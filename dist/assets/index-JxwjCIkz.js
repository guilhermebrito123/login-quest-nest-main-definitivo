var ML=e=>{throw TypeError(e)};var RI=(e,t,r)=>t.has(e)||ML("Cannot "+r);var St=(e,t,r)=>(RI(e,t,"read from private field"),r?r.call(e):t.get(e)),_i=(e,t,r)=>t.has(e)?ML("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),zn=(e,t,r,s)=>(RI(e,t,"write to private field"),s?s.call(e,r):t.set(e,r),r),ds=(e,t,r)=>(RI(e,t,"access private method"),r);var KS=(e,t,r,s)=>({set _(u){zn(e,t,u,r)},get _(){return St(e,t,s)}});function c6(e,t){for(var r=0;r<t.length;r++){const s=t[r];if(typeof s!="string"&&!Array.isArray(s)){for(const u in s)if(u!=="default"&&!(u in e)){const f=Object.getOwnPropertyDescriptor(s,u);f&&Object.defineProperty(e,u,f.get?f:{enumerable:!0,get:()=>s[u]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))s(u);new MutationObserver(u=>{for(const f of u)if(f.type==="childList")for(const m of f.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&s(m)}).observe(document,{childList:!0,subtree:!0});function r(u){const f={};return u.integrity&&(f.integrity=u.integrity),u.referrerPolicy&&(f.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?f.credentials="include":u.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function s(u){if(u.ep)return;u.ep=!0;const f=r(u);fetch(u.href,f)}})();var lK=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function sD(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function cK(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function s(){return this instanceof s?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(s){var u=Object.getOwnPropertyDescriptor(e,s);Object.defineProperty(r,s,u.get?u:{enumerable:!0,get:function(){return e[s]}})}),r}var u6={exports:{}},jC={},d6={exports:{}},Ss={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Pb=Symbol.for("react.element"),uK=Symbol.for("react.portal"),dK=Symbol.for("react.fragment"),hK=Symbol.for("react.strict_mode"),fK=Symbol.for("react.profiler"),pK=Symbol.for("react.provider"),mK=Symbol.for("react.context"),gK=Symbol.for("react.forward_ref"),_K=Symbol.for("react.suspense"),xK=Symbol.for("react.memo"),vK=Symbol.for("react.lazy"),OL=Symbol.iterator;function yK(e){return e===null||typeof e!="object"?null:(e=OL&&e[OL]||e["@@iterator"],typeof e=="function"?e:null)}var h6={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},f6=Object.assign,p6={};function Rv(e,t,r){this.props=e,this.context=t,this.refs=p6,this.updater=r||h6}Rv.prototype.isReactComponent={};Rv.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Rv.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function m6(){}m6.prototype=Rv.prototype;function aD(e,t,r){this.props=e,this.context=t,this.refs=p6,this.updater=r||h6}var oD=aD.prototype=new m6;oD.constructor=aD;f6(oD,Rv.prototype);oD.isPureReactComponent=!0;var FL=Array.isArray,g6=Object.prototype.hasOwnProperty,lD={current:null},_6={key:!0,ref:!0,__self:!0,__source:!0};function x6(e,t,r){var s,u={},f=null,m=null;if(t!=null)for(s in t.ref!==void 0&&(m=t.ref),t.key!==void 0&&(f=""+t.key),t)g6.call(t,s)&&!_6.hasOwnProperty(s)&&(u[s]=t[s]);var i=arguments.length-2;if(i===1)u.children=r;else if(1<i){for(var S=Array(i),E=0;E<i;E++)S[E]=arguments[E+2];u.children=S}if(e&&e.defaultProps)for(s in i=e.defaultProps,i)u[s]===void 0&&(u[s]=i[s]);return{$$typeof:Pb,type:e,key:f,ref:m,props:u,_owner:lD.current}}function wK(e,t){return{$$typeof:Pb,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function cD(e){return typeof e=="object"&&e!==null&&e.$$typeof===Pb}function bK(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var LL=/\/+/g;function MI(e,t){return typeof e=="object"&&e!==null&&e.key!=null?bK(""+e.key):t.toString(36)}function qT(e,t,r,s,u){var f=typeof e;(f==="undefined"||f==="boolean")&&(e=null);var m=!1;if(e===null)m=!0;else switch(f){case"string":case"number":m=!0;break;case"object":switch(e.$$typeof){case Pb:case uK:m=!0}}if(m)return m=e,u=u(m),e=s===""?"."+MI(m,0):s,FL(u)?(r="",e!=null&&(r=e.replace(LL,"$&/")+"/"),qT(u,t,r,"",function(E){return E})):u!=null&&(cD(u)&&(u=wK(u,r+(!u.key||m&&m.key===u.key?"":(""+u.key).replace(LL,"$&/")+"/")+e)),t.push(u)),1;if(m=0,s=s===""?".":s+":",FL(e))for(var i=0;i<e.length;i++){f=e[i];var S=s+MI(f,i);m+=qT(f,t,r,S,u)}else if(S=yK(e),typeof S=="function")for(e=S.call(e),i=0;!(f=e.next()).done;)f=f.value,S=s+MI(f,i++),m+=qT(f,t,r,S,u);else if(f==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return m}function JS(e,t,r){if(e==null)return e;var s=[],u=0;return qT(e,s,"","",function(f){return t.call(r,f,u++)}),s}function SK(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var tc={current:null},GT={transition:null},TK={ReactCurrentDispatcher:tc,ReactCurrentBatchConfig:GT,ReactCurrentOwner:lD};function v6(){throw Error("act(...) is not supported in production builds of React.")}Ss.Children={map:JS,forEach:function(e,t,r){JS(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return JS(e,function(){t++}),t},toArray:function(e){return JS(e,function(t){return t})||[]},only:function(e){if(!cD(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Ss.Component=Rv;Ss.Fragment=dK;Ss.Profiler=fK;Ss.PureComponent=aD;Ss.StrictMode=hK;Ss.Suspense=_K;Ss.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=TK;Ss.act=v6;Ss.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=f6({},e.props),u=e.key,f=e.ref,m=e._owner;if(t!=null){if(t.ref!==void 0&&(f=t.ref,m=lD.current),t.key!==void 0&&(u=""+t.key),e.type&&e.type.defaultProps)var i=e.type.defaultProps;for(S in t)g6.call(t,S)&&!_6.hasOwnProperty(S)&&(s[S]=t[S]===void 0&&i!==void 0?i[S]:t[S])}var S=arguments.length-2;if(S===1)s.children=r;else if(1<S){i=Array(S);for(var E=0;E<S;E++)i[E]=arguments[E+2];s.children=i}return{$$typeof:Pb,type:e.type,key:u,ref:f,props:s,_owner:m}};Ss.createContext=function(e){return e={$$typeof:mK,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:pK,_context:e},e.Consumer=e};Ss.createElement=x6;Ss.createFactory=function(e){var t=x6.bind(null,e);return t.type=e,t};Ss.createRef=function(){return{current:null}};Ss.forwardRef=function(e){return{$$typeof:gK,render:e}};Ss.isValidElement=cD;Ss.lazy=function(e){return{$$typeof:vK,_payload:{_status:-1,_result:e},_init:SK}};Ss.memo=function(e,t){return{$$typeof:xK,type:e,compare:t===void 0?null:t}};Ss.startTransition=function(e){var t=GT.transition;GT.transition={};try{e()}finally{GT.transition=t}};Ss.unstable_act=v6;Ss.useCallback=function(e,t){return tc.current.useCallback(e,t)};Ss.useContext=function(e){return tc.current.useContext(e)};Ss.useDebugValue=function(){};Ss.useDeferredValue=function(e){return tc.current.useDeferredValue(e)};Ss.useEffect=function(e,t){return tc.current.useEffect(e,t)};Ss.useId=function(){return tc.current.useId()};Ss.useImperativeHandle=function(e,t,r){return tc.current.useImperativeHandle(e,t,r)};Ss.useInsertionEffect=function(e,t){return tc.current.useInsertionEffect(e,t)};Ss.useLayoutEffect=function(e,t){return tc.current.useLayoutEffect(e,t)};Ss.useMemo=function(e,t){return tc.current.useMemo(e,t)};Ss.useReducer=function(e,t,r){return tc.current.useReducer(e,t,r)};Ss.useRef=function(e){return tc.current.useRef(e)};Ss.useState=function(e){return tc.current.useState(e)};Ss.useSyncExternalStore=function(e,t,r){return tc.current.useSyncExternalStore(e,t,r)};Ss.useTransition=function(){return tc.current.useTransition()};Ss.version="18.3.1";d6.exports=Ss;var V=d6.exports;const Cr=sD(V),uD=c6({__proto__:null,default:Cr},[V]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var EK=V,CK=Symbol.for("react.element"),AK=Symbol.for("react.fragment"),jK=Object.prototype.hasOwnProperty,IK=EK.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,NK={key:!0,ref:!0,__self:!0,__source:!0};function y6(e,t,r){var s,u={},f=null,m=null;r!==void 0&&(f=""+r),t.key!==void 0&&(f=""+t.key),t.ref!==void 0&&(m=t.ref);for(s in t)jK.call(t,s)&&!NK.hasOwnProperty(s)&&(u[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps,t)u[s]===void 0&&(u[s]=t[s]);return{$$typeof:CK,type:e,key:f,ref:m,props:u,_owner:IK.current}}jC.Fragment=AK;jC.jsx=y6;jC.jsxs=y6;u6.exports=jC;var c=u6.exports,w6={exports:{}},tu={},b6={exports:{}},S6={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(Me,mt){var Kt=Me.length;Me.push(mt);e:for(;0<Kt;){var it=Kt-1>>>1,ee=Me[it];if(0<u(ee,mt))Me[it]=mt,Me[Kt]=ee,Kt=it;else break e}}function r(Me){return Me.length===0?null:Me[0]}function s(Me){if(Me.length===0)return null;var mt=Me[0],Kt=Me.pop();if(Kt!==mt){Me[0]=Kt;e:for(var it=0,ee=Me.length,he=ee>>>1;it<he;){var Se=2*(it+1)-1,Ue=Me[Se],nt=Se+1,dt=Me[nt];if(0>u(Ue,Kt))nt<ee&&0>u(dt,Ue)?(Me[it]=dt,Me[nt]=Kt,it=nt):(Me[it]=Ue,Me[Se]=Kt,it=Se);else if(nt<ee&&0>u(dt,Kt))Me[it]=dt,Me[nt]=Kt,it=nt;else break e}}return mt}function u(Me,mt){var Kt=Me.sortIndex-mt.sortIndex;return Kt!==0?Kt:Me.id-mt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var f=performance;e.unstable_now=function(){return f.now()}}else{var m=Date,i=m.now();e.unstable_now=function(){return m.now()-i}}var S=[],E=[],I=1,D=null,M=3,R=!1,H=!1,F=!1,U=typeof setTimeout=="function"?setTimeout:null,Y=typeof clearTimeout=="function"?clearTimeout:null,z=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function J(Me){for(var mt=r(E);mt!==null;){if(mt.callback===null)s(E);else if(mt.startTime<=Me)s(E),mt.sortIndex=mt.expirationTime,t(S,mt);else break;mt=r(E)}}function ne(Me){if(F=!1,J(Me),!H)if(r(S)!==null)H=!0,Xe(me);else{var mt=r(E);mt!==null&&ct(ne,mt.startTime-Me)}}function me(Me,mt){H=!1,F&&(F=!1,Y(pe),pe=-1),R=!0;var Kt=M;try{for(J(mt),D=r(S);D!==null&&(!(D.expirationTime>mt)||Me&&!Oe());){var it=D.callback;if(typeof it=="function"){D.callback=null,M=D.priorityLevel;var ee=it(D.expirationTime<=mt);mt=e.unstable_now(),typeof ee=="function"?D.callback=ee:D===r(S)&&s(S),J(mt)}else s(S);D=r(S)}if(D!==null)var he=!0;else{var Se=r(E);Se!==null&&ct(ne,Se.startTime-mt),he=!1}return he}finally{D=null,M=Kt,R=!1}}var le=!1,ye=null,pe=-1,be=5,ke=-1;function Oe(){return!(e.unstable_now()-ke<be)}function Ee(){if(ye!==null){var Me=e.unstable_now();ke=Me;var mt=!0;try{mt=ye(!0,Me)}finally{mt?qe():(le=!1,ye=null)}}else le=!1}var qe;if(typeof z=="function")qe=function(){z(Ee)};else if(typeof MessageChannel<"u"){var Qe=new MessageChannel,gt=Qe.port2;Qe.port1.onmessage=Ee,qe=function(){gt.postMessage(null)}}else qe=function(){U(Ee,0)};function Xe(Me){ye=Me,le||(le=!0,qe())}function ct(Me,mt){pe=U(function(){Me(e.unstable_now())},mt)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(Me){Me.callback=null},e.unstable_continueExecution=function(){H||R||(H=!0,Xe(me))},e.unstable_forceFrameRate=function(Me){0>Me||125<Me?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):be=0<Me?Math.floor(1e3/Me):5},e.unstable_getCurrentPriorityLevel=function(){return M},e.unstable_getFirstCallbackNode=function(){return r(S)},e.unstable_next=function(Me){switch(M){case 1:case 2:case 3:var mt=3;break;default:mt=M}var Kt=M;M=mt;try{return Me()}finally{M=Kt}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(Me,mt){switch(Me){case 1:case 2:case 3:case 4:case 5:break;default:Me=3}var Kt=M;M=Me;try{return mt()}finally{M=Kt}},e.unstable_scheduleCallback=function(Me,mt,Kt){var it=e.unstable_now();switch(typeof Kt=="object"&&Kt!==null?(Kt=Kt.delay,Kt=typeof Kt=="number"&&0<Kt?it+Kt:it):Kt=it,Me){case 1:var ee=-1;break;case 2:ee=250;break;case 5:ee=1073741823;break;case 4:ee=1e4;break;default:ee=5e3}return ee=Kt+ee,Me={id:I++,callback:mt,priorityLevel:Me,startTime:Kt,expirationTime:ee,sortIndex:-1},Kt>it?(Me.sortIndex=Kt,t(E,Me),r(S)===null&&Me===r(E)&&(F?(Y(pe),pe=-1):F=!0,ct(ne,Kt-it))):(Me.sortIndex=ee,t(S,Me),H||R||(H=!0,Xe(me))),Me},e.unstable_shouldYield=Oe,e.unstable_wrapCallback=function(Me){var mt=M;return function(){var Kt=M;M=mt;try{return Me.apply(this,arguments)}finally{M=Kt}}}})(S6);b6.exports=S6;var kK=b6.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var PK=V,Kc=kK;function rn(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var T6=new Set,qw={};function A_(e,t){mv(e,t),mv(e+"Capture",t)}function mv(e,t){for(qw[e]=t,e=0;e<t.length;e++)T6.add(t[e])}var ff=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),QN=Object.prototype.hasOwnProperty,DK=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,zL={},BL={};function RK(e){return QN.call(BL,e)?!0:QN.call(zL,e)?!1:DK.test(e)?BL[e]=!0:(zL[e]=!0,!1)}function MK(e,t,r,s){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return s?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function OK(e,t,r,s){if(t===null||typeof t>"u"||MK(e,t,r,s))return!0;if(s)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function rc(e,t,r,s,u,f,m){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=s,this.attributeNamespace=u,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=f,this.removeEmptyString=m}var hl={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){hl[e]=new rc(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];hl[t]=new rc(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){hl[e]=new rc(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){hl[e]=new rc(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){hl[e]=new rc(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){hl[e]=new rc(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){hl[e]=new rc(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){hl[e]=new rc(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){hl[e]=new rc(e,5,!1,e.toLowerCase(),null,!1,!1)});var dD=/[\-:]([a-z])/g;function hD(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(dD,hD);hl[t]=new rc(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(dD,hD);hl[t]=new rc(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(dD,hD);hl[t]=new rc(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){hl[e]=new rc(e,1,!1,e.toLowerCase(),null,!1,!1)});hl.xlinkHref=new rc("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){hl[e]=new rc(e,1,!1,e.toLowerCase(),null,!0,!0)});function fD(e,t,r,s){var u=hl.hasOwnProperty(t)?hl[t]:null;(u!==null?u.type!==0:s||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(OK(t,r,u,s)&&(r=null),s||u===null?RK(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):u.mustUseProperty?e[u.propertyName]=r===null?u.type===3?!1:"":r:(t=u.attributeName,s=u.attributeNamespace,r===null?e.removeAttribute(t):(u=u.type,r=u===3||u===4&&r===!0?"":""+r,s?e.setAttributeNS(s,t,r):e.setAttribute(t,r))))}var wf=PK.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,QS=Symbol.for("react.element"),Cx=Symbol.for("react.portal"),Ax=Symbol.for("react.fragment"),pD=Symbol.for("react.strict_mode"),ek=Symbol.for("react.profiler"),E6=Symbol.for("react.provider"),C6=Symbol.for("react.context"),mD=Symbol.for("react.forward_ref"),tk=Symbol.for("react.suspense"),rk=Symbol.for("react.suspense_list"),gD=Symbol.for("react.memo"),Ap=Symbol.for("react.lazy"),A6=Symbol.for("react.offscreen"),UL=Symbol.iterator;function J1(e){return e===null||typeof e!="object"?null:(e=UL&&e[UL]||e["@@iterator"],typeof e=="function"?e:null)}var to=Object.assign,OI;function hw(e){if(OI===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);OI=t&&t[1]||""}return`
`+OI+e}var FI=!1;function LI(e,t){if(!e||FI)return"";FI=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(E){var s=E}Reflect.construct(e,[],t)}else{try{t.call()}catch(E){s=E}e.call(t.prototype)}else{try{throw Error()}catch(E){s=E}e()}}catch(E){if(E&&s&&typeof E.stack=="string"){for(var u=E.stack.split(`
`),f=s.stack.split(`
`),m=u.length-1,i=f.length-1;1<=m&&0<=i&&u[m]!==f[i];)i--;for(;1<=m&&0<=i;m--,i--)if(u[m]!==f[i]){if(m!==1||i!==1)do if(m--,i--,0>i||u[m]!==f[i]){var S=`
`+u[m].replace(" at new "," at ");return e.displayName&&S.includes("<anonymous>")&&(S=S.replace("<anonymous>",e.displayName)),S}while(1<=m&&0<=i);break}}}finally{FI=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?hw(e):""}function FK(e){switch(e.tag){case 5:return hw(e.type);case 16:return hw("Lazy");case 13:return hw("Suspense");case 19:return hw("SuspenseList");case 0:case 2:case 15:return e=LI(e.type,!1),e;case 11:return e=LI(e.type.render,!1),e;case 1:return e=LI(e.type,!0),e;default:return""}}function nk(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Ax:return"Fragment";case Cx:return"Portal";case ek:return"Profiler";case pD:return"StrictMode";case tk:return"Suspense";case rk:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case C6:return(e.displayName||"Context")+".Consumer";case E6:return(e._context.displayName||"Context")+".Provider";case mD:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case gD:return t=e.displayName||null,t!==null?t:nk(e.type)||"Memo";case Ap:t=e._payload,e=e._init;try{return nk(e(t))}catch{}}return null}function LK(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return nk(t);case 8:return t===pD?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function am(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function j6(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function zK(e){var t=j6(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),s=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var u=r.get,f=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return u.call(this)},set:function(m){s=""+m,f.call(this,m)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return s},setValue:function(m){s=""+m},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function eT(e){e._valueTracker||(e._valueTracker=zK(e))}function I6(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),s="";return e&&(s=j6(e)?e.checked?"true":"false":e.value),e=s,e!==r?(t.setValue(e),!0):!1}function pE(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function ik(e,t){var r=t.checked;return to({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function VL(e,t){var r=t.defaultValue==null?"":t.defaultValue,s=t.checked!=null?t.checked:t.defaultChecked;r=am(t.value!=null?t.value:r),e._wrapperState={initialChecked:s,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function N6(e,t){t=t.checked,t!=null&&fD(e,"checked",t,!1)}function sk(e,t){N6(e,t);var r=am(t.value),s=t.type;if(r!=null)s==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(s==="submit"||s==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?ak(e,t.type,r):t.hasOwnProperty("defaultValue")&&ak(e,t.type,am(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function $L(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var s=t.type;if(!(s!=="submit"&&s!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function ak(e,t,r){(t!=="number"||pE(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var fw=Array.isArray;function Bx(e,t,r,s){if(e=e.options,t){t={};for(var u=0;u<r.length;u++)t["$"+r[u]]=!0;for(r=0;r<e.length;r++)u=t.hasOwnProperty("$"+e[r].value),e[r].selected!==u&&(e[r].selected=u),u&&s&&(e[r].defaultSelected=!0)}else{for(r=""+am(r),t=null,u=0;u<e.length;u++){if(e[u].value===r){e[u].selected=!0,s&&(e[u].defaultSelected=!0);return}t!==null||e[u].disabled||(t=e[u])}t!==null&&(t.selected=!0)}}function ok(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(rn(91));return to({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function qL(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(rn(92));if(fw(r)){if(1<r.length)throw Error(rn(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:am(r)}}function k6(e,t){var r=am(t.value),s=am(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),s!=null&&(e.defaultValue=""+s)}function GL(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function P6(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lk(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?P6(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var tT,D6=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,s,u){MSApp.execUnsafeLocalFunction(function(){return e(t,r,s,u)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(tT=tT||document.createElement("div"),tT.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=tT.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Gw(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var Sw={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},BK=["Webkit","ms","Moz","O"];Object.keys(Sw).forEach(function(e){BK.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Sw[t]=Sw[e]})});function R6(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||Sw.hasOwnProperty(e)&&Sw[e]?(""+t).trim():t+"px"}function M6(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var s=r.indexOf("--")===0,u=R6(r,t[r],s);r==="float"&&(r="cssFloat"),s?e.setProperty(r,u):e[r]=u}}var UK=to({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ck(e,t){if(t){if(UK[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(rn(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(rn(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(rn(61))}if(t.style!=null&&typeof t.style!="object")throw Error(rn(62))}}function uk(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var dk=null;function _D(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var hk=null,Ux=null,Vx=null;function WL(e){if(e=Mb(e)){if(typeof hk!="function")throw Error(rn(280));var t=e.stateNode;t&&(t=DC(t),hk(e.stateNode,e.type,t))}}function O6(e){Ux?Vx?Vx.push(e):Vx=[e]:Ux=e}function F6(){if(Ux){var e=Ux,t=Vx;if(Vx=Ux=null,WL(e),t)for(e=0;e<t.length;e++)WL(t[e])}}function L6(e,t){return e(t)}function z6(){}var zI=!1;function B6(e,t,r){if(zI)return e(t,r);zI=!0;try{return L6(e,t,r)}finally{zI=!1,(Ux!==null||Vx!==null)&&(z6(),F6())}}function Ww(e,t){var r=e.stateNode;if(r===null)return null;var s=DC(r);if(s===null)return null;r=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(e=e.type,s=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!s;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(rn(231,t,typeof r));return r}var fk=!1;if(ff)try{var Q1={};Object.defineProperty(Q1,"passive",{get:function(){fk=!0}}),window.addEventListener("test",Q1,Q1),window.removeEventListener("test",Q1,Q1)}catch{fk=!1}function VK(e,t,r,s,u,f,m,i,S){var E=Array.prototype.slice.call(arguments,3);try{t.apply(r,E)}catch(I){this.onError(I)}}var Tw=!1,mE=null,gE=!1,pk=null,$K={onError:function(e){Tw=!0,mE=e}};function qK(e,t,r,s,u,f,m,i,S){Tw=!1,mE=null,VK.apply($K,arguments)}function GK(e,t,r,s,u,f,m,i,S){if(qK.apply(this,arguments),Tw){if(Tw){var E=mE;Tw=!1,mE=null}else throw Error(rn(198));gE||(gE=!0,pk=E)}}function j_(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function U6(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function HL(e){if(j_(e)!==e)throw Error(rn(188))}function WK(e){var t=e.alternate;if(!t){if(t=j_(e),t===null)throw Error(rn(188));return t!==e?null:e}for(var r=e,s=t;;){var u=r.return;if(u===null)break;var f=u.alternate;if(f===null){if(s=u.return,s!==null){r=s;continue}break}if(u.child===f.child){for(f=u.child;f;){if(f===r)return HL(u),e;if(f===s)return HL(u),t;f=f.sibling}throw Error(rn(188))}if(r.return!==s.return)r=u,s=f;else{for(var m=!1,i=u.child;i;){if(i===r){m=!0,r=u,s=f;break}if(i===s){m=!0,s=u,r=f;break}i=i.sibling}if(!m){for(i=f.child;i;){if(i===r){m=!0,r=f,s=u;break}if(i===s){m=!0,s=f,r=u;break}i=i.sibling}if(!m)throw Error(rn(189))}}if(r.alternate!==s)throw Error(rn(190))}if(r.tag!==3)throw Error(rn(188));return r.stateNode.current===r?e:t}function V6(e){return e=WK(e),e!==null?$6(e):null}function $6(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=$6(e);if(t!==null)return t;e=e.sibling}return null}var q6=Kc.unstable_scheduleCallback,ZL=Kc.unstable_cancelCallback,HK=Kc.unstable_shouldYield,ZK=Kc.unstable_requestPaint,xo=Kc.unstable_now,XK=Kc.unstable_getCurrentPriorityLevel,xD=Kc.unstable_ImmediatePriority,G6=Kc.unstable_UserBlockingPriority,_E=Kc.unstable_NormalPriority,YK=Kc.unstable_LowPriority,W6=Kc.unstable_IdlePriority,IC=null,uh=null;function KK(e){if(uh&&typeof uh.onCommitFiberRoot=="function")try{uh.onCommitFiberRoot(IC,e,void 0,(e.current.flags&128)===128)}catch{}}var vd=Math.clz32?Math.clz32:eJ,JK=Math.log,QK=Math.LN2;function eJ(e){return e>>>=0,e===0?32:31-(JK(e)/QK|0)|0}var rT=64,nT=4194304;function pw(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function xE(e,t){var r=e.pendingLanes;if(r===0)return 0;var s=0,u=e.suspendedLanes,f=e.pingedLanes,m=r&268435455;if(m!==0){var i=m&~u;i!==0?s=pw(i):(f&=m,f!==0&&(s=pw(f)))}else m=r&~u,m!==0?s=pw(m):f!==0&&(s=pw(f));if(s===0)return 0;if(t!==0&&t!==s&&!(t&u)&&(u=s&-s,f=t&-t,u>=f||u===16&&(f&4194240)!==0))return t;if(s&4&&(s|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=s;0<t;)r=31-vd(t),u=1<<r,s|=e[r],t&=~u;return s}function tJ(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function rJ(e,t){for(var r=e.suspendedLanes,s=e.pingedLanes,u=e.expirationTimes,f=e.pendingLanes;0<f;){var m=31-vd(f),i=1<<m,S=u[m];S===-1?(!(i&r)||i&s)&&(u[m]=tJ(i,t)):S<=t&&(e.expiredLanes|=i),f&=~i}}function mk(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function H6(){var e=rT;return rT<<=1,!(rT&4194240)&&(rT=64),e}function BI(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function Db(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-vd(t),e[t]=r}function nJ(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var s=e.eventTimes;for(e=e.expirationTimes;0<r;){var u=31-vd(r),f=1<<u;t[u]=0,s[u]=-1,e[u]=-1,r&=~f}}function vD(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var s=31-vd(r),u=1<<s;u&t|e[s]&t&&(e[s]|=t),r&=~u}}var va=0;function Z6(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var X6,yD,Y6,K6,J6,gk=!1,iT=[],Zp=null,Xp=null,Yp=null,Hw=new Map,Zw=new Map,Np=[],iJ="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function XL(e,t){switch(e){case"focusin":case"focusout":Zp=null;break;case"dragenter":case"dragleave":Xp=null;break;case"mouseover":case"mouseout":Yp=null;break;case"pointerover":case"pointerout":Hw.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Zw.delete(t.pointerId)}}function ew(e,t,r,s,u,f){return e===null||e.nativeEvent!==f?(e={blockedOn:t,domEventName:r,eventSystemFlags:s,nativeEvent:f,targetContainers:[u]},t!==null&&(t=Mb(t),t!==null&&yD(t)),e):(e.eventSystemFlags|=s,t=e.targetContainers,u!==null&&t.indexOf(u)===-1&&t.push(u),e)}function sJ(e,t,r,s,u){switch(t){case"focusin":return Zp=ew(Zp,e,t,r,s,u),!0;case"dragenter":return Xp=ew(Xp,e,t,r,s,u),!0;case"mouseover":return Yp=ew(Yp,e,t,r,s,u),!0;case"pointerover":var f=u.pointerId;return Hw.set(f,ew(Hw.get(f)||null,e,t,r,s,u)),!0;case"gotpointercapture":return f=u.pointerId,Zw.set(f,ew(Zw.get(f)||null,e,t,r,s,u)),!0}return!1}function Q6(e){var t=Vg(e.target);if(t!==null){var r=j_(t);if(r!==null){if(t=r.tag,t===13){if(t=U6(r),t!==null){e.blockedOn=t,J6(e.priority,function(){Y6(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function WT(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=_k(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var s=new r.constructor(r.type,r);dk=s,r.target.dispatchEvent(s),dk=null}else return t=Mb(r),t!==null&&yD(t),e.blockedOn=r,!1;t.shift()}return!0}function YL(e,t,r){WT(e)&&r.delete(t)}function aJ(){gk=!1,Zp!==null&&WT(Zp)&&(Zp=null),Xp!==null&&WT(Xp)&&(Xp=null),Yp!==null&&WT(Yp)&&(Yp=null),Hw.forEach(YL),Zw.forEach(YL)}function tw(e,t){e.blockedOn===t&&(e.blockedOn=null,gk||(gk=!0,Kc.unstable_scheduleCallback(Kc.unstable_NormalPriority,aJ)))}function Xw(e){function t(u){return tw(u,e)}if(0<iT.length){tw(iT[0],e);for(var r=1;r<iT.length;r++){var s=iT[r];s.blockedOn===e&&(s.blockedOn=null)}}for(Zp!==null&&tw(Zp,e),Xp!==null&&tw(Xp,e),Yp!==null&&tw(Yp,e),Hw.forEach(t),Zw.forEach(t),r=0;r<Np.length;r++)s=Np[r],s.blockedOn===e&&(s.blockedOn=null);for(;0<Np.length&&(r=Np[0],r.blockedOn===null);)Q6(r),r.blockedOn===null&&Np.shift()}var $x=wf.ReactCurrentBatchConfig,vE=!0;function oJ(e,t,r,s){var u=va,f=$x.transition;$x.transition=null;try{va=1,wD(e,t,r,s)}finally{va=u,$x.transition=f}}function lJ(e,t,r,s){var u=va,f=$x.transition;$x.transition=null;try{va=4,wD(e,t,r,s)}finally{va=u,$x.transition=f}}function wD(e,t,r,s){if(vE){var u=_k(e,t,r,s);if(u===null)YI(e,t,s,yE,r),XL(e,s);else if(sJ(u,e,t,r,s))s.stopPropagation();else if(XL(e,s),t&4&&-1<iJ.indexOf(e)){for(;u!==null;){var f=Mb(u);if(f!==null&&X6(f),f=_k(e,t,r,s),f===null&&YI(e,t,s,yE,r),f===u)break;u=f}u!==null&&s.stopPropagation()}else YI(e,t,s,null,r)}}var yE=null;function _k(e,t,r,s){if(yE=null,e=_D(s),e=Vg(e),e!==null)if(t=j_(e),t===null)e=null;else if(r=t.tag,r===13){if(e=U6(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return yE=e,null}function eU(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(XK()){case xD:return 1;case G6:return 4;case _E:case YK:return 16;case W6:return 536870912;default:return 16}default:return 16}}var $p=null,bD=null,HT=null;function tU(){if(HT)return HT;var e,t=bD,r=t.length,s,u="value"in $p?$p.value:$p.textContent,f=u.length;for(e=0;e<r&&t[e]===u[e];e++);var m=r-e;for(s=1;s<=m&&t[r-s]===u[f-s];s++);return HT=u.slice(e,1<s?1-s:void 0)}function ZT(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function sT(){return!0}function KL(){return!1}function ru(e){function t(r,s,u,f,m){this._reactName=r,this._targetInst=u,this.type=s,this.nativeEvent=f,this.target=m,this.currentTarget=null;for(var i in e)e.hasOwnProperty(i)&&(r=e[i],this[i]=r?r(f):f[i]);return this.isDefaultPrevented=(f.defaultPrevented!=null?f.defaultPrevented:f.returnValue===!1)?sT:KL,this.isPropagationStopped=KL,this}return to(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=sT)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=sT)},persist:function(){},isPersistent:sT}),t}var Mv={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},SD=ru(Mv),Rb=to({},Mv,{view:0,detail:0}),cJ=ru(Rb),UI,VI,rw,NC=to({},Rb,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:TD,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==rw&&(rw&&e.type==="mousemove"?(UI=e.screenX-rw.screenX,VI=e.screenY-rw.screenY):VI=UI=0,rw=e),UI)},movementY:function(e){return"movementY"in e?e.movementY:VI}}),JL=ru(NC),uJ=to({},NC,{dataTransfer:0}),dJ=ru(uJ),hJ=to({},Rb,{relatedTarget:0}),$I=ru(hJ),fJ=to({},Mv,{animationName:0,elapsedTime:0,pseudoElement:0}),pJ=ru(fJ),mJ=to({},Mv,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),gJ=ru(mJ),_J=to({},Mv,{data:0}),QL=ru(_J),xJ={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},vJ={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},yJ={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function wJ(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=yJ[e])?!!t[e]:!1}function TD(){return wJ}var bJ=to({},Rb,{key:function(e){if(e.key){var t=xJ[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=ZT(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?vJ[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:TD,charCode:function(e){return e.type==="keypress"?ZT(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?ZT(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),SJ=ru(bJ),TJ=to({},NC,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),e4=ru(TJ),EJ=to({},Rb,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:TD}),CJ=ru(EJ),AJ=to({},Mv,{propertyName:0,elapsedTime:0,pseudoElement:0}),jJ=ru(AJ),IJ=to({},NC,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),NJ=ru(IJ),kJ=[9,13,27,32],ED=ff&&"CompositionEvent"in window,Ew=null;ff&&"documentMode"in document&&(Ew=document.documentMode);var PJ=ff&&"TextEvent"in window&&!Ew,rU=ff&&(!ED||Ew&&8<Ew&&11>=Ew),t4=" ",r4=!1;function nU(e,t){switch(e){case"keyup":return kJ.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function iU(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var jx=!1;function DJ(e,t){switch(e){case"compositionend":return iU(t);case"keypress":return t.which!==32?null:(r4=!0,t4);case"textInput":return e=t.data,e===t4&&r4?null:e;default:return null}}function RJ(e,t){if(jx)return e==="compositionend"||!ED&&nU(e,t)?(e=tU(),HT=bD=$p=null,jx=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return rU&&t.locale!=="ko"?null:t.data;default:return null}}var MJ={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function n4(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!MJ[e.type]:t==="textarea"}function sU(e,t,r,s){O6(s),t=wE(t,"onChange"),0<t.length&&(r=new SD("onChange","change",null,r,s),e.push({event:r,listeners:t}))}var Cw=null,Yw=null;function OJ(e){gU(e,0)}function kC(e){var t=kx(e);if(I6(t))return e}function FJ(e,t){if(e==="change")return t}var aU=!1;if(ff){var qI;if(ff){var GI="oninput"in document;if(!GI){var i4=document.createElement("div");i4.setAttribute("oninput","return;"),GI=typeof i4.oninput=="function"}qI=GI}else qI=!1;aU=qI&&(!document.documentMode||9<document.documentMode)}function s4(){Cw&&(Cw.detachEvent("onpropertychange",oU),Yw=Cw=null)}function oU(e){if(e.propertyName==="value"&&kC(Yw)){var t=[];sU(t,Yw,e,_D(e)),B6(OJ,t)}}function LJ(e,t,r){e==="focusin"?(s4(),Cw=t,Yw=r,Cw.attachEvent("onpropertychange",oU)):e==="focusout"&&s4()}function zJ(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return kC(Yw)}function BJ(e,t){if(e==="click")return kC(t)}function UJ(e,t){if(e==="input"||e==="change")return kC(t)}function VJ(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var bd=typeof Object.is=="function"?Object.is:VJ;function Kw(e,t){if(bd(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),s=Object.keys(t);if(r.length!==s.length)return!1;for(s=0;s<r.length;s++){var u=r[s];if(!QN.call(t,u)||!bd(e[u],t[u]))return!1}return!0}function a4(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function o4(e,t){var r=a4(e);e=0;for(var s;r;){if(r.nodeType===3){if(s=e+r.textContent.length,e<=t&&s>=t)return{node:r,offset:t-e};e=s}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=a4(r)}}function lU(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?lU(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function cU(){for(var e=window,t=pE();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=pE(e.document)}return t}function CD(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function $J(e){var t=cU(),r=e.focusedElem,s=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&lU(r.ownerDocument.documentElement,r)){if(s!==null&&CD(r)){if(t=s.start,e=s.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var u=r.textContent.length,f=Math.min(s.start,u);s=s.end===void 0?f:Math.min(s.end,u),!e.extend&&f>s&&(u=s,s=f,f=u),u=o4(r,f);var m=o4(r,s);u&&m&&(e.rangeCount!==1||e.anchorNode!==u.node||e.anchorOffset!==u.offset||e.focusNode!==m.node||e.focusOffset!==m.offset)&&(t=t.createRange(),t.setStart(u.node,u.offset),e.removeAllRanges(),f>s?(e.addRange(t),e.extend(m.node,m.offset)):(t.setEnd(m.node,m.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var qJ=ff&&"documentMode"in document&&11>=document.documentMode,Ix=null,xk=null,Aw=null,vk=!1;function l4(e,t,r){var s=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;vk||Ix==null||Ix!==pE(s)||(s=Ix,"selectionStart"in s&&CD(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),Aw&&Kw(Aw,s)||(Aw=s,s=wE(xk,"onSelect"),0<s.length&&(t=new SD("onSelect","select",null,t,r),e.push({event:t,listeners:s}),t.target=Ix)))}function aT(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var Nx={animationend:aT("Animation","AnimationEnd"),animationiteration:aT("Animation","AnimationIteration"),animationstart:aT("Animation","AnimationStart"),transitionend:aT("Transition","TransitionEnd")},WI={},uU={};ff&&(uU=document.createElement("div").style,"AnimationEvent"in window||(delete Nx.animationend.animation,delete Nx.animationiteration.animation,delete Nx.animationstart.animation),"TransitionEvent"in window||delete Nx.transitionend.transition);function PC(e){if(WI[e])return WI[e];if(!Nx[e])return e;var t=Nx[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in uU)return WI[e]=t[r];return e}var dU=PC("animationend"),hU=PC("animationiteration"),fU=PC("animationstart"),pU=PC("transitionend"),mU=new Map,c4="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function xm(e,t){mU.set(e,t),A_(t,[e])}for(var HI=0;HI<c4.length;HI++){var ZI=c4[HI],GJ=ZI.toLowerCase(),WJ=ZI[0].toUpperCase()+ZI.slice(1);xm(GJ,"on"+WJ)}xm(dU,"onAnimationEnd");xm(hU,"onAnimationIteration");xm(fU,"onAnimationStart");xm("dblclick","onDoubleClick");xm("focusin","onFocus");xm("focusout","onBlur");xm(pU,"onTransitionEnd");mv("onMouseEnter",["mouseout","mouseover"]);mv("onMouseLeave",["mouseout","mouseover"]);mv("onPointerEnter",["pointerout","pointerover"]);mv("onPointerLeave",["pointerout","pointerover"]);A_("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));A_("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));A_("onBeforeInput",["compositionend","keypress","textInput","paste"]);A_("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));A_("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));A_("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var mw="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),HJ=new Set("cancel close invalid load scroll toggle".split(" ").concat(mw));function u4(e,t,r){var s=e.type||"unknown-event";e.currentTarget=r,GK(s,t,void 0,e),e.currentTarget=null}function gU(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var s=e[r],u=s.event;s=s.listeners;e:{var f=void 0;if(t)for(var m=s.length-1;0<=m;m--){var i=s[m],S=i.instance,E=i.currentTarget;if(i=i.listener,S!==f&&u.isPropagationStopped())break e;u4(u,i,E),f=S}else for(m=0;m<s.length;m++){if(i=s[m],S=i.instance,E=i.currentTarget,i=i.listener,S!==f&&u.isPropagationStopped())break e;u4(u,i,E),f=S}}}if(gE)throw e=pk,gE=!1,pk=null,e}function Fa(e,t){var r=t[Tk];r===void 0&&(r=t[Tk]=new Set);var s=e+"__bubble";r.has(s)||(_U(t,e,2,!1),r.add(s))}function XI(e,t,r){var s=0;t&&(s|=4),_U(r,e,s,t)}var oT="_reactListening"+Math.random().toString(36).slice(2);function Jw(e){if(!e[oT]){e[oT]=!0,T6.forEach(function(r){r!=="selectionchange"&&(HJ.has(r)||XI(r,!1,e),XI(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[oT]||(t[oT]=!0,XI("selectionchange",!1,t))}}function _U(e,t,r,s){switch(eU(t)){case 1:var u=oJ;break;case 4:u=lJ;break;default:u=wD}r=u.bind(null,t,r,e),u=void 0,!fk||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(u=!0),s?u!==void 0?e.addEventListener(t,r,{capture:!0,passive:u}):e.addEventListener(t,r,!0):u!==void 0?e.addEventListener(t,r,{passive:u}):e.addEventListener(t,r,!1)}function YI(e,t,r,s,u){var f=s;if(!(t&1)&&!(t&2)&&s!==null)e:for(;;){if(s===null)return;var m=s.tag;if(m===3||m===4){var i=s.stateNode.containerInfo;if(i===u||i.nodeType===8&&i.parentNode===u)break;if(m===4)for(m=s.return;m!==null;){var S=m.tag;if((S===3||S===4)&&(S=m.stateNode.containerInfo,S===u||S.nodeType===8&&S.parentNode===u))return;m=m.return}for(;i!==null;){if(m=Vg(i),m===null)return;if(S=m.tag,S===5||S===6){s=f=m;continue e}i=i.parentNode}}s=s.return}B6(function(){var E=f,I=_D(r),D=[];e:{var M=mU.get(e);if(M!==void 0){var R=SD,H=e;switch(e){case"keypress":if(ZT(r)===0)break e;case"keydown":case"keyup":R=SJ;break;case"focusin":H="focus",R=$I;break;case"focusout":H="blur",R=$I;break;case"beforeblur":case"afterblur":R=$I;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":R=JL;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":R=dJ;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":R=CJ;break;case dU:case hU:case fU:R=pJ;break;case pU:R=jJ;break;case"scroll":R=cJ;break;case"wheel":R=NJ;break;case"copy":case"cut":case"paste":R=gJ;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":R=e4}var F=(t&4)!==0,U=!F&&e==="scroll",Y=F?M!==null?M+"Capture":null:M;F=[];for(var z=E,J;z!==null;){J=z;var ne=J.stateNode;if(J.tag===5&&ne!==null&&(J=ne,Y!==null&&(ne=Ww(z,Y),ne!=null&&F.push(Qw(z,ne,J)))),U)break;z=z.return}0<F.length&&(M=new R(M,H,null,r,I),D.push({event:M,listeners:F}))}}if(!(t&7)){e:{if(M=e==="mouseover"||e==="pointerover",R=e==="mouseout"||e==="pointerout",M&&r!==dk&&(H=r.relatedTarget||r.fromElement)&&(Vg(H)||H[pf]))break e;if((R||M)&&(M=I.window===I?I:(M=I.ownerDocument)?M.defaultView||M.parentWindow:window,R?(H=r.relatedTarget||r.toElement,R=E,H=H?Vg(H):null,H!==null&&(U=j_(H),H!==U||H.tag!==5&&H.tag!==6)&&(H=null)):(R=null,H=E),R!==H)){if(F=JL,ne="onMouseLeave",Y="onMouseEnter",z="mouse",(e==="pointerout"||e==="pointerover")&&(F=e4,ne="onPointerLeave",Y="onPointerEnter",z="pointer"),U=R==null?M:kx(R),J=H==null?M:kx(H),M=new F(ne,z+"leave",R,r,I),M.target=U,M.relatedTarget=J,ne=null,Vg(I)===E&&(F=new F(Y,z+"enter",H,r,I),F.target=J,F.relatedTarget=U,ne=F),U=ne,R&&H)t:{for(F=R,Y=H,z=0,J=F;J;J=ax(J))z++;for(J=0,ne=Y;ne;ne=ax(ne))J++;for(;0<z-J;)F=ax(F),z--;for(;0<J-z;)Y=ax(Y),J--;for(;z--;){if(F===Y||Y!==null&&F===Y.alternate)break t;F=ax(F),Y=ax(Y)}F=null}else F=null;R!==null&&d4(D,M,R,F,!1),H!==null&&U!==null&&d4(D,U,H,F,!0)}}e:{if(M=E?kx(E):window,R=M.nodeName&&M.nodeName.toLowerCase(),R==="select"||R==="input"&&M.type==="file")var me=FJ;else if(n4(M))if(aU)me=UJ;else{me=zJ;var le=LJ}else(R=M.nodeName)&&R.toLowerCase()==="input"&&(M.type==="checkbox"||M.type==="radio")&&(me=BJ);if(me&&(me=me(e,E))){sU(D,me,r,I);break e}le&&le(e,M,E),e==="focusout"&&(le=M._wrapperState)&&le.controlled&&M.type==="number"&&ak(M,"number",M.value)}switch(le=E?kx(E):window,e){case"focusin":(n4(le)||le.contentEditable==="true")&&(Ix=le,xk=E,Aw=null);break;case"focusout":Aw=xk=Ix=null;break;case"mousedown":vk=!0;break;case"contextmenu":case"mouseup":case"dragend":vk=!1,l4(D,r,I);break;case"selectionchange":if(qJ)break;case"keydown":case"keyup":l4(D,r,I)}var ye;if(ED)e:{switch(e){case"compositionstart":var pe="onCompositionStart";break e;case"compositionend":pe="onCompositionEnd";break e;case"compositionupdate":pe="onCompositionUpdate";break e}pe=void 0}else jx?nU(e,r)&&(pe="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(pe="onCompositionStart");pe&&(rU&&r.locale!=="ko"&&(jx||pe!=="onCompositionStart"?pe==="onCompositionEnd"&&jx&&(ye=tU()):($p=I,bD="value"in $p?$p.value:$p.textContent,jx=!0)),le=wE(E,pe),0<le.length&&(pe=new QL(pe,e,null,r,I),D.push({event:pe,listeners:le}),ye?pe.data=ye:(ye=iU(r),ye!==null&&(pe.data=ye)))),(ye=PJ?DJ(e,r):RJ(e,r))&&(E=wE(E,"onBeforeInput"),0<E.length&&(I=new QL("onBeforeInput","beforeinput",null,r,I),D.push({event:I,listeners:E}),I.data=ye))}gU(D,t)})}function Qw(e,t,r){return{instance:e,listener:t,currentTarget:r}}function wE(e,t){for(var r=t+"Capture",s=[];e!==null;){var u=e,f=u.stateNode;u.tag===5&&f!==null&&(u=f,f=Ww(e,r),f!=null&&s.unshift(Qw(e,f,u)),f=Ww(e,t),f!=null&&s.push(Qw(e,f,u))),e=e.return}return s}function ax(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function d4(e,t,r,s,u){for(var f=t._reactName,m=[];r!==null&&r!==s;){var i=r,S=i.alternate,E=i.stateNode;if(S!==null&&S===s)break;i.tag===5&&E!==null&&(i=E,u?(S=Ww(r,f),S!=null&&m.unshift(Qw(r,S,i))):u||(S=Ww(r,f),S!=null&&m.push(Qw(r,S,i)))),r=r.return}m.length!==0&&e.push({event:t,listeners:m})}var ZJ=/\r\n?/g,XJ=/\u0000|\uFFFD/g;function h4(e){return(typeof e=="string"?e:""+e).replace(ZJ,`
`).replace(XJ,"")}function lT(e,t,r){if(t=h4(t),h4(e)!==t&&r)throw Error(rn(425))}function bE(){}var yk=null,wk=null;function bk(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Sk=typeof setTimeout=="function"?setTimeout:void 0,YJ=typeof clearTimeout=="function"?clearTimeout:void 0,f4=typeof Promise=="function"?Promise:void 0,KJ=typeof queueMicrotask=="function"?queueMicrotask:typeof f4<"u"?function(e){return f4.resolve(null).then(e).catch(JJ)}:Sk;function JJ(e){setTimeout(function(){throw e})}function KI(e,t){var r=t,s=0;do{var u=r.nextSibling;if(e.removeChild(r),u&&u.nodeType===8)if(r=u.data,r==="/$"){if(s===0){e.removeChild(u),Xw(t);return}s--}else r!=="$"&&r!=="$?"&&r!=="$!"||s++;r=u}while(r);Xw(t)}function Kp(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function p4(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var Ov=Math.random().toString(36).slice(2),nh="__reactFiber$"+Ov,eb="__reactProps$"+Ov,pf="__reactContainer$"+Ov,Tk="__reactEvents$"+Ov,QJ="__reactListeners$"+Ov,eQ="__reactHandles$"+Ov;function Vg(e){var t=e[nh];if(t)return t;for(var r=e.parentNode;r;){if(t=r[pf]||r[nh]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=p4(e);e!==null;){if(r=e[nh])return r;e=p4(e)}return t}e=r,r=e.parentNode}return null}function Mb(e){return e=e[nh]||e[pf],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function kx(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(rn(33))}function DC(e){return e[eb]||null}var Ek=[],Px=-1;function vm(e){return{current:e}}function za(e){0>Px||(e.current=Ek[Px],Ek[Px]=null,Px--)}function ka(e,t){Px++,Ek[Px]=e.current,e.current=t}var om={},Al=vm(om),Ec=vm(!1),l_=om;function gv(e,t){var r=e.type.contextTypes;if(!r)return om;var s=e.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===t)return s.__reactInternalMemoizedMaskedChildContext;var u={},f;for(f in r)u[f]=t[f];return s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=u),u}function Cc(e){return e=e.childContextTypes,e!=null}function SE(){za(Ec),za(Al)}function m4(e,t,r){if(Al.current!==om)throw Error(rn(168));ka(Al,t),ka(Ec,r)}function xU(e,t,r){var s=e.stateNode;if(t=t.childContextTypes,typeof s.getChildContext!="function")return r;s=s.getChildContext();for(var u in s)if(!(u in t))throw Error(rn(108,LK(e)||"Unknown",u));return to({},r,s)}function TE(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||om,l_=Al.current,ka(Al,e),ka(Ec,Ec.current),!0}function g4(e,t,r){var s=e.stateNode;if(!s)throw Error(rn(169));r?(e=xU(e,t,l_),s.__reactInternalMemoizedMergedChildContext=e,za(Ec),za(Al),ka(Al,e)):za(Ec),ka(Ec,r)}var Zh=null,RC=!1,JI=!1;function vU(e){Zh===null?Zh=[e]:Zh.push(e)}function tQ(e){RC=!0,vU(e)}function ym(){if(!JI&&Zh!==null){JI=!0;var e=0,t=va;try{var r=Zh;for(va=1;e<r.length;e++){var s=r[e];do s=s(!0);while(s!==null)}Zh=null,RC=!1}catch(u){throw Zh!==null&&(Zh=Zh.slice(e+1)),q6(xD,ym),u}finally{va=t,JI=!1}}return null}var Dx=[],Rx=0,EE=null,CE=0,vu=[],yu=0,c_=null,Jh=1,Qh="";function Dg(e,t){Dx[Rx++]=CE,Dx[Rx++]=EE,EE=e,CE=t}function yU(e,t,r){vu[yu++]=Jh,vu[yu++]=Qh,vu[yu++]=c_,c_=e;var s=Jh;e=Qh;var u=32-vd(s)-1;s&=~(1<<u),r+=1;var f=32-vd(t)+u;if(30<f){var m=u-u%5;f=(s&(1<<m)-1).toString(32),s>>=m,u-=m,Jh=1<<32-vd(t)+u|r<<u|s,Qh=f+e}else Jh=1<<f|r<<u|s,Qh=e}function AD(e){e.return!==null&&(Dg(e,1),yU(e,1,0))}function jD(e){for(;e===EE;)EE=Dx[--Rx],Dx[Rx]=null,CE=Dx[--Rx],Dx[Rx]=null;for(;e===c_;)c_=vu[--yu],vu[yu]=null,Qh=vu[--yu],vu[yu]=null,Jh=vu[--yu],vu[yu]=null}var Xc=null,Zc=null,Ga=!1,hd=null;function wU(e,t){var r=bu(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function _4(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Xc=e,Zc=Kp(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Xc=e,Zc=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=c_!==null?{id:Jh,overflow:Qh}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=bu(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,Xc=e,Zc=null,!0):!1;default:return!1}}function Ck(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Ak(e){if(Ga){var t=Zc;if(t){var r=t;if(!_4(e,t)){if(Ck(e))throw Error(rn(418));t=Kp(r.nextSibling);var s=Xc;t&&_4(e,t)?wU(s,r):(e.flags=e.flags&-4097|2,Ga=!1,Xc=e)}}else{if(Ck(e))throw Error(rn(418));e.flags=e.flags&-4097|2,Ga=!1,Xc=e}}}function x4(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Xc=e}function cT(e){if(e!==Xc)return!1;if(!Ga)return x4(e),Ga=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!bk(e.type,e.memoizedProps)),t&&(t=Zc)){if(Ck(e))throw bU(),Error(rn(418));for(;t;)wU(e,t),t=Kp(t.nextSibling)}if(x4(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(rn(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){Zc=Kp(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}Zc=null}}else Zc=Xc?Kp(e.stateNode.nextSibling):null;return!0}function bU(){for(var e=Zc;e;)e=Kp(e.nextSibling)}function _v(){Zc=Xc=null,Ga=!1}function ID(e){hd===null?hd=[e]:hd.push(e)}var rQ=wf.ReactCurrentBatchConfig;function nw(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(rn(309));var s=r.stateNode}if(!s)throw Error(rn(147,e));var u=s,f=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===f?t.ref:(t=function(m){var i=u.refs;m===null?delete i[f]:i[f]=m},t._stringRef=f,t)}if(typeof e!="string")throw Error(rn(284));if(!r._owner)throw Error(rn(290,e))}return e}function uT(e,t){throw e=Object.prototype.toString.call(t),Error(rn(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function v4(e){var t=e._init;return t(e._payload)}function SU(e){function t(Y,z){if(e){var J=Y.deletions;J===null?(Y.deletions=[z],Y.flags|=16):J.push(z)}}function r(Y,z){if(!e)return null;for(;z!==null;)t(Y,z),z=z.sibling;return null}function s(Y,z){for(Y=new Map;z!==null;)z.key!==null?Y.set(z.key,z):Y.set(z.index,z),z=z.sibling;return Y}function u(Y,z){return Y=tm(Y,z),Y.index=0,Y.sibling=null,Y}function f(Y,z,J){return Y.index=J,e?(J=Y.alternate,J!==null?(J=J.index,J<z?(Y.flags|=2,z):J):(Y.flags|=2,z)):(Y.flags|=1048576,z)}function m(Y){return e&&Y.alternate===null&&(Y.flags|=2),Y}function i(Y,z,J,ne){return z===null||z.tag!==6?(z=sN(J,Y.mode,ne),z.return=Y,z):(z=u(z,J),z.return=Y,z)}function S(Y,z,J,ne){var me=J.type;return me===Ax?I(Y,z,J.props.children,ne,J.key):z!==null&&(z.elementType===me||typeof me=="object"&&me!==null&&me.$$typeof===Ap&&v4(me)===z.type)?(ne=u(z,J.props),ne.ref=nw(Y,z,J),ne.return=Y,ne):(ne=tE(J.type,J.key,J.props,null,Y.mode,ne),ne.ref=nw(Y,z,J),ne.return=Y,ne)}function E(Y,z,J,ne){return z===null||z.tag!==4||z.stateNode.containerInfo!==J.containerInfo||z.stateNode.implementation!==J.implementation?(z=aN(J,Y.mode,ne),z.return=Y,z):(z=u(z,J.children||[]),z.return=Y,z)}function I(Y,z,J,ne,me){return z===null||z.tag!==7?(z=n_(J,Y.mode,ne,me),z.return=Y,z):(z=u(z,J),z.return=Y,z)}function D(Y,z,J){if(typeof z=="string"&&z!==""||typeof z=="number")return z=sN(""+z,Y.mode,J),z.return=Y,z;if(typeof z=="object"&&z!==null){switch(z.$$typeof){case QS:return J=tE(z.type,z.key,z.props,null,Y.mode,J),J.ref=nw(Y,null,z),J.return=Y,J;case Cx:return z=aN(z,Y.mode,J),z.return=Y,z;case Ap:var ne=z._init;return D(Y,ne(z._payload),J)}if(fw(z)||J1(z))return z=n_(z,Y.mode,J,null),z.return=Y,z;uT(Y,z)}return null}function M(Y,z,J,ne){var me=z!==null?z.key:null;if(typeof J=="string"&&J!==""||typeof J=="number")return me!==null?null:i(Y,z,""+J,ne);if(typeof J=="object"&&J!==null){switch(J.$$typeof){case QS:return J.key===me?S(Y,z,J,ne):null;case Cx:return J.key===me?E(Y,z,J,ne):null;case Ap:return me=J._init,M(Y,z,me(J._payload),ne)}if(fw(J)||J1(J))return me!==null?null:I(Y,z,J,ne,null);uT(Y,J)}return null}function R(Y,z,J,ne,me){if(typeof ne=="string"&&ne!==""||typeof ne=="number")return Y=Y.get(J)||null,i(z,Y,""+ne,me);if(typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case QS:return Y=Y.get(ne.key===null?J:ne.key)||null,S(z,Y,ne,me);case Cx:return Y=Y.get(ne.key===null?J:ne.key)||null,E(z,Y,ne,me);case Ap:var le=ne._init;return R(Y,z,J,le(ne._payload),me)}if(fw(ne)||J1(ne))return Y=Y.get(J)||null,I(z,Y,ne,me,null);uT(z,ne)}return null}function H(Y,z,J,ne){for(var me=null,le=null,ye=z,pe=z=0,be=null;ye!==null&&pe<J.length;pe++){ye.index>pe?(be=ye,ye=null):be=ye.sibling;var ke=M(Y,ye,J[pe],ne);if(ke===null){ye===null&&(ye=be);break}e&&ye&&ke.alternate===null&&t(Y,ye),z=f(ke,z,pe),le===null?me=ke:le.sibling=ke,le=ke,ye=be}if(pe===J.length)return r(Y,ye),Ga&&Dg(Y,pe),me;if(ye===null){for(;pe<J.length;pe++)ye=D(Y,J[pe],ne),ye!==null&&(z=f(ye,z,pe),le===null?me=ye:le.sibling=ye,le=ye);return Ga&&Dg(Y,pe),me}for(ye=s(Y,ye);pe<J.length;pe++)be=R(ye,Y,pe,J[pe],ne),be!==null&&(e&&be.alternate!==null&&ye.delete(be.key===null?pe:be.key),z=f(be,z,pe),le===null?me=be:le.sibling=be,le=be);return e&&ye.forEach(function(Oe){return t(Y,Oe)}),Ga&&Dg(Y,pe),me}function F(Y,z,J,ne){var me=J1(J);if(typeof me!="function")throw Error(rn(150));if(J=me.call(J),J==null)throw Error(rn(151));for(var le=me=null,ye=z,pe=z=0,be=null,ke=J.next();ye!==null&&!ke.done;pe++,ke=J.next()){ye.index>pe?(be=ye,ye=null):be=ye.sibling;var Oe=M(Y,ye,ke.value,ne);if(Oe===null){ye===null&&(ye=be);break}e&&ye&&Oe.alternate===null&&t(Y,ye),z=f(Oe,z,pe),le===null?me=Oe:le.sibling=Oe,le=Oe,ye=be}if(ke.done)return r(Y,ye),Ga&&Dg(Y,pe),me;if(ye===null){for(;!ke.done;pe++,ke=J.next())ke=D(Y,ke.value,ne),ke!==null&&(z=f(ke,z,pe),le===null?me=ke:le.sibling=ke,le=ke);return Ga&&Dg(Y,pe),me}for(ye=s(Y,ye);!ke.done;pe++,ke=J.next())ke=R(ye,Y,pe,ke.value,ne),ke!==null&&(e&&ke.alternate!==null&&ye.delete(ke.key===null?pe:ke.key),z=f(ke,z,pe),le===null?me=ke:le.sibling=ke,le=ke);return e&&ye.forEach(function(Ee){return t(Y,Ee)}),Ga&&Dg(Y,pe),me}function U(Y,z,J,ne){if(typeof J=="object"&&J!==null&&J.type===Ax&&J.key===null&&(J=J.props.children),typeof J=="object"&&J!==null){switch(J.$$typeof){case QS:e:{for(var me=J.key,le=z;le!==null;){if(le.key===me){if(me=J.type,me===Ax){if(le.tag===7){r(Y,le.sibling),z=u(le,J.props.children),z.return=Y,Y=z;break e}}else if(le.elementType===me||typeof me=="object"&&me!==null&&me.$$typeof===Ap&&v4(me)===le.type){r(Y,le.sibling),z=u(le,J.props),z.ref=nw(Y,le,J),z.return=Y,Y=z;break e}r(Y,le);break}else t(Y,le);le=le.sibling}J.type===Ax?(z=n_(J.props.children,Y.mode,ne,J.key),z.return=Y,Y=z):(ne=tE(J.type,J.key,J.props,null,Y.mode,ne),ne.ref=nw(Y,z,J),ne.return=Y,Y=ne)}return m(Y);case Cx:e:{for(le=J.key;z!==null;){if(z.key===le)if(z.tag===4&&z.stateNode.containerInfo===J.containerInfo&&z.stateNode.implementation===J.implementation){r(Y,z.sibling),z=u(z,J.children||[]),z.return=Y,Y=z;break e}else{r(Y,z);break}else t(Y,z);z=z.sibling}z=aN(J,Y.mode,ne),z.return=Y,Y=z}return m(Y);case Ap:return le=J._init,U(Y,z,le(J._payload),ne)}if(fw(J))return H(Y,z,J,ne);if(J1(J))return F(Y,z,J,ne);uT(Y,J)}return typeof J=="string"&&J!==""||typeof J=="number"?(J=""+J,z!==null&&z.tag===6?(r(Y,z.sibling),z=u(z,J),z.return=Y,Y=z):(r(Y,z),z=sN(J,Y.mode,ne),z.return=Y,Y=z),m(Y)):r(Y,z)}return U}var xv=SU(!0),TU=SU(!1),AE=vm(null),jE=null,Mx=null,ND=null;function kD(){ND=Mx=jE=null}function PD(e){var t=AE.current;za(AE),e._currentValue=t}function jk(e,t,r){for(;e!==null;){var s=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,s!==null&&(s.childLanes|=t)):s!==null&&(s.childLanes&t)!==t&&(s.childLanes|=t),e===r)break;e=e.return}}function qx(e,t){jE=e,ND=Mx=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(bc=!0),e.firstContext=null)}function Tu(e){var t=e._currentValue;if(ND!==e)if(e={context:e,memoizedValue:t,next:null},Mx===null){if(jE===null)throw Error(rn(308));Mx=e,jE.dependencies={lanes:0,firstContext:e}}else Mx=Mx.next=e;return t}var $g=null;function DD(e){$g===null?$g=[e]:$g.push(e)}function EU(e,t,r,s){var u=t.interleaved;return u===null?(r.next=r,DD(t)):(r.next=u.next,u.next=r),t.interleaved=r,mf(e,s)}function mf(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var jp=!1;function RD(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function CU(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function af(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Jp(e,t,r){var s=e.updateQueue;if(s===null)return null;if(s=s.shared,Ys&2){var u=s.pending;return u===null?t.next=t:(t.next=u.next,u.next=t),s.pending=t,mf(e,r)}return u=s.interleaved,u===null?(t.next=t,DD(s)):(t.next=u.next,u.next=t),s.interleaved=t,mf(e,r)}function XT(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var s=t.lanes;s&=e.pendingLanes,r|=s,t.lanes=r,vD(e,r)}}function y4(e,t){var r=e.updateQueue,s=e.alternate;if(s!==null&&(s=s.updateQueue,r===s)){var u=null,f=null;if(r=r.firstBaseUpdate,r!==null){do{var m={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};f===null?u=f=m:f=f.next=m,r=r.next}while(r!==null);f===null?u=f=t:f=f.next=t}else u=f=t;r={baseState:s.baseState,firstBaseUpdate:u,lastBaseUpdate:f,shared:s.shared,effects:s.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function IE(e,t,r,s){var u=e.updateQueue;jp=!1;var f=u.firstBaseUpdate,m=u.lastBaseUpdate,i=u.shared.pending;if(i!==null){u.shared.pending=null;var S=i,E=S.next;S.next=null,m===null?f=E:m.next=E,m=S;var I=e.alternate;I!==null&&(I=I.updateQueue,i=I.lastBaseUpdate,i!==m&&(i===null?I.firstBaseUpdate=E:i.next=E,I.lastBaseUpdate=S))}if(f!==null){var D=u.baseState;m=0,I=E=S=null,i=f;do{var M=i.lane,R=i.eventTime;if((s&M)===M){I!==null&&(I=I.next={eventTime:R,lane:0,tag:i.tag,payload:i.payload,callback:i.callback,next:null});e:{var H=e,F=i;switch(M=t,R=r,F.tag){case 1:if(H=F.payload,typeof H=="function"){D=H.call(R,D,M);break e}D=H;break e;case 3:H.flags=H.flags&-65537|128;case 0:if(H=F.payload,M=typeof H=="function"?H.call(R,D,M):H,M==null)break e;D=to({},D,M);break e;case 2:jp=!0}}i.callback!==null&&i.lane!==0&&(e.flags|=64,M=u.effects,M===null?u.effects=[i]:M.push(i))}else R={eventTime:R,lane:M,tag:i.tag,payload:i.payload,callback:i.callback,next:null},I===null?(E=I=R,S=D):I=I.next=R,m|=M;if(i=i.next,i===null){if(i=u.shared.pending,i===null)break;M=i,i=M.next,M.next=null,u.lastBaseUpdate=M,u.shared.pending=null}}while(!0);if(I===null&&(S=D),u.baseState=S,u.firstBaseUpdate=E,u.lastBaseUpdate=I,t=u.shared.interleaved,t!==null){u=t;do m|=u.lane,u=u.next;while(u!==t)}else f===null&&(u.shared.lanes=0);d_|=m,e.lanes=m,e.memoizedState=D}}function w4(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var s=e[t],u=s.callback;if(u!==null){if(s.callback=null,s=r,typeof u!="function")throw Error(rn(191,u));u.call(s)}}}var Ob={},dh=vm(Ob),tb=vm(Ob),rb=vm(Ob);function qg(e){if(e===Ob)throw Error(rn(174));return e}function MD(e,t){switch(ka(rb,t),ka(tb,e),ka(dh,Ob),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:lk(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=lk(t,e)}za(dh),ka(dh,t)}function vv(){za(dh),za(tb),za(rb)}function AU(e){qg(rb.current);var t=qg(dh.current),r=lk(t,e.type);t!==r&&(ka(tb,e),ka(dh,r))}function OD(e){tb.current===e&&(za(dh),za(tb))}var Ja=vm(0);function NE(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var QI=[];function FD(){for(var e=0;e<QI.length;e++)QI[e]._workInProgressVersionPrimary=null;QI.length=0}var YT=wf.ReactCurrentDispatcher,eN=wf.ReactCurrentBatchConfig,u_=0,Qa=null,Oo=null,Wo=null,kE=!1,jw=!1,nb=0,nQ=0;function yl(){throw Error(rn(321))}function LD(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!bd(e[r],t[r]))return!1;return!0}function zD(e,t,r,s,u,f){if(u_=f,Qa=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,YT.current=e===null||e.memoizedState===null?oQ:lQ,e=r(s,u),jw){f=0;do{if(jw=!1,nb=0,25<=f)throw Error(rn(301));f+=1,Wo=Oo=null,t.updateQueue=null,YT.current=cQ,e=r(s,u)}while(jw)}if(YT.current=PE,t=Oo!==null&&Oo.next!==null,u_=0,Wo=Oo=Qa=null,kE=!1,t)throw Error(rn(300));return e}function BD(){var e=nb!==0;return nb=0,e}function Qd(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Wo===null?Qa.memoizedState=Wo=e:Wo=Wo.next=e,Wo}function Eu(){if(Oo===null){var e=Qa.alternate;e=e!==null?e.memoizedState:null}else e=Oo.next;var t=Wo===null?Qa.memoizedState:Wo.next;if(t!==null)Wo=t,Oo=e;else{if(e===null)throw Error(rn(310));Oo=e,e={memoizedState:Oo.memoizedState,baseState:Oo.baseState,baseQueue:Oo.baseQueue,queue:Oo.queue,next:null},Wo===null?Qa.memoizedState=Wo=e:Wo=Wo.next=e}return Wo}function ib(e,t){return typeof t=="function"?t(e):t}function tN(e){var t=Eu(),r=t.queue;if(r===null)throw Error(rn(311));r.lastRenderedReducer=e;var s=Oo,u=s.baseQueue,f=r.pending;if(f!==null){if(u!==null){var m=u.next;u.next=f.next,f.next=m}s.baseQueue=u=f,r.pending=null}if(u!==null){f=u.next,s=s.baseState;var i=m=null,S=null,E=f;do{var I=E.lane;if((u_&I)===I)S!==null&&(S=S.next={lane:0,action:E.action,hasEagerState:E.hasEagerState,eagerState:E.eagerState,next:null}),s=E.hasEagerState?E.eagerState:e(s,E.action);else{var D={lane:I,action:E.action,hasEagerState:E.hasEagerState,eagerState:E.eagerState,next:null};S===null?(i=S=D,m=s):S=S.next=D,Qa.lanes|=I,d_|=I}E=E.next}while(E!==null&&E!==f);S===null?m=s:S.next=i,bd(s,t.memoizedState)||(bc=!0),t.memoizedState=s,t.baseState=m,t.baseQueue=S,r.lastRenderedState=s}if(e=r.interleaved,e!==null){u=e;do f=u.lane,Qa.lanes|=f,d_|=f,u=u.next;while(u!==e)}else u===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function rN(e){var t=Eu(),r=t.queue;if(r===null)throw Error(rn(311));r.lastRenderedReducer=e;var s=r.dispatch,u=r.pending,f=t.memoizedState;if(u!==null){r.pending=null;var m=u=u.next;do f=e(f,m.action),m=m.next;while(m!==u);bd(f,t.memoizedState)||(bc=!0),t.memoizedState=f,t.baseQueue===null&&(t.baseState=f),r.lastRenderedState=f}return[f,s]}function jU(){}function IU(e,t){var r=Qa,s=Eu(),u=t(),f=!bd(s.memoizedState,u);if(f&&(s.memoizedState=u,bc=!0),s=s.queue,UD(PU.bind(null,r,s,e),[e]),s.getSnapshot!==t||f||Wo!==null&&Wo.memoizedState.tag&1){if(r.flags|=2048,sb(9,kU.bind(null,r,s,u,t),void 0,null),Yo===null)throw Error(rn(349));u_&30||NU(r,t,u)}return u}function NU(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=Qa.updateQueue,t===null?(t={lastEffect:null,stores:null},Qa.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function kU(e,t,r,s){t.value=r,t.getSnapshot=s,DU(t)&&RU(e)}function PU(e,t,r){return r(function(){DU(t)&&RU(e)})}function DU(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!bd(e,r)}catch{return!0}}function RU(e){var t=mf(e,1);t!==null&&yd(t,e,1,-1)}function b4(e){var t=Qd();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ib,lastRenderedState:e},t.queue=e,e=e.dispatch=aQ.bind(null,Qa,e),[t.memoizedState,e]}function sb(e,t,r,s){return e={tag:e,create:t,destroy:r,deps:s,next:null},t=Qa.updateQueue,t===null?(t={lastEffect:null,stores:null},Qa.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(s=r.next,r.next=e,e.next=s,t.lastEffect=e)),e}function MU(){return Eu().memoizedState}function KT(e,t,r,s){var u=Qd();Qa.flags|=e,u.memoizedState=sb(1|t,r,void 0,s===void 0?null:s)}function MC(e,t,r,s){var u=Eu();s=s===void 0?null:s;var f=void 0;if(Oo!==null){var m=Oo.memoizedState;if(f=m.destroy,s!==null&&LD(s,m.deps)){u.memoizedState=sb(t,r,f,s);return}}Qa.flags|=e,u.memoizedState=sb(1|t,r,f,s)}function S4(e,t){return KT(8390656,8,e,t)}function UD(e,t){return MC(2048,8,e,t)}function OU(e,t){return MC(4,2,e,t)}function FU(e,t){return MC(4,4,e,t)}function LU(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function zU(e,t,r){return r=r!=null?r.concat([e]):null,MC(4,4,LU.bind(null,t,e),r)}function VD(){}function BU(e,t){var r=Eu();t=t===void 0?null:t;var s=r.memoizedState;return s!==null&&t!==null&&LD(t,s[1])?s[0]:(r.memoizedState=[e,t],e)}function UU(e,t){var r=Eu();t=t===void 0?null:t;var s=r.memoizedState;return s!==null&&t!==null&&LD(t,s[1])?s[0]:(e=e(),r.memoizedState=[e,t],e)}function VU(e,t,r){return u_&21?(bd(r,t)||(r=H6(),Qa.lanes|=r,d_|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,bc=!0),e.memoizedState=r)}function iQ(e,t){var r=va;va=r!==0&&4>r?r:4,e(!0);var s=eN.transition;eN.transition={};try{e(!1),t()}finally{va=r,eN.transition=s}}function $U(){return Eu().memoizedState}function sQ(e,t,r){var s=em(e);if(r={lane:s,action:r,hasEagerState:!1,eagerState:null,next:null},qU(e))GU(t,r);else if(r=EU(e,t,r,s),r!==null){var u=Jl();yd(r,e,s,u),WU(r,t,s)}}function aQ(e,t,r){var s=em(e),u={lane:s,action:r,hasEagerState:!1,eagerState:null,next:null};if(qU(e))GU(t,u);else{var f=e.alternate;if(e.lanes===0&&(f===null||f.lanes===0)&&(f=t.lastRenderedReducer,f!==null))try{var m=t.lastRenderedState,i=f(m,r);if(u.hasEagerState=!0,u.eagerState=i,bd(i,m)){var S=t.interleaved;S===null?(u.next=u,DD(t)):(u.next=S.next,S.next=u),t.interleaved=u;return}}catch{}finally{}r=EU(e,t,u,s),r!==null&&(u=Jl(),yd(r,e,s,u),WU(r,t,s))}}function qU(e){var t=e.alternate;return e===Qa||t!==null&&t===Qa}function GU(e,t){jw=kE=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function WU(e,t,r){if(r&4194240){var s=t.lanes;s&=e.pendingLanes,r|=s,t.lanes=r,vD(e,r)}}var PE={readContext:Tu,useCallback:yl,useContext:yl,useEffect:yl,useImperativeHandle:yl,useInsertionEffect:yl,useLayoutEffect:yl,useMemo:yl,useReducer:yl,useRef:yl,useState:yl,useDebugValue:yl,useDeferredValue:yl,useTransition:yl,useMutableSource:yl,useSyncExternalStore:yl,useId:yl,unstable_isNewReconciler:!1},oQ={readContext:Tu,useCallback:function(e,t){return Qd().memoizedState=[e,t===void 0?null:t],e},useContext:Tu,useEffect:S4,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,KT(4194308,4,LU.bind(null,t,e),r)},useLayoutEffect:function(e,t){return KT(4194308,4,e,t)},useInsertionEffect:function(e,t){return KT(4,2,e,t)},useMemo:function(e,t){var r=Qd();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var s=Qd();return t=r!==void 0?r(t):t,s.memoizedState=s.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},s.queue=e,e=e.dispatch=sQ.bind(null,Qa,e),[s.memoizedState,e]},useRef:function(e){var t=Qd();return e={current:e},t.memoizedState=e},useState:b4,useDebugValue:VD,useDeferredValue:function(e){return Qd().memoizedState=e},useTransition:function(){var e=b4(!1),t=e[0];return e=iQ.bind(null,e[1]),Qd().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var s=Qa,u=Qd();if(Ga){if(r===void 0)throw Error(rn(407));r=r()}else{if(r=t(),Yo===null)throw Error(rn(349));u_&30||NU(s,t,r)}u.memoizedState=r;var f={value:r,getSnapshot:t};return u.queue=f,S4(PU.bind(null,s,f,e),[e]),s.flags|=2048,sb(9,kU.bind(null,s,f,r,t),void 0,null),r},useId:function(){var e=Qd(),t=Yo.identifierPrefix;if(Ga){var r=Qh,s=Jh;r=(s&~(1<<32-vd(s)-1)).toString(32)+r,t=":"+t+"R"+r,r=nb++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=nQ++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},lQ={readContext:Tu,useCallback:BU,useContext:Tu,useEffect:UD,useImperativeHandle:zU,useInsertionEffect:OU,useLayoutEffect:FU,useMemo:UU,useReducer:tN,useRef:MU,useState:function(){return tN(ib)},useDebugValue:VD,useDeferredValue:function(e){var t=Eu();return VU(t,Oo.memoizedState,e)},useTransition:function(){var e=tN(ib)[0],t=Eu().memoizedState;return[e,t]},useMutableSource:jU,useSyncExternalStore:IU,useId:$U,unstable_isNewReconciler:!1},cQ={readContext:Tu,useCallback:BU,useContext:Tu,useEffect:UD,useImperativeHandle:zU,useInsertionEffect:OU,useLayoutEffect:FU,useMemo:UU,useReducer:rN,useRef:MU,useState:function(){return rN(ib)},useDebugValue:VD,useDeferredValue:function(e){var t=Eu();return Oo===null?t.memoizedState=e:VU(t,Oo.memoizedState,e)},useTransition:function(){var e=rN(ib)[0],t=Eu().memoizedState;return[e,t]},useMutableSource:jU,useSyncExternalStore:IU,useId:$U,unstable_isNewReconciler:!1};function ad(e,t){if(e&&e.defaultProps){t=to({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function Ik(e,t,r,s){t=e.memoizedState,r=r(s,t),r=r==null?t:to({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var OC={isMounted:function(e){return(e=e._reactInternals)?j_(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var s=Jl(),u=em(e),f=af(s,u);f.payload=t,r!=null&&(f.callback=r),t=Jp(e,f,u),t!==null&&(yd(t,e,u,s),XT(t,e,u))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var s=Jl(),u=em(e),f=af(s,u);f.tag=1,f.payload=t,r!=null&&(f.callback=r),t=Jp(e,f,u),t!==null&&(yd(t,e,u,s),XT(t,e,u))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=Jl(),s=em(e),u=af(r,s);u.tag=2,t!=null&&(u.callback=t),t=Jp(e,u,s),t!==null&&(yd(t,e,s,r),XT(t,e,s))}};function T4(e,t,r,s,u,f,m){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(s,f,m):t.prototype&&t.prototype.isPureReactComponent?!Kw(r,s)||!Kw(u,f):!0}function HU(e,t,r){var s=!1,u=om,f=t.contextType;return typeof f=="object"&&f!==null?f=Tu(f):(u=Cc(t)?l_:Al.current,s=t.contextTypes,f=(s=s!=null)?gv(e,u):om),t=new t(r,f),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=OC,e.stateNode=t,t._reactInternals=e,s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=u,e.__reactInternalMemoizedMaskedChildContext=f),t}function E4(e,t,r,s){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,s),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,s),t.state!==e&&OC.enqueueReplaceState(t,t.state,null)}function Nk(e,t,r,s){var u=e.stateNode;u.props=r,u.state=e.memoizedState,u.refs={},RD(e);var f=t.contextType;typeof f=="object"&&f!==null?u.context=Tu(f):(f=Cc(t)?l_:Al.current,u.context=gv(e,f)),u.state=e.memoizedState,f=t.getDerivedStateFromProps,typeof f=="function"&&(Ik(e,t,f,r),u.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof u.getSnapshotBeforeUpdate=="function"||typeof u.UNSAFE_componentWillMount!="function"&&typeof u.componentWillMount!="function"||(t=u.state,typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount(),t!==u.state&&OC.enqueueReplaceState(u,u.state,null),IE(e,r,u,s),u.state=e.memoizedState),typeof u.componentDidMount=="function"&&(e.flags|=4194308)}function yv(e,t){try{var r="",s=t;do r+=FK(s),s=s.return;while(s);var u=r}catch(f){u=`
Error generating stack: `+f.message+`
`+f.stack}return{value:e,source:t,stack:u,digest:null}}function nN(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function kk(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var uQ=typeof WeakMap=="function"?WeakMap:Map;function ZU(e,t,r){r=af(-1,r),r.tag=3,r.payload={element:null};var s=t.value;return r.callback=function(){RE||(RE=!0,Uk=s),kk(e,t)},r}function XU(e,t,r){r=af(-1,r),r.tag=3;var s=e.type.getDerivedStateFromError;if(typeof s=="function"){var u=t.value;r.payload=function(){return s(u)},r.callback=function(){kk(e,t)}}var f=e.stateNode;return f!==null&&typeof f.componentDidCatch=="function"&&(r.callback=function(){kk(e,t),typeof s!="function"&&(Qp===null?Qp=new Set([this]):Qp.add(this));var m=t.stack;this.componentDidCatch(t.value,{componentStack:m!==null?m:""})}),r}function C4(e,t,r){var s=e.pingCache;if(s===null){s=e.pingCache=new uQ;var u=new Set;s.set(t,u)}else u=s.get(t),u===void 0&&(u=new Set,s.set(t,u));u.has(r)||(u.add(r),e=TQ.bind(null,e,t,r),t.then(e,e))}function A4(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function j4(e,t,r,s,u){return e.mode&1?(e.flags|=65536,e.lanes=u,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=af(-1,1),t.tag=2,Jp(r,t,1))),r.lanes|=1),e)}var dQ=wf.ReactCurrentOwner,bc=!1;function Gl(e,t,r,s){t.child=e===null?TU(t,null,r,s):xv(t,e.child,r,s)}function I4(e,t,r,s,u){r=r.render;var f=t.ref;return qx(t,u),s=zD(e,t,r,s,f,u),r=BD(),e!==null&&!bc?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~u,gf(e,t,u)):(Ga&&r&&AD(t),t.flags|=1,Gl(e,t,s,u),t.child)}function N4(e,t,r,s,u){if(e===null){var f=r.type;return typeof f=="function"&&!YD(f)&&f.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=f,YU(e,t,f,s,u)):(e=tE(r.type,null,s,t,t.mode,u),e.ref=t.ref,e.return=t,t.child=e)}if(f=e.child,!(e.lanes&u)){var m=f.memoizedProps;if(r=r.compare,r=r!==null?r:Kw,r(m,s)&&e.ref===t.ref)return gf(e,t,u)}return t.flags|=1,e=tm(f,s),e.ref=t.ref,e.return=t,t.child=e}function YU(e,t,r,s,u){if(e!==null){var f=e.memoizedProps;if(Kw(f,s)&&e.ref===t.ref)if(bc=!1,t.pendingProps=s=f,(e.lanes&u)!==0)e.flags&131072&&(bc=!0);else return t.lanes=e.lanes,gf(e,t,u)}return Pk(e,t,r,s,u)}function KU(e,t,r){var s=t.pendingProps,u=s.children,f=e!==null?e.memoizedState:null;if(s.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},ka(Fx,Bc),Bc|=r;else{if(!(r&1073741824))return e=f!==null?f.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,ka(Fx,Bc),Bc|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=f!==null?f.baseLanes:r,ka(Fx,Bc),Bc|=s}else f!==null?(s=f.baseLanes|r,t.memoizedState=null):s=r,ka(Fx,Bc),Bc|=s;return Gl(e,t,u,r),t.child}function JU(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function Pk(e,t,r,s,u){var f=Cc(r)?l_:Al.current;return f=gv(t,f),qx(t,u),r=zD(e,t,r,s,f,u),s=BD(),e!==null&&!bc?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~u,gf(e,t,u)):(Ga&&s&&AD(t),t.flags|=1,Gl(e,t,r,u),t.child)}function k4(e,t,r,s,u){if(Cc(r)){var f=!0;TE(t)}else f=!1;if(qx(t,u),t.stateNode===null)JT(e,t),HU(t,r,s),Nk(t,r,s,u),s=!0;else if(e===null){var m=t.stateNode,i=t.memoizedProps;m.props=i;var S=m.context,E=r.contextType;typeof E=="object"&&E!==null?E=Tu(E):(E=Cc(r)?l_:Al.current,E=gv(t,E));var I=r.getDerivedStateFromProps,D=typeof I=="function"||typeof m.getSnapshotBeforeUpdate=="function";D||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(i!==s||S!==E)&&E4(t,m,s,E),jp=!1;var M=t.memoizedState;m.state=M,IE(t,s,m,u),S=t.memoizedState,i!==s||M!==S||Ec.current||jp?(typeof I=="function"&&(Ik(t,r,I,s),S=t.memoizedState),(i=jp||T4(t,r,i,s,M,S,E))?(D||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount()),typeof m.componentDidMount=="function"&&(t.flags|=4194308)):(typeof m.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=s,t.memoizedState=S),m.props=s,m.state=S,m.context=E,s=i):(typeof m.componentDidMount=="function"&&(t.flags|=4194308),s=!1)}else{m=t.stateNode,CU(e,t),i=t.memoizedProps,E=t.type===t.elementType?i:ad(t.type,i),m.props=E,D=t.pendingProps,M=m.context,S=r.contextType,typeof S=="object"&&S!==null?S=Tu(S):(S=Cc(r)?l_:Al.current,S=gv(t,S));var R=r.getDerivedStateFromProps;(I=typeof R=="function"||typeof m.getSnapshotBeforeUpdate=="function")||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(i!==D||M!==S)&&E4(t,m,s,S),jp=!1,M=t.memoizedState,m.state=M,IE(t,s,m,u);var H=t.memoizedState;i!==D||M!==H||Ec.current||jp?(typeof R=="function"&&(Ik(t,r,R,s),H=t.memoizedState),(E=jp||T4(t,r,E,s,M,H,S)||!1)?(I||typeof m.UNSAFE_componentWillUpdate!="function"&&typeof m.componentWillUpdate!="function"||(typeof m.componentWillUpdate=="function"&&m.componentWillUpdate(s,H,S),typeof m.UNSAFE_componentWillUpdate=="function"&&m.UNSAFE_componentWillUpdate(s,H,S)),typeof m.componentDidUpdate=="function"&&(t.flags|=4),typeof m.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof m.componentDidUpdate!="function"||i===e.memoizedProps&&M===e.memoizedState||(t.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||i===e.memoizedProps&&M===e.memoizedState||(t.flags|=1024),t.memoizedProps=s,t.memoizedState=H),m.props=s,m.state=H,m.context=S,s=E):(typeof m.componentDidUpdate!="function"||i===e.memoizedProps&&M===e.memoizedState||(t.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||i===e.memoizedProps&&M===e.memoizedState||(t.flags|=1024),s=!1)}return Dk(e,t,r,s,f,u)}function Dk(e,t,r,s,u,f){JU(e,t);var m=(t.flags&128)!==0;if(!s&&!m)return u&&g4(t,r,!1),gf(e,t,f);s=t.stateNode,dQ.current=t;var i=m&&typeof r.getDerivedStateFromError!="function"?null:s.render();return t.flags|=1,e!==null&&m?(t.child=xv(t,e.child,null,f),t.child=xv(t,null,i,f)):Gl(e,t,i,f),t.memoizedState=s.state,u&&g4(t,r,!0),t.child}function QU(e){var t=e.stateNode;t.pendingContext?m4(e,t.pendingContext,t.pendingContext!==t.context):t.context&&m4(e,t.context,!1),MD(e,t.containerInfo)}function P4(e,t,r,s,u){return _v(),ID(u),t.flags|=256,Gl(e,t,r,s),t.child}var Rk={dehydrated:null,treeContext:null,retryLane:0};function Mk(e){return{baseLanes:e,cachePool:null,transitions:null}}function eV(e,t,r){var s=t.pendingProps,u=Ja.current,f=!1,m=(t.flags&128)!==0,i;if((i=m)||(i=e!==null&&e.memoizedState===null?!1:(u&2)!==0),i?(f=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(u|=1),ka(Ja,u&1),e===null)return Ak(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(m=s.children,e=s.fallback,f?(s=t.mode,f=t.child,m={mode:"hidden",children:m},!(s&1)&&f!==null?(f.childLanes=0,f.pendingProps=m):f=zC(m,s,0,null),e=n_(e,s,r,null),f.return=t,e.return=t,f.sibling=e,t.child=f,t.child.memoizedState=Mk(r),t.memoizedState=Rk,e):$D(t,m));if(u=e.memoizedState,u!==null&&(i=u.dehydrated,i!==null))return hQ(e,t,m,s,i,u,r);if(f){f=s.fallback,m=t.mode,u=e.child,i=u.sibling;var S={mode:"hidden",children:s.children};return!(m&1)&&t.child!==u?(s=t.child,s.childLanes=0,s.pendingProps=S,t.deletions=null):(s=tm(u,S),s.subtreeFlags=u.subtreeFlags&14680064),i!==null?f=tm(i,f):(f=n_(f,m,r,null),f.flags|=2),f.return=t,s.return=t,s.sibling=f,t.child=s,s=f,f=t.child,m=e.child.memoizedState,m=m===null?Mk(r):{baseLanes:m.baseLanes|r,cachePool:null,transitions:m.transitions},f.memoizedState=m,f.childLanes=e.childLanes&~r,t.memoizedState=Rk,s}return f=e.child,e=f.sibling,s=tm(f,{mode:"visible",children:s.children}),!(t.mode&1)&&(s.lanes=r),s.return=t,s.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=s,t.memoizedState=null,s}function $D(e,t){return t=zC({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function dT(e,t,r,s){return s!==null&&ID(s),xv(t,e.child,null,r),e=$D(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function hQ(e,t,r,s,u,f,m){if(r)return t.flags&256?(t.flags&=-257,s=nN(Error(rn(422))),dT(e,t,m,s)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(f=s.fallback,u=t.mode,s=zC({mode:"visible",children:s.children},u,0,null),f=n_(f,u,m,null),f.flags|=2,s.return=t,f.return=t,s.sibling=f,t.child=s,t.mode&1&&xv(t,e.child,null,m),t.child.memoizedState=Mk(m),t.memoizedState=Rk,f);if(!(t.mode&1))return dT(e,t,m,null);if(u.data==="$!"){if(s=u.nextSibling&&u.nextSibling.dataset,s)var i=s.dgst;return s=i,f=Error(rn(419)),s=nN(f,s,void 0),dT(e,t,m,s)}if(i=(m&e.childLanes)!==0,bc||i){if(s=Yo,s!==null){switch(m&-m){case 4:u=2;break;case 16:u=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:u=32;break;case 536870912:u=268435456;break;default:u=0}u=u&(s.suspendedLanes|m)?0:u,u!==0&&u!==f.retryLane&&(f.retryLane=u,mf(e,u),yd(s,e,u,-1))}return XD(),s=nN(Error(rn(421))),dT(e,t,m,s)}return u.data==="$?"?(t.flags|=128,t.child=e.child,t=EQ.bind(null,e),u._reactRetry=t,null):(e=f.treeContext,Zc=Kp(u.nextSibling),Xc=t,Ga=!0,hd=null,e!==null&&(vu[yu++]=Jh,vu[yu++]=Qh,vu[yu++]=c_,Jh=e.id,Qh=e.overflow,c_=t),t=$D(t,s.children),t.flags|=4096,t)}function D4(e,t,r){e.lanes|=t;var s=e.alternate;s!==null&&(s.lanes|=t),jk(e.return,t,r)}function iN(e,t,r,s,u){var f=e.memoizedState;f===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:s,tail:r,tailMode:u}:(f.isBackwards=t,f.rendering=null,f.renderingStartTime=0,f.last=s,f.tail=r,f.tailMode=u)}function tV(e,t,r){var s=t.pendingProps,u=s.revealOrder,f=s.tail;if(Gl(e,t,s.children,r),s=Ja.current,s&2)s=s&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&D4(e,r,t);else if(e.tag===19)D4(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}s&=1}if(ka(Ja,s),!(t.mode&1))t.memoizedState=null;else switch(u){case"forwards":for(r=t.child,u=null;r!==null;)e=r.alternate,e!==null&&NE(e)===null&&(u=r),r=r.sibling;r=u,r===null?(u=t.child,t.child=null):(u=r.sibling,r.sibling=null),iN(t,!1,u,r,f);break;case"backwards":for(r=null,u=t.child,t.child=null;u!==null;){if(e=u.alternate,e!==null&&NE(e)===null){t.child=u;break}e=u.sibling,u.sibling=r,r=u,u=e}iN(t,!0,r,null,f);break;case"together":iN(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function JT(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function gf(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),d_|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(rn(153));if(t.child!==null){for(e=t.child,r=tm(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=tm(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function fQ(e,t,r){switch(t.tag){case 3:QU(t),_v();break;case 5:AU(t);break;case 1:Cc(t.type)&&TE(t);break;case 4:MD(t,t.stateNode.containerInfo);break;case 10:var s=t.type._context,u=t.memoizedProps.value;ka(AE,s._currentValue),s._currentValue=u;break;case 13:if(s=t.memoizedState,s!==null)return s.dehydrated!==null?(ka(Ja,Ja.current&1),t.flags|=128,null):r&t.child.childLanes?eV(e,t,r):(ka(Ja,Ja.current&1),e=gf(e,t,r),e!==null?e.sibling:null);ka(Ja,Ja.current&1);break;case 19:if(s=(r&t.childLanes)!==0,e.flags&128){if(s)return tV(e,t,r);t.flags|=128}if(u=t.memoizedState,u!==null&&(u.rendering=null,u.tail=null,u.lastEffect=null),ka(Ja,Ja.current),s)break;return null;case 22:case 23:return t.lanes=0,KU(e,t,r)}return gf(e,t,r)}var rV,Ok,nV,iV;rV=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};Ok=function(){};nV=function(e,t,r,s){var u=e.memoizedProps;if(u!==s){e=t.stateNode,qg(dh.current);var f=null;switch(r){case"input":u=ik(e,u),s=ik(e,s),f=[];break;case"select":u=to({},u,{value:void 0}),s=to({},s,{value:void 0}),f=[];break;case"textarea":u=ok(e,u),s=ok(e,s),f=[];break;default:typeof u.onClick!="function"&&typeof s.onClick=="function"&&(e.onclick=bE)}ck(r,s);var m;r=null;for(E in u)if(!s.hasOwnProperty(E)&&u.hasOwnProperty(E)&&u[E]!=null)if(E==="style"){var i=u[E];for(m in i)i.hasOwnProperty(m)&&(r||(r={}),r[m]="")}else E!=="dangerouslySetInnerHTML"&&E!=="children"&&E!=="suppressContentEditableWarning"&&E!=="suppressHydrationWarning"&&E!=="autoFocus"&&(qw.hasOwnProperty(E)?f||(f=[]):(f=f||[]).push(E,null));for(E in s){var S=s[E];if(i=u!=null?u[E]:void 0,s.hasOwnProperty(E)&&S!==i&&(S!=null||i!=null))if(E==="style")if(i){for(m in i)!i.hasOwnProperty(m)||S&&S.hasOwnProperty(m)||(r||(r={}),r[m]="");for(m in S)S.hasOwnProperty(m)&&i[m]!==S[m]&&(r||(r={}),r[m]=S[m])}else r||(f||(f=[]),f.push(E,r)),r=S;else E==="dangerouslySetInnerHTML"?(S=S?S.__html:void 0,i=i?i.__html:void 0,S!=null&&i!==S&&(f=f||[]).push(E,S)):E==="children"?typeof S!="string"&&typeof S!="number"||(f=f||[]).push(E,""+S):E!=="suppressContentEditableWarning"&&E!=="suppressHydrationWarning"&&(qw.hasOwnProperty(E)?(S!=null&&E==="onScroll"&&Fa("scroll",e),f||i===S||(f=[])):(f=f||[]).push(E,S))}r&&(f=f||[]).push("style",r);var E=f;(t.updateQueue=E)&&(t.flags|=4)}};iV=function(e,t,r,s){r!==s&&(t.flags|=4)};function iw(e,t){if(!Ga)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var s=null;r!==null;)r.alternate!==null&&(s=r),r=r.sibling;s===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:s.sibling=null}}function wl(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,s=0;if(t)for(var u=e.child;u!==null;)r|=u.lanes|u.childLanes,s|=u.subtreeFlags&14680064,s|=u.flags&14680064,u.return=e,u=u.sibling;else for(u=e.child;u!==null;)r|=u.lanes|u.childLanes,s|=u.subtreeFlags,s|=u.flags,u.return=e,u=u.sibling;return e.subtreeFlags|=s,e.childLanes=r,t}function pQ(e,t,r){var s=t.pendingProps;switch(jD(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return wl(t),null;case 1:return Cc(t.type)&&SE(),wl(t),null;case 3:return s=t.stateNode,vv(),za(Ec),za(Al),FD(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(e===null||e.child===null)&&(cT(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,hd!==null&&(qk(hd),hd=null))),Ok(e,t),wl(t),null;case 5:OD(t);var u=qg(rb.current);if(r=t.type,e!==null&&t.stateNode!=null)nV(e,t,r,s,u),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!s){if(t.stateNode===null)throw Error(rn(166));return wl(t),null}if(e=qg(dh.current),cT(t)){s=t.stateNode,r=t.type;var f=t.memoizedProps;switch(s[nh]=t,s[eb]=f,e=(t.mode&1)!==0,r){case"dialog":Fa("cancel",s),Fa("close",s);break;case"iframe":case"object":case"embed":Fa("load",s);break;case"video":case"audio":for(u=0;u<mw.length;u++)Fa(mw[u],s);break;case"source":Fa("error",s);break;case"img":case"image":case"link":Fa("error",s),Fa("load",s);break;case"details":Fa("toggle",s);break;case"input":VL(s,f),Fa("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!f.multiple},Fa("invalid",s);break;case"textarea":qL(s,f),Fa("invalid",s)}ck(r,f),u=null;for(var m in f)if(f.hasOwnProperty(m)){var i=f[m];m==="children"?typeof i=="string"?s.textContent!==i&&(f.suppressHydrationWarning!==!0&&lT(s.textContent,i,e),u=["children",i]):typeof i=="number"&&s.textContent!==""+i&&(f.suppressHydrationWarning!==!0&&lT(s.textContent,i,e),u=["children",""+i]):qw.hasOwnProperty(m)&&i!=null&&m==="onScroll"&&Fa("scroll",s)}switch(r){case"input":eT(s),$L(s,f,!0);break;case"textarea":eT(s),GL(s);break;case"select":case"option":break;default:typeof f.onClick=="function"&&(s.onclick=bE)}s=u,t.updateQueue=s,s!==null&&(t.flags|=4)}else{m=u.nodeType===9?u:u.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=P6(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=m.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof s.is=="string"?e=m.createElement(r,{is:s.is}):(e=m.createElement(r),r==="select"&&(m=e,s.multiple?m.multiple=!0:s.size&&(m.size=s.size))):e=m.createElementNS(e,r),e[nh]=t,e[eb]=s,rV(e,t,!1,!1),t.stateNode=e;e:{switch(m=uk(r,s),r){case"dialog":Fa("cancel",e),Fa("close",e),u=s;break;case"iframe":case"object":case"embed":Fa("load",e),u=s;break;case"video":case"audio":for(u=0;u<mw.length;u++)Fa(mw[u],e);u=s;break;case"source":Fa("error",e),u=s;break;case"img":case"image":case"link":Fa("error",e),Fa("load",e),u=s;break;case"details":Fa("toggle",e),u=s;break;case"input":VL(e,s),u=ik(e,s),Fa("invalid",e);break;case"option":u=s;break;case"select":e._wrapperState={wasMultiple:!!s.multiple},u=to({},s,{value:void 0}),Fa("invalid",e);break;case"textarea":qL(e,s),u=ok(e,s),Fa("invalid",e);break;default:u=s}ck(r,u),i=u;for(f in i)if(i.hasOwnProperty(f)){var S=i[f];f==="style"?M6(e,S):f==="dangerouslySetInnerHTML"?(S=S?S.__html:void 0,S!=null&&D6(e,S)):f==="children"?typeof S=="string"?(r!=="textarea"||S!=="")&&Gw(e,S):typeof S=="number"&&Gw(e,""+S):f!=="suppressContentEditableWarning"&&f!=="suppressHydrationWarning"&&f!=="autoFocus"&&(qw.hasOwnProperty(f)?S!=null&&f==="onScroll"&&Fa("scroll",e):S!=null&&fD(e,f,S,m))}switch(r){case"input":eT(e),$L(e,s,!1);break;case"textarea":eT(e),GL(e);break;case"option":s.value!=null&&e.setAttribute("value",""+am(s.value));break;case"select":e.multiple=!!s.multiple,f=s.value,f!=null?Bx(e,!!s.multiple,f,!1):s.defaultValue!=null&&Bx(e,!!s.multiple,s.defaultValue,!0);break;default:typeof u.onClick=="function"&&(e.onclick=bE)}switch(r){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return wl(t),null;case 6:if(e&&t.stateNode!=null)iV(e,t,e.memoizedProps,s);else{if(typeof s!="string"&&t.stateNode===null)throw Error(rn(166));if(r=qg(rb.current),qg(dh.current),cT(t)){if(s=t.stateNode,r=t.memoizedProps,s[nh]=t,(f=s.nodeValue!==r)&&(e=Xc,e!==null))switch(e.tag){case 3:lT(s.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&lT(s.nodeValue,r,(e.mode&1)!==0)}f&&(t.flags|=4)}else s=(r.nodeType===9?r:r.ownerDocument).createTextNode(s),s[nh]=t,t.stateNode=s}return wl(t),null;case 13:if(za(Ja),s=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Ga&&Zc!==null&&t.mode&1&&!(t.flags&128))bU(),_v(),t.flags|=98560,f=!1;else if(f=cT(t),s!==null&&s.dehydrated!==null){if(e===null){if(!f)throw Error(rn(318));if(f=t.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(rn(317));f[nh]=t}else _v(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;wl(t),f=!1}else hd!==null&&(qk(hd),hd=null),f=!0;if(!f)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(s=s!==null,s!==(e!==null&&e.memoizedState!==null)&&s&&(t.child.flags|=8192,t.mode&1&&(e===null||Ja.current&1?Lo===0&&(Lo=3):XD())),t.updateQueue!==null&&(t.flags|=4),wl(t),null);case 4:return vv(),Ok(e,t),e===null&&Jw(t.stateNode.containerInfo),wl(t),null;case 10:return PD(t.type._context),wl(t),null;case 17:return Cc(t.type)&&SE(),wl(t),null;case 19:if(za(Ja),f=t.memoizedState,f===null)return wl(t),null;if(s=(t.flags&128)!==0,m=f.rendering,m===null)if(s)iw(f,!1);else{if(Lo!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(m=NE(e),m!==null){for(t.flags|=128,iw(f,!1),s=m.updateQueue,s!==null&&(t.updateQueue=s,t.flags|=4),t.subtreeFlags=0,s=r,r=t.child;r!==null;)f=r,e=s,f.flags&=14680066,m=f.alternate,m===null?(f.childLanes=0,f.lanes=e,f.child=null,f.subtreeFlags=0,f.memoizedProps=null,f.memoizedState=null,f.updateQueue=null,f.dependencies=null,f.stateNode=null):(f.childLanes=m.childLanes,f.lanes=m.lanes,f.child=m.child,f.subtreeFlags=0,f.deletions=null,f.memoizedProps=m.memoizedProps,f.memoizedState=m.memoizedState,f.updateQueue=m.updateQueue,f.type=m.type,e=m.dependencies,f.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return ka(Ja,Ja.current&1|2),t.child}e=e.sibling}f.tail!==null&&xo()>wv&&(t.flags|=128,s=!0,iw(f,!1),t.lanes=4194304)}else{if(!s)if(e=NE(m),e!==null){if(t.flags|=128,s=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),iw(f,!0),f.tail===null&&f.tailMode==="hidden"&&!m.alternate&&!Ga)return wl(t),null}else 2*xo()-f.renderingStartTime>wv&&r!==1073741824&&(t.flags|=128,s=!0,iw(f,!1),t.lanes=4194304);f.isBackwards?(m.sibling=t.child,t.child=m):(r=f.last,r!==null?r.sibling=m:t.child=m,f.last=m)}return f.tail!==null?(t=f.tail,f.rendering=t,f.tail=t.sibling,f.renderingStartTime=xo(),t.sibling=null,r=Ja.current,ka(Ja,s?r&1|2:r&1),t):(wl(t),null);case 22:case 23:return ZD(),s=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==s&&(t.flags|=8192),s&&t.mode&1?Bc&1073741824&&(wl(t),t.subtreeFlags&6&&(t.flags|=8192)):wl(t),null;case 24:return null;case 25:return null}throw Error(rn(156,t.tag))}function mQ(e,t){switch(jD(t),t.tag){case 1:return Cc(t.type)&&SE(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return vv(),za(Ec),za(Al),FD(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return OD(t),null;case 13:if(za(Ja),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(rn(340));_v()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return za(Ja),null;case 4:return vv(),null;case 10:return PD(t.type._context),null;case 22:case 23:return ZD(),null;case 24:return null;default:return null}}var hT=!1,Tl=!1,gQ=typeof WeakSet=="function"?WeakSet:Set,Wn=null;function Ox(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(s){ho(e,t,s)}else r.current=null}function Fk(e,t,r){try{r()}catch(s){ho(e,t,s)}}var R4=!1;function _Q(e,t){if(yk=vE,e=cU(),CD(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var s=r.getSelection&&r.getSelection();if(s&&s.rangeCount!==0){r=s.anchorNode;var u=s.anchorOffset,f=s.focusNode;s=s.focusOffset;try{r.nodeType,f.nodeType}catch{r=null;break e}var m=0,i=-1,S=-1,E=0,I=0,D=e,M=null;t:for(;;){for(var R;D!==r||u!==0&&D.nodeType!==3||(i=m+u),D!==f||s!==0&&D.nodeType!==3||(S=m+s),D.nodeType===3&&(m+=D.nodeValue.length),(R=D.firstChild)!==null;)M=D,D=R;for(;;){if(D===e)break t;if(M===r&&++E===u&&(i=m),M===f&&++I===s&&(S=m),(R=D.nextSibling)!==null)break;D=M,M=D.parentNode}D=R}r=i===-1||S===-1?null:{start:i,end:S}}else r=null}r=r||{start:0,end:0}}else r=null;for(wk={focusedElem:e,selectionRange:r},vE=!1,Wn=t;Wn!==null;)if(t=Wn,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Wn=e;else for(;Wn!==null;){t=Wn;try{var H=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(H!==null){var F=H.memoizedProps,U=H.memoizedState,Y=t.stateNode,z=Y.getSnapshotBeforeUpdate(t.elementType===t.type?F:ad(t.type,F),U);Y.__reactInternalSnapshotBeforeUpdate=z}break;case 3:var J=t.stateNode.containerInfo;J.nodeType===1?J.textContent="":J.nodeType===9&&J.documentElement&&J.removeChild(J.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(rn(163))}}catch(ne){ho(t,t.return,ne)}if(e=t.sibling,e!==null){e.return=t.return,Wn=e;break}Wn=t.return}return H=R4,R4=!1,H}function Iw(e,t,r){var s=t.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var u=s=s.next;do{if((u.tag&e)===e){var f=u.destroy;u.destroy=void 0,f!==void 0&&Fk(t,r,f)}u=u.next}while(u!==s)}}function FC(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var s=r.create;r.destroy=s()}r=r.next}while(r!==t)}}function Lk(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function sV(e){var t=e.alternate;t!==null&&(e.alternate=null,sV(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[nh],delete t[eb],delete t[Tk],delete t[QJ],delete t[eQ])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function aV(e){return e.tag===5||e.tag===3||e.tag===4}function M4(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||aV(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function zk(e,t,r){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=bE));else if(s!==4&&(e=e.child,e!==null))for(zk(e,t,r),e=e.sibling;e!==null;)zk(e,t,r),e=e.sibling}function Bk(e,t,r){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(s!==4&&(e=e.child,e!==null))for(Bk(e,t,r),e=e.sibling;e!==null;)Bk(e,t,r),e=e.sibling}var sl=null,ud=!1;function vp(e,t,r){for(r=r.child;r!==null;)oV(e,t,r),r=r.sibling}function oV(e,t,r){if(uh&&typeof uh.onCommitFiberUnmount=="function")try{uh.onCommitFiberUnmount(IC,r)}catch{}switch(r.tag){case 5:Tl||Ox(r,t);case 6:var s=sl,u=ud;sl=null,vp(e,t,r),sl=s,ud=u,sl!==null&&(ud?(e=sl,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):sl.removeChild(r.stateNode));break;case 18:sl!==null&&(ud?(e=sl,r=r.stateNode,e.nodeType===8?KI(e.parentNode,r):e.nodeType===1&&KI(e,r),Xw(e)):KI(sl,r.stateNode));break;case 4:s=sl,u=ud,sl=r.stateNode.containerInfo,ud=!0,vp(e,t,r),sl=s,ud=u;break;case 0:case 11:case 14:case 15:if(!Tl&&(s=r.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){u=s=s.next;do{var f=u,m=f.destroy;f=f.tag,m!==void 0&&(f&2||f&4)&&Fk(r,t,m),u=u.next}while(u!==s)}vp(e,t,r);break;case 1:if(!Tl&&(Ox(r,t),s=r.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=r.memoizedProps,s.state=r.memoizedState,s.componentWillUnmount()}catch(i){ho(r,t,i)}vp(e,t,r);break;case 21:vp(e,t,r);break;case 22:r.mode&1?(Tl=(s=Tl)||r.memoizedState!==null,vp(e,t,r),Tl=s):vp(e,t,r);break;default:vp(e,t,r)}}function O4(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new gQ),t.forEach(function(s){var u=CQ.bind(null,e,s);r.has(s)||(r.add(s),s.then(u,u))})}}function Qu(e,t){var r=t.deletions;if(r!==null)for(var s=0;s<r.length;s++){var u=r[s];try{var f=e,m=t,i=m;e:for(;i!==null;){switch(i.tag){case 5:sl=i.stateNode,ud=!1;break e;case 3:sl=i.stateNode.containerInfo,ud=!0;break e;case 4:sl=i.stateNode.containerInfo,ud=!0;break e}i=i.return}if(sl===null)throw Error(rn(160));oV(f,m,u),sl=null,ud=!1;var S=u.alternate;S!==null&&(S.return=null),u.return=null}catch(E){ho(u,t,E)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)lV(t,e),t=t.sibling}function lV(e,t){var r=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Qu(t,e),Xd(e),s&4){try{Iw(3,e,e.return),FC(3,e)}catch(F){ho(e,e.return,F)}try{Iw(5,e,e.return)}catch(F){ho(e,e.return,F)}}break;case 1:Qu(t,e),Xd(e),s&512&&r!==null&&Ox(r,r.return);break;case 5:if(Qu(t,e),Xd(e),s&512&&r!==null&&Ox(r,r.return),e.flags&32){var u=e.stateNode;try{Gw(u,"")}catch(F){ho(e,e.return,F)}}if(s&4&&(u=e.stateNode,u!=null)){var f=e.memoizedProps,m=r!==null?r.memoizedProps:f,i=e.type,S=e.updateQueue;if(e.updateQueue=null,S!==null)try{i==="input"&&f.type==="radio"&&f.name!=null&&N6(u,f),uk(i,m);var E=uk(i,f);for(m=0;m<S.length;m+=2){var I=S[m],D=S[m+1];I==="style"?M6(u,D):I==="dangerouslySetInnerHTML"?D6(u,D):I==="children"?Gw(u,D):fD(u,I,D,E)}switch(i){case"input":sk(u,f);break;case"textarea":k6(u,f);break;case"select":var M=u._wrapperState.wasMultiple;u._wrapperState.wasMultiple=!!f.multiple;var R=f.value;R!=null?Bx(u,!!f.multiple,R,!1):M!==!!f.multiple&&(f.defaultValue!=null?Bx(u,!!f.multiple,f.defaultValue,!0):Bx(u,!!f.multiple,f.multiple?[]:"",!1))}u[eb]=f}catch(F){ho(e,e.return,F)}}break;case 6:if(Qu(t,e),Xd(e),s&4){if(e.stateNode===null)throw Error(rn(162));u=e.stateNode,f=e.memoizedProps;try{u.nodeValue=f}catch(F){ho(e,e.return,F)}}break;case 3:if(Qu(t,e),Xd(e),s&4&&r!==null&&r.memoizedState.isDehydrated)try{Xw(t.containerInfo)}catch(F){ho(e,e.return,F)}break;case 4:Qu(t,e),Xd(e);break;case 13:Qu(t,e),Xd(e),u=e.child,u.flags&8192&&(f=u.memoizedState!==null,u.stateNode.isHidden=f,!f||u.alternate!==null&&u.alternate.memoizedState!==null||(WD=xo())),s&4&&O4(e);break;case 22:if(I=r!==null&&r.memoizedState!==null,e.mode&1?(Tl=(E=Tl)||I,Qu(t,e),Tl=E):Qu(t,e),Xd(e),s&8192){if(E=e.memoizedState!==null,(e.stateNode.isHidden=E)&&!I&&e.mode&1)for(Wn=e,I=e.child;I!==null;){for(D=Wn=I;Wn!==null;){switch(M=Wn,R=M.child,M.tag){case 0:case 11:case 14:case 15:Iw(4,M,M.return);break;case 1:Ox(M,M.return);var H=M.stateNode;if(typeof H.componentWillUnmount=="function"){s=M,r=M.return;try{t=s,H.props=t.memoizedProps,H.state=t.memoizedState,H.componentWillUnmount()}catch(F){ho(s,r,F)}}break;case 5:Ox(M,M.return);break;case 22:if(M.memoizedState!==null){L4(D);continue}}R!==null?(R.return=M,Wn=R):L4(D)}I=I.sibling}e:for(I=null,D=e;;){if(D.tag===5){if(I===null){I=D;try{u=D.stateNode,E?(f=u.style,typeof f.setProperty=="function"?f.setProperty("display","none","important"):f.display="none"):(i=D.stateNode,S=D.memoizedProps.style,m=S!=null&&S.hasOwnProperty("display")?S.display:null,i.style.display=R6("display",m))}catch(F){ho(e,e.return,F)}}}else if(D.tag===6){if(I===null)try{D.stateNode.nodeValue=E?"":D.memoizedProps}catch(F){ho(e,e.return,F)}}else if((D.tag!==22&&D.tag!==23||D.memoizedState===null||D===e)&&D.child!==null){D.child.return=D,D=D.child;continue}if(D===e)break e;for(;D.sibling===null;){if(D.return===null||D.return===e)break e;I===D&&(I=null),D=D.return}I===D&&(I=null),D.sibling.return=D.return,D=D.sibling}}break;case 19:Qu(t,e),Xd(e),s&4&&O4(e);break;case 21:break;default:Qu(t,e),Xd(e)}}function Xd(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(aV(r)){var s=r;break e}r=r.return}throw Error(rn(160))}switch(s.tag){case 5:var u=s.stateNode;s.flags&32&&(Gw(u,""),s.flags&=-33);var f=M4(e);Bk(e,f,u);break;case 3:case 4:var m=s.stateNode.containerInfo,i=M4(e);zk(e,i,m);break;default:throw Error(rn(161))}}catch(S){ho(e,e.return,S)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function xQ(e,t,r){Wn=e,cV(e)}function cV(e,t,r){for(var s=(e.mode&1)!==0;Wn!==null;){var u=Wn,f=u.child;if(u.tag===22&&s){var m=u.memoizedState!==null||hT;if(!m){var i=u.alternate,S=i!==null&&i.memoizedState!==null||Tl;i=hT;var E=Tl;if(hT=m,(Tl=S)&&!E)for(Wn=u;Wn!==null;)m=Wn,S=m.child,m.tag===22&&m.memoizedState!==null?z4(u):S!==null?(S.return=m,Wn=S):z4(u);for(;f!==null;)Wn=f,cV(f),f=f.sibling;Wn=u,hT=i,Tl=E}F4(e)}else u.subtreeFlags&8772&&f!==null?(f.return=u,Wn=f):F4(e)}}function F4(e){for(;Wn!==null;){var t=Wn;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Tl||FC(5,t);break;case 1:var s=t.stateNode;if(t.flags&4&&!Tl)if(r===null)s.componentDidMount();else{var u=t.elementType===t.type?r.memoizedProps:ad(t.type,r.memoizedProps);s.componentDidUpdate(u,r.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var f=t.updateQueue;f!==null&&w4(t,f,s);break;case 3:var m=t.updateQueue;if(m!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}w4(t,m,r)}break;case 5:var i=t.stateNode;if(r===null&&t.flags&4){r=i;var S=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":S.autoFocus&&r.focus();break;case"img":S.src&&(r.src=S.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var E=t.alternate;if(E!==null){var I=E.memoizedState;if(I!==null){var D=I.dehydrated;D!==null&&Xw(D)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(rn(163))}Tl||t.flags&512&&Lk(t)}catch(M){ho(t,t.return,M)}}if(t===e){Wn=null;break}if(r=t.sibling,r!==null){r.return=t.return,Wn=r;break}Wn=t.return}}function L4(e){for(;Wn!==null;){var t=Wn;if(t===e){Wn=null;break}var r=t.sibling;if(r!==null){r.return=t.return,Wn=r;break}Wn=t.return}}function z4(e){for(;Wn!==null;){var t=Wn;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{FC(4,t)}catch(S){ho(t,r,S)}break;case 1:var s=t.stateNode;if(typeof s.componentDidMount=="function"){var u=t.return;try{s.componentDidMount()}catch(S){ho(t,u,S)}}var f=t.return;try{Lk(t)}catch(S){ho(t,f,S)}break;case 5:var m=t.return;try{Lk(t)}catch(S){ho(t,m,S)}}}catch(S){ho(t,t.return,S)}if(t===e){Wn=null;break}var i=t.sibling;if(i!==null){i.return=t.return,Wn=i;break}Wn=t.return}}var vQ=Math.ceil,DE=wf.ReactCurrentDispatcher,qD=wf.ReactCurrentOwner,Su=wf.ReactCurrentBatchConfig,Ys=0,Yo=null,jo=null,ul=0,Bc=0,Fx=vm(0),Lo=0,ab=null,d_=0,LC=0,GD=0,Nw=null,yc=null,WD=0,wv=1/0,Wh=null,RE=!1,Uk=null,Qp=null,fT=!1,qp=null,ME=0,kw=0,Vk=null,QT=-1,eE=0;function Jl(){return Ys&6?xo():QT!==-1?QT:QT=xo()}function em(e){return e.mode&1?Ys&2&&ul!==0?ul&-ul:rQ.transition!==null?(eE===0&&(eE=H6()),eE):(e=va,e!==0||(e=window.event,e=e===void 0?16:eU(e.type)),e):1}function yd(e,t,r,s){if(50<kw)throw kw=0,Vk=null,Error(rn(185));Db(e,r,s),(!(Ys&2)||e!==Yo)&&(e===Yo&&(!(Ys&2)&&(LC|=r),Lo===4&&kp(e,ul)),Ac(e,s),r===1&&Ys===0&&!(t.mode&1)&&(wv=xo()+500,RC&&ym()))}function Ac(e,t){var r=e.callbackNode;rJ(e,t);var s=xE(e,e===Yo?ul:0);if(s===0)r!==null&&ZL(r),e.callbackNode=null,e.callbackPriority=0;else if(t=s&-s,e.callbackPriority!==t){if(r!=null&&ZL(r),t===1)e.tag===0?tQ(B4.bind(null,e)):vU(B4.bind(null,e)),KJ(function(){!(Ys&6)&&ym()}),r=null;else{switch(Z6(s)){case 1:r=xD;break;case 4:r=G6;break;case 16:r=_E;break;case 536870912:r=W6;break;default:r=_E}r=_V(r,uV.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function uV(e,t){if(QT=-1,eE=0,Ys&6)throw Error(rn(327));var r=e.callbackNode;if(Gx()&&e.callbackNode!==r)return null;var s=xE(e,e===Yo?ul:0);if(s===0)return null;if(s&30||s&e.expiredLanes||t)t=OE(e,s);else{t=s;var u=Ys;Ys|=2;var f=hV();(Yo!==e||ul!==t)&&(Wh=null,wv=xo()+500,r_(e,t));do try{bQ();break}catch(i){dV(e,i)}while(!0);kD(),DE.current=f,Ys=u,jo!==null?t=0:(Yo=null,ul=0,t=Lo)}if(t!==0){if(t===2&&(u=mk(e),u!==0&&(s=u,t=$k(e,u))),t===1)throw r=ab,r_(e,0),kp(e,s),Ac(e,xo()),r;if(t===6)kp(e,s);else{if(u=e.current.alternate,!(s&30)&&!yQ(u)&&(t=OE(e,s),t===2&&(f=mk(e),f!==0&&(s=f,t=$k(e,f))),t===1))throw r=ab,r_(e,0),kp(e,s),Ac(e,xo()),r;switch(e.finishedWork=u,e.finishedLanes=s,t){case 0:case 1:throw Error(rn(345));case 2:Rg(e,yc,Wh);break;case 3:if(kp(e,s),(s&130023424)===s&&(t=WD+500-xo(),10<t)){if(xE(e,0)!==0)break;if(u=e.suspendedLanes,(u&s)!==s){Jl(),e.pingedLanes|=e.suspendedLanes&u;break}e.timeoutHandle=Sk(Rg.bind(null,e,yc,Wh),t);break}Rg(e,yc,Wh);break;case 4:if(kp(e,s),(s&4194240)===s)break;for(t=e.eventTimes,u=-1;0<s;){var m=31-vd(s);f=1<<m,m=t[m],m>u&&(u=m),s&=~f}if(s=u,s=xo()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*vQ(s/1960))-s,10<s){e.timeoutHandle=Sk(Rg.bind(null,e,yc,Wh),s);break}Rg(e,yc,Wh);break;case 5:Rg(e,yc,Wh);break;default:throw Error(rn(329))}}}return Ac(e,xo()),e.callbackNode===r?uV.bind(null,e):null}function $k(e,t){var r=Nw;return e.current.memoizedState.isDehydrated&&(r_(e,t).flags|=256),e=OE(e,t),e!==2&&(t=yc,yc=r,t!==null&&qk(t)),e}function qk(e){yc===null?yc=e:yc.push.apply(yc,e)}function yQ(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var s=0;s<r.length;s++){var u=r[s],f=u.getSnapshot;u=u.value;try{if(!bd(f(),u))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function kp(e,t){for(t&=~GD,t&=~LC,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-vd(t),s=1<<r;e[r]=-1,t&=~s}}function B4(e){if(Ys&6)throw Error(rn(327));Gx();var t=xE(e,0);if(!(t&1))return Ac(e,xo()),null;var r=OE(e,t);if(e.tag!==0&&r===2){var s=mk(e);s!==0&&(t=s,r=$k(e,s))}if(r===1)throw r=ab,r_(e,0),kp(e,t),Ac(e,xo()),r;if(r===6)throw Error(rn(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Rg(e,yc,Wh),Ac(e,xo()),null}function HD(e,t){var r=Ys;Ys|=1;try{return e(t)}finally{Ys=r,Ys===0&&(wv=xo()+500,RC&&ym())}}function h_(e){qp!==null&&qp.tag===0&&!(Ys&6)&&Gx();var t=Ys;Ys|=1;var r=Su.transition,s=va;try{if(Su.transition=null,va=1,e)return e()}finally{va=s,Su.transition=r,Ys=t,!(Ys&6)&&ym()}}function ZD(){Bc=Fx.current,za(Fx)}function r_(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,YJ(r)),jo!==null)for(r=jo.return;r!==null;){var s=r;switch(jD(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&SE();break;case 3:vv(),za(Ec),za(Al),FD();break;case 5:OD(s);break;case 4:vv();break;case 13:za(Ja);break;case 19:za(Ja);break;case 10:PD(s.type._context);break;case 22:case 23:ZD()}r=r.return}if(Yo=e,jo=e=tm(e.current,null),ul=Bc=t,Lo=0,ab=null,GD=LC=d_=0,yc=Nw=null,$g!==null){for(t=0;t<$g.length;t++)if(r=$g[t],s=r.interleaved,s!==null){r.interleaved=null;var u=s.next,f=r.pending;if(f!==null){var m=f.next;f.next=u,s.next=m}r.pending=s}$g=null}return e}function dV(e,t){do{var r=jo;try{if(kD(),YT.current=PE,kE){for(var s=Qa.memoizedState;s!==null;){var u=s.queue;u!==null&&(u.pending=null),s=s.next}kE=!1}if(u_=0,Wo=Oo=Qa=null,jw=!1,nb=0,qD.current=null,r===null||r.return===null){Lo=1,ab=t,jo=null;break}e:{var f=e,m=r.return,i=r,S=t;if(t=ul,i.flags|=32768,S!==null&&typeof S=="object"&&typeof S.then=="function"){var E=S,I=i,D=I.tag;if(!(I.mode&1)&&(D===0||D===11||D===15)){var M=I.alternate;M?(I.updateQueue=M.updateQueue,I.memoizedState=M.memoizedState,I.lanes=M.lanes):(I.updateQueue=null,I.memoizedState=null)}var R=A4(m);if(R!==null){R.flags&=-257,j4(R,m,i,f,t),R.mode&1&&C4(f,E,t),t=R,S=E;var H=t.updateQueue;if(H===null){var F=new Set;F.add(S),t.updateQueue=F}else H.add(S);break e}else{if(!(t&1)){C4(f,E,t),XD();break e}S=Error(rn(426))}}else if(Ga&&i.mode&1){var U=A4(m);if(U!==null){!(U.flags&65536)&&(U.flags|=256),j4(U,m,i,f,t),ID(yv(S,i));break e}}f=S=yv(S,i),Lo!==4&&(Lo=2),Nw===null?Nw=[f]:Nw.push(f),f=m;do{switch(f.tag){case 3:f.flags|=65536,t&=-t,f.lanes|=t;var Y=ZU(f,S,t);y4(f,Y);break e;case 1:i=S;var z=f.type,J=f.stateNode;if(!(f.flags&128)&&(typeof z.getDerivedStateFromError=="function"||J!==null&&typeof J.componentDidCatch=="function"&&(Qp===null||!Qp.has(J)))){f.flags|=65536,t&=-t,f.lanes|=t;var ne=XU(f,i,t);y4(f,ne);break e}}f=f.return}while(f!==null)}pV(r)}catch(me){t=me,jo===r&&r!==null&&(jo=r=r.return);continue}break}while(!0)}function hV(){var e=DE.current;return DE.current=PE,e===null?PE:e}function XD(){(Lo===0||Lo===3||Lo===2)&&(Lo=4),Yo===null||!(d_&268435455)&&!(LC&268435455)||kp(Yo,ul)}function OE(e,t){var r=Ys;Ys|=2;var s=hV();(Yo!==e||ul!==t)&&(Wh=null,r_(e,t));do try{wQ();break}catch(u){dV(e,u)}while(!0);if(kD(),Ys=r,DE.current=s,jo!==null)throw Error(rn(261));return Yo=null,ul=0,Lo}function wQ(){for(;jo!==null;)fV(jo)}function bQ(){for(;jo!==null&&!HK();)fV(jo)}function fV(e){var t=gV(e.alternate,e,Bc);e.memoizedProps=e.pendingProps,t===null?pV(e):jo=t,qD.current=null}function pV(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=mQ(r,t),r!==null){r.flags&=32767,jo=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Lo=6,jo=null;return}}else if(r=pQ(r,t,Bc),r!==null){jo=r;return}if(t=t.sibling,t!==null){jo=t;return}jo=t=e}while(t!==null);Lo===0&&(Lo=5)}function Rg(e,t,r){var s=va,u=Su.transition;try{Su.transition=null,va=1,SQ(e,t,r,s)}finally{Su.transition=u,va=s}return null}function SQ(e,t,r,s){do Gx();while(qp!==null);if(Ys&6)throw Error(rn(327));r=e.finishedWork;var u=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(rn(177));e.callbackNode=null,e.callbackPriority=0;var f=r.lanes|r.childLanes;if(nJ(e,f),e===Yo&&(jo=Yo=null,ul=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||fT||(fT=!0,_V(_E,function(){return Gx(),null})),f=(r.flags&15990)!==0,r.subtreeFlags&15990||f){f=Su.transition,Su.transition=null;var m=va;va=1;var i=Ys;Ys|=4,qD.current=null,_Q(e,r),lV(r,e),$J(wk),vE=!!yk,wk=yk=null,e.current=r,xQ(r),ZK(),Ys=i,va=m,Su.transition=f}else e.current=r;if(fT&&(fT=!1,qp=e,ME=u),f=e.pendingLanes,f===0&&(Qp=null),KK(r.stateNode),Ac(e,xo()),t!==null)for(s=e.onRecoverableError,r=0;r<t.length;r++)u=t[r],s(u.value,{componentStack:u.stack,digest:u.digest});if(RE)throw RE=!1,e=Uk,Uk=null,e;return ME&1&&e.tag!==0&&Gx(),f=e.pendingLanes,f&1?e===Vk?kw++:(kw=0,Vk=e):kw=0,ym(),null}function Gx(){if(qp!==null){var e=Z6(ME),t=Su.transition,r=va;try{if(Su.transition=null,va=16>e?16:e,qp===null)var s=!1;else{if(e=qp,qp=null,ME=0,Ys&6)throw Error(rn(331));var u=Ys;for(Ys|=4,Wn=e.current;Wn!==null;){var f=Wn,m=f.child;if(Wn.flags&16){var i=f.deletions;if(i!==null){for(var S=0;S<i.length;S++){var E=i[S];for(Wn=E;Wn!==null;){var I=Wn;switch(I.tag){case 0:case 11:case 15:Iw(8,I,f)}var D=I.child;if(D!==null)D.return=I,Wn=D;else for(;Wn!==null;){I=Wn;var M=I.sibling,R=I.return;if(sV(I),I===E){Wn=null;break}if(M!==null){M.return=R,Wn=M;break}Wn=R}}}var H=f.alternate;if(H!==null){var F=H.child;if(F!==null){H.child=null;do{var U=F.sibling;F.sibling=null,F=U}while(F!==null)}}Wn=f}}if(f.subtreeFlags&2064&&m!==null)m.return=f,Wn=m;else e:for(;Wn!==null;){if(f=Wn,f.flags&2048)switch(f.tag){case 0:case 11:case 15:Iw(9,f,f.return)}var Y=f.sibling;if(Y!==null){Y.return=f.return,Wn=Y;break e}Wn=f.return}}var z=e.current;for(Wn=z;Wn!==null;){m=Wn;var J=m.child;if(m.subtreeFlags&2064&&J!==null)J.return=m,Wn=J;else e:for(m=z;Wn!==null;){if(i=Wn,i.flags&2048)try{switch(i.tag){case 0:case 11:case 15:FC(9,i)}}catch(me){ho(i,i.return,me)}if(i===m){Wn=null;break e}var ne=i.sibling;if(ne!==null){ne.return=i.return,Wn=ne;break e}Wn=i.return}}if(Ys=u,ym(),uh&&typeof uh.onPostCommitFiberRoot=="function")try{uh.onPostCommitFiberRoot(IC,e)}catch{}s=!0}return s}finally{va=r,Su.transition=t}}return!1}function U4(e,t,r){t=yv(r,t),t=ZU(e,t,1),e=Jp(e,t,1),t=Jl(),e!==null&&(Db(e,1,t),Ac(e,t))}function ho(e,t,r){if(e.tag===3)U4(e,e,r);else for(;t!==null;){if(t.tag===3){U4(t,e,r);break}else if(t.tag===1){var s=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(Qp===null||!Qp.has(s))){e=yv(r,e),e=XU(t,e,1),t=Jp(t,e,1),e=Jl(),t!==null&&(Db(t,1,e),Ac(t,e));break}}t=t.return}}function TQ(e,t,r){var s=e.pingCache;s!==null&&s.delete(t),t=Jl(),e.pingedLanes|=e.suspendedLanes&r,Yo===e&&(ul&r)===r&&(Lo===4||Lo===3&&(ul&130023424)===ul&&500>xo()-WD?r_(e,0):GD|=r),Ac(e,t)}function mV(e,t){t===0&&(e.mode&1?(t=nT,nT<<=1,!(nT&130023424)&&(nT=4194304)):t=1);var r=Jl();e=mf(e,t),e!==null&&(Db(e,t,r),Ac(e,r))}function EQ(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),mV(e,r)}function CQ(e,t){var r=0;switch(e.tag){case 13:var s=e.stateNode,u=e.memoizedState;u!==null&&(r=u.retryLane);break;case 19:s=e.stateNode;break;default:throw Error(rn(314))}s!==null&&s.delete(t),mV(e,r)}var gV;gV=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||Ec.current)bc=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return bc=!1,fQ(e,t,r);bc=!!(e.flags&131072)}else bc=!1,Ga&&t.flags&1048576&&yU(t,CE,t.index);switch(t.lanes=0,t.tag){case 2:var s=t.type;JT(e,t),e=t.pendingProps;var u=gv(t,Al.current);qx(t,r),u=zD(null,t,s,e,u,r);var f=BD();return t.flags|=1,typeof u=="object"&&u!==null&&typeof u.render=="function"&&u.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Cc(s)?(f=!0,TE(t)):f=!1,t.memoizedState=u.state!==null&&u.state!==void 0?u.state:null,RD(t),u.updater=OC,t.stateNode=u,u._reactInternals=t,Nk(t,s,e,r),t=Dk(null,t,s,!0,f,r)):(t.tag=0,Ga&&f&&AD(t),Gl(null,t,u,r),t=t.child),t;case 16:s=t.elementType;e:{switch(JT(e,t),e=t.pendingProps,u=s._init,s=u(s._payload),t.type=s,u=t.tag=jQ(s),e=ad(s,e),u){case 0:t=Pk(null,t,s,e,r);break e;case 1:t=k4(null,t,s,e,r);break e;case 11:t=I4(null,t,s,e,r);break e;case 14:t=N4(null,t,s,ad(s.type,e),r);break e}throw Error(rn(306,s,""))}return t;case 0:return s=t.type,u=t.pendingProps,u=t.elementType===s?u:ad(s,u),Pk(e,t,s,u,r);case 1:return s=t.type,u=t.pendingProps,u=t.elementType===s?u:ad(s,u),k4(e,t,s,u,r);case 3:e:{if(QU(t),e===null)throw Error(rn(387));s=t.pendingProps,f=t.memoizedState,u=f.element,CU(e,t),IE(t,s,null,r);var m=t.memoizedState;if(s=m.element,f.isDehydrated)if(f={element:s,isDehydrated:!1,cache:m.cache,pendingSuspenseBoundaries:m.pendingSuspenseBoundaries,transitions:m.transitions},t.updateQueue.baseState=f,t.memoizedState=f,t.flags&256){u=yv(Error(rn(423)),t),t=P4(e,t,s,r,u);break e}else if(s!==u){u=yv(Error(rn(424)),t),t=P4(e,t,s,r,u);break e}else for(Zc=Kp(t.stateNode.containerInfo.firstChild),Xc=t,Ga=!0,hd=null,r=TU(t,null,s,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(_v(),s===u){t=gf(e,t,r);break e}Gl(e,t,s,r)}t=t.child}return t;case 5:return AU(t),e===null&&Ak(t),s=t.type,u=t.pendingProps,f=e!==null?e.memoizedProps:null,m=u.children,bk(s,u)?m=null:f!==null&&bk(s,f)&&(t.flags|=32),JU(e,t),Gl(e,t,m,r),t.child;case 6:return e===null&&Ak(t),null;case 13:return eV(e,t,r);case 4:return MD(t,t.stateNode.containerInfo),s=t.pendingProps,e===null?t.child=xv(t,null,s,r):Gl(e,t,s,r),t.child;case 11:return s=t.type,u=t.pendingProps,u=t.elementType===s?u:ad(s,u),I4(e,t,s,u,r);case 7:return Gl(e,t,t.pendingProps,r),t.child;case 8:return Gl(e,t,t.pendingProps.children,r),t.child;case 12:return Gl(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(s=t.type._context,u=t.pendingProps,f=t.memoizedProps,m=u.value,ka(AE,s._currentValue),s._currentValue=m,f!==null)if(bd(f.value,m)){if(f.children===u.children&&!Ec.current){t=gf(e,t,r);break e}}else for(f=t.child,f!==null&&(f.return=t);f!==null;){var i=f.dependencies;if(i!==null){m=f.child;for(var S=i.firstContext;S!==null;){if(S.context===s){if(f.tag===1){S=af(-1,r&-r),S.tag=2;var E=f.updateQueue;if(E!==null){E=E.shared;var I=E.pending;I===null?S.next=S:(S.next=I.next,I.next=S),E.pending=S}}f.lanes|=r,S=f.alternate,S!==null&&(S.lanes|=r),jk(f.return,r,t),i.lanes|=r;break}S=S.next}}else if(f.tag===10)m=f.type===t.type?null:f.child;else if(f.tag===18){if(m=f.return,m===null)throw Error(rn(341));m.lanes|=r,i=m.alternate,i!==null&&(i.lanes|=r),jk(m,r,t),m=f.sibling}else m=f.child;if(m!==null)m.return=f;else for(m=f;m!==null;){if(m===t){m=null;break}if(f=m.sibling,f!==null){f.return=m.return,m=f;break}m=m.return}f=m}Gl(e,t,u.children,r),t=t.child}return t;case 9:return u=t.type,s=t.pendingProps.children,qx(t,r),u=Tu(u),s=s(u),t.flags|=1,Gl(e,t,s,r),t.child;case 14:return s=t.type,u=ad(s,t.pendingProps),u=ad(s.type,u),N4(e,t,s,u,r);case 15:return YU(e,t,t.type,t.pendingProps,r);case 17:return s=t.type,u=t.pendingProps,u=t.elementType===s?u:ad(s,u),JT(e,t),t.tag=1,Cc(s)?(e=!0,TE(t)):e=!1,qx(t,r),HU(t,s,u),Nk(t,s,u,r),Dk(null,t,s,!0,e,r);case 19:return tV(e,t,r);case 22:return KU(e,t,r)}throw Error(rn(156,t.tag))};function _V(e,t){return q6(e,t)}function AQ(e,t,r,s){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function bu(e,t,r,s){return new AQ(e,t,r,s)}function YD(e){return e=e.prototype,!(!e||!e.isReactComponent)}function jQ(e){if(typeof e=="function")return YD(e)?1:0;if(e!=null){if(e=e.$$typeof,e===mD)return 11;if(e===gD)return 14}return 2}function tm(e,t){var r=e.alternate;return r===null?(r=bu(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function tE(e,t,r,s,u,f){var m=2;if(s=e,typeof e=="function")YD(e)&&(m=1);else if(typeof e=="string")m=5;else e:switch(e){case Ax:return n_(r.children,u,f,t);case pD:m=8,u|=8;break;case ek:return e=bu(12,r,t,u|2),e.elementType=ek,e.lanes=f,e;case tk:return e=bu(13,r,t,u),e.elementType=tk,e.lanes=f,e;case rk:return e=bu(19,r,t,u),e.elementType=rk,e.lanes=f,e;case A6:return zC(r,u,f,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case E6:m=10;break e;case C6:m=9;break e;case mD:m=11;break e;case gD:m=14;break e;case Ap:m=16,s=null;break e}throw Error(rn(130,e==null?e:typeof e,""))}return t=bu(m,r,t,u),t.elementType=e,t.type=s,t.lanes=f,t}function n_(e,t,r,s){return e=bu(7,e,s,t),e.lanes=r,e}function zC(e,t,r,s){return e=bu(22,e,s,t),e.elementType=A6,e.lanes=r,e.stateNode={isHidden:!1},e}function sN(e,t,r){return e=bu(6,e,null,t),e.lanes=r,e}function aN(e,t,r){return t=bu(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function IQ(e,t,r,s,u){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=BI(0),this.expirationTimes=BI(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=BI(0),this.identifierPrefix=s,this.onRecoverableError=u,this.mutableSourceEagerHydrationData=null}function KD(e,t,r,s,u,f,m,i,S){return e=new IQ(e,t,r,i,S),t===1?(t=1,f===!0&&(t|=8)):t=0,f=bu(3,null,null,t),e.current=f,f.stateNode=e,f.memoizedState={element:s,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},RD(f),e}function NQ(e,t,r){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Cx,key:s==null?null:""+s,children:e,containerInfo:t,implementation:r}}function xV(e){if(!e)return om;e=e._reactInternals;e:{if(j_(e)!==e||e.tag!==1)throw Error(rn(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Cc(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(rn(171))}if(e.tag===1){var r=e.type;if(Cc(r))return xU(e,r,t)}return t}function vV(e,t,r,s,u,f,m,i,S){return e=KD(r,s,!0,e,u,f,m,i,S),e.context=xV(null),r=e.current,s=Jl(),u=em(r),f=af(s,u),f.callback=t??null,Jp(r,f,u),e.current.lanes=u,Db(e,u,s),Ac(e,s),e}function BC(e,t,r,s){var u=t.current,f=Jl(),m=em(u);return r=xV(r),t.context===null?t.context=r:t.pendingContext=r,t=af(f,m),t.payload={element:e},s=s===void 0?null:s,s!==null&&(t.callback=s),e=Jp(u,t,m),e!==null&&(yd(e,u,m,f),XT(e,u,m)),m}function FE(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function V4(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function JD(e,t){V4(e,t),(e=e.alternate)&&V4(e,t)}function kQ(){return null}var yV=typeof reportError=="function"?reportError:function(e){console.error(e)};function QD(e){this._internalRoot=e}UC.prototype.render=QD.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(rn(409));BC(e,t,null,null)};UC.prototype.unmount=QD.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;h_(function(){BC(null,e,null,null)}),t[pf]=null}};function UC(e){this._internalRoot=e}UC.prototype.unstable_scheduleHydration=function(e){if(e){var t=K6();e={blockedOn:null,target:e,priority:t};for(var r=0;r<Np.length&&t!==0&&t<Np[r].priority;r++);Np.splice(r,0,e),r===0&&Q6(e)}};function eR(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function VC(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function $4(){}function PQ(e,t,r,s,u){if(u){if(typeof s=="function"){var f=s;s=function(){var E=FE(m);f.call(E)}}var m=vV(t,s,e,0,null,!1,!1,"",$4);return e._reactRootContainer=m,e[pf]=m.current,Jw(e.nodeType===8?e.parentNode:e),h_(),m}for(;u=e.lastChild;)e.removeChild(u);if(typeof s=="function"){var i=s;s=function(){var E=FE(S);i.call(E)}}var S=KD(e,0,!1,null,null,!1,!1,"",$4);return e._reactRootContainer=S,e[pf]=S.current,Jw(e.nodeType===8?e.parentNode:e),h_(function(){BC(t,S,r,s)}),S}function $C(e,t,r,s,u){var f=r._reactRootContainer;if(f){var m=f;if(typeof u=="function"){var i=u;u=function(){var S=FE(m);i.call(S)}}BC(t,m,e,u)}else m=PQ(r,t,e,u,s);return FE(m)}X6=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=pw(t.pendingLanes);r!==0&&(vD(t,r|1),Ac(t,xo()),!(Ys&6)&&(wv=xo()+500,ym()))}break;case 13:h_(function(){var s=mf(e,1);if(s!==null){var u=Jl();yd(s,e,1,u)}}),JD(e,1)}};yD=function(e){if(e.tag===13){var t=mf(e,134217728);if(t!==null){var r=Jl();yd(t,e,134217728,r)}JD(e,134217728)}};Y6=function(e){if(e.tag===13){var t=em(e),r=mf(e,t);if(r!==null){var s=Jl();yd(r,e,t,s)}JD(e,t)}};K6=function(){return va};J6=function(e,t){var r=va;try{return va=e,t()}finally{va=r}};hk=function(e,t,r){switch(t){case"input":if(sk(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var s=r[t];if(s!==e&&s.form===e.form){var u=DC(s);if(!u)throw Error(rn(90));I6(s),sk(s,u)}}}break;case"textarea":k6(e,r);break;case"select":t=r.value,t!=null&&Bx(e,!!r.multiple,t,!1)}};L6=HD;z6=h_;var DQ={usingClientEntryPoint:!1,Events:[Mb,kx,DC,O6,F6,HD]},sw={findFiberByHostInstance:Vg,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},RQ={bundleType:sw.bundleType,version:sw.version,rendererPackageName:sw.rendererPackageName,rendererConfig:sw.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:wf.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=V6(e),e===null?null:e.stateNode},findFiberByHostInstance:sw.findFiberByHostInstance||kQ,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var pT=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!pT.isDisabled&&pT.supportsFiber)try{IC=pT.inject(RQ),uh=pT}catch{}}tu.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=DQ;tu.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!eR(t))throw Error(rn(200));return NQ(e,t,null,r)};tu.createRoot=function(e,t){if(!eR(e))throw Error(rn(299));var r=!1,s="",u=yV;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(u=t.onRecoverableError)),t=KD(e,1,!1,null,null,r,!1,s,u),e[pf]=t.current,Jw(e.nodeType===8?e.parentNode:e),new QD(t)};tu.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(rn(188)):(e=Object.keys(e).join(","),Error(rn(268,e)));return e=V6(t),e=e===null?null:e.stateNode,e};tu.flushSync=function(e){return h_(e)};tu.hydrate=function(e,t,r){if(!VC(t))throw Error(rn(200));return $C(null,e,t,!0,r)};tu.hydrateRoot=function(e,t,r){if(!eR(e))throw Error(rn(405));var s=r!=null&&r.hydratedSources||null,u=!1,f="",m=yV;if(r!=null&&(r.unstable_strictMode===!0&&(u=!0),r.identifierPrefix!==void 0&&(f=r.identifierPrefix),r.onRecoverableError!==void 0&&(m=r.onRecoverableError)),t=vV(t,null,e,1,r??null,u,!1,f,m),e[pf]=t.current,Jw(e),s)for(e=0;e<s.length;e++)r=s[e],u=r._getVersion,u=u(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,u]:t.mutableSourceEagerHydrationData.push(r,u);return new UC(t)};tu.render=function(e,t,r){if(!VC(t))throw Error(rn(200));return $C(null,e,t,!1,r)};tu.unmountComponentAtNode=function(e){if(!VC(e))throw Error(rn(40));return e._reactRootContainer?(h_(function(){$C(null,null,e,!1,function(){e._reactRootContainer=null,e[pf]=null})}),!0):!1};tu.unstable_batchedUpdates=HD;tu.unstable_renderSubtreeIntoContainer=function(e,t,r,s){if(!VC(r))throw Error(rn(200));if(e==null||e._reactInternals===void 0)throw Error(rn(38));return $C(e,t,r,!1,s)};tu.version="18.3.1-next-f1338f8080-20240426";function wV(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(wV)}catch(e){console.error(e)}}wV(),w6.exports=tu;var I_=w6.exports;const bV=sD(I_);var SV,q4=I_;SV=q4.createRoot,q4.hydrateRoot;const MQ=1,OQ=1e6;let oN=0;function FQ(){return oN=(oN+1)%Number.MAX_SAFE_INTEGER,oN.toString()}const lN=new Map,G4=e=>{if(lN.has(e))return;const t=setTimeout(()=>{lN.delete(e),Pw({type:"REMOVE_TOAST",toastId:e})},OQ);lN.set(e,t)},LQ=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,MQ)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(r=>r.id===t.toast.id?{...r,...t.toast}:r)};case"DISMISS_TOAST":{const{toastId:r}=t;return r?G4(r):e.toasts.forEach(s=>{G4(s.id)}),{...e,toasts:e.toasts.map(s=>s.id===r||r===void 0?{...s,open:!1}:s)}}case"REMOVE_TOAST":return t.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(r=>r.id!==t.toastId)}}},rE=[];let nE={toasts:[]};function Pw(e){nE=LQ(nE,e),rE.forEach(t=>{t(nE)})}function bn({...e}){const t=FQ(),r=u=>Pw({type:"UPDATE_TOAST",toast:{...u,id:t}}),s=()=>Pw({type:"DISMISS_TOAST",toastId:t});return Pw({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:u=>{u||s()}}}),{id:t,dismiss:s,update:r}}function wm(){const[e,t]=V.useState(nE);return V.useEffect(()=>(rE.push(t),()=>{const r=rE.indexOf(t);r>-1&&rE.splice(r,1)}),[e]),{...e,toast:bn,dismiss:r=>Pw({type:"DISMISS_TOAST",toastId:r})}}function xi(e,t,{checkForDefaultPrevented:r=!0}={}){return function(u){if(e==null||e(u),r===!1||!u.defaultPrevented)return t==null?void 0:t(u)}}function W4(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function TV(...e){return t=>{let r=!1;const s=e.map(u=>{const f=W4(u,t);return!r&&typeof f=="function"&&(r=!0),f});if(r)return()=>{for(let u=0;u<s.length;u++){const f=s[u];typeof f=="function"?f():W4(e[u],null)}}}}function da(...e){return V.useCallback(TV(...e),e)}function zQ(e,t){const r=V.createContext(t),s=f=>{const{children:m,...i}=f,S=V.useMemo(()=>i,Object.values(i));return c.jsx(r.Provider,{value:S,children:m})};s.displayName=e+"Provider";function u(f){const m=V.useContext(r);if(m)return m;if(t!==void 0)return t;throw new Error(`\`${f}\` must be used within \`${e}\``)}return[s,u]}function xh(e,t=[]){let r=[];function s(f,m){const i=V.createContext(m),S=r.length;r=[...r,m];const E=D=>{var Y;const{scope:M,children:R,...H}=D,F=((Y=M==null?void 0:M[e])==null?void 0:Y[S])||i,U=V.useMemo(()=>H,Object.values(H));return c.jsx(F.Provider,{value:U,children:R})};E.displayName=f+"Provider";function I(D,M){var F;const R=((F=M==null?void 0:M[e])==null?void 0:F[S])||i,H=V.useContext(R);if(H)return H;if(m!==void 0)return m;throw new Error(`\`${D}\` must be used within \`${f}\``)}return[E,I]}const u=()=>{const f=r.map(m=>V.createContext(m));return function(i){const S=(i==null?void 0:i[e])||f;return V.useMemo(()=>({[`__scope${e}`]:{...i,[e]:S}}),[i,S])}};return u.scopeName=e,[s,BQ(u,...t)]}function BQ(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const s=e.map(u=>({useScope:u(),scopeName:u.scopeName}));return function(f){const m=s.reduce((i,{useScope:S,scopeName:E})=>{const D=S(f)[`__scope${E}`];return{...i,...D}},{});return V.useMemo(()=>({[`__scope${t.scopeName}`]:m}),[m])}};return r.scopeName=t.scopeName,r}function bv(e){const t=UQ(e),r=V.forwardRef((s,u)=>{const{children:f,...m}=s,i=V.Children.toArray(f),S=i.find(VQ);if(S){const E=S.props.children,I=i.map(D=>D===S?V.Children.count(E)>1?V.Children.only(null):V.isValidElement(E)?E.props.children:null:D);return c.jsx(t,{...m,ref:u,children:V.isValidElement(E)?V.cloneElement(E,void 0,I):null})}return c.jsx(t,{...m,ref:u,children:f})});return r.displayName=`${e}.Slot`,r}var N_=bv("Slot");function UQ(e){const t=V.forwardRef((r,s)=>{const{children:u,...f}=r;if(V.isValidElement(u)){const m=qQ(u),i=$Q(f,u.props);return u.type!==V.Fragment&&(i.ref=s?TV(s,m):m),V.cloneElement(u,i)}return V.Children.count(u)>1?V.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var EV=Symbol("radix.slottable");function CV(e){const t=({children:r})=>c.jsx(c.Fragment,{children:r});return t.displayName=`${e}.Slottable`,t.__radixId=EV,t}function VQ(e){return V.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===EV}function $Q(e,t){const r={...t};for(const s in t){const u=e[s],f=t[s];/^on[A-Z]/.test(s)?u&&f?r[s]=(...i)=>{const S=f(...i);return u(...i),S}:u&&(r[s]=u):s==="style"?r[s]={...u,...f}:s==="className"&&(r[s]=[u,f].filter(Boolean).join(" "))}return{...e,...r}}function qQ(e){var s,u;let t=(s=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:s.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=(u=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:u.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}function tR(e){const t=e+"CollectionProvider",[r,s]=xh(t),[u,f]=r(t,{collectionRef:{current:null},itemMap:new Map}),m=F=>{const{scope:U,children:Y}=F,z=Cr.useRef(null),J=Cr.useRef(new Map).current;return c.jsx(u,{scope:U,itemMap:J,collectionRef:z,children:Y})};m.displayName=t;const i=e+"CollectionSlot",S=bv(i),E=Cr.forwardRef((F,U)=>{const{scope:Y,children:z}=F,J=f(i,Y),ne=da(U,J.collectionRef);return c.jsx(S,{ref:ne,children:z})});E.displayName=i;const I=e+"CollectionItemSlot",D="data-radix-collection-item",M=bv(I),R=Cr.forwardRef((F,U)=>{const{scope:Y,children:z,...J}=F,ne=Cr.useRef(null),me=da(U,ne),le=f(I,Y);return Cr.useEffect(()=>(le.itemMap.set(ne,{ref:ne,...J}),()=>void le.itemMap.delete(ne))),c.jsx(M,{[D]:"",ref:me,children:z})});R.displayName=I;function H(F){const U=f(e+"CollectionConsumer",F);return Cr.useCallback(()=>{const z=U.collectionRef.current;if(!z)return[];const J=Array.from(z.querySelectorAll(`[${D}]`));return Array.from(U.itemMap.values()).sort((le,ye)=>J.indexOf(le.ref.current)-J.indexOf(ye.ref.current))},[U.collectionRef,U.itemMap])}return[{Provider:m,Slot:E,ItemSlot:R},H,s]}var GQ=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],es=GQ.reduce((e,t)=>{const r=bv(`Primitive.${t}`),s=V.forwardRef((u,f)=>{const{asChild:m,...i}=u,S=m?r:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),c.jsx(S,{...i,ref:f})});return s.displayName=`Primitive.${t}`,{...e,[t]:s}},{});function AV(e,t){e&&I_.flushSync(()=>e.dispatchEvent(t))}function Cu(e){const t=V.useRef(e);return V.useEffect(()=>{t.current=e}),V.useMemo(()=>(...r)=>{var s;return(s=t.current)==null?void 0:s.call(t,...r)},[])}function WQ(e,t=globalThis==null?void 0:globalThis.document){const r=Cu(e);V.useEffect(()=>{const s=u=>{u.key==="Escape"&&r(u)};return t.addEventListener("keydown",s,{capture:!0}),()=>t.removeEventListener("keydown",s,{capture:!0})},[r,t])}var HQ="DismissableLayer",Gk="dismissableLayer.update",ZQ="dismissableLayer.pointerDownOutside",XQ="dismissableLayer.focusOutside",H4,jV=V.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Fb=V.forwardRef((e,t)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:s,onPointerDownOutside:u,onFocusOutside:f,onInteractOutside:m,onDismiss:i,...S}=e,E=V.useContext(jV),[I,D]=V.useState(null),M=(I==null?void 0:I.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,R]=V.useState({}),H=da(t,ye=>D(ye)),F=Array.from(E.layers),[U]=[...E.layersWithOutsidePointerEventsDisabled].slice(-1),Y=F.indexOf(U),z=I?F.indexOf(I):-1,J=E.layersWithOutsidePointerEventsDisabled.size>0,ne=z>=Y,me=KQ(ye=>{const pe=ye.target,be=[...E.branches].some(ke=>ke.contains(pe));!ne||be||(u==null||u(ye),m==null||m(ye),ye.defaultPrevented||i==null||i())},M),le=JQ(ye=>{const pe=ye.target;[...E.branches].some(ke=>ke.contains(pe))||(f==null||f(ye),m==null||m(ye),ye.defaultPrevented||i==null||i())},M);return WQ(ye=>{z===E.layers.size-1&&(s==null||s(ye),!ye.defaultPrevented&&i&&(ye.preventDefault(),i()))},M),V.useEffect(()=>{if(I)return r&&(E.layersWithOutsidePointerEventsDisabled.size===0&&(H4=M.body.style.pointerEvents,M.body.style.pointerEvents="none"),E.layersWithOutsidePointerEventsDisabled.add(I)),E.layers.add(I),Z4(),()=>{r&&E.layersWithOutsidePointerEventsDisabled.size===1&&(M.body.style.pointerEvents=H4)}},[I,M,r,E]),V.useEffect(()=>()=>{I&&(E.layers.delete(I),E.layersWithOutsidePointerEventsDisabled.delete(I),Z4())},[I,E]),V.useEffect(()=>{const ye=()=>R({});return document.addEventListener(Gk,ye),()=>document.removeEventListener(Gk,ye)},[]),c.jsx(es.div,{...S,ref:H,style:{pointerEvents:J?ne?"auto":"none":void 0,...e.style},onFocusCapture:xi(e.onFocusCapture,le.onFocusCapture),onBlurCapture:xi(e.onBlurCapture,le.onBlurCapture),onPointerDownCapture:xi(e.onPointerDownCapture,me.onPointerDownCapture)})});Fb.displayName=HQ;var YQ="DismissableLayerBranch",IV=V.forwardRef((e,t)=>{const r=V.useContext(jV),s=V.useRef(null),u=da(t,s);return V.useEffect(()=>{const f=s.current;if(f)return r.branches.add(f),()=>{r.branches.delete(f)}},[r.branches]),c.jsx(es.div,{...e,ref:u})});IV.displayName=YQ;function KQ(e,t=globalThis==null?void 0:globalThis.document){const r=Cu(e),s=V.useRef(!1),u=V.useRef(()=>{});return V.useEffect(()=>{const f=i=>{if(i.target&&!s.current){let S=function(){NV(ZQ,r,E,{discrete:!0})};const E={originalEvent:i};i.pointerType==="touch"?(t.removeEventListener("click",u.current),u.current=S,t.addEventListener("click",u.current,{once:!0})):S()}else t.removeEventListener("click",u.current);s.current=!1},m=window.setTimeout(()=>{t.addEventListener("pointerdown",f)},0);return()=>{window.clearTimeout(m),t.removeEventListener("pointerdown",f),t.removeEventListener("click",u.current)}},[t,r]),{onPointerDownCapture:()=>s.current=!0}}function JQ(e,t=globalThis==null?void 0:globalThis.document){const r=Cu(e),s=V.useRef(!1);return V.useEffect(()=>{const u=f=>{f.target&&!s.current&&NV(XQ,r,{originalEvent:f},{discrete:!1})};return t.addEventListener("focusin",u),()=>t.removeEventListener("focusin",u)},[t,r]),{onFocusCapture:()=>s.current=!0,onBlurCapture:()=>s.current=!1}}function Z4(){const e=new CustomEvent(Gk);document.dispatchEvent(e)}function NV(e,t,r,{discrete:s}){const u=r.originalEvent.target,f=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:r});t&&u.addEventListener(e,t,{once:!0}),s?AV(u,f):u.dispatchEvent(f)}var QQ=Fb,eee=IV,fl=globalThis!=null&&globalThis.document?V.useLayoutEffect:()=>{},tee="Portal",qC=V.forwardRef((e,t)=>{var i;const{container:r,...s}=e,[u,f]=V.useState(!1);fl(()=>f(!0),[]);const m=r||u&&((i=globalThis==null?void 0:globalThis.document)==null?void 0:i.body);return m?bV.createPortal(c.jsx(es.div,{...s,ref:t}),m):null});qC.displayName=tee;function ree(e,t){return V.useReducer((r,s)=>t[r][s]??r,e)}var bm=e=>{const{present:t,children:r}=e,s=nee(t),u=typeof r=="function"?r({present:s.isPresent}):V.Children.only(r),f=da(s.ref,iee(u));return typeof r=="function"||s.isPresent?V.cloneElement(u,{ref:f}):null};bm.displayName="Presence";function nee(e){const[t,r]=V.useState(),s=V.useRef(null),u=V.useRef(e),f=V.useRef("none"),m=e?"mounted":"unmounted",[i,S]=ree(m,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return V.useEffect(()=>{const E=mT(s.current);f.current=i==="mounted"?E:"none"},[i]),fl(()=>{const E=s.current,I=u.current;if(I!==e){const M=f.current,R=mT(E);e?S("MOUNT"):R==="none"||(E==null?void 0:E.display)==="none"?S("UNMOUNT"):S(I&&M!==R?"ANIMATION_OUT":"UNMOUNT"),u.current=e}},[e,S]),fl(()=>{if(t){let E;const I=t.ownerDocument.defaultView??window,D=R=>{const F=mT(s.current).includes(R.animationName);if(R.target===t&&F&&(S("ANIMATION_END"),!u.current)){const U=t.style.animationFillMode;t.style.animationFillMode="forwards",E=I.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=U)})}},M=R=>{R.target===t&&(f.current=mT(s.current))};return t.addEventListener("animationstart",M),t.addEventListener("animationcancel",D),t.addEventListener("animationend",D),()=>{I.clearTimeout(E),t.removeEventListener("animationstart",M),t.removeEventListener("animationcancel",D),t.removeEventListener("animationend",D)}}else S("ANIMATION_END")},[t,S]),{isPresent:["mounted","unmountSuspended"].includes(i),ref:V.useCallback(E=>{s.current=E?getComputedStyle(E):null,r(E)},[])}}function mT(e){return(e==null?void 0:e.animationName)||"none"}function iee(e){var s,u;let t=(s=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:s.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=(u=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:u.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}var see=uD[" useInsertionEffect ".trim().toString()]||fl;function lm({prop:e,defaultProp:t,onChange:r=()=>{},caller:s}){const[u,f,m]=aee({defaultProp:t,onChange:r}),i=e!==void 0,S=i?e:u;{const I=V.useRef(e!==void 0);V.useEffect(()=>{const D=I.current;D!==i&&console.warn(`${s} is changing from ${D?"controlled":"uncontrolled"} to ${i?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),I.current=i},[i,s])}const E=V.useCallback(I=>{var D;if(i){const M=oee(I)?I(e):I;M!==e&&((D=m.current)==null||D.call(m,M))}else f(I)},[i,e,f,m]);return[S,E]}function aee({defaultProp:e,onChange:t}){const[r,s]=V.useState(e),u=V.useRef(r),f=V.useRef(t);return see(()=>{f.current=t},[t]),V.useEffect(()=>{var m;u.current!==r&&((m=f.current)==null||m.call(f,r),u.current=r)},[r,u]),[r,s,f]}function oee(e){return typeof e=="function"}var kV=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),lee="VisuallyHidden",GC=V.forwardRef((e,t)=>c.jsx(es.span,{...e,ref:t,style:{...kV,...e.style}}));GC.displayName=lee;var cee=GC,rR="ToastProvider",[nR,uee,dee]=tR("Toast"),[PV,S2e]=xh("Toast",[dee]),[hee,WC]=PV(rR),DV=e=>{const{__scopeToast:t,label:r="Notification",duration:s=5e3,swipeDirection:u="right",swipeThreshold:f=50,children:m}=e,[i,S]=V.useState(null),[E,I]=V.useState(0),D=V.useRef(!1),M=V.useRef(!1);return r.trim()||console.error(`Invalid prop \`label\` supplied to \`${rR}\`. Expected non-empty \`string\`.`),c.jsx(nR.Provider,{scope:t,children:c.jsx(hee,{scope:t,label:r,duration:s,swipeDirection:u,swipeThreshold:f,toastCount:E,viewport:i,onViewportChange:S,onToastAdd:V.useCallback(()=>I(R=>R+1),[]),onToastRemove:V.useCallback(()=>I(R=>R-1),[]),isFocusedToastEscapeKeyDownRef:D,isClosePausedRef:M,children:m})})};DV.displayName=rR;var RV="ToastViewport",fee=["F8"],Wk="toast.viewportPause",Hk="toast.viewportResume",MV=V.forwardRef((e,t)=>{const{__scopeToast:r,hotkey:s=fee,label:u="Notifications ({hotkey})",...f}=e,m=WC(RV,r),i=uee(r),S=V.useRef(null),E=V.useRef(null),I=V.useRef(null),D=V.useRef(null),M=da(t,D,m.onViewportChange),R=s.join("+").replace(/Key/g,"").replace(/Digit/g,""),H=m.toastCount>0;V.useEffect(()=>{const U=Y=>{var J;s.length!==0&&s.every(ne=>Y[ne]||Y.code===ne)&&((J=D.current)==null||J.focus())};return document.addEventListener("keydown",U),()=>document.removeEventListener("keydown",U)},[s]),V.useEffect(()=>{const U=S.current,Y=D.current;if(H&&U&&Y){const z=()=>{if(!m.isClosePausedRef.current){const le=new CustomEvent(Wk);Y.dispatchEvent(le),m.isClosePausedRef.current=!0}},J=()=>{if(m.isClosePausedRef.current){const le=new CustomEvent(Hk);Y.dispatchEvent(le),m.isClosePausedRef.current=!1}},ne=le=>{!U.contains(le.relatedTarget)&&J()},me=()=>{U.contains(document.activeElement)||J()};return U.addEventListener("focusin",z),U.addEventListener("focusout",ne),U.addEventListener("pointermove",z),U.addEventListener("pointerleave",me),window.addEventListener("blur",z),window.addEventListener("focus",J),()=>{U.removeEventListener("focusin",z),U.removeEventListener("focusout",ne),U.removeEventListener("pointermove",z),U.removeEventListener("pointerleave",me),window.removeEventListener("blur",z),window.removeEventListener("focus",J)}}},[H,m.isClosePausedRef]);const F=V.useCallback(({tabbingDirection:U})=>{const z=i().map(J=>{const ne=J.ref.current,me=[ne,...Cee(ne)];return U==="forwards"?me:me.reverse()});return(U==="forwards"?z.reverse():z).flat()},[i]);return V.useEffect(()=>{const U=D.current;if(U){const Y=z=>{var me,le,ye;const J=z.altKey||z.ctrlKey||z.metaKey;if(z.key==="Tab"&&!J){const pe=document.activeElement,be=z.shiftKey;if(z.target===U&&be){(me=E.current)==null||me.focus();return}const Ee=F({tabbingDirection:be?"backwards":"forwards"}),qe=Ee.findIndex(Qe=>Qe===pe);cN(Ee.slice(qe+1))?z.preventDefault():be?(le=E.current)==null||le.focus():(ye=I.current)==null||ye.focus()}};return U.addEventListener("keydown",Y),()=>U.removeEventListener("keydown",Y)}},[i,F]),c.jsxs(eee,{ref:S,role:"region","aria-label":u.replace("{hotkey}",R),tabIndex:-1,style:{pointerEvents:H?void 0:"none"},children:[H&&c.jsx(Zk,{ref:E,onFocusFromOutsideViewport:()=>{const U=F({tabbingDirection:"forwards"});cN(U)}}),c.jsx(nR.Slot,{scope:r,children:c.jsx(es.ol,{tabIndex:-1,...f,ref:M})}),H&&c.jsx(Zk,{ref:I,onFocusFromOutsideViewport:()=>{const U=F({tabbingDirection:"backwards"});cN(U)}})]})});MV.displayName=RV;var OV="ToastFocusProxy",Zk=V.forwardRef((e,t)=>{const{__scopeToast:r,onFocusFromOutsideViewport:s,...u}=e,f=WC(OV,r);return c.jsx(GC,{"aria-hidden":!0,tabIndex:0,...u,ref:t,style:{position:"fixed"},onFocus:m=>{var E;const i=m.relatedTarget;!((E=f.viewport)!=null&&E.contains(i))&&s()}})});Zk.displayName=OV;var Lb="Toast",pee="toast.swipeStart",mee="toast.swipeMove",gee="toast.swipeCancel",_ee="toast.swipeEnd",FV=V.forwardRef((e,t)=>{const{forceMount:r,open:s,defaultOpen:u,onOpenChange:f,...m}=e,[i,S]=lm({prop:s,defaultProp:u??!0,onChange:f,caller:Lb});return c.jsx(bm,{present:r||i,children:c.jsx(yee,{open:i,...m,ref:t,onClose:()=>S(!1),onPause:Cu(e.onPause),onResume:Cu(e.onResume),onSwipeStart:xi(e.onSwipeStart,E=>{E.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:xi(e.onSwipeMove,E=>{const{x:I,y:D}=E.detail.delta;E.currentTarget.setAttribute("data-swipe","move"),E.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${I}px`),E.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${D}px`)}),onSwipeCancel:xi(e.onSwipeCancel,E=>{E.currentTarget.setAttribute("data-swipe","cancel"),E.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),E.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),E.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),E.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:xi(e.onSwipeEnd,E=>{const{x:I,y:D}=E.detail.delta;E.currentTarget.setAttribute("data-swipe","end"),E.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),E.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),E.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${I}px`),E.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${D}px`),S(!1)})})})});FV.displayName=Lb;var[xee,vee]=PV(Lb,{onClose(){}}),yee=V.forwardRef((e,t)=>{const{__scopeToast:r,type:s="foreground",duration:u,open:f,onClose:m,onEscapeKeyDown:i,onPause:S,onResume:E,onSwipeStart:I,onSwipeMove:D,onSwipeCancel:M,onSwipeEnd:R,...H}=e,F=WC(Lb,r),[U,Y]=V.useState(null),z=da(t,Qe=>Y(Qe)),J=V.useRef(null),ne=V.useRef(null),me=u||F.duration,le=V.useRef(0),ye=V.useRef(me),pe=V.useRef(0),{onToastAdd:be,onToastRemove:ke}=F,Oe=Cu(()=>{var gt;(U==null?void 0:U.contains(document.activeElement))&&((gt=F.viewport)==null||gt.focus()),m()}),Ee=V.useCallback(Qe=>{!Qe||Qe===1/0||(window.clearTimeout(pe.current),le.current=new Date().getTime(),pe.current=window.setTimeout(Oe,Qe))},[Oe]);V.useEffect(()=>{const Qe=F.viewport;if(Qe){const gt=()=>{Ee(ye.current),E==null||E()},Xe=()=>{const ct=new Date().getTime()-le.current;ye.current=ye.current-ct,window.clearTimeout(pe.current),S==null||S()};return Qe.addEventListener(Wk,Xe),Qe.addEventListener(Hk,gt),()=>{Qe.removeEventListener(Wk,Xe),Qe.removeEventListener(Hk,gt)}}},[F.viewport,me,S,E,Ee]),V.useEffect(()=>{f&&!F.isClosePausedRef.current&&Ee(me)},[f,me,F.isClosePausedRef,Ee]),V.useEffect(()=>(be(),()=>ke()),[be,ke]);const qe=V.useMemo(()=>U?qV(U):null,[U]);return F.viewport?c.jsxs(c.Fragment,{children:[qe&&c.jsx(wee,{__scopeToast:r,role:"status","aria-live":s==="foreground"?"assertive":"polite","aria-atomic":!0,children:qe}),c.jsx(xee,{scope:r,onClose:Oe,children:I_.createPortal(c.jsx(nR.ItemSlot,{scope:r,children:c.jsx(QQ,{asChild:!0,onEscapeKeyDown:xi(i,()=>{F.isFocusedToastEscapeKeyDownRef.current||Oe(),F.isFocusedToastEscapeKeyDownRef.current=!1}),children:c.jsx(es.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":f?"open":"closed","data-swipe-direction":F.swipeDirection,...H,ref:z,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:xi(e.onKeyDown,Qe=>{Qe.key==="Escape"&&(i==null||i(Qe.nativeEvent),Qe.nativeEvent.defaultPrevented||(F.isFocusedToastEscapeKeyDownRef.current=!0,Oe()))}),onPointerDown:xi(e.onPointerDown,Qe=>{Qe.button===0&&(J.current={x:Qe.clientX,y:Qe.clientY})}),onPointerMove:xi(e.onPointerMove,Qe=>{if(!J.current)return;const gt=Qe.clientX-J.current.x,Xe=Qe.clientY-J.current.y,ct=!!ne.current,Me=["left","right"].includes(F.swipeDirection),mt=["left","up"].includes(F.swipeDirection)?Math.min:Math.max,Kt=Me?mt(0,gt):0,it=Me?0:mt(0,Xe),ee=Qe.pointerType==="touch"?10:2,he={x:Kt,y:it},Se={originalEvent:Qe,delta:he};ct?(ne.current=he,gT(mee,D,Se,{discrete:!1})):X4(he,F.swipeDirection,ee)?(ne.current=he,gT(pee,I,Se,{discrete:!1}),Qe.target.setPointerCapture(Qe.pointerId)):(Math.abs(gt)>ee||Math.abs(Xe)>ee)&&(J.current=null)}),onPointerUp:xi(e.onPointerUp,Qe=>{const gt=ne.current,Xe=Qe.target;if(Xe.hasPointerCapture(Qe.pointerId)&&Xe.releasePointerCapture(Qe.pointerId),ne.current=null,J.current=null,gt){const ct=Qe.currentTarget,Me={originalEvent:Qe,delta:gt};X4(gt,F.swipeDirection,F.swipeThreshold)?gT(_ee,R,Me,{discrete:!0}):gT(gee,M,Me,{discrete:!0}),ct.addEventListener("click",mt=>mt.preventDefault(),{once:!0})}})})})}),F.viewport)})]}):null}),wee=e=>{const{__scopeToast:t,children:r,...s}=e,u=WC(Lb,t),[f,m]=V.useState(!1),[i,S]=V.useState(!1);return Tee(()=>m(!0)),V.useEffect(()=>{const E=window.setTimeout(()=>S(!0),1e3);return()=>window.clearTimeout(E)},[]),i?null:c.jsx(qC,{asChild:!0,children:c.jsx(GC,{...s,children:f&&c.jsxs(c.Fragment,{children:[u.label," ",r]})})})},bee="ToastTitle",LV=V.forwardRef((e,t)=>{const{__scopeToast:r,...s}=e;return c.jsx(es.div,{...s,ref:t})});LV.displayName=bee;var See="ToastDescription",zV=V.forwardRef((e,t)=>{const{__scopeToast:r,...s}=e;return c.jsx(es.div,{...s,ref:t})});zV.displayName=See;var BV="ToastAction",UV=V.forwardRef((e,t)=>{const{altText:r,...s}=e;return r.trim()?c.jsx($V,{altText:r,asChild:!0,children:c.jsx(iR,{...s,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${BV}\`. Expected non-empty \`string\`.`),null)});UV.displayName=BV;var VV="ToastClose",iR=V.forwardRef((e,t)=>{const{__scopeToast:r,...s}=e,u=vee(VV,r);return c.jsx($V,{asChild:!0,children:c.jsx(es.button,{type:"button",...s,ref:t,onClick:xi(e.onClick,u.onClose)})})});iR.displayName=VV;var $V=V.forwardRef((e,t)=>{const{__scopeToast:r,altText:s,...u}=e;return c.jsx(es.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":s||void 0,...u,ref:t})});function qV(e){const t=[];return Array.from(e.childNodes).forEach(s=>{if(s.nodeType===s.TEXT_NODE&&s.textContent&&t.push(s.textContent),Eee(s)){const u=s.ariaHidden||s.hidden||s.style.display==="none",f=s.dataset.radixToastAnnounceExclude==="";if(!u)if(f){const m=s.dataset.radixToastAnnounceAlt;m&&t.push(m)}else t.push(...qV(s))}}),t}function gT(e,t,r,{discrete:s}){const u=r.originalEvent.currentTarget,f=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:r});t&&u.addEventListener(e,t,{once:!0}),s?AV(u,f):u.dispatchEvent(f)}var X4=(e,t,r=0)=>{const s=Math.abs(e.x),u=Math.abs(e.y),f=s>u;return t==="left"||t==="right"?f&&s>r:!f&&u>r};function Tee(e=()=>{}){const t=Cu(e);fl(()=>{let r=0,s=0;return r=window.requestAnimationFrame(()=>s=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(r),window.cancelAnimationFrame(s)}},[t])}function Eee(e){return e.nodeType===e.ELEMENT_NODE}function Cee(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const u=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||u?NodeFilter.FILTER_SKIP:s.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function cN(e){const t=document.activeElement;return e.some(r=>r===t?!0:(r.focus(),document.activeElement!==t))}var Aee=DV,GV=MV,WV=FV,HV=LV,ZV=zV,XV=UV,YV=iR;function KV(e){var t,r,s="";if(typeof e=="string"||typeof e=="number")s+=e;else if(typeof e=="object")if(Array.isArray(e)){var u=e.length;for(t=0;t<u;t++)e[t]&&(r=KV(e[t]))&&(s&&(s+=" "),s+=r)}else for(r in e)e[r]&&(s&&(s+=" "),s+=r);return s}function JV(){for(var e,t,r=0,s="",u=arguments.length;r<u;r++)(e=arguments[r])&&(t=KV(e))&&(s&&(s+=" "),s+=t);return s}const Y4=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,K4=JV,Fv=(e,t)=>r=>{var s;if((t==null?void 0:t.variants)==null)return K4(e,r==null?void 0:r.class,r==null?void 0:r.className);const{variants:u,defaultVariants:f}=t,m=Object.keys(u).map(E=>{const I=r==null?void 0:r[E],D=f==null?void 0:f[E];if(I===null)return null;const M=Y4(I)||Y4(D);return u[E][M]}),i=r&&Object.entries(r).reduce((E,I)=>{let[D,M]=I;return M===void 0||(E[D]=M),E},{}),S=t==null||(s=t.compoundVariants)===null||s===void 0?void 0:s.reduce((E,I)=>{let{class:D,className:M,...R}=I;return Object.entries(R).every(H=>{let[F,U]=H;return Array.isArray(U)?U.includes({...f,...i}[F]):{...f,...i}[F]===U})?[...E,D,M]:E},[]);return K4(e,m,S,r==null?void 0:r.class,r==null?void 0:r.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jee=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),QV=(...e)=>e.filter((t,r,s)=>!!t&&t.trim()!==""&&s.indexOf(t)===r).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Iee={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nee=V.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:s,className:u="",children:f,iconNode:m,...i},S)=>V.createElement("svg",{ref:S,...Iee,width:t,height:t,stroke:e,strokeWidth:s?Number(r)*24/Number(t):r,className:QV("lucide",u),...i},[...m.map(([E,I])=>V.createElement(E,I)),...Array.isArray(f)?f:[f]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hn=(e,t)=>{const r=V.forwardRef(({className:s,...u},f)=>V.createElement(Nee,{ref:f,iconNode:t,className:QV(`lucide-${jee(e)}`,s),...u}));return r.displayName=`${e}`,r};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iE=Hn("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kee=Hn("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J4=Hn("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cm=Hn("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pee=Hn("CalendarCheck",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dee=Hn("CalendarOff",[["path",{d:"M4.2 4.2A2 2 0 0 0 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 1.82-1.18",key:"16swn3"}],["path",{d:"M21 15.5V6a2 2 0 0 0-2-2H9.5",key:"yhw86o"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M3 10h7",key:"1wap6i"}],["path",{d:"M21 10h-5.5",key:"quycpq"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ree=Hn("CalendarPlus",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 13V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8",key:"3spt84"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M16 19h6",key:"xwg31i"}],["path",{d:"M19 16v6",key:"tddt3s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jc=Hn("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xk=Hn("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e8=Hn("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t8=Hn("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mee=Hn("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oee=Hn("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fee=Hn("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lx=Hn("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zb=Hn("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r8=Hn("CircleUser",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n8=Hn("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i8=Hn("ClipboardCheck",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HC=Hn("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lv=Hn("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lee=Hn("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yk=Hn("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f_=Hn("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sm=Hn("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zee=Hn("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bee=Hn("Headphones",[["path",{d:"M3 14h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7a9 9 0 0 1 18 0v7a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3",key:"1xhozi"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uee=Hn("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vee=Hn("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $ee=Hn("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qee=Hn("KeyRound",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kk=Hn("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gee=Hn("ListChecks",[["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q4=Hn("ListOrdered",[["path",{d:"M10 12h11",key:"6m4ad9"}],["path",{d:"M10 18h11",key:"11hvi2"}],["path",{d:"M10 6h11",key:"c7qv1k"}],["path",{d:"M4 10h2",key:"16xx2s"}],["path",{d:"M4 6h1v4",key:"cnovpq"}],["path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1",key:"m9a95d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bf=Hn("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wee=Hn("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hee=Hn("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zee=Hn("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const um=Hn("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ob=Hn("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ef=Hn("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xee=Hn("PanelLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sR=Hn("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s8=Hn("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yee=Hn("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kee=Hn("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sc=Hn("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZC=Hn("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gd=Hn("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a8=Hn("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jee=Hn("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aR=Hn("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jd=Hn("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qee=Hn("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zo=Hn("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oR=Hn("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i_=Hn("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ete=Hn("Unlink",[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tte=Hn("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XC=Hn("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rte=Hn("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nte=Hn("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jk=Hn("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lb=Hn("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const of=Hn("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lR=Hn("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),cR="-",ite=e=>{const t=ate(e),{conflictingClassGroups:r,conflictingClassGroupModifiers:s}=e;return{getClassGroupId:m=>{const i=m.split(cR);return i[0]===""&&i.length!==1&&i.shift(),o8(i,t)||ste(m)},getConflictingClassGroupIds:(m,i)=>{const S=r[m]||[];return i&&s[m]?[...S,...s[m]]:S}}},o8=(e,t)=>{var m;if(e.length===0)return t.classGroupId;const r=e[0],s=t.nextPart.get(r),u=s?o8(e.slice(1),s):void 0;if(u)return u;if(t.validators.length===0)return;const f=e.join(cR);return(m=t.validators.find(({validator:i})=>i(f)))==null?void 0:m.classGroupId},ez=/^\[(.+)\]$/,ste=e=>{if(ez.test(e)){const t=ez.exec(e)[1],r=t==null?void 0:t.substring(0,t.indexOf(":"));if(r)return"arbitrary.."+r}},ate=e=>{const{theme:t,prefix:r}=e,s={nextPart:new Map,validators:[]};return lte(Object.entries(e.classGroups),r).forEach(([f,m])=>{Qk(m,s,f,t)}),s},Qk=(e,t,r,s)=>{e.forEach(u=>{if(typeof u=="string"){const f=u===""?t:tz(t,u);f.classGroupId=r;return}if(typeof u=="function"){if(ote(u)){Qk(u(s),t,r,s);return}t.validators.push({validator:u,classGroupId:r});return}Object.entries(u).forEach(([f,m])=>{Qk(m,tz(t,f),r,s)})})},tz=(e,t)=>{let r=e;return t.split(cR).forEach(s=>{r.nextPart.has(s)||r.nextPart.set(s,{nextPart:new Map,validators:[]}),r=r.nextPart.get(s)}),r},ote=e=>e.isThemeGetter,lte=(e,t)=>t?e.map(([r,s])=>{const u=s.map(f=>typeof f=="string"?t+f:typeof f=="object"?Object.fromEntries(Object.entries(f).map(([m,i])=>[t+m,i])):f);return[r,u]}):e,cte=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,r=new Map,s=new Map;const u=(f,m)=>{r.set(f,m),t++,t>e&&(t=0,s=r,r=new Map)};return{get(f){let m=r.get(f);if(m!==void 0)return m;if((m=s.get(f))!==void 0)return u(f,m),m},set(f,m){r.has(f)?r.set(f,m):u(f,m)}}},l8="!",ute=e=>{const{separator:t,experimentalParseClassName:r}=e,s=t.length===1,u=t[0],f=t.length,m=i=>{const S=[];let E=0,I=0,D;for(let U=0;U<i.length;U++){let Y=i[U];if(E===0){if(Y===u&&(s||i.slice(U,U+f)===t)){S.push(i.slice(I,U)),I=U+f;continue}if(Y==="/"){D=U;continue}}Y==="["?E++:Y==="]"&&E--}const M=S.length===0?i:i.substring(I),R=M.startsWith(l8),H=R?M.substring(1):M,F=D&&D>I?D-I:void 0;return{modifiers:S,hasImportantModifier:R,baseClassName:H,maybePostfixModifierPosition:F}};return r?i=>r({className:i,parseClassName:m}):m},dte=e=>{if(e.length<=1)return e;const t=[];let r=[];return e.forEach(s=>{s[0]==="["?(t.push(...r.sort(),s),r=[]):r.push(s)}),t.push(...r.sort()),t},hte=e=>({cache:cte(e.cacheSize),parseClassName:ute(e),...ite(e)}),fte=/\s+/,pte=(e,t)=>{const{parseClassName:r,getClassGroupId:s,getConflictingClassGroupIds:u}=t,f=[],m=e.trim().split(fte);let i="";for(let S=m.length-1;S>=0;S-=1){const E=m[S],{modifiers:I,hasImportantModifier:D,baseClassName:M,maybePostfixModifierPosition:R}=r(E);let H=!!R,F=s(H?M.substring(0,R):M);if(!F){if(!H){i=E+(i.length>0?" "+i:i);continue}if(F=s(M),!F){i=E+(i.length>0?" "+i:i);continue}H=!1}const U=dte(I).join(":"),Y=D?U+l8:U,z=Y+F;if(f.includes(z))continue;f.push(z);const J=u(F,H);for(let ne=0;ne<J.length;++ne){const me=J[ne];f.push(Y+me)}i=E+(i.length>0?" "+i:i)}return i};function mte(){let e=0,t,r,s="";for(;e<arguments.length;)(t=arguments[e++])&&(r=c8(t))&&(s&&(s+=" "),s+=r);return s}const c8=e=>{if(typeof e=="string")return e;let t,r="";for(let s=0;s<e.length;s++)e[s]&&(t=c8(e[s]))&&(r&&(r+=" "),r+=t);return r};function gte(e,...t){let r,s,u,f=m;function m(S){const E=t.reduce((I,D)=>D(I),e());return r=hte(E),s=r.cache.get,u=r.cache.set,f=i,i(S)}function i(S){const E=s(S);if(E)return E;const I=pte(S,r);return u(S,I),I}return function(){return f(mte.apply(null,arguments))}}const Oa=e=>{const t=r=>r[e]||[];return t.isThemeGetter=!0,t},u8=/^\[(?:([a-z-]+):)?(.+)\]$/i,_te=/^\d+\/\d+$/,xte=new Set(["px","full","screen"]),vte=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,yte=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,wte=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,bte=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Ste=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Vh=e=>Wx(e)||xte.has(e)||_te.test(e),yp=e=>zv(e,"length",kte),Wx=e=>!!e&&!Number.isNaN(Number(e)),uN=e=>zv(e,"number",Wx),aw=e=>!!e&&Number.isInteger(Number(e)),Tte=e=>e.endsWith("%")&&Wx(e.slice(0,-1)),os=e=>u8.test(e),wp=e=>vte.test(e),Ete=new Set(["length","size","percentage"]),Cte=e=>zv(e,Ete,d8),Ate=e=>zv(e,"position",d8),jte=new Set(["image","url"]),Ite=e=>zv(e,jte,Dte),Nte=e=>zv(e,"",Pte),ow=()=>!0,zv=(e,t,r)=>{const s=u8.exec(e);return s?s[1]?typeof t=="string"?s[1]===t:t.has(s[1]):r(s[2]):!1},kte=e=>yte.test(e)&&!wte.test(e),d8=()=>!1,Pte=e=>bte.test(e),Dte=e=>Ste.test(e),Rte=()=>{const e=Oa("colors"),t=Oa("spacing"),r=Oa("blur"),s=Oa("brightness"),u=Oa("borderColor"),f=Oa("borderRadius"),m=Oa("borderSpacing"),i=Oa("borderWidth"),S=Oa("contrast"),E=Oa("grayscale"),I=Oa("hueRotate"),D=Oa("invert"),M=Oa("gap"),R=Oa("gradientColorStops"),H=Oa("gradientColorStopPositions"),F=Oa("inset"),U=Oa("margin"),Y=Oa("opacity"),z=Oa("padding"),J=Oa("saturate"),ne=Oa("scale"),me=Oa("sepia"),le=Oa("skew"),ye=Oa("space"),pe=Oa("translate"),be=()=>["auto","contain","none"],ke=()=>["auto","hidden","clip","visible","scroll"],Oe=()=>["auto",os,t],Ee=()=>[os,t],qe=()=>["",Vh,yp],Qe=()=>["auto",Wx,os],gt=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Xe=()=>["solid","dashed","dotted","double","none"],ct=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Me=()=>["start","end","center","between","around","evenly","stretch"],mt=()=>["","0",os],Kt=()=>["auto","avoid","all","avoid-page","page","left","right","column"],it=()=>[Wx,os];return{cacheSize:500,separator:":",theme:{colors:[ow],spacing:[Vh,yp],blur:["none","",wp,os],brightness:it(),borderColor:[e],borderRadius:["none","","full",wp,os],borderSpacing:Ee(),borderWidth:qe(),contrast:it(),grayscale:mt(),hueRotate:it(),invert:mt(),gap:Ee(),gradientColorStops:[e],gradientColorStopPositions:[Tte,yp],inset:Oe(),margin:Oe(),opacity:it(),padding:Ee(),saturate:it(),scale:it(),sepia:mt(),skew:it(),space:Ee(),translate:Ee()},classGroups:{aspect:[{aspect:["auto","square","video",os]}],container:["container"],columns:[{columns:[wp]}],"break-after":[{"break-after":Kt()}],"break-before":[{"break-before":Kt()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...gt(),os]}],overflow:[{overflow:ke()}],"overflow-x":[{"overflow-x":ke()}],"overflow-y":[{"overflow-y":ke()}],overscroll:[{overscroll:be()}],"overscroll-x":[{"overscroll-x":be()}],"overscroll-y":[{"overscroll-y":be()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[F]}],"inset-x":[{"inset-x":[F]}],"inset-y":[{"inset-y":[F]}],start:[{start:[F]}],end:[{end:[F]}],top:[{top:[F]}],right:[{right:[F]}],bottom:[{bottom:[F]}],left:[{left:[F]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",aw,os]}],basis:[{basis:Oe()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",os]}],grow:[{grow:mt()}],shrink:[{shrink:mt()}],order:[{order:["first","last","none",aw,os]}],"grid-cols":[{"grid-cols":[ow]}],"col-start-end":[{col:["auto",{span:["full",aw,os]},os]}],"col-start":[{"col-start":Qe()}],"col-end":[{"col-end":Qe()}],"grid-rows":[{"grid-rows":[ow]}],"row-start-end":[{row:["auto",{span:[aw,os]},os]}],"row-start":[{"row-start":Qe()}],"row-end":[{"row-end":Qe()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",os]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",os]}],gap:[{gap:[M]}],"gap-x":[{"gap-x":[M]}],"gap-y":[{"gap-y":[M]}],"justify-content":[{justify:["normal",...Me()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Me(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Me(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[z]}],px:[{px:[z]}],py:[{py:[z]}],ps:[{ps:[z]}],pe:[{pe:[z]}],pt:[{pt:[z]}],pr:[{pr:[z]}],pb:[{pb:[z]}],pl:[{pl:[z]}],m:[{m:[U]}],mx:[{mx:[U]}],my:[{my:[U]}],ms:[{ms:[U]}],me:[{me:[U]}],mt:[{mt:[U]}],mr:[{mr:[U]}],mb:[{mb:[U]}],ml:[{ml:[U]}],"space-x":[{"space-x":[ye]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[ye]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",os,t]}],"min-w":[{"min-w":[os,t,"min","max","fit"]}],"max-w":[{"max-w":[os,t,"none","full","min","max","fit","prose",{screen:[wp]},wp]}],h:[{h:[os,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[os,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[os,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[os,t,"auto","min","max","fit"]}],"font-size":[{text:["base",wp,yp]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",uN]}],"font-family":[{font:[ow]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",os]}],"line-clamp":[{"line-clamp":["none",Wx,uN]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Vh,os]}],"list-image":[{"list-image":["none",os]}],"list-style-type":[{list:["none","disc","decimal",os]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[Y]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[Y]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Xe(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Vh,yp]}],"underline-offset":[{"underline-offset":["auto",Vh,os]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Ee()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",os]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",os]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[Y]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...gt(),Ate]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Cte]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Ite]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[H]}],"gradient-via-pos":[{via:[H]}],"gradient-to-pos":[{to:[H]}],"gradient-from":[{from:[R]}],"gradient-via":[{via:[R]}],"gradient-to":[{to:[R]}],rounded:[{rounded:[f]}],"rounded-s":[{"rounded-s":[f]}],"rounded-e":[{"rounded-e":[f]}],"rounded-t":[{"rounded-t":[f]}],"rounded-r":[{"rounded-r":[f]}],"rounded-b":[{"rounded-b":[f]}],"rounded-l":[{"rounded-l":[f]}],"rounded-ss":[{"rounded-ss":[f]}],"rounded-se":[{"rounded-se":[f]}],"rounded-ee":[{"rounded-ee":[f]}],"rounded-es":[{"rounded-es":[f]}],"rounded-tl":[{"rounded-tl":[f]}],"rounded-tr":[{"rounded-tr":[f]}],"rounded-br":[{"rounded-br":[f]}],"rounded-bl":[{"rounded-bl":[f]}],"border-w":[{border:[i]}],"border-w-x":[{"border-x":[i]}],"border-w-y":[{"border-y":[i]}],"border-w-s":[{"border-s":[i]}],"border-w-e":[{"border-e":[i]}],"border-w-t":[{"border-t":[i]}],"border-w-r":[{"border-r":[i]}],"border-w-b":[{"border-b":[i]}],"border-w-l":[{"border-l":[i]}],"border-opacity":[{"border-opacity":[Y]}],"border-style":[{border:[...Xe(),"hidden"]}],"divide-x":[{"divide-x":[i]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[i]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[Y]}],"divide-style":[{divide:Xe()}],"border-color":[{border:[u]}],"border-color-x":[{"border-x":[u]}],"border-color-y":[{"border-y":[u]}],"border-color-s":[{"border-s":[u]}],"border-color-e":[{"border-e":[u]}],"border-color-t":[{"border-t":[u]}],"border-color-r":[{"border-r":[u]}],"border-color-b":[{"border-b":[u]}],"border-color-l":[{"border-l":[u]}],"divide-color":[{divide:[u]}],"outline-style":[{outline:["",...Xe()]}],"outline-offset":[{"outline-offset":[Vh,os]}],"outline-w":[{outline:[Vh,yp]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:qe()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[Y]}],"ring-offset-w":[{"ring-offset":[Vh,yp]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",wp,Nte]}],"shadow-color":[{shadow:[ow]}],opacity:[{opacity:[Y]}],"mix-blend":[{"mix-blend":[...ct(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":ct()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[s]}],contrast:[{contrast:[S]}],"drop-shadow":[{"drop-shadow":["","none",wp,os]}],grayscale:[{grayscale:[E]}],"hue-rotate":[{"hue-rotate":[I]}],invert:[{invert:[D]}],saturate:[{saturate:[J]}],sepia:[{sepia:[me]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[s]}],"backdrop-contrast":[{"backdrop-contrast":[S]}],"backdrop-grayscale":[{"backdrop-grayscale":[E]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[I]}],"backdrop-invert":[{"backdrop-invert":[D]}],"backdrop-opacity":[{"backdrop-opacity":[Y]}],"backdrop-saturate":[{"backdrop-saturate":[J]}],"backdrop-sepia":[{"backdrop-sepia":[me]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[m]}],"border-spacing-x":[{"border-spacing-x":[m]}],"border-spacing-y":[{"border-spacing-y":[m]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",os]}],duration:[{duration:it()}],ease:[{ease:["linear","in","out","in-out",os]}],delay:[{delay:it()}],animate:[{animate:["none","spin","ping","pulse","bounce",os]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[ne]}],"scale-x":[{"scale-x":[ne]}],"scale-y":[{"scale-y":[ne]}],rotate:[{rotate:[aw,os]}],"translate-x":[{"translate-x":[pe]}],"translate-y":[{"translate-y":[pe]}],"skew-x":[{"skew-x":[le]}],"skew-y":[{"skew-y":[le]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",os]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",os]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Ee()}],"scroll-mx":[{"scroll-mx":Ee()}],"scroll-my":[{"scroll-my":Ee()}],"scroll-ms":[{"scroll-ms":Ee()}],"scroll-me":[{"scroll-me":Ee()}],"scroll-mt":[{"scroll-mt":Ee()}],"scroll-mr":[{"scroll-mr":Ee()}],"scroll-mb":[{"scroll-mb":Ee()}],"scroll-ml":[{"scroll-ml":Ee()}],"scroll-p":[{"scroll-p":Ee()}],"scroll-px":[{"scroll-px":Ee()}],"scroll-py":[{"scroll-py":Ee()}],"scroll-ps":[{"scroll-ps":Ee()}],"scroll-pe":[{"scroll-pe":Ee()}],"scroll-pt":[{"scroll-pt":Ee()}],"scroll-pr":[{"scroll-pr":Ee()}],"scroll-pb":[{"scroll-pb":Ee()}],"scroll-pl":[{"scroll-pl":Ee()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",os]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[Vh,yp,uN]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Mte=gte(Rte);function sn(...e){return Mte(JV(e))}const Ote=Aee,h8=V.forwardRef(({className:e,...t},r)=>c.jsx(GV,{ref:r,className:sn("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t}));h8.displayName=GV.displayName;const Fte=Fv("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),f8=V.forwardRef(({className:e,variant:t,...r},s)=>c.jsx(WV,{ref:s,className:sn(Fte({variant:t}),e),...r}));f8.displayName=WV.displayName;const Lte=V.forwardRef(({className:e,...t},r)=>c.jsx(XV,{ref:r,className:sn("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",e),...t}));Lte.displayName=XV.displayName;const p8=V.forwardRef(({className:e,...t},r)=>c.jsx(YV,{ref:r,className:sn("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...t,children:c.jsx(lR,{className:"h-4 w-4"})}));p8.displayName=YV.displayName;const m8=V.forwardRef(({className:e,...t},r)=>c.jsx(HV,{ref:r,className:sn("text-sm font-semibold",e),...t}));m8.displayName=HV.displayName;const g8=V.forwardRef(({className:e,...t},r)=>c.jsx(ZV,{ref:r,className:sn("text-sm opacity-90",e),...t}));g8.displayName=ZV.displayName;function zte(){const{toasts:e}=wm();return c.jsxs(Ote,{children:[e.map(function({id:t,title:r,description:s,action:u,...f}){return c.jsxs(f8,{...f,children:[c.jsxs("div",{className:"grid gap-1",children:[r&&c.jsx(m8,{children:r}),s&&c.jsx(g8,{children:s})]}),u,c.jsx(p8,{})]},t)}),c.jsx(h8,{})]})}var rz=["light","dark"],Bte="(prefers-color-scheme: dark)",Ute=V.createContext(void 0),Vte={setTheme:e=>{},themes:[]},$te=()=>{var e;return(e=V.useContext(Ute))!=null?e:Vte};V.memo(({forcedTheme:e,storageKey:t,attribute:r,enableSystem:s,enableColorScheme:u,defaultTheme:f,value:m,attrs:i,nonce:S})=>{let E=f==="system",I=r==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${i.map(H=>`'${H}'`).join(",")})`};`:`var d=document.documentElement,n='${r}',s='setAttribute';`,D=u?rz.includes(f)&&f?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${f}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",M=(H,F=!1,U=!0)=>{let Y=m?m[H]:H,z=F?H+"|| ''":`'${Y}'`,J="";return u&&U&&!F&&rz.includes(H)&&(J+=`d.style.colorScheme = '${H}';`),r==="class"?F||Y?J+=`c.add(${z})`:J+="null":Y&&(J+=`d[s](n,${z})`),J},R=e?`!function(){${I}${M(e)}}()`:s?`!function(){try{${I}var e=localStorage.getItem('${t}');if('system'===e||(!e&&${E})){var t='${Bte}',m=window.matchMedia(t);if(m.media!==t||m.matches){${M("dark")}}else{${M("light")}}}else if(e){${m?`var x=${JSON.stringify(m)};`:""}${M(m?"x[e]":"e",!0)}}${E?"":"else{"+M(f,!1,!1)+"}"}${D}}catch(e){}}()`:`!function(){try{${I}var e=localStorage.getItem('${t}');if(e){${m?`var x=${JSON.stringify(m)};`:""}${M(m?"x[e]":"e",!0)}}else{${M(f,!1,!1)};}${D}}catch(t){}}();`;return V.createElement("script",{nonce:S,dangerouslySetInnerHTML:{__html:R}})});var qte=e=>{switch(e){case"success":return Hte;case"info":return Xte;case"warning":return Zte;case"error":return Yte;default:return null}},Gte=Array(12).fill(0),Wte=({visible:e,className:t})=>Cr.createElement("div",{className:["sonner-loading-wrapper",t].filter(Boolean).join(" "),"data-visible":e},Cr.createElement("div",{className:"sonner-spinner"},Gte.map((r,s)=>Cr.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${s}`})))),Hte=Cr.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Cr.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),Zte=Cr.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},Cr.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),Xte=Cr.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Cr.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),Yte=Cr.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Cr.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),Kte=Cr.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},Cr.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),Cr.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),Jte=()=>{let[e,t]=Cr.useState(document.hidden);return Cr.useEffect(()=>{let r=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",r),()=>window.removeEventListener("visibilitychange",r)},[]),e},eP=1,Qte=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let t=this.subscribers.indexOf(e);this.subscribers.splice(t,1)}),this.publish=e=>{this.subscribers.forEach(t=>t(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var t;let{message:r,...s}=e,u=typeof(e==null?void 0:e.id)=="number"||((t=e.id)==null?void 0:t.length)>0?e.id:eP++,f=this.toasts.find(i=>i.id===u),m=e.dismissible===void 0?!0:e.dismissible;return this.dismissedToasts.has(u)&&this.dismissedToasts.delete(u),f?this.toasts=this.toasts.map(i=>i.id===u?(this.publish({...i,...e,id:u,title:r}),{...i,...e,id:u,dismissible:m,title:r}):i):this.addToast({title:r,...s,dismissible:m,id:u}),u},this.dismiss=e=>(this.dismissedToasts.add(e),e||this.toasts.forEach(t=>{this.subscribers.forEach(r=>r({id:t.id,dismiss:!0}))}),this.subscribers.forEach(t=>t({id:e,dismiss:!0})),e),this.message=(e,t)=>this.create({...t,message:e}),this.error=(e,t)=>this.create({...t,message:e,type:"error"}),this.success=(e,t)=>this.create({...t,type:"success",message:e}),this.info=(e,t)=>this.create({...t,type:"info",message:e}),this.warning=(e,t)=>this.create({...t,type:"warning",message:e}),this.loading=(e,t)=>this.create({...t,type:"loading",message:e}),this.promise=(e,t)=>{if(!t)return;let r;t.loading!==void 0&&(r=this.create({...t,promise:e,type:"loading",message:t.loading,description:typeof t.description!="function"?t.description:void 0}));let s=e instanceof Promise?e:e(),u=r!==void 0,f,m=s.then(async S=>{if(f=["resolve",S],Cr.isValidElement(S))u=!1,this.create({id:r,type:"default",message:S});else if(tre(S)&&!S.ok){u=!1;let E=typeof t.error=="function"?await t.error(`HTTP error! status: ${S.status}`):t.error,I=typeof t.description=="function"?await t.description(`HTTP error! status: ${S.status}`):t.description;this.create({id:r,type:"error",message:E,description:I})}else if(t.success!==void 0){u=!1;let E=typeof t.success=="function"?await t.success(S):t.success,I=typeof t.description=="function"?await t.description(S):t.description;this.create({id:r,type:"success",message:E,description:I})}}).catch(async S=>{if(f=["reject",S],t.error!==void 0){u=!1;let E=typeof t.error=="function"?await t.error(S):t.error,I=typeof t.description=="function"?await t.description(S):t.description;this.create({id:r,type:"error",message:E,description:I})}}).finally(()=>{var S;u&&(this.dismiss(r),r=void 0),(S=t.finally)==null||S.call(t)}),i=()=>new Promise((S,E)=>m.then(()=>f[0]==="reject"?E(f[1]):S(f[1])).catch(E));return typeof r!="string"&&typeof r!="number"?{unwrap:i}:Object.assign(r,{unwrap:i})},this.custom=(e,t)=>{let r=(t==null?void 0:t.id)||eP++;return this.create({jsx:e(r),id:r,...t}),r},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},vc=new Qte,ere=(e,t)=>{let r=(t==null?void 0:t.id)||eP++;return vc.addToast({title:e,...t,id:r}),r},tre=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",rre=ere,nre=()=>vc.toasts,ire=()=>vc.getActiveToasts(),$t=Object.assign(rre,{success:vc.success,info:vc.info,warning:vc.warning,error:vc.error,custom:vc.custom,message:vc.message,promise:vc.promise,dismiss:vc.dismiss,loading:vc.loading},{getHistory:nre,getToasts:ire});function sre(e,{insertAt:t}={}){if(typeof document>"u")return;let r=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",t==="top"&&r.firstChild?r.insertBefore(s,r.firstChild):r.appendChild(s),s.styleSheet?s.styleSheet.cssText=e:s.appendChild(document.createTextNode(e))}sre(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function _T(e){return e.label!==void 0}var are=3,ore="32px",lre="16px",nz=4e3,cre=356,ure=14,dre=20,hre=200;function ed(...e){return e.filter(Boolean).join(" ")}function fre(e){let[t,r]=e.split("-"),s=[];return t&&s.push(t),r&&s.push(r),s}var pre=e=>{var t,r,s,u,f,m,i,S,E,I,D;let{invert:M,toast:R,unstyled:H,interacting:F,setHeights:U,visibleToasts:Y,heights:z,index:J,toasts:ne,expanded:me,removeToast:le,defaultRichColors:ye,closeButton:pe,style:be,cancelButtonStyle:ke,actionButtonStyle:Oe,className:Ee="",descriptionClassName:qe="",duration:Qe,position:gt,gap:Xe,loadingIcon:ct,expandByDefault:Me,classNames:mt,icons:Kt,closeButtonAriaLabel:it="Close toast",pauseWhenPageIsHidden:ee}=e,[he,Se]=Cr.useState(null),[Ue,nt]=Cr.useState(null),[dt,Vt]=Cr.useState(!1),[zt,Gt]=Cr.useState(!1),[jr,Wr]=Cr.useState(!1),[nn,xn]=Cr.useState(!1),[ei,Dn]=Cr.useState(!1),[Zr,Nn]=Cr.useState(0),[Pi,ft]=Cr.useState(0),Rt=Cr.useRef(R.duration||Qe||nz),Wt=Cr.useRef(null),Pr=Cr.useRef(null),Sr=J===0,Nr=J+1<=Y,Kr=R.type,Zn=R.dismissible!==!1,Yn=R.className||"",Zt=R.descriptionClassName||"",en=Cr.useMemo(()=>z.findIndex(Hr=>Hr.toastId===R.id)||0,[z,R.id]),Sn=Cr.useMemo(()=>{var Hr;return(Hr=R.closeButton)!=null?Hr:pe},[R.closeButton,pe]),fs=Cr.useMemo(()=>R.duration||Qe||nz,[R.duration,Qe]),ms=Cr.useRef(0),hr=Cr.useRef(0),An=Cr.useRef(0),fi=Cr.useRef(null),[Vi,$n]=gt.split("-"),vi=Cr.useMemo(()=>z.reduce((Hr,hn,vn)=>vn>=en?Hr:Hr+hn.height,0),[z,en]),ii=Jte(),Ds=R.invert||M,Ua=Kr==="loading";hr.current=Cr.useMemo(()=>en*Xe+vi,[en,vi]),Cr.useEffect(()=>{Rt.current=fs},[fs]),Cr.useEffect(()=>{Vt(!0)},[]),Cr.useEffect(()=>{let Hr=Pr.current;if(Hr){let hn=Hr.getBoundingClientRect().height;return ft(hn),U(vn=>[{toastId:R.id,height:hn,position:R.position},...vn]),()=>U(vn=>vn.filter(ai=>ai.toastId!==R.id))}},[U,R.id]),Cr.useLayoutEffect(()=>{if(!dt)return;let Hr=Pr.current,hn=Hr.style.height;Hr.style.height="auto";let vn=Hr.getBoundingClientRect().height;Hr.style.height=hn,ft(vn),U(ai=>ai.find(At=>At.toastId===R.id)?ai.map(At=>At.toastId===R.id?{...At,height:vn}:At):[{toastId:R.id,height:vn,position:R.position},...ai])},[dt,R.title,R.description,U,R.id]);let Us=Cr.useCallback(()=>{Gt(!0),Nn(hr.current),U(Hr=>Hr.filter(hn=>hn.toastId!==R.id)),setTimeout(()=>{le(R)},hre)},[R,le,U,hr]);Cr.useEffect(()=>{if(R.promise&&Kr==="loading"||R.duration===1/0||R.type==="loading")return;let Hr;return me||F||ee&&ii?(()=>{if(An.current<ms.current){let hn=new Date().getTime()-ms.current;Rt.current=Rt.current-hn}An.current=new Date().getTime()})():Rt.current!==1/0&&(ms.current=new Date().getTime(),Hr=setTimeout(()=>{var hn;(hn=R.onAutoClose)==null||hn.call(R,R),Us()},Rt.current)),()=>clearTimeout(Hr)},[me,F,R,Kr,ee,ii,Us]),Cr.useEffect(()=>{R.delete&&Us()},[Us,R.delete]);function Ot(){var Hr,hn,vn;return Kt!=null&&Kt.loading?Cr.createElement("div",{className:ed(mt==null?void 0:mt.loader,(Hr=R==null?void 0:R.classNames)==null?void 0:Hr.loader,"sonner-loader"),"data-visible":Kr==="loading"},Kt.loading):ct?Cr.createElement("div",{className:ed(mt==null?void 0:mt.loader,(hn=R==null?void 0:R.classNames)==null?void 0:hn.loader,"sonner-loader"),"data-visible":Kr==="loading"},ct):Cr.createElement(Wte,{className:ed(mt==null?void 0:mt.loader,(vn=R==null?void 0:R.classNames)==null?void 0:vn.loader),visible:Kr==="loading"})}return Cr.createElement("li",{tabIndex:0,ref:Pr,className:ed(Ee,Yn,mt==null?void 0:mt.toast,(t=R==null?void 0:R.classNames)==null?void 0:t.toast,mt==null?void 0:mt.default,mt==null?void 0:mt[Kr],(r=R==null?void 0:R.classNames)==null?void 0:r[Kr]),"data-sonner-toast":"","data-rich-colors":(s=R.richColors)!=null?s:ye,"data-styled":!(R.jsx||R.unstyled||H),"data-mounted":dt,"data-promise":!!R.promise,"data-swiped":ei,"data-removed":zt,"data-visible":Nr,"data-y-position":Vi,"data-x-position":$n,"data-index":J,"data-front":Sr,"data-swiping":jr,"data-dismissible":Zn,"data-type":Kr,"data-invert":Ds,"data-swipe-out":nn,"data-swipe-direction":Ue,"data-expanded":!!(me||Me&&dt),style:{"--index":J,"--toasts-before":J,"--z-index":ne.length-J,"--offset":`${zt?Zr:hr.current}px`,"--initial-height":Me?"auto":`${Pi}px`,...be,...R.style},onDragEnd:()=>{Wr(!1),Se(null),fi.current=null},onPointerDown:Hr=>{Ua||!Zn||(Wt.current=new Date,Nn(hr.current),Hr.target.setPointerCapture(Hr.pointerId),Hr.target.tagName!=="BUTTON"&&(Wr(!0),fi.current={x:Hr.clientX,y:Hr.clientY}))},onPointerUp:()=>{var Hr,hn,vn,ai;if(nn||!Zn)return;fi.current=null;let At=Number(((Hr=Pr.current)==null?void 0:Hr.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),$i=Number(((hn=Pr.current)==null?void 0:hn.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),ha=new Date().getTime()-((vn=Wt.current)==null?void 0:vn.getTime()),pt=he==="x"?At:$i,lt=Math.abs(pt)/ha;if(Math.abs(pt)>=dre||lt>.11){Nn(hr.current),(ai=R.onDismiss)==null||ai.call(R,R),nt(he==="x"?At>0?"right":"left":$i>0?"down":"up"),Us(),xn(!0),Dn(!1);return}Wr(!1),Se(null)},onPointerMove:Hr=>{var hn,vn,ai,At;if(!fi.current||!Zn||((hn=window.getSelection())==null?void 0:hn.toString().length)>0)return;let $i=Hr.clientY-fi.current.y,ha=Hr.clientX-fi.current.x,pt=(vn=e.swipeDirections)!=null?vn:fre(gt);!he&&(Math.abs(ha)>1||Math.abs($i)>1)&&Se(Math.abs(ha)>Math.abs($i)?"x":"y");let lt={x:0,y:0};he==="y"?(pt.includes("top")||pt.includes("bottom"))&&(pt.includes("top")&&$i<0||pt.includes("bottom")&&$i>0)&&(lt.y=$i):he==="x"&&(pt.includes("left")||pt.includes("right"))&&(pt.includes("left")&&ha<0||pt.includes("right")&&ha>0)&&(lt.x=ha),(Math.abs(lt.x)>0||Math.abs(lt.y)>0)&&Dn(!0),(ai=Pr.current)==null||ai.style.setProperty("--swipe-amount-x",`${lt.x}px`),(At=Pr.current)==null||At.style.setProperty("--swipe-amount-y",`${lt.y}px`)}},Sn&&!R.jsx?Cr.createElement("button",{"aria-label":it,"data-disabled":Ua,"data-close-button":!0,onClick:Ua||!Zn?()=>{}:()=>{var Hr;Us(),(Hr=R.onDismiss)==null||Hr.call(R,R)},className:ed(mt==null?void 0:mt.closeButton,(u=R==null?void 0:R.classNames)==null?void 0:u.closeButton)},(f=Kt==null?void 0:Kt.close)!=null?f:Kte):null,R.jsx||V.isValidElement(R.title)?R.jsx?R.jsx:typeof R.title=="function"?R.title():R.title:Cr.createElement(Cr.Fragment,null,Kr||R.icon||R.promise?Cr.createElement("div",{"data-icon":"",className:ed(mt==null?void 0:mt.icon,(m=R==null?void 0:R.classNames)==null?void 0:m.icon)},R.promise||R.type==="loading"&&!R.icon?R.icon||Ot():null,R.type!=="loading"?R.icon||(Kt==null?void 0:Kt[Kr])||qte(Kr):null):null,Cr.createElement("div",{"data-content":"",className:ed(mt==null?void 0:mt.content,(i=R==null?void 0:R.classNames)==null?void 0:i.content)},Cr.createElement("div",{"data-title":"",className:ed(mt==null?void 0:mt.title,(S=R==null?void 0:R.classNames)==null?void 0:S.title)},typeof R.title=="function"?R.title():R.title),R.description?Cr.createElement("div",{"data-description":"",className:ed(qe,Zt,mt==null?void 0:mt.description,(E=R==null?void 0:R.classNames)==null?void 0:E.description)},typeof R.description=="function"?R.description():R.description):null),V.isValidElement(R.cancel)?R.cancel:R.cancel&&_T(R.cancel)?Cr.createElement("button",{"data-button":!0,"data-cancel":!0,style:R.cancelButtonStyle||ke,onClick:Hr=>{var hn,vn;_T(R.cancel)&&Zn&&((vn=(hn=R.cancel).onClick)==null||vn.call(hn,Hr),Us())},className:ed(mt==null?void 0:mt.cancelButton,(I=R==null?void 0:R.classNames)==null?void 0:I.cancelButton)},R.cancel.label):null,V.isValidElement(R.action)?R.action:R.action&&_T(R.action)?Cr.createElement("button",{"data-button":!0,"data-action":!0,style:R.actionButtonStyle||Oe,onClick:Hr=>{var hn,vn;_T(R.action)&&((vn=(hn=R.action).onClick)==null||vn.call(hn,Hr),!Hr.defaultPrevented&&Us())},className:ed(mt==null?void 0:mt.actionButton,(D=R==null?void 0:R.classNames)==null?void 0:D.actionButton)},R.action.label):null))};function iz(){if(typeof window>"u"||typeof document>"u")return"ltr";let e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}function mre(e,t){let r={};return[e,t].forEach((s,u)=>{let f=u===1,m=f?"--mobile-offset":"--offset",i=f?lre:ore;function S(E){["top","right","bottom","left"].forEach(I=>{r[`${m}-${I}`]=typeof E=="number"?`${E}px`:E})}typeof s=="number"||typeof s=="string"?S(s):typeof s=="object"?["top","right","bottom","left"].forEach(E=>{s[E]===void 0?r[`${m}-${E}`]=i:r[`${m}-${E}`]=typeof s[E]=="number"?`${s[E]}px`:s[E]}):S(i)}),r}var gre=V.forwardRef(function(e,t){let{invert:r,position:s="bottom-right",hotkey:u=["altKey","KeyT"],expand:f,closeButton:m,className:i,offset:S,mobileOffset:E,theme:I="light",richColors:D,duration:M,style:R,visibleToasts:H=are,toastOptions:F,dir:U=iz(),gap:Y=ure,loadingIcon:z,icons:J,containerAriaLabel:ne="Notifications",pauseWhenPageIsHidden:me}=e,[le,ye]=Cr.useState([]),pe=Cr.useMemo(()=>Array.from(new Set([s].concat(le.filter(ee=>ee.position).map(ee=>ee.position)))),[le,s]),[be,ke]=Cr.useState([]),[Oe,Ee]=Cr.useState(!1),[qe,Qe]=Cr.useState(!1),[gt,Xe]=Cr.useState(I!=="system"?I:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),ct=Cr.useRef(null),Me=u.join("+").replace(/Key/g,"").replace(/Digit/g,""),mt=Cr.useRef(null),Kt=Cr.useRef(!1),it=Cr.useCallback(ee=>{ye(he=>{var Se;return(Se=he.find(Ue=>Ue.id===ee.id))!=null&&Se.delete||vc.dismiss(ee.id),he.filter(({id:Ue})=>Ue!==ee.id)})},[]);return Cr.useEffect(()=>vc.subscribe(ee=>{if(ee.dismiss){ye(he=>he.map(Se=>Se.id===ee.id?{...Se,delete:!0}:Se));return}setTimeout(()=>{bV.flushSync(()=>{ye(he=>{let Se=he.findIndex(Ue=>Ue.id===ee.id);return Se!==-1?[...he.slice(0,Se),{...he[Se],...ee},...he.slice(Se+1)]:[ee,...he]})})})}),[]),Cr.useEffect(()=>{if(I!=="system"){Xe(I);return}if(I==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?Xe("dark"):Xe("light")),typeof window>"u")return;let ee=window.matchMedia("(prefers-color-scheme: dark)");try{ee.addEventListener("change",({matches:he})=>{Xe(he?"dark":"light")})}catch{ee.addListener(({matches:Se})=>{try{Xe(Se?"dark":"light")}catch(Ue){console.error(Ue)}})}},[I]),Cr.useEffect(()=>{le.length<=1&&Ee(!1)},[le]),Cr.useEffect(()=>{let ee=he=>{var Se,Ue;u.every(nt=>he[nt]||he.code===nt)&&(Ee(!0),(Se=ct.current)==null||Se.focus()),he.code==="Escape"&&(document.activeElement===ct.current||(Ue=ct.current)!=null&&Ue.contains(document.activeElement))&&Ee(!1)};return document.addEventListener("keydown",ee),()=>document.removeEventListener("keydown",ee)},[u]),Cr.useEffect(()=>{if(ct.current)return()=>{mt.current&&(mt.current.focus({preventScroll:!0}),mt.current=null,Kt.current=!1)}},[ct.current]),Cr.createElement("section",{ref:t,"aria-label":`${ne} ${Me}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},pe.map((ee,he)=>{var Se;let[Ue,nt]=ee.split("-");return le.length?Cr.createElement("ol",{key:ee,dir:U==="auto"?iz():U,tabIndex:-1,ref:ct,className:i,"data-sonner-toaster":!0,"data-theme":gt,"data-y-position":Ue,"data-lifted":Oe&&le.length>1&&!f,"data-x-position":nt,style:{"--front-toast-height":`${((Se=be[0])==null?void 0:Se.height)||0}px`,"--width":`${cre}px`,"--gap":`${Y}px`,...R,...mre(S,E)},onBlur:dt=>{Kt.current&&!dt.currentTarget.contains(dt.relatedTarget)&&(Kt.current=!1,mt.current&&(mt.current.focus({preventScroll:!0}),mt.current=null))},onFocus:dt=>{dt.target instanceof HTMLElement&&dt.target.dataset.dismissible==="false"||Kt.current||(Kt.current=!0,mt.current=dt.relatedTarget)},onMouseEnter:()=>Ee(!0),onMouseMove:()=>Ee(!0),onMouseLeave:()=>{qe||Ee(!1)},onDragEnd:()=>Ee(!1),onPointerDown:dt=>{dt.target instanceof HTMLElement&&dt.target.dataset.dismissible==="false"||Qe(!0)},onPointerUp:()=>Qe(!1)},le.filter(dt=>!dt.position&&he===0||dt.position===ee).map((dt,Vt)=>{var zt,Gt;return Cr.createElement(pre,{key:dt.id,icons:J,index:Vt,toast:dt,defaultRichColors:D,duration:(zt=F==null?void 0:F.duration)!=null?zt:M,className:F==null?void 0:F.className,descriptionClassName:F==null?void 0:F.descriptionClassName,invert:r,visibleToasts:H,closeButton:(Gt=F==null?void 0:F.closeButton)!=null?Gt:m,interacting:qe,position:ee,style:F==null?void 0:F.style,unstyled:F==null?void 0:F.unstyled,classNames:F==null?void 0:F.classNames,cancelButtonStyle:F==null?void 0:F.cancelButtonStyle,actionButtonStyle:F==null?void 0:F.actionButtonStyle,removeToast:it,toasts:le.filter(jr=>jr.position==dt.position),heights:be.filter(jr=>jr.position==dt.position),setHeights:ke,expandByDefault:f,gap:Y,loadingIcon:z,expanded:Oe,pauseWhenPageIsHidden:me,swipeDirections:e.swipeDirections})})):null}))});const _re=({...e})=>{const{theme:t="system"}=$te();return c.jsx(gre,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e})};var xre=uD[" useId ".trim().toString()]||(()=>{}),vre=0;function lf(e){const[t,r]=V.useState(xre());return fl(()=>{r(s=>s??String(vre++))},[e]),t?`radix-${t}`:""}const yre=["top","right","bottom","left"],dm=Math.min,$c=Math.max,LE=Math.round,xT=Math.floor,hh=e=>({x:e,y:e}),wre={left:"right",right:"left",bottom:"top",top:"bottom"},bre={start:"end",end:"start"};function tP(e,t,r){return $c(e,dm(t,r))}function _f(e,t){return typeof e=="function"?e(t):e}function xf(e){return e.split("-")[0]}function Bv(e){return e.split("-")[1]}function uR(e){return e==="x"?"y":"x"}function dR(e){return e==="y"?"height":"width"}const Sre=new Set(["top","bottom"]);function oh(e){return Sre.has(xf(e))?"y":"x"}function hR(e){return uR(oh(e))}function Tre(e,t,r){r===void 0&&(r=!1);const s=Bv(e),u=hR(e),f=dR(u);let m=u==="x"?s===(r?"end":"start")?"right":"left":s==="start"?"bottom":"top";return t.reference[f]>t.floating[f]&&(m=zE(m)),[m,zE(m)]}function Ere(e){const t=zE(e);return[rP(e),t,rP(t)]}function rP(e){return e.replace(/start|end/g,t=>bre[t])}const sz=["left","right"],az=["right","left"],Cre=["top","bottom"],Are=["bottom","top"];function jre(e,t,r){switch(e){case"top":case"bottom":return r?t?az:sz:t?sz:az;case"left":case"right":return t?Cre:Are;default:return[]}}function Ire(e,t,r,s){const u=Bv(e);let f=jre(xf(e),r==="start",s);return u&&(f=f.map(m=>m+"-"+u),t&&(f=f.concat(f.map(rP)))),f}function zE(e){return e.replace(/left|right|bottom|top/g,t=>wre[t])}function Nre(e){return{top:0,right:0,bottom:0,left:0,...e}}function _8(e){return typeof e!="number"?Nre(e):{top:e,right:e,bottom:e,left:e}}function BE(e){const{x:t,y:r,width:s,height:u}=e;return{width:s,height:u,top:r,left:t,right:t+s,bottom:r+u,x:t,y:r}}function oz(e,t,r){let{reference:s,floating:u}=e;const f=oh(t),m=hR(t),i=dR(m),S=xf(t),E=f==="y",I=s.x+s.width/2-u.width/2,D=s.y+s.height/2-u.height/2,M=s[i]/2-u[i]/2;let R;switch(S){case"top":R={x:I,y:s.y-u.height};break;case"bottom":R={x:I,y:s.y+s.height};break;case"right":R={x:s.x+s.width,y:D};break;case"left":R={x:s.x-u.width,y:D};break;default:R={x:s.x,y:s.y}}switch(Bv(t)){case"start":R[m]-=M*(r&&E?-1:1);break;case"end":R[m]+=M*(r&&E?-1:1);break}return R}const kre=async(e,t,r)=>{const{placement:s="bottom",strategy:u="absolute",middleware:f=[],platform:m}=r,i=f.filter(Boolean),S=await(m.isRTL==null?void 0:m.isRTL(t));let E=await m.getElementRects({reference:e,floating:t,strategy:u}),{x:I,y:D}=oz(E,s,S),M=s,R={},H=0;for(let F=0;F<i.length;F++){const{name:U,fn:Y}=i[F],{x:z,y:J,data:ne,reset:me}=await Y({x:I,y:D,initialPlacement:s,placement:M,strategy:u,middlewareData:R,rects:E,platform:m,elements:{reference:e,floating:t}});I=z??I,D=J??D,R={...R,[U]:{...R[U],...ne}},me&&H<=50&&(H++,typeof me=="object"&&(me.placement&&(M=me.placement),me.rects&&(E=me.rects===!0?await m.getElementRects({reference:e,floating:t,strategy:u}):me.rects),{x:I,y:D}=oz(E,M,S)),F=-1)}return{x:I,y:D,placement:M,strategy:u,middlewareData:R}};async function cb(e,t){var r;t===void 0&&(t={});const{x:s,y:u,platform:f,rects:m,elements:i,strategy:S}=e,{boundary:E="clippingAncestors",rootBoundary:I="viewport",elementContext:D="floating",altBoundary:M=!1,padding:R=0}=_f(t,e),H=_8(R),U=i[M?D==="floating"?"reference":"floating":D],Y=BE(await f.getClippingRect({element:(r=await(f.isElement==null?void 0:f.isElement(U)))==null||r?U:U.contextElement||await(f.getDocumentElement==null?void 0:f.getDocumentElement(i.floating)),boundary:E,rootBoundary:I,strategy:S})),z=D==="floating"?{x:s,y:u,width:m.floating.width,height:m.floating.height}:m.reference,J=await(f.getOffsetParent==null?void 0:f.getOffsetParent(i.floating)),ne=await(f.isElement==null?void 0:f.isElement(J))?await(f.getScale==null?void 0:f.getScale(J))||{x:1,y:1}:{x:1,y:1},me=BE(f.convertOffsetParentRelativeRectToViewportRelativeRect?await f.convertOffsetParentRelativeRectToViewportRelativeRect({elements:i,rect:z,offsetParent:J,strategy:S}):z);return{top:(Y.top-me.top+H.top)/ne.y,bottom:(me.bottom-Y.bottom+H.bottom)/ne.y,left:(Y.left-me.left+H.left)/ne.x,right:(me.right-Y.right+H.right)/ne.x}}const Pre=e=>({name:"arrow",options:e,async fn(t){const{x:r,y:s,placement:u,rects:f,platform:m,elements:i,middlewareData:S}=t,{element:E,padding:I=0}=_f(e,t)||{};if(E==null)return{};const D=_8(I),M={x:r,y:s},R=hR(u),H=dR(R),F=await m.getDimensions(E),U=R==="y",Y=U?"top":"left",z=U?"bottom":"right",J=U?"clientHeight":"clientWidth",ne=f.reference[H]+f.reference[R]-M[R]-f.floating[H],me=M[R]-f.reference[R],le=await(m.getOffsetParent==null?void 0:m.getOffsetParent(E));let ye=le?le[J]:0;(!ye||!await(m.isElement==null?void 0:m.isElement(le)))&&(ye=i.floating[J]||f.floating[H]);const pe=ne/2-me/2,be=ye/2-F[H]/2-1,ke=dm(D[Y],be),Oe=dm(D[z],be),Ee=ke,qe=ye-F[H]-Oe,Qe=ye/2-F[H]/2+pe,gt=tP(Ee,Qe,qe),Xe=!S.arrow&&Bv(u)!=null&&Qe!==gt&&f.reference[H]/2-(Qe<Ee?ke:Oe)-F[H]/2<0,ct=Xe?Qe<Ee?Qe-Ee:Qe-qe:0;return{[R]:M[R]+ct,data:{[R]:gt,centerOffset:Qe-gt-ct,...Xe&&{alignmentOffset:ct}},reset:Xe}}}),Dre=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var r,s;const{placement:u,middlewareData:f,rects:m,initialPlacement:i,platform:S,elements:E}=t,{mainAxis:I=!0,crossAxis:D=!0,fallbackPlacements:M,fallbackStrategy:R="bestFit",fallbackAxisSideDirection:H="none",flipAlignment:F=!0,...U}=_f(e,t);if((r=f.arrow)!=null&&r.alignmentOffset)return{};const Y=xf(u),z=oh(i),J=xf(i)===i,ne=await(S.isRTL==null?void 0:S.isRTL(E.floating)),me=M||(J||!F?[zE(i)]:Ere(i)),le=H!=="none";!M&&le&&me.push(...Ire(i,F,H,ne));const ye=[i,...me],pe=await cb(t,U),be=[];let ke=((s=f.flip)==null?void 0:s.overflows)||[];if(I&&be.push(pe[Y]),D){const Qe=Tre(u,m,ne);be.push(pe[Qe[0]],pe[Qe[1]])}if(ke=[...ke,{placement:u,overflows:be}],!be.every(Qe=>Qe<=0)){var Oe,Ee;const Qe=(((Oe=f.flip)==null?void 0:Oe.index)||0)+1,gt=ye[Qe];if(gt&&(!(D==="alignment"?z!==oh(gt):!1)||ke.every(Me=>Me.overflows[0]>0&&oh(Me.placement)===z)))return{data:{index:Qe,overflows:ke},reset:{placement:gt}};let Xe=(Ee=ke.filter(ct=>ct.overflows[0]<=0).sort((ct,Me)=>ct.overflows[1]-Me.overflows[1])[0])==null?void 0:Ee.placement;if(!Xe)switch(R){case"bestFit":{var qe;const ct=(qe=ke.filter(Me=>{if(le){const mt=oh(Me.placement);return mt===z||mt==="y"}return!0}).map(Me=>[Me.placement,Me.overflows.filter(mt=>mt>0).reduce((mt,Kt)=>mt+Kt,0)]).sort((Me,mt)=>Me[1]-mt[1])[0])==null?void 0:qe[0];ct&&(Xe=ct);break}case"initialPlacement":Xe=i;break}if(u!==Xe)return{reset:{placement:Xe}}}return{}}}};function lz(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function cz(e){return yre.some(t=>e[t]>=0)}const Rre=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:r}=t,{strategy:s="referenceHidden",...u}=_f(e,t);switch(s){case"referenceHidden":{const f=await cb(t,{...u,elementContext:"reference"}),m=lz(f,r.reference);return{data:{referenceHiddenOffsets:m,referenceHidden:cz(m)}}}case"escaped":{const f=await cb(t,{...u,altBoundary:!0}),m=lz(f,r.floating);return{data:{escapedOffsets:m,escaped:cz(m)}}}default:return{}}}}},x8=new Set(["left","top"]);async function Mre(e,t){const{placement:r,platform:s,elements:u}=e,f=await(s.isRTL==null?void 0:s.isRTL(u.floating)),m=xf(r),i=Bv(r),S=oh(r)==="y",E=x8.has(m)?-1:1,I=f&&S?-1:1,D=_f(t,e);let{mainAxis:M,crossAxis:R,alignmentAxis:H}=typeof D=="number"?{mainAxis:D,crossAxis:0,alignmentAxis:null}:{mainAxis:D.mainAxis||0,crossAxis:D.crossAxis||0,alignmentAxis:D.alignmentAxis};return i&&typeof H=="number"&&(R=i==="end"?H*-1:H),S?{x:R*I,y:M*E}:{x:M*E,y:R*I}}const Ore=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var r,s;const{x:u,y:f,placement:m,middlewareData:i}=t,S=await Mre(t,e);return m===((r=i.offset)==null?void 0:r.placement)&&(s=i.arrow)!=null&&s.alignmentOffset?{}:{x:u+S.x,y:f+S.y,data:{...S,placement:m}}}}},Fre=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:r,y:s,placement:u}=t,{mainAxis:f=!0,crossAxis:m=!1,limiter:i={fn:U=>{let{x:Y,y:z}=U;return{x:Y,y:z}}},...S}=_f(e,t),E={x:r,y:s},I=await cb(t,S),D=oh(xf(u)),M=uR(D);let R=E[M],H=E[D];if(f){const U=M==="y"?"top":"left",Y=M==="y"?"bottom":"right",z=R+I[U],J=R-I[Y];R=tP(z,R,J)}if(m){const U=D==="y"?"top":"left",Y=D==="y"?"bottom":"right",z=H+I[U],J=H-I[Y];H=tP(z,H,J)}const F=i.fn({...t,[M]:R,[D]:H});return{...F,data:{x:F.x-r,y:F.y-s,enabled:{[M]:f,[D]:m}}}}}},Lre=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:r,y:s,placement:u,rects:f,middlewareData:m}=t,{offset:i=0,mainAxis:S=!0,crossAxis:E=!0}=_f(e,t),I={x:r,y:s},D=oh(u),M=uR(D);let R=I[M],H=I[D];const F=_f(i,t),U=typeof F=="number"?{mainAxis:F,crossAxis:0}:{mainAxis:0,crossAxis:0,...F};if(S){const J=M==="y"?"height":"width",ne=f.reference[M]-f.floating[J]+U.mainAxis,me=f.reference[M]+f.reference[J]-U.mainAxis;R<ne?R=ne:R>me&&(R=me)}if(E){var Y,z;const J=M==="y"?"width":"height",ne=x8.has(xf(u)),me=f.reference[D]-f.floating[J]+(ne&&((Y=m.offset)==null?void 0:Y[D])||0)+(ne?0:U.crossAxis),le=f.reference[D]+f.reference[J]+(ne?0:((z=m.offset)==null?void 0:z[D])||0)-(ne?U.crossAxis:0);H<me?H=me:H>le&&(H=le)}return{[M]:R,[D]:H}}}},zre=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var r,s;const{placement:u,rects:f,platform:m,elements:i}=t,{apply:S=()=>{},...E}=_f(e,t),I=await cb(t,E),D=xf(u),M=Bv(u),R=oh(u)==="y",{width:H,height:F}=f.floating;let U,Y;D==="top"||D==="bottom"?(U=D,Y=M===(await(m.isRTL==null?void 0:m.isRTL(i.floating))?"start":"end")?"left":"right"):(Y=D,U=M==="end"?"top":"bottom");const z=F-I.top-I.bottom,J=H-I.left-I.right,ne=dm(F-I[U],z),me=dm(H-I[Y],J),le=!t.middlewareData.shift;let ye=ne,pe=me;if((r=t.middlewareData.shift)!=null&&r.enabled.x&&(pe=J),(s=t.middlewareData.shift)!=null&&s.enabled.y&&(ye=z),le&&!M){const ke=$c(I.left,0),Oe=$c(I.right,0),Ee=$c(I.top,0),qe=$c(I.bottom,0);R?pe=H-2*(ke!==0||Oe!==0?ke+Oe:$c(I.left,I.right)):ye=F-2*(Ee!==0||qe!==0?Ee+qe:$c(I.top,I.bottom))}await S({...t,availableWidth:pe,availableHeight:ye});const be=await m.getDimensions(i.floating);return H!==be.width||F!==be.height?{reset:{rects:!0}}:{}}}};function YC(){return typeof window<"u"}function Uv(e){return v8(e)?(e.nodeName||"").toLowerCase():"#document"}function Yc(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function vh(e){var t;return(t=(v8(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function v8(e){return YC()?e instanceof Node||e instanceof Yc(e).Node:!1}function Sd(e){return YC()?e instanceof Element||e instanceof Yc(e).Element:!1}function ph(e){return YC()?e instanceof HTMLElement||e instanceof Yc(e).HTMLElement:!1}function uz(e){return!YC()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof Yc(e).ShadowRoot}const Bre=new Set(["inline","contents"]);function Bb(e){const{overflow:t,overflowX:r,overflowY:s,display:u}=Td(e);return/auto|scroll|overlay|hidden|clip/.test(t+s+r)&&!Bre.has(u)}const Ure=new Set(["table","td","th"]);function Vre(e){return Ure.has(Uv(e))}const $re=[":popover-open",":modal"];function KC(e){return $re.some(t=>{try{return e.matches(t)}catch{return!1}})}const qre=["transform","translate","scale","rotate","perspective"],Gre=["transform","translate","scale","rotate","perspective","filter"],Wre=["paint","layout","strict","content"];function fR(e){const t=pR(),r=Sd(e)?Td(e):e;return qre.some(s=>r[s]?r[s]!=="none":!1)||(r.containerType?r.containerType!=="normal":!1)||!t&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!t&&(r.filter?r.filter!=="none":!1)||Gre.some(s=>(r.willChange||"").includes(s))||Wre.some(s=>(r.contain||"").includes(s))}function Hre(e){let t=hm(e);for(;ph(t)&&!Sv(t);){if(fR(t))return t;if(KC(t))return null;t=hm(t)}return null}function pR(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const Zre=new Set(["html","body","#document"]);function Sv(e){return Zre.has(Uv(e))}function Td(e){return Yc(e).getComputedStyle(e)}function JC(e){return Sd(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function hm(e){if(Uv(e)==="html")return e;const t=e.assignedSlot||e.parentNode||uz(e)&&e.host||vh(e);return uz(t)?t.host:t}function y8(e){const t=hm(e);return Sv(t)?e.ownerDocument?e.ownerDocument.body:e.body:ph(t)&&Bb(t)?t:y8(t)}function ub(e,t,r){var s;t===void 0&&(t=[]),r===void 0&&(r=!0);const u=y8(e),f=u===((s=e.ownerDocument)==null?void 0:s.body),m=Yc(u);if(f){const i=nP(m);return t.concat(m,m.visualViewport||[],Bb(u)?u:[],i&&r?ub(i):[])}return t.concat(u,ub(u,[],r))}function nP(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function w8(e){const t=Td(e);let r=parseFloat(t.width)||0,s=parseFloat(t.height)||0;const u=ph(e),f=u?e.offsetWidth:r,m=u?e.offsetHeight:s,i=LE(r)!==f||LE(s)!==m;return i&&(r=f,s=m),{width:r,height:s,$:i}}function mR(e){return Sd(e)?e:e.contextElement}function Hx(e){const t=mR(e);if(!ph(t))return hh(1);const r=t.getBoundingClientRect(),{width:s,height:u,$:f}=w8(t);let m=(f?LE(r.width):r.width)/s,i=(f?LE(r.height):r.height)/u;return(!m||!Number.isFinite(m))&&(m=1),(!i||!Number.isFinite(i))&&(i=1),{x:m,y:i}}const Xre=hh(0);function b8(e){const t=Yc(e);return!pR()||!t.visualViewport?Xre:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function Yre(e,t,r){return t===void 0&&(t=!1),!r||t&&r!==Yc(e)?!1:t}function p_(e,t,r,s){t===void 0&&(t=!1),r===void 0&&(r=!1);const u=e.getBoundingClientRect(),f=mR(e);let m=hh(1);t&&(s?Sd(s)&&(m=Hx(s)):m=Hx(e));const i=Yre(f,r,s)?b8(f):hh(0);let S=(u.left+i.x)/m.x,E=(u.top+i.y)/m.y,I=u.width/m.x,D=u.height/m.y;if(f){const M=Yc(f),R=s&&Sd(s)?Yc(s):s;let H=M,F=nP(H);for(;F&&s&&R!==H;){const U=Hx(F),Y=F.getBoundingClientRect(),z=Td(F),J=Y.left+(F.clientLeft+parseFloat(z.paddingLeft))*U.x,ne=Y.top+(F.clientTop+parseFloat(z.paddingTop))*U.y;S*=U.x,E*=U.y,I*=U.x,D*=U.y,S+=J,E+=ne,H=Yc(F),F=nP(H)}}return BE({width:I,height:D,x:S,y:E})}function gR(e,t){const r=JC(e).scrollLeft;return t?t.left+r:p_(vh(e)).left+r}function S8(e,t,r){r===void 0&&(r=!1);const s=e.getBoundingClientRect(),u=s.left+t.scrollLeft-(r?0:gR(e,s)),f=s.top+t.scrollTop;return{x:u,y:f}}function Kre(e){let{elements:t,rect:r,offsetParent:s,strategy:u}=e;const f=u==="fixed",m=vh(s),i=t?KC(t.floating):!1;if(s===m||i&&f)return r;let S={scrollLeft:0,scrollTop:0},E=hh(1);const I=hh(0),D=ph(s);if((D||!D&&!f)&&((Uv(s)!=="body"||Bb(m))&&(S=JC(s)),ph(s))){const R=p_(s);E=Hx(s),I.x=R.x+s.clientLeft,I.y=R.y+s.clientTop}const M=m&&!D&&!f?S8(m,S,!0):hh(0);return{width:r.width*E.x,height:r.height*E.y,x:r.x*E.x-S.scrollLeft*E.x+I.x+M.x,y:r.y*E.y-S.scrollTop*E.y+I.y+M.y}}function Jre(e){return Array.from(e.getClientRects())}function Qre(e){const t=vh(e),r=JC(e),s=e.ownerDocument.body,u=$c(t.scrollWidth,t.clientWidth,s.scrollWidth,s.clientWidth),f=$c(t.scrollHeight,t.clientHeight,s.scrollHeight,s.clientHeight);let m=-r.scrollLeft+gR(e);const i=-r.scrollTop;return Td(s).direction==="rtl"&&(m+=$c(t.clientWidth,s.clientWidth)-u),{width:u,height:f,x:m,y:i}}function ene(e,t){const r=Yc(e),s=vh(e),u=r.visualViewport;let f=s.clientWidth,m=s.clientHeight,i=0,S=0;if(u){f=u.width,m=u.height;const E=pR();(!E||E&&t==="fixed")&&(i=u.offsetLeft,S=u.offsetTop)}return{width:f,height:m,x:i,y:S}}const tne=new Set(["absolute","fixed"]);function rne(e,t){const r=p_(e,!0,t==="fixed"),s=r.top+e.clientTop,u=r.left+e.clientLeft,f=ph(e)?Hx(e):hh(1),m=e.clientWidth*f.x,i=e.clientHeight*f.y,S=u*f.x,E=s*f.y;return{width:m,height:i,x:S,y:E}}function dz(e,t,r){let s;if(t==="viewport")s=ene(e,r);else if(t==="document")s=Qre(vh(e));else if(Sd(t))s=rne(t,r);else{const u=b8(e);s={x:t.x-u.x,y:t.y-u.y,width:t.width,height:t.height}}return BE(s)}function T8(e,t){const r=hm(e);return r===t||!Sd(r)||Sv(r)?!1:Td(r).position==="fixed"||T8(r,t)}function nne(e,t){const r=t.get(e);if(r)return r;let s=ub(e,[],!1).filter(i=>Sd(i)&&Uv(i)!=="body"),u=null;const f=Td(e).position==="fixed";let m=f?hm(e):e;for(;Sd(m)&&!Sv(m);){const i=Td(m),S=fR(m);!S&&i.position==="fixed"&&(u=null),(f?!S&&!u:!S&&i.position==="static"&&!!u&&tne.has(u.position)||Bb(m)&&!S&&T8(e,m))?s=s.filter(I=>I!==m):u=i,m=hm(m)}return t.set(e,s),s}function ine(e){let{element:t,boundary:r,rootBoundary:s,strategy:u}=e;const m=[...r==="clippingAncestors"?KC(t)?[]:nne(t,this._c):[].concat(r),s],i=m[0],S=m.reduce((E,I)=>{const D=dz(t,I,u);return E.top=$c(D.top,E.top),E.right=dm(D.right,E.right),E.bottom=dm(D.bottom,E.bottom),E.left=$c(D.left,E.left),E},dz(t,i,u));return{width:S.right-S.left,height:S.bottom-S.top,x:S.left,y:S.top}}function sne(e){const{width:t,height:r}=w8(e);return{width:t,height:r}}function ane(e,t,r){const s=ph(t),u=vh(t),f=r==="fixed",m=p_(e,!0,f,t);let i={scrollLeft:0,scrollTop:0};const S=hh(0);function E(){S.x=gR(u)}if(s||!s&&!f)if((Uv(t)!=="body"||Bb(u))&&(i=JC(t)),s){const R=p_(t,!0,f,t);S.x=R.x+t.clientLeft,S.y=R.y+t.clientTop}else u&&E();f&&!s&&u&&E();const I=u&&!s&&!f?S8(u,i):hh(0),D=m.left+i.scrollLeft-S.x-I.x,M=m.top+i.scrollTop-S.y-I.y;return{x:D,y:M,width:m.width,height:m.height}}function dN(e){return Td(e).position==="static"}function hz(e,t){if(!ph(e)||Td(e).position==="fixed")return null;if(t)return t(e);let r=e.offsetParent;return vh(e)===r&&(r=r.ownerDocument.body),r}function E8(e,t){const r=Yc(e);if(KC(e))return r;if(!ph(e)){let u=hm(e);for(;u&&!Sv(u);){if(Sd(u)&&!dN(u))return u;u=hm(u)}return r}let s=hz(e,t);for(;s&&Vre(s)&&dN(s);)s=hz(s,t);return s&&Sv(s)&&dN(s)&&!fR(s)?r:s||Hre(e)||r}const one=async function(e){const t=this.getOffsetParent||E8,r=this.getDimensions,s=await r(e.floating);return{reference:ane(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:s.width,height:s.height}}};function lne(e){return Td(e).direction==="rtl"}const cne={convertOffsetParentRelativeRectToViewportRelativeRect:Kre,getDocumentElement:vh,getClippingRect:ine,getOffsetParent:E8,getElementRects:one,getClientRects:Jre,getDimensions:sne,getScale:Hx,isElement:Sd,isRTL:lne};function C8(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function une(e,t){let r=null,s;const u=vh(e);function f(){var i;clearTimeout(s),(i=r)==null||i.disconnect(),r=null}function m(i,S){i===void 0&&(i=!1),S===void 0&&(S=1),f();const E=e.getBoundingClientRect(),{left:I,top:D,width:M,height:R}=E;if(i||t(),!M||!R)return;const H=xT(D),F=xT(u.clientWidth-(I+M)),U=xT(u.clientHeight-(D+R)),Y=xT(I),J={rootMargin:-H+"px "+-F+"px "+-U+"px "+-Y+"px",threshold:$c(0,dm(1,S))||1};let ne=!0;function me(le){const ye=le[0].intersectionRatio;if(ye!==S){if(!ne)return m();ye?m(!1,ye):s=setTimeout(()=>{m(!1,1e-7)},1e3)}ye===1&&!C8(E,e.getBoundingClientRect())&&m(),ne=!1}try{r=new IntersectionObserver(me,{...J,root:u.ownerDocument})}catch{r=new IntersectionObserver(me,J)}r.observe(e)}return m(!0),f}function dne(e,t,r,s){s===void 0&&(s={});const{ancestorScroll:u=!0,ancestorResize:f=!0,elementResize:m=typeof ResizeObserver=="function",layoutShift:i=typeof IntersectionObserver=="function",animationFrame:S=!1}=s,E=mR(e),I=u||f?[...E?ub(E):[],...ub(t)]:[];I.forEach(Y=>{u&&Y.addEventListener("scroll",r,{passive:!0}),f&&Y.addEventListener("resize",r)});const D=E&&i?une(E,r):null;let M=-1,R=null;m&&(R=new ResizeObserver(Y=>{let[z]=Y;z&&z.target===E&&R&&(R.unobserve(t),cancelAnimationFrame(M),M=requestAnimationFrame(()=>{var J;(J=R)==null||J.observe(t)})),r()}),E&&!S&&R.observe(E),R.observe(t));let H,F=S?p_(e):null;S&&U();function U(){const Y=p_(e);F&&!C8(F,Y)&&r(),F=Y,H=requestAnimationFrame(U)}return r(),()=>{var Y;I.forEach(z=>{u&&z.removeEventListener("scroll",r),f&&z.removeEventListener("resize",r)}),D==null||D(),(Y=R)==null||Y.disconnect(),R=null,S&&cancelAnimationFrame(H)}}const hne=Ore,fne=Fre,pne=Dre,mne=zre,gne=Rre,fz=Pre,_ne=Lre,xne=(e,t,r)=>{const s=new Map,u={platform:cne,...r},f={...u.platform,_c:s};return kre(e,t,{...u,platform:f})};var vne=typeof document<"u",yne=function(){},sE=vne?V.useLayoutEffect:yne;function UE(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let r,s,u;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(r=e.length,r!==t.length)return!1;for(s=r;s--!==0;)if(!UE(e[s],t[s]))return!1;return!0}if(u=Object.keys(e),r=u.length,r!==Object.keys(t).length)return!1;for(s=r;s--!==0;)if(!{}.hasOwnProperty.call(t,u[s]))return!1;for(s=r;s--!==0;){const f=u[s];if(!(f==="_owner"&&e.$$typeof)&&!UE(e[f],t[f]))return!1}return!0}return e!==e&&t!==t}function A8(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function pz(e,t){const r=A8(e);return Math.round(t*r)/r}function hN(e){const t=V.useRef(e);return sE(()=>{t.current=e}),t}function wne(e){e===void 0&&(e={});const{placement:t="bottom",strategy:r="absolute",middleware:s=[],platform:u,elements:{reference:f,floating:m}={},transform:i=!0,whileElementsMounted:S,open:E}=e,[I,D]=V.useState({x:0,y:0,strategy:r,placement:t,middlewareData:{},isPositioned:!1}),[M,R]=V.useState(s);UE(M,s)||R(s);const[H,F]=V.useState(null),[U,Y]=V.useState(null),z=V.useCallback(Me=>{Me!==le.current&&(le.current=Me,F(Me))},[]),J=V.useCallback(Me=>{Me!==ye.current&&(ye.current=Me,Y(Me))},[]),ne=f||H,me=m||U,le=V.useRef(null),ye=V.useRef(null),pe=V.useRef(I),be=S!=null,ke=hN(S),Oe=hN(u),Ee=hN(E),qe=V.useCallback(()=>{if(!le.current||!ye.current)return;const Me={placement:t,strategy:r,middleware:M};Oe.current&&(Me.platform=Oe.current),xne(le.current,ye.current,Me).then(mt=>{const Kt={...mt,isPositioned:Ee.current!==!1};Qe.current&&!UE(pe.current,Kt)&&(pe.current=Kt,I_.flushSync(()=>{D(Kt)}))})},[M,t,r,Oe,Ee]);sE(()=>{E===!1&&pe.current.isPositioned&&(pe.current.isPositioned=!1,D(Me=>({...Me,isPositioned:!1})))},[E]);const Qe=V.useRef(!1);sE(()=>(Qe.current=!0,()=>{Qe.current=!1}),[]),sE(()=>{if(ne&&(le.current=ne),me&&(ye.current=me),ne&&me){if(ke.current)return ke.current(ne,me,qe);qe()}},[ne,me,qe,ke,be]);const gt=V.useMemo(()=>({reference:le,floating:ye,setReference:z,setFloating:J}),[z,J]),Xe=V.useMemo(()=>({reference:ne,floating:me}),[ne,me]),ct=V.useMemo(()=>{const Me={position:r,left:0,top:0};if(!Xe.floating)return Me;const mt=pz(Xe.floating,I.x),Kt=pz(Xe.floating,I.y);return i?{...Me,transform:"translate("+mt+"px, "+Kt+"px)",...A8(Xe.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:mt,top:Kt}},[r,i,Xe.floating,I.x,I.y]);return V.useMemo(()=>({...I,update:qe,refs:gt,elements:Xe,floatingStyles:ct}),[I,qe,gt,Xe,ct])}const bne=e=>{function t(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:e,fn(r){const{element:s,padding:u}=typeof e=="function"?e(r):e;return s&&t(s)?s.current!=null?fz({element:s.current,padding:u}).fn(r):{}:s?fz({element:s,padding:u}).fn(r):{}}}},Sne=(e,t)=>({...hne(e),options:[e,t]}),Tne=(e,t)=>({...fne(e),options:[e,t]}),Ene=(e,t)=>({..._ne(e),options:[e,t]}),Cne=(e,t)=>({...pne(e),options:[e,t]}),Ane=(e,t)=>({...mne(e),options:[e,t]}),jne=(e,t)=>({...gne(e),options:[e,t]}),Ine=(e,t)=>({...bne(e),options:[e,t]});var Nne="Arrow",j8=V.forwardRef((e,t)=>{const{children:r,width:s=10,height:u=5,...f}=e;return c.jsx(es.svg,{...f,ref:t,width:s,height:u,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?r:c.jsx("polygon",{points:"0,0 30,0 15,10"})})});j8.displayName=Nne;var kne=j8;function I8(e){const[t,r]=V.useState(void 0);return fl(()=>{if(e){r({width:e.offsetWidth,height:e.offsetHeight});const s=new ResizeObserver(u=>{if(!Array.isArray(u)||!u.length)return;const f=u[0];let m,i;if("borderBoxSize"in f){const S=f.borderBoxSize,E=Array.isArray(S)?S[0]:S;m=E.inlineSize,i=E.blockSize}else m=e.offsetWidth,i=e.offsetHeight;r({width:m,height:i})});return s.observe(e,{box:"border-box"}),()=>s.unobserve(e)}else r(void 0)},[e]),t}var _R="Popper",[N8,QC]=xh(_R),[Pne,k8]=N8(_R),P8=e=>{const{__scopePopper:t,children:r}=e,[s,u]=V.useState(null);return c.jsx(Pne,{scope:t,anchor:s,onAnchorChange:u,children:r})};P8.displayName=_R;var D8="PopperAnchor",R8=V.forwardRef((e,t)=>{const{__scopePopper:r,virtualRef:s,...u}=e,f=k8(D8,r),m=V.useRef(null),i=da(t,m);return V.useEffect(()=>{f.onAnchorChange((s==null?void 0:s.current)||m.current)}),s?null:c.jsx(es.div,{...u,ref:i})});R8.displayName=D8;var xR="PopperContent",[Dne,Rne]=N8(xR),M8=V.forwardRef((e,t)=>{var dt,Vt,zt,Gt,jr,Wr;const{__scopePopper:r,side:s="bottom",sideOffset:u=0,align:f="center",alignOffset:m=0,arrowPadding:i=0,avoidCollisions:S=!0,collisionBoundary:E=[],collisionPadding:I=0,sticky:D="partial",hideWhenDetached:M=!1,updatePositionStrategy:R="optimized",onPlaced:H,...F}=e,U=k8(xR,r),[Y,z]=V.useState(null),J=da(t,nn=>z(nn)),[ne,me]=V.useState(null),le=I8(ne),ye=(le==null?void 0:le.width)??0,pe=(le==null?void 0:le.height)??0,be=s+(f!=="center"?"-"+f:""),ke=typeof I=="number"?I:{top:0,right:0,bottom:0,left:0,...I},Oe=Array.isArray(E)?E:[E],Ee=Oe.length>0,qe={padding:ke,boundary:Oe.filter(One),altBoundary:Ee},{refs:Qe,floatingStyles:gt,placement:Xe,isPositioned:ct,middlewareData:Me}=wne({strategy:"fixed",placement:be,whileElementsMounted:(...nn)=>dne(...nn,{animationFrame:R==="always"}),elements:{reference:U.anchor},middleware:[Sne({mainAxis:u+pe,alignmentAxis:m}),S&&Tne({mainAxis:!0,crossAxis:!1,limiter:D==="partial"?Ene():void 0,...qe}),S&&Cne({...qe}),Ane({...qe,apply:({elements:nn,rects:xn,availableWidth:ei,availableHeight:Dn})=>{const{width:Zr,height:Nn}=xn.reference,Pi=nn.floating.style;Pi.setProperty("--radix-popper-available-width",`${ei}px`),Pi.setProperty("--radix-popper-available-height",`${Dn}px`),Pi.setProperty("--radix-popper-anchor-width",`${Zr}px`),Pi.setProperty("--radix-popper-anchor-height",`${Nn}px`)}}),ne&&Ine({element:ne,padding:i}),Fne({arrowWidth:ye,arrowHeight:pe}),M&&jne({strategy:"referenceHidden",...qe})]}),[mt,Kt]=L8(Xe),it=Cu(H);fl(()=>{ct&&(it==null||it())},[ct,it]);const ee=(dt=Me.arrow)==null?void 0:dt.x,he=(Vt=Me.arrow)==null?void 0:Vt.y,Se=((zt=Me.arrow)==null?void 0:zt.centerOffset)!==0,[Ue,nt]=V.useState();return fl(()=>{Y&&nt(window.getComputedStyle(Y).zIndex)},[Y]),c.jsx("div",{ref:Qe.setFloating,"data-radix-popper-content-wrapper":"",style:{...gt,transform:ct?gt.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Ue,"--radix-popper-transform-origin":[(Gt=Me.transformOrigin)==null?void 0:Gt.x,(jr=Me.transformOrigin)==null?void 0:jr.y].join(" "),...((Wr=Me.hide)==null?void 0:Wr.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:c.jsx(Dne,{scope:r,placedSide:mt,onArrowChange:me,arrowX:ee,arrowY:he,shouldHideArrow:Se,children:c.jsx(es.div,{"data-side":mt,"data-align":Kt,...F,ref:J,style:{...F.style,animation:ct?void 0:"none"}})})})});M8.displayName=xR;var O8="PopperArrow",Mne={top:"bottom",right:"left",bottom:"top",left:"right"},F8=V.forwardRef(function(t,r){const{__scopePopper:s,...u}=t,f=Rne(O8,s),m=Mne[f.placedSide];return c.jsx("span",{ref:f.onArrowChange,style:{position:"absolute",left:f.arrowX,top:f.arrowY,[m]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[f.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[f.placedSide],visibility:f.shouldHideArrow?"hidden":void 0},children:c.jsx(kne,{...u,ref:r,style:{...u.style,display:"block"}})})});F8.displayName=O8;function One(e){return e!==null}var Fne=e=>({name:"transformOrigin",options:e,fn(t){var U,Y,z;const{placement:r,rects:s,middlewareData:u}=t,m=((U=u.arrow)==null?void 0:U.centerOffset)!==0,i=m?0:e.arrowWidth,S=m?0:e.arrowHeight,[E,I]=L8(r),D={start:"0%",center:"50%",end:"100%"}[I],M=(((Y=u.arrow)==null?void 0:Y.x)??0)+i/2,R=(((z=u.arrow)==null?void 0:z.y)??0)+S/2;let H="",F="";return E==="bottom"?(H=m?D:`${M}px`,F=`${-S}px`):E==="top"?(H=m?D:`${M}px`,F=`${s.floating.height+S}px`):E==="right"?(H=`${-S}px`,F=m?D:`${R}px`):E==="left"&&(H=`${s.floating.width+S}px`,F=m?D:`${R}px`),{data:{x:H,y:F}}}});function L8(e){const[t,r="center"]=e.split("-");return[t,r]}var z8=P8,B8=R8,U8=M8,V8=F8,[eA,T2e]=xh("Tooltip",[QC]),tA=QC(),$8="TooltipProvider",Lne=700,iP="tooltip.open",[zne,vR]=eA($8),q8=e=>{const{__scopeTooltip:t,delayDuration:r=Lne,skipDelayDuration:s=300,disableHoverableContent:u=!1,children:f}=e,m=V.useRef(!0),i=V.useRef(!1),S=V.useRef(0);return V.useEffect(()=>{const E=S.current;return()=>window.clearTimeout(E)},[]),c.jsx(zne,{scope:t,isOpenDelayedRef:m,delayDuration:r,onOpen:V.useCallback(()=>{window.clearTimeout(S.current),m.current=!1},[]),onClose:V.useCallback(()=>{window.clearTimeout(S.current),S.current=window.setTimeout(()=>m.current=!0,s)},[s]),isPointerInTransitRef:i,onPointerInTransitChange:V.useCallback(E=>{i.current=E},[]),disableHoverableContent:u,children:f})};q8.displayName=$8;var db="Tooltip",[Bne,rA]=eA(db),G8=e=>{const{__scopeTooltip:t,children:r,open:s,defaultOpen:u,onOpenChange:f,disableHoverableContent:m,delayDuration:i}=e,S=vR(db,e.__scopeTooltip),E=tA(t),[I,D]=V.useState(null),M=lf(),R=V.useRef(0),H=m??S.disableHoverableContent,F=i??S.delayDuration,U=V.useRef(!1),[Y,z]=lm({prop:s,defaultProp:u??!1,onChange:ye=>{ye?(S.onOpen(),document.dispatchEvent(new CustomEvent(iP))):S.onClose(),f==null||f(ye)},caller:db}),J=V.useMemo(()=>Y?U.current?"delayed-open":"instant-open":"closed",[Y]),ne=V.useCallback(()=>{window.clearTimeout(R.current),R.current=0,U.current=!1,z(!0)},[z]),me=V.useCallback(()=>{window.clearTimeout(R.current),R.current=0,z(!1)},[z]),le=V.useCallback(()=>{window.clearTimeout(R.current),R.current=window.setTimeout(()=>{U.current=!0,z(!0),R.current=0},F)},[F,z]);return V.useEffect(()=>()=>{R.current&&(window.clearTimeout(R.current),R.current=0)},[]),c.jsx(z8,{...E,children:c.jsx(Bne,{scope:t,contentId:M,open:Y,stateAttribute:J,trigger:I,onTriggerChange:D,onTriggerEnter:V.useCallback(()=>{S.isOpenDelayedRef.current?le():ne()},[S.isOpenDelayedRef,le,ne]),onTriggerLeave:V.useCallback(()=>{H?me():(window.clearTimeout(R.current),R.current=0)},[me,H]),onOpen:ne,onClose:me,disableHoverableContent:H,children:r})})};G8.displayName=db;var sP="TooltipTrigger",W8=V.forwardRef((e,t)=>{const{__scopeTooltip:r,...s}=e,u=rA(sP,r),f=vR(sP,r),m=tA(r),i=V.useRef(null),S=da(t,i,u.onTriggerChange),E=V.useRef(!1),I=V.useRef(!1),D=V.useCallback(()=>E.current=!1,[]);return V.useEffect(()=>()=>document.removeEventListener("pointerup",D),[D]),c.jsx(B8,{asChild:!0,...m,children:c.jsx(es.button,{"aria-describedby":u.open?u.contentId:void 0,"data-state":u.stateAttribute,...s,ref:S,onPointerMove:xi(e.onPointerMove,M=>{M.pointerType!=="touch"&&!I.current&&!f.isPointerInTransitRef.current&&(u.onTriggerEnter(),I.current=!0)}),onPointerLeave:xi(e.onPointerLeave,()=>{u.onTriggerLeave(),I.current=!1}),onPointerDown:xi(e.onPointerDown,()=>{u.open&&u.onClose(),E.current=!0,document.addEventListener("pointerup",D,{once:!0})}),onFocus:xi(e.onFocus,()=>{E.current||u.onOpen()}),onBlur:xi(e.onBlur,u.onClose),onClick:xi(e.onClick,u.onClose)})})});W8.displayName=sP;var Une="TooltipPortal",[E2e,Vne]=eA(Une,{forceMount:void 0}),Tv="TooltipContent",H8=V.forwardRef((e,t)=>{const r=Vne(Tv,e.__scopeTooltip),{forceMount:s=r.forceMount,side:u="top",...f}=e,m=rA(Tv,e.__scopeTooltip);return c.jsx(bm,{present:s||m.open,children:m.disableHoverableContent?c.jsx(Z8,{side:u,...f,ref:t}):c.jsx($ne,{side:u,...f,ref:t})})}),$ne=V.forwardRef((e,t)=>{const r=rA(Tv,e.__scopeTooltip),s=vR(Tv,e.__scopeTooltip),u=V.useRef(null),f=da(t,u),[m,i]=V.useState(null),{trigger:S,onClose:E}=r,I=u.current,{onPointerInTransitChange:D}=s,M=V.useCallback(()=>{i(null),D(!1)},[D]),R=V.useCallback((H,F)=>{const U=H.currentTarget,Y={x:H.clientX,y:H.clientY},z=Zne(Y,U.getBoundingClientRect()),J=Xne(Y,z),ne=Yne(F.getBoundingClientRect()),me=Jne([...J,...ne]);i(me),D(!0)},[D]);return V.useEffect(()=>()=>M(),[M]),V.useEffect(()=>{if(S&&I){const H=U=>R(U,I),F=U=>R(U,S);return S.addEventListener("pointerleave",H),I.addEventListener("pointerleave",F),()=>{S.removeEventListener("pointerleave",H),I.removeEventListener("pointerleave",F)}}},[S,I,R,M]),V.useEffect(()=>{if(m){const H=F=>{const U=F.target,Y={x:F.clientX,y:F.clientY},z=(S==null?void 0:S.contains(U))||(I==null?void 0:I.contains(U)),J=!Kne(Y,m);z?M():J&&(M(),E())};return document.addEventListener("pointermove",H),()=>document.removeEventListener("pointermove",H)}},[S,I,m,E,M]),c.jsx(Z8,{...e,ref:f})}),[qne,Gne]=eA(db,{isInside:!1}),Wne=CV("TooltipContent"),Z8=V.forwardRef((e,t)=>{const{__scopeTooltip:r,children:s,"aria-label":u,onEscapeKeyDown:f,onPointerDownOutside:m,...i}=e,S=rA(Tv,r),E=tA(r),{onClose:I}=S;return V.useEffect(()=>(document.addEventListener(iP,I),()=>document.removeEventListener(iP,I)),[I]),V.useEffect(()=>{if(S.trigger){const D=M=>{const R=M.target;R!=null&&R.contains(S.trigger)&&I()};return window.addEventListener("scroll",D,{capture:!0}),()=>window.removeEventListener("scroll",D,{capture:!0})}},[S.trigger,I]),c.jsx(Fb,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:f,onPointerDownOutside:m,onFocusOutside:D=>D.preventDefault(),onDismiss:I,children:c.jsxs(U8,{"data-state":S.stateAttribute,...E,...i,ref:t,style:{...i.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[c.jsx(Wne,{children:s}),c.jsx(qne,{scope:r,isInside:!0,children:c.jsx(cee,{id:S.contentId,role:"tooltip",children:u||s})})]})})});H8.displayName=Tv;var X8="TooltipArrow",Hne=V.forwardRef((e,t)=>{const{__scopeTooltip:r,...s}=e,u=tA(r);return Gne(X8,r).isInside?null:c.jsx(V8,{...u,...s,ref:t})});Hne.displayName=X8;function Zne(e,t){const r=Math.abs(t.top-e.y),s=Math.abs(t.bottom-e.y),u=Math.abs(t.right-e.x),f=Math.abs(t.left-e.x);switch(Math.min(r,s,u,f)){case f:return"left";case u:return"right";case r:return"top";case s:return"bottom";default:throw new Error("unreachable")}}function Xne(e,t,r=5){const s=[];switch(t){case"top":s.push({x:e.x-r,y:e.y+r},{x:e.x+r,y:e.y+r});break;case"bottom":s.push({x:e.x-r,y:e.y-r},{x:e.x+r,y:e.y-r});break;case"left":s.push({x:e.x+r,y:e.y-r},{x:e.x+r,y:e.y+r});break;case"right":s.push({x:e.x-r,y:e.y-r},{x:e.x-r,y:e.y+r});break}return s}function Yne(e){const{top:t,right:r,bottom:s,left:u}=e;return[{x:u,y:t},{x:r,y:t},{x:r,y:s},{x:u,y:s}]}function Kne(e,t){const{x:r,y:s}=e;let u=!1;for(let f=0,m=t.length-1;f<t.length;m=f++){const i=t[f],S=t[m],E=i.x,I=i.y,D=S.x,M=S.y;I>s!=M>s&&r<(D-E)*(s-I)/(M-I)+E&&(u=!u)}return u}function Jne(e){const t=e.slice();return t.sort((r,s)=>r.x<s.x?-1:r.x>s.x?1:r.y<s.y?-1:r.y>s.y?1:0),Qne(t)}function Qne(e){if(e.length<=1)return e.slice();const t=[];for(let s=0;s<e.length;s++){const u=e[s];for(;t.length>=2;){const f=t[t.length-1],m=t[t.length-2];if((f.x-m.x)*(u.y-m.y)>=(f.y-m.y)*(u.x-m.x))t.pop();else break}t.push(u)}t.pop();const r=[];for(let s=e.length-1;s>=0;s--){const u=e[s];for(;r.length>=2;){const f=r[r.length-1],m=r[r.length-2];if((f.x-m.x)*(u.y-m.y)>=(f.y-m.y)*(u.x-m.x))r.pop();else break}r.push(u)}return r.pop(),t.length===1&&r.length===1&&t[0].x===r[0].x&&t[0].y===r[0].y?t:t.concat(r)}var eie=q8,tie=G8,rie=W8,Y8=H8;const K8=eie,nie=tie,iie=rie,J8=V.forwardRef(({className:e,sideOffset:t=4,...r},s)=>c.jsx(Y8,{ref:s,sideOffset:t,className:sn("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r}));J8.displayName=Y8.displayName;var Vv=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},m_=typeof window>"u"||"Deno"in globalThis;function Wl(){}function sie(e,t){return typeof e=="function"?e(t):e}function aP(e){return typeof e=="number"&&e>=0&&e!==1/0}function Q8(e,t){return Math.max(e+(t||0)-Date.now(),0)}function rm(e,t){return typeof e=="function"?e(t):e}function xu(e,t){return typeof e=="function"?e(t):e}function mz(e,t){const{type:r="all",exact:s,fetchStatus:u,predicate:f,queryKey:m,stale:i}=e;if(m){if(s){if(t.queryHash!==yR(m,t.options))return!1}else if(!hb(t.queryKey,m))return!1}if(r!=="all"){const S=t.isActive();if(r==="active"&&!S||r==="inactive"&&S)return!1}return!(typeof i=="boolean"&&t.isStale()!==i||u&&u!==t.state.fetchStatus||f&&!f(t))}function gz(e,t){const{exact:r,status:s,predicate:u,mutationKey:f}=e;if(f){if(!t.options.mutationKey)return!1;if(r){if(g_(t.options.mutationKey)!==g_(f))return!1}else if(!hb(t.options.mutationKey,f))return!1}return!(s&&t.state.status!==s||u&&!u(t))}function yR(e,t){return((t==null?void 0:t.queryKeyHashFn)||g_)(e)}function g_(e){return JSON.stringify(e,(t,r)=>oP(r)?Object.keys(r).sort().reduce((s,u)=>(s[u]=r[u],s),{}):r)}function hb(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(r=>hb(e[r],t[r])):!1}function e$(e,t){if(e===t)return e;const r=_z(e)&&_z(t);if(r||oP(e)&&oP(t)){const s=r?e:Object.keys(e),u=s.length,f=r?t:Object.keys(t),m=f.length,i=r?[]:{},S=new Set(s);let E=0;for(let I=0;I<m;I++){const D=r?I:f[I];(!r&&S.has(D)||r)&&e[D]===void 0&&t[D]===void 0?(i[D]=void 0,E++):(i[D]=e$(e[D],t[D]),i[D]===e[D]&&e[D]!==void 0&&E++)}return u===m&&E===u?e:i}return t}function VE(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}function _z(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function oP(e){if(!xz(e))return!1;const t=e.constructor;if(t===void 0)return!0;const r=t.prototype;return!(!xz(r)||!r.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function xz(e){return Object.prototype.toString.call(e)==="[object Object]"}function aie(e){return new Promise(t=>{setTimeout(t,e)})}function lP(e,t,r){return typeof r.structuralSharing=="function"?r.structuralSharing(e,t):r.structuralSharing!==!1?e$(e,t):t}function oie(e,t,r=0){const s=[...e,t];return r&&s.length>r?s.slice(1):s}function lie(e,t,r=0){const s=[t,...e];return r&&s.length>r?s.slice(0,-1):s}var wR=Symbol();function t$(e,t){return!e.queryFn&&(t!=null&&t.initialPromise)?()=>t.initialPromise:!e.queryFn||e.queryFn===wR?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}function r$(e,t){return typeof e=="function"?e(...t):!!e}var Hg,Dp,nv,Q5,cie=(Q5=class extends Vv{constructor(){super();_i(this,Hg);_i(this,Dp);_i(this,nv);zn(this,nv,t=>{if(!m_&&window.addEventListener){const r=()=>t();return window.addEventListener("visibilitychange",r,!1),()=>{window.removeEventListener("visibilitychange",r)}}})}onSubscribe(){St(this,Dp)||this.setEventListener(St(this,nv))}onUnsubscribe(){var t;this.hasListeners()||((t=St(this,Dp))==null||t.call(this),zn(this,Dp,void 0))}setEventListener(t){var r;zn(this,nv,t),(r=St(this,Dp))==null||r.call(this),zn(this,Dp,t(s=>{typeof s=="boolean"?this.setFocused(s):this.onFocus()}))}setFocused(t){St(this,Hg)!==t&&(zn(this,Hg,t),this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(r=>{r(t)})}isFocused(){var t;return typeof St(this,Hg)=="boolean"?St(this,Hg):((t=globalThis.document)==null?void 0:t.visibilityState)!=="hidden"}},Hg=new WeakMap,Dp=new WeakMap,nv=new WeakMap,Q5),bR=new cie,iv,Rp,sv,e6,uie=(e6=class extends Vv{constructor(){super();_i(this,iv,!0);_i(this,Rp);_i(this,sv);zn(this,sv,t=>{if(!m_&&window.addEventListener){const r=()=>t(!0),s=()=>t(!1);return window.addEventListener("online",r,!1),window.addEventListener("offline",s,!1),()=>{window.removeEventListener("online",r),window.removeEventListener("offline",s)}}})}onSubscribe(){St(this,Rp)||this.setEventListener(St(this,sv))}onUnsubscribe(){var t;this.hasListeners()||((t=St(this,Rp))==null||t.call(this),zn(this,Rp,void 0))}setEventListener(t){var r;zn(this,sv,t),(r=St(this,Rp))==null||r.call(this),zn(this,Rp,t(this.setOnline.bind(this)))}setOnline(t){St(this,iv)!==t&&(zn(this,iv,t),this.listeners.forEach(s=>{s(t)}))}isOnline(){return St(this,iv)}},iv=new WeakMap,Rp=new WeakMap,sv=new WeakMap,e6),$E=new uie;function cP(){let e,t;const r=new Promise((u,f)=>{e=u,t=f});r.status="pending",r.catch(()=>{});function s(u){Object.assign(r,u),delete r.resolve,delete r.reject}return r.resolve=u=>{s({status:"fulfilled",value:u}),e(u)},r.reject=u=>{s({status:"rejected",reason:u}),t(u)},r}function die(e){return Math.min(1e3*2**e,3e4)}function n$(e){return(e??"online")==="online"?$E.isOnline():!0}var i$=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function fN(e){return e instanceof i$}function s$(e){let t=!1,r=0,s=!1,u;const f=cP(),m=F=>{var U;s||(M(new i$(F)),(U=e.abort)==null||U.call(e))},i=()=>{t=!0},S=()=>{t=!1},E=()=>bR.isFocused()&&(e.networkMode==="always"||$E.isOnline())&&e.canRun(),I=()=>n$(e.networkMode)&&e.canRun(),D=F=>{var U;s||(s=!0,(U=e.onSuccess)==null||U.call(e,F),u==null||u(),f.resolve(F))},M=F=>{var U;s||(s=!0,(U=e.onError)==null||U.call(e,F),u==null||u(),f.reject(F))},R=()=>new Promise(F=>{var U;u=Y=>{(s||E())&&F(Y)},(U=e.onPause)==null||U.call(e)}).then(()=>{var F;u=void 0,s||(F=e.onContinue)==null||F.call(e)}),H=()=>{if(s)return;let F;const U=r===0?e.initialPromise:void 0;try{F=U??e.fn()}catch(Y){F=Promise.reject(Y)}Promise.resolve(F).then(D).catch(Y=>{var le;if(s)return;const z=e.retry??(m_?0:3),J=e.retryDelay??die,ne=typeof J=="function"?J(r,Y):J,me=z===!0||typeof z=="number"&&r<z||typeof z=="function"&&z(r,Y);if(t||!me){M(Y);return}r++,(le=e.onFail)==null||le.call(e,r,Y),aie(ne).then(()=>E()?void 0:R()).then(()=>{t?M(Y):H()})})};return{promise:f,cancel:m,continue:()=>(u==null||u(),f),cancelRetry:i,continueRetry:S,canStart:I,start:()=>(I()?H():R().then(H),f)}}var hie=e=>setTimeout(e,0);function fie(){let e=[],t=0,r=i=>{i()},s=i=>{i()},u=hie;const f=i=>{t?e.push(i):u(()=>{r(i)})},m=()=>{const i=e;e=[],i.length&&u(()=>{s(()=>{i.forEach(S=>{r(S)})})})};return{batch:i=>{let S;t++;try{S=i()}finally{t--,t||m()}return S},batchCalls:i=>(...S)=>{f(()=>{i(...S)})},schedule:f,setNotifyFunction:i=>{r=i},setBatchNotifyFunction:i=>{s=i},setScheduler:i=>{u=i}}}var Fo=fie(),Zg,t6,a$=(t6=class{constructor(){_i(this,Zg)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),aP(this.gcTime)&&zn(this,Zg,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(m_?1/0:5*60*1e3))}clearGcTimeout(){St(this,Zg)&&(clearTimeout(St(this,Zg)),zn(this,Zg,void 0))}},Zg=new WeakMap,t6),av,Xg,gu,Yg,Sl,jb,Kg,ld,Gh,r6,pie=(r6=class extends a${constructor(t){super();_i(this,ld);_i(this,av);_i(this,Xg);_i(this,gu);_i(this,Yg);_i(this,Sl);_i(this,jb);_i(this,Kg);zn(this,Kg,!1),zn(this,jb,t.defaultOptions),this.setOptions(t.options),this.observers=[],zn(this,Yg,t.client),zn(this,gu,St(this,Yg).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,zn(this,av,mie(this.options)),this.state=t.state??St(this,av),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=St(this,Sl))==null?void 0:t.promise}setOptions(t){this.options={...St(this,jb),...t},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&St(this,gu).remove(this)}setData(t,r){const s=lP(this.state.data,t,this.options);return ds(this,ld,Gh).call(this,{data:s,type:"success",dataUpdatedAt:r==null?void 0:r.updatedAt,manual:r==null?void 0:r.manual}),s}setState(t,r){ds(this,ld,Gh).call(this,{type:"setState",state:t,setStateOptions:r})}cancel(t){var s,u;const r=(s=St(this,Sl))==null?void 0:s.promise;return(u=St(this,Sl))==null||u.cancel(t),r?r.then(Wl).catch(Wl):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(St(this,av))}isActive(){return this.observers.some(t=>xu(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===wR||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>rm(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!Q8(this.state.dataUpdatedAt,t)}onFocus(){var r;const t=this.observers.find(s=>s.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(r=St(this,Sl))==null||r.continue()}onOnline(){var r;const t=this.observers.find(s=>s.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(r=St(this,Sl))==null||r.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),St(this,gu).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(r=>r!==t),this.observers.length||(St(this,Sl)&&(St(this,Kg)?St(this,Sl).cancel({revert:!0}):St(this,Sl).cancelRetry()),this.scheduleGc()),St(this,gu).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||ds(this,ld,Gh).call(this,{type:"invalidate"})}fetch(t,r){var E,I,D;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(r!=null&&r.cancelRefetch))this.cancel({silent:!0});else if(St(this,Sl))return St(this,Sl).continueRetry(),St(this,Sl).promise}if(t&&this.setOptions(t),!this.options.queryFn){const M=this.observers.find(R=>R.options.queryFn);M&&this.setOptions(M.options)}const s=new AbortController,u=M=>{Object.defineProperty(M,"signal",{enumerable:!0,get:()=>(zn(this,Kg,!0),s.signal)})},f=()=>{const M=t$(this.options,r),H=(()=>{const F={client:St(this,Yg),queryKey:this.queryKey,meta:this.meta};return u(F),F})();return zn(this,Kg,!1),this.options.persister?this.options.persister(M,H,this):M(H)},i=(()=>{const M={fetchOptions:r,options:this.options,queryKey:this.queryKey,client:St(this,Yg),state:this.state,fetchFn:f};return u(M),M})();(E=this.options.behavior)==null||E.onFetch(i,this),zn(this,Xg,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((I=i.fetchOptions)==null?void 0:I.meta))&&ds(this,ld,Gh).call(this,{type:"fetch",meta:(D=i.fetchOptions)==null?void 0:D.meta});const S=M=>{var R,H,F,U;fN(M)&&M.silent||ds(this,ld,Gh).call(this,{type:"error",error:M}),fN(M)||((H=(R=St(this,gu).config).onError)==null||H.call(R,M,this),(U=(F=St(this,gu).config).onSettled)==null||U.call(F,this.state.data,M,this)),this.scheduleGc()};return zn(this,Sl,s$({initialPromise:r==null?void 0:r.initialPromise,fn:i.fetchFn,abort:s.abort.bind(s),onSuccess:M=>{var R,H,F,U;if(M===void 0){S(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(M)}catch(Y){S(Y);return}(H=(R=St(this,gu).config).onSuccess)==null||H.call(R,M,this),(U=(F=St(this,gu).config).onSettled)==null||U.call(F,M,this.state.error,this),this.scheduleGc()},onError:S,onFail:(M,R)=>{ds(this,ld,Gh).call(this,{type:"failed",failureCount:M,error:R})},onPause:()=>{ds(this,ld,Gh).call(this,{type:"pause"})},onContinue:()=>{ds(this,ld,Gh).call(this,{type:"continue"})},retry:i.options.retry,retryDelay:i.options.retryDelay,networkMode:i.options.networkMode,canRun:()=>!0})),St(this,Sl).start()}},av=new WeakMap,Xg=new WeakMap,gu=new WeakMap,Yg=new WeakMap,Sl=new WeakMap,jb=new WeakMap,Kg=new WeakMap,ld=new WeakSet,Gh=function(t){const r=s=>{switch(t.type){case"failed":return{...s,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...s,fetchStatus:"paused"};case"continue":return{...s,fetchStatus:"fetching"};case"fetch":return{...s,...o$(s.data,this.options),fetchMeta:t.meta??null};case"success":return zn(this,Xg,void 0),{...s,data:t.data,dataUpdateCount:s.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const u=t.error;return fN(u)&&u.revert&&St(this,Xg)?{...St(this,Xg),fetchStatus:"idle"}:{...s,error:u,errorUpdateCount:s.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:s.fetchFailureCount+1,fetchFailureReason:u,fetchStatus:"idle",status:"error"};case"invalidate":return{...s,isInvalidated:!0};case"setState":return{...s,...t.state}}};this.state=r(this.state),Fo.batch(()=>{this.observers.forEach(s=>{s.onQueryUpdate()}),St(this,gu).notify({query:this,type:"updated",action:t})})},r6);function o$(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:n$(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function mie(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,r=t!==void 0,s=r?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:r?s??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:r?"success":"pending",fetchStatus:"idle"}}var eh,n6,gie=(n6=class extends Vv{constructor(t={}){super();_i(this,eh);this.config=t,zn(this,eh,new Map)}build(t,r,s){const u=r.queryKey,f=r.queryHash??yR(u,r);let m=this.get(f);return m||(m=new pie({client:t,queryKey:u,queryHash:f,options:t.defaultQueryOptions(r),state:s,defaultOptions:t.getQueryDefaults(u)}),this.add(m)),m}add(t){St(this,eh).has(t.queryHash)||(St(this,eh).set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const r=St(this,eh).get(t.queryHash);r&&(t.destroy(),r===t&&St(this,eh).delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){Fo.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return St(this,eh).get(t)}getAll(){return[...St(this,eh).values()]}find(t){const r={exact:!0,...t};return this.getAll().find(s=>mz(r,s))}findAll(t={}){const r=this.getAll();return Object.keys(t).length>0?r.filter(s=>mz(t,s)):r}notify(t){Fo.batch(()=>{this.listeners.forEach(r=>{r(t)})})}onFocus(){Fo.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){Fo.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},eh=new WeakMap,n6),th,$l,Jg,rh,Ep,i6,_ie=(i6=class extends a${constructor(t){super();_i(this,rh);_i(this,th);_i(this,$l);_i(this,Jg);this.mutationId=t.mutationId,zn(this,$l,t.mutationCache),zn(this,th,[]),this.state=t.state||l$(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){St(this,th).includes(t)||(St(this,th).push(t),this.clearGcTimeout(),St(this,$l).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){zn(this,th,St(this,th).filter(r=>r!==t)),this.scheduleGc(),St(this,$l).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){St(this,th).length||(this.state.status==="pending"?this.scheduleGc():St(this,$l).remove(this))}continue(){var t;return((t=St(this,Jg))==null?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var f,m,i,S,E,I,D,M,R,H,F,U,Y,z,J,ne,me,le,ye,pe;const r=()=>{ds(this,rh,Ep).call(this,{type:"continue"})};zn(this,Jg,s$({fn:()=>this.options.mutationFn?this.options.mutationFn(t):Promise.reject(new Error("No mutationFn found")),onFail:(be,ke)=>{ds(this,rh,Ep).call(this,{type:"failed",failureCount:be,error:ke})},onPause:()=>{ds(this,rh,Ep).call(this,{type:"pause"})},onContinue:r,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>St(this,$l).canRun(this)}));const s=this.state.status==="pending",u=!St(this,Jg).canStart();try{if(s)r();else{ds(this,rh,Ep).call(this,{type:"pending",variables:t,isPaused:u}),await((m=(f=St(this,$l).config).onMutate)==null?void 0:m.call(f,t,this));const ke=await((S=(i=this.options).onMutate)==null?void 0:S.call(i,t));ke!==this.state.context&&ds(this,rh,Ep).call(this,{type:"pending",context:ke,variables:t,isPaused:u})}const be=await St(this,Jg).start();return await((I=(E=St(this,$l).config).onSuccess)==null?void 0:I.call(E,be,t,this.state.context,this)),await((M=(D=this.options).onSuccess)==null?void 0:M.call(D,be,t,this.state.context)),await((H=(R=St(this,$l).config).onSettled)==null?void 0:H.call(R,be,null,this.state.variables,this.state.context,this)),await((U=(F=this.options).onSettled)==null?void 0:U.call(F,be,null,t,this.state.context)),ds(this,rh,Ep).call(this,{type:"success",data:be}),be}catch(be){try{throw await((z=(Y=St(this,$l).config).onError)==null?void 0:z.call(Y,be,t,this.state.context,this)),await((ne=(J=this.options).onError)==null?void 0:ne.call(J,be,t,this.state.context)),await((le=(me=St(this,$l).config).onSettled)==null?void 0:le.call(me,void 0,be,this.state.variables,this.state.context,this)),await((pe=(ye=this.options).onSettled)==null?void 0:pe.call(ye,void 0,be,t,this.state.context)),be}finally{ds(this,rh,Ep).call(this,{type:"error",error:be})}}finally{St(this,$l).runNext(this)}}},th=new WeakMap,$l=new WeakMap,Jg=new WeakMap,rh=new WeakSet,Ep=function(t){const r=s=>{switch(t.type){case"failed":return{...s,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...s,isPaused:!0};case"continue":return{...s,isPaused:!1};case"pending":return{...s,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...s,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...s,data:void 0,error:t.error,failureCount:s.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=r(this.state),Fo.batch(()=>{St(this,th).forEach(s=>{s.onMutationUpdate(t)}),St(this,$l).notify({mutation:this,type:"updated",action:t})})},i6);function l$(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Xh,cd,Ib,s6,xie=(s6=class extends Vv{constructor(t={}){super();_i(this,Xh);_i(this,cd);_i(this,Ib);this.config=t,zn(this,Xh,new Set),zn(this,cd,new Map),zn(this,Ib,0)}build(t,r,s){const u=new _ie({mutationCache:this,mutationId:++KS(this,Ib)._,options:t.defaultMutationOptions(r),state:s});return this.add(u),u}add(t){St(this,Xh).add(t);const r=vT(t);if(typeof r=="string"){const s=St(this,cd).get(r);s?s.push(t):St(this,cd).set(r,[t])}this.notify({type:"added",mutation:t})}remove(t){if(St(this,Xh).delete(t)){const r=vT(t);if(typeof r=="string"){const s=St(this,cd).get(r);if(s)if(s.length>1){const u=s.indexOf(t);u!==-1&&s.splice(u,1)}else s[0]===t&&St(this,cd).delete(r)}}this.notify({type:"removed",mutation:t})}canRun(t){const r=vT(t);if(typeof r=="string"){const s=St(this,cd).get(r),u=s==null?void 0:s.find(f=>f.state.status==="pending");return!u||u===t}else return!0}runNext(t){var s;const r=vT(t);if(typeof r=="string"){const u=(s=St(this,cd).get(r))==null?void 0:s.find(f=>f!==t&&f.state.isPaused);return(u==null?void 0:u.continue())??Promise.resolve()}else return Promise.resolve()}clear(){Fo.batch(()=>{St(this,Xh).forEach(t=>{this.notify({type:"removed",mutation:t})}),St(this,Xh).clear(),St(this,cd).clear()})}getAll(){return Array.from(St(this,Xh))}find(t){const r={exact:!0,...t};return this.getAll().find(s=>gz(r,s))}findAll(t={}){return this.getAll().filter(r=>gz(t,r))}notify(t){Fo.batch(()=>{this.listeners.forEach(r=>{r(t)})})}resumePausedMutations(){const t=this.getAll().filter(r=>r.state.isPaused);return Fo.batch(()=>Promise.all(t.map(r=>r.continue().catch(Wl))))}},Xh=new WeakMap,cd=new WeakMap,Ib=new WeakMap,s6);function vT(e){var t;return(t=e.options.scope)==null?void 0:t.id}function vz(e){return{onFetch:(t,r)=>{var I,D,M,R,H;const s=t.options,u=(M=(D=(I=t.fetchOptions)==null?void 0:I.meta)==null?void 0:D.fetchMore)==null?void 0:M.direction,f=((R=t.state.data)==null?void 0:R.pages)||[],m=((H=t.state.data)==null?void 0:H.pageParams)||[];let i={pages:[],pageParams:[]},S=0;const E=async()=>{let F=!1;const U=J=>{Object.defineProperty(J,"signal",{enumerable:!0,get:()=>(t.signal.aborted?F=!0:t.signal.addEventListener("abort",()=>{F=!0}),t.signal)})},Y=t$(t.options,t.fetchOptions),z=async(J,ne,me)=>{if(F)return Promise.reject();if(ne==null&&J.pages.length)return Promise.resolve(J);const ye=(()=>{const Oe={client:t.client,queryKey:t.queryKey,pageParam:ne,direction:me?"backward":"forward",meta:t.options.meta};return U(Oe),Oe})(),pe=await Y(ye),{maxPages:be}=t.options,ke=me?lie:oie;return{pages:ke(J.pages,pe,be),pageParams:ke(J.pageParams,ne,be)}};if(u&&f.length){const J=u==="backward",ne=J?vie:yz,me={pages:f,pageParams:m},le=ne(s,me);i=await z(me,le,J)}else{const J=e??f.length;do{const ne=S===0?m[0]??s.initialPageParam:yz(s,i);if(S>0&&ne==null)break;i=await z(i,ne),S++}while(S<J)}return i};t.options.persister?t.fetchFn=()=>{var F,U;return(U=(F=t.options).persister)==null?void 0:U.call(F,E,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},r)}:t.fetchFn=E}}}function yz(e,{pages:t,pageParams:r}){const s=t.length-1;return t.length>0?e.getNextPageParam(t[s],t,r[s],r):void 0}function vie(e,{pages:t,pageParams:r}){var s;return t.length>0?(s=e.getPreviousPageParam)==null?void 0:s.call(e,t[0],t,r[0],r):void 0}var co,Mp,Op,ov,lv,Fp,cv,uv,a6,yie=(a6=class{constructor(e={}){_i(this,co);_i(this,Mp);_i(this,Op);_i(this,ov);_i(this,lv);_i(this,Fp);_i(this,cv);_i(this,uv);zn(this,co,e.queryCache||new gie),zn(this,Mp,e.mutationCache||new xie),zn(this,Op,e.defaultOptions||{}),zn(this,ov,new Map),zn(this,lv,new Map),zn(this,Fp,0)}mount(){KS(this,Fp)._++,St(this,Fp)===1&&(zn(this,cv,bR.subscribe(async e=>{e&&(await this.resumePausedMutations(),St(this,co).onFocus())})),zn(this,uv,$E.subscribe(async e=>{e&&(await this.resumePausedMutations(),St(this,co).onOnline())})))}unmount(){var e,t;KS(this,Fp)._--,St(this,Fp)===0&&((e=St(this,cv))==null||e.call(this),zn(this,cv,void 0),(t=St(this,uv))==null||t.call(this),zn(this,uv,void 0))}isFetching(e){return St(this,co).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return St(this,Mp).findAll({...e,status:"pending"}).length}getQueryData(e){var r;const t=this.defaultQueryOptions({queryKey:e});return(r=St(this,co).get(t.queryHash))==null?void 0:r.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),r=St(this,co).build(this,t),s=r.state.data;return s===void 0?this.fetchQuery(e):(e.revalidateIfStale&&r.isStaleByTime(rm(t.staleTime,r))&&this.prefetchQuery(t),Promise.resolve(s))}getQueriesData(e){return St(this,co).findAll(e).map(({queryKey:t,state:r})=>{const s=r.data;return[t,s]})}setQueryData(e,t,r){const s=this.defaultQueryOptions({queryKey:e}),u=St(this,co).get(s.queryHash),f=u==null?void 0:u.state.data,m=sie(t,f);if(m!==void 0)return St(this,co).build(this,s).setData(m,{...r,manual:!0})}setQueriesData(e,t,r){return Fo.batch(()=>St(this,co).findAll(e).map(({queryKey:s})=>[s,this.setQueryData(s,t,r)]))}getQueryState(e){var r;const t=this.defaultQueryOptions({queryKey:e});return(r=St(this,co).get(t.queryHash))==null?void 0:r.state}removeQueries(e){const t=St(this,co);Fo.batch(()=>{t.findAll(e).forEach(r=>{t.remove(r)})})}resetQueries(e,t){const r=St(this,co);return Fo.batch(()=>(r.findAll(e).forEach(s=>{s.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const r={revert:!0,...t},s=Fo.batch(()=>St(this,co).findAll(e).map(u=>u.cancel(r)));return Promise.all(s).then(Wl).catch(Wl)}invalidateQueries(e,t={}){return Fo.batch(()=>(St(this,co).findAll(e).forEach(r=>{r.invalidate()}),(e==null?void 0:e.refetchType)==="none"?Promise.resolve():this.refetchQueries({...e,type:(e==null?void 0:e.refetchType)??(e==null?void 0:e.type)??"active"},t)))}refetchQueries(e,t={}){const r={...t,cancelRefetch:t.cancelRefetch??!0},s=Fo.batch(()=>St(this,co).findAll(e).filter(u=>!u.isDisabled()&&!u.isStatic()).map(u=>{let f=u.fetch(void 0,r);return r.throwOnError||(f=f.catch(Wl)),u.state.fetchStatus==="paused"?Promise.resolve():f}));return Promise.all(s).then(Wl)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const r=St(this,co).build(this,t);return r.isStaleByTime(rm(t.staleTime,r))?r.fetch(t):Promise.resolve(r.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(Wl).catch(Wl)}fetchInfiniteQuery(e){return e.behavior=vz(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(Wl).catch(Wl)}ensureInfiniteQueryData(e){return e.behavior=vz(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return $E.isOnline()?St(this,Mp).resumePausedMutations():Promise.resolve()}getQueryCache(){return St(this,co)}getMutationCache(){return St(this,Mp)}getDefaultOptions(){return St(this,Op)}setDefaultOptions(e){zn(this,Op,e)}setQueryDefaults(e,t){St(this,ov).set(g_(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...St(this,ov).values()],r={};return t.forEach(s=>{hb(e,s.queryKey)&&Object.assign(r,s.defaultOptions)}),r}setMutationDefaults(e,t){St(this,lv).set(g_(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...St(this,lv).values()],r={};return t.forEach(s=>{hb(e,s.mutationKey)&&Object.assign(r,s.defaultOptions)}),r}defaultQueryOptions(e){if(e._defaulted)return e;const t={...St(this,Op).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=yR(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===wR&&(t.enabled=!1),t}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...St(this,Op).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){St(this,co).clear(),St(this,Mp).clear()}},co=new WeakMap,Mp=new WeakMap,Op=new WeakMap,ov=new WeakMap,lv=new WeakMap,Fp=new WeakMap,cv=new WeakMap,uv=new WeakMap,a6),gc,zs,Nb,ql,Qg,dv,Lp,zp,kb,hv,fv,e_,t_,Bp,pv,ua,gw,uP,dP,hP,fP,pP,mP,gP,c$,o6,wie=(o6=class extends Vv{constructor(t,r){super();_i(this,ua);_i(this,gc);_i(this,zs);_i(this,Nb);_i(this,ql);_i(this,Qg);_i(this,dv);_i(this,Lp);_i(this,zp);_i(this,kb);_i(this,hv);_i(this,fv);_i(this,e_);_i(this,t_);_i(this,Bp);_i(this,pv,new Set);this.options=r,zn(this,gc,t),zn(this,zp,null),zn(this,Lp,cP()),this.options.experimental_prefetchInRender||St(this,Lp).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(r)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(St(this,zs).addObserver(this),wz(St(this,zs),this.options)?ds(this,ua,gw).call(this):this.updateResult(),ds(this,ua,fP).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return _P(St(this,zs),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return _P(St(this,zs),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,ds(this,ua,pP).call(this),ds(this,ua,mP).call(this),St(this,zs).removeObserver(this)}setOptions(t){const r=this.options,s=St(this,zs);if(this.options=St(this,gc).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof xu(this.options.enabled,St(this,zs))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");ds(this,ua,gP).call(this),St(this,zs).setOptions(this.options),r._defaulted&&!VE(this.options,r)&&St(this,gc).getQueryCache().notify({type:"observerOptionsUpdated",query:St(this,zs),observer:this});const u=this.hasListeners();u&&bz(St(this,zs),s,this.options,r)&&ds(this,ua,gw).call(this),this.updateResult(),u&&(St(this,zs)!==s||xu(this.options.enabled,St(this,zs))!==xu(r.enabled,St(this,zs))||rm(this.options.staleTime,St(this,zs))!==rm(r.staleTime,St(this,zs)))&&ds(this,ua,uP).call(this);const f=ds(this,ua,dP).call(this);u&&(St(this,zs)!==s||xu(this.options.enabled,St(this,zs))!==xu(r.enabled,St(this,zs))||f!==St(this,Bp))&&ds(this,ua,hP).call(this,f)}getOptimisticResult(t){const r=St(this,gc).getQueryCache().build(St(this,gc),t),s=this.createResult(r,t);return Sie(this,s)&&(zn(this,ql,s),zn(this,dv,this.options),zn(this,Qg,St(this,zs).state)),s}getCurrentResult(){return St(this,ql)}trackResult(t,r){return new Proxy(t,{get:(s,u)=>(this.trackProp(u),r==null||r(u),Reflect.get(s,u))})}trackProp(t){St(this,pv).add(t)}getCurrentQuery(){return St(this,zs)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const r=St(this,gc).defaultQueryOptions(t),s=St(this,gc).getQueryCache().build(St(this,gc),r);return s.fetch().then(()=>this.createResult(s,r))}fetch(t){return ds(this,ua,gw).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),St(this,ql)))}createResult(t,r){var be;const s=St(this,zs),u=this.options,f=St(this,ql),m=St(this,Qg),i=St(this,dv),E=t!==s?t.state:St(this,Nb),{state:I}=t;let D={...I},M=!1,R;if(r._optimisticResults){const ke=this.hasListeners(),Oe=!ke&&wz(t,r),Ee=ke&&bz(t,s,r,u);(Oe||Ee)&&(D={...D,...o$(I.data,t.options)}),r._optimisticResults==="isRestoring"&&(D.fetchStatus="idle")}let{error:H,errorUpdatedAt:F,status:U}=D;R=D.data;let Y=!1;if(r.placeholderData!==void 0&&R===void 0&&U==="pending"){let ke;f!=null&&f.isPlaceholderData&&r.placeholderData===(i==null?void 0:i.placeholderData)?(ke=f.data,Y=!0):ke=typeof r.placeholderData=="function"?r.placeholderData((be=St(this,fv))==null?void 0:be.state.data,St(this,fv)):r.placeholderData,ke!==void 0&&(U="success",R=lP(f==null?void 0:f.data,ke,r),M=!0)}if(r.select&&R!==void 0&&!Y)if(f&&R===(m==null?void 0:m.data)&&r.select===St(this,kb))R=St(this,hv);else try{zn(this,kb,r.select),R=r.select(R),R=lP(f==null?void 0:f.data,R,r),zn(this,hv,R),zn(this,zp,null)}catch(ke){zn(this,zp,ke)}St(this,zp)&&(H=St(this,zp),R=St(this,hv),F=Date.now(),U="error");const z=D.fetchStatus==="fetching",J=U==="pending",ne=U==="error",me=J&&z,le=R!==void 0,pe={status:U,fetchStatus:D.fetchStatus,isPending:J,isSuccess:U==="success",isError:ne,isInitialLoading:me,isLoading:me,data:R,dataUpdatedAt:D.dataUpdatedAt,error:H,errorUpdatedAt:F,failureCount:D.fetchFailureCount,failureReason:D.fetchFailureReason,errorUpdateCount:D.errorUpdateCount,isFetched:D.dataUpdateCount>0||D.errorUpdateCount>0,isFetchedAfterMount:D.dataUpdateCount>E.dataUpdateCount||D.errorUpdateCount>E.errorUpdateCount,isFetching:z,isRefetching:z&&!J,isLoadingError:ne&&!le,isPaused:D.fetchStatus==="paused",isPlaceholderData:M,isRefetchError:ne&&le,isStale:SR(t,r),refetch:this.refetch,promise:St(this,Lp),isEnabled:xu(r.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const ke=qe=>{pe.status==="error"?qe.reject(pe.error):pe.data!==void 0&&qe.resolve(pe.data)},Oe=()=>{const qe=zn(this,Lp,pe.promise=cP());ke(qe)},Ee=St(this,Lp);switch(Ee.status){case"pending":t.queryHash===s.queryHash&&ke(Ee);break;case"fulfilled":(pe.status==="error"||pe.data!==Ee.value)&&Oe();break;case"rejected":(pe.status!=="error"||pe.error!==Ee.reason)&&Oe();break}}return pe}updateResult(){const t=St(this,ql),r=this.createResult(St(this,zs),this.options);if(zn(this,Qg,St(this,zs).state),zn(this,dv,this.options),St(this,Qg).data!==void 0&&zn(this,fv,St(this,zs)),VE(r,t))return;zn(this,ql,r);const s=()=>{if(!t)return!0;const{notifyOnChangeProps:u}=this.options,f=typeof u=="function"?u():u;if(f==="all"||!f&&!St(this,pv).size)return!0;const m=new Set(f??St(this,pv));return this.options.throwOnError&&m.add("error"),Object.keys(St(this,ql)).some(i=>{const S=i;return St(this,ql)[S]!==t[S]&&m.has(S)})};ds(this,ua,c$).call(this,{listeners:s()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&ds(this,ua,fP).call(this)}},gc=new WeakMap,zs=new WeakMap,Nb=new WeakMap,ql=new WeakMap,Qg=new WeakMap,dv=new WeakMap,Lp=new WeakMap,zp=new WeakMap,kb=new WeakMap,hv=new WeakMap,fv=new WeakMap,e_=new WeakMap,t_=new WeakMap,Bp=new WeakMap,pv=new WeakMap,ua=new WeakSet,gw=function(t){ds(this,ua,gP).call(this);let r=St(this,zs).fetch(this.options,t);return t!=null&&t.throwOnError||(r=r.catch(Wl)),r},uP=function(){ds(this,ua,pP).call(this);const t=rm(this.options.staleTime,St(this,zs));if(m_||St(this,ql).isStale||!aP(t))return;const s=Q8(St(this,ql).dataUpdatedAt,t)+1;zn(this,e_,setTimeout(()=>{St(this,ql).isStale||this.updateResult()},s))},dP=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(St(this,zs)):this.options.refetchInterval)??!1},hP=function(t){ds(this,ua,mP).call(this),zn(this,Bp,t),!(m_||xu(this.options.enabled,St(this,zs))===!1||!aP(St(this,Bp))||St(this,Bp)===0)&&zn(this,t_,setInterval(()=>{(this.options.refetchIntervalInBackground||bR.isFocused())&&ds(this,ua,gw).call(this)},St(this,Bp)))},fP=function(){ds(this,ua,uP).call(this),ds(this,ua,hP).call(this,ds(this,ua,dP).call(this))},pP=function(){St(this,e_)&&(clearTimeout(St(this,e_)),zn(this,e_,void 0))},mP=function(){St(this,t_)&&(clearInterval(St(this,t_)),zn(this,t_,void 0))},gP=function(){const t=St(this,gc).getQueryCache().build(St(this,gc),this.options);if(t===St(this,zs))return;const r=St(this,zs);zn(this,zs,t),zn(this,Nb,t.state),this.hasListeners()&&(r==null||r.removeObserver(this),t.addObserver(this))},c$=function(t){Fo.batch(()=>{t.listeners&&this.listeners.forEach(r=>{r(St(this,ql))}),St(this,gc).getQueryCache().notify({query:St(this,zs),type:"observerResultsUpdated"})})},o6);function bie(e,t){return xu(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function wz(e,t){return bie(e,t)||e.state.data!==void 0&&_P(e,t,t.refetchOnMount)}function _P(e,t,r){if(xu(t.enabled,e)!==!1&&rm(t.staleTime,e)!=="static"){const s=typeof r=="function"?r(e):r;return s==="always"||s!==!1&&SR(e,t)}return!1}function bz(e,t,r,s){return(e!==t||xu(s.enabled,e)===!1)&&(!r.suspense||e.state.status!=="error")&&SR(e,r)}function SR(e,t){return xu(t.enabled,e)!==!1&&e.isStaleByTime(rm(t.staleTime,e))}function Sie(e,t){return!VE(e.getCurrentResult(),t)}var Up,Vp,_c,Yh,hf,aE,xP,l6,Tie=(l6=class extends Vv{constructor(r,s){super();_i(this,hf);_i(this,Up);_i(this,Vp);_i(this,_c);_i(this,Yh);zn(this,Up,r),this.setOptions(s),this.bindMethods(),ds(this,hf,aE).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(r){var u;const s=this.options;this.options=St(this,Up).defaultMutationOptions(r),VE(this.options,s)||St(this,Up).getMutationCache().notify({type:"observerOptionsUpdated",mutation:St(this,_c),observer:this}),s!=null&&s.mutationKey&&this.options.mutationKey&&g_(s.mutationKey)!==g_(this.options.mutationKey)?this.reset():((u=St(this,_c))==null?void 0:u.state.status)==="pending"&&St(this,_c).setOptions(this.options)}onUnsubscribe(){var r;this.hasListeners()||(r=St(this,_c))==null||r.removeObserver(this)}onMutationUpdate(r){ds(this,hf,aE).call(this),ds(this,hf,xP).call(this,r)}getCurrentResult(){return St(this,Vp)}reset(){var r;(r=St(this,_c))==null||r.removeObserver(this),zn(this,_c,void 0),ds(this,hf,aE).call(this),ds(this,hf,xP).call(this)}mutate(r,s){var u;return zn(this,Yh,s),(u=St(this,_c))==null||u.removeObserver(this),zn(this,_c,St(this,Up).getMutationCache().build(St(this,Up),this.options)),St(this,_c).addObserver(this),St(this,_c).execute(r)}},Up=new WeakMap,Vp=new WeakMap,_c=new WeakMap,Yh=new WeakMap,hf=new WeakSet,aE=function(){var s;const r=((s=St(this,_c))==null?void 0:s.state)??l$();zn(this,Vp,{...r,isPending:r.status==="pending",isSuccess:r.status==="success",isError:r.status==="error",isIdle:r.status==="idle",mutate:this.mutate,reset:this.reset})},xP=function(r){Fo.batch(()=>{var s,u,f,m,i,S,E,I;if(St(this,Yh)&&this.hasListeners()){const D=St(this,Vp).variables,M=St(this,Vp).context;(r==null?void 0:r.type)==="success"?((u=(s=St(this,Yh)).onSuccess)==null||u.call(s,r.data,D,M),(m=(f=St(this,Yh)).onSettled)==null||m.call(f,r.data,null,D,M)):(r==null?void 0:r.type)==="error"&&((S=(i=St(this,Yh)).onError)==null||S.call(i,r.error,D,M),(I=(E=St(this,Yh)).onSettled)==null||I.call(E,void 0,r.error,D,M))}this.listeners.forEach(D=>{D(St(this,Vp))})})},l6),u$=V.createContext(void 0),Tm=e=>{const t=V.useContext(u$);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},Eie=({client:e,children:t})=>(V.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),c.jsx(u$.Provider,{value:e,children:t})),d$=V.createContext(!1),Cie=()=>V.useContext(d$);d$.Provider;function Aie(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var jie=V.createContext(Aie()),Iie=()=>V.useContext(jie),Nie=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))},kie=e=>{V.useEffect(()=>{e.clearReset()},[e])},Pie=({result:e,errorResetBoundary:t,throwOnError:r,query:s,suspense:u})=>e.isError&&!t.isReset()&&!e.isFetching&&s&&(u&&e.data===void 0||r$(r,[e.error,s])),Die=e=>{if(e.suspense){const t=s=>s==="static"?s:Math.max(s??1e3,1e3),r=e.staleTime;e.staleTime=typeof r=="function"?(...s)=>t(r(...s)):t(r),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},Rie=(e,t)=>e.isLoading&&e.isFetching&&!t,Mie=(e,t)=>(e==null?void 0:e.suspense)&&t.isPending,Sz=(e,t,r)=>t.fetchOptimistic(e).catch(()=>{r.clearReset()});function Oie(e,t,r){var D,M,R,H,F;const s=Cie(),u=Iie(),f=Tm(),m=f.defaultQueryOptions(e);(M=(D=f.getDefaultOptions().queries)==null?void 0:D._experimental_beforeQuery)==null||M.call(D,m),m._optimisticResults=s?"isRestoring":"optimistic",Die(m),Nie(m,u),kie(u);const i=!f.getQueryCache().get(m.queryHash),[S]=V.useState(()=>new t(f,m)),E=S.getOptimisticResult(m),I=!s&&e.subscribed!==!1;if(V.useSyncExternalStore(V.useCallback(U=>{const Y=I?S.subscribe(Fo.batchCalls(U)):Wl;return S.updateResult(),Y},[S,I]),()=>S.getCurrentResult(),()=>S.getCurrentResult()),V.useEffect(()=>{S.setOptions(m)},[m,S]),Mie(m,E))throw Sz(m,S,u);if(Pie({result:E,errorResetBoundary:u,throwOnError:m.throwOnError,query:f.getQueryCache().get(m.queryHash),suspense:m.suspense}))throw E.error;if((H=(R=f.getDefaultOptions().queries)==null?void 0:R._experimental_afterQuery)==null||H.call(R,m,E),m.experimental_prefetchInRender&&!m_&&Rie(E,s)){const U=i?Sz(m,S,u):(F=f.getQueryCache().get(m.queryHash))==null?void 0:F.promise;U==null||U.catch(Wl).finally(()=>{S.updateResult()})}return m.notifyOnChangeProps?E:S.trackResult(E)}function aa(e,t){return Oie(e,wie)}function ox(e,t){const r=Tm(),[s]=V.useState(()=>new Tie(r,e));V.useEffect(()=>{s.setOptions(e)},[s,e]);const u=V.useSyncExternalStore(V.useCallback(m=>s.subscribe(Fo.batchCalls(m)),[s]),()=>s.getCurrentResult(),()=>s.getCurrentResult()),f=V.useCallback((m,i)=>{s.mutate(m,i).catch(Wl)},[s]);if(u.error&&r$(s.options.throwOnError,[u.error]))throw u.error;return{...u,mutate:f,mutateAsync:u.mutate}}/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function fb(){return fb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},fb.apply(this,arguments)}var Gp;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Gp||(Gp={}));const Tz="popstate";function Fie(e){e===void 0&&(e={});function t(s,u){let{pathname:f,search:m,hash:i}=s.location;return vP("",{pathname:f,search:m,hash:i},u.state&&u.state.usr||null,u.state&&u.state.key||"default")}function r(s,u){return typeof u=="string"?u:qE(u)}return zie(t,r,null,e)}function eo(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function h$(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function Lie(){return Math.random().toString(36).substr(2,8)}function Ez(e,t){return{usr:e.state,key:e.key,idx:t}}function vP(e,t,r,s){return r===void 0&&(r=null),fb({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?$v(t):t,{state:r,key:t&&t.key||s||Lie()})}function qE(e){let{pathname:t="/",search:r="",hash:s=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),s&&s!=="#"&&(t+=s.charAt(0)==="#"?s:"#"+s),t}function $v(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let s=e.indexOf("?");s>=0&&(t.search=e.substr(s),e=e.substr(0,s)),e&&(t.pathname=e)}return t}function zie(e,t,r,s){s===void 0&&(s={});let{window:u=document.defaultView,v5Compat:f=!1}=s,m=u.history,i=Gp.Pop,S=null,E=I();E==null&&(E=0,m.replaceState(fb({},m.state,{idx:E}),""));function I(){return(m.state||{idx:null}).idx}function D(){i=Gp.Pop;let U=I(),Y=U==null?null:U-E;E=U,S&&S({action:i,location:F.location,delta:Y})}function M(U,Y){i=Gp.Push;let z=vP(F.location,U,Y);E=I()+1;let J=Ez(z,E),ne=F.createHref(z);try{m.pushState(J,"",ne)}catch(me){if(me instanceof DOMException&&me.name==="DataCloneError")throw me;u.location.assign(ne)}f&&S&&S({action:i,location:F.location,delta:1})}function R(U,Y){i=Gp.Replace;let z=vP(F.location,U,Y);E=I();let J=Ez(z,E),ne=F.createHref(z);m.replaceState(J,"",ne),f&&S&&S({action:i,location:F.location,delta:0})}function H(U){let Y=u.location.origin!=="null"?u.location.origin:u.location.href,z=typeof U=="string"?U:qE(U);return z=z.replace(/ $/,"%20"),eo(Y,"No window.location.(origin|href) available to create URL for href: "+z),new URL(z,Y)}let F={get action(){return i},get location(){return e(u,m)},listen(U){if(S)throw new Error("A history only accepts one active listener");return u.addEventListener(Tz,D),S=U,()=>{u.removeEventListener(Tz,D),S=null}},createHref(U){return t(u,U)},createURL:H,encodeLocation(U){let Y=H(U);return{pathname:Y.pathname,search:Y.search,hash:Y.hash}},push:M,replace:R,go(U){return m.go(U)}};return F}var Cz;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(Cz||(Cz={}));function Bie(e,t,r){return r===void 0&&(r="/"),Uie(e,t,r,!1)}function Uie(e,t,r,s){let u=typeof t=="string"?$v(t):t,f=Ev(u.pathname||"/",r);if(f==null)return null;let m=f$(e);Vie(m);let i=null;for(let S=0;i==null&&S<m.length;++S){let E=Qie(f);i=Kie(m[S],E,s)}return i}function f$(e,t,r,s){t===void 0&&(t=[]),r===void 0&&(r=[]),s===void 0&&(s="");let u=(f,m,i)=>{let S={relativePath:i===void 0?f.path||"":i,caseSensitive:f.caseSensitive===!0,childrenIndex:m,route:f};S.relativePath.startsWith("/")&&(eo(S.relativePath.startsWith(s),'Absolute route path "'+S.relativePath+'" nested under path '+('"'+s+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),S.relativePath=S.relativePath.slice(s.length));let E=nm([s,S.relativePath]),I=r.concat(S);f.children&&f.children.length>0&&(eo(f.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+E+'".')),f$(f.children,t,I,E)),!(f.path==null&&!f.index)&&t.push({path:E,score:Xie(E,f.index),routesMeta:I})};return e.forEach((f,m)=>{var i;if(f.path===""||!((i=f.path)!=null&&i.includes("?")))u(f,m);else for(let S of p$(f.path))u(f,m,S)}),t}function p$(e){let t=e.split("/");if(t.length===0)return[];let[r,...s]=t,u=r.endsWith("?"),f=r.replace(/\?$/,"");if(s.length===0)return u?[f,""]:[f];let m=p$(s.join("/")),i=[];return i.push(...m.map(S=>S===""?f:[f,S].join("/"))),u&&i.push(...m),i.map(S=>e.startsWith("/")&&S===""?"/":S)}function Vie(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:Yie(t.routesMeta.map(s=>s.childrenIndex),r.routesMeta.map(s=>s.childrenIndex)))}const $ie=/^:[\w-]+$/,qie=3,Gie=2,Wie=1,Hie=10,Zie=-2,Az=e=>e==="*";function Xie(e,t){let r=e.split("/"),s=r.length;return r.some(Az)&&(s+=Zie),t&&(s+=Gie),r.filter(u=>!Az(u)).reduce((u,f)=>u+($ie.test(f)?qie:f===""?Wie:Hie),s)}function Yie(e,t){return e.length===t.length&&e.slice(0,-1).every((s,u)=>s===t[u])?e[e.length-1]-t[t.length-1]:0}function Kie(e,t,r){let{routesMeta:s}=e,u={},f="/",m=[];for(let i=0;i<s.length;++i){let S=s[i],E=i===s.length-1,I=f==="/"?t:t.slice(f.length)||"/",D=GE({path:S.relativePath,caseSensitive:S.caseSensitive,end:E},I),M=S.route;if(!D&&E&&r&&!s[s.length-1].route.index&&(D=GE({path:S.relativePath,caseSensitive:S.caseSensitive,end:!1},I)),!D)return null;Object.assign(u,D.params),m.push({params:u,pathname:nm([f,D.pathname]),pathnameBase:nse(nm([f,D.pathnameBase])),route:M}),D.pathnameBase!=="/"&&(f=nm([f,D.pathnameBase]))}return m}function GE(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,s]=Jie(e.path,e.caseSensitive,e.end),u=t.match(r);if(!u)return null;let f=u[0],m=f.replace(/(.)\/+$/,"$1"),i=u.slice(1);return{params:s.reduce((E,I,D)=>{let{paramName:M,isOptional:R}=I;if(M==="*"){let F=i[D]||"";m=f.slice(0,f.length-F.length).replace(/(.)\/+$/,"$1")}const H=i[D];return R&&!H?E[M]=void 0:E[M]=(H||"").replace(/%2F/g,"/"),E},{}),pathname:f,pathnameBase:m,pattern:e}}function Jie(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),h$(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let s=[],u="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(m,i,S)=>(s.push({paramName:i,isOptional:S!=null}),S?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(s.push({paramName:"*"}),u+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?u+="\\/*$":e!==""&&e!=="/"&&(u+="(?:(?=\\/|$))"),[new RegExp(u,t?void 0:"i"),s]}function Qie(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return h$(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function Ev(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,s=e.charAt(r);return s&&s!=="/"?null:e.slice(r)||"/"}function ese(e,t){t===void 0&&(t="/");let{pathname:r,search:s="",hash:u=""}=typeof e=="string"?$v(e):e;return{pathname:r?r.startsWith("/")?r:tse(r,t):t,search:ise(s),hash:sse(u)}}function tse(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(u=>{u===".."?r.length>1&&r.pop():u!=="."&&r.push(u)}),r.length>1?r.join("/"):"/"}function pN(e,t,r,s){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(s)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function rse(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function TR(e,t){let r=rse(e);return t?r.map((s,u)=>u===r.length-1?s.pathname:s.pathnameBase):r.map(s=>s.pathnameBase)}function ER(e,t,r,s){s===void 0&&(s=!1);let u;typeof e=="string"?u=$v(e):(u=fb({},e),eo(!u.pathname||!u.pathname.includes("?"),pN("?","pathname","search",u)),eo(!u.pathname||!u.pathname.includes("#"),pN("#","pathname","hash",u)),eo(!u.search||!u.search.includes("#"),pN("#","search","hash",u)));let f=e===""||u.pathname==="",m=f?"/":u.pathname,i;if(m==null)i=r;else{let D=t.length-1;if(!s&&m.startsWith("..")){let M=m.split("/");for(;M[0]==="..";)M.shift(),D-=1;u.pathname=M.join("/")}i=D>=0?t[D]:"/"}let S=ese(u,i),E=m&&m!=="/"&&m.endsWith("/"),I=(f||m===".")&&r.endsWith("/");return!S.pathname.endsWith("/")&&(E||I)&&(S.pathname+="/"),S}const nm=e=>e.join("/").replace(/\/\/+/g,"/"),nse=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),ise=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,sse=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function ase(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const m$=["post","put","patch","delete"];new Set(m$);const ose=["get",...m$];new Set(ose);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function pb(){return pb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},pb.apply(this,arguments)}const nA=V.createContext(null),g$=V.createContext(null),Sf=V.createContext(null),iA=V.createContext(null),Em=V.createContext({outlet:null,matches:[],isDataRoute:!1}),_$=V.createContext(null);function lse(e,t){let{relative:r}=t===void 0?{}:t;qv()||eo(!1);let{basename:s,navigator:u}=V.useContext(Sf),{hash:f,pathname:m,search:i}=sA(e,{relative:r}),S=m;return s!=="/"&&(S=m==="/"?s:nm([s,m])),u.createHref({pathname:S,search:i,hash:f})}function qv(){return V.useContext(iA)!=null}function Tf(){return qv()||eo(!1),V.useContext(iA).location}function x$(e){V.useContext(Sf).static||V.useLayoutEffect(e)}function Id(){let{isDataRoute:e}=V.useContext(Em);return e?wse():cse()}function cse(){qv()||eo(!1);let e=V.useContext(nA),{basename:t,future:r,navigator:s}=V.useContext(Sf),{matches:u}=V.useContext(Em),{pathname:f}=Tf(),m=JSON.stringify(TR(u,r.v7_relativeSplatPath)),i=V.useRef(!1);return x$(()=>{i.current=!0}),V.useCallback(function(E,I){if(I===void 0&&(I={}),!i.current)return;if(typeof E=="number"){s.go(E);return}let D=ER(E,JSON.parse(m),f,I.relative==="path");e==null&&t!=="/"&&(D.pathname=D.pathname==="/"?t:nm([t,D.pathname])),(I.replace?s.replace:s.push)(D,I.state,I)},[t,s,m,f,e])}function sA(e,t){let{relative:r}=t===void 0?{}:t,{future:s}=V.useContext(Sf),{matches:u}=V.useContext(Em),{pathname:f}=Tf(),m=JSON.stringify(TR(u,s.v7_relativeSplatPath));return V.useMemo(()=>ER(e,JSON.parse(m),f,r==="path"),[e,m,f,r])}function use(e,t){return dse(e,t)}function dse(e,t,r,s){qv()||eo(!1);let{navigator:u}=V.useContext(Sf),{matches:f}=V.useContext(Em),m=f[f.length-1],i=m?m.params:{};m&&m.pathname;let S=m?m.pathnameBase:"/";m&&m.route;let E=Tf(),I;if(t){var D;let U=typeof t=="string"?$v(t):t;S==="/"||(D=U.pathname)!=null&&D.startsWith(S)||eo(!1),I=U}else I=E;let M=I.pathname||"/",R=M;if(S!=="/"){let U=S.replace(/^\//,"").split("/");R="/"+M.replace(/^\//,"").split("/").slice(U.length).join("/")}let H=Bie(e,{pathname:R}),F=gse(H&&H.map(U=>Object.assign({},U,{params:Object.assign({},i,U.params),pathname:nm([S,u.encodeLocation?u.encodeLocation(U.pathname).pathname:U.pathname]),pathnameBase:U.pathnameBase==="/"?S:nm([S,u.encodeLocation?u.encodeLocation(U.pathnameBase).pathname:U.pathnameBase])})),f,r,s);return t&&F?V.createElement(iA.Provider,{value:{location:pb({pathname:"/",search:"",hash:"",state:null,key:"default"},I),navigationType:Gp.Pop}},F):F}function hse(){let e=yse(),t=ase(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,u={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return V.createElement(V.Fragment,null,V.createElement("h2",null,"Unexpected Application Error!"),V.createElement("h3",{style:{fontStyle:"italic"}},t),r?V.createElement("pre",{style:u},r):null,null)}const fse=V.createElement(hse,null);class pse extends V.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error!==void 0?V.createElement(Em.Provider,{value:this.props.routeContext},V.createElement(_$.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function mse(e){let{routeContext:t,match:r,children:s}=e,u=V.useContext(nA);return u&&u.static&&u.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(u.staticContext._deepestRenderedBoundaryId=r.route.id),V.createElement(Em.Provider,{value:t},s)}function gse(e,t,r,s){var u;if(t===void 0&&(t=[]),r===void 0&&(r=null),s===void 0&&(s=null),e==null){var f;if(!r)return null;if(r.errors)e=r.matches;else if((f=s)!=null&&f.v7_partialHydration&&t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let m=e,i=(u=r)==null?void 0:u.errors;if(i!=null){let I=m.findIndex(D=>D.route.id&&(i==null?void 0:i[D.route.id])!==void 0);I>=0||eo(!1),m=m.slice(0,Math.min(m.length,I+1))}let S=!1,E=-1;if(r&&s&&s.v7_partialHydration)for(let I=0;I<m.length;I++){let D=m[I];if((D.route.HydrateFallback||D.route.hydrateFallbackElement)&&(E=I),D.route.id){let{loaderData:M,errors:R}=r,H=D.route.loader&&M[D.route.id]===void 0&&(!R||R[D.route.id]===void 0);if(D.route.lazy||H){S=!0,E>=0?m=m.slice(0,E+1):m=[m[0]];break}}}return m.reduceRight((I,D,M)=>{let R,H=!1,F=null,U=null;r&&(R=i&&D.route.id?i[D.route.id]:void 0,F=D.route.errorElement||fse,S&&(E<0&&M===0?(H=!0,U=null):E===M&&(H=!0,U=D.route.hydrateFallbackElement||null)));let Y=t.concat(m.slice(0,M+1)),z=()=>{let J;return R?J=F:H?J=U:D.route.Component?J=V.createElement(D.route.Component,null):D.route.element?J=D.route.element:J=I,V.createElement(mse,{match:D,routeContext:{outlet:I,matches:Y,isDataRoute:r!=null},children:J})};return r&&(D.route.ErrorBoundary||D.route.errorElement||M===0)?V.createElement(pse,{location:r.location,revalidation:r.revalidation,component:F,error:R,children:z(),routeContext:{outlet:null,matches:Y,isDataRoute:!0}}):z()},null)}var v$=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(v$||{}),WE=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(WE||{});function _se(e){let t=V.useContext(nA);return t||eo(!1),t}function xse(e){let t=V.useContext(g$);return t||eo(!1),t}function vse(e){let t=V.useContext(Em);return t||eo(!1),t}function y$(e){let t=vse(),r=t.matches[t.matches.length-1];return r.route.id||eo(!1),r.route.id}function yse(){var e;let t=V.useContext(_$),r=xse(WE.UseRouteError),s=y$(WE.UseRouteError);return t!==void 0?t:(e=r.errors)==null?void 0:e[s]}function wse(){let{router:e}=_se(v$.UseNavigateStable),t=y$(WE.UseNavigateStable),r=V.useRef(!1);return x$(()=>{r.current=!0}),V.useCallback(function(u,f){f===void 0&&(f={}),r.current&&(typeof u=="number"?e.navigate(u):e.navigate(u,pb({fromRouteId:t},f)))},[e,t])}function bse(e,t){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function Sse(e){let{to:t,replace:r,state:s,relative:u}=e;qv()||eo(!1);let{future:f,static:m}=V.useContext(Sf),{matches:i}=V.useContext(Em),{pathname:S}=Tf(),E=Id(),I=ER(t,TR(i,f.v7_relativeSplatPath),S,u==="path"),D=JSON.stringify(I);return V.useEffect(()=>E(JSON.parse(D),{replace:r,state:s,relative:u}),[E,D,u,r,s]),null}function ns(e){eo(!1)}function Tse(e){let{basename:t="/",children:r=null,location:s,navigationType:u=Gp.Pop,navigator:f,static:m=!1,future:i}=e;qv()&&eo(!1);let S=t.replace(/^\/*/,"/"),E=V.useMemo(()=>({basename:S,navigator:f,static:m,future:pb({v7_relativeSplatPath:!1},i)}),[S,i,f,m]);typeof s=="string"&&(s=$v(s));let{pathname:I="/",search:D="",hash:M="",state:R=null,key:H="default"}=s,F=V.useMemo(()=>{let U=Ev(I,S);return U==null?null:{location:{pathname:U,search:D,hash:M,state:R,key:H},navigationType:u}},[S,I,D,M,R,H,u]);return F==null?null:V.createElement(Sf.Provider,{value:E},V.createElement(iA.Provider,{children:r,value:F}))}function Ese(e){let{children:t,location:r}=e;return use(yP(t),r)}new Promise(()=>{});function yP(e,t){t===void 0&&(t=[]);let r=[];return V.Children.forEach(e,(s,u)=>{if(!V.isValidElement(s))return;let f=[...t,u];if(s.type===V.Fragment){r.push.apply(r,yP(s.props.children,f));return}s.type!==ns&&eo(!1),!s.props.index||!s.props.children||eo(!1);let m={id:s.props.id||f.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,loader:s.props.loader,action:s.props.action,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(m.children=yP(s.props.children,f)),r.push(m)}),r}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function HE(){return HE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},HE.apply(this,arguments)}function w$(e,t){if(e==null)return{};var r={},s=Object.keys(e),u,f;for(f=0;f<s.length;f++)u=s[f],!(t.indexOf(u)>=0)&&(r[u]=e[u]);return r}function Cse(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function Ase(e,t){return e.button===0&&(!t||t==="_self")&&!Cse(e)}const jse=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],Ise=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],Nse="6";try{window.__reactRouterVersion=Nse}catch{}const kse=V.createContext({isTransitioning:!1}),Pse="startTransition",jz=uD[Pse];function Dse(e){let{basename:t,children:r,future:s,window:u}=e,f=V.useRef();f.current==null&&(f.current=Fie({window:u,v5Compat:!0}));let m=f.current,[i,S]=V.useState({action:m.action,location:m.location}),{v7_startTransition:E}=s||{},I=V.useCallback(D=>{E&&jz?jz(()=>S(D)):S(D)},[S,E]);return V.useLayoutEffect(()=>m.listen(I),[m,I]),V.useEffect(()=>bse(s),[s]),V.createElement(Tse,{basename:t,children:r,location:i.location,navigationType:i.action,navigator:m,future:s})}const Rse=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Mse=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ose=V.forwardRef(function(t,r){let{onClick:s,relative:u,reloadDocument:f,replace:m,state:i,target:S,to:E,preventScrollReset:I,viewTransition:D}=t,M=w$(t,jse),{basename:R}=V.useContext(Sf),H,F=!1;if(typeof E=="string"&&Mse.test(E)&&(H=E,Rse))try{let J=new URL(window.location.href),ne=E.startsWith("//")?new URL(J.protocol+E):new URL(E),me=Ev(ne.pathname,R);ne.origin===J.origin&&me!=null?E=me+ne.search+ne.hash:F=!0}catch{}let U=lse(E,{relative:u}),Y=zse(E,{replace:m,state:i,target:S,preventScrollReset:I,relative:u,viewTransition:D});function z(J){s&&s(J),J.defaultPrevented||Y(J)}return V.createElement("a",HE({},M,{href:H||U,onClick:F||f?s:z,ref:r,target:S}))}),Fse=V.forwardRef(function(t,r){let{"aria-current":s="page",caseSensitive:u=!1,className:f="",end:m=!1,style:i,to:S,viewTransition:E,children:I}=t,D=w$(t,Ise),M=sA(S,{relative:D.relative}),R=Tf(),H=V.useContext(g$),{navigator:F,basename:U}=V.useContext(Sf),Y=H!=null&&Bse(M)&&E===!0,z=F.encodeLocation?F.encodeLocation(M).pathname:M.pathname,J=R.pathname,ne=H&&H.navigation&&H.navigation.location?H.navigation.location.pathname:null;u||(J=J.toLowerCase(),ne=ne?ne.toLowerCase():null,z=z.toLowerCase()),ne&&U&&(ne=Ev(ne,U)||ne);const me=z!=="/"&&z.endsWith("/")?z.length-1:z.length;let le=J===z||!m&&J.startsWith(z)&&J.charAt(me)==="/",ye=ne!=null&&(ne===z||!m&&ne.startsWith(z)&&ne.charAt(z.length)==="/"),pe={isActive:le,isPending:ye,isTransitioning:Y},be=le?s:void 0,ke;typeof f=="function"?ke=f(pe):ke=[f,le?"active":null,ye?"pending":null,Y?"transitioning":null].filter(Boolean).join(" ");let Oe=typeof i=="function"?i(pe):i;return V.createElement(Ose,HE({},D,{"aria-current":be,className:ke,ref:r,style:Oe,to:S,viewTransition:E}),typeof I=="function"?I(pe):I)});var wP;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(wP||(wP={}));var Iz;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(Iz||(Iz={}));function Lse(e){let t=V.useContext(nA);return t||eo(!1),t}function zse(e,t){let{target:r,replace:s,state:u,preventScrollReset:f,relative:m,viewTransition:i}=t===void 0?{}:t,S=Id(),E=Tf(),I=sA(e,{relative:m});return V.useCallback(D=>{if(Ase(D,r)){D.preventDefault();let M=s!==void 0?s:qE(E)===qE(I);S(e,{replace:M,state:u,preventScrollReset:f,relative:m,viewTransition:i})}},[E,S,I,s,u,r,e,f,m,i])}function Bse(e,t){t===void 0&&(t={});let r=V.useContext(kse);r==null&&eo(!1);let{basename:s}=Lse(wP.useViewTransitionState),u=sA(e,{relative:t.relative});if(!r.isTransitioning)return!1;let f=Ev(r.currentLocation.pathname,s)||r.currentLocation.pathname,m=Ev(r.nextLocation.pathname,s)||r.nextLocation.pathname;return GE(u.pathname,m)!=null||GE(u.pathname,f)!=null}var bP=function(e,t){return bP=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(r[u]=s[u])},bP(e,t)};function b$(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");bP(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var wu=function(){return wu=Object.assign||function(t){for(var r,s=1,u=arguments.length;s<u;s++){r=arguments[s];for(var f in r)Object.prototype.hasOwnProperty.call(r,f)&&(t[f]=r[f])}return t},wu.apply(this,arguments)};function Cm(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,s=Object.getOwnPropertySymbols(e);u<s.length;u++)t.indexOf(s[u])<0&&Object.prototype.propertyIsEnumerable.call(e,s[u])&&(r[s[u]]=e[s[u]]);return r}function S$(e,t,r,s){var u=arguments.length,f=u<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,r):s,m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(e,t,r,s);else for(var i=e.length-1;i>=0;i--)(m=e[i])&&(f=(u<3?m(f):u>3?m(t,r,f):m(t,r))||f);return u>3&&f&&Object.defineProperty(t,r,f),f}function T$(e,t){return function(r,s){t(r,s,e)}}function E$(e,t,r,s,u,f){function m(Y){if(Y!==void 0&&typeof Y!="function")throw new TypeError("Function expected");return Y}for(var i=s.kind,S=i==="getter"?"get":i==="setter"?"set":"value",E=!t&&e?s.static?e:e.prototype:null,I=t||(E?Object.getOwnPropertyDescriptor(E,s.name):{}),D,M=!1,R=r.length-1;R>=0;R--){var H={};for(var F in s)H[F]=F==="access"?{}:s[F];for(var F in s.access)H.access[F]=s.access[F];H.addInitializer=function(Y){if(M)throw new TypeError("Cannot add initializers after decoration has completed");f.push(m(Y||null))};var U=(0,r[R])(i==="accessor"?{get:I.get,set:I.set}:I[S],H);if(i==="accessor"){if(U===void 0)continue;if(U===null||typeof U!="object")throw new TypeError("Object expected");(D=m(U.get))&&(I.get=D),(D=m(U.set))&&(I.set=D),(D=m(U.init))&&u.unshift(D)}else(D=m(U))&&(i==="field"?u.unshift(D):I[S]=D)}E&&Object.defineProperty(E,s.name,I),M=!0}function C$(e,t,r){for(var s=arguments.length>2,u=0;u<t.length;u++)r=s?t[u].call(e,r):t[u].call(e);return s?r:void 0}function A$(e){return typeof e=="symbol"?e:"".concat(e)}function j$(e,t,r){return typeof t=="symbol"&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:r?"".concat(r," ",t):t})}function I$(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)}function ni(e,t,r,s){function u(f){return f instanceof r?f:new r(function(m){m(f)})}return new(r||(r=Promise))(function(f,m){function i(I){try{E(s.next(I))}catch(D){m(D)}}function S(I){try{E(s.throw(I))}catch(D){m(D)}}function E(I){I.done?f(I.value):u(I.value).then(i,S)}E((s=s.apply(e,t||[])).next())})}function N$(e,t){var r={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},s,u,f,m=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return m.next=i(0),m.throw=i(1),m.return=i(2),typeof Symbol=="function"&&(m[Symbol.iterator]=function(){return this}),m;function i(E){return function(I){return S([E,I])}}function S(E){if(s)throw new TypeError("Generator is already executing.");for(;m&&(m=0,E[0]&&(r=0)),r;)try{if(s=1,u&&(f=E[0]&2?u.return:E[0]?u.throw||((f=u.return)&&f.call(u),0):u.next)&&!(f=f.call(u,E[1])).done)return f;switch(u=0,f&&(E=[E[0]&2,f.value]),E[0]){case 0:case 1:f=E;break;case 4:return r.label++,{value:E[1],done:!1};case 5:r.label++,u=E[1],E=[0];continue;case 7:E=r.ops.pop(),r.trys.pop();continue;default:if(f=r.trys,!(f=f.length>0&&f[f.length-1])&&(E[0]===6||E[0]===2)){r=0;continue}if(E[0]===3&&(!f||E[1]>f[0]&&E[1]<f[3])){r.label=E[1];break}if(E[0]===6&&r.label<f[1]){r.label=f[1],f=E;break}if(f&&r.label<f[2]){r.label=f[2],r.ops.push(E);break}f[2]&&r.ops.pop(),r.trys.pop();continue}E=t.call(e,r)}catch(I){E=[6,I],u=0}finally{s=f=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}}var aA=Object.create?function(e,t,r,s){s===void 0&&(s=r);var u=Object.getOwnPropertyDescriptor(t,r);(!u||("get"in u?!t.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,u)}:function(e,t,r,s){s===void 0&&(s=r),e[s]=t[r]};function k$(e,t){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r)&&aA(t,e,r)}function ZE(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],s=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&s>=e.length&&(e=void 0),{value:e&&e[s++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function CR(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var s=r.call(e),u,f=[],m;try{for(;(t===void 0||t-- >0)&&!(u=s.next()).done;)f.push(u.value)}catch(i){m={error:i}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(m)throw m.error}}return f}function P$(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(CR(arguments[t]));return e}function D$(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var s=Array(e),u=0,t=0;t<r;t++)for(var f=arguments[t],m=0,i=f.length;m<i;m++,u++)s[u]=f[m];return s}function AR(e,t,r){if(r||arguments.length===2)for(var s=0,u=t.length,f;s<u;s++)(f||!(s in t))&&(f||(f=Array.prototype.slice.call(t,0,s)),f[s]=t[s]);return e.concat(f||Array.prototype.slice.call(t))}function Cv(e){return this instanceof Cv?(this.v=e,this):new Cv(e)}function R$(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=r.apply(e,t||[]),u,f=[];return u=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),i("next"),i("throw"),i("return",m),u[Symbol.asyncIterator]=function(){return this},u;function m(R){return function(H){return Promise.resolve(H).then(R,D)}}function i(R,H){s[R]&&(u[R]=function(F){return new Promise(function(U,Y){f.push([R,F,U,Y])>1||S(R,F)})},H&&(u[R]=H(u[R])))}function S(R,H){try{E(s[R](H))}catch(F){M(f[0][3],F)}}function E(R){R.value instanceof Cv?Promise.resolve(R.value.v).then(I,D):M(f[0][2],R)}function I(R){S("next",R)}function D(R){S("throw",R)}function M(R,H){R(H),f.shift(),f.length&&S(f[0][0],f[0][1])}}function M$(e){var t,r;return t={},s("next"),s("throw",function(u){throw u}),s("return"),t[Symbol.iterator]=function(){return this},t;function s(u,f){t[u]=e[u]?function(m){return(r=!r)?{value:Cv(e[u](m)),done:!1}:f?f(m):m}:f}}function O$(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof ZE=="function"?ZE(e):e[Symbol.iterator](),r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r);function s(f){r[f]=e[f]&&function(m){return new Promise(function(i,S){m=e[f](m),u(i,S,m.done,m.value)})}}function u(f,m,i,S){Promise.resolve(S).then(function(E){f({value:E,done:i})},m)}}function F$(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var Use=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},SP=function(e){return SP=Object.getOwnPropertyNames||function(t){var r=[];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(r[r.length]=s);return r},SP(e)};function L$(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=SP(e),s=0;s<r.length;s++)r[s]!=="default"&&aA(t,e,r[s]);return Use(t,e),t}function z$(e){return e&&e.__esModule?e:{default:e}}function B$(e,t,r,s){if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?s:r==="a"?s.call(e):s?s.value:t.get(e)}function U$(e,t,r,s,u){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!u)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!u:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?u.call(e,r):u?u.value=r:t.set(e,r),r}function V$(e,t){if(t===null||typeof t!="object"&&typeof t!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof e=="function"?t===e:e.has(t)}function $$(e,t,r){if(t!=null){if(typeof t!="object"&&typeof t!="function")throw new TypeError("Object expected.");var s,u;if(r){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");s=t[Symbol.asyncDispose]}if(s===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");s=t[Symbol.dispose],r&&(u=s)}if(typeof s!="function")throw new TypeError("Object not disposable.");u&&(s=function(){try{u.call(this)}catch(f){return Promise.reject(f)}}),e.stack.push({value:t,dispose:s,async:r})}else r&&e.stack.push({async:!0});return t}var Vse=typeof SuppressedError=="function"?SuppressedError:function(e,t,r){var s=new Error(r);return s.name="SuppressedError",s.error=e,s.suppressed=t,s};function q$(e){function t(f){e.error=e.hasError?new Vse(f,e.error,"An error was suppressed during disposal."):f,e.hasError=!0}var r,s=0;function u(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(u);if(r.dispose){var f=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(f).then(u,function(m){return t(m),u()})}else s|=1}catch(m){t(m)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return u()}function G$(e,t){return typeof e=="string"&&/^\.\.?\//.test(e)?e.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(r,s,u,f,m){return s?t?".jsx":".js":u&&(!f||!m)?r:u+f+"."+m.toLowerCase()+"js"}):e}const $se={__extends:b$,__assign:wu,__rest:Cm,__decorate:S$,__param:T$,__esDecorate:E$,__runInitializers:C$,__propKey:A$,__setFunctionName:j$,__metadata:I$,__awaiter:ni,__generator:N$,__createBinding:aA,__exportStar:k$,__values:ZE,__read:CR,__spread:P$,__spreadArrays:D$,__spreadArray:AR,__await:Cv,__asyncGenerator:R$,__asyncDelegator:M$,__asyncValues:O$,__makeTemplateObject:F$,__importStar:L$,__importDefault:z$,__classPrivateFieldGet:B$,__classPrivateFieldSet:U$,__classPrivateFieldIn:V$,__addDisposableResource:$$,__disposeResources:q$,__rewriteRelativeImportExtension:G$},qse=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:$$,get __assign(){return wu},__asyncDelegator:M$,__asyncGenerator:R$,__asyncValues:O$,__await:Cv,__awaiter:ni,__classPrivateFieldGet:B$,__classPrivateFieldIn:V$,__classPrivateFieldSet:U$,__createBinding:aA,__decorate:S$,__disposeResources:q$,__esDecorate:E$,__exportStar:k$,__extends:b$,__generator:N$,__importDefault:z$,__importStar:L$,__makeTemplateObject:F$,__metadata:I$,__param:T$,__propKey:A$,__read:CR,__rest:Cm,__rewriteRelativeImportExtension:G$,__runInitializers:C$,__setFunctionName:j$,__spread:P$,__spreadArray:AR,__spreadArrays:D$,__values:ZE,default:$se},Symbol.toStringTag,{value:"Module"})),Gse=e=>e?(...t)=>e(...t):(...t)=>fetch(...t);class jR extends Error{constructor(t,r="FunctionsError",s){super(t),this.name=r,this.context=s}}class Nz extends jR{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class kz extends jR{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class Pz extends jR{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var TP;(function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"})(TP||(TP={}));class Wse{constructor(t,{headers:r={},customFetch:s,region:u=TP.Any}={}){this.url=t,this.headers=r,this.region=u,this.fetch=Gse(s)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return ni(this,arguments,void 0,function*(r,s={}){var u;try{const{headers:f,method:m,body:i,signal:S}=s;let E={},{region:I}=s;I||(I=this.region);const D=new URL(`${this.url}/${r}`);I&&I!=="any"&&(E["x-region"]=I,D.searchParams.set("forceFunctionRegion",I));let M;i&&(f&&!Object.prototype.hasOwnProperty.call(f,"Content-Type")||!f)?typeof Blob<"u"&&i instanceof Blob||i instanceof ArrayBuffer?(E["Content-Type"]="application/octet-stream",M=i):typeof i=="string"?(E["Content-Type"]="text/plain",M=i):typeof FormData<"u"&&i instanceof FormData?M=i:(E["Content-Type"]="application/json",M=JSON.stringify(i)):M=i;const R=yield this.fetch(D.toString(),{method:m||"POST",headers:Object.assign(Object.assign(Object.assign({},E),this.headers),f),body:M,signal:S}).catch(Y=>{throw Y.name==="AbortError"?Y:new Nz(Y)}),H=R.headers.get("x-relay-error");if(H&&H==="true")throw new kz(R);if(!R.ok)throw new Pz(R);let F=((u=R.headers.get("Content-Type"))!==null&&u!==void 0?u:"text/plain").split(";")[0].trim(),U;return F==="application/json"?U=yield R.json():F==="application/octet-stream"||F==="application/pdf"?U=yield R.blob():F==="text/event-stream"?U=R:F==="multipart/form-data"?U=yield R.formData():U=yield R.text(),{data:U,error:null,response:R}}catch(f){return f instanceof Error&&f.name==="AbortError"?{data:null,error:new Nz(f)}:{data:null,error:f,response:f instanceof Pz||f instanceof kz?f.context:void 0}}})}}var Kl={};const Gv=cK(qse);var yT={},wT={},bT={},ST={},TT={},ET={},Dz;function W$(){if(Dz)return ET;Dz=1,Object.defineProperty(ET,"__esModule",{value:!0});class e extends Error{constructor(r){super(r.message),this.name="PostgrestError",this.details=r.details,this.hint=r.hint,this.code=r.code}}return ET.default=e,ET}var Rz;function H$(){if(Rz)return TT;Rz=1,Object.defineProperty(TT,"__esModule",{value:!0});const t=Gv.__importDefault(W$());class r{constructor(u){var f,m;this.shouldThrowOnError=!1,this.method=u.method,this.url=u.url,this.headers=new Headers(u.headers),this.schema=u.schema,this.body=u.body,this.shouldThrowOnError=(f=u.shouldThrowOnError)!==null&&f!==void 0?f:!1,this.signal=u.signal,this.isMaybeSingle=(m=u.isMaybeSingle)!==null&&m!==void 0?m:!1,u.fetch?this.fetch=u.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(u,f){return this.headers=new Headers(this.headers),this.headers.set(u,f),this}then(u,f){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const m=this.fetch;let i=m(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async S=>{var E,I,D,M;let R=null,H=null,F=null,U=S.status,Y=S.statusText;if(S.ok){if(this.method!=="HEAD"){const me=await S.text();me===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((E=this.headers.get("Accept"))===null||E===void 0)&&E.includes("application/vnd.pgrst.plan+text"))?H=me:H=JSON.parse(me))}const J=(I=this.headers.get("Prefer"))===null||I===void 0?void 0:I.match(/count=(exact|planned|estimated)/),ne=(D=S.headers.get("content-range"))===null||D===void 0?void 0:D.split("/");J&&ne&&ne.length>1&&(F=parseInt(ne[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(H)&&(H.length>1?(R={code:"PGRST116",details:`Results contain ${H.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},H=null,F=null,U=406,Y="Not Acceptable"):H.length===1?H=H[0]:H=null)}else{const J=await S.text();try{R=JSON.parse(J),Array.isArray(R)&&S.status===404&&(H=[],R=null,U=200,Y="OK")}catch{S.status===404&&J===""?(U=204,Y="No Content"):R={message:J}}if(R&&this.isMaybeSingle&&(!((M=R==null?void 0:R.details)===null||M===void 0)&&M.includes("0 rows"))&&(R=null,U=200,Y="OK"),R&&this.shouldThrowOnError)throw new t.default(R)}return{error:R,data:H,count:F,status:U,statusText:Y}});return this.shouldThrowOnError||(i=i.catch(S=>{var E,I,D;return{error:{message:`${(E=S==null?void 0:S.name)!==null&&E!==void 0?E:"FetchError"}: ${S==null?void 0:S.message}`,details:`${(I=S==null?void 0:S.stack)!==null&&I!==void 0?I:""}`,hint:"",code:`${(D=S==null?void 0:S.code)!==null&&D!==void 0?D:""}`},data:null,count:null,status:0,statusText:""}})),i.then(u,f)}returns(){return this}overrideTypes(){return this}}return TT.default=r,TT}var Mz;function Z$(){if(Mz)return ST;Mz=1,Object.defineProperty(ST,"__esModule",{value:!0});const t=Gv.__importDefault(H$());class r extends t.default{select(u){let f=!1;const m=(u??"*").split("").map(i=>/\s/.test(i)&&!f?"":(i==='"'&&(f=!f),i)).join("");return this.url.searchParams.set("select",m),this.headers.append("Prefer","return=representation"),this}order(u,{ascending:f=!0,nullsFirst:m,foreignTable:i,referencedTable:S=i}={}){const E=S?`${S}.order`:"order",I=this.url.searchParams.get(E);return this.url.searchParams.set(E,`${I?`${I},`:""}${u}.${f?"asc":"desc"}${m===void 0?"":m?".nullsfirst":".nullslast"}`),this}limit(u,{foreignTable:f,referencedTable:m=f}={}){const i=typeof m>"u"?"limit":`${m}.limit`;return this.url.searchParams.set(i,`${u}`),this}range(u,f,{foreignTable:m,referencedTable:i=m}={}){const S=typeof i>"u"?"offset":`${i}.offset`,E=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(S,`${u}`),this.url.searchParams.set(E,`${f-u+1}`),this}abortSignal(u){return this.signal=u,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:u=!1,verbose:f=!1,settings:m=!1,buffers:i=!1,wal:S=!1,format:E="text"}={}){var I;const D=[u?"analyze":null,f?"verbose":null,m?"settings":null,i?"buffers":null,S?"wal":null].filter(Boolean).join("|"),M=(I=this.headers.get("Accept"))!==null&&I!==void 0?I:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${E}; for="${M}"; options=${D};`),E==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(u){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${u}`),this}}return ST.default=r,ST}var Oz;function IR(){if(Oz)return bT;Oz=1,Object.defineProperty(bT,"__esModule",{value:!0});const t=Gv.__importDefault(Z$()),r=new RegExp("[,()]");class s extends t.default{eq(f,m){return this.url.searchParams.append(f,`eq.${m}`),this}neq(f,m){return this.url.searchParams.append(f,`neq.${m}`),this}gt(f,m){return this.url.searchParams.append(f,`gt.${m}`),this}gte(f,m){return this.url.searchParams.append(f,`gte.${m}`),this}lt(f,m){return this.url.searchParams.append(f,`lt.${m}`),this}lte(f,m){return this.url.searchParams.append(f,`lte.${m}`),this}like(f,m){return this.url.searchParams.append(f,`like.${m}`),this}likeAllOf(f,m){return this.url.searchParams.append(f,`like(all).{${m.join(",")}}`),this}likeAnyOf(f,m){return this.url.searchParams.append(f,`like(any).{${m.join(",")}}`),this}ilike(f,m){return this.url.searchParams.append(f,`ilike.${m}`),this}ilikeAllOf(f,m){return this.url.searchParams.append(f,`ilike(all).{${m.join(",")}}`),this}ilikeAnyOf(f,m){return this.url.searchParams.append(f,`ilike(any).{${m.join(",")}}`),this}is(f,m){return this.url.searchParams.append(f,`is.${m}`),this}in(f,m){const i=Array.from(new Set(m)).map(S=>typeof S=="string"&&r.test(S)?`"${S}"`:`${S}`).join(",");return this.url.searchParams.append(f,`in.(${i})`),this}contains(f,m){return typeof m=="string"?this.url.searchParams.append(f,`cs.${m}`):Array.isArray(m)?this.url.searchParams.append(f,`cs.{${m.join(",")}}`):this.url.searchParams.append(f,`cs.${JSON.stringify(m)}`),this}containedBy(f,m){return typeof m=="string"?this.url.searchParams.append(f,`cd.${m}`):Array.isArray(m)?this.url.searchParams.append(f,`cd.{${m.join(",")}}`):this.url.searchParams.append(f,`cd.${JSON.stringify(m)}`),this}rangeGt(f,m){return this.url.searchParams.append(f,`sr.${m}`),this}rangeGte(f,m){return this.url.searchParams.append(f,`nxl.${m}`),this}rangeLt(f,m){return this.url.searchParams.append(f,`sl.${m}`),this}rangeLte(f,m){return this.url.searchParams.append(f,`nxr.${m}`),this}rangeAdjacent(f,m){return this.url.searchParams.append(f,`adj.${m}`),this}overlaps(f,m){return typeof m=="string"?this.url.searchParams.append(f,`ov.${m}`):this.url.searchParams.append(f,`ov.{${m.join(",")}}`),this}textSearch(f,m,{config:i,type:S}={}){let E="";S==="plain"?E="pl":S==="phrase"?E="ph":S==="websearch"&&(E="w");const I=i===void 0?"":`(${i})`;return this.url.searchParams.append(f,`${E}fts${I}.${m}`),this}match(f){return Object.entries(f).forEach(([m,i])=>{this.url.searchParams.append(m,`eq.${i}`)}),this}not(f,m,i){return this.url.searchParams.append(f,`not.${m}.${i}`),this}or(f,{foreignTable:m,referencedTable:i=m}={}){const S=i?`${i}.or`:"or";return this.url.searchParams.append(S,`(${f})`),this}filter(f,m,i){return this.url.searchParams.append(f,`${m}.${i}`),this}}return bT.default=s,bT}var Fz;function X$(){if(Fz)return wT;Fz=1,Object.defineProperty(wT,"__esModule",{value:!0});const t=Gv.__importDefault(IR());class r{constructor(u,{headers:f={},schema:m,fetch:i}){this.url=u,this.headers=new Headers(f),this.schema=m,this.fetch=i}select(u,f){const{head:m=!1,count:i}=f??{},S=m?"HEAD":"GET";let E=!1;const I=(u??"*").split("").map(D=>/\s/.test(D)&&!E?"":(D==='"'&&(E=!E),D)).join("");return this.url.searchParams.set("select",I),i&&this.headers.append("Prefer",`count=${i}`),new t.default({method:S,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(u,{count:f,defaultToNull:m=!0}={}){var i;const S="POST";if(f&&this.headers.append("Prefer",`count=${f}`),m||this.headers.append("Prefer","missing=default"),Array.isArray(u)){const E=u.reduce((I,D)=>I.concat(Object.keys(D)),[]);if(E.length>0){const I=[...new Set(E)].map(D=>`"${D}"`);this.url.searchParams.set("columns",I.join(","))}}return new t.default({method:S,url:this.url,headers:this.headers,schema:this.schema,body:u,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}upsert(u,{onConflict:f,ignoreDuplicates:m=!1,count:i,defaultToNull:S=!0}={}){var E;const I="POST";if(this.headers.append("Prefer",`resolution=${m?"ignore":"merge"}-duplicates`),f!==void 0&&this.url.searchParams.set("on_conflict",f),i&&this.headers.append("Prefer",`count=${i}`),S||this.headers.append("Prefer","missing=default"),Array.isArray(u)){const D=u.reduce((M,R)=>M.concat(Object.keys(R)),[]);if(D.length>0){const M=[...new Set(D)].map(R=>`"${R}"`);this.url.searchParams.set("columns",M.join(","))}}return new t.default({method:I,url:this.url,headers:this.headers,schema:this.schema,body:u,fetch:(E=this.fetch)!==null&&E!==void 0?E:fetch})}update(u,{count:f}={}){var m;const i="PATCH";return f&&this.headers.append("Prefer",`count=${f}`),new t.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:u,fetch:(m=this.fetch)!==null&&m!==void 0?m:fetch})}delete({count:u}={}){var f;const m="DELETE";return u&&this.headers.append("Prefer",`count=${u}`),new t.default({method:m,url:this.url,headers:this.headers,schema:this.schema,fetch:(f=this.fetch)!==null&&f!==void 0?f:fetch})}}return wT.default=r,wT}var Lz;function Hse(){if(Lz)return yT;Lz=1,Object.defineProperty(yT,"__esModule",{value:!0});const e=Gv,t=e.__importDefault(X$()),r=e.__importDefault(IR());class s{constructor(f,{headers:m={},schema:i,fetch:S}={}){this.url=f,this.headers=new Headers(m),this.schemaName=i,this.fetch=S}from(f){const m=new URL(`${this.url}/${f}`);return new t.default(m,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(f){return new s(this.url,{headers:this.headers,schema:f,fetch:this.fetch})}rpc(f,m={},{head:i=!1,get:S=!1,count:E}={}){var I;let D;const M=new URL(`${this.url}/rpc/${f}`);let R;i||S?(D=i?"HEAD":"GET",Object.entries(m).filter(([F,U])=>U!==void 0).map(([F,U])=>[F,Array.isArray(U)?`{${U.join(",")}}`:`${U}`]).forEach(([F,U])=>{M.searchParams.append(F,U)})):(D="POST",R=m);const H=new Headers(this.headers);return E&&H.set("Prefer",`count=${E}`),new r.default({method:D,url:M,headers:H,schema:this.schemaName,body:R,fetch:(I=this.fetch)!==null&&I!==void 0?I:fetch})}}return yT.default=s,yT}Object.defineProperty(Kl,"__esModule",{value:!0});var Y$=Kl.PostgrestError=a9=Kl.PostgrestBuilder=i9=Kl.PostgrestTransformBuilder=r9=Kl.PostgrestFilterBuilder=e9=Kl.PostgrestQueryBuilder=J$=Kl.PostgrestClient=void 0;const Wv=Gv,K$=Wv.__importDefault(Hse());var J$=Kl.PostgrestClient=K$.default;const Q$=Wv.__importDefault(X$());var e9=Kl.PostgrestQueryBuilder=Q$.default;const t9=Wv.__importDefault(IR());var r9=Kl.PostgrestFilterBuilder=t9.default;const n9=Wv.__importDefault(Z$());var i9=Kl.PostgrestTransformBuilder=n9.default;const s9=Wv.__importDefault(H$());var a9=Kl.PostgrestBuilder=s9.default;const o9=Wv.__importDefault(W$());Y$=Kl.PostgrestError=o9.default;var l9=Kl.default={PostgrestClient:K$.default,PostgrestQueryBuilder:Q$.default,PostgrestFilterBuilder:t9.default,PostgrestTransformBuilder:n9.default,PostgrestBuilder:s9.default,PostgrestError:o9.default};const Zse=c6({__proto__:null,get PostgrestBuilder(){return a9},get PostgrestClient(){return J$},get PostgrestError(){return Y$},get PostgrestFilterBuilder(){return r9},get PostgrestQueryBuilder(){return e9},get PostgrestTransformBuilder(){return i9},default:l9},[Kl]),{PostgrestClient:Xse,PostgrestQueryBuilder:A2e,PostgrestFilterBuilder:j2e,PostgrestTransformBuilder:I2e,PostgrestBuilder:N2e,PostgrestError:k2e}=l9||Zse;class Yse{static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const r=process.versions;if(r&&r.node){const s=r.node,u=parseInt(s.replace(/^v/,"").split(".")[0]);return u>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${u} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${u} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let r=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(r+=`

Suggested solution: ${t.workaround}`),new Error(r)}static createWebSocket(t,r){const s=this.getWebSocketConstructor();return new s(t,r)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const Kse="2.80.0",Jse=`realtime-js/${Kse}`,Qse="1.0.0",EP=1e4,eae=1e3,tae=100;var Dw;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(Dw||(Dw={}));var Do;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(Do||(Do={}));var dd;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"})(dd||(dd={}));var CP;(function(e){e.websocket="websocket"})(CP||(CP={}));var Fg;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"})(Fg||(Fg={}));class rae{constructor(){this.HEADER_LENGTH=1}decode(t,r){return t.constructor===ArrayBuffer?r(this._binaryDecode(t)):r(typeof t=="string"?JSON.parse(t):{})}_binaryDecode(t){const r=new DataView(t),s=new TextDecoder;return this._decodeBroadcast(t,r,s)}_decodeBroadcast(t,r,s){const u=r.getUint8(1),f=r.getUint8(2);let m=this.HEADER_LENGTH+2;const i=s.decode(t.slice(m,m+u));m=m+u;const S=s.decode(t.slice(m,m+f));m=m+f;const E=JSON.parse(s.decode(t.slice(m,t.byteLength)));return{ref:null,topic:i,event:S,payload:E}}}class c9{constructor(t,r){this.callback=t,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Na;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(Na||(Na={}));const zz=(e,t,r={})=>{var s;const u=(s=r.skipTypes)!==null&&s!==void 0?s:[];return t?Object.keys(t).reduce((f,m)=>(f[m]=nae(m,e,t,u),f),{}):{}},nae=(e,t,r,s)=>{const u=t.find(i=>i.name===e),f=u==null?void 0:u.type,m=r[e];return f&&!s.includes(f)?u9(f,m):AP(m)},u9=(e,t)=>{if(e.charAt(0)==="_"){const r=e.slice(1,e.length);return oae(t,r)}switch(e){case Na.bool:return iae(t);case Na.float4:case Na.float8:case Na.int2:case Na.int4:case Na.int8:case Na.numeric:case Na.oid:return sae(t);case Na.json:case Na.jsonb:return aae(t);case Na.timestamp:return lae(t);case Na.abstime:case Na.date:case Na.daterange:case Na.int4range:case Na.int8range:case Na.money:case Na.reltime:case Na.text:case Na.time:case Na.timestamptz:case Na.timetz:case Na.tsrange:case Na.tstzrange:return AP(t);default:return AP(t)}},AP=e=>e,iae=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},sae=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},aae=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},oae=(e,t)=>{if(typeof e!="string")return e;const r=e.length-1,s=e[r];if(e[0]==="{"&&s==="}"){let f;const m=e.slice(1,r);try{f=JSON.parse("["+m+"]")}catch{f=m?m.split(","):[]}return f.map(i=>u9(t,i))}return e},lae=e=>typeof e=="string"?e.replace(" ","T"):e,d9=e=>{const t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class mN{constructor(t,r,s={},u=EP){this.channel=t,this.event=r,this.payload=s,this.timeout=u,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,r){var s;return this._hasReceived(t)&&r((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:t,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:r}){this.recHooks.filter(s=>s.status===t).forEach(s=>s.callback(r))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var Bz;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"})(Bz||(Bz={}));class Rw{constructor(t,r){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(r==null?void 0:r.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},u=>{const{onJoin:f,onLeave:m,onSync:i}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Rw.syncState(this.state,u,f,m),this.pendingDiffs.forEach(S=>{this.state=Rw.syncDiff(this.state,S,f,m)}),this.pendingDiffs=[],i()}),this.channel._on(s.diff,{},u=>{const{onJoin:f,onLeave:m,onSync:i}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(u):(this.state=Rw.syncDiff(this.state,u,f,m),i())}),this.onJoin((u,f,m)=>{this.channel._trigger("presence",{event:"join",key:u,currentPresences:f,newPresences:m})}),this.onLeave((u,f,m)=>{this.channel._trigger("presence",{event:"leave",key:u,currentPresences:f,leftPresences:m})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,r,s,u){const f=this.cloneDeep(t),m=this.transformState(r),i={},S={};return this.map(f,(E,I)=>{m[E]||(S[E]=I)}),this.map(m,(E,I)=>{const D=f[E];if(D){const M=I.map(U=>U.presence_ref),R=D.map(U=>U.presence_ref),H=I.filter(U=>R.indexOf(U.presence_ref)<0),F=D.filter(U=>M.indexOf(U.presence_ref)<0);H.length>0&&(i[E]=H),F.length>0&&(S[E]=F)}else i[E]=I}),this.syncDiff(f,{joins:i,leaves:S},s,u)}static syncDiff(t,r,s,u){const{joins:f,leaves:m}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return s||(s=()=>{}),u||(u=()=>{}),this.map(f,(i,S)=>{var E;const I=(E=t[i])!==null&&E!==void 0?E:[];if(t[i]=this.cloneDeep(S),I.length>0){const D=t[i].map(R=>R.presence_ref),M=I.filter(R=>D.indexOf(R.presence_ref)<0);t[i].unshift(...M)}s(i,I,S)}),this.map(m,(i,S)=>{let E=t[i];if(!E)return;const I=S.map(D=>D.presence_ref);E=E.filter(D=>I.indexOf(D.presence_ref)<0),t[i]=E,u(i,E,S),E.length===0&&delete t[i]}),t}static map(t,r){return Object.getOwnPropertyNames(t).map(s=>r(s,t[s]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((r,s)=>{const u=t[s];return"metas"in u?r[s]=u.metas.map(f=>(f.presence_ref=f.phx_ref,delete f.phx_ref,delete f.phx_ref_prev,f)):r[s]=u,r},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Uz;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(Uz||(Uz={}));var Mw;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"})(Mw||(Mw={}));var Hh;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"})(Hh||(Hh={}));class NR{constructor(t,r={config:{}},s){var u,f;if(this.topic=t,this.params=r,this.socket=s,this.bindings={},this.state=Do.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new mN(this,dd.join,this.params,this.timeout),this.rejoinTimer=new c9(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Do.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(m=>m.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Do.closed,this.socket._remove(this)}),this._onError(m=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,m),this.state=Do.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Do.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",m=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,m),this.state=Do.errored,this.rejoinTimer.scheduleTimeout())}),this._on(dd.reply,{},(m,i)=>{this._trigger(this._replyEventName(i),m)}),this.presence=new Rw(this),this.broadcastEndpointURL=d9(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((f=(u=this.params.config)===null||u===void 0?void 0:u.broadcast)===null||f===void 0)&&f.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,r=this.timeout){var s,u,f;if(this.socket.isConnected()||this.socket.connect(),this.state==Do.closed){const{config:{broadcast:m,presence:i,private:S}}=this.params,E=(u=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(R=>R.filter))!==null&&u!==void 0?u:[],I=!!this.bindings[Mw.PRESENCE]&&this.bindings[Mw.PRESENCE].length>0||((f=this.params.config.presence)===null||f===void 0?void 0:f.enabled)===!0,D={},M={broadcast:m,presence:Object.assign(Object.assign({},i),{enabled:I}),postgres_changes:E,private:S};this.socket.accessTokenValue&&(D.access_token=this.socket.accessTokenValue),this._onError(R=>t==null?void 0:t(Hh.CHANNEL_ERROR,R)),this._onClose(()=>t==null?void 0:t(Hh.CLOSED)),this.updateJoinPayload(Object.assign({config:M},D)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:R})=>{var H;if(this.socket.setAuth(),R===void 0){t==null||t(Hh.SUBSCRIBED);return}else{const F=this.bindings.postgres_changes,U=(H=F==null?void 0:F.length)!==null&&H!==void 0?H:0,Y=[];for(let z=0;z<U;z++){const J=F[z],{filter:{event:ne,schema:me,table:le,filter:ye}}=J,pe=R&&R[z];if(pe&&pe.event===ne&&pe.schema===me&&pe.table===le&&pe.filter===ye)Y.push(Object.assign(Object.assign({},J),{id:pe.id}));else{this.unsubscribe(),this.state=Do.errored,t==null||t(Hh.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=Y,t&&t(Hh.SUBSCRIBED);return}}).receive("error",R=>{this.state=Do.errored,t==null||t(Hh.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(R).join(", ")||"error")))}).receive("timeout",()=>{t==null||t(Hh.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,r={}){return await this.send({type:"presence",event:"track",payload:t},r.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,r,s){return this.state===Do.joined&&t===Mw.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(t,r,s)}async httpSend(t,r,s={}){var u;const f=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(r==null)return Promise.reject("Payload is required for httpSend()");const m={method:"POST",headers:{Authorization:f,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:r,private:this.private}]})},i=await this._fetchWithTimeout(this.broadcastEndpointURL,m,(u=s.timeout)!==null&&u!==void 0?u:this.timeout);if(i.status===202)return{success:!0};let S=i.statusText;try{const E=await i.json();S=E.error||E.message||S}catch{}return Promise.reject(new Error(S))}async send(t,r={}){var s,u;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:f,payload:m}=t,S={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:f,payload:m,private:this.private}]})};try{const E=await this._fetchWithTimeout(this.broadcastEndpointURL,S,(s=r.timeout)!==null&&s!==void 0?s:this.timeout);return await((u=E.body)===null||u===void 0?void 0:u.cancel()),E.ok?"ok":"error"}catch(E){return E.name==="AbortError"?"timed out":"error"}}else return new Promise(f=>{var m,i,S;const E=this._push(t.type,t,r.timeout||this.timeout);t.type==="broadcast"&&!(!((S=(i=(m=this.params)===null||m===void 0?void 0:m.config)===null||i===void 0?void 0:i.broadcast)===null||S===void 0)&&S.ack)&&f("ok"),E.receive("ok",()=>f("ok")),E.receive("error",()=>f("error")),E.receive("timeout",()=>f("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=Do.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(dd.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(u=>{s=new mN(this,dd.leave,{},t),s.receive("ok",()=>{r(),u("ok")}).receive("timeout",()=>{r(),u("timed out")}).receive("error",()=>{u("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s==null||s.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Do.closed,this.bindings={}}async _fetchWithTimeout(t,r,s){const u=new AbortController,f=setTimeout(()=>u.abort(),s),m=await this.socket.fetch(t,Object.assign(Object.assign({},r),{signal:u.signal}));return clearTimeout(f),m}_push(t,r,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let u=new mN(this,t,r,s);return this._canPush()?u.send():this._addToPushBuffer(u),u}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>tae){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(t,r,s){return r}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,r,s){var u,f;const m=t.toLocaleLowerCase(),{close:i,error:S,leave:E,join:I}=dd;if(s&&[i,S,E,I].indexOf(m)>=0&&s!==this._joinRef())return;let M=this._onMessage(m,r,s);if(r&&!M)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(m)?(u=this.bindings.postgres_changes)===null||u===void 0||u.filter(R=>{var H,F,U;return((H=R.filter)===null||H===void 0?void 0:H.event)==="*"||((U=(F=R.filter)===null||F===void 0?void 0:F.event)===null||U===void 0?void 0:U.toLocaleLowerCase())===m}).map(R=>R.callback(M,s)):(f=this.bindings[m])===null||f===void 0||f.filter(R=>{var H,F,U,Y,z,J;if(["broadcast","presence","postgres_changes"].includes(m))if("id"in R){const ne=R.id,me=(H=R.filter)===null||H===void 0?void 0:H.event;return ne&&((F=r.ids)===null||F===void 0?void 0:F.includes(ne))&&(me==="*"||(me==null?void 0:me.toLocaleLowerCase())===((U=r.data)===null||U===void 0?void 0:U.type.toLocaleLowerCase()))}else{const ne=(z=(Y=R==null?void 0:R.filter)===null||Y===void 0?void 0:Y.event)===null||z===void 0?void 0:z.toLocaleLowerCase();return ne==="*"||ne===((J=r==null?void 0:r.event)===null||J===void 0?void 0:J.toLocaleLowerCase())}else return R.type.toLocaleLowerCase()===m}).map(R=>{if(typeof M=="object"&&"ids"in M){const H=M.data,{schema:F,table:U,commit_timestamp:Y,type:z,errors:J}=H;M=Object.assign(Object.assign({},{schema:F,table:U,commit_timestamp:Y,eventType:z,new:{},old:{},errors:J}),this._getPayloadRecords(H))}R.callback(M,s)})}_isClosed(){return this.state===Do.closed}_isJoined(){return this.state===Do.joined}_isJoining(){return this.state===Do.joining}_isLeaving(){return this.state===Do.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,r,s){const u=t.toLocaleLowerCase(),f={type:u,filter:r,callback:s};return this.bindings[u]?this.bindings[u].push(f):this.bindings[u]=[f],this}_off(t,r){const s=t.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(u=>{var f;return!(((f=u.type)===null||f===void 0?void 0:f.toLocaleLowerCase())===s&&NR.isEqual(u.filter,r))})),this}static isEqual(t,r){if(Object.keys(t).length!==Object.keys(r).length)return!1;for(const s in t)if(t[s]!==r[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(dd.close,{},t)}_onError(t){this._on(dd.error,{},r=>t(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Do.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const r={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(r.new=zz(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(r.old=zz(t.columns,t.old_record)),r}}const gN=()=>{},CT={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},cae=[1e3,2e3,5e3,1e4],uae=1e4,dae=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class hae{constructor(t,r){var s;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=EP,this.transport=null,this.heartbeatIntervalMs=CT.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=gN,this.ref=0,this.reconnectTimer=null,this.logger=gN,this.conn=null,this.sendBuffer=[],this.serializer=new rae,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=u=>u?(...f)=>u(...f):(...f)=>fetch(...f),!(!((s=r==null?void 0:r.params)===null||s===void 0)&&s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${t}/${CP.websocket}`,this.httpEndpoint=d9(t),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r==null?void 0:r.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Yse.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const r=t.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Qse}))}disconnect(t,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},t?this.conn.close(t,r??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const r=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const t=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,r,s){this.logger(t,r,s)}connectionState(){switch(this.conn&&this.conn.readyState){case Dw.connecting:return Fg.Connecting;case Dw.open:return Fg.Open;case Dw.closing:return Fg.Closing;default:return Fg.Closed}}isConnected(){return this.connectionState()===Fg.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,r={config:{}}){const s=`realtime:${t}`,u=this.getChannels().find(f=>f.topic===s);if(u)return u;{const f=new NR(`realtime:${t}`,r,this);return this.channels.push(f),f}}push(t){const{topic:r,event:s,payload:u,ref:f}=t,m=()=>{this.encode(t,i=>{var S;(S=this.conn)===null||S===void 0||S.send(i)})};this.log("push",`${r} ${s} (${f})`,u),this.isConnected()?m():this.sendBuffer.push(m)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(r){this.log("error","error in heartbeat callback",r)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(r){this.log("error","error in heartbeat callback",r)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(eae,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},CT.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(r){this.log("error","error in heartbeat callback",r)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let r=this.channels.find(s=>s.topic===t&&(s._isJoined()||s._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${t}"`),r.unsubscribe())}_remove(t){this.channels=this.channels.filter(r=>r.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,r=>{if(r.topic==="phoenix"&&r.event==="phx_reply")try{this.heartbeatCallback(r.payload.status==="ok"?"ok":"error")}catch(E){this.log("error","error in heartbeat callback",E)}r.ref&&r.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:s,event:u,payload:f,ref:m}=r,i=m?`(${m})`:"",S=f.status||"";this.log("receive",`${S} ${s} ${u} ${i}`.trim(),f),this.channels.filter(E=>E._isMember(s)).forEach(E=>E._trigger(u,f,m)),this._triggerStateCallbacks("message",r)})}_clearTimer(t){var r;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this.workerRef.terminate()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(t){var r;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(dd.error))}_appendParams(t,r){if(Object.keys(r).length===0)return t;const s=t.match(/\?/)?"&":"?",u=new URLSearchParams(r);return`${t}${s}${u}`}_workerObjectUrl(t){let r;if(t)r=t;else{const s=new Blob([dae],{type:"application/javascript"});r=URL.createObjectURL(s)}return r}_setConnectionState(t,r=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(t=null){let r;t?r=t:this.accessToken?r=await this.accessToken():r=this.accessTokenValue,this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(s=>{const u={access_token:r,version:Jse};r&&s.updateJoinPayload(u),s.joinedOnce&&s._isJoined()&&s._push(dd.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this.setAuth().catch(r=>{this.log("error",`error setting auth in ${t}`,r)})}_triggerStateCallbacks(t,r){try{this.stateChangeCallbacks[t].forEach(s=>{try{s(r)}catch(u){this.log("error",`error in ${t} callback`,u)}})}catch(s){this.log("error",`error triggering ${t} callbacks`,s)}}_setupReconnectionTimer(){this.reconnectTimer=new c9(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},CT.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var r,s,u,f,m,i,S,E,I;if(this.transport=(r=t==null?void 0:t.transport)!==null&&r!==void 0?r:null,this.timeout=(s=t==null?void 0:t.timeout)!==null&&s!==void 0?s:EP,this.heartbeatIntervalMs=(u=t==null?void 0:t.heartbeatIntervalMs)!==null&&u!==void 0?u:CT.HEARTBEAT_INTERVAL,this.worker=(f=t==null?void 0:t.worker)!==null&&f!==void 0?f:!1,this.accessToken=(m=t==null?void 0:t.accessToken)!==null&&m!==void 0?m:null,this.heartbeatCallback=(i=t==null?void 0:t.heartbeatCallback)!==null&&i!==void 0?i:gN,t!=null&&t.params&&(this.params=t.params),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(S=t==null?void 0:t.reconnectAfterMs)!==null&&S!==void 0?S:D=>cae[D-1]||uae,this.encode=(E=t==null?void 0:t.encode)!==null&&E!==void 0?E:(D,M)=>M(JSON.stringify(D)),this.decode=(I=t==null?void 0:t.decode)!==null&&I!==void 0?I:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t==null?void 0:t.workerUrl}}}class kR extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function Ka(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}class fae extends kR{constructor(t,r,s){super(t),this.name="StorageApiError",this.status=r,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class jP extends kR{constructor(t,r){super(t),this.name="StorageUnknownError",this.originalError=r}}const PR=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),pae=()=>Response,IP=e=>{if(Array.isArray(e))return e.map(r=>IP(r));if(typeof e=="function"||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([r,s])=>{const u=r.replace(/([-_][a-z])/gi,f=>f.toUpperCase().replace(/[-_]/g,""));t[u]=IP(s)}),t},mae=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},_N=e=>{var t;return e.msg||e.message||e.error_description||(typeof e.error=="string"?e.error:(t=e.error)===null||t===void 0?void 0:t.message)||JSON.stringify(e)},gae=(e,t,r)=>ni(void 0,void 0,void 0,function*(){const s=yield pae();e instanceof s&&!(r!=null&&r.noResolveJson)?e.json().then(u=>{const f=e.status||500,m=(u==null?void 0:u.statusCode)||f+"";t(new fae(_N(u),f,m))}).catch(u=>{t(new jP(_N(u),u))}):t(new jP(_N(e),e))}),_ae=(e,t,r,s)=>{const u={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"||!s?u:(mae(s)?(u.headers=Object.assign({"Content-Type":"application/json"},t==null?void 0:t.headers),u.body=JSON.stringify(s)):u.body=s,t!=null&&t.duplex&&(u.duplex=t.duplex),Object.assign(Object.assign({},u),r))};function Ub(e,t,r,s,u,f){return ni(this,void 0,void 0,function*(){return new Promise((m,i)=>{e(r,_ae(t,s,u,f)).then(S=>{if(!S.ok)throw S;return s!=null&&s.noResolveJson?S:S.json()}).then(S=>m(S)).catch(S=>gae(S,i,s))})})}function mb(e,t,r,s){return ni(this,void 0,void 0,function*(){return Ub(e,"GET",t,r,s)})}function od(e,t,r,s,u){return ni(this,void 0,void 0,function*(){return Ub(e,"POST",t,s,u,r)})}function NP(e,t,r,s,u){return ni(this,void 0,void 0,function*(){return Ub(e,"PUT",t,s,u,r)})}function xae(e,t,r,s){return ni(this,void 0,void 0,function*(){return Ub(e,"HEAD",t,Object.assign(Object.assign({},r),{noResolveJson:!0}),s)})}function DR(e,t,r,s,u){return ni(this,void 0,void 0,function*(){return Ub(e,"DELETE",t,s,u,r)})}class vae{constructor(t,r){this.downloadFn=t,this.shouldThrowOnError=r}then(t,r){return this.execute().then(t,r)}execute(){return ni(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Ka(t))return{data:null,error:t};throw t}})}}var h9;class yae{constructor(t,r){this.downloadFn=t,this.shouldThrowOnError=r,this[h9]="BlobDownloadBuilder",this.promise=null}asStream(){return new vae(this.downloadFn,this.shouldThrowOnError)}then(t,r){return this.getPromise().then(t,r)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return ni(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Ka(t))return{data:null,error:t};throw t}})}}h9=Symbol.toStringTag;const wae={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Vz={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class bae{constructor(t,r={},s,u){this.shouldThrowOnError=!1,this.url=t,this.headers=r,this.bucketId=s,this.fetch=PR(u)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(t,r,s,u){return ni(this,void 0,void 0,function*(){try{let f;const m=Object.assign(Object.assign({},Vz),u);let i=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(m.upsert)});const S=m.metadata;typeof Blob<"u"&&s instanceof Blob?(f=new FormData,f.append("cacheControl",m.cacheControl),S&&f.append("metadata",this.encodeMetadata(S)),f.append("",s)):typeof FormData<"u"&&s instanceof FormData?(f=s,f.has("cacheControl")||f.append("cacheControl",m.cacheControl),S&&!f.has("metadata")&&f.append("metadata",this.encodeMetadata(S))):(f=s,i["cache-control"]=`max-age=${m.cacheControl}`,i["content-type"]=m.contentType,S&&(i["x-metadata"]=this.toBase64(this.encodeMetadata(S))),(typeof ReadableStream<"u"&&f instanceof ReadableStream||f&&typeof f=="object"&&"pipe"in f&&typeof f.pipe=="function")&&!m.duplex&&(m.duplex="half")),u!=null&&u.headers&&(i=Object.assign(Object.assign({},i),u.headers));const E=this._removeEmptyFolders(r),I=this._getFinalPath(E),D=yield(t=="PUT"?NP:od)(this.fetch,`${this.url}/object/${I}`,f,Object.assign({headers:i},m!=null&&m.duplex?{duplex:m.duplex}:{}));return{data:{path:E,id:D.Id,fullPath:D.Key},error:null}}catch(f){if(this.shouldThrowOnError)throw f;if(Ka(f))return{data:null,error:f};throw f}})}upload(t,r,s){return ni(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,r,s)})}uploadToSignedUrl(t,r,s,u){return ni(this,void 0,void 0,function*(){const f=this._removeEmptyFolders(t),m=this._getFinalPath(f),i=new URL(this.url+`/object/upload/sign/${m}`);i.searchParams.set("token",r);try{let S;const E=Object.assign({upsert:Vz.upsert},u),I=Object.assign(Object.assign({},this.headers),{"x-upsert":String(E.upsert)});typeof Blob<"u"&&s instanceof Blob?(S=new FormData,S.append("cacheControl",E.cacheControl),S.append("",s)):typeof FormData<"u"&&s instanceof FormData?(S=s,S.append("cacheControl",E.cacheControl)):(S=s,I["cache-control"]=`max-age=${E.cacheControl}`,I["content-type"]=E.contentType);const D=yield NP(this.fetch,i.toString(),S,{headers:I});return{data:{path:f,fullPath:D.Key},error:null}}catch(S){if(this.shouldThrowOnError)throw S;if(Ka(S))return{data:null,error:S};throw S}})}createSignedUploadUrl(t,r){return ni(this,void 0,void 0,function*(){try{let s=this._getFinalPath(t);const u=Object.assign({},this.headers);r!=null&&r.upsert&&(u["x-upsert"]="true");const f=yield od(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:u}),m=new URL(this.url+f.url),i=m.searchParams.get("token");if(!i)throw new kR("No token returned by API");return{data:{signedUrl:m.toString(),path:t,token:i},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Ka(s))return{data:null,error:s};throw s}})}update(t,r,s){return ni(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,r,s)})}move(t,r,s){return ni(this,void 0,void 0,function*(){try{return{data:yield od(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:r,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(u){if(this.shouldThrowOnError)throw u;if(Ka(u))return{data:null,error:u};throw u}})}copy(t,r,s){return ni(this,void 0,void 0,function*(){try{return{data:{path:(yield od(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:r,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(u){if(this.shouldThrowOnError)throw u;if(Ka(u))return{data:null,error:u};throw u}})}createSignedUrl(t,r,s){return ni(this,void 0,void 0,function*(){try{let u=this._getFinalPath(t),f=yield od(this.fetch,`${this.url}/object/sign/${u}`,Object.assign({expiresIn:r},s!=null&&s.transform?{transform:s.transform}:{}),{headers:this.headers});const m=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return f={signedUrl:encodeURI(`${this.url}${f.signedURL}${m}`)},{data:f,error:null}}catch(u){if(this.shouldThrowOnError)throw u;if(Ka(u))return{data:null,error:u};throw u}})}createSignedUrls(t,r,s){return ni(this,void 0,void 0,function*(){try{const u=yield od(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:r,paths:t},{headers:this.headers}),f=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return{data:u.map(m=>Object.assign(Object.assign({},m),{signedUrl:m.signedURL?encodeURI(`${this.url}${m.signedURL}${f}`):null})),error:null}}catch(u){if(this.shouldThrowOnError)throw u;if(Ka(u))return{data:null,error:u};throw u}})}download(t,r){const u=typeof(r==null?void 0:r.transform)<"u"?"render/image/authenticated":"object",f=this.transformOptsToQueryString((r==null?void 0:r.transform)||{}),m=f?`?${f}`:"",i=this._getFinalPath(t),S=()=>mb(this.fetch,`${this.url}/${u}/${i}${m}`,{headers:this.headers,noResolveJson:!0});return new yae(S,this.shouldThrowOnError)}info(t){return ni(this,void 0,void 0,function*(){const r=this._getFinalPath(t);try{const s=yield mb(this.fetch,`${this.url}/object/info/${r}`,{headers:this.headers});return{data:IP(s),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Ka(s))return{data:null,error:s};throw s}})}exists(t){return ni(this,void 0,void 0,function*(){const r=this._getFinalPath(t);try{return yield xae(this.fetch,`${this.url}/object/${r}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Ka(s)&&s instanceof jP){const u=s.originalError;if([400,404].includes(u==null?void 0:u.status))return{data:!1,error:s}}throw s}})}getPublicUrl(t,r){const s=this._getFinalPath(t),u=[],f=r!=null&&r.download?`download=${r.download===!0?"":r.download}`:"";f!==""&&u.push(f);const i=typeof(r==null?void 0:r.transform)<"u"?"render/image":"object",S=this.transformOptsToQueryString((r==null?void 0:r.transform)||{});S!==""&&u.push(S);let E=u.join("&");return E!==""&&(E=`?${E}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${s}${E}`)}}}remove(t){return ni(this,void 0,void 0,function*(){try{return{data:yield DR(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ka(r))return{data:null,error:r};throw r}})}list(t,r,s){return ni(this,void 0,void 0,function*(){try{const u=Object.assign(Object.assign(Object.assign({},wae),r),{prefix:t||""});return{data:yield od(this.fetch,`${this.url}/object/list/${this.bucketId}`,u,{headers:this.headers},s),error:null}}catch(u){if(this.shouldThrowOnError)throw u;if(Ka(u))return{data:null,error:u};throw u}})}listV2(t,r){return ni(this,void 0,void 0,function*(){try{const s=Object.assign({},t);return{data:yield od(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Ka(s))return{data:null,error:s};throw s}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const r=[];return t.width&&r.push(`width=${t.width}`),t.height&&r.push(`height=${t.height}`),t.resize&&r.push(`resize=${t.resize}`),t.format&&r.push(`format=${t.format}`),t.quality&&r.push(`quality=${t.quality}`),r.join("&")}}const f9="2.80.0",p9={"X-Client-Info":`storage-js/${f9}`};class Sae{constructor(t,r={},s,u){this.shouldThrowOnError=!1;const f=new URL(t);u!=null&&u.useNewHostname&&/supabase\.(co|in|red)$/.test(f.hostname)&&!f.hostname.includes("storage.supabase.")&&(f.hostname=f.hostname.replace("supabase.","storage.supabase.")),this.url=f.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},p9),r),this.fetch=PR(s)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(t){return ni(this,void 0,void 0,function*(){try{const r=this.listBucketOptionsToQueryString(t);return{data:yield mb(this.fetch,`${this.url}/bucket${r}`,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ka(r))return{data:null,error:r};throw r}})}getBucket(t){return ni(this,void 0,void 0,function*(){try{return{data:yield mb(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ka(r))return{data:null,error:r};throw r}})}createBucket(t){return ni(this,arguments,void 0,function*(r,s={public:!1}){try{return{data:yield od(this.fetch,`${this.url}/bucket`,{id:r,name:r,type:s.type,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(u){if(this.shouldThrowOnError)throw u;if(Ka(u))return{data:null,error:u};throw u}})}updateBucket(t,r){return ni(this,void 0,void 0,function*(){try{return{data:yield NP(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Ka(s))return{data:null,error:s};throw s}})}emptyBucket(t){return ni(this,void 0,void 0,function*(){try{return{data:yield od(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ka(r))return{data:null,error:r};throw r}})}deleteBucket(t){return ni(this,void 0,void 0,function*(){try{return{data:yield DR(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ka(r))return{data:null,error:r};throw r}})}listBucketOptionsToQueryString(t){const r={};return t&&("limit"in t&&(r.limit=String(t.limit)),"offset"in t&&(r.offset=String(t.offset)),t.search&&(r.search=t.search),t.sortColumn&&(r.sortColumn=t.sortColumn),t.sortOrder&&(r.sortOrder=t.sortOrder)),Object.keys(r).length>0?"?"+new URLSearchParams(r).toString():""}}class Tae{constructor(t,r={},s){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},p9),r),this.fetch=PR(s)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(t){return ni(this,void 0,void 0,function*(){try{return{data:yield od(this.fetch,`${this.url}/bucket`,{name:t},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ka(r))return{data:null,error:r};throw r}})}listBuckets(t){return ni(this,void 0,void 0,function*(){try{const r=new URLSearchParams;(t==null?void 0:t.limit)!==void 0&&r.set("limit",t.limit.toString()),(t==null?void 0:t.offset)!==void 0&&r.set("offset",t.offset.toString()),t!=null&&t.sortColumn&&r.set("sortColumn",t.sortColumn),t!=null&&t.sortOrder&&r.set("sortOrder",t.sortOrder),t!=null&&t.search&&r.set("search",t.search);const s=r.toString(),u=s?`${this.url}/bucket?${s}`:`${this.url}/bucket`;return{data:yield mb(this.fetch,u,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ka(r))return{data:null,error:r};throw r}})}deleteBucket(t){return ni(this,void 0,void 0,function*(){try{return{data:yield DR(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ka(r))return{data:null,error:r};throw r}})}}const RR={"X-Client-Info":`storage-js/${f9}`,"Content-Type":"application/json"};class m9 extends Error{constructor(t){super(t),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function Wc(e){return typeof e=="object"&&e!==null&&"__isStorageVectorsError"in e}class xN extends m9{constructor(t,r,s){super(t),this.name="StorageVectorsApiError",this.status=r,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Eae extends m9{constructor(t,r){super(t),this.name="StorageVectorsUnknownError",this.originalError=r}}var $z;(function(e){e.InternalError="InternalError",e.S3VectorConflictException="S3VectorConflictException",e.S3VectorNotFoundException="S3VectorNotFoundException",e.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",e.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",e.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})($z||($z={}));const MR=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),Cae=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},qz=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Aae=(e,t,r)=>ni(void 0,void 0,void 0,function*(){if(e&&typeof e=="object"&&"status"in e&&"ok"in e&&typeof e.status=="number"&&!(r!=null&&r.noResolveJson)){const u=e.status||500,f=e;if(typeof f.json=="function")f.json().then(m=>{const i=(m==null?void 0:m.statusCode)||(m==null?void 0:m.code)||u+"";t(new xN(qz(m),u,i))}).catch(()=>{const m=u+"",i=f.statusText||`HTTP ${u} error`;t(new xN(i,u,m))});else{const m=u+"",i=f.statusText||`HTTP ${u} error`;t(new xN(i,u,m))}}else t(new Eae(qz(e),e))}),jae=(e,t,r,s)=>{const u={method:e,headers:(t==null?void 0:t.headers)||{}};return s?(Cae(s)?(u.headers=Object.assign({"Content-Type":"application/json"},t==null?void 0:t.headers),u.body=JSON.stringify(s)):u.body=s,Object.assign(Object.assign({},u),r)):u};function Iae(e,t,r,s,u,f){return ni(this,void 0,void 0,function*(){return new Promise((m,i)=>{e(r,jae(t,s,u,f)).then(S=>{if(!S.ok)throw S;if(s!=null&&s.noResolveJson)return S;const E=S.headers.get("content-type");return!E||!E.includes("application/json")?{}:S.json()}).then(S=>m(S)).catch(S=>Aae(S,i,s))})})}function Hc(e,t,r,s,u){return ni(this,void 0,void 0,function*(){return Iae(e,"POST",t,s,u,r)})}class Nae{constructor(t,r={},s){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},RR),r),this.fetch=MR(s)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(t){return ni(this,void 0,void 0,function*(){try{return{data:(yield Hc(this.fetch,`${this.url}/CreateIndex`,t,{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Wc(r))return{data:null,error:r};throw r}})}getIndex(t,r){return ni(this,void 0,void 0,function*(){try{return{data:yield Hc(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:t,indexName:r},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Wc(s))return{data:null,error:s};throw s}})}listIndexes(t){return ni(this,void 0,void 0,function*(){try{return{data:yield Hc(this.fetch,`${this.url}/ListIndexes`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Wc(r))return{data:null,error:r};throw r}})}deleteIndex(t,r){return ni(this,void 0,void 0,function*(){try{return{data:(yield Hc(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:t,indexName:r},{headers:this.headers}))||{},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Wc(s))return{data:null,error:s};throw s}})}}class kae{constructor(t,r={},s){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},RR),r),this.fetch=MR(s)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(t){return ni(this,void 0,void 0,function*(){try{if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield Hc(this.fetch,`${this.url}/PutVectors`,t,{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Wc(r))return{data:null,error:r};throw r}})}getVectors(t){return ni(this,void 0,void 0,function*(){try{return{data:yield Hc(this.fetch,`${this.url}/GetVectors`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Wc(r))return{data:null,error:r};throw r}})}listVectors(t){return ni(this,void 0,void 0,function*(){try{if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return{data:yield Hc(this.fetch,`${this.url}/ListVectors`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Wc(r))return{data:null,error:r};throw r}})}queryVectors(t){return ni(this,void 0,void 0,function*(){try{return{data:yield Hc(this.fetch,`${this.url}/QueryVectors`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Wc(r))return{data:null,error:r};throw r}})}deleteVectors(t){return ni(this,void 0,void 0,function*(){try{if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield Hc(this.fetch,`${this.url}/DeleteVectors`,t,{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Wc(r))return{data:null,error:r};throw r}})}}class Pae{constructor(t,r={},s){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},RR),r),this.fetch=MR(s)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(t){return ni(this,void 0,void 0,function*(){try{return{data:(yield Hc(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Wc(r))return{data:null,error:r};throw r}})}getBucket(t){return ni(this,void 0,void 0,function*(){try{return{data:yield Hc(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:t},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Wc(r))return{data:null,error:r};throw r}})}listBuckets(){return ni(this,arguments,void 0,function*(t={}){try{return{data:yield Hc(this.fetch,`${this.url}/ListVectorBuckets`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Wc(r))return{data:null,error:r};throw r}})}deleteBucket(t){return ni(this,void 0,void 0,function*(){try{return{data:(yield Hc(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Wc(r))return{data:null,error:r};throw r}})}}class Dae extends Pae{constructor(t,r={}){super(t,r.headers||{},r.fetch)}from(t){return new Rae(this.url,this.headers,t,this.fetch)}}class Rae extends Nae{constructor(t,r,s,u){super(t,r,u),this.vectorBucketName=s}createIndex(t){const r=Object.create(null,{createIndex:{get:()=>super.createIndex}});return ni(this,void 0,void 0,function*(){return r.createIndex.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const t=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return ni(this,arguments,void 0,function*(r={}){return t.listIndexes.call(this,Object.assign(Object.assign({},r),{vectorBucketName:this.vectorBucketName}))})}getIndex(t){const r=Object.create(null,{getIndex:{get:()=>super.getIndex}});return ni(this,void 0,void 0,function*(){return r.getIndex.call(this,this.vectorBucketName,t)})}deleteIndex(t){const r=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return ni(this,void 0,void 0,function*(){return r.deleteIndex.call(this,this.vectorBucketName,t)})}index(t){return new Mae(this.url,this.headers,this.vectorBucketName,t,this.fetch)}}class Mae extends kae{constructor(t,r,s,u,f){super(t,r,f),this.vectorBucketName=s,this.indexName=u}putVectors(t){const r=Object.create(null,{putVectors:{get:()=>super.putVectors}});return ni(this,void 0,void 0,function*(){return r.putVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(t){const r=Object.create(null,{getVectors:{get:()=>super.getVectors}});return ni(this,void 0,void 0,function*(){return r.getVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const t=Object.create(null,{listVectors:{get:()=>super.listVectors}});return ni(this,arguments,void 0,function*(r={}){return t.listVectors.call(this,Object.assign(Object.assign({},r),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(t){const r=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return ni(this,void 0,void 0,function*(){return r.queryVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(t){const r=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return ni(this,void 0,void 0,function*(){return r.deleteVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class Oae extends Sae{constructor(t,r={},s,u){super(t,r,s,u)}from(t){return new bae(this.url,this.headers,t,this.fetch)}get vectors(){return new Dae(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new Tae(this.url+"/iceberg",this.headers,this.fetch)}}const Fae="2.80.0";let _w="";typeof Deno<"u"?_w="deno":typeof document<"u"?_w="web":typeof navigator<"u"&&navigator.product==="ReactNative"?_w="react-native":_w="node";const Lae={"X-Client-Info":`supabase-js-${_w}/${Fae}`},zae={headers:Lae},Bae={schema:"public"},Uae={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Vae={},$ae=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),qae=()=>Headers,Gae=(e,t,r)=>{const s=$ae(r),u=qae();return async(f,m)=>{var i;const S=(i=await t())!==null&&i!==void 0?i:e;let E=new u(m==null?void 0:m.headers);return E.has("apikey")||E.set("apikey",e),E.has("Authorization")||E.set("Authorization",`Bearer ${S}`),s(f,Object.assign(Object.assign({},m),{headers:E}))}};function Wae(e){return e.endsWith("/")?e:e+"/"}function Hae(e,t){var r,s;const{db:u,auth:f,realtime:m,global:i}=e,{db:S,auth:E,realtime:I,global:D}=t,M={db:Object.assign(Object.assign({},S),u),auth:Object.assign(Object.assign({},E),f),realtime:Object.assign(Object.assign({},I),m),storage:{},global:Object.assign(Object.assign(Object.assign({},D),i),{headers:Object.assign(Object.assign({},(r=D==null?void 0:D.headers)!==null&&r!==void 0?r:{}),(s=i==null?void 0:i.headers)!==null&&s!==void 0?s:{})}),accessToken:async()=>""};return e.accessToken?M.accessToken=e.accessToken:delete M.accessToken,M}function Zae(e){const t=e==null?void 0:e.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(Wae(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const g9="2.80.0",bx=30*1e3,kP=3,vN=kP*bx,Xae="http://localhost:9999",Yae="supabase.auth.token",Kae={"X-Client-Info":`gotrue-js/${g9}`},PP="X-Supabase-Api-Version",_9={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Jae=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Qae=10*60*1e3;class gb extends Error{constructor(t,r,s){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=s}}function ci(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class eoe extends gb{constructor(t,r,s){super(t,r,s),this.name="AuthApiError",this.status=r,this.code=s}}function toe(e){return ci(e)&&e.name==="AuthApiError"}class Lg extends gb{constructor(t,r){super(t),this.name="AuthUnknownError",this.originalError=r}}class Am extends gb{constructor(t,r,s,u){super(t,s,u),this.name=r,this.status=s}}class nd extends Am{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function roe(e){return ci(e)&&e.name==="AuthSessionMissingError"}class lx extends Am{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class AT extends Am{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class jT extends Am{constructor(t,r=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function noe(e){return ci(e)&&e.name==="AuthImplicitGrantRedirectError"}class Gz extends Am{constructor(t,r=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class DP extends Am{constructor(t,r){super(t,"AuthRetryableFetchError",r,void 0)}}function yN(e){return ci(e)&&e.name==="AuthRetryableFetchError"}class Wz extends Am{constructor(t,r,s){super(t,"AuthWeakPasswordError",r,"weak_password"),this.reasons=s}}class RP extends Am{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const XE="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Hz=` 	
\r=`.split(""),ioe=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<Hz.length;t+=1)e[Hz[t].charCodeAt(0)]=-2;for(let t=0;t<XE.length;t+=1)e[XE[t].charCodeAt(0)]=t;return e})();function Zz(e,t,r){if(e!==null)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const s=t.queue>>t.queuedBits-6&63;r(XE[s]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const s=t.queue>>t.queuedBits-6&63;r(XE[s]),t.queuedBits-=6}}function x9(e,t,r){const s=ioe[e];if(s>-1)for(t.queue=t.queue<<6|s,t.queuedBits+=6;t.queuedBits>=8;)r(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}}function Xz(e){const t=[],r=m=>{t.push(String.fromCodePoint(m))},s={utf8seq:0,codepoint:0},u={queue:0,queuedBits:0},f=m=>{ooe(m,s,r)};for(let m=0;m<e.length;m+=1)x9(e.charCodeAt(m),u,f);return t.join("")}function soe(e,t){if(e<=127){t(e);return}else if(e<=2047){t(192|e>>6),t(128|e&63);return}else if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|e&63);return}else if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|e&63);return}throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}function aoe(e,t){for(let r=0;r<e.length;r+=1){let s=e.charCodeAt(r);if(s>55295&&s<=56319){const u=(s-55296)*1024&65535;s=(e.charCodeAt(r+1)-56320&65535|u)+65536,r+=1}soe(s,t)}}function ooe(e,t,r){if(t.utf8seq===0){if(e<=127){r(e);return}for(let s=1;s<6;s+=1)if(!(e>>7-s&1)){t.utf8seq=s;break}if(t.utf8seq===2)t.codepoint=e&31;else if(t.utf8seq===3)t.codepoint=e&15;else if(t.utf8seq===4)t.codepoint=e&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|e&63,t.utf8seq-=1,t.utf8seq===0&&r(t.codepoint)}}function Zx(e){const t=[],r={queue:0,queuedBits:0},s=u=>{t.push(u)};for(let u=0;u<e.length;u+=1)x9(e.charCodeAt(u),r,s);return new Uint8Array(t)}function loe(e){const t=[];return aoe(e,r=>t.push(r)),new Uint8Array(t)}function Gg(e){const t=[],r={queue:0,queuedBits:0},s=u=>{t.push(u)};return e.forEach(u=>Zz(u,r,s)),Zz(null,r,s),t.join("")}function coe(e){return Math.round(Date.now()/1e3)+e}function uoe(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;return(e=="x"?t:t&3|8).toString(16)})}const bl=()=>typeof window<"u"&&typeof document<"u",Ng={tested:!1,writable:!1},v9=()=>{if(!bl())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Ng.tested)return Ng.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),Ng.tested=!0,Ng.writable=!0}catch{Ng.tested=!0,Ng.writable=!1}return Ng.writable};function doe(e){const t={},r=new URL(e);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((u,f)=>{t[f]=u})}catch{}return r.searchParams.forEach((s,u)=>{t[u]=s}),t}const y9=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),hoe=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",Sx=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},kg=async(e,t)=>{const r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch{return r}},bp=async(e,t)=>{await e.removeItem(t)};class oA{constructor(){this.promise=new oA.promiseConstructor((t,r)=>{this.resolve=t,this.reject=r})}}oA.promiseConstructor=Promise;function wN(e){const t=e.split(".");if(t.length!==3)throw new RP("Invalid JWT structure");for(let s=0;s<t.length;s++)if(!Jae.test(t[s]))throw new RP("JWT not in base64url format");return{header:JSON.parse(Xz(t[0])),payload:JSON.parse(Xz(t[1])),signature:Zx(t[2]),raw:{header:t[0],payload:t[1]}}}async function foe(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function poe(e,t){return new Promise((s,u)=>{(async()=>{for(let f=0;f<1/0;f++)try{const m=await e(f);if(!t(f,null,m)){s(m);return}}catch(m){if(!t(f,m)){u(m);return}}})()})}function moe(e){return("0"+e.toString(16)).substr(-2)}function goe(){const t=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=r.length;let u="";for(let f=0;f<56;f++)u+=r.charAt(Math.floor(Math.random()*s));return u}return crypto.getRandomValues(t),Array.from(t,moe).join("")}async function _oe(e){const r=new TextEncoder().encode(e),s=await crypto.subtle.digest("SHA-256",r),u=new Uint8Array(s);return Array.from(u).map(f=>String.fromCharCode(f)).join("")}async function xoe(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const r=await _oe(e);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function cx(e,t,r=!1){const s=goe();let u=s;r&&(u+="/PASSWORD_RECOVERY"),await Sx(e,`${t}-code-verifier`,u);const f=await xoe(s);return[f,s===f?"plain":"s256"]}const voe=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function yoe(e){const t=e.headers.get(PP);if(!t||!t.match(voe))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function woe(e){if(!e)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(e<=t)throw new Error("JWT has expired")}function boe(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Soe=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ux(e){if(!Soe.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function bN(){const e={};return new Proxy(e,{get:(t,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const s=r.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Toe(e,t){return new Proxy(e,{get:(r,s,u)=>{if(s==="__isInsecureUserWarningProxy")return!0;if(typeof s=="symbol"){const f=s.toString();if(f==="Symbol(Symbol.toPrimitive)"||f==="Symbol(Symbol.toStringTag)"||f==="Symbol(util.inspect.custom)"||f==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(r,s,u)}return!t.value&&typeof s=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(r,s,u)}})}function Yz(e){return JSON.parse(JSON.stringify(e))}const Mg=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Eoe=[502,503,504];async function Kz(e){var t;if(!hoe(e))throw new DP(Mg(e),0);if(Eoe.includes(e.status))throw new DP(Mg(e),e.status);let r;try{r=await e.json()}catch(f){throw new Lg(Mg(f),f)}let s;const u=yoe(e);if(u&&u.getTime()>=_9["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?s=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(s=r.error_code),s){if(s==="weak_password")throw new Wz(Mg(r),e.status,((t=r.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(s==="session_not_found")throw new nd}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((f,m)=>f&&typeof m=="string",!0))throw new Wz(Mg(r),e.status,r.weak_password.reasons);throw new eoe(Mg(r),e.status||500,s)}const Coe=(e,t,r,s)=>{const u={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"?u:(u.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t==null?void 0:t.headers),u.body=JSON.stringify(s),Object.assign(Object.assign({},u),r))};async function Bi(e,t,r,s){var u;const f=Object.assign({},s==null?void 0:s.headers);f[PP]||(f[PP]=_9["2024-01-01"].name),s!=null&&s.jwt&&(f.Authorization=`Bearer ${s.jwt}`);const m=(u=s==null?void 0:s.query)!==null&&u!==void 0?u:{};s!=null&&s.redirectTo&&(m.redirect_to=s.redirectTo);const i=Object.keys(m).length?"?"+new URLSearchParams(m).toString():"",S=await Aoe(e,t,r+i,{headers:f,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(S):{data:Object.assign({},S),error:null}}async function Aoe(e,t,r,s,u,f){const m=Coe(t,s,u,f);let i;try{i=await e(r,Object.assign({},m))}catch(S){throw console.error(S),new DP(Mg(S),0)}if(i.ok||await Kz(i),s!=null&&s.noResolveJson)return i;try{return await i.json()}catch(S){await Kz(S)}}function id(e){var t;let r=null;Noe(e)&&(r=Object.assign({},e),e.expires_at||(r.expires_at=coe(e.expires_in)));const s=(t=e.user)!==null&&t!==void 0?t:e;return{data:{session:r,user:s},error:null}}function Jz(e){const t=id(e);return!t.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((r,s)=>r&&typeof s=="string",!0)&&(t.data.weak_password=e.weak_password),t}function Pp(e){var t;return{data:{user:(t=e.user)!==null&&t!==void 0?t:e},error:null}}function joe(e){return{data:e,error:null}}function Ioe(e){const{action_link:t,email_otp:r,hashed_token:s,redirect_to:u,verification_type:f}=e,m=Cm(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),i={action_link:t,email_otp:r,hashed_token:s,redirect_to:u,verification_type:f},S=Object.assign({},m);return{data:{properties:i,user:S},error:null}}function Qz(e){return e}function Noe(e){return e.access_token&&e.refresh_token&&e.expires_in}const SN=["global","local","others"];class koe{constructor({url:t="",headers:r={},fetch:s}){this.url=t,this.headers=r,this.fetch=y9(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,r=SN[0]){if(SN.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${SN.join(", ")}`);try{return await Bi(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(s){if(ci(s))return{data:null,error:s};throw s}}async inviteUserByEmail(t,r={}){try{return await Bi(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:Pp})}catch(s){if(ci(s))return{data:{user:null},error:s};throw s}}async generateLink(t){try{const{options:r}=t,s=Cm(t,["options"]),u=Object.assign(Object.assign({},s),r);return"newEmail"in s&&(u.new_email=s==null?void 0:s.newEmail,delete u.newEmail),await Bi(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:u,headers:this.headers,xform:Ioe,redirectTo:r==null?void 0:r.redirectTo})}catch(r){if(ci(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(t){try{return await Bi(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:Pp})}catch(r){if(ci(r))return{data:{user:null},error:r};throw r}}async listUsers(t){var r,s,u,f,m,i,S;try{const E={nextPage:null,lastPage:0,total:0},I=await Bi(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(r=t==null?void 0:t.page)===null||r===void 0?void 0:r.toString())!==null&&s!==void 0?s:"",per_page:(f=(u=t==null?void 0:t.perPage)===null||u===void 0?void 0:u.toString())!==null&&f!==void 0?f:""},xform:Qz});if(I.error)throw I.error;const D=await I.json(),M=(m=I.headers.get("x-total-count"))!==null&&m!==void 0?m:0,R=(S=(i=I.headers.get("link"))===null||i===void 0?void 0:i.split(","))!==null&&S!==void 0?S:[];return R.length>0&&(R.forEach(H=>{const F=parseInt(H.split(";")[0].split("=")[1].substring(0,1)),U=JSON.parse(H.split(";")[1].split("=")[1]);E[`${U}Page`]=F}),E.total=parseInt(M)),{data:Object.assign(Object.assign({},D),E),error:null}}catch(E){if(ci(E))return{data:{users:[]},error:E};throw E}}async getUserById(t){ux(t);try{return await Bi(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:Pp})}catch(r){if(ci(r))return{data:{user:null},error:r};throw r}}async updateUserById(t,r){ux(t);try{return await Bi(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:r,headers:this.headers,xform:Pp})}catch(s){if(ci(s))return{data:{user:null},error:s};throw s}}async deleteUser(t,r=!1){ux(t);try{return await Bi(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:r},xform:Pp})}catch(s){if(ci(s))return{data:{user:null},error:s};throw s}}async _listFactors(t){ux(t.userId);try{const{data:r,error:s}=await Bi(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:u=>({data:{factors:u},error:null})});return{data:r,error:s}}catch(r){if(ci(r))return{data:null,error:r};throw r}}async _deleteFactor(t){ux(t.userId),ux(t.id);try{return{data:await Bi(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(r){if(ci(r))return{data:null,error:r};throw r}}async _listOAuthClients(t){var r,s,u,f,m,i,S;try{const E={nextPage:null,lastPage:0,total:0},I=await Bi(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(r=t==null?void 0:t.page)===null||r===void 0?void 0:r.toString())!==null&&s!==void 0?s:"",per_page:(f=(u=t==null?void 0:t.perPage)===null||u===void 0?void 0:u.toString())!==null&&f!==void 0?f:""},xform:Qz});if(I.error)throw I.error;const D=await I.json(),M=(m=I.headers.get("x-total-count"))!==null&&m!==void 0?m:0,R=(S=(i=I.headers.get("link"))===null||i===void 0?void 0:i.split(","))!==null&&S!==void 0?S:[];return R.length>0&&(R.forEach(H=>{const F=parseInt(H.split(";")[0].split("=")[1].substring(0,1)),U=JSON.parse(H.split(";")[1].split("=")[1]);E[`${U}Page`]=F}),E.total=parseInt(M)),{data:Object.assign(Object.assign({},D),E),error:null}}catch(E){if(ci(E))return{data:{clients:[]},error:E};throw E}}async _createOAuthClient(t){try{return await Bi(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(ci(r))return{data:null,error:r};throw r}}async _getOAuthClient(t){try{return await Bi(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(ci(r))return{data:null,error:r};throw r}}async _updateOAuthClient(t,r){try{return await Bi(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:r,headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(ci(s))return{data:null,error:s};throw s}}async _deleteOAuthClient(t){try{return await Bi(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(r){if(ci(r))return{data:null,error:r};throw r}}async _regenerateOAuthClientSecret(t){try{return await Bi(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(ci(r))return{data:null,error:r};throw r}}}function eB(e={}){return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}const dx={debug:!!(globalThis&&v9()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class w9 extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class Poe extends w9{}async function Doe(e,t,r){dx.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const s=new globalThis.AbortController;return t>0&&setTimeout(()=>{s.abort(),dx.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async u=>{if(u){dx.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,u.name);try{return await r()}finally{dx.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,u.name)}}else{if(t===0)throw dx.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new Poe(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(dx.debug)try{const f=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(f,null,"  "))}catch(f){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",f)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}function Roe(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function b9(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function Moe(e){return parseInt(e,16)}function Ooe(e){const t=new TextEncoder().encode(e);return"0x"+Array.from(t,s=>s.toString(16).padStart(2,"0")).join("")}function Foe(e){var t;const{chainId:r,domain:s,expirationTime:u,issuedAt:f=new Date,nonce:m,notBefore:i,requestId:S,resources:E,scheme:I,uri:D,version:M}=e;{if(!Number.isInteger(r))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!s)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(m&&m.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${m}`);if(!D)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(M!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${M}`);if(!((t=e.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`)}const R=b9(e.address),H=I?`${I}://${s}`:s,F=e.statement?`${e.statement}
`:"",U=`${H} wants you to sign in with your Ethereum account:
${R}

${F}`;let Y=`URI: ${D}
Version: ${M}
Chain ID: ${r}${m?`
Nonce: ${m}`:""}
Issued At: ${f.toISOString()}`;if(u&&(Y+=`
Expiration Time: ${u.toISOString()}`),i&&(Y+=`
Not Before: ${i.toISOString()}`),S&&(Y+=`
Request ID: ${S}`),E){let z=`
Resources:`;for(const J of E){if(!J||typeof J!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${J}`);z+=`
- ${J}`}Y+=z}return`${U}
${Y}`}class Ao extends Error{constructor({message:t,code:r,cause:s,name:u}){var f;super(t,{cause:s}),this.__isWebAuthnError=!0,this.name=(f=u??(s instanceof Error?s.name:void 0))!==null&&f!==void 0?f:"Unknown Error",this.code=r}}class YE extends Ao{constructor(t,r){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r,message:t}),this.name="WebAuthnUnknownError",this.originalError=r}}function Loe({error:e,options:t}){var r,s,u;const{publicKey:f}=t;if(!f)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Ao({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(((r=f.authenticatorSelection)===null||r===void 0?void 0:r.requireResidentKey)===!0)return new Ao({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(t.mediation==="conditional"&&((s=f.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new Ao({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if(((u=f.authenticatorSelection)===null||u===void 0?void 0:u.userVerification)==="required")return new Ao({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new Ao({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new Ao({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return f.pubKeyCredParams.filter(i=>i.type==="public-key").length===0?new Ao({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new Ao({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const m=window.location.hostname;if(S9(m)){if(f.rp.id!==m)return new Ao({message:`The RP ID "${f.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new Ao({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(f.user.id.byteLength<1||f.user.id.byteLength>64)return new Ao({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new Ao({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Ao({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function zoe({error:e,options:t}){const{publicKey:r}=t;if(!r)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Ao({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if(e.name==="NotAllowedError")return new Ao({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){const s=window.location.hostname;if(S9(s)){if(r.rpId!==s)return new Ao({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new Ao({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new Ao({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Ao({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}class Boe{createNewAbortSignal(){if(this.controller){const r=new Error("Cancelling existing WebAuthn API call for new one");r.name="AbortError",this.controller.abort(r)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const Uoe=new Boe;function Voe(e){if(!e)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:r,excludeCredentials:s}=e,u=Cm(e,["challenge","user","excludeCredentials"]),f=Zx(t).buffer,m=Object.assign(Object.assign({},r),{id:Zx(r.id).buffer}),i=Object.assign(Object.assign({},u),{challenge:f,user:m});if(s&&s.length>0){i.excludeCredentials=new Array(s.length);for(let S=0;S<s.length;S++){const E=s[S];i.excludeCredentials[S]=Object.assign(Object.assign({},E),{id:Zx(E.id).buffer,type:E.type||"public-key",transports:E.transports})}}return i}function $oe(e){if(!e)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:r}=e,s=Cm(e,["challenge","allowCredentials"]),u=Zx(t).buffer,f=Object.assign(Object.assign({},s),{challenge:u});if(r&&r.length>0){f.allowCredentials=new Array(r.length);for(let m=0;m<r.length;m++){const i=r[m];f.allowCredentials[m]=Object.assign(Object.assign({},i),{id:Zx(i.id).buffer,type:i.type||"public-key",transports:i.transports})}}return f}function qoe(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const r=e;return{id:e.id,rawId:e.id,response:{attestationObject:Gg(new Uint8Array(e.response.attestationObject)),clientDataJSON:Gg(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:(t=r.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function Goe(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const r=e,s=e.getClientExtensionResults(),u=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:Gg(new Uint8Array(u.authenticatorData)),clientDataJSON:Gg(new Uint8Array(u.clientDataJSON)),signature:Gg(new Uint8Array(u.signature)),userHandle:u.userHandle?Gg(new Uint8Array(u.userHandle)):void 0},type:"public-key",clientExtensionResults:s,authenticatorAttachment:(t=r.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function S9(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function tB(){var e,t;return!!(bl()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.create)=="function"&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.get)=="function")}async function Woe(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new YE("Browser returned unexpected credential type",t)}:{data:null,error:new YE("Empty credential response",t)}}catch(t){return{data:null,error:Loe({error:t,options:e})}}}async function Hoe(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new YE("Browser returned unexpected credential type",t)}:{data:null,error:new YE("Empty credential response",t)}}catch(t){return{data:null,error:zoe({error:t,options:e})}}}const Zoe={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"none"},Xoe={userVerification:"preferred",hints:["security-key"]};function KE(...e){const t=u=>u!==null&&typeof u=="object"&&!Array.isArray(u),r=u=>u instanceof ArrayBuffer||ArrayBuffer.isView(u),s={};for(const u of e)if(u)for(const f in u){const m=u[f];if(m!==void 0)if(Array.isArray(m))s[f]=m;else if(r(m))s[f]=m;else if(t(m)){const i=s[f];t(i)?s[f]=KE(i,m):s[f]=KE(m)}else s[f]=m}return s}function Yoe(e,t){return KE(Zoe,e,t||{})}function Koe(e,t){return KE(Xoe,e,t||{})}class Joe{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:r,friendlyName:s,signal:u},f){try{const{data:m,error:i}=await this.client.mfa.challenge({factorId:t,webauthn:r});if(!m)return{data:null,error:i};const S=u??Uoe.createNewAbortSignal();if(m.webauthn.type==="create"){const{user:E}=m.webauthn.credential_options.publicKey;E.name||(E.name=`${E.id}:${s}`),E.displayName||(E.displayName=E.name)}switch(m.webauthn.type){case"create":{const E=Yoe(m.webauthn.credential_options.publicKey,f==null?void 0:f.create),{data:I,error:D}=await Woe({publicKey:E,signal:S});return I?{data:{factorId:t,challengeId:m.id,webauthn:{type:m.webauthn.type,credential_response:I}},error:null}:{data:null,error:D}}case"request":{const E=Koe(m.webauthn.credential_options.publicKey,f==null?void 0:f.request),{data:I,error:D}=await Hoe(Object.assign(Object.assign({},m.webauthn.credential_options),{publicKey:E,signal:S}));return I?{data:{factorId:t,challengeId:m.id,webauthn:{type:m.webauthn.type,credential_response:I}},error:null}:{data:null,error:D}}}}catch(m){return ci(m)?{data:null,error:m}:{data:null,error:new Lg("Unexpected error in challenge",m)}}}async _verify({challengeId:t,factorId:r,webauthn:s}){return this.client.mfa.verify({factorId:r,challengeId:t,webauthn:s})}async _authenticate({factorId:t,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:u}},f){if(!r)return{data:null,error:new gb("rpId is required for WebAuthn authentication")};try{if(!tB())return{data:null,error:new Lg("Browser does not support WebAuthn",null)};const{data:m,error:i}=await this.challenge({factorId:t,webauthn:{rpId:r,rpOrigins:s},signal:u},{request:f});if(!m)return{data:null,error:i};const{webauthn:S}=m;return this._verify({factorId:t,challengeId:m.challengeId,webauthn:{type:S.type,rpId:r,rpOrigins:s,credential_response:S.credential_response}})}catch(m){return ci(m)?{data:null,error:m}:{data:null,error:new Lg("Unexpected error in authenticate",m)}}}async _register({friendlyName:t,rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:u},f){if(!r)return{data:null,error:new gb("rpId is required for WebAuthn registration")};try{if(!tB())return{data:null,error:new Lg("Browser does not support WebAuthn",null)};const{data:m,error:i}=await this._enroll({friendlyName:t});if(!m)return await this.client.mfa.listFactors().then(I=>{var D;return(D=I.data)===null||D===void 0?void 0:D.all.find(M=>M.factor_type==="webauthn"&&M.friendly_name===t&&M.status!=="unverified")}).then(I=>I?this.client.mfa.unenroll({factorId:I==null?void 0:I.id}):void 0),{data:null,error:i};const{data:S,error:E}=await this._challenge({factorId:m.id,friendlyName:m.friendly_name,webauthn:{rpId:r,rpOrigins:s},signal:u},{create:f});return S?this._verify({factorId:m.id,challengeId:S.challengeId,webauthn:{rpId:r,rpOrigins:s,type:S.webauthn.type,credential_response:S.webauthn.credential_response}}):{data:null,error:E}}catch(m){return ci(m)?{data:null,error:m}:{data:null,error:new Lg("Unexpected error in register",m)}}}}Roe();const Qoe={url:Xae,storageKey:Yae,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Kae,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function rB(e,t,r){return await r()}const hx={};class _b{get jwks(){var t,r;return(r=(t=hx[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(t){hx[this.storageKey]=Object.assign(Object.assign({},hx[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,r;return(r=(t=hx[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){hx[this.storageKey]=Object.assign(Object.assign({},hx[this.storageKey]),{cachedAt:t})}constructor(t){var r,s,u;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const f=Object.assign(Object.assign({},Qoe),t);if(this.storageKey=f.storageKey,this.instanceID=(r=_b.nextInstanceID[this.storageKey])!==null&&r!==void 0?r:0,_b.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!f.debug,typeof f.debug=="function"&&(this.logger=f.debug),this.instanceID>0&&bl()){const m=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(m),this.logDebugMessages&&console.trace(m)}if(this.persistSession=f.persistSession,this.autoRefreshToken=f.autoRefreshToken,this.admin=new koe({url:f.url,headers:f.headers,fetch:f.fetch}),this.url=f.url,this.headers=f.headers,this.fetch=y9(f.fetch),this.lock=f.lock||rB,this.detectSessionInUrl=f.detectSessionInUrl,this.flowType=f.flowType,this.hasCustomAuthorizationHeader=f.hasCustomAuthorizationHeader,this.throwOnError=f.throwOnError,f.lock?this.lock=f.lock:bl()&&(!((s=globalThis==null?void 0:globalThis.navigator)===null||s===void 0)&&s.locks)?this.lock=Doe:this.lock=rB,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new Joe(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this)},this.persistSession?(f.storage?this.storage=f.storage:v9()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=eB(this.memoryStorage)),f.userStorage&&(this.userStorage=f.userStorage)):(this.memoryStorage={},this.storage=eB(this.memoryStorage)),bl()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(m){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",m)}(u=this.broadcastChannel)===null||u===void 0||u.addEventListener("message",async m=>{this._debug("received broadcast notification from other tab or client",m),await this._notifyAllSubscribers(m.data.event,m.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${g9}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let r={},s="none";if(bl()&&(r=doe(window.location.href),this._isImplicitGrantCallback(r)?s="implicit":await this._isPKCECallback(r)&&(s="pkce")),bl()&&this.detectSessionInUrl&&s!=="none"){const{data:u,error:f}=await this._getSessionFromURL(r,s);if(f){if(this._debug("#_initialize()","error detecting session from URL",f),noe(f)){const S=(t=f.details)===null||t===void 0?void 0:t.code;if(S==="identity_already_exists"||S==="identity_not_found"||S==="single_identity_not_deletable")return{error:f}}return await this._removeSession(),{error:f}}const{session:m,redirectType:i}=u;return this._debug("#_initialize()","detected session in URL",m,"redirect type",i),await this._saveSession(m),setTimeout(async()=>{i==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",m):await this._notifyAllSubscribers("SIGNED_IN",m)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return ci(r)?this._returnResult({error:r}):this._returnResult({error:new Lg("Unexpected error during initialization",r)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var r,s,u;try{const f=await Bi(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(r=t==null?void 0:t.options)===null||r===void 0?void 0:r.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(u=t==null?void 0:t.options)===null||u===void 0?void 0:u.captchaToken}},xform:id}),{data:m,error:i}=f;if(i||!m)return this._returnResult({data:{user:null,session:null},error:i});const S=m.session,E=m.user;return m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",S)),this._returnResult({data:{user:E,session:S},error:null})}catch(f){if(ci(f))return this._returnResult({data:{user:null,session:null},error:f});throw f}}async signUp(t){var r,s,u;try{let f;if("email"in t){const{email:I,password:D,options:M}=t;let R=null,H=null;this.flowType==="pkce"&&([R,H]=await cx(this.storage,this.storageKey)),f=await Bi(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:M==null?void 0:M.emailRedirectTo,body:{email:I,password:D,data:(r=M==null?void 0:M.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:M==null?void 0:M.captchaToken},code_challenge:R,code_challenge_method:H},xform:id})}else if("phone"in t){const{phone:I,password:D,options:M}=t;f=await Bi(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:I,password:D,data:(s=M==null?void 0:M.data)!==null&&s!==void 0?s:{},channel:(u=M==null?void 0:M.channel)!==null&&u!==void 0?u:"sms",gotrue_meta_security:{captcha_token:M==null?void 0:M.captchaToken}},xform:id})}else throw new AT("You must provide either an email or phone number and a password");const{data:m,error:i}=f;if(i||!m)return this._returnResult({data:{user:null,session:null},error:i});const S=m.session,E=m.user;return m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",S)),this._returnResult({data:{user:E,session:S},error:null})}catch(f){if(ci(f))return this._returnResult({data:{user:null,session:null},error:f});throw f}}async signInWithPassword(t){try{let r;if("email"in t){const{email:f,password:m,options:i}=t;r=await Bi(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:f,password:m,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},xform:Jz})}else if("phone"in t){const{phone:f,password:m,options:i}=t;r=await Bi(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:f,password:m,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},xform:Jz})}else throw new AT("You must provide either an email or phone number and a password");const{data:s,error:u}=r;if(u)return this._returnResult({data:{user:null,session:null},error:u});if(!s||!s.session||!s.user){const f=new lx;return this._returnResult({data:{user:null,session:null},error:f})}return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),this._returnResult({data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:u})}catch(r){if(ci(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOAuth(t){var r,s,u,f;return await this._handleProviderSignIn(t.provider,{redirectTo:(r=t.options)===null||r===void 0?void 0:r.redirectTo,scopes:(s=t.options)===null||s===void 0?void 0:s.scopes,queryParams:(u=t.options)===null||u===void 0?void 0:u.queryParams,skipBrowserRedirect:(f=t.options)===null||f===void 0?void 0:f.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:r}=t;switch(r){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}}async signInWithEthereum(t){var r,s,u,f,m,i,S,E,I,D,M;let R,H;if("message"in t)R=t.message,H=t.signature;else{const{chain:F,wallet:U,statement:Y,options:z}=t;let J;if(bl())if(typeof U=="object")J=U;else{const be=window;if("ethereum"in be&&typeof be.ethereum=="object"&&"request"in be.ethereum&&typeof be.ethereum.request=="function")J=be.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof U!="object"||!(z!=null&&z.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");J=U}const ne=new URL((r=z==null?void 0:z.url)!==null&&r!==void 0?r:window.location.href),me=await J.request({method:"eth_requestAccounts"}).then(be=>be).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!me||me.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const le=b9(me[0]);let ye=(s=z==null?void 0:z.signInWithEthereum)===null||s===void 0?void 0:s.chainId;if(!ye){const be=await J.request({method:"eth_chainId"});ye=Moe(be)}const pe={domain:ne.host,address:le,statement:Y,uri:ne.href,version:"1",chainId:ye,nonce:(u=z==null?void 0:z.signInWithEthereum)===null||u===void 0?void 0:u.nonce,issuedAt:(m=(f=z==null?void 0:z.signInWithEthereum)===null||f===void 0?void 0:f.issuedAt)!==null&&m!==void 0?m:new Date,expirationTime:(i=z==null?void 0:z.signInWithEthereum)===null||i===void 0?void 0:i.expirationTime,notBefore:(S=z==null?void 0:z.signInWithEthereum)===null||S===void 0?void 0:S.notBefore,requestId:(E=z==null?void 0:z.signInWithEthereum)===null||E===void 0?void 0:E.requestId,resources:(I=z==null?void 0:z.signInWithEthereum)===null||I===void 0?void 0:I.resources};R=Foe(pe),H=await J.request({method:"personal_sign",params:[Ooe(R),le]})}try{const{data:F,error:U}=await Bi(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:R,signature:H},!((D=t.options)===null||D===void 0)&&D.captchaToken?{gotrue_meta_security:{captcha_token:(M=t.options)===null||M===void 0?void 0:M.captchaToken}}:null),xform:id});if(U)throw U;if(!F||!F.session||!F.user){const Y=new lx;return this._returnResult({data:{user:null,session:null},error:Y})}return F.session&&(await this._saveSession(F.session),await this._notifyAllSubscribers("SIGNED_IN",F.session)),this._returnResult({data:Object.assign({},F),error:U})}catch(F){if(ci(F))return this._returnResult({data:{user:null,session:null},error:F});throw F}}async signInWithSolana(t){var r,s,u,f,m,i,S,E,I,D,M,R;let H,F;if("message"in t)H=t.message,F=t.signature;else{const{chain:U,wallet:Y,statement:z,options:J}=t;let ne;if(bl())if(typeof Y=="object")ne=Y;else{const le=window;if("solana"in le&&typeof le.solana=="object"&&("signIn"in le.solana&&typeof le.solana.signIn=="function"||"signMessage"in le.solana&&typeof le.solana.signMessage=="function"))ne=le.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof Y!="object"||!(J!=null&&J.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");ne=Y}const me=new URL((r=J==null?void 0:J.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in ne&&ne.signIn){const le=await ne.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},J==null?void 0:J.signInWithSolana),{version:"1",domain:me.host,uri:me.href}),z?{statement:z}:null));let ye;if(Array.isArray(le)&&le[0]&&typeof le[0]=="object")ye=le[0];else if(le&&typeof le=="object"&&"signedMessage"in le&&"signature"in le)ye=le;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in ye&&"signature"in ye&&(typeof ye.signedMessage=="string"||ye.signedMessage instanceof Uint8Array)&&ye.signature instanceof Uint8Array)H=typeof ye.signedMessage=="string"?ye.signedMessage:new TextDecoder().decode(ye.signedMessage),F=ye.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in ne)||typeof ne.signMessage!="function"||!("publicKey"in ne)||typeof ne!="object"||!ne.publicKey||!("toBase58"in ne.publicKey)||typeof ne.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");H=[`${me.host} wants you to sign in with your Solana account:`,ne.publicKey.toBase58(),...z?["",z,""]:[""],"Version: 1",`URI: ${me.href}`,`Issued At: ${(u=(s=J==null?void 0:J.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&u!==void 0?u:new Date().toISOString()}`,...!((f=J==null?void 0:J.signInWithSolana)===null||f===void 0)&&f.notBefore?[`Not Before: ${J.signInWithSolana.notBefore}`]:[],...!((m=J==null?void 0:J.signInWithSolana)===null||m===void 0)&&m.expirationTime?[`Expiration Time: ${J.signInWithSolana.expirationTime}`]:[],...!((i=J==null?void 0:J.signInWithSolana)===null||i===void 0)&&i.chainId?[`Chain ID: ${J.signInWithSolana.chainId}`]:[],...!((S=J==null?void 0:J.signInWithSolana)===null||S===void 0)&&S.nonce?[`Nonce: ${J.signInWithSolana.nonce}`]:[],...!((E=J==null?void 0:J.signInWithSolana)===null||E===void 0)&&E.requestId?[`Request ID: ${J.signInWithSolana.requestId}`]:[],...!((D=(I=J==null?void 0:J.signInWithSolana)===null||I===void 0?void 0:I.resources)===null||D===void 0)&&D.length?["Resources",...J.signInWithSolana.resources.map(ye=>`- ${ye}`)]:[]].join(`
`);const le=await ne.signMessage(new TextEncoder().encode(H),"utf8");if(!le||!(le instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");F=le}}try{const{data:U,error:Y}=await Bi(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:H,signature:Gg(F)},!((M=t.options)===null||M===void 0)&&M.captchaToken?{gotrue_meta_security:{captcha_token:(R=t.options)===null||R===void 0?void 0:R.captchaToken}}:null),xform:id});if(Y)throw Y;if(!U||!U.session||!U.user){const z=new lx;return this._returnResult({data:{user:null,session:null},error:z})}return U.session&&(await this._saveSession(U.session),await this._notifyAllSubscribers("SIGNED_IN",U.session)),this._returnResult({data:Object.assign({},U),error:Y})}catch(U){if(ci(U))return this._returnResult({data:{user:null,session:null},error:U});throw U}}async _exchangeCodeForSession(t){const r=await kg(this.storage,`${this.storageKey}-code-verifier`),[s,u]=(r??"").split("/");try{const{data:f,error:m}=await Bi(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:s},xform:id});if(await bp(this.storage,`${this.storageKey}-code-verifier`),m)throw m;if(!f||!f.session||!f.user){const i=new lx;return this._returnResult({data:{user:null,session:null,redirectType:null},error:i})}return f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("SIGNED_IN",f.session)),this._returnResult({data:Object.assign(Object.assign({},f),{redirectType:u??null}),error:m})}catch(f){if(ci(f))return this._returnResult({data:{user:null,session:null,redirectType:null},error:f});throw f}}async signInWithIdToken(t){try{const{options:r,provider:s,token:u,access_token:f,nonce:m}=t,i=await Bi(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:u,access_token:f,nonce:m,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},xform:id}),{data:S,error:E}=i;if(E)return this._returnResult({data:{user:null,session:null},error:E});if(!S||!S.session||!S.user){const I=new lx;return this._returnResult({data:{user:null,session:null},error:I})}return S.session&&(await this._saveSession(S.session),await this._notifyAllSubscribers("SIGNED_IN",S.session)),this._returnResult({data:S,error:E})}catch(r){if(ci(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOtp(t){var r,s,u,f,m;try{if("email"in t){const{email:i,options:S}=t;let E=null,I=null;this.flowType==="pkce"&&([E,I]=await cx(this.storage,this.storageKey));const{error:D}=await Bi(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:i,data:(r=S==null?void 0:S.data)!==null&&r!==void 0?r:{},create_user:(s=S==null?void 0:S.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:S==null?void 0:S.captchaToken},code_challenge:E,code_challenge_method:I},redirectTo:S==null?void 0:S.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:D})}if("phone"in t){const{phone:i,options:S}=t,{data:E,error:I}=await Bi(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:i,data:(u=S==null?void 0:S.data)!==null&&u!==void 0?u:{},create_user:(f=S==null?void 0:S.shouldCreateUser)!==null&&f!==void 0?f:!0,gotrue_meta_security:{captcha_token:S==null?void 0:S.captchaToken},channel:(m=S==null?void 0:S.channel)!==null&&m!==void 0?m:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:E==null?void 0:E.message_id},error:I})}throw new AT("You must provide either an email or phone number.")}catch(i){if(ci(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async verifyOtp(t){var r,s;try{let u,f;"options"in t&&(u=(r=t.options)===null||r===void 0?void 0:r.redirectTo,f=(s=t.options)===null||s===void 0?void 0:s.captchaToken);const{data:m,error:i}=await Bi(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:f}}),redirectTo:u,xform:id});if(i)throw i;if(!m)throw new Error("An error occurred on token verification.");const S=m.session,E=m.user;return S!=null&&S.access_token&&(await this._saveSession(S),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",S)),this._returnResult({data:{user:E,session:S},error:null})}catch(u){if(ci(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async signInWithSSO(t){var r,s,u;try{let f=null,m=null;this.flowType==="pkce"&&([f,m]=await cx(this.storage,this.storageKey));const i=await Bi(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(s=(r=t.options)===null||r===void 0?void 0:r.redirectTo)!==null&&s!==void 0?s:void 0}),!((u=t==null?void 0:t.options)===null||u===void 0)&&u.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:f,code_challenge_method:m}),headers:this.headers,xform:joe});return this._returnResult(i)}catch(f){if(ci(f))return this._returnResult({data:null,error:f});throw f}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:r},error:s}=t;if(s)throw s;if(!r)throw new nd;const{error:u}=await Bi(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return this._returnResult({data:{user:null,session:null},error:u})})}catch(t){if(ci(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const r=`${this.url}/resend`;if("email"in t){const{email:s,type:u,options:f}=t,{error:m}=await Bi(this.fetch,"POST",r,{headers:this.headers,body:{email:s,type:u,gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},redirectTo:f==null?void 0:f.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:m})}else if("phone"in t){const{phone:s,type:u,options:f}=t,{data:m,error:i}=await Bi(this.fetch,"POST",r,{headers:this.headers,body:{phone:s,type:u,gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:m==null?void 0:m.message_id},error:i})}throw new AT("You must provide either an email or phone number and a type")}catch(r){if(ci(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(t,r){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),u=(async()=>(await s,await r()))();return this.pendingInLock.push((async()=>{try{await u}catch{}})()),u}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=r();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const u=[...this.pendingInLock];await Promise.all(u),this.pendingInLock.splice(0,u.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await t(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const r=await kg(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?t=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const s=t.expires_at?t.expires_at*1e3-Date.now()<vN:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",t.expires_at),!s){if(this.userStorage){const m=await kg(this.userStorage,this.storageKey+"-user");m!=null&&m.user?t.user=m.user:t.user=bN()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const m={value:this.suppressGetSessionWarning};t.user=Toe(t.user,m),m.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:u,error:f}=await this._callRefreshToken(t.refresh_token);return f?this._returnResult({data:{session:null},error:f}):this._returnResult({data:{session:u},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){return t?await this._getUser(t):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(t){try{return t?await Bi(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:Pp}):await this._useSession(async r=>{var s,u,f;const{data:m,error:i}=r;if(i)throw i;return!(!((s=m.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new nd}:await Bi(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(f=(u=m.session)===null||u===void 0?void 0:u.access_token)!==null&&f!==void 0?f:void 0,xform:Pp})})}catch(r){if(ci(r))return roe(r)&&(await this._removeSession(),await bp(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:r});throw r}}async updateUser(t,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,r))}async _updateUser(t,r={}){try{return await this._useSession(async s=>{const{data:u,error:f}=s;if(f)throw f;if(!u.session)throw new nd;const m=u.session;let i=null,S=null;this.flowType==="pkce"&&t.email!=null&&([i,S]=await cx(this.storage,this.storageKey));const{data:E,error:I}=await Bi(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r==null?void 0:r.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:i,code_challenge_method:S}),jwt:m.access_token,xform:Pp});if(I)throw I;return m.user=E.user,await this._saveSession(m),await this._notifyAllSubscribers("USER_UPDATED",m),this._returnResult({data:{user:m.user},error:null})})}catch(s){if(ci(s))return this._returnResult({data:{user:null},error:s});throw s}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new nd;const r=Date.now()/1e3;let s=r,u=!0,f=null;const{payload:m}=wN(t.access_token);if(m.exp&&(s=m.exp,u=s<=r),u){const{data:i,error:S}=await this._callRefreshToken(t.refresh_token);if(S)return this._returnResult({data:{user:null,session:null},error:S});if(!i)return{data:{user:null,session:null},error:null};f=i}else{const{data:i,error:S}=await this._getUser(t.access_token);if(S)throw S;f={access_token:t.access_token,refresh_token:t.refresh_token,user:i.user,token_type:"bearer",expires_in:s-r,expires_at:s},await this._saveSession(f),await this._notifyAllSubscribers("SIGNED_IN",f)}return this._returnResult({data:{user:f.user,session:f},error:null})}catch(r){if(ci(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async r=>{var s;if(!t){const{data:m,error:i}=r;if(i)throw i;t=(s=m.session)!==null&&s!==void 0?s:void 0}if(!(t!=null&&t.refresh_token))throw new nd;const{data:u,error:f}=await this._callRefreshToken(t.refresh_token);return f?this._returnResult({data:{user:null,session:null},error:f}):u?this._returnResult({data:{user:u.user,session:u},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(r){if(ci(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async _getSessionFromURL(t,r){try{if(!bl())throw new jT("No browser detected.");if(t.error||t.error_description||t.error_code)throw new jT(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new Gz("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new jT("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new Gz("No code detected.");const{data:z,error:J}=await this._exchangeCodeForSession(t.code);if(J)throw J;const ne=new URL(window.location.href);return ne.searchParams.delete("code"),window.history.replaceState(window.history.state,"",ne.toString()),{data:{session:z.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:u,access_token:f,refresh_token:m,expires_in:i,expires_at:S,token_type:E}=t;if(!f||!i||!m||!E)throw new jT("No session defined in URL");const I=Math.round(Date.now()/1e3),D=parseInt(i);let M=I+D;S&&(M=parseInt(S));const R=M-I;R*1e3<=bx&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${R}s, should have been closer to ${D}s`);const H=M-D;I-H>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",H,M,I):I-H<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",H,M,I);const{data:F,error:U}=await this._getUser(f);if(U)throw U;const Y={provider_token:s,provider_refresh_token:u,access_token:f,expires_in:D,expires_at:M,refresh_token:m,token_type:E,user:F.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:Y,redirectType:t.type},error:null})}catch(s){if(ci(s))return this._returnResult({data:{session:null,redirectType:null},error:s});throw s}}_isImplicitGrantCallback(t){return!!(t.access_token||t.error_description)}async _isPKCECallback(t){const r=await kg(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&r)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async r=>{var s;const{data:u,error:f}=r;if(f)return this._returnResult({error:f});const m=(s=u.session)===null||s===void 0?void 0:s.access_token;if(m){const{error:i}=await this.admin.signOut(m,t);if(i&&!(toe(i)&&(i.status===404||i.status===401||i.status===403)))return this._returnResult({error:i})}return t!=="others"&&(await this._removeSession(),await bp(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const r=uoe(),s={id:r,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:s}}}async _emitInitialSession(t){return await this._useSession(async r=>{var s,u;try{const{data:{session:f},error:m}=r;if(m)throw m;await((s=this.stateChangeEmitters.get(t))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",f)),this._debug("INITIAL_SESSION","callback id",t,"session",f)}catch(f){await((u=this.stateChangeEmitters.get(t))===null||u===void 0?void 0:u.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",f),console.error(f)}})}async resetPasswordForEmail(t,r={}){let s=null,u=null;this.flowType==="pkce"&&([s,u]=await cx(this.storage,this.storageKey,!0));try{return await Bi(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:s,code_challenge_method:u,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(f){if(ci(f))return this._returnResult({data:null,error:f});throw f}}async getUserIdentities(){var t;try{const{data:r,error:s}=await this.getUser();if(s)throw s;return this._returnResult({data:{identities:(t=r.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(r){if(ci(r))return this._returnResult({data:null,error:r});throw r}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var r;try{const{data:s,error:u}=await this._useSession(async f=>{var m,i,S,E,I;const{data:D,error:M}=f;if(M)throw M;const R=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(m=t.options)===null||m===void 0?void 0:m.redirectTo,scopes:(i=t.options)===null||i===void 0?void 0:i.scopes,queryParams:(S=t.options)===null||S===void 0?void 0:S.queryParams,skipBrowserRedirect:!0});return await Bi(this.fetch,"GET",R,{headers:this.headers,jwt:(I=(E=D.session)===null||E===void 0?void 0:E.access_token)!==null&&I!==void 0?I:void 0})});if(u)throw u;return bl()&&!(!((r=t.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),this._returnResult({data:{provider:t.provider,url:s==null?void 0:s.url},error:null})}catch(s){if(ci(s))return this._returnResult({data:{provider:t.provider,url:null},error:s});throw s}}async linkIdentityIdToken(t){return await this._useSession(async r=>{var s;try{const{error:u,data:{session:f}}=r;if(u)throw u;const{options:m,provider:i,token:S,access_token:E,nonce:I}=t,D=await Bi(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(s=f==null?void 0:f.access_token)!==null&&s!==void 0?s:void 0,body:{provider:i,id_token:S,access_token:E,nonce:I,link_identity:!0,gotrue_meta_security:{captcha_token:m==null?void 0:m.captchaToken}},xform:id}),{data:M,error:R}=D;return R?this._returnResult({data:{user:null,session:null},error:R}):!M||!M.session||!M.user?this._returnResult({data:{user:null,session:null},error:new lx}):(M.session&&(await this._saveSession(M.session),await this._notifyAllSubscribers("USER_UPDATED",M.session)),this._returnResult({data:M,error:R}))}catch(u){if(ci(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}})}async unlinkIdentity(t){try{return await this._useSession(async r=>{var s,u;const{data:f,error:m}=r;if(m)throw m;return await Bi(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(u=(s=f.session)===null||s===void 0?void 0:s.access_token)!==null&&u!==void 0?u:void 0})})}catch(r){if(ci(r))return this._returnResult({data:null,error:r});throw r}}async _refreshAccessToken(t){const r=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(r,"begin");try{const s=Date.now();return await poe(async u=>(u>0&&await foe(200*Math.pow(2,u-1)),this._debug(r,"refreshing attempt",u),await Bi(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:id})),(u,f)=>{const m=200*Math.pow(2,u);return f&&yN(f)&&Date.now()+m-s<bx})}catch(s){if(this._debug(r,"error",s),ci(s))return this._returnResult({data:{session:null,user:null},error:s});throw s}finally{this._debug(r,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,r){const s=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",r,"url",s),bl()&&!r.skipBrowserRedirect&&window.location.assign(s),{data:{provider:t,url:s},error:null}}async _recoverAndRefresh(){var t,r;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const u=await kg(this.storage,this.storageKey);if(u&&this.userStorage){let m=await kg(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!m&&(m={user:u.user},await Sx(this.userStorage,this.storageKey+"-user",m)),u.user=(t=m==null?void 0:m.user)!==null&&t!==void 0?t:bN()}else if(u&&!u.user&&!u.user){const m=await kg(this.storage,this.storageKey+"-user");m&&(m!=null&&m.user)?(u.user=m.user,await bp(this.storage,this.storageKey+"-user"),await Sx(this.storage,this.storageKey,u)):u.user=bN()}if(this._debug(s,"session from storage",u),!this._isValidSession(u)){this._debug(s,"session is not valid"),u!==null&&await this._removeSession();return}const f=((r=u.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<vN;if(this._debug(s,`session has${f?"":" not"} expired with margin of ${vN}s`),f){if(this.autoRefreshToken&&u.refresh_token){const{error:m}=await this._callRefreshToken(u.refresh_token);m&&(console.error(m),yN(m)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",m),await this._removeSession()))}}else if(u.user&&u.user.__isUserNotAvailableProxy===!0)try{const{data:m,error:i}=await this._getUser(u.access_token);!i&&(m!=null&&m.user)?(u.user=m.user,await this._saveSession(u),await this._notifyAllSubscribers("SIGNED_IN",u)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(m){console.error("Error getting user data:",m),this._debug(s,"error getting user data, skipping SIGNED_IN notification",m)}else await this._notifyAllSubscribers("SIGNED_IN",u)}catch(u){this._debug(s,"error",u),console.error(u);return}finally{this._debug(s,"end")}}async _callRefreshToken(t){var r,s;if(!t)throw new nd;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const u=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(u,"begin");try{this.refreshingDeferred=new oA;const{data:f,error:m}=await this._refreshAccessToken(t);if(m)throw m;if(!f.session)throw new nd;await this._saveSession(f.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",f.session);const i={data:f.session,error:null};return this.refreshingDeferred.resolve(i),i}catch(f){if(this._debug(u,"error",f),ci(f)){const m={data:null,error:f};return yN(f)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(m),m}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(f),f}finally{this.refreshingDeferred=null,this._debug(u,"end")}}async _notifyAllSubscribers(t,r,s=!0){const u=`#_notifyAllSubscribers(${t})`;this._debug(u,"begin",r,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:t,session:r});const f=[],m=Array.from(this.stateChangeEmitters.values()).map(async i=>{try{await i.callback(t,r)}catch(S){f.push(S)}});if(await Promise.all(m),f.length>0){for(let i=0;i<f.length;i+=1)console.error(f[i]);throw f[0]}}finally{this._debug(u,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0;const r=Object.assign({},t),s=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!s&&r.user&&await Sx(this.userStorage,this.storageKey+"-user",{user:r.user});const u=Object.assign({},r);delete u.user;const f=Yz(u);await Sx(this.storage,this.storageKey,f)}else{const u=Yz(r);await Sx(this.storage,this.storageKey,u)}}async _removeSession(){this._debug("#_removeSession()"),await bp(this.storage,this.storageKey),await bp(this.storage,this.storageKey+"-code-verifier"),await bp(this.storage,this.storageKey+"-user"),this.userStorage&&await bp(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&bl()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),bx);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async r=>{const{data:{session:s}}=r;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const u=Math.floor((s.expires_at*1e3-t)/bx);this._debug("#_autoRefreshTokenTick()",`access token expires in ${u} ticks, a tick lasts ${bx}ms, refresh threshold is ${kP} ticks`),u<=kP&&await this._callRefreshToken(s.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof w9)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!bl()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const r=`#_onVisibilityChanged(${t})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,r,s){const u=[`provider=${encodeURIComponent(r)}`];if(s!=null&&s.redirectTo&&u.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&u.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[f,m]=await cx(this.storage,this.storageKey),i=new URLSearchParams({code_challenge:`${encodeURIComponent(f)}`,code_challenge_method:`${encodeURIComponent(m)}`});u.push(i.toString())}if(s!=null&&s.queryParams){const f=new URLSearchParams(s.queryParams);u.push(f.toString())}return s!=null&&s.skipBrowserRedirect&&u.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${t}?${u.join("&")}`}async _unenroll(t){try{return await this._useSession(async r=>{var s;const{data:u,error:f}=r;return f?this._returnResult({data:null,error:f}):await Bi(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(s=u==null?void 0:u.session)===null||s===void 0?void 0:s.access_token})})}catch(r){if(ci(r))return this._returnResult({data:null,error:r});throw r}}async _enroll(t){try{return await this._useSession(async r=>{var s,u;const{data:f,error:m}=r;if(m)return this._returnResult({data:null,error:m});const i=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:S,error:E}=await Bi(this.fetch,"POST",`${this.url}/factors`,{body:i,headers:this.headers,jwt:(s=f==null?void 0:f.session)===null||s===void 0?void 0:s.access_token});return E?this._returnResult({data:null,error:E}):(t.factorType==="totp"&&S.type==="totp"&&(!((u=S==null?void 0:S.totp)===null||u===void 0)&&u.qr_code)&&(S.totp.qr_code=`data:image/svg+xml;utf-8,${S.totp.qr_code}`),this._returnResult({data:S,error:null}))})}catch(r){if(ci(r))return this._returnResult({data:null,error:r});throw r}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var s;const{data:u,error:f}=r;if(f)return this._returnResult({data:null,error:f});const m=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?qoe(t.webauthn.credential_response):Goe(t.webauthn.credential_response)})}:{code:t.code}),{data:i,error:S}=await Bi(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:m,headers:this.headers,jwt:(s=u==null?void 0:u.session)===null||s===void 0?void 0:s.access_token});return S?this._returnResult({data:null,error:S}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),this._returnResult({data:i,error:S}))})}catch(r){if(ci(r))return this._returnResult({data:null,error:r});throw r}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var s;const{data:u,error:f}=r;if(f)return this._returnResult({data:null,error:f});const m=await Bi(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(s=u==null?void 0:u.session)===null||s===void 0?void 0:s.access_token});if(m.error)return m;const{data:i}=m;if(i.type!=="webauthn")return{data:i,error:null};switch(i.webauthn.type){case"create":return{data:Object.assign(Object.assign({},i),{webauthn:Object.assign(Object.assign({},i.webauthn),{credential_options:Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:Voe(i.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},i),{webauthn:Object.assign(Object.assign({},i.webauthn),{credential_options:Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:$oe(i.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(r){if(ci(r))return this._returnResult({data:null,error:r});throw r}})}async _challengeAndVerify(t){const{data:r,error:s}=await this._challenge({factorId:t.factorId});return s?this._returnResult({data:null,error:s}):await this._verify({factorId:t.factorId,challengeId:r.id,code:t.code})}async _listFactors(){var t;const{data:{user:r},error:s}=await this.getUser();if(s)return{data:null,error:s};const u={all:[],phone:[],totp:[],webauthn:[]};for(const f of(t=r==null?void 0:r.factors)!==null&&t!==void 0?t:[])u.all.push(f),f.status==="verified"&&u[f.factor_type].push(f);return{data:u,error:null}}async _getAuthenticatorAssuranceLevel(){var t,r;const{data:{session:s},error:u}=await this.getSession();if(u)return this._returnResult({data:null,error:u});if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:f}=wN(s.access_token);let m=null;f.aal&&(m=f.aal);let i=m;((r=(t=s.user.factors)===null||t===void 0?void 0:t.filter(I=>I.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(i="aal2");const E=f.amr||[];return{data:{currentLevel:m,nextLevel:i,currentAuthenticationMethods:E},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async r=>{const{data:{session:s},error:u}=r;return u?this._returnResult({data:null,error:u}):s?await Bi(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:s.access_token,xform:f=>({data:f,error:null})}):this._returnResult({data:null,error:new nd})})}catch(r){if(ci(r))return this._returnResult({data:null,error:r});throw r}}async _approveAuthorization(t,r){try{return await this._useSession(async s=>{const{data:{session:u},error:f}=s;if(f)return this._returnResult({data:null,error:f});if(!u)return this._returnResult({data:null,error:new nd});const m=await Bi(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:u.access_token,body:{action:"approve"},xform:i=>({data:i,error:null})});return m.data&&m.data.redirect_url&&bl()&&!(r!=null&&r.skipBrowserRedirect)&&window.location.assign(m.data.redirect_url),m})}catch(s){if(ci(s))return this._returnResult({data:null,error:s});throw s}}async _denyAuthorization(t,r){try{return await this._useSession(async s=>{const{data:{session:u},error:f}=s;if(f)return this._returnResult({data:null,error:f});if(!u)return this._returnResult({data:null,error:new nd});const m=await Bi(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:u.access_token,body:{action:"deny"},xform:i=>({data:i,error:null})});return m.data&&m.data.redirect_url&&bl()&&!(r!=null&&r.skipBrowserRedirect)&&window.location.assign(m.data.redirect_url),m})}catch(s){if(ci(s))return this._returnResult({data:null,error:s});throw s}}async fetchJwk(t,r={keys:[]}){let s=r.keys.find(i=>i.kid===t);if(s)return s;const u=Date.now();if(s=this.jwks.keys.find(i=>i.kid===t),s&&this.jwks_cached_at+Qae>u)return s;const{data:f,error:m}=await Bi(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(m)throw m;return!f.keys||f.keys.length===0||(this.jwks=f,this.jwks_cached_at=u,s=f.keys.find(i=>i.kid===t),!s)?null:s}async getClaims(t,r={}){try{let s=t;if(!s){const{data:R,error:H}=await this.getSession();if(H||!R.session)return this._returnResult({data:null,error:H});s=R.session.access_token}const{header:u,payload:f,signature:m,raw:{header:i,payload:S}}=wN(s);r!=null&&r.allowExpired||woe(f.exp);const E=!u.alg||u.alg.startsWith("HS")||!u.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(u.kid,r!=null&&r.keys?{keys:r.keys}:r==null?void 0:r.jwks);if(!E){const{error:R}=await this.getUser(s);if(R)throw R;return{data:{claims:f,header:u,signature:m},error:null}}const I=boe(u.alg),D=await crypto.subtle.importKey("jwk",E,I,!0,["verify"]);if(!await crypto.subtle.verify(I,D,m,loe(`${i}.${S}`)))throw new RP("Invalid JWT signature");return{data:{claims:f,header:u,signature:m},error:null}}catch(s){if(ci(s))return this._returnResult({data:null,error:s});throw s}}}_b.nextInstanceID={};const ele=_b;class tle extends ele{constructor(t){super(t)}}class rle{constructor(t,r,s){var u,f,m;this.supabaseUrl=t,this.supabaseKey=r;const i=Zae(t);if(!r)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const S=`sb-${i.hostname.split(".")[0]}-auth-token`,E={db:Bae,realtime:Vae,auth:Object.assign(Object.assign({},Uae),{storageKey:S}),global:zae},I=Hae(s??{},E);this.storageKey=(u=I.auth.storageKey)!==null&&u!==void 0?u:"",this.headers=(f=I.global.headers)!==null&&f!==void 0?f:{},I.accessToken?(this.accessToken=I.accessToken,this.auth=new Proxy({},{get:(D,M)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(M)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((m=I.auth)!==null&&m!==void 0?m:{},this.headers,I.global.fetch),this.fetch=Gae(r,this._getAccessToken.bind(this),I.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},I.realtime)),this.rest=new Xse(new URL("rest/v1",i).href,{headers:this.headers,schema:I.db.schema,fetch:this.fetch}),this.storage=new Oae(this.storageUrl.href,this.headers,this.fetch,s==null?void 0:s.storage),I.accessToken||this._listenForAuthEvents()}get functions(){return new Wse(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,r={},s={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,r,s)}channel(t,r={config:{}}){return this.realtime.channel(t,r)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t,r;if(this.accessToken)return await this.accessToken();const{data:s}=await this.auth.getSession();return(r=(t=s.session)===null||t===void 0?void 0:t.access_token)!==null&&r!==void 0?r:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:r,detectSessionInUrl:s,storage:u,userStorage:f,storageKey:m,flowType:i,lock:S,debug:E,throwOnError:I},D,M){const R={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new tle({url:this.authUrl.href,headers:Object.assign(Object.assign({},R),D),storageKey:m,autoRefreshToken:t,persistSession:r,detectSessionInUrl:s,storage:u,userStorage:f,flowType:i,lock:S,debug:E,throwOnError:I,fetch:M,hasCustomAuthorizationHeader:Object.keys(this.headers).some(H=>H.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new hae(this.realtimeUrl.href,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((r,s)=>{this._handleTokenChanged(r,"CLIENT",s==null?void 0:s.access_token)})}_handleTokenChanged(t,r,s){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==s?(this.changedAccessToken=s,this.realtime.setAuth(s)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),r=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const nle=(e,t,r)=>new rle(e,t,r);function ile(){if(typeof window<"u"||typeof process>"u")return!1;const e=process.version;if(e==null)return!1;const t=e.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}ile()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const sle="https://jcsmwkkytigomvibwsnb.supabase.co",ale="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Impjc213a2t5dGlnb212aWJ3c25iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI0MzU3NDUsImV4cCI6MjA3ODAxMTc0NX0.jkbRoq_Gd_WdqCQOx_KnbPuyDEuchdmbCgwj-ZRxdT0",tt=nle(sle,ale,{auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0}}),js=({children:e})=>{const[t,r]=V.useState(null),[s,u]=V.useState(!0);return V.useEffect(()=>{const{data:{subscription:f}}=tt.auth.onAuthStateChange((m,i)=>{r(i),u(!1)});return tt.auth.getSession().then(({data:{session:m}})=>{r(m),u(!1)}),()=>f.unsubscribe()},[]),s?c.jsx("div",{className:"flex items-center justify-center h-screen",children:c.jsx(bf,{className:"h-8 w-8 animate-spin text-primary"})}):t?c.jsx(c.Fragment,{children:e}):c.jsx(Sse,{to:"/auth",replace:!0})},xb=Fv("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Nt=V.forwardRef(({className:e,variant:t,size:r,asChild:s=!1,...u},f)=>{const m=s?N_:"button";return c.jsx(m,{className:sn(xb({variant:t,size:r,className:e})),ref:f,...u})});Nt.displayName="Button";const ole=()=>{const e=Id(),[t,r]=V.useState(!0);if(V.useEffect(()=>{tt.auth.getSession().then(({data:{session:f}})=>{f?e("/dashboard"):r(!1)});const{data:{subscription:u}}=tt.auth.onAuthStateChange((f,m)=>{m&&e("/dashboard")});return()=>u.unsubscribe()},[e]),t)return null;const s=[{icon:iE,title:"Monitoramento 24/7",description:"Centro de controle operacional em tempo real"},{icon:cm,title:"Gesto de Contratos",description:"Hierarquia Cliente  Contrato  Unidade  Posto"},{icon:of,title:"Gesto de Colaboradores",description:"Controle de escalas, presena e performance"},{icon:Sm,title:"Ordens de Servio",description:"Preventivas, corretivas e emergenciais"},{icon:zb,title:"Checklists Inteligentes",description:"Inspees programadas e auditoria completa"},{icon:Xk,title:"Dashboard Executivo",description:"KPIs, SLA e NPS em tempo real"}];return c.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/5 via-background to-accent/5",children:[c.jsxs("div",{className:"container mx-auto px-4 py-16",children:[c.jsxs("div",{className:"text-center max-w-4xl mx-auto mb-16",children:[c.jsx("div",{className:"inline-flex p-4 bg-gradient-to-br from-primary to-accent rounded-2xl mb-6 shadow-lg",children:c.jsx(cm,{className:"h-16 w-16 text-primary-foreground"})}),c.jsx("h1",{className:"text-5xl md:text-6xl font-bold mb-6 bg-gradient-to-r from-primary via-accent to-primary bg-clip-text text-transparent",children:"Facilities Center"}),c.jsx("p",{className:"text-xl text-muted-foreground mb-4",children:"Plataforma de gesto de operaes de servio que atua como ncleo de inteligncia operacional 24/7"}),c.jsx("p",{className:"text-lg text-muted-foreground mb-8",children:"Monitoramento contnuo e preditivo com preciso e inteligncia para garantir estabilidade operacional"}),c.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[c.jsx(Nt,{size:"lg",onClick:()=>e("/auth"),className:"text-lg px-8 shadow-lg hover:shadow-xl transition-shadow",children:"Acessar Plataforma"}),c.jsx(Nt,{size:"lg",variant:"outline",onClick:()=>e("/auth"),className:"text-lg px-8",children:"Criar Conta"})]})]}),c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-16",children:s.map((u,f)=>c.jsxs("div",{className:"bg-card p-6 rounded-xl shadow-md hover:shadow-lg transition-all duration-300 hover:-translate-y-1 border",children:[c.jsx("div",{className:"inline-flex p-3 bg-primary/10 rounded-lg mb-4",children:c.jsx(u.icon,{className:"h-6 w-6 text-primary"})}),c.jsx("h3",{className:"text-lg font-semibold mb-2",children:u.title}),c.jsx("p",{className:"text-sm text-muted-foreground",children:u.description})]},f))}),c.jsxs("div",{className:"bg-card rounded-2xl p-8 shadow-lg border max-w-4xl mx-auto",children:[c.jsx("h2",{className:"text-3xl font-bold mb-6 text-center",children:"Controle de Acesso por Perfil (RBAC)"}),c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[{role:"Administrador",description:"Acesso total ao sistema"},{role:"Gestor de Operaes",description:"Tudo exceto gesto de usurios"},{role:"Supervisor",description:"CRUD de OS, incidentes, checklists e presena"},{role:"Analista Centro Controle",description:"Leitura total + abertura de OS e incidentes"},{role:"Tcnico",description:"Visualizar OS atribudas e executar checklists"},{role:"Cliente View",description:"Somente leitura e comentrios"}].map((u,f)=>c.jsxs("div",{className:"flex items-start gap-3 p-4 bg-muted/50 rounded-lg",children:[c.jsx(aR,{className:"h-5 w-5 text-primary flex-shrink-0 mt-0.5"}),c.jsxs("div",{children:[c.jsx("p",{className:"font-semibold",children:u.role}),c.jsx("p",{className:"text-sm text-muted-foreground",children:u.description})]})]},f))})]})]}),c.jsx("footer",{className:"border-t bg-card/50 py-8",children:c.jsx("div",{className:"container mx-auto px-4 text-center text-muted-foreground",children:c.jsx("p",{children:" 2025 Facilities Center - Delta Facilities. Todos os direitos reservados."})})})]})};var ea;(function(e){e.assertEqual=u=>{};function t(u){}e.assertIs=t;function r(u){throw new Error}e.assertNever=r,e.arrayToEnum=u=>{const f={};for(const m of u)f[m]=m;return f},e.getValidEnumValues=u=>{const f=e.objectKeys(u).filter(i=>typeof u[u[i]]!="number"),m={};for(const i of f)m[i]=u[i];return e.objectValues(m)},e.objectValues=u=>e.objectKeys(u).map(function(f){return u[f]}),e.objectKeys=typeof Object.keys=="function"?u=>Object.keys(u):u=>{const f=[];for(const m in u)Object.prototype.hasOwnProperty.call(u,m)&&f.push(m);return f},e.find=(u,f)=>{for(const m of u)if(f(m))return m},e.isInteger=typeof Number.isInteger=="function"?u=>Number.isInteger(u):u=>typeof u=="number"&&Number.isFinite(u)&&Math.floor(u)===u;function s(u,f=" | "){return u.map(m=>typeof m=="string"?`'${m}'`:m).join(f)}e.joinValues=s,e.jsonStringifyReplacer=(u,f)=>typeof f=="bigint"?f.toString():f})(ea||(ea={}));var nB;(function(e){e.mergeShapes=(t,r)=>({...t,...r})})(nB||(nB={}));const Qn=ea.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Ip=e=>{switch(typeof e){case"undefined":return Qn.undefined;case"string":return Qn.string;case"number":return Number.isNaN(e)?Qn.nan:Qn.number;case"boolean":return Qn.boolean;case"function":return Qn.function;case"bigint":return Qn.bigint;case"symbol":return Qn.symbol;case"object":return Array.isArray(e)?Qn.array:e===null?Qn.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?Qn.promise:typeof Map<"u"&&e instanceof Map?Qn.map:typeof Set<"u"&&e instanceof Set?Qn.set:typeof Date<"u"&&e instanceof Date?Qn.date:Qn.object;default:return Qn.unknown}},ln=ea.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Au extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};const r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=t}format(t){const r=t||function(f){return f.message},s={_errors:[]},u=f=>{for(const m of f.issues)if(m.code==="invalid_union")m.unionErrors.map(u);else if(m.code==="invalid_return_type")u(m.returnTypeError);else if(m.code==="invalid_arguments")u(m.argumentsError);else if(m.path.length===0)s._errors.push(r(m));else{let i=s,S=0;for(;S<m.path.length;){const E=m.path[S];S===m.path.length-1?(i[E]=i[E]||{_errors:[]},i[E]._errors.push(r(m))):i[E]=i[E]||{_errors:[]},i=i[E],S++}}};return u(this),s}static assert(t){if(!(t instanceof Au))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ea.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=r=>r.message){const r={},s=[];for(const u of this.issues)if(u.path.length>0){const f=u.path[0];r[f]=r[f]||[],r[f].push(t(u))}else s.push(t(u));return{formErrors:s,fieldErrors:r}}get formErrors(){return this.flatten()}}Au.create=e=>new Au(e);const MP=(e,t)=>{let r;switch(e.code){case ln.invalid_type:e.received===Qn.undefined?r="Required":r=`Expected ${e.expected}, received ${e.received}`;break;case ln.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,ea.jsonStringifyReplacer)}`;break;case ln.unrecognized_keys:r=`Unrecognized key(s) in object: ${ea.joinValues(e.keys,", ")}`;break;case ln.invalid_union:r="Invalid input";break;case ln.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${ea.joinValues(e.options)}`;break;case ln.invalid_enum_value:r=`Invalid enum value. Expected ${ea.joinValues(e.options)}, received '${e.received}'`;break;case ln.invalid_arguments:r="Invalid function arguments";break;case ln.invalid_return_type:r="Invalid function return type";break;case ln.invalid_date:r="Invalid date";break;case ln.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:ea.assertNever(e.validation):e.validation!=="regex"?r=`Invalid ${e.validation}`:r="Invalid";break;case ln.too_small:e.type==="array"?r=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?r=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?r=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="bigint"?r=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?r=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:r="Invalid input";break;case ln.too_big:e.type==="array"?r=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?r=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?r=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?r=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?r=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:r="Invalid input";break;case ln.custom:r="Invalid input";break;case ln.invalid_intersection_types:r="Intersection results could not be merged";break;case ln.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case ln.not_finite:r="Number must be finite";break;default:r=t.defaultError,ea.assertNever(e)}return{message:r}};let lle=MP;function cle(){return lle}const ule=e=>{const{data:t,path:r,errorMaps:s,issueData:u}=e,f=[...r,...u.path||[]],m={...u,path:f};if(u.message!==void 0)return{...u,path:f,message:u.message};let i="";const S=s.filter(E=>!!E).slice().reverse();for(const E of S)i=E(m,{data:t,defaultError:i}).message;return{...u,path:f,message:i}};function Bn(e,t){const r=cle(),s=ule({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===MP?void 0:MP].filter(u=>!!u)});e.common.issues.push(s)}class Jc{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,r){const s=[];for(const u of r){if(u.status==="aborted")return Ji;u.status==="dirty"&&t.dirty(),s.push(u.value)}return{status:t.value,value:s}}static async mergeObjectAsync(t,r){const s=[];for(const u of r){const f=await u.key,m=await u.value;s.push({key:f,value:m})}return Jc.mergeObjectSync(t,s)}static mergeObjectSync(t,r){const s={};for(const u of r){const{key:f,value:m}=u;if(f.status==="aborted"||m.status==="aborted")return Ji;f.status==="dirty"&&t.dirty(),m.status==="dirty"&&t.dirty(),f.value!=="__proto__"&&(typeof m.value<"u"||u.alwaysSet)&&(s[f.value]=m.value)}return{status:t.value,value:s}}}const Ji=Object.freeze({status:"aborted"}),xw=e=>({status:"dirty",value:e}),Ru=e=>({status:"valid",value:e}),iB=e=>e.status==="aborted",sB=e=>e.status==="dirty",Av=e=>e.status==="valid",JE=e=>typeof Promise<"u"&&e instanceof Promise;var ri;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(ri||(ri={}));class fm{constructor(t,r,s,u){this._cachedPath=[],this.parent=t,this.data=r,this._path=s,this._key=u}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const aB=(e,t)=>{if(Av(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const r=new Au(e.common.issues);return this._error=r,this._error}}};function ws(e){if(!e)return{};const{errorMap:t,invalid_type_error:r,required_error:s,description:u}=e;if(t&&(r||s))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:u}:{errorMap:(m,i)=>{const{message:S}=e;return m.code==="invalid_enum_value"?{message:S??i.defaultError}:typeof i.data>"u"?{message:S??s??i.defaultError}:m.code!=="invalid_type"?{message:i.defaultError}:{message:S??r??i.defaultError}},description:u}}class Ks{get description(){return this._def.description}_getType(t){return Ip(t.data)}_getOrReturnCtx(t,r){return r||{common:t.parent.common,data:t.data,parsedType:Ip(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new Jc,ctx:{common:t.parent.common,data:t.data,parsedType:Ip(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const r=this._parse(t);if(JE(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(t){const r=this._parse(t);return Promise.resolve(r)}parse(t,r){const s=this.safeParse(t,r);if(s.success)return s.data;throw s.error}safeParse(t,r){const s={common:{issues:[],async:(r==null?void 0:r.async)??!1,contextualErrorMap:r==null?void 0:r.errorMap},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Ip(t)},u=this._parseSync({data:t,path:s.path,parent:s});return aB(s,u)}"~validate"(t){var s,u;const r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Ip(t)};if(!this["~standard"].async)try{const f=this._parseSync({data:t,path:[],parent:r});return Av(f)?{value:f.value}:{issues:r.common.issues}}catch(f){(u=(s=f==null?void 0:f.message)==null?void 0:s.toLowerCase())!=null&&u.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:r}).then(f=>Av(f)?{value:f.value}:{issues:r.common.issues})}async parseAsync(t,r){const s=await this.safeParseAsync(t,r);if(s.success)return s.data;throw s.error}async safeParseAsync(t,r){const s={common:{issues:[],contextualErrorMap:r==null?void 0:r.errorMap,async:!0},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Ip(t)},u=this._parse({data:t,path:s.path,parent:s}),f=await(JE(u)?u:Promise.resolve(u));return aB(s,f)}refine(t,r){const s=u=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(u):r;return this._refinement((u,f)=>{const m=t(u),i=()=>f.addIssue({code:ln.custom,...s(u)});return typeof Promise<"u"&&m instanceof Promise?m.then(S=>S?!0:(i(),!1)):m?!0:(i(),!1)})}refinement(t,r){return this._refinement((s,u)=>t(s)?!0:(u.addIssue(typeof r=="function"?r(s,u):r),!1))}_refinement(t){return new Nv({schema:this,typeName:Qi.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return im.create(this,this._def)}nullable(){return kv.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return fh.create(this)}promise(){return rC.create(this,this._def)}or(t){return eC.create([this,t],this._def)}and(t){return tC.create(this,t,this._def)}transform(t){return new Nv({...ws(this._def),schema:this,typeName:Qi.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const r=typeof t=="function"?t:()=>t;return new FP({...ws(this._def),innerType:this,defaultValue:r,typeName:Qi.ZodDefault})}brand(){return new Dle({typeName:Qi.ZodBranded,type:this,...ws(this._def)})}catch(t){const r=typeof t=="function"?t:()=>t;return new LP({...ws(this._def),innerType:this,catchValue:r,typeName:Qi.ZodCatch})}describe(t){const r=this.constructor;return new r({...this._def,description:t})}pipe(t){return OR.create(this,t)}readonly(){return zP.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const dle=/^c[^\s-]{8,}$/i,hle=/^[0-9a-z]+$/,fle=/^[0-9A-HJKMNP-TV-Z]{26}$/i,ple=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,mle=/^[a-z0-9_-]{21}$/i,gle=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,_le=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,xle=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,vle="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let TN;const yle=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,wle=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ble=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Sle=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Tle=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Ele=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,T9="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Cle=new RegExp(`^${T9}$`);function E9(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`);const r=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${r}`}function Ale(e){return new RegExp(`^${E9(e)}$`)}function jle(e){let t=`${T9}T${E9(e)}`;const r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,new RegExp(`^${t}$`)}function Ile(e,t){return!!((t==="v4"||!t)&&yle.test(e)||(t==="v6"||!t)&&ble.test(e))}function Nle(e,t){if(!gle.test(e))return!1;try{const[r]=e.split(".");if(!r)return!1;const s=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),u=JSON.parse(atob(s));return!(typeof u!="object"||u===null||"typ"in u&&(u==null?void 0:u.typ)!=="JWT"||!u.alg||t&&u.alg!==t)}catch{return!1}}function kle(e,t){return!!((t==="v4"||!t)&&wle.test(e)||(t==="v6"||!t)&&Sle.test(e))}class tf extends Ks{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==Qn.string){const f=this._getOrReturnCtx(t);return Bn(f,{code:ln.invalid_type,expected:Qn.string,received:f.parsedType}),Ji}const s=new Jc;let u;for(const f of this._def.checks)if(f.kind==="min")t.data.length<f.value&&(u=this._getOrReturnCtx(t,u),Bn(u,{code:ln.too_small,minimum:f.value,type:"string",inclusive:!0,exact:!1,message:f.message}),s.dirty());else if(f.kind==="max")t.data.length>f.value&&(u=this._getOrReturnCtx(t,u),Bn(u,{code:ln.too_big,maximum:f.value,type:"string",inclusive:!0,exact:!1,message:f.message}),s.dirty());else if(f.kind==="length"){const m=t.data.length>f.value,i=t.data.length<f.value;(m||i)&&(u=this._getOrReturnCtx(t,u),m?Bn(u,{code:ln.too_big,maximum:f.value,type:"string",inclusive:!0,exact:!0,message:f.message}):i&&Bn(u,{code:ln.too_small,minimum:f.value,type:"string",inclusive:!0,exact:!0,message:f.message}),s.dirty())}else if(f.kind==="email")xle.test(t.data)||(u=this._getOrReturnCtx(t,u),Bn(u,{validation:"email",code:ln.invalid_string,message:f.message}),s.dirty());else if(f.kind==="emoji")TN||(TN=new RegExp(vle,"u")),TN.test(t.data)||(u=this._getOrReturnCtx(t,u),Bn(u,{validation:"emoji",code:ln.invalid_string,message:f.message}),s.dirty());else if(f.kind==="uuid")ple.test(t.data)||(u=this._getOrReturnCtx(t,u),Bn(u,{validation:"uuid",code:ln.invalid_string,message:f.message}),s.dirty());else if(f.kind==="nanoid")mle.test(t.data)||(u=this._getOrReturnCtx(t,u),Bn(u,{validation:"nanoid",code:ln.invalid_string,message:f.message}),s.dirty());else if(f.kind==="cuid")dle.test(t.data)||(u=this._getOrReturnCtx(t,u),Bn(u,{validation:"cuid",code:ln.invalid_string,message:f.message}),s.dirty());else if(f.kind==="cuid2")hle.test(t.data)||(u=this._getOrReturnCtx(t,u),Bn(u,{validation:"cuid2",code:ln.invalid_string,message:f.message}),s.dirty());else if(f.kind==="ulid")fle.test(t.data)||(u=this._getOrReturnCtx(t,u),Bn(u,{validation:"ulid",code:ln.invalid_string,message:f.message}),s.dirty());else if(f.kind==="url")try{new URL(t.data)}catch{u=this._getOrReturnCtx(t,u),Bn(u,{validation:"url",code:ln.invalid_string,message:f.message}),s.dirty()}else f.kind==="regex"?(f.regex.lastIndex=0,f.regex.test(t.data)||(u=this._getOrReturnCtx(t,u),Bn(u,{validation:"regex",code:ln.invalid_string,message:f.message}),s.dirty())):f.kind==="trim"?t.data=t.data.trim():f.kind==="includes"?t.data.includes(f.value,f.position)||(u=this._getOrReturnCtx(t,u),Bn(u,{code:ln.invalid_string,validation:{includes:f.value,position:f.position},message:f.message}),s.dirty()):f.kind==="toLowerCase"?t.data=t.data.toLowerCase():f.kind==="toUpperCase"?t.data=t.data.toUpperCase():f.kind==="startsWith"?t.data.startsWith(f.value)||(u=this._getOrReturnCtx(t,u),Bn(u,{code:ln.invalid_string,validation:{startsWith:f.value},message:f.message}),s.dirty()):f.kind==="endsWith"?t.data.endsWith(f.value)||(u=this._getOrReturnCtx(t,u),Bn(u,{code:ln.invalid_string,validation:{endsWith:f.value},message:f.message}),s.dirty()):f.kind==="datetime"?jle(f).test(t.data)||(u=this._getOrReturnCtx(t,u),Bn(u,{code:ln.invalid_string,validation:"datetime",message:f.message}),s.dirty()):f.kind==="date"?Cle.test(t.data)||(u=this._getOrReturnCtx(t,u),Bn(u,{code:ln.invalid_string,validation:"date",message:f.message}),s.dirty()):f.kind==="time"?Ale(f).test(t.data)||(u=this._getOrReturnCtx(t,u),Bn(u,{code:ln.invalid_string,validation:"time",message:f.message}),s.dirty()):f.kind==="duration"?_le.test(t.data)||(u=this._getOrReturnCtx(t,u),Bn(u,{validation:"duration",code:ln.invalid_string,message:f.message}),s.dirty()):f.kind==="ip"?Ile(t.data,f.version)||(u=this._getOrReturnCtx(t,u),Bn(u,{validation:"ip",code:ln.invalid_string,message:f.message}),s.dirty()):f.kind==="jwt"?Nle(t.data,f.alg)||(u=this._getOrReturnCtx(t,u),Bn(u,{validation:"jwt",code:ln.invalid_string,message:f.message}),s.dirty()):f.kind==="cidr"?kle(t.data,f.version)||(u=this._getOrReturnCtx(t,u),Bn(u,{validation:"cidr",code:ln.invalid_string,message:f.message}),s.dirty()):f.kind==="base64"?Tle.test(t.data)||(u=this._getOrReturnCtx(t,u),Bn(u,{validation:"base64",code:ln.invalid_string,message:f.message}),s.dirty()):f.kind==="base64url"?Ele.test(t.data)||(u=this._getOrReturnCtx(t,u),Bn(u,{validation:"base64url",code:ln.invalid_string,message:f.message}),s.dirty()):ea.assertNever(f);return{status:s.value,value:t.data}}_regex(t,r,s){return this.refinement(u=>t.test(u),{validation:r,code:ln.invalid_string,...ri.errToObj(s)})}_addCheck(t){return new tf({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...ri.errToObj(t)})}url(t){return this._addCheck({kind:"url",...ri.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...ri.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...ri.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...ri.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...ri.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...ri.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...ri.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...ri.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",...ri.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",...ri.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...ri.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",...ri.errToObj(t)})}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(t==null?void 0:t.offset)??!1,local:(t==null?void 0:t.local)??!1,...ri.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,...ri.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",...ri.errToObj(t)})}regex(t,r){return this._addCheck({kind:"regex",regex:t,...ri.errToObj(r)})}includes(t,r){return this._addCheck({kind:"includes",value:t,position:r==null?void 0:r.position,...ri.errToObj(r==null?void 0:r.message)})}startsWith(t,r){return this._addCheck({kind:"startsWith",value:t,...ri.errToObj(r)})}endsWith(t,r){return this._addCheck({kind:"endsWith",value:t,...ri.errToObj(r)})}min(t,r){return this._addCheck({kind:"min",value:t,...ri.errToObj(r)})}max(t,r){return this._addCheck({kind:"max",value:t,...ri.errToObj(r)})}length(t,r){return this._addCheck({kind:"length",value:t,...ri.errToObj(r)})}nonempty(t){return this.min(1,ri.errToObj(t))}trim(){return new tf({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new tf({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new tf({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxLength(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}}tf.create=e=>new tf({checks:[],typeName:Qi.ZodString,coerce:(e==null?void 0:e.coerce)??!1,...ws(e)});function Ple(e,t){const r=(e.toString().split(".")[1]||"").length,s=(t.toString().split(".")[1]||"").length,u=r>s?r:s,f=Number.parseInt(e.toFixed(u).replace(".","")),m=Number.parseInt(t.toFixed(u).replace(".",""));return f%m/10**u}class __ extends Ks{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==Qn.number){const f=this._getOrReturnCtx(t);return Bn(f,{code:ln.invalid_type,expected:Qn.number,received:f.parsedType}),Ji}let s;const u=new Jc;for(const f of this._def.checks)f.kind==="int"?ea.isInteger(t.data)||(s=this._getOrReturnCtx(t,s),Bn(s,{code:ln.invalid_type,expected:"integer",received:"float",message:f.message}),u.dirty()):f.kind==="min"?(f.inclusive?t.data<f.value:t.data<=f.value)&&(s=this._getOrReturnCtx(t,s),Bn(s,{code:ln.too_small,minimum:f.value,type:"number",inclusive:f.inclusive,exact:!1,message:f.message}),u.dirty()):f.kind==="max"?(f.inclusive?t.data>f.value:t.data>=f.value)&&(s=this._getOrReturnCtx(t,s),Bn(s,{code:ln.too_big,maximum:f.value,type:"number",inclusive:f.inclusive,exact:!1,message:f.message}),u.dirty()):f.kind==="multipleOf"?Ple(t.data,f.value)!==0&&(s=this._getOrReturnCtx(t,s),Bn(s,{code:ln.not_multiple_of,multipleOf:f.value,message:f.message}),u.dirty()):f.kind==="finite"?Number.isFinite(t.data)||(s=this._getOrReturnCtx(t,s),Bn(s,{code:ln.not_finite,message:f.message}),u.dirty()):ea.assertNever(f);return{status:u.value,value:t.data}}gte(t,r){return this.setLimit("min",t,!0,ri.toString(r))}gt(t,r){return this.setLimit("min",t,!1,ri.toString(r))}lte(t,r){return this.setLimit("max",t,!0,ri.toString(r))}lt(t,r){return this.setLimit("max",t,!1,ri.toString(r))}setLimit(t,r,s,u){return new __({...this._def,checks:[...this._def.checks,{kind:t,value:r,inclusive:s,message:ri.toString(u)}]})}_addCheck(t){return new __({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:ri.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:ri.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:ri.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:ri.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:ri.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:ri.toString(r)})}finite(t){return this._addCheck({kind:"finite",message:ri.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:ri.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:ri.toString(t)})}get minValue(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&ea.isInteger(t.value))}get isFinite(){let t=null,r=null;for(const s of this._def.checks){if(s.kind==="finite"||s.kind==="int"||s.kind==="multipleOf")return!0;s.kind==="min"?(r===null||s.value>r)&&(r=s.value):s.kind==="max"&&(t===null||s.value<t)&&(t=s.value)}return Number.isFinite(r)&&Number.isFinite(t)}}__.create=e=>new __({checks:[],typeName:Qi.ZodNumber,coerce:(e==null?void 0:e.coerce)||!1,...ws(e)});class x_ extends Ks{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==Qn.bigint)return this._getInvalidInput(t);let s;const u=new Jc;for(const f of this._def.checks)f.kind==="min"?(f.inclusive?t.data<f.value:t.data<=f.value)&&(s=this._getOrReturnCtx(t,s),Bn(s,{code:ln.too_small,type:"bigint",minimum:f.value,inclusive:f.inclusive,message:f.message}),u.dirty()):f.kind==="max"?(f.inclusive?t.data>f.value:t.data>=f.value)&&(s=this._getOrReturnCtx(t,s),Bn(s,{code:ln.too_big,type:"bigint",maximum:f.value,inclusive:f.inclusive,message:f.message}),u.dirty()):f.kind==="multipleOf"?t.data%f.value!==BigInt(0)&&(s=this._getOrReturnCtx(t,s),Bn(s,{code:ln.not_multiple_of,multipleOf:f.value,message:f.message}),u.dirty()):ea.assertNever(f);return{status:u.value,value:t.data}}_getInvalidInput(t){const r=this._getOrReturnCtx(t);return Bn(r,{code:ln.invalid_type,expected:Qn.bigint,received:r.parsedType}),Ji}gte(t,r){return this.setLimit("min",t,!0,ri.toString(r))}gt(t,r){return this.setLimit("min",t,!1,ri.toString(r))}lte(t,r){return this.setLimit("max",t,!0,ri.toString(r))}lt(t,r){return this.setLimit("max",t,!1,ri.toString(r))}setLimit(t,r,s,u){return new x_({...this._def,checks:[...this._def.checks,{kind:t,value:r,inclusive:s,message:ri.toString(u)}]})}_addCheck(t){return new x_({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:ri.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:ri.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:ri.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:ri.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:ri.toString(r)})}get minValue(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}}x_.create=e=>new x_({checks:[],typeName:Qi.ZodBigInt,coerce:(e==null?void 0:e.coerce)??!1,...ws(e)});class QE extends Ks{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==Qn.boolean){const s=this._getOrReturnCtx(t);return Bn(s,{code:ln.invalid_type,expected:Qn.boolean,received:s.parsedType}),Ji}return Ru(t.data)}}QE.create=e=>new QE({typeName:Qi.ZodBoolean,coerce:(e==null?void 0:e.coerce)||!1,...ws(e)});class jv extends Ks{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==Qn.date){const f=this._getOrReturnCtx(t);return Bn(f,{code:ln.invalid_type,expected:Qn.date,received:f.parsedType}),Ji}if(Number.isNaN(t.data.getTime())){const f=this._getOrReturnCtx(t);return Bn(f,{code:ln.invalid_date}),Ji}const s=new Jc;let u;for(const f of this._def.checks)f.kind==="min"?t.data.getTime()<f.value&&(u=this._getOrReturnCtx(t,u),Bn(u,{code:ln.too_small,message:f.message,inclusive:!0,exact:!1,minimum:f.value,type:"date"}),s.dirty()):f.kind==="max"?t.data.getTime()>f.value&&(u=this._getOrReturnCtx(t,u),Bn(u,{code:ln.too_big,message:f.message,inclusive:!0,exact:!1,maximum:f.value,type:"date"}),s.dirty()):ea.assertNever(f);return{status:s.value,value:new Date(t.data.getTime())}}_addCheck(t){return new jv({...this._def,checks:[...this._def.checks,t]})}min(t,r){return this._addCheck({kind:"min",value:t.getTime(),message:ri.toString(r)})}max(t,r){return this._addCheck({kind:"max",value:t.getTime(),message:ri.toString(r)})}get minDate(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t!=null?new Date(t):null}}jv.create=e=>new jv({checks:[],coerce:(e==null?void 0:e.coerce)||!1,typeName:Qi.ZodDate,...ws(e)});class oB extends Ks{_parse(t){if(this._getType(t)!==Qn.symbol){const s=this._getOrReturnCtx(t);return Bn(s,{code:ln.invalid_type,expected:Qn.symbol,received:s.parsedType}),Ji}return Ru(t.data)}}oB.create=e=>new oB({typeName:Qi.ZodSymbol,...ws(e)});class lB extends Ks{_parse(t){if(this._getType(t)!==Qn.undefined){const s=this._getOrReturnCtx(t);return Bn(s,{code:ln.invalid_type,expected:Qn.undefined,received:s.parsedType}),Ji}return Ru(t.data)}}lB.create=e=>new lB({typeName:Qi.ZodUndefined,...ws(e)});class cB extends Ks{_parse(t){if(this._getType(t)!==Qn.null){const s=this._getOrReturnCtx(t);return Bn(s,{code:ln.invalid_type,expected:Qn.null,received:s.parsedType}),Ji}return Ru(t.data)}}cB.create=e=>new cB({typeName:Qi.ZodNull,...ws(e)});class uB extends Ks{constructor(){super(...arguments),this._any=!0}_parse(t){return Ru(t.data)}}uB.create=e=>new uB({typeName:Qi.ZodAny,...ws(e)});class dB extends Ks{constructor(){super(...arguments),this._unknown=!0}_parse(t){return Ru(t.data)}}dB.create=e=>new dB({typeName:Qi.ZodUnknown,...ws(e)});class pm extends Ks{_parse(t){const r=this._getOrReturnCtx(t);return Bn(r,{code:ln.invalid_type,expected:Qn.never,received:r.parsedType}),Ji}}pm.create=e=>new pm({typeName:Qi.ZodNever,...ws(e)});class hB extends Ks{_parse(t){if(this._getType(t)!==Qn.undefined){const s=this._getOrReturnCtx(t);return Bn(s,{code:ln.invalid_type,expected:Qn.void,received:s.parsedType}),Ji}return Ru(t.data)}}hB.create=e=>new hB({typeName:Qi.ZodVoid,...ws(e)});class fh extends Ks{_parse(t){const{ctx:r,status:s}=this._processInputParams(t),u=this._def;if(r.parsedType!==Qn.array)return Bn(r,{code:ln.invalid_type,expected:Qn.array,received:r.parsedType}),Ji;if(u.exactLength!==null){const m=r.data.length>u.exactLength.value,i=r.data.length<u.exactLength.value;(m||i)&&(Bn(r,{code:m?ln.too_big:ln.too_small,minimum:i?u.exactLength.value:void 0,maximum:m?u.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:u.exactLength.message}),s.dirty())}if(u.minLength!==null&&r.data.length<u.minLength.value&&(Bn(r,{code:ln.too_small,minimum:u.minLength.value,type:"array",inclusive:!0,exact:!1,message:u.minLength.message}),s.dirty()),u.maxLength!==null&&r.data.length>u.maxLength.value&&(Bn(r,{code:ln.too_big,maximum:u.maxLength.value,type:"array",inclusive:!0,exact:!1,message:u.maxLength.message}),s.dirty()),r.common.async)return Promise.all([...r.data].map((m,i)=>u.type._parseAsync(new fm(r,m,r.path,i)))).then(m=>Jc.mergeArray(s,m));const f=[...r.data].map((m,i)=>u.type._parseSync(new fm(r,m,r.path,i)));return Jc.mergeArray(s,f)}get element(){return this._def.type}min(t,r){return new fh({...this._def,minLength:{value:t,message:ri.toString(r)}})}max(t,r){return new fh({...this._def,maxLength:{value:t,message:ri.toString(r)}})}length(t,r){return new fh({...this._def,exactLength:{value:t,message:ri.toString(r)}})}nonempty(t){return this.min(1,t)}}fh.create=(e,t)=>new fh({type:e,minLength:null,maxLength:null,exactLength:null,typeName:Qi.ZodArray,...ws(t)});function Tx(e){if(e instanceof uo){const t={};for(const r in e.shape){const s=e.shape[r];t[r]=im.create(Tx(s))}return new uo({...e._def,shape:()=>t})}else return e instanceof fh?new fh({...e._def,type:Tx(e.element)}):e instanceof im?im.create(Tx(e.unwrap())):e instanceof kv?kv.create(Tx(e.unwrap())):e instanceof v_?v_.create(e.items.map(t=>Tx(t))):e}class uo extends Ks{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),r=ea.objectKeys(t);return this._cached={shape:t,keys:r},this._cached}_parse(t){if(this._getType(t)!==Qn.object){const E=this._getOrReturnCtx(t);return Bn(E,{code:ln.invalid_type,expected:Qn.object,received:E.parsedType}),Ji}const{status:s,ctx:u}=this._processInputParams(t),{shape:f,keys:m}=this._getCached(),i=[];if(!(this._def.catchall instanceof pm&&this._def.unknownKeys==="strip"))for(const E in u.data)m.includes(E)||i.push(E);const S=[];for(const E of m){const I=f[E],D=u.data[E];S.push({key:{status:"valid",value:E},value:I._parse(new fm(u,D,u.path,E)),alwaysSet:E in u.data})}if(this._def.catchall instanceof pm){const E=this._def.unknownKeys;if(E==="passthrough")for(const I of i)S.push({key:{status:"valid",value:I},value:{status:"valid",value:u.data[I]}});else if(E==="strict")i.length>0&&(Bn(u,{code:ln.unrecognized_keys,keys:i}),s.dirty());else if(E!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const E=this._def.catchall;for(const I of i){const D=u.data[I];S.push({key:{status:"valid",value:I},value:E._parse(new fm(u,D,u.path,I)),alwaysSet:I in u.data})}}return u.common.async?Promise.resolve().then(async()=>{const E=[];for(const I of S){const D=await I.key,M=await I.value;E.push({key:D,value:M,alwaysSet:I.alwaysSet})}return E}).then(E=>Jc.mergeObjectSync(s,E)):Jc.mergeObjectSync(s,S)}get shape(){return this._def.shape()}strict(t){return ri.errToObj,new uo({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(r,s)=>{var f,m;const u=((m=(f=this._def).errorMap)==null?void 0:m.call(f,r,s).message)??s.defaultError;return r.code==="unrecognized_keys"?{message:ri.errToObj(t).message??u}:{message:u}}}:{}})}strip(){return new uo({...this._def,unknownKeys:"strip"})}passthrough(){return new uo({...this._def,unknownKeys:"passthrough"})}extend(t){return new uo({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new uo({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:Qi.ZodObject})}setKey(t,r){return this.augment({[t]:r})}catchall(t){return new uo({...this._def,catchall:t})}pick(t){const r={};for(const s of ea.objectKeys(t))t[s]&&this.shape[s]&&(r[s]=this.shape[s]);return new uo({...this._def,shape:()=>r})}omit(t){const r={};for(const s of ea.objectKeys(this.shape))t[s]||(r[s]=this.shape[s]);return new uo({...this._def,shape:()=>r})}deepPartial(){return Tx(this)}partial(t){const r={};for(const s of ea.objectKeys(this.shape)){const u=this.shape[s];t&&!t[s]?r[s]=u:r[s]=u.optional()}return new uo({...this._def,shape:()=>r})}required(t){const r={};for(const s of ea.objectKeys(this.shape))if(t&&!t[s])r[s]=this.shape[s];else{let f=this.shape[s];for(;f instanceof im;)f=f._def.innerType;r[s]=f}return new uo({...this._def,shape:()=>r})}keyof(){return C9(ea.objectKeys(this.shape))}}uo.create=(e,t)=>new uo({shape:()=>e,unknownKeys:"strip",catchall:pm.create(),typeName:Qi.ZodObject,...ws(t)});uo.strictCreate=(e,t)=>new uo({shape:()=>e,unknownKeys:"strict",catchall:pm.create(),typeName:Qi.ZodObject,...ws(t)});uo.lazycreate=(e,t)=>new uo({shape:e,unknownKeys:"strip",catchall:pm.create(),typeName:Qi.ZodObject,...ws(t)});class eC extends Ks{_parse(t){const{ctx:r}=this._processInputParams(t),s=this._def.options;function u(f){for(const i of f)if(i.result.status==="valid")return i.result;for(const i of f)if(i.result.status==="dirty")return r.common.issues.push(...i.ctx.common.issues),i.result;const m=f.map(i=>new Au(i.ctx.common.issues));return Bn(r,{code:ln.invalid_union,unionErrors:m}),Ji}if(r.common.async)return Promise.all(s.map(async f=>{const m={...r,common:{...r.common,issues:[]},parent:null};return{result:await f._parseAsync({data:r.data,path:r.path,parent:m}),ctx:m}})).then(u);{let f;const m=[];for(const S of s){const E={...r,common:{...r.common,issues:[]},parent:null},I=S._parseSync({data:r.data,path:r.path,parent:E});if(I.status==="valid")return I;I.status==="dirty"&&!f&&(f={result:I,ctx:E}),E.common.issues.length&&m.push(E.common.issues)}if(f)return r.common.issues.push(...f.ctx.common.issues),f.result;const i=m.map(S=>new Au(S));return Bn(r,{code:ln.invalid_union,unionErrors:i}),Ji}}get options(){return this._def.options}}eC.create=(e,t)=>new eC({options:e,typeName:Qi.ZodUnion,...ws(t)});function OP(e,t){const r=Ip(e),s=Ip(t);if(e===t)return{valid:!0,data:e};if(r===Qn.object&&s===Qn.object){const u=ea.objectKeys(t),f=ea.objectKeys(e).filter(i=>u.indexOf(i)!==-1),m={...e,...t};for(const i of f){const S=OP(e[i],t[i]);if(!S.valid)return{valid:!1};m[i]=S.data}return{valid:!0,data:m}}else if(r===Qn.array&&s===Qn.array){if(e.length!==t.length)return{valid:!1};const u=[];for(let f=0;f<e.length;f++){const m=e[f],i=t[f],S=OP(m,i);if(!S.valid)return{valid:!1};u.push(S.data)}return{valid:!0,data:u}}else return r===Qn.date&&s===Qn.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class tC extends Ks{_parse(t){const{status:r,ctx:s}=this._processInputParams(t),u=(f,m)=>{if(iB(f)||iB(m))return Ji;const i=OP(f.value,m.value);return i.valid?((sB(f)||sB(m))&&r.dirty(),{status:r.value,value:i.data}):(Bn(s,{code:ln.invalid_intersection_types}),Ji)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([f,m])=>u(f,m)):u(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}}tC.create=(e,t,r)=>new tC({left:e,right:t,typeName:Qi.ZodIntersection,...ws(r)});class v_ extends Ks{_parse(t){const{status:r,ctx:s}=this._processInputParams(t);if(s.parsedType!==Qn.array)return Bn(s,{code:ln.invalid_type,expected:Qn.array,received:s.parsedType}),Ji;if(s.data.length<this._def.items.length)return Bn(s,{code:ln.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Ji;!this._def.rest&&s.data.length>this._def.items.length&&(Bn(s,{code:ln.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());const f=[...s.data].map((m,i)=>{const S=this._def.items[i]||this._def.rest;return S?S._parse(new fm(s,m,s.path,i)):null}).filter(m=>!!m);return s.common.async?Promise.all(f).then(m=>Jc.mergeArray(r,m)):Jc.mergeArray(r,f)}get items(){return this._def.items}rest(t){return new v_({...this._def,rest:t})}}v_.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new v_({items:e,typeName:Qi.ZodTuple,rest:null,...ws(t)})};class fB extends Ks{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:r,ctx:s}=this._processInputParams(t);if(s.parsedType!==Qn.map)return Bn(s,{code:ln.invalid_type,expected:Qn.map,received:s.parsedType}),Ji;const u=this._def.keyType,f=this._def.valueType,m=[...s.data.entries()].map(([i,S],E)=>({key:u._parse(new fm(s,i,s.path,[E,"key"])),value:f._parse(new fm(s,S,s.path,[E,"value"]))}));if(s.common.async){const i=new Map;return Promise.resolve().then(async()=>{for(const S of m){const E=await S.key,I=await S.value;if(E.status==="aborted"||I.status==="aborted")return Ji;(E.status==="dirty"||I.status==="dirty")&&r.dirty(),i.set(E.value,I.value)}return{status:r.value,value:i}})}else{const i=new Map;for(const S of m){const E=S.key,I=S.value;if(E.status==="aborted"||I.status==="aborted")return Ji;(E.status==="dirty"||I.status==="dirty")&&r.dirty(),i.set(E.value,I.value)}return{status:r.value,value:i}}}}fB.create=(e,t,r)=>new fB({valueType:t,keyType:e,typeName:Qi.ZodMap,...ws(r)});class vb extends Ks{_parse(t){const{status:r,ctx:s}=this._processInputParams(t);if(s.parsedType!==Qn.set)return Bn(s,{code:ln.invalid_type,expected:Qn.set,received:s.parsedType}),Ji;const u=this._def;u.minSize!==null&&s.data.size<u.minSize.value&&(Bn(s,{code:ln.too_small,minimum:u.minSize.value,type:"set",inclusive:!0,exact:!1,message:u.minSize.message}),r.dirty()),u.maxSize!==null&&s.data.size>u.maxSize.value&&(Bn(s,{code:ln.too_big,maximum:u.maxSize.value,type:"set",inclusive:!0,exact:!1,message:u.maxSize.message}),r.dirty());const f=this._def.valueType;function m(S){const E=new Set;for(const I of S){if(I.status==="aborted")return Ji;I.status==="dirty"&&r.dirty(),E.add(I.value)}return{status:r.value,value:E}}const i=[...s.data.values()].map((S,E)=>f._parse(new fm(s,S,s.path,E)));return s.common.async?Promise.all(i).then(S=>m(S)):m(i)}min(t,r){return new vb({...this._def,minSize:{value:t,message:ri.toString(r)}})}max(t,r){return new vb({...this._def,maxSize:{value:t,message:ri.toString(r)}})}size(t,r){return this.min(t,r).max(t,r)}nonempty(t){return this.min(1,t)}}vb.create=(e,t)=>new vb({valueType:e,minSize:null,maxSize:null,typeName:Qi.ZodSet,...ws(t)});class pB extends Ks{get schema(){return this._def.getter()}_parse(t){const{ctx:r}=this._processInputParams(t);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}}pB.create=(e,t)=>new pB({getter:e,typeName:Qi.ZodLazy,...ws(t)});class mB extends Ks{_parse(t){if(t.data!==this._def.value){const r=this._getOrReturnCtx(t);return Bn(r,{received:r.data,code:ln.invalid_literal,expected:this._def.value}),Ji}return{status:"valid",value:t.data}}get value(){return this._def.value}}mB.create=(e,t)=>new mB({value:e,typeName:Qi.ZodLiteral,...ws(t)});function C9(e,t){return new Iv({values:e,typeName:Qi.ZodEnum,...ws(t)})}class Iv extends Ks{_parse(t){if(typeof t.data!="string"){const r=this._getOrReturnCtx(t),s=this._def.values;return Bn(r,{expected:ea.joinValues(s),received:r.parsedType,code:ln.invalid_type}),Ji}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){const r=this._getOrReturnCtx(t),s=this._def.values;return Bn(r,{received:r.data,code:ln.invalid_enum_value,options:s}),Ji}return Ru(t.data)}get options(){return this._def.values}get enum(){const t={};for(const r of this._def.values)t[r]=r;return t}get Values(){const t={};for(const r of this._def.values)t[r]=r;return t}get Enum(){const t={};for(const r of this._def.values)t[r]=r;return t}extract(t,r=this._def){return Iv.create(t,{...this._def,...r})}exclude(t,r=this._def){return Iv.create(this.options.filter(s=>!t.includes(s)),{...this._def,...r})}}Iv.create=C9;class gB extends Ks{_parse(t){const r=ea.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(t);if(s.parsedType!==Qn.string&&s.parsedType!==Qn.number){const u=ea.objectValues(r);return Bn(s,{expected:ea.joinValues(u),received:s.parsedType,code:ln.invalid_type}),Ji}if(this._cache||(this._cache=new Set(ea.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){const u=ea.objectValues(r);return Bn(s,{received:s.data,code:ln.invalid_enum_value,options:u}),Ji}return Ru(t.data)}get enum(){return this._def.values}}gB.create=(e,t)=>new gB({values:e,typeName:Qi.ZodNativeEnum,...ws(t)});class rC extends Ks{unwrap(){return this._def.type}_parse(t){const{ctx:r}=this._processInputParams(t);if(r.parsedType!==Qn.promise&&r.common.async===!1)return Bn(r,{code:ln.invalid_type,expected:Qn.promise,received:r.parsedType}),Ji;const s=r.parsedType===Qn.promise?r.data:Promise.resolve(r.data);return Ru(s.then(u=>this._def.type.parseAsync(u,{path:r.path,errorMap:r.common.contextualErrorMap})))}}rC.create=(e,t)=>new rC({type:e,typeName:Qi.ZodPromise,...ws(t)});class Nv extends Ks{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Qi.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:r,ctx:s}=this._processInputParams(t),u=this._def.effect||null,f={addIssue:m=>{Bn(s,m),m.fatal?r.abort():r.dirty()},get path(){return s.path}};if(f.addIssue=f.addIssue.bind(f),u.type==="preprocess"){const m=u.transform(s.data,f);if(s.common.async)return Promise.resolve(m).then(async i=>{if(r.value==="aborted")return Ji;const S=await this._def.schema._parseAsync({data:i,path:s.path,parent:s});return S.status==="aborted"?Ji:S.status==="dirty"||r.value==="dirty"?xw(S.value):S});{if(r.value==="aborted")return Ji;const i=this._def.schema._parseSync({data:m,path:s.path,parent:s});return i.status==="aborted"?Ji:i.status==="dirty"||r.value==="dirty"?xw(i.value):i}}if(u.type==="refinement"){const m=i=>{const S=u.refinement(i,f);if(s.common.async)return Promise.resolve(S);if(S instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return i};if(s.common.async===!1){const i=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return i.status==="aborted"?Ji:(i.status==="dirty"&&r.dirty(),m(i.value),{status:r.value,value:i.value})}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(i=>i.status==="aborted"?Ji:(i.status==="dirty"&&r.dirty(),m(i.value).then(()=>({status:r.value,value:i.value}))))}if(u.type==="transform")if(s.common.async===!1){const m=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!Av(m))return Ji;const i=u.transform(m.value,f);if(i instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:i}}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(m=>Av(m)?Promise.resolve(u.transform(m.value,f)).then(i=>({status:r.value,value:i})):Ji);ea.assertNever(u)}}Nv.create=(e,t,r)=>new Nv({schema:e,typeName:Qi.ZodEffects,effect:t,...ws(r)});Nv.createWithPreprocess=(e,t,r)=>new Nv({schema:t,effect:{type:"preprocess",transform:e},typeName:Qi.ZodEffects,...ws(r)});class im extends Ks{_parse(t){return this._getType(t)===Qn.undefined?Ru(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}im.create=(e,t)=>new im({innerType:e,typeName:Qi.ZodOptional,...ws(t)});class kv extends Ks{_parse(t){return this._getType(t)===Qn.null?Ru(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}kv.create=(e,t)=>new kv({innerType:e,typeName:Qi.ZodNullable,...ws(t)});class FP extends Ks{_parse(t){const{ctx:r}=this._processInputParams(t);let s=r.data;return r.parsedType===Qn.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:r.path,parent:r})}removeDefault(){return this._def.innerType}}FP.create=(e,t)=>new FP({innerType:e,typeName:Qi.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...ws(t)});class LP extends Ks{_parse(t){const{ctx:r}=this._processInputParams(t),s={...r,common:{...r.common,issues:[]}},u=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return JE(u)?u.then(f=>({status:"valid",value:f.status==="valid"?f.value:this._def.catchValue({get error(){return new Au(s.common.issues)},input:s.data})})):{status:"valid",value:u.status==="valid"?u.value:this._def.catchValue({get error(){return new Au(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}}LP.create=(e,t)=>new LP({innerType:e,typeName:Qi.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...ws(t)});class _B extends Ks{_parse(t){if(this._getType(t)!==Qn.nan){const s=this._getOrReturnCtx(t);return Bn(s,{code:ln.invalid_type,expected:Qn.nan,received:s.parsedType}),Ji}return{status:"valid",value:t.data}}}_B.create=e=>new _B({typeName:Qi.ZodNaN,...ws(e)});class Dle extends Ks{_parse(t){const{ctx:r}=this._processInputParams(t),s=r.data;return this._def.type._parse({data:s,path:r.path,parent:r})}unwrap(){return this._def.type}}class OR extends Ks{_parse(t){const{status:r,ctx:s}=this._processInputParams(t);if(s.common.async)return(async()=>{const f=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return f.status==="aborted"?Ji:f.status==="dirty"?(r.dirty(),xw(f.value)):this._def.out._parseAsync({data:f.value,path:s.path,parent:s})})();{const u=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return u.status==="aborted"?Ji:u.status==="dirty"?(r.dirty(),{status:"dirty",value:u.value}):this._def.out._parseSync({data:u.value,path:s.path,parent:s})}}static create(t,r){return new OR({in:t,out:r,typeName:Qi.ZodPipeline})}}class zP extends Ks{_parse(t){const r=this._def.innerType._parse(t),s=u=>(Av(u)&&(u.value=Object.freeze(u.value)),u);return JE(r)?r.then(u=>s(u)):s(r)}unwrap(){return this._def.innerType}}zP.create=(e,t)=>new zP({innerType:e,typeName:Qi.ZodReadonly,...ws(t)});uo.lazycreate;var Qi;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(Qi||(Qi={}));const ol=tf.create;__.create;x_.create;QE.create;jv.create;pm.create;fh.create;const Vb=uo.create;uo.strictCreate;eC.create;tC.create;v_.create;const IT=Iv.create;rC.create;im.create;kv.create;const Rle={string:e=>tf.create({...e,coerce:!0}),number:e=>__.create({...e,coerce:!0}),boolean:e=>QE.create({...e,coerce:!0}),bigint:e=>x_.create({...e,coerce:!0}),date:e=>jv.create({...e,coerce:!0})},xr=V.forwardRef(({className:e,type:t,...r},s)=>c.jsx("input",{type:t,className:sn("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:s,...r}));xr.displayName="Input";var Mle="Label",A9=V.forwardRef((e,t)=>c.jsx(es.label,{...e,ref:t,onMouseDown:r=>{var u;r.target.closest("button, input, select, textarea")||((u=e.onMouseDown)==null||u.call(e,r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));A9.displayName=Mle;var j9=A9;const Ole=Fv("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Dt=V.forwardRef(({className:e,...t},r)=>c.jsx(j9,{ref:r,className:sn(Ole(),e),...t}));Dt.displayName=j9.displayName;const $r=V.forwardRef(({className:e,...t},r)=>c.jsx("div",{ref:r,className:sn("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));$r.displayName="Card";const Xn=V.forwardRef(({className:e,...t},r)=>c.jsx("div",{ref:r,className:sn("flex flex-col space-y-1.5 p-6",e),...t}));Xn.displayName="CardHeader";const ti=V.forwardRef(({className:e,...t},r)=>c.jsx("h3",{ref:r,className:sn("text-2xl font-semibold leading-none tracking-tight",e),...t}));ti.displayName="CardTitle";const Gs=V.forwardRef(({className:e,...t},r)=>c.jsx("p",{ref:r,className:sn("text-sm text-muted-foreground",e),...t}));Gs.displayName="CardDescription";const _n=V.forwardRef(({className:e,...t},r)=>c.jsx("div",{ref:r,className:sn("p-6 pt-0",e),...t}));_n.displayName="CardContent";const Fle=V.forwardRef(({className:e,...t},r)=>c.jsx("div",{ref:r,className:sn("flex items-center p-6 pt-0",e),...t}));Fle.displayName="CardFooter";const Lle=async({to:e,subject:t,html:r,from:s})=>{try{const{data:u,error:f}=await tt.functions.invoke("send-email",{body:{to:e,subject:t,html:r,from:s}});if(f)throw f;return{success:!0,data:u}}catch(u){return console.error("Error sending email:",u),{success:!1,error:u}}},zle=async(e,t)=>{const r=`
    <!DOCTYPE html>
    <html>
      <head>
        <style>
          body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
          .container { max-width: 600px; margin: 0 auto; padding: 20px; }
          .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0; }
          .content { background: #f9fafb; padding: 30px; border-radius: 0 0 10px 10px; }
          .button { display: inline-block; background: #667eea; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px; margin: 20px 0; }
          .footer { text-align: center; margin-top: 20px; color: #6b7280; font-size: 14px; }
        </style>
      </head>
      <body>
        <div class="container">
          <div class="header">
            <h1>Bem-vindo ao Facilities Hub! </h1>
          </div>
          <div class="content">
            <h2>Ol, ${t}!</h2>
            <p>Estamos muito felizes em ter voc conosco no <strong>Facilities Hub</strong>, sua plataforma completa de gesto de facilities.</p>
            
            <p>Com o Facilities Hub voc poder:</p>
            <ul>
              <li>Gerenciar ordens de servio e manutenes</li>
              <li>Controlar ativos e equipamentos</li>
              <li>Acompanhar indicadores e relatrios</li>
              <li>Otimizar processos de facilities</li>
            </ul>
            
            <p>Sua conta foi criada com sucesso e voc j pode comear a explorar a plataforma.</p>
            
            <a href="${window.location.origin}/dashboard" class="button">Acessar Dashboard</a>
            
            <p>Se voc tiver alguma dvida ou precisar de ajuda, nossa equipe est sempre disponvel.</p>
            
            <p>Atenciosamente,<br><strong>Equipe Facilities Hub</strong></p>
          </div>
          <div class="footer">
            <p>Este  um email automtico, por favor no responda.</p>
          </div>
        </div>
      </body>
    </html>
  `;return Lle({to:e,subject:"Bem-vindo ao Facilities Hub!",html:r})};var EN="focusScope.autoFocusOnMount",CN="focusScope.autoFocusOnUnmount",xB={bubbles:!1,cancelable:!0},Ble="FocusScope",FR=V.forwardRef((e,t)=>{const{loop:r=!1,trapped:s=!1,onMountAutoFocus:u,onUnmountAutoFocus:f,...m}=e,[i,S]=V.useState(null),E=Cu(u),I=Cu(f),D=V.useRef(null),M=da(t,F=>S(F)),R=V.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;V.useEffect(()=>{if(s){let F=function(J){if(R.paused||!i)return;const ne=J.target;i.contains(ne)?D.current=ne:Cp(D.current,{select:!0})},U=function(J){if(R.paused||!i)return;const ne=J.relatedTarget;ne!==null&&(i.contains(ne)||Cp(D.current,{select:!0}))},Y=function(J){if(document.activeElement===document.body)for(const me of J)me.removedNodes.length>0&&Cp(i)};document.addEventListener("focusin",F),document.addEventListener("focusout",U);const z=new MutationObserver(Y);return i&&z.observe(i,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",F),document.removeEventListener("focusout",U),z.disconnect()}}},[s,i,R.paused]),V.useEffect(()=>{if(i){yB.add(R);const F=document.activeElement;if(!i.contains(F)){const Y=new CustomEvent(EN,xB);i.addEventListener(EN,E),i.dispatchEvent(Y),Y.defaultPrevented||(Ule(Wle(I9(i)),{select:!0}),document.activeElement===F&&Cp(i))}return()=>{i.removeEventListener(EN,E),setTimeout(()=>{const Y=new CustomEvent(CN,xB);i.addEventListener(CN,I),i.dispatchEvent(Y),Y.defaultPrevented||Cp(F??document.body,{select:!0}),i.removeEventListener(CN,I),yB.remove(R)},0)}}},[i,E,I,R]);const H=V.useCallback(F=>{if(!r&&!s||R.paused)return;const U=F.key==="Tab"&&!F.altKey&&!F.ctrlKey&&!F.metaKey,Y=document.activeElement;if(U&&Y){const z=F.currentTarget,[J,ne]=Vle(z);J&&ne?!F.shiftKey&&Y===ne?(F.preventDefault(),r&&Cp(J,{select:!0})):F.shiftKey&&Y===J&&(F.preventDefault(),r&&Cp(ne,{select:!0})):Y===z&&F.preventDefault()}},[r,s,R.paused]);return c.jsx(es.div,{tabIndex:-1,...m,ref:M,onKeyDown:H})});FR.displayName=Ble;function Ule(e,{select:t=!1}={}){const r=document.activeElement;for(const s of e)if(Cp(s,{select:t}),document.activeElement!==r)return}function Vle(e){const t=I9(e),r=vB(t,e),s=vB(t.reverse(),e);return[r,s]}function I9(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const u=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||u?NodeFilter.FILTER_SKIP:s.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function vB(e,t){for(const r of e)if(!$le(r,{upTo:t}))return r}function $le(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function qle(e){return e instanceof HTMLInputElement&&"select"in e}function Cp(e,{select:t=!1}={}){if(e&&e.focus){const r=document.activeElement;e.focus({preventScroll:!0}),e!==r&&qle(e)&&t&&e.select()}}var yB=Gle();function Gle(){let e=[];return{add(t){const r=e[0];t!==r&&(r==null||r.pause()),e=wB(e,t),e.unshift(t)},remove(t){var r;e=wB(e,t),(r=e[0])==null||r.resume()}}}function wB(e,t){const r=[...e],s=r.indexOf(t);return s!==-1&&r.splice(s,1),r}function Wle(e){return e.filter(t=>t.tagName!=="A")}var AN=0;function N9(){V.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??bB()),document.body.insertAdjacentElement("beforeend",e[1]??bB()),AN++,()=>{AN===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),AN--}},[])}function bB(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var oE="right-scroll-bar-position",lE="width-before-scroll-bar",Hle="with-scroll-bars-hidden",Zle="--removed-body-scroll-bar-size";function jN(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function Xle(e,t){var r=V.useState(function(){return{value:e,callback:t,facade:{get current(){return r.value},set current(s){var u=r.value;u!==s&&(r.value=s,r.callback(s,u))}}}})[0];return r.callback=t,r.facade}var Yle=typeof window<"u"?V.useLayoutEffect:V.useEffect,SB=new WeakMap;function Kle(e,t){var r=Xle(null,function(s){return e.forEach(function(u){return jN(u,s)})});return Yle(function(){var s=SB.get(r);if(s){var u=new Set(s),f=new Set(e),m=r.current;u.forEach(function(i){f.has(i)||jN(i,null)}),f.forEach(function(i){u.has(i)||jN(i,m)})}SB.set(r,e)},[e]),r}function Jle(e){return e}function Qle(e,t){t===void 0&&(t=Jle);var r=[],s=!1,u={read:function(){if(s)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:e},useMedium:function(f){var m=t(f,s);return r.push(m),function(){r=r.filter(function(i){return i!==m})}},assignSyncMedium:function(f){for(s=!0;r.length;){var m=r;r=[],m.forEach(f)}r={push:function(i){return f(i)},filter:function(){return r}}},assignMedium:function(f){s=!0;var m=[];if(r.length){var i=r;r=[],i.forEach(f),m=r}var S=function(){var I=m;m=[],I.forEach(f)},E=function(){return Promise.resolve().then(S)};E(),r={push:function(I){m.push(I),E()},filter:function(I){return m=m.filter(I),r}}}};return u}function ece(e){e===void 0&&(e={});var t=Qle(null);return t.options=wu({async:!0,ssr:!1},e),t}var k9=function(e){var t=e.sideCar,r=Cm(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var s=t.read();if(!s)throw new Error("Sidecar medium not found");return V.createElement(s,wu({},r))};k9.isSideCarExport=!0;function tce(e,t){return e.useMedium(t),k9}var P9=ece(),IN=function(){},lA=V.forwardRef(function(e,t){var r=V.useRef(null),s=V.useState({onScrollCapture:IN,onWheelCapture:IN,onTouchMoveCapture:IN}),u=s[0],f=s[1],m=e.forwardProps,i=e.children,S=e.className,E=e.removeScrollBar,I=e.enabled,D=e.shards,M=e.sideCar,R=e.noRelative,H=e.noIsolation,F=e.inert,U=e.allowPinchZoom,Y=e.as,z=Y===void 0?"div":Y,J=e.gapMode,ne=Cm(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),me=M,le=Kle([r,t]),ye=wu(wu({},ne),u);return V.createElement(V.Fragment,null,I&&V.createElement(me,{sideCar:P9,removeScrollBar:E,shards:D,noRelative:R,noIsolation:H,inert:F,setCallbacks:f,allowPinchZoom:!!U,lockRef:r,gapMode:J}),m?V.cloneElement(V.Children.only(i),wu(wu({},ye),{ref:le})):V.createElement(z,wu({},ye,{className:S,ref:le}),i))});lA.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};lA.classNames={fullWidth:lE,zeroRight:oE};var rce=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function nce(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=rce();return t&&e.setAttribute("nonce",t),e}function ice(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function sce(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var ace=function(){var e=0,t=null;return{add:function(r){e==0&&(t=nce())&&(ice(t,r),sce(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},oce=function(){var e=ace();return function(t,r){V.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&r])}},D9=function(){var e=oce(),t=function(r){var s=r.styles,u=r.dynamic;return e(s,u),null};return t},lce={left:0,top:0,right:0,gap:0},NN=function(e){return parseInt(e||"",10)||0},cce=function(e){var t=window.getComputedStyle(document.body),r=t[e==="padding"?"paddingLeft":"marginLeft"],s=t[e==="padding"?"paddingTop":"marginTop"],u=t[e==="padding"?"paddingRight":"marginRight"];return[NN(r),NN(s),NN(u)]},uce=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return lce;var t=cce(e),r=document.documentElement.clientWidth,s=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,s-r+t[2]-t[0])}},dce=D9(),Xx="data-scroll-locked",hce=function(e,t,r,s){var u=e.left,f=e.top,m=e.right,i=e.gap;return r===void 0&&(r="margin"),`
  .`.concat(Hle,` {
   overflow: hidden `).concat(s,`;
   padding-right: `).concat(i,"px ").concat(s,`;
  }
  body[`).concat(Xx,`] {
    overflow: hidden `).concat(s,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(s,";"),r==="margin"&&`
    padding-left: `.concat(u,`px;
    padding-top: `).concat(f,`px;
    padding-right: `).concat(m,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(i,"px ").concat(s,`;
    `),r==="padding"&&"padding-right: ".concat(i,"px ").concat(s,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(oE,` {
    right: `).concat(i,"px ").concat(s,`;
  }
  
  .`).concat(lE,` {
    margin-right: `).concat(i,"px ").concat(s,`;
  }
  
  .`).concat(oE," .").concat(oE,` {
    right: 0 `).concat(s,`;
  }
  
  .`).concat(lE," .").concat(lE,` {
    margin-right: 0 `).concat(s,`;
  }
  
  body[`).concat(Xx,`] {
    `).concat(Zle,": ").concat(i,`px;
  }
`)},TB=function(){var e=parseInt(document.body.getAttribute(Xx)||"0",10);return isFinite(e)?e:0},fce=function(){V.useEffect(function(){return document.body.setAttribute(Xx,(TB()+1).toString()),function(){var e=TB()-1;e<=0?document.body.removeAttribute(Xx):document.body.setAttribute(Xx,e.toString())}},[])},pce=function(e){var t=e.noRelative,r=e.noImportant,s=e.gapMode,u=s===void 0?"margin":s;fce();var f=V.useMemo(function(){return uce(u)},[u]);return V.createElement(dce,{styles:hce(f,!t,u,r?"":"!important")})},BP=!1;if(typeof window<"u")try{var NT=Object.defineProperty({},"passive",{get:function(){return BP=!0,!0}});window.addEventListener("test",NT,NT),window.removeEventListener("test",NT,NT)}catch{BP=!1}var fx=BP?{passive:!1}:!1,mce=function(e){return e.tagName==="TEXTAREA"},R9=function(e,t){if(!(e instanceof Element))return!1;var r=window.getComputedStyle(e);return r[t]!=="hidden"&&!(r.overflowY===r.overflowX&&!mce(e)&&r[t]==="visible")},gce=function(e){return R9(e,"overflowY")},_ce=function(e){return R9(e,"overflowX")},EB=function(e,t){var r=t.ownerDocument,s=t;do{typeof ShadowRoot<"u"&&s instanceof ShadowRoot&&(s=s.host);var u=M9(e,s);if(u){var f=O9(e,s),m=f[1],i=f[2];if(m>i)return!0}s=s.parentNode}while(s&&s!==r.body);return!1},xce=function(e){var t=e.scrollTop,r=e.scrollHeight,s=e.clientHeight;return[t,r,s]},vce=function(e){var t=e.scrollLeft,r=e.scrollWidth,s=e.clientWidth;return[t,r,s]},M9=function(e,t){return e==="v"?gce(t):_ce(t)},O9=function(e,t){return e==="v"?xce(t):vce(t)},yce=function(e,t){return e==="h"&&t==="rtl"?-1:1},wce=function(e,t,r,s,u){var f=yce(e,window.getComputedStyle(t).direction),m=f*s,i=r.target,S=t.contains(i),E=!1,I=m>0,D=0,M=0;do{if(!i)break;var R=O9(e,i),H=R[0],F=R[1],U=R[2],Y=F-U-f*H;(H||Y)&&M9(e,i)&&(D+=Y,M+=H);var z=i.parentNode;i=z&&z.nodeType===Node.DOCUMENT_FRAGMENT_NODE?z.host:z}while(!S&&i!==document.body||S&&(t.contains(i)||t===i));return(I&&(Math.abs(D)<1||!u)||!I&&(Math.abs(M)<1||!u))&&(E=!0),E},kT=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},CB=function(e){return[e.deltaX,e.deltaY]},AB=function(e){return e&&"current"in e?e.current:e},bce=function(e,t){return e[0]===t[0]&&e[1]===t[1]},Sce=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},Tce=0,px=[];function Ece(e){var t=V.useRef([]),r=V.useRef([0,0]),s=V.useRef(),u=V.useState(Tce++)[0],f=V.useState(D9)[0],m=V.useRef(e);V.useEffect(function(){m.current=e},[e]),V.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(u));var F=AR([e.lockRef.current],(e.shards||[]).map(AB),!0).filter(Boolean);return F.forEach(function(U){return U.classList.add("allow-interactivity-".concat(u))}),function(){document.body.classList.remove("block-interactivity-".concat(u)),F.forEach(function(U){return U.classList.remove("allow-interactivity-".concat(u))})}}},[e.inert,e.lockRef.current,e.shards]);var i=V.useCallback(function(F,U){if("touches"in F&&F.touches.length===2||F.type==="wheel"&&F.ctrlKey)return!m.current.allowPinchZoom;var Y=kT(F),z=r.current,J="deltaX"in F?F.deltaX:z[0]-Y[0],ne="deltaY"in F?F.deltaY:z[1]-Y[1],me,le=F.target,ye=Math.abs(J)>Math.abs(ne)?"h":"v";if("touches"in F&&ye==="h"&&le.type==="range")return!1;var pe=EB(ye,le);if(!pe)return!0;if(pe?me=ye:(me=ye==="v"?"h":"v",pe=EB(ye,le)),!pe)return!1;if(!s.current&&"changedTouches"in F&&(J||ne)&&(s.current=me),!me)return!0;var be=s.current||me;return wce(be,U,F,be==="h"?J:ne,!0)},[]),S=V.useCallback(function(F){var U=F;if(!(!px.length||px[px.length-1]!==f)){var Y="deltaY"in U?CB(U):kT(U),z=t.current.filter(function(me){return me.name===U.type&&(me.target===U.target||U.target===me.shadowParent)&&bce(me.delta,Y)})[0];if(z&&z.should){U.cancelable&&U.preventDefault();return}if(!z){var J=(m.current.shards||[]).map(AB).filter(Boolean).filter(function(me){return me.contains(U.target)}),ne=J.length>0?i(U,J[0]):!m.current.noIsolation;ne&&U.cancelable&&U.preventDefault()}}},[]),E=V.useCallback(function(F,U,Y,z){var J={name:F,delta:U,target:Y,should:z,shadowParent:Cce(Y)};t.current.push(J),setTimeout(function(){t.current=t.current.filter(function(ne){return ne!==J})},1)},[]),I=V.useCallback(function(F){r.current=kT(F),s.current=void 0},[]),D=V.useCallback(function(F){E(F.type,CB(F),F.target,i(F,e.lockRef.current))},[]),M=V.useCallback(function(F){E(F.type,kT(F),F.target,i(F,e.lockRef.current))},[]);V.useEffect(function(){return px.push(f),e.setCallbacks({onScrollCapture:D,onWheelCapture:D,onTouchMoveCapture:M}),document.addEventListener("wheel",S,fx),document.addEventListener("touchmove",S,fx),document.addEventListener("touchstart",I,fx),function(){px=px.filter(function(F){return F!==f}),document.removeEventListener("wheel",S,fx),document.removeEventListener("touchmove",S,fx),document.removeEventListener("touchstart",I,fx)}},[]);var R=e.removeScrollBar,H=e.inert;return V.createElement(V.Fragment,null,H?V.createElement(f,{styles:Sce(u)}):null,R?V.createElement(pce,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function Cce(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const Ace=tce(P9,Ece);var LR=V.forwardRef(function(e,t){return V.createElement(lA,wu({},e,{ref:t,sideCar:Ace}))});LR.classNames=lA.classNames;var jce=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},mx=new WeakMap,PT=new WeakMap,DT={},kN=0,F9=function(e){return e&&(e.host||F9(e.parentNode))},Ice=function(e,t){return t.map(function(r){if(e.contains(r))return r;var s=F9(r);return s&&e.contains(s)?s:(console.error("aria-hidden",r,"in not contained inside",e,". Doing nothing"),null)}).filter(function(r){return!!r})},Nce=function(e,t,r,s){var u=Ice(t,Array.isArray(e)?e:[e]);DT[r]||(DT[r]=new WeakMap);var f=DT[r],m=[],i=new Set,S=new Set(u),E=function(D){!D||i.has(D)||(i.add(D),E(D.parentNode))};u.forEach(E);var I=function(D){!D||S.has(D)||Array.prototype.forEach.call(D.children,function(M){if(i.has(M))I(M);else try{var R=M.getAttribute(s),H=R!==null&&R!=="false",F=(mx.get(M)||0)+1,U=(f.get(M)||0)+1;mx.set(M,F),f.set(M,U),m.push(M),F===1&&H&&PT.set(M,!0),U===1&&M.setAttribute(r,"true"),H||M.setAttribute(s,"true")}catch(Y){console.error("aria-hidden: cannot operate on ",M,Y)}})};return I(t),i.clear(),kN++,function(){m.forEach(function(D){var M=mx.get(D)-1,R=f.get(D)-1;mx.set(D,M),f.set(D,R),M||(PT.has(D)||D.removeAttribute(s),PT.delete(D)),R||D.removeAttribute(r)}),kN--,kN||(mx=new WeakMap,mx=new WeakMap,PT=new WeakMap,DT={})}},L9=function(e,t,r){r===void 0&&(r="data-aria-hidden");var s=Array.from(Array.isArray(e)?e:[e]),u=jce(e);return u?(s.push.apply(s,Array.from(u.querySelectorAll("[aria-live]"))),Nce(s,u,r,"aria-hidden")):function(){return null}},cA="Dialog",[z9,B9]=xh(cA),[kce,Nd]=z9(cA),U9=e=>{const{__scopeDialog:t,children:r,open:s,defaultOpen:u,onOpenChange:f,modal:m=!0}=e,i=V.useRef(null),S=V.useRef(null),[E,I]=lm({prop:s,defaultProp:u??!1,onChange:f,caller:cA});return c.jsx(kce,{scope:t,triggerRef:i,contentRef:S,contentId:lf(),titleId:lf(),descriptionId:lf(),open:E,onOpenChange:I,onOpenToggle:V.useCallback(()=>I(D=>!D),[I]),modal:m,children:r})};U9.displayName=cA;var V9="DialogTrigger",$9=V.forwardRef((e,t)=>{const{__scopeDialog:r,...s}=e,u=Nd(V9,r),f=da(t,u.triggerRef);return c.jsx(es.button,{type:"button","aria-haspopup":"dialog","aria-expanded":u.open,"aria-controls":u.contentId,"data-state":UR(u.open),...s,ref:f,onClick:xi(e.onClick,u.onOpenToggle)})});$9.displayName=V9;var zR="DialogPortal",[Pce,q9]=z9(zR,{forceMount:void 0}),G9=e=>{const{__scopeDialog:t,forceMount:r,children:s,container:u}=e,f=Nd(zR,t);return c.jsx(Pce,{scope:t,forceMount:r,children:V.Children.map(s,m=>c.jsx(bm,{present:r||f.open,children:c.jsx(qC,{asChild:!0,container:u,children:m})}))})};G9.displayName=zR;var nC="DialogOverlay",W9=V.forwardRef((e,t)=>{const r=q9(nC,e.__scopeDialog),{forceMount:s=r.forceMount,...u}=e,f=Nd(nC,e.__scopeDialog);return f.modal?c.jsx(bm,{present:s||f.open,children:c.jsx(Rce,{...u,ref:t})}):null});W9.displayName=nC;var Dce=bv("DialogOverlay.RemoveScroll"),Rce=V.forwardRef((e,t)=>{const{__scopeDialog:r,...s}=e,u=Nd(nC,r);return c.jsx(LR,{as:Dce,allowPinchZoom:!0,shards:[u.contentRef],children:c.jsx(es.div,{"data-state":UR(u.open),...s,ref:t,style:{pointerEvents:"auto",...s.style}})})}),y_="DialogContent",H9=V.forwardRef((e,t)=>{const r=q9(y_,e.__scopeDialog),{forceMount:s=r.forceMount,...u}=e,f=Nd(y_,e.__scopeDialog);return c.jsx(bm,{present:s||f.open,children:f.modal?c.jsx(Mce,{...u,ref:t}):c.jsx(Oce,{...u,ref:t})})});H9.displayName=y_;var Mce=V.forwardRef((e,t)=>{const r=Nd(y_,e.__scopeDialog),s=V.useRef(null),u=da(t,r.contentRef,s);return V.useEffect(()=>{const f=s.current;if(f)return L9(f)},[]),c.jsx(Z9,{...e,ref:u,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:xi(e.onCloseAutoFocus,f=>{var m;f.preventDefault(),(m=r.triggerRef.current)==null||m.focus()}),onPointerDownOutside:xi(e.onPointerDownOutside,f=>{const m=f.detail.originalEvent,i=m.button===0&&m.ctrlKey===!0;(m.button===2||i)&&f.preventDefault()}),onFocusOutside:xi(e.onFocusOutside,f=>f.preventDefault())})}),Oce=V.forwardRef((e,t)=>{const r=Nd(y_,e.__scopeDialog),s=V.useRef(!1),u=V.useRef(!1);return c.jsx(Z9,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:f=>{var m,i;(m=e.onCloseAutoFocus)==null||m.call(e,f),f.defaultPrevented||(s.current||(i=r.triggerRef.current)==null||i.focus(),f.preventDefault()),s.current=!1,u.current=!1},onInteractOutside:f=>{var S,E;(S=e.onInteractOutside)==null||S.call(e,f),f.defaultPrevented||(s.current=!0,f.detail.originalEvent.type==="pointerdown"&&(u.current=!0));const m=f.target;((E=r.triggerRef.current)==null?void 0:E.contains(m))&&f.preventDefault(),f.detail.originalEvent.type==="focusin"&&u.current&&f.preventDefault()}})}),Z9=V.forwardRef((e,t)=>{const{__scopeDialog:r,trapFocus:s,onOpenAutoFocus:u,onCloseAutoFocus:f,...m}=e,i=Nd(y_,r),S=V.useRef(null),E=da(t,S);return N9(),c.jsxs(c.Fragment,{children:[c.jsx(FR,{asChild:!0,loop:!0,trapped:s,onMountAutoFocus:u,onUnmountAutoFocus:f,children:c.jsx(Fb,{role:"dialog",id:i.contentId,"aria-describedby":i.descriptionId,"aria-labelledby":i.titleId,"data-state":UR(i.open),...m,ref:E,onDismiss:()=>i.onOpenChange(!1)})}),c.jsxs(c.Fragment,{children:[c.jsx(Lce,{titleId:i.titleId}),c.jsx(Bce,{contentRef:S,descriptionId:i.descriptionId})]})]})}),BR="DialogTitle",X9=V.forwardRef((e,t)=>{const{__scopeDialog:r,...s}=e,u=Nd(BR,r);return c.jsx(es.h2,{id:u.titleId,...s,ref:t})});X9.displayName=BR;var Y9="DialogDescription",K9=V.forwardRef((e,t)=>{const{__scopeDialog:r,...s}=e,u=Nd(Y9,r);return c.jsx(es.p,{id:u.descriptionId,...s,ref:t})});K9.displayName=Y9;var J9="DialogClose",Q9=V.forwardRef((e,t)=>{const{__scopeDialog:r,...s}=e,u=Nd(J9,r);return c.jsx(es.button,{type:"button",...s,ref:t,onClick:xi(e.onClick,()=>u.onOpenChange(!1))})});Q9.displayName=J9;function UR(e){return e?"open":"closed"}var e7="DialogTitleWarning",[Fce,t7]=zQ(e7,{contentName:y_,titleName:BR,docsSlug:"dialog"}),Lce=({titleId:e})=>{const t=t7(e7),r=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return V.useEffect(()=>{e&&(document.getElementById(e)||console.error(r))},[r,e]),null},zce="DialogDescriptionWarning",Bce=({contentRef:e,descriptionId:t})=>{const s=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${t7(zce).contentName}}.`;return V.useEffect(()=>{var f;const u=(f=e.current)==null?void 0:f.getAttribute("aria-describedby");t&&u&&(document.getElementById(t)||console.warn(s))},[s,e,t]),null},VR=U9,r7=$9,$R=G9,$b=W9,qb=H9,Gb=X9,Wb=K9,uA=Q9;const Bs=VR,n7=r7,Uce=$R,i7=V.forwardRef(({className:e,...t},r)=>c.jsx($b,{ref:r,className:sn("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));i7.displayName=$b.displayName;const Is=V.forwardRef(({className:e,children:t,...r},s)=>c.jsxs(Uce,{children:[c.jsx(i7,{}),c.jsxs(qb,{ref:s,className:sn("fixed left-[50%] top-[50%] z-50 grid w-[70vw] max-h-[70vh] translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 overflow-auto data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...r,children:[t,c.jsxs(uA,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[c.jsx(lR,{className:"h-4 w-4"}),c.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Is.displayName=qb.displayName;const Ns=({className:e,...t})=>c.jsx("div",{className:sn("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});Ns.displayName="DialogHeader";const _d=({className:e,...t})=>c.jsx("div",{className:sn("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});_d.displayName="DialogFooter";const ks=V.forwardRef(({className:e,...t},r)=>c.jsx(Gb,{ref:r,className:sn("text-lg font-semibold leading-none tracking-tight",e),...t}));ks.displayName=Gb.displayName;const La=V.forwardRef(({className:e,...t},r)=>c.jsx(Wb,{ref:r,className:sn("text-sm text-muted-foreground",e),...t}));La.displayName=Wb.displayName;const Vce=Vb({email:ol().trim().email({message:"Email invlido"}).max(255,{message:"Email deve ter no mximo 255 caracteres"})}),$ce=()=>{const[e,t]=V.useState(!1),[r,s]=V.useState(""),[u,f]=V.useState(!1),{toast:m}=wm(),i=async S=>{S.preventDefault(),f(!0);try{const E=Vce.parse({email:r}),{error:I,data:D}=await tt.functions.invoke("request-password-reset",{body:{email:E.email}});if(I)throw I;if(D&&D.success===!1)throw new Error(D.message||"Nao foi possivel enviar o email");m({title:"Email enviado!",description:"Se o email estiver cadastrado, voc receber as instrues para redefinir sua senha."}),s(""),t(!1)}catch(E){E instanceof Au?m({title:"Erro de validao",description:E.errors[0].message,variant:"destructive"}):m({title:"Erro",description:E.message||"No foi possvel enviar o email",variant:"destructive"})}finally{f(!1)}};return c.jsxs(Bs,{open:e,onOpenChange:t,children:[c.jsx(n7,{asChild:!0,children:c.jsx("button",{type:"button",className:"text-sm text-primary hover:underline",children:"Esqueci minha senha"})}),c.jsxs(Is,{className:"sm:max-w-md",children:[c.jsxs(Ns,{children:[c.jsx("div",{className:"flex justify-center mb-2",children:c.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:c.jsx(qee,{className:"h-6 w-6 text-primary"})})}),c.jsx(ks,{children:"Recuperar Senha"}),c.jsx(La,{children:"Digite seu email para receber as instrues de redefinio de senha."})]}),c.jsxs("form",{onSubmit:i,className:"space-y-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"reset-email",children:"Email"}),c.jsx(xr,{id:"reset-email",type:"email",placeholder:"seu@email.com",value:r,onChange:S=>s(S.target.value),required:!0,disabled:u,maxLength:255})]}),c.jsxs("div",{className:"flex gap-2 justify-end",children:[c.jsx(Nt,{type:"button",variant:"outline",onClick:()=>t(!1),disabled:u,children:"Cancelar"}),c.jsx(Nt,{type:"submit",disabled:u,children:u?c.jsxs(c.Fragment,{children:[c.jsx(bf,{className:"mr-2 h-4 w-4 animate-spin"}),"Enviando..."]}):"Enviar Email"})]})]})]})]})},qce=Vb({email:ol().trim().email({message:"Email invlido"}).max(255,{message:"Email deve ter no mximo 255 caracteres"}),password:ol().min(6,{message:"Senha deve ter no mnimo 6 caracteres"}).max(72,{message:"Senha deve ter no mximo 72 caracteres"}),fullName:ol().trim().min(1,{message:"Nome completo  obrigatrio"}).max(100,{message:"Nome deve ter no mximo 100 caracteres"}),phone:ol().trim().max(20,{message:"Telefone deve ter no mximo 20 caracteres"}).optional()}),Gce=Vb({email:ol().trim().email({message:"Email invlido"}).max(255,{message:"Email deve ter no mximo 255 caracteres"}),password:ol().min(1,{message:"Senha  obrigatria"}).max(72,{message:"Senha deve ter no mximo 72 caracteres"})}),Wce=()=>{const[e,t]=V.useState(!0),[r,s]=V.useState(""),[u,f]=V.useState(""),[m,i]=V.useState(""),[S,E]=V.useState(""),[I,D]=V.useState(!1),[M,R]=V.useState(!1),H=Id(),{toast:F}=wm();V.useEffect(()=>{tt.auth.getSession().then(({data:{session:z}})=>{z&&H("/dashboard")});const{data:{subscription:Y}}=tt.auth.onAuthStateChange((z,J)=>{J&&H("/dashboard")});return()=>Y.unsubscribe()},[H]);const U=async Y=>{Y.preventDefault(),D(!0);try{if(e){const z=Gce.parse({email:r,password:u}),{error:J}=await tt.auth.signInWithPassword({email:z.email,password:z.password});if(J)throw J;F({title:"Login realizado!",description:"Bem-vindo de volta ao Facilities Hub."}),H("/dashboard")}else{const z=qce.parse({email:r,password:u,fullName:m,phone:S||void 0}),{error:J,data:ne}=await tt.auth.signUp({email:z.email,password:z.password,options:{emailRedirectTo:`${window.location.origin}/dashboard`,data:{full_name:z.fullName,phone:z.phone}}});if(J)throw J;ne.user&&await zle(z.email,z.fullName),F({title:"Cadastro realizado!",description:"Sua conta foi criada com sucesso. Email de boas-vindas enviado!"}),H("/dashboard")}}catch(z){z instanceof Au?F({title:"Erro de validao",description:z.errors[0].message,variant:"destructive"}):F({title:"Erro",description:z.message,variant:"destructive"})}finally{D(!1)}};return c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-primary/5 via-background to-accent/5 p-4",children:c.jsxs($r,{className:"w-full max-w-md shadow-lg",children:[c.jsxs(Xn,{className:"space-y-3 text-center",children:[c.jsx("div",{className:"flex justify-center mb-2",children:c.jsx("div",{className:"p-3 bg-gradient-to-br from-primary to-accent rounded-xl",children:c.jsx(cm,{className:"h-8 w-8 text-primary-foreground"})})}),c.jsx(ti,{className:"text-2xl font-bold bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent",children:"Facilities Center"}),c.jsx(Gs,{children:e?"Entre na sua conta":"Crie sua conta"})]}),c.jsxs(_n,{children:[c.jsxs("form",{onSubmit:U,className:"space-y-4",children:[!e&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"fullName",children:"Nome Completo"}),c.jsx(xr,{id:"fullName",type:"text",placeholder:"Joo Silva",value:m,onChange:Y=>i(Y.target.value),required:!e,disabled:I,maxLength:100})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"phone",children:"Telefone"}),c.jsx(xr,{id:"phone",type:"tel",placeholder:"(11) 99999-9999",value:S,onChange:Y=>E(Y.target.value),disabled:I,maxLength:20})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"email",children:"Email"}),c.jsx(xr,{id:"email",type:"email",placeholder:"seu@email.com",value:r,onChange:Y=>s(Y.target.value),required:!0,disabled:I,maxLength:255})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"password",children:"Senha"}),c.jsxs("div",{className:"relative",children:[c.jsx(xr,{id:"password",type:M?"text":"password",placeholder:"********",value:u,onChange:Y=>f(Y.target.value),required:!0,disabled:I,minLength:6,maxLength:72,className:"pr-10"}),c.jsx("button",{type:"button",onClick:()=>R(Y=>!Y),className:"absolute inset-y-0 right-0 flex items-center px-3 text-muted-foreground hover:text-foreground","aria-label":M?"Ocultar senha":"Mostrar senha",disabled:I,children:M?c.jsx(Yk,{className:"h-4 w-4"}):c.jsx(f_,{className:"h-4 w-4"})})]})]}),c.jsx(Nt,{type:"submit",className:"w-full",disabled:I,children:I?c.jsxs(c.Fragment,{children:[c.jsx(bf,{className:"mr-2 h-4 w-4 animate-spin"}),"Processando..."]}):e?"Entrar":"Cadastrar"})]}),c.jsx("div",{className:"mt-4 text-center",children:e&&c.jsx($ce,{})}),c.jsx("div",{className:"mt-4 text-center text-sm",children:c.jsx("button",{type:"button",onClick:()=>t(!e),className:"text-primary hover:underline",disabled:I,children:e?"No tem uma conta? Cadastre-se":"J tem uma conta? Faa login"})})]})]})})},PN=768;function Hce(){const[e,t]=V.useState(void 0);return V.useEffect(()=>{const r=window.matchMedia(`(max-width: ${PN-1}px)`),s=()=>{t(window.innerWidth<PN)};return r.addEventListener("change",s),t(window.innerWidth<PN),()=>r.removeEventListener("change",s)},[]),!!e}var Zce="Separator",jB="horizontal",Xce=["horizontal","vertical"],s7=V.forwardRef((e,t)=>{const{decorative:r,orientation:s=jB,...u}=e,f=Yce(s)?s:jB,i=r?{role:"none"}:{"aria-orientation":f==="vertical"?f:void 0,role:"separator"};return c.jsx(es.div,{"data-orientation":f,...i,...u,ref:t})});s7.displayName=Zce;function Yce(e){return Xce.includes(e)}var a7=s7;const s_=V.forwardRef(({className:e,orientation:t="horizontal",decorative:r=!0,...s},u)=>c.jsx(a7,{ref:u,decorative:r,orientation:t,className:sn("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...s}));s_.displayName=a7.displayName;const Kce=VR,Jce=$R,o7=V.forwardRef(({className:e,...t},r)=>c.jsx($b,{className:sn("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:r}));o7.displayName=$b.displayName;const Qce=Fv("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),l7=V.forwardRef(({side:e="right",className:t,children:r,...s},u)=>c.jsxs(Jce,{children:[c.jsx(o7,{}),c.jsxs(qb,{ref:u,className:sn(Qce({side:e}),t),...s,children:[r,c.jsxs(uA,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-secondary hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[c.jsx(lR,{className:"h-4 w-4"}),c.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));l7.displayName=qb.displayName;const eue=V.forwardRef(({className:e,...t},r)=>c.jsx(Gb,{ref:r,className:sn("text-lg font-semibold text-foreground",e),...t}));eue.displayName=Gb.displayName;const tue=V.forwardRef(({className:e,...t},r)=>c.jsx(Wb,{ref:r,className:sn("text-sm text-muted-foreground",e),...t}));tue.displayName=Wb.displayName;function iC({className:e,...t}){return c.jsx("div",{className:sn("animate-pulse rounded-md bg-muted",e),...t})}const rue="sidebar:state",nue=60*60*24*7,iue="16rem",sue="18rem",aue="3rem",oue="b",c7=V.createContext(null);function Hb(){const e=V.useContext(c7);if(!e)throw new Error("useSidebar must be used within a SidebarProvider.");return e}const u7=V.forwardRef(({defaultOpen:e=!0,open:t,onOpenChange:r,className:s,style:u,children:f,...m},i)=>{const S=Hce(),[E,I]=V.useState(!1),[D,M]=V.useState(e),R=t??D,H=V.useCallback(z=>{const J=typeof z=="function"?z(R):z;r?r(J):M(J),document.cookie=`${rue}=${J}; path=/; max-age=${nue}`},[r,R]),F=V.useCallback(()=>S?I(z=>!z):H(z=>!z),[S,H,I]);V.useEffect(()=>{const z=J=>{J.key===oue&&(J.metaKey||J.ctrlKey)&&(J.preventDefault(),F())};return window.addEventListener("keydown",z),()=>window.removeEventListener("keydown",z)},[F]);const U=R?"expanded":"collapsed",Y=V.useMemo(()=>({state:U,open:R,setOpen:H,isMobile:S,openMobile:E,setOpenMobile:I,toggleSidebar:F}),[U,R,H,S,E,I,F]);return c.jsx(c7.Provider,{value:Y,children:c.jsx(K8,{delayDuration:0,children:c.jsx("div",{style:{"--sidebar-width":iue,"--sidebar-width-icon":aue,...u},className:sn("group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",s),ref:i,...m,children:f})})})});u7.displayName="SidebarProvider";const d7=V.forwardRef(({side:e="left",variant:t="sidebar",collapsible:r="offcanvas",className:s,children:u,...f},m)=>{const{isMobile:i,state:S,openMobile:E,setOpenMobile:I}=Hb();return r==="none"?c.jsx("div",{className:sn("flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",s),ref:m,...f,children:u}):i?c.jsx(Kce,{open:E,onOpenChange:I,...f,children:c.jsx(l7,{"data-sidebar":"sidebar","data-mobile":"true",className:"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden",style:{"--sidebar-width":sue},side:e,children:c.jsx("div",{className:"flex h-full w-full flex-col",children:u})})}):c.jsxs("div",{ref:m,className:"group peer hidden text-sidebar-foreground md:block","data-state":S,"data-collapsible":S==="collapsed"?r:"","data-variant":t,"data-side":e,children:[c.jsx("div",{className:sn("relative h-svh w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180",t==="floating"||t==="inset"?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon]")}),c.jsx("div",{className:sn("fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex",e==="left"?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",t==="floating"||t==="inset"?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",s),...f,children:c.jsx("div",{"data-sidebar":"sidebar",className:"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow",children:u})})]})});d7.displayName="Sidebar";const h7=V.forwardRef(({className:e,onClick:t,...r},s)=>{const{toggleSidebar:u}=Hb();return c.jsxs(Nt,{ref:s,"data-sidebar":"trigger",variant:"ghost",size:"icon",className:sn("h-7 w-7",e),onClick:f=>{t==null||t(f),u()},...r,children:[c.jsx(Xee,{}),c.jsx("span",{className:"sr-only",children:"Toggle Sidebar"})]})});h7.displayName="SidebarTrigger";const lue=V.forwardRef(({className:e,...t},r)=>{const{toggleSidebar:s}=Hb();return c.jsx("button",{ref:r,"data-sidebar":"rail","aria-label":"Toggle Sidebar",tabIndex:-1,onClick:s,title:"Toggle Sidebar",className:sn("absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] group-data-[side=left]:-right-4 group-data-[side=right]:left-0 hover:after:bg-sidebar-border sm:flex","[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize","[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize","group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar","[[data-side=left][data-collapsible=offcanvas]_&]:-right-2","[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",e),...t})});lue.displayName="SidebarRail";const cue=V.forwardRef(({className:e,...t},r)=>c.jsx("main",{ref:r,className:sn("relative flex min-h-svh flex-1 flex-col bg-background","peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",e),...t}));cue.displayName="SidebarInset";const uue=V.forwardRef(({className:e,...t},r)=>c.jsx(xr,{ref:r,"data-sidebar":"input",className:sn("h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",e),...t}));uue.displayName="SidebarInput";const due=V.forwardRef(({className:e,...t},r)=>c.jsx("div",{ref:r,"data-sidebar":"header",className:sn("flex flex-col gap-2 p-2",e),...t}));due.displayName="SidebarHeader";const hue=V.forwardRef(({className:e,...t},r)=>c.jsx("div",{ref:r,"data-sidebar":"footer",className:sn("flex flex-col gap-2 p-2",e),...t}));hue.displayName="SidebarFooter";const fue=V.forwardRef(({className:e,...t},r)=>c.jsx(s_,{ref:r,"data-sidebar":"separator",className:sn("mx-2 w-auto bg-sidebar-border",e),...t}));fue.displayName="SidebarSeparator";const f7=V.forwardRef(({className:e,...t},r)=>c.jsx("div",{ref:r,"data-sidebar":"content",className:sn("flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",e),...t}));f7.displayName="SidebarContent";const p7=V.forwardRef(({className:e,...t},r)=>c.jsx("div",{ref:r,"data-sidebar":"group",className:sn("relative flex w-full min-w-0 flex-col p-2",e),...t}));p7.displayName="SidebarGroup";const m7=V.forwardRef(({className:e,asChild:t=!1,...r},s)=>{const u=t?N_:"div";return c.jsx(u,{ref:s,"data-sidebar":"group-label",className:sn("flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",e),...r})});m7.displayName="SidebarGroupLabel";const pue=V.forwardRef(({className:e,asChild:t=!1,...r},s)=>{const u=t?N_:"button";return c.jsx(u,{ref:s,"data-sidebar":"group-action",className:sn("absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","group-data-[collapsible=icon]:hidden",e),...r})});pue.displayName="SidebarGroupAction";const g7=V.forwardRef(({className:e,...t},r)=>c.jsx("div",{ref:r,"data-sidebar":"group-content",className:sn("w-full text-sm",e),...t}));g7.displayName="SidebarGroupContent";const _7=V.forwardRef(({className:e,...t},r)=>c.jsx("ul",{ref:r,"data-sidebar":"menu",className:sn("flex w-full min-w-0 flex-col gap-1",e),...t}));_7.displayName="SidebarMenu";const cE=V.forwardRef(({className:e,...t},r)=>c.jsx("li",{ref:r,"data-sidebar":"menu-item",className:sn("group/menu-item relative",e),...t}));cE.displayName="SidebarMenuItem";const mue=Fv("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-sm",sm:"h-7 text-xs",lg:"h-12 text-sm group-data-[collapsible=icon]:!p-0"}},defaultVariants:{variant:"default",size:"default"}}),uE=V.forwardRef(({asChild:e=!1,isActive:t=!1,variant:r="default",size:s="default",tooltip:u,className:f,...m},i)=>{const S=e?N_:"button",{isMobile:E,state:I}=Hb(),D=c.jsx(S,{ref:i,"data-sidebar":"menu-button","data-size":s,"data-active":t,className:sn(mue({variant:r,size:s}),f),...m});return u?(typeof u=="string"&&(u={children:u}),c.jsxs(nie,{children:[c.jsx(iie,{asChild:!0,children:D}),c.jsx(J8,{side:"right",align:"center",hidden:I!=="collapsed"||E,...u})]})):D});uE.displayName="SidebarMenuButton";const gue=V.forwardRef(({className:e,asChild:t=!1,showOnHover:r=!1,...s},u)=>{const f=t?N_:"button";return c.jsx(f,{ref:u,"data-sidebar":"menu-action",className:sn("absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform peer-hover/menu-button:text-sidebar-accent-foreground hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",r&&"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",e),...s})});gue.displayName="SidebarMenuAction";const _ue=V.forwardRef(({className:e,...t},r)=>c.jsx("div",{ref:r,"data-sidebar":"menu-badge",className:sn("pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground","peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",e),...t}));_ue.displayName="SidebarMenuBadge";const xue=V.forwardRef(({className:e,showIcon:t=!1,...r},s)=>{const u=V.useMemo(()=>`${Math.floor(Math.random()*40)+50}%`,[]);return c.jsxs("div",{ref:s,"data-sidebar":"menu-skeleton",className:sn("flex h-8 items-center gap-2 rounded-md px-2",e),...r,children:[t&&c.jsx(iC,{className:"size-4 rounded-md","data-sidebar":"menu-skeleton-icon"}),c.jsx(iC,{className:"h-4 max-w-[--skeleton-width] flex-1","data-sidebar":"menu-skeleton-text",style:{"--skeleton-width":u}})]})});xue.displayName="SidebarMenuSkeleton";const vue=V.forwardRef(({className:e,...t},r)=>c.jsx("ul",{ref:r,"data-sidebar":"menu-sub",className:sn("mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5","group-data-[collapsible=icon]:hidden",e),...t}));vue.displayName="SidebarMenuSub";const yue=V.forwardRef(({...e},t)=>c.jsx("li",{ref:t,...e}));yue.displayName="SidebarMenuSubItem";const wue=V.forwardRef(({asChild:e=!1,size:t="md",isActive:r,className:s,...u},f)=>{const m=e?N_:"a";return c.jsx(m,{ref:f,"data-sidebar":"menu-sub-button","data-size":t,"data-active":r,className:sn("flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring aria-disabled:pointer-events-none aria-disabled:opacity-50 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground","data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",t==="sm"&&"text-xs",t==="md"&&"text-sm","group-data-[collapsible=icon]:hidden",s),...u})});wue.displayName="SidebarMenuSubButton";const UP=V.forwardRef(({className:e,activeClassName:t,pendingClassName:r,to:s,...u},f)=>c.jsx(Fse,{ref:f,to:s,className:({isActive:m,isPending:i})=>sn(e,m&&t,i&&r),...u}));UP.displayName="NavLink";const bue=[{title:"Aguardando confirmao",url:"/diarias/aguardando",status:"Aguardando confirmacao"},{title:"Confirmadas",url:"/diarias/confirmadas",status:"Confirmada"},{title:"Financeiro",url:"/diarias/aprovadas",status:"Aprovada"},{title:"Lanadas",url:"/diarias/lancadas",status:"Lanada para pagamento"},{title:"Aprovadas p/ pagamento",url:"/diarias/aprovadas-pagamento",status:"Aprovada para pagamento"},{title:"Reprovadas",url:"/diarias/reprovadas"},{title:"Canceladas",url:"/diarias/canceladas"},{title:"Pagas",url:"/diarias/pagas"}],x7=[{title:"Aguardando confirmao",url:"/diarias2/aguardando",status:"Aguardando confirmacao"},{title:"Confirmadas",url:"/diarias2/confirmadas",status:"Confirmada"},{title:"Financeiro",url:"/diarias2/aprovadas",status:"Aprovada"},{title:"Lanadas",url:"/diarias2/lancadas",status:"Lanada para pagamento"},{title:"Aprovadas p/ pagamento",url:"/diarias2/aprovadas-pagamento",status:"Aprovada para pagamento"},{title:"Pagas",url:"/diarias2/pagas"},{title:"Reprovadas",url:"/diarias2/reprovadas"},{title:"Canceladas",url:"/diarias2/canceladas"}],Sue=[{title:"Dashboard 24/7",url:"/dashboard-24h",icon:Kk},{title:"Dashboard",url:"/dashboard",icon:Kk},{title:"Contratos",url:"/contratos",icon:Sm},{title:"Mesa de Operaes",url:"/mesa-operacoes",icon:Bee},{title:"Chamados",url:"/chamados",icon:ob},{title:"Ordens de Servio",url:"/ordens-servico",icon:HC},{title:"Colaboradores",url:"/colaboradores",icon:XC},{title:"Diaristas",url:"/diaristas",icon:r8},{title:"Diarias (verso 1.0.0)",url:"/diarias2",icon:jc,children:x7,statusCountsKey:"diariasTemporarias"},{title:"Ativos",url:"/ativos",icon:ef},{title:"Estoque",url:"/estoque",icon:ef},{title:"Checklists",url:"/checklists",icon:i8},{title:"Execues de Checklist",url:"/checklist-execucoes",icon:Q4},{title:"Responder Checklist",url:"/checklist-respostas",icon:Q4},{title:"Respostas registradas",url:"/checklist-respostas-lista",icon:Gee}];function Tue(){const{open:e}=Hb(),t=Tf(),r=Id(),s=t.pathname,[u,f]=V.useState({}),[m,i]=V.useState({});V.useEffect(()=>{let I=!0;const D=async(R,H)=>{const F=R.filter(z=>z.status);if(F.length===0)return{};const U=await Promise.all(F.map(async z=>{const{count:J,error:ne}=await tt.from(H).select("id",{count:"exact",head:!0}).eq("status",z.status);if(ne)throw ne;return{status:z.status,count:J||0}})),Y={};return U.forEach(({status:z,count:J})=>{Y[z]=J}),Y};return(async()=>{try{const[R,H]=await Promise.all([D(bue,"diarias"),D(x7,"diarias_temporarias")]);if(!I)return;f(R),i(H)}catch(R){console.error("Erro ao carregar contagens de diarias:",R)}})(),()=>{I=!1}},[]);const S=(I,D=!0)=>D?s===I:s===I||s.startsWith(`${I}/`),E=async()=>{await tt.auth.signOut(),$t.success("Logout realizado com sucesso"),r("/auth")};return c.jsx(d7,{className:e?"w-64":"w-16",collapsible:"icon",children:c.jsx(f7,{children:c.jsxs(p7,{children:[c.jsx(m7,{className:e?"":"hidden",children:"Facilities Center"}),c.jsx(g7,{children:c.jsxs(_7,{children:[Sue.map(I=>{const D=Array.isArray(I.children)&&I.children.length>0,M=D?S(I.url,!1):S(I.url),R=I.statusCountsKey==="diariasTemporarias"?m:u;return c.jsxs(cE,{children:[c.jsx(uE,{asChild:!0,isActive:M,children:c.jsxs(UP,{to:I.url,end:!D,className:"flex items-center gap-3 hover:bg-accent",activeClassName:"bg-accent text-accent-foreground font-medium",children:[c.jsx(I.icon,{className:"h-5 w-5"}),e&&c.jsx("span",{children:I.title})]})}),D&&e&&M&&c.jsx("ul",{className:"ml-6 mt-1 space-y-1 border-l pl-3",children:I.children.map(H=>c.jsx(cE,{children:c.jsx(uE,{asChild:!0,isActive:S(H.url),children:c.jsxs(UP,{to:H.url,end:!0,className:"flex w-full items-center justify-between gap-2 text-sm hover:bg-accent",activeClassName:"bg-accent text-accent-foreground font-medium",children:[c.jsx("span",{className:"truncate",children:H.title}),H.status&&(R[H.status]??0)>0&&c.jsx("span",{className:"inline-flex h-5 min-w-[1.25rem] items-center justify-center rounded-full bg-destructive px-1 text-[10px] font-semibold text-destructive-foreground",children:R[H.status]})]})})},H.title))})]},I.title)}),c.jsx(cE,{children:c.jsxs(uE,{onClick:E,children:[c.jsx(Hee,{className:"h-5 w-5"}),e&&c.jsx("span",{children:"Sair"})]})})]})})]})})})}function Wa({children:e}){return c.jsx(u7,{defaultOpen:!0,children:c.jsxs("div",{className:"min-h-screen flex w-full",children:[c.jsx(Tue,{}),c.jsxs("div",{className:"flex-1 flex flex-col",children:[c.jsx("header",{className:"h-14 border-b flex items-center px-4 bg-background sticky top-0 z-10",children:c.jsx(h7,{})}),c.jsx("main",{className:"flex-1 overflow-auto",children:e})]})]})})}const Eue=()=>{const[e,t]=V.useState(null),[r,s]=V.useState(null),[u,f]=V.useState(!0),m=Id(),{toast:i}=wm();V.useEffect(()=>{S();const{data:{subscription:D}}=tt.auth.onAuthStateChange(async(M,R)=>{if(M==="SIGNED_IN"&&R){t(R.user);const{data:H}=await tt.from("user_roles").select("role").eq("user_id",R.user.id).single();H&&s(H.role),f(!1)}else M==="SIGNED_OUT"&&m("/auth")});return()=>D.unsubscribe()},[]);const S=async()=>{try{const{data:{user:D}}=await tt.auth.getUser();if(!D){m("/auth");return}t(D);const{data:M}=await tt.from("user_roles").select("role").eq("user_id",D.id).single();M&&s(M.role)}catch(D){console.error("Error checking user:",D)}finally{f(!1)}};if(u)return c.jsx("div",{className:"min-h-screen flex items-center justify-center",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})});const E={admin:"Administrador",gestor_operacoes:"Gestor de Operaes",supervisor:"Supervisor",analista_centro_controle:"Analista do Centro de Controle",tecnico:"Tcnico",cliente_view:"Cliente (Visualizao)"},I=[{title:"Dashboard 24/7",description:"Resumo executivo e alertas em tempo real",icon:Xk,color:"from-blue-500 to-cyan-500",action:()=>m("/dashboard-24h")},{title:"Gesto de Contratos",description:"Clientes, contratos, unidades e postos",icon:cm,color:"from-purple-500 to-pink-500",action:()=>m("/contratos")},{title:"Mesa de Operaes",description:"Mapa operacional e monitoramento 24/7",icon:um,color:"from-green-500 to-emerald-500",action:()=>m("/mesa-operacoes")},{title:"Chamados",description:"Sistema de abertura e acompanhamento",icon:ob,color:"from-orange-500 to-amber-500",action:()=>m("/chamados")},{title:"Ordens de Servio",description:"Preventivas, corretivas e emergenciais",icon:Sm,color:"from-indigo-500 to-purple-500",action:()=>m("/ordens-servico")},{title:"Incidentes",description:"Registro e investigao de incidentes",icon:i_,color:"from-red-500 to-rose-500",action:()=>i({title:"Em desenvolvimento",description:"Mdulo em breve!"})},{title:"Checklists",description:"Checklists e auditorias",icon:zb,color:"from-teal-500 to-cyan-500",action:()=>m("/checklists")},{title:"Recursos",description:"Materiais, equipamentos e veculos",icon:ef,color:"from-violet-500 to-purple-500",action:()=>m("/estoque")},{title:"Colaboradores",description:"Gesto de pessoal e escalas",icon:of,color:"from-blue-500 to-indigo-500",action:()=>m("/colaboradores")},{title:"QSMMA",description:"Qualidade, Segurana, Meio Ambiente e Sade",icon:aR,color:"from-emerald-500 to-green-500",action:()=>i({title:"Em desenvolvimento",description:"Mdulo em breve!"})},{title:"Portal do Cliente",description:"rea restrita para clientes",icon:f_,color:"from-pink-500 to-rose-500",action:()=>i({title:"Em desenvolvimento",description:"Mdulo em breve!"})},{title:"Configuraes",description:"Configuraes do sistema",icon:Jee,color:"from-gray-500 to-slate-500",action:()=>i({title:"Em desenvolvimento",description:"Mdulo em breve!"})}];return c.jsx(Wa,{children:c.jsxs("div",{className:"min-h-screen bg-background",children:[c.jsx("header",{className:"border-b bg-card shadow-sm",children:c.jsx("div",{className:"container mx-auto px-4 py-4",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"p-2 bg-gradient-to-br from-primary to-accent rounded-lg",children:c.jsx(cm,{className:"h-6 w-6 text-primary-foreground"})}),c.jsxs("div",{children:[c.jsx("h1",{className:"text-xl font-bold",children:"Facilities Center"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Sistema de Gesto de Facilities"})]})]})})}),c.jsxs("main",{className:"container mx-auto px-4 py-8",children:[c.jsxs("div",{className:"mb-8",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx(Kk,{className:"h-6 w-6 text-primary"}),c.jsx("h2",{className:"text-2xl font-bold",children:"Dashboard"})]}),c.jsxs("p",{className:"text-muted-foreground",children:["Bem-vindo, ",e==null?void 0:e.email,"  Perfil: ",E[r||""]||r]})]}),c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:I.map((D,M)=>c.jsx($r,{className:"cursor-pointer hover:shadow-lg transition-all duration-300 hover:-translate-y-1",onClick:D.action,children:c.jsxs(Xn,{children:[c.jsx("div",{className:`w-12 h-12 rounded-lg bg-gradient-to-br ${D.color} flex items-center justify-center mb-4`,children:c.jsx(D.icon,{className:"h-6 w-6 text-white"})}),c.jsx(ti,{className:"text-lg",children:D.title}),c.jsx(Gs,{children:D.description})]})},M))}),c.jsxs("div",{className:"mt-8 grid grid-cols-1 md:grid-cols-4 gap-6",children:[c.jsx($r,{children:c.jsxs(Xn,{children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx(ti,{className:"text-sm font-medium text-muted-foreground",children:"SLA do Dia"}),c.jsx(Xk,{className:"h-5 w-5 text-green-600"})]}),c.jsx("p",{className:"text-3xl font-bold text-green-600",children:"0%"})]})}),c.jsx($r,{children:c.jsxs(Xn,{children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx(ti,{className:"text-sm font-medium text-muted-foreground",children:"Chamados Abertos"}),c.jsx(ob,{className:"h-5 w-5 text-primary"})]}),c.jsx("p",{className:"text-3xl font-bold",children:"0"})]})}),c.jsx($r,{children:c.jsxs(Xn,{children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx(ti,{className:"text-sm font-medium text-muted-foreground",children:"Incidentes Crticos"}),c.jsx(i_,{className:"h-5 w-5 text-red-600"})]}),c.jsx("p",{className:"text-3xl font-bold text-red-600",children:"0"})]})}),c.jsx($r,{children:c.jsxs(Xn,{children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx(ti,{className:"text-sm font-medium text-muted-foreground",children:"Postos Cobertos"}),c.jsx(of,{className:"h-5 w-5 text-primary"})]}),c.jsx("p",{className:"text-3xl font-bold",children:"0/0"})]})})]})]})]})})},Cue=Fv("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Oi({className:e,variant:t,...r}){return c.jsx("div",{className:sn(Cue({variant:t}),e),...r})}var v7={exports:{}};(function(e,t){(function(r,s){e.exports=s()})(lK,function(){var r,s,u;function f(i,S){if(!r)r=S;else if(!s)s=S;else{var E="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+r+")(sharedChunk); ("+s+")(sharedChunk); self.onerror = null;",I={};r(I),u=S(I),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(u.workerUrl=window.URL.createObjectURL(new Blob([E],{type:"text/javascript"})))}}f(["exports"],function(i){var S=1e-6,E=typeof Float32Array<"u"?Float32Array:Array;function I(l,n){var o=n[0],h=n[1],p=n[2],x=n[3],v=o*x-p*h;return v?(l[0]=x*(v=1/v),l[1]=-h*v,l[2]=-p*v,l[3]=o*v,l):null}function D(){var l=new E(9);return E!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l}function M(l,n){var o=n[0],h=n[1],p=n[2],x=n[3],v=n[4],w=n[5],C=n[6],A=n[7],k=n[8];return l[0]=v*k-w*A,l[1]=p*A-h*k,l[2]=h*w-p*v,l[3]=w*C-x*k,l[4]=o*k-p*C,l[5]=p*x-o*w,l[6]=x*A-v*C,l[7]=h*C-o*A,l[8]=o*v-h*x,l}function R(l,n,o){var h=n[0],p=n[1],x=n[2],v=n[3],w=n[4],C=n[5],A=n[6],k=n[7],P=n[8],O=o[0],G=o[1],W=o[2],te=o[3],se=o[4],oe=o[5],ge=o[6],ve=o[7],Te=o[8];return l[0]=O*h+G*v+W*A,l[1]=O*p+G*w+W*k,l[2]=O*x+G*C+W*P,l[3]=te*h+se*v+oe*A,l[4]=te*p+se*w+oe*k,l[5]=te*x+se*C+oe*P,l[6]=ge*h+ve*v+Te*A,l[7]=ge*p+ve*w+Te*k,l[8]=ge*x+ve*C+Te*P,l}function H(){var l=new E(16);return E!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0),l[0]=1,l[5]=1,l[10]=1,l[15]=1,l}function F(l){var n=new E(16);return n[0]=l[0],n[1]=l[1],n[2]=l[2],n[3]=l[3],n[4]=l[4],n[5]=l[5],n[6]=l[6],n[7]=l[7],n[8]=l[8],n[9]=l[9],n[10]=l[10],n[11]=l[11],n[12]=l[12],n[13]=l[13],n[14]=l[14],n[15]=l[15],n}function U(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function Y(l,n){var o=n[0],h=n[1],p=n[2],x=n[3],v=n[4],w=n[5],C=n[6],A=n[7],k=n[8],P=n[9],O=n[10],G=n[11],W=n[12],te=n[13],se=n[14],oe=n[15],ge=o*w-h*v,ve=o*C-p*v,Te=o*A-x*v,$e=h*C-p*w,Fe=h*A-x*w,Ze=p*A-x*C,Ye=k*te-P*W,Je=k*se-O*W,Tt=k*oe-G*W,ot=P*se-O*te,Ct=P*oe-G*te,Mt=O*oe-G*se,Bt=ge*Mt-ve*Ct+Te*ot+$e*Tt-Fe*Je+Ze*Ye;return Bt?(l[0]=(w*Mt-C*Ct+A*ot)*(Bt=1/Bt),l[1]=(p*Ct-h*Mt-x*ot)*Bt,l[2]=(te*Ze-se*Fe+oe*$e)*Bt,l[3]=(O*Fe-P*Ze-G*$e)*Bt,l[4]=(C*Tt-v*Mt-A*Je)*Bt,l[5]=(o*Mt-p*Tt+x*Je)*Bt,l[6]=(se*Te-W*Ze-oe*ve)*Bt,l[7]=(k*Ze-O*Te+G*ve)*Bt,l[8]=(v*Ct-w*Tt+A*Ye)*Bt,l[9]=(h*Tt-o*Ct-x*Ye)*Bt,l[10]=(W*Fe-te*Te+oe*ge)*Bt,l[11]=(P*Te-k*Fe-G*ge)*Bt,l[12]=(w*Je-v*ot-C*Ye)*Bt,l[13]=(o*ot-h*Je+p*Ye)*Bt,l[14]=(te*ve-W*$e-se*ge)*Bt,l[15]=(k*$e-P*ve+O*ge)*Bt,l):null}function z(l,n,o){var h=n[0],p=n[1],x=n[2],v=n[3],w=n[4],C=n[5],A=n[6],k=n[7],P=n[8],O=n[9],G=n[10],W=n[11],te=n[12],se=n[13],oe=n[14],ge=n[15],ve=o[0],Te=o[1],$e=o[2],Fe=o[3];return l[0]=ve*h+Te*w+$e*P+Fe*te,l[1]=ve*p+Te*C+$e*O+Fe*se,l[2]=ve*x+Te*A+$e*G+Fe*oe,l[3]=ve*v+Te*k+$e*W+Fe*ge,l[4]=(ve=o[4])*h+(Te=o[5])*w+($e=o[6])*P+(Fe=o[7])*te,l[5]=ve*p+Te*C+$e*O+Fe*se,l[6]=ve*x+Te*A+$e*G+Fe*oe,l[7]=ve*v+Te*k+$e*W+Fe*ge,l[8]=(ve=o[8])*h+(Te=o[9])*w+($e=o[10])*P+(Fe=o[11])*te,l[9]=ve*p+Te*C+$e*O+Fe*se,l[10]=ve*x+Te*A+$e*G+Fe*oe,l[11]=ve*v+Te*k+$e*W+Fe*ge,l[12]=(ve=o[12])*h+(Te=o[13])*w+($e=o[14])*P+(Fe=o[15])*te,l[13]=ve*p+Te*C+$e*O+Fe*se,l[14]=ve*x+Te*A+$e*G+Fe*oe,l[15]=ve*v+Te*k+$e*W+Fe*ge,l}function J(l,n,o){var h,p,x,v,w,C,A,k,P,O,G,W,te=o[0],se=o[1],oe=o[2];return n===l?(l[12]=n[0]*te+n[4]*se+n[8]*oe+n[12],l[13]=n[1]*te+n[5]*se+n[9]*oe+n[13],l[14]=n[2]*te+n[6]*se+n[10]*oe+n[14],l[15]=n[3]*te+n[7]*se+n[11]*oe+n[15]):(p=n[1],x=n[2],v=n[3],w=n[4],C=n[5],A=n[6],k=n[7],P=n[8],O=n[9],G=n[10],W=n[11],l[0]=h=n[0],l[1]=p,l[2]=x,l[3]=v,l[4]=w,l[5]=C,l[6]=A,l[7]=k,l[8]=P,l[9]=O,l[10]=G,l[11]=W,l[12]=h*te+w*se+P*oe+n[12],l[13]=p*te+C*se+O*oe+n[13],l[14]=x*te+A*se+G*oe+n[14],l[15]=v*te+k*se+W*oe+n[15]),l}function ne(l,n,o){var h=o[0],p=o[1],x=o[2];return l[0]=n[0]*h,l[1]=n[1]*h,l[2]=n[2]*h,l[3]=n[3]*h,l[4]=n[4]*p,l[5]=n[5]*p,l[6]=n[6]*p,l[7]=n[7]*p,l[8]=n[8]*x,l[9]=n[9]*x,l[10]=n[10]*x,l[11]=n[11]*x,l[12]=n[12],l[13]=n[13],l[14]=n[14],l[15]=n[15],l}function me(l,n,o){var h=Math.sin(o),p=Math.cos(o),x=n[4],v=n[5],w=n[6],C=n[7],A=n[8],k=n[9],P=n[10],O=n[11];return n!==l&&(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[12]=n[12],l[13]=n[13],l[14]=n[14],l[15]=n[15]),l[4]=x*p+A*h,l[5]=v*p+k*h,l[6]=w*p+P*h,l[7]=C*p+O*h,l[8]=A*p-x*h,l[9]=k*p-v*h,l[10]=P*p-w*h,l[11]=O*p-C*h,l}function le(l,n,o){var h=Math.sin(o),p=Math.cos(o),x=n[0],v=n[1],w=n[2],C=n[3],A=n[8],k=n[9],P=n[10],O=n[11];return n!==l&&(l[4]=n[4],l[5]=n[5],l[6]=n[6],l[7]=n[7],l[12]=n[12],l[13]=n[13],l[14]=n[14],l[15]=n[15]),l[0]=x*p-A*h,l[1]=v*p-k*h,l[2]=w*p-P*h,l[3]=C*p-O*h,l[8]=x*h+A*p,l[9]=v*h+k*p,l[10]=w*h+P*p,l[11]=C*h+O*p,l}function ye(l,n,o){var h=Math.sin(o),p=Math.cos(o),x=n[0],v=n[1],w=n[2],C=n[3],A=n[4],k=n[5],P=n[6],O=n[7];return n!==l&&(l[8]=n[8],l[9]=n[9],l[10]=n[10],l[11]=n[11],l[12]=n[12],l[13]=n[13],l[14]=n[14],l[15]=n[15]),l[0]=x*p+A*h,l[1]=v*p+k*h,l[2]=w*p+P*h,l[3]=C*p+O*h,l[4]=A*p-x*h,l[5]=k*p-v*h,l[6]=P*p-w*h,l[7]=O*p-C*h,l}function pe(l,n){return l[0]=n[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=n[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=n[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function be(l,n,o){var h,p,x,v=o[0],w=o[1],C=o[2],A=Math.sqrt(v*v+w*w+C*C);return A<S?null:(v*=A=1/A,w*=A,C*=A,h=Math.sin(n),p=Math.cos(n),l[0]=v*v*(x=1-p)+p,l[1]=w*v*x+C*h,l[2]=C*v*x-w*h,l[3]=0,l[4]=v*w*x-C*h,l[5]=w*w*x+p,l[6]=C*w*x+v*h,l[7]=0,l[8]=v*C*x+w*h,l[9]=w*C*x-v*h,l[10]=C*C*x+p,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l)}function ke(l,n){var o=n[0],h=n[1],p=n[2],x=n[4],v=n[5],w=n[6],C=n[8],A=n[9],k=n[10];return l[0]=Math.sqrt(o*o+h*h+p*p),l[1]=Math.sqrt(x*x+v*v+w*w),l[2]=Math.sqrt(C*C+A*A+k*k),l}function Oe(l,n){var o=n[0],h=n[1],p=n[2],x=n[3],v=o+o,w=h+h,C=p+p,A=o*v,k=h*v,P=h*w,O=p*v,G=p*w,W=p*C,te=x*v,se=x*w,oe=x*C;return l[0]=1-P-W,l[1]=k+oe,l[2]=O-se,l[3]=0,l[4]=k-oe,l[5]=1-A-W,l[6]=G+te,l[7]=0,l[8]=O+se,l[9]=G-te,l[10]=1-A-P,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}var Ee=z;function qe(){var l=new E(3);return E!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l}function Qe(l){var n=new E(3);return n[0]=l[0],n[1]=l[1],n[2]=l[2],n}function gt(l){var n=l[0],o=l[1],h=l[2];return Math.sqrt(n*n+o*o+h*h)}function Xe(l,n,o){var h=new E(3);return h[0]=l,h[1]=n,h[2]=o,h}function ct(l,n,o,h){return l[0]=n,l[1]=o,l[2]=h,l}function Me(l,n,o){return l[0]=n[0]+o[0],l[1]=n[1]+o[1],l[2]=n[2]+o[2],l}function mt(l,n,o){return l[0]=n[0]-o[0],l[1]=n[1]-o[1],l[2]=n[2]-o[2],l}function Kt(l,n,o){return l[0]=n[0]*o[0],l[1]=n[1]*o[1],l[2]=n[2]*o[2],l}function it(l,n,o){return l[0]=Math.min(n[0],o[0]),l[1]=Math.min(n[1],o[1]),l[2]=Math.min(n[2],o[2]),l}function ee(l,n,o){return l[0]=Math.max(n[0],o[0]),l[1]=Math.max(n[1],o[1]),l[2]=Math.max(n[2],o[2]),l}function he(l,n,o){return l[0]=n[0]*o,l[1]=n[1]*o,l[2]=n[2]*o,l}function Se(l,n,o,h){return l[0]=n[0]+o[0]*h,l[1]=n[1]+o[1]*h,l[2]=n[2]+o[2]*h,l}function Ue(l,n){var o=n[0]-l[0],h=n[1]-l[1],p=n[2]-l[2];return Math.sqrt(o*o+h*h+p*p)}function nt(l,n){var o=n[0]-l[0],h=n[1]-l[1],p=n[2]-l[2];return o*o+h*h+p*p}function dt(l){var n=l[0],o=l[1],h=l[2];return n*n+o*o+h*h}function Vt(l,n){return l[0]=-n[0],l[1]=-n[1],l[2]=-n[2],l}function zt(l,n){var o=n[0],h=n[1],p=n[2],x=o*o+h*h+p*p;return x>0&&(x=1/Math.sqrt(x)),l[0]=n[0]*x,l[1]=n[1]*x,l[2]=n[2]*x,l}function Gt(l,n){return l[0]*n[0]+l[1]*n[1]+l[2]*n[2]}function jr(l,n,o){var h=n[0],p=n[1],x=n[2],v=o[0],w=o[1],C=o[2];return l[0]=p*C-x*w,l[1]=x*v-h*C,l[2]=h*w-p*v,l}function Wr(l,n,o,h){var p=n[0],x=n[1],v=n[2];return l[0]=p+h*(o[0]-p),l[1]=x+h*(o[1]-x),l[2]=v+h*(o[2]-v),l}function nn(l,n,o){var h=n[0],p=n[1],x=n[2],v=o[3]*h+o[7]*p+o[11]*x+o[15];return l[0]=(o[0]*h+o[4]*p+o[8]*x+o[12])/(v=v||1),l[1]=(o[1]*h+o[5]*p+o[9]*x+o[13])/v,l[2]=(o[2]*h+o[6]*p+o[10]*x+o[14])/v,l}function xn(l,n,o){var h=n[0],p=n[1],x=n[2];return l[0]=h*o[0]+p*o[3]+x*o[6],l[1]=h*o[1]+p*o[4]+x*o[7],l[2]=h*o[2]+p*o[5]+x*o[8],l}function ei(l,n,o){var h=o[0],p=o[1],x=o[2],v=o[3],w=n[0],C=n[1],A=n[2],k=p*A-x*C,P=x*w-h*A,O=h*C-p*w;return l[0]=w+v*(k+=k)+p*(O+=O)-x*(P+=P),l[1]=C+v*P+x*k-h*O,l[2]=A+v*O+h*P-p*k,l}function Dn(l){return l[0]=0,l[1]=0,l[2]=0,l}function Zr(l,n){return l[0]===n[0]&&l[1]===n[1]&&l[2]===n[2]}var Nn=mt,Pi=Kt,ft=gt;function Rt(){var l=new E(4);return E!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0,l[3]=0),l}function Wt(l,n,o){return l[0]=n[0]*o,l[1]=n[1]*o,l[2]=n[2]*o,l[3]=n[3]*o,l}function Pr(l,n){var o=n[0],h=n[1],p=n[2],x=n[3],v=o*o+h*h+p*p+x*x;return v>0&&(v=1/Math.sqrt(v)),l[0]=o*v,l[1]=h*v,l[2]=p*v,l[3]=x*v,l}function Sr(l,n,o){var h=n[0],p=n[1],x=n[2],v=n[3];return l[0]=o[0]*h+o[4]*p+o[8]*x+o[12]*v,l[1]=o[1]*h+o[5]*p+o[9]*x+o[13]*v,l[2]=o[2]*h+o[6]*p+o[10]*x+o[14]*v,l[3]=o[3]*h+o[7]*p+o[11]*x+o[15]*v,l}function Nr(){var l=new E(4);return E!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l[3]=1,l}function Kr(l){return l[0]=0,l[1]=0,l[2]=0,l[3]=1,l}function Zn(l,n,o){o*=.5;var h=n[0],p=n[1],x=n[2],v=n[3],w=Math.sin(o),C=Math.cos(o);return l[0]=h*C+v*w,l[1]=p*C+x*w,l[2]=x*C-p*w,l[3]=v*C-h*w,l}function Yn(l,n,o){o*=.5;var h=n[0],p=n[1],x=n[2],v=n[3],w=Math.sin(o),C=Math.cos(o);return l[0]=h*C-x*w,l[1]=p*C+v*w,l[2]=x*C+h*w,l[3]=v*C-p*w,l}qe(),Rt();var Zt,en,Sn,fs=Pr,ms=(Zt=qe(),en=Xe(1,0,0),Sn=Xe(0,1,0),function(l,n,o){var h=Gt(n,o);return h<-.999999?(jr(Zt,en,n),ft(Zt)<1e-6&&jr(Zt,Sn,n),zt(Zt,Zt),function(p,x,v){v*=.5;var w=Math.sin(v);p[0]=w*x[0],p[1]=w*x[1],p[2]=w*x[2],p[3]=Math.cos(v)}(l,Zt,Math.PI),l):h>.999999?(l[0]=0,l[1]=0,l[2]=0,l[3]=1,l):(jr(Zt,n,o),l[0]=Zt[0],l[1]=Zt[1],l[2]=Zt[2],l[3]=1+h,fs(l,l))});function hr(){var l=new E(2);return E!=Float32Array&&(l[0]=0,l[1]=0),l}function An(l,n){var o=new E(2);return o[0]=l,o[1]=n,o}function fi(l,n,o){return l[0]=n,l[1]=o,l}function Vi(l,n,o){return l[0]=n[0]+o[0],l[1]=n[1]+o[1],l}function $n(l,n,o){return l[0]=n[0]-o[0],l[1]=n[1]-o[1],l}function vi(l,n,o){return l[0]=n[0]*o,l[1]=n[1]*o,l}function ii(l){var n=l[0],o=l[1];return Math.sqrt(n*n+o*o)}function Ds(l,n){var o=n[0],h=n[1],p=o*o+h*h;return p>0&&(p=1/Math.sqrt(p)),l[0]=n[0]*p,l[1]=n[1]*p,l}function Ua(l,n){return l[0]*n[0]+l[1]*n[1]}Nr(),Nr(),D();var Us,Ot,Hr=$n;function hn(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}hr();var vn=function(){if(Ot)return Us;function l(n,o,h,p){this.cx=3*n,this.bx=3*(h-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(p-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=o,this.p2x=h,this.p2y=p}return Ot=1,Us=l,l.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,o){if(o===void 0&&(o=1e-6),n<0)return 0;if(n>1)return 1;for(var h=n,p=0;p<8;p++){var x=this.sampleCurveX(h)-n;if(Math.abs(x)<o)return h;var v=this.sampleCurveDerivativeX(h);if(Math.abs(v)<1e-6)break;h-=x/v}var w=0,C=1;for(h=n,p=0;p<20&&(x=this.sampleCurveX(h),!(Math.abs(x-n)<o));p++)n>x?w=h:C=h,h=.5*(C-w)+w;return h},solve:function(n,o){return this.sampleCurveY(this.solveCurveX(n,o))}},Us}(),ai=hn(vn);function At(l,n){this.x=l,this.y=n}function $i(l,n){if(Array.isArray(l)){if(!Array.isArray(n)||l.length!==n.length)return!1;for(let o=0;o<l.length;o++)if(!$i(l[o],n[o]))return!1;return!0}if(typeof l=="object"&&l!==null&&n!==null){if(typeof n!="object"||Object.keys(l).length!==Object.keys(n).length)return!1;for(const o in l)if(!$i(l[o],n[o]))return!1;return!0}return l===n}At.prototype={clone(){return new At(this.x,this.y)},add(l){return this.clone()._add(l)},sub(l){return this.clone()._sub(l)},multByPoint(l){return this.clone()._multByPoint(l)},divByPoint(l){return this.clone()._divByPoint(l)},mult(l){return this.clone()._mult(l)},div(l){return this.clone()._div(l)},rotate(l){return this.clone()._rotate(l)},rotateAround(l,n){return this.clone()._rotateAround(l,n)},matMult(l){return this.clone()._matMult(l)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(l){return this.x===l.x&&this.y===l.y},dist(l){return Math.sqrt(this.distSqr(l))},distSqr(l){const n=l.x-this.x,o=l.y-this.y;return n*n+o*o},angle(){return Math.atan2(this.y,this.x)},angleTo(l){return Math.atan2(this.y-l.y,this.x-l.x)},angleWith(l){return this.angleWithSep(l.x,l.y)},angleWithSep(l,n){return Math.atan2(this.x*n-this.y*l,this.x*l+this.y*n)},_matMult(l){const n=l[2]*this.x+l[3]*this.y;return this.x=l[0]*this.x+l[1]*this.y,this.y=n,this},_add(l){return this.x+=l.x,this.y+=l.y,this},_sub(l){return this.x-=l.x,this.y-=l.y,this},_mult(l){return this.x*=l,this.y*=l,this},_div(l){return this.x/=l,this.y/=l,this},_multByPoint(l){return this.x*=l.x,this.y*=l.y,this},_divByPoint(l){return this.x/=l.x,this.y/=l.y,this},_unit(){return this._div(this.mag()),this},_perp(){const l=this.y;return this.y=this.x,this.x=-l,this},_rotate(l){const n=Math.cos(l),o=Math.sin(l),h=o*this.x+n*this.y;return this.x=n*this.x-o*this.y,this.y=h,this},_rotateAround(l,n){const o=Math.cos(l),h=Math.sin(l),p=n.y+h*(this.x-n.x)+o*(this.y-n.y);return this.x=n.x+o*(this.x-n.x)-h*(this.y-n.y),this.y=p,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:At},At.convert=function(l){if(l instanceof At)return l;if(Array.isArray(l))return new At(+l[0],+l[1]);if(l.x!==void 0&&l.y!==void 0)return new At(+l.x,+l.y);throw new Error("Expected [x, y] or {x, y} point format")};const ha=Math.PI/180,pt=180/Math.PI;function lt(l){return l*ha}function Er(l){return l*pt}const Jr=[[0,0],[1,0],[1,1],[0,1]];function Ae(l){if(l<=0)return 0;if(l>=1)return 1;const n=l*l,o=n*l;return 4*(l<.5?o:3*(l-n)+o-.75)}function ue(l,n,o,h){const p=new ai(l,n,o,h);return function(x){return p.solve(x)}}const Z=ue(.25,.1,.25,1);function K(l,n,o){return Math.min(o,Math.max(n,l))}function ie(l,n,o){return(o=K((o-l)/(n-l),0,1))*o*(3-2*o)}function ce(l,n,o){const h=o-n,p=((l-n)%h+h)%h+n;return p===n?o:p}function _e(l,n,o){if(!l.length)return o(null,[]);let h=l.length;const p=new Array(l.length);let x=null;l.forEach((v,w)=>{n(v,(C,A)=>{C&&(x=C),p[w]=A,--h==0&&o(x,p)})})}let Ie=1;function Re(){return Ie++}function Ce(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log2(l)))}function ze(l,n){l.forEach(o=>{n[o]&&(n[o]=n[o].bind(n))})}function et(l,n,o){const h={};for(const p in l)h[p]=n.call(this,l[p],p,l);return h}function ut(l,n,o){const h={};for(const p in l)n.call(this,l[p],p,l)&&(h[p]=l[p]);return h}function Ut(l){return Array.isArray(l)?l.map(Ut):typeof l=="object"&&l?et(l,Ut):l}function Xt(l,n){for(let o=0;o<l.length;o++)if(n.indexOf(l[o])>=0)return!0;return!1}const Qt={};function ur(l){Qt[l]||(typeof console<"u"&&console.warn(l),Qt[l]=!0)}function Yr(l,n,o){return(o.y-l.y)*(n.x-l.x)>(n.y-l.y)*(o.x-l.x)}function Xr(l){let n=0;for(let o,h,p=0,x=l.length,v=x-1;p<x;v=p++)o=l[p],h=l[v],n+=(h.x-o.x)*(o.y+h.y);return n}function Rn([l,n,o]){const h=lt(n+90),p=lt(o);return{x:l*Math.cos(h)*Math.sin(p),y:l*Math.sin(h)*Math.sin(p),z:l*Math.cos(p),azimuthal:n,polar:o}}function Zi(l){return(typeof self<"u"||l!==void 0)&&typeof WorkerGlobalScope<"u"&&(l!==void 0?l:self)instanceof WorkerGlobalScope}function Rs(l){const n={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,h,p,x)=>{const v=p||x;return n[h]=!v||v.toLowerCase(),""}),n["max-age"]){const o=parseInt(n["max-age"],10);isNaN(o)?delete n["max-age"]:n["max-age"]=o}return n}let gs=null;function is(l,n){return[l[4*n],l[4*n+1],l[4*n+2],l[4*n+3]]}function yi(l,n,o,h){for(;n<o;){const p=n+o>>1;l[p]<h?n=p+1:o=p}return n}function Un(l,n,o,h){for(;n<o;){const p=n+o>>1;l[p]<=h?n=p+1:o=p}return n}function ls(l){return l>0?1/(1.001-l):1+l}function Ts(l){return l>0?1-1/(1.001-l):-l}function Di(l,n,o){return(l-n.min)*(o.max-o.min)/(n.max-n.min)+o.min}const cs={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!cs.API_URL)return null;try{const l=new URL(cs.API_URL);return l.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":l.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function wa(l){return cs.API_URL_REGEX.test(l)}function ro(l){return cs.API_SPRITE_REGEX.test(l)}let Ko,au,He,Et,lr,qr;function oi(){return Ko==null&&(Ko=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Ko}const Ti={now:()=>Et!==void 0?Et:performance.now(),setNow(l){Et=l},restoreNow(){Et=void 0},frame(l){const n=requestAnimationFrame(l);return{cancel:()=>cancelAnimationFrame(n)}},getImageData(l,n=0){const{width:o,height:h}=l;lr||(lr=document.createElement("canvas"));const p=lr.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(o>lr.width||h>lr.height)&&(lr.width=o,lr.height=h),p.clearRect(-n,-n,o+2*n,h+2*n),p.drawImage(l,0,0,o,h),p.getImageData(-n,-n,o+2*n,h+2*n)},resolveURL:l=>(au||(au=document.createElement("a")),au.href=l,au.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(He==null&&(He=window.matchMedia("(prefers-reduced-motion: reduce)")),He.matches)},hasCanvasFingerprintNoise(){if(qr!==void 0)return qr;if(!oi())return qr=!1,!1;const l=new OffscreenCanvas(85,1),n=l.getContext("2d",{willReadFrequently:!0});let o=0;for(let p=0;p<l.width;++p)n.fillStyle=`rgba(${o++},${o++},${o++}, 255)`,n.fillRect(p,0,1,1);const h=n.getImageData(0,0,l.width,l.height);o=0;for(let p=0;p<h.data.length;++p)if(p%4!=3&&o++!==h.data[p])return qr=!0,!0;return qr=!1,!1}};function qi(l,n){const o=l.indexOf("?");if(o<0)return`${l}?${new URLSearchParams(n).toString()}`;const h=new URLSearchParams(l.slice(o));for(const p in n)h.set(p,n[p]);return`${l.slice(0,o)}?${h.toString()}`}function Ms(l,n={persistentParams:[]}){const o=l.indexOf("?");if(o<0)return l;const h=new URLSearchParams,p=new URLSearchParams(l.slice(o));for(const v of n.persistentParams){const w=p.get(v);w&&h.set(v,w)}const x=h.toString();return`${l.slice(0,o)}${x.length>0?`?${x}`:""}`}const ba="mapbox-tiles";let Da=500,Hs=50;const no=["language","worldview","jobid"];let Ea,Fi;function Va(){try{return caches}catch{}}function Jo(){const l=Va();l&&Ea==null&&(Ea=l.open(ba))}let nc=1/0;const Es={supported:!1,testSupport:function(l){!ta&&Bo&&(kd?Af(l):Sa=l)}};let Sa,Bo,ta=!1,kd=!1;const Qo=typeof self<"u"?self:{};function Af(l){const n=l.createTexture();l.bindTexture(l.TEXTURE_2D,n);try{if(l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,Bo),l.isContextLost())return;Es.supported=!0}catch{}l.deleteTexture(n),ta=!0}Qo.document&&(Bo=Qo.document.createElement("img"),Bo.onload=function(){Sa&&Af(Sa),Sa=null,kd=!0},Bo.onerror=function(){ta=!0,Sa=null},Bo.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const yh={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(yh);class wh extends Error{constructor(n,o,h){o===401&&wa(h)&&(n+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(n),this.status=o,this.url=h}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Jv=Zi()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Mm=function(l,n){if(!(/^file:/.test(o=l.url)||/^file:/.test(Jv())&&!/^\w+:/.test(o))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(h,p){const x=new AbortController,v=new Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:Jv(),referrerPolicy:h.referrerPolicy,signal:x.signal});let w=!1,C=!1;const A=(k=v.url).indexOf("sku=")>0&&wa(k);var k;h.type==="json"&&v.headers.set("Accept","application/json");const P=(G,W,te)=>{if(C)return;if(G&&G.message!=="SecurityError"&&ur(G.toString()),W&&te)return O(W);const se=Date.now();fetch(v).then(oe=>{if(oe.ok){const ge=A?oe.clone():null;return O(oe,ge,se)}return p(new wh(oe.statusText,oe.status,h.url))}).catch(oe=>{oe.name!=="AbortError"&&p(new Error(`${oe.message} ${h.url}`))})},O=(G,W,te)=>{(h.type==="arrayBuffer"?G.arrayBuffer():h.type==="json"?G.json():G.text()).then(se=>{C||(W&&te&&function(oe,ge,ve){if(Jo(),Ea==null)return;const Te=Rs(ge.headers.get("Cache-Control")||"");if(Te["no-store"])return;const $e={status:ge.status,statusText:ge.statusText,headers:new Headers};ge.headers.forEach((Ye,Je)=>$e.headers.set(Je,Ye)),Te["max-age"]&&$e.headers.set("Expires",new Date(ve+1e3*Te["max-age"]).toUTCString());const Fe=$e.headers.get("Expires");if(!Fe||new Date(Fe).getTime()-ve<42e4)return;let Ze=Ms(oe.url,{persistentParams:no});if(ge.status===206){const Ye=oe.headers.get("Range");if(!Ye)return;$e.status=200,Ze=qi(Ze,{range:Ye})}(function(Ye,Je){if(Fi===void 0)try{new Response(new ReadableStream),Fi=!0}catch{Fi=!1}Fi?Je(Ye.body):Ye.blob().then(Je).catch(Tt=>ur(Tt.message))})(ge,Ye=>{const Je=new Response((Tt=ge.status)!==200&&Tt!==404&&[101,103,204,205,304].includes(Tt)?null:Ye,$e);var Tt;Jo(),Ea!=null&&Ea.then(ot=>ot.put(Ze,Je)).catch(ot=>ur(ot.message))})}(v,W,te),w=!0,p(null,se,G.headers))}).catch(se=>{C||p(new Error(se.message))})};return A?function(G,W){if(Jo(),Ea==null)return W(null);Ea.then(te=>{let se=Ms(G.url,{persistentParams:no});const oe=G.headers.get("Range");oe&&(se=qi(se,{range:oe})),te.match(se).then(ge=>{const ve=function(Te){if(!Te)return!1;const $e=new Date(Te.headers.get("Expires")||0),Fe=Rs(Te.headers.get("Cache-Control")||"");return Number($e)>Date.now()&&!Fe["no-cache"]}(ge);te.delete(se).catch(W),ve&&te.put(se,ge.clone()).catch(W),W(null,ge,ve)}).catch(W)}).catch(W)}(v,P):P(null,null),{cancel:()=>{C=!0,w||x.abort()}}}(l,n);if(Zi(self)&&self.worker.actor)return self.worker.actor.send("getResource",l,n,void 0,!0)}var o;return function(h,p){const x=new XMLHttpRequest;x.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(x.responseType="arraybuffer");for(const v in h.headers)x.setRequestHeader(v,h.headers[v]);return h.type==="json"&&(x.responseType="text",x.setRequestHeader("Accept","application/json")),x.withCredentials=h.credentials==="include",x.onerror=()=>{p(new Error(x.statusText))},x.onload=()=>{if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let v=x.response;if(h.type==="json")try{v=JSON.parse(x.response)}catch(C){return p(C)}const w=new Headers;x.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(C=>{const A=C.split(": "),k=A.shift(),P=A.join(": ");w.append(k,P)}),p(null,v,w)}else p(new wh(x.statusText,x.status,h.url))},x.send(h.body),{cancel:()=>x.abort()}}(l,n)},jf=function(l,n){return Mm(Object.assign(l,{type:"arrayBuffer"}),n)};function Ni(l){const n=document.createElement("a");return n.href=l,n.protocol===location.protocol&&n.host===location.host}const Qv="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Om,Fm;Om=[],Fm=0;const ey=function(l,n){if(Es.supported&&(l.headers||(l.headers={}),l.headers.accept="image/webp,*/*"),Fm>=cs.MAX_PARALLEL_IMAGE_REQUESTS){const x={requestParameters:l,callback:n,cancelled:!1,cancel(){this.cancelled=!0}};return Om.push(x),x}Fm++;let o=!1;const h=()=>{if(!o)for(o=!0,Fm--;Om.length&&Fm<cs.MAX_PARALLEL_IMAGE_REQUESTS;){const x=Om.shift(),{requestParameters:v,callback:w,cancelled:C}=x;C||(x.cancel=ey(v,w).cancel)}},p=jf(l,(x,v,w)=>{h(),x?n(x):v&&(self.createImageBitmap?function(C,A){const k=new Blob([new Uint8Array(C)],{type:"image/png"});createImageBitmap(k).then(P=>{A(null,P)}).catch(P=>{A(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(v,(C,A)=>n(C,A,w)):function(C,A){const k=new Image;k.onload=()=>{A(null,k),URL.revokeObjectURL(k.src),k.onload=null,requestAnimationFrame(()=>{k.src=Qv})},k.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const P=new Blob([new Uint8Array(C)],{type:"image/png"});k.src=C.byteLength?URL.createObjectURL(P):Qv}(v,(C,A)=>n(C,A,w)))});return{cancel:()=>{p.cancel(),h()}}};var Lm,zm,Bm,bh={exports:{}},o2={exports:{}},O_={exports:{}},kA=function(){if(Bm)return bh.exports;Bm=1;var l=(Lm||(Lm=1,o2.exports=function(o,h){var p,x,v,w,C,A,k,P;for(x=o.length-(p=3&o.length),v=h,C=3432918353,A=461845907,P=0;P<x;)k=255&o.charCodeAt(P)|(255&o.charCodeAt(++P))<<8|(255&o.charCodeAt(++P))<<16|(255&o.charCodeAt(++P))<<24,++P,v=27492+(65535&(w=5*(65535&(v=(v^=k=(65535&(k=(k=(65535&k)*C+(((k>>>16)*C&65535)<<16)&4294967295)<<15|k>>>17))*A+(((k>>>16)*A&65535)<<16)&4294967295)<<13|v>>>19))+((5*(v>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(k=0,p){case 3:k^=(255&o.charCodeAt(P+2))<<16;case 2:k^=(255&o.charCodeAt(P+1))<<8;case 1:v^=k=(65535&(k=(k=(65535&(k^=255&o.charCodeAt(P)))*C+(((k>>>16)*C&65535)<<16)&4294967295)<<15|k>>>17))*A+(((k>>>16)*A&65535)<<16)&4294967295}return v^=o.length,v=2246822507*(65535&(v^=v>>>16))+((2246822507*(v>>>16)&65535)<<16)&4294967295,v=3266489909*(65535&(v^=v>>>13))+((3266489909*(v>>>16)&65535)<<16)&4294967295,(v^=v>>>16)>>>0}),o2.exports),n=(zm||(zm=1,O_.exports=function(o,h){for(var p,x=o.length,v=h^x,w=0;x>=4;)p=1540483477*(65535&(p=255&o.charCodeAt(w)|(255&o.charCodeAt(++w))<<8|(255&o.charCodeAt(++w))<<16|(255&o.charCodeAt(++w))<<24))+((1540483477*(p>>>16)&65535)<<16),v=1540483477*(65535&v)+((1540483477*(v>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),x-=4,++w;switch(x){case 3:v^=(255&o.charCodeAt(w+2))<<16;case 2:v^=(255&o.charCodeAt(w+1))<<8;case 1:v=1540483477*(65535&(v^=255&o.charCodeAt(w)))+((1540483477*(v>>>16)&65535)<<16)}return v=1540483477*(65535&(v^=v>>>13))+((1540483477*(v>>>16)&65535)<<16),(v^=v>>>15)>>>0}),O_.exports);return bh.exports=l,bh.exports.murmur3=l,bh.exports.murmur2=n,bh.exports}(),Um=hn(kA);class jl{constructor(n,...o){Object.assign(this,o[0]||{}),this.type=n}}class Vm extends jl{constructor(n,o={}){super("error",Object.assign({error:n},o))}}function If(l,n,o){o[l]&&o[l].indexOf(n)!==-1||(o[l]=o[l]||[],o[l].push(n))}function $m(l,n,o){if(o&&o[l]){const h=o[l].indexOf(n);h!==-1&&o[l].splice(h,1)}}class Ou{on(n,o){return this._listeners=this._listeners||{},If(n,o,this._listeners),this}off(n,o){return $m(n,o,this._listeners),$m(n,o,this._oneTimeListeners),this}once(n,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},If(n,o,this._oneTimeListeners),this):new Promise(h=>{this.once(n,h)})}fire(n,o){const h=typeof n=="string"?new jl(n,o):n,p=h.type;if(this.listens(p)){h.target=this;const x=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const C of x)C.call(this,h);const v=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const C of v)$m(p,C,this._oneTimeListeners),C.call(this,h);const w=this._eventedParent;if(w){const C=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(h,C),w.fire(h)}}else h instanceof Vm&&console.error(h.error);return this}listens(n){return!!(this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n))}setEventedParent(n,o){return this._eventedParent=n,this._eventedParentData=o,this}}class Ra{constructor(n){typeof n=="string"?this.name=n:(this.name=n.name,this.iconsetId=n.iconsetId)}static from(n){return new Ra(n)}static toString(n){return n.iconsetId?`${n.name}${n.iconsetId}`:n.name}static parse(n){const[o,h]=n.split("");return new Ra({name:o,iconsetId:h})}static isEqual(n,o){return n.name===o.name&&n.iconsetId===o.iconsetId}toString(){return Ra.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var ty,ry={},ny=function(){if(ty)return ry;ty=1;var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(x){return(x=Math.round(x))<0?0:x>255?255:x}function o(x){return n(x[x.length-1]==="%"?parseFloat(x)/100*255:parseInt(x))}function h(x){return(v=x[x.length-1]==="%"?parseFloat(x)/100:parseFloat(x))<0?0:v>1?1:v;var v}function p(x,v,w){return w<0?w+=1:w>1&&(w-=1),6*w<1?x+(v-x)*w*6:2*w<1?v:3*w<2?x+(v-x)*(2/3-w)*6:x}try{ry.parseCSSColor=function(x){var v,w=x.replace(/ /g,"").toLowerCase();if(w in l)return l[w].slice();if(w[0]==="#")return w.length===4?(v=parseInt(w.substr(1),16))>=0&&v<=4095?[(3840&v)>>4|(3840&v)>>8,240&v|(240&v)>>4,15&v|(15&v)<<4,1]:null:w.length===7&&(v=parseInt(w.substr(1),16))>=0&&v<=16777215?[(16711680&v)>>16,(65280&v)>>8,255&v,1]:null;var C=w.indexOf("("),A=w.indexOf(")");if(C!==-1&&A+1===w.length){var k=w.substr(0,C),P=w.substr(C+1,A-(C+1)).split(","),O=1;switch(k){case"rgba":if(P.length!==4)return null;O=h(P.pop());case"rgb":return P.length!==3?null:[o(P[0]),o(P[1]),o(P[2]),O];case"hsla":if(P.length!==4)return null;O=h(P.pop());case"hsl":if(P.length!==3)return null;var G=(parseFloat(P[0])%360+360)%360/360,W=h(P[1]),te=h(P[2]),se=te<=.5?te*(W+1):te+W-te*W,oe=2*te-se;return[n(255*p(oe,se,G+1/3)),n(255*p(oe,se,G)),n(255*p(oe,se,G-1/3)),O];default:return null}}return null}}catch{}return ry}();class Li{constructor(n,o,h,p=1){this.r=n,this.g=o,this.b=h,this.a=p}static parse(n){if(!n)return;if(n instanceof Li)return n;if(typeof n!="string")return;const o=ny.parseCSSColor(n);return o?new Li(o[0]/255,o[1]/255,o[2]/255,o[3]):void 0}toString(){const[n,o,h,p]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*n)},${Math.round(255*o)},${Math.round(255*h)},${p})`}toNonPremultipliedRenderColor(n){const{r:o,g:h,b:p,a:x}=this;return new l2(n,o,h,p,x)}toPremultipliedRenderColor(n){const{r:o,g:h,b:p,a:x}=this;return new c2(n,o*x,h*x,p*x,x)}clone(){return new Li(this.r,this.g,this.b,this.a)}}class iy{constructor(n,o,h,p,x,v=!1){if(this.premultiplied=!1,this.premultiplied=v,n){const w=n.image.height,C=w*w;this.premultiplied?(o=x===0?0:o/x*(w-1),h=x===0?0:h/x*(w-1),p=x===0?0:p/x*(w-1)):(o*=w-1,h*=w-1,p*=w-1);const A=Math.floor(o),k=Math.floor(h),P=Math.floor(p),O=Math.ceil(o),G=Math.ceil(h),W=Math.ceil(p),te=o-A,se=h-k,oe=p-P,ge=n.image.data,ve=4*(A+k*C+P*w),Te=4*(A+k*C+W*w),$e=4*(A+G*C+P*w),Fe=4*(A+G*C+W*w),Ze=4*(O+k*C+P*w),Ye=4*(O+k*C+W*w),Je=4*(O+G*C+P*w),Tt=4*(O+G*C+W*w);if(ve<0||Tt>=ge.length)throw new Error("out of range");this.r=fn(fn(fn(ge[ve],ge[Te],oe),fn(ge[$e],ge[Fe],oe),se),fn(fn(ge[Ze],ge[Ye],oe),fn(ge[Je],ge[Tt],oe),se),te)/255*(this.premultiplied?x:1),this.g=fn(fn(fn(ge[ve+1],ge[Te+1],oe),fn(ge[$e+1],ge[Fe+1],oe),se),fn(fn(ge[Ze+1],ge[Ye+1],oe),fn(ge[Je+1],ge[Tt+1],oe),se),te)/255*(this.premultiplied?x:1),this.b=fn(fn(fn(ge[ve+2],ge[Te+2],oe),fn(ge[$e+2],ge[Fe+2],oe),se),fn(fn(ge[Ze+2],ge[Ye+2],oe),fn(ge[Je+2],ge[Tt+2],oe),se),te)/255*(this.premultiplied?x:1),this.a=x}else this.r=o,this.g=h,this.b=p,this.a=x}toArray(){const{r:n,g:o,b:h,a:p}=this;return[255*n,255*o,255*h,p]}toHslaArray(){let{r:n,g:o,b:h,a:p}=this;if(this.premultiplied){if(p===0)return[0,0,0,0];const W=1/p;n*=W,o*=W,h*=W}const x=Math.min(Math.max(n,0),1),v=Math.min(Math.max(o,0),1),w=Math.min(Math.max(h,0),1),C=Math.min(x,v,w),A=Math.max(x,v,w),k=A-C,P=.5*(C+A);if(k===0)return[0,0,100*P,p];const O=P>.5?k/(2-A-C):k/(A+C);let G;switch(A){case x:G=60*((v-w)/k+(v<w?6:0));break;case v:G=60*((w-x)/k+2);break;default:G=60*((x-v)/k+4)}return[G,100*O,100*P,p]}toArray01(){const{r:n,g:o,b:h,a:p}=this;return[n,o,h,p]}toArray01Scaled(n){const{r:o,g:h,b:p}=this;return[o*n,h*n,p*n]}toArray01Linear(){const{r:n,g:o,b:h,a:p}=this;return[Math.pow(n,2.2),Math.pow(o,2.2),Math.pow(h,2.2),p]}}class l2 extends iy{constructor(n,o,h,p,x){super(n,o,h,p,x,!1)}}class c2 extends iy{constructor(n,o,h,p,x){super(n,o,h,p,x,!0)}}function fn(l,n,o){return l*(1-o)+n*o}function qm(l,n,o){return l.map((h,p)=>fn(h,n[p],o))}Li.black=new Li(0,0,0,1),Li.white=new Li(1,1,1,1),Li.transparent=new Li(0,0,0,0),Li.red=new Li(1,0,0,1),Li.blue=new Li(0,0,1,1);var Fu=Object.freeze({__proto__:null,array:qm,color:function(l,n,o){return new Li(fn(l.r,n.r,o),fn(l.g,n.g,o),fn(l.b,n.b,o),fn(l.a,n.a,o))},number:fn});class ic extends Error{constructor(n,o){super(o),this.message=o,this.key=n}}class sc{constructor(n,o=[]){this.parent=n,this.bindings={};for(const[h,p]of o)this.bindings[h]=p}concat(n){return new sc(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const Nf={kind:"null"},Gr={kind:"number"},wi={kind:"string"},Ri={kind:"boolean"},ml={kind:"color"},kf={kind:"object"},Gi={kind:"value"},Gm={kind:"collator"},Sh={kind:"formatted"},Wm={kind:"resolvedImage"};function io(l,n){return{kind:"array",itemType:l,N:n}}function ja(l){if(l.kind==="array"){const n=ja(l.itemType);return typeof l.N=="number"?`array<${n}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${n}>`}return l.kind}const PA=[Nf,Gr,wi,Ri,ml,Sh,kf,io(Gi),Wm];function Hm(l,n){if(n.kind==="error")return null;if(l.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!Hm(l.itemType,n.itemType))&&(typeof l.N!="number"||l.N===n.N))return null}else{if(l.kind===n.kind)return null;if(l.kind==="value"){for(const o of PA)if(!Hm(o,n))return null}}return`Expected ${ja(l)} but found ${ja(n)} instead.`}function sy(l,n){return n.some(o=>o.kind===l.kind)}function Zm(l,n){return n.some(o=>o==="null"?l===null:o==="array"?Array.isArray(l):o==="object"?l&&!Array.isArray(l)&&typeof l=="object":o===typeof l)}function F_(l,n){return l.kind==="array"&&n.kind==="array"?l.N===n.N&&F_(l.itemType,n.itemType):l.kind===n.kind}class ay{constructor(n,o,h){this.sensitivity=n?o?"variant":"case":o?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,o){return this.collator.compare(n,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Xm{constructor(n,o,h,p,x){this.text=n.normalize?n.normalize():n,this.image=o,this.scale=h,this.fontStack=p,this.textColor=x}}class Ha{constructor(n){this.sections=n}static fromString(n){return new Ha([new Xm(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||!!n.image&&n.image.hasPrimary())}static factory(n){return n instanceof Ha?n:Ha.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}serialize(){const n=["format"];for(const o of this.sections){if(o.image){const p=o.image.getPrimary().id.toString();n.push(["image",p]);continue}n.push(o.text);const h={};o.fontStack&&(h["text-font"]=["literal",o.fontStack.split(",")]),o.scale&&(h["font-scale"]=o.scale),o.textColor&&(h["text-color"]=["rgba"].concat(o.textColor.toNonPremultipliedRenderColor(null).toArray())),n.push(h)}return n}}class Lu{constructor(n,o={}){if(this.id=Ra.from(n),this.options=Object.assign({},o),o.transform){const{a:h,b:p,c:x,d:v,e:w,f:C}=o.transform;this.options.transform=new DOMMatrix([h,p,x,v,w,C])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:n,b:o,c:h,d:p,e:x,f:v}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:n,b:o,c:h,d:p,e:x,f:v}})}static parse(n){let o,h,p,x;try{({name:o,iconsetId:h,params:p,transform:x}=JSON.parse(n)||{})}catch{return null}if(!o)return null;const{a:v,b:w,c:C,d:A,e:k,f:P}=x||{};return new Lu({name:o,iconsetId:h},{params:p,transform:new DOMMatrix([v,w,C,A,k,P])})}scaleSelf(n,o){return this.options.transform.scaleSelf(n,o),this}}class el{constructor(n,o,h,p,x=!1){this.primaryId=Ra.from(n),this.primaryOptions=o,h&&(this.secondaryId=Ra.from(h)),this.secondaryOptions=p,this.available=x}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Lu(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Lu(this.secondaryId,this.secondaryOptions):null}static from(n){return typeof n=="string"?el.build({name:n}):n}static build(n,o,h,p){return!n||typeof n=="object"&&!("name"in n)?null:new el(n,h,o,p)}}function L_(l,n,o,h){return typeof l=="number"&&l>=0&&l<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof o=="number"&&o>=0&&o<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[l,n,o,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[l,n,o,h]:[l,n,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Pf(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof Li||l instanceof ay||l instanceof Ha||l instanceof el)return!0;if(Array.isArray(l)){for(const n of l)if(!Pf(n))return!1;return!0}if(typeof l=="object"){for(const n in l)if(!Pf(l[n]))return!1;return!0}return!1}function $a(l){if(l===null)return Nf;if(typeof l=="string")return wi;if(typeof l=="boolean")return Ri;if(typeof l=="number")return Gr;if(l instanceof Li)return ml;if(l instanceof ay)return Gm;if(l instanceof Ha)return Sh;if(l instanceof el)return Wm;if(Array.isArray(l)){const n=l.length;let o;for(const h of l){const p=$a(h);if(o){if(o===p)continue;o=Gi;break}o=p}return io(o||Gi,n)}return kf}function ou(l){const n=typeof l;return l===null?"":n==="string"||n==="number"||n==="boolean"?String(l):l instanceof Ha||l instanceof el||l instanceof Li?l.toString():JSON.stringify(l)}class zu{constructor(n,o){this.type=n,this.value=o}static parse(n,o){if(n.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!Pf(n[1]))return o.error("invalid value");const h=n[1];let p=$a(h);const x=o.expectedType;return p.kind!=="array"||p.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(p=x),new zu(p,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Li?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Ha?this.value.serialize():this.value}}class oa{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}}const Vn={string:wi,number:Gr,boolean:Ri,object:kf};class Rr{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");let h,p=1;const x=n[0];if(x==="array"){let w,C;if(n.length>2){const A=n[1];if(typeof A!="string"||!(A in Vn)||A==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);w=Vn[A],p++}else w=Gi;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return o.error('The length argument to "array" must be a positive integer literal',2);C=n[2],p++}h=io(w,C)}else h=Vn[x];const v=[];for(;p<n.length;p++){const w=o.parse(n[p],p,Gi);if(!w)return null;v.push(w)}return new Rr(h,v)}evaluate(n){for(let o=0;o<this.args.length;o++){const h=this.args[o].evaluate(n);if(!Hm(this.type,$a(h)))return h;if(o===this.args.length-1)throw new oa(`The expression ${JSON.stringify(this.args[o].serialize())} evaluated to ${ja($a(h))} but was expected to be of type ${ja(this.type)}.`)}return null}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=this.type,o=[n.kind];if(n.kind==="array"){const h=n.itemType;if(h.kind==="string"||h.kind==="number"||h.kind==="boolean"){o.push(h.kind);const p=n.N;(typeof p=="number"||this.args.length>1)&&o.push(p)}}return o.concat(this.args.map(h=>h.serialize()))}}class Th{constructor(n){this.type=Sh,this.sections=n}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");const h=n[1];if(!Array.isArray(h)&&typeof h=="object")return o.error("First argument must be an image or text section.");const p=[];let x=!1;for(let v=1;v<=n.length-1;++v){const w=n[v];if(x&&typeof w=="object"&&!Array.isArray(w)){x=!1;let C=null;if(w["font-scale"]&&(C=o.parseObjectValue(w["font-scale"],v,"font-scale",Gr),!C))return null;let A=null;if(w["text-font"]&&(A=o.parseObjectValue(w["text-font"],v,"text-font",io(wi)),!A))return null;let k=null;if(w["text-color"]&&(k=o.parseObjectValue(w["text-color"],v,"text-color",ml),!k))return null;const P=p[p.length-1];P.scale=C,P.font=A,P.textColor=k}else{const C=o.parse(n[v],v,Gi);if(!C)return null;const A=C.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,p.push({content:C,scale:null,font:null,textColor:null})}}return new Th(p)}evaluate(n){return new Ha(this.sections.map(o=>{const h=o.content.evaluate(n);return F_($a(h),Wm)?new Xm("",h,null,null,null):new Xm(ou(h),null,o.scale?o.scale.evaluate(n):null,o.font?o.font.evaluate(n).join(","):null,o.textColor?o.textColor.evaluate(n):null)}))}eachChild(n){for(const o of this.sections)n(o.content),o.scale&&n(o.scale),o.font&&n(o.font),o.textColor&&n(o.textColor)}outputDefined(){return!1}serialize(){const n=["format"];for(const o of this.sections){n.push(o.content.serialize());const h={};o.scale&&(h["font-scale"]=o.scale.serialize()),o.font&&(h["text-font"]=o.font.serialize()),o.textColor&&(h["text-color"]=o.textColor.serialize()),n.push(h)}return n}}class Cn{constructor(n,o,h,p){this._imageWarnHistory={},this.type=Wm,this.namePrimary=n,this.nameSecondary=o,h&&(this.paramsPrimary=h.params,this.iconsetIdPrimary=h.iconset?h.iconset.id:void 0),p&&(this.paramsSecondary=p.params,this.iconsetIdSecondary=p.iconset?p.iconset.id:void 0)}static parse(n,o){if(n.length<2)return o.error("Expected two or more arguments.");let h=1;const p=[];function x(){if(h<n.length){const w=o.parse(n[h],h++,wi);return w?(p.push({image:w,options:{}}),!0):(o.error(p.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function v(){if(h<n.length){const C=n[h];if((w=C)===null||typeof w!="object"||Array.isArray(w))return!0;const A=C.params,k=C.iconset,P=o.concat(h);if(!A&&!k)return h++,!0;if(A){if(typeof A!="object"||A.constructor!==Object)return P.error('Image options "params" should be an object'),!1;const O={},G=P.concat(void 0,"params");for(const W in A){if(!W)return G.error("Image parameter name should be non-empty"),!1;const te=G.concat(void 0,W).parse(A[W],void 0,ml,void 0,{typeAnnotation:"coerce"});if(!te)return!1;O[W]=te}p[p.length-1].options.params=O}if(k){if(typeof k!="object"||k.constructor!==Object)return P.error('Image options "iconset" should be an object'),!1;if(!k.id)return P.error('Image options "iconset" should have an "id" property'),!1;p[p.length-1].options.iconset=k}return h++,!0}var w;return!0}for(let w=0;w<2;w++)if(!x()||!v())return;return new Cn(p[0].image,p[1]?p[1].image:void 0,p[0].options,p[1]?p[1].options:void 0)}evaluateParams(n,o){const h={};if(o){for(const p in o)if(o[p])try{h[p]=o[p].evaluate(n)}catch{continue}if(Object.keys(h).length!==0)return{params:h}}}evaluate(n){const o={name:this.namePrimary.evaluate(n),iconsetId:this.iconsetIdPrimary},h=this.nameSecondary?{name:this.nameSecondary.evaluate(n),iconsetId:this.iconsetIdSecondary}:void 0,p=el.build(o,h,this.paramsPrimary?this.evaluateParams(n,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(n,this.paramsSecondary):void 0);if(p&&n.availableImages){const x=p.getPrimary().id;if(p.available=n.availableImages.some(v=>Ra.isEqual(v,x)),p.available){const v=p.getSecondary()?p.getSecondary().id:null;v&&(p.available=n.availableImages.some(w=>Ra.isEqual(w,v)))}}return p}eachChild(n){if(n(this.namePrimary),this.paramsPrimary)for(const o in this.paramsPrimary)this.paramsPrimary[o]&&n(this.paramsPrimary[o]);if(this.nameSecondary&&(n(this.nameSecondary),this.paramsSecondary))for(const o in this.paramsSecondary)this.paramsSecondary[o]&&n(this.paramsSecondary[o])}outputDefined(){return!1}serializeOptions(n,o){const h={};if(o&&(h.iconset={id:o}),n){h.params={};for(const p in n)n[p]&&(h.params[p]=n[p].serialize())}return Object.keys(h).length>0?h:void 0}serialize(){const n=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const o=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);o&&n.push(o)}if(this.nameSecondary&&(n.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const o=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);o&&n.push(o)}return n}}function Df(l){return yn(l)?"string":Ym(l)?"number":B_(l)?"boolean":Array.isArray(l)?"array":l===null?"null":z_(l)?"object":typeof l}function z_(l){return l!=null&&!Array.isArray(l)&&typeof l!="function"&&!(l instanceof String||l instanceof Number||l instanceof Boolean)&&typeof l=="object"}function yn(l){return typeof l=="string"||l instanceof String}function Ym(l){return typeof l=="number"||l instanceof Number}function B_(l){return typeof l=="boolean"||l instanceof Boolean}const u2={"to-boolean":Ri,"to-color":ml,"to-number":Gr,"to-string":wi};class lu{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");const h=n[0],p=[];let x=Nf;if(h==="to-array"){if(!Array.isArray(n[1]))return null;const v=n[1].length;if(o.expectedType){if(o.expectedType.kind!=="array")return o.error(`Expected ${o.expectedType.kind} but found array.`);x=io(o.expectedType.itemType,v)}else{if(!(v>0&&Pf(n[1][0])))return null;x=io($a(n[1][0]),v)}for(let w=0;w<v;w++){const C=n[1][w];let A;if(Array.isArray(C))A=o.parse(C,void 0,x.itemType);else{const k=Df(C);if(k!==x.itemType.kind)return o.error(`Expected ${x.itemType.kind} but found ${k}.`);A=o.registry.literal.parse(["literal",C===void 0?null:C],o)}if(!A)return null;p.push(A)}}else{if((h==="to-boolean"||h==="to-string")&&n.length!==2)return o.error("Expected one argument.");x=u2[h];for(let v=1;v<n.length;v++){const w=o.parse(n[v],v,Gi);if(!w)return null;p.push(w)}}return new lu(x,p)}evaluate(n){if(this.type.kind==="boolean")return!!this.args[0].evaluate(n);if(this.type.kind==="color"){let o,h;for(const p of this.args){if(o=p.evaluate(n),h=null,o instanceof Li)return o;if(typeof o=="string"){const x=n.parseColor(o);if(x)return x}else if(Array.isArray(o)&&(h=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:L_(o[0],o[1],o[2],o[3]),!h))return new Li(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new oa(h||`Could not parse color from value '${typeof o=="string"?o:String(JSON.stringify(o))}'`)}if(this.type.kind==="number"){let o=null;for(const h of this.args){if(o=h.evaluate(n),o===null)return 0;const p=Number(o);if(!isNaN(p))return p}throw new oa(`Could not convert ${JSON.stringify(o)} to number.`)}return this.type.kind==="formatted"?Ha.fromString(ou(this.args[0].evaluate(n))):this.type.kind==="resolvedImage"?el.build(ou(this.args[0].evaluate(n))):this.type.kind==="array"?this.args.map(o=>o.evaluate(n)):ou(this.args[0].evaluate(n))}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Th([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Cn(this.args[0]).serialize();const n=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(o=>{n.push(o.serialize())}),n}}const U_=["Unknown","Point","LineString","Polygon"];class so{constructor(n,o,h){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=n,this.options=o,this.iconImageUseTheme=h}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?U_[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(n){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:h,y:p}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(h*o-n[0])+this.featureDistanceData.bearing[1]*(p*o-n[1])}return 0}parseColor(n){let o=this._parseColorCache[n];return o||(o=this._parseColorCache[n]=Li.parse(n)),o}getConfig(n){return this.options?this.options.get(n):null}}class ko{constructor(n,o,h,p,x){this.name=n,this.type=o,this._evaluate=h,this.args=p,this._overloadIndex=x}evaluate(n){if(!this._evaluate){const o=ko.definitions[this.name];this._evaluate=Array.isArray(o)?o[2]:o.overloads[this._overloadIndex][1]}return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(n=>n.serialize()))}static parse(n,o){const h=n[0],p=ko.definitions[h];if(!p)return o.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const x=Array.isArray(p)?p[0]:p.type,v=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,w=[];let C=null,A=-1;for(const[k,P]of v){if(Array.isArray(k)&&k.length!==n.length-1)continue;w.push(k),A++,C=new K_(o.registry,o.path,null,o.scope,void 0,o._scope,o.options,o.iconImageUseTheme);const O=[];let G=!1;for(let W=1;W<n.length;W++){const te=n[W],se=Array.isArray(k)?k[W-1]:k.type,oe=C.parse(te,1+O.length,se);if(!oe){G=!0;break}O.push(oe)}if(!G)if(Array.isArray(k)&&k.length!==O.length)C.error(`Expected ${k.length} arguments, but found ${O.length} instead.`);else{for(let W=0;W<O.length;W++){const te=Array.isArray(k)?k[W]:k.type,se=O[W];C.concat(W+1).checkSubtype(te,se.type)}if(C.errors.length===0)return new ko(h,x,P,O,A)}}if(w.length===1)o.errors.push(...C.errors);else{const k=(w.length?w:v.map(([O])=>O)).map(Eh).join(" | "),P=[];for(let O=1;O<n.length;O++){const G=o.parse(n[O],1+P.length);if(!G)return null;P.push(ja(G.type))}o.error(`Expected arguments of type ${k}, but found (${P.join(", ")}) instead.`)}return null}static register(n,o){ko.definitions=o;for(const h in o)n[h]=ko}}function Eh(l){return Array.isArray(l)?`(${l.map(ja).join(", ")})`:`(${ja(l.type)}...)`}class Rf{constructor(n,o,h){this.type=Gm,this.locale=h,this.caseSensitive=n,this.diacriticSensitive=o}static parse(n,o){if(n.length!==2)return o.error("Expected one argument.");const h=n[1];if(typeof h!="object"||Array.isArray(h))return o.error("Collator options argument must be an object.");const p=h["case-sensitive"]===void 0?o.parse(!1,1,Ri):o.parseObjectValue(h["case-sensitive"],1,"case-sensitive",Ri);if(!p)return null;const x=h["diacritic-sensitive"]===void 0?o.parse(!1,1,Ri):o.parseObjectValue(h["diacritic-sensitive"],1,"diacritic-sensitive",Ri);if(!x)return null;let v=null;return h.locale&&(v=o.parseObjectValue(h.locale,1,"locale",wi),!v)?null:new Rf(p,x,v)}evaluate(n){return new ay(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}serialize(){const n={};return n["case-sensitive"]=this.caseSensitive.serialize(),n["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(n.locale=this.locale.serialize()),["collator",n]}}function Bu(l,n,o=0,h=l.length-1,p=DA){for(;h>o;){if(h-o>600){const C=h-o+1,A=n-o+1,k=Math.log(C),P=.5*Math.exp(2*k/3),O=.5*Math.sqrt(k*P*(C-P)/C)*(A-C/2<0?-1:1);Bu(l,n,Math.max(o,Math.floor(n-A*P/C+O)),Math.min(h,Math.floor(n+(C-A)*P/C+O)),p)}const x=l[n];let v=o,w=h;for(ao(l,o,n),p(l[h],x)>0&&ao(l,o,h);v<w;){for(ao(l,v,w),v++,w--;p(l[v],x)<0;)v++;for(;p(l[w],x)>0;)w--}p(l[o],x)===0?ao(l,o,w):(w++,ao(l,w,h)),w<=n&&(o=w+1),n<=w&&(h=w-1)}}function ao(l,n,o){const h=l[n];l[n]=l[o],l[o]=h}function DA(l,n){return l<n?-1:l>n?1:0}function RA(l){let n=0;for(let o,h,p=0,x=l.length,v=x-1;p<x;v=p++)o=l[p],h=l[v],n+=(h.x-o.x)*(o.y+h.y);return n}function Km(l,n){l[0]=Math.min(l[0],n[0]),l[1]=Math.min(l[1],n[1]),l[2]=Math.max(l[2],n[0]),l[3]=Math.max(l[3],n[1])}function Pd(l,n){return!(l[0]<=n[0]||l[2]>=n[2]||l[1]<=n[1]||l[3]>=n[3])}function d2(l,n,o){const h=l[0]-n[0],p=l[1]-n[1],x=l[0]-o[0],v=l[1]-o[1];return h*v-x*p==0&&h*x<=0&&p*v<=0}function ac(l,n,o=!1){let h=!1;for(let w=0,C=n.length;w<C;w++){const A=n[w];for(let k=0,P=A.length,O=P-1;k<P;O=k++){const G=A[O],W=A[k];if(d2(l,G,W))return o;(x=G)[1]>(p=l)[1]!=(v=W)[1]>p[1]&&p[0]<(v[0]-x[0])*(p[1]-x[1])/(v[1]-x[1])+x[0]&&(h=!h)}}var p,x,v;return h}function h2(l,n,o,h){const p=h[0]-o[0],x=h[1]-o[1],v=(l[0]-o[0])*x-p*(l[1]-o[1]),w=(n[0]-o[0])*x-p*(n[1]-o[1]);return v>0&&w<0||v<0&&w>0}function V_(l,n,o,h){return(p=[h[0]-o[0],h[1]-o[1]])[0]*(x=[n[0]-l[0],n[1]-l[1]])[1]-p[1]*x[0]!=0&&!(!h2(l,n,o,h)||!h2(o,h,l,n));var p,x}function Jm(l){const n=new At(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),o=new At(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const h of l[0])n.x>h.x&&(n.x=h.x),n.y>h.y&&(n.y=h.y),o.x<h.x&&(o.x=h.x),o.y<h.y&&(o.y=h.y);return{min:n,max:o}}const Dd=8192;function MA(l,n){const o=(180+l[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,p=Math.pow(2,n.z);return[Math.round(o*p*Dd),Math.round(h*p*Dd)]}function f2(l,n){for(let o=0;o<n.length;o++)if(ac(l,n[o]))return!0;return!1}function OA(l,n,o){for(const h of o)for(let p=0,x=h.length,v=x-1;p<x;v=p++)if(V_(l,n,h[v],h[p]))return!0;return!1}function Rd(l,n){for(let o=0;o<l.length;++o)if(!ac(l[o],n))return!1;for(let o=0;o<l.length-1;++o)if(OA(l[o],l[o+1],n))return!1;return!0}function FA(l,n){for(let o=0;o<n.length;o++)if(Rd(l,n[o]))return!0;return!1}function oy(l,n,o){const h=[];for(let p=0;p<l.length;p++){const x=[];for(let v=0;v<l[p].length;v++){const w=MA(l[p][v],o);Km(n,w),x.push(w)}h.push(x)}return h}function $_(l,n,o){const h=[];for(let p=0;p<l.length;p++){const x=oy(l[p],n,o);h.push(x)}return h}function ly(l,n,o,h){if(l[0]<o[0]||l[0]>o[2]){const p=.5*h;let x=l[0]-o[0]>p?-h:o[0]-l[0]>p?h:0;x===0&&(x=l[0]-o[2]>p?-h:o[2]-l[0]>p?h:0),l[0]+=x}Km(n,l)}function cy(l,n,o,h){const p=Math.pow(2,h.z)*Dd,x=[h.x*Dd,h.y*Dd],v=[];if(!l)return v;for(const w of l)for(const C of w){const A=[C.x+x[0],C.y+x[1]];ly(A,n,o,p),v.push(A)}return v}function oc(l,n,o,h){const p=Math.pow(2,h.z)*Dd,x=[h.x*Dd,h.y*Dd],v=[];if(!l)return v;for(const C of l){const A=[];for(const k of C){const P=[k.x+x[0],k.y+x[1]];Km(n,P),A.push(P)}v.push(A)}if(n[2]-n[0]<=p/2){(w=n)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const C of v)for(const A of C)ly(A,n,o,p)}var w;return v}class Ch{constructor(n,o){this.type=Ri,this.geojson=n,this.geometries=o}static parse(n,o){if(n.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(Pf(n[1])){const h=n[1];if(h.type==="FeatureCollection")for(let p=0;p<h.features.length;++p){const x=h.features[p].geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new Ch(h,h.features[p].geometry)}else if(h.type==="Feature"){const p=h.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Ch(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new Ch(h,h)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(o,h){const p=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],v=o.canonicalID();if(!v)return!1;if(h.type==="Polygon"){const w=oy(h.coordinates,x,v),C=cy(o.geometry(),p,x,v);if(!Pd(p,x))return!1;for(const A of C)if(!ac(A,w))return!1}if(h.type==="MultiPolygon"){const w=$_(h.coordinates,x,v),C=cy(o.geometry(),p,x,v);if(!Pd(p,x))return!1;for(const A of C)if(!f2(A,w))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(o,h){const p=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],v=o.canonicalID();if(!v)return!1;if(h.type==="Polygon"){const w=oy(h.coordinates,x,v),C=oc(o.geometry(),p,x,v);if(!Pd(p,x))return!1;for(const A of C)if(!Rd(A,w))return!1}if(h.type==="MultiPolygon"){const w=$_(h.coordinates,x,v),C=oc(o.geometry(),p,x,v);if(!Pd(p,x))return!1;for(const A of C)if(!FA(A,w))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Qm={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},uy=1/298.257223563,dy=uy*(2-uy),Mf=Math.PI/180;class Of{static fromTile(n,o,h){const p=Math.PI*(1-2*(n+.5)/Math.pow(2,o)),x=Math.atan(.5*(Math.exp(p)-Math.exp(-p)))/Mf;return new Of(x,h)}static get units(){return Qm}constructor(n,o){if(n===void 0)throw new Error("No latitude given.");if(o&&!Qm[o])throw new Error(`Unknown unit ${o}. Use one of: ${Object.keys(Qm).join(", ")}`);const h=6378.137*Mf*(o?Qm[o]:1),p=Math.cos(n*Mf),x=1/(1-dy*(1-p*p)),v=Math.sqrt(x);this.kx=h*v*p,this.ky=h*v*x*(1-dy)}distance(n,o){const h=Il(n[0]-o[0])*this.kx,p=(n[1]-o[1])*this.ky;return Math.sqrt(h*h+p*p)}bearing(n,o){const h=Il(o[0]-n[0])*this.kx;return Math.atan2(h,(o[1]-n[1])*this.ky)/Mf}destination(n,o,h){const p=h*Mf;return this.offset(n,Math.sin(p)*o,Math.cos(p)*o)}offset(n,o,h){return[n[0]+o/this.kx,n[1]+h/this.ky]}lineDistance(n){let o=0;for(let h=0;h<n.length-1;h++)o+=this.distance(n[h],n[h+1]);return o}area(n){let o=0;for(let h=0;h<n.length;h++){const p=n[h];for(let x=0,v=p.length,w=v-1;x<v;w=x++)o+=Il(p[x][0]-p[w][0])*(p[x][1]+p[w][1])*(h?-1:1)}return Math.abs(o)/2*this.kx*this.ky}along(n,o){let h=0;if(o<=0)return n[0];for(let p=0;p<n.length-1;p++){const x=n[p],v=n[p+1],w=this.distance(x,v);if(h+=w,h>o)return q_(x,v,(o-(h-w))/w)}return n[n.length-1]}pointToSegmentDistance(n,o,h){let[p,x]=o,v=Il(h[0]-p)*this.kx,w=(h[1]-x)*this.ky;if(v!==0||w!==0){const C=(Il(n[0]-p)*this.kx*v+(n[1]-x)*this.ky*w)/(v*v+w*w);C>1?(p=h[0],x=h[1]):C>0&&(p+=v/this.kx*C,x+=w/this.ky*C)}return v=Il(n[0]-p)*this.kx,w=(n[1]-x)*this.ky,Math.sqrt(v*v+w*w)}pointOnLine(n,o){let h=1/0,p=n[0][0],x=n[0][1],v=0,w=0;for(let C=0;C<n.length-1;C++){let A=n[C][0],k=n[C][1],P=Il(n[C+1][0]-A)*this.kx,O=(n[C+1][1]-k)*this.ky,G=0;P===0&&O===0||(G=(Il(o[0]-A)*this.kx*P+(o[1]-k)*this.ky*O)/(P*P+O*O),G>1?(A=n[C+1][0],k=n[C+1][1]):G>0&&(A+=P/this.kx*G,k+=O/this.ky*G)),P=Il(o[0]-A)*this.kx,O=(o[1]-k)*this.ky;const W=P*P+O*O;W<h&&(h=W,p=A,x=k,v=C,w=G)}return{point:[p,x],index:v,t:Math.max(0,Math.min(1,w))}}lineSlice(n,o,h){let p=this.pointOnLine(h,n),x=this.pointOnLine(h,o);if(p.index>x.index||p.index===x.index&&p.t>x.t){const A=p;p=x,x=A}const v=[p.point],w=p.index+1,C=x.index;!hy(h[w],v[0])&&w<=C&&v.push(h[w]);for(let A=w+1;A<=C;A++)v.push(h[A]);return hy(h[C],x.point)||v.push(x.point),v}lineSliceAlong(n,o,h){let p=0;const x=[];for(let v=0;v<h.length-1;v++){const w=h[v],C=h[v+1],A=this.distance(w,C);if(p+=A,p>n&&x.length===0&&x.push(q_(w,C,(n-(p-A))/A)),p>=o)return x.push(q_(w,C,(o-(p-A))/A)),x;p>n&&x.push(C)}return x}bufferPoint(n,o){const h=o/this.ky,p=o/this.kx;return[n[0]-p,n[1]-h,n[0]+p,n[1]+h]}bufferBBox(n,o){const h=o/this.ky,p=o/this.kx;return[n[0]-p,n[1]-h,n[2]+p,n[3]+h]}insideBBox(n,o){return Il(n[0]-o[0])>=0&&Il(n[0]-o[2])<=0&&n[1]>=o[1]&&n[1]<=o[3]}}function hy(l,n){return l[0]===n[0]&&l[1]===n[1]}function q_(l,n,o){const h=Il(n[0]-l[0]);return[l[0]+h*o,l[1]+(n[1]-l[1])*o]}function Il(l){for(;l<-180;)l+=360;for(;l>180;)l-=360;return l}class G_{constructor(n=[],o=(h,p)=>h<p?-1:h>p?1:0){if(this.data=n,this.length=this.data.length,this.compare=o,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],o=this.data.pop();return--this.length>0&&(this.data[0]=o,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:o,compare:h}=this,p=o[n];for(;n>0;){const x=n-1>>1,v=o[x];if(h(p,v)>=0)break;o[n]=v,n=x}o[n]=p}_down(n){const{data:o,compare:h}=this,p=this.length>>1,x=o[n];for(;n<p;){let v=1+(n<<1);const w=v+1;if(w<this.length&&h(o[w],o[v])<0&&(v=w),h(o[v],x)>=0)break;o[n]=o[v],n=v}o[n]=x}}var ar=8192;function fy(l,n){return n.dist-l.dist}const Ff=100,Lf=50;function eg(l){const n=[1/0,1/0,-1/0,-1/0];if(n.length!==l.length)return!1;for(let o=0;o<n.length;o++)if(n[o]!==l[o])return!1;return!0}function tg(l){return l[1]-l[0]+1}function cu(l,n){const o=l[1]>=l[0]&&l[1]<n;return o||console.warn("Distance Expression: Index is out of range"),o}function W_(l,n){if(l[0]>l[1])return[null,null];const o=tg(l);if(n){if(o===2)return[l,null];const h=Math.floor(o/2);return[[l[0],l[0]+h],[l[0]+h,l[1]]]}{if(o===1)return[l,null];const h=Math.floor(o/2)-1;return[[l[0],l[0]+h],[l[0]+h+1,l[1]]]}}function lc(l,n){const o=[1/0,1/0,-1/0,-1/0];if(!cu(n,l.length))return o;for(let h=n[0];h<=n[1];++h)Km(o,l[h]);return o}function si(l){const n=[1/0,1/0,-1/0,-1/0];for(let o=0;o<l.length;++o)for(let h=0;h<l[o].length;++h)Km(n,l[o][h]);return n}function zf(l,n,o){if(eg(l)||eg(n))return NaN;let h=0,p=0;return l[2]<n[0]&&(h=n[0]-l[2]),l[0]>n[2]&&(h=l[0]-n[2]),l[1]>n[3]&&(p=l[1]-n[3]),l[3]<n[1]&&(p=n[1]-l[3]),o.distance([0,0],[h,p])}function LA(l){return 360*l-180}function zA(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function H_(l,n){const o=Math.pow(2,n.z),h=(l.y/ar+n.y)/o;return[LA((l.x/ar+n.x)/o),zA(h)]}function BA(l,n){const o=[];for(let h=0;h<l.length;++h)o.push(H_(l[h],n));return o}function Os(l,n,o){const h=o.pointOnLine(n,l).point;return o.distance(l,h)}function p2(l,n,o,h,p){const x=o.slice(h[0],h[1]+1);let v=1/0;for(let w=n[0];w<=n[1];++w)if((v=Math.min(v,Os(l[w],x,p)))===0)return 0;return v}function py(l,n,o,h,p){const x=Math.min(p.pointToSegmentDistance(l,o,h),p.pointToSegmentDistance(n,o,h)),v=Math.min(p.pointToSegmentDistance(o,l,n),p.pointToSegmentDistance(h,l,n));return Math.min(x,v)}function UA(l,n,o,h,p){if(!cu(n,l.length)||!cu(h,o.length))return NaN;let x=1/0;for(let v=n[0];v<n[1];++v)for(let w=h[0];w<h[1];++w){if(V_(l[v],l[v+1],o[w],o[w+1]))return 0;x=Math.min(x,py(l[v],l[v+1],o[w],o[w+1],p))}return x}function VA(l,n,o,h,p){if(!cu(n,l.length)||!cu(h,o.length))return NaN;let x=1/0;for(let v=n[0];v<=n[1];++v)for(let w=h[0];w<=h[1];++w)if((x=Math.min(x,p.distance(l[v],o[w])))===0)return x;return x}function $A(l,n,o){if(ac(l,n,!0))return 0;let h=1/0;for(const p of n){const x=p.length;if(x<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(p[0]!==p[x-1]&&(h=Math.min(h,o.pointToSegmentDistance(l,p[x-1],p[0])))===0||(h=Math.min(h,Os(l,p,o)))===0)return h}return h}function qA(l,n,o,h){if(!cu(n,l.length))return NaN;for(let x=n[0];x<=n[1];++x)if(ac(l[x],o,!0))return 0;let p=1/0;for(let x=n[0];x<n[1];++x)for(const v of o)for(let w=0,C=v.length,A=C-1;w<C;A=w++){if(V_(l[x],l[x+1],v[A],v[w]))return 0;p=Math.min(p,py(l[x],l[x+1],v[A],v[w],h))}return p}function m2(l,n){for(const o of l)for(let h=0;h<=o.length-1;++h)if(ac(o[h],n,!0))return!0;return!1}function GA(l,n,o,h=1/0){const p=si(l),x=si(n);if(h!==1/0&&zf(p,x,o)>=h)return h;if(Pd(p,x)){if(m2(l,n))return 0}else if(m2(n,l))return 0;let v=h;for(const w of l)for(let C=0,A=w.length,k=A-1;C<A;k=C++)for(const P of n)for(let O=0,G=P.length,W=G-1;O<G;W=O++){if(V_(w[k],w[C],P[W],P[O]))return 0;v=Math.min(v,py(w[k],w[C],P[W],P[O],o))}return v}function Z_(l,n,o,h,p,x,v){if(x===null||v===null)return;const w=zf(lc(h,x),lc(p,v),o);w<n&&l.push({dist:w,range1:x,range2:v})}function WA(l,n,o,h,p=1/0){let x=Math.min(h.distance(l[0],o[0][0]),p);if(x===0)return x;const v=new G_([{dist:0,range1:[0,l.length-1],range2:[0,0]}],fy),w=n?Lf:Ff,C=si(o);for(;v.length;){const A=v.pop();if(A.dist>=x)continue;const k=A.range1;if(tg(k)<=w){if(!cu(k,l.length))return NaN;if(n){const P=qA(l,k,o,h);if((x=Math.min(x,P))===0)return x}else for(let P=k[0];P<=k[1];++P){const O=$A(l[P],o,h);if((x=Math.min(x,O))===0)return x}}else{const P=W_(k,n);if(P[0]!==null){const O=zf(lc(l,P[0]),C,h);O<x&&v.push({dist:O,range1:P[0],range2:[0,0]})}if(P[1]!==null){const O=zf(lc(l,P[1]),C,h);O<x&&v.push({dist:O,range1:P[1],range2:[0,0]})}}}return x}function g2(l,n,o,h,p,x=1/0){let v=Math.min(x,p.distance(l[0],o[0]));if(v===0)return v;const w=new G_([{dist:0,range1:[0,l.length-1],range2:[0,o.length-1]}],fy),C=n?Lf:Ff,A=h?Lf:Ff;for(;w.length;){const k=w.pop();if(k.dist>=v)continue;const P=k.range1,O=k.range2;if(tg(P)<=C&&tg(O)<=A){if(!cu(P,l.length)||!cu(O,o.length))return NaN;if(n&&h?v=Math.min(v,UA(l,P,o,O,p)):n||h?n&&!h?v=Math.min(v,p2(o,O,l,P,p)):!n&&h&&(v=Math.min(v,p2(l,P,o,O,p))):v=Math.min(v,VA(l,P,o,O,p)),v===0)return v}else{const G=W_(P,n),W=W_(O,h);Z_(w,v,p,l,o,G[0],W[0]),Z_(w,v,p,l,o,G[0],W[1]),Z_(w,v,p,l,o,G[1],W[0]),Z_(w,v,p,l,o,G[1],W[1])}}return v}function my(l,n,o,h,p=1/0){let x=p;const v=lc(l,[0,l.length-1]);for(const w of o)if(!(x!==1/0&&zf(v,lc(w,[0,w.length-1]),h)>=x)&&(x=Math.min(x,g2(l,n,w,!0,h,x)),x===0))return x;return x}function X_(l,n,o,h,p=1/0){let x=p;const v=lc(l,[0,l.length-1]);for(const w of o){if(x!==1/0&&zf(v,si(w),h)>=x)continue;const C=WA(l,n,w,h,x);if(isNaN(C))return C;if((x=Math.min(x,C))===0)return x}return x}function gy(l){return l==="Point"||l==="MultiPoint"||l==="LineString"||l==="MultiLineString"||l==="Polygon"||l==="MultiPolygon"}class Ah{constructor(n,o){this.type=Gr,this.geojson=n,this.geometries=o}static parse(n,o){if(n.length!==2)return o.error(`'distance' expression requires either one argument, but found ' ${n.length-1} instead.`);if(Pf(n[1])){const h=n[1];if(h.type==="FeatureCollection"){for(let p=0;p<h.features.length;++p)if(gy(h.features[p].geometry.type))return new Ah(h,h.features[p].geometry)}else if(h.type==="Feature"){if(gy(h.geometry.type))return new Ah(h,h.geometry)}else if(gy(h.type))return new Ah(h,h)}return o.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(n){const o=n.geometry(),h=n.canonicalID();if(o!=null&&h!=null){if(n.geometryType()==="Point")return function(p,x,v){const w=[];for(const A of p)for(const k of A)w.push(H_(k,x));const C=new Of(w[0][1],"meters");return v.type==="Point"||v.type==="MultiPoint"||v.type==="LineString"?g2(w,!1,v.type==="Point"?[v.coordinates]:v.coordinates,v.type==="LineString",C):v.type==="MultiLineString"?my(w,!1,v.coordinates,C):v.type==="Polygon"||v.type==="MultiPolygon"?X_(w,!1,v.type==="Polygon"?[v.coordinates]:v.coordinates,C):null}(o,h,this.geometries);if(n.geometryType()==="LineString")return function(p,x,v){const w=[];for(const A of p){const k=[];for(const P of A)k.push(H_(P,x));w.push(k)}const C=new Of(w[0][0][1],"meters");if(v.type==="Point"||v.type==="MultiPoint"||v.type==="LineString")return my(v.type==="Point"?[v.coordinates]:v.coordinates,v.type==="LineString",w,C);if(v.type==="MultiLineString"){let A=1/0;for(let k=0;k<v.coordinates.length;k++){const P=my(v.coordinates[k],!0,w,C,A);if(isNaN(P))return P;if((A=Math.min(A,P))===0)return A}return A}if(v.type==="Polygon"||v.type==="MultiPolygon"){let A=1/0;for(let k=0;k<w.length;k++){const P=X_(w[k],!0,v.type==="Polygon"?[v.coordinates]:v.coordinates,C,A);if(isNaN(P))return P;if((A=Math.min(A,P))===0)return A}return A}return null}(o,h,this.geometries);if(n.geometryType()==="Polygon")return function(p,x,v){const w=[];for(const A of function(k,P){const O=k.length;if(O<=1)return[k];const G=[];let W,te;for(let se=0;se<O;se++){const oe=RA(k[se]);oe!==0&&(k[se].area=Math.abs(oe),te===void 0&&(te=oe<0),te===oe<0?(W&&G.push(W),W=[k[se]]):W.push(k[se]))}return W&&G.push(W),G}(p)){const k=[];for(let P=0;P<A.length;++P)k.push(BA(A[P],x));w.push(k)}const C=new Of(w[0][0][0][1],"meters");if(v.type==="Point"||v.type==="MultiPoint"||v.type==="LineString")return X_(v.type==="Point"?[v.coordinates]:v.coordinates,v.type==="LineString",w,C);if(v.type==="MultiLineString"){let A=1/0;for(let k=0;k<v.coordinates.length;k++){const P=X_(v.coordinates[k],!0,w,C,A);if(isNaN(P))return P;if((A=Math.min(A,P))===0)return A}return A}return v.type==="Polygon"||v.type==="MultiPolygon"?function(A,k,P){let O=1/0;for(const G of A)for(const W of k){const te=GA(G,W,P,O);if(isNaN(te))return te;if((O=Math.min(O,te))===0)return O}return O}(v.type==="Polygon"?[v.coordinates]:v.coordinates,w,C):null}(o,h,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Bf(l){if(l instanceof ko&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof Ch||l instanceof Ah)return!1;if(l instanceof Vf)return l.featureConstant;let n=!0;return l.eachChild(o=>{n&&!Bf(o)&&(n=!1)}),n}function rg(l){if(l instanceof ko&&l.name==="feature-state")return!1;let n=!0;return l.eachChild(o=>{n&&!rg(o)&&(n=!1)}),n}function Uf(l,n){if(l instanceof ko&&n.indexOf(l.name)>=0)return!1;let o=!0;return l.eachChild(h=>{o&&!Uf(h,n)&&(o=!1)}),o}function _2(l,n,o){return[l,n,o].filter(Boolean).join("")}function _y(l,n){switch(l){case"string":return ou(n);case"number":return+n;case"boolean":return!!n;case"color":return Li.parse(n);case"formatted":return Ha.fromString(ou(n));case"resolvedImage":return el.build(ou(n))}return n}function x2(l,n,o,h){return h!==void 0&&(l=h*Math.round(l/h)),n!==void 0&&l<n&&(l=n),o!==void 0&&l>o&&(l=o),l}class Vf{constructor(n,o,h,p=!1){this.type=n,this.key=o,this.scope=h,this.featureConstant=p}static parse(n,o){let h=o.expectedType;if(h==null&&(h=Gi),n.length<2||n.length>3)return o.error("Invalid number of arguments for 'config' expression.");const p=o.parse(n[1],1);if(!(p instanceof zu))return o.error("Key name of 'config' expression must be a string literal.");let x,v=!0;const w=ou(p.value);if(n.length>=3){const C=o.parse(n[2],2);if(!(C instanceof zu))return o.error("Scope of 'config' expression must be a string literal.");x=ou(C.value)}if(o.options){const C=_2(w,x,o._scope),A=o.options.get(C);A&&(v=Bf(A.value||A.default))}return new Vf(h,w,x,v)}evaluate(n){const o=_2(this.key,this.scope,n.scope),h=n.getConfig(o);if(!h)return null;const{type:p,value:x,values:v,minValue:w,maxValue:C,stepValue:A}=h,k=h.default.evaluate(n);let P=k;if(x){const O=n.scope;n.scope=(O||"").split("").slice(1).join(""),P=x.evaluate(n),n.scope=O}return p&&(P=_y(p,P)),P===void 0||w===void 0&&C===void 0&&A===void 0||(typeof P=="number"?P=x2(P,w,C,A):Array.isArray(P)&&(P=P.map(O=>typeof O=="number"?x2(O,w,C,A):O))),x!==void 0&&P!==void 0&&v&&!v.includes(P)&&(P=k,p&&(P=_y(p,P))),(p&&p!==this.type||P!==void 0&&!F_($a(P),this.type))&&(P=_y(this.type.kind,P)),P}eachChild(){}outputDefined(){return!1}serialize(){const n=["config",this.key];return this.scope&&n.concat(this.scope),n}}class Y_{constructor(n,o){this.type=o.type,this.name=n,this.boundExpression=o}static parse(n,o){if(n.length!==2||typeof n[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const h=n[1];return o.scope.has(h)?new Y_(h,o.scope.get(h)):o.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class K_{constructor(n,o=[],h,p=new sc,x=[],v,w,C){this.registry=n,this.path=o,this.key=o.map(A=>typeof A=="string"?`['${A}']`:`[${A}]`).join(""),this.scope=p,this.errors=x,this.expectedType=h,this._scope=v,this.options=w,this.iconImageUseTheme=C}parse(n,o,h,p,x={}){return o||h?this.concat(o,null,h,p)._parse(n,x):this._parse(n,x)}parseObjectValue(n,o,h,p,x,v={}){return this.concat(o,h,p,x)._parse(n,v)}_parse(n,o){function h(p,x,v){return v==="assert"?new Rr(x,[p]):v==="coerce"?new lu(x,[p]):p}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=typeof n[0]=="string"?this.registry[n[0]]:void 0;if(p){let x=p.parse(n,this);if(!x)return null;if(this.expectedType){const v=this.expectedType,w=x.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||w.kind!=="value")if(v.kind!=="color"&&v.kind!=="formatted"&&v.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string"){if(this.checkSubtype(v,w))return null}else x=h(x,v,o.typeAnnotation||"coerce");else x=h(x,v,o.typeAnnotation||"assert")}if(!(x instanceof zu)&&x.type.kind!=="resolvedImage"&&xy(x)){const v=new so(this._scope,this.options,this.iconImageUseTheme);try{x=new zu(x.type,x.evaluate(v))}catch(w){return this.error(w.message),null}}return x}return lu.parse(["to-array",n],this)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,o,h,p){let x=typeof n=="number"?this.path.concat(n):this.path;x=typeof o=="string"?x.concat(o):x;const v=p?this.scope.concat(p):this.scope;return new K_(this.registry,x,h||null,v,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(n,...o){const h=`${this.key}${o.map(p=>`[${p}]`).join("")}`;this.errors.push(new ic(h,n))}checkSubtype(n,o){const h=Hm(n,o);return h&&this.error(h),h}}function xy(l){if(l instanceof Y_)return xy(l.boundExpression);if(l instanceof ko&&l.name==="error"||l instanceof Rf||l instanceof Ch||l instanceof Ah||l instanceof Vf)return!1;const n=l instanceof lu||l instanceof Rr;let o=!0;return l.eachChild(h=>{o=n?o&&xy(h):o&&h instanceof zu}),!!o&&Bf(l)&&Uf(l,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function J_(l,n){const o=l.length-1;let h,p,x=0,v=o,w=0;for(;x<=v;)if(w=Math.floor((x+v)/2),h=l[w],p=l[w+1],h<=n){if(w===o||n<p)return w;x=w+1}else{if(!(h>n))throw new oa("Input is not a number.");v=w-1}return 0}class ng{constructor(n,o,h){this.type=n,this.input=o,this.labels=[],this.outputs=[];for(const[p,x]of h)this.labels.push(p),this.outputs.push(x)}static parse(n,o){if(n.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return o.error("Expected an even number of arguments.");const h=o.parse(n[1],1,Gr);if(!h)return null;const p=[];let x=null;o.expectedType&&o.expectedType.kind!=="value"&&(x=o.expectedType);for(let v=1;v<n.length;v+=2){const w=v===1?-1/0:n[v],C=n[v+1],A=v,k=v+1;if(typeof w!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(p.length&&p[p.length-1][0]>=w)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const P=o.parse(C,k,x);if(!P)return null;x=x||P.type,p.push([w,P])}return new ng(x,h,p)}evaluate(n){const o=this.labels,h=this.outputs;if(o.length===1)return h[0].evaluate(n);const p=this.input.evaluate(n);if(p<=o[0])return h[0].evaluate(n);const x=o.length;return p>=o[x-1]?h[x-1].evaluate(n):h[J_(o,p)].evaluate(n)}eachChild(n){n(this.input);for(const o of this.outputs)n(o)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){const n=["step",this.input.serialize()];for(let o=0;o<this.labels.length;o++)o>0&&n.push(this.labels[o]),n.push(this.outputs[o].serialize());return n}}const v2=.95047,y2=1.08883,w2=4/29,$f=6/29,Q_=3*$f*$f,HA=$f*$f*$f,b2=Math.PI/180,ZA=180/Math.PI;function vy(l){return l>HA?Math.pow(l,1/3):l/Q_+w2}function yy(l){return l>$f?l*l*l:Q_*(l-w2)}function e0(l){return 255*(l<=.0031308?12.92*l:1.055*Math.pow(l,1/2.4)-.055)}function t0(l){return(l/=255)<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function jh(l){const n=t0(l.r),o=t0(l.g),h=t0(l.b),p=vy((.4124564*n+.3575761*o+.1804375*h)/v2),x=vy((.2126729*n+.7151522*o+.072175*h)/1);return{l:116*x-16,a:500*(p-x),b:200*(x-vy((.0193339*n+.119192*o+.9503041*h)/y2)),alpha:l.a}}function wy(l){let n=(l.l+16)/116,o=isNaN(l.a)?n:n+l.a/500,h=isNaN(l.b)?n:n-l.b/200;return n=1*yy(n),o=v2*yy(o),h=y2*yy(h),new Li(e0(3.2404542*o-1.5371385*n-.4985314*h),e0(-.969266*o+1.8760108*n+.041556*h),e0(.0556434*o-.2040259*n+1.0572252*h),l.alpha)}function S2(l,n,o){const h=n-l;return l+o*(h>180||h<-180?h-360*Math.round(h/360):h)}const ig={forward:jh,reverse:wy,interpolate:function(l,n,o){return{l:fn(l.l,n.l,o),a:fn(l.a,n.a,o),b:fn(l.b,n.b,o),alpha:fn(l.alpha,n.alpha,o)}}},Ih={forward:function(l){const{l:n,a:o,b:h}=jh(l),p=Math.atan2(h,o)*ZA;return{h:p<0?p+360:p,c:Math.sqrt(o*o+h*h),l:n,alpha:l.a}},reverse:function(l){const n=l.h*b2,o=l.c;return wy({l:l.l,a:Math.cos(n)*o,b:Math.sin(n)*o,alpha:l.alpha})},interpolate:function(l,n,o){return{h:S2(l.h,n.h,o),c:fn(l.c,n.c,o),l:fn(l.l,n.l,o),alpha:fn(l.alpha,n.alpha,o)}}};var r0=Object.freeze({__proto__:null,hcl:Ih,lab:ig});class Nl{constructor(n,o,h,p,x){this.type=n,this.operator=o,this.interpolation=h,this.input=p,this.labels=[],this.outputs=[];for(const[v,w]of x)this.labels.push(v),this.outputs.push(w)}static interpolationFactor(n,o,h,p){let x=0;if(n.name==="exponential")x=by(o,n.base,h,p);else if(n.name==="linear")x=by(o,1,h,p);else if(n.name==="cubic-bezier"){const v=n.controlPoints;x=new ai(v[0],v[1],v[2],v[3]).solve(by(o,1,h,p))}return x}static parse(n,o){let[h,p,x,...v]=n;if(!Array.isArray(p)||p.length===0)return o.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const A=p[1];if(typeof A!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:A}}else{if(p[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const A=p.slice(1);if(A.length!==4||A.some(k=>typeof k!="number"||k<0||k>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:A}}}if(n.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length-1>3&&(n.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(x=o.parse(x,2,Gr),!x)return null;const w=[];let C=null;h==="interpolate-hcl"||h==="interpolate-lab"?C=ml:o.expectedType&&o.expectedType.kind!=="value"&&(C=o.expectedType);for(let A=0;A<v.length;A+=2){const k=v[A],P=v[A+1],O=A+3,G=A+4;if(typeof k!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(w.length&&w[w.length-1][0]>=k)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',O);const W=o.parse(P,G,C);if(!W)return null;C=C||W.type,w.push([k,W])}return C.kind==="number"||C.kind==="color"||C.kind==="array"&&C.itemType.kind==="number"&&typeof C.N=="number"?new Nl(C,h,p,x,w):o.error(`Type ${ja(C)} is not interpolatable.`)}evaluate(n){const o=this.labels,h=this.outputs;if(o.length===1)return h[0].evaluate(n);const p=this.input.evaluate(n);if(p<=o[0])return h[0].evaluate(n);const x=o.length;if(p>=o[x-1])return h[x-1].evaluate(n);const v=J_(o,p),w=Nl.interpolationFactor(this.interpolation,p,o[v],o[v+1]),C=h[v].evaluate(n),A=h[v+1].evaluate(n);return this.operator==="interpolate"?Fu[this.type.kind.toLowerCase()](C,A,w):this.operator==="interpolate-hcl"?Ih.reverse(Ih.interpolate(Ih.forward(C),Ih.forward(A),w)):ig.reverse(ig.interpolate(ig.forward(C),ig.forward(A),w))}eachChild(n){n(this.input);for(const o of this.outputs)n(o)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){let n;n=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const o=[this.operator,n,this.input.serialize()];for(let h=0;h<this.labels.length;h++)o.push(this.labels[h],this.outputs[h].serialize());return o}}function by(l,n,o,h){const p=h-o,x=l-o;return p===0?0:n===1?x/p:(Math.pow(n,x)-1)/(Math.pow(n,p)-1)}class sg{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expectected at least one argument.");let h=null;const p=o.expectedType;p&&p.kind!=="value"&&(h=p);const x=[];for(const w of n.slice(1)){const C=o.parse(w,1+x.length,h,void 0,{typeAnnotation:"omit"});if(!C)return null;h=h||C.type,x.push(C)}const v=p&&x.some(w=>Hm(p,w.type));return new sg(v?Gi:h,x)}evaluate(n){let o,h=null,p=0;for(const x of this.args){if(p++,h=x.evaluate(n),h&&h instanceof el&&!h.available&&(o||(o=h),h=null,p===this.args.length))return o;if(h!==null)break}return h}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=["coalesce"];return this.eachChild(o=>{n.push(o.serialize())}),n}}class ag{constructor(n,o){this.type=o.type,this.bindings=[].concat(n),this.result=o}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const o of this.bindings)n(o[1]);n(this.result)}static parse(n,o){if(n.length<4)return o.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const h=[];for(let x=1;x<n.length-1;x+=2){const v=n[x];if(typeof v!="string")return o.error(`Expected string, but found ${typeof v} instead.`,x);if(/[^a-zA-Z0-9_]/.test(v))return o.error("Variable names must contain only alphanumeric characters or '_'.",x);const w=o.parse(n[x+1],x+1);if(!w)return null;h.push([v,w])}const p=o.parse(n[n.length-1],n.length-1,o.expectedType,h);return p?new ag(h,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const n=["let"];for(const[o,h]of this.bindings)n.push(o,h.serialize());return n.push(this.result.serialize()),n}}class Sy{constructor(n,o,h){this.type=n,this.index=o,this.input=h}static parse(n,o){if(n.length!==3)return o.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const h=o.parse(n[1],1,Gr),p=o.parse(n[2],2,io(o.expectedType||Gi));return h&&p?new Sy(p.type.itemType,h,p):null}evaluate(n){const o=this.index.evaluate(n),h=this.input.evaluate(n);if(o<0)throw new oa("Array index out of bounds: negative index");if(o>=h.length)throw new oa("Array index out of bounds: index exceeds array size");if(o!==Math.floor(o))throw new oa("Array index must be an integer. Use at-interpolated for fractional indices");return h[o]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Ty{constructor(n,o,h){this.type=n,this.index=o,this.input=h}static parse(n,o){if(n.length!==3)return o.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const h=o.parse(n[1],1,Gr),p=o.parse(n[2],2,io(o.expectedType||Gi));return h&&p?new Ty(p.type.itemType,h,p):null}evaluate(n){const o=this.index.evaluate(n),h=this.input.evaluate(n);if(o<0)throw new oa(`Array index out of bounds: ${o} < 0.`);if(o>h.length-1)throw new oa(`Array index out of bounds: ${o} > ${h.length-1}.`);if(o===Math.floor(o))return h[o];const p=Math.floor(o),x=Math.ceil(o),v=h[p],w=h[x];if(typeof v!="number"||typeof w!="number")throw new oa(`Cannot interpolate between non-number values at index ${o}.`);const C=o-p;return v*(1-C)+w*C}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Ey{constructor(n,o){this.type=Ri,this.needle=n,this.haystack=o}static parse(n,o){if(n.length!==3)return o.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const h=o.parse(n[1],1,Gi),p=o.parse(n[2],2,Gi);return h&&p?sy(h.type,[Ri,wi,Gr,Nf,Gi])?new Ey(h,p):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${ja(h.type)} instead`):null}evaluate(n){const o=this.needle.evaluate(n),h=this.haystack.evaluate(n);if(h==null)return!1;if(!Zm(o,["boolean","string","number","null"]))throw new oa(`Expected first argument to be of type boolean, string, number or null, but found ${ja($a(o))} instead.`);if(!Zm(h,["string","array"]))throw new oa(`Expected second argument to be of type array or string, but found ${ja($a(h))} instead.`);return h.indexOf(o)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class og{constructor(n,o,h){this.type=Gr,this.needle=n,this.haystack=o,this.fromIndex=h}static parse(n,o){if(n.length<=2||n.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const h=o.parse(n[1],1,Gi),p=o.parse(n[2],2,Gi);if(!h||!p)return null;if(!sy(h.type,[Ri,wi,Gr,Nf,Gi]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${ja(h.type)} instead`);if(n.length===4){const x=o.parse(n[3],3,Gr);return x?new og(h,p,x):null}return new og(h,p)}evaluate(n){const o=this.needle.evaluate(n),h=this.haystack.evaluate(n);if(!Zm(o,["boolean","string","number","null"]))throw new oa(`Expected first argument to be of type boolean, string, number or null, but found ${ja($a(o))} instead.`);if(!Zm(h,["string","array"]))throw new oa(`Expected second argument to be of type array or string, but found ${ja($a(h))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(n);return h.indexOf(o,p)}return h.indexOf(o)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const n=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),n]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class n0{constructor(n,o,h,p,x,v){this.inputType=n,this.type=o,this.input=h,this.cases=p,this.outputs=x,this.otherwise=v}static parse(n,o){if(n.length<5)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return o.error("Expected an even number of arguments.");let h,p;o.expectedType&&o.expectedType.kind!=="value"&&(p=o.expectedType);const x={},v=[];for(let A=2;A<n.length-1;A+=2){let k=n[A];const P=n[A+1];Array.isArray(k)||(k=[k]);const O=o.concat(A);if(k.length===0)return O.error("Expected at least one branch label.");for(const W of k){if(typeof W!="number"&&typeof W!="string")return O.error("Branch labels must be numbers or strings.");if(typeof W=="number"&&Math.abs(W)>Number.MAX_SAFE_INTEGER)return O.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof W=="number"&&Math.floor(W)!==W)return O.error("Numeric branch labels must be integer values.");if(h){if(O.checkSubtype(h,$a(W)))return null}else h=$a(W);if(x[String(W)]!==void 0)return O.error("Branch labels must be unique.");x[String(W)]=v.length}const G=o.parse(P,A,p);if(!G)return null;p=p||G.type,v.push(G)}const w=o.parse(n[1],1,Gi);if(!w)return null;const C=o.parse(n[n.length-1],n.length-1,p);return C?w.type.kind!=="value"&&o.concat(1).checkSubtype(h,w.type)?null:new n0(h,p,w,x,v,C):null}evaluate(n){const o=this.input.evaluate(n);return(F_($a(o),this.inputType)&&this.outputs[this.cases[o]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["match",this.input.serialize()],o=Object.keys(this.cases).sort(),h=[],p={};for(const v of o){const w=p[this.cases[v]];w===void 0?(p[this.cases[v]]=h.length,h.push([this.cases[v],[v]])):h[w][1].push(v)}const x=v=>this.inputType.kind==="number"?Number(v):v;for(const[v,w]of h)n.push(w.length===1?x(w[0]):w.map(x)),n.push(this.outputs[v].serialize());return n.push(this.otherwise.serialize()),n}}class qf{constructor(n,o,h){this.type=n,this.branches=o,this.otherwise=h}static parse(n,o){if(n.length<4)return o.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return o.error("Expected an odd number of arguments.");let h;o.expectedType&&o.expectedType.kind!=="value"&&(h=o.expectedType);const p=[];for(let v=1;v<n.length-1;v+=2){const w=o.parse(n[v],v,Ri);if(!w)return null;const C=o.parse(n[v+1],v+1,h);if(!C)return null;p.push([w,C]),h=h||C.type}const x=o.parse(n[n.length-1],n.length-1,h);return x?new qf(h,p,x):null}evaluate(n){for(const[o,h]of this.branches)if(o.evaluate(n))return h.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[o,h]of this.branches)n(o),n(h);n(this.otherwise)}outputDefined(){return this.branches.every(([n,o])=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["case"];return this.eachChild(o=>{n.push(o.serialize())}),n}}class i0{constructor(n,o,h,p){this.type=n,this.input=o,this.beginIndex=h,this.endIndex=p}static parse(n,o){if(n.length<=2||n.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const h=o.parse(n[1],1,Gi),p=o.parse(n[2],2,Gr);if(!h||!p)return null;if(!sy(h.type,[io(Gi),wi,Gi]))return o.error(`Expected first argument to be of type array or string, but found ${ja(h.type)} instead`);if(n.length===4){const x=o.parse(n[3],3,Gr);return x?new i0(h.type,h,p,x):null}return new i0(h.type,h,p)}evaluate(n){const o=this.input.evaluate(n),h=this.beginIndex.evaluate(n);if(!Zm(o,["string","array"]))throw new oa(`Expected first argument to be of type array or string, but found ${ja($a(o))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(n);return o.slice(h,p)}return o.slice(h)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const n=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),n]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class s0{constructor(n,o){this.type=io(wi),this.str=n,this.delimiter=o}static parse(n,o){if(n.length!==3)return o.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const h=o.parse(n[1],1,wi),p=o.parse(n[2],2,wi);return h&&p?new s0(h,p):void 0}evaluate(n){const o=this.str.evaluate(n),h=this.delimiter.evaluate(n);return o.split(h)}eachChild(n){n(this.str),n(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function T2(l,n){return l==="=="||l==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function E2(l,n,o,h){return h.compare(n,o)===0}function Gf(l,n,o){const h=l!=="=="&&l!=="!=";return class y7{constructor(x,v,w){this.type=Ri,this.lhs=x,this.rhs=v,this.collator=w,this.hasUntypedArgument=x.type.kind==="value"||v.type.kind==="value"}static parse(x,v){if(x.length!==3&&x.length!==4)return v.error("Expected two or three arguments.");const w=x[0];let C=v.parse(x[1],1,Gi);if(!C)return null;if(!T2(w,C.type))return v.concat(1).error(`"${w}" comparisons are not supported for type '${ja(C.type)}'.`);let A=v.parse(x[2],2,Gi);if(!A)return null;if(!T2(w,A.type))return v.concat(2).error(`"${w}" comparisons are not supported for type '${ja(A.type)}'.`);if(C.type.kind!==A.type.kind&&C.type.kind!=="value"&&A.type.kind!=="value")return v.error(`Cannot compare types '${ja(C.type)}' and '${ja(A.type)}'.`);h&&(C.type.kind==="value"&&A.type.kind!=="value"?C=new Rr(A.type,[C]):C.type.kind!=="value"&&A.type.kind==="value"&&(A=new Rr(C.type,[A])));let k=null;if(x.length===4){if(C.type.kind!=="string"&&A.type.kind!=="string"&&C.type.kind!=="value"&&A.type.kind!=="value")return v.error("Cannot use collator to compare non-string types.");if(k=v.parse(x[3],3,Gm),!k)return null}return new y7(C,A,k)}evaluate(x){const v=this.lhs.evaluate(x),w=this.rhs.evaluate(x);if(h&&this.hasUntypedArgument){const C=$a(v),A=$a(w);if(C.kind!==A.kind||C.kind!=="string"&&C.kind!=="number")throw new oa(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${C.kind}, ${A.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const C=$a(v),A=$a(w);if(C.kind!=="string"||A.kind!=="string")return n(x,v,w)}return this.collator?o(x,v,w,this.collator.evaluate(x)):n(x,v,w)}eachChild(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)}outputDefined(){return!0}serialize(){const x=[l];return this.eachChild(v=>{x.push(v.serialize())}),x}}}const C2=Gf("==",function(l,n,o){return n===o},E2),A2=Gf("!=",function(l,n,o){return n!==o},function(l,n,o,h){return!E2(0,n,o,h)}),XA=Gf("<",function(l,n,o){return n<o},function(l,n,o,h){return h.compare(n,o)<0}),YA=Gf(">",function(l,n,o){return n>o},function(l,n,o,h){return h.compare(n,o)>0}),KA=Gf("<=",function(l,n,o){return n<=o},function(l,n,o,h){return h.compare(n,o)<=0}),a0=Gf(">=",function(l,n,o){return n>=o},function(l,n,o,h){return h.compare(n,o)>=0});class Cy{constructor(n,o,h,p,x,v){this.type=wi,this.number=n,this.locale=o,this.currency=h,this.unit=p,this.minFractionDigits=x,this.maxFractionDigits=v}static parse(n,o){if(n.length!==3)return o.error("Expected two arguments.");const h=o.parse(n[1],1,Gr);if(!h)return null;const p=n[2];if(typeof p!="object"||Array.isArray(p))return o.error("NumberFormat options argument must be an object.");let x=null;if(p.locale&&(x=o.parseObjectValue(p.locale,2,"locale",wi),!x))return null;let v=null;if(p.currency&&(v=o.parseObjectValue(p.currency,2,"currency",wi),!v))return null;let w=null;if(p.unit&&(w=o.parseObjectValue(p.unit,2,"unit",wi),!w))return null;let C=null;if(p["min-fraction-digits"]&&(C=o.parseObjectValue(p["min-fraction-digits"],2,"min-fraction-digits",Gr),!C))return null;let A=null;return p["max-fraction-digits"]&&(A=o.parseObjectValue(p["max-fraction-digits"],2,"max-fraction-digits",Gr),!A)?null:new Cy(h,x,v,w,C,A)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(n):void 0,unit:this.unit?this.unit.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.unit&&n(this.unit),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const n={};return this.locale&&(n.locale=this.locale.serialize()),this.currency&&(n.currency=this.currency.serialize()),this.unit&&(n.unit=this.unit.serialize()),this.minFractionDigits&&(n["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(n["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),n]}}class Ay{constructor(n){this.type=Gr,this.input=n}static parse(n,o){if(n.length!==2)return o.error(`Expected 1 argument, but found ${n.length-1} instead.`);const h=o.parse(n[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${ja(h.type)} instead.`):new Ay(h):null}evaluate(n){const o=this.input.evaluate(n);if(typeof o=="string"||Array.isArray(o))return o.length;throw new oa(`Expected value to be of type string or array, but found ${ja($a(o))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){const n=["length"];return this.eachChild(o=>{n.push(o.serialize())}),n}}function j2(l){return function(){l=1831565813+(l|=0)|0;let n=Math.imul(l^l>>>15,1|l);return n=n+Math.imul(n^n>>>7,61|n)^n,((n^n>>>14)>>>0)/4294967296}}const Wf={"==":C2,"!=":A2,">":YA,"<":XA,">=":a0,"<=":KA,array:Rr,at:Sy,"at-interpolated":Ty,boolean:Rr,case:qf,coalesce:sg,collator:Rf,format:Th,image:Cn,in:Ey,"index-of":og,interpolate:Nl,"interpolate-hcl":Nl,"interpolate-lab":Nl,length:Ay,let:ag,literal:zu,match:n0,number:Rr,"number-format":Cy,object:Rr,slice:i0,step:ng,string:Rr,"to-boolean":lu,"to-color":lu,"to-number":lu,"to-string":lu,var:Y_,within:Ch,distance:Ah,config:Vf,split:s0};function jy(l,[n,o,h,p]){n=n.evaluate(l),o=o.evaluate(l),h=h.evaluate(l);const x=p?p.evaluate(l):1,v=L_(n,o,h,x);if(v)throw new oa(v);return new Li(n/255,o/255,h/255,x)}function I2(l,[n,o,h,p]){n=n.evaluate(l),o=o.evaluate(l),h=h.evaluate(l);const x=p?p.evaluate(l):1,v=function(A,k,P,O){return typeof A=="number"&&A>=0&&A<=360?typeof k=="number"&&k>=0&&k<=100&&typeof P=="number"&&P>=0&&P<=100?O===void 0||typeof O=="number"&&O>=0&&O<=1?null:`Invalid hsla value [${[A,k,P,O].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof O=="number"?[A,k,P,O]:[A,k,P]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof O=="number"?[A,k,P,O]:[A,k,P]).join(", ")}]: 'h' must be between 0 and 360.`}(n,o,h,x);if(v)throw new oa(v);const w=`hsla(${n}, ${o}%, ${h}%, ${x})`,C=Li.parse(w);if(!C)throw new oa(`Failed to parse HSLA color: ${w}`);return C}function N2(l,n){return l in n}function o0(l,n){const o=n[l];return o===void 0?null:o}function Uu(l){return{type:l}}function lg(l){if(l instanceof Vf)return new Set([l.key]);let n=new Set;return l.eachChild(o=>{n=new Set([...n,...lg(o)])}),n}function l0(l){if(l instanceof ko&&l.name==="is-active-floor")return!0;let n=!1;return l.eachChild(o=>{!n&&l0(o)&&(n=!0)}),n}function Nh(l){return{result:"success",value:l}}function Md(l){return{result:"error",value:l}}function Iy(l,n){return!!l&&!!l.parameters&&l.parameters.indexOf(n)>-1}function c0(l){return l["property-type"]==="data-driven"}function Ny(l){return Iy(l.expression,"measure-light")}function ky(l){return Iy(l.expression,"zoom")}function u0(l){return!!l.expression&&l.expression.interpolated}function d0(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)}function Py(l){return l}function h0(l,n){const o=n.type==="color",h=l.stops&&typeof l.stops[0][0]=="object",p=h||!(h||l.property!==void 0),x=l.type||(u0(n)?"exponential":"interval");if(o&&((l=Object.assign({},l)).stops&&(l.stops=l.stops.map(A=>[A[0],Li.parse(A[1])])),l.default=Li.parse(l.default?l.default:n.default)),l.colorSpace&&l.colorSpace!=="rgb"&&!r0[l.colorSpace])throw new Error(`Unknown color space: ${l.colorSpace}`);let v,w,C;if(x==="exponential")v=k2;else if(x==="interval")v=Od;else if(x==="categorical"){v=JA,w=Object.create(null);for(const A of l.stops)w[A[0]]=A[1];C=typeof l.stops[0][0]}else{if(x!=="identity")throw new Error(`Unknown function type "${x}"`);v=QA}if(h){const A={},k=[];for(let G=0;G<l.stops.length;G++){const W=l.stops[G],te=W[0].zoom;A[te]===void 0&&(A[te]={zoom:te,type:l.type,property:l.property,default:l.default,stops:[]},k.push(te)),A[te].stops.push([W[0].value,W[1]])}const P=[];for(const G of k)P.push([A[G].zoom,h0(A[G],n)]);const O={name:"linear"};return{kind:"composite",interpolationType:O,interpolationFactor:Nl.interpolationFactor.bind(void 0,O),zoomStops:P.map(G=>G[0]),evaluate:({zoom:G},W)=>k2({stops:P,base:l.base},n,G).evaluate(G,W)}}if(p){const A=x==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:Nl.interpolationFactor.bind(void 0,A),zoomStops:l.stops.map(k=>k[0]),evaluate:({zoom:k})=>v(l,n,k,w,C)}}return{kind:"source",evaluate(A,k){const P=k&&k.properties?k.properties[l.property]:void 0;return P===void 0?Hf(l.default,n.default):v(l,n,P,w,C)}}}function Hf(l,n,o){return l!==void 0?l:n!==void 0?n:o!==void 0?o:void 0}function JA(l,n,o,h,p){return Hf(typeof o===p?h[o]:void 0,l.default,n.default)}function Od(l,n,o){if(!Ym(o))return Hf(l.default,n.default);const h=l.stops.length;if(h===1||o<=l.stops[0][0])return l.stops[0][1];if(o>=l.stops[h-1][0])return l.stops[h-1][1];const p=J_(l.stops.map(x=>x[0]),o);return l.stops[p][1]}function k2(l,n,o){const h=l.base!==void 0?l.base:1;if(!Ym(o))return Hf(l.default,n.default);const p=l.stops.length;if(p===1||o<=l.stops[0][0])return l.stops[0][1];if(o>=l.stops[p-1][0])return l.stops[p-1][1];const x=J_(l.stops.map(k=>k[0]),o),v=function(k,P,O,G){const W=G-O,te=k-O;return W===0?0:P===1?te/W:(Math.pow(P,te)-1)/(Math.pow(P,W)-1)}(o,h,l.stops[x][0],l.stops[x+1][0]),w=l.stops[x][1],C=l.stops[x+1][1];let A=Fu[n.type]||Py;if(l.colorSpace&&l.colorSpace!=="rgb"){const k=r0[l.colorSpace];A=(P,O)=>k.reverse(k.interpolate(k.forward(P),k.forward(O),v))}return typeof w.evaluate=="function"?{evaluate(...k){const P=w.evaluate.apply(void 0,k),O=C.evaluate.apply(void 0,k);if(P!==void 0&&O!==void 0)return A(P,O,v)}}:A(w,C,v)}function QA(l,n,o){return n.type==="color"?o=Li.parse(o):n.type==="formatted"?o=Ha.fromString(o.toString()):n.type==="resolvedImage"?o=el.build(o.toString()):Df(o)===n.type||n.type==="enum"&&n.values[o]||(o=void 0),Hf(o,l.default,n.default)}ko.register(Wf,{error:[{kind:"error"},[wi],(l,[n])=>{throw new oa(n.evaluate(l))}],typeof:[wi,[Gi],(l,[n])=>ja($a(n.evaluate(l)))],"to-rgba":[io(Gr,4),[ml],(l,[n])=>n.evaluate(l).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[io(Gr,4),[ml],(l,[n])=>n.evaluate(l).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[ml,[Gr,Gr,Gr],jy],rgba:[ml,[Gr,Gr,Gr,Gr],jy],hsl:[ml,[Gr,Gr,Gr],I2],hsla:[ml,[Gr,Gr,Gr,Gr],I2],has:{type:Ri,overloads:[[[wi],(l,[n])=>N2(n.evaluate(l),l.properties())],[[wi,kf],(l,[n,o])=>N2(n.evaluate(l),o.evaluate(l))]]},get:{type:Gi,overloads:[[[wi],(l,[n])=>o0(n.evaluate(l),l.properties())],[[wi,kf],(l,[n,o])=>o0(n.evaluate(l),o.evaluate(l))]]},"feature-state":[Gi,[wi],(l,[n])=>o0(n.evaluate(l),l.featureState||{})],properties:[kf,[],l=>l.properties()],"geometry-type":[wi,[],l=>l.geometryType()],worldview:[wi,[],l=>l.globals.worldview||""],"is-active-floor":[Ri,Uu(wi),(l,n)=>{if(!(l.globals.activeFloors&&l.globals.activeFloors.size>0))return!1;const o=l.globals.activeFloors;return n.some(h=>{const p=h.evaluate(l);return o.has(p)})}],id:[Gi,[],l=>l.id()],zoom:[Gr,[],l=>l.globals.zoom],pitch:[Gr,[],l=>l.globals.pitch||0],"distance-from-center":[Gr,[],l=>l.distanceFromCenter()],"measure-light":[Gr,[wi],(l,[n])=>l.measureLight(n.evaluate(l))],"heatmap-density":[Gr,[],l=>l.globals.heatmapDensity||0],"line-progress":[Gr,[],l=>l.globals.lineProgress||0],"raster-value":[Gr,[],l=>l.globals.rasterValue||0],"raster-particle-speed":[Gr,[],l=>l.globals.rasterParticleSpeed||0],"sky-radial-progress":[Gr,[],l=>l.globals.skyRadialProgress||0],accumulated:[Gi,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[Gr,Uu(Gr),(l,n)=>{let o=0;for(const h of n)o+=h.evaluate(l);return o}],"*":[Gr,Uu(Gr),(l,n)=>{let o=1;for(const h of n)o*=h.evaluate(l);return o}],"-":{type:Gr,overloads:[[[Gr,Gr],(l,[n,o])=>n.evaluate(l)-o.evaluate(l)],[[Gr],(l,[n])=>-n.evaluate(l)]]},"/":[Gr,[Gr,Gr],(l,[n,o])=>n.evaluate(l)/o.evaluate(l)],"%":[Gr,[Gr,Gr],(l,[n,o])=>n.evaluate(l)%o.evaluate(l)],ln2:[Gr,[],()=>Math.LN2],pi:[Gr,[],()=>Math.PI],e:[Gr,[],()=>Math.E],"^":[Gr,[Gr,Gr],(l,[n,o])=>Math.pow(n.evaluate(l),o.evaluate(l))],sqrt:[Gr,[Gr],(l,[n])=>Math.sqrt(n.evaluate(l))],log10:[Gr,[Gr],(l,[n])=>Math.log(n.evaluate(l))/Math.LN10],ln:[Gr,[Gr],(l,[n])=>Math.log(n.evaluate(l))],log2:[Gr,[Gr],(l,[n])=>Math.log2(n.evaluate(l))],sin:[Gr,[Gr],(l,[n])=>Math.sin(n.evaluate(l))],cos:[Gr,[Gr],(l,[n])=>Math.cos(n.evaluate(l))],tan:[Gr,[Gr],(l,[n])=>Math.tan(n.evaluate(l))],asin:[Gr,[Gr],(l,[n])=>Math.asin(n.evaluate(l))],acos:[Gr,[Gr],(l,[n])=>Math.acos(n.evaluate(l))],atan:[Gr,[Gr],(l,[n])=>Math.atan(n.evaluate(l))],min:[Gr,Uu(Gr),(l,n)=>Math.min(...n.map(o=>o.evaluate(l)))],max:[Gr,Uu(Gr),(l,n)=>Math.max(...n.map(o=>o.evaluate(l)))],abs:[Gr,[Gr],(l,[n])=>Math.abs(n.evaluate(l))],round:[Gr,[Gr],(l,[n])=>{const o=n.evaluate(l);return o<0?-Math.round(-o):Math.round(o)}],floor:[Gr,[Gr],(l,[n])=>Math.floor(n.evaluate(l))],ceil:[Gr,[Gr],(l,[n])=>Math.ceil(n.evaluate(l))],"filter-==":[Ri,[wi,Gi],(l,[n,o])=>l.properties()[n.value]===o.value],"filter-id-==":[Ri,[Gi],(l,[n])=>l.id()===n.value],"filter-type-==":[Ri,[wi],(l,[n])=>l.geometryType()===n.value],"filter-<":[Ri,[wi,Gi],(l,[n,o])=>{const h=l.properties()[n.value],p=o.value;return typeof h==typeof p&&h<p}],"filter-id-<":[Ri,[Gi],(l,[n])=>{const o=l.id(),h=n.value;return typeof o==typeof h&&o<h}],"filter->":[Ri,[wi,Gi],(l,[n,o])=>{const h=l.properties()[n.value],p=o.value;return typeof h==typeof p&&h>p}],"filter-id->":[Ri,[Gi],(l,[n])=>{const o=l.id(),h=n.value;return typeof o==typeof h&&o>h}],"filter-<=":[Ri,[wi,Gi],(l,[n,o])=>{const h=l.properties()[n.value],p=o.value;return typeof h==typeof p&&h<=p}],"filter-id-<=":[Ri,[Gi],(l,[n])=>{const o=l.id(),h=n.value;return typeof o==typeof h&&o<=h}],"filter->=":[Ri,[wi,Gi],(l,[n,o])=>{const h=l.properties()[n.value],p=o.value;return typeof h==typeof p&&h>=p}],"filter-id->=":[Ri,[Gi],(l,[n])=>{const o=l.id(),h=n.value;return typeof o==typeof h&&o>=h}],"filter-has":[Ri,[Gi],(l,[n])=>n.value in l.properties()],"filter-has-id":[Ri,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[Ri,[io(wi)],(l,[n])=>n.value.indexOf(l.geometryType())>=0],"filter-id-in":[Ri,[io(Gi)],(l,[n])=>n.value.indexOf(l.id())>=0],"filter-in-small":[Ri,[wi,io(Gi)],(l,[n,o])=>o.value.indexOf(l.properties()[n.value])>=0],"filter-in-large":[Ri,[wi,io(Gi)],(l,[n,o])=>function(h,p,x,v){for(;x<=v;){const w=x+v>>1;if(p[w]===h)return!0;p[w]>h?v=w-1:x=w+1}return!1}(l.properties()[n.value],o.value,0,o.value.length-1)],all:{type:Ri,overloads:[[[Ri,Ri],(l,[n,o])=>n.evaluate(l)&&o.evaluate(l)],[Uu(Ri),(l,n)=>{for(const o of n)if(!o.evaluate(l))return!1;return!0}]]},any:{type:Ri,overloads:[[[Ri,Ri],(l,[n,o])=>n.evaluate(l)||o.evaluate(l)],[Uu(Ri),(l,n)=>{for(const o of n)if(o.evaluate(l))return!0;return!1}]]},"!":[Ri,[Ri],(l,[n])=>!n.evaluate(l)],"is-supported-script":[Ri,[wi],(l,[n])=>{const o=l.globals&&l.globals.isSupportedScript;return!o||o(n.evaluate(l))}],upcase:[wi,[wi],(l,[n])=>n.evaluate(l).toUpperCase()],downcase:[wi,[wi],(l,[n])=>n.evaluate(l).toLowerCase()],concat:[wi,Uu(Gi),(l,n)=>n.map(o=>ou(o.evaluate(l))).join("")],"resolved-locale":[wi,[Gm],(l,[n])=>n.evaluate(l).resolvedLocale()],random:[Gr,[Gr,Gr,Gi],(l,n)=>{const[o,h,p]=n.map(v=>v.evaluate(l));if(o>h||o===h)return o;let x;if(typeof p=="string")x=function(v){let w=0;if(v.length===0)return w;for(let C=0;C<v.length;C++)w=(w<<5)-w+v.charCodeAt(C),w|=0;return w}(p);else{if(typeof p!="number")throw new oa(`Invalid seed input: ${p}`);x=p}return o+j2(x)()*(h-o)}]});class f0{constructor(n,o,h,p,x){this.expression=n,this._warningHistory={},this._scope=h,this._options=p,this._iconImageUseTheme=x,this._evaluator=new so(h,p,x),this._defaultValue=o?function(v){return v.type==="color"&&(d0(v.default)||Array.isArray(v.default))?new Li(0,0,0,0):v.type==="color"?Li.parse(v.default)||null:v.default===void 0?null:v.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null,this.configDependencies=lg(n),this.isIndoorDependent=l0(n)}evaluateWithoutErrorHandling(n,o,h,p,x,v,w,C){return this._evaluator.globals=n,this._evaluator.feature=o,this._evaluator.featureState=h,this._evaluator.canonical=p||null,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=v,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=C||null,this.expression.evaluate(this._evaluator)}evaluate(n,o,h,p,x,v,w,C,A){this._evaluator||(this._evaluator=new so(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=n,this._evaluator.feature=o||null,this._evaluator.featureState=h||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=v||null,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=C||null,this._evaluator.iconImageUseTheme=A||null;try{const k=this.expression.evaluate(this._evaluator);if(k==null||typeof k=="number"&&k!=k)return this._defaultValue;if(this._enumValues&&!(k in this._enumValues))throw new oa(`Expected value to be one of ${Object.keys(this._enumValues).map(P=>JSON.stringify(P)).join(", ")}, but found ${JSON.stringify(k)} instead.`);return k}catch(k){return this._warningHistory[k.message]||(this._warningHistory[k.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${k.message}`)),this._defaultValue}}}function p0(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in Wf}function uu(l,n,o,h,p){const x=new K_(Wf,[],n?function(w){const C={color:ml,string:wi,number:Gr,enum:wi,boolean:Ri,formatted:Sh,resolvedImage:Wm};return w.type==="array"?io(C[w.value]||Gi,w.length):C[w.type]}(n):void 0,void 0,void 0,o,h,p),v=x.parse(l,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return v?Nh(new f0(v,n,o,h,p)):Md(x.errors)}class cg{constructor(n,o,h,p){this.kind=n,this._styleExpression=o,this.isLightConstant=h,this.isLineProgressConstant=p,this.isStateDependent=n!=="constant"&&!rg(o.expression),this.configDependencies=lg(o.expression),this.isIndoorDependent=l0(o.expression)}evaluateWithoutErrorHandling(n,o,h,p,x,v){return this._styleExpression.evaluateWithoutErrorHandling(n,o,h,p,x,v)}evaluate(n,o,h,p,x,v,w){return this._styleExpression.evaluate(n,o,h,p,x,v,void 0,void 0,w)}}class Fd{constructor(n,o,h,p,x,v){this.kind=n,this.zoomStops=h,this._styleExpression=o,this.isStateDependent=n!=="camera"&&!rg(o.expression),this.isIndoorDependent=l0(o.expression),this.isLightConstant=x,this.isLineProgressConstant=v,this.configDependencies=lg(o.expression),this.interpolationType=p}evaluateWithoutErrorHandling(n,o,h,p,x,v){return this._styleExpression.evaluateWithoutErrorHandling(n,o,h,p,x,v)}evaluate(n,o,h,p,x,v){return this._styleExpression.evaluate(n,o,h,p,x,v)}interpolationFactor(n,o,h){return this.interpolationType?Nl.interpolationFactor(this.interpolationType,n,o,h):0}}function Dy(l,n,o,h,p){if((l=uu(l,n,o,h,p)).result==="error")return l;const x=l.value.expression,v=Bf(x);if(!v&&!c0(n))return Md([new ic("","data expressions not supported")]);const w=Uf(x,["zoom","pitch","distance-from-center"]);if(!w&&!ky(n))return Md([new ic("","zoom expressions not supported")]);const C=Uf(x,["measure-light"]);if(!C&&!Ny(n))return Md([new ic("","measure-light expression not supported")]);const A=Uf(x,["line-progress"]);if(!A&&!function(O){return Iy(O.expression,"line-progress")}(n))return Md([new ic("","line-progress expression not supported")]);const k=n.expression&&n.expression.relaxZoomRestriction,P=g0(x);return P||w||k?P instanceof ic?Md([P]):P instanceof Nl&&!u0(n)?Md([new ic("",'"interpolate" expressions cannot be used with this property')]):Nh(P?new Fd(v&&A?"camera":"composite",l.value,P.labels,P instanceof Nl?P.interpolation:void 0,C,A):new cg(v&&A?"constant":"source",l.value,C,A)):Md([new ic("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class m0{constructor(n,o){this._parameters=n,this._specification=o,Object.assign(this,h0(this._parameters,this._specification))}static deserialize(n){return new m0(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function g0(l){let n=null;if(l instanceof ag)n=g0(l.result);else if(l instanceof sg){for(const o of l.args)if(n=g0(o),n)break}else(l instanceof ng||l instanceof Nl)&&l.input instanceof ko&&l.input.name==="zoom"&&(n=l);return n instanceof ic||l.eachChild(o=>{const h=g0(o);h instanceof ic?n=h:n&&h&&n!==h&&(n=new ic("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}var ug,_0,P2=function(){if(_0)return ug;_0=1,ug=n;var l=3;function n(o,h,p){var x=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var v=new Int32Array(this.arrayBuffer);o=v[0],this.d=(h=v[1])+2*(p=v[2]);for(var w=0;w<this.d*this.d;w++){var C=v[l+w],A=v[l+w+1];x.push(C===A?null:v.subarray(C,A))}var k=v[l+x.length+1];this.keys=v.subarray(v[l+x.length],k),this.bboxes=v.subarray(k),this.insert=this._insertReadonly}else{this.d=h+2*p;for(var P=0;P<this.d*this.d;P++)x.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=o,this.padding=p,this.scale=h/o,this.uid=0;var O=p/h*o;this.min=-O,this.max=o+O}return n.prototype.insert=function(o,h,p,x,v){this._forEachCell(h,p,x,v,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(x),this.bboxes.push(v)},n.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},n.prototype._insertCell=function(o,h,p,x,v,w){this.cells[v].push(w)},n.prototype.query=function(o,h,p,x,v){var w=this.min,C=this.max;if(o<=w&&h<=w&&C<=p&&C<=x&&!v)return Array.prototype.slice.call(this.keys);var A=[];return this._forEachCell(o,h,p,x,this._queryCell,A,{},v),A},n.prototype._queryCell=function(o,h,p,x,v,w,C,A){var k=this.cells[v];if(k!==null)for(var P=this.keys,O=this.bboxes,G=0;G<k.length;G++){var W=k[G];if(C[W]===void 0){var te=4*W;(A?A(O[te+0],O[te+1],O[te+2],O[te+3]):o<=O[te+2]&&h<=O[te+3]&&p>=O[te+0]&&x>=O[te+1])?(C[W]=!0,w.push(P[W])):C[W]=!1}}},n.prototype._forEachCell=function(o,h,p,x,v,w,C,A){for(var k=this._convertToCellCoord(o),P=this._convertToCellCoord(h),O=this._convertToCellCoord(p),G=this._convertToCellCoord(x),W=k;W<=O;W++)for(var te=P;te<=G;te++){var se=this.d*te+W;if((!A||A(this._convertFromCellCoord(W),this._convertFromCellCoord(te),this._convertFromCellCoord(W+1),this._convertFromCellCoord(te+1)))&&v.call(this,o,h,p,x,se,w,C,A))return}},n.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},n.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},n.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,h=l+this.cells.length+1+1,p=0,x=0;x<this.cells.length;x++)p+=this.cells[x].length;var v=new Int32Array(h+p+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;for(var w=h,C=0;C<o.length;C++){var A=o[C];v[l+C]=w,v.set(A,w),w+=A.length}return v[l+o.length]=w,v.set(this.keys,w),v[l+o.length+1]=w+=this.keys.length,v.set(this.bboxes,w),w+=this.bboxes.length,v.buffer},ug}(),kh=hn(P2);const Zf={};function Tr(l,n,o={}){Object.defineProperty(l,"_classRegistryKey",{value:n,writable:!1}),Zf[n]={klass:l,omit:o.omit||[]}}Tr(Object,"Object"),kh.serialize=function(l,n){const o=l.toArrayBuffer();return n&&n.add(o),{buffer:o}},kh.deserialize=function(l){return new kh(l.buffer)},Object.defineProperty(kh,"name",{value:"Grid"}),Tr(kh,"Grid"),delete At.prototype.constructor,typeof DOMMatrix<"u"&&Tr(DOMMatrix,"DOMMatrix"),Tr(Li,"Color"),Tr(Error,"Error"),Tr(Ha,"Formatted"),Tr(Xm,"FormattedSection"),Tr(wh,"AJAXError"),Tr(el,"ResolvedImage"),Tr(m0,"StylePropertyFunction"),Tr(f0,"StyleExpression",{omit:["_evaluator"]}),Tr(Ra,"ImageId"),Tr(Lu,"ImageVariant"),Tr(Fd,"ZoomDependentExpression"),Tr(cg,"ZoomConstantExpression"),Tr(ko,"CompoundExpression",{omit:["_evaluate"]});for(const l in Wf)Zf[Wf[l]._classRegistryKey]||Tr(Wf[l],`Expression${l}`);function Ry(l){return l&&typeof ArrayBuffer<"u"&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function Vu(l){return self.ImageBitmap&&l instanceof ImageBitmap}function Ld(l,n){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp)return l;if(Ry(l)||Vu(l))return n&&n.add(l),l;if(ArrayBuffer.isView(l))return n&&n.add(l.buffer),l;if(l instanceof ImageData)return n&&n.add(l.data.buffer),l;if(Array.isArray(l)){const o=[];for(const h of l)o.push(Ld(h,n));return o}if(l instanceof Map){const o={$name:"Map",entries:[]};for(const[h,p]of l.entries())o.entries.push(Ld(h),Ld(p,n));return o}if(l instanceof Set){const o={$name:"Set"};let h=0;for(const p of l.values())o[++h]=Ld(p);return o}if(l instanceof DOMMatrix){const o={$name:"DOMMatrix"},h=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const p of h)o[p]=l[p];return o}if(typeof l=="bigint")return{$name:"BigInt",value:l.toString()};if(typeof l=="object"){const o=l.constructor,h=o._classRegistryKey;if(!h)throw new Error(`Can't serialize object of unregistered class "${o.name}".`);const p=o.serialize?o.serialize(l,n):{};if(!o.serialize){for(const x in l)l.hasOwnProperty(x)&&(Zf[h].omit.indexOf(x)>=0||(p[x]=Ld(l[x],n)));l instanceof Error&&(p.message=l.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(p.$name=h),p}throw new Error("can't serialize object of type "+typeof l)}function zd(l){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||Ry(l)||Vu(l)||ArrayBuffer.isView(l)||l instanceof ImageData)return l;if(Array.isArray(l))return l.map(zd);if(typeof l=="object"){const n=l.$name||"Object";if(n==="Map"){const p=l.entries||[],x=new Map;for(let v=0;v<p.length;v+=2)x.set(zd(p[v]),zd(p[v+1]));return x}if(n==="Set"){const p=new Set;for(const x of Object.keys(l))x!=="$name"&&p.add(zd(l[x]));return p}if(n==="DOMMatrix"){let p;return p=l.is2D?[l.a,l.b,l.c,l.d,l.e,l.f]:[l.m11,l.m12,l.m13,l.m14,l.m21,l.m22,l.m23,l.m24,l.m31,l.m32,l.m33,l.m34,l.m41,l.m42,l.m43,l.m44],new DOMMatrix(p)}if(n==="BigInt")return BigInt(l.value);const{klass:o}=Zf[n];if(!o)throw new Error(`Can't deserialize unregistered class "${n}".`);if(o.deserialize)return o.deserialize(l);const h=Object.create(o.prototype);for(const p of Object.keys(l))p!=="$name"&&(h[p]=zd(l[p]));return h}throw new Error("can't deserialize object of type "+typeof l)}const an={"Latin-1 Supplement":l=>l>=128&&l<=255,Arabic:l=>l>=1536&&l<=1791,"Arabic Supplement":l=>l>=1872&&l<=1919,"Arabic Extended-A":l=>l>=2208&&l<=2303,"Hangul Jamo":l=>l>=4352&&l<=4607,"Unified Canadian Aboriginal Syllabics":l=>l>=5120&&l<=5759,Khmer:l=>l>=6016&&l<=6143,"Unified Canadian Aboriginal Syllabics Extended":l=>l>=6320&&l<=6399,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"CJK Radicals Supplement":l=>l>=11904&&l<=12031,"Kangxi Radicals":l=>l>=12032&&l<=12255,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Hiragana:l=>l>=12352&&l<=12447,Katakana:l=>l>=12448&&l<=12543,Bopomofo:l=>l>=12544&&l<=12591,"Hangul Compatibility Jamo":l=>l>=12592&&l<=12687,Kanbun:l=>l>=12688&&l<=12703,"Bopomofo Extended":l=>l>=12704&&l<=12735,"CJK Strokes":l=>l>=12736&&l<=12783,"Katakana Phonetic Extensions":l=>l>=12784&&l<=12799,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"CJK Unified Ideographs Extension A":l=>l>=13312&&l<=19903,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"CJK Unified Ideographs":l=>l>=19968&&l<=40959,"Yi Syllables":l=>l>=40960&&l<=42127,"Yi Radicals":l=>l>=42128&&l<=42191,"Hangul Jamo Extended-A":l=>l>=43360&&l<=43391,"Hangul Syllables":l=>l>=44032&&l<=55215,"Hangul Jamo Extended-B":l=>l>=55216&&l<=55295,"Private Use Area":l=>l>=57344&&l<=63743,"CJK Compatibility Ideographs":l=>l>=63744&&l<=64255,"Arabic Presentation Forms-A":l=>l>=64336&&l<=65023,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Arabic Presentation Forms-B":l=>l>=65136&&l<=65279,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519,Osage:l=>l>=66736&&l<=66815,"CJK Unified Ideographs Extension B":l=>l>=131072&&l<=173791};function My(l){for(const n of l)if(v0(n.charCodeAt(0)))return!0;return!1}function D2(l){for(const n of l)if(!x0(n.charCodeAt(0)))return!1;return!0}function x0(l){return!(an.Arabic(l)||an["Arabic Supplement"](l)||an["Arabic Extended-A"](l)||an["Arabic Presentation Forms-A"](l)||an["Arabic Presentation Forms-B"](l))}function v0(l){return!(l!==746&&l!==747&&(l<4352||!(an["Bopomofo Extended"](l)||an.Bopomofo(l)||an["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||an["CJK Compatibility Ideographs"](l)||an["CJK Compatibility"](l)||an["CJK Radicals Supplement"](l)||an["CJK Strokes"](l)||!(!an["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||an["CJK Unified Ideographs Extension A"](l)||an["CJK Unified Ideographs"](l)||an["Enclosed CJK Letters and Months"](l)||an["Hangul Compatibility Jamo"](l)||an["Hangul Jamo Extended-A"](l)||an["Hangul Jamo Extended-B"](l)||an["Hangul Jamo"](l)||an["Hangul Syllables"](l)||an.Hiragana(l)||an["Ideographic Description Characters"](l)||an.Kanbun(l)||an["Kangxi Radicals"](l)||an["Katakana Phonetic Extensions"](l)||an.Katakana(l)&&l!==12540||!(!an["Halfwidth and Fullwidth Forms"](l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!an["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||an["Unified Canadian Aboriginal Syllabics"](l)||an["Unified Canadian Aboriginal Syllabics Extended"](l)||an["Vertical Forms"](l)||an["Yijing Hexagram Symbols"](l)||an["Yi Syllables"](l)||an["Yi Radicals"](l))))}function Oy(l){return!(v0(l)||function(n){return!!(an["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||an["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||an["Letterlike Symbols"](n)||an["Number Forms"](n)||an["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||an["Control Pictures"](n)&&n!==9251||an["Optical Character Recognition"](n)||an["Enclosed Alphanumerics"](n)||an["Geometric Shapes"](n)||an["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||an["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||an["CJK Symbols and Punctuation"](n)||an.Katakana(n)||an["Private Use Area"](n)||an["CJK Compatibility Forms"](n)||an["Small Form Variants"](n)||an["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(l))}function Fy(l){return an.Arabic(l)||an["Arabic Supplement"](l)||an["Arabic Extended-A"](l)||an["Arabic Presentation Forms-A"](l)||an["Arabic Presentation Forms-B"](l)}function R2(l){return l>=1424&&l<=2303||an["Arabic Presentation Forms-A"](l)||an["Arabic Presentation Forms-B"](l)}function ej(l,n){return!(!n&&R2(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||an.Khmer(l))}function tj(l){for(const n of l)if(R2(n.charCodeAt(0)))return!0;return!1}const gl={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Ly=null,Uo=gl.unavailable,Bd=null;const M2=function(l){l&&typeof l=="string"&&l.indexOf("NetworkError")>-1&&(Uo=gl.error),Ly&&Ly(l)};function zy(){By.fire(new jl("pluginStateChange",{pluginStatus:Uo,pluginURL:Bd}))}const By=new Ou,Uy=function(){return Uo},Vy=function(){if(Uo!==gl.deferred||!Bd)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Uo=gl.loading,zy(),Bd&&jf({url:Bd},l=>{l?M2(l):(Uo=gl.loaded,zy())})},_l={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Uo===gl.loaded||_l.applyArabicShaping!=null,isLoading:()=>Uo===gl.loading,setState(l){Uo=l.pluginStatus,Bd=l.pluginURL},isParsing:()=>Uo===gl.parsing,isParsed:()=>Uo===gl.parsed,getPluginURL:()=>Bd};class us{constructor(n,o){this.zoom=n,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.transition=o.transition,this.pitch=o.pitch,this.brightness=o.brightness,this.worldview=o.worldview,this.activeFloors=o.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(n){return function(o,h){for(const p of o)if(!ej(p.charCodeAt(0),h))return!1;return!0}(n,_l.isLoaded())}}class dg{constructor(n,o,h,p,x){this.property=n,this.value=o,this.expression=function(v,w,C,A,k){if(d0(v))return new m0(v,w);if(p0(v)||Array.isArray(v)&&v.length>0){const P=Dy(v,w,C,A,k);if(P.result==="error")throw new Error(P.value.map(O=>`${O.key}: ${O.message}`).join(", "));return P.value}{let P=v;return typeof v=="string"&&w.type==="color"&&(P=Li.parse(v)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>P}}}(o===void 0?n.specification.default:o,n.specification,h,p,x)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,o,h,p){return this.property.possiblyEvaluate(this,n,o,h,p)}}class Xf{constructor(n,o,h,p){this.property=n,this.value=new dg(n,void 0,o,h,p)}transitioned(n,o){return new F2(this.property,this.value,o,Object.assign({},n.transition,this.transition),n.now)}untransitioned(){return new F2(this.property,this.value,null,{},0)}}class O2{constructor(n,o,h,p){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues),this._scope=o,this._options=h,this._iconImageUseTheme=p,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(n){return Ut(this._values[n].value.value)}setValue(n,o){this._values.hasOwnProperty(n)||(this._values[n]=new Xf(this._values[n].property,this._scope,this._options,this._iconImageUseTheme)),this._values[n].value=new dg(this._values[n].property,o===null?void 0:Ut(o),this._scope,this._options,this._iconImageUseTheme),this._values[n].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[n].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[n].value.isIndoorDependent())}setTransitionOrValue(n,o){o&&(this._options=o);const h=this._properties.properties;if(n)for(const p in n){const x=n[p];if(p.endsWith("-transition")){const v=p.slice(0,-11);h[v]&&this.setTransition(v,x)}else h.hasOwnProperty(p)&&this.setValue(p,x)}}getTransition(n){return Ut(this._values[n].transition)}setTransition(n,o){this._values.hasOwnProperty(n)||(this._values[n]=new Xf(this._values[n].property)),this._values[n].transition=Ut(o)||void 0}serialize(){const n={};for(const o of Object.keys(this._values)){const h=this.getValue(o);h!==void 0&&(n[o]=h);const p=this.getTransition(o);p!==void 0&&(n[`${o}-transition`]=p)}return n}transitioned(n,o){const h=new $u(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].transitioned(n,o._values[p]);return h}untransitioned(){const n=new $u(this._properties);for(const o of Object.keys(this._values))n._values[o]=this._values[o].untransitioned();return n}isIndoorDependent(){return this._isIndoorDependent}}class F2{constructor(n,o,h,p,x){const v=p.delay||0,w=p.duration||0;x=x||0,this.property=n,this.value=o,this.begin=x+v,this.end=this.begin+w,n.specification.transition&&(p.delay||p.duration)&&(this.prior=h)}possiblyEvaluate(n,o,h){const p=n.now||0,x=this.value.possiblyEvaluate(n,o,h),v=this.prior;if(v){if(p>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(p<this.begin)return v.possiblyEvaluate(n,o,h);{const w=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(n,o,h),x,Ae(w))}}return x}}class $u{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,o,h){const p=new Ph(this._properties);for(const x of Object.keys(this._values))p._values[x]=this._values[x].possiblyEvaluate(n,o,h);return p}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class $y{constructor(n,o,h,p){this._properties=n,this._values=Object.create(n.defaultPropertyValues),this._scope=o,this._options=h,this._iconImageUseTheme=p,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(n){return Ut(this._values[n].value)}setValue(n,o){this._values[n]=new dg(this._values[n].property,o===null?void 0:Ut(o),this._scope,this._options,this._iconImageUseTheme),this._values[n].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[n].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[n].isIndoorDependent())}serialize(){const n={};for(const o of Object.keys(this._values)){const h=this.getValue(o);h!==void 0&&(n[o]=h)}return n}possiblyEvaluate(n,o,h,p){const x=new Ph(this._properties);for(const v of Object.keys(this._values))x._values[v]=this._values[v].possiblyEvaluate(n,o,h,p);return x}isIndoorDependent(){return this._isIndoorDependent}}class cc{constructor(n,o,h,p){this.property=n,this.value=o,this.parameters=h,this.iconImageUseTheme=p}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,o,h,p){return this.property.evaluate(this.value,this.parameters,n,o,h,p,this.iconImageUseTheme)}}class Ph{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class er{constructor(n){this.specification=n}possiblyEvaluate(n,o){return n.expression.evaluate(o)}interpolate(n,o,h){const p=Fu[this.specification.type];return p?p(n,o,h):n}}class mr{constructor(n,o){this.specification=n,this.overrides=o}possiblyEvaluate(n,o,h,p,x){return n.expression.kind==="constant"||n.expression.kind==="camera"?new cc(this,{kind:"constant",value:n.expression.evaluate(o,null,{},h,p,void 0,x)},o):new cc(this,n.expression,o,x)}interpolate(n,o,h){if(n.value.kind!=="constant"||o.value.kind!=="constant")return n;if(n.value.value===void 0||o.value.value===void 0)return new cc(this,{kind:"constant",value:void 0},n.parameters);const p=Fu[this.specification.type];return p?new cc(this,{kind:"constant",value:p(n.value.value,o.value.value,h)},n.parameters):n}evaluate(n,o,h,p,x,v,w){return n.kind==="constant"?n.value:n.evaluate(o,h,p,x,v,void 0,w)}}class Yf{constructor(n){this.specification=n}possiblyEvaluate(n,o,h,p){return!!n.expression.evaluate(o,null,{},h,p)}interpolate(){return!1}}class Zs{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const o=new us(0,{});for(const h in n){const p=n[h];p.specification.overridable&&this.overridableProperties.push(h);const x=this.defaultPropertyValues[h]=new dg(p,void 0),v=this.defaultTransitionablePropertyValues[h]=new Xf(p);this.defaultTransitioningPropertyValues[h]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=x.possiblyEvaluate(o)}}}Tr(mr,"DataDrivenProperty"),Tr(er,"DataConstantProperty"),Tr(Yf,"ColorRampProperty");var at=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function qy(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function Kf(l){if(Array.isArray(l))return l.map(Kf);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){const n={};for(const o in l)n[o]=Kf(l[o]);return n}return qy(l)}function Jf(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(const n of l.slice(1))if(!Jf(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}function y0(l,n="",o=null,h="fill"){if(l==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Jf(l)||(l=kl(l));const p=l;let x=!0;try{x=function(k){if(!ep(k))return k;let P=Kf(k);return Qf(P),P=w0(P),P}(p)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(p,null,2)}
        `)}let v=null,w=null;if(h!=="background"&&h!=="sky"&&h!=="slot"){w=at[`filter_${h}`];const k=uu(x,w,n,o);if(k.result==="error")throw new Error(k.value.map(P=>`${P.key}: ${P.message}`).join(", "));v=(P,O,G)=>k.value.evaluate(P,O,{},G)}let C=null,A=null;if(x!==p){const k=uu(p,w,n,o);if(k.result==="error")throw new Error(k.value.map(P=>`${P.key}: ${P.message}`).join(", "));C=(P,O,G,W,te)=>k.value.evaluate(P,O,{},G,void 0,void 0,W,te),A=!Bf(k.value.expression)}return{filter:v,dynamicFilter:C||void 0,needGeometry:z2(x),needFeature:!!A}}function w0(l){if(!Array.isArray(l))return l;const n=function(o){if(rj.has(o[0])){for(let h=1;h<o.length;h++)if(ep(o[h]))return!0}return o}(l);return n===!0?n:n.map(o=>w0(o))}function Qf(l){let n=!1;const o=[];if(l[0]==="case"){for(let h=1;h<l.length-1;h+=2)n=n||ep(l[h]),o.push(l[h+1]);o.push(l[l.length-1])}else if(l[0]==="match"){n=n||ep(l[1]);for(let h=2;h<l.length-1;h+=2)o.push(l[h+1]);o.push(l[l.length-1])}else if(l[0]==="step"){n=n||ep(l[1]);for(let h=1;h<l.length-1;h+=2)o.push(l[h+1])}n&&(l.length=0,l.push("any",...o));for(let h=1;h<l.length;h++)Qf(l[h])}function ep(l){if(!Array.isArray(l))return!1;if((n=l[0])==="pitch"||n==="distance-from-center")return!0;var n;for(let o=1;o<l.length;o++)if(ep(l[o]))return!0;return!1}const rj=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function L2(l,n){return l<n?-1:l>n?1:0}function z2(l){if(!Array.isArray(l))return!1;if(l[0]==="within"||l[0]==="distance")return!0;for(let n=1;n<l.length;n++)if(z2(l[n]))return!0;return!1}function kl(l){if(!l)return!0;const n=l[0];return l.length<=1?n!=="any":n==="=="?Gy(l[1],l[2],"=="):n==="!="?b0(Gy(l[1],l[2],"==")):n==="<"||n===">"||n==="<="||n===">="?Gy(l[1],l[2],n):n==="any"?(o=l.slice(1),["any"].concat(o.map(kl))):n==="all"?["all"].concat(l.slice(1).map(kl)):n==="none"?["all"].concat(l.slice(1).map(kl).map(b0)):n==="in"?Wy(l[1],l.slice(2)):n==="!in"?b0(Wy(l[1],l.slice(2))):n==="has"?B2(l[1]):n!=="!has"||b0(B2(l[1]));var o}function Gy(l,n,o){switch(l){case"$type":return[`filter-type-${o}`,n];case"$id":return[`filter-id-${o}`,n];default:return[`filter-${o}`,l,n]}}function Wy(l,n){if(n.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(o=>typeof o!=typeof n[0])?["filter-in-large",l,["literal",n.sort(L2)]]:["filter-in-small",l,["literal",n]]}}function B2(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function b0(l){return["!",l]}const hg="";function Dh(l,n){return n?`${l}${hg}${n}`:l}let U2;const V2=()=>U2||(U2=new Zs({"icon-size":new mr(at.layout_symbol["icon-size"]),"icon-image":new mr(at.layout_symbol["icon-image"]),"icon-rotate":new mr(at.layout_symbol["icon-rotate"]),"icon-offset":new mr(at.layout_symbol["icon-offset"])}));class nj{constructor(n,o,h,p,x,v){this.cachedIconPrimary=null;const w=uu(n,at.appearance.condition);if(w.result==="success"&&(this.condition=w.value),this.name=o,h){this.properties=new Ph(V2()),this.unevaluatedLayout=new $y(V2(),p,x,v);for(const C in h)this.unevaluatedLayout.setValue(C,h[C])}}hasCachedIconPrimary(){return this.cachedIconPrimary!==null}setCachedIconPrimary(n){this.cachedIconPrimary=n}getCachedIconPrimary(){return this.cachedIconPrimary}isActive(n){return!(this.condition||!n.isHidden||this.name!=="hidden")||this.condition.evaluate(n.globals,n.feature,n.featureState,n.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(n){return this.properties.get(n)}getUnevaluatedProperties(){return this.unevaluatedLayout}recalculate(n,o,h){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(n,void 0,o,h))}serialize(){const n={};return n.condition=this.condition.expression.serialize(),this.name&&(n.name=this.name),this.unevaluatedLayout&&(n.properties=this.unevaluatedLayout.serialize()),n}}const $2="-transition",ij=new Set(["fill","line","background","hillshade","raster"]);class Po extends Ou{constructor(n,o,h,p,x,v){if(super(),this.id=n.id,this.fqid=Dh(this.id,h),this.type=n.type,this.scope=h,this.lut=p,this.options=x,this.iconImageUseTheme=v,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},n.type!=="custom"){if(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type&&n.type!=="background"&&n.type!=="sky"&&n.type!=="slot"){this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter;const w=uu(this.filter,at[`filter_${n.type}`]);w.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...w.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||w.value.isIndoorDependent)}if(n.slot&&(this.slot=n.slot),n.appearances&&this.setAppearances(n.appearances),o.layout&&(this._unevaluatedLayout=new $y(o.layout,this.scope,x,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),o.paint){this._transitionablePaint=new O2(o.paint,this.scope,x);for(const w in n.paint)this.setPaintProperty(w,n.paint[w]);for(const w in n.layout)this.setLayoutProperty(w,n.layout[w]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ph(o.paint)}}}onAdd(n){}onRemove(n){}isDraped(n){return!this.is3D(!0)&&ij.has(this.type)}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,o){if(this.type==="custom"&&n==="visibility")return void(this.visibility=o);const h=this._unevaluatedLayout;h._properties.properties[n]&&(h.setValue(n,o),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...h.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||h.isIndoorDependent(),n==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(n){this.appearances=[],n.forEach(o=>{this.appearances.push(new nj(o.condition,o.name,o.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(n){return n.endsWith($2)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}isPaintProperty(n){return!!this._transitionablePaint._properties.properties[n]}setPaintProperty(n,o){const h=this._transitionablePaint,p=h._properties.properties;if(n.endsWith($2)){const P=n.slice(0,-11);return p[P]&&h.setTransition(P,o||void 0),!1}if(!p[n])return!1;const x=h._values[n],v=x.value.isDataDriven(),w=x.value;h.setValue(n,o),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...h.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||h.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(n);const C=h._values[n].value,A=C.isDataDriven(),k=n.endsWith("pattern")||n==="line-dasharray";return A||v||k||this._handleOverridablePaintPropertyUpdate(n,w,C)}_handleSpecialPaintPropertyUpdate(n){}getProgramIds(){return null}getDefaultProgramParams(n,o,h){return null}_handleOverridablePaintPropertyUpdate(n,o,h){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,o){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,o,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,o)}serialize(){const n={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(n.appearances=this.appearances.map(o=>o.serialize())),ut(n,(o,h)=>!(o===void 0||h==="layout"&&!Object.keys(o).length||h==="paint"&&!Object.keys(o).length))}is3D(n){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const n in this.paint._values){const o=this.paint.get(n);if(o instanceof cc&&c0(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}for(const n of this.appearances)if(!rg(n.condition.expression))return!0;return!1}compileFilter(n){this._filterCompiled||(this._featureFilter=y0(this.filter,this.scope,n),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(n){this._stats&&(n.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(n,o,h){return{}}queryRadius(n){}queryIntersectsFeature(n,o,h,p,x,v,w,C,A){}}const sj={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class fg{constructor(n,o){this._structArray=n,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class _s{constructor(){this.capacity=-1,this.resize(0)}static serialize(n,o){return n._trim(),o&&o.add(n.arrayBuffer),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const o=Object.create(this.prototype);return o.arrayBuffer=n.arrayBuffer,o.length=n.length,o.capacity=n.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...n){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...n){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Kn(l,n=1){let o=0,h=0;return{members:l.map(p=>{const x=sj[p.type].BYTES_PER_ELEMENT,v=o=Hy(o,Math.max(n,x)),w=p.components||1;return h=Math.max(h,x),o+=x*w,{name:p.name,type:p.type,components:w,offset:v}}),size:Hy(o,Math.max(h,n)),alignment:n}}function Hy(l,n){return Math.ceil(l/n)*n}class tl extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o){const h=this.length;return this.resize(h+1),this.emplace(h,n,o)}emplace(n,o,h){const p=2*n;return this.int16[p+0]=o,this.int16[p+1]=h,n}}tl.prototype.bytesPerElement=4,Tr(tl,"StructArrayLayout2i4");class Rh extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,o,h)}emplace(n,o,h,p){const x=3*n;return this.int16[x+0]=o,this.int16[x+1]=h,this.int16[x+2]=p,n}}Rh.prototype.bytesPerElement=6,Tr(Rh,"StructArrayLayout3i6");class tp extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,h,p){const x=this.length;return this.resize(x+1),this.emplace(x,n,o,h,p)}emplace(n,o,h,p,x){const v=4*n;return this.int16[v+0]=o,this.int16[v+1]=h,this.int16[v+2]=p,this.int16[v+3]=x,n}}tp.prototype.bytesPerElement=8,Tr(tp,"StructArrayLayout4i8");class qu extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.float32[1*n+0]=o,n}}qu.prototype.bytesPerElement=4,Tr(qu,"StructArrayLayout1f4");class Zy extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,o,h)}emplace(n,o,h,p){const x=4*n,v=2*n;return this.int16[x+0]=o,this.int16[x+1]=h,this.float32[v+1]=p,n}}Zy.prototype.bytesPerElement=8,Tr(Zy,"StructArrayLayout2i1f8");class Xy extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,o,h)}emplace(n,o,h,p){const x=4*n;return this.int16[x+0]=o,this.int16[x+1]=h,this.int16[x+2]=p,n}}Xy.prototype.bytesPerElement=8,Tr(Xy,"StructArrayLayout3i8");class S0 extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,h,p,x){const v=this.length;return this.resize(v+1),this.emplace(v,n,o,h,p,x)}emplace(n,o,h,p,x,v){const w=5*n;return this.int16[w+0]=o,this.int16[w+1]=h,this.int16[w+2]=p,this.int16[w+3]=x,this.int16[w+4]=v,n}}S0.prototype.bytesPerElement=10,Tr(S0,"StructArrayLayout5i10");class T0 extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,h,p,x,v,w){const C=this.length;return this.resize(C+1),this.emplace(C,n,o,h,p,x,v,w)}emplace(n,o,h,p,x,v,w,C){const A=6*n,k=12*n,P=3*n;return this.int16[A+0]=o,this.int16[A+1]=h,this.uint8[k+4]=p,this.uint8[k+5]=x,this.uint8[k+6]=v,this.uint8[k+7]=w,this.float32[P+2]=C,n}}T0.prototype.bytesPerElement=12,Tr(T0,"StructArrayLayout2i4ub1f12");class Pl extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,o,h)}emplace(n,o,h,p){const x=3*n;return this.float32[x+0]=o,this.float32[x+1]=h,this.float32[x+2]=p,n}}Pl.prototype.bytesPerElement=12,Tr(Pl,"StructArrayLayout3f12");class Ud extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,h,p,x){const v=this.length;return this.resize(v+1),this.emplace(v,n,o,h,p,x)}emplace(n,o,h,p,x,v){const w=6*n,C=3*n;return this.uint16[w+0]=o,this.uint16[w+1]=h,this.uint16[w+2]=p,this.uint16[w+3]=x,this.float32[C+2]=v,n}}Ud.prototype.bytesPerElement=12,Tr(Ud,"StructArrayLayout4ui1f12");class Mh extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,h,p){const x=this.length;return this.resize(x+1),this.emplace(x,n,o,h,p)}emplace(n,o,h,p,x){const v=4*n;return this.uint16[v+0]=o,this.uint16[v+1]=h,this.uint16[v+2]=p,this.uint16[v+3]=x,n}}Mh.prototype.bytesPerElement=8,Tr(Mh,"StructArrayLayout4ui8");class E0 extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,h,p,x,v){const w=this.length;return this.resize(w+1),this.emplace(w,n,o,h,p,x,v)}emplace(n,o,h,p,x,v,w){const C=6*n;return this.int16[C+0]=o,this.int16[C+1]=h,this.int16[C+2]=p,this.int16[C+3]=x,this.int16[C+4]=v,this.int16[C+5]=w,n}}E0.prototype.bytesPerElement=12,Tr(E0,"StructArrayLayout6i12");class C0 extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,h,p,x,v,w,C,A,k,P,O){const G=this.length;return this.resize(G+1),this.emplace(G,n,o,h,p,x,v,w,C,A,k,P,O)}emplace(n,o,h,p,x,v,w,C,A,k,P,O,G){const W=12*n;return this.int16[W+0]=o,this.int16[W+1]=h,this.int16[W+2]=p,this.int16[W+3]=x,this.uint16[W+4]=v,this.uint16[W+5]=w,this.uint16[W+6]=C,this.uint16[W+7]=A,this.int16[W+8]=k,this.int16[W+9]=P,this.int16[W+10]=O,this.int16[W+11]=G,n}}C0.prototype.bytesPerElement=24,Tr(C0,"StructArrayLayout4i4ui4i24");class rp extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,h,p,x,v){const w=this.length;return this.resize(w+1),this.emplace(w,n,o,h,p,x,v)}emplace(n,o,h,p,x,v,w){const C=10*n,A=5*n;return this.int16[C+0]=o,this.int16[C+1]=h,this.int16[C+2]=p,this.float32[A+2]=x,this.float32[A+3]=v,this.float32[A+4]=w,n}}rp.prototype.bytesPerElement=20,Tr(rp,"StructArrayLayout3i3f20");class Vd extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,h,p){const x=this.length;return this.resize(x+1),this.emplace(x,n,o,h,p)}emplace(n,o,h,p,x){const v=4*n;return this.float32[v+0]=o,this.float32[v+1]=h,this.float32[v+2]=p,this.float32[v+3]=x,n}}Vd.prototype.bytesPerElement=16,Tr(Vd,"StructArrayLayout4f16");class Yy extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint32[1*n+0]=o,n}}Yy.prototype.bytesPerElement=4,Tr(Yy,"StructArrayLayout1ul4");class uc extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o){const h=this.length;return this.resize(h+1),this.emplace(h,n,o)}emplace(n,o,h){const p=2*n;return this.uint16[p+0]=o,this.uint16[p+1]=h,n}}uc.prototype.bytesPerElement=4,Tr(uc,"StructArrayLayout2ui4");class Ky extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,h,p,x,v,w,C,A,k,P,O,G){const W=this.length;return this.resize(W+1),this.emplace(W,n,o,h,p,x,v,w,C,A,k,P,O,G)}emplace(n,o,h,p,x,v,w,C,A,k,P,O,G,W){const te=20*n,se=10*n;return this.int16[te+0]=o,this.int16[te+1]=h,this.int16[te+2]=p,this.int16[te+3]=x,this.int16[te+4]=v,this.float32[se+3]=w,this.float32[se+4]=C,this.float32[se+5]=A,this.float32[se+6]=k,this.int16[te+14]=P,this.uint32[se+8]=O,this.uint16[te+18]=G,this.uint16[te+19]=W,n}}Ky.prototype.bytesPerElement=40,Tr(Ky,"StructArrayLayout5i4f1i1ul2ui40");class A0 extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,h,p,x,v,w){const C=this.length;return this.resize(C+1),this.emplace(C,n,o,h,p,x,v,w)}emplace(n,o,h,p,x,v,w,C){const A=8*n;return this.int16[A+0]=o,this.int16[A+1]=h,this.int16[A+2]=p,this.int16[A+4]=x,this.int16[A+5]=v,this.int16[A+6]=w,this.int16[A+7]=C,n}}A0.prototype.bytesPerElement=16,Tr(A0,"StructArrayLayout3i2i2i16");class np extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,h,p,x){const v=this.length;return this.resize(v+1),this.emplace(v,n,o,h,p,x)}emplace(n,o,h,p,x,v){const w=4*n,C=8*n;return this.float32[w+0]=o,this.float32[w+1]=h,this.float32[w+2]=p,this.int16[C+6]=x,this.int16[C+7]=v,n}}np.prototype.bytesPerElement=16,Tr(np,"StructArrayLayout2f1f2i16");class ip extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,h,p,x,v){const w=this.length;return this.resize(w+1),this.emplace(w,n,o,h,p,x,v)}emplace(n,o,h,p,x,v,w){const C=20*n,A=5*n;return this.uint8[C+0]=o,this.uint8[C+1]=h,this.float32[A+1]=p,this.float32[A+2]=x,this.float32[A+3]=v,this.float32[A+4]=w,n}}ip.prototype.bytesPerElement=20,Tr(ip,"StructArrayLayout2ub4f20");class bs extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,o,h)}emplace(n,o,h,p){const x=3*n;return this.uint16[x+0]=o,this.uint16[x+1]=h,this.uint16[x+2]=p,n}}bs.prototype.bytesPerElement=6,Tr(bs,"StructArrayLayout3ui6");class sp extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,o,h,p,x,v,w,C,A,k,P,O,G,W,te,se,oe,ge,ve,Te,$e){const Fe=this.length;return this.resize(Fe+1),this.emplace(Fe,n,o,h,p,x,v,w,C,A,k,P,O,G,W,te,se,oe,ge,ve,Te,$e)}emplace(n,o,h,p,x,v,w,C,A,k,P,O,G,W,te,se,oe,ge,ve,Te,$e,Fe){const Ze=30*n,Ye=15*n,Je=60*n;return this.int16[Ze+0]=o,this.int16[Ze+1]=h,this.int16[Ze+2]=p,this.float32[Ye+2]=x,this.float32[Ye+3]=v,this.uint16[Ze+8]=w,this.uint16[Ze+9]=C,this.uint32[Ye+5]=A,this.uint32[Ye+6]=k,this.uint32[Ye+7]=P,this.uint16[Ze+16]=O,this.uint16[Ze+17]=G,this.uint16[Ze+18]=W,this.float32[Ye+10]=te,this.float32[Ye+11]=se,this.uint8[Je+48]=oe,this.uint8[Je+49]=ge,this.uint8[Je+50]=ve,this.uint32[Ye+13]=Te,this.int16[Ze+28]=$e,this.uint8[Je+58]=Fe,n}}sp.prototype.bytesPerElement=60,Tr(sp,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Jy extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,o,h,p,x,v,w,C,A,k,P,O,G,W,te,se,oe,ge,ve,Te,$e,Fe,Ze,Ye,Je,Tt,ot,Ct,Mt,Bt,ir,Jt,Ft){const Yt=this.length;return this.resize(Yt+1),this.emplace(Yt,n,o,h,p,x,v,w,C,A,k,P,O,G,W,te,se,oe,ge,ve,Te,$e,Fe,Ze,Ye,Je,Tt,ot,Ct,Mt,Bt,ir,Jt,Ft)}emplace(n,o,h,p,x,v,w,C,A,k,P,O,G,W,te,se,oe,ge,ve,Te,$e,Fe,Ze,Ye,Je,Tt,ot,Ct,Mt,Bt,ir,Jt,Ft,Yt){const wt=20*n,vt=40*n,Ht=80*n;return this.float32[wt+0]=o,this.float32[wt+1]=h,this.int16[vt+4]=p,this.int16[vt+5]=x,this.int16[vt+6]=v,this.int16[vt+7]=w,this.int16[vt+8]=C,this.int16[vt+9]=A,this.int16[vt+10]=k,this.int16[vt+11]=P,this.int16[vt+12]=O,this.uint16[vt+13]=G,this.uint16[vt+14]=W,this.uint16[vt+15]=te,this.uint16[vt+16]=se,this.uint16[vt+17]=oe,this.uint16[vt+18]=ge,this.uint16[vt+19]=ve,this.uint16[vt+20]=Te,this.uint16[vt+21]=$e,this.uint16[vt+22]=Fe,this.uint16[vt+23]=Ze,this.uint16[vt+24]=Ye,this.uint16[vt+25]=Je,this.uint16[vt+26]=Tt,this.uint16[vt+27]=ot,this.uint32[wt+14]=Ct,this.float32[wt+15]=Mt,this.float32[wt+16]=Bt,this.float32[wt+17]=ir,this.float32[wt+18]=Jt,this.uint8[Ht+76]=Ft,this.uint16[vt+39]=Yt,n}}Jy.prototype.bytesPerElement=80,Tr(Jy,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Qy extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,h,p,x,v){const w=this.length;return this.resize(w+1),this.emplace(w,n,o,h,p,x,v)}emplace(n,o,h,p,x,v,w){const C=6*n;return this.float32[C+0]=o,this.float32[C+1]=h,this.float32[C+2]=p,this.float32[C+3]=x,this.float32[C+4]=v,this.float32[C+5]=w,n}}Qy.prototype.bytesPerElement=24,Tr(Qy,"StructArrayLayout6f24");class Oh extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,h,p,x){const v=this.length;return this.resize(v+1),this.emplace(v,n,o,h,p,x)}emplace(n,o,h,p,x,v){const w=5*n;return this.float32[w+0]=o,this.float32[w+1]=h,this.float32[w+2]=p,this.float32[w+3]=x,this.float32[w+4]=v,n}}Oh.prototype.bytesPerElement=20,Tr(Oh,"StructArrayLayout5f20");class e1 extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,h,p,x,v,w){const C=this.length;return this.resize(C+1),this.emplace(C,n,o,h,p,x,v,w)}emplace(n,o,h,p,x,v,w,C){const A=7*n;return this.float32[A+0]=o,this.float32[A+1]=h,this.float32[A+2]=p,this.float32[A+3]=x,this.float32[A+4]=v,this.float32[A+5]=w,this.float32[A+6]=C,n}}e1.prototype.bytesPerElement=28,Tr(e1,"StructArrayLayout7f28");class pg extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,h,p,x,v,w,C,A,k,P){const O=this.length;return this.resize(O+1),this.emplace(O,n,o,h,p,x,v,w,C,A,k,P)}emplace(n,o,h,p,x,v,w,C,A,k,P,O){const G=11*n;return this.float32[G+0]=o,this.float32[G+1]=h,this.float32[G+2]=p,this.float32[G+3]=x,this.float32[G+4]=v,this.float32[G+5]=w,this.float32[G+6]=C,this.float32[G+7]=A,this.float32[G+8]=k,this.float32[G+9]=P,this.float32[G+10]=O,n}}pg.prototype.bytesPerElement=44,Tr(pg,"StructArrayLayout11f44");class t1 extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,h,p,x,v,w,C,A){const k=this.length;return this.resize(k+1),this.emplace(k,n,o,h,p,x,v,w,C,A)}emplace(n,o,h,p,x,v,w,C,A,k){const P=9*n;return this.float32[P+0]=o,this.float32[P+1]=h,this.float32[P+2]=p,this.float32[P+3]=x,this.float32[P+4]=v,this.float32[P+5]=w,this.float32[P+6]=C,this.float32[P+7]=A,this.float32[P+8]=k,n}}t1.prototype.bytesPerElement=36,Tr(t1,"StructArrayLayout9f36");class $d extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o){const h=this.length;return this.resize(h+1),this.emplace(h,n,o)}emplace(n,o,h){const p=2*n;return this.float32[p+0]=o,this.float32[p+1]=h,n}}$d.prototype.bytesPerElement=8,Tr($d,"StructArrayLayout2f8");class r1 extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,h,p){const x=this.length;return this.resize(x+1),this.emplace(x,n,o,h,p)}emplace(n,o,h,p,x){const v=6*n;return this.uint32[3*n+0]=o,this.uint16[v+2]=h,this.uint16[v+3]=p,this.uint16[v+4]=x,n}}r1.prototype.bytesPerElement=12,Tr(r1,"StructArrayLayout1ul3ui12");class j0 extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint16[1*n+0]=o,n}}j0.prototype.bytesPerElement=2,Tr(j0,"StructArrayLayout1ui2");class I0 extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,h,p,x,v,w,C,A,k,P,O,G,W,te,se){const oe=this.length;return this.resize(oe+1),this.emplace(oe,n,o,h,p,x,v,w,C,A,k,P,O,G,W,te,se)}emplace(n,o,h,p,x,v,w,C,A,k,P,O,G,W,te,se,oe){const ge=16*n;return this.float32[ge+0]=o,this.float32[ge+1]=h,this.float32[ge+2]=p,this.float32[ge+3]=x,this.float32[ge+4]=v,this.float32[ge+5]=w,this.float32[ge+6]=C,this.float32[ge+7]=A,this.float32[ge+8]=k,this.float32[ge+9]=P,this.float32[ge+10]=O,this.float32[ge+11]=G,this.float32[ge+12]=W,this.float32[ge+13]=te,this.float32[ge+14]=se,this.float32[ge+15]=oe,n}}I0.prototype.bytesPerElement=64,Tr(I0,"StructArrayLayout16f64");class ap extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,h,p,x,v,w){const C=this.length;return this.resize(C+1),this.emplace(C,n,o,h,p,x,v,w)}emplace(n,o,h,p,x,v,w,C){const A=10*n,k=5*n;return this.uint16[A+0]=o,this.uint16[A+1]=h,this.uint16[A+2]=p,this.uint16[A+3]=x,this.float32[k+2]=v,this.float32[k+3]=w,this.float32[k+4]=C,n}}ap.prototype.bytesPerElement=20,Tr(ap,"StructArrayLayout4ui3f20");class n1 extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.int16[1*n+0]=o,n}}n1.prototype.bytesPerElement=2,Tr(n1,"StructArrayLayout1i2");class N0 extends _s{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint8[1*n+0]=o,n}}N0.prototype.bytesPerElement=1,Tr(N0,"StructArrayLayout1ub1");class i1 extends fg{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}i1.prototype.size=40;class q2 extends Ky{get(n){return new i1(this,n)}}Tr(q2,"CollisionBoxArray");class k0 extends fg{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(n){this._structArray.uint8[this._pos1+49]=n}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(n){this._structArray.uint8[this._pos1+50]=n}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(n){this._structArray.uint32[this._pos4+13]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(n){this._structArray.uint8[this._pos1+58]=n}}k0.prototype.size=60;class mg extends sp{get(n){return new k0(this,n)}}Tr(mg,"PlacedSymbolArray");class s1 extends fg{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(n){this._structArray.uint32[this._pos4+14]=n}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(n){this._structArray.float32[this._pos4+18]=n}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}s1.prototype.size=80;class G2 extends Jy{get(n){return new s1(this,n)}}Tr(G2,"SymbolInstanceArray");class a1 extends qu{getoffsetX(n){return this.float32[1*n+0]}}Tr(a1,"GlyphOffsetArray");class W2 extends tl{getx(n){return this.int16[2*n+0]}gety(n){return this.int16[2*n+1]}}Tr(W2,"SymbolLineVertexArray");class P0 extends fg{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}P0.prototype.size=12;class H2 extends r1{get(n){return new P0(this,n)}}Tr(H2,"FeatureIndexArray");class Z2 extends uc{geta_centroid_pos0(n){return this.uint16[2*n+0]}geta_centroid_pos1(n){return this.uint16[2*n+1]}}Tr(Z2,"FillExtrusionCentroidArray");class X2 extends fg{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}X2.prototype.size=6;class Y2 extends Rh{get(n){return new X2(this,n)}}Tr(Y2,"FillExtrusionWallArray");const K2=Kn([{name:"a_pos",components:2,type:"Int16"}],4),aj=Kn([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),oj=Kn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Fs{constructor(n=[]){this.segments=n}_prepareSegment(n,o,h,p){let x=this.segments[this.segments.length-1];return n>Fs.MAX_VERTEX_ARRAY_LENGTH&&ur(`Max vertices per segment is ${Fs.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!x||x.vertexLength+n>Fs.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==p)&&(x={vertexOffset:o,primitiveOffset:h,vertexLength:0,primitiveLength:0},p!==void 0&&(x.sortKey=p),this.segments.push(x)),x}prepareSegment(n,o,h,p){return this._prepareSegment(n,o.length,h.length,p)}get(){return this.segments}destroy(){for(const n of this.segments)for(const o in n.vaos)n.vaos[o].destroy()}static simpleSegment(n,o,h,p){return new Fs([{vertexOffset:n,primitiveOffset:o,vertexLength:h,primitiveLength:p,vaos:{},sortKey:0}])}}function J2(l,n){return 256*(l=K(Math.floor(l),0,255))+K(Math.floor(n),0,255)}Fs.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Tr(Fs,"SegmentVector");const lj=Kn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),cj=Kn([{name:"a_pattern_b",components:4,type:"Uint16"}]),uj=Kn([{name:"a_dash",components:4,type:"Uint16"}]);class gg{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(n,o,h,p){this.ids.push(_g(n)),this.positions.push(o,h,p)}eachPosition(n,o){const h=_g(n);let p=0,x=this.ids.length-1;for(;p<x;){const v=p+x>>1;this.ids[v]>=h?x=v:p=v+1}for(;this.ids[p]===h;)o(this.positions[3*p],this.positions[3*p+1],this.positions[3*p+2]),p++}static serialize(n,o){const h=new Float64Array(n.ids),p=new Uint32Array(n.positions);return o1(h,p,0,h.length-1),o&&(o.add(h.buffer),o.add(p.buffer)),{ids:h,positions:p}}static deserialize(n){const o=new gg;let h;o.ids=n.ids,o.positions=n.positions;for(const p of o.ids)p!==h&&o.uniqueIds.push(p),h=p;return o.indexed=!0,o}}function _g(l){const n=+l;return Number.isSafeInteger(n)?n:Um(String(l))}function o1(l,n,o,h){for(;o<h;){const p=l[o+h>>1];let x=o-1,v=h+1;for(;;){do x++;while(l[x]<p);do v--;while(l[v]>p);if(x>=v)break;D0(l,x,v),D0(n,3*x,3*v),D0(n,3*x+1,3*v+1),D0(n,3*x+2,3*v+2)}v-o<h-v?(o1(l,n,o,v),o=v+1):(o1(l,n,v+1,h),h=v)}}function D0(l,n,o){const h=l[n];l[n]=l[o],l[o]=h}Tr(gg,"FeaturePositionMap");class dc{constructor(n){this.gl=n.gl,this.initialized=!1}fetchUniformLocation(n,o){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(n,o),this.initialized=!0),!!this.location}set(n,o,h){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class R0 extends dc{constructor(n){super(n),this.current=0}set(n,o,h){this.fetchUniformLocation(n,o)&&this.current!==h&&(this.current=h,this.gl.uniform1i(this.location,h))}}class fa extends dc{constructor(n){super(n),this.current=0}set(n,o,h){this.fetchUniformLocation(n,o)&&this.current!==h&&(this.current=h,this.gl.uniform1f(this.location,h))}}class du extends dc{constructor(n){super(n),this.current=[0,0]}set(n,o,h){this.fetchUniformLocation(n,o)&&(h[0]===this.current[0]&&h[1]===this.current[1]||(this.current=h,this.gl.uniform2f(this.location,h[0],h[1])))}}class op extends dc{constructor(n){super(n),this.current=[0,0,0]}set(n,o,h){this.fetchUniformLocation(n,o)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]||(this.current=h,this.gl.uniform3f(this.location,h[0],h[1],h[2])))}}class xg extends dc{constructor(n){super(n),this.current=[0,0,0,0]}set(n,o,h){this.fetchUniformLocation(n,o)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]&&h[3]===this.current[3]||(this.current=h,this.gl.uniform4f(this.location,h[0],h[1],h[2],h[3])))}}class l1 extends dc{constructor(n){super(n),this.current=Li.transparent.toPremultipliedRenderColor(null)}set(n,o,h){this.fetchUniformLocation(n,o)&&(h.r===this.current.r&&h.g===this.current.g&&h.b===this.current.b&&h.a===this.current.a||(this.current=h,this.gl.uniform4f(this.location,h.r,h.g,h.b,h.a)))}}const Q2=new Float32Array(16);class vg extends dc{constructor(n){super(n),this.current=Q2}set(n,o,h){if(this.fetchUniformLocation(n,o)){if(h[12]!==this.current[12]||h[0]!==this.current[0])return this.current=h,void this.gl.uniformMatrix4fv(this.location,!1,h);for(let p=1;p<16;p++)if(h[p]!==this.current[p]){this.current=h,this.gl.uniformMatrix4fv(this.location,!1,h);break}}}}const dj=new Float32Array(9),eS=new Float32Array(4);class c1 extends dc{constructor(n){super(n),this.current=eS}set(n,o,h){if(this.fetchUniformLocation(n,o)){for(let p=0;p<4;p++)if(h[p]!==this.current[p]){this.current=h,this.gl.uniformMatrix2fv(this.location,!1,h);break}}}}function u1(l){return[J2(255*l.r,255*l.g),J2(255*l.b,255*l.a)]}function M0(l,n,o,h,p,x,v,w){return!!l&&(l.kind==="composite"||l.kind==="source"?l.evaluate(new us(0,{brightness:x,worldview:w}),n,o,p,h,v)==="none":l.value==="none")}class O0{constructor(n,o,h,p){this.value=n,this.uniformNames=o.map(x=>`u_${x}`),this.type=h,this.context=p}setUniform(n,o,h,p,x){const v=p.constantOr(this.value);o.set(n,x,v instanceof Li?v.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):v)}getBinding(n,o){return this.type==="color"?new l1(n):new fa(n)}}class yg{constructor(n,o){this.uniformNames=o.map(h=>`u_${h}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(n,o){this.pixelRatio=n.pixelRatio||1,this.pattern=n.tl.concat(n.br),this.patternTransition=o?o.tl.concat(o.br):this.pattern}setUniform(n,o,h,p,x){let v=null;x!=="u_pattern"&&x!=="u_dash"||(v=this.pattern),x==="u_pattern_b"&&(v=this.patternTransition),x==="u_pixel_ratio"&&(v=this.pixelRatio),v&&o.set(n,x,v)}getBinding(n,o){return o==="u_pattern"||o==="u_pattern_b"||o==="u_dash"?new xg(n):new fa(n)}}class Gu{constructor(n,o,h,p){this.expression=n,this.type=h,this.maxValue=0,this.paintVertexAttributes=o.map(x=>({name:`a_${x}`,type:"Float32",components:h==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(n,o,h,p,x,v,w,C){const A=this.paintVertexArray.length,k=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new us(0,{brightness:v,worldview:C}),o,{},x,p,w):this.expression.kind==="constant"&&this.expression.value,P=M0(this.lutExpression,o,{},p,x,v,w,C);this.paintVertexArray.resize(n),this._setPaintValue(A,n,k,P?null:this.context.lut)}updatePaintArray(n,o,h,p,x,v,w,C){const A=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:w,worldview:C},h,p,void 0,x):this.expression.kind==="constant"&&this.expression.value,k=M0(this.lutExpression,h,p,x,void 0,w,void 0,C);this._setPaintValue(n,o,A,k?null:this.context.lut)}_setPaintValue(n,o,h,p){if(this.type==="color"){const x=u1(h.toPremultipliedRenderColor(p));for(let v=n;v<o;v++)this.paintVertexArray.emplace(v,x[0],x[1])}else{for(let x=n;x<o;x++)this.paintVertexArray.emplace(x,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Dc{constructor(n,o,h,p,x,v){this.expression=n,this.uniformNames=o.map(w=>`u_${w}_t`),this.type=h,this.useIntegerZoom=p,this.context=x,this.maxValue=0,this.paintVertexAttributes=o.map(w=>({name:`a_${w}`,type:"Float32",components:h==="color"?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(n,o,h,p,x,v,w,C){const A=this.expression.evaluate(new us(this.context.zoom,{brightness:v,worldview:C}),o,{},x,p,w),k=this.expression.evaluate(new us(this.context.zoom+1,{brightness:v,worldview:C}),o,{},x,p,w),P=M0(this.lutExpression,o,{},p,x,v,w,C),O=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(O,n,A,k,P?null:this.context.lut)}updatePaintArray(n,o,h,p,x,v,w,C){const A=this.expression.evaluate({zoom:this.context.zoom,brightness:w,worldview:C},h,p,void 0,x),k=this.expression.evaluate({zoom:this.context.zoom+1,brightness:w,worldview:C},h,p,void 0,x),P=M0(this.lutExpression,h,p,x,void 0,w,void 0,C);this._setPaintValue(n,o,A,k,P?null:this.context.lut)}_setPaintValue(n,o,h,p,x){if(this.type==="color"){const v=u1(h.toPremultipliedRenderColor(x)),w=u1(h.toPremultipliedRenderColor(x));for(let C=n;C<o;C++)this.paintVertexArray.emplace(C,v[0],v[1],w[0],w[1])}else{for(let v=n;v<o;v++)this.paintVertexArray.emplace(v,h,p);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(p))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,o,h,p,x){const v=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,w=K(this.expression.interpolationFactor(v,this.context.zoom,this.context.zoom+1),0,1);o.set(n,x,w)}getBinding(n,o){return new fa(n)}}class yo{constructor(n,o,h,p,x){this.expression=n,this.layerId=x,this.paintVertexAttributes=(h==="array"?uj:lj).members;for(let v=0;v<o.length;++v);this.paintVertexArray=new p,this.paintTransitionVertexArray=new Mh}populatePaintArray(n,o,h,p){const x=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValues(x,n,o.patterns&&o.patterns[this.layerId],h)}updatePaintArray(n,o,h,p,x,v,w){this._setPaintValues(n,o,h.patterns&&h.patterns[this.layerId],v)}_setPaintValues(n,o,h,p){if(!p||!h)return;const x=p[h[0]],v=p[h[1]];if(x){if(x){const{tl:w,br:C,pixelRatio:A}=x;for(let k=n;k<o;k++)this.paintVertexArray.emplace(k,w[0],w[1],C[0],C[1],A)}if(v){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:w,br:C}=v;for(let A=n;A<o;A++)this.paintTransitionVertexArray.emplace(A,w[0],w[1],C[0],C[1])}}}upload(n){const o=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,o)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=n.createVertexBuffer(this.paintTransitionVertexArray,cj.members,o))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Wu{constructor(n,o,h=()=>!0){this.binders={},this._buffers=[],this.context=o;const p=[];for(const x in n.paint._values){const v=n.paint.get(x);if(x.endsWith("-use-theme")||!h(x)||!(v instanceof cc&&c0(v.property.specification)))continue;const w=fj(x,n.type),C=v.value,A=v.property.specification.type,k=!!v.property.useIntegerZoom,P=x==="line-dasharray"||x.endsWith("pattern"),O=n.paint.get(`${x}-use-theme`),G=x==="line-dasharray"&&n.layout.get("line-cap").value.kind!=="constant"||O&&O.value.kind!=="constant";if(C.kind!=="constant"||G)if(C.kind==="source"||G||P){const W=d1(x,A,"source");this.binders[x]=P?new yo(C,w,A,W,n.id):new Gu(C,w,A,W),p.push(`/a_${x}`)}else{const W=d1(x,A,"composite");this.binders[x]=new Dc(C,w,A,k,o,W),p.push(`/z_${x}`)}else this.binders[x]=P?new yg(C.value,w):new O0(C.value,w,A,o),p.push(`/u_${x}`);O&&(this.binders[x].lutExpression=O.value)}this.cacheKey=p.sort().join("")}getMaxValue(n){const o=this.binders[n];return o instanceof Gu||o instanceof Dc?o.maxValue:0}populatePaintArrays(n,o,h,p,x,v,w,C){for(const A in this.binders){const k=this.binders[A];k.context=this.context,(k instanceof Gu||k instanceof Dc||k instanceof yo)&&k.populatePaintArray(n,o,h,p,x,v,w,C)}}setConstantPatternPositions(n,o){for(const h in this.binders){const p=this.binders[h];p instanceof yg&&p.setConstantPatternPositions(n,o)}}getPatternTransitionVertexBuffer(n){const o=this.binders[n];return o instanceof yo?o.paintTransitionVertexBuffer:null}updatePaintArrays(n,o,h,p,x,v,w,C,A,k){let P=!1;const O=Object.keys(n),G=O.length!==0&&!C,W=G?O:o.uniqueIds;this.context.lut=x.lut;for(const te in this.binders){const se=this.binders[te];if(se.context=this.context,(se instanceof Gu||se instanceof Dc||se instanceof yo)&&se.expression&&se.expression.kind&&se.expression.kind!=="constant"&&(se.expression.isStateDependent===!0||se.expression.isLightConstant===!1)){const oe=x.paint.get(te);se.expression=oe.value;for(const ge of W){const ve=n[ge.toString()];o.eachPosition(ge,(Te,$e,Fe)=>{const Ze=p.feature(Te);se.updatePaintArray($e,Fe,Ze,ve,v,w,A,k)})}if(!G)for(const ge of h.uniqueIds){const ve=n[ge.toString()];h.eachPosition(ge,(Te,$e,Fe)=>{const Ze=p.feature(Te);se.updatePaintArray($e,Fe,Ze,ve,v,w,A,k)})}P=!0}}return P}defines(){const n=[];for(const o in this.binders){const h=this.binders[o];(h instanceof O0||h instanceof yg)&&n.push(...h.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n){const o=[];for(const h in this.binders){const p=this.binders[h];if(p instanceof O0||p instanceof yg||p instanceof Dc)for(const x of p.uniformNames)o.push({name:x,property:h,binding:p.getBinding(n,x)})}return o}setUniforms(n,o,h,p,x){for(const{name:v,property:w,binding:C}of h)this.binders[w].setUniform(n,C,x,p.get(w),v)}updatePaintBuffers(){this._buffers=[];for(const n in this.binders){const o=this.binders[n];(o instanceof Gu||o instanceof Dc||o instanceof yo)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer),o instanceof yo&&o.paintTransitionVertexBuffer&&this._buffers.push(o.paintTransitionVertexBuffer)}}upload(n){for(const o in this.binders){const h=this.binders[o];(h instanceof Gu||h instanceof Dc||h instanceof yo)&&h.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const o=this.binders[n];(o instanceof Gu||o instanceof Dc||o instanceof yo)&&o.destroy()}}}class Rc{constructor(n,o,h=()=>!0){this.programConfigurations={};for(const p of n)this.programConfigurations[p.id]=new Wu(p,o,h);this.needsUpload=!1,this._featureMap=new gg,this._featureMapWithoutIds=new gg,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(n,o,h,p,x,v,w,C,A){for(const k in this.programConfigurations)this.programConfigurations[k].populatePaintArrays(n,o,p,x,v,w,C,A);o.id!==void 0?this._featureMap.add(o.id,h,this._bufferOffset,n):(this._featureMapWithoutIds.add(this._idlessCounter,h,this._bufferOffset,n),this._idlessCounter+=1),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,o,h,p,x,v,w,C){for(const A of h)this.needsUpload=this.programConfigurations[A.id].updatePaintArrays(n,this._featureMap,this._featureMapWithoutIds,o,A,p,x,v,w||0,C)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}const hj={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function fj(l,n){return hj[l]||[l.replace(`${n}-`,"").replace(/-/g,"_")]}const pj={"line-pattern":{source:Ud,composite:Ud},"fill-pattern":{source:Ud,composite:Ud},"fill-extrusion-pattern":{source:Ud,composite:Ud},"line-dasharray":{source:Mh,composite:Mh}},mj={color:{source:$d,composite:Vd},number:{source:qu,composite:$d}};function d1(l,n,o){const h=pj[l];return h&&h[o]||mj[n][o]}Tr(O0,"ConstantBinder"),Tr(yg,"PatternConstantBinder"),Tr(Gu,"SourceExpressionBinder"),Tr(yo,"PatternCompositeBinder"),Tr(Dc,"CompositeExpressionBinder"),Tr(Wu,"ProgramConfiguration",{omit:["_buffers"]}),Tr(Rc,"ProgramConfigurationSet");const rl=ar/Math.PI/2,g=5,a=6,d=16383,_=64,y=[_,32,16],b=-rl,T=rl;function j(l,n,o,h=rl){return o=lt(o),[l*Math.sin(o)*h,-n*h,l*Math.cos(o)*h]}function N(l,n,o){return j(Math.cos(lt(l)),Math.sin(lt(l)),n,o)}const L=63710088e-1,B=2*Math.PI*L;class X{constructor(n,o){if(isNaN(n)||isNaN(o))throw new Error(`Invalid LngLat object: (${n}, ${o})`);if(this.lng=+n,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new X(ce(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const o=Math.PI/180,h=this.lat*o,p=n.lat*o,x=Math.sin(h)*Math.sin(p)+Math.cos(h)*Math.cos(p)*Math.cos((n.lng-this.lng)*o);return L*Math.acos(Math.min(x,1))}toBounds(n=0){const o=360*n/40075017,h=o/Math.cos(Math.PI/180*this.lat);return new q({lng:this.lng-h,lat:this.lat-o},{lng:this.lng+h,lat:this.lat+o})}toEcef(n){return N(this.lat,this.lng,rl+n*rl/L)}static convert(n){if(n instanceof X)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new X(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new X(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class q{constructor(n,o){n&&(o?this.setSouthWest(n).setNorthEast(o):Array.isArray(n)&&n.length===4?this.setSouthWest([n[0],n[1]]).setNorthEast([n[2],n[3]]):this.setSouthWest(n[0]).setNorthEast(n[1]))}setNorthEast(n){return this._ne=n instanceof X?new X(n.lng,n.lat):X.convert(n),this}setSouthWest(n){return this._sw=n instanceof X?new X(n.lng,n.lat):X.convert(n),this}extend(n){const o=this._sw,h=this._ne;let p,x;if(n instanceof X)p=n,x=n;else{if(!(n instanceof q))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(q.convert(n)):this.extend(X.convert(n)):typeof n=="object"&&n!==null&&n.hasOwnProperty("lat")&&(n.hasOwnProperty("lon")||n.hasOwnProperty("lng"))?this.extend(X.convert(n)):this;if(p=n._sw,x=n._ne,!p||!x)return this}return o||h?(o.lng=Math.min(p.lng,o.lng),o.lat=Math.min(p.lat,o.lat),h.lng=Math.max(x.lng,h.lng),h.lat=Math.max(x.lat,h.lat)):(this._sw=new X(p.lng,p.lat),this._ne=new X(x.lng,x.lat)),this}getCenter(){return new X((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new X(this.getWest(),this.getNorth())}getSouthEast(){return new X(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:o,lat:h}=X.convert(n);let p=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&p}static convert(n){if(n)return n instanceof q?n:new q(n)}}const Q=0,re=25.5;function ae(l){return B*Math.cos(l*Math.PI/180)}function fe(l){return(180+l)/360}function de(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function xe(l,n){return l/ae(n)}function je(l){return 360*l-180}function we(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function Ve(l,n){return l*ae(we(n))}const Ne=85.051129;function Ge(l){return Math.cos(lt(K(l,-Ne,Ne)))}function Be(l,n){const o=K(n,Q,re),h=Math.pow(2,o);return Ge(l)*B/(512*h)}function De(l){return 1/Math.cos(l*Math.PI/180)}function We(l,n=0){const o=Math.exp(Math.PI*(1-(l.y+n/ar)/(1<<l.z)*2));return 80150034*o/(o*o+1)/ar/(1<<l.z)}class st{constructor(n,o,h=0){this.x=+n,this.y=+o,this.z=+h}static fromLngLat(n,o=0){const h=X.convert(n);return new st(fe(h.lng),de(h.lat),xe(o,h.lat))}toLngLat(){return new X(je(this.x),we(this.y))}toAltitude(){return Ve(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/B*De(we(this.y))}}function rt(l,n,o,h,p,x,v,w,C){const A=(n+h)/2,k=(o+p)/2,P=new At(A,k);w(P),function(O,G,W,te,se,oe){const ge=W-se,ve=te-oe;return Math.abs((te-G)*ge-(W-O)*ve)/Math.hypot(ge,ve)}(P.x,P.y,x.x,x.y,v.x,v.y)>=C?(rt(l,n,o,A,k,x,P,w,C),rt(l,A,k,h,p,P,v,w,C)):l.push(v)}function bt(l,n,o){let h=l[0],p=h.x,x=h.y;n(h);const v=[h];for(let w=1;w<l.length;w++){const C=l[w],{x:A,y:k}=C;n(C),rt(v,p,x,A,k,h,C,n,o),p=A,x=k,h=C}return v}function _t(l,n,o,h){if(h(n,o)){const p=n.add(o)._mult(.5);_t(l,n,p,h),_t(l,p,o,h)}else l.push(o)}function kt(l,n){let o=l[0];const h=[o];for(let p=1;p<l.length;p++){const x=l[p];_t(h,o,x,n),o=x}return h}const nr=Math.pow(2,14)-1,ht=-nr-1;function Ke(l,n){const o=Math.round(l.x*n),h=Math.round(l.y*n);return l.x=K(o,ht,nr),l.y=K(h,ht,nr),(o<l.x||o>l.x+1||h<l.y||h>l.y+1)&&ur("Geometry exceeds allowed extent, reduce your vector tile buffer size"),l}function Pt(l,n,o){const h=l.loadGeometry(),p=l.extent,x=ar/p;if(n&&o&&o.projection.isReprojectedInTileSpace){const v=1<<n.z,{scale:w,x:C,y:A,projection:k}=o,P=O=>{const G=je((n.x+O.x/p)/v),W=we((n.y+O.y/p)/v),te=k.project(G,W);O.x=(te.x*w-C)*p,O.y=(te.y*w-A)*p};for(let O=0;O<h.length;O++)if(l.type!==1)h[O]=bt(h[O],P,1);else{const G=[];for(const W of h[O])W.x<0||W.x>=p||W.y<0||W.y>=p||(P(W),G.push(W));h[O]=G}}for(const v of h)for(const w of v)Ke(w,x);return h}function xt(l,n){return{type:l.type,id:l.id,properties:l.properties,geometry:n?Pt(l):[]}}class qt{constructor(n,o,h,p,x){this.properties={},this.extent=h,this.type=0,this.id=void 0,this._pbf=n,this._geometry=-1,this._keys=p,this._values=x,n.readFields(or,this,o)}loadGeometry(){const n=this._pbf;n.pos=this._geometry;const o=n.readVarint()+n.pos,h=[];let p,x=1,v=0,w=0,C=0;for(;n.pos<o;){if(v<=0){const A=n.readVarint();x=7&A,v=A>>3}if(v--,x===1||x===2)w+=n.readSVarint(),C+=n.readSVarint(),x===1&&(p&&h.push(p),p=[]),p&&p.push(new At(w,C));else{if(x!==7)throw new Error(`unknown command ${x}`);p&&p.push(p[0].clone())}}return p&&h.push(p),h}bbox(){const n=this._pbf;n.pos=this._geometry;const o=n.readVarint()+n.pos;let h=1,p=0,x=0,v=0,w=1/0,C=-1/0,A=1/0,k=-1/0;for(;n.pos<o;){if(p<=0){const P=n.readVarint();h=7&P,p=P>>3}if(p--,h===1||h===2)x+=n.readSVarint(),v+=n.readSVarint(),x<w&&(w=x),x>C&&(C=x),v<A&&(A=v),v>k&&(k=v);else if(h!==7)throw new Error(`unknown command ${h}`)}return[w,A,C,k]}toGeoJSON(n,o,h){const p=this.extent*Math.pow(2,h),x=this.extent*n,v=this.extent*o,w=this.loadGeometry();function C(O){return[360*(O.x+x)/p-180,360/Math.PI*Math.atan(Math.exp((1-2*(O.y+v)/p)*Math.PI))-90]}function A(O){return O.map(C)}let k;if(this.type===1){const O=[];for(const W of w)O.push(W[0]);const G=A(O);k=O.length===1?{type:"Point",coordinates:G[0]}:{type:"MultiPoint",coordinates:G}}else if(this.type===2){const O=w.map(A);k=O.length===1?{type:"LineString",coordinates:O[0]}:{type:"MultiLineString",coordinates:O}}else{if(this.type!==3)throw new Error("unknown feature type");{const O=function(W){const te=W.length;if(te<=1)return[W];const se=[];let oe,ge;for(let ve=0;ve<te;ve++){const Te=Ar(W[ve]);Te!==0&&(ge===void 0&&(ge=Te<0),ge===Te<0?(oe&&se.push(oe),oe=[W[ve]]):oe&&oe.push(W[ve]))}return oe&&se.push(oe),se}(w),G=[];for(const W of O)G.push(W.map(A));k=G.length===1?{type:"Polygon",coordinates:G[0]}:{type:"MultiPolygon",coordinates:G}}}const P={type:"Feature",geometry:k,properties:this.properties};return this.id!=null&&(P.id=this.id),P}}function or(l,n,o){l===1?n.id=o.readVarint():l===2?function(h,p){const x=h.readVarint()+h.pos;for(;h.pos<x;){const v=p._keys[h.readVarint()],w=p._values[h.readVarint()];p.properties[v]=w}}(o,n):l===3?n.type=o.readVarint():l===4&&(n._geometry=o.pos)}function Ar(l){let n=0;for(let o,h,p=0,x=l.length,v=x-1;p<x;v=p++)o=l[p],h=l[v],n+=(h.x-o.x)*(o.y+h.y);return n}qt.types=["Unknown","Point","LineString","Polygon"];class tr{constructor(n,o){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(sr,this,o),this.length=this._features.length}feature(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];const o=this._pbf.readVarint()+this._pbf.pos;return new qt(this._pbf,o,this.extent,this._keys,this._values)}}function sr(l,n,o){l===15?n.version=o.readVarint():l===1?n.name=o.readString():l===5?n.extent=o.readVarint():l===2?n._features.push(o.pos):l===3?n._keys.push(o.readString()):l===4&&n._values.push(function(h){let p=null;const x=h.readVarint()+h.pos;for(;h.pos<x;){const v=h.readVarint()>>3;p=v===1?h.readString():v===2?h.readFloat():v===3?h.readDouble():v===4?h.readVarint64():v===5?h.readVarint():v===6?h.readSVarint():v===7?h.readBoolean():null}if(p==null)throw new Error("unknown feature value");return p}(o))}class kr{constructor(n,o){this.layers=n.readFields(yr,{},o)}}function yr(l,n,o){if(l===3){const h=new tr(o,o.readVarint()+o.pos);h.length&&(n[h.name]=h)}}const gr="3d_elevation_id",wr="level";class on{constructor(){this._valid=!1}reset(n){return this.feature=n,this._valid=!0,this._geometry=n.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(n,o){return this._valid&&n(o(this._geometry)),this}require(n,o,h){return this.get(n,!0,o,h)}optional(n,o,h){return this.get(n,!1,o,h)}success(){return this._valid}get(n,o,h,p){const x=this.feature.properties.hasOwnProperty(n)?+this.feature.properties[n]:void 0;return this._valid&&x!==void 0&&!Number.isNaN(x)?h(p?p(x):x):o&&(this._valid=!1),this}}class Jn{constructor(n,o){this.featureFunc=n,this.vertexFunc=o}parseFeature(n,o,h){return this.featureFunc(n,o,h)}parseVertex(n,o,h){return this.vertexFunc(n,o,h)}}const ui=new Jn((l,n,o)=>l.reset(n).require(gr,h=>{o.id=h}).optional("fixed_height_relative",h=>{o.constantHeight=h},wn.decodeRelativeHeight).geometry(h=>{o.bounds=h},Jm).success(),(l,n,o)=>l.reset(n).require(gr,h=>{o.id=h}).require("elevation_idx",h=>{o.idx=h}).require("extent",h=>{o.extent=h}).require("height_relative",h=>{o.height=h},wn.decodeRelativeHeight).geometry(h=>{o.position=h},wn.getPoint).success()),Xi=new Jn((l,n,o)=>l.reset(n).require(gr,h=>{o.id=h}).optional("fixed_height",h=>{o.constantHeight=h},wn.decodeMetricHeight).geometry(h=>{o.bounds=h},Jm).success(),(l,n,o)=>l.reset(n).require(gr,h=>{o.id=h}).require("elevation_idx",h=>{o.idx=h}).require("extent",h=>{o.extent=h}).require("height",h=>{o.height=h},wn.decodeMetricHeight).geometry(h=>{o.position=h},wn.getPoint).success());class wn{static getPoint(n){return An(n[0][0].x,n[0][0].y)}static decodeRelativeHeight(n){return 1e-4*n*5}static decodeMetricHeight(n){return 1e-4*n}static getVersionSchema(n){return n?n==="1.0.1"?Xi:void 0:ui}static parse(n){const o=[],h=[],p=n.length,x=new on;for(let v=0;v<p;v++){const w=n.feature(v),C=w.properties.version,A=wn.getVersionSchema(C);if(A===void 0){ur(`Unknown elevation feature version number ${C||"(unknown)"}`);continue}const k=w.properties.type;if(!k)continue;const P=qt.types[w.type];if(P==="Point"&&k==="curve_point"){const O={};A.parseVertex(x,w,O)&&o.push(O)}else if(P==="Polygon"&&k==="curve_meta"){const O={};A.parseFeature(x,w,O)&&h.push(O)}}return{vertices:o,features:h}}}class li{constructor(n,o){this.pos=n,this.dir=o}intersectsPlane(n,o,h){const p=Ua(o,this.dir);if(Math.abs(p)<1e-6)return!1;const x=((n[0]-this.pos[0])*o[0]+(n[1]-this.pos[1])*o[1])/p;return h[0]=this.pos[0]+this.dir[0]*x,h[1]=this.pos[1]+this.dir[1]*x,!0}}class Fn{constructor(n,o){this.pos=n,this.dir=o}intersectsPlane(n,o,h){const p=Gt(o,this.dir);if(Math.abs(p)<1e-6)return!1;const x=((n[0]-this.pos[0])*o[0]+(n[1]-this.pos[1])*o[1]+(n[2]-this.pos[2])*o[2])/p;return h[0]=this.pos[0]+this.dir[0]*x,h[1]=this.pos[1]+this.dir[1]*x,h[2]=this.pos[2]+this.dir[2]*x,!0}closestPointOnSphere(n,o,h){if(function(G,W){var te=G[0],se=G[1],oe=G[2],ge=W[0],ve=W[1],Te=W[2];return Math.abs(te-ge)<=S*Math.max(1,Math.abs(te),Math.abs(ge))&&Math.abs(se-ve)<=S*Math.max(1,Math.abs(se),Math.abs(ve))&&Math.abs(oe-Te)<=S*Math.max(1,Math.abs(oe),Math.abs(Te))}(this.pos,n)||o===0)return h[0]=h[1]=h[2]=0,!1;const[p,x,v]=this.dir,w=this.pos[0]-n[0],C=this.pos[1]-n[1],A=this.pos[2]-n[2],k=p*p+x*x+v*v,P=2*(w*p+C*x+A*v),O=P*P-4*k*(w*w+C*C+A*A-o*o);if(O<0){const G=Math.max(-P/2,0),W=w+p*G,te=C+x*G,se=A+v*G,oe=Math.hypot(W,te,se);return h[0]=W*o/oe,h[1]=te*o/oe,h[2]=se*o/oe,!1}{const G=(-P-Math.sqrt(O))/(2*k);if(G<0){const W=Math.hypot(w,C,A);return h[0]=w*o/W,h[1]=C*o/W,h[2]=A*o/W,!1}return h[0]=w+p*G,h[1]=C+x*G,h[2]=A+v*G,!0}}}class Wi{constructor(n,o,h,p,x){this.TL=n,this.TR=o,this.BR=h,this.BL=p,this.horizon=x}static fromInvProjectionMatrix(n,o,h){const p=[-1,1,1],x=[1,1,1],v=[1,-1,1],w=[-1,-1,1],C=nn(p,p,n),A=nn(x,x,n),k=nn(v,v,n),P=nn(w,w,n);return new Wi(C,A,k,P,o/h)}}function di(l,n,o){let h=1/0,p=-1/0;const x=[];for(const v of l){Nn(x,v,n);const w=Gt(x,o);h=Math.min(h,w),p=Math.max(p,w)}return[h,p]}function rs(l,n){let o=!0;for(let h=0;h<l.planes.length;h++){const p=l.planes[h];let x=0;for(let v=0;v<n.length;v++)x+=+(Gt(p,n[v])+p[3]>=0);if(x===0)return 0;x!==n.length&&(o=!1)}return o?2:1}function bi(l,n){for(const o of l.projections){const h=di(n,l.points[0],o.axis);if(o.projection[1]<h[0]||o.projection[0]>h[1])return 0}return 1}function Ln(l,n){let o=0;const h=[0,0,0,0];for(let v=0;v<l.length;v++)h[0]=l[v][0],h[1]=l[v][1],h[2]=l[v][2],h[3]=1,(p=h)[0]*(x=n)[0]+p[1]*x[1]+p[2]*x[2]+p[3]*x[3]>=0&&o++;var p,x;return o}class ki{constructor(n,o){this.points=n||new Array(8).fill([0,0,0]),this.planes=o||new Array(6).fill([0,0,0,0]),this.bounds=qn.fromPoints(this.points),this.projections=[],this.frustumEdges=[Nn([],this.points[2],this.points[3]),Nn([],this.points[0],this.points[3]),Nn([],this.points[4],this.points[0]),Nn([],this.points[5],this.points[1]),Nn([],this.points[6],this.points[2]),Nn([],this.points[7],this.points[3])];for(const h of this.frustumEdges){const p=[0,-h[2],h[1]],x=[h[2],0,-h[0]];this.projections.push({axis:p,projection:di(this.points,this.points[0],p)}),this.projections.push({axis:x,projection:di(this.points,this.points[0],x)})}}static fromInvProjectionMatrix(n,o,h,p){const x=Math.pow(2,h),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(A=>{const k=Sr([],A,n),P=1/k[3]/o*x;return(O=k)[0]=(G=k)[0]*(W=[P,P,p?1/k[3]:P,P])[0],O[1]=G[1]*W[1],O[2]=G[2]*W[2],O[3]=G[3]*W[3],O;var O,G,W}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(A=>{const k=zt([],jr([],Nn([],v[A[0]],v[A[1]]),Nn([],v[A[2]],v[A[1]]))),P=-Gt(k,v[A[1]]);return k.concat(P)}),C=[];for(let A=0;A<v.length;A++)C.push([v[A][0],v[A][1],v[A][2]]);return new ki(C,w)}intersectsPrecise(n,o,h){for(let p=0;p<o.length;p++)if(!Ln(n,o[p]))return 0;for(let p=0;p<this.planes.length;p++)if(!Ln(n,this.planes[p]))return 0;for(const p of h)for(const x of this.frustumEdges){const v=jr([],p,x),w=gt(v);if(w===0)continue;he(v,v,1/w);const C=di(this.points,this.points[0],v),A=di(n,this.points[0],v);if(C[0]>A[1]||A[0]>C[1])return 0}return 1}containsPoint(n){for(const o of this.planes){const h=o[3];if(Gt([o[0],o[1],o[2]],n)+h<0)return!1}return!0}}class qn{static fromPoints(n){const o=[1/0,1/0,1/0],h=[-1/0,-1/0,-1/0];for(const p of n)it(o,o,p),ee(h,h,p);return new qn(o,h)}static fromTileIdAndHeight(n,o,h){const p=1<<n.canonical.z,x=n.canonical.x,v=n.canonical.y;return new qn([x/p,v/p,o],[(x+1)/p,(v+1)/p,h])}static applyTransform(n,o){const h=n.getCorners();for(let p=0;p<h.length;++p)nn(h[p],h[p],o);return qn.fromPoints(h)}static applyTransformFast(n,o){const h=[o[12],o[13],o[14]],p=[...h];for(let x=0;x<3;x++)for(let v=0;v<3;v++){const w=o[4*v+x],C=w*n.min[v],A=w*n.max[v];h[x]+=Math.min(C,A),p[x]+=Math.max(C,A)}return new qn(h,p)}static projectAabbCorners(n,o){const h=n.getCorners();for(let p=0;p<h.length;++p)nn(h[p],h[p],o);return h}constructor(n,o){this.min=n,this.max=o,this.center=he([],Me([],this.min,this.max),.5)}quadrant(n){const o=[n%2==0,n<2],h=Qe(this.min),p=Qe(this.max);for(let x=0;x<o.length;x++)h[x]=o[x]?this.min[x]:this.center[x],p[x]=o[x]?this.center[x]:this.max[x];return p[2]=this.max[2],new qn(h,p)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}distanceZ(n){return Math.max(Math.min(this.max[2],n[2]),this.min[2])-n[2]}getCorners(){const n=this.min,o=this.max;return[[n[0],n[1],n[2]],[o[0],n[1],n[2]],[o[0],o[1],n[2]],[n[0],o[1],n[2]],[n[0],n[1],o[2]],[o[0],n[1],o[2]],[o[0],o[1],o[2]],[n[0],o[1],o[2]]]}intersects(n){return this.intersectsAabb(n.bounds)?rs(n,this.getCorners()):0}intersectsFlat(n){return this.intersectsAabb(n.bounds)?rs(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(n,o){return o||this.intersects(n)?bi(n,this.getCorners()):0}intersectsPreciseFlat(n,o){return o||this.intersectsFlat(n)?bi(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(n){for(let o=0;o<3;++o)if(this.min[o]>n.max[o]||n.min[o]>this.max[o])return!1;return!0}intersectsAabbXY(n){return!(this.min[0]>n.max[0]||n.min[0]>this.max[0]||this.min[1]>n.max[1]||n.min[1]>this.max[1])}encapsulate(n){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],n.min[o]),this.max[o]=Math.max(this.max[o],n.max[o])}encapsulatePoint(n){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],n[o]),this.max[o]=Math.max(this.max[o],n[o])}closestPoint(n){return[Math.max(Math.min(this.max[0],n[0]),this.min[0]),Math.max(Math.min(this.max[1],n[1]),this.min[1]),Math.max(Math.min(this.max[2],n[2]),this.min[2])]}}Tr(qn,"Aabb");class ps{constructor(n,o){this.feature=n,this.metersToTile=o,this.index=0}get(){const n=this.feature.vertices[this.index],o=this.feature.vertexProps[this.index].dir,h=o[1],p=-o[0],x=(n.extent+1)*this.metersToTile;return[new At(Math.trunc(n.position[0]+h*x),Math.trunc(n.position[1]+p*x)),new At(Math.trunc(n.position[0]-h*x),Math.trunc(n.position[1]-p*x))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Mi{constructor(n,o,h,p,x,v){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[hr(),hr(),hr(),hr(),hr(),hr(),hr()],this.id=n,this.heightRange={min:h,max:h},this.safeArea=o,this.constantHeight=h,this.constantHeight==null&&(this.constantHeight!=null||p.length!==0)){this.vertices=p,this.edges=x,this.edges=this.edges.filter(w=>{return w.a<this.vertices.length&&w.b<this.vertices.length&&!((C=this.vertices[w.a].position)[0]===(A=this.vertices[w.b].position)[0]&&C[1]===A[1]);var C,A}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const w of this.vertices)this.vertexProps.push({dir:An(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,w.height),this.heightRange.max=Math.max(this.heightRange.max,w.height);for(const w of this.edges){const C=this.vertices[w.a].position,A=this.vertices[w.b].position,k=$n(hr(),A,C),P=ii(k),O=vi(hr(),k,1/P);this.edgeProps.push({vec:k,dir:O,len:P});const G=this.vertexProps[w.a].dir,W=this.vertexProps[w.b].dir;Vi(G,G,O),Vi(W,W,O)}for(const w of this.vertexProps)w.dir[0]===0&&w.dir[1]===0||Ds(w.dir,w.dir);this.tessellate(v)}}pointElevation(n){if(this.constantHeight!=null)return this.constantHeight;const o=this.getClosestEdge(n);if(o==null)return 0;const[h,p]=o;return fn(this.vertices[this.edges[h].a].height,this.vertices[this.edges[h].b].height,p)}computeSlopeNormal(n,o){const h=this.getClosestEdge(n);if(!h)return Xe(0,0,1);const p=h[0],x=this.edges[p],v=this.edgeProps[p].vec,w=Xe(v[0],v[1],(this.vertices[x.b].height-this.vertices[x.a].height)*o),C=Xe(w[1],-w[0],0);jr(C,C,w);const A=gt(C);return A>0?he(C,C,1/A):ct(C,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(n){if(this.edges.length===0)return;let o=0,h=Number.POSITIVE_INFINITY,p=0;const[x,v,w,C,A,k,P]=this._tmpVec2;fi(P,n.x,n.y);const O=new li(P,null);for(let G=0;G<this.edges.length;G++){const W=this.edges[G],te=this.edgeProps[G].dir;O.dir=te;const se=this.vertices[W.a].position,oe=this.vertices[W.b].position,ge=O.intersectsPlane(se,this.vertexProps[W.a].dir,x),ve=O.intersectsPlane(oe,this.vertexProps[W.b].dir,v);if(!ge||!ve)continue;$n(w,v,x),$n(C,P,x);const Te=Ua(w,w),$e=Te>0?Ua(C,w)/Te:0,Fe=K($e,0,1),Ze=Math.abs(($e-Fe)*this.edgeProps[G].len);$n(A,P,se),fi(k,te[1],-te[0]);const Ye=Ze+Math.abs(Ua(A,k));Ye<h&&(o=G,h=Ye,p=Fe)}return[o,p]}tessellate(n){const o=qe(),h=qe(),p=qe(),x=qe();for(let v=this.edges.length-1;v>=0;--v){const w=this.edges[v].a,C=this.edges[v].b,{position:A,height:k,extent:P}=this.vertices[w],{position:O,height:G,extent:W}=this.vertices[C],te=this.vertexProps[w].dir,se=this.vertexProps[C].dir;if(ct(o,A[0]/n,A[1]/n,k),ct(h,O[0]/n,O[1]/n,G),ct(p,te[1],-te[0],0),he(p,p,P),ct(x,se[1],-se[0],0),he(x,x,W),this.distSqLines(Xe(o[0]+.5*p[0],o[1]+.5*p[1],o[2]+.5*p[2]),Xe(h[0]-.5*x[0],h[1]-.5*x[1],h[2]-.5*x[2]),Xe(o[0]-.5*p[0],o[1]-.5*p[1],o[2]-.5*p[2]),Xe(h[0]+.5*x[0],h[1]+.5*x[1],h[2]+.5*x[2]))<=.0025000000000000005)continue;const oe=this.vertices.length,ge=Vi(hr(),A,O);this.vertices.push({position:vi(ge,ge,.5),height:.5*(k+G),extent:.5*(P+W)});const ve=Vi(hr(),te,se);this.vertexProps.push({dir:Ds(ve,ve)}),this.edges.splice(v,1),this.edgeProps.splice(v,1),this.edges.push({a:w,b:oe}),this.edges.push({a:oe,b:C});const Te=$n(hr(),this.vertices[oe].position,A),$e=ii(Te),Fe={vec:Te,dir:vi(hr(),Te,1/$e),len:$e};this.edgeProps.push(Fe),this.edgeProps.push(Fe)}}distSqLines(n,o,h,p){const x=mt(qe(),o,n),v=mt(qe(),p,h),w=mt(qe(),n,h),C=Gt(x,x),A=Gt(x,v),k=Gt(x,w),P=Gt(v,v),O=Gt(v,w),G=C*P-A*A;if(G===0)return nt(Wr(x,h,p,Gt(w,v)/Gt(v,v)),n);const W=(C*O-A*k)/G;return nt(Wr(x,n,o,(A*O-k*P)/G),Wr(v,h,p,W))}}class Tn{static parseFrom(n,o){const h=wn.parse(n);if(!h)return[];let{vertices:p,features:x}=h;const v=1/We(o);x.sort((k,P)=>k.id-P.id),p.sort((k,P)=>k.id-P.id||k.idx-P.idx),p=p.filter((k,P,O)=>P===O.findIndex(G=>G.id===k.id&&G.idx===k.idx));const w=new Array;let C=0;const A=p.length;for(const k of x){if(k.constantHeight){w.push(new Mi(k.id,k.bounds,k.constantHeight));continue}for(;C!==A&&p[C].id<k.id;)C++;if(C===A||p[C].id!==k.id)continue;const P=new Array,O=new Array,G=C;for(;C!==A&&p[C].id===k.id;){const W=p[C];if(P.push({position:W.position,height:W.height,extent:W.extent}),C!==G&&p[C-1].idx===W.idx-1){const te=C-G;O.push({a:te-1,b:te})}C++}w.push(new Mi(k.id,k.bounds,void 0,P,O,v))}return w}static getElevationFeature(n,o){if(!o)return;const h=+n.properties[gr];return Number.isNaN(h)?void 0:o.find(p=>p.id===h)}}class pi{constructor(n,o){this.zScale=1,this.xOffset=0,this.yOffset=0,n.equals(o)||(this.zScale=Math.pow(2,o.z-n.z),this.xOffset=(n.x*this.zScale-o.x)*ar,this.yOffset=(n.y*this.zScale-o.y)*ar)}constantElevation(n,o){if(n.constantHeight!=null)return this.computeBiasedHeight(n.constantHeight,o)}pointElevation(n,o,h){const p=this.constantElevation(o,h);return p??(n.x=n.x*this.zScale+this.xOffset,n.y=n.y*this.zScale+this.yOffset,this.computeBiasedHeight(o.pointElevation(n),h))}computeBiasedHeight(n,o){return o<=0?n:n+o*ie(0,o,n>=0?n:Math.abs(.5*n))}}Tr(Mi,"ElevationFeature");class Cs{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.hasPattern=!1,this.projection=n.projection,this.layoutVertexArray=new tl,this.indexArray=new bs,this.segments=new Fs,this.programConfigurations=new Rc(n.layers,{zoom:n.zoom,lut:n.lut}),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new qu),this.worldview=n.worldview,this.hasAppearances=null}updateFootprints(n,o){}updateAppearances(n,o,h,p){}populate(n,o,h,p){const x=this.layers[0],v=[];let w=null;x.type==="circle"&&(w=x.layout.get("circle-sort-key"));for(const{feature:A,id:k,index:P,sourceLayerIndex:O}of n){const G=this.layers[0]._featureFilter.needGeometry,W=xt(A,G);if(!this.layers[0]._featureFilter.filter(new us(this.zoom,{worldview:this.worldview,activeFloors:o.activeFloors}),W,h))continue;const te=w?w.evaluate(W,{},h):void 0,se={id:k,properties:A.properties,type:A.type,sourceLayerIndex:O,index:P,geometry:G?W.geometry:Pt(A,h,p),patterns:{},sortKey:te};v.push(se)}w&&v.sort((A,k)=>A.sortKey-k.sortKey);let C=null;p.projection.name==="globe"&&(this.globeExtVertexArray=new E0,C=p.projection);for(const A of v){const{geometry:k,index:P,sourceLayerIndex:O}=A,G=n[P].feature;this.addFeature(A,k,P,o.availableImages,h,C,o.brightness,o.elevationFeatures),o.featureIndex.insert(G,k,P,O,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(n,o,h,p,x,v,w){this.programConfigurations.updatePaintArrays(n,o,x,h,p,v,w,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,K2.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,oj.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=n.createVertexBuffer(this.elevatedLayoutVertexArray,aj.members))),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(n,o,h,p,x,v,w,C){let A;this.elevationMode!=="none"&&(A=Tn.getElevationFeature(n,C));for(const k of o)for(const P of k){const O=P.x,G=P.y;if(O<0||O>=ar||G<0||G>=ar)continue;if(v){const se=v.projectTilePoint(O,G,x),oe=v.upVector(x,O,G);this.addGlobeExtVertex(se,oe),this.addGlobeExtVertex(se,oe),this.addGlobeExtVertex(se,oe),this.addGlobeExtVertex(se,oe)}const W=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),te=W.vertexLength;if(this.addCircleVertex(O,G,-1,-1),this.addCircleVertex(O,G,1,-1),this.addCircleVertex(O,G,1,1),this.addCircleVertex(O,G,-1,1),this.elevationMode!=="none"){const se=A?A.pointElevation(new At(O,G)):0;this.hasElevation=this.hasElevation||se!==0;for(let oe=0;oe<4;oe++)this.elevatedLayoutVertexArray.emplaceBack(se)}this.indexArray.emplaceBack(te,te+1,te+2),this.indexArray.emplaceBack(te,te+2,te+3),W.vertexLength+=4,W.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,h,{},p,x,w,void 0,this.worldview)}addCircleVertex(n,o,h,p){this.layoutVertexArray.emplaceBack(2*n+(h+1)/2,2*o+(p+1)/2)}addGlobeExtVertex(n,o){this.globeExtVertexArray.emplaceBack(n.x,n.y,n.z,o[0]*16384,o[1]*16384,o[2]*16384)}}function ra(l,n){for(let o=0;o<l.length;o++)if(Za(n,l[o]))return!0;for(let o=0;o<n.length;o++)if(Za(l,n[o]))return!0;return!!Vo(l,n)}function Ls(l,n,o){return!!Za(l,n)||!!go(n,l,o)}function Xs(l,n){if(l.length===1)return hc(n,l[0]);for(let o=0;o<n.length;o++){const h=n[o];for(let p=0;p<h.length;p++)if(Za(l,h[p]))return!0}for(let o=0;o<l.length;o++)if(hc(n,l[o]))return!0;for(let o=0;o<n.length;o++)if(Vo(l,n[o]))return!0;return!1}function nl(l,n,o){if(l.length>1){if(Vo(l,n))return!0;for(let h=0;h<n.length;h++)if(go(n[h],l,o))return!0}for(let h=0;h<l.length;h++)if(go(l[h],n,o))return!0;return!1}function Vo(l,n){if(l.length===0||n.length===0)return!1;for(let o=0;o<l.length-1;o++){const h=l[o],p=l[o+1];for(let x=0;x<n.length-1;x++)if(mo(h,p,n[x],n[x+1]))return!0}return!1}function mo(l,n,o,h){return Yr(l,o,h)!==Yr(n,o,h)&&Yr(l,n,o)!==Yr(l,n,h)}function wo(l,n,o){return(l.x-o.x)*(n.y-o.y)-(l.y-o.y)*(n.x-o.x)}function Dl(l,n,o,h){const p=wo(l,n,h),x=wo(l,n,o);if(Math.sign(p)===Math.sign(x))return;const v=wo(o,h,l),w=v+x-p;return Math.sign(v)!==Math.sign(w)?[v/(v-w),x/(x-p)]:void 0}function go(l,n,o){const h=o*o;if(n.length===1)return l.distSqr(n[0])<h;for(let p=1;p<n.length;p++)if(Rl(l,n[p-1],n[p])<h)return!0;return!1}function Rl(l,n,o){const h=n.distSqr(o);if(h===0)return l.distSqr(n);const p=((l.x-n.x)*(o.x-n.x)+(l.y-n.y)*(o.y-n.y))/h;return l.distSqr(p<0?n:p>1?o:o.sub(n)._mult(p)._add(n))}function hc(l,n){let o,h,p,x=!1;for(let v=0;v<l.length;v++){o=l[v];for(let w=0,C=o.length-1;w<o.length;C=w++)h=o[w],p=o[C],h.y>n.y!=p.y>n.y&&n.x<(p.x-h.x)*(n.y-h.y)/(p.y-h.y)+h.x&&(x=!x)}return x}function Za(l,n){let o=!1;for(let h=0,p=l.length-1;h<l.length;p=h++){const x=l[h],v=l[p];x.y>n.y!=v.y>n.y&&n.x<(v.x-x.x)*(n.y-x.y)/(v.y-x.y)+x.x&&(o=!o)}return o}function Vs(l,n,o,h,p){for(const v of l)if(n<=v.x&&o<=v.y&&h>=v.x&&p>=v.y)return!0;const x=[new At(n,o),new At(n,p),new At(h,p),new At(h,o)];if(l.length>2){for(const v of x)if(Za(l,v))return!0}for(let v=0;v<l.length-1;v++)if(na(l[v],l[v+1],x))return!0;return!1}function na(l,n,o){const h=o[0],p=o[2];if(l.x<h.x&&n.x<h.x||l.x>p.x&&n.x>p.x||l.y<h.y&&n.y<h.y||l.y>p.y&&n.y>p.y)return!1;const x=Yr(l,n,o[0]);return x!==Yr(l,n,o[1])||x!==Yr(l,n,o[2])||x!==Yr(l,n,o[3])}function ts(l,n,o,h,p,x){let v=n.y-l.y,w=l.x-n.x;if(x=x||0){const C=v*v+w*w;if(C===0)return!0;const A=Math.sqrt(C);v/=A,w/=A}return!((o.x-l.x)*v+(o.y-l.y)*w-x<0||(h.x-l.x)*v+(h.y-l.y)*w-x<0||(p.x-l.x)*v+(p.y-l.y)*w-x<0)}function la(l,n,o,h,p,x,v){return!(ts(l,n,h,p,x,v)||ts(n,o,h,p,x,v)||ts(o,l,h,p,x,v)||ts(h,p,l,n,o,v)||ts(p,x,l,n,o,v)||ts(x,h,l,n,o,v))}function Xa(l,n,o){const h=n.paint.get(l).value;return h.kind==="constant"?h.value:o.programConfigurations.get(n.id).getMaxValue(l)}function $s(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function Ml(l,n,o,h,p){if(!n[0]&&!n[1])return l;const x=At.convert(n)._mult(p);o==="viewport"&&x._rotate(-h);const v=[];for(let w=0;w<l.length;w++)v.push(l[w].sub(x));return v}function lp(l,n,o,h){const p=At.convert(l)._mult(h);return n==="viewport"&&p._rotate(-o),p}let Hu,cp;function up(l,n,o){var h=2*Math.PI*6378137/256/Math.pow(2,o);return[l*h-2*Math.PI*6378137/2,n*h-2*Math.PI*6378137/2]}Tr(Cs,"CircleBucket",{omit:["layers"]});class Ol{constructor(n,o,h){this.z=n,this.x=o,this.y=h,this.key=Fl(0,n,n,o,h)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}isChildOf(n){const o=this.z-n.z;return n.z===0||n.z<this.z&&n.x===this.x>>o&&n.y===this.y>>o}url(n,o){const h=function(x,v,w){var C=up(256*x,256*(v=Math.pow(2,w)-v-1),w),A=up(256*(x+1),256*(v+1),w);return C[0]+","+C[1]+","+A[0]+","+A[1]}(this.x,this.y,this.z),p=function(x,v,w){let C,A="";for(let k=x;k>0;k--)C=1<<k-1,A+=(v&C?1:0)+(w&C?2:0);return A}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",h)}toString(){return`${this.z}/${this.x}/${this.y}`}}class hu{constructor(n,o){this.wrap=n,this.canonical=o,this.key=Fl(n,o.z,o.z,o.x,o.y)}}class qa{constructor(n,o,h,p,x){this.overscaledZ=n,this.wrap=o,this.canonical=new Ol(h,+p,+x),this.key=o===0&&n===h?this.canonical.key:Fl(o,n,h,p,x)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){const o=this.canonical.z-n;return n>this.canonical.z?new qa(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new qa(n,this.wrap,n,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(n,o=!0){if(this.overscaledZ===n&&o)return this.key;if(n>this.canonical.z)return Fl(this.wrap*+o,n,this.canonical.z,this.canonical.x,this.canonical.y);{const h=this.canonical.z-n;return Fl(this.wrap*+o,n,n,this.canonical.x>>h,this.canonical.y>>h)}}isChildOf(n){if(n.wrap!==this.wrap)return!1;const o=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.z<this.canonical.z&&n.canonical.x===this.canonical.x>>o&&n.canonical.y===this.canonical.y>>o}children(n){if(this.overscaledZ>=n)return[new qa(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,h=2*this.canonical.x,p=2*this.canonical.y;return[new qa(o,this.wrap,o,h,p),new qa(o,this.wrap,o,h+1,p),new qa(o,this.wrap,o,h,p+1),new qa(o,this.wrap,o,h+1,p+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new qa(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new qa(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new hu(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Fl(l,n,o,h,p){const x=1<<Math.min(o,22);let v=x*(p%x)+h%x;return l&&o<22&&(v+=x*x*((l<0?-2*l-1:2*l)%(1<<2*(22-o)))),16*(32*v+o)+(n-o)}const Fh=[l=>{let n=l.canonical.x-1,o=l.wrap;return n<0&&(n=(1<<l.canonical.z)-1,o--),new qa(l.overscaledZ,o,l.canonical.z,n,l.canonical.y)},l=>{let n=l.canonical.x+1,o=l.wrap;return n===1<<l.canonical.z&&(n=0,o++),new qa(l.overscaledZ,o,l.canonical.z,n,l.canonical.y)},l=>new qa(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,(l.canonical.y===0?1<<l.canonical.z:l.canonical.y)-1),l=>new qa(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y===(1<<l.canonical.z)-1?0:l.canonical.y+1)];Tr(Ol,"CanonicalTileID"),Tr(qa,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const tS=Kn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:F0}=tS,TH=Kn([{name:"a_pos_3",components:3,type:"Int16"}]);var FM=Kn([{name:"a_pos",type:"Int16",components:2}]);function rS(l){return l*rl/L}const EH=[new qn([b,b,b],[T,T,T]),new qn([b,b,b],[0,0,T]),new qn([0,b,b],[T,0,T]),new qn([b,0,b],[0,T,T]),new qn([0,0,b],[T,T,T])];function LM(l,n,o,h=!0){const p=he([],l._camera.position,l.worldSize),x=[n,o,1,1];Sr(x,x,l.pixelMatrixInverse),Wt(x,x,1/x[3]);const v=zt([],Nn([],x,p)),w=l.globeMatrix,C=[w[12],w[13],w[14]],A=Nn([],C,p),k=gt(A),P=zt([],A),O=l.worldSize/(2*Math.PI),G=Gt(P,v),W=Math.asin(O/k);if(W<Math.acos(G)){if(!h)return null;const Tt=[],ot=[];he(Tt,v,k/G),zt(ot,Nn(ot,Tt,A)),zt(v,Me(v,A,he(v,ot,Math.tan(W)*k)))}const te=[];new Fn(p,v).closestPointOnSphere(C,O,te);const se=zt([],is(w,0)),oe=zt([],is(w,1)),ge=zt([],is(w,2)),ve=Gt(se,te),Te=Gt(oe,te),$e=Gt(ge,te),Fe=Er(Math.asin(-Te/O));let Ze=Er(Math.atan2(ve,$e));Ze=l.center.lng+function(Tt,ot){const Ct=(ot-Tt+180)%360-180;return Ct<-180?Ct+360:Ct}(l.center.lng,Ze);const Ye=fe(Ze),Je=K(de(Fe),0,1);return new st(Ye,Je)}class CH{constructor(n,o,h){this.a=Nn([],n,h),this.b=Nn([],o,h),this.center=h;const p=zt([],this.a),x=zt([],this.b);this.angle=Math.acos(Gt(p,x))}}function gj(l,n){if(l.angle===0)return null;let o;return o=l.a[n]===0?1/l.angle*.5*Math.PI:1/l.angle*Math.atan(l.b[n]/l.a[n]/Math.sin(l.angle)-1/Math.tan(l.angle)),o<0||o>1?null:function(h,p,x,v){const w=Math.sin(x);return h*(Math.sin((1-v)*x)/w)+p*(Math.sin(v*x)/w)}(l.a[n],l.b[n],l.angle,K(o,0,1))+l.center[n]}function qd(l){if(l.z<=1)return EH[l.z+2*l.y+l.x];const n=_j(nS(l));return qn.fromPoints(n)}function Lh(l,n,o){return he(l,l,1-o),Se(l,l,n,o)}function zM(l,n,o){for(const h of l)nn(h,h,n),he(h,h,o)}function BM(l,n,o,h){const p=n/l.worldSize,x=l.globeMatrix;if(o.z<=1){const Je=qd(o).getCorners();return zM(Je,x,p),qn.fromPoints(Je)}const v=nS(o,h),w=_j(v,rl+rS(l._tileCoverLift));zM(w,x,p);const C=Number.MAX_VALUE,A=[-C,-C,-C],k=[C,C,C];if(v.contains(l.center)){for(const ot of w)it(k,k,ot),ee(A,A,ot);A[2]=0;const Je=l.point,Tt=[Je.x*p,Je.y*p,0];return it(k,k,Tt),ee(A,A,Tt),new qn(k,A)}if(l._tileCoverLift>0){for(const Je of w)it(k,k,Je),ee(A,A,Je);return new qn(k,A)}const P=[x[12]*p,x[13]*p,x[14]*p],O=v.getCenter(),G=K(l.center.lat,-Ne,Ne),W=K(O.lat,-Ne,Ne),te=fe(l.center.lng),se=de(G);let oe=te-fe(O.lng);const ge=se-de(W);oe>.5?oe-=1:oe<-.5&&(oe+=1);let ve=0;Math.abs(oe)>Math.abs(ge)?ve=oe>=0?1:3:(ve=ge>=0?0:2,Se(P,P,[x[4]*p,x[5]*p,x[6]*p],-Math.sin(lt(ge>=0?v.getSouth():v.getNorth()))*rl));const Te=w[ve],$e=w[(ve+1)%4],Fe=new CH(Te,$e,P),Ze=[gj(Fe,0)||Te[0],gj(Fe,1)||Te[1],gj(Fe,2)||Te[2]],Ye=dp(l.zoom);if(Ye>0){const Je=function({x:ot,y:Ct,z:Mt},Bt,ir,Jt,Ft){const Yt=1/(1<<Mt);let wt=ot*Yt,vt=wt+Yt,Ht=Ct*Yt,rr=Ht+Yt,Lt=0;const br=(wt+vt)/2-Jt;return br>.5?Lt=-1:br<-.5&&(Lt=1),wt=((wt+Lt)*Bt-(Jt*=Bt))*ir+Jt,vt=((vt+Lt)*Bt-Jt)*ir+Jt,Ht=(Ht*Bt-(Ft*=Bt))*ir+Ft,rr=(rr*Bt-Ft)*ir+Ft,[[wt,rr,0],[vt,rr,0],[vt,Ht,0],[wt,Ht,0]]}(o,n,l._pixelsPerMercatorPixel,te,se);for(let ot=0;ot<w.length;ot++)Lh(w[ot],Je[ot],Ye);const Tt=Me([],Je[ve],Je[(ve+1)%4]);he(Tt,Tt,.5),Lh(Ze,Tt,Ye)}for(const Je of w)it(k,k,Je),ee(A,A,Je);return k[2]=Math.min(Te[2],$e[2]),it(k,k,Ze),ee(A,A,Ze),new qn(k,A)}function nS({x:l,y:n,z:o},h=!1){const p=1/(1<<o),x=new X(je(l*p),n===(1<<o)-1&&h?-90:we((n+1)*p)),v=new X(je((l+1)*p),n===0&&h?90:we(n*p));return new q(x,v)}function _j(l,n=rl){const o=lt(l.getNorth()),h=lt(l.getSouth()),p=Math.cos(o),x=Math.cos(h),v=Math.sin(o),w=Math.sin(h),C=l.getWest(),A=l.getEast();return[j(x,w,C,n),j(x,w,A,n),j(p,v,A,n),j(p,v,C,n)]}function h1(l,n,o,h){const p=1<<o.z,x=(l/ar+o.x)/p;return N(we((n/ar+o.y)/p),je(x),h)}function iS({min:l,max:n}){return d/Math.max(n[0]-l[0],n[1]-l[1],n[2]-l[2])}const UM=new Float64Array(16);function sS(l){const n=iS(l),o=pe(UM,[n,n,n]);return J(o,o,Vt([],l.min))}function xj(l){const n=(h=l.min,(o=UM)[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=h[0],o[13]=h[1],o[14]=h[2],o[15]=1,o);var o,h;const p=1/iS(l);return ne(n,n,[p,p,p])}function vj(l){const n=ar/(2*Math.PI);return l/(2*Math.PI)/n}function VM(l,n){return ar/(512*Math.pow(2,l))*iS(qd(n))}function $M(l,n,o,h,p){const x=vj(o),v=[l,n,-o/(2*Math.PI)],w=U(new Float64Array(16));return J(w,w,v),ne(w,w,[x,x,x]),me(w,w,lt(-p)),le(w,w,lt(-h)),w}function dp(l){return ie(g,a,l)}function qM(l,n){const o=N(n.lat,n.lng),h=function(W){const te=N(W._center.lat,W._center.lng);let se=jr([],Xe(0,1,0),te);const oe=be([],-W.angle,te);se=nn(se,se,oe),be(oe,-W._pitch,se);const ge=zt([],te);return he(ge,ge,rS(W.cameraToCenterDistance/W.pixelsPerMeter)),nn(ge,ge,oe),Me([],te,ge)}(l);return v=(p=mt([],h,o))[0],w=p[1],C=p[2],A=(x=o)[0],k=x[1],P=x[2],G=(O=Math.sqrt((v*v+w*w+C*C)*(A*A+k*k+P*P)))&&Gt(p,x)/O,Math.acos(Math.min(Math.max(G,-1),1));var p,x,v,w,C,A,k,P,O,G}function yj(l,n){return qM(l,n)>Math.PI/2*1.01}const GM=lt(85),AH=Math.cos(GM),jH=Math.sin(GM),IH=H(),WM=l=>{const n=[];return l.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),l.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n};function HM(l,n,o,h,p,x,v,w,C){if(x&&l.queryGeometry.isAboveHorizon)return!1;x&&(C*=l.pixelToTileUnitsFactor);const A=l.tileID.canonical,k=o.projection.upVectorScale(A,o.center.lat,o.worldSize).metersToTile;for(const P of n)for(const O of P){const G=O.add(w),W=p&&o.elevation?o.elevation.exaggeration()*p.getElevationAt(G.x,G.y,!0):0,te=o.projection.projectTilePoint(G.x,G.y,A);if(W>0){const ve=o.projection.upVector(A,G.x,G.y);te.x+=ve[0]*k*W,te.y+=ve[1]*k*W,te.z+=ve[2]*k*W}const se=x?G:NH(te.x,te.y,te.z,h),oe=x?l.tilespaceRays.map(ve=>PH(ve,W)):l.queryGeometry.screenGeometry,ge=Sr([],[te.x,te.y,te.z,1],h);if(!v&&x?C*=ge[3]/o.cameraToCenterDistance:v&&!x&&(C*=o.cameraToCenterDistance/ge[3]),x){const ve=we((O.y/ar+A.y)/(1<<A.z));C/=o.projection.pixelsPerMeter(ve,1)/xe(1,ve)}if(Ls(oe,se,C))return!0}return!1}function NH(l,n,o,h){const p=Sr([],[l,n,o,1],h);return new At(p[0]/p[3],p[1]/p[3])}const ZM=Xe(0,0,0),kH=Xe(0,0,1);function PH(l,n){const o=qe();return ZM[2]=n,l.intersectsPlane(ZM,kH,o),new At(o[0],o[1])}class XM extends Cs{}let YM,KM,JM,QM;function eO(l,{width:n,height:o},h,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==n*o*h)throw new RangeError("mismatched image size")}else p=new Uint8Array(n*o*h);return l.width=n,l.height=o,l.data=p,l}function tO(l,n,o){const{width:h,height:p}=n;h===l.width&&p===l.height||(wj(l,n,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,h),height:Math.min(l.height,p)},o,null),l.width=h,l.height=p,l.data=n.data)}function wj(l,n,o,h,p,x,v,w){if(p.width===0||p.height===0)return n;if(p.width>l.width||p.height>l.height||o.x>l.width-p.width||o.y>l.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>n.width||p.height>n.height||h.x>n.width-p.width||h.y>n.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const C=l.data,A=n.data,k=x===4&&w;for(let P=0;P<p.height;P++){const O=((o.y+P)*l.width+o.x)*x,G=((h.y+P)*n.width+h.x)*x;if(k)for(let W=0;W<p.width;W++){const te=O+W*x+3,se=G+W*x;A[se+0]=255,A[se+1]=255,A[se+2]=255,A[se+3]=C[te]}else if(v)for(let W=0;W<p.width;W++){const te=O+W*x,se=G+W*x,oe=new Li(C[te+0]/255,C[te+1]/255,C[te+2]/255,C[te+3]).toNonPremultipliedRenderColor(v).toArray();A[se+0]=oe[0],A[se+1]=oe[1],A[se+2]=oe[2],A[se+3]=oe[3]}else for(let W=0;W<p.width*x;W++)A[G+W]=C[O+W]}return n}Tr(XM,"HeatmapBucket",{omit:["layers"]});class hp{constructor(n,o){eO(this,n,1,o)}resize(n){tO(this,new hp(n),1)}clone(){return new hp({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,o,h,p,x){wj(n,o,h,p,x,1,null)}}class bo{constructor(n,o){eO(this,n,4,o)}resize(n){tO(this,new bo(n),4)}replace(n,o){o?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new bo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,o,h,p,x,v,w){wj(n,o,h,p,x,4,v,w)}}class rO{constructor(n,o){this.width=n.width,this.height=n.height,this.data=o instanceof Uint8Array?new Float32Array(o.buffer):o}}function f1(l){const n={},o=l.resolution||256,h=l.clips?l.clips.length:1,p=l.image||new bo({width:o,height:h}),x=(v,w,C)=>{n[l.evaluationKey]=C;const A=l.expression.evaluate(n),k=A?A.toNonPremultipliedRenderColor(null):null;k&&(p.data[v+w+0]=Math.floor(255*k.r),p.data[v+w+1]=Math.floor(255*k.g),p.data[v+w+2]=Math.floor(255*k.b),p.data[v+w+3]=Math.floor(255*k.a))};if(l.clips)for(let v=0,w=0;v<h;++v,w+=4*o)for(let C=0,A=0;C<o;C++,A+=4){const k=C/(o-1),{start:P,end:O}=l.clips[v];x(w,A,P*(1-k)+O*k)}else for(let v=0,w=0;v<o;v++,w+=4)x(0,w,v/(o-1));return p}Tr(hp,"AlphaImage"),Tr(bo,"RGBAImage");const DH=Kn([{name:"a_pos",components:2,type:"Int16"}],4),RH=Kn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),MH=Kn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),OH=Kn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function L0(l,n,o=2){const h=n&&n.length,p=h?n[0]*o:l.length;let x=nO(l,0,p,o,!0);const v=[];if(!x||x.next===x.prev)return v;let w,C,A;if(h&&(x=function(k,P,O,G){const W=[];for(let te=0,se=P.length;te<se;te++){const oe=nO(k,P[te]*G,te<se-1?P[te+1]*G:k.length,G,!1);oe===oe.next&&(oe.steiner=!0),W.push(qH(oe))}W.sort(UH);for(let te=0;te<W.length;te++)O=VH(W[te],O);return O}(l,n,x,o)),l.length>80*o){w=l[0],C=l[1];let k=w,P=C;for(let O=o;O<p;O+=o){const G=l[O],W=l[O+1];G<w&&(w=G),W<C&&(C=W),G>k&&(k=G),W>P&&(P=W)}A=Math.max(k-w,P-C),A=A!==0?32767/A:0}return p1(x,v,o,w,C,A,0),v}function nO(l,n,o,h,p){let x;if(p===function(v,w,C,A){let k=0;for(let P=w,O=C-A;P<C;P+=A)k+=(v[O]-v[P])*(v[P+1]+v[O+1]),O=P;return k}(l,n,o,h)>0)for(let v=n;v<o;v+=h)x=oO(v/h|0,l[v],l[v+1],x);else for(let v=o-h;v>=n;v-=h)x=oO(v/h|0,l[v],l[v+1],x);return x&&z0(x,x.next)&&(_1(x),x=x.next),x}function wg(l,n){if(!l)return l;n||(n=l);let o,h=l;do if(o=!1,h.steiner||!z0(h,h.next)&&Ya(h.prev,h,h.next)!==0)h=h.next;else{if(_1(h),h=n=h.prev,h===h.next)break;o=!0}while(o||h!==n);return n}function p1(l,n,o,h,p,x,v){if(!l)return;!v&&x&&function(C,A,k,P){let O=C;do O.z===0&&(O.z=bj(O.x,O.y,A,k,P)),O.prevZ=O.prev,O.nextZ=O.next,O=O.next;while(O!==C);O.prevZ.nextZ=null,O.prevZ=null,function(G){let W,te=1;do{let se,oe=G;G=null;let ge=null;for(W=0;oe;){W++;let ve=oe,Te=0;for(let Fe=0;Fe<te&&(Te++,ve=ve.nextZ,ve);Fe++);let $e=te;for(;Te>0||$e>0&&ve;)Te!==0&&($e===0||!ve||oe.z<=ve.z)?(se=oe,oe=oe.nextZ,Te--):(se=ve,ve=ve.nextZ,$e--),ge?ge.nextZ=se:G=se,se.prevZ=ge,ge=se;oe=ve}ge.nextZ=null,te*=2}while(W>1)}(O)}(l,h,p,x);let w=l;for(;l.prev!==l.next;){const C=l.prev,A=l.next;if(x?LH(l,h,p,x):FH(l))n.push(C.i,l.i,A.i),_1(l),l=A.next,w=A.next;else if((l=A)===w){v?v===1?p1(l=zH(wg(l),n),n,o,h,p,x,2):v===2&&BH(l,n,o,h,p,x):p1(wg(l),n,o,h,p,x,1);break}}}function FH(l){const n=l.prev,o=l,h=l.next;if(Ya(n,o,h)>=0)return!1;const p=n.x,x=o.x,v=h.x,w=n.y,C=o.y,A=h.y,k=Math.min(p,x,v),P=Math.min(w,C,A),O=Math.max(p,x,v),G=Math.max(w,C,A);let W=h.next;for(;W!==n;){if(W.x>=k&&W.x<=O&&W.y>=P&&W.y<=G&&m1(p,w,x,C,v,A,W.x,W.y)&&Ya(W.prev,W,W.next)>=0)return!1;W=W.next}return!0}function LH(l,n,o,h){const p=l.prev,x=l,v=l.next;if(Ya(p,x,v)>=0)return!1;const w=p.x,C=x.x,A=v.x,k=p.y,P=x.y,O=v.y,G=Math.min(w,C,A),W=Math.min(k,P,O),te=Math.max(w,C,A),se=Math.max(k,P,O),oe=bj(G,W,n,o,h),ge=bj(te,se,n,o,h);let ve=l.prevZ,Te=l.nextZ;for(;ve&&ve.z>=oe&&Te&&Te.z<=ge;){if(ve.x>=G&&ve.x<=te&&ve.y>=W&&ve.y<=se&&ve!==p&&ve!==v&&m1(w,k,C,P,A,O,ve.x,ve.y)&&Ya(ve.prev,ve,ve.next)>=0||(ve=ve.prevZ,Te.x>=G&&Te.x<=te&&Te.y>=W&&Te.y<=se&&Te!==p&&Te!==v&&m1(w,k,C,P,A,O,Te.x,Te.y)&&Ya(Te.prev,Te,Te.next)>=0))return!1;Te=Te.nextZ}for(;ve&&ve.z>=oe;){if(ve.x>=G&&ve.x<=te&&ve.y>=W&&ve.y<=se&&ve!==p&&ve!==v&&m1(w,k,C,P,A,O,ve.x,ve.y)&&Ya(ve.prev,ve,ve.next)>=0)return!1;ve=ve.prevZ}for(;Te&&Te.z<=ge;){if(Te.x>=G&&Te.x<=te&&Te.y>=W&&Te.y<=se&&Te!==p&&Te!==v&&m1(w,k,C,P,A,O,Te.x,Te.y)&&Ya(Te.prev,Te,Te.next)>=0)return!1;Te=Te.nextZ}return!0}function zH(l,n){let o=l;do{const h=o.prev,p=o.next.next;!z0(h,p)&&sO(h,o,o.next,p)&&g1(h,p)&&g1(p,h)&&(n.push(h.i,o.i,p.i),_1(o),_1(o.next),o=l=p),o=o.next}while(o!==l);return wg(o)}function BH(l,n,o,h,p,x){let v=l;do{let w=v.next.next;for(;w!==v.prev;){if(v.i!==w.i&&GH(v,w)){let C=aO(v,w);return v=wg(v,v.next),C=wg(C,C.next),p1(v,n,o,h,p,x,0),void p1(C,n,o,h,p,x,0)}w=w.next}v=v.next}while(v!==l)}function UH(l,n){let o=l.x-n.x;return o===0&&(o=l.y-n.y,o===0)&&(o=(l.next.y-l.y)/(l.next.x-l.x)-(n.next.y-n.y)/(n.next.x-n.x)),o}function VH(l,n){const o=function(p,x){let v=x;const w=p.x,C=p.y;let A,k=-1/0;if(z0(p,v))return v;do{if(z0(p,v.next))return v.next;if(C<=v.y&&C>=v.next.y&&v.next.y!==v.y){const te=v.x+(C-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(te<=w&&te>k&&(k=te,A=v.x<v.next.x?v:v.next,te===w))return A}v=v.next}while(v!==x);if(!A)return null;const P=A,O=A.x,G=A.y;let W=1/0;v=A;do{if(w>=v.x&&v.x>=O&&w!==v.x&&iO(C<G?w:k,C,O,G,C<G?k:w,C,v.x,v.y)){const te=Math.abs(C-v.y)/(w-v.x);g1(v,p)&&(te<W||te===W&&(v.x>A.x||v.x===A.x&&$H(A,v)))&&(A=v,W=te)}v=v.next}while(v!==P);return A}(l,n);if(!o)return n;const h=aO(o,l);return wg(h,h.next),wg(o,o.next)}function $H(l,n){return Ya(l.prev,l,n.prev)<0&&Ya(n.next,l,l.next)<0}function bj(l,n,o,h,p){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-o)*p|0)|l<<8))|l<<4))|l<<2))|l<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-h)*p|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function qH(l){let n=l,o=l;do(n.x<o.x||n.x===o.x&&n.y<o.y)&&(o=n),n=n.next;while(n!==l);return o}function iO(l,n,o,h,p,x,v,w){return(p-v)*(n-w)>=(l-v)*(x-w)&&(l-v)*(h-w)>=(o-v)*(n-w)&&(o-v)*(x-w)>=(p-v)*(h-w)}function m1(l,n,o,h,p,x,v,w){return!(l===v&&n===w)&&iO(l,n,o,h,p,x,v,w)}function GH(l,n){return l.next.i!==n.i&&l.prev.i!==n.i&&!function(o,h){let p=o;do{if(p.i!==o.i&&p.next.i!==o.i&&p.i!==h.i&&p.next.i!==h.i&&sO(p,p.next,o,h))return!0;p=p.next}while(p!==o);return!1}(l,n)&&(g1(l,n)&&g1(n,l)&&function(o,h){let p=o,x=!1;const v=(o.x+h.x)/2,w=(o.y+h.y)/2;do p.y>w!=p.next.y>w&&p.next.y!==p.y&&v<(p.next.x-p.x)*(w-p.y)/(p.next.y-p.y)+p.x&&(x=!x),p=p.next;while(p!==o);return x}(l,n)&&(Ya(l.prev,l,n.prev)||Ya(l,n.prev,n))||z0(l,n)&&Ya(l.prev,l,l.next)>0&&Ya(n.prev,n,n.next)>0)}function Ya(l,n,o){return(n.y-l.y)*(o.x-n.x)-(n.x-l.x)*(o.y-n.y)}function z0(l,n){return l.x===n.x&&l.y===n.y}function sO(l,n,o,h){const p=oS(Ya(l,n,o)),x=oS(Ya(l,n,h)),v=oS(Ya(o,h,l)),w=oS(Ya(o,h,n));return p!==x&&v!==w||!(p!==0||!aS(l,o,n))||!(x!==0||!aS(l,h,n))||!(v!==0||!aS(o,l,h))||!(w!==0||!aS(o,n,h))}function aS(l,n,o){return n.x<=Math.max(l.x,o.x)&&n.x>=Math.min(l.x,o.x)&&n.y<=Math.max(l.y,o.y)&&n.y>=Math.min(l.y,o.y)}function oS(l){return l>0?1:l<0?-1:0}function g1(l,n){return Ya(l.prev,l,l.next)<0?Ya(l,n,l.next)>=0&&Ya(l,l.prev,n)>=0:Ya(l,n,l.prev)<0||Ya(l,l.next,n)<0}function aO(l,n){const o=Sj(l.i,l.x,l.y),h=Sj(n.i,n.x,n.y),p=l.next,x=n.prev;return l.next=n,n.prev=l,o.next=p,p.prev=o,h.next=o,o.prev=h,x.next=h,h.prev=x,h}function oO(l,n,o,h){const p=Sj(l,n,o);return h?(p.next=h.next,p.prev=h,h.next.prev=p,h.next=p):(p.prev=p,p.next=p),p}function _1(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function Sj(l,n,o){return{i:l,x:n,y:o,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function x1(l,n){const o=l.length;if(o<=1)return[l];const h=[];let p,x;for(let v=0;v<o;v++){const w=Xr(l[v]);w!==0&&(l[v].area=Math.abs(w),x===void 0&&(x=w<0),x===w<0?(p&&h.push(p),p=[l[v]]):p.push(l[v]))}if(p&&h.push(p),n>1)for(let v=0;v<h.length;v++)h[v].length<=n||(Bu(h[v],n,1,h[v].length-1,WH),h[v]=h[v].slice(0,n));return h}function WH(l,n){return n.area-l.area}function lO(l,n,o=1){if(!l)return null;const h=typeof l=="string"?el.from(l).getPrimary():l.getPrimary(),p=typeof l=="string"?null:l.getSecondary();for(const x of[h,p]){if(!x)continue;const v=x.id.toString();n.has(v)||n.set(v,[]),x.scaleSelf(o),n.get(v).push(x)}return{primary:h.toString(),secondary:p?p.toString():null}}function Tj(l,n,o,h){const p=h.patternDependencies;let x=!1;for(const v of n){const w=v.paint.get(`${l}-pattern`);w.isConstant()||(x=!0),lO(w.constantOr(null),p,o)&&(x=!0)}return x}function Ej(l,n,o,h,p,x){const v=x.patternDependencies;for(const w of n){const C=w.paint.get(`${l}-pattern`).value;if(C.kind!=="constant"){let A=C.evaluate({zoom:h},o,{},x.availableImages);A=A&&A.name?A.name:A;const k=lO(A,v,p);if(!k)continue;const{primary:P,secondary:O}=k;P&&(o.patterns[w.id]=[P,O].filter(Boolean))}}return o}class cO{constructor(){this.polygons=new Map}add(n,...o){const h=this.polygons.get(n);h?h.push(...o):this.polygons.set(n,o)}merge(n){for(const[o,h]of n.polygons)this.add(o,...h)}}class zh{constructor(){this.portals=[]}static isOnBorder(n,o){return n<=0&&o<=0||n>=ar&&o>=ar}static evaluate(n){if(n.length===0)return new zh;let o=[];for(const C of n)o.push(...C.portals);if(o.length===0)return new zh;for(const C of o){const A=C.va,k=C.vb;(zh.isOnBorder(A.x,k.x)||zh.isOnBorder(A.y,k.y))&&(C.type="border")}const h=o.filter(C=>C.type!=="unevaluated"),p=o.filter(C=>C.type==="unevaluated");if(p.length===0)return new zh;p.sort((C,A)=>C.hash===A.hash?C.isTunnel===A.isTunnel?0:C.isTunnel?-1:1:C.hash<A.hash?1:-1),o=h.concat(p);let x=h.length,v=x,w=x;do if(v++,v===o.length||o[x].hash!==o[v].hash){if(v-x==2){w<x&&(o[w]=o[x],o[x]=null);const C=o[w],A=o[v-1];C.type=C.isTunnel!==A.isTunnel?"tunnel":"polygon",C.connection={a:C.connection.a,b:A.connection.a},w++}x=v}while(x!==o.length);return o.splice(w),o.sort((C,A)=>C.hash<A.hash?1:-1),{portals:o}}}Tr(zh,"ElevationPortalGraph"),Tr(cO,"ElevationPolygons");class HH{constructor(n,o,h){this.outPositions=n,this.outNormals=o,this.outIndices=h,this.vertexLookup=new Map}addVertex(n,o,h){let p=n[2];h!=null&&(p*=h);const x=`${n[0]},${n[1]},${n[2]},${o[0]},${o[1]},${o[2]}`,v=this.vertexLookup.get(x);if(v!=null)return v;const w=this.outPositions.length;this.vertexLookup.set(x,w);const C=Math.trunc(16384*o[0]),A=Math.trunc(16384*o[1]),k=Math.trunc(16384*o[2]);return this.outPositions.emplaceBack(n[0],n[1],p),this.outNormals.emplaceBack(C,A,k),w}addTriangle(n,o,h){this.outIndices.emplaceBack(n,o,h)}addTriangles(n,o,h){if(n.length===0)return;const p=h.length===1,x=qe(),v=qe();for(let w=0;w<n.length;w+=3){const C=o[n[w+0]],A=o[n[w+1]],k=o[n[w+2]],P=p?h[0]:h[n[w+1]],O=p?h[0]:h[n[w+2]];ct(x,C.x,C.y,p?h[0]:h[n[w+0]]);const G=this.addVertex(x,v);ct(x,A.x,A.y,P);const W=this.addVertex(x,v);ct(x,k.x,k.y,O);const te=this.addVertex(x,v);this.outIndices.emplaceBack(G,W,te)}}addQuad(n,o,h,p,x,v){const w=this.addVertex(n,x,v),C=this.addVertex(o,x,v),A=this.addVertex(h,x,v),k=this.addVertex(p,x,v);this.addTriangle(w,C,A),this.addTriangle(A,k,w)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class Ll{constructor(n,o,h,p){this.unevaluatedPortals=new zh,this.portalPolygons=new cO,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Zy,this.vertexNormals=new Xy,this.indexArray=new bs,this.tileToMeters=We(n),this.bridgeProgramConfigurations=new Rc(o,{zoom:h,lut:p},x=>x!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new Rc(o,{zoom:h,lut:p},x=>x!=="fill-bridge-guard-rail-color")}addVertices(n,o){const h=this.unevalVertices.length;for(let p=0;p<n.length;p++)this.unevalVertices.push(n[p]),this.unevalHeights.push(o[p]);return h}addTriangles(n,o,h){const p=h?this.unevalTunnelTriangles:this.unevalTriangles;for(const x of n)p.push(x+o)}addRenderableRing(n,o,h,p,x,v){const w=[new At(x.min.x,x.min.y),new At(x.max.x,x.min.y),new At(x.max.x,x.max.y),new At(x.min.x,x.max.y)];for(let C=0;C<h-1;C++){const A=o+C,k=A+1,P=this.unevalVertices[A],O=this.unevalVertices[k];if(!(P.x>=x.min.x&&P.x<=x.max.x&&P.y>=x.min.y&&P.y<=x.max.y||O.x>=x.min.x&&O.x<=x.max.x&&O.y>=x.min.y&&O.y<=x.max.y||na(P,O,w))||this.isOnBorder(P.x,O.x)||this.isOnBorder(P.y,O.y))continue;const G=Ll.computeEdgeHash(this.unevalVertices[A],this.unevalVertices[k]);let W,te=this.vertexHashLookup.get(Ll.computePosHash(P));te!=null?W=te.next:(te=this.vertexHashLookup.get(Ll.computePosHash(O)),W=te!=null?te.prev:G),this.unevalEdges.push({polygonIdx:n,a:A,b:k,hash:G,portalHash:W,isTunnel:p,type:"unevaluated",featureInfo:v})}}addPortalCandidates(n,o,h,p,x){if(o.length===0)return;this.portalPolygons.add(n,{geometry:o,zLevel:x});const v=o[0];this.vertexHashLookup.clear();let w=Ll.computeEdgeHash(v[v.length-2],v[v.length-1]);for(let C=0;C<v.length-1;C++){const A=v[C+0],k=v[C+1],P=An(k.x-A.x,k.y-A.y),O=ii(P);if(O===0)continue;let G="unevaluated";const W=p.pointElevation(A),te=p.pointElevation(k);Math.abs(W)<.01&&Math.abs(te)<.01?G="entrance":(this.isOnBorder(A.x,k.x)||this.isOnBorder(A.y,k.y))&&(G="border");const se=Ll.computeEdgeHash(A,k);this.unevaluatedPortals.portals.push({connection:{a:n,b:void 0},va:A,vb:k,vab:P,length:O,hash:se,isTunnel:h,type:G});const oe=Ll.computePosHash(A);this.vertexHashLookup.set(oe,{prev:w,next:se}),w=se}}construct(n){if(this.unevalVertices.length===0)return;const o=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),h=O=>{O.primitiveLength=this.indexArray.length-O.primitiveOffset},p=new HH(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(n.portals,this.unevalEdges);const x=o(),v=o(),w=o(),C=(O,G)=>{O.sort((te,se)=>te.type===G&&se.type!==G?-1:te.type!==G&&se.type===G?1:0);const W=O.findIndex(te=>te.type!==G);return W>=0?W:O.length};let A=0;this.unevalEdges.length>0&&(A=C(this.unevalEdges,"none"),this.constructBridgeStructures(p,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:A},this.tileToMeters)),h(w);const k=o(),P=o();if(this.unevalEdges.length>0){const O=this.unevalEdges.splice(A),G=C(O,"tunnel")+A;this.unevalEdges.push(...O),this.constructTunnelStructures(p,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:A},{min:A,max:G})}h(k),p.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),h(P),p.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),h(v),p.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),h(x),this.maskSegments=Fs.simpleSegment(0,P.primitiveOffset,0,P.primitiveLength),this.depthSegments=Fs.simpleSegment(0,v.primitiveOffset,0,v.primitiveLength),this.renderableBridgeSegments=Fs.simpleSegment(0,w.primitiveOffset,0,w.primitiveLength),this.renderableTunnelSegments=Fs.simpleSegment(0,k.primitiveOffset,0,k.primitiveLength),this.shadowCasterSegments=Fs.simpleSegment(0,x.primitiveOffset,0,x.primitiveLength)}update(n,o,h,p,x,v,w,C){this.bridgeProgramConfigurations.updatePaintArrays(n,o,x,h,p,v,w,C),this.tunnelProgramConfigurations.updatePaintArrays(n,o,x,h,p,v,w,C)}upload(n){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=n.createVertexBuffer(this.vertexPositions,MH.members),this.vertexBufferNormal=n.createVertexBuffer(this.vertexNormals,OH.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(n),this.tunnelProgramConfigurations.upload(n))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(n,o,h,p,x){const v=(w,C)=>{for(let A=0;A<C.length-1;A++){const k=C[A].featureIndex,P=C[A+1].vertexStart,O=n.feature(k);w.populatePaintArrays(P,O,k,{},h,o,p,void 0,x)}};v(this.bridgeProgramConfigurations,this.bridgeFeatureSections),v(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(n,o,h,p,x){const v=new Map;for(let w=p;w<x;w++){const C=h[w],A=C.a,k=C.b,P=Ll.computePosHash(n[A]),O=Ll.computePosHash(n[k]);let G=v.get(P);G||(G={},v.set(P,G));let W=v.get(O);W||(W={},v.set(O,W)),o[A]<=0&&o[k]<=0||(G.to=k,W.from=A)}return v}isTerminalVertex(n,o){const h=Ll.computePosHash(this.unevalVertices[n]),p=o.get(h);return!p||!p.from||!p.to}constructBridgeStructures(n,o,h,p,x,v){n.clearVertexLookup();const w=this.computeVertexConnections(o,h,p,x.min,x.max),C=1/v,A=.5*C,k=(ir,Jt)=>ct(ir,o[Jt].x,o[Jt].y,h[Jt]*C),P=qe(),O=qe(),G=qe(),W=qe(),te=qe(),se=(ir,Jt)=>{const Ft=w.get(Ll.computePosHash(o[Jt])),Yt=Ft.from,wt=Ft.to;if(!Yt||!wt)return;k(P,Yt),k(O,Jt),k(G,wt),Dn(W),Zr(P,O)||(Nn(te,O,P),zt(W,te)),Zr(G,O)||(Nn(te,G,O),Me(W,W,zt(te,te)));const vt=ft(W);return vt>0?he(ir,W,1/vt):void 0};let oe=Number.POSITIVE_INFINITY;this.sortSubarray(p,x.min,x.max,(ir,Jt)=>ir.featureInfo.featureIndex-Jt.featureInfo.featureIndex);const ge=qe(),ve=qe(),Te=qe(),$e=qe(),Fe=qe(),Ze=qe(),Ye=qe(),Je=qe(),Tt=qe(),ot=[qe(),qe(),qe(),qe()],Ct=[qe(),qe(),qe(),qe()],Mt=[{coord:new At(0,0),height:0},{coord:new At(0,0),height:0}],Bt=(ir,Jt)=>ir>Jt;for(let ir=x.min;ir<x.max;ir++){const Jt=p[ir];if(!Jt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(Mt,o,h,Jt,Bt))continue;const[Ft,Yt]=Mt;if(ct(ge,Ft.coord.x,Ft.coord.y,C*Ft.height),ct(ve,Yt.coord.x,Yt.coord.y,C*Yt.height),Zr(ge,ve))continue;Nn(Te,ve,ge),zt(Te,Te);const wt=se(Je,Jt.a)||Te,vt=se(Tt,Jt.b)||Te;ct($e,wt[1],-wt[0],0),zt($e,$e),ct(Fe,vt[1],-vt[0],0),zt(Fe,Fe),jr(Je,$e,wt),zt(Ze,Je),jr(Je,Fe,vt),zt(Ye,Je),Me(ot[0],ge,he(Je,Nn(Je,$e,Ze),A)),Me(ot[1],ge,he(Je,Me(Je,$e,Ze),A)),Me(ot[2],ge,he(Je,Ze,A)),ot[3]=ge,Me(Ct[0],ve,he(Je,Nn(Je,Fe,Ye),A)),Me(Ct[1],ve,he(Je,Me(Je,Fe,Ye),A)),Me(Ct[2],ve,he(Je,Ye,A)),Ct[3]=ve,oe=this.addFeatureSection(Jt.featureInfo.featureIndex,oe,this.bridgeFeatureSections,n);const Ht=n.addVertex(ot[0],$e,v),rr=n.addVertex(ot[1],$e,v),Lt=n.addVertex(Ct[0],Fe,v),br=n.addVertex(Ct[1],Fe,v);n.addTriangle(Ht,rr,Lt),n.addTriangle(rr,br,Lt);const Ir=n.addVertex(ot[1],Ze,v),_r=n.addVertex(ot[2],Ze,v),dr=n.addVertex(Ct[1],Ye,v),En=n.addVertex(Ct[2],Ye,v);n.addTriangle(Ir,_r,dr),n.addTriangle(_r,En,dr),Vt($e,$e),Vt(Fe,Fe);const pr=n.addVertex(ot[2],$e,v),Qr=n.addVertex(ot[3],$e,v),jn=n.addVertex(Ct[2],Fe,v),Gn=n.addVertex(Ct[3],Fe,v);n.addTriangle(pr,Qr,jn),n.addTriangle(Qr,Gn,jn);const mi=this.isTerminalVertex(Jt.a,w),Pn=this.isTerminalVertex(Jt.b,w);Ft.height<.01&&mi&&n.addQuad(ot[3],ot[2],ot[1],ot[0],Vt(wt,wt),v),Yt.height<.01&&Pn&&n.addQuad(Ct[0],Ct[1],Ct[2],Ct[3],vt,v)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:n.getVertexCount()})}constructTunnelStructures(n,o,h,p,x,v){n.clearVertexLookup();let w=Number.POSITIVE_INFINITY;const C=(oe,ge)=>oe.featureInfo.featureIndex-ge.featureInfo.featureIndex;this.sortSubarray(p,x.min,x.max,C),this.sortSubarray(p,v.min,v.max,C);const A=oe=>zt(oe,oe),k=[{coord:new At(0,0),height:0},{coord:new At(0,0),height:0}],P=(oe,ge)=>oe<ge,O=qe(),G=qe(),W=qe(),te=qe(),se=qe();for(let oe=x.min;oe<x.max;oe++){if(!this.prepareEdgePoints(k,o,h,p[oe],P))continue;const[ge,ve]=k,Te=A(ct(se,-(ve.coord.y-ge.coord.y),ve.coord.x-ge.coord.x,0));w=this.addFeatureSection(p[oe].featureInfo.featureIndex,w,this.tunnelFeatureSections,n),n.addQuad(ct(O,ge.coord.x,ge.coord.y,ge.height),ct(G,ve.coord.x,ve.coord.y,ve.height),ct(W,ve.coord.x,ve.coord.y,p[oe].isTunnel?-.1:0),ct(te,ge.coord.x,ge.coord.y,p[oe].isTunnel?-.1:0),Te)}for(let oe=v.min;oe<v.max;oe++){const ge=p[oe];ge.isTunnel&&([ge.a,ge.b]=[ge.b,ge.a]);const ve=o[ge.a],Te=o[ge.b],$e=A(ct(se,-(Te.y-ve.y),Te.x-ve.x,0));w=this.addFeatureSection(ge.featureInfo.featureIndex,w,this.tunnelFeatureSections,n),n.addQuad(ct(O,Te.x,Te.y,0),ct(G,ve.x,ve.y,0),ct(W,ve.x,ve.y,h[ge.a]+4),ct(te,Te.x,Te.y,h[ge.b]+4),$e),n.addQuad(ct(O,ve.x,ve.y,0),ct(G,Te.x,Te.y,0),ct(W,Te.x,Te.y,h[ge.b]+4),ct(te,ve.x,ve.y,h[ge.a]+4),$e)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:n.getVertexCount()})}setElevatedPoint(n,o,h,p){n.coord.x=o,n.coord.y=h,n.height=p}prepareEdgePoints(n,o,h,p,x){let v=o[p.a].x,w=o[p.a].y,C=o[p.b].x,A=o[p.b].y,k=h[p.a],P=h[p.b];const O=x(k,0),G=x(P,0);if(O&&G)return this.setElevatedPoint(n[0],v,w,k),this.setElevatedPoint(n[1],C,A,P),!0;if(!O&&!G)return!1;if(O){if(!G){const W=P/(P-k);C=fn(C,v,W),A=fn(A,w,W),P=fn(P,k,W)}}else{const W=k/(k-P);v=fn(v,C,W),w=fn(w,A,W),k=fn(k,P,W)}return this.setElevatedPoint(n[0],v,w,k),this.setElevatedPoint(n[1],C,A,P),!0}prepareEdges(n,o){if(o.length===0)return;o.sort((w,C)=>w.hash===C.hash?C.polygonIdx-w.polygonIdx:C.hash>w.hash?1:-1);let h=0,p=0,x=0,v=o[h].polygonIdx;do p++,(p===o.length||o[h].hash!==o[p].hash)&&((p-h==1||o[p-1].polygonIdx!==v)&&(x<h&&(o[x]=o[h],o[h]=null),o[x].type="none",x++),h=p,h!==o.length&&(v=o[h].polygonIdx));while(h!==o.length);if(o.splice(x),o.length!==0&&n.length!==0){o.sort((A,k)=>A.portalHash<k.portalHash?1:-1);let w=0,C=0;for(;w!==o.length&&C!==n.length;){const A=o[w],k=n[C];A.portalHash>k.hash?w++:k.hash>A.portalHash?C++:(A.type=k.type,w++)}}}isOnBorder(n,o){return n<=0&&o<=0||n>=ar&&o>=ar}addFeatureSection(n,o,h,p){return n!==o&&(o=n,h.push({featureIndex:n,vertexStart:p.getVertexCount()}),p.clearVertexLookup()),o}sortSubarray(n,o,h,p){const x=n.slice(o,h);x.sort(p),n.splice(o,x.length,...x)}static computeEdgeHash(n,o){return(n.y===o.y&&n.x>o.x||n.y>o.y)&&([n,o]=[o,n]),BigInt(Ll.computePosHash(n))<<32n|BigInt(Ll.computePosHash(o))}static computePosHash(n){return((65535&n.x)<<16|65535&n.y)>>>0}}var uO,dO={exports:{}},hO=(uO||(uO=1,function(l,n){(function(o){function h(Le,Pe){return Le>Pe?1:Le<Pe?-1:0}var p=function(Le,Pe){Le===void 0&&(Le=h),Pe===void 0&&(Pe=!1),this._compare=Le,this._root=null,this._size=0,this._noDuplicates=!!Pe},x={size:{configurable:!0}};function v(Le,Pe,jt,cr,It){var fr=It-cr;if(fr>0){var Br=cr+Math.floor(fr/2),Mr={key:Pe[Br],data:jt[Br],parent:Le};return Mr.left=v(Mr,Pe,jt,cr,Br),Mr.right=v(Mr,Pe,jt,Br+1,It),Mr}return null}function w(Le,Pe,jt,cr,It){if(!(jt>=cr)){for(var fr=Le[jt+cr>>1],Br=jt-1,Mr=cr+1;;){do Br++;while(It(Le[Br],fr)<0);do Mr--;while(It(Le[Mr],fr)>0);if(Br>=Mr)break;var Mn=Le[Br];Le[Br]=Le[Mr],Le[Mr]=Mn,Mn=Pe[Br],Pe[Br]=Pe[Mr],Pe[Mr]=Mn}w(Le,Pe,jt,Mr,It),w(Le,Pe,Mr+1,cr,It)}}p.prototype.rotateLeft=function(Le){var Pe=Le.right;Pe&&(Le.right=Pe.left,Pe.left&&(Pe.left.parent=Le),Pe.parent=Le.parent),Le.parent?Le===Le.parent.left?Le.parent.left=Pe:Le.parent.right=Pe:this._root=Pe,Pe&&(Pe.left=Le),Le.parent=Pe},p.prototype.rotateRight=function(Le){var Pe=Le.left;Pe&&(Le.left=Pe.right,Pe.right&&(Pe.right.parent=Le),Pe.parent=Le.parent),Le.parent?Le===Le.parent.left?Le.parent.left=Pe:Le.parent.right=Pe:this._root=Pe,Pe&&(Pe.right=Le),Le.parent=Pe},p.prototype._splay=function(Le){for(;Le.parent;){var Pe=Le.parent;Pe.parent?Pe.left===Le&&Pe.parent.left===Pe?(this.rotateRight(Pe.parent),this.rotateRight(Pe)):Pe.right===Le&&Pe.parent.right===Pe?(this.rotateLeft(Pe.parent),this.rotateLeft(Pe)):Pe.left===Le&&Pe.parent.right===Pe?(this.rotateRight(Pe),this.rotateLeft(Pe)):(this.rotateLeft(Pe),this.rotateRight(Pe)):Pe.left===Le?this.rotateRight(Pe):this.rotateLeft(Pe)}},p.prototype.splay=function(Le){for(var Pe,jt,cr,It,fr;Le.parent;)(jt=(Pe=Le.parent).parent)&&jt.parent?((cr=jt.parent).left===jt?cr.left=Le:cr.right=Le,Le.parent=cr):(Le.parent=null,this._root=Le),It=Le.left,fr=Le.right,Le===Pe.left?(jt&&(jt.left===Pe?(Pe.right?(jt.left=Pe.right,jt.left.parent=jt):jt.left=null,Pe.right=jt,jt.parent=Pe):(It?(jt.right=It,It.parent=jt):jt.right=null,Le.left=jt,jt.parent=Le)),fr?(Pe.left=fr,fr.parent=Pe):Pe.left=null,Le.right=Pe,Pe.parent=Le):(jt&&(jt.right===Pe?(Pe.left?(jt.right=Pe.left,jt.right.parent=jt):jt.right=null,Pe.left=jt,jt.parent=Pe):(fr?(jt.left=fr,fr.parent=jt):jt.left=null,Le.right=jt,jt.parent=Le)),It?(Pe.right=It,It.parent=Pe):Pe.right=null,Le.left=Pe,Pe.parent=Le)},p.prototype.replace=function(Le,Pe){Le.parent?Le===Le.parent.left?Le.parent.left=Pe:Le.parent.right=Pe:this._root=Pe,Pe&&(Pe.parent=Le.parent)},p.prototype.minNode=function(Le){if(Le===void 0&&(Le=this._root),Le)for(;Le.left;)Le=Le.left;return Le},p.prototype.maxNode=function(Le){if(Le===void 0&&(Le=this._root),Le)for(;Le.right;)Le=Le.right;return Le},p.prototype.insert=function(Le,Pe){var jt=this._root,cr=null,It=this._compare;if(this._noDuplicates)for(;jt;){if(cr=jt,It(jt.key,Le)===0)return;jt=It(jt.key,Le)<0?jt.right:jt.left}else for(;jt;)cr=jt,jt=It(jt.key,Le)<0?jt.right:jt.left;return jt={key:Le,data:Pe,left:null,right:null,parent:cr},cr?It(cr.key,jt.key)<0?cr.right=jt:cr.left=jt:this._root=jt,this.splay(jt),this._size++,jt},p.prototype.find=function(Le){for(var Pe=this._root,jt=this._compare;Pe;){var cr=jt(Pe.key,Le);if(cr<0)Pe=Pe.right;else{if(!(cr>0))return Pe;Pe=Pe.left}}return null},p.prototype.contains=function(Le){for(var Pe=this._root,jt=this._compare;Pe;){var cr=jt(Le,Pe.key);if(cr===0)return!0;Pe=cr<0?Pe.left:Pe.right}return!1},p.prototype.remove=function(Le){var Pe=this.find(Le);if(!Pe)return!1;if(this.splay(Pe),Pe.left)if(Pe.right){var jt=this.minNode(Pe.right);jt.parent!==Pe&&(this.replace(jt,jt.right),jt.right=Pe.right,jt.right.parent=jt),this.replace(Pe,jt),jt.left=Pe.left,jt.left.parent=jt}else this.replace(Pe,Pe.left);else this.replace(Pe,Pe.right);return this._size--,!0},p.prototype.removeNode=function(Le){if(!Le)return!1;if(this.splay(Le),Le.left)if(Le.right){var Pe=this.minNode(Le.right);Pe.parent!==Le&&(this.replace(Pe,Pe.right),Pe.right=Le.right,Pe.right.parent=Pe),this.replace(Le,Pe),Pe.left=Le.left,Pe.left.parent=Pe}else this.replace(Le,Le.left);else this.replace(Le,Le.right);return this._size--,!0},p.prototype.erase=function(Le){var Pe=this.find(Le);if(Pe){this.splay(Pe);var jt=Pe.left,cr=Pe.right,It=null;jt&&(jt.parent=null,It=this.maxNode(jt),this.splay(It),this._root=It),cr&&(jt?It.right=cr:this._root=cr,cr.parent=It),this._size--}},p.prototype.pop=function(){var Le=this._root,Pe=null;if(Le){for(;Le.left;)Le=Le.left;Pe={key:Le.key,data:Le.data},this.remove(Le.key)}return Pe},p.prototype.next=function(Le){var Pe=Le;if(Pe)if(Pe.right)for(Pe=Pe.right;Pe&&Pe.left;)Pe=Pe.left;else for(Pe=Le.parent;Pe&&Pe.right===Le;)Le=Pe,Pe=Pe.parent;return Pe},p.prototype.prev=function(Le){var Pe=Le;if(Pe)if(Pe.left)for(Pe=Pe.left;Pe&&Pe.right;)Pe=Pe.right;else for(Pe=Le.parent;Pe&&Pe.left===Le;)Le=Pe,Pe=Pe.parent;return Pe},p.prototype.forEach=function(Le){for(var Pe=this._root,jt=[],cr=!1,It=0;!cr;)Pe?(jt.push(Pe),Pe=Pe.left):jt.length>0?(Le(Pe=jt.pop(),It++),Pe=Pe.right):cr=!0;return this},p.prototype.range=function(Le,Pe,jt,cr){for(var It=[],fr=this._compare,Br=this._root;It.length!==0||Br;)if(Br)It.push(Br),Br=Br.left;else{if(fr((Br=It.pop()).key,Pe)>0)break;if(fr(Br.key,Le)>=0&&jt.call(cr,Br))return this;Br=Br.right}return this},p.prototype.keys=function(){for(var Le=this._root,Pe=[],jt=[],cr=!1;!cr;)Le?(Pe.push(Le),Le=Le.left):Pe.length>0?(Le=Pe.pop(),jt.push(Le.key),Le=Le.right):cr=!0;return jt},p.prototype.values=function(){for(var Le=this._root,Pe=[],jt=[],cr=!1;!cr;)Le?(Pe.push(Le),Le=Le.left):Pe.length>0?(Le=Pe.pop(),jt.push(Le.data),Le=Le.right):cr=!0;return jt},p.prototype.at=function(Le){for(var Pe=this._root,jt=[],cr=!1,It=0;!cr;)if(Pe)jt.push(Pe),Pe=Pe.left;else if(jt.length>0){if(Pe=jt.pop(),It===Le)return Pe;It++,Pe=Pe.right}else cr=!0;return null},p.prototype.load=function(Le,Pe,jt){if(Le===void 0&&(Le=[]),Pe===void 0&&(Pe=[]),jt===void 0&&(jt=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var cr=Le.length;return jt&&w(Le,Pe,0,cr-1,this._compare),this._root=v(null,Le,Pe,0,cr),this._size=cr,this},p.prototype.min=function(){var Le=this.minNode(this._root);return Le?Le.key:null},p.prototype.max=function(){var Le=this.maxNode(this._root);return Le?Le.key:null},p.prototype.isEmpty=function(){return this._root===null},x.size.get=function(){return this._size},p.createTree=function(Le,Pe,jt,cr,It){return new p(jt,It).load(Le,Pe,cr)},Object.defineProperties(p.prototype,x);var C=0,A=1,k=2,P=3,O=0,G=1,W=2,te=3;function se(Le,Pe,jt){Pe===null?(Le.inOut=!1,Le.otherInOut=!0):(Le.isSubject===Pe.isSubject?(Le.inOut=!Pe.inOut,Le.otherInOut=Pe.otherInOut):(Le.inOut=!Pe.otherInOut,Le.otherInOut=Pe.isVertical()?!Pe.inOut:Pe.inOut),Pe&&(Le.prevInResult=!oe(Pe,jt)||Pe.isVertical()?Pe.prevInResult:Pe));var cr=oe(Le,jt);Le.resultTransition=cr?function(It,fr){var Br,Mr=!It.inOut,Mn=!It.otherInOut;switch(fr){case O:Br=Mr&&Mn;break;case G:Br=Mr||Mn;break;case te:Br=Mr^Mn;break;case W:Br=It.isSubject?Mr&&!Mn:Mn&&!Mr}return Br?1:-1}(Le,jt):0}function oe(Le,Pe){switch(Le.type){case C:switch(Pe){case O:return!Le.otherInOut;case G:return Le.otherInOut;case W:return Le.isSubject&&Le.otherInOut||!Le.isSubject&&!Le.otherInOut;case te:return!0}break;case k:return Pe===O||Pe===G;case P:return Pe===W;case A:return!1}return!1}var ge=function(Le,Pe,jt,cr,It){this.left=Pe,this.point=Le,this.otherEvent=jt,this.isSubject=cr,this.type=It||C,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},ve={inResult:{configurable:!0}};function Te(Le,Pe){return Le[0]===Pe[0]&&Le[1]===Pe[1]}ge.prototype.isBelow=function(Le){var Pe=this.point,jt=this.otherEvent.point;return this.left?(Pe[0]-Le[0])*(jt[1]-Le[1])-(jt[0]-Le[0])*(Pe[1]-Le[1])>0:(jt[0]-Le[0])*(Pe[1]-Le[1])-(Pe[0]-Le[0])*(jt[1]-Le[1])>0},ge.prototype.isAbove=function(Le){return!this.isBelow(Le)},ge.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},ve.inResult.get=function(){return this.resultTransition!==0},ge.prototype.clone=function(){var Le=new ge(this.point,this.left,this.otherEvent,this.isSubject,this.type);return Le.contourId=this.contourId,Le.resultTransition=this.resultTransition,Le.prevInResult=this.prevInResult,Le.isExteriorRing=this.isExteriorRing,Le.inOut=this.inOut,Le.otherInOut=this.otherInOut,Le},Object.defineProperties(ge.prototype,ve);var $e=11102230246251565e-32,Fe=134217729,Ze=(3+8*$e)*$e;function Ye(Le,Pe,jt,cr,It){var fr,Br,Mr,Mn,cn=Pe[0],Dr=cr[0],Si=0,Yi=0;Dr>cn==Dr>-cn?(fr=cn,cn=Pe[++Si]):(fr=Dr,Dr=cr[++Yi]);var dn=0;if(Si<Le&&Yi<jt)for(Dr>cn==Dr>-cn?(Mr=fr-((Br=cn+fr)-cn),cn=Pe[++Si]):(Mr=fr-((Br=Dr+fr)-Dr),Dr=cr[++Yi]),fr=Br,Mr!==0&&(It[dn++]=Mr);Si<Le&&Yi<jt;)Dr>cn==Dr>-cn?(Mr=fr-((Br=fr+cn)-(Mn=Br-fr))+(cn-Mn),cn=Pe[++Si]):(Mr=fr-((Br=fr+Dr)-(Mn=Br-fr))+(Dr-Mn),Dr=cr[++Yi]),fr=Br,Mr!==0&&(It[dn++]=Mr);for(;Si<Le;)Mr=fr-((Br=fr+cn)-(Mn=Br-fr))+(cn-Mn),cn=Pe[++Si],fr=Br,Mr!==0&&(It[dn++]=Mr);for(;Yi<jt;)Mr=fr-((Br=fr+Dr)-(Mn=Br-fr))+(Dr-Mn),Dr=cr[++Yi],fr=Br,Mr!==0&&(It[dn++]=Mr);return fr===0&&dn!==0||(It[dn++]=fr),dn}function Je(Le){return new Float64Array(Le)}var Tt=33306690738754716e-32,ot=22204460492503146e-32,Ct=11093356479670487e-47,Mt=Je(4),Bt=Je(8),ir=Je(12),Jt=Je(16),Ft=Je(4);function Yt(Le,Pe,jt){var cr=function(It,fr,Br,Mr,Mn,cn){var Dr=(fr-cn)*(Br-Mn),Si=(It-Mn)*(Mr-cn),Yi=Dr-Si;if(Dr===0||Si===0||Dr>0!=Si>0)return Yi;var dn=Math.abs(Dr+Si);return Math.abs(Yi)>=Tt*dn?Yi:-function(hi,Ki,zi,qs,xs,ss,Hi){var Ai,On,ji,as,un,gi,vs,Js,ca,Ia,ys,Ca,xl,Aa,Bl,So,Oc,vl,Ul=hi-xs,To=zi-xs,Vl=Ki-ss,Fc=qs-ss;Mt[0]=(Bl=(Js=Ul-(vs=(gi=Fe*Ul)-(gi-Ul)))*(Ia=Fc-(ca=(gi=Fe*Fc)-(gi-Fc)))-((Aa=Ul*Fc)-vs*ca-Js*ca-vs*Ia))-((ys=Bl-(Oc=(Js=Vl-(vs=(gi=Fe*Vl)-(gi-Vl)))*(Ia=To-(ca=(gi=Fe*To)-(gi-To)))-((So=Vl*To)-vs*ca-Js*ca-vs*Ia)))+(un=Bl-ys))+(un-Oc),Mt[1]=(xl=Aa-((Ca=Aa+ys)-(un=Ca-Aa))+(ys-un))-((ys=xl-So)+(un=xl-ys))+(un-So),Mt[2]=Ca-((vl=Ca+ys)-(un=vl-Ca))+(ys-un),Mt[3]=vl;var lo=function(xp,Zd){for(var YS=Zd[0],ix=1;ix<4;ix++)YS+=Zd[ix];return YS}(0,Mt),$o=ot*Hi;if(lo>=$o||-lo>=$o||(Ai=hi-(Ul+(un=hi-Ul))+(un-xs),ji=zi-(To+(un=zi-To))+(un-xs),On=Ki-(Vl+(un=Ki-Vl))+(un-ss),as=qs-(Fc+(un=qs-Fc))+(un-ss),Ai===0&&On===0&&ji===0&&as===0)||($o=Ct*Hi+Ze*Math.abs(lo),(lo+=Ul*as+Fc*Ai-(Vl*ji+To*On))>=$o||-lo>=$o))return lo;Ft[0]=(Bl=(Js=Ai-(vs=(gi=Fe*Ai)-(gi-Ai)))*(Ia=Fc-(ca=(gi=Fe*Fc)-(gi-Fc)))-((Aa=Ai*Fc)-vs*ca-Js*ca-vs*Ia))-((ys=Bl-(Oc=(Js=On-(vs=(gi=Fe*On)-(gi-On)))*(Ia=To-(ca=(gi=Fe*To)-(gi-To)))-((So=On*To)-vs*ca-Js*ca-vs*Ia)))+(un=Bl-ys))+(un-Oc),Ft[1]=(xl=Aa-((Ca=Aa+ys)-(un=Ca-Aa))+(ys-un))-((ys=xl-So)+(un=xl-ys))+(un-So),Ft[2]=Ca-((vl=Ca+ys)-(un=vl-Ca))+(ys-un),Ft[3]=vl;var Hd=Ye(4,Mt,4,Ft,Bt);Ft[0]=(Bl=(Js=Ul-(vs=(gi=Fe*Ul)-(gi-Ul)))*(Ia=as-(ca=(gi=Fe*as)-(gi-as)))-((Aa=Ul*as)-vs*ca-Js*ca-vs*Ia))-((ys=Bl-(Oc=(Js=Vl-(vs=(gi=Fe*Vl)-(gi-Vl)))*(Ia=ji-(ca=(gi=Fe*ji)-(gi-ji)))-((So=Vl*ji)-vs*ca-Js*ca-vs*Ia)))+(un=Bl-ys))+(un-Oc),Ft[1]=(xl=Aa-((Ca=Aa+ys)-(un=Ca-Aa))+(ys-un))-((ys=xl-So)+(un=xl-ys))+(un-So),Ft[2]=Ca-((vl=Ca+ys)-(un=vl-Ca))+(ys-un),Ft[3]=vl;var _p=Ye(Hd,Bt,4,Ft,ir);Ft[0]=(Bl=(Js=Ai-(vs=(gi=Fe*Ai)-(gi-Ai)))*(Ia=as-(ca=(gi=Fe*as)-(gi-as)))-((Aa=Ai*as)-vs*ca-Js*ca-vs*Ia))-((ys=Bl-(Oc=(Js=On-(vs=(gi=Fe*On)-(gi-On)))*(Ia=ji-(ca=(gi=Fe*ji)-(gi-ji)))-((So=On*ji)-vs*ca-Js*ca-vs*Ia)))+(un=Bl-ys))+(un-Oc),Ft[1]=(xl=Aa-((Ca=Aa+ys)-(un=Ca-Aa))+(ys-un))-((ys=xl-So)+(un=xl-ys))+(un-So),Ft[2]=Ca-((vl=Ca+ys)-(un=vl-Ca))+(ys-un),Ft[3]=vl;var nx=Ye(_p,ir,4,Ft,Jt);return Jt[nx-1]}(It,fr,Br,Mr,Mn,cn,dn)}(Le[0],Le[1],Pe[0],Pe[1],jt[0],jt[1]);return cr>0?-1:cr<0?1:0}function wt(Le,Pe){var jt=Le.point,cr=Pe.point;return jt[0]>cr[0]?1:jt[0]<cr[0]?-1:jt[1]!==cr[1]?jt[1]>cr[1]?1:-1:function(It,fr,Br,Mr){return It.left!==fr.left?It.left?1:-1:Yt(Br,It.otherEvent.point,fr.otherEvent.point)!==0?It.isBelow(fr.otherEvent.point)?-1:1:!It.isSubject&&fr.isSubject?1:-1}(Le,Pe,jt)}function vt(Le,Pe,jt){var cr=new ge(Pe,!1,Le,Le.isSubject),It=new ge(Pe,!0,Le.otherEvent,Le.isSubject);return Te(Le.point,Le.otherEvent.point)&&console.warn("what is that, a collapsed segment?",Le),cr.contourId=It.contourId=Le.contourId,wt(It,Le.otherEvent)>0&&(Le.otherEvent.left=!0,It.left=!1),Le.otherEvent.otherEvent=It,Le.otherEvent=cr,jt.push(It),jt.push(cr),jt}function Ht(Le,Pe){return Le[0]*Pe[1]-Le[1]*Pe[0]}function rr(Le,Pe){return Le[0]*Pe[0]+Le[1]*Pe[1]}function Lt(Le,Pe,jt){var cr=function(Mn,cn,Dr,Si,Yi){var dn=[cn[0]-Mn[0],cn[1]-Mn[1]],hi=[Si[0]-Dr[0],Si[1]-Dr[1]];function Ki(gi,vs,Js){return[gi[0]+vs*Js[0],gi[1]+vs*Js[1]]}var zi=[Dr[0]-Mn[0],Dr[1]-Mn[1]],qs=Ht(dn,hi),xs=qs*qs,ss=rr(dn,dn);if(xs>0){var Hi=Ht(zi,hi)/qs;if(Hi<0||Hi>1)return null;var Ai=Ht(zi,dn)/qs;return Ai<0||Ai>1?null:Hi===0||Hi===1?[Ki(Mn,Hi,dn)]:Ai===0||Ai===1?[Ki(Dr,Ai,hi)]:[Ki(Mn,Hi,dn)]}if((xs=(qs=Ht(zi,dn))*qs)>0)return null;var On=rr(dn,zi)/ss,ji=On+rr(dn,hi)/ss,as=Math.min(On,ji),un=Math.max(On,ji);return as<=1&&un>=0?as===1?[Ki(Mn,as>0?as:0,dn)]:un===0?[Ki(Mn,un<1?un:1,dn)]:[Ki(Mn,as>0?as:0,dn),Ki(Mn,un<1?un:1,dn)]:null}(Le.point,Le.otherEvent.point,Pe.point,Pe.otherEvent.point),It=cr?cr.length:0;if(It===0||It===1&&(Te(Le.point,Pe.point)||Te(Le.otherEvent.point,Pe.otherEvent.point))||It===2&&Le.isSubject===Pe.isSubject)return 0;if(It===1)return Te(Le.point,cr[0])||Te(Le.otherEvent.point,cr[0])||vt(Le,cr[0],jt),Te(Pe.point,cr[0])||Te(Pe.otherEvent.point,cr[0])||vt(Pe,cr[0],jt),1;var fr=[],Br=!1,Mr=!1;return Te(Le.point,Pe.point)?Br=!0:wt(Le,Pe)===1?fr.push(Pe,Le):fr.push(Le,Pe),Te(Le.otherEvent.point,Pe.otherEvent.point)?Mr=!0:wt(Le.otherEvent,Pe.otherEvent)===1?fr.push(Pe.otherEvent,Le.otherEvent):fr.push(Le.otherEvent,Pe.otherEvent),Br&&Mr||Br?(Pe.type=A,Le.type=Pe.inOut===Le.inOut?k:P,Br&&!Mr&&vt(fr[1].otherEvent,fr[0].point,jt),2):Mr?(vt(fr[0],fr[1].point,jt),3):fr[0]!==fr[3].otherEvent?(vt(fr[0],fr[1].point,jt),vt(fr[1],fr[2].point,jt),3):(vt(fr[0],fr[1].point,jt),vt(fr[3].otherEvent,fr[2].point,jt),3)}function br(Le,Pe){if(Le===Pe)return 0;if(Yt(Le.point,Le.otherEvent.point,Pe.point)!==0||Yt(Le.point,Le.otherEvent.point,Pe.otherEvent.point)!==0)return Te(Le.point,Pe.point)?Le.isBelow(Pe.otherEvent.point)?-1:1:Le.point[0]===Pe.point[0]?Le.point[1]<Pe.point[1]?-1:1:wt(Le,Pe)===1?Pe.isAbove(Le.point)?-1:1:Le.isBelow(Pe.point)?-1:1;if(Le.isSubject!==Pe.isSubject)return Le.isSubject?-1:1;var jt=Le.point,cr=Pe.point;return jt[0]===cr[0]&&jt[1]===cr[1]?(jt=Le.otherEvent.point)[0]===(cr=Pe.otherEvent.point)[0]&&jt[1]===cr[1]?0:Le.contourId>Pe.contourId?1:-1:wt(Le,Pe)===1?1:-1}var Ir=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function _r(Le,Pe,jt,cr){var It,fr=Le+1,Br=Pe[Le].point,Mr=Pe.length;for(fr<Mr&&(It=Pe[fr].point);fr<Mr&&It[0]===Br[0]&&It[1]===Br[1];){if(!jt[fr])return fr;++fr<Mr&&(It=Pe[fr].point)}for(fr=Le-1;jt[fr]&&fr>cr;)fr--;return fr}Ir.prototype.isExterior=function(){return this.holeOf==null};var dr=pr,En=pr;function pr(Le,Pe){if(!(this instanceof pr))return new pr(Le,Pe);if(this.data=Le||[],this.length=this.data.length,this.compare=Pe||Qr,this.length>0)for(var jt=(this.length>>1)-1;jt>=0;jt--)this._down(jt)}function Qr(Le,Pe){return Le<Pe?-1:Le>Pe?1:0}pr.prototype={push:function(Le){this.data.push(Le),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var Le=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),Le}},peek:function(){return this.data[0]},_up:function(Le){for(var Pe=this.data,jt=this.compare,cr=Pe[Le];Le>0;){var It=Le-1>>1,fr=Pe[It];if(jt(cr,fr)>=0)break;Pe[Le]=fr,Le=It}Pe[Le]=cr},_down:function(Le){for(var Pe=this.data,jt=this.compare,cr=this.length>>1,It=Pe[Le];Le<cr;){var fr=1+(Le<<1),Br=fr+1,Mr=Pe[fr];if(Br<this.length&&jt(Pe[Br],Mr)<0&&(fr=Br,Mr=Pe[Br]),jt(Mr,It)>=0)break;Pe[Le]=Mr,Le=fr}Pe[Le]=It}},dr.default=En;var jn=Math.max,Gn=Math.min,mi=0;function Pn(Le,Pe,jt,cr,It,fr){var Br,Mr,Mn,cn,Dr,Si;for(Br=0,Mr=Le.length-1;Br<Mr;Br++)if(cn=Le[Br+1],Dr=new ge(Mn=Le[Br],!1,void 0,Pe),Si=new ge(cn,!1,Dr,Pe),Dr.otherEvent=Si,Mn[0]!==cn[0]||Mn[1]!==cn[1]){Dr.contourId=Si.contourId=jt,fr||(Dr.isExteriorRing=!1,Si.isExteriorRing=!1),wt(Dr,Si)>0?Si.left=!0:Dr.left=!0;var Yi=Mn[0],dn=Mn[1];It[0]=Gn(It[0],Yi),It[1]=Gn(It[1],dn),It[2]=jn(It[2],Yi),It[3]=jn(It[3],dn),cr.push(Dr),cr.push(Si)}}var Ei=[];function Ci(Le,Pe,jt){typeof Le[0][0][0]=="number"&&(Le=[Le]),typeof Pe[0][0][0]=="number"&&(Pe=[Pe]);var cr=function(dn,hi,Ki){var zi=null;return dn.length*hi.length==0&&(Ki===O?zi=Ei:Ki===W?zi=dn:Ki!==G&&Ki!==te||(zi=dn.length===0?hi:dn)),zi}(Le,Pe,jt);if(cr)return cr===Ei?null:cr;var It=[1/0,1/0,-1/0,-1/0],fr=[1/0,1/0,-1/0,-1/0],Br=function(dn,hi,Ki,zi,qs){var xs,ss,Hi,Ai,On,ji,as=new dr(null,wt);for(Hi=0,Ai=dn.length;Hi<Ai;Hi++)for(On=0,ji=(xs=dn[Hi]).length;On<ji;On++)(ss=On===0)&&mi++,Pn(xs[On],!0,mi,as,Ki,ss);for(Hi=0,Ai=hi.length;Hi<Ai;Hi++)for(On=0,ji=(xs=hi[Hi]).length;On<ji;On++)ss=On===0,qs===W&&(ss=!1),ss&&mi++,Pn(xs[On],!1,mi,as,zi,ss);return as}(Le,Pe,It,fr,jt);if(cr=function(dn,hi,Ki,zi,qs){var xs=null;return(Ki[0]>zi[2]||zi[0]>Ki[2]||Ki[1]>zi[3]||zi[1]>Ki[3])&&(qs===O?xs=Ei:qs===W?xs=dn:qs!==G&&qs!==te||(xs=dn.concat(hi))),xs}(Le,Pe,It,fr,jt))return cr===Ei?null:cr;for(var Mr=function(dn){var hi,Ki,zi=function(Hi){var Ai,On,ji,as,un=[];for(On=0,ji=Hi.length;On<ji;On++)((Ai=Hi[On]).left&&Ai.inResult||!Ai.left&&Ai.otherEvent.inResult)&&un.push(Ai);for(var gi=!1;!gi;)for(gi=!0,On=0,ji=un.length;On<ji;On++)On+1<ji&&wt(un[On],un[On+1])===1&&(as=un[On],un[On]=un[On+1],un[On+1]=as,gi=!1);for(On=0,ji=un.length;On<ji;On++)(Ai=un[On]).otherPos=On;for(On=0,ji=un.length;On<ji;On++)(Ai=un[On]).left||(as=Ai.otherPos,Ai.otherPos=Ai.otherEvent.otherPos,Ai.otherEvent.otherPos=as);return un}(dn),qs={},xs=[],ss=function(){if(!qs[hi]){var Hi=xs.length,Ai=function(un,gi,vs){var Js=new Ir;if(un.prevInResult!=null){var ca=un.prevInResult,Ia=ca.outputContourId;if(ca.resultTransition>0){var ys=gi[Ia];if(ys.holeOf!=null){var Ca=ys.holeOf;gi[Ca].holeIds.push(vs),Js.holeOf=Ca,Js.depth=gi[Ia].depth}else gi[Ia].holeIds.push(vs),Js.holeOf=Ia,Js.depth=gi[Ia].depth+1}else Js.holeOf=null,Js.depth=gi[Ia].depth}else Js.holeOf=null,Js.depth=0;return Js}(zi[hi],xs,Hi),On=function(un){qs[un]=!0,un<zi.length&&zi[un]&&(zi[un].outputContourId=Hi)},ji=hi,as=hi;for(Ai.points.push(zi[hi].point);On(ji),On(ji=zi[ji].otherPos),Ai.points.push(zi[ji].point),!((ji=_r(ji,zi,qs,as))==as||ji>=zi.length)&&zi[ji];);xs.push(Ai)}};for(hi=0,Ki=zi.length;hi<Ki;hi++)ss();return xs}(function(dn,hi,Ki,zi,qs,xs){for(var ss,Hi,Ai,On=new p(br),ji=[],as=Math.min(zi[2],qs[2]);dn.length!==0;){var un=dn.pop();if(ji.push(un),xs===O&&un.point[0]>as||xs===W&&un.point[0]>zi[2])break;if(un.left){Hi=ss=On.insert(un),ss=ss!==(Ai=On.minNode())?On.prev(ss):null,Hi=On.next(Hi);var gi=ss?ss.key:null;if(se(un,gi,xs),Hi&&Lt(un,Hi.key,dn)===2&&(se(un,gi,xs),se(Hi.key,un,xs)),ss&&Lt(ss.key,un,dn)===2){var vs=ss;se(gi,(vs=vs!==Ai?On.prev(vs):null)?vs.key:null,xs),se(un,gi,xs)}}else Hi=ss=On.find(un=un.otherEvent),ss&&Hi&&(ss=ss!==Ai?On.prev(ss):null,Hi=On.next(Hi),On.remove(un),Hi&&ss&&Lt(ss.key,Hi.key,dn))}return ji}(Br,0,0,It,fr,jt)),Mn=[],cn=0;cn<Mr.length;cn++){var Dr=Mr[cn];if(Dr.isExterior()){for(var Si=[Dr.points],Yi=0;Yi<Dr.holeIds.length;Yi++)Si.push(Mr[Dr.holeIds[Yi]].points);Mn.push(Si)}}return Mn}var As={UNION:G,DIFFERENCE:W,INTERSECTION:O,XOR:te};o.diff=function(Le,Pe){return Ci(Le,Pe,W)},o.intersection=function(Le,Pe){return Ci(Le,Pe,O)},o.operations=As,o.union=function(Le,Pe){return Ci(Le,Pe,G)},o.xor=function(Le,Pe){return Ci(Le,Pe,te)},Object.defineProperty(o,"__esModule",{value:!0})})(n)}(0,dO.exports)),dO.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function lS(l,n,o,h){const p=[],x=h===0?(v,w,C,A,k,P)=>{v.push(new At(P,C+(P-w)/(A-w)*(k-C)))}:(v,w,C,A,k,P)=>{v.push(new At(w+(P-C)/(k-C)*(A-w),P))};for(const v of l){const w=[];for(const C of v){if(C.length<=2)continue;const A=[];for(let O=0;O<C.length-1;O++){const G=C[O].x,W=C[O].y,te=C[O+1].x,se=C[O+1].y,oe=h===0?G:W,ge=h===0?te:se;oe<n?ge>n&&x(A,G,W,te,se,n):oe>o?ge<o&&x(A,G,W,te,se,o):A.push(C[O]),ge<n&&oe>=n&&x(A,G,W,te,se,n),ge>o&&oe<=o&&x(A,G,W,te,se,o)}let k=C[C.length-1];const P=h===0?k.x:k.y;P>=n&&P<=o&&A.push(k),A.length&&(k=A[A.length-1],A[0].x===k.x&&A[0].y===k.y||A.push(A[0]),w.push(A))}w.length&&p.push(w)}return p}function ZH(l,n){const o=Cj(l),h=Cj([n]),p=hO.intersection(o,h);return p==null?[]:fO(p)}function XH(l,n){let h=Cj(l,65536);const p=[];for(;n.valid();n.next()){const[x,v]=n.get(),w=x.x*65536,C=x.y*65536,A=v.x*65536,k=v.y*65536,P=A-w,O=k-C,G=Math.hypot(P,O);if(G===0)continue;const W=Math.trunc(O/G*3),te=-Math.trunc(P/G*3);p.push([[[w,C],[A,k],[A+W,k+te],[w+W,C+te],[w,C]]])}return p.length>0&&(h=hO.diff(h,p)),fO(h,1/65536)}function Cj(l,n=1){return[l.map(o=>o.map(h=>[h.x*n,h.y*n]))]}function fO(l,n=1){return l.map(o=>o.map((h,p)=>{const x=h.map(v=>new At(v[0]*n,v[1]*n).round());return p>0&&x.reverse(),x}))}class Aj{constructor(n,o){this.layoutVertexArray=new tl,this.indexArray=new bs,this.lineIndexArray=new uc,this.triangleSegments=new Fs,this.lineSegments=new Fs,this.programConfigurations=new Rc(n.layers,{zoom:n.zoom,lut:n.lut}),this.uploaded=!1,o&&(this.elevatedLayoutVertexArray=new qu)}update(n,o,h,p,x,v,w,C){this.programConfigurations.updatePaintArrays(n,o,x,h,p,v,w,C)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,DH.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.lineIndexBuffer=n.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=n.createVertexBuffer(this.elevatedLayoutVertexArray,RH.members))),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(n,o,h,p,x,v,w){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,o,h,p,x,v,void 0,w)}}class jj{constructor(n){this.zoom=n.zoom,this.pixelRatio=n.pixelRatio,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=n.lut,this.bufferData=new Aj(n,!1),this.elevationBufferData=new Aj(n,!0),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.projection=n.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=n.sourceLayerIndex,this.worldview=n.worldview,this.hasAppearances=null}updateFootprints(n,o){}updateAppearances(n,o,h,p){}populate(n,o,h,p){this.hasPattern=Tj("fill",this.layers,this.pixelRatio,o);const x=this.layers[0].layout.get("fill-sort-key"),v=[];for(const{feature:w,id:C,index:A,sourceLayerIndex:k}of n){const P=this.layers[0]._featureFilter.needGeometry,O=xt(w,P);if(!this.layers[0]._featureFilter.filter(new us(this.zoom,{worldview:this.worldview,activeFloors:o.activeFloors}),O,h))continue;const G=x?x.evaluate(O,{},h,o.availableImages):void 0,W={id:C,properties:w.properties,type:w.type,sourceLayerIndex:k,index:A,geometry:P?O.geometry:Pt(w,h,p),patterns:{},sortKey:G};v.push(W)}x&&v.sort((w,C)=>w.sortKey-C.sortKey);for(const w of v){const{geometry:C,index:A,sourceLayerIndex:k}=w;if(this.hasPattern){const P=Ej("fill",this.layers,w,this.zoom,this.pixelRatio,o);this.patternFeatures.push(P)}else this.addFeature(w,C,A,h,{},o.availableImages,o.brightness,o.elevationFeatures);o.featureIndex.insert(n[A].feature,C,A,k,this.index)}}update(n,o,h,p,x,v,w){this.bufferData.update(n,o,h,p,x,v,w,this.worldview),this.elevationBufferData.update(n,o,h,p,x,v,w,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(n,o,h,p,x,v,w,this.worldview)}addFeatures(n,o,h,p,x,v){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,o,h,p,v,n.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(n){this.bufferData.upload(n),this.elevationBufferData.upload(n),this.elevatedStructures&&this.elevatedStructures.upload(n)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(n,o,h,p,x,v=[],w,C){const A=x1(o,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(n,A,p,h,C):this.addGeometry(A,this.bufferData),this.bufferData.populatePaintArrays(n,h,x,v,p,w,this.worldview),this.elevationBufferData.populatePaintArrays(n,h,x,v,p,w,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(n,o,h,p,x){this.elevatedStructures&&(this.elevatedStructures.construct(n),this.elevatedStructures.populatePaintArrays(o,h,p,x,this.worldview))}addElevatedRoadFeature(n,o,h,p,x){const v=new Array,w=Tn.getElevationFeature(n,x);if(!w)return void this.addGeometry(o,this.bufferData);{const A=this.clipPolygonsToTile(o,1);A.length>0&&v.push({polygons:A,elevationFeature:w,elevationTileID:h})}const C={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(n,{},h),featureIndex:p};for(const A of v)if(A.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Ll(A.elevationTileID,this.layers,this.zoom,this.lut));const P=A.elevationFeature.isTunnel();let O=0;n.properties.hasOwnProperty(wr)&&(O=+n.properties[wr]);for(const G of A.polygons)this.elevatedStructures.addPortalCandidates(A.elevationFeature.id,G,P,A.elevationFeature,O)}A.elevationFeature.constantHeight==null&&(A.polygons=this.prepareElevatedPolygons(A.polygons,A.elevationFeature,A.elevationTileID));const k=new pi(h,A.elevationTileID);this.addElevatedGeometry(A.polygons,k,A.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,p,C)}}addElevatedGeometry(n,o,h,p,x,v){const w={elevation:h,elevationSampler:o,bias:p,index:x,featureInfo:v},[C,A]=this.addGeometry(n,this.elevationBufferData,w);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:C,max:A}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,C),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,A))}addGeometry(n,o,h){let p=Number.POSITIVE_INFINITY,x=Number.NEGATIVE_INFINITY,v=null;h&&(v=h.elevationSampler.constantElevation(h.elevation,h.bias),v!=null&&(p=v,x=v));const w=(C,A,k)=>{if(h!=null)if(A.push(C),v!=null)o.elevatedLayoutVertexArray.emplaceBack(v),k.push(v);else{const P=h.elevationSampler.pointElevation(C,h.elevation,h.bias);o.elevatedLayoutVertexArray.emplaceBack(P),k.push(P),p=Math.min(p,P),x=Math.max(x,P)}};for(const C of n){let A=0;for(const ve of C)A+=ve.length;const k=o.triangleSegments.prepareSegment(A,o.layoutVertexArray,o.indexArray),P=k.vertexLength,O=[],G=[],W=[],te=[],se=[],oe=o.layoutVertexArray.length;for(const ve of C){if(ve.length===0)continue;ve!==C[0]&&G.push(O.length/2);const Te=o.lineSegments.prepareSegment(ve.length,o.layoutVertexArray,o.lineIndexArray),$e=Te.vertexLength;h&&se.push(o.layoutVertexArray.length-oe),w(ve[0],W,te),o.layoutVertexArray.emplaceBack(ve[0].x,ve[0].y),o.lineIndexArray.emplaceBack($e+ve.length-1,$e),O.push(ve[0].x),O.push(ve[0].y);for(let Fe=1;Fe<ve.length;Fe++)w(ve[Fe],W,te),o.layoutVertexArray.emplaceBack(ve[Fe].x,ve[Fe].y),o.lineIndexArray.emplaceBack($e+Fe-1,$e+Fe),O.push(ve[Fe].x),O.push(ve[Fe].y);Te.vertexLength+=ve.length,Te.primitiveLength+=ve.length}const ge=L0(O,G);for(let ve=0;ve<ge.length;ve+=3)o.indexArray.emplaceBack(P+ge[ve],P+ge[ve+1],P+ge[ve+2]);if(ge.length>0&&h&&this.elevationMode==="hd-road-base"){const ve=h.elevation.isTunnel(),Te=h.elevation.safeArea,$e=this.elevatedStructures.addVertices(W,te);this.elevatedStructures.addTriangles(ge,$e,ve);const Fe=se.length;if(Fe>0){for(let Ze=0;Ze<Fe-1;Ze++)this.elevatedStructures.addRenderableRing(h.index,se[Ze]+$e,se[Ze+1]-se[Ze],ve,Te,h.featureInfo);this.elevatedStructures.addRenderableRing(h.index,se[Fe-1]+$e,W.length-se[Fe-1],ve,Te,h.featureInfo)}}k.vertexLength+=A,k.primitiveLength+=ge.length/3}return[p,x]}prepareElevatedPolygons(n,o,h){const p=1/We(h),x=[];for(const v of n){const w=XH(v,new ps(o,p));x.push(...w)}return x}clipPolygonsToTile(n,o){const h=-o,p=-o,x=ar+o,v=ar+o;let w=0;const C=[],A=[];for(;w<n.length;w++){const O=n[w],G=Jm(O);(G.min.x>=h&&G.max.x<=x&&G.min.y>=p&&G.max.y<=v?C:A).push(O)}if(C.length===n.length)return n;const k=[new At(h,p),new At(x,p),new At(x,v),new At(h,v),new At(h,p)],P=C;for(const O of A)P.push(...ZH(O,k));return P}}let pO,mO,gO,_O;Tr(jj,"FillBucket",{omit:["layers","patternFeatures"]}),Tr(Aj,"FillBufferData"),Tr(Ll,"ElevatedStructures");class cS{constructor(n,o,h,p){if(this.triangleCount=o.length/3,this.min=new At(0,0),this.max=new At(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||n.length===0)return;const[x,v]=[n[0].clone(),n[0].clone()];for(let P=1;P<n.length;++P){const O=n[P];x.x=Math.min(x.x,O.x),x.y=Math.min(x.y,O.y),v.x=Math.max(v.x,O.x),v.y=Math.max(v.y,O.y)}if(p){const P=Math.ceil(Math.max(v.x-x.x,v.y-x.y)/p);h=Math.max(h,P)}if(h===0)return;this.min=x,this.max=v;const w=this.max.sub(this.min);w.x=Math.max(w.x,1),w.y=Math.max(w.y,1);const C=Math.max(w.x,w.y)/h;this.cellsX=Math.max(1,Math.ceil(w.x/C)),this.cellsY=Math.max(1,Math.ceil(w.y/C)),this.xScale=1/C,this.yScale=1/C;const A=[];for(let P=0;P<this.triangleCount;P++){const O=n[o[3*P+0]].sub(this.min),G=n[o[3*P+1]].sub(this.min),W=n[o[3*P+2]].sub(this.min),te=Gd(Math.floor(Math.min(O.x,G.x,W.x)),this.xScale,this.cellsX),se=Gd(Math.floor(Math.max(O.x,G.x,W.x)),this.xScale,this.cellsX),oe=Gd(Math.floor(Math.min(O.y,G.y,W.y)),this.yScale,this.cellsY),ge=Gd(Math.floor(Math.max(O.y,G.y,W.y)),this.yScale,this.cellsY),ve=new At(0,0),Te=new At(0,0),$e=new At(0,0),Fe=new At(0,0);for(let Ze=oe;Ze<=ge;++Ze){ve.y=Te.y=Ze*C,$e.y=Fe.y=(Ze+1)*C;for(let Ye=te;Ye<=se;++Ye)ve.x=$e.x=Ye*C,Te.x=Fe.x=(Ye+1)*C,(la(O,G,W,ve,Te,Fe)||la(O,G,W,ve,Fe,$e))&&A.push({cellIdx:Ze*this.cellsX+Ye,triIdx:P})}}if(A.length===0)return;A.sort((P,O)=>P.cellIdx-O.cellIdx||P.triIdx-O.triIdx);let k=0;for(;k<A.length;){const P=A[k].cellIdx,O={start:this.payload.length,len:0};for(;k<A.length&&A[k].cellIdx===P;)++O.len,this.payload.push(A[k++].triIdx);this.cells[P]=O}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(n,o){if(this.triangleCount===0||this.cells.length===0||n.x>this.max.x||this.min.x>n.x||n.y>this.max.y||this.min.y>n.y)return;const h=Gd(n.x-this.min.x,this.xScale,this.cellsX),p=Gd(n.y-this.min.y,this.yScale,this.cellsY),x=this.cells[p*this.cellsX+h];if(x){this._lazyInitLookup();for(let v=0;v<x.len;v++){const w=this.payload[x.start+v],C=Math.floor(w/8),A=1<<w%8;if(!(this.lookup[C]&A)&&(this.lookup[C]|=A,o.push(w),o.length===this.triangleCount))return}}}query(n,o,h){if(this.triangleCount===0||this.cells.length===0||n.x>this.max.x||this.min.x>o.x||n.y>this.max.y||this.min.y>o.y)return;this._lazyInitLookup();const p=Gd(n.x-this.min.x,this.xScale,this.cellsX),x=Gd(o.x-this.min.x,this.xScale,this.cellsX),v=Gd(n.y-this.min.y,this.yScale,this.cellsY),w=Gd(o.y-this.min.y,this.yScale,this.cellsY);for(let C=v;C<=w;C++)for(let A=p;A<=x;A++){const k=this.cells[C*this.cellsX+A];if(k)for(let P=0;P<k.len;P++){const O=this.payload[k.start+P],G=Math.floor(O/8),W=1<<O%8;if(!(this.lookup[G]&W)&&(this.lookup[G]|=W,h.push(O),h.length===this.triangleCount))return}}}}function Gd(l,n,o){return Math.max(0,Math.min(o-1,Math.floor(l*n)))}Tr(cS,"TriangleGridIndex");class xO{constructor(n){this.zoom=n.zoom,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.footprints=[],this.worldview=n.worldview,this.hasAppearances=null}updateFootprints(n,o){for(const h of this.footprints)o.push({footprint:h,id:n})}updateAppearances(n,o,h,p){}populate(n,o,h,p){const x=[];for(const{feature:v,id:w,index:C,sourceLayerIndex:A}of n){const k=this.layers[0]._featureFilter.needGeometry,P=xt(v,k);if(!this.layers[0]._featureFilter.filter(new us(this.zoom,{worldview:this.worldview,activeFloors:o.activeFloors}),P,h))continue;const O={id:w,properties:v.properties,type:v.type,sourceLayerIndex:A,index:C,geometry:k?P.geometry:Pt(v,h,p),patterns:{}};x.push(O)}for(const v of x){const{geometry:w,index:C,sourceLayerIndex:A}=v;this.addFeature(v,w,C,h,{},o.availableImages,o.brightness),o.featureIndex.insert(n[C].feature,w,C,A,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(n){}update(n,o,h,p,x,v,w){}destroy(){}addFeature(n,o,h,p,x,v=[],w){for(const C of x1(o,2)){const A=[],k=[],P=[],O=new At(1/0,1/0),G=new At(-1/0,-1/0);for(const se of C)if(se.length!==0){se!==C[0]&&P.push(k.length/2);for(let oe=0;oe<se.length;oe++)k.push(se[oe].x),k.push(se[oe].y),A.push(se[oe]),O.x=Math.min(O.x,se[oe].x),O.y=Math.min(O.y,se[oe].y),G.x=Math.max(G.x,se[oe].x),G.y=Math.max(G.y,se[oe].y)}const W=L0(k,P),te=new cS(A,W,8,256);this.footprints.push({vertices:A,indices:W,grid:te,min:O,max:G})}}}Tr(xO,"ClipBucket",{omit:["layers"]});const YH=Kn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),KH=Kn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),JH=Kn([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),QH=Kn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),eZ=Kn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),tZ=Kn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),rZ=Kn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:nZ}=YH,v1=Number.MAX_SAFE_INTEGER,vO=v1-1;function yO(l,n,o,h){return l.order<n||l.order===v1||!(l.clipMask&o)||function(p,x){return x.length!==0&&x.find(v=>v===p)===void 0}(h,l.clipScope)}function uS(l,n){return l.x-n.x||l.y-n.y}function wO(l,n){return uS(l.min,n.min)===0&&uS(l.max,n.max)===0}function Ij(l,n){return!(l.min.x>n.max.x||l.max.x<n.min.x||l.min.y>n.max.y||l.max.y<n.min.y)}function dS(l,n){if(l.length!==n.length)return!1;for(let o=0;o<l.length;o++)if(l[o].sourceId!==n[o].sourceId||!wO(l[o],n[o])||l[o].order!==n[o].order||l[o].clipMask!==n[o].clipMask||!$i(l[o].clipScope,n[o].clipScope))return!1;return!0}function bO(l,n,o){const h=1/ar,p=1/(1<<o.canonical.z),x=(n.x*h+o.canonical.x)*p+o.wrap,v=(n.y*h+o.canonical.y)*p;return{min:new At((l.x*h+o.canonical.x)*p+o.wrap,(l.y*h+o.canonical.y)*p),max:new At(x,v)}}function iZ(l,n,o){const h=1<<o.canonical.z,p=((n.x-o.wrap)*h-o.canonical.x)*ar,x=(n.y*h-o.canonical.y)*ar;return{min:new At(((l.x-o.wrap)*h-o.canonical.x)*ar,(l.y*h-o.canonical.y)*ar),max:new At(p,x)}}function Nj(l,n,o,h,p,x,v){const w=l.indices,C=l.vertices,A=[];for(let k=h;k<h+p;k+=3){const P=n[o[k+0]+x],O=n[o[k+1]+x],G=n[o[k+2]+x],W=Math.min(P.x,O.x,G.x),te=Math.max(P.x,O.x,G.x),se=Math.min(P.y,O.y,G.y),oe=Math.max(P.y,O.y,G.y);A.length=0,l.grid.query(new At(W,se),new At(te,oe),A);for(let ge=0;ge<A.length;ge++){const ve=A[ge];if(la(C[w[3*ve+0]],C[w[3*ve+1]],C[w[3*ve+2]],P,O,G,v))return!0}}return!1}function SO(l,n,o,h){if(!l||!o)return!1;let p=l.vertices;if(!n.canonical.equals(h.canonical)||n.wrap!==h.wrap){if(o.vertices.length<l.vertices.length)return SO(o,h,l,n);const x=n.canonical,v=h.canonical,w=Math.pow(2,v.z-x.z);p=l.vertices.map(C=>new At((C.x+x.x*ar)*w-v.x*ar,(C.y+x.y*ar)*w-v.y*ar))}return Nj(o,p,l.indices,0,l.indices.length,0,0)}function TO(l,n,o,h){const p=Math.pow(2,h.z-o.z);return new At((l+o.x*ar)*p-h.x*ar,(n+o.y*ar)*p-h.y*ar)}function kj(l,n){const o=[];n.grid.queryPoint(l,o);const h=n.indices,p=n.vertices;for(let x=0;x<o.length;x++){const v=o[x];if(Za([p[h[3*v+0]],p[h[3*v+1]],p[h[3*v+2]]],l))return!0}return!1}const Pj=[new At(0,0),new At(ar,0),new At(ar,ar),new At(0,ar)];function EO(l,n){const o=[];let h=[];if(!n||l.length<2)return[l];if(l.length===2)return na(l[0],l[1],Pj)?[l]:[];for(let p=0;p<l.length+2;p++){const x=l[p%l.length],v=l[(p+1)%l.length],w=na(p===0?l[l.length-1]:l[(p-1)%l.length],x,Pj),C=na(x,v,Pj),A=w||C;A&&h.push(x),A&&C||h.length>0&&(h.length>1&&o.push(h),h=[])}return h.length>1&&o.push(h),o}const Dj=qt.types,sZ=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],aZ=["fill-extrusion-flood-light-ground-radius"],oZ=Math.pow(2,13),lZ=Math.pow(2,15)-1,CO=new At(0,1),fp=2147483648,AO=7,jO=450;function y1(l,n,o,h,p,x,v,w){l.emplaceBack((n<<1)+v,(o<<1)+x,(Math.floor(h*oZ)<<1)+p,Math.round(w))}function w1(l,n,o){l.emplaceBack(n.x*ar,n.y*ar,o?1:0)}function hS(l,n,o,h,p,x){l.emplaceBack(n.x,n.y,(o.x<<1)+h,(o.y<<1)+p,x)}function b1(l,n,o){l.emplaceBack(n.x,n.y,n.z,o[0]*16384,o[1]*16384,o[2]*16384)}class IO{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class NO{constructor(){this.centroidXY=new At(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new At(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new At(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new At(this.max.x-this.min.x,this.max.y-this.min.y)}}class kO{constructor(){this.acc=new At(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(n,o){n.min.x===Number.MAX_VALUE&&(n.min.x=n.max.x=o.x,n.min.y=n.max.y=o.y)}appendEdge(n,o,h){this.accCount++,this.acc._add(o);let p=!!this.borders;o.x<n.min.x?(n.min.x=o.x,p=!0):o.x>n.max.x&&(n.max.x=o.x,p=!0),o.y<n.min.y?(n.min.y=o.y,p=!0):o.y>n.max.y&&(n.max.y=o.y,p=!0),((o.x===0||o.x===ar)&&o.x===h.x)!=((o.y===0||o.y===ar)&&o.y===h.y)&&this.processBorderOverlap(o,h),p&&this.checkBorderIntersection(o,h)}checkBorderIntersection(n,o){o.x<0!=n.x<0&&this.addBorderIntersection(0,fn(o.y,n.y,(0-o.x)/(n.x-o.x))),o.x>ar!=n.x>ar&&this.addBorderIntersection(1,fn(o.y,n.y,(ar-o.x)/(n.x-o.x))),o.y<0!=n.y<0&&this.addBorderIntersection(2,fn(o.x,n.x,(0-o.y)/(n.y-o.y))),o.y>ar!=n.y>ar&&this.addBorderIntersection(3,fn(o.x,n.x,(ar-o.y)/(n.y-o.y)))}addBorderIntersection(n,o){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const h=this.borders[n];o<h[0]&&(h[0]=o),o>h[1]&&(h[1]=o)}processBorderOverlap(n,o){if(n.x===o.x){if(n.y===o.y)return;const h=n.x===0?0:1;this.addBorderIntersection(h,o.y),this.addBorderIntersection(h,n.y)}else{const h=n.y===0?2:3;this.addBorderIntersection(h,o.x),this.addBorderIntersection(h,n.x)}}centroid(){return this.accCount===0?new At(0,0):new At(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((n,o)=>n+ +(o[0]!==Number.MAX_VALUE),0):0}}function PO(l,n){const o=l.add(n)._unit(),h=K(l.x*o.x+l.y*o.y,-1,1);var p,x,v;return p=Math.acos(h),Math.min(4,Math.max(-4,Math.tan(p)))/4*lZ*((x=l).x*(v=n).y-x.y*v.x<0?-1:1)}const cZ=[l=>l.x<0,l=>l.x>ar,l=>l.y<0,l=>l.y>ar];function uZ(l,n,o,h){const p=[4];if(h===0)return p;o._mult(h);const x=l.sub(o),v=n.sub(o),w=[l,n,x,v];for(let C=0;C<4;C++)for(const A of w)if(cZ[C](A)){p.push(C);break}return p}class Rj{constructor(n){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new S0,this.indexArray=new bs,this.programConfigurations=new Rc(n.layers,{zoom:n.zoom,lut:n.lut},o=>aZ.includes(o)),this._segments=new Fs,this.hiddenByLandmarkVertexArray=new N0,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Fs}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(n,o,h,p=!1){const x=n.length;if(x>2){let v=Math.max(0,this._segments.get().length-1);const w=this._segments._prepareSegment(4*x,this.vertexArray.length,2*this._segmentToGroundQuads[v].length);let C;v!==this._segments.get().length-1&&(v++,this._segmentToGroundQuads[v]=[],this._segmentToRegionTriCounts[v]=[0,0,0,0,0]);{const A=n[0],k=n[1];C=PO(A.sub(n[x-1])._perp()._unit(),k.sub(A)._perp()._unit())}for(let A=0;A<x;A++){const k=A===x-1?0:A+1,P=n[A],O=n[k],G=n[k===x-1?0:k+1],W=O.sub(P)._perp()._unit(),te=PO(W,G.sub(O)._perp()._unit()),se=C,oe=te;if(Mj(P,O,o)||p&&MO(P,o)&&MO(O,o)){C=te;continue}const ge=w.vertexLength;hS(this.vertexArray,P,O,1,1,se),hS(this.vertexArray,P,O,1,0,se),hS(this.vertexArray,P,O,0,1,oe),hS(this.vertexArray,P,O,0,0,oe),w.vertexLength+=4;const ve=uZ(P,O,W,h);for(const Te of ve)this._segmentToGroundQuads[v].push({id:ge,region:Te}),this._segmentToRegionTriCounts[v][Te]+=2,w.primitiveLength+=2;C=te}}}prepareBorderSegments(){if(!this.hasData())return;const n=this._segments.get(),o=n.length;for(let h=0;h<o;h++)this._segmentToGroundQuads[h].sort((p,x)=>p.region-x.region);for(let h=0;h<o;h++){const p=this._segmentToGroundQuads[h],x=n[h],v=this._segmentToRegionTriCounts[h];v.reduce((C,A)=>C+A,0);let w=0;for(let C=0;C<=4;C++){const A=v[C];if(A!==0){let k=this.regionSegments[C];k||(k=this.regionSegments[C]=new Fs);const P={vertexOffset:x.vertexOffset,primitiveOffset:x.primitiveOffset+w,vertexLength:x.vertexLength,primitiveLength:A};k.get().push(P)}w+=A}for(let C=0;C<p.length;C++){const A=p[C].id;this.indexArray.emplaceBack(A,A+1,A+3),this.indexArray.emplaceBack(A,A+3,A+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(n,o,h,p,x,v,w){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,n,o,h,p,x,v,void 0,w)}upload(n){this.hasData()&&(this.vertexBuffer=n.createVertexBuffer(this.vertexArray,KH.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=n.createVertexBuffer(this.groundRadiusArray,JH.members)))}uploadPaintProperties(n){this.hasData()&&this.programConfigurations.upload(n)}update(n,o,h,p,x,v,w,C){this.hasData()&&this.programConfigurations.updatePaintArrays(n,o,h,p,x,v,w,C)}updateHiddenByLandmark(n){this.updateHiddenByLandmarkRange(n.groundVertexArrayOffset,n.groundVertexCount,!!(n.flags&fp))}updateHiddenByLandmarkRange(n,o,h){if(!this.hasData())return;const p=o+n;if(o!==0){for(let x=n;x<p;++x)this.hiddenByLandmarkVertexArray.emplace(x,h?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(n){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=n.createVertexBuffer(this.hiddenByLandmarkVertexArray,tZ.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let n=0;n<=4;n++){const o=this.regionSegments[n];o&&o.destroy()}}}}class fS{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.overscaling=n.overscaling,this.layers=n.layers,this.pixelRatio=n.pixelRatio,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=n.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new bs,this.footprintVertices=new tl,this.footprintSegments=[],this.layoutVertexArray=new tp,this.centroidVertexArray=new Z2,this.wallVertexArray=new Y2,this.indexArray=new bs,this.programConfigurations=new Rc(n.layers,{zoom:n.zoom,lut:n.lut},o=>sZ.includes(o)),this.segments=new Fs,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.groundEffect=new Rj(n),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=n.worldview,this.hasAppearances=null}updateFootprints(n,o){}updateAppearances(n,o,h,p){}populate(n,o,h,p){this.features=[],this.hasPattern=Tj("fill-extrusion",this.layers,this.pixelRatio,o),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=We(h),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:x,id:v,index:w,sourceLayerIndex:C}of n){const A=this.layers[0]._featureFilter.needGeometry,k=xt(x,A);if(!this.layers[0]._featureFilter.filter(new us(this.zoom,{worldview:this.worldview,activeFloors:o.activeFloors}),k,h))continue;const P={id:v,sourceLayerIndex:C,index:w,geometry:A?k.geometry:Pt(x,h,p),properties:x.properties,type:x.type,patterns:{}},O=this.layoutVertexArray.length,G=Dj[P.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:x.id,feature:Ej("fill-extrusion",this.layers,P,this.zoom,this.pixelRatio,o)});else if(this.wallMode)for(const W of P.geometry)for(const te of EO(W,G))this.addFeature(x.id,P,[te],w,h,{},o.availableImages,p,o.brightness);else this.addFeature(x.id,P,P.geometry,w,h,{},o.availableImages,p,o.brightness);o.featureIndex.insert(x,P.geometry,w,C,this.index,O)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(n,o,h,p,x,v){for(const{featureId:w,feature:C}of this.features){const A=Dj[C.type]==="Polygon",{geometry:k}=C;if(this.wallMode)for(const P of k)for(const O of EO(P,A))this.addFeature(w,C,[O],C.index,o,h,p,x,v);else this.addFeature(w,C,k,C.index,o,h,p,x,v)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(n,o,h,p,x,v,w){this.programConfigurations.updatePaintArrays(n,o,x,h,p,v,w,this.worldview),this.groundEffect.update(n,o,x,h,p,v,w,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,nZ),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.wallVertexBuffer=n.createVertexBuffer(this.wallVertexArray,eZ.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=n.createVertexBuffer(this.layoutVertexExtArray,rZ.members,!0)),this.groundEffect.upload(n)),this.groundEffect.uploadPaintProperties(n),this.programConfigurations.upload(n),this.uploaded=!0}uploadCentroid(n){this.groundEffect.uploadHiddenByLandmark(n),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,QH.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,o,h,p,x,v,w,C,A){const k=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(o,{})/this.tileToMeter,P=[new At(0,0),new At(ar,ar)],O=C.projection,G=O.name==="globe",W=this.wallMode||Dj[o.type]==="Polygon",te=new kO;te.centroidDataIndex=this.centroidData.length;const se=new NO;se.buildingId=n,o.properties&&o.properties.hasOwnProperty("building_id")&&(se.buildingId=o.properties.building_id);const oe=this.layers[0].paint.get("fill-extrusion-base").evaluate(o,{},x)<=0,ge=this.layers[0].paint.get("fill-extrusion-height").evaluate(o,{},x);let ve;if(se.height=ge,se.vertexArrayOffset=this.layoutVertexArray.length,se.groundVertexArrayOffset=this.groundEffect.vertexArray.length,G&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new E0),this.wallMode){if(G)return void ur("Non zero fill-extrusion-line-width is not yet supported on globe.");if(h.length!==1)return;ve=function(ot){const Ct=ot[0].x===ot[ot.length-1].x&&ot[0].y===ot[ot.length-1].y;(function(_r){let dr=0;const En=_r.length;for(let pr=0;pr<En;pr++)dr+=(_r[(pr+1)%En].x-_r[pr].x)*(_r[(pr+1)%En].y+_r[pr].y);return dr>=0})(ot)||(ot=ot.reverse());const Bt={geometry:[],joinNormals:[],indices:[]},ir=[],Jt=[],Ft=[];let Yt=ot.length;for(;Yt>=2&&ot[Yt-1].equals(ot[Yt-2]);)Yt--;if(Yt<(Ct?3:2))return Bt;let wt,vt,Ht,rr,Lt,br=0;for(;br<Yt-1&&ot[br].equals(ot[br+1]);)br++;Ct&&(wt=ot[Yt-2],Lt=ot[br].sub(wt)._unit()._perp());for(let _r=br;_r<Yt;_r++){if(Ht=_r===Yt-1?Ct?ot[br+1]:void 0:ot[_r+1],Ht&&ot[_r].equals(Ht))continue;Lt&&(rr=Lt),wt&&(vt=wt),wt=ot[_r],Lt=Ht?Ht.sub(wt)._unit()._perp():rr,rr=rr||Lt;let dr=rr.add(Lt);dr.x===0&&dr.y===0||dr._unit();const En=dr.x*Lt.x+dr.y*Lt.y,pr=En!==0?1/En:1/0,Qr=rr.x*Lt.y-rr.y*Lt.x>0;let jn="miter";const Gn=2;jn==="miter"&&pr>Gn&&(jn="bevel"),jn==="bevel"&&(pr>100&&(jn="flipbevel"),pr<Gn&&(jn="miter"));const mi=(Pn,Ei,Ci,As)=>{const Le=new At(Pn.x,Pn.y),Pe=new At(Pn.x,Pn.y);Le.x+=Ei.x*As,Le.y+=Ei.y*As,Pe.x-=Ei.x*Math.max(Ci,1),Pe.y-=Ei.y*Math.max(Ci,1),Ft.push(Ei),ir.push(Le),Jt.push(Pe)};if(jn==="miter")dr._mult(pr),mi(wt,dr,0,0);else if(jn==="flipbevel")dr=Lt.mult(-1),mi(wt,dr,0,0),mi(wt,dr.mult(-1),0,0);else{const Pn=-Math.sqrt(pr*pr-1),Ei=Qr?Pn:0,Ci=Qr?0:Pn;vt&&mi(wt,rr,Ei,Ci),Ht&&mi(wt,Lt,Ei,Ci)}}Bt.geometry=[...ir,...Jt.reverse(),ir[0]],Bt.joinNormals=[...Ft,...Ft.reverse(),Ft[Ft.length-1]];const Ir=Bt.geometry.length-1;for(let _r=0;_r<Ir/2;_r++)if(_r+1<Ir/2){let dr=_r,En=_r+1,pr=Ir-1-_r,Qr=Ir-2-_r;dr=dr===0?Ir-1:dr-1,En=En===0?Ir-1:En-1,pr=pr===0?Ir-1:pr-1,Qr=Qr===0?Ir-1:Qr-1,Bt.indices.push(pr),Bt.indices.push(En),Bt.indices.push(dr),Bt.indices.push(pr),Bt.indices.push(Qr),Bt.indices.push(En)}return Bt}(h[0]),h=[ve.geometry]}const Te=(ot,Ct)=>ot<(Ct.length-1)/2||ot===Ct.length-1,$e=this.wallMode?[h]:x1(h,500);for(let ot=$e.length-1;ot>=0;ot--){const Ct=$e[ot];(Ct.length===0||(Fe=Ct[0]).every(Mt=>Mt.x<=0)||Fe.every(Mt=>Mt.x>=ar)||Fe.every(Mt=>Mt.y<=0)||Fe.every(Mt=>Mt.y>=ar))&&$e.splice(ot,1)}var Fe;let Ze;if(G)Ze=zO($e,P,x);else{Ze=[];for(const ot of $e)Ze.push({polygon:ot,bounds:P})}const Ye=W?this.edgeRadius:0,Je=Ye>0&&this.zoom<17,Tt=(ot,Ct)=>{if(ot.length===0)return!1;const Mt=ot[ot.length-1];return Ct.x===Mt.x&&Ct.y===Mt.y};for(const{polygon:ot,bounds:Ct}of Ze){let Mt=0,Bt=0;for(const Yt of ot)W&&!Yt[0].equals(Yt[Yt.length-1])&&Yt.push(Yt[0]),Bt+=W?Yt.length-1:Yt.length;const ir=this.segments.prepareSegment((W?5:4)*Bt,this.layoutVertexArray,this.indexArray);se.footprintSegIdx<0&&(se.footprintSegIdx=this.footprintSegments.length),se.polygonSegIdx<0&&(se.polygonSegIdx=this.polygonSegments.length);const Jt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ft=new IO;if(Ft.vertexOffset=this.footprintVertices.length,Ft.indexOffset=3*this.footprintIndices.length,Ft.ringIndices=[],W){const Yt=[],wt=[];Mt=ir.vertexLength;for(let Ht=0;Ht<ot.length;Ht++){const rr=ot[Ht];rr.length&&Ht!==0&&wt.push(Yt.length/2);const Lt=[];let br,Ir;br=rr[1].sub(rr[0])._perp()._unit(),Ft.ringIndices.push(rr.length-1);for(let _r=1;_r<rr.length;_r++){const dr=rr[_r],En=rr[_r===rr.length-1?1:_r+1],pr=dr.clone();if(Ye){Ir=En.sub(dr)._perp()._unit();const Qr=br.add(Ir)._unit(),jn=Ye*Math.min(4,1/(br.x*Qr.x+br.y*Qr.y));pr.x+=jn*Qr.x,pr.y+=jn*Qr.y,pr.x=Math.round(pr.x),pr.y=Math.round(pr.y),br=Ir}if(!oe||Ye!==0&&!Je||Tt(Lt,pr)||Lt.push(pr),y1(this.layoutVertexArray,pr.x,pr.y,0,0,1,1,0),this.wallMode){const Qr=Te(_r,rr);w1(this.wallVertexArray,ve.joinNormals[_r],!Qr)}ir.vertexLength++,this.footprintVertices.emplaceBack(dr.x,dr.y),Yt.push(dr.x,dr.y),G&&b1(this.layoutVertexExtArray,O.projectTilePoint(pr.x,pr.y,x),O.upVector(x,pr.x,pr.y))}oe&&(Ye===0||Je)&&(Lt.length!==0&&Tt(Lt,Lt[0])&&Lt.pop(),this.groundEffect.addData(Lt,Ct,k))}const vt=this.wallMode?ve.indices:L0(Yt,wt);for(let Ht=0;Ht<vt.length;Ht+=3)this.footprintIndices.emplaceBack(Ft.vertexOffset+vt[Ht+0],Ft.vertexOffset+vt[Ht+1],Ft.vertexOffset+vt[Ht+2]),this.indexArray.emplaceBack(Mt+vt[Ht],Mt+vt[Ht+2],Mt+vt[Ht+1]),ir.primitiveLength++;Ft.indexCount+=vt.length,Ft.vertexCount+=this.footprintVertices.length-Ft.vertexOffset}for(let Yt=0;Yt<ot.length;Yt++){const wt=ot[Yt];te.startRing(se,wt[0]);let vt=wt.length>4&&OO(wt[wt.length-2],wt[0],wt[1]),Ht=Ye?dZ(wt[wt.length-2],wt[0],wt[1],Ye):0;const rr=[];let Lt,br,Ir;br=wt[1].sub(wt[0])._perp()._unit();let _r=!0;for(let dr=1,En=0;dr<wt.length;dr++){let pr=wt[dr-1],Qr=wt[dr];const jn=wt[dr===wt.length-1?1:dr+1];if(te.appendEdge(se,Qr,pr),Mj(Qr,pr,Ct)){Ye&&(br=jn.sub(Qr)._perp()._unit(),_r=!_r);continue}const Gn=Qr.sub(pr)._perp(),mi=Gn.x/(Math.abs(Gn.x)+Math.abs(Gn.y)),Pn=Gn.y>0?1:0,Ei=pr.dist(Qr);if(En+Ei>32768&&(En=0),Ye){Ir=jn.sub(Qr)._perp()._unit();let Pe=RO(pr,Qr,jn,DO(br,Ir),Ye);isNaN(Pe)&&(Pe=0);const jt=Qr.sub(pr)._unit();pr=pr.add(jt.mult(Ht))._round(),Qr=Qr.add(jt.mult(-Pe))._round(),Ht=Pe,br=Ir,oe&&this.zoom>=17&&(Tt(rr,pr)||rr.push(pr),Tt(rr,Qr)||rr.push(Qr))}const Ci=ir.vertexLength,As=wt.length>4&&OO(pr,Qr,jn);let Le=FO(En,vt,_r);if(y1(this.layoutVertexArray,pr.x,pr.y,mi,Pn,0,0,Le),y1(this.layoutVertexArray,pr.x,pr.y,mi,Pn,0,1,Le),this.wallMode){const Pe=Te(dr-1,wt),jt=ve.joinNormals[dr-1];w1(this.wallVertexArray,jt,Pe),w1(this.wallVertexArray,jt,Pe)}if(En+=Ei,Le=FO(En,As,!_r),vt=As,y1(this.layoutVertexArray,Qr.x,Qr.y,mi,Pn,0,0,Le),y1(this.layoutVertexArray,Qr.x,Qr.y,mi,Pn,0,1,Le),this.wallMode){const Pe=Te(dr,wt),jt=ve.joinNormals[dr];w1(this.wallVertexArray,jt,Pe),w1(this.wallVertexArray,jt,Pe)}if(ir.vertexLength+=4,this.indexArray.emplaceBack(Ci+0,Ci+1,Ci+2),this.indexArray.emplaceBack(Ci+1,Ci+3,Ci+2),ir.primitiveLength+=2,Ye){const Pe=Mt+(dr===1?wt.length-2:dr-2),jt=dr===1?Mt:Pe+1;if(this.indexArray.emplaceBack(Ci+1,Pe,Ci+3),this.indexArray.emplaceBack(Pe,jt,Ci+3),ir.primitiveLength+=2,Lt===void 0&&(Lt=Ci),!Mj(jn,wt[dr],Ct)){const cr=dr===wt.length-1?Lt:ir.vertexLength;this.indexArray.emplaceBack(Ci+2,Ci+3,cr),this.indexArray.emplaceBack(Ci+3,cr+1,cr),this.indexArray.emplaceBack(Ci+3,jt,cr+1),ir.primitiveLength+=3}_r=!_r}if(G){const Pe=this.layoutVertexExtArray,jt=O.projectTilePoint(pr.x,pr.y,x),cr=O.projectTilePoint(Qr.x,Qr.y,x),It=O.upVector(x,pr.x,pr.y),fr=O.upVector(x,Qr.x,Qr.y);b1(Pe,jt,It),b1(Pe,jt,It),b1(Pe,cr,fr),b1(Pe,cr,fr)}}W&&(Mt+=wt.length-1),oe&&Ye&&this.zoom>=17&&(rr.length!==0&&Tt(rr,rr[0])&&rr.pop(),this.groundEffect.addData(rr,Ct,k,Ye>0))}this.footprintSegments.push(Ft),Jt.triangleCount=this.indexArray.length-Jt.triangleArrayOffset,this.polygonSegments.push(Jt),++se.footprintSegLen,++se.polygonSegLen}if(se.vertexCount=this.layoutVertexArray.length-se.vertexArrayOffset,se.groundVertexCount=this.groundEffect.vertexArray.length-se.groundVertexArrayOffset,se.vertexCount!==0){if(se.centroidXY=te.borders?CO:this.encodeCentroid(te,se),this.centroidData.push(se),te.borders){this.featuresOnBorder.push(te);const ot=this.featuresOnBorder.length-1;for(let Ct=0;Ct<te.borders.length;Ct++)te.borders[Ct][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ct].push(ot)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,p,v,w,x,A,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(o,p,v,w,x,A,this.worldview),this.maxHeight=Math.max(this.maxHeight,ge)}}sortBorders(){for(let n=0;n<this.borderFeatureIndices.length;n++)this.borderFeatureIndices[n].sort((o,h)=>this.featuresOnBorder[o].borders[n][0]-this.featuresOnBorder[h].borders[n][0])}splitToSubtiles(){const n=[];for(let w=0;w<this.centroidData.length;w++){const C=this.centroidData[w],A=+(C.min.y+C.max.y>ar),k=2*A+(+(C.min.x+C.max.x>ar)^A);for(let P=0;P<C.polygonSegLen;P++){const O=C.polygonSegIdx+P;n.push({centroidIdx:w,subtile:k,polygonSegmentIdx:O,triangleSegmentIdx:this.polygonSegments[O].triangleSegIdx})}}const o=new bs;n.sort((w,C)=>w.triangleSegmentIdx===C.triangleSegmentIdx?w.subtile-C.subtile:w.triangleSegmentIdx-C.triangleSegmentIdx);let h=0,p=0,x=0;for(const w of n){if(w.triangleSegmentIdx!==h)break;x++}const v=n.length;for(;p!==n.length;){h=n[p].triangleSegmentIdx;let w=0,C=p,A=p;for(let k=C;k<x&&n[k].subtile===w;k++)A++;for(;C!==x;){const k=n[C];w=k.subtile;const P=this.centroidData[k.centroidIdx].min.clone(),O=this.centroidData[k.centroidIdx].max.clone(),G={vertexOffset:this.segments.segments[h].vertexOffset,primitiveOffset:o.length,vertexLength:this.segments.segments[h].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let W=C;W<A;W++){const te=n[W],se=this.polygonSegments[te.polygonSegmentIdx],oe=this.centroidData[te.centroidIdx].min,ge=this.centroidData[te.centroidIdx].max,ve=this.indexArray.uint16;for(let Te=se.triangleArrayOffset;Te<se.triangleArrayOffset+se.triangleCount;Te++)o.emplaceBack(ve[3*Te],ve[3*Te+1],ve[3*Te+2]);G.primitiveLength+=se.triangleCount,P.x=Math.min(P.x,oe.x),P.y=Math.min(P.y,oe.y),O.x=Math.max(O.x,ge.x),O.y=Math.max(O.y,ge.y)}G.primitiveLength>0&&this.triangleSubSegments.push({segment:G,min:P,max:O}),C=A;for(let W=C;W<x&&n[W].subtile===n[C].subtile;W++)A++}p=x;for(let k=p;k<v&&n[k].triangleSegmentIdx===n[p].triangleSegmentIdx;k++)x++}o._trim(),this.indexArray=o}getVisibleSegments(n,o,h){const p=new Fs;if(this.wallMode){for(const te of this.triangleSubSegments)p.segments.push(te.segment);return p}let x=0,v=0;const w=1<<n.canonical.z;if(o){const te=o.getMinMaxForTile(n);te&&(x=te.min,v=te.max)}v+=this.maxHeight;const C=n.toUnwrapped();let A;const k=[C.canonical.x/w+C.wrap,C.canonical.y/w],P=[(C.canonical.x+1)/w+C.wrap,(C.canonical.y+1)/w],O=(te,se,oe)=>[te[0]*(1-oe[0])+se[0]*oe[0],te[1]*(1-oe[1])+se[1]*oe[1]],G=[],W=[];for(const te of this.triangleSubSegments){G[0]=te.min.x/ar,G[1]=te.min.y/ar,W[0]=te.max.x/ar,W[1]=te.max.y/ar;const se=O(k,P,G),oe=O(k,P,W);if(new qn([se[0],se[1],x],[oe[0],oe[1],v]).intersectsPrecise(h)===0){A&&(p.segments.push(A),A=void 0);continue}const ge=te.segment;A&&A.vertexOffset!==ge.vertexOffset&&(p.segments.push(A),A=void 0),A?(A.vertexLength+=ge.vertexLength,A.primitiveLength+=ge.primitiveLength):A={vertexOffset:ge.vertexOffset,primitiveLength:ge.primitiveLength,vertexLength:ge.vertexLength,primitiveOffset:ge.primitiveOffset,sortKey:void 0,vaos:{}}}return A&&p.segments.push(A),p}encodeCentroid(n,o){const h=n.centroid(),p=o.span(),x=Math.min(7,Math.round(p.x*this.tileToMeter/10)),v=Math.min(7,Math.round(p.y*this.tileToMeter/10));return new At(K(h.x,1,ar-1)<<3|x,K(h.y,1,ar-1)<<3|v)}encodeBorderCentroid(n){if(!n.borders)return new At(0,0);const o=n.borders,h=Number.MAX_VALUE;if(o[0][0]!==h||o[1][0]!==h){const p=o[0][0]!==h?0:1;return new At(6|(o[0][0]!==h?0:65528),(o[p][0]+o[p][1])/2<<3|6)}{const p=o[2][0]!==h?2:3;return new At((o[p][0]+o[p][1])/2<<3|6,6|(o[2][0]!==h?0:65528))}}showCentroid(n){const o=this.centroidData[n.centroidDataIndex];o.flags&=2147483647,o.centroidXY.x=0,o.centroidXY.y=0,this.writeCentroidToBuffer(o)}writeCentroidToBuffer(n){this.groundEffect.updateHiddenByLandmark(n);const o=n.vertexArrayOffset,h=n.vertexCount+n.vertexArrayOffset,p=n.flags&fp?CO:n.centroidXY,x=this.centroidVertexArray.geta_centroid_pos0(o);if(this.centroidVertexArray.geta_centroid_pos1(o)!==p.y||x!==p.x){for(let v=o;v<h;++v)this.centroidVertexArray.emplace(v,p.x,p.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const n of this.centroidData)this.writeCentroidToBuffer(n)}updateReplacement(n,o,h){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const p=o.getReplacementRegionsForTile(n.toUnwrapped());if(dS(this.activeReplacements,p))return;if(this.activeReplacements=p,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const v of this.centroidData)v.flags&=2147483647;const x=[];for(const v of this.activeReplacements){if(v.order<h)continue;const w=Math.max(1,Math.pow(2,v.footprintTileId.canonical.z-n.canonical.z));if(v.footprint.buildingId){const C=v.footprint.buildingId;for(const A of this.centroidData)A.buildingId===C&&(A.flags|=fp)}else for(const C of this.centroidData)if(!(C.flags&fp||v.min.x>C.max.x||C.min.x>v.max.x||v.min.y>C.max.y||C.min.y>v.max.y))for(let A=0;A<C.footprintSegLen;A++){const k=this.footprintSegments[C.footprintSegIdx+A];if(x.length=0,hZ(this.footprintVertices,k.vertexOffset,k.vertexCount,v.footprintTileId.canonical,n.canonical,x),Nj(v.footprint,x,this.footprintIndices.uint16,k.indexOffset,k.indexCount,-k.vertexOffset,-w)){C.flags|=fp;break}}}for(const v of this.centroidData)this.writeCentroidToBuffer(v);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(n,o,h){let p=!1;for(let x=0;x<h.footprintSegLen;x++){const v=this.footprintSegments[h.footprintSegIdx+x];let w=0;for(const C of v.ringIndices){for(let A=w,k=C+w-1;A<C+w;k=A++){const P=this.footprintVertices.int16[2*(A+v.vertexOffset)+0],O=this.footprintVertices.int16[2*(A+v.vertexOffset)+1],G=this.footprintVertices.int16[2*(k+v.vertexOffset)+1];O>o!=G>o&&n<(this.footprintVertices.int16[2*(k+v.vertexOffset)+0]-P)*(o-O)/(G-O)+P&&(p=!p)}w=C}}return p}getHeightAtTileCoord(n,o){let h=Number.NEGATIVE_INFINITY,p=!0;const x=4*(n+ar)*ar+(o+ar);if(this.partLookup.hasOwnProperty(x)){const v=this.partLookup[x];return v?{height:v.height,hidden:!!(v.flags&fp)}:void 0}for(const v of this.centroidData)n>v.max.x||v.min.x>n||o>v.max.y||v.min.y>o||v.height<=h||this.footprintContainsPoint(n,o,v)&&(h=v.height,this.partLookup[x]=v,p=!!(v.flags&fp));if(h!==Number.NEGATIVE_INFINITY)return{height:h,hidden:p};this.partLookup[x]=void 0}}function DO(l,n){const o=l.add(n)._unit();return l.x*o.x+l.y*o.y}function dZ(l,n,o,h){const p=n.sub(l)._perp()._unit(),x=o.sub(n)._perp()._unit();return RO(l,n,o,DO(p,x),h)}function RO(l,n,o,h,p){const x=Math.sqrt(1-h*h);return Math.min(l.dist(n)/3,n.dist(o)/3,p*x/h)}function Mj(l,n,o){return l.x<o[0].x&&n.x<o[0].x||l.x>o[1].x&&n.x>o[1].x||l.y<o[0].y&&n.y<o[0].y||l.y>o[1].y&&n.y>o[1].y}function MO(l,n){return l.x<n[0].x||l.x>n[1].x||l.y<n[0].y||l.y>n[1].y}function OO(l,n,o){if(l.x<0||l.x>=ar||n.x<0||n.x>=ar||o.x<0||o.x>=ar)return!1;const h=o.sub(n),p=h.perp(),x=l.sub(n);return(h.x*x.x+h.y*x.y)/Math.sqrt((h.x*h.x+h.y*h.y)*(x.x*x.x+x.y*x.y))>-.866&&p.x*x.x+p.y*x.y<0}function FO(l,n,o){const h=n?2|l:-3&l;return o?1|h:-2&h}function LO(){const l=Math.PI/32,n=Math.tan(l),o=L;return o*Math.sqrt(1+2*n*n)-o}function zO(l,n,o){const h=1<<o.z,p=je(o.x/h),x=je((o.x+1)/h),v=we(o.y/h),w=we((o.y+1)/h);return function(C,A,k,P,O=0,G){const W=[];if(!C.length||!k||!P)return W;const te=(Fe,Ze)=>{for(const Ye of Fe)W.push({polygon:Ye,bounds:Ze})},se=Math.ceil(Math.log2(k)),oe=Math.ceil(Math.log2(P)),ge=se-oe,ve=[];for(let Fe=0;Fe<Math.abs(ge);Fe++)ve.push(ge>0?0:1);for(let Fe=0;Fe<Math.min(se,oe);Fe++)ve.push(0),ve.push(1);let Te=C;if(Te=lS(Te,A[0].y-O,A[1].y+O,1),Te=lS(Te,A[0].x-O,A[1].x+O,0),!Te.length)return W;const $e=[];for(ve.length?$e.push({polygons:Te,bounds:A,depth:0}):te(Te,A);$e.length;){const Fe=$e.pop(),Ze=Fe.depth,Ye=ve[Ze],Je=Fe.bounds[0],Tt=Fe.bounds[1],ot=Ye===0?Je.x:Je.y,Ct=Ye===0?Tt.x:Tt.y,Mt=G?G(Ye,ot,Ct):.5*(ot+Ct),Bt=lS(Fe.polygons,ot-O,Mt+O,Ye),ir=lS(Fe.polygons,Mt-O,Ct+O,Ye);if(Bt.length){const Jt=[Je,new At(Ye===0?Mt:Tt.x,Ye===1?Mt:Tt.y)];ve.length>Ze+1?$e.push({polygons:Bt,bounds:Jt,depth:Ze+1}):te(Bt,Jt)}if(ir.length){const Jt=[new At(Ye===0?Mt:Je.x,Ye===1?Mt:Je.y),Tt];ve.length>Ze+1?$e.push({polygons:ir,bounds:Jt,depth:Ze+1}):te(ir,Jt)}}return W}(l,n,Math.ceil((x-p)/11.25),Math.ceil((v-w)/11.25),1,(C,A,k)=>{if(C===0)return .5*(A+k);{const P=we((o.y+A/ar)/h);return(de(.5*(we((o.y+k/ar)/h)+P))*h-o.y)*ar}})}function hZ(l,n,o,h,p,x){const v=Math.pow(2,h.z-p.z);for(let w=0;w<o;w++){let C=l.int16[2*(w+n)+0],A=l.int16[2*(w+n)+1];C=(C+p.x*ar)*v-h.x*ar,A=(A+p.y*ar)*v-h.y*ar,x.push(new At(C,A))}}let BO,UO;Tr(fS,"FillExtrusionBucket",{omit:["layers","features"]}),Tr(NO,"PartData"),Tr(IO,"FootprintSegment"),Tr(kO,"BorderCentroidData"),Tr(Rj,"GroundEffect");class bg extends At{constructor(n,o,h){super(n,o),this.z=h}}class VO extends bg{constructor(n,o,h,p){super(n,o,h),this.w=p}}function $O(l,n,o,h){const p=o==="x"?"y":"x",x=(h-l[o])/(n[o]-l[o]);l[p]=Math.round(l[p]+(n[p]-l[p])*x),l[o]=h,l.hasOwnProperty("z")&&(l.z=fn(l.z,n.z,x)),l.hasOwnProperty("w")&&(l.w=fn(l.w,n.w,x))}function qO(l,n,o,h){const p=o,x=h;for(const v of["x","y"]){let w=l,C=n;w[v]>=C[v]&&(w=n,C=l),w[v]<p&&C[v]>p&&$O(w,C,v,p),w[v]<x&&C[v]>x&&$O(C,w,v,x)}}function pS(l,n,o,h,p,x){const v=[];for(let w=0;w<l.length;w++){const C=l[w];let A;const k=v.length;let P=0;for(let O=0;O<C.length-1;O++){let G=C[O],W=C[O+1],te=0;const se=P;let oe,ge;x&&(te=Math.hypot(W.x-G.x,W.y-G.y),P+=te,oe=G,ge=W),G.x<n&&W.x<n||(G.x<n?G=new At(n,G.y+(n-G.x)/(W.x-G.x)*(W.y-G.y))._round():W.x<n&&(W=new At(n,G.y+(n-G.x)/(W.x-G.x)*(W.y-G.y))._round()),G.y<o&&W.y<o||(G.y<o?G=new At(G.x+(o-G.y)/(W.y-G.y)*(W.x-G.x),o)._round():W.y<o&&(W=new At(G.x+(o-G.y)/(W.y-G.y)*(W.x-G.x),o)._round()),G.x>=h&&W.x>=h||(G.x>=h?G=new At(h,G.y+(h-G.x)/(W.x-G.x)*(W.y-G.y))._round():W.x>=h&&(W=new At(h,G.y+(h-G.x)/(W.x-G.x)*(W.y-G.y))._round()),G.y>=p&&W.y>=p||(G.y>=p?G=new At(G.x+(p-G.y)/(W.y-G.y)*(W.x-G.x),p)._round():W.y>=p&&(W=new At(G.x+(p-G.y)/(W.y-G.y)*(W.x-G.x),p)._round()),A&&G.equals(A[A.length-1])||(A=[G],v.push(A),x&&x.push({progress:{min:se+GO(oe,ge,G)*te,max:1},parentIndex:w,prevPoint:oe,nextPoint:ge})),A.push(W),x&&(x[x.length-1].progress.max=se+GO(oe,ge,W)*te,x[x.length-1].nextPoint=ge)))))}if(x&&P>0)for(let O=k;O<v.length;O++)x[O].progress.min/=P,x[O].progress.max/=P}return v}function fZ(l,n,o,h,p){if(l.length<2)return void h.push(l);const x=[];for(;n.valid();){const[A,k]=n.get();for(let P=0;P<l.length-1;P++){const O=l[P],G=l[P+1],W=Dl(O,G,A,k);if(W){const[te]=W,se=new At(fn(O.x,G.x,te),fn(O.y,G.y,te));x.push({t:P+te,distance:0,point:se})}}n.next()}if(x.length===0)return void h.push(l);x.sort((A,k)=>A.t-k.t);let v=0,w=0,C=[];for(h.push(C);v!==l.length;){if(w===x.length){for(;v!==l.length;)C.length!==0&&C[C.length-1].equals(l[v])||C.push(l[v]),v++;break}x[w].t<=v?(C.length!==0&&C[C.length-1].equals(x[w].point)||C.push(x[w].point),Math.trunc(x[w].t),w++):(C.length!==0&&C[C.length-1].equals(l[v])||C.push(l[v]),v++)}}function GO(l,n,o){return l.x!==n.x?(o.x-l.x)/(n.x-l.x):l.y!==n.y?(o.y-l.y)/(n.y-l.y):0}function S1(l,n){return l.x*n.x+l.y*n.y}function WO(l,n){if(l.length===1){let o=0;const h=n[o++];let p;for(;!p||h.equals(p);)if(p=n[o++],!p)return 1/0;for(;o<n.length;o++){const x=n[o],v=l[0],w=p.sub(h),C=x.sub(h),A=v.sub(h),k=S1(w,w),P=S1(w,C),O=S1(C,C),G=S1(A,w),W=S1(A,C),te=k*O-P*P,se=(O*G-P*W)/te,oe=(k*W-P*G)/te,ge=h.z*(1-se-oe)+p.z*se+x.z*oe;if(isFinite(ge))return ge}return 1/0}{let o=1/0;for(const h of n)o=Math.min(o,h.z);return o}}function HO(l,n,o){let h=1/0;Xs(o,n)&&(h=WO(o,n[0]));for(let p=0;p<n.length;p++){const x=n[p],v=l[p];for(let w=0;w<x.length-1;w++){const C=x[w],A=[C,x[w+1],v[w+1],v[w],C];ra(o,A)&&(h=Math.min(h,WO(o,A)))}}return h!==1/0&&h}function ZO(l,n,o,h,p,x,v,w,C,A,k){return l.projection.name==="globe"?function(P,O,G,W,te,se,oe,ge,ve,Te,$e){const Fe=[],Ze=[],Ye=P.projection.upVectorScale($e,P.center.lat,P.worldSize).metersToTile,Je=[0,0,0,1],Tt=[0,0,0,1],ot=(Mt,Bt,ir,Jt)=>{Mt[0]=Bt,Mt[1]=ir,Mt[2]=Jt,Mt[3]=1},Ct=LO();G>0&&(G+=Ct),W+=Ct;for(const Mt of O){const Bt=[],ir=[];for(const Jt of Mt){const Ft=Jt.x+te.x,Yt=Jt.y+te.y,wt=P.projection.projectTilePoint(Ft,Yt,$e),vt=P.projection.upVector($e,Jt.x,Jt.y);let Ht=G,rr=W;if(oe){const Lt=XO(Ft,Yt,G,W,oe,ge,ve,Te);Ht+=Lt.base,rr+=Lt.top}G!==0?ot(Je,wt.x+vt[0]*Ye*Ht,wt.y+vt[1]*Ye*Ht,wt.z+vt[2]*Ye*Ht):ot(Je,wt.x,wt.y,wt.z),ot(Tt,wt.x+vt[0]*Ye*rr,wt.y+vt[1]*Ye*rr,wt.z+vt[2]*Ye*rr),nn(Je,Je,se),nn(Tt,Tt,se),Bt.push(new bg(Je[0],Je[1],Je[2])),ir.push(new bg(Tt[0],Tt[1],Tt[2]))}Fe.push(Bt),Ze.push(ir)}return[Fe,Ze]}(l,n,o,h,p,x,v,w,C,A,k):v?function(P,O,G,W,te,se,oe,ge,ve){const Te=[],$e=[],Fe=[0,0,0,1];for(const Ze of P){const Ye=[],Je=[];for(const Tt of Ze){const ot=Tt.x+W.x,Ct=Tt.y+W.y,Mt=XO(ot,Ct,O,G,se,oe,ge,ve);Fe[0]=ot,Fe[1]=Ct,Fe[2]=Mt.base,Fe[3]=1,Sr(Fe,Fe,te),Fe[3]=Math.max(Fe[3],1e-5);const Bt=new bg(Fe[0]/Fe[3],Fe[1]/Fe[3],Fe[2]/Fe[3]);Fe[0]=ot,Fe[1]=Ct,Fe[2]=Mt.top,Fe[3]=1,Sr(Fe,Fe,te),Fe[3]=Math.max(Fe[3],1e-5);const ir=new bg(Fe[0]/Fe[3],Fe[1]/Fe[3],Fe[2]/Fe[3]);Ye.push(Bt),Je.push(ir)}Te.push(Ye),$e.push(Je)}return[Te,$e]}(n,o,h,p,x,v,w,C,A):function(P,O,G,W,te){const se=[],oe=[],ge=te[8]*O,ve=te[9]*O,Te=te[10]*O,$e=te[11]*O,Fe=te[8]*G,Ze=te[9]*G,Ye=te[10]*G,Je=te[11]*G;for(const Tt of P){const ot=[],Ct=[];for(const Mt of Tt){const Bt=Mt.x+W.x,ir=Mt.y+W.y,Jt=te[0]*Bt+te[4]*ir+te[12],Ft=te[1]*Bt+te[5]*ir+te[13],Yt=te[2]*Bt+te[6]*ir+te[14],wt=te[3]*Bt+te[7]*ir+te[15],vt=Jt+ge,Ht=Ft+ve,rr=Yt+Te,Lt=Math.max(wt+$e,1e-5),br=Jt+Fe,Ir=Ft+Ze,_r=Yt+Ye,dr=Math.max(wt+Je,1e-5);ot.push(new bg(vt/Lt,Ht/Lt,rr/Lt)),Ct.push(new bg(br/dr,Ir/dr,_r/dr))}se.push(ot),oe.push(Ct)}return[se,oe]}(n,o,h,p,x)}function XO(l,n,o,h,p,x,v,w){const C=v*p.getElevationAt(l,n,!0,!0),A=x[0]!==0,k=A?x[1]===0?v*(x[0]/AO-jO):v*function(P,O,G){const W=Math.floor(O[0]/8),te=Math.floor(O[1]/8),se=10*(O[0]-8*W),oe=10*(O[1]-8*te),ge=P.getElevationAt(W,te,!0,!0),ve=P.getMeterToDEM(G),Te=Math.floor(.5*(se*ve-1)),$e=Math.floor(.5*(oe*ve-1)),Fe=P.tileCoordToPixel(W,te),Ze=2*Te+1,Ye=2*$e+1,Je=function(ir,Jt,Ft,Yt,wt){return[ir.getElevationAtPixel(Jt,Ft,!0),ir.getElevationAtPixel(Jt+wt,Ft,!0),ir.getElevationAtPixel(Jt,Ft+wt,!0),ir.getElevationAtPixel(Jt+Yt,Ft+wt,!0)]}(P,Fe.x-Te,Fe.y-$e,Ze,Ye),Tt=Math.abs(Je[0]-Je[1]),ot=Math.abs(Je[2]-Je[3]),Ct=Math.abs(Je[0]-Je[2])+Math.abs(Je[1]-Je[3]),Mt=Math.min(.25,.5*ve*(Tt+ot)/Ze),Bt=Math.min(.25,.5*ve*Ct/Ye);return ge+Math.max(Mt*se,Bt*oe)}(p,x,w):C;return{base:C+(o===0?-1:o),top:A?Math.max(k+h,C+o+2):C+h}}class pZ{constructor(n){this._callback=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class mZ{constructor(){this.tasks={},this.taskQueue=[],ze(["process"],this),this.invoker=new pZ(this.process),this.nextId=0}add(n,o){const h=this.nextId++,p=function({type:x,isSymbolTile:v,zoom:w}){return w=w||0,x==="message"?0:x!=="maybePrepare"||v?x!=="parseTile"||v?x==="parseTile"&&v?300-w:x==="maybePrepare"&&v?400-w:500:200-w:100-w}(o);if(p===0){try{n()}finally{}return null}return this.tasks[h]={fn:n,metadata:o,priority:p,id:h},this.taskQueue.push(h),this.invoker.trigger(),{cancel:()=>{delete this.tasks[h]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(h=>!!this.tasks[h]),!this.taskQueue.length)return;const n=this.pick();if(n===null)return;const o=this.tasks[n];if(delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),!o)return;o.fn()}finally{}}pick(){let n=null,o=1/0;for(let p=0;p<this.taskQueue.length;p++){const x=this.tasks[this.taskQueue[p]];x.priority<o&&(o=x.priority,n=p)}if(n===null)return null;const h=this.taskQueue[n];return this.taskQueue.splice(n,1),h}remove(){this.invoker.remove()}}class YO{constructor(n,o,h){this.target=n,this.parent=o,this.mapId=h,this.callbacks={},this.cancelCallbacks={},ze(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new mZ}send(n,o,h,p,x=!1,v){const w=Math.round(1e18*Math.random()).toString(36).substring(0,10);h&&(h.metadata=v,this.callbacks[w]=h);const C=new Set;return this.target.postMessage({id:w,type:n,hasCallback:!!h,targetMapId:p,mustQueue:x,sourceMapId:this.mapId,data:Ld(o,C)},C),{cancel:()=>{h&&delete this.callbacks[w],this.target.postMessage({id:w,type:"<cancel>",targetMapId:p,sourceMapId:this.mapId})}}}receive(n){const o=n.data;if(!o)return;const h=o.id;if(h&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){const p=this.cancelCallbacks[h];delete this.cancelCallbacks[h],p&&p.cancel()}else if(o.mustQueue||Zi(self)){const p=this.callbacks[h],x=this.scheduler.add(()=>this.processTask(h,o),p&&p.metadata||{type:"message"});x&&(this.cancelCallbacks[h]=x)}else this.processTask(h,o)}processTask(n,o){if(delete this.cancelCallbacks[n],o.type==="<response>"){const h=this.callbacks[n];delete this.callbacks[n],h&&(o.error?h(zd(o.error)):h(null,zd(o.data)))}else{const h=new Set,p=o.hasCallback?(v,w)=>{this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:v?Ld(v):null,data:Ld(w,h)},h)}:()=>{},x=zd(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,x,p);else if(this.parent.getWorkerSource){const v=o.type.split("."),{source:w,scope:C}=x;this.parent.getWorkerSource(o.sourceMapId,v[0],w,C)[v[1]](x,p)}else p(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var T1={workerUrl:"",workerClass:null,workerParams:void 0};const Oj="mapboxgl_preloaded_worker_pool";class Sg{constructor(){this.active={}}acquire(n,o=Sg.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<o;)this.workers.push(T1.workerClass!=null?new T1.workerClass:new self.Worker(T1.workerUrl,T1.workerParams));return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.workers&&this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Oj]}numActive(){return Object.keys(this.active).length}}Sg.workerCount=2;class B0{constructor(n,o,h="Worker",p=Sg.workerCount){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=Re();const x=this.workerPool.acquire(this.id,p);for(let v=0;v<x.length;v++){const w=new B0.Actor(x[v],o,this.id);w.name=`${h} ${v}`,this.actors.push(w)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,o,h){_e(this.actors,(p,x)=>{p.send(n,o,x)},h=h||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}let E1,Fj;function mS(){return E1||(E1=new Sg),E1}B0.Actor=YO;class gZ{constructor(n){this.module=n}createIntArray(n){const o=new Int32Array(n),h=this.module.malloc(o.length*o.BYTES_PER_ELEMENT);return this.module.heap32.set(o,h/o.BYTES_PER_ELEMENT),h}createFloatArray(n){const o=new Float32Array(n),h=this.module.malloc(o.length*o.BYTES_PER_ELEMENT);return this.module.heapF32.set(o,h/o.BYTES_PER_ELEMENT),h}createStringBuffer(n){const o=this.module.malloc(n.length+1);for(let h=0;h<n.length;++h)this.module.heapU8[o+h]=n.charCodeAt(h);return this.module.heapU8[o+n.length]=0,o}readStringBuffer(n){let o="";for(;this.module.heapU8[n]!==0;)o+=String.fromCharCode(this.module.heapU8[n]),++n;return o}setStyle(n){const o=n.entranceColorRgb,h=n.facadeGlazingColorRgb,p=n.roofColorRgb,x=n.wallColorRgb,v=n.normalScale;this.module.setStyle(o[0],o[1],o[2],h[0],h[1],h[2],p[0],p[1],p[2],x[0],x[1],x[2],v[0],v[1],v[2],n.tileToMeters)}setAOOptions(n,o){this.module.setAOOptions(n?1:0,o)}setMetricOptions(n,o){this.module.setMetricOptions(n?1:0,o)}setStructuralOptions(n){this.module.setStructuralOptions(n?1:0)}setFacadeOptions(n,o){this.module.setFacadeOptions(n,o?1:0)}setFauxFacadeOptions(n,o,h){this.module.setFauxFacadeOptions(n?1:0,o?1:0,h)}setFacadeClassifierOptions(n){this.module.setFacadeClassifierOptions(n)}generateMesh(n,o){for(const w of n){const C=this.createStringBuffer(w.roofType),A=[0],k=[];for(const G of w.coordinates)if(Array.isArray(G)){for(const W of G)k.push(W.x),k.push(W.y);A.push(k.length)}const P=this.createIntArray(A),O=this.createFloatArray(k);this.module.addFeature(w.id,w.sourceId,w.minHeight,w.height,C,w.roofType.length,O,P,A.length-1),this.module.free(C),this.module.free(P),this.module.free(O)}for(const w of o){let C;C=w.entrances?JSON.parse(w.entrances):[];const A=this.createFloatArray(C),k=[];for(const O of w.coordinates)k.push(O.x),k.push(O.y);const P=this.createFloatArray(k);this.module.addFacade(w.sourceId,w.crossPerc,w.distanceToRoad,A,C.length,P,k.length),this.module.free(A),this.module.free(P)}if(!this.module.generateMesh()){const w=this.module.getLastError();return this.readStringBuffer(w)}const h=this.module.getMeshCount(),p=new Array(h);for(let w=0;w<h;w++){const C=this.module.getPositionsPtr(w),A=this.module.getPositionsLength(w),k=new Float32Array(this.module.heapF32.buffer,C,A),P=this.module.getNormalsPtr(w),O=this.module.getNormalsLength(w),G=new Float32Array(this.module.heapF32.buffer,P,O),W=this.module.getColorsPtr(w),te=this.module.getColorsLength(w),se=new Uint8Array(this.module.heapU8.buffer,W,te),oe=this.module.getAOPtr(w),ge=this.module.getAOLength(w),ve=new Float32Array(this.module.heapF32.buffer,oe,ge),Te=this.module.getUVPtr(w),$e=this.module.getUVLength(w),Fe=new Float32Array(this.module.heapF32.buffer,Te,$e),Ze=this.module.getFauxFacadePtr(w),Ye=this.module.getFauxFacadeLength(w),Je=new Uint8Array(this.module.heapU8.buffer,Ze,Ye),Tt=this.module.getIndicesPtr(w),ot=this.module.getIndicesLength(w),Ct=new Int32Array(this.module.heap32.buffer,Tt,ot),Mt=this.module.getBuildingPart(w),Bt=this.readStringBuffer(Mt);p[w]={positions:k,normals:G,colors:se,ao:ve,uv:Fe,isFauxFacade:Je,indices:Ct,buildingPart:Bt}}const x=this.module.getRingCount(),v=[];for(let w=0;w<x;w++){const C=this.module.getRingPtr(w),A=this.module.getRingLength(w),k=new Float32Array(this.module.heapF32.buffer,C,A);v.push(k)}return{meshes:p,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:v}}}let C1,Lj,Zu,U0,zj,V0=null,$0=null,KO=null,gS=null;function JO(){return Zi(self)&&self.worker.dracoUrl?self.worker.dracoUrl:Lj||cs.DRACO_URL}function QO(){if(Zi(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(U0)return U0;const l=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return U0=WebAssembly.validate(l)?cs.MESHOPT_SIMD_URL:cs.MESHOPT_URL,U0}function _Z(){return gS}const _S={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},xZ={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},A1={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function eF(l,n,o){const h=o.json.bufferViews.length,p=o.buffers.length;n.bufferView=h,o.json.bufferViews[h]={buffer:p,byteLength:l.byteLength},o.buffers[p]=l}const Bj="KHR_draco_mesh_compression";function vZ(l,n){const o=l.extensions&&l.extensions[Bj];if(!o)return;const h=new Zu.Decoder,p=iF(n,o.bufferView),x=new Zu.Mesh;if(!h.DecodeArrayToMesh(p,p.byteLength,x))throw new Error("Failed to decode Draco mesh");const v=n.json.accessors[l.indices],w=_S[v.componentType],C=v.count*w.BYTES_PER_ELEMENT,A=Zu._malloc(C);w===Uint16Array?h.GetTrianglesUInt16Array(x,C,A):h.GetTrianglesUInt32Array(x,C,A),eF(Zu.memory.buffer.slice(A,A+C),v,n),Zu._free(A);for(const k of Object.keys(o.attributes)){const P=h.GetAttributeByUniqueId(x,o.attributes[k]),O=n.json.accessors[l.attributes[k]],G=xZ[O.componentType],W=O.count*A1[O.type]*_S[O.componentType].BYTES_PER_ELEMENT,te=Zu._malloc(W);h.GetAttributeDataArrayForAllPoints(x,P,Zu[G],W,te),eF(Zu.memory.buffer.slice(te,te+W),O,n),Zu._free(te)}h.destroy(),x.destroy(),delete l.extensions[Bj]}const xS="EXT_meshopt_compression";function yZ(l,n){if(!l.extensions||!l.extensions[xS])return;const o=l.extensions[xS],h=new Uint8Array(n.buffers[o.buffer],o.byteOffset||0,o.byteLength||0),p=new Uint8Array(o.count*o.byteStride);zj.decodeGltfBuffer(p,o.count,o.byteStride,h,o.mode,o.filter),l.buffer=n.buffers.length,l.byteOffset=0,n.buffers[l.buffer]=p.buffer,delete l.extensions[xS]}const tF=1179937895,rF=new TextDecoder("utf8");function nF(l,n){return new URL(l,n).href}function wZ(l,n,o,h){return fetch(nF(l.uri,h)).then(p=>p.arrayBuffer()).then(p=>{n.buffers[o]=p})}function iF(l,n){const o=l.json.bufferViews[n];return new Uint8Array(l.buffers[o.buffer],o.byteOffset||0,o.byteLength)}function bZ(l,n,o,h){if(l.uri){const p=nF(l.uri,h);return fetch(p).then(x=>x.blob()).then(x=>createImageBitmap(x)).then(x=>{n.images[o]=x})}if(l.bufferView!==void 0){const p=iF(n,l.bufferView),x=new Blob([p],{type:l.mimeType});return createImageBitmap(x).then(v=>{n.images[o]=v})}}function sF(l,n=0,o){const h={json:null,images:[],buffers:[]};if(new Uint32Array(l,n,1)[0]===tF){const k=new Uint32Array(l,n);let P=2;const O=(k[P++]>>2)-3,G=k[P++]>>2;if(P++,h.json=JSON.parse(rF.decode(k.subarray(P,P+G))),P+=G,P<O){const W=k[P++];P++;const te=n+(P<<2);h.buffers[0]=l.slice(te,te+W)}}else h.json=JSON.parse(rF.decode(new Uint8Array(l,n)));const{buffers:p,images:x,meshes:v,extensionsUsed:w,bufferViews:C}=h.json;let A=Promise.resolve();if(p){const k=[];for(let P=0;P<p.length;P++){const O=p[P];O.uri?k.push(wZ(O,h,P,o)):h.buffers[P]||(h.buffers[P]=null)}A=Promise.all(k)}return A.then(()=>{const k=[],P=w&&w.includes(Bj),O=w&&w.includes(xS);if(P&&k.push(function(){if(!Zu)return C1??(C1=function(G){let W,te=null;function se(){W=new Uint8Array(te.buffer)}function oe(){throw new Error("Unexpected Draco error.")}const ge={a:{a:oe,d:function(ve,Te,$e){return W.copyWithin(ve,Te,Te+$e)},c:function(ve){const Te=W.length,$e=Math.max(ve>>>0,Math.ceil(1.2*Te)),Fe=Math.ceil(($e-Te)/65536);try{return te.grow(Fe),se(),!0}catch{return!1}},b:oe}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(G,ge):G.then(ve=>ve.arrayBuffer()).then(ve=>WebAssembly.instantiate(ve,ge))).then(ve=>{const{Rb:Te,Qb:$e,P:Fe,T:Ze,X:Ye,Ja:Je,La:Tt,Qa:ot,Va:Ct,Wa:Mt,eb:Bt,jb:ir,f:Jt,e:Ft,yb:Yt,zb:wt,Ab:vt,Bb:Ht,Db:rr,Gb:Lt}=ve.instance.exports;te=Ft;const br=(()=>{let Ir=0,_r=0,dr=0,En=0;return pr=>{dr&&(Te(En),Te(Ir),_r+=dr,dr=Ir=0),Ir||(_r+=128,Ir=$e(_r));const Qr=pr.length+7&-8;let jn=Ir;Qr>=_r&&(dr=Qr,jn=En=$e(Qr));for(let Gn=0;Gn<pr.length;Gn++)W[jn+Gn]=pr[Gn];return jn}})();return se(),Jt(),{memory:Ft,_free:Te,_malloc:$e,Mesh:class{constructor(){this.ptr=Fe()}destroy(){Ze(this.ptr)}},Decoder:class{constructor(){this.ptr=Je()}destroy(){ir(this.ptr)}DecodeArrayToMesh(Ir,_r,dr){const En=br(Ir),pr=Tt(this.ptr,En,_r,dr.ptr);return!!Ye(pr)}GetAttributeByUniqueId(Ir,_r){return{ptr:ot(this.ptr,Ir.ptr,_r)}}GetTrianglesUInt16Array(Ir,_r,dr){Ct(this.ptr,Ir.ptr,_r,dr)}GetTrianglesUInt32Array(Ir,_r,dr){Mt(this.ptr,Ir.ptr,_r,dr)}GetAttributeDataArrayForAllPoints(Ir,_r,dr,En,pr){Bt(this.ptr,Ir.ptr,_r.ptr,dr,En,pr)}},DT_INT8:Yt(),DT_UINT8:wt(),DT_INT16:vt(),DT_UINT16:Ht(),DT_UINT32:rr(),DT_FLOAT32:Lt()}})}(fetch(JO())),C1.then(G=>{Zu=G,C1=void 0}))}()),O&&k.push(function(){if(zj)return;const G=function(W){let te;const se=WebAssembly.instantiateStreaming(W,{}).then(ve=>{te=ve.instance,te.exports.__wasm_call_ctors()}),oe={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ge={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:se,supported:!0,decodeGltfBuffer(ve,Te,$e,Fe,Ze,Ye){(function(Je,Tt,ot,Ct,Mt,Bt,ir){const Jt=Je.exports.sbrk,Ft=Ct+3&-4,Yt=Jt(Ft*Mt),wt=Jt(Bt.length),vt=new Uint8Array(Je.exports.memory.buffer);vt.set(Bt,wt);const Ht=Tt(Yt,Ct,Mt,wt,Bt.length);if(Ht===0&&ir&&ir(Yt,Ft,Mt),ot.set(vt.subarray(Yt,Yt+Ct*Mt)),Jt(Yt-Jt(0)),Ht!==0)throw new Error(`Malformed buffer data: ${Ht}`)})(te,te.exports[ge[Ze]],ve,Te,$e,Fe,te.exports[oe[Ye]])}}}(fetch(QO()));return G.ready.then(()=>{zj=G})}()),x)for(let G=0;G<x.length;G++)k.push(bZ(x[G],h,G,o));return(k.length?Promise.all(k):Promise.resolve()).then(()=>{if(P&&v)for(const{primitives:G}of v)for(const W of G)vZ(W,h);if(O&&v&&C)for(const G of C)yZ(G,h);return h})})}function aF(l){return fetch(l).then(n=>n.arrayBuffer()).then(n=>sF(n,0,l))}function Uj(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Vj(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class $j{constructor(n,o,h,p){this.context=n,this.format=h,this.useMipmap=p&&p.useMipmap,this.texture=n.gl.createTexture(),this.update(o,{premultiply:p&&p.premultiply})}update(n,o){const h=n&&n instanceof HTMLVideoElement&&n.width===0?n.videoWidth:n.width,p=n&&n instanceof HTMLVideoElement&&n.height===0?n.videoHeight:n.height,{context:x}=this,{gl:v}=x,{x:w,y:C}=o&&o.position?o.position:{x:0,y:0},A=w+h,k=C+p;!this.size||this.size[0]===A&&this.size[1]===k||(v.bindTexture(v.TEXTURE_2D,null),v.deleteTexture(this.texture),this.texture=v.createTexture(),this.size=null),v.bindTexture(v.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA8&&(!o||o.premultiply!==!1));const P=n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||ImageBitmap&&n instanceof ImageBitmap;if(!this.size&&A>0&&k>0){const O=this.useMipmap?Math.floor(Math.log2(Math.max(A,k)))+1:1;v.texStorage2D(v.TEXTURE_2D,O,this.format,A,k),this.size=[A,k]}this.size&&(P?v.texSubImage2D(v.TEXTURE_2D,0,w,C,Uj(this.format),Vj(this.format),n):"data"in n&&n.data&&v.texSubImage2D(v.TEXTURE_2D,0,w,C,h,p,Uj(this.format),Vj(this.format),n.data)),this.useMipmap&&v.generateMipmap(v.TEXTURE_2D)}bind(n,o,h=!1){const{context:p}=this,{gl:x}=p;x.bindTexture(x.TEXTURE_2D,this.texture),n!==this.minFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,n),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,this.useMipmap&&!h?n===x.NEAREST?x.NEAREST_MIPMAP_NEAREST:x.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),o!==this.wrapS&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,o),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,o),this.wrapS=o)}bindExtraParam(n,o,h,p,x){const{context:v}=this,{gl:w}=v;w.bindTexture(w.TEXTURE_2D,this.texture),o!==this.magFilter&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,o),this.magFilter=o),n!==this.minFilter&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,this.useMipmap?n===w.NEAREST?w.NEAREST_MIPMAP_NEAREST:w.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),h!==this.wrapS&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,h),this.wrapS=h),p!==this.wrapT&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,p),this.wrapT=p),x!==this.compareMode&&(x?(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_COMPARE_MODE,w.COMPARE_REF_TO_TEXTURE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_COMPARE_FUNC,x)):w.texParameteri(w.TEXTURE_2D,w.TEXTURE_COMPARE_MODE,w.NONE),this.compareMode=x)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}class j1{constructor(n,o){this.context=n,this.texture=o}bind(n,o){const{context:h}=this,{gl:p}=h;p.bindTexture(p.TEXTURE_2D,this.texture),n!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,n),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,n),this.minFilter=n),o!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,o),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,o),this.wrapS=o)}}const SZ=Kn([{name:"a_pos_3f",components:3,type:"Float32"}]),TZ=Kn([{name:"a_color_3f",components:3,type:"Float32"}]),EZ=Kn([{name:"a_color_4f",components:4,type:"Float32"}]),CZ=Kn([{name:"a_uv_2f",components:2,type:"Float32"}]),AZ=Kn([{name:"a_normal_3f",components:3,type:"Float32"}]),jZ=Kn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),IZ=Kn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function oF(l,n){const o=vS(l.projection,l.zoom,l.width,l.height),h=function(x,v,w,C,A){const k=new X(w.lng-180*pp,w.lat),P=new X(w.lng+180*pp,w.lat),O=x.project(k.lng,k.lat),G=x.project(P.lng,P.lat),W=-Math.atan2(G.y-O.y,G.x-O.x),te=st.fromLngLat(w);te.y=K(te.y,-1+pp,1-pp);const se=te.toLngLat(),oe=x.project(se.lng,se.lat),ge=st.fromLngLat(se);ge.x+=pp;const ve=ge.toLngLat(),Te=x.project(ve.lng,ve.lat),$e=cF(Te.x-oe.x,Te.y-oe.y,W),Fe=st.fromLngLat(se);Fe.y+=pp;const Ze=Fe.toLngLat(),Ye=x.project(Ze.lng,Ze.lat),Je=cF(Ye.x-oe.x,Ye.y-oe.y,W),Tt=Math.abs($e.x)/Math.abs(Je.y),ot=U([]);ye(ot,ot,-W*(1-(A?0:C)));const Ct=U([]);return ne(Ct,Ct,[1,1-(1-Tt)*C,1]),Ct[4]=-Je.x/Je.y*C,ye(Ct,Ct,W),z(Ct,ot,Ct),Ct}(l.projection,0,l.center,o,n),p=lF(l);return ne(h,h,[p,p,1]),h}function lF(l){const n=l.projection,o=vS(l.projection,l.zoom,l.width,l.height),h=qj(n,l.center),p=qj(n,X.convert(n.center));return Math.pow(2,h*o+(1-o)*p)}function vS(l,n,o,h,p=1/0){const x=l.range;if(!x)return 0;const v=Math.min(p,Math.max(o,h)),w=Math.log2(v/1024);return ie(x[0]+w,x[1]+w,n)}const pp=1/4e4;function qj(l,n){const o=K(n.lat,-Ne,Ne),h=new X(n.lng-180*pp,o),p=new X(n.lng+180*pp,o),x=l.project(h.lng,o),v=l.project(p.lng,o),w=st.fromLngLat(h),C=st.fromLngLat(p),A=v.x-x.x,k=v.y-x.y,P=C.x-w.x,O=C.y-w.y,G=Math.sqrt((P*P+O*O)/(A*A+k*k));return Math.log2(G)}function cF(l,n,o){const h=Math.cos(o),p=Math.sin(o);return{x:l*h-n*p,y:l*p+n*h}}function uF(l,n,o){U(l),ye(l,l,lt(n[2])),me(l,l,lt(n[0])),le(l,l,lt(n[1])),ne(l,l,o),z(l,l,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function yS(l,n,o,h,p,x,v,w){const C=[o[0]-n[0],o[1]-n[1],0],A=[h[0]-n[0],h[1]-n[1],0];if(gt(C)<1e-12||gt(A)<1e-12)return Kr(l);const k=jr([],C,A);zt(k,k),mt(A,h,n),C[2]=(x-p)*w,A[2]=(v-p)*w;const P=C;return jr(P,C,A),zt(P,P),ms(l,k,P)}function wS(l,n,o=!1){const h=dp(n.zoom),p=function(x,v,w){const C=v.worldSize,A=[x[12],x[13],x[14]],k=we(A[1]/C),P=je(A[0]/C),O=U([]),G=xe(1,k)*C,W=xe(1,0)*C*Be(k,v.zoom),te=1/vj(C);let se=W*te;if(w){const Te=vS(v.projection,v.zoom,v.width,v.height,1024);se=te*v.projection.pixelSpaceConversion(v.center.lat,C,Te)}const oe=N(k,P);Me(oe,oe,he([],zt([],oe),G*se*A[2]));const ge=function(Te){const $e=[Te[0],Te[1],Te[2]];let Fe=[0,1,0];const Ze=jr([],Fe,$e);return jr(Fe,$e,Ze),dt(Fe)===0&&(Fe=[0,1,0],jr(Ze,$e,Fe)),zt(Ze,Ze),zt(Fe,Fe),zt($e,$e),[Ze[0],Ze[1],Ze[2],0,Fe[0],Fe[1],Fe[2],0,$e[0],$e[1],$e[2],0,Te[0],Te[1],Te[2],1]}(oe);ne(O,O,[se,se,se*G]),J(O,O,[-A[0],-A[1],-A[2]]);const ve=z([],v.globeMatrix,ge);return z(ve,ve,O),z(ve,ve,x),ve}(l,n,o);if(h>0){const x=function(v,w){const C=w.worldSize,A=xe(1,0)*C*Be(w.center.lat,w.zoom)/vj(C),k=xe(1,w.center.lat)*C,P=U([]);le(P,P,lt(w.center.lng)),me(P,P,lt(w.center.lat)),J(P,P,[0,0,rl]),ne(P,P,[A,A,A*k]);const O=w.point;return J(P,P,[-O.x,-O.y,0]),z(P,P,v),z(P,w.globeMatrix,P)}(l,n);return function(v,w,C){const A=(W,te,se)=>{const oe=gt(W),ge=gt(te),ve=Lh(W,te,se);return he(ve,ve,1/gt(ve)*fn(oe,ge,se))},k=A([v[0],v[1],v[2]],[w[0],w[1],w[2]],C),P=A([v[4],v[5],v[6]],[w[4],w[5],w[6]],C),O=A([v[8],v[9],v[10]],[w[8],w[9],w[10]],C),G=Lh([v[12],v[13],v[14]],[w[12],w[13],w[14]],C);return[k[0],k[1],k[2],0,P[0],P[1],P[2],0,O[0],O[1],O[2],0,G[0],G[1],G[2],1]}(p,x,h)}return p}function Gj(l,n,o,h){const p=qn.projectAabbCorners(h,o);let x=Number.MAX_VALUE;for(let w=0;w<p.length;++w){const C=p[w];C[0]=(.5*C[0]+.5)*n.width,C[1]=(.5-.5*C[1])*n.height,C[2]<x&&(x=C[2])}const v=function(w){const C=[];let A=0;for(let G=1;G<w.length;G++)(w[G][0]<w[A][0]||w[G][0]===w[A][0]&&w[G][1]<w[A][1])&&(A=G);let k,P=A;const O=new Uint8Array(w.length);do{if(O[P])break;C.push(new At(w[P][0],w[P][1])),O[P]=1,k=(P+1)%w.length;for(let G=0;G<w.length;G++){if(w[G][0]===w[k][0]&&w[G][1]===w[k][1]||w[G][0]===w[P][0]&&w[G][1]===w[P][1])continue;const W=[w[G][0]-w[P][0],w[G][1]-w[P][1]],te=[w[k][0]-w[P][0],w[k][1]-w[P][1]],se=W[0]*te[1]-W[1]*te[0];(se>0||se===0&&W[0]*te[0]+W[1]*te[1]>=0&&W[0]*W[0]+W[1]*W[1]>te[0]*te[0]+te[1]*te[1])&&(k=G)}P=k}while(P!==A);return C.length>0&&C.push(C[0]),C}(p);if(ra(l,v))return x}const Tg=64,q0={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function bS(l,n,o,h,p,x,v,w,C,A=!1){const k=o.zoom,P=o.project(h),O=Be(h.lat,k),G=1/O;U(l),J(l,l,[P.x+v[0]*G,P.y+v[1]*G,v[2]]);let W=1,te=1;const se=o.worldSize;if(A){if(o.projection.name==="mercator"){let Te=0;o.elevation&&(Te=o.elevation.getAtPointOrZero(new st(P.x/se,P.y/se),0));const $e=Sr([],[P.x,P.y,Te,1],o.projMatrix)[3]/o.cameraToCenterDistance;W=$e,te=$e*Be(o.center.lat,k)}else if(o.projection.name==="globe"){const Te=wS(l,o),$e=[0,0,0,1];Sr($e,$e,z([],o.projMatrix,Te));const Fe=$e[3]/o.cameraToCenterDistance,Ze=dp(k),Ye=o.projection.pixelsPerMeter(h.lat,se)*Be(h.lat,k),Je=o.projection.pixelsPerMeter(o.center.lat,se)*Be(o.center.lat,k);W=Fe/fn(Ye,Ge(o.center.lat),Ze),te=Fe*O/Ye,W*=Je,te*=Je}}else W=G;ne(l,l,[W,W,te]);const oe=[...l],ge=n.orientation,ve=[];if(uF(ve,[ge[0]+(p?p[0]:0),ge[1]+(p?p[1]:0),ge[2]+(p?p[2]:0)],x),z(l,oe,ve),w&&o.elevation){let Te=0;const $e=[];if(C&&o.elevation){Te=function(Ze,Ye,Je,Tt,ot){const Ct=Ye.elevation;if(!Ct)return 0;const Mt=qn.projectAabbCorners(Je,Tt),Bt=xe(1,ot.lat)*Ye.worldSize,ir=function(_r,dr){const En=[0,0,1],pr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Qr of pr){const jn=_r[Qr.corners[0]],Gn=_r[Qr.corners[1]],mi=_r[Qr.corners[2]],Pn=[Gn[0]-jn[0],Gn[1]-jn[1],dr*(Gn[2]-jn[2])],Ei=jr(Pn,Pn,[mi[0]-jn[0],mi[1]-jn[1],dr*(mi[2]-jn[2])]);zt(Ei,Ei),Qr.dotProductWithUp=Gt(Ei,En)}return pr.sort((Qr,jn)=>Qr.dotProductWithUp-jn.dotProductWithUp),pr[0].corners}(Mt,Bt),Jt=Mt[ir[0]],Ft=Mt[ir[1]],Yt=Mt[ir[2]],wt=Mt[ir[3]],vt=Ct.getAtPointOrZero(new st(Jt[0]/Ye.worldSize,Jt[1]/Ye.worldSize),0),Ht=Ct.getAtPointOrZero(new st(Ft[0]/Ye.worldSize,Ft[1]/Ye.worldSize),0),rr=Ct.getAtPointOrZero(new st(Yt[0]/Ye.worldSize,Yt[1]/Ye.worldSize),0),Lt=Ct.getAtPointOrZero(new st(wt[0]/Ye.worldSize,wt[1]/Ye.worldSize),0),br=(vt+Lt)/2,Ir=(Ht+rr)/2;return br>Ir?Ht<rr?yS(Ze,Ft,wt,Jt,Ht,Lt,vt,Bt):yS(Ze,Yt,Jt,wt,rr,vt,Lt,Bt):vt<Lt?yS(Ze,Jt,Ft,Yt,vt,Ht,rr,Bt):yS(Ze,wt,Yt,Ft,Lt,rr,Ht,Bt),Math.max(br,Ir)}($e,o,n.aabb,l,h);const Fe=z([],Oe([],$e),ve);z(l,oe,Fe)}else Te=o.elevation.getAtPointOrZero(new st(P.x/se,P.y/se),0);Te!==0&&(l[14]+=Te)}}class dF{constructor(n,o,h,p,x){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=n,this.uri=o,this.position=h!=null?new X(h[0],h[1]):new X(0,0),this.orientation=p??[0,0,0],this.nodes=x,this.uploaded=!1,this.aabb=new qn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(n,o){z(n.globalMatrix,o,n.localMatrix);const h=this.nodeOverrides.get(n.name);if(h!==void 0){const v=[];x=h.orientation,U(p=v),le(p,p,lt(x[1])),ye(p,p,lt(x[2])),me(p,p,lt(x[0])),z(n.globalMatrix,n.globalMatrix,v)}var p,x;if(n.meshes)for(const v of n.meshes){const w=qn.applyTransformFast(v.aabb,n.globalMatrix);this.aabb.encapsulate(w)}if(n.children)for(const v of n.children)this._applyTransformations(v,n.globalMatrix)}computeBoundsAndApplyParent(){const n=U([]);this.aabb=new qn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const o of this.nodes)this._applyTransformations(o,n)}computeModelMatrix(n,o,h,p,x,v,w=!1){bS(this.matrix,this,n.transform,this.position,o,h,p,x,v,w)}upload(n){if(!this.uploaded){for(const o of this.nodes)Wj(o,n);for(const o of this.nodes)SS(o);this.uploaded=!0}}destroy(){for(const n of this.nodes)Hj(n)}}function I1(l,n,o=!1){l.uploaded||(l.gfxTexture=new $j(n,l.image,o?n.gl.R8:n.gl.RGBA8,{useMipmap:l.sampler.minFilter>=n.gl.NEAREST_MIPMAP_NEAREST}),l.uploaded=!0,l.image=null)}function NZ(l,n,o){l.indexBuffer=n.createIndexBuffer(l.indexArray,!1,!0),l.vertexBuffer=n.createVertexBuffer(l.vertexArray,SZ.members,!1,!0),l.normalArray&&(l.normalBuffer=n.createVertexBuffer(l.normalArray,AZ.members,!1,!0)),l.texcoordArray&&(l.texcoordBuffer=n.createVertexBuffer(l.texcoordArray,CZ.members,!1,!0)),l.colorArray&&(l.colorBuffer=n.createVertexBuffer(l.colorArray,(l.colorArray.bytesPerElement===12?TZ:EZ).members,!1,!0)),l.featureArray&&(l.pbrBuffer=n.createVertexBuffer(l.featureArray,IZ.members,!0)),l.segments=Fs.simpleSegment(0,0,l.vertexArray.length,l.indexArray.length);const h=l.material;h.pbrMetallicRoughness.baseColorTexture&&I1(h.pbrMetallicRoughness.baseColorTexture,n),h.pbrMetallicRoughness.metallicRoughnessTexture&&I1(h.pbrMetallicRoughness.metallicRoughnessTexture,n),h.normalTexture&&I1(h.normalTexture,n),h.occlusionTexture&&I1(h.occlusionTexture,n,o),h.emissionTexture&&I1(h.emissionTexture,n)}function Wj(l,n,o){if(l.meshes)for(const h of l.meshes)NZ(h,n,o);if(l.children)for(const h of l.children)Wj(h,n,o)}function SS(l){if(l.meshes)for(const n of l.meshes)n.indexArray.destroy(),n.vertexArray.destroy(),n.colorArray&&n.colorArray.destroy(),n.normalArray&&n.normalArray.destroy(),n.texcoordArray&&n.texcoordArray.destroy(),n.featureArray&&n.featureArray.destroy();if(l.children)for(const n of l.children)SS(n)}function Hj(l){if(l.meshes)for(const o of l.meshes)o.vertexBuffer&&(o.vertexBuffer.destroy(),o.indexBuffer.destroy(),o.normalBuffer&&o.normalBuffer.destroy(),o.texcoordBuffer&&o.texcoordBuffer.destroy(),o.colorBuffer&&o.colorBuffer.destroy(),o.pbrBuffer&&o.pbrBuffer.destroy(),o.segments.destroy(),o.material&&((n=o.material).pbrMetallicRoughness.baseColorTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),n.pbrMetallicRoughness.metallicRoughnessTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),n.normalTexture&&n.normalTexture.gfxTexture&&n.normalTexture.gfxTexture.destroy(),n.emissionTexture&&n.emissionTexture.gfxTexture&&n.emissionTexture.gfxTexture.destroy(),n.occlusionTexture&&n.occlusionTexture.gfxTexture&&n.occlusionTexture.gfxTexture.destroy()));var n;if(l.children)for(const o of l.children)Hj(o)}function Eg(l,n){const o=l.json.bufferViews[n.bufferView],h=_S[n.componentType];return new h(l.buffers[o.buffer],(n.byteOffset||0)+(o.byteOffset||0),n.count*(o.byteStride&&o.byteStride!==A1[n.type]*h.BYTES_PER_ELEMENT?o.byteStride/h.BYTES_PER_ELEMENT:A1[n.type]))}function Zj(l,n,o,h){const p=_S[n.componentType],x=function(k){switch(k){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(p),v=l.json.bufferViews[n.bufferView],w=v.byteStride?v.byteStride/p.BYTES_PER_ELEMENT:A1[n.type],C=o.float32,A=C.length/o.capacity;for(let k=0,P=0;k<n.count*w;k+=w,P+=A)for(let O=0;O<A;O++)C[P+O]=h[k+O]*x;o._trim()}function kZ(l,n,o){const h=l.indices,p=l.attributes,x={};x.indexArray=new bs;const v=n.json.accessors[h],w=v.count/3;x.indexArray.reserve(w);const C=Eg(n,v);for(let O=0;O<w;O++)x.indexArray.emplaceBack(C[3*O],C[3*O+1],C[3*O+2]);x.indexArray._trim(),x.vertexArray=new Pl;const A=n.json.accessors[p.POSITION];x.vertexArray.reserve(A.count);const k=Eg(n,A);for(let O=0;O<A.count;O++)x.vertexArray.emplaceBack(k[3*O],k[3*O+1],k[3*O+2]);if(x.vertexArray._trim(),x.aabb=new qn(A.min,A.max),x.centroid=function(O,G){const W=[0,0,0],te=O.length;if(te>0){for(let se=0;se<te;se++){const oe=3*O[se];W[0]+=G[oe],W[1]+=G[oe+1],W[2]+=G[oe+2]}W[0]/=te,W[1]/=te,W[2]/=te}return W}(C,k),p.COLOR_0!==void 0){const O=n.json.accessors[p.COLOR_0],G=A1[O.type],W=Eg(n,O);x.colorArray=G===3?new Pl:new Vd,x.colorArray.resize(O.count),Zj(n,O,x.colorArray,W)}if(p.NORMAL!==void 0){x.normalArray=new Pl;const O=n.json.accessors[p.NORMAL];x.normalArray.resize(O.count);const G=Eg(n,O);Zj(n,O,x.normalArray,G)}if(p.TEXCOORD_0!==void 0&&o.length>0){x.texcoordArray=new $d;const O=n.json.accessors[p.TEXCOORD_0];x.texcoordArray.resize(O.count);const G=Eg(n,O);Zj(n,O,x.texcoordArray,G)}if(p._FEATURE_ID_RGBA4444!==void 0){const O=n.json.accessors[p._FEATURE_ID_RGBA4444];n.json.extensionsUsed&&n.json.extensionsUsed.includes("EXT_meshopt_compression")&&(x.featureData=Eg(n,O))}p._FEATURE_RGBA4444!==void 0&&(x.featureData=new Uint32Array(Eg(n,n.json.accessors[p._FEATURE_RGBA4444]).buffer));const P=l.material;return x.material=function(O,G){const{emissiveFactor:W=[0,0,0],alphaMode:te="OPAQUE",alphaCutoff:se=.5,normalTexture:oe,occlusionTexture:ge,emissiveTexture:ve,doubleSided:Te,name:$e}=O,{baseColorFactor:Fe=[1,1,1,1],metallicFactor:Ze=1,roughnessFactor:Ye=1,baseColorTexture:Je,metallicRoughnessTexture:Tt}=O.pbrMetallicRoughness||{},ot=ge?G[ge.index]:void 0;if(ge&&ge.extensions&&ge.extensions.KHR_texture_transform&&ot){const Ct=ge.extensions.KHR_texture_transform;ot.offsetScale=[Ct.offset[0],Ct.offset[1],Ct.scale[0],Ct.scale[1]]}return{name:$e,pbrMetallicRoughness:{baseColorFactor:new Li(...Fe),metallicFactor:Ze,roughnessFactor:Ye,baseColorTexture:Je?G[Je.index]:void 0,metallicRoughnessTexture:Tt?G[Tt.index]:void 0},doubleSided:Te,emissiveFactor:new Li(...W),alphaMode:te,alphaCutoff:se,normalTexture:oe?G[oe.index]:void 0,occlusionTexture:ot,emissionTexture:ve?G[ve.index]:void 0,defined:O.defined===void 0}}(P!==void 0?n.json.materials[P]:{defined:!1},o),x}function hF(l,n,o){const{matrix:h,rotation:p,translation:x,scale:v,mesh:w,extras:C,children:A,name:k}=l,P={};if(P.name=k,P.localMatrix=h||function(O,G,W,te){var se=G[0],oe=G[1],ge=G[2],ve=G[3],Te=se+se,$e=oe+oe,Fe=ge+ge,Ze=se*Te,Ye=se*$e,Je=se*Fe,Tt=oe*$e,ot=oe*Fe,Ct=ge*Fe,Mt=ve*Te,Bt=ve*$e,ir=ve*Fe,Jt=te[0],Ft=te[1],Yt=te[2];return O[0]=(1-(Tt+Ct))*Jt,O[1]=(Ye+ir)*Jt,O[2]=(Je-Bt)*Jt,O[3]=0,O[4]=(Ye-ir)*Ft,O[5]=(1-(Ze+Ct))*Ft,O[6]=(ot+Mt)*Ft,O[7]=0,O[8]=(Je+Bt)*Yt,O[9]=(ot-Mt)*Yt,O[10]=(1-(Ze+Tt))*Yt,O[11]=0,O[12]=W[0],O[13]=W[1],O[14]=W[2],O[15]=1,O}([],p||[0,0,0,1],x||[0,0,0],v||[1,1,1]),P.globalMatrix=F(P.localMatrix),w!==void 0){P.meshes=o[w];const O=P.anchor=[0,0];for(const G of P.meshes){const{min:W,max:te}=G.aabb;O[0]+=W[0]+te[0],O[1]+=W[1]+te[1]}O[0]=Math.floor(O[0]/P.meshes.length/2),O[1]=Math.floor(O[1]/P.meshes.length/2)}if(C&&(C.id&&(P.id=C.id),C.lights&&(P.lights=function(O){if(!O.length)return[];const G=function(ge){const ve=atob(ge),Te=new Uint8Array(ve.length);for(let $e=0;$e<ve.length;$e++)Te[$e]=ve.codePointAt($e);return Te}(O),W=[],te=G.length/24,se=new Uint16Array(G.buffer),oe=new Float32Array(G.buffer);for(let ge=0;ge<te;ge++){const ve=se[2*ge*6]/30,Te=se[2*ge*6+1]/30,$e=se[2*ge*6+10]/100,Fe=oe[6*ge+1],Ze=oe[6*ge+2],Ye=oe[6*ge+3],Je=oe[6*ge+4],Tt=Ye-Fe,ot=Je-Ze,Ct=Math.hypot(Tt,ot);W.push({pos:[Fe+.5*Tt,Ze+.5*ot,Te],normal:[ot/Ct,-Tt/Ct,0],width:Ct,height:ve,depth:$e,points:[Fe,Ze,Ye,Je]})}return W}(C.lights)),C.MAPBOX_geometry_bloom&&(P.isGeometryBloom=C.MAPBOX_geometry_bloom)),A){const O=[];for(const G of A)O.push(hF(n.json.nodes[G],n,o));P.children=O}return P}function PZ(l){if(l.vertices.length===0||l.indices.length===0)return null;const n=new cS(l.vertices,l.indices,8,256),[o,h]=[n.min.clone(),n.max.clone()];return{vertices:l.vertices,indices:l.indices,grid:n,min:o,max:h}}function DZ(l){if(!l.extras||!l.extras.ground)return null;const n=l.extras.ground;if(!n||!Array.isArray(n)||n.length===0)return null;const o=n[0];if(!o||!Array.isArray(o)||o.length===0)return null;const h=[];for(const v of o){if(!Array.isArray(v)||v.length!==2)continue;const w=v[0],C=v[1];typeof w=="number"&&typeof C=="number"&&h.push(new At(w,C))}if(h.length<3)return null;h.length>1&&h[h.length-1].equals(h[0])&&h.pop();let p=0;for(let v=0;v<h.length;v++){const w=h[v],C=h[(v+1)%h.length],A=h[(v+2)%h.length];p+=(w.x-C.x)*(A.y-C.y)-(A.x-C.x)*(w.y-C.y)}p>0&&h.reverse();const x=L0(h.flatMap(v=>[v.x,v.y]),[]);return x.length===0?null:{vertices:h,indices:x}}function RZ(l,n){const o=[],h=[];let p=0;const x=[];for(const v of l){p=o.length;const w=v.vertexArray.float32,C=v.indexArray.uint16;for(let A=0;A<v.vertexArray.length;A++)x[0]=w[3*A+0],x[1]=w[3*A+1],x[2]=w[3*A+2],nn(x,x,n),o.push(new At(x[0],x[1]));for(let A=0;A<3*v.indexArray.length;A++)h.push(C[A]+p)}if(h.length%3!=0)return null;for(let v=0;v<h.length;v+=3){const w=o[h[v+0]],C=o[h[v+1]],A=o[h[v+2]];(w.x-C.x)*(A.y-C.y)-(A.x-C.x)*(w.y-C.y)>0&&([h[v+1],h[v+2]]=[h[v+2],h[v+1]])}return{vertices:o,indices:h}}function Xj(l){const n=function(C,A){const k=[],P=WebGL2RenderingContext;if(C.json.textures)for(const O of C.json.textures){const G={magFilter:P.LINEAR,minFilter:P.NEAREST,wrapS:P.REPEAT,wrapT:P.REPEAT};O.sampler!==void 0&&Object.assign(G,C.json.samplers[O.sampler]),k.push({image:A[O.source],sampler:G,uploaded:!1})}return k}(l,l.images),o=function(C,A){const k=[];for(const P of C.json.meshes){const O=[];for(const G of P.primitives)O.push(kZ(G,C,A));k.push(O)}return k}(l,n),{scenes:h,scene:p,nodes:x}=l.json,v=h?h[p||0].nodes:[...x.keys()],w=[];for(const C of v)w.push(hF(x[C],l,o));return function(C,A,k){const P={},O=new Set;for(let G=0;G<C.length;G++){const W=k[A[G]];if(!W.extras)continue;const te=W.extras["mapbox:footprint:version"],se=W.extras["mapbox:footprint:id"];(te||se)&&O.add(G),te==="1.0.0"&&se&&(P[se]=G)}for(let G=0;G<C.length;G++){if(O.has(G))continue;const W=C[G],te=k[A[G]];if(!te.extras)continue;let se=null;W.id in P&&(se=RZ(C[P[W.id]].meshes,W.localMatrix)),se||(se=DZ(te)),se&&(W.footprint=PZ(se))}if(O.size>0){const G=Array.from(O.values()).sort((W,te)=>W-te);for(let W=G.length-1;W>=0;W--)C.splice(G[W],1)}}(w,v,l.json.nodes),w}function MZ(l){l.heightmap=new Float32Array(4096),l.heightmap.fill(-1);const n=l.vertexArray.float32,o=l.aabb.min[0]-1,h=l.aabb.min[1]-1,p=Tg/(l.aabb.max[0]-o+2),x=Tg/(l.aabb.max[1]-h+2);for(let v=0;v<n.length;v+=3){const w=n[v+2],C=(n[v+0]-o)*p|0,A=(n[v+1]-h)*x|0;w>l.heightmap[A*Tg+C]&&(l.heightmap[A*Tg+C]=w)}}function fF(l,n,o,h,p){o.reserve(o.length+4*l.length),h.reserve(h.length+10*l.length),p.reserve(p.length+10*l.length);let x=h.length;for(const v of l){const w=Math.min(10,Math.max(4,1.3*v.height))*n,C=[-v.normal[1],v.normal[0],0],A=Math.min(.29,.1*v.width/v.depth),k=v.width-2*v.depth*n*(A+.01),P=Se([],v.pos,C,k/2),O=Se([],v.pos,C,-k/2),G=[P[0],P[1],P[2]+v.height],W=[O[0],O[1],O[2]+v.height],te=Se([],v.normal,C,A);he(te,te,w);const se=Se([],v.normal,C,-A);he(se,se,w),Me(te,P,te),Me(se,O,se),P[2]+=.1,O[2]+=.1,h.emplaceBack(te[0],te[1],te[2]),h.emplaceBack(se[0],se[1],se[2]),h.emplaceBack(P[0],P[1],P[2]),h.emplaceBack(O[0],O[1],O[2]),h.emplaceBack(G[0],G[1],G[2]),h.emplaceBack(W[0],W[1],W[2]),h.emplaceBack(P[0],P[1],P[2]),h.emplaceBack(O[0],O[1],O[2]),h.emplaceBack(te[0],te[1],te[2]),h.emplaceBack(se[0],se[1],se[2]);const oe=k/w/2;p.emplaceBack(-oe-A,-1,oe,.8),p.emplaceBack(oe+A,-1,oe,.8),p.emplaceBack(-oe,0,oe,1.3),p.emplaceBack(oe,0,oe,1.3),p.emplaceBack(oe+A,-.8,oe,.7),p.emplaceBack(oe+A,-.8,oe,.7),p.emplaceBack(0,0,oe,1.3),p.emplaceBack(0,0,oe,1.3),p.emplaceBack(oe+A,-1.2,oe,.8),p.emplaceBack(oe+A,-1.2,oe,.8),o.emplaceBack(6+x,4+x,8+x),o.emplaceBack(7+x,9+x,5+x),o.emplaceBack(0+x,1+x,2+x),o.emplaceBack(1+x,3+x,2+x),x+=10}}function OZ(l,n){const o={};o.indexArray=new bs,o.vertexArray=new Pl,o.colorArray=new Vd,fF(l,n,o.indexArray,o.vertexArray,o.colorArray);const h={defined:!0};h.emissiveFactor=Li.black;const p={};return p.baseColorFactor=Li.white,h.pbrMetallicRoughness=p,o.material=h,o.aabb=new qn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),o}const pF=Kn([{name:"a_pos_3f",components:3,type:"Float32"}]),FZ=Kn([{name:"a_normal_3",components:3,type:"Int16"}]),LZ=Kn([{name:"a_centroid_3",components:3,type:"Int16"}]),mF=Kn([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),zZ=Kn([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),BZ=Kn([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),UZ=Kn([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),VZ=Kn([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),$Z=Kn([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),gF=qt.types,TS=32767;function qZ(l,n){const o=ar+n;for(const h of l)for(const p of h)if(p.x<-n||p.x>o||p.y<-n||p.y>o)return!1;return!0}class _F{constructor(){this.layoutVertexArray=new Pl,this.layoutAttenuationArray=new Vd,this.layoutColorArray=new uc,this.indexArray=new bs,this.indexArrayForConflation=new bs,this.segmentsBucket=new Fs}}class Yj{constructor(){this.layoutVertexArray=new Pl,this.layoutNormalArray=new Rh,this.layoutCentroidArray=new Rh,this.layoutColorArray=new uc,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutFloodLightDataArray=new j0,this.layoutAOArray=new qu,this.indexArray=new bs,this.indexArrayForConflation=new bs,this.segmentsBucket=new Fs,this.entranceBloom=new _F}}class xF{constructor(n){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new Yj,this.buildingWithFacade=new Yj,this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.footprintLookup={},this.zoom=n.zoom,this.canonical=n.canonical,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.hasPattern=!1,this.worldview=n.worldview,this.lut=n.lut,this.buildingWithFacade.layoutFacadePaintArray=new uc,this.buildingWithFacade.layoutFacadeDataArray=new Mh,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new uc,this.programConfigurations=new Rc(n.layers,{zoom:n.zoom,lut:n.lut}),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.projection=n.projection,this.groundEffect=new Rj(n),this.groundEffect.groundRadiusArray=new qu,this.hasAppearances=null}updateFootprints(n,o){for(const h of this.footprints)o.push({footprint:h,id:n})}updateAppearances(n,o,h,p){}prepare(){return function(){if(gS!=null||KO!=null)return null;if($0!=null)return $0;const n=fetch(cs.BUILDING_GEN_URL);return $0=function(o){let h,p,x,v;function w(){h=new Uint8Array(v.buffer),p=new Int32Array(v.buffer),x=new Float32Array(v.buffer)}function C(){throw new Error("Unexpected BuildingGen error.")}const A=()=>{},k={a:{a:C,f:function(P){const O=h.length,G=Math.max(P>>>0,Math.ceil(1.2*O)),W=Math.ceil((G-O)/65536);try{return v.grow(W),w(),!0}catch{return!1}},g:C,b:A,c:A,d:A,e:A}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(o,k):o.then(P=>P.arrayBuffer()).then(P=>WebAssembly.instantiate(P,k))).then(P=>{const O=P.instance.exports;return(0,O.g)(),v=O.f,w(),new gZ({setStyle:O.h,setAOOptions:O.i,setMetricOptions:O.j,setStructuralOptions:O.k,setFacadeOptions:O.l,setFauxFacadeOptions:O.m,setFacadeClassifierOptions:O.n,addFeature:O.o,addFacade:O.p,generateMesh:O.q,getLastError:O.r,getOuterRingLength:O.s,getMeshCount:O.t,getPositionsPtr:O.u,getPositionsLength:O.v,getNormalsPtr:O.w,getNormalsLength:O.x,getColorsPtr:O.y,getColorsLength:O.z,getAOPtr:O.A,getAOLength:O.B,getUVPtr:O.C,getUVLength:O.D,getFauxFacadePtr:O.E,getFauxFacadeLength:O.F,getIndicesPtr:O.G,getIndicesLength:O.H,getBuildingPart:O.I,getRingCount:O.J,getRingPtr:O.K,getRingLength:O.L,free:O.M,malloc:O.N,heapU8:h,heap32:p,heapF32:x})})}(n).then(o=>($0=null,gS=o,gS)).catch(o=>{ur("Could not load building-gen"),$0=null,KO=o}),$0}()}populate(n,o,h,p){const x=_Z();if(!x)return;const v=We(h);this.tileToMeter=v,this.brightness=o.brightness,x.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,v],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:v,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),x.setAOOptions(!1,.3),x.setMetricOptions(!1,16),x.setStructuralOptions(!0),x.setFacadeClassifierOptions(3);const w=new Map,C=new Map;for(const{feature:A}of n){if(gF[A.type]!=="LineString"){w.set(A.id,A.properties.source_id);continue}const k=this.layers[0]._featureFilter.needGeometry,P=xt(A,k);if(!this.layers[0]._featureFilter.filter(new us(this.zoom),P,h))continue;const O=k?P.geometry:Pt(A,h,p),G=[];for(const oe of O)for(const ge of oe)G.push({x:ge.x,y:ge.y});const W={coordinates:G,crossPerc:A.properties.cross_perc,distanceToRoad:A.properties.distance_to_road,entrances:A.properties.entrances,sourceId:0},te=A.properties.source_id;let se=C.get(te);se||(se=[],C.set(te,se)),se.push(W)}this.maxHeight=0;for(const{feature:A,id:k,index:P,sourceLayerIndex:O}of n){if(gF[A.type]==="LineString")continue;const G=this.layers[0]._featureFilter.needGeometry,W=xt(A,G);if(!this.layers[0]._featureFilter.filter(new us(this.zoom),W,h))continue;const te=G?W.geometry:Pt(A,h,p),se=x1(te,500);if(!qZ(te,163))continue;const oe=this.layers[0],ge=oe.layout.get("building-roof-shape").evaluate(A,{},h);if(ge==="flat")continue;const ve=oe.layout.get("building-base").evaluate(A,{},h),Te=oe.layout.get("building-height").evaluate(A,{},h),$e=oe.layout.get("building-flood-light-ground-radius").evaluate(A,{},h),Fe=oe.paint.get("building-ambient-occlusion-intensity"),Ze=$e/this.tileToMeter;let Ye=oe.layout.get("building-flood-light-wall-radius").evaluate(A,{},h);Ye=K(Ye,0,2048);const Je=Ye/2048*TS,Tt=w.get(k);let ot;ot=C.has(Tt)?C.get(Tt):[];const Ct=ot.length!==0&&oe.layout.get("building-facade").evaluate(A,{},h);x.setFacadeOptions(4,!0),x.setFauxFacadeOptions(Ct,!1,1);let Mt=0,Bt=0,ir=0,Jt=0,Ft=0,Yt=0;if(Ct){let It=Math.round(oe.layout.get("building-facade-floors").evaluate(A,{},h));if(ve===0){It=Math.max(1,It-(ot.length>0?1:0));let Br=4;if(Te>100){const Mr=[10,13,15];Br=Mr[A.id?A.id%Mr.length:0],x.setFacadeOptions(Br,!0)}Ft=1.6803*Br/v}else Ft=ve/v;Yt=Te/v,Ft=Math.min(Ft,Yt),ir=oe.layout.get("building-facade-unit-width").evaluate(A,{},h)/v,Jt=(Yt-Ft)/It,x.setFauxFacadeOptions(!0,!0,ir);const fr=oe.layout.get("building-facade-window").evaluate(A,{},h);Mt=fr[0],Bt=fr[1]}const wt=[],vt=new At(1/0,1/0),Ht=new At(-1/0,-1/0),rr=new At(0,0);let Lt=0;for(const It of se)if(It.length>0){const fr=[];for(const Br of It){const Mr=[];for(let Mn=Br.length-1;Mn>=0;Mn--){const cn=Br[Mn];Mr.push({x:cn.x,y:cn.y}),vt.x=Math.min(vt.x,cn.x),vt.y=Math.min(vt.y,cn.y),Ht.x=Math.max(Ht.x,cn.x),Ht.y=Math.max(Ht.y,cn.y),rr.x+=cn.x,rr.y+=cn.y,Lt++}fr.push(Mr)}wt.push({id:A.id?A.id:0,height:Te,minHeight:ve,sourceId:0,roofType:ge,coordinates:fr})}rr.x/=Lt||1,rr.y/=Lt||1;const br=x.generateMesh(wt,ot);if(typeof br=="string"){ur(`Unable to generate building ${A.id}: ${br}`);continue}if(br.meshes.length===0||br.modifiedPolygonRings.length===0)continue;let Ir=0;for(const It of br.meshes)Ir+=It.positions.length/3;const _r=Ct?this.buildingWithFacade:this.buildingWithoutFacade,dr=_r.segmentsBucket.prepareSegment(Ir,_r.layoutVertexArray,_r.indexArray),En=[];let pr=null,Qr=0,jn=-1;const Gn=_r.layoutVertexArray.length,mi=_r.indexArray.length;let Pn=0;for(const It of br.meshes){const fr=_r.layoutVertexArray.length;if(It.buildingPart==="entrance"){const Dr=new Array;for(let hi=0;hi<It.positions.length;hi+=12){const Ki=It.positions[hi+0],zi=It.positions[hi+1],qs=It.positions[hi+3],xs=It.positions[hi+4],ss=It.positions[hi+2],Hi=It.positions[hi+8]-ss,Ai=1,On=qs-Ki,ji=xs-zi,as=Math.hypot(On,ji);Dr.push({pos:[Ki+.5*On,zi+.5*ji,ss],normal:[ji/as,-On/as,0],width:as,height:Hi,depth:Ai,points:[Ki,zi,qs,xs]})}const Si=_r.entranceBloom.segmentsBucket.prepareSegment(10*Dr.length,_r.entranceBloom.layoutVertexArray,_r.entranceBloom.indexArray),Yi=_r.entranceBloom.layoutVertexArray.length;Qr=_r.entranceBloom.indexArray.length,fF(Dr,.5/this.tileToMeter,_r.entranceBloom.indexArray,_r.entranceBloom.layoutVertexArray,_r.entranceBloom.layoutAttenuationArray);const dn=_r.entranceBloom.layoutVertexArray.length-Yi;jn=_r.entranceBloom.indexArray.length-Qr;for(let hi=0;hi<dn;hi++)_r.entranceBloom.layoutColorArray.emplaceBack(65535,65535);Si.vertexLength+=dn,Si.primitiveLength+=jn,pr={part:It.buildingPart,vertexOffset:Yi,vertexLength:dn}}for(let Dr=0;Dr<It.positions.length;Dr+=3)Pn=Math.max(Pn,It.positions[Dr+2]),_r.layoutVertexArray.emplaceBack(It.positions[Dr],It.positions[Dr+1],It.positions[Dr+2]);const Br=Math.floor(rr.x),Mr=Math.floor(rr.y),Mn=Math.floor(Pn);for(let Dr=0;Dr<It.positions.length;Dr+=3)_r.layoutCentroidArray.emplaceBack(Br,Mr,Mn),_r.layoutFloodLightDataArray.emplaceBack(It.buildingPart==="wall"?Je:0);for(let Dr=0;Dr<It.normals.length;Dr+=3)_r.layoutNormalArray.emplaceBack(It.normals[Dr+0]*TS,It.normals[Dr+1]*TS,It.normals[Dr+2]*TS);for(let Dr=0;Dr<It.ao.length;Dr++)_r.layoutAOArray.emplaceBack(It.ao[Dr]);for(let Dr=0;Dr<It.colors.length;Dr+=3){const Si=1+(It.ao[Dr/3]-1)*Fe;_r.layoutColorArray.emplaceBack(It.colors[Dr]*Si<<8|It.colors[Dr+1]*Si,It.colors[Dr+2]*Si<<8)}if(Ct){for(let Dr=0;Dr<It.positions.length;Dr+=3)_r.layoutFacadePaintArray.emplaceBack(65535,255);for(let Dr=0;Dr<It.isFauxFacade.length;Dr++)if(It.isFauxFacade[Dr]){const Si=1|Math.min(65535,Math.floor(It.uv[2*Dr]*br.outerRingLength)),Yi=Math.floor(255*Mt)<<8|Math.floor(255*Bt),dn=Math.floor(65535*Math.min(1,ir/ar)),hi=Math.floor(65535*Math.min(1,Jt/ar));_r.layoutFacadeDataArray.emplaceBack(Si,Yi,dn,hi);const Ki=Math.floor(65535*Math.min(1,Ft/ar)),zi=Math.floor(65535*Math.min(1,Yt/ar));_r.layoutFacadeVerticalRangeArray.emplaceBack(Ki,zi)}else _r.layoutFacadeDataArray.emplaceBack(0,0,0,0),_r.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}const cn=dr.vertexLength;for(let Dr=0;Dr<It.indices.length;Dr+=3)_r.indexArray.emplaceBack(cn+It.indices[Dr],cn+It.indices[Dr+1],cn+It.indices[Dr+2]);dr.vertexLength+=It.positions.length/3,dr.primitiveLength+=It.indices.length/3,(It.buildingPart==="roof"||It.buildingPart==="wall"||It.buildingPart==="facade_glazing"||It.buildingPart==="entrance")&&En.push({part:It.buildingPart,vertexOffset:fr,vertexLength:It.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,Pn),this.buildingFeatures.push({promoteId:k,feature:W,hasFauxFacade:Ct,segment:dr,parts:En,buildingBloom:pr});const Ei=_r.indexArray.length-mi,Ci=[],As=[],Le=new At(1/0,1/0),Pe=new At(-1/0,-1/0),jt=this.groundEffect.vertexArray.length;for(const It of br.modifiedPolygonRings){const fr=[],Br=new At(1/0,1/0),Mr=new At(-1/0,-1/0);for(let Mn=0;Mn<It.length;Mn+=2){const cn=It.length-Mn-2;Br.x=Math.min(Br.x,It[cn]),Br.y=Math.min(Br.y,It[cn+1]),Mr.x=Math.max(Mr.x,It[cn]),Mr.y=Math.max(Mr.y,It[cn+1]);const Dr=new At(It[cn],It[cn+1]);fr.push(Dr),Ci.push(Dr.x,Dr.y),As.push(Dr.clone())}Le.x=Math.min(Le.x,Br.x),Le.y=Math.min(Le.y,Br.y),Pe.x=Math.max(Pe.x,Mr.x),Pe.y=Math.max(Pe.y,Mr.y),this.groundEffect.addData(fr,[Br,Mr],Ze)}const cr=this.groundEffect.vertexArray.length-jt;for(let It=0;It<cr;It++)this.groundEffect.groundRadiusArray.emplaceBack($e);(vt.x<0||Ht.x>ar||vt.y<0||Ht.y>ar)&&this.featuresOnBorder.push({featureId:A.id,footprintIndex:this.footprints.length});{const It=L0(Ci,null,2),fr=new cS(As,It,8,256);let Br=A.id;A.properties&&A.properties.hasOwnProperty("building_id")&&(Br=A.properties.building_id);const Mr={vertices:As,indices:It,grid:fr,min:Le,max:Pe,buildingId:Br,hiddenFlags:0,indicesOffset:mi,indicesLength:Ei,bloomIndicesOffset:Qr,bloomIndicesLength:jn,groundEffectVertexOffset:jt,groundEffectVertexLength:cr,hasFauxFacade:Ct,segment:dr,height:Pn};A.id!==void 0&&this.featureFootprintLookup.set(A.id,this.footprints.length),this.footprints.push(Mr)}this.programConfigurations.populatePaintArrays(_r.layoutVertexArray.length,A,P,{},o.availableImages,h,o.brightness),this.groundEffect.addPaintPropertiesData(A,P,{},o.availableImages,h,o.brightness),o.featureIndex.insert(A,te,P,O,this.index,Gn)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(n,o,h,p,x,v,w){this.programConfigurations.updatePaintArrays(n,o,x,h,p,v,w),this.groundEffect.update(n,o,x,h,p,v,w),this.evaluate(this.layers[0],n),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(n){const o=h=>{h.layoutVertexBuffer=n.createVertexBuffer(h.layoutVertexArray,pF.members),h.layoutNormalBuffer=n.createVertexBuffer(h.layoutNormalArray,FZ.members),h.layoutCentroidBuffer=n.createVertexBuffer(h.layoutCentroidArray,LZ.members),h.layoutFloodLightDataBuffer=n.createVertexBuffer(h.layoutFloodLightDataArray,$Z.members),h.layoutFacadeDataArray&&h.layoutFacadeDataArray.length&&(h.layoutFacadeDataBuffer=n.createVertexBuffer(h.layoutFacadeDataArray,BZ.members)),h.layoutFacadeVerticalRangeArray&&h.layoutFacadeVerticalRangeArray.length&&(h.layoutFacadeVerticalRangeBuffer=n.createVertexBuffer(h.layoutFacadeVerticalRangeArray,UZ.members)),h.entranceBloom.layoutVertexArray.length&&(h.entranceBloom.layoutVertexBuffer=n.createVertexBuffer(h.entranceBloom.layoutVertexArray,pF.members),h.entranceBloom.layoutAttenuationBuffer=n.createVertexBuffer(h.entranceBloom.layoutAttenuationArray,VZ.members)),this.uploadUpdatedColorBuffer(n),this.uploadUpdatedIndexBuffer(n)};this.uploaded||(o(this.buildingWithoutFacade),o(this.buildingWithFacade),this.groundEffect.upload(n)),this.groundEffect.uploadPaintProperties(n),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){const n=o=>{o.layoutVertexBuffer&&(o.layoutVertexBuffer.destroy(),o.layoutNormalBuffer.destroy(),o.layoutColorBuffer.destroy(),o.segmentsBucket.destroy(),o.indexBuffer&&o.indexBuffer.destroy(),o.entranceBloom.layoutVertexBuffer&&(o.entranceBloom.layoutVertexBuffer.destroy(),o.entranceBloom.layoutColorBuffer.destroy(),o.entranceBloom.layoutAttenuationBuffer.destroy(),o.entranceBloom.indexBuffer.destroy(),o.entranceBloom.segmentsBucket.destroy()))};n(this.buildingWithoutFacade),n(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(n,o,h=!0){let p=!1;const x=h?o:0,v=0|(h?-1:~o);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const w of n){const C=this.footprints[w],A=C.hiddenFlags&v|x;C.hiddenFlags!==A&&(C.hiddenFlags=A,p=!0,this.groundEffect.updateHiddenByLandmarkRange(C.groundEffectVertexOffset,C.groundEffectVertexLength,C.hiddenFlags!==0))}return p&&(this.indexArrayForConflationUploaded=!1),p}uploadUpdatedIndexBuffer(n){if(this.groundEffect.uploadHiddenByLandmark(n),this.indexArrayForConflationUploaded)return;const o=p=>{p.indexArray.length!==0&&(p.indexArrayForConflation.resize(p.indexArray.length),p.indexArrayForConflation.uint16.set(p.indexArray.uint16),p.entranceBloom.indexArrayForConflation.resize(p.entranceBloom.indexArray.length),p.entranceBloom.indexArrayForConflation.uint16.set(p.entranceBloom.indexArray.uint16))};o(this.buildingWithoutFacade),o(this.buildingWithFacade);for(const p of this.footprints){const x=p.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,v=p.indicesOffset+p.indicesLength;if(p.hiddenFlags!==0){for(let C=p.indicesOffset;C<v;C++)x.indexArrayForConflation.uint16[3*C+0]=0,x.indexArrayForConflation.uint16[3*C+1]=0,x.indexArrayForConflation.uint16[3*C+2]=0;const w=p.bloomIndicesOffset+p.bloomIndicesLength;for(let C=p.bloomIndicesOffset;C<w;C++)x.entranceBloom.indexArrayForConflation.uint16[3*C+0]=0,x.entranceBloom.indexArrayForConflation.uint16[3*C+1]=0,x.entranceBloom.indexArrayForConflation.uint16[3*C+2]=0}}const h=p=>{p.indexArray.length!==0&&(p.indexBuffer?p.indexBuffer.updateData(p.indexArrayForConflation):p.indexBuffer=n.createIndexBuffer(p.indexArrayForConflation,!0),p.entranceBloom.indexBuffer?p.entranceBloom.indexBuffer.updateData(p.entranceBloom.indexArrayForConflation):p.entranceBloom.indexBuffer=n.createIndexBuffer(p.entranceBloom.indexArrayForConflation,!0))};h(this.buildingWithoutFacade),h(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(n){const o=h=>{h.layoutColorBuffer?h.layoutColorBuffer.updateData(h.layoutColorArray):h.layoutColorBuffer=n.createVertexBuffer(h.layoutColorArray,mF.members,!0),h.layoutFacadePaintArray&&(h.layoutFacadePaintBuffer?h.layoutFacadePaintBuffer.updateData(h.layoutFacadePaintArray):h.layoutFacadePaintBuffer=n.createVertexBuffer(h.layoutFacadePaintArray,zZ.members,!0)),h.entranceBloom.layoutColorBuffer?h.entranceBloom.layoutColorBuffer.updateData(h.entranceBloom.layoutColorArray):h.entranceBloom.layoutColorBuffer=n.createVertexBuffer(h.entranceBloom.layoutColorArray,mF.members,!0)};o(this.buildingWithoutFacade),o(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(n,o){const h=n.paint.get("building-ambient-occlusion-intensity");for(const p of this.buildingFeatures){const x=o[p.promoteId],v=p.feature;v.properties["building-part"]="roof";const w=n.paint.get("building-color").evaluate(v,x,this.canonical).toPremultipliedRenderColor(this.lut),C=n.paint.get("building-emissive-strength").evaluate(v,x,this.canonical);v.properties["building-part"]="wall";const A=n.paint.get("building-color").evaluate(v,x,this.canonical).toPremultipliedRenderColor(this.lut),k=n.paint.get("building-emissive-strength").evaluate(v,x,this.canonical);v.properties["building-part"]="window";const P=n.paint.get("building-color").evaluate(v,x,this.canonical).toPremultipliedRenderColor(this.lut),O=n.paint.get("building-emissive-strength").evaluate(v,x,this.canonical);v.properties["building-part"]="door";const G=n.paint.get("building-color").evaluate(v,x,this.canonical).toPremultipliedRenderColor(this.lut),W=n.paint.get("building-emissive-strength").evaluate(v,x,this.canonical),te=p.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const oe of p.parts){let ge,ve=w;oe.part==="roof"?(ve=w,ge=C):oe.part==="wall"?(ve=A,ge=k):oe.part==="facade_glazing"?(ve=P,ge=O):oe.part==="entrance"&&(ve=G,ge=W),ge=K(ge,0,1);for(let Te=0;Te<oe.vertexLength;Te++){const $e=oe.vertexOffset+Te,Fe=1+(te.layoutAOArray.float32[$e]-1)*h;te.layoutColorArray.emplace($e,ve.r*Fe*255<<8|ve.g*Fe*255,ve.b*Fe*255<<8|255*ge),p.hasFauxFacade&&te.layoutFacadePaintArray.emplace($e,255*P.r<<8|255*P.g,255*P.b<<8|255*O)}}const se=p.buildingBloom;if(se)for(let oe=0;oe<se.vertexLength;oe++)te.entranceBloom.layoutColorArray.emplace(se.vertexOffset+oe,255*G.r<<8|255*G.g,255*G.b<<8|51*W)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(n,o,h){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const p=o.getReplacementRegionsForTile(n.toUnwrapped());if(dS(this.activeReplacements,p))return;this.activeReplacements=p;for(const v of this.footprints)v.hiddenFlags&=-2;const x=[];for(const v of this.activeReplacements){if(v.order<=vO)continue;const w=Math.max(1,Math.pow(2,v.footprintTileId.canonical.z-n.canonical.z));for(const C of this.footprints)C.min.x>v.max.x||C.max.x<v.min.x||C.min.y>v.max.y||C.max.y<v.min.y||(x.length=0,GZ(C.vertices,0,C.vertices.length,v.footprintTileId.canonical,n.canonical,x),Nj(v.footprint,x,C.indices,0,C.indices.length,0,-w)&&(C.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const v of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(v.groundEffectVertexOffset,v.groundEffectVertexLength,v.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(n){if(n.id!==void 0){const o=this.featureFootprintLookup.get(n.id);return this.footprints[o]}return null}getHeightAtTileCoord(n,o){let h=Number.NEGATIVE_INFINITY,p=!0;const x=4*(n+ar)*ar+(o+ar);if(this.footprintLookup.hasOwnProperty(x)){const w=this.footprintLookup[x];return w?{height:w.height,hidden:w.hiddenFlags!==0}:void 0}const v=new At(n,o);for(const w of this.footprints)n>w.max.x||w.min.x>n||o>w.max.y||w.min.y>o||w.height<=h||kj(v,w)&&(h=w.height,this.footprintLookup[x]=w,p=w.hiddenFlags!==0);if(h!==Number.NEGATIVE_INFINITY)return{height:h,hidden:p};this.footprintLookup[x]=void 0}}function GZ(l,n,o,h,p,x){const v=Math.pow(2,h.z-p.z);for(let w=0;w<o;w++){let C=l[w+n].x,A=l[w+n].y;C=(C+p.x*ar)*v-h.x*ar,A=(A+p.y*ar)*v-h.y*ar,x.push(new At(C,A))}}let vF,yF;Tr(xF,"BuildingBucket",{omit:["layers"]}),Tr(Yj,"BuildingGeometry"),Tr(_F,"BuildingBloomGeometry");const WZ=Kn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),HZ=Kn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:ZZ}=WZ,XZ=Kn([{name:"a_packed",components:3,type:"Float32"}]),{members:YZ}=XZ,KZ=Kn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:JZ}=KZ;class wF{constructor(n,o){this.width=n,this.height=o,this.nextRow=0,this.image=new hp({width:n,height:o}),this.positions={},this.uploaded=!1}getDash(n,o){const h=this.getKey(n,o);return this.positions[h]}trim(){const n=this.width,o=this.height=Ce(this.nextRow);this.image.resize({width:n,height:o})}getKey(n,o){return n.join(",")+o}getDashRanges(n,o,h){const p=[];let x=n.length%2==1?-n[n.length-1]*h:0,v=n[0]*h,w=!0;p.push({left:x,right:v,isDash:w,zeroLength:n[0]===0});let C=n[0];for(let A=1;A<n.length;A++){w=!w;const k=n[A];x=C*h,C+=k,v=C*h,p.push({left:x,right:v,isDash:w,zeroLength:k===0})}return p}addRoundDash(n,o,h){const p=o/2;for(let x=-h;x<=h;x++){const v=this.width*(this.nextRow+h+x);let w=0,C=n[w];for(let A=0;A<this.width;A++){A/C.right>1&&(C=n[++w]);const k=Math.abs(A-C.left),P=Math.abs(A-C.right),O=Math.min(k,P);let G;const W=x/h*(p+1);if(C.isDash){const te=p-Math.abs(W);G=Math.sqrt(O*O+te*te)}else G=p-Math.sqrt(O*O+W*W);this.image.data[v+A]=Math.max(0,Math.min(255,G+128))}}}addRegularDash(n,o){for(let C=n.length-1;C>=0;--C){const A=n[C],k=n[C+1];A.zeroLength?n.splice(C,1):k&&k.isDash===A.isDash&&(k.left=A.left,n.splice(C,1))}const h=n[0],p=n[n.length-1];h.isDash===p.isDash&&(h.left=p.left-this.width,p.right=h.right+this.width);const x=this.width*this.nextRow;let v=0,w=n[v];for(let C=0;C<this.width;C++){C/w.right>1&&(w=n[++v]);const A=Math.abs(C-w.left),k=Math.abs(C-w.right),P=Math.min(A,k);this.image.data[x+C]=Math.max(0,Math.min(255,(w.isDash?P:-P)+o+128))}}addDash(n,o){const h=this.getKey(n,o);if(this.positions[h])return this.positions[h];const p=o==="round",x=p?7:0,v=2*x+1;if(this.nextRow+v>this.height)return ur("LineAtlas out of space"),null;n.length===0&&n.push(1);let w=0;for(let k=0;k<n.length;k++)n[k]<0&&(ur("Negative value is found in line dasharray, replacing values with 0"),n[k]=0),w+=n[k];if(w!==0){const k=this.width/w,P=this.getDashRanges(n,this.width,k);p?this.addRoundDash(P,k,x):this.addRegularDash(P,o==="square"?.5*k:0)}const C=this.nextRow+x;this.nextRow+=v;const A={tl:[C,x],br:[w,0]};return this.positions[h]=A,A}}Tr(wF,"LineAtlas");const QZ=qt.types,eX=Math.cos(Math.PI/180*37.5),tX=Math.cos(Math.PI/180*5);class Kj{constructor(n){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=n.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=n.overscaling,this.pixelRatio=n.pixelRatio,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.projection=n.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new T0,this.layoutVertexArray2=new Pl,this.patternVertexArray=new Pl,this.indexArray=new bs,this.programConfigurations=new Rc(n.layers,{zoom:n.zoom,lut:n.lut}),this.segments=new Fs,this.maxLineLength=0,this.zOffsetVertexArray=new Pl,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.tessellationStep=n.tessellationStep?n.tessellationStep:ar/64,this.worldview=n.worldview,this.hasAppearances=null}updateFootprints(n,o){}updateAppearances(n,o,h,p){}populate(n,o,h,p){this.hasPattern=Tj("line",this.layers,this.pixelRatio,o);const x=this.layers[0].layout.get("line-sort-key");this.tileToMeter=We(h);const v=this.layers[0].layout.get("line-elevation-reference");if(v==="hd-road-markup")this.elevationType="road";else{const O=this.layers[0].layout.get("line-z-offset"),G=O.isConstant()&&!O.constantOr(0);this.elevationType=v!=="sea"&&v!=="ground"&&G?"none":"offset",this.elevationType==="offset"&&v==="none"&&ur(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const w=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&w!==void 0;const C=[];for(const{feature:O,id:G,index:W,sourceLayerIndex:te}of n){const se=this.layers[0]._featureFilter.needGeometry,oe=xt(O,se);if(!this.layers[0]._featureFilter.filter(new us(this.zoom,{worldview:this.worldview,activeFloors:o.activeFloors}),oe,h))continue;const ge=x?x.evaluate(oe,{},h):void 0,ve={id:G,properties:O.properties,type:O.type,sourceLayerIndex:te,index:W,geometry:se?oe.geometry:Pt(O,h,p),patterns:{},sortKey:ge};C.push(ve)}x&&C.sort((O,G)=>O.sortKey-G.sortKey);const{lineAtlas:A,featureIndex:k}=o,P=this.addConstantDashes(A);for(const O of C){const{geometry:G,index:W,sourceLayerIndex:te}=O;if(P&&this.addFeatureDashes(O,A),this.hasPattern){const se=Ej("line",this.layers,O,this.zoom,this.pixelRatio,o);this.patternFeatures.push(se)}else this.addFeature(O,G,W,h,A.positions,o.availableImages,o.brightness,o.elevationFeatures);k.insert(n[W].feature,G,W,te,this.index)}}addConstantDashes(n){let o=!1;for(const h of this.layers){const p=h.paint.get("line-dasharray").value,x=h.layout.get("line-cap").value;if(p.kind!=="constant"||x.kind!=="constant")o=!0;else{const v=x.value,w=p.value;if(!w)continue;n.addDash(w,v)}}return o}addFeatureDashes(n,o){const h=this.zoom;for(const p of this.layers){const x=p.paint.get("line-dasharray").value,v=p.layout.get("line-cap").value;if(x.kind==="constant"&&v.kind==="constant")continue;let w,C;if(x.kind==="constant"){if(w=x.value,!w)continue}else w=x.evaluate({zoom:h},n);C=v.kind==="constant"?v.value:v.evaluate({zoom:h},n),o.addDash(w,C),n.patterns[p.id]=[o.getKey(w,C)]}}update(n,o,h,p,x,v,w,C){this.programConfigurations.updatePaintArrays(n,o,x,h,p,v,w,C)}addFeatures(n,o,h,p,x,v){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,o,h,p,v)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,YZ)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=n.createVertexBuffer(this.patternVertexArray,JZ)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=n.createVertexBuffer(this.zOffsetVertexArray,HZ.members,!0)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,ZZ),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n,o){let h,p;if(o&&o>0?(h=`mapbox_clip_start_${o}`,p=`mapbox_clip_end_${o}`):(h="mapbox_clip_start",p="mapbox_clip_end"),n.properties&&n.properties.hasOwnProperty(h)&&n.properties.hasOwnProperty(p))return{start:+n.properties[h],end:+n.properties[p]}}addFeature(n,o,h,p,x,v,w,C){const A=this.layers[0].layout,k=A.get("line-join").evaluate(n,{}),P=A.get("line-cap").evaluate(n,{}),O=A.get("line-miter-limit"),G=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(n),this.lineFeature=n;const W=!(!n.properties||!n.properties.hasOwnProperty("mapbox_line_metrics"))&&n.properties.mapbox_line_metrics;this.zOffsetValue=A.get("line-z-offset").value;const te=this.layers[0].paint.get("line-width").value;if(te.kind!=="constant"&&te.isLineProgressConstant===!1&&(this.variableWidthValue=te),this.elevationType==="road"){const se=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(n,o,p,C,k,P,O,G)){const[oe,ge]=this.clipRuntimeLinesToTile(o,1);for(let ve=0;ve<oe.length;ve++){const Te=oe[ve],$e=ge[ve],Fe={progress:{min:$e.progress.min,max:$e.progress.max},nextDir:this.computeSegNextDir($e,Te),prevDir:this.computeSegPrevDir($e,Te)};this.addLine(Te,n,p,k,P,O,G,Fe,W&&$e.parentIndex>0?$e.parentIndex:null)}this.fillNonElevatedRoadSegment(se)}}else for(let se=0;se<o.length;se++)this.addLine(o[se],n,p,k,P,O,G,void 0,W&&se>0?se:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,h,x,v,p,w,void 0,this.worldview)}computeSegNextDir(n,o){return n.nextPoint.sub(o.at(-2)).unit()}computeSegPrevDir(n,o){return o[1].sub(n.prevPoint).unit()}clipLinesToTile(n,o){return pS(n,-o,-o,ar+o,ar+o)}clipRuntimeLinesToTile(n,o){const h=[];return[pS(n,-o,-o,ar+o,ar+o,h),h]}addElevatedRoadFeature(n,o,h,p,x,v,w,C){const A=[],k=Tn.getElevationFeature(n,p);if(k){const P=this.clipLinesToTile(o,1),O=this.prepareElevatedLines(P,k,h);for(const G of O)A.push({geometry:G,elevation:k,elevationTileID:h,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(A.length===0)return!1;for(const P of A){const O=this.layoutVertexArray.length;this.addLine(P.geometry,n,h,x,v,w,C);const G=new pi(h,P.elevationTileID);if(P.elevation)for(let W=O;W<this.layoutVertexArray.length;W++){const te=new At(this.layoutVertexArray.int16[6*W]>>1,this.layoutVertexArray.int16[6*W+1]>>1),se=G.pointElevation(te,P.elevation,.05);this.updateHeightRange(se),this.zOffsetVertexArray.emplaceBack(se,0,0)}else this.fillNonElevatedRoadSegment(O)}return!0}prepareElevatedLines(n,o,h){if(o.constantHeight!=null)return n;const p=[],x=1/We(h);for(const v of n)fZ(v,new ps(o,x),0,p);return p}fillNonElevatedRoadSegment(n){for(let o=n;o<this.layoutVertexArray.length;o++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(n){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,n),this.heightRange.max=Math.max(this.heightRange.max,n)):this.heightRange={min:n,max:n}}addLine(n,o,h,p,x,v,w,C,A){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=A?this.lineFeatureClips(o,A):this.lineClips;const k=p==="none";this.patternJoinNone=this.hasPattern&&k,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const P=C&&C.progress.min>0,O=C&&C.progress.max<1;if(this.lineClips){let Je={min:this.lineClips.start,max:this.lineClips.end},Tt=1;if(C){const Mt=this.lineClips.end-this.lineClips.start;Je=function(Bt,ir,Jt){return{min:Di(Bt.min,ir,Jt),max:Di(Bt.max,ir,Jt)}}(C.progress,{min:0,max:1},Je),Mt>0&&(Tt=(Je.max-Je.min)/Mt)}const ot=+o.properties.mapbox_clip_feature_len,Ct=+o.properties.mapbox_clip_seg_len;if(Number.isNaN(ot)||Number.isNaN(Ct)){for(let Bt=0;Bt<n.length-1;Bt++)this.totalDistance+=n[Bt].dist(n[Bt+1]);const Mt=this.totalDistance/(Je.max-Je.min);this.totalFeatureLength=Number.isFinite(Mt)?Mt:0,this.lineClips.start=Je.min,this.lineClips.end=Je.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=ot,this.distance=Ct*Tt,this.lineClips.start=Je.min,this.lineClips.end=Je.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const G=QZ[o.type]==="Polygon";let W=n.length;for(;W>=2&&n[W-1].equals(n[W-2]);)W--;let te=0;for(;te<W-1&&n[te].equals(n[te+1]);)te++;if(W<(G?3:2))return;p==="bevel"&&(v=1.05);const se=this.segments.prepareSegment(10*W,this.layoutVertexArray,this.indexArray);let oe,ge,ve,Te,$e,Fe,Ze,Ye;C&&C.prevDir&&(Fe=C.prevDir.perp()),C&&C.nextDir&&(Ze=C.nextDir.perp()),this.e1=this.e2=-1,G&&(oe=n[W-2],$e=n[te].sub(oe)._unit()._perp());for(let Je=te;Je<W;Je++){if(ve=Je===W-1?G?n[te+1]:void 0:n[Je+1],ve&&n[Je].equals(ve))continue;$e&&(Te=$e),oe&&(ge=oe),oe=n[Je],Ye=this.evaluateLineProgressFeatures(ge?ge.dist(oe):0),$e=ve?ve.sub(oe)._unit()._perp():Te,Te=Te||$e;const Tt=ge&&ve;let ot=Tt?p:G||k?"butt":x;const Ct=Te.x*$e.x+Te.y*$e.y;if(k){const vt=function(Ht){if(Ht.patternJoinNone){const rr=Ht.segmentPoints.length/2,Lt=Ht.lineSoFar-Ht.segmentStart;for(let br=0;br<rr;++br){const Ir=Ht.segmentPoints[2*br+1],_r=Math.round(Ht.segmentPoints[2*br])+.5+.25*Ir;Ht.patternVertexArray.emplaceBack(_r,Lt,Ht.segmentStart),Ht.patternVertexArray.emplaceBack(_r,Lt,Ht.segmentStart)}Ht.segmentPoints.length=0}Ht.e1=Ht.e2=-1};if(Tt&&Ct<tX){this.updateDistance(ge,oe),this.addCurrentVertex(oe,Te,1,1,se,Ye),vt(this),this.addCurrentVertex(oe,$e,-1,-1,se,Ye);continue}if(ge){if(!ve){this.updateDistance(ge,oe),this.addCurrentVertex(oe,Te,1,1,se,Ye),vt(this);continue}ot="miter"}}let Mt=Te.add($e);Mt.x===0&&Mt.y===0||Mt._unit();const Bt=Mt.x*$e.x+Mt.y*$e.y,ir=Bt!==0?1/Bt:1/0,Jt=2*Math.sqrt(2-2*Bt),Ft=Bt<eX&&ge&&ve,Yt=Te.x*$e.y-Te.y*$e.x>0,wt=this.overscaling<=16?15*ar/(512*this.overscaling):0;if(Tt&&ot==="round"){if(ir<w)ot="miter";else if(ir<=2){const vt=Jj(oe,-10,ar+10);ot=this.elevationType==="offset"&&(vt||this.hasCrossSlope)?"miter":"fakeround"}}if(ot==="miter"&&ir>v&&(ot="bevel"),ot==="bevel"&&(ir>2&&(ot="flipbevel"),ir<v&&(ot="miter")),ge&&!(ot==="miter"&&Ft)&&this.updateDistance(ge,oe),ot==="miter")if(Ft){const vt=oe.dist(ge);if(vt>2*wt){const rr=oe.sub(oe.sub(ge)._mult(wt/vt)._round());this.updateDistance(ge,rr),this.addCurrentVertex(rr,Te,0,0,se,Ye),ge=rr}this.updateDistance(ge,oe),Mt._mult(ir),this.addCurrentVertex(oe,Mt,0,0,se,Ye);const Ht=oe.dist(ve);if(Ht>2*wt){const rr=oe.add(ve.sub(oe)._mult(wt/Ht)._round());this.updateDistance(oe,rr),this.addCurrentVertex(rr,$e,0,0,se,Ye),oe=rr}}else Mt._mult(ir),this.addCurrentVertex(oe,Mt,0,0,se,Ye);else if(ot==="flipbevel"){if(ir>100)Mt=$e.mult(-1);else{const vt=ir*Te.add($e).mag()/Te.sub($e).mag();Mt._perp()._mult(vt*(Yt?-1:1))}this.addCurrentVertex(oe,Mt,0,0,se,Ye),this.addCurrentVertex(oe,Mt.mult(-1),0,0,se,Ye)}else if(ot==="bevel"||ot==="fakeround"){Ye!=null&&ge&&this.addCurrentVertex(oe,Ze||Te,-1,-1,se,Ye);const vt=oe.dist(ge)<=2*wt&&ot!=="bevel",Ht=Mt.mult(Yt?1:-1);Ht._mult(ir);const rr=$e.mult(Yt?-1:1),Lt=Te.mult(Yt?-1:1),br=this.evaluateLineProgressFeatures(this.distance);if(Ye==null&&(this.addHalfVertex(oe,Ht.x,Ht.y,!1,!Yt,0,se,br),vt||this.addHalfVertex(oe,Ht.x+2*Lt.x,Ht.y+2*Lt.y,!1,Yt,0,se,br)),ot==="fakeround"){const Ir=Math.round(180*Jt/Math.PI/20);this.addHalfVertex(oe,Lt.x,Lt.y,!1,Yt,0,se,br);for(let _r=0;_r<Ir;_r++){let dr=_r/Ir;if(dr!==.5){const pr=dr-.5;dr+=dr*pr*(dr-1)*((1.0904+Ct*(Ct*(3.55645-1.43519*Ct)-3.2452))*pr*pr+(.848013+Ct*(.215638*Ct-1.06021)))}const En=rr.sub(Lt)._mult(dr)._add(Lt)._unit();this.addHalfVertex(oe,En.x,En.y,!1,Yt,0,se,br)}this.addHalfVertex(oe,rr.x,rr.y,!1,Yt,0,se,br)}vt||Ye!=null||this.addHalfVertex(oe,Ht.x+2*rr.x,Ht.y+2*rr.y,!1,Yt,0,se,br),Ye!=null&&ve&&this.addCurrentVertex(oe,Fe||$e,1,1,se,Ye)}else if(ot==="butt")this.addCurrentVertex(oe,Mt,0,0,se,Ye);else if(ot==="square"){if(!ge){const vt=P?0:-1;this.addCurrentVertex(oe,Mt,vt,vt,se,Ye)}if(this.addCurrentVertex(oe,Mt,0,0,se,Ye),ge){const vt=O?0:1;this.addCurrentVertex(oe,Mt,vt,vt,se,Ye)}}else if(ot==="round"){if(ge){const vt=!Tt&&Ze?Ze:Te;this.addCurrentVertex(oe,vt,0,0,se,Ye),!Tt&&O||this.addCurrentVertex(oe,vt,1,1,se,Ye,!0)}if(ve){const vt=!Tt&&Fe?Fe:$e;!Tt&&P||this.addCurrentVertex(oe,vt,-1,-1,se,Ye,!0),this.addCurrentVertex(oe,vt,0,0,se,Ye)}}}}addVerticesTo(n,o,h,p,x,v,w,C,A,k){const P=(o.w-n.w)/this.tessellationStep|0;let O=0;const G=this.scaledDistance;if(P>1){this.lineSoFar=n.w;const te=(o.x-n.x)/P,se=(o.y-n.y)/P,oe=(o.z-n.z)/P,ge=(o.w-n.w)/P;for(let ve=1;ve<P;++ve){n.x+=te,n.y+=se,n.z+=oe,this.lineSoFar+=ge,O+=ge;const Te=this.evaluateLineProgressFeatures(this.prevDistance+O);this.scaledDistance=(this.prevDistance+O)/this.totalDistance,this.addHalfVertex(n,h,p,k,!1,w,A,Te),this.addHalfVertex(n,x,v,k,!0,-C,A,Te)}}this.lineSoFar=o.w,this.scaledDistance=G;const W=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(o,h,p,k,!1,w,A,W),this.addHalfVertex(o,x,v,k,!0,-C,A,W)}evaluateLineProgressFeatures(n){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+n)/this.totalFeatureLength):ur(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let o=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(o=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:o}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:o}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:o}}addCurrentVertex(n,o,h,p,x,v,w=!1){const C=o.x+o.y*h,A=o.y-o.x*h,k=o.y*p-o.x,P=-o.y-o.x*p;if(v!=null){const O=this.elevationType==="offset",G=-10,W=ar+10,te=v.zOffset,se=new VO(n.x,n.y,te,this.lineSoFar),oe=!!O&&Jj(n,G,W),ge=this.lineSoFar,ve=this.distance;if(this.currentVertex)if(oe){const Te=this.currentVertexIsOutside,$e=this.currentVertex,Fe=new VO(n.x,n.y,te,this.lineSoFar);if(qO($e,Fe,G,W),!Jj(Fe,G,W)){if(Te){this.e1=this.e2=-1,this.distance-=$e.dist(se),this.lineSoFar=$e.w;const Ze=this.evaluateLineProgressFeatures($e.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex($e,C,A,w,!1,h,x,Ze),this.addHalfVertex($e,k,P,w,!0,-p,x,Ze),this.prevDistance=this.distance}this.distance=this.prevDistance+$e.dist(Fe),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo($e,Fe,C,A,k,P,h,p,x,w),this.distance=ve,this.scaledDistance=this.distance/this.totalDistance}}else{const Te=this.currentVertex;if(this.currentVertexIsOutside){qO(Te,se,G,W),this.e1=this.e2=-1,this.distance-=Te.dist(se),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=Te.w;const $e=this.evaluateLineProgressFeatures(Te.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Te,C,A,w,!1,h,x,$e),this.addHalfVertex(Te,k,P,w,!0,-p,x,$e),this.prevDistance=this.distance,this.distance=ve,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(Te,se,C,A,k,P,h,p,x,w)}else oe||(this.addHalfVertex(n,C,A,w,!1,h,x,v),this.addHalfVertex(n,k,P,w,!0,-p,x,v));this.currentVertex=se,this.currentVertexIsOutside=oe,this.lineSoFar=ge}else this.addHalfVertex(n,C,A,w,!1,h,x,v),this.addHalfVertex(n,k,P,w,!0,-p,x,v)}addHalfVertex({x:n,y:o},h,p,x,v,w,C,A){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),v||this.segmentPoints.push(this.lineSoFar-this.segmentStart,w)),this.layoutVertexArray.emplaceBack((n<<1)+(x?1:0),(o<<1)+(v?1:0),Math.round(63*h)+128,Math.round(63*p)+128,1+(w===0?0:w<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const P=fn(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,P)}const k=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,k),C.primitiveLength++),v?this.e2=k:this.e1=k,A!=null&&this.zOffsetVertexArray.emplaceBack(A.zOffset,A.variableWidth,A.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(n,o){this.prevDistance=this.distance,this.distance+=n.dist(o),this.updateScaledDistance()}}function Jj(l,n,o){return l.x<n||l.x>o||l.y<n||l.y>o}let bF,SF;function TF(l,n,o){return n*(ar/(l.tileSize*Math.pow(2,o-l.tileID.overscaledZ)))}Tr(Kj,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const EF=(l,n,o)=>(1-o)*l+o*n;function CF(l,n){return 1/TF(l,1,n.tileZoom)}function AF(l,n,o,h){return l.translatePosMatrix(h||n.tileID.projMatrix,n,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const jF=l=>{const n=[];IF(l)&&n.push("RENDER_LINE_DASH"),l.paint.get("line-gradient")&&n.push("RENDER_LINE_GRADIENT");const o=l.paint.get("line-trim-offset");o[0]===0&&o[1]===0||n.push("RENDER_LINE_TRIM_OFFSET"),l.paint.get("line-border-width").constantOr(1)!==0&&n.push("RENDER_LINE_BORDER");const h=l.layout.get("line-join").constantOr("miter")==="none",p=!!l.paint.get("line-pattern").constantOr(1);return h&&p&&n.push("LINE_JOIN_NONE"),n};function IF(l){const n=l.paint.get("line-dasharray").value;return n.kind!=="constant"||n.value}let Qj;const NF=()=>Qj||(Qj={layout:bF||(bF=new Zs({"line-cap":new mr(at.layout_line["line-cap"]),"line-join":new mr(at.layout_line["line-join"]),"line-miter-limit":new er(at.layout_line["line-miter-limit"]),"line-round-limit":new er(at.layout_line["line-round-limit"]),"line-sort-key":new mr(at.layout_line["line-sort-key"]),"line-z-offset":new mr(at.layout_line["line-z-offset"]),"line-elevation-reference":new er(at.layout_line["line-elevation-reference"]),"line-cross-slope":new er(at.layout_line["line-cross-slope"]),visibility:new er(at.layout_line.visibility),"line-width-unit":new er(at.layout_line["line-width-unit"])})),paint:SF||(SF=new Zs({"line-opacity":new mr(at.paint_line["line-opacity"]),"line-color":new mr(at.paint_line["line-color"]),"line-translate":new er(at.paint_line["line-translate"]),"line-translate-anchor":new er(at.paint_line["line-translate-anchor"]),"line-width":new mr(at.paint_line["line-width"]),"line-gap-width":new mr(at.paint_line["line-gap-width"]),"line-offset":new mr(at.paint_line["line-offset"]),"line-blur":new mr(at.paint_line["line-blur"]),"line-dasharray":new mr(at.paint_line["line-dasharray"]),"line-pattern":new mr(at.paint_line["line-pattern"]),"line-pattern-cross-fade":new er(at.paint_line["line-pattern-cross-fade"]),"line-gradient":new Yf(at.paint_line["line-gradient"]),"line-trim-offset":new er(at.paint_line["line-trim-offset"]),"line-trim-fade-range":new er(at.paint_line["line-trim-fade-range"]),"line-trim-color":new er(at.paint_line["line-trim-color"]),"line-emissive-strength":new er(at.paint_line["line-emissive-strength"]),"line-border-width":new mr(at.paint_line["line-border-width"]),"line-border-color":new mr(at.paint_line["line-border-color"]),"line-occlusion-opacity":new er(at.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new mr({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new mr({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new mr({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new mr({type:"string",default:"default","property-type":"data-driven"})}))},Qj);class rX extends mr{possiblyEvaluate(n,o){return o=new us(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,transition:o.transition,worldview:o.worldview}),super.possiblyEvaluate(n,o)}evaluate(n,o,h,p){return o=Object.assign({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(n,o,h,p)}}let N1;function kF(l,n){return n>0?n+2*l:l}const nX=Kn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),iX=Kn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),sX=Kn([{name:"a_projected_pos",components:4,type:"Float32"}],4);Kn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const aX=Kn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),oX=Kn([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),lX=Kn([{name:"a_texb",components:2,type:"Uint16"}]),cX=Kn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),uX=Kn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Kn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const PF=Kn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),dX=Kn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Kn([{name:"triangle",components:3,type:"Uint16"}]),Kn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Kn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Kn([{type:"Float32",name:"offsetX"}]),Kn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var oo=24;function hX(l,n,o){return l.sections.forEach(h=>{h.text=function(p,x,v){const w=x.layout.get("text-transform").evaluate(v,{});return w==="uppercase"?p=p.toLocaleUpperCase():w==="lowercase"&&(p=p.toLocaleLowerCase()),_l.applyArabicShaping&&(p=_l.applyArabicShaping(p)),p}(h.text,n,o)}),l}const k1={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function fX(l){return l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""}function pX(l){return l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""}const eI=4294967296,DF=1/eI,RF=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let ES=class{constructor(l=new Uint8Array(16)){this.buf=ArrayBuffer.isView(l)?l:new Uint8Array(l),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(l,n,o=this.length){for(;this.pos<o;){const h=this.readVarint(),p=h>>3,x=this.pos;this.type=7&h,l(p,n,this),this.pos===x&&this.skip(h)}return n}readMessage(l,n){return this.readFields(l,n,this.readVarint()+this.pos)}readFixed32(){const l=this.dataView.getUint32(this.pos,!0);return this.pos+=4,l}readSFixed32(){const l=this.dataView.getInt32(this.pos,!0);return this.pos+=4,l}readFixed64(){const l=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*eI;return this.pos+=8,l}readSFixed64(){const l=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*eI;return this.pos+=8,l}readFloat(){const l=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,l}readDouble(){const l=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,l}readVarint(l){const n=this.buf;let o,h;return h=n[this.pos++],o=127&h,h<128?o:(h=n[this.pos++],o|=(127&h)<<7,h<128?o:(h=n[this.pos++],o|=(127&h)<<14,h<128?o:(h=n[this.pos++],o|=(127&h)<<21,h<128?o:(h=n[this.pos],o|=(15&h)<<28,function(p,x,v){const w=v.buf;let C,A;if(A=w[v.pos++],C=(112&A)>>4,A<128||(A=w[v.pos++],C|=(127&A)<<3,A<128)||(A=w[v.pos++],C|=(127&A)<<10,A<128)||(A=w[v.pos++],C|=(127&A)<<17,A<128)||(A=w[v.pos++],C|=(127&A)<<24,A<128)||(A=w[v.pos++],C|=(1&A)<<31,A<128))return G0(p,C,x);throw new Error("Expected varint not more than 10 bytes")}(o,l,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const l=this.readVarint();return l%2==1?(l+1)/-2:l/2}readBoolean(){return!!this.readVarint()}readString(){const l=this.readVarint()+this.pos,n=this.pos;return this.pos=l,l-n>=12&&RF?RF.decode(this.buf.subarray(n,l)):function(o,h,p){let x="",v=h;for(;v<p;){const w=o[v];let C,A,k,P=null,O=w>239?4:w>223?3:w>191?2:1;if(v+O>p)break;O===1?w<128&&(P=w):O===2?(C=o[v+1],(192&C)==128&&(P=(31&w)<<6|63&C,P<=127&&(P=null))):O===3?(C=o[v+1],A=o[v+2],(192&C)==128&&(192&A)==128&&(P=(15&w)<<12|(63&C)<<6|63&A,(P<=2047||P>=55296&&P<=57343)&&(P=null))):O===4&&(C=o[v+1],A=o[v+2],k=o[v+3],(192&C)==128&&(192&A)==128&&(192&k)==128&&(P=(15&w)<<18|(63&C)<<12|(63&A)<<6|63&k,(P<=65535||P>=1114112)&&(P=null))),P===null?(P=65533,O=1):P>65535&&(P-=65536,x+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),x+=String.fromCharCode(P),v+=O}return x}(this.buf,n,l)}readBytes(){const l=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,l);return this.pos=l,n}readPackedVarint(l=[],n){const o=this.readPackedEnd();for(;this.pos<o;)l.push(this.readVarint(n));return l}readPackedSVarint(l=[]){const n=this.readPackedEnd();for(;this.pos<n;)l.push(this.readSVarint());return l}readPackedBoolean(l=[]){const n=this.readPackedEnd();for(;this.pos<n;)l.push(this.readBoolean());return l}readPackedFloat(l=[]){const n=this.readPackedEnd();for(;this.pos<n;)l.push(this.readFloat());return l}readPackedDouble(l=[]){const n=this.readPackedEnd();for(;this.pos<n;)l.push(this.readDouble());return l}readPackedFixed32(l=[]){const n=this.readPackedEnd();for(;this.pos<n;)l.push(this.readFixed32());return l}readPackedSFixed32(l=[]){const n=this.readPackedEnd();for(;this.pos<n;)l.push(this.readSFixed32());return l}readPackedFixed64(l=[]){const n=this.readPackedEnd();for(;this.pos<n;)l.push(this.readFixed64());return l}readPackedSFixed64(l=[]){const n=this.readPackedEnd();for(;this.pos<n;)l.push(this.readSFixed64());return l}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(l){const n=7&l;if(n===0)for(;this.buf[this.pos++]>127;);else if(n===2)this.pos=this.readVarint()+this.pos;else if(n===5)this.pos+=4;else{if(n!==1)throw new Error(`Unimplemented type: ${n}`);this.pos+=8}}writeTag(l,n){this.writeVarint(l<<3|n)}realloc(l){let n=this.length||16;for(;n<this.pos+l;)n*=2;if(n!==this.length){const o=new Uint8Array(n);o.set(this.buf),this.buf=o,this.dataView=new DataView(o.buffer),this.length=n}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(l){this.realloc(4),this.dataView.setInt32(this.pos,l,!0),this.pos+=4}writeSFixed32(l){this.realloc(4),this.dataView.setInt32(this.pos,l,!0),this.pos+=4}writeFixed64(l){this.realloc(8),this.dataView.setInt32(this.pos,-1&l,!0),this.dataView.setInt32(this.pos+4,Math.floor(l*DF),!0),this.pos+=8}writeSFixed64(l){this.realloc(8),this.dataView.setInt32(this.pos,-1&l,!0),this.dataView.setInt32(this.pos+4,Math.floor(l*DF),!0),this.pos+=8}writeVarint(l){(l=+l||0)>268435455||l<0?function(n,o){let h,p;if(n>=0?(h=n%4294967296|0,p=n/4294967296|0):(h=~(-n%4294967296),p=~(-n/4294967296),4294967295^h?h=h+1|0:(h=0,p=p+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),function(x,v,w){w.buf[w.pos++]=127&x|128,x>>>=7,w.buf[w.pos++]=127&x|128,x>>>=7,w.buf[w.pos++]=127&x|128,x>>>=7,w.buf[w.pos++]=127&x|128,w.buf[w.pos]=127&(x>>>=7)}(h,0,o),function(x,v){const w=(7&x)<<4;v.buf[v.pos++]|=w|((x>>>=3)?128:0),x&&(v.buf[v.pos++]=127&x|((x>>>=7)?128:0),x&&(v.buf[v.pos++]=127&x|((x>>>=7)?128:0),x&&(v.buf[v.pos++]=127&x|((x>>>=7)?128:0),x&&(v.buf[v.pos++]=127&x|((x>>>=7)?128:0),x&&(v.buf[v.pos++]=127&x)))))}(p,o)}(l,this):(this.realloc(4),this.buf[this.pos++]=127&l|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=l>>>7&127))))}writeSVarint(l){this.writeVarint(l<0?2*-l-1:2*l)}writeBoolean(l){this.writeVarint(+l)}writeString(l){l=String(l),this.realloc(4*l.length),this.pos++;const n=this.pos;this.pos=function(h,p,x){for(let v,w,C=0;C<p.length;C++){if(v=p.charCodeAt(C),v>55295&&v<57344){if(!w){v>56319||C+1===p.length?(h[x++]=239,h[x++]=191,h[x++]=189):w=v;continue}if(v<56320){h[x++]=239,h[x++]=191,h[x++]=189,w=v;continue}v=w-55296<<10|v-56320|65536,w=null}else w&&(h[x++]=239,h[x++]=191,h[x++]=189,w=null);v<128?h[x++]=v:(v<2048?h[x++]=v>>6|192:(v<65536?h[x++]=v>>12|224:(h[x++]=v>>18|240,h[x++]=v>>12&63|128),h[x++]=v>>6&63|128),h[x++]=63&v|128)}return x}(this.buf,l,this.pos);const o=this.pos-n;o>=128&&MF(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o}writeFloat(l){this.realloc(4),this.dataView.setFloat32(this.pos,l,!0),this.pos+=4}writeDouble(l){this.realloc(8),this.dataView.setFloat64(this.pos,l,!0),this.pos+=8}writeBytes(l){const n=l.length;this.writeVarint(n),this.realloc(n);for(let o=0;o<n;o++)this.buf[this.pos++]=l[o]}writeRawMessage(l,n){this.pos++;const o=this.pos;l(n,this);const h=this.pos-o;h>=128&&MF(o,h,this),this.pos=o-1,this.writeVarint(h),this.pos+=h}writeMessage(l,n,o){this.writeTag(l,2),this.writeRawMessage(n,o)}writePackedVarint(l,n){n.length&&this.writeMessage(l,mX,n)}writePackedSVarint(l,n){n.length&&this.writeMessage(l,gX,n)}writePackedBoolean(l,n){n.length&&this.writeMessage(l,vX,n)}writePackedFloat(l,n){n.length&&this.writeMessage(l,_X,n)}writePackedDouble(l,n){n.length&&this.writeMessage(l,xX,n)}writePackedFixed32(l,n){n.length&&this.writeMessage(l,yX,n)}writePackedSFixed32(l,n){n.length&&this.writeMessage(l,wX,n)}writePackedFixed64(l,n){n.length&&this.writeMessage(l,bX,n)}writePackedSFixed64(l,n){n.length&&this.writeMessage(l,SX,n)}writeBytesField(l,n){this.writeTag(l,2),this.writeBytes(n)}writeFixed32Field(l,n){this.writeTag(l,5),this.writeFixed32(n)}writeSFixed32Field(l,n){this.writeTag(l,5),this.writeSFixed32(n)}writeFixed64Field(l,n){this.writeTag(l,1),this.writeFixed64(n)}writeSFixed64Field(l,n){this.writeTag(l,1),this.writeSFixed64(n)}writeVarintField(l,n){this.writeTag(l,0),this.writeVarint(n)}writeSVarintField(l,n){this.writeTag(l,0),this.writeSVarint(n)}writeStringField(l,n){this.writeTag(l,2),this.writeString(n)}writeFloatField(l,n){this.writeTag(l,5),this.writeFloat(n)}writeDoubleField(l,n){this.writeTag(l,1),this.writeDouble(n)}writeBooleanField(l,n){this.writeVarintField(l,+n)}};function G0(l,n,o){return o?4294967296*n+(l>>>0):4294967296*(n>>>0)+(l>>>0)}function MF(l,n,o){const h=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));o.realloc(h);for(let p=o.pos-1;p>=l;p--)o.buf[p+h]=o.buf[p]}function mX(l,n){for(let o=0;o<l.length;o++)n.writeVarint(l[o])}function gX(l,n){for(let o=0;o<l.length;o++)n.writeSVarint(l[o])}function _X(l,n){for(let o=0;o<l.length;o++)n.writeFloat(l[o])}function xX(l,n){for(let o=0;o<l.length;o++)n.writeDouble(l[o])}function vX(l,n){for(let o=0;o<l.length;o++)n.writeBoolean(l[o])}function yX(l,n){for(let o=0;o<l.length;o++)n.writeFixed32(l[o])}function wX(l,n){for(let o=0;o<l.length;o++)n.writeSFixed32(l[o])}function bX(l,n){for(let o=0;o<l.length;o++)n.writeFixed64(l[o])}function SX(l,n){for(let o=0;o<l.length;o++)n.writeSFixed64(l[o])}const tI=3;function TX(l,n,o){n.glyphs=[],l===1&&o.readMessage(EX,n)}function EX(l,n,o){if(l===3){const{id:h,bitmap:p,width:x,height:v,left:w,top:C,advance:A}=o.readMessage(CX,{});n.glyphs.push({id:h,bitmap:new hp({width:x+2*tI,height:v+2*tI},p),metrics:{width:x,height:v,left:w,top:C,advance:A}})}else l===4?n.ascender=o.readSVarint():l===5&&(n.descender=o.readSVarint())}function CX(l,n,o){l===1?n.id=o.readVarint():l===2?n.bitmap=o.readBytes():l===3?n.width=o.readVarint():l===4?n.height=o.readVarint():l===5?n.left=o.readSVarint():l===6?n.top=o.readSVarint():l===7&&(n.advance=o.readVarint())}const OF=tI,zl={horizontal:1,vertical:2,horizontalOnly:3};class P1{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(n,o){const h=new P1;return h.scale=n||1,h.fontStack=o,h}static forImage(n){const o=new P1;return o.image=n,o}}class W0{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,o,h){const p=new W0;for(let x=0;x<n.sections.length;x++){const v=n.sections[x];v.image?p.addImageSection(v,h):p.addTextSection(v,o)}return p}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSections(){return this.sections}getSectionIndex(n){return this.sectionIndex[n]}getCodePoint(n){return this.text.codePointAt(n)}verticalizePunctuation(n){this.text=function(o,h){let p="";for(let x=0;x<o.length;x++){const v=o.charCodeAt(x+1)||null,w=o.charCodeAt(x-1)||null;p+=!h&&(v&&Oy(v)&&!k1[o[x+1]]||w&&Oy(w)&&!k1[o[x-1]])||!k1[o[x]]?o[x]:k1[o[x]]}return p}(this.text,n)}trim(){let n=0;for(let h=0;h<this.text.length&&CS[this.text.charCodeAt(h)];h++)n++;let o=this.text.length;for(let h=this.text.length-1;h>=0&&h>=n&&CS[this.text.charCodeAt(h)];h--)o--;this.text=this.text.substring(n,o),this.sectionIndex=this.sectionIndex.slice(n,o)}substring(n,o){const h=new W0;return h.text=this.text.substring(n,o),h.sectionIndex=this.sectionIndex.slice(n,o),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,o)=>Math.max(n,this.sections[o].scale),0)}addTextSection(n,o){this.text+=n.text,this.sections.push(P1.forText(n.scale,n.fontStack||o));const h=this.sections.length-1;for(let p=0;p<n.text.length;++p)this.sectionIndex.push(h)}addImageSection(n,o){const h=n.image?n.image.getPrimary():null;if(!h)return void ur("Can't add FormattedSection with an empty image.");h.scaleSelf(o);const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCodePoint(p),this.sections.push(P1.forImage(h)),this.sectionIndex.push(this.sections.length-1)):ur("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function rI(l,n,o,h,p,x,v,w,C,A,k,P,O,G,W,te=1){const se=W0.fromFeature(l,p,te);P===zl.vertical&&se.verticalizePunctuation(O);let oe=[];const ge=function(Ze,Ye,Je,Tt,ot,Ct){if(!Ze)return[];const Mt=[],Bt=function(Yt,wt,vt,Ht,rr,Lt){let br=0;for(let Ir=0;Ir<Yt.length();Ir++){const _r=Yt.getSection(Ir);br+=FF(Yt.getCodePoint(Ir),_r,Ht,rr,wt,Lt)}return br/Math.max(1,Math.ceil(br/vt))}(Ze,Ye,Je,Tt,ot,Ct),ir=Ze.text.indexOf("")>=0;let Jt=0;for(let Yt=0;Yt<Ze.length();Yt++){const wt=Ze.getSection(Yt),vt=Ze.getCodePoint(Yt);if(CS[vt]||(Jt+=FF(vt,wt,Tt,ot,Ye,Ct)),Yt<Ze.length()-1){const Ht=!((Ft=vt)<11904||!(an["Bopomofo Extended"](Ft)||an.Bopomofo(Ft)||an["CJK Compatibility Forms"](Ft)||an["CJK Compatibility Ideographs"](Ft)||an["CJK Compatibility"](Ft)||an["CJK Radicals Supplement"](Ft)||an["CJK Strokes"](Ft)||an["CJK Symbols and Punctuation"](Ft)||an["CJK Unified Ideographs Extension A"](Ft)||an["CJK Unified Ideographs"](Ft)||an["Enclosed CJK Letters and Months"](Ft)||an["Halfwidth and Fullwidth Forms"](Ft)||an.Hiragana(Ft)||an["Ideographic Description Characters"](Ft)||an["Kangxi Radicals"](Ft)||an["Katakana Phonetic Extensions"](Ft)||an.Katakana(Ft)||an["Vertical Forms"](Ft)||an["Yi Radicals"](Ft)||an["Yi Syllables"](Ft)));(AX[vt]||Ht||wt.image)&&Mt.push(zF(Yt+1,Jt,Bt,Mt,jX(vt,Ze.getCodePoint(Yt+1),Ht&&ir),!1))}}var Ft;return BF(zF(Ze.length(),Jt,Bt,Mt,0,!0))}(se,A,x,n,h,G),{processBidirectionalText:ve,processStyledBidirectionalText:Te}=_l;if(ve&&se.sections.length===1){const Ze=ve(se.toString(),ge);for(const Ye of Ze){const Je=new W0;Je.text=Ye,Je.sections=se.sections;for(let Tt=0;Tt<Ye.length;Tt++)Je.sectionIndex.push(0);oe.push(Je)}}else if(Te){const Ze=Te(se.text,se.sectionIndex,ge);for(const Ye of Ze){const Je=new W0;Je.text=Ye[0],Je.sectionIndex=Ye[1],Je.sections=se.sections,oe.push(Je)}}else oe=function(Ze,Ye){const Je=[],Tt=Ze.text;let ot=0;for(const Ct of Ye)Je.push(Ze.substring(ot,Ct)),ot=Ct;return ot<Tt.length&&Je.push(Ze.substring(ot,Tt.length)),Je}(se,ge);const $e=[],Fe={positionedLines:$e,text:se.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Ze,Ye,Je,Tt,ot,Ct,Mt,Bt,ir,Jt,Ft,Yt){let wt=0,vt=0,Ht=0;const rr=Bt==="right"?1:Bt==="left"?0:.5;let Lt=!1;for(const pr of ot){const Qr=pr.getSections();for(const jn of Qr){if(jn.image)continue;const Gn=Ye[jn.fontStack];if(Gn&&(Lt=Gn.ascender!==void 0&&Gn.descender!==void 0,!Lt))break}if(!Lt)break}let br=0;for(const pr of ot){pr.trim();const Qr=pr.getMaxScale(),jn=(Qr-1)*oo,Gn={positionedGlyphs:[],lineOffset:0};Ze.positionedLines[br]=Gn;const mi=Gn.positionedGlyphs;let Pn=0;if(!pr.length()){vt+=Ct,++br;continue}let Ei=0,Ci=0;for(let Le=0;Le<pr.length();Le++){const Pe=pr.getSection(Le),jt=pr.getSectionIndex(Le),cr=pr.getCodePoint(Le);let It=Pe.scale,fr=null,Br=null,Mr=null,Mn=oo,cn=0,Dr=ir;Dr===zl.vertical&&((Ir=cr)===12312||Ir===12313||Ir===12316||Ir===12540||Ir===12448)&&(Dr=zl.horizontal);const Si=!(Dr===zl.horizontal||!Ft&&!v0(cr)||Ft&&(CS[cr]||Fy(cr)));if(Pe.image){const Yi=Tt.get(Pe.image.toString());if(!Yi)continue;Mr=Pe.image,Ze.iconsInText=Ze.iconsInText||!0,Br=Yi.paddedRect;const dn=Yi.displaySize;It=It*oo/Yt,fr={width:dn[0],height:dn[1],left:0,top:-OF,advance:Si?dn[1]:dn[0],localGlyph:!1},cn=Lt?-fr.height*It:Qr*oo-17-dn[1]*It,Mn=fr.advance;const hi=(Si?dn[0]:dn[1])*It-oo*Qr;hi>0&&hi>Pn&&(Pn=hi)}else{const Yi=Je[Pe.fontStack];if(!Yi)continue;Yi[cr]&&(Br=Yi[cr]);const dn=Ye[Pe.fontStack];if(!dn)continue;const hi=dn.glyphs[cr];if(!hi)continue;if(fr=hi.metrics,Mn=cr!==8203?oo:0,Lt){const Ki=dn.ascender!==void 0?Math.abs(dn.ascender):0,zi=dn.descender!==void 0?Math.abs(dn.descender):0,qs=(Ki+zi)*It;Ei<qs&&(Ei=qs,Ci=(Ki-zi)/2*It),cn=-Ki*It}else cn=(Qr-It)*oo-17}Si?(Ze.verticalizable=!0,mi.push({glyph:cr,image:Mr,x:wt,y:vt+cn,vertical:Si,scale:It,localGlyph:fr.localGlyph,fontStack:Pe.fontStack,sectionIndex:jt,metrics:fr,rect:Br}),wt+=Mn*It+Jt):(mi.push({glyph:cr,image:Mr,x:wt,y:vt+cn,vertical:Si,scale:It,localGlyph:fr.localGlyph,fontStack:Pe.fontStack,sectionIndex:jt,metrics:fr,rect:Br}),wt+=fr.advance*It+Jt)}mi.length!==0&&(Ht=Math.max(wt-Jt,Ht),Lt?UF(mi,rr,Pn,Ci,Ct*Qr/2):UF(mi,rr,Pn,0,Ct/2)),wt=0;const As=Ct*Qr+Pn;Gn.lineOffset=Math.max(Pn,jn),vt+=As,++br}var Ir;const _r=vt,{horizontalAlign:dr,verticalAlign:En}=nI(Mt);(function(pr,Qr,jn,Gn,mi,Pn){const Ei=(Qr-jn)*mi,Ci=-Pn*Gn;for(const As of pr)for(const Le of As.positionedGlyphs)Le.x+=Ei,Le.y+=Ci})(Ze.positionedLines,rr,dr,En,Ht,_r),Ze.top+=-En*_r,Ze.bottom=Ze.top+_r,Ze.left+=-dr*Ht,Ze.right=Ze.left+Ht,Ze.hasBaseline=Lt}(Fe,n,o,h,oe,v,w,C,P,A,O,W),!function(Ze){for(const Ye of Ze)if(Ye.positionedGlyphs.length!==0)return!1;return!0}($e))return Fe}const CS={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},AX={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function FF(l,n,o,h,p,x){if(n.image){const v=h.get(n.image.toString());return v?v.displaySize[0]*n.scale*oo/x+p:0}{const v=o[n.fontStack],w=v&&v.glyphs[l];return w?w.metrics.advance*n.scale+p:0}}function LF(l,n,o,h){const p=Math.pow(l-n,2);return h?l<n?p/2:2*p:p+Math.abs(o)*o}function jX(l,n,o){let h=0;return l===10&&(h-=1e4),o&&(h+=150),l!==40&&l!==65288||(h+=50),n!==41&&n!==65289||(h+=50),h}function zF(l,n,o,h,p,x){let v=null,w=LF(n,o,p,x);for(const C of h){const A=LF(n-C.x,o,p,x)+C.badness;A<=w&&(v=C,w=A)}return{index:l,x:n,priorBreak:v,badness:w}}function BF(l){return l?BF(l.priorBreak).concat(l.index):[]}function nI(l){let n=.5,o=.5;switch(l){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:n,verticalAlign:o}}function UF(l,n,o,h,p){if(!(n||o||h||p))return;const x=l.length-1,v=l[x],w=(v.x+v.metrics.advance*v.scale)*n;for(let C=0;C<=x;C++)l[C].x-=w,l[C].y+=o+h+p}function VF(l){return l.imagePrimary!==void 0&&l.top!==void 0&&l.bottom!==void 0&&l.left!==void 0&&l.right!==void 0}function AS(l,n,o,h){const{horizontalAlign:p,verticalAlign:x}=nI(h),v=o[0]-l.displaySize[0]*p,w=o[1]-l.displaySize[1]*x;return{imagePrimary:l,imageSecondary:n,top:w,bottom:w+l.displaySize[1],left:v,right:v+l.displaySize[0]}}function iI(l,n,o,h,p,x){const v=l.imagePrimary;let w;if(v.content){const se=v.content,oe=v.pixelRatio||1;w=[se[0]/oe,se[1]/oe,v.displaySize[0]-se[2]/oe,v.displaySize[1]-se[3]/oe]}const C=n.left*x,A=n.right*x;let k,P,O,G;o==="width"||o==="both"?(G=p[0]+C-h[3],P=p[0]+A+h[1]):(G=p[0]+(C+A-v.displaySize[0])/2,P=G+v.displaySize[0]);const W=n.top*x,te=n.bottom*x;return o==="height"||o==="both"?(k=p[1]+W-h[0],O=p[1]+te+h[2]):(k=p[1]+(W+te-v.displaySize[1])/2,O=k+v.displaySize[1]),{imagePrimary:v,imageSecondary:void 0,top:k,right:P,bottom:O,left:G,collisionPadding:w}}function $F(l){return!l.imagePrimary.stretchX}function qF(l){return!l.imagePrimary.stretchY}function GF(l){return{width:l.right-l.left,height:l.bottom-l.top}}const Xu=128;function H0(l,n,o){const{expression:h}=n;if(h.kind==="constant")return{kind:"constant",layoutSize:h.evaluate(new us(l+1,{worldview:o}))};if(h.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:x}=h;let v=0;for(;v<p.length&&p[v]<=l;)v++;v=Math.max(0,v-1);let w=v;for(;w<p.length&&p[w]<l+1;)w++;w=Math.min(p.length-1,w);const C=p[v],A=p[w];return h.kind==="composite"?{kind:"composite",minZoom:C,maxZoom:A,interpolationType:x}:{kind:"camera",minZoom:C,maxZoom:A,minSize:h.evaluate(new us(C,{worldview:o})),maxSize:h.evaluate(new us(A,{worldview:o})),interpolationType:x}}}function sI(l,{uSize:n,uSizeT:o},{lowerSize:h,upperSize:p}){return l.kind==="source"?h/Xu:l.kind==="composite"?fn(h/Xu,p/Xu,o):n}function Z0(l,n,o=1){let h=0,p=0;if(l.kind==="constant")p=l.layoutSize*o;else if(l.kind!=="source"){const{interpolationType:x,minZoom:v,maxZoom:w}=l,C=x?K(Nl.interpolationFactor(x,n,v,w),0,1):0;l.kind==="camera"?p=fn(l.minSize,l.maxSize,C)*o:h=C*o}return{uSizeT:h,uSize:p}}class Bh extends At{constructor(n,o,h,p,x){super(n,o),this.angle=p,this.z=h,x!==void 0&&(this.segment=x)}clone(){return new Bh(this.x,this.y,this.z,this.angle,this.segment)}}function WF(l,n,o,h,p){if(n.segment===void 0)return!0;let x=n,v=n.segment+1,w=0;for(;w>-o/2;){if(v--,v<0)return!1;w-=l[v].dist(x),x=l[v]}w+=l[v].dist(l[v+1]),v++;const C=[];let A=0;for(;w<o/2;){const k=l[v],P=l[v+1];if(!P)return!1;let O=l[v-1].angleTo(k)-k.angleTo(P);for(O=Math.abs((O+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:w,angleDelta:O}),A+=O;w-C[0].distance>h;)A-=C.shift().angleDelta;if(A>p)return!1;v++,w+=k.dist(P)}return!0}function HF(l){let n=0;for(let o=0;o<l.length-1;o++)n+=l[o].dist(l[o+1]);return n}function ZF(l,n,o){return l?.6*n*o:0}function XF(l,n){return Math.max(l?l.right-l.left:0,n?n.right-n.left:0)}function IX(l,n,o,h,p,x){const v=ZF(o,p,x),w=XF(o,h)*x;let C=0;const A=HF(l)/2;for(let k=0;k<l.length-1;k++){const P=l[k],O=l[k+1],G=P.dist(O);if(C+G>A){const W=(A-C)/G,te=fn(P.x,O.x,W),se=fn(P.y,O.y,W),oe=new Bh(te,se,0,O.angleTo(P),k);return!v||WF(l,oe,w,v,n)?oe:void 0}C+=G}}function NX(l,n,o,h,p,x,v,w,C){const A=ZF(h,x,v),k=XF(h,p),P=k*v,O=l[0].x===0||l[0].x===C||l[0].y===0||l[0].y===C;return n-P<n/4&&(n=P+n/4),YF(l,O?n/2*w%n:(k/2+2*x)*v*w%n,n,A,o,P,O,!1,C)}function YF(l,n,o,h,p,x,v,w,C){const A=x/2,k=HF(l);let P=0,O=n-o,G=[];for(let W=0;W<l.length-1;W++){const te=l[W],se=l[W+1],oe=te.dist(se),ge=se.angleTo(te);for(;O+o<P+oe;){O+=o;const ve=(O-P)/oe,Te=fn(te.x,se.x,ve),$e=fn(te.y,se.y,ve);if(Te>=0&&Te<C&&$e>=0&&$e<C&&O-A>=0&&O+A<=k){const Fe=new Bh(Te,$e,0,ge,W);h&&!WF(l,Fe,x,h,p)||G.push(Fe)}}P+=oe}return w||G.length||v||(G=YF(l,P/2,o,h,p,x,v,!0,C)),G}function KF(l){let n=0,o=0;for(const v of l)n+=v.w*v.h,o=Math.max(o,v.w);l.sort((v,w)=>w.h-v.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),o),h:1/0}];let p=0,x=0;for(const v of l)for(let w=h.length-1;w>=0;w--){const C=h[w];if(!(v.w>C.w||v.h>C.h)){if(v.x=C.x,v.y=C.y,x=Math.max(x,v.y+v.h),p=Math.max(p,v.x+v.w),v.w===C.w&&v.h===C.h){const A=h.pop();A&&w<h.length&&(h[w]=A)}else v.h===C.h?(C.x+=v.w,C.w-=v.w):v.w===C.w?(C.y+=v.h,C.h-=v.h):(h.push({x:C.x+v.w,y:C.y,w:C.w-v.w,h:v.h}),C.y+=v.h,C.h-=v.h);break}}return{w:p,h:x,fill:n/(p*x)||0}}Tr(Bh,"Anchor");const Cg=1;class D1{static getImagePositionScale(n,o,h){if(o&&n&&n.options&&n.options.transform){const p=n.options.transform;return{x:p.a,y:p.d}}return{x:h,y:h}}constructor(n,o,h,p){this.paddedRect=n;const{pixelRatio:x,version:v,stretchX:w,stretchY:C,content:A,sdf:k,usvg:P}=o;this.pixelRatio=x,this.stretchX=w,this.stretchY=C,this.content=A,this.version=v,this.padding=h,this.sdf=k,this.usvg=P,this.scale=D1.getImagePositionScale(p,P,x)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function aI(l,n,o){const h=Lu.parse(l),p=function(x,v,w=[1,1]){return{x:0,y:0,w:(x.data?x.data.width:x.width*w[0])+2*v,h:(x.data?x.data.height:x.height*w[1])+2*v}}(n,o,[h.options.transform.a,h.options.transform.d]);return{bin:p,imagePosition:new D1(p,n,o,h),imageVariant:h}}class JF{constructor(n,o,h){const p=new Map,x=new Map;this.haveRenderCallbacks=[];const v=[];this.addImages(n,p,Cg,v),this.addImages(o,x,2,v);const{w,h:C}=KF(v),A=new bo({width:w||1,height:C||1});for(const[k,P]of n.entries()){const O=p.get(k).paddedRect;bo.copy(P.data,A,{x:0,y:0},{x:O.x+Cg,y:O.y+Cg},P.data,null,P.sdf)}for(const[k,P]of o.entries()){const O=x.get(k),G=O.paddedRect;let W=O.padding;const te=G.x+W,se=G.y+W,oe=P.data.width,ge=P.data.height;W=W>1?W-1:W,bo.copy(P.data,A,{x:0,y:0},{x:te,y:se},P.data,h),bo.copy(P.data,A,{x:0,y:ge-W},{x:te,y:se-W},{width:oe,height:W},h),bo.copy(P.data,A,{x:0,y:0},{x:te,y:se+ge},{width:oe,height:W},h),bo.copy(P.data,A,{x:oe-W,y:0},{x:te-W,y:se},{width:W,height:ge},h),bo.copy(P.data,A,{x:0,y:0},{x:te+oe,y:se},{width:W,height:ge},h),bo.copy(P.data,A,{x:oe-W,y:ge-W},{x:te-W,y:se-W},{width:W,height:W},h),bo.copy(P.data,A,{x:0,y:ge-W},{x:te+oe,y:se-W},{width:W,height:W},h),bo.copy(P.data,A,{x:0,y:0},{x:te+oe,y:se+ge},{width:W,height:W},h),bo.copy(P.data,A,{x:oe-W,y:0},{x:te-W,y:se+ge},{width:W,height:W},h)}this.lut=h,this.image=A,this.iconPositions=p,this.patternPositions=x}addImages(n,o,h,p){for(const[x,v]of n.entries()){const{bin:w,imagePosition:C,imageVariant:A}=aI(x,v,h);o.set(x,C),p.push(w),v.hasRenderCallback&&this.haveRenderCallbacks.push(A.id)}}patchUpdatedImages(n,o,h){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(p=>n.hasImage(p,h)),n.dispatchRenderCallbacks(this.haveRenderCallbacks,h);for(const p of n.getUpdatedImages(h)){for(const x of this.iconPositions.keys()){const v=Lu.parse(x);if(Ra.isEqual(v.id,p)){const w=n.getImage(p,h);this.patchUpdatedImage(this.iconPositions.get(x),w,o,null)}}for(const x of this.patternPositions.keys()){const v=Lu.parse(x);if(Ra.isEqual(v.id,p)){const w=n.getImage(p,h);this.patchUpdatedImage(this.patternPositions.get(x),w,o,this.lut)}}}}patchUpdatedImage(n,o,h,p=null){if(!n||!o||n.version===o.version)return;n.version=o.version;const[x,v]=n.tl,w=n.sdf;if(this.lut||w){const C={width:o.data.width,height:o.data.height},A=new bo(C);bo.copy(o.data,A,{x:0,y:0},{x:0,y:0},C,p,w),h.update(A,{position:{x,y:v}})}else h.update(o.data,{position:{x,y:v}})}}Tr(D1,"ImagePosition"),Tr(JF,"ImageAtlas");const R1=1e20;function QF(l,n,o,h,p,x,v,w,C){for(let A=n;A<n+h;A++)e3(l,o*x+A,x,p,v,w,C);for(let A=o;A<o+p;A++)e3(l,A*x+n,1,h,v,w,C)}function e3(l,n,o,h,p,x,v){x[0]=0,v[0]=-R1,v[1]=R1,p[0]=l[n];for(let w=1,C=0,A=0;w<h;w++){p[w]=l[n+w*o];const k=w*w;do{const P=x[C];A=(p[w]-p[P]+k-P*P)/(w-P)/2}while(A<=v[C]&&--C>-1);C++,x[C]=w,v[C]=A,v[C+1]=R1}for(let w=0,C=0;w<h;w++){for(;v[C+1]<w;)C++;const A=x[C],k=w-A;l[n+w*o]=p[A]+k*k}}const Yu=2,oI={none:0,ideographs:1,all:2};class X0{constructor(n,o,h){this.requestManager=n,this.localGlyphMode=o,this.localFontFamily=h,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(n){this.url=n}getGlyphs(n,o){const h=[],p=this.url||cs.GLYPHS_URL;for(const x in n)for(const v of n[x])h.push({stack:x,id:v});_e(h,({stack:x,id:v},w)=>{let C=this.entries[x];C||(C=this.entries[x]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let A=C.glyphs[v];if(A!==void 0)return void w(null,{stack:x,id:v,glyph:A});if(A=this._tinySDF(C,x,v),A)return C.glyphs[v]=A,void w(null,{stack:x,id:v,glyph:A});const k=Math.floor(v/256);if(256*k>65535)return ur("glyphs > 65535 not supported"),void w(null,{stack:x,id:v,glyph:A});if(C.ranges[k])return void w(null,{stack:x,id:v,glyph:A});let P=C.requests[k];P||(P=C.requests[k]=[],X0.loadGlyphRange(x,k,p,this.requestManager,(O,G)=>{if(G){C.ascender=G.ascender,C.descender=G.descender;for(const W in G.glyphs)this._doesCharSupportLocalGlyph(+W)||(C.glyphs[+W]=G.glyphs[+W]);C.ranges[k]=!0}for(const W of P)W(O,G);delete C.requests[k]})),P.push((O,G)=>{O?w(O):G&&w(null,{stack:x,id:v,glyph:G.glyphs[v]||null})})},(x,v)=>{if(x)o(x);else if(v){const w={};for(const{stack:C,id:A,glyph:k}of v)w[C]===void 0&&(w[C]={}),w[C].glyphs===void 0&&(w[C].glyphs={}),w[C].glyphs[A]=k&&{id:k.id,bitmap:k.bitmap.clone(),metrics:k.metrics},w[C].ascender=this.entries[C].ascender,w[C].descender=this.entries[C].descender;o(null,w)}})}_doesCharSupportLocalGlyph(n){return this.localGlyphMode!==oI.none&&(this.localGlyphMode===oI.all?!!this.localFontFamily:!!this.localFontFamily&&(an["CJK Unified Ideographs"](n)||an["Hangul Syllables"](n)||an.Hiragana(n)||an.Katakana(n)||an["CJK Symbols and Punctuation"](n)||an["CJK Unified Ideographs Extension A"](n)||an["CJK Unified Ideographs Extension B"](n)||an.Osage(n)))}_tinySDF(n,o,h){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(h))return;let x=n.tinySDF;if(!x){let te="400";/bold/i.test(o)?te="900":/medium/i.test(o)?te="500":/light/i.test(o)&&(te="200"),x=n.tinySDF=new X0.TinySDF({fontFamily:p,fontWeight:te,fontSize:24*Yu,buffer:3*Yu,radius:8*Yu}),x.fontWeight=te}if(this.localGlyphs[x.fontWeight][h])return this.localGlyphs[x.fontWeight][h];const v=String.fromCodePoint(h),{data:w,width:C,height:A,glyphWidth:k,glyphHeight:P,glyphLeft:O,glyphTop:G,glyphAdvance:W}=x.draw(v);return this.localGlyphs[x.fontWeight][h]={id:h,bitmap:new hp({width:C,height:A},w),metrics:{width:k/Yu,height:P/Yu,left:O/Yu,top:G/Yu-27,advance:W/Yu,localGlyph:!0}}}}X0.loadGlyphRange=function(l,n,o,h,p){const x=256*n,v=x+255,w=h.transformRequest(h.normalizeGlyphsURL(o).replace("{fontstack}",l).replace("{range}",`${x}-${v}`),yh.Glyphs);jf(w,(C,A)=>{if(C)p(C);else if(A){const k={},P=function(O){return new ES(O).readFields(TX,{})}(A);for(const O of P.glyphs)k[O.id]=O;p(null,{glyphs:k,ascender:P.ascender,descender:P.descender})}})},X0.TinySDF=class{constructor({fontSize:l=24,buffer:n=3,radius:o=8,cutoff:h=.25,fontFamily:p="sans-serif",fontWeight:x="normal",fontStyle:v="normal",lang:w=null}={}){this.buffer=n,this.cutoff=h,this.radius=o,this.lang=w;const C=this.size=l+4*n,A=this._createCanvas(C),k=this.ctx=A.getContext("2d",{willReadFrequently:!0});k.font=`${v} ${x} ${l}px ${p}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Uint16Array(C)}_createCanvas(l){const n=document.createElement("canvas");return n.width=n.height=l,n}draw(l){const{width:n,actualBoundingBoxAscent:o,actualBoundingBoxDescent:h,actualBoundingBoxLeft:p,actualBoundingBoxRight:x}=this.ctx.measureText(l),v=Math.ceil(o),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(x-p))),C=Math.min(this.size-this.buffer,v+Math.ceil(h)),A=w+2*this.buffer,k=C+2*this.buffer,P=Math.max(A*k,0),O=new Uint8ClampedArray(P),G={data:O,width:A,height:k,glyphWidth:w,glyphHeight:C,glyphTop:v,glyphLeft:0,glyphAdvance:n};if(w===0||C===0)return G;const{ctx:W,buffer:te,gridInner:se,gridOuter:oe}=this;this.lang&&(W.lang=this.lang),W.clearRect(te,te,w,C),W.fillText(l,te,te+v);const ge=W.getImageData(te,te,w,C);oe.fill(R1,0,P),se.fill(0,0,P);for(let ve=0;ve<C;ve++)for(let Te=0;Te<w;Te++){const $e=ge.data[4*(ve*w+Te)+3]/255;if($e===0)continue;const Fe=(ve+te)*A+Te+te;if($e===1)oe[Fe]=0,se[Fe]=R1;else{const Ze=.5-$e;oe[Fe]=Ze>0?Ze*Ze:0,se[Fe]=Ze<0?Ze*Ze:0}}QF(oe,0,0,A,k,A,this.f,this.v,this.z),QF(se,te,te,w,C,A,this.f,this.v,this.z);for(let ve=0;ve<P;ve++){const Te=Math.sqrt(oe[ve])-Math.sqrt(se[ve]);O[ve]=Math.round(255-255*(Te/this.radius+this.cutoff))}return G}};const Wd=Cg;function t3(l,n){return l+n[1]-n[0]}function lI(l,n,o,h,p=1){const x=[],v=l.imagePrimary,w=v.pixelRatio,C=v.paddedRect.w-2*Wd,A=v.paddedRect.h-2*Wd,k=(l.right-l.left)*p,P=(l.bottom-l.top)*p,O=v.stretchX||[[0,C]],G=v.stretchY||[[0,A]],W=O.reduce(t3,0),te=G.reduce(t3,0),se=C-W,oe=A-te;let ge=0,ve=W,Te=0,$e=te,Fe=0,Ze=se,Ye=0,Je=oe;if(v.content&&h){const ot=v.content;ge=jS(O,0,ot[0]),Te=jS(G,0,ot[1]),ve=jS(O,ot[0],ot[2]),$e=jS(G,ot[1],ot[3]),Fe=ot[0]-ge,Ye=ot[1]-Te,Ze=ot[2]-ot[0]-ve,Je=ot[3]-ot[1]-$e}const Tt=(ot,Ct,Mt,Bt)=>{const ir=IS(ot.stretch-ge,ve,k,l.left*p),Jt=NS(ot.fixed-Fe,Ze,ot.stretch,W),Ft=IS(Ct.stretch-Te,$e,P,l.top*p),Yt=NS(Ct.fixed-Ye,Je,Ct.stretch,te),wt=IS(Mt.stretch-ge,ve,k,l.left*p),vt=NS(Mt.fixed-Fe,Ze,Mt.stretch,W),Ht=IS(Bt.stretch-Te,$e,P,l.top*p),rr=NS(Bt.fixed-Ye,Je,Bt.stretch,te),Lt=new At(ir,Ft),br=new At(wt,Ft),Ir=new At(wt,Ht),_r=new At(ir,Ht),dr=new At(Jt/w,Yt/w),En=new At(vt/w,rr/w),pr=n*Math.PI/180;if(pr){const Ei=Math.sin(pr),Ci=Math.cos(pr),As=[Ci,-Ei,Ei,Ci];Lt._matMult(As),br._matMult(As),_r._matMult(As),Ir._matMult(As)}const Qr=ot.stretch+ot.fixed,jn=Mt.stretch+Mt.fixed,Gn=Ct.stretch+Ct.fixed,mi=Bt.stretch+Bt.fixed,Pn=l.imageSecondary;return{tl:Lt,tr:br,bl:_r,br:Ir,texPrimary:{x:v.paddedRect.x+Wd+Qr,y:v.paddedRect.y+Wd+Gn,w:jn-Qr,h:mi-Gn},texSecondary:Pn?{x:Pn.paddedRect.x+Wd+Qr,y:Pn.paddedRect.y+Wd+Gn,w:jn-Qr,h:mi-Gn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:dr,pixelOffsetBR:En,minFontScaleX:Ze/w/k,minFontScaleY:Je/w/P,isSDF:o}};if(h&&(v.stretchX||v.stretchY)){const ot=r3(O,se,W),Ct=r3(G,oe,te);for(let Mt=0;Mt<ot.length-1;Mt++){const Bt=ot[Mt],ir=ot[Mt+1];for(let Jt=0;Jt<Ct.length-1;Jt++)x.push(Tt(Bt,Ct[Jt],ir,Ct[Jt+1]))}}else x.push(Tt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:C+1},{fixed:0,stretch:A+1}));return x}function kX(l,n){const o=l.stretchY||[[0,l.paddedRect.h-2*Wd]];return n&&(l.stretchX||l.stretchY)?n3(l.stretchX||[[0,l.paddedRect.w-2*Wd]])*n3(o):1}function jS(l,n,o){let h=0;for(const p of l)h+=Math.max(n,Math.min(o,p[1]))-Math.max(n,Math.min(o,p[0]));return h}function r3(l,n,o){const h=[{fixed:-Wd,stretch:0}];for(const[p,x]of l){const v=h[h.length-1];h.push({fixed:p-v.stretch,stretch:v.stretch}),h.push({fixed:p-v.stretch,stretch:v.stretch+(x-p)})}return h.push({fixed:n+Wd,stretch:o}),h}function n3(l){return 2*l.length+1}function IS(l,n,o,h){return l/n*o+h}function NS(l,n,o,h){return l-n*o/h}function PX(l,n,o,h){const p=n+l.positionedLines[h].lineOffset;return h===0?o+p/2:o+(p+(n+l.positionedLines[h-1].lineOffset))/2}function DX(l,n=1,o=!1){let h=1/0,p=1/0,x=-1/0,v=-1/0;const w=l[0];for(let G=0;G<w.length;G++){const W=w[G];(!G||W.x<h)&&(h=W.x),(!G||W.y<p)&&(p=W.y),(!G||W.x>x)&&(x=W.x),(!G||W.y>v)&&(v=W.y)}const C=Math.min(x-h,v-p);let A=C/2;const k=new G_([],RX);if(C===0)return new At(h,p);for(let G=h;G<x;G+=C)for(let W=p;W<v;W+=C)k.push(new Y0(G+A,W+A,A,l));let P=function(G){let W=0,te=0,se=0;const oe=G[0];for(let ge=0,ve=oe.length,Te=ve-1;ge<ve;Te=ge++){const $e=oe[ge],Fe=oe[Te],Ze=$e.x*Fe.y-Fe.x*$e.y;te+=($e.x+Fe.x)*Ze,se+=($e.y+Fe.y)*Ze,W+=3*Ze}return new Y0(te/W,se/W,0,G)}(l),O=k.length;for(;k.length;){const G=k.pop();(G.d>P.d||!P.d)&&(P=G,o&&console.log("found best %d after %d probes",Math.round(1e4*G.d)/1e4,O)),G.max-P.d<=n||(A=G.h/2,k.push(new Y0(G.p.x-A,G.p.y-A,A,l)),k.push(new Y0(G.p.x+A,G.p.y-A,A,l)),k.push(new Y0(G.p.x-A,G.p.y+A,A,l)),k.push(new Y0(G.p.x+A,G.p.y+A,A,l)),O+=4)}return o&&(console.log(`num probes: ${O}`),console.log(`best distance: ${P.d}`)),P.p}function RX(l,n){return n.max-l.max}class Y0{constructor(n,o,h,p){this.p=new At(n,o),this.h=h,this.d=function(x,v){let w=!1,C=1/0;for(let A=0;A<v.length;A++){const k=v[A];for(let P=0,O=k.length,G=O-1;P<O;G=P++){const W=k[P],te=k[G];W.y>x.y!=te.y>x.y&&x.x<(te.x-W.x)*(x.y-W.y)/(te.y-W.y)+W.x&&(w=!w),C=Math.min(C,Rl(x,W,te))}}return(w?1:-1)*Math.sqrt(C)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}}const MX=Object.keys,cI=Number.POSITIVE_INFINITY,OX=Math.sqrt(2);function kS(l,n,o,h){const p=l.collisionPadding||[0,0,0,0],x={top:l.top-p[1],bottom:l.bottom+p[3],left:l.left-p[0],right:l.right+p[2],scaled:!1};return h!==void 0&&function(v,w){v.top*=w,v.bottom*=w,v.left*=w,v.right*=w,v.scaled=!0}(x,h),o&&function(v,w){if(!w)return;const C=lt(w),A=new At(v.left,v.top),k=new At(v.right,v.top),P=new At(v.left,v.bottom),O=new At(v.right,v.bottom);A._rotateAround(C,new At(0,0)),k._rotateAround(C,new At(0,0)),P._rotateAround(C,new At(0,0)),O._rotateAround(C,new At(0,0)),v.left=Math.min(A.x,k.x,P.x,O.x),v.right=Math.max(A.x,k.x,P.x,O.x),v.top=Math.min(A.y,k.y,P.y,O.y),v.bottom=Math.max(A.y,k.y,P.y,O.y)}(x,o),n?{top:Math.min(n.top,x.top),bottom:Math.max(n.bottom,x.bottom),left:Math.min(n.left,x.left),right:Math.max(n.right,x.right),scaled:n.scaled||x.scaled}:x}function i3(l,[n,o]){let h=0,p=0;if(o===cI){n<0&&(n=0);const x=n/OX;switch(l){case"top-right":case"top-left":p=x-7;break;case"bottom-right":case"bottom-left":p=7-x;break;case"bottom":p=7-n;break;case"top":p=n-7}switch(l){case"top-right":case"bottom-right":h=-x;break;case"top-left":case"bottom-left":h=x;break;case"left":h=n;break;case"right":h=-n}}else{switch(n=Math.abs(n),o=Math.abs(o),l){case"top-right":case"top-left":case"top":p=o-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-o}switch(l){case"top-right":case"bottom-right":case"right":h=-n;break;case"top-left":case"bottom-left":case"left":h=n}}return[h,p]}function FX(l,n,o,h,p,x,v,w,C,A,k){const P=l.layers[0],O=P.appearances;if(O.length===0)return{iconBBox:null,iconVerticalBBox:null};let G=null,W=null;const te=h.get("icon-rotate").evaluate(p,{},x);n&&(G=kS(n,G,te,v),o)&&(W=kS(o,W,te+90,v));const[se,oe]=h.get("icon-size-scale-range"),ge=K(1,se,oe);for(const ve of O){const Te=ve.getUnevaluatedProperties(),$e=Te._values["icon-image"].value!==void 0,Fe=Te._values["icon-size"].value!==void 0,Ze=Te._values["icon-offset"].value!==void 0,Ye=Te._values["icon-rotate"].value!==void 0;if($e||Fe||Ze||Ye){const Je=Ze?P.getAppearanceValueAndResolveTokens(ve,"icon-offset",p,x,[]):null,Tt=Je&&Array.isArray(Je)?Je:w,ot=Ye?P.getAppearanceValueAndResolveTokens(ve,"icon-rotate",p,x,[]):null,Ct=typeof ot=="number"?ot:te,Mt=Fe?P.getAppearanceValueAndResolveTokens(ve,"icon-size",p,x,[]):null,Bt=typeof Mt=="number"?Mt*C.iconScaleFactor:v;let ir=null,Jt=null,Ft=null;if($e){const Yt=P.getAppearanceValueAndResolveTokens(ve,"icon-image",p,x,[]);if(Yt){const wt=l.getResolvedImageFromTokens(Yt),vt=Te._values["icon-size"],Ht=M1(wt,H0(l.zoom,vt,l.worldview),vt,x,l.zoom,p,l.pixelRatio,ge,l.worldview);Ft=A.get(Ht.iconPrimary.toString())}}else n&&(Ft=n.imagePrimary);Ft&&(ir=AS(Ft,null,Tt,k),l.allowVerticalPlacement&&(Jt=AS(Ft,null,Tt,k))),ir&&(G=kS(ir,G,Ct,Bt)),Jt&&(W=kS(Jt,W,Ct+90,Bt))}}return{iconBBox:G,iconVerticalBBox:W}}function PS(l,n,o,h,p,x,v,w,C){if(!n||!n.usvg)return;const A=GF(h),k=GF(p),P=x!=="both"&&x!=="width"||!$F(h)?1:k.width/A.width,O=x!=="both"&&x!=="height"||!qF(h)?1:k.height/A.height;o.scaleSelf(P,O);const G=o.toString();v.set(G,o),w.set(G,n);const{imagePosition:W}=aI(G,n,Cg);C.set(G,W)}function s3(l,n,o,h,p,x,v,w,C){if(!l)return;const A=function(k,P,O,G,W,te){if(k.kind==="camera")return k.maxSize;if(k.kind==="composite"){const se=P.possiblyEvaluate(new us(k.maxZoom,{worldview:te}),O).evaluate(W,{},O),oe=P.possiblyEvaluate(new us(k.minZoom,{worldview:te}),O).evaluate(W,{},O);return Math.max(se,oe)}return P.possiblyEvaluate(new us(G,{worldview:te})).evaluate(W,{},O)}(n,o,h,p,x,C);return l.scaleSelf(A*w*v)}function M1(l,n,o,h,p,x,v,w,C){return{iconPrimary:s3(l.getPrimary(),n,o,h,p,x,v,w,C),iconSecondary:s3(l.getSecondary(),n,o,h,p,x,v,w,C)}}function LX(l,n,o){if(!n)return;const h=o.get(l.toString()),p=o.get(n.toString());h&&p&&(h.paddedRect.w===p.paddedRect.w&&h.paddedRect.h===p.paddedRect.h||ur(`Mismatch in icon variant sizes: ${l.toString()} and ${n.toString()}`),h.usvg!==p.usvg&&ur(`Mismatch in icon variant image types: ${l.id} and ${n.id}`))}function a3(l,n,o,h){if(!l)return;const p=n.get(o.toString());if(l.imagePrimary=p,h){const x=n.get(h.toString());l.imageSecondary=x}}function zX(l,n){for(const o in l.horizontal)o3(l.horizontal[o],n);o3(l.vertical,n)}function o3(l,n){if(l){for(const o of l.positionedLines)for(const h of o.positionedGlyphs)if(h.image!==null){const p=h.image.toString();h.rect=n.get(p).paddedRect}}}function uI(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function BX(l,n,o,h,p,x,v,w,C){const A=dI(x.horizontal)||x.vertical,k=o.get("icon-text-fit-padding").evaluate(h,{},p);let P,O=n;return n&&C!=="none"&&(l.allowVerticalPlacement&&x.vertical&&(P=iI(n,x.vertical,C,k,w,v)),A&&(O=iI(n,A,C,k,w,v))),{defaultShapedIcon:O,verticallyShapedIcon:P}}function UX(l,n,o,h,p,x,v,w,C,A,k,P,O,G,W,te,se,oe,ge,ve,Te,$e){let Fe=v.textMaxSize.evaluate(n,{},O);Fe===void 0?Fe=w*v.textScaleFactor:Fe*=v.textScaleFactor;const Ze=l.layers[0].layout,Ye=oo,Je=w*v.textScaleFactor/Ye,Tt=dI(o.horizontal)||o.vertical;if(se!=="none"&&l.appearanceFeatureData&&n.index<l.appearanceFeatureData.length){const Lt=l.appearanceFeatureData[n.index];Lt&&(Lt.textShaping=Tt,Lt.iconTextFitPadding=Ze.get("icon-text-fit-padding").evaluate(n,{},O),Lt.fontScale=Je)}const ot=G.name==="globe",Ct=l.tilePixelRatio*Fe/Ye,Mt=(wt=l.overscaling,l.zoom>18&&wt>2&&(wt>>=1),Math.max(ar/(512*wt),1)*Ze.get("symbol-spacing")),Bt=Ze.get("text-padding")*l.tilePixelRatio,ir=Ze.get("icon-padding")*l.tilePixelRatio,Jt=lt(Ze.get("text-max-angle")),Ft=Ze.get("icon-rotation-alignment")==="map"&&ve!=="point",Yt=Mt/2;var wt;l.hasAnyIconTextFit===!1&&se!=="none"&&(l.hasAnyIconTextFit=!0);const vt=n.properties?+n.properties[gr]:null,Ht=vt&&l.elevationFeatureIdToIndex?l.elevationFeatureIdToIndex.get(vt):65535,rr=(Lt,br,Ir)=>{if(br.x<0||br.x>=ar||br.y<0||br.y>=ar)return;let _r=null;if(ot){const{x:dr,y:En,z:pr}=G.projectTilePoint(br.x,br.y,Ir);_r={anchor:new Bh(dr,En,pr,0,void 0),up:G.upVector(Ir,br.x,br.y)}}(function(dr,En,pr,Qr,jn,Gn,mi,Pn,Ei,Ci,As,Le,Pe,jt,cr,It,fr,Br,Mr,Mn,cn,Dr,Si,Yi,dn,hi,Ki,zi,qs,xs,ss){const Hi=dr.addToLineVertexArray(En,Qr);let Ai,On,ji,as,un,gi,vs,Js=0,ca=0,Ia=0,ys=0,Ca=-1,xl=-1;const Aa={};let Bl=Um("");const So=pr?pr.anchor:En,Oc=zi!=="none";let vl=0,Ul=0;if(Ei._unevaluatedLayout.getValue("text-radial-offset")===void 0){const lo=Ei.layout.get("text-offset").evaluate(cn,{},dn);vl=lo[0]*oo,Ul=lo[1]*oo}else vl=Ei.layout.get("text-radial-offset").evaluate(cn,{},dn)*oo,Ul=cI;if(dr.allowVerticalPlacement&&jn.vertical){const lo=jn.vertical;if(cr)gi=hI(lo),Pn&&(vs=hI(Pn));else{const $o=Ei.layout.get("text-rotate").evaluate(cn,{},dn)+90;ji=DS(Ci,So,En,As,Le,Pe,lo,jt,$o,It),Pn&&(as=DS(Ci,So,En,As,Le,Pe,Pn,Br,$o,null,ss))}}if(Gn){const lo=dr.iconSizeData,$o=Ei.layout.get("icon-rotate").evaluate(cn,{},dn),Hd=lI(Gn,$o,Si,Oc,Dr.iconScaleFactor),_p=Pn?lI(Pn,$o,Si,Oc,Dr.iconScaleFactor):void 0;On=DS(Ci,So,En,As,Le,Pe,Gn,Br,$o,null,xs);const nx=function(Zd,YS,ix,eK,CL,AL,tK,rK){const jL=Zd.layers[0],IL=jL.appearances;let sx=YS.length;if(ix&&(sx=Math.max(sx,ix.length)),IL.length===0)return sx;const[nK,iK]=eK.get("icon-size-scale-range"),sK=K(1,nK,iK);for(const NL of IL){const kL=NL.getUnevaluatedProperties();if(kL._values["icon-image"].value!==void 0){const PL=jL.getAppearanceValueAndResolveTokens(NL,"icon-image",CL,AL,[]);if(PL){const DL=Zd.getResolvedImageFromTokens(PL);if(DL){const RL=kL._values["icon-size"],aK=M1(DL,H0(Zd.zoom,RL,Zd.worldview),RL,AL,Zd.zoom,CL,Zd.pixelRatio,sK,Zd.worldview),oK=tK.get(aK.iconPrimary.toString());sx=Math.max(sx,kX(oK,rK))}}}}return sx}(dr,Hd,_p,Ei.layout,cn,dn,dr.iconAtlasPositions,Oc);Js=4*nx;let xp=null;lo.kind==="source"?(xp=[Xu*Ei.layout.get("icon-size").evaluate(cn,{},dn)*Dr.iconScaleFactor],xp[0]>Uh&&ur(`${dr.layerIds[0]}: Value for "icon-size" is >= ${O1}. Reduce your "icon-size".`)):lo.kind==="composite"&&(xp=[Xu*Dr.compositeIconSizes[0].evaluate(cn,{},dn)*Dr.iconScaleFactor,Xu*Dr.compositeIconSizes[1].evaluate(cn,{},dn)*Dr.iconScaleFactor],(xp[0]>Uh||xp[1]>Uh)&&ur(`${dr.layerIds[0]}: Value for "icon-size" is >= ${O1}. Reduce your "icon-size".`)),dr.addSymbols(dr.icon,Hd,xp,Mn,Mr,cn,void 0,pr,En,Hi.lineStartIndex,Hi.lineLength,-1,Yi,dn,hi,Ki,dr.symbolInstances.length,nx),Ca=dr.icon.placedSymbolArray.length-1,_p&&(ca=4*nx,dr.addSymbols(dr.icon,_p,xp,Mn,Mr,cn,zl.vertical,pr,En,Hi.lineStartIndex,Hi.lineLength,-1,Yi,dn,hi,Ki,dr.symbolInstances.length,nx),xl=dr.icon.placedSymbolArray.length-1)}for(const lo in jn.horizontal){const $o=lo,Hd=jn.horizontal[$o];Ai||(Bl=Um(Hd.text),cr?un=hI(Hd):Ai=DS(Ci,So,En,As,Le,Pe,Hd,jt,Ei.layout.get("text-rotate").evaluate(cn,{},dn),It));const _p=Hd.positionedLines.length===1;if(Ia+=l3(dr,pr,En,Hd,mi,Ei,cr,cn,It,Hi,jn.vertical?zl.horizontal:zl.horizontalOnly,_p?MX(jn.horizontal):[$o],Aa,Ca,Dr,Yi,dn,dr.symbolInstances.length,hi),_p)break}jn.vertical&&(ys+=l3(dr,pr,En,jn.vertical,mi,Ei,cr,cn,It,Hi,zl.vertical,["vertical"],Aa,xl,Dr,Yi,dn,dr.symbolInstances.length,hi));let To=-1;const Vl=(lo,$o)=>lo?Math.max(lo,$o):$o;To=Vl(un,To),To=Vl(gi,To),To=Vl(vs,To);const Fc=To>-1?1:0;dr.glyphOffsetArray.length>=65535&&ur("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),cn.sortKey!==void 0&&dr.addToSortKeyRanges(dr.symbolInstances.length,cn.sortKey),dr.symbolInstances.emplaceBack(En.x,En.y,So.x,So.y,So.z,Aa.right>=0?Aa.right:-1,Aa.center>=0?Aa.center:-1,Aa.left>=0?Aa.left:-1,Aa.vertical>=0?Aa.vertical:-1,Ca,xl,Bl,Ai!==void 0?Ai:dr.collisionBoxArray.length,Ai!==void 0?Ai+1:dr.collisionBoxArray.length,ji!==void 0?ji:dr.collisionBoxArray.length,ji!==void 0?ji+1:dr.collisionBoxArray.length,On!==void 0?On:dr.collisionBoxArray.length,On!==void 0?On+1:dr.collisionBoxArray.length,as||dr.collisionBoxArray.length,as?as+1:dr.collisionBoxArray.length,As,Ia,ys,Js,ca,Fc,0,vl,Ul,To,0,Oc?1:0,qs)})(l,br,_r,Lt,o,h,x,p,l.layers[0],l.collisionBoxArray,n.index,n.sourceLayerIndex,l.index,Bt,ge,A,0,ir,Ft,oe,n,v,k,P,O,W,te,se,Ht,Te,$e)};if(ve==="line")for(const Lt of pS(n.geometry,0,0,ar,ar)){const br=NX(Lt,Mt,Jt,o.vertical||Tt,h,Ye,Ct,l.overscaling,ar);for(const Ir of br)Tt&&VX(l,Tt.text,Yt,Ir)||rr(Lt,Ir,O)}else if(ve==="line-center"){for(const Lt of n.geometry)if(Lt.length>1){const br=IX(Lt,Jt,o.vertical||Tt,h,Ye,Ct);br&&rr(Lt,br,O)}}else if(n.type==="Polygon")for(const Lt of x1(n.geometry,0)){const br=DX(Lt,16);rr(Lt[0],new Bh(br.x,br.y,0,0,void 0),O)}else if(n.type==="LineString")for(const Lt of n.geometry)rr(Lt,new Bh(Lt[0].x,Lt[0].y,0,0,void 0),O);else if(n.type==="Point")for(const Lt of n.geometry)for(const br of Lt)rr([br],new Bh(br.x,br.y,0,0,void 0),O)}const O1=255,Uh=O1*Xu;function l3(l,n,o,h,p,x,v,w,C,A,k,P,O,G,W,te,se,oe,ge){const ve=function(Fe,Ze,Ye,Je,Tt,ot,Ct,Mt){const Bt=[];if(Ze.positionedLines.length===0)return Bt;const ir=Je.layout.get("text-rotate").evaluate(ot,{})*Math.PI/180,Jt=function(Ht){const rr=Ht[0],Lt=Ht[1],br=rr*Lt;return br>0?[rr,-Lt]:br<0?[-rr,Lt]:rr===0?[Lt,rr]:[Lt,-rr]}(Ye);let Ft=Math.abs(Ze.top-Ze.bottom);for(const Ht of Ze.positionedLines)Ft-=Ht.lineOffset;const Yt=Ze.positionedLines.length,wt=Ft/Yt;let vt=Ze.top-Ye[1];for(let Ht=0;Ht<Yt;++Ht){const rr=Ze.positionedLines[Ht];vt=PX(Ze,wt,vt,Ht);for(const Lt of rr.positionedGlyphs){if(!Lt.rect)continue;const br=Lt.rect||{};let Ir=OF+1,_r=!0,dr=1,En=0;if(Lt.image){const Mr=Ct.get(Lt.image.toString());if(!Mr)continue;if(Mr.sdf){ur("SDF images are not supported in formatted text and will be ignored.");continue}_r=!1,dr=Mr.pixelRatio,Ir=Cg/dr}const pr=(Tt||Mt)&&Lt.vertical,Qr=Lt.metrics.advance*Lt.scale/2,jn=Lt.metrics,Gn=Lt.rect;if(Gn===null)continue;Mt&&Ze.verticalizable&&(En=Lt.image?Qr-Lt.metrics.width*Lt.scale/2:0);const mi=Tt?[Lt.x+Qr,Lt.y]:[0,0];let Pn=[0,0],Ei=[0,0],Ci=!1;Tt||(pr?(Ei=[Lt.x+Qr+Jt[0],Lt.y+Jt[1]-En],Ci=!0):Pn=[Lt.x+Qr+Ye[0],Lt.y+Ye[1]-En]);const As=Gn.w*Lt.scale/(dr*(Lt.localGlyph?Yu:1)),Le=Gn.h*Lt.scale/(dr*(Lt.localGlyph?Yu:1));let Pe,jt,cr,It;if(pr){const Mr=Lt.y-vt,Mn=new At(-Qr,Qr-Mr),cn=-Math.PI/2,Dr=new At(...Ei);Pe=new At(-Qr+Pn[0],Pn[1]),Pe._rotateAround(cn,Mn)._add(Dr),Pe.x+=-Mr+Qr,Pe.y-=(jn.left-Ir)*Lt.scale;const Si=Lt.image?jn.advance*Lt.scale:oo*Lt.scale,Yi=String.fromCodePoint(Lt.glyph);fX(Yi)?Pe.x+=(1-Ir)*Lt.scale:pX(Yi)?Pe.x+=Si-jn.height*Lt.scale+(-Ir-1)*Lt.scale:Pe.x+=Lt.image||jn.width+2*Ir===Gn.w&&jn.height+2*Ir===Gn.h?(Si-Le)/2:(Si-(jn.height+2*Ir)*Lt.scale)/2,jt=new At(Pe.x,Pe.y-As),cr=new At(Pe.x+Le,Pe.y),It=new At(Pe.x+Le,Pe.y-As)}else{const Mr=(jn.left-Ir)*Lt.scale-Qr+Pn[0],Mn=(-jn.top-Ir)*Lt.scale+Pn[1],cn=Mr+As,Dr=Mn+Le;Pe=new At(Mr,Mn),jt=new At(cn,Mn),cr=new At(Mr,Dr),It=new At(cn,Dr)}if(ir){let Mr;Mr=Tt?new At(0,0):Ci?new At(Jt[0],Jt[1]):new At(Ye[0],Ye[1]),Pe._rotateAround(ir,Mr),jt._rotateAround(ir,Mr),cr._rotateAround(ir,Mr),It._rotateAround(ir,Mr)}const fr=new At(0,0),Br=new At(0,0);Bt.push({tl:Pe,tr:jt,bl:cr,br:It,texPrimary:br,texSecondary:void 0,writingMode:Ze.writingMode,glyphOffset:mi,sectionIndex:Lt.sectionIndex,isSDF:_r,pixelOffsetTL:fr,pixelOffsetBR:Br,minFontScaleX:0,minFontScaleY:0})}}return Bt}(0,h,C,x,v,w,p,l.allowVerticalPlacement),Te=l.textSizeData;let $e=null;Te.kind==="source"?($e=[Xu*x.layout.get("text-size").evaluate(w,{},se)*W.textScaleFactor],$e[0]>Uh&&ur(`${l.layerIds[0]}: Value for "text-size" is >= ${O1}. Reduce your "text-size".`)):Te.kind==="composite"&&($e=[Xu*W.compositeTextSizes[0].evaluate(w,{},se)*W.textScaleFactor,Xu*W.compositeTextSizes[1].evaluate(w,{},se)*W.textScaleFactor],($e[0]>Uh||$e[1]>Uh)&&ur(`${l.layerIds[0]}: Value for "text-size" is >= ${O1}. Reduce your "text-size".`)),l.addSymbols(l.text,ve,$e,C,v,w,k,n,o,A.lineStartIndex,A.lineLength,G,te,se,ge,!1,oe,ve.length);for(const Fe of P)O[Fe]=l.text.placedSymbolArray.length-1;return 4*ve.length}function dI(l){for(const n in l)return l[n];return null}function DS(l,n,o,h,p,x,v,w,C,A,k){let P,O,G,W;if(P=k?k.top:v.top,O=k?k.bottom:v.bottom,G=k?k.left:v.left,W=k?k.right:v.right,VF(v)&&v.collisionPadding){const te=v.collisionPadding;G-=te[0],P-=te[1],W+=te[2],O+=te[3]}if(C){const te=new At(G,P),se=new At(W,P),oe=new At(G,O),ge=new At(W,O),ve=lt(C);let Te=new At(0,0);A&&(Te=new At(A[0],A[1])),te._rotateAround(ve,Te),se._rotateAround(ve,Te),oe._rotateAround(ve,Te),ge._rotateAround(ve,Te),G=Math.min(te.x,se.x,oe.x,ge.x),W=Math.max(te.x,se.x,oe.x,ge.x),P=Math.min(te.y,se.y,oe.y,ge.y),O=Math.max(te.y,se.y,oe.y,ge.y)}return l.emplaceBack(n.x,n.y,n.z,o.x,o.y,G,P,W,O,w,h,p,x),l.length-1}function hI(l){VF(l)&&l.collisionPadding&&(l.top-=l.collisionPadding[1],l.bottom+=l.collisionPadding[3]);const n=l.bottom-l.top;return n>0?Math.max(10,n):null}function VX(l,n,o,h){const p=l.compareText;if(n in p){const x=p[n];for(let v=x.length-1;v>=0;v--)if(h.dist(x[v])<o)return!0}else p[n]=[];return p[n].push(h),!1}function c3(l,n){const o=l.fovAboveCenter,h=l.elevation?l.elevation.getMinElevationBelowMSL()*n:0,p=(l._camera.position[2]*l.worldSize-h)/Math.cos(l._pitch),x=Math.sin(o)*p/Math.sin(Math.max(Math.PI/2-l._pitch-o,.01));let v=Math.sin(l._pitch)*x+p;const w=p*(1/l._horizonShift);if(!l.elevation||l.elevation.exaggeration()===0){let C=Math.max(l.zoom-17,0);l.isOrthographic&&(C/=10),v*=1+C}return Math.min(1.01*v,w)}function F1(l,n){if(!n.isReprojectedInTileSpace)return{scale:1<<l.z,x:l.x,y:l.y,x2:l.x+1,y2:l.y+1,projection:n};const o=Math.pow(2,-l.z),h=l.x*o,p=(l.x+1)*o,x=l.y*o,v=(l.y+1)*o,w=je(h),C=je(p),A=we(x),k=we(v),P=n.project(w,A),O=n.project(C,A),G=n.project(C,k),W=n.project(w,k);let te=Math.min(P.x,O.x,G.x,W.x),se=Math.min(P.y,O.y,G.y,W.y),oe=Math.max(P.x,O.x,G.x,W.x),ge=Math.max(P.y,O.y,G.y,W.y);const ve=o/16;function Te(Fe,Ze,Ye,Je,Tt,ot){const Ct=(Ye+Tt)/2,Mt=(Je+ot)/2,Bt=n.project(je(Ct),we(Mt)),ir=Math.max(0,te-Bt.x,se-Bt.y,Bt.x-oe,Bt.y-ge);te=Math.min(te,Bt.x),oe=Math.max(oe,Bt.x),se=Math.min(se,Bt.y),ge=Math.max(ge,Bt.y),ir>ve&&(Te(Fe,Bt,Ye,Je,Ct,Mt),Te(Bt,Ze,Ct,Mt,Tt,ot))}Te(P,O,h,x,p,x),Te(O,G,p,x,p,v),Te(G,W,p,v,h,v),Te(W,P,h,v,h,x),te-=ve,se-=ve,oe+=ve,ge+=ve;const $e=1/Math.max(oe-te,ge-se);return{scale:$e,x:te*$e,y:se*$e,x2:oe*$e,y2:ge*$e,projection:n}}function u3(l,{x:n,y:o},h=0){return new At(((n-h)*l.scale-l.x)*ar,(o*l.scale-l.y)*ar)}const $X=U(new Float32Array(16));class mp{constructor(n){this.spec=n,this.name=n.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(n,o){return{x:0,y:0,z:0}}unproject(n,o){return new X(0,0)}projectTilePoint(n,o,h){return{x:n,y:o,z:0}}locationPoint(n,o,h,p=!0){return n._coordinatePoint(n.locationCoordinate(o,h),p)}pixelsPerMeter(n,o){return xe(1,n)*o}pixelSpaceConversion(n,o,h){return 1}farthestPixelDistance(n){return c3(n,n.pixelsPerMeter)}pointCoordinate(n,o,h,p){const x=n.horizonLineFromTop(!1),v=new At(o,Math.max(x,h));return n.rayIntersectionCoordinate(n.pointRayIntersection(v,p))}pointCoordinate3D(n,o,h){const p=new At(o,h);if(n.elevation)return n.elevation.pointCoordinate(p);{const x=this.pointCoordinate(n,p.x,p.y,0);return[x.x,x.y,x.z]}}isPointAboveHorizon(n,o){if(n.elevation&&n.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(n,o.x,o.y);const h=n.horizonLineFromTop();return o.y<h}createInversionMatrix(n,o){return $X}createTileMatrix(n,o,h){let p,x,v;const w=h.canonical,C=U(new Float64Array(16));if(this.isReprojectedInTileSpace){const A=F1(w,this);p=1,x=A.x+h.wrap*A.scale,v=A.y,ne(C,C,[p/A.scale,p/A.scale,n.pixelsPerMeter/o])}else p=o/n.zoomScale(w.z),x=(w.x+Math.pow(2,w.z)*h.wrap)*p,v=w.y*p;return J(C,C,[x,v,0]),ne(C,C,[p/ar,p/ar,1]),C}upVector(n,o,h){return[0,0,1]}upVectorScale(n,o,h){return{metersToTile:1}}}class qX extends mp{constructor(n){super(n),this.range=[4,7],this.center=n.center||[-96,37.5];const[o,h]=this.parallels=n.parallels||[29.5,45.5],p=Math.sin(lt(o));this.n=(p+Math.sin(lt(h)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(n,o){const{n:h,c:p,r0:x}=this,v=lt(n-this.center[0]),w=lt(o),C=Math.sqrt(p-2*h*Math.sin(w))/h;return{x:C*Math.sin(v*h),y:C*Math.cos(v*h)-x,z:0}}unproject(n,o){const{n:h,c:p,r0:x}=this,v=x+o;let w=Math.atan2(n,Math.abs(v))*Math.sign(v);v*h<0&&(w-=Math.PI*Math.sign(n)*Math.sign(v));const C=lt(this.center[0])*h;w=ce(w,-Math.PI-C,Math.PI-C);const A=K(Er(w/h)+this.center[0],-180,180),k=Math.asin(K((p-(n*n+v*v)*h*h)/(2*h),-1,1)),P=K(Er(k),-Ne,Ne);return new X(A,P)}}const L1=1.340264,z1=-.081106,B1=893e-6,U1=.003796,RS=Math.sqrt(3)/2;class GX extends mp{project(n,o){o=o/180*Math.PI,n=n/180*Math.PI;const h=Math.asin(RS*Math.sin(o)),p=h*h,x=p*p*p;return{x:.5*(n*Math.cos(h)/(RS*(L1+3*z1*p+x*(7*B1+9*U1*p)))/Math.PI+.5),y:1-.5*(h*(L1+z1*p+x*(B1+U1*p))/Math.PI+1),z:0}}unproject(n,o){n=(2*n-.5)*Math.PI;let h=o=(2*(1-o)-1)*Math.PI,p=h*h,x=p*p*p;for(let k,P,O,G=0;G<12&&(P=h*(L1+z1*p+x*(B1+U1*p))-o,O=L1+3*z1*p+x*(7*B1+9*U1*p),k=P/O,h=K(h-k,-Math.PI/3,Math.PI/3),p=h*h,x=p*p*p,!(Math.abs(k)<1e-12));++G);const v=RS*n*(L1+3*z1*p+x*(7*B1+9*U1*p))/Math.cos(h),w=Math.asin(Math.sin(h)/RS),C=K(180*v/Math.PI,-180,180),A=K(180*w/Math.PI,-Ne,Ne);return new X(C,A)}}class WX extends mp{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0}project(n,o){return{x:.5+n/360,y:.5-o/360,z:0}}unproject(n,o){const h=360*(n-.5),p=K(360*(.5-o),-Ne,Ne);return new X(h,p)}}const K0=Math.PI/2;function MS(l){return Math.tan((K0+l)/2)}class HX extends mp{constructor(n){super(n),this.center=n.center||[0,30];const[o,h]=this.parallels=n.parallels||[30,30];let p=lt(o),x=lt(h);this.southernCenter=p+x<0,this.southernCenter&&(p=-p,x=-x);const v=Math.cos(p),w=MS(p);this.n=p===x?Math.sin(p):Math.log(v/Math.cos(x))/Math.log(MS(x)/w),this.f=v*Math.pow(MS(p),this.n)/this.n}project(n,o){o=lt(o),this.southernCenter&&(o=-o),n=lt(n-this.center[0]);const h=1e-6,{n:p,f:x}=this;x>0?o<-K0+h&&(o=-K0+h):o>K0-h&&(o=K0-h);const v=x/Math.pow(MS(o),p);let w=v*Math.sin(p*n),C=x-v*Math.cos(p*n);return w=.5*(w/Math.PI+.5),C=.5*(C/Math.PI+.5),{x:w,y:this.southernCenter?C:1-C,z:0}}unproject(n,o){n=(2*n-.5)*Math.PI,this.southernCenter&&(o=1-o),o=(2*(1-o)-.5)*Math.PI;const{n:h,f:p}=this,x=p-o,v=Math.sign(x),w=Math.sign(h)*Math.sqrt(n*n+x*x);let C=Math.atan2(n,Math.abs(x))*v;x*h<0&&(C-=Math.PI*Math.sign(n)*v);const A=K(Er(C/h)+this.center[0],-180,180),k=K(Er(2*Math.atan(Math.pow(p/w,1/h))-K0),-Ne,Ne);return new X(A,this.southernCenter?-k:k)}}class d3 extends mp{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(n,o){return{x:fe(n),y:de(o),z:0}}unproject(n,o){const h=je(n),p=we(o);return new X(h,p)}}const h3=lt(Ne);class ZX extends mp{project(n,o){const h=(o=lt(o))*o,p=h*h;return{x:.5*((n=lt(n))*(.8707-.131979*h+p*(p*(.003971*h-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(o*(1.007226+h*(.015085+p*(.028874*h-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(n,o){n=(2*n-.5)*Math.PI;let h=o=(2*(1-o)-1)*Math.PI,p=25,x=0,v=h*h;do{v=h*h;const A=v*v;x=(h*(1.007226+v*(.015085+A*(.028874*v-.044475-.005916*A)))-o)/(1.007226+v*(.045255+A*(.259866*v-.311325-.005916*11*A))),h=K(h-x,-h3,h3)}while(Math.abs(x)>1e-6&&--p>0);v=h*h;const w=K(Er(n/(.8707+v*(v*(v*v*v*(.003971-.001529*v)-.013791)-.131979))),-180,180),C=Er(h);return new X(w,C)}}const f3=lt(Ne);class XX extends mp{project(n,o){o=lt(o),n=lt(n);const h=Math.cos(o),p=2/Math.PI,x=Math.acos(h*Math.cos(n/2)),v=Math.sin(x)/x,w=.5*(n*p+2*h*Math.sin(n/2)/v)||0,C=.5*(o+Math.sin(o)/v)||0;return{x:.5*(w/Math.PI+.5),y:1-.5*(C/Math.PI+1),z:0}}unproject(n,o){let h=n=(2*n-.5)*Math.PI,p=o=(2*(1-o)-1)*Math.PI,x=25;const v=1e-6;let w=0,C=0;do{const A=Math.cos(p),k=Math.sin(p),P=2*k*A,O=k*k,G=A*A,W=Math.cos(h/2),te=Math.sin(h/2),se=2*W*te,oe=te*te,ge=1-G*W*W,ve=ge?1/ge:0,Te=ge?Math.acos(A*W)*Math.sqrt(1/ge):0,$e=.5*(2*Te*A*te+2*h/Math.PI)-n,Fe=.5*(Te*k+p)-o,Ze=.5*ve*(G*oe+Te*A*W*O)+1/Math.PI,Ye=ve*(se*P/4-Te*k*te),Je=.125*ve*(P*te-Te*k*G*se),Tt=.5*ve*(O*W+Te*oe*A)+.5,ot=Ye*Je-Tt*Ze;w=(Fe*Ye-$e*Tt)/ot,C=($e*Je-Fe*Ze)/ot,h=K(h-w,-Math.PI,Math.PI),p=K(p-C,-f3,f3)}while((Math.abs(w)>v||Math.abs(C)>v)&&--x>0);return new X(Er(h),Er(p))}}class p3 extends mp{constructor(n){super(n),this.center=n.center||[0,0],this.parallels=n.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(lt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(n,o){const{scale:h,cosPhi:p}=this;return{x:lt(n)*p*h+.5,y:-Math.sin(lt(o))/p*h+.5,z:0}}unproject(n,o){const{scale:h,cosPhi:p}=this,x=-(o-.5)/h,v=K(Er((n-.5)/h)/p,-180,180),w=Math.asin(K(x*p,-1,1)),C=K(Er(w),-Ne,Ne);return new X(v,C)}}class YX extends d3{constructor(n){super(n),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(n,o,h){const p=h1(n,o,h);return nn(p,p,sS(qd(h))),{x:p[0],y:p[1],z:p[2]}}locationPoint(n,o,h){const p=N(o.lat,o.lng),x=zt([],p),v=h?n._centerAltitude+h:n.elevation?n.elevation.getAtPointOrZero(n.locationCoordinate(o),n._centerAltitude):n._centerAltitude;Se(p,p,x,xe(1,0)*ar*v);const w=U(new Float64Array(16));return z(w,n.pixelMatrix,n.globeMatrix),nn(p,p,w),new At(p[0],p[1])}pixelsPerMeter(n,o){return xe(1,0)*o}pixelSpaceConversion(n,o,h){const p=xe(1,n)*o,x=fn(xe(1,45)*o,p,h);return this.pixelsPerMeter(n,o)/x}createTileMatrix(n,o,h){const p=xj(qd(h.canonical));return z(new Float64Array(16),n.globeMatrix,p)}createInversionMatrix(n,o){const{center:h}=n,p=sS(qd(o));return le(p,p,lt(h.lng)),me(p,p,lt(h.lat)),ne(p,p,[n._pixelsPerMercatorPixel,n._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(n,o,h,p){return LM(n,o,h,!0)||new st(0,0)}pointCoordinate3D(n,o,h){const p=this.pointCoordinate(n,o,h,0);return[p.x,p.y,p.z]}isPointAboveHorizon(n,o){return!LM(n,o.x,o.y,!1)}farthestPixelDistance(n){const o=function(p,x){const v=p.cameraToCenterDistance,w=p._centerAltitude*x,C=p._camera,A=p._camera.forward(),k=Me([],he([],A,-v),[0,0,w]),P=p.worldSize/(2*Math.PI),O=[0,0,-P],G=p.width/p.height,W=Math.tan(p.fovAboveCenter),te=he([],C.up(),W),se=he([],C.right(),W*G),oe=zt([],Me([],Me([],A,te),se)),ge=[];let ve;if(new Fn(k,oe).closestPointOnSphere(O,P,ge)){const Te=Me([],ge,O),$e=Nn([],Te,k);ve=Math.cos(p.fovAboveCenter)*gt($e)}else{const Te=Nn([],k,O),$e=Nn([],O,k);zt($e,$e);const Fe=gt(Te)-P;ve=Math.sqrt(Fe*(Fe+2*P));const Ze=Math.acos(ve/(P+Fe))-Math.acos(Gt(A,$e));ve*=Math.cos(Ze)}return 1.01*ve}(n,this.pixelsPerMeter(n.center.lat,n.worldSize)),h=dp(n.zoom);if(h>0){const p=c3(n,xe(1,n.center.lat)*n.worldSize),x=n.worldSize/(2*Math.PI),v=Math.max(n.width,n.height)/n.worldSize*Math.PI;return fn(o,p+x*(1-Math.cos(v)),Math.pow(h,10))}return o}upVector(n,o,h){return h1(o,h,n,1)}upVectorScale(n){return{metersToTile:rS(iS(qd(n)))}}}function m3(l){const n=l.parallels,o=!!n&&Math.abs(n[0]+n[1])<.01;switch(l.name){case"mercator":return new d3(l);case"equirectangular":return new WX(l);case"naturalEarth":return new ZX(l);case"equalEarth":return new GX(l);case"winkelTripel":return new XX(l);case"albers":return o?new p3(l):new qX(l);case"lambertConformalConic":return o?new p3(l):new HX(l);case"globe":return new YX(l)}throw new Error(`Invalid projection name: ${l.name}`)}const KX=qt.types,JX=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function V1(l,n,o,h,p,x,v,w,C,A,k,P,O){const G=w?Math.min(Uh,Math.round(w[0])):0,W=w?Math.min(Uh,Math.round(w[1])):0;l.emplaceBack(n,o,Math.round(32*h),Math.round(32*p),x,v,(G<<1)+(C?1:0),0+(W<<1),16*A,16*k,256*P,256*O)}function $1(l,n,o){l.emplaceBack(n,o)}function q1(l,n,o,h,p,x,v){l.emplaceBack(n,o,h,p,x,v)}const OS=(l,n,o,h)=>{for(let p=0;p<n;p++)l.emplaceBack(o[0],o[1],o[2],h[0],h[1],h[2])};function J0(l,n,o,h,p){l.emplaceBack(n,o,h,p),l.emplaceBack(n,o,h,p),l.emplaceBack(n,o,h,p),l.emplaceBack(n,o,h,p)}function QX(l){for(const n of l.sections)if(tj(n.text))return!0;return!1}class fI{constructor(n){this.layoutVertexArray=new C0,this.indexArray=new bs,this.programConfigurations=n,this.segments=new Fs,this.dynamicLayoutVertexArray=new Vd,this.opacityVertexArray=new Yy,this.placedSymbolArray=new mg,this.iconTransitioningVertexArray=new uc,this.globeExtVertexArray=new rp,this.zOffsetVertexArray=new qu,this.orientationVertexArray=new Qy,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(n,o){const h=[],p=this.layoutVertexArray.uint16;for(let x=0;x<o;++x){const v=12*(n+x);h.push(...p.slice(v,v+12))}return h}updateIconVertexData(n,o,h,p,x,v,w,C,A,k,P,O,G){const W=this.layoutVertexArray.uint16,te=12*n;W[te]=o,W[te+1]=h,W[te+2]=p,W[te+3]=x,W[te+4]=v,W[te+5]=w,W[te+6]=C,W[te+7]=A,W[te+8]=k,W[te+9]=P,W[te+10]=O,W[te+11]=G}upload(n,o,h,p,x,v){this.isEmpty()||(h&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,nX.members,!!v),this.indexBuffer=n.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,sX.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,JX,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=n.createVertexBuffer(this.iconTransitioningVertexArray,lX.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,iX.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||x)&&(this.zOffsetVertexBuffer=n.createVertexBuffer(this.zOffsetVertexArray,aX.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=n.createVertexBuffer(this.orientationVertexArray,oX.members,!0)),this.opacityVertexBuffer.itemSize=1),(h||p)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Tr(fI,"SymbolBuffers");class pI{constructor(n,o,h){this.layoutVertexArray=new n,this.layoutAttributes=o,this.indexArray=new h,this.segments=new Fs,this.collisionVertexArray=new ip,this.collisionVertexArrayExt=new Vd}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,cX.members,!0),this.collisionVertexBufferExt=n.createVertexBuffer(this.collisionVertexArrayExt,uX.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Tr(pI,"CollisionBuffers");class FS{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(v=>v.fqid),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=U([]),this.placementViewportMatrix=U([]);const o=this.layers[0]._unevaluatedLayout._values;this.worldview=n.worldview,this.textSizeData=H0(this.zoom,o["text-size"],this.worldview),this.iconSizeData=H0(this.zoom,o["icon-size"],this.worldview);const h=this.layers[0].layout,p=h.get("symbol-sort-key"),x=h.get("symbol-z-order");this.lut=n.lut,this.canOverlap=h.get("text-allow-overlap")||h.get("icon-allow-overlap")||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=h.get("text-writing-mode").map(v=>zl[v]),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=n.sourceID,this.projection=n.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null}hasAnyAppearanceProperty(n){const o=this.layers[0].getAppearances();return!(!o||o.length===0)&&o.some(h=>h.getProperty(n)!=null)}createArrays(){this.text=new fI(new Rc(this.layers,{zoom:this.zoom,lut:this.lut},n=>n.startsWith("text")||n.startsWith("symbol"))),this.icon=new fI(new Rc(this.layers,{zoom:this.zoom,lut:this.lut},n=>n.startsWith("icon")||n.startsWith("symbol"))),this.glyphOffsetArray=new a1,this.lineVertexArray=new W2,this.symbolInstances=new G2}calculateGlyphDependencies(n,o,h,p,x){for(const v of n){const w=v.codePointAt(0);if(w===void 0)break;if(o[w]=!0,p&&x&&w<=65535){const C=k1[v];C&&(o[C.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(n,o,h,p,x,v){let w=1;const C=n.getUnevaluatedProperties()._values["icon-size"],A=H0(this.zoom,C,this.worldview),k=Z0(A,o);if(A.kind!=="constant"&&A.kind!=="camera"||(w=k.uSize),A.kind==="composite"){const{minZoom:P,maxZoom:O}=A,G=C.possiblyEvaluate(new us(P,{worldview:this.worldview}),p),W=C.possiblyEvaluate(new us(O,{worldview:this.worldview}),p),te=G.evaluate(h,{},p,x);w=te+(W.evaluate(h,{},p,x)-te)*k.uSizeT}return A.kind==="source"&&(w=C.possiblyEvaluate(new us(this.zoom,{worldview:this.worldview}),p).evaluate(h,{},p,x)),w*v}updateFootprints(n,o){}updateReplacement(n,o){if(o.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=o.updateTime;const h=o.getReplacementRegionsForTile(n.toUnwrapped(),!0);return!dS(this.activeReplacements,h)&&(this.activeReplacements=h,!0)}getResolvedImageFromTokens(n){return typeof n=="string"?el.build(n):n}populate(n,o,h,p){const x=this.layers[0],v=x.layout,w=this.projection.name==="globe",C=v.get("text-font"),A=v.get("text-field"),k=v.get("icon-image"),[P,O]=v.get("icon-size-scale-range"),G=K(o.scaleFactor||1,P,O),W=(A.value.kind!=="constant"||A.value.value instanceof Ha&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(C.value.kind!=="constant"||C.value.value.length>0),te=k.value.kind!=="constant"||!!k.value.value||Object.keys(k.parameters).length>0,se=this.hasAnyAppearanceProperty("icon-image"),oe=v.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!W&&!te&&!se)return;const ge=o.iconDependencies,ve=o.glyphDependencies,Te=o.availableImages,$e=new us(this.zoom,{worldview:this.worldview,activeFloors:o.activeFloors}),Fe=Ze=>{const Ye=Ze.id.toString();ge.has(Ye)?ge.get(Ye).push(Ze):ge.set(Ye,[Ze])};for(const Ze of n){const{feature:Ye,id:Je,index:Tt,sourceLayerIndex:ot}=Ze,Ct=x._featureFilter.needGeometry,Mt=xt(Ye,Ct);if(!x._featureFilter.filter($e,Mt,h))continue;if(Ct||(Mt.geometry=Pt(Ye,h,p)),w&&Ye.type!==1&&h.z<=5){const Ht=Mt.geometry,rr=.98078528056,Lt=(br,Ir)=>Gt(h1(br.x,br.y,h,1),h1(Ir.x,Ir.y,h,1))<rr;for(let br=0;br<Ht.length;br++)Ht[br]=kt(Ht[br],Lt)}let Bt,ir;if(W){const Ht=x.getValueAndResolveTokens("text-field",Mt,h,Te),rr=Ha.factory(Ht);QX(rr)&&(this.hasRTLText=!0),(!this.hasRTLText||Uy()==="unavailable"||this.hasRTLText&&_l.isParsed())&&(Bt=hX(rr,x,Mt))}if(te){const Ht=x.getValueAndResolveTokens("icon-image",Mt,h,Te);ir=this.getResolvedImageFromTokens(Ht)}const Jt=this.layers[0];let Ft=!1;if(!ir&&se){const Ht=Jt.getAppearances();for(const rr of Ht)if(rr.getProperty("icon-image")){const Lt=Jt.getAppearanceValueAndResolveTokens(rr,"icon-image",Mt,h,Te);if(Lt){ir=this.getResolvedImageFromTokens(Lt),Ft=!0;break}}}if(!Bt&&!ir)continue;const Yt=this.sortFeaturesByKey?oe.evaluate(Mt,{},h):void 0,wt={id:Je,text:Bt,icon:ir,index:Tt,sourceLayerIndex:ot,geometry:Mt.geometry,properties:Ye.properties,type:KX[Ye.type],sortKey:Yt};if(this.features.push(wt),this.appearanceFeatureData.push({id:Je,properties:Ye.properties,usesAppearanceIconAsPlaceholder:Ft,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),ir){const Ht=Jt._unevaluatedLayout._values,{iconPrimary:rr,iconSecondary:Lt}=M1(ir,this.iconSizeData,Ht["icon-size"],h,this.zoom,wt,this.pixelRatio,G,this.worldview);Fe(rr),Lt&&(this.hasAnySecondaryIcon=!0,Fe(Lt))}const vt=Jt.getAppearances();if(vt.length!==0&&vt.forEach(Ht=>{if(!Ht.getProperty("icon-image"))return;const rr=this.getCombinedIconPrimary(Ht,Jt,Mt,h,Te,wt,G);rr&&Fe(rr)}),Bt){const Ht=C.evaluate(Mt,{},h).join(","),rr=v.get("text-rotation-alignment")==="map"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(zl.vertical)>=0;for(const Lt of Bt.sections)if(Lt.image){const br=Lt.image.getPrimary().scaleSelf(this.pixelRatio),Ir=br.id.toString(),_r=ge.get(Ir)||[];_r.push(br),ge.set(Ir,_r)}else{const br=My(Bt.toString()),Ir=Lt.fontStack||Ht,_r=ve[Ir]=ve[Ir]||{};this.calculateGlyphDependencies(Lt.text,_r,rr,this.allowVerticalPlacement,br)}}}if(v.get("symbol-placement")==="line"&&(this.features=function(Ze){const Ye={},Je={},Tt=[];let ot=0;function Ct(Jt){Tt.push(Ze[Jt]),ot++}function Mt(Jt,Ft,Yt){const wt=Je[Jt];return delete Je[Jt],Je[Ft]=wt,Tt[wt].geometry[0].pop(),Tt[wt].geometry[0]=Tt[wt].geometry[0].concat(Yt[0]),wt}function Bt(Jt,Ft,Yt){const wt=Ye[Ft];return delete Ye[Ft],Ye[Jt]=wt,Tt[wt].geometry[0].shift(),Tt[wt].geometry[0]=Yt[0].concat(Tt[wt].geometry[0]),wt}function ir(Jt,Ft,Yt){const wt=Yt?Ft[0][Ft[0].length-1]:Ft[0][0];return`${Jt}:${wt.x}:${wt.y}`}for(let Jt=0;Jt<Ze.length;Jt++){const Ft=Ze[Jt],Yt=Ft.geometry,wt=Ft.text?Ft.text.toString():null;if(!wt){Ct(Jt);continue}const vt=ir(wt,Yt),Ht=ir(wt,Yt,!0);if(vt in Je&&Ht in Ye&&Je[vt]!==Ye[Ht]){const rr=Bt(vt,Ht,Yt),Lt=Mt(vt,Ht,Tt[rr].geometry);delete Ye[vt],delete Je[Ht],Je[ir(wt,Tt[Lt].geometry,!0)]=Lt,Tt[rr].geometry=null}else vt in Je?Mt(vt,Ht,Yt):Ht in Ye?Bt(vt,Ht,Yt):(Ct(Jt),Ye[vt]=ot-1,Je[Ht]=ot-1)}return Tt.filter(Jt=>Jt.geometry)}(this.features)),v.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",o.elevationFeatures){!this.elevationFeatures&&o.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Ze of o.elevationFeatures)this.elevationFeatureIdToIndex.set(Ze.id,this.elevationFeatures.length),this.elevationFeatures.push(Ze)}}else v.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Ze,Ye)=>Ze.sortKey-Ye.sortKey)}getCombinedIconPrimary(n,o,h,p,x,v,w){let C,A;const k=n.getUnevaluatedProperties();if(k._values["icon-image"].value!==void 0){const P=o.getAppearanceValueAndResolveTokens(n,"icon-image",h,p,x);C=this.getResolvedImageFromTokens(P)}else{const P=o.getValueAndResolveTokens("icon-image",h,p,x);C=this.getResolvedImageFromTokens(P)}if(C){const P=k._values["icon-size"]||o._unevaluatedLayout._values["icon-size"];A=M1(C,H0(this.zoom,P,this.worldview),P,p,this.zoom,v,this.pixelRatio,w,this.worldview).iconPrimary}return A}updateAppearanceBasedIconTextures(n,o,h,p){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const x=this.layers[0];let v=!1,w=0;const C=x.layout,[A,k]=C.get("icon-size-scale-range"),P=K(1,A,k);for(let O=0;O<this.symbolInstances.length;O++){const G=this.symbolInstances.get(O),W=this.appearanceFeatureData[G.featureIndex];if(W&&G.placedIconSymbolIndex>=0){const te=W.id,se=o&&te!==void 0?o[String(te)]:void 0,oe={type:"Point",id:W.id,properties:W.properties,geometry:[]},ge=this.layers[0].appearances&&this.layers[0].appearances.find(ve=>ve.isActive({globals:p,feature:oe,canonical:n,featureState:se}));if(W.activeAppearance===ge)continue;if(ge){W.activeAppearance=ge;const ve={sortKey:void 0,text:void 0,icon:null,index:G.featureIndex,sourceLayerIndex:G.featureIndex,geometry:[],properties:W.properties,type:"Point",id:W.id};if(!ge.hasCachedIconPrimary()){const Ze=this.getCombinedIconPrimary(ge,x,oe,n,h,ve,P);ge.setCachedIconPrimary(Ze)}const Te=ge.getCachedIconPrimary();if(!Te)continue;const $e=Te.toString(),Fe=this.iconAtlasPositions&&this.iconAtlasPositions.get($e);if(Fe){const Ze=x.getAppearanceValueAndResolveTokens(ge,"icon-offset",oe,n,h),Ye=Ze&&Array.isArray(Ze)?Ze:[0,0];let Je=AS(Fe,void 0,Ye,x.layout.get("icon-anchor").evaluate(oe,{},n));const Tt=x.getAppearanceValueAndResolveTokens(ge,"icon-rotate",oe,n,h),ot=typeof Tt=="number"?Tt:0,Ct=Fe.sdf,Mt=x.layout.get("icon-text-fit").constantOr("none");Mt!=="none"&&W.textShaping&&W.iconTextFitPadding&&W.fontScale&&(Je=iI(Je,W.textShaping,Mt,W.iconTextFitPadding,Ye,W.fontScale));const Bt=this.calculateEffectiveAppearanceIconSize(ge,p.zoom,oe,n,h,P),ir=0,Jt=1+(Math.min(Uh,Math.round(Bt*Xu))<<1),Ft=lI(Je,ot,Ct,Mt!=="none",P);W.isUsingAppearanceVertexData||(W.isUsingAppearanceVertexData=!0,W.layoutBasedVertexData=this.icon.getIconVertexData(w,G.numIconVertices));for(let wt=0;wt<Ft.length;++wt){const vt=Ft[wt],Ht=W.layoutBasedVertexData[0]||G.tileAnchorX,rr=W.layoutBasedVertexData[1]||G.tileAnchorY,Lt=16*vt.pixelOffsetTL.x,br=16*vt.pixelOffsetTL.y,Ir=16*vt.pixelOffsetBR.x,_r=16*vt.pixelOffsetBR.y,dr=16*vt.minFontScaleX,En=16*vt.minFontScaleY;this.icon.updateIconVertexData(w,Ht,rr,Math.round(32*vt.tl.x),Math.round(32*vt.tl.y),vt.texPrimary.x,vt.texPrimary.y,ir,Jt,Lt,br,dr,En),this.icon.updateIconVertexData(w+1,Ht,rr,Math.round(32*vt.tr.x),Math.round(32*vt.tr.y),vt.texPrimary.x+vt.texPrimary.w,vt.texPrimary.y,ir,Jt,Ir,br,dr,En),this.icon.updateIconVertexData(w+2,Ht,rr,Math.round(32*vt.bl.x),Math.round(32*vt.bl.y),vt.texPrimary.x,vt.texPrimary.y+vt.texPrimary.h,ir,Jt,Lt,_r,dr,En),this.icon.updateIconVertexData(w+3,Ht,rr,Math.round(32*vt.br.x),Math.round(32*vt.br.y),vt.texPrimary.x+vt.texPrimary.w,vt.texPrimary.y+vt.texPrimary.h,ir,Jt,Ir,_r,dr,En),w+=4}const Yt=G.numIconVertices-4*Ft.length;for(let wt=0;wt<Yt;++wt)this.icon.updateIconVertexData(w+wt,0,0,0,0,0,0,0,0,0,0,0,0);v=!0}else w+=G.numIconVertices}else if(W.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(w,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(w+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(w+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(w+3,0,0,0,0,0,0,0,0,0,0,0,0),v=!0),w+=G.numIconVertices,W.activeAppearance=null;else if(W.isUsingAppearanceVertexData){const Te=W.layoutBasedVertexData.length/12;for(let $e=0;$e<Te;++$e){const Fe=$e*12;this.icon.updateIconVertexData(w+$e,W.layoutBasedVertexData[Fe+0],W.layoutBasedVertexData[Fe+1],W.layoutBasedVertexData[Fe+2],W.layoutBasedVertexData[Fe+3],W.layoutBasedVertexData[Fe+4],W.layoutBasedVertexData[Fe+5],W.layoutBasedVertexData[Fe+6],W.layoutBasedVertexData[Fe+7],W.layoutBasedVertexData[Fe+8],W.layoutBasedVertexData[Fe+9],W.layoutBasedVertexData[Fe+10],W.layoutBasedVertexData[Fe+11])}w+=Te,W.isUsingAppearanceVertexData=!1,W.activeAppearance=null,v=!0}else w+=G.numIconVertices,W.activeAppearance=null}}return v}update(n,o,h,p,x,v,w){this.text.programConfigurations.updatePaintArrays(n,o,x,h,p,v,w,this.worldview),this.icon.programConfigurations.updatePaintArrays(n,o,x,h,p,v,w,this.worldview)}updateRoadElevation(n){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let o=!1;const h=We(n),p=1/h;let x=!1,v=!1;for(let w=0;w<this.symbolInstances.length;w++){const C=this.symbolInstances.get(w),A=Xe(1,0,0),k=Xe(0,1,0),{numHorizontalGlyphVertices:P,numVerticalGlyphVertices:O,numIconVertices:G,numVerticalIconVertices:W}=C,te=P>0||O>0,se=G>0,oe=this.elevationFeatures[C.elevationFeatureIndex];if(oe){const ge=new At(C.tileAnchorX,C.tileAnchorY),ve=.075+oe.pointElevation(ge);C.zOffset!==ve&&(o=!0,C.zOffset=ve),ve!==0&&(this.hasAnyZOffset=!0);const Te=oe.computeSlopeNormal(ge,p),$e=ms(Nr(),Xe(0,0,1),Te);ei(A,A,$e),ei(k,k,$e),A[2]*=h,k[2]*=h,A[0]===1&&A[1]===0&&A[2]===0&&k[0]===0&&k[1]===1&&k[2]===0||(x=x||te,v=v||se)}if(te&&(OS(this.text.orientationVertexArray,P,A,k),OS(this.text.orientationVertexArray,O,A,k)),se){const{placedIconSymbolIndex:ge,verticalPlacedIconSymbolIndex:ve}=C;ge>=0&&OS(this.icon.orientationVertexArray,G,A,k),ve>=0&&OS(this.icon.orientationVertexArray,W,A,k)}}x||(this.text.orientationVertexArray=void 0),v||(this.icon.orientationVertexArray=void 0),o&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const n=(x,v,w)=>{h+=v,h>x.length&&x.resize(h);for(let C=-v;C<0;C++)x.emplace(C+h,w)},o=(x,v,w)=>{p+=v,p>x.length&&x.resize(p);for(let C=-v;C<0;C++)x.emplace(C+p,w)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let h=0,p=0;for(let x=0;x<this.symbolInstances.length;x++){const v=this.symbolInstances.get(x),{numHorizontalGlyphVertices:w,numVerticalGlyphVertices:C,numIconVertices:A}=v,k=v.zOffset,P=A>0;if((w>0||C>0)&&(n(this.text.zOffsetVertexArray,w,k),n(this.text.zOffsetVertexArray,C,k)),P){const{placedIconSymbolIndex:O,verticalPlacedIconSymbolIndex:G}=v;O>=0&&o(this.icon.zOffsetVertexArray,A,k),G>=0&&o(this.icon.zOffsetVertexArray,v.numVerticalIconVertices,k)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n,o,h,p,x){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(v=>v.appearances&&v.appearances.length>0)),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(n,o,h,p){return!!(n&&o&&h)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(n,o,h,p)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=m3(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,o){const h=this.lineVertexArray.length;if(n.segment!==void 0)for(const{x:p,y:x}of o)this.lineVertexArray.emplaceBack(p,x);return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(n,o,h,p,x,v,w,C,A,k,P,O,G,W,te,se,oe,ge){const ve=n.indexArray,Te=n.layoutVertexArray,$e=n.globeExtVertexArray,Fe=n.segments.prepareSegment(4*ge,Te,ve,this.canOverlap?v.sortKey:void 0),Ze=this.glyphOffsetArray.length,Ye=Fe.vertexLength,Je=this.allowVerticalPlacement&&w===zl.vertical?Math.PI/2:0,Tt=v.text&&v.text.sections;for(let Mt=0;Mt<o.length;Mt++){const{tl:Bt,tr:ir,bl:Jt,br:Ft,texPrimary:Yt,texSecondary:wt,pixelOffsetTL:vt,pixelOffsetBR:Ht,minFontScaleX:rr,minFontScaleY:Lt,glyphOffset:br,isSDF:Ir,sectionIndex:_r}=o[Mt],dr=Fe.vertexLength,En=br[1];if(V1(Te,A.x,A.y,Bt.x,En+Bt.y,Yt.x,Yt.y,h,Ir,vt.x,vt.y,rr,Lt),V1(Te,A.x,A.y,ir.x,En+ir.y,Yt.x+Yt.w,Yt.y,h,Ir,Ht.x,vt.y,rr,Lt),V1(Te,A.x,A.y,Jt.x,En+Jt.y,Yt.x,Yt.y+Yt.h,h,Ir,vt.x,Ht.y,rr,Lt),V1(Te,A.x,A.y,Ft.x,En+Ft.y,Yt.x+Yt.w,Yt.y+Yt.h,h,Ir,Ht.x,Ht.y,rr,Lt),C){const{x:pr,y:Qr,z:jn}=C.anchor,[Gn,mi,Pn]=C.up;q1($e,pr,Qr,jn,Gn,mi,Pn),q1($e,pr,Qr,jn,Gn,mi,Pn),q1($e,pr,Qr,jn,Gn,mi,Pn),q1($e,pr,Qr,jn,Gn,mi,Pn),J0(n.dynamicLayoutVertexArray,pr,Qr,jn,Je)}else J0(n.dynamicLayoutVertexArray,A.x,A.y,A.z,Je);if(se){const pr=wt||Yt;$1(n.iconTransitioningVertexArray,pr.x,pr.y),$1(n.iconTransitioningVertexArray,pr.x+pr.w,pr.y),$1(n.iconTransitioningVertexArray,pr.x,pr.y+pr.h),$1(n.iconTransitioningVertexArray,pr.x+pr.w,pr.y+pr.h)}ve.emplaceBack(dr,dr+1,dr+2),ve.emplaceBack(dr+1,dr+2,dr+3),Fe.vertexLength+=4,Fe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(br[0]),Mt!==o.length-1&&_r===o[Mt+1].sectionIndex||n.programConfigurations.populatePaintArrays(Te.length,v,v.index,{},G,W,te,Tt&&Tt[_r],this.worldview)}const ot=ge-o.length;ot!==0&&this._addNullVertices(ot,Te,h,C,$e,n,se,Fe,ve);const Ct=C?C.anchor:A;n.placedSymbolArray.emplaceBack(Ct.x,Ct.y,Ct.z,A.x,A.y,Ze,this.glyphOffsetArray.length-Ze,Ye,k,P,A.segment,h?h[0]:0,h?h[1]:0,p[0],p[1],w,0,0,0,O,0),n.symbolInstanceIndices.push(oe)}_addNullVertices(n,o,h,p,x,v,w,C,A){for(let k=0;k<n;k++){for(let O=0;O<4;O++)V1(o,0,0,0,0,0,0,h,!1,0,0,0,0),p&&q1(x,0,0,0,0,0,0),J0(v.dynamicLayoutVertexArray,0,0,0,0),w&&$1(v.iconTransitioningVertexArray,0,0);const P=C.vertexLength;A.emplaceBack(P,P+1,P+2),A.emplaceBack(P+1,P+2,P+3),C.vertexLength+=4,C.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(n,o,h,p,x,v,w){n.emplaceBack(o,h,p,x,v,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(n,o,h,p,x,v,w){const C=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),A=C.vertexLength,k=w.tileAnchorX,P=w.tileAnchorY;for(let G=0;G<4;G++)h.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(h.collisionVertexArrayExt,o,n.padding,w.zOffset),this._commitLayoutVertex(h.layoutVertexArray,p,x,v,k,P,new At(n.x1,n.y1)),this._commitLayoutVertex(h.layoutVertexArray,p,x,v,k,P,new At(n.x2,n.y1)),this._commitLayoutVertex(h.layoutVertexArray,p,x,v,k,P,new At(n.x2,n.y2)),this._commitLayoutVertex(h.layoutVertexArray,p,x,v,k,P,new At(n.x1,n.y2)),C.vertexLength+=4;const O=h.indexArray;O.emplaceBack(A,A+1),O.emplaceBack(A+1,A+2),O.emplaceBack(A+2,A+3),O.emplaceBack(A+3,A),C.primitiveLength+=4}_addTextDebugCollisionBoxes(n,o,h,p,x,v){for(let w=p;w<x;w++){const C=h.get(w),A=this.getSymbolInstanceTextSize(n,v,o,w);this._addCollisionDebugVertices(C,A,this.textCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,v)}}_addIconDebugCollisionBoxes(n,o,h,p,x,v){for(let w=p;w<x;w++){const C=h.get(w),A=this.getSymbolInstanceIconSize(n,o,v.placedIconSymbolIndex);this._addCollisionDebugVertices(C,A,this.iconCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,v)}}generateCollisionDebugBuffers(n,o,h){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new pI(A0,PF.members,uc),this.iconCollisionBox=new pI(A0,PF.members,uc);const p=Z0(this.iconSizeData,n),x=Z0(this.textSizeData,n,h);for(let v=0;v<this.symbolInstances.length;v++){const w=this.symbolInstances.get(v);this._addTextDebugCollisionBoxes(x,n,o,w.textBoxStartIndex,w.textBoxEndIndex,w),this._addTextDebugCollisionBoxes(x,n,o,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w),this._addIconDebugCollisionBoxes(p,n,o,w.iconBoxStartIndex,w.iconBoxEndIndex,w),this._addIconDebugCollisionBoxes(p,n,o,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w)}}getSymbolInstanceTextSize(n,o,h,p){const x=this.text.placedSymbolArray.get(o.rightJustifiedTextSymbolIndex>=0?o.rightJustifiedTextSymbolIndex:o.centerJustifiedTextSymbolIndex>=0?o.centerJustifiedTextSymbolIndex:o.leftJustifiedTextSymbolIndex>=0?o.leftJustifiedTextSymbolIndex:o.verticalPlacedTextSymbolIndex>=0?o.verticalPlacedTextSymbolIndex:p),v=sI(this.textSizeData,n,x)/oo;return this.tilePixelRatio*v}getSymbolInstanceIconSize(n,o,h){const p=this.icon.placedSymbolArray.get(h),x=sI(this.iconSizeData,n,p);return this.tilePixelRatio*x}_commitDebugCollisionVertexUpdate(n,o,h,p){n.emplaceBack(o,-h,-h,p),n.emplaceBack(o,h,-h,p),n.emplaceBack(o,h,h,p),n.emplaceBack(o,-h,h,p)}_updateTextDebugCollisionBoxes(n,o,h,p,x,v,w){for(let C=p;C<x;C++){const A=h.get(C),k=this.getSymbolInstanceTextSize(n,v,o,C);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,k,A.padding,v.zOffset)}}_updateIconDebugCollisionBoxes(n,o,h,p,x,v,w){for(let C=p;C<x;C++){const A=h.get(C),k=this.getSymbolInstanceIconSize(n,o,v.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,k,A.padding,v.zOffset)}}updateCollisionDebugBuffers(n,o,h,p){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const x=Z0(this.iconSizeData,n,p),v=Z0(this.textSizeData,n,h);for(let w=0;w<this.symbolInstances.length;w++){const C=this.symbolInstances.get(w);this._updateTextDebugCollisionBoxes(v,n,o,C.textBoxStartIndex,C.textBoxEndIndex,C,h),this._updateTextDebugCollisionBoxes(v,n,o,C.verticalTextBoxStartIndex,C.verticalTextBoxEndIndex,C,h),this._updateIconDebugCollisionBoxes(x,n,o,C.iconBoxStartIndex,C.iconBoxEndIndex,C,p),this._updateIconDebugCollisionBoxes(x,n,o,C.verticalIconBoxStartIndex,C.verticalIconBoxEndIndex,C,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(n,o,h,p,x,v,w,C,A){const k={};if(o<h){const{x1:P,y1:O,x2:G,y2:W,padding:te,projectedAnchorX:se,projectedAnchorY:oe,projectedAnchorZ:ge,tileAnchorX:ve,tileAnchorY:Te,featureIndex:$e}=n.get(o);k.textBox={x1:P,y1:O,x2:G,y2:W,padding:te,projectedAnchorX:se,projectedAnchorY:oe,projectedAnchorZ:ge,tileAnchorX:ve,tileAnchorY:Te},k.textFeatureIndex=$e}if(p<x){const{x1:P,y1:O,x2:G,y2:W,padding:te,projectedAnchorX:se,projectedAnchorY:oe,projectedAnchorZ:ge,tileAnchorX:ve,tileAnchorY:Te,featureIndex:$e}=n.get(p);k.verticalTextBox={x1:P,y1:O,x2:G,y2:W,padding:te,projectedAnchorX:se,projectedAnchorY:oe,projectedAnchorZ:ge,tileAnchorX:ve,tileAnchorY:Te},k.verticalTextFeatureIndex=$e}if(v<w){const{x1:P,y1:O,x2:G,y2:W,padding:te,projectedAnchorX:se,projectedAnchorY:oe,projectedAnchorZ:ge,tileAnchorX:ve,tileAnchorY:Te,featureIndex:$e}=n.get(v);k.iconBox={x1:P,y1:O,x2:G,y2:W,padding:te,projectedAnchorX:se,projectedAnchorY:oe,projectedAnchorZ:ge,tileAnchorX:ve,tileAnchorY:Te},k.iconFeatureIndex=$e}if(C<A){const{x1:P,y1:O,x2:G,y2:W,padding:te,projectedAnchorX:se,projectedAnchorY:oe,projectedAnchorZ:ge,tileAnchorX:ve,tileAnchorY:Te,featureIndex:$e}=n.get(C);k.verticalIconBox={x1:P,y1:O,x2:G,y2:W,padding:te,projectedAnchorX:se,projectedAnchorY:oe,projectedAnchorZ:ge,tileAnchorX:ve,tileAnchorY:Te},k.verticalIconFeatureIndex=$e}return k}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const h=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(n,o){const h=n.placedSymbolArray.get(o),p=h.vertexStartIndex+4*h.numGlyphs;for(let x=h.vertexStartIndex;x<p;x+=4)n.indexArray.emplaceBack(x,x+1,x+2),n.indexArray.emplaceBack(x+1,x+2,x+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(n),h=Math.cos(n),p=[],x=[],v=[];for(let w=0;w<this.symbolInstances.length;++w){v.push(w);const C=this.symbolInstances.get(w);p.push(0|Math.round(o*C.tileAnchorX+h*C.tileAnchorY)),x.push(C.featureIndex)}return v.sort((w,C)=>p[w]-p[C]||x[C]-x[w]),v}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let n=0;n<this.symbolInstances.length;++n)this.symbolInstanceIndexesSortedZOffset.push(n)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((n,o)=>this.symbolInstances.get(o).zOffset-this.symbolInstances.get(n).zOffset)}addToSortKeyRanges(n,o){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===o?h.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const h=this.symbolInstances.get(o);this.featureSortOrder.push(h.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:x,leftJustifiedTextSymbolIndex:v,verticalPlacedTextSymbolIndex:w,placedIconSymbolIndex:C,verticalPlacedIconSymbolIndex:A}=h;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),x>=0&&x!==p&&this.addIndicesForPlacedSymbol(this.text,x),v>=0&&v!==x&&v!==p&&this.addIndicesForPlacedSymbol(this.text,v),w>=0&&this.addIndicesForPlacedSymbol(this.text,w),C>=0&&this.addIndicesForPlacedSymbol(this.icon,C),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(n){const o=this.symbolInstances.get(this.text.symbolInstanceIndices[n]).elevationFeatureIndex;let h;return this.elevationFeatures&&o<this.elevationFeatures.length&&(h=this.elevationFeatures[o]),h}}function g3(l,n){return n.replace(/{([^{}]+)}/g,(o,h)=>h in l?String(l[h]):"")}let _3,x3,mI;Tr(FS,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),FS.addDynamicAttributes=J0;class v3{constructor(n){this.type=n.property.overrides?n.property.overrides.runtimeType:Nf,this.defaultValue=n}evaluate(n){if(n.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(n.formattedSection))return o.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Tr(v3,"FormatSectionOverride",{omit:["defaultValue"]});const gI=()=>mI||(mI={layout:_3||(_3=new Zs({"symbol-placement":new er(at.layout_symbol["symbol-placement"]),"symbol-spacing":new er(at.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new er(at.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new mr(at.layout_symbol["symbol-sort-key"]),"symbol-z-order":new er(at.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new er(at.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new er(at.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new er(at.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new er(at.layout_symbol["icon-ignore-placement"]),"icon-optional":new er(at.layout_symbol["icon-optional"]),"icon-rotation-alignment":new er(at.layout_symbol["icon-rotation-alignment"]),"icon-size":new mr(at.layout_symbol["icon-size"]),"icon-size-scale-range":new er(at.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new mr(at.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new mr(at.layout_symbol["icon-text-fit-padding"]),"icon-image":new mr(at.layout_symbol["icon-image"]),"icon-image-use-theme":new er({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new mr(at.layout_symbol["icon-rotate"]),"icon-padding":new er(at.layout_symbol["icon-padding"]),"icon-keep-upright":new er(at.layout_symbol["icon-keep-upright"]),"icon-offset":new mr(at.layout_symbol["icon-offset"]),"icon-anchor":new mr(at.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new er(at.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new er(at.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new er(at.layout_symbol["text-rotation-alignment"]),"text-field":new mr(at.layout_symbol["text-field"]),"text-font":new mr(at.layout_symbol["text-font"]),"text-size":new mr(at.layout_symbol["text-size"]),"text-size-scale-range":new er(at.layout_symbol["text-size-scale-range"]),"text-max-width":new mr(at.layout_symbol["text-max-width"]),"text-line-height":new mr(at.layout_symbol["text-line-height"]),"text-letter-spacing":new mr(at.layout_symbol["text-letter-spacing"]),"text-justify":new mr(at.layout_symbol["text-justify"]),"text-radial-offset":new mr(at.layout_symbol["text-radial-offset"]),"text-variable-anchor":new er(at.layout_symbol["text-variable-anchor"]),"text-anchor":new mr(at.layout_symbol["text-anchor"]),"text-max-angle":new er(at.layout_symbol["text-max-angle"]),"text-writing-mode":new er(at.layout_symbol["text-writing-mode"]),"text-rotate":new mr(at.layout_symbol["text-rotate"]),"text-padding":new er(at.layout_symbol["text-padding"]),"text-keep-upright":new er(at.layout_symbol["text-keep-upright"]),"text-transform":new mr(at.layout_symbol["text-transform"]),"text-offset":new mr(at.layout_symbol["text-offset"]),"text-allow-overlap":new er(at.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new er(at.layout_symbol["text-ignore-placement"]),"text-optional":new er(at.layout_symbol["text-optional"]),visibility:new er(at.layout_symbol.visibility)})),paint:x3||(x3=new Zs({"icon-opacity":new mr(at.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new mr(at.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new mr(at.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new mr(at.paint_symbol["text-emissive-strength"]),"icon-color":new mr(at.paint_symbol["icon-color"]),"icon-halo-color":new mr(at.paint_symbol["icon-halo-color"]),"icon-halo-width":new mr(at.paint_symbol["icon-halo-width"]),"icon-halo-blur":new mr(at.paint_symbol["icon-halo-blur"]),"icon-translate":new er(at.paint_symbol["icon-translate"]),"icon-translate-anchor":new er(at.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new er(at.paint_symbol["icon-image-cross-fade"]),"text-opacity":new mr(at.paint_symbol["text-opacity"]),"text-occlusion-opacity":new mr(at.paint_symbol["text-occlusion-opacity"]),"text-color":new mr(at.paint_symbol["text-color"],{runtimeType:ml,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new mr(at.paint_symbol["text-halo-color"]),"text-halo-width":new mr(at.paint_symbol["text-halo-width"]),"text-halo-blur":new mr(at.paint_symbol["text-halo-blur"]),"text-translate":new er(at.paint_symbol["text-translate"]),"text-translate-anchor":new er(at.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new er(at.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new er(at.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new er(at.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new er(at.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new mr(at.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new mr({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new mr({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new mr({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new mr({type:"string",default:"default","property-type":"data-driven"})}))},mI);class LS extends Po{constructor(n,o,h,p){super(n,gI(),o,h,p,n.layout?n.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=U([]),this.hasOcclusionOpacityProperties=n.paint!==void 0&&("icon-occlusion-opacity"in n.paint||"text-occlusion-opacity"in n.paint)}_handleSpecialPaintPropertyUpdate(n){n!=="icon-occlusion-opacity"&&n!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(n,o){super.recalculate(n,o),this.appearances&&this.appearances.forEach(p=>{p.recalculate(n,o,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const h=this.layout.get("text-writing-mode");if(h){const p=[];for(const x of h)p.indexOf(x)<0&&p.push(x);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(n,o,h,p){return this._saturation===n&&this._contrast===o&&this._brightnessMin===h&&this._brightnessMax===p||(this._colorAdjustmentMatrix=function(x,v,w,C){x=Ts(x),v=ls(v);const A=H(),k=x/3,P=1-2*k,O=[P,k,k,0,k,P,k,0,k,k,P,0,0,0,0,1],G=.5-.5*v,W=C-w;return z(A,[W,0,0,0,0,W,0,0,0,0,W,0,w,w,w,1],[v,0,0,0,0,v,0,0,0,0,v,0,G,G,G,1]),z(A,A,O),A}(n,o,h,p),this._saturation=n,this._contrast=o,this._brightnessMin=h,this._brightnessMax=p),this._colorAdjustmentMatrix}getValueAndResolveTokens(n,o,h,p){const x=this.layout.get(n).evaluate(o,{},h,p),v=this._unevaluatedLayout._values[n];return v.isDataDriven()||p0(v.value)||!x?x:g3(o.properties,x)}getAppearanceValueAndResolveTokens(n,o,h,p,x){const v=n.getProperty(o);if(!v)return;const w=v.evaluate(h,{},p,x),C=n.getUnevaluatedProperties()._values[o];return C.isDataDriven()||p0(C.value)||!w||typeof w!="string"?w:g3(h.properties,w)}createBucket(n){return new FS(n)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const n of gI().paint.overridableProperties){if(!LS.hasPaintOverride(this.layout,n))continue;const o=this.paint.get(n),h=new v3(o),p=new f0(h,o.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let x=null;x=o.value.kind==="constant"||o.value.kind==="source"?new cg("source",p):new Fd("composite",p,o.value.zoomStops,o.value.interpolationType),this.paint._values[n]=new cc(o.property,x,o.parameters)}}_handleOverridablePaintPropertyUpdate(n,o,h){return!(!this.layout||o.isDataDriven()||h.isDataDriven())&&LS.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,o){const h=n.get("text-field"),p=gI().paint.properties[o];let x=!1;const v=w=>{for(const C of w)if(p.overrides&&p.overrides.hasOverride(C))return void(x=!0)};if(h.value.kind==="constant"&&h.value.value instanceof Ha)v(h.value.value.sections);else if(h.value.kind==="source"){const w=A=>{x||(A instanceof zu&&$a(A.value)===Sh?v(A.value.sections):A instanceof Th?v(A.sections):A.eachChild(w))},C=h.value;C._styleExpression&&w(C._styleExpression.expression)}return x}getProgramIds(){return["symbol"]}getDefaultProgramParams(n,o,h){return{config:new Wu(this,{zoom:o,lut:h}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let y3,w3,b3,S3;var _I=Kn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function zS(l,n,o,h,p,x,v,w){const C=[l,n,1,o,h,1,p,x,1],A=[v,w,1],k=M([],C),[P,O,G]=xn(A,A,k);return R(C,C,[P,0,0,0,O,0,0,0,G])}function T3(l,n,o,h,p,x,v,w){const C=function(A,k,P,O,G,W,te,se){const oe=zS(0,0,1,0,1,1,0,1),ge=zS(A,k,P,O,G,W,te,se);return R(ge,ge,M([],oe))}(l,n,o,h,p,x,v,w);return[C[2]/C[8]/ar,C[5]/C[8]/ar]}function BS(l){return[l[0],Math.min(Math.max(l[1],-Ne),Ne)]}class E3 extends Ou{constructor(n,o,h,p){super(),this.id=n,this.dispatcher=h,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(p),this.options=o,this._dirty=!1}load(n,o){if(this._loaded=o||!1,this.fire(new jl("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return n&&(this.coordinates=n),this._loaded=!0,void this._finishLoading();this._imageRequest=ey(this.map._requestManager.transformRequest(this.url,yh.Image),(h,p)=>{this._imageRequest=null,this._loaded=!0,h?this.fire(new Vm(h)):p&&(this.image=p instanceof HTMLImageElement?Ti.getImageData(p):p,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading())})}loaded(){return this._loaded}updateImage(n){return n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}setTexture(n){if(!(n.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new j1(this.map.painter.context,n.handle),this.width=n.dimensions[0],this.height=n.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new jl("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(n){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof j1||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(n){if(this.coordinates=n,this._boundsArray=void 0,this._unsupportedCoords=!1,!n.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let o=n[0][1],h=n[0][1];for(const x of n)x[1]>h&&(h=x[1]),x[1]<o&&(o=x[1]);const p=(h+o)/2;if(p>Ne?this.onNorthPole=!0:p<-Ne&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const x=n.map(st.fromLngLat);this.tileID=function(v){let w=1/0,C=1/0,A=-1/0,k=-1/0;for(const te of v)w=Math.min(w,te.x),C=Math.min(C,te.y),A=Math.max(A,te.x),k=Math.max(k,te.y);const P=Math.max(A-w,k-C),O=Math.max(0,Math.floor(-Math.log2(P))),G=Math.pow(2,O);let W=Math.floor((w+A)/2*G);return W>1&&(W-=1),new Ol(O,W,Math.floor((C+k)/2*G))}(x),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new jl("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof j1||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(n){for(const oe in this.tiles){const ge=this.tiles[oe];ge.state!=="loaded"&&(ge.state="loaded",ge.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const o=F1(new Ol(0,0,0),this.map.transform.projection),h=[o.projection.project(this.coordinates[0][0],this.coordinates[0][1]),o.projection.project(this.coordinates[1][0],this.coordinates[1][1]),o.projection.project(this.coordinates[2][0],this.coordinates[2][1]),o.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(oe){const ge=oe[1].x-oe[0].x,ve=oe[1].y-oe[0].y,Te=oe[2].x-oe[1].x,$e=oe[2].y-oe[1].y,Fe=oe[3].x-oe[2].x,Ze=oe[3].y-oe[2].y,Ye=oe[0].x-oe[3].x,Je=oe[0].y-oe[3].y,Tt=ge*$e-Te*ve,ot=Te*Ze-Fe*$e,Ct=Fe*Je-Ye*Ze,Mt=Ye*ve-ge*Je;return Tt>0&&ot>0&&Ct>0&&Mt>0||Tt<0&&ot<0&&Ct<0&&Mt<0}(h))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const p=F1(this.tileID,this.map.transform.projection),[x,v,w,C]=this.coordinates.map(oe=>{const ge=p.projection.project(oe[0],oe[1]);return u3(p,ge)._round()});this.perspectiveTransform=T3(x.x,x.y,v.x,v.y,w.x,w.y,C.x,C.y);const A=this._boundsArray=new tp;A.emplaceBack(x.x,x.y,0,0),A.emplaceBack(v.x,v.y,ar,0),A.emplaceBack(C.x,C.y,0,ar),A.emplaceBack(w.x,w.y,ar,ar),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=n.createVertexBuffer(A,_I.members),this.boundsSegments=Fs.simpleSegment(0,0,4,2);const k=[],P=[BS((O=this.coordinates)[0]),BS(O[1]),BS(O[2]),BS(O[3])];var O;const[G,W,te,se]=function(oe){let ge=oe[0][0],ve=ge,Te=oe[0][1],$e=Te;for(let Fe=1;Fe<oe.length;Fe++)oe[Fe][0]<ge?ge=oe[Fe][0]:oe[Fe][0]>ve&&(ve=oe[Fe][0]),oe[Fe][1]<Te?Te=oe[Fe][1]:oe[Fe][1]>$e&&($e=oe[Fe][1]);return[ge,Te,ve-ge,$e-Te]}(P);{const oe=new tp,[ge,ve,Te,$e]=function(Ft){let Yt=Ft[0].x,wt=Yt,vt=Ft[0].y,Ht=vt;for(let rr=1;rr<Ft.length;rr++)Ft[rr].x<Yt?Yt=Ft[rr].x:Ft[rr].x>wt&&(wt=Ft[rr].x),Ft[rr].y<vt?vt=Ft[rr].y:Ft[rr].y>Ht&&(Ht=Ft[rr].y);return[Yt,vt,wt-Yt,Ht-vt]}(h),Fe=Ft=>[(Ft.x-ge)/Te,(Ft.y-ve)/$e],[Ze,Ye,Je,Tt]=h.map(Fe),ot=function(Ft,Yt,wt,vt,Ht,rr,Lt,br){const Ir=zS(0,0,1,0,1,1,0,1);return R(Ir,Ir,M([],zS(Ft,Yt,wt,vt,Ht,rr,Lt,br)))}(Ze[0],Ze[1],Ye[0],Ye[1],Je[0],Je[1],Tt[0],Tt[1]);this.elevatedGlobePerspectiveTransform=T3(Ze[0],Ze[1],Ye[0],Ye[1],Je[0],Je[1],Tt[0],Tt[1]);const Ct=(Ft,Yt)=>{k.push(Ft.lng);const wt=Math.round((Ft.lng-G)/te*ar),vt=Math.round((Ft.lat-W)/se*ar),Ht=Fe(Yt),rr=xn([],[Ht[0],Ht[1],1],ot),Lt=Math.round(rr[0]/rr[2]*ar),br=Math.round(rr[1]/rr[2]*ar);oe.emplaceBack(wt,vt,Lt,br)},Mt=h[3].x-h[0].x,Bt=h[3].y-h[0].y,ir=h[2].x-h[1].x,Jt=h[2].y-h[1].y;for(let Ft=0;Ft<65;Ft++){const Yt=Ft/64,wt=[h[0].x+Yt*Mt,h[0].y+Yt*Bt],vt=[h[1].x+Yt*ir,h[1].y+Yt*Jt],Ht=vt[0]-wt[0],rr=vt[1]-wt[1];for(let Lt=0;Lt<65;Lt++){const br=Lt/64,Ir={x:wt[0]+Ht*br,y:wt[1]+rr*br};Ct(o.projection.unproject(Ir.x,Ir.y),Ir)}}this.elevatedGlobeVertexBuffer=n.createVertexBuffer(oe,_I.members)}{this.maxLongitudeTriangleSize=0;let oe=[],ge=new bs;const ve=(Te,$e,Fe)=>{ge.emplaceBack(Te,$e,Fe);const Ze=k[Te],Ye=k[$e],Je=k[Fe],Tt=Math.min(Math.min(Ze,Ye),Je),ot=Math.max(Math.max(Ze,Ye),Je)-Tt;ot>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=ot),oe.push(Tt+ot/2)};for(let Te=0;Te<64;Te++)for(let $e=0;$e<64;$e++){const Fe=65*Te+$e,Ze=Fe+1,Ye=Fe+65,Je=Ye+1;ve(Fe,Ye,Ze),ve(Ze,Ye,Je)}[oe,ge]=function(Te,$e){const Fe=Array.from({length:Te.length},(Je,Tt)=>Tt);Fe.sort((Je,Tt)=>Te[Je]-Te[Tt]);const Ze=[],Ye=new bs;for(let Je=0;Je<Fe.length;Je++){const Tt=Fe[Je];Ze.push(Te[Tt]);const ot=3*Tt,Ct=ot+1;Ye.emplaceBack($e.uint16[ot],$e.uint16[Ct],$e.uint16[Ct+1])}return[Ze,Ye]}(oe,ge),this.elevatedGlobeTrianglesCenterLongitudes=oe,this.elevatedGlobeIndexBuffer=n.createIndexBuffer(ge)}this.elevatedGlobeSegments=Fs.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,te/ar,0,se/ar,0,0,W,G,0])}prepare(){const n=Object.keys(this.tiles).length!==0;if(this.tileID&&!n)return;const o=this.map.painter.context,h=o.gl;!this._dirty||this.texture instanceof j1||(this.texture?this.texture.update(this.image):(this.texture=new $j(o,this.image,h.RGBA8),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._dirty=!1),n&&this._prepareData(o)}loadTile(n,o){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},o(null)):(n.state="errored",o(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(n){const o=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!o)return null;const h=this.elevatedGlobeTrianglesCenterLongitudes;let p=(x=n+180)+360*Math.round((h[0]-x)/360);var x;const v=new Fs,w=(P,O)=>{v.segments.push({vertexOffset:0,primitiveOffset:P,vertexLength:o.segments[0].vertexLength,primitiveLength:O,sortKey:void 0,vaos:{}})},C=.51*this.maxLongitudeTriangleSize;if(Math.abs(h[0]-p)<=C){const P=Un(h,0,h.length,p+C);return P===h.length||w(P,yi(h,P+1,h.length,p+360-C)-P),v}p<h[0]&&(p+=360);const A=yi(h,0,h.length,p-C);if(A===h.length)return w(0,h.length),v;w(0,A-0);const k=Un(h,A+1,h.length,p+C);return k!==h.length&&w(k,h.length-k),v}}const eY=(Math.pow(256,2)-1)/16907520;class C3 extends Po{constructor(n,o,h,p){super(n,{layout:b3||(b3=new Zs({visibility:new er(at.layout_raster.visibility)})),paint:S3||(S3=new Zs({"raster-opacity":new er(at.paint_raster["raster-opacity"]),"raster-color":new Yf(at.paint_raster["raster-color"]),"raster-color-mix":new er(at.paint_raster["raster-color-mix"]),"raster-color-range":new er(at.paint_raster["raster-color-range"]),"raster-hue-rotate":new er(at.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new er(at.paint_raster["raster-brightness-min"]),"raster-brightness-max":new er(at.paint_raster["raster-brightness-max"]),"raster-saturation":new er(at.paint_raster["raster-saturation"]),"raster-contrast":new er(at.paint_raster["raster-contrast"]),"raster-resampling":new er(at.paint_raster["raster-resampling"]),"raster-fade-duration":new er(at.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new er(at.paint_raster["raster-emissive-strength"]),"raster-array-band":new er(at.paint_raster["raster-array-band"]),"raster-elevation":new er(at.paint_raster["raster-elevation"]),"raster-color-use-theme":new mr({type:"string",default:"default","property-type":"data-driven"})}))},o,h,p),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(n){return!(n&&n._source instanceof E3&&(n._source.onNorthPole||n._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(n){n!=="raster-color"&&n!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(n){if(!this.hasColorMap()||!this._curRampRange)return;const o=this._transitionablePaint._values["raster-color"].value.expression,[h,p]=n||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(h)&&isNaN(p)||h===this._curRampRange[0]&&p===this._curRampRange[1]||(this.colorRamp=f1({expression:o,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:h,end:p}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[h,p])}}let A3,j3,I3,N3,k3;class P3 extends Po{constructor(n,o,h,p){super(n,{layout:A3||(A3=new Zs({visibility:new er(at["layout_raster-particle"].visibility)})),paint:j3||(j3=new Zs({"raster-particle-array-band":new er(at["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new er(at["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Yf(at["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new er(at["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new er(at["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new er(at["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new er(at["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new er(at["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new mr({type:"string",default:"default","property-type":"data-driven"})}))},o,h,p),this._updateColorRamp(),this.lastInvalidatedAt=Ti.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(n){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(n){return!1}_handleSpecialPaintPropertyUpdate(n){n!=="raster-particle-color"&&n!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),n==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const n=this._transitionablePaint._values["raster-particle-color"].value.expression,o=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=f1({expression:n,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:o}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Ti.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class tY extends Po{constructor(n,o){super(n,{},o,null),this.implementation=n,n.slot&&(this.slot=n.slot)}is3D(n){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(n){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(n){this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)}onRemove(n){this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)}}function xI(l,n,o){const h=[0,0,1],p=Kr([]);return Yn(p,p,o?-lt(l)+Math.PI:lt(l)),Zn(p,p,-lt(n)),ei(h,h,p),zt(h,h)}const D3={None:0,Model:1,Symbol:2,FillExtrusion:4};class US{constructor(n,o,h,p){this.message=(n?`${n}: `:"")+h,p&&(this.identifier=p),o!=null&&o.__line__&&(this.line=o.__line__)}}function vI(l,n){const o=l.indexOf("://")===-1;try{return new URL(l,o&&n?"http://example.com":void 0),!0}catch{return!1}}class R3{constructor(n,o){this.feature=n,this.instancedDataOffset=o,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class M3{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new I0,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(n){const o=16*n,h=this.instancedDataArray.float32;let p=Math.floor(h[o+2]);const x=1.05*(h[o+2]-p);return p/=100,[h[o]%1*1.05,h[o+1]%1*1.05,x,p]}tileCoordinatesForInstance(n){const o=16*n,h=this.instancedDataArray.float32;let p=h[o+0];return p=p>ar?p-ar:p,new At(Math.trunc(p),Math.trunc(h[o+1]))}translationForInstance(n){const o=16*n,h=this.instancedDataArray.float32;return[h[o+4],h[o+5],h[o+6]]}rotationScaleForInstance(n){const o=16*n,h=this.instancedDataArray.float32;return[h[o+7],h[o+8],h[o+9],h[o+10],h[o+11],h[o+12],h[o+13],h[o+14],h[o+15]]}transformForInstance(n){const o=16*n,h=this.instancedDataArray.float32;return[h[o+7],h[o+8],h[o+9],h[o+4],h[o+10],h[o+11],h[o+12],h[o+5],h[o+13],h[o+14],h[o+15],h[o+6],0,0,0,1]}}class yI{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.overscaledZ=this.canonical.z+Math.log2(n.overscaling),this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.projection=n.projection,this.index=n.index,this.worldview=n.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=n.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(n,o){}updateAppearances(n,o,h,p){}populate(n,o,h,p){this.tileToMeter=We(h);const x=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:v,id:w,index:C,sourceLayerIndex:A}of n){const k=w??(v.properties&&v.properties.hasOwnProperty("id")?v.properties.id:void 0),P=xt(v,x);if(!this.layers[0]._featureFilter.filter(new us(this.zoom,{worldview:this.worldview,activeFloors:o.activeFloors}),P,h))continue;const O={id:k,sourceLayerIndex:A,index:C,geometry:x?P.geometry:Pt(v,h,p),properties:v.properties,type:v.type,patterns:{}},G=this.addFeature(O,O.geometry,P);G&&o.featureIndex.insert(v,O.geometry,C,A,this.index,this.instancesPerModel[G].instancedDataArray.length,ar/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const n=this.layers[0].modelManager,o=this.layers[0].scope;let h=0;for(const p of this.modelUris){const x=n.getModel(p,o);if(!x)continue;const v=this.instancesPerModel[p];if(v){const w=.5*Ue(x.aabb.max,x.aabb.min)*v.maxScale+v.maxXYTranslationDistance,C=Math.min(ar,Math.max(w/this.tileToMeter,ar/32));h=Math.max(C,h)}}return h}update(n,o,h,p){for(const x in this.instancesPerModel){const v=this.instancesPerModel[x];for(const w in n)v.idToFeaturesIndex.hasOwnProperty(w)&&(this.evaluate(v.features[v.idToFeaturesIndex[w]],n[w],v,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let n=!1;for(const o in this.instancesPerModel){const h=this.instancesPerModel[o];for(const p of h.features){const x=this.layers[0],v=p.feature,w=this.canonical,C=x.paint.get("model-rotation").evaluate(v,{},w),A=x.paint.get("model-scale").evaluate(v,{},w),k=x.paint.get("model-translation").evaluate(v,{},w);Zr(p.rotation,C)&&Zr(p.scale,A)&&Zr(p.translation,k)||(this.evaluate(p,p.featureStates,h,!0),n=!0)}}return n}updateReplacement(n,o,h,p){if(o.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=o.updateTime;const x=o.getReplacementRegionsForTile(n.toUnwrapped(),!0);if(dS(this.activeReplacements,x))return!1;this.activeReplacements=x;let v=!1;for(const w in this.instancesPerModel){const C=this.instancesPerModel[w],A=C.instancedDataArray;for(const k of C.features){const P=k.instancedDataOffset,O=k.instancedDataCount;for(let G=0;G<O;G++){const W=16*(G+P);let te=A.float32[W+0];const se=te>ar;te=se?te-ar:te;const oe=Math.floor(te),ge=Math.floor(A.float32[W+1]);let ve=!1;for(const Te of this.activeReplacements)if(!yO(Te,h,D3.Model,p)&&!(Te.min.x>oe||oe>Te.max.x||Te.min.y>ge||ge>Te.max.y)&&(ve=kj(TO(oe,ge,n.canonical,Te.footprintTileId.canonical),Te.footprint),ve))break;A.float32[W]=ve?te+ar:te,v=v||ve!==se}}}return v}isEmpty(){for(const n in this.instancesPerModel)if(this.instancesPerModel[n].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(n){if(!this.uploaded)for(const o in this.instancesPerModel){const h=this.instancesPerModel[o];h.instancedDataArray.length<0||h.instancedDataArray.length===0||(h.instancedDataBuffer?h.instancedDataBuffer.updateData(h.instancedDataArray):h.instancedDataBuffer=n.createVertexBuffer(h.instancedDataArray,jZ.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const o in this.instancesPerModel){const h=this.instancesPerModel[o];h.instancedDataArray.length!==0&&h.instancedDataBuffer&&h.instancedDataBuffer.destroy()}const n=this.layers[0].modelManager;if(n&&this.modelUris&&this.modelsRequested)for(const o of this.modelUris)n.removeModel(o,"",!0)}addFeature(n,o,h){const p=this.layers[0],x=p.layout.get("model-id").evaluate(h,{},this.canonical);if(!x)return ur(`modelId is not evaluated for layer ${p.id} and it is not going to get rendered.`),x;(vI(x,!1)||this.styleDefinedModelURLs[x]!==void 0)&&(this.modelUris.includes(x)||this.modelUris.push(x)),this.instancesPerModel[x]||(this.instancesPerModel[x]=new M3);const v=this.instancesPerModel[x],w=v.instancedDataArray,C=new R3(h,w.length);for(const A of o)for(const k of A){if(k.x<0||k.x>=ar||k.y<0||k.y>=ar)continue;if(this.lookupDim!==0){const O=(this.lookupDim-1)/ar,G=this.lookupDim*(k.y*O|0)+k.x*O|0;if(this.lookup){if(this.lookup[G]!==0)continue;this.lookup[G]=1}}this.instanceCount++;const P=w.length;w.resize(P+1),v.instancesEvaluatedElevation.push(0),w.float32[16*P]=k.x,w.float32[16*P+1]=k.y}return C.instancedDataCount=v.instancedDataArray.length-C.instancedDataOffset,C.instancedDataCount>0&&(n.id&&(v.idToFeaturesIndex[n.id]=v.features.length),v.features.push(C),this.evaluate(C,{},v,!1)),x}getModelUris(){return this.modelUris}evaluate(n,o,h,p){const x=this.layers[0],v=n.feature,w=this.canonical,C=n.rotation=x.paint.get("model-rotation").evaluate(v,o,w),A=n.scale=x.paint.get("model-scale").evaluate(v,o,w),k=n.translation=x.paint.get("model-translation").evaluate(v,o,w),P=Object.assign({},x.paint.get("model-color").evaluate(v,o,w));P.a=x.paint.get("model-color-mix-intensity").evaluate(v,o,w);const O=[];this.maxVerticalOffset<k[2]&&(this.maxVerticalOffset=k[2]);const G=k[0]*k[0]+k[1]*k[1],W=G>0?Math.sqrt(G):0;h.maxScale=Math.max(Math.max(h.maxScale,A[0]),Math.max(A[1],A[2])),h.maxXYTranslationDistance=Math.max(h.maxXYTranslationDistance,W),this.maxScale=Math.max(Math.max(this.maxScale,A[0]),Math.max(A[1],A[2])),uF(O,C,A);const te=Math.round(100*P.a)+P.b/1.05;for(let se=0;se<n.instancedDataCount;++se){const oe=n.instancedDataOffset+se,ge=16*oe,ve=h.instancedDataArray.float32;let Te=0;p&&(Te=ve[ge+6]-h.instancesEvaluatedElevation[oe]);const $e=0|ve[ge+1];ve[ge]=(0|ve[ge])+P.r/1.05,ve[ge+1]=$e+P.g/1.05,ve[ge+2]=te,ve[ge+3]=1/(w.z>10?this.tileToMeter:We(w,$e)),ve[ge+4]=k[0],ve[ge+5]=k[1],ve[ge+6]=k[2]+Te,ve[ge+7]=O[0],ve[ge+8]=O[1],ve[ge+9]=O[2],ve[ge+10]=O[4],ve[ge+11]=O[5],ve[ge+12]=O[6],ve[ge+13]=O[8],ve[ge+14]=O[9],ve[ge+15]=O[10],h.instancesEvaluatedElevation[oe]=k[2]}}}let O3,F3;Tr(yI,"ModelBucket",{omit:["layers"]}),Tr(M3,"PerModelAttributes"),Tr(R3,"ModelFeature");class Q0{constructor(n,o,h){this._demTile=n,this._dem=this._demTile.dem,this._scale=o,this._offset=h}static create(n,o,h){const p=h||n.findDEMTileFor(o);if(!p||!p.dem)return;const x=p.dem,v=p.tileID,w=1<<o.canonical.z-v.canonical.z;return new Q0(p,x.dim/ar/w,[(o.canonical.x/w-v.canonical.x)*x.dim,(o.canonical.y/w-v.canonical.y)*x.dim])}tileCoordToPixel(n,o){const h=o*this._scale+this._offset[1];return new At(Math.floor(n*this._scale+this._offset[0]),Math.floor(h))}getElevationAt(n,o,h,p){const x=n*this._scale+this._offset[0],v=o*this._scale+this._offset[1],w=Math.floor(x),C=Math.floor(v),A=this._dem;return p=!!p,h?fn(fn(A.get(w,C,p),A.get(w,C+1,p),v-C),fn(A.get(w+1,C,p),A.get(w+1,C+1,p),v-C),x-w):A.get(w,C,p)}getElevationAtPixel(n,o,h){return this._dem.get(n,o,!!h)}getMeterToDEM(n){return(1<<this._demTile.tileID.canonical.z)*xe(1,n)*this._dem.stride}}const wI=new Float32Array(262144),Ag=new Uint8Array(262144);function L3(l){let n=0;if(l.meshes)for(const o of l.meshes)n=Math.max(n,o.aabb.max[2]);if(l.children)for(const o of l.children)n=Math.max(n,L3(o));return n}function z3(l,n,o){if(l.meshes)for(const h of l.meshes){if(h.aabb.min[0]===1/0)continue;const p=qn.applyTransform(h.aabb,l.globalMatrix);o.insert(n,p.min[0],p.min[1],p.max[0],p.max[1])}if(l.children)for(const h of l.children)z3(h,n,o)}const B3=["","wall","door","roof","window","lamp","logo"];class U3{constructor(n){this.node=n,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:n.id,geometry:[],properties:{height:L3(n)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new qn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let n=0;const o=new qn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const h of this.node.meshes)this.node.lightMeshIndex!==n&&(h.transformedAabb=qn.applyTransformFast(h.aabb,this.node.globalMatrix),o.encapsulate(h.transformedAabb)),n++;this.aabb=o}return this.aabb}}class VS{constructor(n,o,h,p,x,v,w,C){this.id=h,this.layers=n,this.layerIds=this.layers.map(A=>A.fqid),this.stateDependentLayerIds=this.layers.filter(A=>A.isStateDependent()).map(A=>A.id),this.modelTraits|=q0.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,p&&(this.modelTraits|=q0.HasMapboxMeshFeatures),x&&(this.modelTraits|=q0.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=v,this.worldview=C,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const A of o)this.nodesInfo.push(new U3(A)),z3(A,w.featureIndexArray.length,w.grid),w.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,w.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(n,o){for(const h of this.getNodesInfo()){const p=h.node;p.footprint&&o.push({footprint:p.footprint,id:n})}}updateAppearances(n,o,h,p){}update(n){const o=Object.keys(n).length!==0;if(o&&!this.stateDependentLayers.length)return;const h=o?this.stateDependentLayers:this.layers;if(!$i(n,this.states))for(const p of h)this.evaluate(p,n);this.states=structuredClone(n)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(n){if(!this.needsUpload)return;const o=this.getNodesInfo();for(const h of o){const p=h.node;this.uploaded?this.updatePbrBuffer(p):Wj(p,n,!0)}for(const h of o)SS(h.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(n){let o=!1;if(!n.meshes)return o;for(const h of n.meshes)h.pbrBuffer&&(h.pbrBuffer.updateData(h.featureArray),o=!0);return o}needsReEvaluation(n,o,h){const p=n.transform.projectionOptions,x=n.style.getBrightness(),v=this.brightness!==x;if(!this.uploaded||this.dirty||p.name!==this.projection.name||G1(h.paint.get("model-color").value,v)||G1(h.paint.get("model-color-mix-intensity").value,v)||G1(h.paint.get("model-roughness").value,v)||G1(h.paint.get("model-emissive-strength").value,v)||G1(h.paint.get("model-height-based-emissive-strength-multiplier").value,v)){this.projection=p,this.brightness=x;const w=this.getNodesInfo();for(const C of w)C.state=null;return!0}return!1}evaluateTransform(n,o){if(n.transform.zoom===this.zoom)return;this.zoom=n.transform.zoom;const h=this.getNodesInfo(),p=this.id.canonical;for(const x of h){const v=x.feature;x.evaluatedTranslation=o.paint.get("model-translation").evaluate(v,{},p),x.evaluatedScale=o.paint.get("model-scale").evaluate(v,{},p)}}evaluate(n,o){const h=this.getNodesInfo();for(const p of h){if(!p.node.meshes)continue;const x=p.feature,v=o&&o[x.id];if($i(v,p.state))continue;p.state=structuredClone(v);const w=p.node.meshes&&p.node.meshes[0].featureData,C=p.evaluatedColor[2],A=p.evaluatedRMEA[2],k=this.id.canonical;if(p.hasTranslucentParts=!1,w){for(let P=0;P<B3.length;P++){const O=B3[P];O.length&&(x.properties.part=O);const G=n.paint.get("model-color").evaluate(x,v,k).toPremultipliedRenderColor(null),W=n.paint.get("model-color-mix-intensity").evaluate(x,v,k);p.evaluatedColor[P]=[G.r,G.g,G.b,W],p.evaluatedRMEA[P][0]=n.paint.get("model-roughness").evaluate(x,v,k),p.evaluatedRMEA[P][2]=n.paint.get("model-emissive-strength").evaluate(x,v,k),p.evaluatedRMEA[P][3]=G.a,p.emissionHeightBasedParams[P]=n.paint.get("model-height-based-emissive-strength-multiplier").evaluate(x,v,k),!p.hasTranslucentParts&&G.a<1&&(p.hasTranslucentParts=!0)}delete x.properties.part,nY(p,C!==p.evaluatedColor[2]||A!==p.evaluatedRMEA[2],this.modelTraits)}else p.evaluatedRMEA[0][2]=n.paint.get("model-emissive-strength").evaluate(x,v,k);p.evaluatedTranslation=n.paint.get("model-translation").evaluate(x,v,k),p.evaluatedScale=n.paint.get("model-scale").evaluate(x,v,k),this.updatePbrBuffer(p.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(n,o,h,p){const x=n.findDEMTileFor(h);if(x&&(x.tileID.canonical!==this.terrainTile||o!==this.terrainExaggeration)){if(x.dem&&x.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=x.tileID.overscaledZ;const v=Q0.create(n,h,x);if(!v)return;this.modelTraits&q0.HasMapboxMeshFeatures&&this.updateDEM(n,v,h,p);for(const w of this.getNodesInfo()){const C=w.node;if(!C.footprint||!C.footprint.vertices||!C.footprint.vertices.length)continue;const A=C.footprint.vertices;let k=v.getElevationAt(A[0].x,A[0].y,!0,!0);for(let P=1;P<A.length;P++)k=Math.min(k,v.getElevationAt(A[P].x,A[P].y,!0,!0));C.elevation=k}}this.terrainTile=x.tileID.canonical,this.terrainExaggeration=o}}updateDEM(n,o,h,p){let x=o._dem._modifiedForSources[p];if(x===void 0&&(o._dem._modifiedForSources[p]=[],x=o._dem._modifiedForSources[p]),x.includes(h.canonical))return;const v=o._dem.dim;x.push(h.canonical);let w=!1;for(const C of this.getNodesInfo()){const A=C.node;if(!A.footprint||!A.footprint.grid)continue;const k=A.footprint.grid,P=o.tileCoordToPixel(k.min.x,k.min.y),O=o.tileCoordToPixel(k.max.x,k.max.y),G=Math.min(Math.min(v-O.y,P.x),Math.min(P.y,v-O.x));if(G<0)continue;const W=K(G,2,5);let te=Math.max(0,P.x-W),se=Math.max(0,P.y-W),oe=Math.min(O.x+W,v-1),ge=Math.min(O.y+W,v-1);for(let Fe=se;Fe<=ge;++Fe)for(let Ze=te;Ze<=oe;++Ze)Ag[Fe*v+Ze]=255;let ve=0,Te=0;for(let Fe=0;Fe<k.cellsY;++Fe)for(let Ze=0;Ze<k.cellsX;++Ze){if(!k.cells[Fe*k.cellsX+Ze])continue;const Ye=o.tileCoordToPixel(k.min.x+Ze/k.xScale,k.min.y+Fe/k.yScale),Je=o.tileCoordToPixel(k.min.x+(Ze+1)/k.xScale,k.min.y+(Fe+1)/k.yScale);for(let Tt=Ye.y;Tt<=Math.min(Je.y+1,v-1);++Tt)for(let ot=Ye.x;ot<=Math.min(Je.x+1,v-1);++ot)Ag[Tt*v+ot]===255&&(Ag[Tt*v+ot]=0,ve+=o.getElevationAtPixel(ot,Tt),Te++)}const $e=ve/Te;te=Math.max(1,P.x-W),se=Math.max(1,P.y-W),oe=Math.min(O.x+W,v-2),ge=Math.min(O.y+W,v-2),w=!0;for(let Fe=se;Fe<=ge;++Fe)for(let Ze=te;Ze<=oe;++Ze)Ag[Fe*v+Ze]===0&&(wI[Fe*v+Ze]=o._dem.set(Ze,Fe,$e));for(let Fe=1;Fe<W;++Fe){te=Math.max(1,P.x-Fe),se=Math.max(1,P.y-Fe),oe=Math.min(O.x+Fe,v-2),ge=Math.min(O.y+Fe,v-2);for(let Ze=se;Ze<=ge;++Ze)for(let Ye=te;Ye<=oe;++Ye){const Je=Ze*v+Ye;if(Ag[Je]===255){let Tt=0,ot=0,Ct=-1,Mt=-1;for(let Bt=-1;Bt<=1;++Bt)for(let ir=-1;ir<=1;++ir){const Jt=(Ze+Bt)*v+Ye+ir;if(Ag[Jt]>=Fe)continue;const Ft=wI[Jt],Yt=Math.abs(Ft);Yt>ot&&(Tt=Ft,ot=Yt,Ct=ir,Mt=Bt)}if(ot>.1){const Bt=1-(Fe+.5*Math.abs(Ct*Mt))/W;let ir=o._dem.get(Ye,Ze)+Tt*Bt;const Jt=o._dem.get(Ye+Ct,Ze+Mt),Ft=o._dem.get(Ye-Ct,Ze-Mt,!0);(ir-Jt)*(ir-Ft)>0&&(ir=(Jt+Ft)/2),wI[Je]=o._dem.set(Ye,Ze,ir),Ag[Je]=Fe}}}}}w&&(o._demTile.needsDEMTextureUpload=!0,o._dem._timestamp=Ti.now())}setFilter(n){this.filter=n?y0(n):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(n=>this.filter.filter(new us(this.id.overscaledZ,{worldview:this.worldview}),n.feature,this.id.canonical)):this.nodesInfo}destroy(){const n=this.getNodesInfo();for(const o of n)SS(o.node),Hj(o.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(n,o){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const h=o.getReplacementRegionsForTile(n.toUnwrapped());for(const p of this.getNodesInfo()){const x=p.node.footprint;p.hiddenByReplacement=!!x&&!h.find(v=>v.footprint===x)}}getHeightAtTileCoord(n,o){const h=[],p=[0,0,0],x=U([]);for(const v of this.getNodesInfo()){const w=v.node.meshes[0],C=w.transformedAabb;if(n<C.min[0]||o<C.min[1]||n>C.max[0]||o>C.max[1])continue;if(v.node.hidden===!0)return{height:1/0,maxHeight:v.feature.properties.height,hidden:!1,verticalScale:v.evaluatedScale[2]};Y(x,v.node.globalMatrix),p[0]=n,p[1]=o,nn(p,p,x);const A=(p[0]-w.aabb.min[0])/(w.aabb.max[0]-w.aabb.min[0])*Tg|0,k=Math.min(63,(p[1]-w.aabb.min[1])/(w.aabb.max[1]-w.aabb.min[1])*Tg|0)*Tg+Math.min(63,A),P=w.heightmap[k];if(!(P<0&&v.node.footprint))return v.hiddenByReplacement?void 0:{height:P,maxHeight:v.feature.properties.height,hidden:!1,verticalScale:v.evaluatedScale[2]};if(v.node.footprint.grid.query(new At(n,o),new At(n,o),h),h.length>0)return{height:void 0,maxHeight:v.feature.properties.height,hidden:v.hiddenByReplacement,verticalScale:v.evaluatedScale[2]}}}}function G1(l,n){return l instanceof cg&&!l.isLightConstant&&n}function rY(l,n,o,h,p,x,v,w){let C=(61440&n|(61440&n)>>4)>>8,A=(3840&n|(3840&n)>>4)>>4,k=240&n|(240&n)>>4;o[3]>0&&(C=fn(C,255*o[0],o[3]),A=fn(A,255*o[1],o[3]),k=fn(k,255*o[2],o[3]));const P=C<<8|A,O=k<<8|Math.floor(255*h[3]),G=function(Fe){const Ze=K(Fe,0,2);return Math.min(Math.round(.5*Ze*255),255)}(h[2])<<8|15*h[0]<<4|15*h[1],W=K(p[0],0,1),te=K(p[1],0,1),se=K(p[2],0,1),oe=K(p[3],0,1);let ge,ve,Te,$e;if(W!==te&&v!==x&&te!==W){const Fe=v-x;ve=1/(Fe*(te-W)),Te=-(x+Fe*W)/(Fe*(te-W));const Ze=K(p[4],-1,1);$e=Math.pow(10,Ze),ge=255*se<<8|255*oe}else ge=65535,ve=0,Te=1,$e=1;if(l.emplaceBack(P,O,G,ge,ve,Te,$e),w){const Fe=w.length;w.clear();for(let Ze=0;Ze<Fe;Ze++)w.emplaceBack(P,O,G,ge,ve,Te,$e)}}function nY(l,n,o){const h=l.node;let p=0;const x=o&q0.HasMeshoptCompression;for(const v of h.meshes){if(h.lights&&h.lightMeshIndex===p||!v.featureData)continue;v.featureArray=new ap,v.featureArray.reserve(v.featureData.length);let w=n;for(const C of v.featureData){const A=x?65535&C:C>>16&65535,k=x?C>>16&65535:65535&C,P=(15&k)<8?15&k:0,O=l.evaluatedRMEA[P],G=l.evaluatedColor[P],W=l.emissionHeightBasedParams[P];let te;if(w&&P===2&&h.lights&&(te=new ap,te.resize(10*h.lights.length)),rY(v.featureArray,A,G,O,W,v.aabb.min[2],v.aabb.max[2],te),te&&w){w=!1;const se=h.meshes[h.lightMeshIndex];se.featureArray=te,se.featureArray._trim()}}v.featureArray._trim(),p++}}Tr(VS,"Tiled3dModelBucket",{omit:["layers"]}),Tr(U3,"Tiled3dModelFeature");const iY=["id","tile","layer","source","sourceLayer","state"];class jg{constructor(n,o,h,p,x){this.type="Feature",this._vectorTileFeature=n,this._z=o,this._x=h,this._y=p,this.properties=n?n.properties:{},this.id=x}clone(){const n=new jg(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(n.state=Object.assign({},this.state)),this.layer&&(n.layer=Object.assign({},this.layer)),this.source&&(n.source=this.source),this.sourceLayer&&(n.sourceLayer=this.sourceLayer),n}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const o of iY)this[o]!==void 0&&(n[o]=this[o]);return n}}class Ig extends Ou{constructor(n,o,h,p){super(),this.id=n,this.type="model",this.models=[],this._loaded=!1,this._options=o,this._modelsInfo=new Map}load(){const n=[];for(const o in this._options.models){const h=this._options.models[o],p=this._modelsInfo.get(o);if(p){const x=p.model;x.position=h.position!=null?new X(h.position[0],h.position[1]):new X(0,0),x.orientation=h.orientation!=null?h.orientation:[0,0,0],p.modelSpec=h,Ig.applyModelSpecification(x,h),x.computeBoundsAndApplyParent(),this.models.push(x)}else{const x=aF(this.map._requestManager.transformRequest(h.uri,yh.Model).url).then(v=>{if(!v)return;const w=Xj(v),C=new dF(o,h.uri,h.position,h.orientation,w);Ig.applyModelSpecification(C,h),C.computeBoundsAndApplyParent(),this.models.push(C),this._modelsInfo.set(o,{modelSpec:h,model:C})}).catch(v=>{this.fire(new Vm(new Error(`Could not load model ${o} from ${h.uri}: ${v.message}`)))});n.push(x)}}Promise.allSettled(n).then(()=>{this._loaded=!0,this.fire(new jl("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(o=>{this._loaded=!0,this.fire(new Vm(new Error(`Could not load models: ${o.message}`)))})}static applyModelSpecification(n,o){o.nodeOverrides&&Ig.convertNodeOverrides(n,o.nodeOverrides),o.materialOverrides&&Ig.convertMaterialOverrides(n,o.materialOverrides),o.nodeOverrideNames&&(n.nodeOverrideNames=[...o.nodeOverrideNames]),o.materialOverrideNames&&(n.materialOverrideNames=[...o.materialOverrideNames]),o.featureProperties&&(n.featureProperties=o.featureProperties)}static convertNodeOverrides(n,o){if(Array.isArray(o)&&o.every(h=>typeof h=="string")){n.nodeOverrideNames=[];for(const h of o)n.nodeOverrideNames.push(h)}else Object.entries(o).forEach(([h,p])=>{const x={orientation:[0,0,0]};if(p.hasOwnProperty("orientation")){const v=p.orientation;v&&(x.orientation=v)}n.nodeOverrides.set(h,x)})}static convertMaterialOverrides(n,o){if(Array.isArray(o)&&o.every(h=>typeof h=="string")){n.materialOverrideNames=[];for(const h of o)n.materialOverrideNames.push(h)}else Object.entries(o).forEach(([h,p])=>{const x={color:new Li(1,1,1),colorMix:0,emissionStrength:0,opacity:1},v=p["model-color"];v!==void 0&&(x.color.r=v[0],x.color.g=v[1],x.color.b=v[2]);const w=p["model-color-mix-intensity"];w!==void 0&&(x.colorMix=w);const C=p["model-emissive-strength"];C!==void 0&&(x.emissionStrength=C);const A=p["model-opacity"];A!==void 0&&(x.opacity=A),n.materialOverrides.set(h,x)})}onAdd(n){this.map=n,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(n,o){}serialize(){return this._options}setProperty(n,o){return!1}reload(){const n=Dh(this.id,this.scope);this.map.style.clearSource(n),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(n){this.models=[];const o=new Map;for(const h in n){const p=n[h];if(this._modelsInfo.has(h)){const x=this._modelsInfo.get(h);x&&x.modelSpec.uri===p.uri&&o.set(h,x)}}this._modelsInfo=o,this._options.models=n,this._loaded=!1,this.load()}}function bI(l,n,o,h){const p=1<<l.z;n.lat=we((h/ar+l.y)/p),n.lng=je((o/ar+l.x)/p)}function sY(l,n,o,h){const p=l.getNodesInfo()[n];if(!p||p.hiddenByReplacement||!p.node.meshes)return;let x=Number.MAX_VALUE;const v=p.node,w=o.tile,C=h.calculatePosMatrix(w.tileID.toUnwrapped(),h.worldSize),A=p.evaluatedScale;let k=0;h.elevation&&v.elevation&&(k=v.elevation*h.elevation.exaggeration()),J(C,C,[(v.anchor?v.anchor[0]:0)*(A[0]-1),(v.anchor?v.anchor[1]:0)*(A[1]-1),k]),ne(C,C,A);const P=o.queryGeometry,O=P.isPointQuery()?P.screenBounds:P.screenGeometry,G=function(te){const se=z([],C,te.globalMatrix);z(se,h.expandedFarZProjMatrix,se);for(let oe=0;oe<te.meshes.length;++oe){const ge=te.meshes[oe];if(oe===te.lightMeshIndex)continue;const ve=Gj(O,h,se,ge.aabb);ve!=null&&(x=Math.min(ve,x))}if(te.children)for(const oe of te.children)G(oe)};if(G(v),x===Number.MAX_VALUE)return;const W=new X(0,0);return bI(w.tileID.canonical,W,p.node.anchor[0],p.node.anchor[1]),{intersectionZ:x,position:W,feature:p.feature}}const aY={circle:class extends Po{constructor(l,n,o,h){super(l,{layout:Hu||(Hu=new Zs({"circle-sort-key":new mr(at.layout_circle["circle-sort-key"]),"circle-elevation-reference":new er(at.layout_circle["circle-elevation-reference"]),visibility:new er(at.layout_circle.visibility)})),paint:cp||(cp=new Zs({"circle-radius":new mr(at.paint_circle["circle-radius"]),"circle-color":new mr(at.paint_circle["circle-color"]),"circle-blur":new mr(at.paint_circle["circle-blur"]),"circle-opacity":new mr(at.paint_circle["circle-opacity"]),"circle-translate":new er(at.paint_circle["circle-translate"]),"circle-translate-anchor":new er(at.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new er(at.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new er(at.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new mr(at.paint_circle["circle-stroke-width"]),"circle-stroke-color":new mr(at.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new mr(at.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new er(at.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new mr({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new mr({type:"string",default:"default","property-type":"data-driven"})}))},n,o,h)}createBucket(l){return new Cs(l)}queryRadius(l){const n=l;return Xa("circle-radius",this,n)+Xa("circle-stroke-width",this,n)+$s(this.paint.get("circle-translate"))}queryIntersectsFeature(l,n,o,h,p,x,v,w){const C=lp(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,l.pixelToTileUnitsFactor),A=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o);return HM(l,h,x,v,w,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",C,A)}getProgramIds(){return["circle"]}getDefaultProgramParams(l,n,o){const h=WM(this);return{config:new Wu(this,{zoom:n,lut:o}),defines:h,overrideFog:!1}}is3D(l){return!l&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Po{createBucket(l){return new XM(l)}constructor(l,n,o,h){super(l,{layout:YM||(YM=new Zs({visibility:new er(at.layout_heatmap.visibility)})),paint:KM||(KM=new Zs({"heatmap-radius":new mr(at.paint_heatmap["heatmap-radius"]),"heatmap-weight":new mr(at.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new er(at.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Yf(at.paint_heatmap["heatmap-color"]),"heatmap-opacity":new er(at.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new mr({type:"string",default:"default","property-type":"data-driven"})}))},n,o,h),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=f1({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(l){return Xa("heatmap-radius",this,l)}queryIntersectsFeature(l,n,o,h,p,x,v,w){const C=this.paint.get("heatmap-radius").evaluate(n,o);return HM(l,h,x,v,w,!0,!0,new At(0,0),C)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(l,n,o){return l==="heatmap"?{config:new Wu(this,{zoom:n,lut:o}),overrideFog:!1}:{}}},hillshade:class extends Po{constructor(l,n,o,h){super(l,{layout:JM||(JM=new Zs({visibility:new er(at.layout_hillshade.visibility)})),paint:QM||(QM=new Zs({"hillshade-illumination-direction":new er(at.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new er(at.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new er(at.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new er(at.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new er(at.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new er(at.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new er(at.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new mr({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new mr({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new mr({type:"string",default:"default","property-type":"data-driven"})}))},n,o,h)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(l,n,o){return{overrideFog:!1}}},fill:class extends Po{constructor(l,n,o,h){super(l,{layout:pO||(pO=new Zs({"fill-sort-key":new mr(at.layout_fill["fill-sort-key"]),visibility:new er(at.layout_fill.visibility),"fill-elevation-reference":new er(at.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new mr(at.layout_fill["fill-construct-bridge-guard-rail"])})),paint:mO||(mO=new Zs({"fill-antialias":new er(at.paint_fill["fill-antialias"]),"fill-opacity":new mr(at.paint_fill["fill-opacity"]),"fill-color":new mr(at.paint_fill["fill-color"]),"fill-outline-color":new mr(at.paint_fill["fill-outline-color"]),"fill-translate":new er(at.paint_fill["fill-translate"]),"fill-translate-anchor":new er(at.paint_fill["fill-translate-anchor"]),"fill-pattern":new mr(at.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new er(at.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new er(at.paint_fill["fill-emissive-strength"]),"fill-z-offset":new mr(at.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new mr(at.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new mr(at.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new mr({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new mr({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new mr({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new mr({type:"string",default:"default","property-type":"data-driven"})}))},n,o,h)}getProgramIds(){const l=this.paint.get("fill-pattern"),n=l&&l.constantOr(1),o=[n?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&o.push(n&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),o}getDefaultProgramParams(l,n,o){return{config:new Wu(this,{zoom:n,lut:o}),overrideFog:!1}}recalculate(l,n){super.recalculate(l,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new jj(l)}queryRadius(){return $s(this.paint.get("fill-translate"))}queryIntersectsFeature(l,n,o,h,p,x){return!l.queryGeometry.isAboveHorizon&&Xs(Ml(l.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,l.pixelToTileUnitsFactor),h)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(l){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const n=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return l!=null?n&&!l:n}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Po{constructor(l,n,o,h){super(l,{layout:BO||(BO=new Zs({visibility:new er(at["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new er(at["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:UO||(UO=new Zs({"fill-extrusion-opacity":new er(at["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new mr(at["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new er(at["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new er(at["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new mr(at["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new er(at["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new mr(at["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new mr(at["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new er(at["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new er(at["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new er(at["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new er(at["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new er(at["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new er(at["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new er(at["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new er(at["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new er(at["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new er(at["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new mr(at["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new mr(at["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new er(at["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new er(at["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new er(at["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new er(at["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new mr(at["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new mr(at["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new er(at["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new mr({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new mr({type:"string",default:"default","property-type":"data-driven"})}))},n,o,h),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new fS(l)}queryRadius(){return $s(this.paint.get("fill-extrusion-translate"))}is3D(l){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(l,n,o,h,p,x,v,w,C){const A=lp(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,l.pixelToTileUnitsFactor),k=this.paint.get("fill-extrusion-height").evaluate(n,o),P=this.paint.get("fill-extrusion-base").evaluate(n,o),O=[0,0],G=w&&x.elevation,W=x.elevation?x.elevation.exaggeration():1,te=l.tile.getBucket(this);if(G&&te instanceof fS){const Te=te.centroidVertexArray,$e=C+1;$e<Te.length&&(O[0]=Te.geta_centroid_pos0($e),O[1]=Te.geta_centroid_pos1($e))}if(O[0]===0&&O[1]===1)return!1;x.projection.name==="globe"&&(h=zO([h],[new At(0,0),new At(ar,ar)],l.tileID.canonical).map(Te=>Te.polygon).flat());const se=G?w:null,[oe,ge]=ZO(x,h,P,k,A,v,se,O,W,x.center.lat,l.tileID.canonical),ve=l.queryGeometry;return HO(oe,ge,ve.isPointQuery()?ve.screenBounds:ve.screenGeometry)}},building:class extends Po{constructor(l,n,o,h){super(l,{layout:vF||(vF=new Zs({visibility:new er(at.layout_building.visibility),"building-facade":new mr(at.layout_building["building-facade"]),"building-facade-floors":new mr(at.layout_building["building-facade-floors"]),"building-facade-unit-width":new mr(at.layout_building["building-facade-unit-width"]),"building-facade-window":new mr(at.layout_building["building-facade-window"]),"building-roof-shape":new mr(at.layout_building["building-roof-shape"]),"building-height":new mr(at.layout_building["building-height"]),"building-base":new mr(at.layout_building["building-base"]),"building-flood-light-wall-radius":new mr(at.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new mr(at.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new mr(at.layout_building["building-flip-roof-orientation"])})),paint:yF||(yF=new Zs({"building-opacity":new er(at.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new er(at.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new er(at.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new er(at.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new er(at.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new er(at.paint_building["building-vertical-scale"]),"building-cast-shadows":new er(at.paint_building["building-cast-shadows"]),"building-color":new mr(at.paint_building["building-color"]),"building-emissive-strength":new mr(at.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new er(at.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new er(at.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new er(at.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new er(at.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new er(at.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new mr({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new mr({type:"string",default:"default","property-type":"data-driven"})}))},n,o,h),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new xF(l)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(l){return!0}queryRadius(l){return 0}queryIntersectsFeature(l,n,o,h,p,x,v,w,C){let A=this.layout.get("building-height").evaluate(n,o);const k=this.layout.get("building-base").evaluate(n,o),P=l.tile.getBucket(this).getFootprint(n);if(P){if(P.hiddenFlags!==0)return!1;A=P.height}const[O,G]=ZO(x,h,k,A,new At(0,0),v,null,[0,0],1,x.center.lat,l.tileID.canonical),W=l.queryGeometry;return HO(O,G,W.isPointQuery()?W.screenBounds:W.screenGeometry)}},line:class extends Po{constructor(l,n,o,h){const p=NF();super(l,p,n,o,h),p.layout&&(this.layout=new Ph(p.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){const n=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=n._styleExpression&&n._styleExpression.expression instanceof ng,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(l,n){super.recalculate(l,n),this.paint._values["line-floorwidth"]=(()=>{if(N1)return N1;const o=NF();return N1=new rX(o.paint.properties["line-width"].specification),N1.useIntegerZoom=!0,N1})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new Kj(l)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(l,n,o){const h=jF(this);return{config:new Wu(this,{zoom:n,lut:o}),defines:h,overrideFog:!1}}queryRadius(l){const n=l,o=kF(Xa("line-width",this,n),Xa("line-gap-width",this,n)),h=Xa("line-offset",this,n);return o/2+Math.abs(h)+$s(this.paint.get("line-translate"))}queryIntersectsFeature(l,n,o,h,p,x){if(l.queryGeometry.isAboveHorizon)return!1;const v=Ml(l.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,l.pixelToTileUnitsFactor),w=l.pixelToTileUnitsFactor/2*kF(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),C=this.paint.get("line-offset").evaluate(n,o);return C&&(h=function(A,k){const P=[],O=new At(0,0);for(let G=0;G<A.length;G++){const W=A[G],te=[];for(let se=0;se<W.length;se++){const oe=W[se],ge=W[se+1],ve=se===0?O:oe.sub(W[se-1])._unit()._perp(),Te=se===W.length-1?O:ge.sub(oe)._unit()._perp(),$e=ve._add(Te)._unit();$e._mult(1/($e.x*Te.x+$e.y*Te.y)),te.push($e._mult(k)._add(oe))}P.push(te)}return P}(h,C*l.pixelToTileUnitsFactor)),function(A,k,P){for(let O=0;O<k.length;O++){const G=k[O];if(A.length>=3){for(let W=0;W<G.length;W++)if(Za(A,G[W]))return!0}if(nl(A,G,P))return!0}return!1}(v,h,w)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(l){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:LS,background:class extends Po{constructor(l,n,o,h){super(l,{layout:y3||(y3=new Zs({visibility:new er(at.layout_background.visibility)})),paint:w3||(w3=new Zs({"background-pitch-alignment":new er(at.paint_background["background-pitch-alignment"]),"background-color":new er(at.paint_background["background-color"]),"background-pattern":new er(at.paint_background["background-pattern"]),"background-opacity":new er(at.paint_background["background-opacity"]),"background-emissive-strength":new er(at.paint_background["background-emissive-strength"]),"background-color-use-theme":new mr({type:"string",default:"default","property-type":"data-driven"})}))},n,o,h)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(l,n,o){return{overrideFog:!1}}is3D(l){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:C3,"raster-particle":P3,sky:class extends Po{constructor(l,n,o,h){super(l,{layout:I3||(I3=new Zs({visibility:new er(at.layout_sky.visibility)})),paint:N3||(N3=new Zs({"sky-type":new er(at.paint_sky["sky-type"]),"sky-atmosphere-sun":new er(at.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new er(at.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new er(at.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new er(at.paint_sky["sky-gradient-radius"]),"sky-gradient":new Yf(at.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new er(at.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new er(at.paint_sky["sky-atmosphere-color"]),"sky-opacity":new er(at.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new mr({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new mr({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new mr({type:"string",default:"default","property-type":"data-driven"})}))},n,o,h),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(l){l==="sky-gradient"?this._updateColorRamp():l!=="sky-atmosphere-sun"&&l!=="sky-atmosphere-halo-color"&&l!=="sky-atmosphere-color"&&l!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=f1({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(l){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const n=l.style.light.properties.get("position");return this._lightPosition.azimuthal!==n.azimuthal||this._lightPosition.polar!==n.polar}return!1}getCenter(l,n){if(this.paint.get("sky-type")==="atmosphere"){const h=this.paint.get("sky-atmosphere-sun"),p=!h,x=l.style.light,v=x.properties.get("position");return p&&x.properties.get("anchor")==="viewport"&&ur("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?xI(v.azimuthal,90-v.polar,n):xI(h[0],90-h[1],n)}const o=this.paint.get("sky-gradient-center");return xI(o[0],90-o[1],n)}isSky(){return!0}markSkyboxValid(l){this._skyboxInvalidated=!1,this._lightPosition=l.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const l=this.paint.get("sky-type");return l==="atmosphere"?["skyboxCapture","skybox"]:l==="gradient"?["skyboxGradient"]:null}},slot:class extends Po{constructor(l,n,o,h){super(l,{paint:k3||(k3=new Zs({}))},n,null)}},model:class extends Po{constructor(l,n,o,h){super(l,{layout:O3||(O3=new Zs({visibility:new er(at.layout_model.visibility),"model-id":new mr(at.layout_model["model-id"])})),paint:F3||(F3=new Zs({"model-opacity":new mr(at.paint_model["model-opacity"]),"model-rotation":new mr(at.paint_model["model-rotation"]),"model-scale":new mr(at.paint_model["model-scale"]),"model-translation":new mr(at.paint_model["model-translation"]),"model-color":new mr(at.paint_model["model-color"]),"model-color-mix-intensity":new mr(at.paint_model["model-color-mix-intensity"]),"model-type":new er(at.paint_model["model-type"]),"model-cast-shadows":new er(at.paint_model["model-cast-shadows"]),"model-receive-shadows":new er(at.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new er(at.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new mr(at.paint_model["model-emissive-strength"]),"model-roughness":new mr(at.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new mr(at.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new er(at.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new er(at.paint_model["model-front-cutoff"]),"model-elevation-reference":new er(at.paint_model["model-elevation-reference"]),"model-color-use-theme":new mr({type:"string",default:"default","property-type":"data-driven"})}))},n,o,h),this.layer=l,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new yI(l)}getProgramIds(){return["model"]}is3D(l){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(l){return l instanceof VS?ar-1:0}queryRenderedFeatures(l,n,o){const h=n.getSource();if(!(h&&h instanceof Ig))return{};const p=h,x={};x[this.id]=[];const v=x[this.id];let w=0;for(const C of p.models){const A=n.getFeatureState(this.sourceLayer,C.id),k={type:"Unknown",id:C.id,properties:C.featureProperties},P=this.paint.get("model-rotation").evaluate(k,A),O=this.paint.get("model-scale").evaluate(k,A),G=this.paint.get("model-translation").evaluate(k,A),W=this.paint.get("model-elevation-reference");let te=[];bS(te,C,o,C.position,P,O,G,W==="ground",W==="ground",!1),o.projection.name==="globe"&&(te=wS(te,o));const se=z([],o.projMatrix,te),oe=Gj(l.isPointQuery()?l.screenBounds:l.screenGeometry,o,se,C.aabb);if(oe!=null){const ge=new jg(void 0,0,0,0,C.id);ge.layer=this.layer,ge.properties=structuredClone(C.featureProperties),ge.properties.layer=this.id,ge.properties.uri=C.uri,ge.properties.orientation=C.orientation,ge.sourceLayer=this.sourceLayer,ge.geometry={type:"Point",coordinates:[C.position.lng,C.position.lat]},ge.state=A,ge.source=this.source,v.push({featureIndex:w,feature:ge,intersectionZ:oe})}++w}return x}queryIntersectsFeature(l,n,o,h,p,x){if(!this.modelManager)return!1;const v=this.modelManager,w=l.tile.getBucket(this);if(!(w&&w instanceof yI))return!1;for(const C in w.instancesPerModel){const A=w.instancesPerModel[C],k=n.id!==void 0?n.id:n.properties&&n.properties.hasOwnProperty("id")?n.properties.id:void 0;if(A.idToFeaturesIndex.hasOwnProperty(k)){const P=A.features[A.idToFeaturesIndex[k]],O=v.getModel(C,this.scope);if(!O)return!1;let G=[];const W=new X(0,0),te=w.canonical;let se=Number.MAX_VALUE;for(let oe=0;oe<P.instancedDataCount;++oe){const ge=16*(P.instancedDataOffset+oe),ve=A.instancedDataArray.float32,Te=[ve[ge+4],ve[ge+5],ve[ge+6]];bI(te,W,Math.floor(ve[ge]),Math.floor(ve[ge+1])),bS(G,O,x,W,P.rotation,P.scale,Te,!1,!1,!1),x.projection.name==="globe"&&(G=wS(G,x));const $e=z([],x.projMatrix,G),Fe=l.queryGeometry,Ze=Gj(Fe.isPointQuery()?Fe.screenBounds:Fe.screenGeometry,x,$e,O.aabb);Ze!=null&&(se=Math.min(Ze,se))}return se!==Number.MAX_VALUE&&se}}return!1}_handleOverridablePaintPropertyUpdate(l,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven()||l!=="model-color"&&l!=="model-color-mix-intensity"&&l!=="model-rotation"&&l!=="model-scale"&&l!=="model-translation"&&l!=="model-emissive-strength")}_isPropertyZoomDependent(l){const n=this._transitionablePaint._values[l];return n!=null&&n.value!=null&&n.value.expression!=null&&n.value.expression instanceof Fd}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Po{constructor(l,n,o,h){super(l,{layout:gO||(gO=new Zs({"clip-layer-types":new er(at.layout_clip["clip-layer-types"]),"clip-layer-scope":new er(at.layout_clip["clip-layer-scope"])})),paint:_O||(_O=new Zs({}))},n,o,h)}recalculate(l,n){super.recalculate(l,n)}createBucket(l){return new xO(l)}is3D(l){return!0}}},SI=new Li(0,0,0),TI={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},EI={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},$S={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},oY={PAINT_ORDER_FILL_AND_STROKE:1},W1={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},V3={MASK_TYPE_LUMINANCE:1};function lY(l,n,o){l===1&&n.icons.push(function(h,p){return function(x){if(x.usvg_tree.height||(x.usvg_tree.height=x.usvg_tree.width),!x.metadata)return x;const{metadata:v}=x;if(v.content_area){const{content_area:w}=v;w.left==null&&(w.left=0),w.top==null&&(w.top=w.left),w.width==null&&(w.width=x.usvg_tree.width),w.height==null&&(w.height=w.width)}if(v.text_placeholder){const{text_placeholder:w}=v;w.top==null&&(w.top=w.left),w.height==null&&(w.height=w.width)}return v.stretch_x&&v.stretch_x.length&&$3(v,"x"),v.stretch_y&&v.stretch_y.length&&$3(v,"y"),x}(h.readFields(cY,{name:void 0},p))}(o,o.readVarint()+o.pos))}function $3(l,n){const o=[],h=l[`stretch_${n}`];let p=null;for(let x=0;x<h.length;x++)p===null?p=o.length===0?h[0]:o[o.length-1][1]+h[x]:(o.push([p,p+h[x]]),p=null);l[`stretch_${n}_areas`]=o}function cY(l,n,o){l===1?n.name=o.readString():l===2?n.metadata=function(h,p){return h.readFields(uY,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},p)}(o,o.readVarint()+o.pos):l===3&&(n.usvg_tree=function(h,p){return h.readFields(fY,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},p)}(o,o.readVarint()+o.pos),n.data="usvg_tree")}function uY(l,n,o){l===1?n.stretch_x=o.readPackedVarint():l===2?n.stretch_y=o.readPackedVarint():l===3?n.content_area=q3(o,o.readVarint()+o.pos):l===4?n.variables.push(function(h,p){return h.readFields(hY,{name:void 0},p)}(o,o.readVarint()+o.pos)):l===5&&(n.text_placeholder=q3(o,o.readVarint()+o.pos))}function q3(l,n){return l.readFields(dY,{},n)}function dY(l,n,o){l===1?n.left=o.readVarint():l===2?n.width=o.readVarint():l===3?n.top=o.readVarint():l===4&&(n.height=o.readVarint())}function hY(l,n,o){l===1?n.name=o.readString():l===2&&(n.rgb_color=WS(o.readVarint()),n.value="rgb_color")}function fY(l,n,o){l===1?n.width=n.height=o.readVarint():l===2?n.height=o.readVarint():l===3?n.children.push(qS(o,o.readVarint()+o.pos)):l===4?n.linear_gradients.push(function(h,p){return h.readFields(yY,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},p)}(o,o.readVarint()+o.pos)):l===5?n.radial_gradients.push(function(h,p){return h.readFields(bY,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},p)}(o,o.readVarint()+o.pos)):l===7?n.clip_paths.push(function(h,p){return h.readFields(SY,{children:[]},p)}(o,o.readVarint()+o.pos)):l===8&&n.masks.push(function(h,p){const x=h.readFields(TY,{left:0,width:20,mask_type:V3.MASK_TYPE_LUMINANCE,children:[]},p);return x.height==null&&(x.height=x.width),x.top==null&&(x.top=x.left),x}(o,o.readVarint()+o.pos))}function qS(l,n){return l.readFields(pY,{},n)}function pY(l,n,o){l===1?(n.group=function(h,p){return h.readFields(mY,{opacity:255,children:[]},p)}(o,o.readVarint()+o.pos),n.node="group"):l===2&&(n.path=function(h,p){return h.readFields(_Y,{paint_order:1,commands:[],step:1,diffs:[],rule:TI.PATH_RULE_NON_ZERO},p)}(o,o.readVarint()+o.pos),n.node="path")}function mY(l,n,o){l===1?n.transform=GS(o,o.readVarint()+o.pos):l===2?n.opacity=o.readVarint():l===5?n.clip_path_idx=o.readVarint():l===6?n.mask_idx=o.readVarint():l===7&&n.children.push(qS(o,o.readVarint()+o.pos))}function GS(l,n){return l.readFields(gY,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},n)}function gY(l,n,o){l===1?n.sx=o.readFloat():l===2?n.ky=o.readFloat():l===3?n.kx=o.readFloat():l===4?n.sy=o.readFloat():l===5?n.tx=o.readFloat():l===6&&(n.ty=o.readFloat())}function _Y(l,n,o){l===1?n.fill=function(h,p){return h.readFields(xY,{rgb_color:SI,paint:"rgb_color",opacity:255},p)}(o,o.readVarint()+o.pos):l===2?n.stroke=function(h,p){return h.readFields(vY,{rgb_color:SI,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},p)}(o,o.readVarint()+o.pos):l===3?n.paint_order=o.readVarint():l===5?o.readPackedVarint(n.commands):l===6?n.step=o.readFloat():l===7?o.readPackedSVarint(n.diffs):l===8&&(n.rule=o.readVarint())}function xY(l,n,o){l===1?(n.rgb_color=WS(o.readVarint()),n.paint="rgb_color"):l===2?(n.linear_gradient_idx=o.readVarint(),n.paint="linear_gradient_idx"):l===3?(n.radial_gradient_idx=o.readVarint(),n.paint="radial_gradient_idx"):l===5&&(n.opacity=o.readVarint())}function WS(l){return new Li((l>>16&255)/255,(l>>8&255)/255,(255&l)/255,1)}function vY(l,n,o){l===1?(n.rgb_color=WS(o.readVarint()),n.paint="rgb_color"):l===2?(n.linear_gradient_idx=o.readVarint(),n.paint="linear_gradient_idx"):l===3?(n.radial_gradient_idx=o.readVarint(),n.paint="radial_gradient_idx"):l===5?o.readPackedFloat(n.dasharray):l===6?n.dashoffset=o.readFloat():l===7?n.miterlimit=o.readFloat():l===8?n.opacity=o.readVarint():l===9?n.width=o.readFloat():l===10?n.linecap=o.readVarint():l===11&&(n.linejoin=o.readVarint())}function yY(l,n,o){l===1?n.transform=GS(o,o.readVarint()+o.pos):l===2?n.spread_method=o.readVarint():l===3?n.stops.push(G3(o,o.readVarint()+o.pos)):l===4?n.x1=o.readFloat():l===5?n.y1=o.readFloat():l===6?n.x2=o.readFloat():l===7&&(n.y2=o.readFloat())}function G3(l,n){return l.readFields(wY,{offset:0,opacity:255,rgb_color:SI},n)}function wY(l,n,o){l===1?n.offset=o.readFloat():l===2?n.opacity=o.readVarint():l===3&&(n.rgb_color=WS(o.readVarint()))}function bY(l,n,o){l===1?n.transform=GS(o,o.readVarint()+o.pos):l===2?n.spread_method=o.readVarint():l===3?n.stops.push(G3(o,o.readVarint()+o.pos)):l===4?n.cx=o.readFloat():l===5?n.cy=o.readFloat():l===6?n.r=o.readFloat():l===7?n.fx=o.readFloat():l===8?n.fy=o.readFloat():l===9&&(n.fr=o.readFloat())}function SY(l,n,o){l===1?n.transform=GS(o,o.readVarint()+o.pos):l===2?n.clip_path_idx=o.readVarint():l===3&&n.children.push(qS(o,o.readVarint()+o.pos))}function TY(l,n,o){l===1?n.left=n.top=o.readFloat():l===2?n.width=n.height=o.readFloat():l===3?n.top=o.readFloat():l===4?n.height=o.readFloat():l===5?n.mask_type=o.readVarint():l===6?n.mask_idx=o.readVarint():l===7&&n.children.push(qS(o,o.readVarint()+o.pos))}class EY{static calculate(n={},o=[]){const h=new Map,p=new Map;if(Object.keys(n).length===0)return h;o.forEach(x=>{p.set(x.name,x.rgb_color||new Li(0,0,0))});for(const[x,v]of Object.entries(n))p.has(x)?h.set(p.get(x).toString(),v):console.warn(`Ignoring unknown image variable "${x}"`);return h}}function ex(l,n=255,o){const h=n/255,p=l.toString(),x=o.has(p)?o.get(p).clone():l.clone();return x.a*=h,x.toString()}function H1(l,n){if(!oi()){const o=document.createElement("canvas");return o.width=l,o.height=n,o}return new OffscreenCanvas(l,n)}function CY(l,n){const o=EY.calculate(n.params,l.metadata?l.metadata.variables:[]),h=l.usvg_tree,p=h.width,x=h.height,v=n.transform?n.transform:new DOMMatrix,w=Math.max(1,Math.round(p*v.a)),C=Math.max(1,Math.round(x*v.d)),A=new DOMMatrix([w/p,0,0,C/x,0,0]),k=H1(w,C).getContext("2d");return CI(k,A,h,h,o),k.getImageData(0,0,w,C)}function CI(l,n,o,h,p){for(const x of h.children)W3(l,n,o,x,p)}function W3(l,n,o,h,p){h.group?(l.save(),function(x,v,w,C,A){const k=C.mask_idx!=null?w.masks[C.mask_idx]:null,P=C.clip_path_idx!=null?w.clip_paths[C.clip_path_idx]:null;if(C.transform&&(v=tx(C.transform).preMultiplySelf(v)),!function(W,te,se){return W.opacity!==255||te||se}(C,P!=null,k!=null))return void CI(x,v,w,C,A);const O=H1(x.canvas.width,x.canvas.height),G=O.getContext("2d");CI(G,v,w,C,A),P&&Q3(G,v,w,P),k&&eL(G,v,w,k,A),x.globalAlpha=C.opacity/255,x.drawImage(O,0,0)}(l,n,o,h.group,p),l.restore()):h.path&&(l.save(),function(x,v,w,C,A){x.setTransform(v),C.paint_order===oY.PAINT_ORDER_FILL_AND_STROKE?(H3(x,w,C,A),X3(x,w,C,A)):(X3(x,w,C,A),H3(x,w,C,A))}(l,n,o,h.path,p),l.restore())}function H3(l,n,o,h){const p=o.fill;if(!p)return;const x=p.opacity/255;switch(l.save(),l.beginPath(),tL(o,l),p.paint){case"rgb_color":l.fillStyle=ex(p.rgb_color,p.opacity,h);break;case"linear_gradient_idx":{const v=n.linear_gradients[p.linear_gradient_idx];v.transform&&l.setTransform(tx(v.transform).preMultiplySelf(l.getTransform())),l.fillStyle=Y3(l,v,x,h);break}case"radial_gradient_idx":{const v=n.radial_gradients[p.radial_gradient_idx];v.transform&&l.setTransform(tx(v.transform).preMultiplySelf(l.getTransform())),l.fillStyle=K3(l,v,x,h)}}l.fill(Z3(o)),l.restore()}function Z3(l){return l.rule===TI.PATH_RULE_NON_ZERO?"nonzero":l.rule===TI.PATH_RULE_EVEN_ODD?"evenodd":void 0}function X3(l,n,o,h){const p=o.stroke;if(!p)return;const x=rL(o);l.lineWidth=p.width,l.miterLimit=p.miterlimit,l.setLineDash(p.dasharray),l.lineDashOffset=p.dashoffset;const v=p.opacity/255;switch(p.paint){case"rgb_color":l.strokeStyle=ex(p.rgb_color,p.opacity,h);break;case"linear_gradient_idx":l.strokeStyle=Y3(l,n.linear_gradients[p.linear_gradient_idx],v,h,!0);break;case"radial_gradient_idx":l.strokeStyle=K3(l,n.radial_gradients[p.radial_gradient_idx],v,h,!0)}switch(p.linejoin){case $S.LINE_JOIN_MITER_CLIP:case $S.LINE_JOIN_MITER:l.lineJoin="miter";break;case $S.LINE_JOIN_ROUND:l.lineJoin="round";break;case $S.LINE_JOIN_BEVEL:l.lineJoin="bevel"}switch(p.linecap){case EI.LINE_CAP_BUTT:l.lineCap="butt";break;case EI.LINE_CAP_ROUND:l.lineCap="round";break;case EI.LINE_CAP_SQUARE:l.lineCap="square"}l.stroke(x)}function Y3(l,n,o,h,p=!1){if(n.stops.length===1){const O=n.stops[0];return ex(O.rgb_color,O.opacity*o,h)}const{x1:x,y1:v,x2:w,y2:C}=n;let A=new DOMPoint(x,v),k=new DOMPoint(w,C);if(p){const O=tx(n.transform);A=O.transformPoint(A),k=O.transformPoint(k)}const P=l.createLinearGradient(A.x,A.y,k.x,k.y);for(const O of n.stops)P.addColorStop(O.offset,ex(O.rgb_color,O.opacity*o,h));return P}function K3(l,n,o,h,p=!1){if(n.stops.length===1){const oe=n.stops[0];return ex(oe.rgb_color,oe.opacity*o,h)}const x=tx(n.transform),{fx:v,fy:w,fr:C,cx:A,cy:k,r:P}=n;let O=new DOMPoint(v,w),G=new DOMPoint(A,k),W=C,te=P;if(p){O=x.transformPoint(O),G=x.transformPoint(G);const oe=(x.a+x.d)/2;W=C*oe,te=n.r*oe}const se=l.createRadialGradient(O.x,O.y,W,G.x,G.y,te);for(const oe of n.stops)se.addColorStop(oe.offset,ex(oe.rgb_color,oe.opacity*o,h));return se}function J3(l,n,o,h){const p=h.transform?tx(h.transform).preMultiplySelf(n):n,x=H1(l.canvas.width,l.canvas.height),v=x.getContext("2d");for(const C of h.children)if(C.group)J3(v,p,o,C.group);else if(C.path){const A=C.path,k=new Path2D;k.addPath(rL(A),p),v.fill(k,Z3(A))}const w=h.clip_path_idx!=null?o.clip_paths[h.clip_path_idx]:null;w&&Q3(v,p,o,w),l.globalCompositeOperation="source-over",l.drawImage(x,0,0)}function Q3(l,n,o,h){const p=H1(l.canvas.width,l.canvas.height);J3(p.getContext("2d"),n,o,h),l.globalCompositeOperation="destination-in",l.drawImage(p,0,0)}function eL(l,n,o,h,p){if(h.children.length===0)return;const x=h.mask_idx!=null?o.masks[h.mask_idx]:null;x&&eL(l,n,o,x,p);const v=l.canvas.width,w=l.canvas.height,C=H1(v,w),A=C.getContext("2d"),k=h.width,P=h.height,O=h.left,G=h.top,W=new Path2D,te=new Path2D;te.rect(O,G,k,P),W.addPath(te,n),A.clip(W);for(const ge of h.children)W3(A,n,o,ge,p);const se=A.getImageData(0,0,v,w),oe=se.data;if(h.mask_type===V3.MASK_TYPE_LUMINANCE)for(let ge=0;ge<oe.length;ge+=4)oe[ge+3]=oe[ge+3]/255*(.2126*oe[ge]+.7152*oe[ge+1]+.0722*oe[ge+2]);A.putImageData(se,0,0),l.globalCompositeOperation="destination-in",l.drawImage(C,0,0)}function tx(l){return l?new DOMMatrix([l.sx,l.ky,l.kx,l.sy,l.tx,l.ty]):new DOMMatrix}function tL(l,n){const o=l.step;let h=l.diffs[0]*o,p=l.diffs[1]*o;n.moveTo(h,p);for(let x=0,v=2;x<l.commands.length;x++)switch(l.commands[x]){case W1.PATH_COMMAND_MOVE:h+=l.diffs[v++]*o,p+=l.diffs[v++]*o,n.moveTo(h,p);break;case W1.PATH_COMMAND_LINE:h+=l.diffs[v++]*o,p+=l.diffs[v++]*o,n.lineTo(h,p);break;case W1.PATH_COMMAND_QUAD:{const w=h+l.diffs[v++]*o,C=p+l.diffs[v++]*o;h=w+l.diffs[v++]*o,p=C+l.diffs[v++]*o,n.quadraticCurveTo(w,C,h,p);break}case W1.PATH_COMMAND_CUBIC:{const w=h+l.diffs[v++]*o,C=p+l.diffs[v++]*o,A=w+l.diffs[v++]*o,k=C+l.diffs[v++]*o;h=A+l.diffs[v++]*o,p=k+l.diffs[v++]*o,n.bezierCurveTo(w,C,A,k,h,p);break}case W1.PATH_COMMAND_CLOSE:n.closePath()}return n}function rL(l){return tL(l,new Path2D)}class HS{constructor(n){this.capacity=n,this.cache=new Map}get(n){if(!this.cache.has(n))return;const o=this.cache.get(n);return this.cache.delete(n),this.cache.set(n,o),o}put(n,o){this.cache.has(n)?this.cache.delete(n):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(n,o)}delete(n){this.cache.delete(n)}}Tr(HS,"LRUCache");class AI{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(n){return new bo(n,n.data)}getFromCache(n,o,h){return this.cacheMap.has(h)||this.cacheMap.set(h,new HS(150)),this.cacheMap.get(h).get(Dh(n.toString(),o))}setInCache(n,o,h,p){this.cacheDependenciesMap.has(p)||this.cacheDependenciesMap.set(p,new Map),this.cacheMap.has(p)||this.cacheMap.set(p,new HS(150));const x=this.cacheDependenciesMap.get(p),v=Dh(n.id.toString(),h);x.get(v)||x.set(v,new Set);const w=this.cacheMap.get(p),C=n.toString();x.get(v).add(C),w.put(Dh(n.toString(),h),o)}removeImagesFromCacheByIds(n,o,h=0){if(!this.cacheMap.has(h)||!this.cacheDependenciesMap.has(h))return;const p=this.cacheMap.get(h),x=this.cacheDependenciesMap.get(h);for(const v of n){const w=Dh(v.toString(),o);if(x.has(w)){for(const C of x.get(w))p.delete(C);x.delete(w)}}}rasterize(n,o,h,p,x=CY){const v=this.getFromCache(n,h,p);if(v)return v.clone();const w=x(o.icon,n.options),C=AI._getImage(w);return this.setInCache(n,C,h,p),C.clone()}}class nL{constructor(n){this.size=n,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(n,o){const h=this.toIdx(n,o);return{min:this.minimums[h],max:this.maximums[h]}}isLeaf(n,o){return this.leaves[this.toIdx(n,o)]}toIdx(n,o){return o*this.size+n}}function iL(l,n,o,h){let p=0,x=Number.MAX_VALUE;for(let v=0;v<3;v++)if(Math.abs(h[v])<1e-15){if(o[v]<l[v]||o[v]>n[v])return null}else{const w=1/h[v];let C=(l[v]-o[v])*w,A=(n[v]-o[v])*w;if(C>A){const k=C;C=A,A=k}if(C>p&&(p=C),A<x&&(x=A),p>x)return null}return p}function sL(l,n,o,h,p,x,v,w,C,A,k){const P=h-l,O=p-n,G=x-o,W=v-l,te=w-n,se=C-o,oe=k[1]*se-k[2]*te,ge=k[2]*W-k[0]*se,ve=k[0]*te-k[1]*W,Te=P*oe+O*ge+G*ve;if(Math.abs(Te)<1e-15)return null;const $e=1/Te,Fe=A[0]-l,Ze=A[1]-n,Ye=A[2]-o,Je=(Fe*oe+Ze*ge+Ye*ve)*$e;if(Je<0||Je>1)return null;const Tt=Ze*G-Ye*O,ot=Ye*P-Fe*G,Ct=Fe*O-Ze*P,Mt=(k[0]*Tt+k[1]*ot+k[2]*Ct)*$e;return Mt<0||Je+Mt>1?null:(W*Tt+te*ot+se*Ct)*$e}function aL(l,n,o){return(l-n)/(o-n)}function oL(l,n,o,h,p,x,v,w,C){const A=1<<o,k=x-h,P=v-p,O=(l+1)/A*k+h,G=(n+0)/A*P+p,W=(n+1)/A*P+p;w[0]=(l+0)/A*k+h,w[1]=G,C[0]=O,C[1]=W}class lL{constructor(n){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=n,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const o=function(x){const v=Math.ceil(Math.log2(x.dim/8)),w=[];let C=Math.ceil(Math.pow(2,v));const A=1/C,k=(G,W,te,se,oe)=>{const ge=se?1:0,ve=(G+1)*te-ge,Te=W*te,$e=(W+1)*te-ge;oe[0]=G*te,oe[1]=Te,oe[2]=ve,oe[3]=$e};let P=new nL(C);const O=[];for(let G=0;G<C*C;G++){k(G%C,Math.floor(G/C),A,!1,O);const W=gp(O[0],O[1],x),te=gp(O[2],O[1],x),se=gp(O[2],O[3],x),oe=gp(O[0],O[3],x);P.minimums.push(Math.min(W,te,se,oe)),P.maximums.push(Math.max(W,te,se,oe)),P.leaves.push(1)}for(w.push(P),C/=2;C>=1;C/=2){const G=w[w.length-1];P=new nL(C);for(let W=0;W<C*C;W++){k(W%C,Math.floor(W/C),2,!0,O);const te=G.getElevation(O[0],O[1]),se=G.getElevation(O[2],O[1]),oe=G.getElevation(O[2],O[3]),ge=G.getElevation(O[0],O[3]),ve=G.isLeaf(O[0],O[1]),Te=G.isLeaf(O[2],O[1]),$e=G.isLeaf(O[2],O[3]),Fe=G.isLeaf(O[0],O[3]),Ze=Math.min(te.min,se.min,oe.min,ge.min),Ye=Math.max(te.max,se.max,oe.max,ge.max),Je=ve&&Te&&$e&&Fe;P.maximums.push(Ye),P.minimums.push(Ze),P.leaves.push(Ye-Ze<=5&&Je?1:0)}w.push(P)}return w}(this.dem),h=o.length-1,p=o[h];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(o,0,0,h,0)}raycastRoot(n,o,h,p,x,v,w=1){return iL([n,o,-100],[h,p,this.maximums[0]*w],x,v)}raycast(n,o,h,p,x,v,w=1){if(!this.nodeCount)return null;const C=this.raycastRoot(n,o,h,p,x,v,w);if(C==null)return null;const A=[],k=[],P=[],O=[],G=[{idx:0,t:C,nodex:0,nodey:0,depth:0}];for(;G.length>0;){const{idx:W,t:te,nodex:se,nodey:oe,depth:ge}=G.pop();if(this.leaves[W]){oL(se,oe,ge,n,o,h,p,P,O);const Te=1<<ge,$e=(se+0)/Te,Fe=(se+1)/Te,Ze=(oe+0)/Te,Ye=(oe+1)/Te,Je=gp($e,Ze,this.dem)*w,Tt=gp(Fe,Ze,this.dem)*w,ot=gp(Fe,Ye,this.dem)*w,Ct=gp($e,Ye,this.dem)*w,Mt=sL(P[0],P[1],Je,O[0],P[1],Tt,O[0],O[1],ot,x,v),Bt=sL(O[0],O[1],ot,P[0],O[1],Ct,P[0],P[1],Je,x,v),ir=Math.min(Mt!==null?Mt:Number.MAX_VALUE,Bt!==null?Bt:Number.MAX_VALUE);if(ir!==Number.MAX_VALUE)return ir;{const Jt=Se([],x,v,te);if(cL(Je,Tt,Ct,ot,aL(Jt[0],P[0],O[0]),aL(Jt[1],P[1],O[1]))>=Jt[2])return te}continue}let ve=0;for(let Te=0;Te<this._siblingOffset.length;Te++){oL((se<<1)+this._siblingOffset[Te][0],(oe<<1)+this._siblingOffset[Te][1],ge+1,n,o,h,p,P,O),P[2]=-100,O[2]=this.maximums[this.childOffsets[W]+Te]*w;const $e=iL(P,O,x,v);if($e!=null){const Fe=$e;A[Te]=Fe;let Ze=!1;for(let Ye=0;Ye<ve&&!Ze;Ye++)Fe>=A[k[Ye]]&&(k.splice(Ye,0,Te),Ze=!0);Ze||(k[ve]=Te),ve++}}for(let Te=0;Te<ve;Te++){const $e=k[Te];G.push({idx:this.childOffsets[W]+$e,t:A[$e],nodex:(se<<1)+this._siblingOffset[$e][0],nodey:(oe<<1)+this._siblingOffset[$e][1],depth:ge+1})}}return null}_addNode(n,o,h){return this.minimums.push(n),this.maximums.push(o),this.leaves.push(h),this.childOffsets.push(0),this.nodeCount++}_construct(n,o,h,p,x){if(n[p].isLeaf(o,h)===1)return;this.childOffsets[x]||(this.childOffsets[x]=this.nodeCount);const v=p-1,w=n[v];let C=0,A=0;for(let k=0;k<this._siblingOffset.length;k++){const P=2*o+this._siblingOffset[k][0],O=2*h+this._siblingOffset[k][1],G=w.getElevation(P,O),W=w.isLeaf(P,O),te=this._addNode(G.min,G.max,W);W&&(C|=1<<k),A||(A=te)}for(let k=0;k<this._siblingOffset.length;k++)C&1<<k||this._construct(n,2*o+this._siblingOffset[k][0],2*h+this._siblingOffset[k][1],v,A+k)}}function cL(l,n,o,h,p,x){return fn(fn(l,o,x),fn(n,h,x),p)}function gp(l,n,o){const h=o.dim,p=K(l*h-.5,0,h-1),x=K(n*h-.5,0,h-1),v=Math.floor(p),w=Math.floor(x),C=Math.min(v+1,h-1),A=Math.min(w+1,h-1);return cL(o.get(v,w),o.get(C,w),o.get(v,A),o.get(C,A),p-v,x-w)}const AY={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function jY(l,n,o){return(256*l*256+256*n+o)/10-1e4}function IY(l,n,o){return 256*l+n+o/256-32768}class ZS{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(n,o,h,p=!1){if(this.uid=n,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(h&&h!=="mapbox"&&h!=="terrarium")return void ur(`"${h}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=o.height;const x=this.dim=o.height-2,v=new Uint32Array(o.data.buffer);if(this.pixels=new Uint8Array(o.data.buffer),this.floatView=new Float32Array(o.data.buffer),this.borderReady=p,this._modifiedForSources={},!p){for(let C=0;C<x;C++)v[this._idx(-1,C)]=v[this._idx(0,C)],v[this._idx(x,C)]=v[this._idx(x-1,C)],v[this._idx(C,-1)]=v[this._idx(C,0)],v[this._idx(C,x)]=v[this._idx(C,x-1)];v[this._idx(-1,-1)]=v[this._idx(0,0)],v[this._idx(x,-1)]=v[this._idx(x-1,0)],v[this._idx(-1,x)]=v[this._idx(0,x-1)],v[this._idx(x,x)]=v[this._idx(x-1,x-1)]}const w=h==="terrarium"?IY:jY;for(let C=0;C<v.length;++C){const A=4*C;this.floatView[C]=w(this.pixels[A],this.pixels[A+1],this.pixels[A+2])}this._timestamp=Ti.now()}_buildQuadTree(){this._tree=new lL(this)}get(n,o,h=!1){h&&(n=K(n,-1,this.dim),o=K(o,-1,this.dim));const p=this._idx(n,o);return this.floatView[p]}set(n,o,h){const p=this._idx(n,o),x=this.floatView[p];return this.floatView[p]=h,h-x}static getUnpackVector(n){return AY[n]}_idx(n,o){if(n<-1||n>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(n+1)}static pack(n,o){const h=[0,0,0,0],p=ZS.getUnpackVector(o);let x=Math.floor((n+p[3])/p[2]);return h[2]=x%256,x=Math.floor(x/256),h[1]=x%256,x=Math.floor(x/256),h[0]=x,h}getPixels(){return new rO({width:this.stride,height:this.stride},this.pixels)}backfillBorder(n,o,h){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let p=o*this.dim,x=o*this.dim+this.dim,v=h*this.dim,w=h*this.dim+this.dim;switch(o){case-1:p=x-1;break;case 1:x=p+1}switch(h){case-1:v=w-1;break;case 1:w=v+1}const C=-o*this.dim,A=-h*this.dim;for(let k=v;k<w;k++)for(let P=p;P<x;P++){const O=4*this._idx(P,k),G=4*this._idx(P+C,k+A);this.pixels[O+0]=n.pixels[G+0],this.pixels[O+1]=n.pixels[G+1],this.pixels[O+2]=n.pixels[G+2],this.pixels[O+3]=n.pixels[G+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function NY(l,n,o){l===1?n.headerLength=o.readFixed32():l===2?n.x=o.readVarint():l===3?n.y=o.readVarint():l===4?n.z=o.readVarint():l===5&&n.layers.push(function(h,p){return h.readFields(MY,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},p)}(o,o.readVarint()+o.pos))}function kY(l,n,o){l===1?(n.delta_filter=function(h,p){return h.readFields(PY,{blockSize:0},p)}(o,o.readVarint()+o.pos),n.filter="delta_filter"):l===2?(o.readVarint(),n.filter="zigzag_filter"):l===3?(o.readVarint(),n.filter="bitshuffle_filter"):l===4&&(o.readVarint(),n.filter="byteshuffle_filter")}function PY(l,n,o){l===1&&(n.blockSize=o.readVarint())}function DY(l,n,o){l===1?(o.readVarint(),n.codec="gzip_data"):l===2?(o.readVarint(),n.codec="jpeg_image"):l===3?(o.readVarint(),n.codec="webp_image"):l===4&&(o.readVarint(),n.codec="png_image")}function RY(l,n,o){let h=0,p=0;l===1?n.firstByte=o.readFixed64():l===2?n.lastByte=o.readFixed64():l===3?n.filters.push(function(x,v){return x.readFields(kY,{},v)}(o,o.readVarint()+o.pos)):l===4?n.codec=function(x,v){return x.readFields(DY,{},v)}(o,o.readVarint()+o.pos):l===5?p=o.readFloat():l===6?h=o.readFloat():l===7?n.bands.push(o.readString()):l===8?n.offset=o.readDouble():l===9&&(n.scale=o.readDouble()),n.offset===0&&(n.offset=p),n.scale===0&&(n.scale=h)}function MY(l,n,o){l===1?n.version=o.readVarint():l===2?n.name=o.readString():l===3?n.units=o.readString():l===4?n.tileSize=o.readVarint():l===5?n.buffer=o.readVarint():l===6?n.pixelFormat=o.readVarint():l===7&&n.dataIndex.push(function(h,p){return h.readFields(RY,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},p)}(o,o.readVarint()+o.pos))}function OY(l,n,o){if(l===2)(function(h,p,x){h.readFields(FY,x,p)})(o,o.readVarint()+o.pos,n);else if(l===3)throw new Error("Not implemented")}function FY(l,n,o){if(l===1){let h=0;const p=o.readVarint()+o.pos;for(;o.pos<p;)n[h++]=o.readVarint()}}function LY(l,n){if(n.length!==4)throw new Error(`Expected data of dimension 4 but got ${n.length}.`);let o=n[3];for(let h=2;h>=1;h--){const p=h===1?1:0,x=h===2?1:0;for(let v=0;v<n[0];v++){const w=n[1]*v;for(let C=p;C<n[1];C++){const A=n[2]*(C+w);for(let k=x;k<n[2];k++){const P=n[3]*(k+A);for(let O=0;O<n[3];O++){const G=P+O;l[G]+=l[G-o]}}}}o*=n[h]}return l}function zY(l){for(let n=0,o=l.length;n<o;n++)l[n]=l[n]>>>1^-(1&l[n]);return l}function BY(l,n){switch(n){case"uint32":return l;case"uint16":for(let o=0;o<l.length;o+=2){const h=l[o],p=l[o+1];l[o]=(240&h)>>4|(61440&h)>>8|(240&p)<<4|61440&p,l[o+1]=15&h|(3840&h)>>4|(15&p)<<8|(3840&p)<<4}return l;case"uint8":for(let o=0;o<l.length;o+=4){const h=l[o],p=l[o+1],x=l[o+2],v=l[o+3];l[o+0]=(192&h)>>6|(192&p)>>4|(192&x)>>2|192&v,l[o+1]=(48&h)>>4|(48&p)>>2|48&x|(48&v)<<2,l[o+2]=(12&h)>>2|12&p|(12&x)<<2|(12&v)<<4,l[o+3]=3&h|(3&p)<<2|(3&x)<<4|(3&v)<<6}return l;default:throw new Error(`Invalid pixel format, "${n}"`)}}Tr(ZS,"DEMData"),Tr(lL,"DemMinMaxQuadTree",{omit:["dem"]});var Mc=Uint8Array,Z1=Uint16Array,UY=Int32Array,uL=new Mc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),dL=new Mc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),VY=new Mc([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),hL=function(l,n){for(var o=new Z1(31),h=0;h<31;++h)o[h]=n+=1<<l[h-1];var p=new UY(o[30]);for(h=1;h<30;++h)for(var x=o[h];x<o[h+1];++x)p[x]=x-o[h]<<5|h;return{b:o,r:p}},fL=hL(uL,2),pL=fL.b,$Y=fL.r;pL[28]=258,$Y[258]=28;for(var qY=hL(dL,0).b,mL=new Z1(32768),Ma=0;Ma<32768;++Ma){var rx=(43690&Ma)>>1|(21845&Ma)<<1;mL[Ma]=((65280&(rx=(61680&(rx=(52428&rx)>>2|(13107&rx)<<2))>>4|(3855&rx)<<4))>>8|(255&rx)<<8)>>1}var X1=function(l,n,o){for(var h=l.length,p=0,x=new Z1(n);p<h;++p)l[p]&&++x[l[p]-1];var v,w=new Z1(n);for(p=1;p<n;++p)w[p]=w[p-1]+x[p-1]<<1;v=new Z1(1<<n);var C=15-n;for(p=0;p<h;++p)if(l[p])for(var A=p<<4|l[p],k=n-l[p],P=w[l[p]-1]++<<k,O=P|(1<<k)-1;P<=O;++P)v[mL[P]>>C]=A;return v},Y1=new Mc(288);for(Ma=0;Ma<144;++Ma)Y1[Ma]=8;for(Ma=144;Ma<256;++Ma)Y1[Ma]=9;for(Ma=256;Ma<280;++Ma)Y1[Ma]=7;for(Ma=280;Ma<288;++Ma)Y1[Ma]=8;var gL=new Mc(32);for(Ma=0;Ma<32;++Ma)gL[Ma]=5;var GY=X1(Y1,9),WY=X1(gL,5),jI=function(l){for(var n=l[0],o=1;o<l.length;++o)l[o]>n&&(n=l[o]);return n},Ku=function(l,n,o){var h=n/8|0;return(l[h]|l[h+1]<<8)>>(7&n)&o},II=function(l,n){var o=n/8|0;return(l[o]|l[o+1]<<8|l[o+2]<<16)>>(7&n)},HY=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ju=function(l,n,o){var h=new Error(n||HY[l]);if(h.code=l,Error.captureStackTrace&&Error.captureStackTrace(h,Ju),!o)throw h;return h},ZY=new Mc(0),XY=typeof TextDecoder<"u"&&new TextDecoder;try{XY.decode(ZY,{stream:!0})}catch{}const YY={gzip_data:"gzip"};class fu extends Error{constructor(n){super(n),this.name="MRTError"}}const KY={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},_L={uint32:1,uint16:2,uint8:4},JY={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let NI;class XS{constructor(n=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=n}getLayer(n){const o=this.layers[n];if(!o)throw new fu(`Layer '${n}' not found`);return o}getHeaderLength(n){const o=new Uint8Array(n),h=new DataView(n);if(o[0]!==13)throw new fu("File is not a valid MRT.");return h.getUint32(1,!0)}parseHeader(n){const o=new Uint8Array(n),h=this.getHeaderLength(n);if(o.length<h)throw new fu(`Expected header with length >= ${h} but got buffer of length ${o.length}`);const p=new NI(o.subarray(0,h)).readFields(NY,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==p.x||this.y!==p.y||this.z!==p.z))throw new fu(`Invalid attempt to parse header ${p.z}/${p.x}/${p.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=p.x,this.y=p.y,this.z=p.z;for(const x of p.layers)this.layers[x.name]=new xL(x,{cacheSize:this._cacheSize});return this}createDecodingTask(n){const o=[],h=this.getLayer(n.layerName);for(let p of n.blockIndices){const x=h.dataIndex[p],v=x.firstByte-n.firstByte,w=x.lastByte-n.firstByte;if(h._blocksInProgress.has(p))continue;const C={layerName:h.name,firstByte:v,lastByte:w,pixelFormat:h.pixelFormat,blockIndex:p,blockShape:[x.bands.length].concat(h.bandShape),buffer:h.buffer,codec:x.codec.codec,filters:x.filters.map(A=>A.filter)};h._blocksInProgress.add(p),o.push(C)}return new vL(o,()=>{o.forEach(p=>h._blocksInProgress.delete(p.blockIndex))},(p,x)=>{if(o.forEach(v=>h._blocksInProgress.delete(v.blockIndex)),p)throw p;x.forEach(v=>{this.getLayer(v.layerName).processDecodedData(v)})})}}class xL{constructor({version:n,name:o,units:h,tileSize:p,pixelFormat:x,buffer:v,dataIndex:w},C){if(this.version=n,this.version!==1)throw new fu(`Cannot parse raster layer encoded with MRT version ${n}`);this.name=o,this.units=h,this.tileSize=p,this.buffer=v,this.pixelFormat=KY[x],this.dataIndex=w,this.bandShape=[p+2*v,p+2*v,_L[this.pixelFormat]],this._decodedBlocks=new HS(C?C.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return _L[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:n})=>n).flat()}processDecodedData(n){const o=n.blockIndex.toString();this._decodedBlocks.get(o)||this._decodedBlocks.put(o,n.data)}getBlockForBand(n){let o=0;switch(typeof n){case"string":for(const[h,p]of this.dataIndex.entries()){for(const[x,v]of p.bands.entries())if(v===n)return{bandIndex:o+x,blockIndex:h,blockBandIndex:x};o+=p.bands.length}break;case"number":for(const[h,p]of this.dataIndex.entries()){if(n>=o&&n<o+p.bands.length)return{bandIndex:n,blockIndex:h,blockBandIndex:n-o};o+=p.bands.length}break;default:throw new fu(`Invalid band \`${JSON.stringify(n)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(n){let o=1/0,h=-1/0;const p=[],x=new Set;for(const v of n){const{blockIndex:w}=this.getBlockForBand(v);if(w<0)throw new fu(`Invalid band: ${JSON.stringify(v)}`);const C=this.dataIndex[w];p.includes(w)||p.push(w),x.add(w),o=Math.min(o,C.firstByte),h=Math.max(h,C.lastByte)}if(x.size>this.cacheSize)throw new fu(`Number of blocks to decode (${x.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:o,lastByte:h,blockIndices:p}}hasBand(n){const{blockIndex:o}=this.getBlockForBand(n);return o>=0}hasDataForBand(n){const{blockIndex:o}=this.getBlockForBand(n);return o>=0&&!!this._decodedBlocks.get(o.toString())}getBandView(n){const{blockIndex:o,blockBandIndex:h}=this.getBlockForBand(n);if(o<0)throw new fu(`Band not found: ${JSON.stringify(n)}`);const p=this._decodedBlocks.get(o.toString());if(!p)throw new fu(`Data for band ${JSON.stringify(n)} of layer "${this.name}" not decoded.`);const x=this.dataIndex[o],v=this.bandShape.reduce((A,k)=>A*k,1),w=h*v,C=p.subarray(w,w+v);return{data:C,bytes:new Uint8Array(C.buffer).subarray(C.byteOffset,C.byteOffset+C.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:x.offset,scale:x.scale}}}XS.setPbf=function(l){NI=l};class vL{constructor(n,o,h){this.tasks=n,this._onCancel=o,this._onComplete=h,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(n,o){this._finalized||(this._onComplete(n,o),this._finalized=!0)}}XS.performDecoding=function(l,n){const o=new Uint8Array(l);return Promise.all(n.tasks.map(h=>{const{layerName:p,firstByte:x,lastByte:v,pixelFormat:w,blockShape:C,blockIndex:A,filters:k,codec:P}=h,O=o.subarray(x,v+1),G=new Uint32Array(C[0]*C[1]*C[2]);let W;if(P!=="gzip_data")throw new fu(`Unhandled codec: ${P}`);return W=function(te,se){if(!globalThis.DecompressionStream&&se==="gzip_data")return Promise.resolve(((Te=function(Ze){Ze[0]==31&&Ze[1]==139&&Ze[2]==8||Ju(6,"invalid gzip data");var Ye=Ze[3],Je=10;4&Ye&&(Je+=2+(Ze[10]|Ze[11]<<8));for(var Tt=(Ye>>3&1)+(Ye>>4&1);Tt>0;Tt-=!Ze[Je++]);return Je+(2&Ye)}(ve=te))+8>ve.length&&Ju(6,"invalid gzip data"),function(Ze,Ye,Je,Tt){var ot=Ze.length;if(!ot||Ye.f&&!Ye.l)return Je||new Mc(0);var Ct=!Je,Mt=Ct||Ye.i!=2,Bt=Ye.i;Ct&&(Je=new Mc(3*ot));var ir,Jt,Ft=function(qs){var xs=Je.length;if(qs>xs){var ss=new Mc(Math.max(2*xs,qs));ss.set(Je),Je=ss}},Yt=Ye.f||0,wt=Ye.p||0,vt=Ye.b||0,Ht=Ye.l,rr=Ye.d,Lt=Ye.m,br=Ye.n,Ir=8*ot;do{if(!Ht){Yt=Ku(Ze,wt,1);var _r=Ku(Ze,wt+1,3);if(wt+=3,!_r){var dr=Ze[(Le=4+((wt+7)/8|0))-4]|Ze[Le-3]<<8,En=Le+dr;if(En>ot){Bt&&Ju(0);break}Mt&&Ft(vt+dr),Je.set(Ze.subarray(Le,En),vt),Ye.b=vt+=dr,Ye.p=wt=8*En,Ye.f=Yt;continue}if(_r==1)Ht=GY,rr=WY,Lt=9,br=5;else if(_r==2){var pr=Ku(Ze,wt,31)+257,Qr=Ku(Ze,wt+10,15)+4,jn=pr+Ku(Ze,wt+5,31)+1;wt+=14;for(var Gn=new Mc(jn),mi=new Mc(19),Pn=0;Pn<Qr;++Pn)mi[VY[Pn]]=Ku(Ze,wt+3*Pn,7);wt+=3*Qr;var Ei=jI(mi),Ci=(1<<Ei)-1,As=X1(mi,Ei);for(Pn=0;Pn<jn;){var Le,Pe=As[Ku(Ze,wt,Ci)];if(wt+=15&Pe,(Le=Pe>>4)<16)Gn[Pn++]=Le;else{var jt=0,cr=0;for(Le==16?(cr=3+Ku(Ze,wt,3),wt+=2,jt=Gn[Pn-1]):Le==17?(cr=3+Ku(Ze,wt,7),wt+=3):Le==18&&(cr=11+Ku(Ze,wt,127),wt+=7);cr--;)Gn[Pn++]=jt}}var It=Gn.subarray(0,pr),fr=Gn.subarray(pr);Lt=jI(It),br=jI(fr),Ht=X1(It,Lt),rr=X1(fr,br)}else Ju(1);if(wt>Ir){Bt&&Ju(0);break}}Mt&&Ft(vt+131072);for(var Br=(1<<Lt)-1,Mr=(1<<br)-1,Mn=wt;;Mn=wt){var cn=(jt=Ht[II(Ze,wt)&Br])>>4;if((wt+=15&jt)>Ir){Bt&&Ju(0);break}if(jt||Ju(2),cn<256)Je[vt++]=cn;else{if(cn==256){Mn=wt,Ht=null;break}var Dr=cn-254;cn>264&&(Dr=Ku(Ze,wt,(1<<(dn=uL[Pn=cn-257]))-1)+pL[Pn],wt+=dn);var Si=rr[II(Ze,wt)&Mr],Yi=Si>>4;if(Si||Ju(3),wt+=15&Si,fr=qY[Yi],Yi>3){var dn=dL[Yi];fr+=II(Ze,wt)&(1<<dn)-1,wt+=dn}if(wt>Ir){Bt&&Ju(0);break}Mt&&Ft(vt+131072);var hi=vt+Dr;if(vt<fr){var Ki=0-fr,zi=Math.min(fr,hi);for(Ki+vt<0&&Ju(3);vt<zi;++vt)Je[vt]=(void 0)[Ki+vt]}for(;vt<hi;++vt)Je[vt]=Je[vt-fr]}}Ye.l=Ht,Ye.p=Mn,Ye.b=vt,Ye.f=Yt,Ht&&(Yt=1,Ye.m=Lt,Ye.d=rr,Ye.n=br)}while(!Yt);return vt!=Je.length&&Ct?(ir=Je,((Jt=vt)==null||Jt>ir.length)&&(Jt=ir.length),new Mc(ir.subarray(0,Jt))):Je.subarray(0,vt)}(ve.subarray(Te,-8),{i:2},new Mc(((oe=ve)[(ge=oe.length)-4]|oe[ge-3]<<8|oe[ge-2]<<16|oe[ge-1]<<24)>>>0))));var oe,ge,ve,Te;const $e=YY[se];if(!$e)throw new Error(`Unhandled codec: ${se}`);const Fe=new globalThis.DecompressionStream($e);return new Response(new Blob([te]).stream().pipeThrough(Fe)).arrayBuffer().then(Ze=>new Uint8Array(Ze))}(O,P).then(te=>(function(se,oe){se.readFields(OY,oe)}(new NI(te),G),new JY[w](G.buffer))),W.then(te=>{for(let se=k.length-1;se>=0;se--)switch(k[se]){case"delta_filter":LY(te,C);break;case"zigzag_filter":zY(te);break;case"bitshuffle_filter":BY(te,w);break;default:throw new fu(`Unhandled filter "${k[se]}"`)}return{layerName:p,blockIndex:A,data:te}}).catch(te=>{throw te})}))},Tr(vL,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Tr(XS,"MapboxRasterTile"),Tr(xL,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class yL{constructor(n){this._stringToNumber={},this._numberToString=[];for(let o=0;o<n.length;o++){const h=n[o];this._stringToNumber[h]=o,this._numberToString[o]=h}}encode(n){return this._stringToNumber[n]}decode(n){return this._numberToString[n]}}class wL{constructor(n,o){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new kh(ar,16,0),this.featureIndexArray=new H2,this.promoteId=o,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(n,o,h,p,x,v=0,w=0){const C=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,p,x,v);const A=this.grid;for(let k=0;k<o.length;k++){const P=o[k],O=[1/0,1/0,-1/0,-1/0];for(let G=0;G<P.length;G++){const W=P[G];O[0]=Math.min(O[0],W.x),O[1]=Math.min(O[1],W.y),O[2]=Math.max(O[2],W.x),O[3]=Math.max(O[3],W.y)}w!==0&&(O[0]-=w,O[1]-=w,O[2]+=w,O[3]+=w),O[0]<ar&&O[1]<ar&&O[2]>=0&&O[3]>=0&&A.insert(C,O[0],O[1],O[2],O[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new kr(new ES(this.rawTileData)).layers,this.sourceLayerCoder=new yL(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const n in this.vtLayers)this.vtFeatures[n]=[]}return this.vtLayers}query(n,o){const{tilespaceGeometry:h,transform:p,tileTransform:x,pixelPosMatrix:v,availableImages:w,worldview:C}=o;this.loadVTLayers(),this.serializedLayersCache.clear();const A=o.queryRadius?o.queryRadius:0,k=h.bufferedTilespaceBounds,P=this.grid.query(k.min.x,k.min.y,k.max.x,k.max.y,(te,se,oe,ge)=>Vs(h.bufferedTilespaceGeometry,te-A,se-A,oe+A,ge+A));P.sort(QY);let O=null;p.elevation&&P.length>0&&(O=Q0.create(p.elevation,this.tileID));const G={};let W;for(let te=0;te<P.length;te++){const se=P[te];if(se===W)continue;W=se;const oe=this.featureIndexArray.get(se);let ge=null;this.is3DTile?this.loadMatchingModelFeature(G,oe,n,h,p,C):this.loadMatchingFeature(G,oe,n,w,C,(ve,Te,$e,Fe=0)=>(ge||(ge=Pt(ve,this.tileID.canonical,x)),Te.queryIntersectsFeature(h,ve,$e,ge,this.z,p,v,O,Fe)))}return G}loadMatchingFeature(n,o,h,p,x,v){const{featureIndex:w,bucketIndex:C,sourceLayerIndex:A,layoutVertexArrayOffset:k}=o,P=this.bucketLayerIDs[C],O=h.layers,G=Object.keys(O);if(G.length&&!Xt(G,P))return;const W=h.sourceCache,te=this.sourceLayerCoder.decode(A),se=this.vtLayers[te].feature(w),oe=this.getId(se,te);for(let ge=0;ge<P.length;ge++){const ve=P[ge];if(!O[ve])continue;const{styleLayer:Te,targets:$e}=O[ve];let Fe={};oe!==void 0&&(Fe=W.getFeatureState(Te.sourceLayer,oe));const Ze=!v||v(se,Te,Fe,k);if(!Ze)continue;const Ye=new jg(se,this.z,this.x,this.y,oe);Ye.tile=this.tileID.canonical,Ye.state=Fe;let Je=this.serializedLayersCache.get(ve);Je||(Je=Te.serialize(),Je.id=ve,this.serializedLayersCache.set(ve,Je)),Ye.source=Je.source,Ye.sourceLayer=Je["source-layer"],Ye.layer=Object.assign({},Je),Ye.layer.paint=bL(Je.paint,Te.paint,se,Fe,p),Ye.layer.layout=bL(Je.layout,Te.layout,se,Fe,p);let Tt=!1;for(const ot of $e){this.updateFeatureProperties(Ye,ot);const{filter:Ct}=ot;if(Ct){if(se.properties=Ye.properties,Ct.needGeometry){const Mt=xt(se,!0);if(!Ct.filter(new us(this.tileID.overscaledZ,{worldview:x}),Mt,this.tileID.canonical))continue}else if(!Ct.filter(new us(this.tileID.overscaledZ,{worldview:x}),se))continue}Tt=!0,ot.targetId&&this.addFeatureVariant(Ye,ot)}Tt&&this.appendToResult(n,ve,w,Ye,Ze)}}loadMatchingModelFeature(n,o,h,p,x,v){const{featureIndex:w,bucketIndex:C}=o,A=this.bucketLayerIDs[C],k=h.layers,P=Object.keys(k);if(!P.length||Xt(P,A))for(let O=0;O<A.length;O++){const G=A[O],{styleLayer:W,targets:te}=k[G];if(W.type!=="model")continue;const se=p.tile,oe=se.getBucket(W);if(!(oe&&oe instanceof VS))continue;const ge=sY(oe,w,p,x);if(!ge)continue;const{z:ve,x:Te,y:$e}=se.tileID.canonical,{feature:Fe,intersectionZ:Ze,position:Ye}=ge;let Je={};Fe.id!==void 0&&(Je=h.sourceCache.getFeatureState(W.sourceLayer,Fe.id));const Tt=new jg({},ve,Te,$e,Fe.id);Tt.tile=this.tileID.canonical,Tt.state=Je,Tt.properties=Fe.properties,Tt.geometry={type:"Point",coordinates:[Ye.lng,Ye.lat]};let ot=this.serializedLayersCache.get(G);ot||(ot=W.serialize(),ot.id=G,this.serializedLayersCache.set(G,ot)),Tt.source=ot.source,Tt.sourceLayer=ot["source-layer"],Tt.layer=Object.assign({},ot);let Ct=!1;for(const Mt of te){this.updateFeatureProperties(Tt,Mt);const{filter:Bt}=Mt;if(Bt){if(Fe.properties=Tt.properties,Bt.needGeometry){if(!Bt.filter(new us(this.tileID.overscaledZ,{worldview:v}),Fe,this.tileID.canonical))continue}else if(!Bt.filter(new us(this.tileID.overscaledZ,{worldview:v}),Fe))continue}Ct=!0,Mt.targetId&&this.addFeatureVariant(Tt,Mt)}Ct&&this.appendToResult(n,G,w,Tt,Ze)}}updateFeatureProperties(n,o,h){if(o.properties){const p={};for(const x in o.properties){const v=o.properties[x].evaluate({zoom:this.z},n._vectorTileFeature,n.state,n.tile,h);v!=null&&(p[x]=v)}n.properties=p}}addFeatureVariant(n,o,h){const p={target:o.target,namespace:o.namespace,uniqueFeatureID:o.uniqueFeatureID};o.properties&&(p.properties=n.properties),n.variants=n.variants||{},n.variants[o.targetId]=n.variants[o.targetId]||[],n.variants[o.targetId].push(p)}appendToResult(n,o,h,p,x){let v=n[o];v===void 0&&(v=n[o]=[]),v.push({featureIndex:h,feature:p,intersectionZ:x})}lookupSymbolFeatures(n,o,h,p,x,v){const w={};this.loadVTLayers();for(const C of n)this.loadMatchingFeature(w,{bucketIndex:o,sourceLayerIndex:h,featureIndex:C,layoutVertexArrayOffset:0},p,x,v);return w}loadFeature(n){const{featureIndex:o,sourceLayerIndex:h}=n;this.loadVTLayers();const p=this.sourceLayerCoder.decode(h),x=this.vtFeatures[p];if(x[o])return x[o];const v=this.vtLayers[p].feature(o);return x[o]=v,v}hasLayer(n){for(const o of this.bucketLayerIDs)for(const h of o)if(n===h)return!0;return!1}getId(n,o){let h=n.id;if(this.promoteId){const p=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[o];if(p!=null)if(Array.isArray(p)){if(!this.promoteIdExpression){const x=uu(p);if(x.result!=="success"){const v=x.value.map(w=>`${w.key}: ${w.message}`).join(", ");return void ur(`Failed to create expression for promoteId: ${v}`)}this.promoteIdExpression=x.value}h=this.promoteIdExpression.evaluate({zoom:0},n)}else h=n.properties[p];typeof h=="boolean"&&(h=Number(h))}return h}}function bL(l,n,o,h,p){return et(l,(x,v)=>{const w=n instanceof Ph?n.get(v):null;return w&&w.evaluate?w.evaluate(o,h,void 0,p):w})}function QY(l,n){return n-l}Tr(wL,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const SL=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class kI{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,h]=new Uint8Array(n,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=h>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const x=SL[15&h];if(!x)throw new Error("Unrecognized array type.");const[v]=new Uint16Array(n,2,1),[w]=new Uint32Array(n,4,1);return new kI(w,v,x,n)}constructor(n,o=64,h=Float64Array,p){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=h,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;const x=SL.indexOf(this.ArrayType),v=2*n*this.ArrayType.BYTES_PER_ELEMENT,w=n*this.IndexArrayType.BYTES_PER_ELEMENT,C=(8-w%8)%8;if(x<0)throw new Error(`Unexpected typed array class: ${h}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+w+C,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+v+w+C),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+w+C,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+x]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=n)}add(n,o){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=n,this.coords[this._pos++]=o,h}finish(){const n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return PI(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,o,h,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:x,coords:v,nodeSize:w}=this,C=[0,x.length-1,0],A=[];for(;C.length;){const k=C.pop()||0,P=C.pop()||0,O=C.pop()||0;if(P-O<=w){for(let se=O;se<=P;se++){const oe=v[2*se],ge=v[2*se+1];oe>=n&&oe<=h&&ge>=o&&ge<=p&&A.push(x[se])}continue}const G=O+P>>1,W=v[2*G],te=v[2*G+1];W>=n&&W<=h&&te>=o&&te<=p&&A.push(x[G]),(k===0?n<=W:o<=te)&&(C.push(O),C.push(G-1),C.push(1-k)),(k===0?h>=W:p>=te)&&(C.push(G+1),C.push(P),C.push(1-k))}return A}within(n,o,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:x,nodeSize:v}=this,w=[0,p.length-1,0],C=[],A=h*h;for(;w.length;){const k=w.pop()||0,P=w.pop()||0,O=w.pop()||0;if(P-O<=v){for(let se=O;se<=P;se++)EL(x[2*se],x[2*se+1],n,o)<=A&&C.push(p[se]);continue}const G=O+P>>1,W=x[2*G],te=x[2*G+1];EL(W,te,n,o)<=A&&C.push(p[G]),(k===0?n-h<=W:o-h<=te)&&(w.push(O),w.push(G-1),w.push(1-k)),(k===0?n+h>=W:o+h>=te)&&(w.push(G+1),w.push(P),w.push(1-k))}return C}}function PI(l,n,o,h,p,x){if(p-h<=o)return;const v=h+p>>1;TL(l,n,v,h,p,x),PI(l,n,o,h,v-1,1-x),PI(l,n,o,v+1,p,1-x)}function TL(l,n,o,h,p,x){for(;p>h;){if(p-h>600){const A=p-h+1,k=o-h+1,P=Math.log(A),O=.5*Math.exp(2*P/3),G=.5*Math.sqrt(P*O*(A-O)/A)*(k-A/2<0?-1:1);TL(l,n,o,Math.max(h,Math.floor(o-k*O/A+G)),Math.min(p,Math.floor(o+(A-k)*O/A+G)),x)}const v=n[2*o+x];let w=h,C=p;for(K1(l,n,h,o),n[2*p+x]>v&&K1(l,n,h,p);w<C;){for(K1(l,n,w,C),w++,C--;n[2*w+x]<v;)w++;for(;n[2*C+x]>v;)C--}n[2*h+x]===v?K1(l,n,h,C):(C++,K1(l,n,C,p)),C<=o&&(h=C+1),o<=C&&(p=C-1)}}function K1(l,n,o,h){DI(l,o,h),DI(n,2*o,2*h),DI(n,2*o+1,2*h+1)}function DI(l,n,o){const h=l[n];l[n]=l[o],l[o]=h}function EL(l,n,o,h){const p=l-o,x=n-h;return p*p+x*x}i.$=B_,i.A=Lu,i.B=Dh,i.C=2,i.D=B0,i.E=Ou,i.F=D1,i.G=KF,i.H=z_,i.I=Ra,i.J=qy,i.K=Df,i.L=Ym,i.M=u0,i.N=c0,i.O=ky,i.P=At,i.Q=p0,i.R=yh,i.S=Kf,i.T=$j,i.U=uu,i.V=US,i.W=Dy,i.X=Uf,i.Y=Bf,i.Z=rg,i._=ko,i.a=function(l){return cs.API_CDN_URL_REGEX.test(l)},i.a$=tp,i.a0=yn,i.a1=ny,i.a2=Jf,i.a3=class extends US{},i.a4=d0,i.a5=Ny,i.a6=at,i.a7=function(l){const n=l.value;return n?yn(n)?vI(n,!0)?[]:[new US(l.key,n,`invalid url "${n}"`)]:[new US(l.key,n,`string expected, "${Df(n)}" found`)]:[]},i.a8=O2,i.a9=Zs,i.aA=K,i.aB=z,i.aC=Sr,i.aD=rl,i.aE=Za,i.aF=fe,i.aG=bt,i.aH=function(l,n){const o={};for(let h=0;h<n.length;h++){const p=n[h];p in l&&(o[p]=l[p])}return o},i.aI=q,i.aJ=de,i.aK=class{constructor(l){this.entries={},this.scheduler=l}request(l,n,o,h){const p=this.entries[l]=this.entries[l]||{callbacks:[]};if(p.result){const[x,v]=p.result;return this.scheduler?this.scheduler.add(()=>{h(x,v)},n):h(x,v),()=>{}}return p.callbacks.push(h),p.cancel||(p.cancel=o((x,v)=>{p.result=[x,v];for(const w of p.callbacks)this.scheduler?this.scheduler.add(()=>{w(x,v)},n):w(x,v);setTimeout(()=>delete this.entries[l],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(x=>x!==h),p.callbacks.length||(p.cancel(),delete this.entries[l]))}}},i.aL=function(l,n,o){const h=JSON.stringify(l.request);return l.data&&(this.deduped.entries[h]={result:[null,l.data]}),this.deduped.request(h,{type:"parseTile",isSymbolTile:l.isSymbolTile,zoom:l.tileZoom},p=>{const x=jf(l.request,(v,w,C)=>{v?p(v):w&&p(null,{vectorTile:o?void 0:new kr(new ES(w)),rawData:w,responseHeaders:new Map(C.entries())})});return()=>{x.cancel(),p()}},n)},i.aM=function(l){return l?{cacheControl:l.get("Cache-Control"),expires:l.get("Expires")}:{cacheControl:void 0,expires:void 0}},i.aN=function(l){nc++,nc>Hs&&(l.getActor().send("enforceCacheSizeLimit",Da),nc=0)},i.aO=function(l){return l<=1?1:Math.pow(2,Math.floor(Math.log2(l)))},i.aP=qa,i.aQ=C3,i.aR=P3,i.aS=X,i.aT=E3,i.aU=function(l,n){const o=document.createElement("video");o.muted=!0,o.onloadstart=function(){n(null,o)};for(let h=0;h<l.length;h++){const p=document.createElement("source");Ni(l[h])||(o.crossOrigin="Anonymous"),p.src=l[h],o.appendChild(p)}return{cancel:()=>{}}},i.aV=j1,i.aW=Ig,i.aX=ze,i.aY=F1,i.aZ=je,i.a_=we,i.aa=er,i.ab=class{constructor(l){this.specification=l}possiblyEvaluate(l,n){return Rn(l.expression.evaluate(n))}interpolate(l,n,o){return{x:fn(l.x,n.x,o),y:fn(l.y,n.y,o),z:fn(l.z,n.z,o),azimuthal:fn(l.azimuthal,n.azimuthal,o),polar:fn(l.polar,n.polar,o)}}},i.ac=us,i.ad=Fd,i.ae=st,i.af=nn,i.ag=gt,i.ah=ie,i.ai=Ph,i.aj=dp,i.ak=fn,i.al=ar,i.am=qm,i.an=lt,i.ao=Li,i.ap=class{constructor(l){this.specification=l}possiblyEvaluate(l,n){return function([o,h]){const p=Rn([1,o,h]);return{x:p.x,y:p.y,z:p.z}}(l.expression.evaluate(n))}interpolate(l,n,o){return{x:fn(l.x,n.x,o),y:fn(l.y,n.y,o),z:fn(l.z,n.z,o)}}},i.aq=function(l,n,o=0,h=!0){const p=new At(o,o),x=l.sub(p),v=n.add(p),w=[x,new At(v.x,x.y),v,new At(x.x,v.y)];return h&&w.push(x.clone()),w},i.ar=function(l,n){const o=[];for(let h=0;h<l.length;h++){const p=ce(h-1,-1,l.length-1),x=ce(h+1,-1,l.length-1),v=l[h],w=l[x],C=l[p].sub(v).unit(),A=w.sub(v).unit(),k=A.angleWithSep(C.x,C.y),P=C.add(A).unit().mult(-1*n/Math.sin(k/2));o.push(v.add(P))}return o},i.as=u3,i.at=Vs,i.au=function(l,n,o=0){return Xe(((n.x-o)*l.scale-l.x)*ar,(n.y*l.scale-l.y)*ar,Ve(n.z,n.y))},i.av=Nn,i.aw=zt,i.ax=Fn,i.ay=TF,i.az=function(l){let n=1/0,o=1/0,h=-1/0,p=-1/0;for(const x of l)n=Math.min(n,x.x),o=Math.min(o,x.y),h=Math.max(h,x.x),p=Math.max(p,x.y);return{min:new At(n,o),max:new At(h,p)}},i.b=function(l){return cs.API_FONTS_REGEX.test(l)},i.b$=kj,i.b0=bs,i.b1=Re,i.b2=q2,i.b3=FS,i.b4=function(){_l.isLoading()||_l.isLoaded()||Uy()!=="deferred"||Vy()},i.b5=y0,i.b6=xt,i.b7=jg,i.b8=Rs,i.b9=Kj,i.bA=ye,i.bB=H,i.bC=function(l,n){const{x:o,y:h}=l.point,p=$M(o,h,l.worldSize/l._pixelsPerMercatorPixel,0,0);return z(p,p,xj(qd(n)))},i.bD=I,i.bE=Dn,i.bF=Ue,i.bG=Se,i.bH=jr,i.bI=Gt,i.bJ=Z0,i.bK=zl,i.bL=sI,i.bM=function(l,n,o,h,p){const x=5*n+2;l.float32[x+0]=o,l.float32[x+1]=h,l.float32[x+2]=p},i.bN=J0,i.bO=An,i.bP=vi,i.bQ=Vi,i.bR=Hr,i.bS=ce,i.bT=function(l,n,o,h){var p=new E(4);return p[0]=l,p[1]=n,p[2]=o,p[3]=h,p},i.bU=class{isDataAvailableAtPoint(l){const n=this._source();if(this.isUsingMockSource()||!n||l.y<0||l.y>1)return!1;const o=n.getSource().maxzoom,h=1<<o,p=Math.floor(l.x),x=Math.floor((l.x-p)*h),v=Math.floor(l.y*h),w=this.findDEMTileFor(new qa(o,p,o,x,v));return!(!w||!w.dem)}getAtPointOrZero(l,n=0){return this.getAtPoint(l,n)||0}getAtPoint(l,n,o=!0){if(this.isUsingMockSource())return null;n==null&&(n=null);const h=this._source();if(!h||l.y<0||l.y>1)return n;const p=h.getSource().maxzoom,x=1<<p,v=Math.floor(l.x),w=l.x-v,C=new qa(p,v,p,Math.floor(w*x),Math.floor(l.y*x)),A=this.findDEMTileFor(C);if(!A||!A.dem)return n;const k=A.dem,P=1<<A.tileID.canonical.z,O=(w*P-A.tileID.canonical.x)*k.dim,G=(l.y*P-A.tileID.canonical.y)*k.dim,W=Math.floor(O),te=Math.floor(G);return(o?this.exaggeration():1)*fn(fn(k.get(W,te),k.get(W,te+1),G-te),fn(k.get(W+1,te),k.get(W+1,te+1),G-te),O-W)}static getAtTileOffset(l,n,o,h){const p=1<<l.canonical.z;return h?h.pointElevation(n):o?o.getAtPointOrZero(new st(l.wrap+(l.canonical.x+n.x/ar)/p,(l.canonical.y+n.y/ar)/p)):0}static getAtTileOffsetFunc(l,n,o,h){return(p,x,v)=>{const w=this.getAtTileOffset(l,p,x,v),C=h.upVector(l.canonical,p.x,p.y);return he(C,C,w*h.upVectorScale(l.canonical,n,o).metersToTile),C}}getForTilePoints(l,n,o,h){if(this.isUsingMockSource())return!1;const p=Q0.create(this,l,h);return!!p&&(n.forEach(x=>{x[2]=this.exaggeration()*p.getElevationAt(x[0],x[1],o)}),!0)}getMinMaxForTile(l){if(this.isUsingMockSource())return null;const n=this.findDEMTileFor(l);if(!n||!n.dem)return null;const o=n.dem.tree,h=n.tileID,p=1<<l.canonical.z-h.canonical.z;let x=l.canonical.x/p-h.canonical.x,v=l.canonical.y/p-h.canonical.y,w=0;for(let C=0;C<l.canonical.z-h.canonical.z&&!o.leaves[w];C++){x*=2,v*=2;const A=2*Math.floor(v)+Math.floor(x);w=o.childOffsets[w]+A,x%=1,v%=1}return{min:this.exaggeration()*o.minimums[w],max:this.exaggeration()*o.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(l,n,o){throw new Error("Pure virtual method called.")}pointCoordinate(l){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(l){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const l=this.visibleDemTiles;if(l.length===0)return null;let n=!1,o=Number.MAX_VALUE,h=Number.MIN_VALUE;for(const p of l){const x=this.getMinMaxForTile(p.tileID);x&&(o=Math.min(o,x.min),h=Math.max(h,x.max),n=!0)}return n?{min:o,max:h}:null}},i.bV=pS,i.bW=ra,i.bX=oo,i.bY=yO,i.bZ=D3,i.b_=TO,i.ba=jj,i.bb=Pt,i.bc=tl,i.bd=j0,i.be=FM,i.bf=Fs,i.bg=L0,i.bh=_I,i.bi=function(l,n){const o=dp(n.zoom);if(o===0)return qd(l);const h=nS(l),p=_j(h),x=fe(h.getWest())*n.worldSize,v=fe(h.getEast())*n.worldSize,w=de(h.getNorth())*n.worldSize,C=de(h.getSouth())*n.worldSize,A=[x,w,0],k=[v,w,0],P=[x,C,0],O=[v,C,0],G=Y([],n.globeMatrix);return nn(A,A,G),nn(k,k,G),nn(P,P,G),nn(O,O,G),p[0]=Lh(p[0],P,o),p[1]=Lh(p[1],O,o),p[2]=Lh(p[2],k,o),p[3]=Lh(p[3],A,o),qn.fromPoints(p)},i.bj=sS,i.bk=Y,i.bl=h1,i.bm=Lh,i.bn=Rh,i.bo=TH,i.bp=pe,i.bq=J,i.br=XS,i.bs=ES,i.bt=jf,i.bu=function(l,n){const o=[];for(const h in l)h in n||o.push(h);return o},i.bv=_e,i.bw=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.bx=$i,i.by=F,i.bz=U,i.c=ro,i.c$=function(l){return l*l*l*l*l},i.c0=nI,i.c1=i3,i.c2=uI,i.c3=kI,i.c4=he,i.c5=ft,i.c6=Kr,i.c7=function(l,n,o){o*=.5;var h=n[0],p=n[1],x=n[2],v=n[3],w=Math.sin(o),C=Math.cos(o);return l[0]=h*C+p*w,l[1]=p*C-h*w,l[2]=x*C+v*w,l[3]=v*C-x*w,l},i.c8=Zn,i.c9=is,i.cA=ki,i.cB=lF,i.cC=Ol,i.cD=BM,i.cE=function(l,n,o,h,p,x,v,w,C){if(C.name==="globe")return BM(l,n,new Ol(o,h,p),!1);const A=F1({z:o,x:h,y:p},C);return new qn([(x+A.x/A.scale)*n,n*(A.y/A.scale),v],[(x+A.x2/A.scale)*n,n*(A.y2/A.scale),w])},i.cF=function(l,n,o){return l[0]=Math.min(n[0],o[0]),l[1]=Math.min(n[1],o[1]),l[2]=Math.min(n[2],o[2]),l[3]=Math.min(n[3],o[3]),l},i.cG=function(l,n,o){return l[0]=Math.max(n[0],o[0]),l[1]=Math.max(n[1],o[1]),l[2]=Math.max(n[2],o[2]),l[3]=Math.max(n[3],o[3]),l},i.cH=function(l){const n=Math.round((l+45+360)%360/90)%4;return Jr[n]},i.cI=Ne,i.cJ=Wt,i.cK=a,i.cL=function(l){const n=U(new Float64Array(16));z(n,l.pixelMatrix,l.globeMatrix);const o=[0,b,0],h=[0,T,0];return nn(o,o,n),nn(h,h,n),[o[0]>0&&o[0]<=l.width&&o[1]>0&&o[1]<=l.height&&!yj(l,new X(l.center.lat,90)),h[0]>0&&h[0]<=l.width&&h[1]>0&&h[1]<=l.height&&!yj(l,new X(l.center.lat,-90))]},i.cM=function(l,n){const{scale:o}=l.tileTransform,h=o*ar/(l.tileSize*Math.pow(2,n.zoom-l.tileID.overscaledZ+l.tileID.canonical.z));return function(p,x,v){var w=x[1],C=x[2],A=x[3],k=v[0],P=v[1];return p[0]=x[0]*k,p[1]=w*k,p[2]=C*P,p[3]=A*P,p}(new Float32Array(4),n.inverseAdjustmentMatrix,[h,h])},i.cN=vS,i.cO=Ee,i.cP=oF,i.cQ=function(l){const n=oF(l,!0);return I([],[n[0],n[1],n[4],n[5]])},i.cR=ne,i.cS=Wi,i.cT=me,i.cU=function(l){const{x:n,y:o}=l.point,{lng:h,lat:p}=l._center;return $M(n,o,l.worldSize,h,p)},i.cV=Kt,i.cW=Er,i.cX=Fl,i.cY=na,i.cZ=g,i.c_=function(l,n,o){let h=0;for(let p=0;p<2;++p)l[p]>0&&(h+=(l[p]-0)*(l[p]-0)),n[p]<0&&(h+=(0-n[p])*(0-n[p]));return h},i.ca=function(l,n){return l[0]=-n[0],l[1]=-n[1],l[2]=-n[2],l[3]=n[3],l},i.cb=Oe,i.cc=function(l,n,o,h,p){var x=1/Math.tan(n/2);if(l[0]=x/o,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=x,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,p!=null&&p!==1/0){var v=1/(h-p);l[10]=(p+h)*v,l[14]=2*p*h*v}else l[10]=-1,l[14]=-2*h;return l},i.cd=function(l,n,o,h,p,x,v){var w=1/(n-o),C=1/(h-p),A=1/(x-v);return l[0]=-2*w,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*C,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*A,l[11]=0,l[12]=(n+o)*w,l[13]=(p+h)*C,l[14]=(v+x)*A,l[15]=1,l},i.ce=xe,i.cf=function(l,n,o){l[4*n+0]=o[0],l[4*n+1]=o[1],l[4*n+2]=o[2],l[4*n+3]=o[3]},i.cg=R0,i.ch=op,i.ci=fa,i.cj=du,i.ck=vg,i.cl=m3,i.cm=function(){var l=new E(4);return E!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l},i.cn=function(l,n,o){var h=n[0],p=n[1],x=n[2],v=n[3],w=Math.sin(o),C=Math.cos(o);return l[0]=h*C+x*w,l[1]=p*C+v*w,l[2]=h*-w+x*C,l[3]=p*-w+v*C,l},i.co=function(l,n){return l[0]===n[0]&&l[1]===n[1]&&l[2]===n[2]&&l[3]===n[3]},i.cp=Zr,i.cq=function(l){var n=l[0],o=l[1],h=l[2],p=l[3];return Math.sqrt(n*n+o*o+h*h+p*p)},i.cr=fs,i.cs=ei,i.ct=hu,i.cu=3,i.cv=2,i.cw=7,i.cx=6,i.cy=Wr,i.cz=qe,i.d=function(l){return cs.API_TILEJSON_REGEX.test(l)},i.d$=WM,i.d0=ae,i.d1=45,i.d2=xg,i.d3=function(l,n,o){const h=Math.sqrt(l*l+n*n+o*o),p=h>0?Math.acos(o/h)*pt:0;let x=l!==0||n!==0?Math.atan2(-n,-l)*pt+90:0;return x<0&&(x+=360),[h,x,p]},i.d4=Xe,i.d5=Rn,i.d6=We,i.d7=Me,i.d8=qn,i.d9=mt,i.dA=l1,i.dB=class extends dc{constructor(l){super(l),this.current=dj}set(l,n,o){if(this.fetchUniformLocation(l,n)){for(let h=0;h<9;h++)if(o[h]!==this.current[h]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}}},i.dC=Ae,i.dD=function(l,n,o){const h=dp(o.zoom),p=l.style.map._antialias,x=l.terrain&&l.terrain.exaggeration()>0;return h===0&&!p&&!x},i.dE=function(l){const n=l.pixelsPerMeter,o=n/xe(1,l.center.lat),h=U(new Float64Array(16));return J(h,h,[l.point.x,l.point.y,0]),ne(h,h,[o,o,n]),Float32Array.from(h)},i.dF=nS,i.dG=function(l){const n=Ne-5;l=K(l,-n,n)/n*90;const o=Math.pow(Math.abs(Math.sin(lt(l))),3);return Math.round(o*(y.length-1))},i.dH=function(l,n,o,h){const p=n.getNorth(),x=n.getSouth(),v=n.getWest(),w=n.getEast(),C=1<<l.z,A=w-v,k=p-x,P=A/_,O=-k/y[o],G=[0,P,0,O,0,0,p,v,0];if(l.z>0){const W=180/h;R(G,G,[W/A+1,0,0,0,W/k+1,0,-.5*W/P,.5*W/O,1])}return G[2]=C,G[5]=l.x,G[8]=l.y,G},i.dI=qd,i.dJ=function(l,n,o){const h=U(new Float64Array(16)),p=(n/(1<<l)-.5)*Math.PI*2;return le(h,o.globeMatrix,p),Float32Array.from(h)},i.dK=rO,i.dL=rS,i.dM=function(l,n){return[Math.pow(l[0],2.2)*n,Math.pow(l[1],2.2)*n,Math.pow(l[2],2.2)*n]},i.dN=D,i.dO=function(l,n){var o=Math.sin(n),h=Math.cos(n);return l[0]=h,l[1]=o,l[2]=0,l[3]=-o,l[4]=h,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},i.dP=xn,i.dQ=VM,i.dR=ls,i.dS=Ts,i.dT=256,i.dU=function(l,n){const o=[0,0,0];return nn(o,o,sS(qd(n.canonical))),nn(o,o,l),o},i.dV=l=>({u_matrix:new vg(l),u_texsize:new du(l),u_pixels_to_tile_units:new c1(l),u_device_pixel_ratio:new fa(l),u_width_scale:new fa(l),u_floor_width_scale:new fa(l),u_image:new R0(l),u_units_to_pixels:new du(l),u_tile_units_to_pixels:new fa(l),u_alpha_discard_threshold:new fa(l),u_trim_offset:new du(l),u_trim_fade_range:new du(l),u_trim_color:new xg(l),u_emissive_strength:new fa(l),u_zbias_factor:new fa(l),u_tile_to_meter:new fa(l),u_ground_shadow_factor:new op(l),u_pattern_transition:new fa(l)}),i.dW=l=>({u_matrix:new vg(l),u_pixels_to_tile_units:new c1(l),u_device_pixel_ratio:new fa(l),u_width_scale:new fa(l),u_floor_width_scale:new fa(l),u_units_to_pixels:new du(l),u_dash_image:new R0(l),u_gradient_image:new R0(l),u_image_height:new fa(l),u_texsize:new du(l),u_tile_units_to_pixels:new fa(l),u_alpha_discard_threshold:new fa(l),u_trim_offset:new du(l),u_trim_fade_range:new du(l),u_trim_color:new xg(l),u_emissive_strength:new fa(l),u_zbias_factor:new fa(l),u_tile_to_meter:new fa(l),u_ground_shadow_factor:new op(l)}),i.dX=l=>({u_camera_to_center_distance:new fa(l),u_extrude_scale:new c1(l),u_device_pixel_ratio:new fa(l),u_matrix:new vg(l),u_inv_rot_matrix:new vg(l),u_merc_center:new du(l),u_tile_id:new op(l),u_zoom_transition:new fa(l),u_up_dir:new op(l),u_emissive_strength:new fa(l)}),i.dY=np,i.dZ=dX,i.d_=class{constructor(l,n,o,h){this.context=l,this.format=h,this.size=o,this.texture=l.gl.createTexture();const[p,x,v]=this.size,{gl:w}=l;w.bindTexture(w.TEXTURE_3D,this.texture),l.pixelStoreUnpackFlipY.set(!1),l.pixelStoreUnpack.set(1),l.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in n&&n.data&&w.texImage3D(w.TEXTURE_3D,0,this.format,p,x,v,0,Uj(this.format),Vj(this.format),n.data)}bind(l,n){const{context:o}=this,{gl:h}=o;h.bindTexture(h.TEXTURE_3D,this.texture),l!==this.minFilter&&(h.texParameteri(h.TEXTURE_3D,h.TEXTURE_MAG_FILTER,l),h.texParameteri(h.TEXTURE_3D,h.TEXTURE_MIN_FILTER,l),this.minFilter=l),n!==this.wrapS&&(h.texParameteri(h.TEXTURE_3D,h.TEXTURE_WRAP_S,n),h.texParameteri(h.TEXTURE_3D,h.TEXTURE_WRAP_T,n),this.wrapS=n)}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}},i.da=function(l){return[Math.pow(l[0],1/2.2),Math.pow(l[1],1/2.2),Math.pow(l[2],1/2.2)]},i.db=aF,i.dc=Xj,i.dd=dF,i.de=vI,i.df=function(l,n){return l.readFields(lY,{icons:[]},n)},i.dg=mS,i.dh=X0,i.di=oI,i.dj=Jv,i.dk=M2,i.dl=Ms,i.dm=Um,i.dn=Ut,i.dp=function(l){const n=l.indexOf(hg);return n>=0?l.slice(0,n):l},i.dq=function(l){return l.indexOf(hg)>=0},i.dr=function(l){const n=l.lastIndexOf(hg);return n>=0?l.slice(n+1):""},i.ds=function(l){const n=[],o=l.id;return o===void 0&&n.push({message:`layers.${o}: missing required property "id"`}),l.render===void 0&&n.push({message:`layers.${o}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&n.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),n},i.dt=function(l,n,o,h){return l.type==="custom"?new tY(l,n):new aY[l.type](l,n,o,h)},i.du=ut,i.dv=function(l){const n=l.indexOf(hg);return n>=0?l.slice(n+1):""},i.dw=class extends jg{constructor(l,n){super(l._vectorTileFeature,l._z,l._x,l._y,l.id),l.state&&(this.state=Object.assign({},l.state)),this.target=n.target,this.namespace=n.namespace,n.properties&&(this.properties=n.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=l.source,this.sourceLayer=l.sourceLayer,this.layer=l.layer)}toJSON(){const l=super.toJSON();return l.target=this.target,l.namespace=this.namespace,l}},i.dx=By,i.dy=Mm,i.dz=function(l){return l({pluginStatus:Uo,pluginURL:Bd}),By.on("pluginStateChange",l),l},i.e=cs,i.e$=function([l,n,o]){const h=Math.hypot(l,n,o),p=Math.atan2(l,o),x=.5*Math.PI-Math.acos(-n/h);return new X(Er(p),Er(x))},i.e0=(l,n,o,h,p,x)=>{const v=l.transform,w=v.projection.name==="globe";let C;if(x.paint.get("circle-pitch-alignment")==="map")if(w){const k=VM(v.zoom,n.canonical)*v._pixelsPerMercatorPixel;C=Float32Array.from([k,0,0,k])}else C=v.calculatePixelsToTileUnitsMatrix(o);else C=new Float32Array([v.pixelsToGLUnits[0],0,0,v.pixelsToGLUnits[1]]);const A={u_camera_to_center_distance:l.transform.getCameraToCenterDistance(v.projection),u_matrix:l.translatePosMatrix(n.projMatrix,o,x.paint.get("circle-translate"),x.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Ti.devicePixelRatio,u_extrude_scale:C,u_inv_rot_matrix:IH,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:x.paint.get("circle-emissive-strength")};if(w){A.u_inv_rot_matrix=h,A.u_merc_center=p,A.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],A.u_zoom_transition=dp(v.zoom);const k=p[0]*ar,P=p[1]*ar;A.u_up_dir=v.projection.upVector(new Ol(0,0,0),k,P)}return A},i.e1=jF,i.e2=el,i.e3=(l,n,o,h,p,x,v,w,C,A)=>{const k=l.transform,P=k.pitch<15?EF(.07,.7,K((14-k.zoom)/5,0,1)):.07,O=o.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:AF(l,n,o,h),u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:k.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:p,u_width_scale:x,u_floor_width_scale:v,u_image:0,u_tile_units_to_pixels:CF(n,k),u_units_to_pixels:[1/k.pixelsToGLUnits[0],1/k.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:w,u_trim_fade_range:o.paint.get("line-trim-fade-range"),u_trim_color:o.paint.get("line-trim-color").toPremultipliedRenderColor(O?null:o.lut).toArray01(),u_emissive_strength:o.paint.get("line-emissive-strength"),u_zbias_factor:P,u_tile_to_meter:We(n.tileID.canonical,0),u_ground_shadow_factor:C,u_pattern_transition:A}},i.e4=(l,n,o,h,p,x,v,w,C,A)=>{const k=l.transform,P=k.calculatePixelsToTileUnitsMatrix(n),O=o.paint.get("line-trim-color-use-theme").constantOr("default")==="none",G=k.pitch<15?EF(.07,.7,K((14-k.zoom)/5,0,1)):.07;return{u_matrix:AF(l,n,o,h),u_pixels_to_tile_units:P,u_device_pixel_ratio:x,u_width_scale:v,u_floor_width_scale:w,u_units_to_pixels:[1/k.pixelsToGLUnits[0],1/k.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:p,u_texsize:IF(o)&&n.lineAtlasTexture?n.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:CF(n,l.transform),u_alpha_discard_threshold:0,u_trim_offset:C,u_trim_fade_range:o.paint.get("line-trim-fade-range"),u_trim_color:o.paint.get("line-trim-color").toPremultipliedRenderColor(O?null:o.lut).toArray01(),u_emissive_strength:o.paint.get("line-emissive-strength"),u_zbias_factor:G,u_tile_to_meter:We(n.tileID.canonical,0),u_ground_shadow_factor:A}},i.e5=Ce,i.e6=f1,i.e7=Ve,i.e8=Fh,i.e9=fS,i.eA=bI,i.eB=bS,i.eC=wS,i.eD=[1,1,1],i.eE=Q0,i.eF=Rt,i.eG=function(l,n,o,h){var p=n[0],x=n[1],v=n[2],w=n[3];return l[0]=p+h*(o[0]-p),l[1]=x+h*(o[1]-x),l[2]=v+h*(o[2]-v),l[3]=w+h*(o[3]-w),l},i.eH=q0,i.eI=uc,i.eJ=$d,i.eK=function(l,n,o,h,p,x,v,w,C,A,k,P,O,G,W,te){var se=new E(16);return se[0]=l,se[1]=n,se[2]=o,se[3]=h,se[4]=p,se[5]=x,se[6]=v,se[7]=w,se[8]=C,se[9]=A,se[10]=k,se[11]=P,se[12]=O,se[13]=G,se[14]=W,se[15]=te,se},i.eL=L,i.eM=t1,i.eN=pg,i.eO=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new At(1/0,1/0),max:new At(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(l,n=!1){const o=bO(new At(0,0),new At(ar,ar),l),h=[];if(n&&!Ij(o,this._globalClipBounds))return h;for(const p of this._activeRegions){if(p.hiddenByOverlap||!Ij(o,p))continue;const x=iZ(p.min,p.max,l);h.push({min:x.min,max:x.max,sourceId:this._sourceIds[p.priority],footprint:p.footprint,footprintTileId:p.tileId,order:p.order,clipMask:p.clipMask,clipScope:p.clipScope})}return h}setSources(l){this._setSources(l.map(n=>({getSourceId:()=>n.cache.id,getFootprints:()=>{const o=[];for(const h of n.cache.getVisibleCoordinates()){const p=n.cache.getTile(h).buckets[n.layer];p&&p.updateFootprints(h.toUnwrapped(),o)}return o},getOrder:()=>n.order,getClipMask:()=>n.clipMask,getClipScope:()=>n.clipScope})))}_addSource(l){const n=l.getFootprints();if(n.length===0)return;const o=l.getOrder(),h=l.getClipMask(),p=l.getClipScope();for(const x of n){if(!x.footprint)continue;const v=bO(x.footprint.min,x.footprint.max,x.id);this._activeRegions.push({min:v.min,max:v.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:x.id,footprint:x.footprint,order:o,clipMask:h,clipScope:p})}this._sourceIds.push(l.getSourceId())}_computeReplacement(){this._activeRegions.sort((n,o)=>n.priority-o.priority||uS(n.min,o.min)||uS(n.max,o.max)||n.order-o.order||n.clipMask-o.clipMask||function(h,p){const x=(v,w)=>v+w;return h.length-p.length||h.reduce(x,"").localeCompare(p.reduce(x,""))}(n.clipScope,o.clipScope));let l=this._activeRegions.length!==this._prevRegions.length;if(!l){let n=0;for(;!l&&n!==this._activeRegions.length;){const o=this._activeRegions[n],h=this._prevRegions[n];l=o.priority!==h.priority||!wO(o,h)||o.order!==h.order||o.clipMask!==h.clipMask||!$i(o.clipScope,h.clipScope),this._activeRegions[n].hiddenByOverlap=h.hiddenByOverlap,++n}}if(l){++this._updateTime;for(const o of this._activeRegions)o.order!==v1&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,o.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,o.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,o.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,o.max.y));const n=o=>{const h=this._activeRegions;if(o>=h.length)return o;const p=h[o].priority;for(;o<h.length&&h[o].priority===p;)++o;return o};if(this._sourceIds.length>1){let o=0,h=n(o);for(;o!==h;){let p=o;const x=o;for(;p!==h;){const v=this._activeRegions[p];v.hiddenByOverlap=!1;for(let w=0;w<x;w++){const C=this._activeRegions[w];if(!C.hiddenByOverlap&&v.order===v1&&Ij(v,C)&&(v.hiddenByOverlap=SO(v.footprint,v.tileId,C.footprint,C.tileId),v.hiddenByOverlap))break}++p}o=h,h=n(o)}}}}_setSources(l){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let n=l.length-1;n>=0;n--)this._addSource(l[n]);this._computeReplacement()}},i.eP=v1,i.eQ=class{constructor(l){this._createGrid(l),this._createPoles(l)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const l of this._poleSegments)l.destroy();for(const l of this._gridSegments)l.withSkirts.destroy(),l.withoutSkirts.destroy()}_fillGridMeshWithLods(l,n){const o=new tl,h=new bs,p=[],x=l+1+2,v=n[0]+1,w=n[0]+1+(1+n.length),C=(A,k,P)=>{let O=A===x-1?A-2:A===0?A:A-1;return O+=P?24575:0,[O,k]};for(let A=0;A<x;++A)o.emplaceBack(...C(A,0,!0));for(let A=0;A<v;++A)for(let k=0;k<x;++k)o.emplaceBack(...C(k,A,(k===0||k===x-1)&&!0));for(let A=0;A<n.length;++A){const k=n[A];for(let P=0;P<x;++P)o.emplaceBack(...C(P,k,!0))}for(let A=0;A<n.length;++A){const k=h.length,P=n[A]+1+2,O=new bs;for(let te=0;te<P-1;te++){const se=te===P-2,oe=se?x*(w-n.length+A-te):x;for(let ge=0;ge<x-1;ge++){const ve=te*x+ge;te===0||se||ge===0||ge===x-2?(O.emplaceBack(ve+1,ve,ve+oe),O.emplaceBack(ve+oe,ve+oe+1,ve+1)):(h.emplaceBack(ve+1,ve,ve+oe),h.emplaceBack(ve+oe,ve+oe+1,ve+1))}}const G=Fs.simpleSegment(0,k,o.length,h.length-k);for(let te=0;te<O.uint16.length;te+=3)h.emplaceBack(O.uint16[te],O.uint16[te+1],O.uint16[te+2]);const W=Fs.simpleSegment(0,k,o.length,h.length-k);p.push({withoutSkirts:G,withSkirts:W})}return{vertices:o,indices:h,segments:p}}_createGrid(l){const n=this._fillGridMeshWithLods(_,y);this._gridSegments=n.segments,this._gridBuffer=l.createVertexBuffer(n.vertices,FM.members),this._gridIndexBuffer=l.createIndexBuffer(n.indices,!0)}_createPoles(l){const n=new bs;for(let v=0;v<=_;v++)n.emplaceBack(0,v+1,v+2);this._poleIndexBuffer=l.createIndexBuffer(n,!0);const o=new Oh,h=new Oh,p=new Oh,x=new Oh;this._poleSegments=[];for(let v=0,w=0;v<g;v++){const C=360/(1<<v);o.emplaceBack(0,-rl,0,.5,0),h.emplaceBack(0,-rl,0,.5,1),p.emplaceBack(0,-rl,0,.5,.5),x.emplaceBack(0,-rl,0,.5,.5);for(let A=0;A<=_;A++){let k=A/_,P=0;const O=fn(0,C,k),[G,W,te]=j(AH,jH,O,rl);o.emplaceBack(G,W,te,k,P),h.emplaceBack(G,W,te,k,1-P);const se=lt(O);k=.5+.5*Math.sin(se),P=.5+.5*Math.cos(se),p.emplaceBack(G,W,te,k,P),x.emplaceBack(G,W,te,k,1-P)}this._poleSegments.push(Fs.simpleSegment(w,0,66,64)),w+=66}this._poleNorthVertexBuffer=l.createVertexBuffer(o,F0,!1),this._poleSouthVertexBuffer=l.createVertexBuffer(h,F0,!1),this._texturedPoleNorthVertexBuffer=l.createVertexBuffer(p,F0,!1),this._texturedPoleSouthVertexBuffer=l.createVertexBuffer(x,F0,!1)}getGridBuffers(l,n){return[this._gridBuffer,this._gridIndexBuffer,n?this._gridSegments[l].withSkirts:this._gridSegments[l].withoutSkirts]}getPoleBuffers(l,n){return[n?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,n?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[l]]}},i.eR=vO,i.eS=ue,i.eT=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},i.eU=Z,i.eV=De,i.eW=function(l,n,o){return l[0]=n[0]/o[0],l[1]=n[1]/o[1],l[2]=n[2]/o[2],l},i.eX=Pi,i.eY=N,i.eZ=dt,i.e_=ct,i.ea=LO,i.eb=fp,i.ec=jO,i.ed=AO,i.ee=Be,i.ef=function(l,n){if(l===n){var o=n[1],h=n[2],p=n[3],x=n[6],v=n[7],w=n[11];l[1]=n[4],l[2]=n[8],l[3]=n[12],l[4]=o,l[6]=n[9],l[7]=n[13],l[8]=h,l[9]=x,l[11]=n[14],l[12]=p,l[13]=v,l[14]=w}else l[0]=n[0],l[1]=n[4],l[2]=n[8],l[3]=n[12],l[4]=n[1],l[5]=n[5],l[6]=n[9],l[7]=n[13],l[8]=n[2],l[9]=n[6],l[10]=n[10],l[11]=n[14],l[12]=n[3],l[13]=n[7],l[14]=n[11],l[15]=n[15];return l},i.eg=eY,i.eh=Kn,i.ei=n1,i.ej=256,i.ek=xj,i.el=Pl,i.em=le,i.en=function(l,n){return l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[4],l[4]=n[5],l[5]=n[6],l[6]=n[8],l[7]=n[9],l[8]=n[10],l},i.eo=Oh,i.ep=e1,i.eq=j2,i.er=function(l,n,o,h,p){return K((l-n)/(o-n)*(p-h)+h,h,p)},i.es=Yn,i.et=function(l,n){var o=n[0],h=n[1],p=n[2],x=n[3],v=n[4],w=n[5],C=n[6],A=n[7],k=n[8],P=k*v-w*A,O=-k*x+w*C,G=A*x-v*C,W=o*P+h*O+p*G;return W?(l[0]=P*(W=1/W),l[1]=(-k*h+p*A)*W,l[2]=(w*h-p*v)*W,l[3]=O*W,l[4]=(k*o-p*C)*W,l[5]=(-w*o+p*x)*W,l[6]=G*W,l[7]=(-A*o+h*C)*W,l[8]=(v*o-h*x)*W,l):null},i.eu=2,i.ev=Vt,i.ew=Nr,i.ex=ke,i.ey=function(l,n){var o=new E(3);ke(o,n);var h=1/o[0],p=1/o[1],x=1/o[2],v=n[0]*h,w=n[1]*p,C=n[2]*x,A=n[4]*h,k=n[5]*p,P=n[6]*x,O=n[8]*h,G=n[9]*p,W=n[10]*x,te=v+k+W,se=0;return te>0?(se=2*Math.sqrt(te+1),l[3]=.25*se,l[0]=(P-G)/se,l[1]=(O-C)/se,l[2]=(w-A)/se):v>k&&v>W?(se=2*Math.sqrt(1+v-k-W),l[3]=(P-G)/se,l[0]=.25*se,l[1]=(w+A)/se,l[2]=(O+C)/se):k>W?(se=2*Math.sqrt(1+k-v-W),l[3]=(O-C)/se,l[0]=(w+A)/se,l[1]=.25*se,l[2]=(P+G)/se):(se=2*Math.sqrt(1+W-v-k),l[3]=(w-A)/se,l[0]=(O+C)/se,l[1]=(P+G)/se,l[2]=.25*se),l},i.ez=function(l,n){var o=2*Math.acos(n[3]),h=Math.sin(o/2);return h>S?(l[0]=n[0]/h,l[1]=n[1]/h,l[2]=n[2]/h):(l[0]=1,l[1]=0,l[2]=0),o},i.f=function(l){return btoa(encodeURIComponent(l).replace(/%([0-9A-F]{2})/g,(n,o)=>String.fromCharCode(+("0x"+o))))},i.f0=Pr,i.f1=qj,i.f2=function(l){const n=l.navigator?l.navigator.userAgent:null;return!!function(o){if(gs==null){const h=o.navigator?o.navigator.userAgent:null;gs=!!o.safari||!(!h||!(/\b(iPad|iPhone|iPod)\b/.test(h)||h.match("Safari")&&!h.match("Chrome")))}return gs}(l)&&!(!n||!(n.match("Version/15.4")||n.match("Version/15.5")||n.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},i.f3=function(l,n){Da=l,Hs=n},i.f4=yj,i.f5=qM,i.f6=function(l){const n=[0,0,0],o=U(new Float64Array(16));return z(o,l.pixelMatrix,l.globeMatrix),nn(n,n,o),new At(n[0],n[1])},i.f7=function(){const l=E1;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(Oj),E1=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.f8=function(){mS().acquire(Oj)},i.f9=Uy,i.fA=qt,i.fB=function(l){let n=0;if(new Uint32Array(l,0,1)[0]!==tF){const o=new Uint32Array(l,0,7),[,,h,p,x,v]=o;n=o.byteLength+p+x+v+x,(h!==l.byteLength||n>=l.byteLength)&&ur("Invalid b3dm header information.")}return sF(l,n)},i.fC=function(l,n){const o=Xj(l);for(const h of o){for(const p of h.meshes)MZ(p);h.lights&&(h.lightMeshIndex=h.meshes.length,h.meshes.push(OZ(h.lights,n)))}return o},i.fD=VS,i.fE=Zi,i.fF=YO,i.fG=_l,i.fH=gl,i.fI=function(l){Jo(),Ea!=null&&Ea.then(n=>{n.keys().then(o=>{for(let h=0;h<o.length-l;h++)n.delete(o[h]).catch(p=>ur(p.message))}).catch(o=>ur(o.message))}).catch(n=>ur(n.message))},i.fa=function(l,n,o=!1){if(Uo===gl.deferred||Uo===gl.loading||Uo===gl.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Bd=Ti.resolveURL(l),Uo=gl.deferred,Ly=n,zy(),o||Vy()},i.fb=function(l){U0=Ti.resolveURL(l),V0||(V0=new B0(mS(),new Ou)),V0.broadcast("setMeshoptUrl",U0)},i.fc=QO,i.fd=function(l){Lj=Ti.resolveURL(l),V0||(V0=new B0(mS(),new Ou)),V0.broadcast("setDracoUrl",Lj)},i.fe=JO,i.ff=T1,i.fg=function(l){const n=Va();if(!n)return;const o=n.delete(ba);l&&o.then(()=>l()).catch(l)},i.fh=Sg,i.fi=Tr,i.fj=hp,i.fk=Yu,i.fl=yL,i.fm=wL,i.fn=wF,i.fo=gr,i.fp="hd_road_elevation",i.fq=Tn,i.fr=et,i.fs=zh,i.ft=aI,i.fu=Cg,i.fv=function(l,n,o,h,p,x,v,w=1,C,A,k){l.createArrays(),l.tilePixelRatio=ar/(512*l.overscaling),l.compareText={},l.iconsNeedLinear=!1;const P=l.layers[0].layout,O=l.layers[0]._unevaluatedLayout._values,G={};G.scaleFactor=w,G.textSizeScaleRange=P.get("text-size-scale-range"),G.iconSizeScaleRange=P.get("icon-size-scale-range");const[W,te]=G.textSizeScaleRange,[se,oe]=G.iconSizeScaleRange;G.textScaleFactor=K(G.scaleFactor,W,te),G.iconScaleFactor=K(G.scaleFactor,se,oe);const ge=O["text-size"],ve=O["icon-size"];if(l.textSizeData.kind==="composite"){const{minZoom:Je,maxZoom:Tt}=l.textSizeData;G.compositeTextSizes=[ge.possiblyEvaluate(new us(Je,{worldview:k}),x),ge.possiblyEvaluate(new us(Tt,{worldview:k}),x)]}if(l.iconSizeData.kind==="composite"){const{minZoom:Je,maxZoom:Tt}=l.iconSizeData;G.compositeIconSizes=[ve.possiblyEvaluate(new us(Je,{worldview:k}),x),ve.possiblyEvaluate(new us(Tt,{worldview:k}),x)]}G.layoutTextSize=ge.possiblyEvaluate(new us(v+1,{worldview:k}),x),G.layoutIconSize=ve.possiblyEvaluate(new us(v+1,{worldview:k}),x),G.textMaxSize=ge.possiblyEvaluate(new us(18,{worldview:k}),x);const Te=P.get("symbol-placement"),$e=P.get("text-rotation-alignment")==="map"&&Te!=="point",Fe=P.get("text-size");let Ze=!1;const Ye=[];for(const Je of l.features){const Tt=P.get("text-font").evaluate(Je,{},x).join(","),ot=Fe.evaluate(Je,{},x)*G.textScaleFactor,Ct=G.layoutTextSize.evaluate(Je,{},x)*G.textScaleFactor,Mt=G.layoutIconSize.evaluate(Je,{},x)*G.iconScaleFactor,Bt={horizontal:{},vertical:void 0},ir=Je.text;let Jt,Ft=[0,0];if(ir){const Gn=ir.toString(),mi=P.get("text-letter-spacing").evaluate(Je,{},x)*oo,Pn=P.get("text-line-height").evaluate(Je,{},x)*oo,Ei=D2(Gn)?mi:0,Ci=P.get("text-anchor").evaluate(Je,{},x),As=P.get("text-variable-anchor");if(!As){const It=P.get("text-radial-offset").evaluate(Je,{},x);if(It)Ft=i3(Ci,[It*oo,cI]);else{const fr=P.get("text-offset").evaluate(Je,{},x);Ft=[fr[0]*oo,fr[1]*oo]}}let Le=$e?"center":P.get("text-justify").evaluate(Je,{},x);const Pe=Te==="point",jt=Pe?P.get("text-max-width").evaluate(Je,{},x)*oo:1/0,cr=It=>{l.allowVerticalPlacement&&My(Gn)&&(Bt.vertical=rI(ir,n,o,p,Tt,jt,Pn,Ci,It,Ei,Ft,zl.vertical,!0,Ct,ot,C))};if(!$e&&As){const It=Le==="auto"?As.map(Br=>uI(Br)):[Le];let fr=!1;for(let Br=0;Br<It.length;Br++){const Mr=It[Br];if(!Bt.horizontal[Mr])if(fr)Bt.horizontal[Mr]=Bt.horizontal[0];else{const Mn=rI(ir,n,o,p,Tt,jt,Pn,"center",Mr,Ei,Ft,zl.horizontal,!1,Ct,ot,C);Mn&&(Bt.horizontal[Mr]=Mn,fr=Mn.positionedLines.length===1)}}cr("left")}else{if(Le==="auto"&&(Le=uI(Ci)),Pe||P.get("text-writing-mode").indexOf("horizontal")>=0||!My(Gn)){const It=rI(ir,n,o,p,Tt,jt,Pn,Ci,Le,Ei,Ft,zl.horizontal,!1,Ct,ot,C);It&&(Bt.horizontal[Le]=It)}cr(Pe?"left":Le)}}let Yt,wt,vt,Ht,rr,Lt,br=!1;const Ir=P.get("icon-text-fit").evaluate(Je,{},x);if(Je.icon&&Je.icon.hasPrimary()){const Gn=M1(Je.icon,l.iconSizeData,O["icon-size"],x,l.zoom,Je,C,G.iconScaleFactor,k);Yt=Gn.iconPrimary,vt=Gn.iconSecondary;const mi=Yt.toString();if(wt=h.get(mi),wt&&(rr=P.get("icon-offset").evaluate(Je,{},x),Lt=P.get("icon-anchor").evaluate(Je,{},x),Jt=AS(p.get(mi),vt?p.get(vt.toString()):void 0,rr,Lt),br=wt.sdf,l.sdfIcons===void 0?l.sdfIcons=wt.sdf:l.sdfIcons!==wt.sdf&&ur("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(wt.pixelRatio!==l.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(l.iconsNeedLinear=!0)),vt){const Pn=vt.toString();Ht=h.get(Pn)}}Ze=Ze||!(!Je.icon||!Je.icon.hasSecondary());const _r=dI(Bt.horizontal)||Bt.vertical;l.iconsInText||(l.iconsInText=!!_r&&_r.iconsInText);const dr=Ct*G.textScaleFactor/oo,{defaultShapedIcon:En,verticallyShapedIcon:pr}=BX(l,Jt,P,Je,x,Bt,dr,rr,Ir);Ir!=="none"&&Jt&&($F(Jt)||qF(Jt))&&(PS(0,wt,Yt,Jt,En,Ir,A,h,p),PS(0,Ht,vt,Jt,En,Ir,A,h,p),pr&&(PS(0,wt,Yt,Jt,pr,Ir,A,h,p),PS(0,Ht,vt,Jt,pr,Ir,A,h,p))),Jt=En;const{iconBBox:Qr,iconVerticalBBox:jn}=FX(l,Jt,pr,P,Je,x,Mt,rr,G,p,Lt);Ye.push({feature:Je,shapedTextOrientations:Bt,shapedText:_r,shapedIcon:Jt,iconPrimary:Yt,iconSecondary:vt,iconOffset:rr,iconAnchor:Lt,verticallyShapedIcon:pr,layoutTextSize:Ct,layoutIconSize:Mt,textOffset:Ft,isSDFIcon:br,iconTextFit:Ir,iconCollisionBounds:Qr,iconVerticalCollisionBounds:jn})}return{featureData:Ye,sizes:G,hasAnySecondaryIcon:Ze,textAlongLine:$e,symbolPlacement:Te}},i.fw=JF,i.fx=function(l,n,o,h,p,x,v,w,C,A){l.iconAtlasPositions=A.iconPositions;const{featureData:k,hasAnySecondaryIcon:P,sizes:O,textAlongLine:G,symbolPlacement:W}=n;for(const te of k){const{shapedIcon:se,verticallyShapedIcon:oe,feature:ge,shapedTextOrientations:ve,shapedText:Te,layoutTextSize:$e,textOffset:Fe,isSDFIcon:Ze,iconPrimary:Ye,iconSecondary:Je,iconTextFit:Tt,iconOffset:ot,iconCollisionBounds:Ct,iconVerticalCollisionBounds:Mt}=te;a3(se,A.iconPositions,Ye,Je),a3(oe,A.iconPositions,Ye,Je),zX(ve,A.iconPositions),LX(Ye,Je,A.iconPositions),(Te||se)&&UX(l,ge,ve,se,oe,C,O,$e,0,Fe,Ze,h,p,v,w,P,Tt,ot,G,W,Ct,Mt)}o&&l.generateCollisionDebugBuffers(x,l.collisionBoxArray,O.textScaleFactor)},i.fy=kr,i.fz=ZS,i.g=function(l,n){return Mm(Object.assign(l,{method:"GET"}),n)},i.h=function(l){return l.indexOf("mapbox:")===0},i.i=function(l){return cs.API_STYLE_REGEX.test(l)&&!ro(l)},i.j=wa,i.k=Es,i.l=function(l){return decodeURIComponent(atob(l).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join(""))},i.m=function(l,n){return Mm(Object.assign(l,{type:"json"}),n)},i.n=ey,i.o=Ti,i.p=function(l,n){return Mm(Object.assign(l,{method:"POST"}),n)},i.q=bo,i.r=oi,i.s=function(l){try{const n=self[l];return n.setItem("_mapbox_test_",1),n.removeItem("_mapbox_test_"),!0}catch{return!1}},i.t=function(){return Fj||(Fj=new Sg),Fj},i.u=function(){return function l(n){return n?(n^Math.random()*(16>>n/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,l)}()},i.v=function(l){return!!l&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(l)},i.w=ur,i.x=AI,i.y=Vm,i.z=jl}),f(["./shared"],function(i){function S(ue){const Z=ue?ue.url.toString():void 0;return Z?performance.getEntriesByName(Z):[]}function E(ue){if(typeof ue=="number"||typeof ue=="boolean"||typeof ue=="string"||ue==null)return JSON.stringify(ue);if(Array.isArray(ue)){let K="[";for(const ie of ue)K+=`${E(ie)},`;return`${K}]`}let Z="{";for(const K of Object.keys(ue).sort())Z+=`${K}:${E(ue[K])},`;return`${Z}}`}function I(ue){let Z="";for(const K of i.bw)Z+=`/${E(ue[K])}`;return Z}class D{constructor(Z){this.keyCache={},this._layers={},this._layerConfigs={},Z&&this.replace(Z)}replace(Z,K){this._layerConfigs={},this._layers={},this.update(Z,[],K)}update(Z,K,ie){this._options=ie;for(const _e of Z)this._layerConfigs[_e.id]=_e,(this._layers[_e.id]=i.dt(_e,this.scope,null,this._options)).compileFilter(ie),this.keyCache[_e.id]&&delete this.keyCache[_e.id];for(const _e of K)delete this.keyCache[_e],delete this._layerConfigs[_e],delete this._layers[_e];this.familiesBySource={};const ce=function(_e,Ie){const Re={};for(let ze=0;ze<_e.length;ze++){const et=_e[ze];let ut=Ie&&Ie[et.id];ut||(et.type==="symbol"?ut=et.id:(ut=I(et),et.type==="line"&&et.paint&&function Xt(Qt){return typeof Qt=="string"&&Qt==="line-progress"||(Array.isArray(Qt)?Qt.some(Xt):!(!Qt||typeof Qt!="object")&&Object.values(Qt).some(Xt))}(et.paint["line-width"])&&(ut+=`/${E(et.paint["line-width"])}`))),Ie&&(Ie[et.id]=ut);let Ut=Re[ut];Ut||(Ut=Re[ut]=[]),Ut.push(et)}const Ce=[];for(const ze in Re)Ce.push(Re[ze]);return Ce}(Object.values(this._layerConfigs),this.keyCache);for(const _e of ce){const Ie=_e.map(Ut=>this._layers[Ut.id]),Re=Ie[0];if(Re.visibility==="none")continue;const Ce=Re.source||"";let ze=this.familiesBySource[Ce];ze||(ze=this.familiesBySource[Ce]={});const et=Re.sourceLayer||"_geojsonTileLayer";let ut=ze[et];ut||(ut=ze[et]=[]),ut.push(Ie)}}}const M=1*i.fk;class R{constructor(Z){const K={},ie=[];for(const Re in Z){const Ce=Z[Re],ze=K[Re]={};for(const et in Ce.glyphs){const ut=Ce.glyphs[+et];if(!ut||ut.bitmap.width===0||ut.bitmap.height===0)continue;const Ut=ut.metrics.localGlyph?M:1,Xt={x:0,y:0,w:ut.bitmap.width+2*Ut,h:ut.bitmap.height+2*Ut};ie.push(Xt),ze[et]=Xt}}const{w:ce,h:_e}=i.G(ie),Ie=new i.fj({width:ce||1,height:_e||1});for(const Re in Z){const Ce=Z[Re];for(const ze in Ce.glyphs){const et=Ce.glyphs[+ze];if(!et||et.bitmap.width===0||et.bitmap.height===0)continue;const ut=K[Re][ze],Ut=et.metrics.localGlyph?M:1;i.fj.copy(et.bitmap,Ie,{x:0,y:0},{x:ut.x+Ut,y:ut.y+Ut},et.bitmap)}}this.image=Ie,this.positions=K}}function H(ue,Z,K){ue[Z]?K&&(ue[Z].center=K):ue[Z]={floorIds:new Set,center:K||[0,0],floors:{}}}function F(ue,Z,K,ie){for(const ce of Z)H(ue,ce),ue[ce].floors[K]=ie,ue[ce].floorIds.add(K)}function U(ue){return{id:ue.properties.id.toString(),center:ue.properties.center.toString().split(";").map(Number)}}function Y(ue){return{id:ue.properties.id.toString(),isDefault:!!ue.properties.is_default&&ue.properties.is_default,connections:ue.properties.connected_floor_ids?new Set(ue.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:ue.properties.conflicted_floor_ids?new Set(ue.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:ue.properties.building_ids?new Set(ue.properties.building_ids.toString().split(";")):new Set,name:ue.properties.name.toString(),zIndex:ue.properties.z_index}}function z(ue,Z){return Z.every(K=>ue.properties&&ue.properties[K]!=null)}function J(ue){return z(ue,["type","id","name"])&&ue.properties.type==="building"}function ne(ue){return z(ue,["type","id","name","z_index"])&&ue.properties.type==="floor"}i.fi(R,"GlyphAtlas");class me{constructor(Z){this.tileID=new i.aP(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.tileZoom=Z.tileZoom,this.uid=Z.uid,this.zoom=Z.zoom,this.lut=Z.lut,this.canonical=Z.tileID.canonical,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.scope=Z.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Z.showCollisionBoxes,this.collectResourceTiming=!!Z.request&&Z.request.collectResourceTiming,this.promoteId=Z.promoteId,this.isSymbolTile=Z.isSymbolTile,this.tileTransform=i.aY(Z.tileID.canonical,Z.projection),this.projection=Z.projection,this.worldview=Z.worldview,this.localizableLayerIds=Z.localizableLayerIds,this.brightness=Z.brightness,this.extraShadowCaster=!!Z.extraShadowCaster,this.tessellationStep=Z.tessellationStep,this.scaleFactor=Z.scaleFactor,this.worldview=Z.worldview,this.indoor=Z.indoor}parse(Z,K,ie,ce,_e,Ie){this.status="parsing",this.data=Z,this.collisionBoxArray=new i.b2;const Re=new i.fl(Object.keys(Z.layers).sort()),Ce=new i.fm(this.tileID,this.promoteId);Ce.bucketLayerIDs=[];const ze={},et=new i.fn(256,256),ut={featureIndex:Ce,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:et,availableImages:ie,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const ur=this.indoor.indoorState.activeFloorsVisible,Yr=function(Xr,Rn,Zi){const Rs=function(yi,Un){if(!yi)return i.w("No source layers defined in indoor specification"),Un;if(yi.size===0)return Un;const ls=yi.difference(Un);for(const Ts of ls)i.w(`Missing source layer required in indoor specification: ${Ts}`);return Un.intersection(Un)}(Rn.sourceLayers,new Set(Object.keys(Xr.layers))),gs=Rn.indoorState,is=function(yi,Un,ls,Ts){const Di=new Set,cs=new Set,wa=new Set,ro=new Map,Ko={},au=He=>{const Et=ro.get(He)||new Set;for(const lr of Di)if((ro.get(lr)||new Set).has(He)||Et.has(lr))return!0;return!1};for(const He of Un){const Et=yi.layers[He];if(Et)for(let lr=0;lr<Et.length;lr++){const qr=Et.feature(lr);if(J(qr)){const{id:oi,center:Ti}=U(qr);H(Ko,oi,Ti),Di.add(oi)}else if(ne(qr)){const{id:oi,isDefault:Ti,connections:qi,conflicts:Ms,buildings:ba,name:Da,zIndex:Hs}=Y(qr);F(Ko,ba,oi,{name:Da,zIndex:Hs}),ro.set(oi,Ms),(oi===Ts||qi.has(Ts))&&Di.add(oi),cs.add(oi),Ti&&wa.add(oi)}}else i.w(`indoor source layer not found: ${He}`)}if(ls)for(const He of ls)cs.has(He)&&(au(He)||Di.add(He));for(const He of wa)Di.has(He)||au(He)||Di.add(He);return{buildings:Ko,activeFloors:Di}}(Xr,Rs,gs.lastActiveFloors,gs.selectedFloorId);return Zi.send("setIndoorData",is),is}(Z,this.indoor,_e);ut.activeFloors=ur?Yr.activeFloors:void 0}const Ut=[],Xt=K.familiesBySource[this.source];for(const ur in Xt){const Yr=Z.layers[ur];if(!Yr)continue;let Xr=!1,Rn=!1,Zi=!1;for(const yi of Xt[ur])yi[0].type==="symbol"?Xr=!0:Rn=!0,yi[0].is3D()&&yi[0].type!=="model"&&(Zi=!0);if(this.extraShadowCaster&&!Zi||this.isSymbolTile===!0&&!Xr||this.isSymbolTile===!1&&!Rn)continue;Yr.version===1&&i.w(`Vector tile source "${this.source}" layer "${ur}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Rs=Re.encode(ur),gs=[];let is=!1;for(let yi=0,Un=0;yi<Yr.length;yi++){const ls=Yr.feature(yi),Ts=Ce.getId(ls,ur);if(this.localizableLayerIds&&this.localizableLayerIds.has(ur)){const Di=ls.properties?ls.properties.worldview:null;if(this.worldview&&typeof Di=="string")if(Di==="all")ls.properties.$localized=!0;else{if(!Di.split(",").includes(this.worldview))continue;ls.properties.$localized=!0,ls.properties.worldview=this.worldview}}!is&&ls.properties&&ls.properties.hasOwnProperty(i.fo)&&(is=!0),gs.push({feature:ls,id:Ts,index:Un,sourceLayerIndex:Rs}),Un++}is&&!ut.elevationFeatures&&Z.layers.hasOwnProperty(i.fp)&&(ut.elevationFeatures=i.fq.parseFrom(Z.layers[i.fp],this.canonical));for(const yi of Xt[ur]){const Un=yi[0];if(this.extraShadowCaster&&(!Un.is3D()||Un.type==="model")||this.isSymbolTile!==void 0&&Un.type==="symbol"!==this.isSymbolTile||Un.minzoom&&this.zoom<Math.floor(Un.minzoom)||Un.maxzoom&&this.zoom>=Un.maxzoom||Un.visibility==="none")continue;le(yi,this.zoom,ut.brightness,ie,this.worldview);const ls=ze[Un.id]=Un.createBucket({index:Ce.bucketLayerIDs.length,layers:yi,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Rs,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:ce,worldview:this.worldview});Ce.bucketLayerIDs.push(yi.map(Di=>i.B(Di.id,Di.scope)));let Ts=ls.prepare?ls.prepare():null;Ts!=null?(Ts=Ts.then(()=>ls.populate(gs,ut,this.tileID.canonical,this.tileTransform)),Ut.push(Ts)):ls.populate(gs,ut,this.tileID.canonical,this.tileTransform)}}const Qt=()=>{let ur,Yr,Xr,Rn,Zi,Rs;et.trim();const gs={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},is=()=>{if(ur)return this.status="done",Ie(ur);if(this.extraShadowCaster)this.status="done",Ie(null,{buckets:Object.values(ze).filter(Un=>!Un.isEmpty()),featureIndex:Ce,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:ut.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Yr&&Xr&&Rn){const Un=new R(Yr),ls=new Map;for(const[cs,wa]of Xr.entries()){const{imagePosition:ro}=i.ft(cs,wa,i.fu);ls.set(cs,ro)}const Ts={};for(const cs in ze){const wa=ze[cs];wa instanceof i.b3&&(le(wa.layers,this.zoom,ut.brightness,ie,this.worldview),Ts[cs]=i.fv(wa,Yr,Un.positions,Xr,ls,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Zi,this.worldview))}const Di={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(_e,Xr,Zi,()=>{Di.iconsPending=!1,yi(Ts,Un,Di)}),this.rasterizeIfNeeded(_e,Rn,Rs,()=>{Di.patternsPending=!1,yi(Ts,Un,Di)})}},yi=(Un,ls,Ts,Di)=>{if(Ts.iconsPending||Ts.patternsPending)return;const cs=new i.fw(Xr,Rn,this.lut);for(const wa in ze){const ro=ze[wa];if(wa in Un)i.fx(ro,Un[wa],this.showCollisionBoxes,ie,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Xr,cs);else if(ro.hasPattern&&(ro instanceof i.b9||ro instanceof i.ba||ro instanceof i.e9)){le(ro.layers,this.zoom,ut.brightness,ie,this.worldview);const Ko=Object.fromEntries(cs.patternPositions);ro.addFeatures(ut,this.tileID.canonical,Ko,ie,this.tileTransform,this.brightness)}}this.status="done",Ie(null,{buckets:Object.values(ze).filter(wa=>!wa.isEmpty()),featureIndex:Ce,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ls.image,lineAtlas:et,imageAtlas:cs,brightness:ut.brightness})};if(!this.extraShadowCaster){const Un=i.fr(ut.glyphDependencies,Di=>Object.keys(Di).map(Number));Object.keys(Un).length?_e.send("getGlyphs",{uid:this.uid,stacks:Un},(Di,cs)=>{ur||(ur=Di,Yr=cs,is())},void 0,!1,gs):Yr={};const ls=Array.from(ut.iconDependencies.keys()).map(Di=>i.I.parse(Di));ls.length?_e.send("getImages",{images:ls,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Di,cs)=>{ur||(ur=Di,Xr=new Map,Zi=this.updateImageMapAndGetImageTaskQueue(Xr,cs,ut.iconDependencies),is())},void 0,!1,gs):(Xr=new Map,Zi=new Map);const Ts=Array.from(ut.patternDependencies.keys()).map(Di=>i.I.parse(Di));Ts.length?_e.send("getImages",{images:Ts,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Di,cs)=>{ur||(ur=Di,Rn=new Map,Rs=this.updateImageMapAndGetImageTaskQueue(Rn,cs,ut.patternDependencies),is())},void 0,!1,gs):(Rn=new Map,Rs=new Map)}if(ut.elevationFeatures&&ut.elevationFeatures.length>0){const Un=[];for(const Ts of Object.values(ze))if(Ts instanceof i.ba){const Di=Ts.getUnevaluatedPortalGraph();Di&&Un.push(Di)}const ls=i.fs.evaluate(Un);for(const Ts of Object.values(ze))if(Ts instanceof i.ba){const Di=Z.layers[Re.decode(Ts.sourceLayerIndex)];Ts.setEvaluatedPortalGraph(ls,Di,this.tileID.canonical,ut.availableImages,ut.brightness)}}is()};Ut.length>0?Promise.allSettled(Ut).then(Qt).catch(Ie):Qt()}updateParameters(Z){this.scaleFactor=Z.scaleFactor,this.showCollisionBoxes=Z.showCollisionBoxes,this.projection=Z.projection,this.brightness=Z.brightness,this.tileTransform=i.aY(Z.tileID.canonical,Z.projection),this.extraShadowCaster=Z.extraShadowCaster,this.lut=Z.lut,this.worldview=Z.worldview,this.indoor=Z.indoor}rasterizeIfNeeded(Z,K,ie,ce){Array.from(K.values()).some(_e=>_e.usvg)?this.rasterize(Z,K,ie,ce):ce()}updateImageMapAndGetImageTaskQueue(Z,K,ie){const ce=new Map;for(const _e of K.keys()){const Ie=ie.get(_e)||[];for(const Re of Ie){const Ce=Re.toString(),ze=K.get(Re.id.toString());ze.usvg?ce.has(Ce)||(ce.set(Ce,Re),Z.set(Ce,Object.assign({},ze))):Z.set(Ce,ze)}}return ce}rasterize(Z,K,ie,ce){this.rasterizeTask=Z.send("rasterizeImages",{scope:this.scope,tasks:ie},(_e,Ie)=>{if(!_e)for(const[Re,Ce]of Ie.entries()){const ze=Object.assign(K.get(Re),{data:Ce});K.set(Re,ze)}ce()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function le(ue,Z,K,ie,ce){const _e=new i.ac(Z,{brightness:K,worldview:ce});for(const Ie of ue)Ie.recalculate(_e,ie)}class ye extends i.E{constructor(Z,K,ie,ce,_e,Ie,Re){super(),this.actor=Z,this.layerIndex=K,this.availableImages=ie,this.availableModels=ce,this.loadVectorData=Ie||i.aL,this.loading={},this.loaded={},this.deduped=new i.aK(Z.scheduler),this.isSpriteLoaded=_e,this.scheduler=Z.scheduler,this.brightness=Re}loadTile(Z,K){const ie=Z.uid,ce=Z&&Z.request,_e=ce&&ce.collectResourceTiming,Ie=this.loading[ie]=new me(Z);Ie.abort=this.loadVectorData(Z,(Re,Ce)=>{const ze=!this.loading[ie];if(delete this.loading[ie],Ie.cancelRasterize(),ze||Re||!Ce)return Ie.status="done",ze||(this.loaded[ie]=Ie),K(Re);const et=Ce.rawData,ut={},Ut=i.aM(Ce.responseHeaders);Ut&&Ut.expires&&(ut.expires=Ut.expires),Ut&&Ut.cacheControl&&(ut.cacheControl=Ut.cacheControl),Ie.vectorTile=Ce.vectorTile||new i.fy(new i.bs(et));const Xt=()=>{Ie.parse(Ie.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Qt,ur)=>{if(Qt||!ur)return K(Qt);const Yr={};if(_e){const Xr=S(ce);Xr.length>0&&(Yr.resourceTiming=JSON.parse(JSON.stringify(Xr)))}K(null,Object.assign({rawTileData:et.slice(0),responseHeaders:Ce.responseHeaders},ur,ut,Yr))})};this.isSpriteLoaded?Xt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Xt,{type:"parseTile",isSymbolTile:Z.isSymbolTile,zoom:Z.tileZoom}):Xt()}),this.loaded=this.loaded||{},this.loaded[ie]=Ie})}reloadTile(Z,K){const ie=this.loaded,ce=Z.uid;if(ie&&ie[ce]){const _e=ie[ce];_e.updateParameters(Z);const Ie=(Re,Ce)=>{const ze=_e.reloadCallback;ze&&(delete _e.reloadCallback,_e.parse(_e.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,ze)),K(Re,Ce)};_e.status==="parsing"?_e.reloadCallback=Ie:_e.status==="done"&&(_e.vectorTile?_e.parse(_e.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ie):Ie())}else K(null,void 0)}abortTile(Z,K){const ie=Z.uid,ce=this.loading[ie];ce&&(ce.abort&&ce.abort(),delete this.loading[ie]),K()}removeTile(Z,K){const ie=this.loaded,ce=Z.uid;ie&&ie[ce]&&delete ie[ce],K()}}class pe{loadTile(Z,K){const{uid:ie,encoding:ce,rawImageData:_e,padding:Ie}=Z,Re=ImageBitmap&&_e instanceof ImageBitmap?this.getImageData(_e,Ie):_e;K(null,new i.fz(ie,Re,ce,Ie<1))}reloadTile(Z,K){K(null,null)}abortTile(Z,K){K()}removeTile(Z,K){K()}getImageData(Z,K){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Z.width,Z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Z.width,this.offscreenCanvas.height=Z.height,this.offscreenCanvasContext.drawImage(Z,0,0,Z.width,Z.height);const ie=this.offscreenCanvasContext.getImageData(-K,-K,Z.width+2*K,Z.height+2*K);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ie}}i.br.setPbf(i.bs);class be{constructor(Z){this._mrt=new i.br(Z.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=Z.uid,this.tileID=Z.tileID,this.source=Z.source}parse(Z,K){const ie=this._mrt;this.status="parsing",this._entireBuffer=Z;try{ie.parseHeader(Z),this._isHeaderLoaded=!0;const ce=[];for(const _e in ie.layers){const Ie=ie.getLayer(_e),Re=Ie.getDataRange(Ie.getBandList()),Ce=ie.createDecodingTask(Re),ze=Z.slice(Re.firstByte,Re.lastByte+1),et=i.br.performDecoding(ze,Ce).then(ut=>Ce.complete(null,ut)).catch(ut=>Ce.complete(ut,null));ce.push(et)}Promise.allSettled(ce).then(()=>K(null,ie)).catch(_e=>K(_e))}catch(ce){K(ce)}}}class ke{constructor(Z){this.actor=Z,this.loading={},this.loaded={}}loadTile(Z,K){const ie=Z.uid,ce=Z.request,_e=this.loading[ie]=new be(Z),{cancel:Ie}=i.bt(ce,(Re,Ce,ze)=>{const et=!this.loading[ie];if(delete this.loading[ie],et||Re||!Ce)return _e.status="done",et||(this.loaded[ie]=_e),K(Re);_e.parse(Ce,(ut,Ut)=>{if(ut||!Ut)return K(ut);K(null,Ut,ze)}),this.loaded[ie]=_e});_e.abort=Ie}reloadTile(Z,K){K(null,void 0)}abortTile(Z,K){const ie=Z.uid,ce=this.loading[ie];ce&&(ce.abort&&ce.abort(),delete this.loading[ie]),K()}removeTile(Z,K){const ie=Z.uid;this.loaded[ie]&&delete this.loaded[ie],K()}decodeRasterArray(Z,K){i.br.performDecoding(Z.buffer,Z.task).then(ie=>K(null,ie)).catch(ie=>K(ie))}}const Oe=i.fA.prototype.toGeoJSON;class Ee{constructor(Z){this._feature=Z,this.extent=i.al,this.type=Z.type,this.properties=Z.tags,"id"in Z&&!isNaN(Z.id)&&(this.id=parseInt(Z.id,10))}loadGeometry(){if(this._feature.type===1){const Z=[];for(const K of this._feature.geometry)Z.push([new i.P(K[0],K[1])]);return Z}{const Z=[];for(const K of this._feature.geometry){const ie=[];for(const ce of K)ie.push(new i.P(ce[0],ce[1]));Z.push(ie)}return Z}}toGeoJSON(Z,K,ie){return Oe.call(this,Z,K,ie)}}class qe{constructor(Z,K){this.name=Z,this.extent=i.al,this.length=K.length,this._jsonFeatures=K}feature(Z){return new Ee(this._jsonFeatures[Z])}}class Qe{constructor(Z){this.layers={},this.extent=i.al;for(const K of Object.keys(Z))this.layers[K]=new qe(K,Z[K])}}const gt=64/4096,Xe=128;class ct{constructor(){this.features=new Map}clear(){this.features.clear()}load(Z=[],K){for(const ie of Z){const ce=ie.id;if(ce==null)continue;let _e=this.features.get(ce);_e&&this.updateCache(_e,K),ie.geometry?(_e=mt(ie),this.updateCache(_e,K),this.features.set(ce,_e)):this.features.delete(ce),this.updateCache(_e,K)}}updateCache(Z,K){for(const{canonical:ie,uid:ce}of Object.values(K)){const{z:_e,x:Ie,y:Re}=ie;Me(Z,Math.pow(2,_e),Ie,Re)&&delete K[ce]}}getTile(Z,K,ie){const ce=Math.pow(2,Z),_e=[];for(const Ie of this.features.values())Me(Ie,ce,K,ie)&&_e.push(he(Ie,ce,K,ie));return{features:_e}}getFeatures(){return[...this.features.values()]}}function Me({minX:ue,minY:Z,maxX:K,maxY:ie},ce,_e,Ie){return ue<(_e+1+gt)/ce&&Z<(Ie+1+gt)/ce&&K>(_e-gt)/ce&&ie>(Ie-gt)/ce}function mt(ue){const{id:Z,geometry:K,properties:ie}=ue;if(!K)return;if(K.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:ce,coordinates:_e}=K,Ie={id:Z,type:1,geometry:[],tags:ie,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Re=Ie.geometry;if(ce==="Point")Kt(_e,Re,Ie);else if(ce==="MultiPoint")for(const Ce of _e)Kt(Ce,Re,Ie);else if(ce==="LineString")Ie.type=2,it(_e,Re,Ie);else if(ce==="MultiLineString")Ie.type=2,ee(_e,Re,Ie);else if(ce==="Polygon")Ie.type=3,ee(_e,Re,Ie,!0);else{if(ce!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ie.type=3;for(const Ce of _e)ee(Ce,Re,Ie,!0)}return Ie}function Kt([ue,Z],K,ie){const ce=i.aF(ue);let _e=i.aJ(Z);_e=_e<0?0:_e>1?1:_e,K.push(ce,_e),ie.minX=Math.min(ie.minX,ce),ie.minY=Math.min(ie.minY,_e),ie.maxX=Math.max(ie.maxX,ce),ie.maxY=Math.max(ie.maxY,_e)}function it(ue,Z,K,ie=!1,ce=!1){const _e=[];for(const Ie of ue)Kt(Ie,_e,K);Z.push(_e),ie&&function(Ie,Re){let Ce=0;for(let ze=0,et=Ie.length,ut=et-2;ze<et;ut=ze,ze+=2)Ce+=(Ie[ze]-Ie[ut])*(Ie[ze+1]+Ie[ut+1]);if(Ce>0===Re)for(let ze=0,et=Ie.length;ze<et/2;ze+=2){const ut=Ie[ze],Ut=Ie[ze+1];Ie[ze]=Ie[et-2-ze],Ie[ze+1]=Ie[et-1-ze],Ie[et-2-ze]=ut,Ie[et-1-ze]=Ut}}(_e,ce)}function ee(ue,Z,K,ie=!1){for(let ce=0;ce<ue.length;ce++)it(ue[ce],Z,K,ie,ce===0)}function he(ue,Z,K,ie){const{id:ce,type:_e,geometry:Ie,tags:Re}=ue,Ce=[];if(_e===1)(function(ze,et,ut,Ut,Xt){for(let Qt=0;Qt<ze.length;Qt+=2){const ur=Math.round(i.al*(ze[Qt+0]*et-ut)),Yr=Math.round(i.al*(ze[Qt+1]*et-Ut));Xt.push([ur,Yr])}})(Ie,Z,K,ie,Ce);else for(const ze of Ie)Se(ze,Z,K,ie,Ce);return{id:ce,type:_e,geometry:Ce,tags:Re}}function Se(ue,Z,K,ie,ce){const _e=-Xe,Ie=i.al+Xe;let Re;for(let Ce=0;Ce<ue.length-2;Ce+=2){let ze=Math.round(i.al*(ue[Ce+0]*Z-K)),et=Math.round(i.al*(ue[Ce+1]*Z-ie)),ut=Math.round(i.al*(ue[Ce+2]*Z-K)),Ut=Math.round(i.al*(ue[Ce+3]*Z-ie));const Xt=ut-ze,Qt=Ut-et;ze<_e&&ut<_e||(ze<_e?(et+=Math.round(Qt*((_e-ze)/Xt)),ze=_e):ut<_e&&(Ut=et+Math.round(Qt*((_e-ze)/Xt)),ut=_e),et<_e&&Ut<_e||(et<_e?(ze+=Math.round(Xt*((_e-et)/Qt)),et=_e):Ut<_e&&(ut=ze+Math.round(Xt*((_e-et)/Qt)),Ut=_e),ze>=Ie&&ut>=Ie||(ze>=Ie?(et+=Math.round(Qt*((Ie-ze)/Xt)),ze=Ie):ut>=Ie&&(Ut=et+Math.round(Qt*((Ie-ze)/Xt)),ut=Ie),et>=Ie&&Ut>=Ie||(et>=Ie?(ze+=Math.round(Xt*((Ie-et)/Qt)),et=Ie):Ut>=Ie&&(ut=ze+Math.round(Xt*((Ie-et)/Qt)),Ut=Ie),Re&&ze===Re[Re.length-1][0]&&et===Re[Re.length-1][1]||(Re=[[ze,et]],ce.push(Re)),Re.push([ut,Ut])))))}}function Ue({name:ue,features:Z},K){K.writeStringField(1,ue),K.writeVarintField(5,i.al);const ie=new Map,ce=new Map,_e={keys:ie,values:ce,feature:null};for(const Ie of Z)_e.feature=Ie,K.writeMessage(2,nt,_e);for(const Ie of ie.keys())K.writeStringField(3,Ie);for(const Ie of ce.keys())K.writeMessage(4,jr,Ie)}function nt(ue,Z){const K=ue.feature;K.id!==void 0&&Number.isSafeInteger(+K.id)&&Z.writeVarintField(1,+K.id),K.tags&&Z.writeMessage(2,dt,ue),Z.writeVarintField(3,K.type),Z.writeMessage(4,Gt,K)}function dt({keys:ue,values:Z,feature:K},ie){for(const ce of Object.keys(K.tags)){let _e=K.tags[ce];if(_e===null)continue;let Ie=ue.get(ce);Ie===void 0&&(Ie=ue.size,ue.set(ce,Ie)),ie.writeVarint(Ie);const Re=typeof _e;Re!=="string"&&Re!=="boolean"&&Re!=="number"&&(_e=JSON.stringify(_e));let Ce=Z.get(_e);Ce===void 0&&(Ce=Z.size,Z.set(_e,Ce)),ie.writeVarint(Ce)}}function Vt(ue,Z){return(Z<<3)+(7&ue)}function zt(ue){return ue<<1^ue>>31}function Gt(ue,Z){const{geometry:K,type:ie}=ue;let ce=0,_e=0;if(ie===1){Z.writeVarint(Vt(1,K.length));for(const Ie of K){const Re=Ie[0]-ce,Ce=Ie[1]-_e;Z.writeVarint(zt(Re)),Z.writeVarint(zt(Ce)),ce+=Re,_e+=Ce}}else for(const Ie of K){Z.writeVarint(Vt(1,1));const Re=Ie.length-(ie===3?1:0);for(let Ce=0;Ce<Re;Ce++){Ce===1&&Z.writeVarint(Vt(2,Re-1));const ze=Ie[Ce][0]-ce,et=Ie[Ce][1]-_e;Z.writeVarint(zt(ze)),Z.writeVarint(zt(et)),ce+=ze,_e+=et}ie===3&&Z.writeVarint(Vt(7,1))}}function jr(ue,Z){const K=typeof ue;K==="string"?Z.writeStringField(1,ue):K==="boolean"?Z.writeBooleanField(7,ue):K==="number"&&(ue%1!=0?Z.writeDoubleField(3,ue):ue<0?Z.writeSVarintField(6,ue):Z.writeVarintField(5,ue))}const Wr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ue=>ue},nn=Math.fround||(xn=new Float32Array(1),ue=>(xn[0]=+ue,xn[0]));var xn;const ei=3,Dn=5,Zr=6;class Nn{constructor(Z){this.options=Object.assign(Object.create(Wr),Z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Z){const{log:K,minZoom:ie,maxZoom:ce}=this.options;K&&console.time("total time");const _e=`prepare ${Z.length} points`;K&&console.time(_e),this.points=Z;const Ie=[];for(let Ce=0;Ce<Z.length;Ce++){const ze=Z[Ce];if(!ze.geometry)continue;const[et,ut]=ze.geometry.coordinates,Ut=nn(Rt(et)),Xt=nn(Wt(ut));Ie.push(Ut,Xt,1/0,Ce,-1,1),this.options.reduce&&Ie.push(0)}let Re=this.trees[ce+1]=this._createTree(Ie);K&&console.timeEnd(_e);for(let Ce=ce;Ce>=ie;Ce--){const ze=+Date.now();Re=this.trees[Ce]=this._createTree(this._cluster(Re,Ce)),K&&console.log("z%d: %d clusters in %dms",Ce,Re.numItems,+Date.now()-ze)}return K&&console.timeEnd("total time"),this}getClusters(Z,K){let ie=((Z[0]+180)%360+360)%360-180;const ce=Math.max(-90,Math.min(90,Z[1]));let _e=Z[2]===180?180:((Z[2]+180)%360+360)%360-180;const Ie=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)ie=-180,_e=180;else if(ie>_e){const ut=this.getClusters([ie,ce,180,Ie],K),Ut=this.getClusters([-180,ce,_e,Ie],K);return ut.concat(Ut)}const Re=this.trees[this._limitZoom(K)],Ce=Re.range(Rt(ie),Wt(Ie),Rt(_e),Wt(ce)),ze=Re.data,et=[];for(const ut of Ce){const Ut=this.stride*ut;et.push(ze[Ut+Dn]>1?Pi(ze,Ut,this.clusterProps):this.points[ze[Ut+ei]])}return et}getChildren(Z){const K=this._getOriginId(Z),ie=this._getOriginZoom(Z),ce="No cluster with the specified id.",_e=this.trees[ie];if(!_e)throw new Error(ce);const Ie=_e.data;if(K*this.stride>=Ie.length)throw new Error(ce);const Re=this.options.radius/(this.options.extent*Math.pow(2,ie-1)),Ce=_e.within(Ie[K*this.stride],Ie[K*this.stride+1],Re),ze=[];for(const et of Ce){const ut=et*this.stride;Ie[ut+4]===Z&&ze.push(Ie[ut+Dn]>1?Pi(Ie,ut,this.clusterProps):this.points[Ie[ut+ei]])}if(ze.length===0)throw new Error(ce);return ze}getLeaves(Z,K,ie){const ce=[];return this._appendLeaves(ce,Z,K=K||10,ie=ie||0,0),ce}getTile(Z,K,ie){const ce=this.trees[this._limitZoom(Z)],_e=Math.pow(2,Z),{extent:Ie,radius:Re}=this.options,Ce=Re/Ie,ze=(ie-Ce)/_e,et=(ie+1+Ce)/_e,ut={features:[]};return this._addTileFeatures(ce.range((K-Ce)/_e,ze,(K+1+Ce)/_e,et),ce.data,K,ie,_e,ut),K===0&&this._addTileFeatures(ce.range(1-Ce/_e,ze,1,et),ce.data,_e,ie,_e,ut),K===_e-1&&this._addTileFeatures(ce.range(0,ze,Ce/_e,et),ce.data,-1,ie,_e,ut),ut.features.length?ut:null}getClusterExpansionZoom(Z){let K=this._getOriginZoom(Z)-1;for(;K<=this.options.maxZoom;){const ie=this.getChildren(Z);if(K++,ie.length!==1)break;Z=ie[0].properties.cluster_id}return K}_appendLeaves(Z,K,ie,ce,_e){const Ie=this.getChildren(K);for(const Re of Ie){const Ce=Re.properties;if(Ce&&Ce.cluster?_e+Ce.point_count<=ce?_e+=Ce.point_count:_e=this._appendLeaves(Z,Ce.cluster_id,ie,ce,_e):_e<ce?_e++:Z.push(Re),Z.length===ie)break}return _e}_createTree(Z){const K=new i.c3(Z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ie=0;ie<Z.length;ie+=this.stride)K.add(Z[ie],Z[ie+1]);return K.finish(),K.data=Z,K}_addTileFeatures(Z,K,ie,ce,_e,Ie){for(const Re of Z){const Ce=Re*this.stride,ze=K[Ce+Dn]>1;let et,ut,Ut;if(ze)et=ft(K,Ce,this.clusterProps),ut=K[Ce],Ut=K[Ce+1];else{const ur=this.points[K[Ce+ei]];et=ur.properties;const[Yr,Xr]=ur.geometry.coordinates;ut=Rt(Yr),Ut=Wt(Xr)}const Xt={type:1,geometry:[[Math.round(this.options.extent*(ut*_e-ie)),Math.round(this.options.extent*(Ut*_e-ce))]],tags:et};let Qt;Qt=ze||this.options.generateId?K[Ce+ei]:this.points[K[Ce+ei]].id,Qt!==void 0&&(Xt.id=Qt),Ie.features.push(Xt)}}_limitZoom(Z){return Math.max(this.options.minZoom,Math.min(Math.floor(+Z),this.options.maxZoom+1))}_cluster(Z,K){const{radius:ie,extent:ce,reduce:_e,minPoints:Ie}=this.options,Re=ie/(ce*Math.pow(2,K)),Ce=Z.data,ze=[],et=this.stride;for(let ut=0;ut<Ce.length;ut+=et){if(Ce[ut+2]<=K)continue;Ce[ut+2]=K;const Ut=Ce[ut],Xt=Ce[ut+1],Qt=Z.within(Ce[ut],Ce[ut+1],Re),ur=Ce[ut+Dn];let Yr=ur;for(const Xr of Qt){const Rn=Xr*et;Ce[Rn+2]>K&&(Yr+=Ce[Rn+Dn])}if(Yr>ur&&Yr>=Ie){let Xr,Rn=Ut*ur,Zi=Xt*ur,Rs=-1;const gs=(ut/et<<5)+(K+1)+this.points.length;for(const is of Qt){const yi=is*et;if(Ce[yi+2]<=K)continue;Ce[yi+2]=K;const Un=Ce[yi+Dn];Rn+=Ce[yi]*Un,Zi+=Ce[yi+1]*Un,Ce[yi+4]=gs,_e&&(Xr||(Xr=this._map(Ce,ut,!0),Rs=this.clusterProps.length,this.clusterProps.push(Xr)),_e(Xr,this._map(Ce,yi)))}Ce[ut+4]=gs,ze.push(Rn/Yr,Zi/Yr,1/0,gs,-1,Yr),_e&&ze.push(Rs)}else{for(let Xr=0;Xr<et;Xr++)ze.push(Ce[ut+Xr]);if(Yr>1)for(const Xr of Qt){const Rn=Xr*et;if(!(Ce[Rn+2]<=K)){Ce[Rn+2]=K;for(let Zi=0;Zi<et;Zi++)ze.push(Ce[Rn+Zi])}}}}return ze}_getOriginId(Z){return Z-this.points.length>>5}_getOriginZoom(Z){return(Z-this.points.length)%32}_map(Z,K,ie){if(Z[K+Dn]>1){const Ie=this.clusterProps[Z[K+Zr]];return ie?Object.assign({},Ie):Ie}const ce=this.points[Z[K+ei]].properties,_e=this.options.map(ce);return ie&&_e===ce?Object.assign({},_e):_e}}function Pi(ue,Z,K){return{type:"Feature",id:ue[Z+ei],properties:ft(ue,Z,K),geometry:{type:"Point",coordinates:[(ie=ue[Z],360*(ie-.5)),Pr(ue[Z+1])]}};var ie}function ft(ue,Z,K){const ie=ue[Z+Dn],ce=ie>=1e4?`${Math.round(ie/1e3)}k`:ie>=1e3?Math.round(ie/100)/10+"k":ie,_e=ue[Z+Zr],Ie=_e===-1?{}:Object.assign({},K[_e]);return Object.assign(Ie,{cluster:!0,cluster_id:ue[Z+ei],point_count:ie,point_count_abbreviated:ce})}function Rt(ue){return ue/360+.5}function Wt(ue){const Z=Math.sin(ue*Math.PI/180),K=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return K<0?0:K>1?1:K}function Pr(ue){const Z=(180-360*ue)*Math.PI/180;return 360*Math.atan(Math.exp(Z))/Math.PI-90}function Sr(ue,Z,K,ie){let ce=ie;const _e=Z+(K-Z>>1);let Ie,Re=K-Z;const Ce=ue[Z],ze=ue[Z+1],et=ue[K],ut=ue[K+1];for(let Ut=Z+3;Ut<K;Ut+=3){const Xt=Nr(ue[Ut],ue[Ut+1],Ce,ze,et,ut);if(Xt>ce)Ie=Ut,ce=Xt;else if(Xt===ce){const Qt=Math.abs(Ut-_e);Qt<Re&&(Ie=Ut,Re=Qt)}}ce>ie&&(Ie-Z>3&&Sr(ue,Z,Ie,ie),ue[Ie+2]=ce,K-Ie>3&&Sr(ue,Ie,K,ie))}function Nr(ue,Z,K,ie,ce,_e){let Ie=ce-K,Re=_e-ie;if(Ie!==0||Re!==0){const Ce=((ue-K)*Ie+(Z-ie)*Re)/(Ie*Ie+Re*Re);Ce>1?(K=ce,ie=_e):Ce>0&&(K+=Ie*Ce,ie+=Re*Ce)}return Ie=ue-K,Re=Z-ie,Ie*Ie+Re*Re}function Kr(ue,Z,K,ie){const ce={id:ue??null,type:Z,geometry:K,tags:ie,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Z==="Point"||Z==="MultiPoint"||Z==="LineString")Zn(ce,K);else if(Z==="Polygon")Zn(ce,K[0]);else if(Z==="MultiLineString")for(const _e of K)Zn(ce,_e);else if(Z==="MultiPolygon")for(const _e of K)Zn(ce,_e[0]);return ce}function Zn(ue,Z){for(let K=0;K<Z.length;K+=3)ue.minX=Math.min(ue.minX,Z[K]),ue.minY=Math.min(ue.minY,Z[K+1]),ue.maxX=Math.max(ue.maxX,Z[K]),ue.maxY=Math.max(ue.maxY,Z[K+1])}function Yn(ue,Z,K,ie){if(!Z.geometry)return;const ce=Z.geometry.coordinates;if(ce&&ce.length===0)return;const _e=Z.geometry.type,Ie=Math.pow(K.tolerance/((1<<K.maxZoom)*K.extent),2);let Re=[],Ce=Z.id;if(K.promoteId?Ce=Z.properties[K.promoteId]:K.generateId&&(Ce=ie||0),_e==="Point")Zt(ce,Re);else if(_e==="MultiPoint")for(const ze of ce)Zt(ze,Re);else if(_e==="LineString")en(ce,Re,Ie,!1);else if(_e==="MultiLineString"){if(K.lineMetrics){for(const ze of ce)Re=[],en(ze,Re,Ie,!1),ue.push(Kr(Ce,"LineString",Re,Z.properties));return}Sn(ce,Re,Ie,!1)}else if(_e==="Polygon")Sn(ce,Re,Ie,!0);else{if(_e!=="MultiPolygon"){if(_e==="GeometryCollection"){for(const ze of Z.geometry.geometries)Yn(ue,{id:Ce,geometry:ze,properties:Z.properties},K,ie);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ze of ce){const et=[];Sn(ze,et,Ie,!0),Re.push(et)}}ue.push(Kr(Ce,_e,Re,Z.properties))}function Zt(ue,Z){Z.push(fs(ue[0]),ms(ue[1]),0)}function en(ue,Z,K,ie){let ce,_e,Ie=0;for(let Ce=0;Ce<ue.length;Ce++){const ze=fs(ue[Ce][0]),et=ms(ue[Ce][1]);Z.push(ze,et,0),Ce>0&&(Ie+=ie?(ce*et-ze*_e)/2:Math.sqrt(Math.pow(ze-ce,2)+Math.pow(et-_e,2))),ce=ze,_e=et}const Re=Z.length-3;Z[2]=1,Sr(Z,0,Re,K),Z[Re+2]=1,Z.size=Math.abs(Ie),Z.start=0,Z.end=Z.size}function Sn(ue,Z,K,ie){for(let ce=0;ce<ue.length;ce++){const _e=[];en(ue[ce],_e,K,ie),Z.push(_e)}}function fs(ue){return ue/360+.5}function ms(ue){const Z=Math.sin(ue*Math.PI/180),K=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return K<0?0:K>1?1:K}function hr(ue,Z,K,ie,ce,_e,Ie,Re){if(ie/=Z,_e>=(K/=Z)&&Ie<ie)return ue;if(Ie<K||_e>=ie)return null;const Ce=[];for(const ze of ue){const et=ze.geometry;let ut=ze.type;const Ut=ce===0?ze.minX:ze.minY,Xt=ce===0?ze.maxX:ze.maxY;if(Ut>=K&&Xt<ie){Ce.push(ze);continue}if(Xt<K||Ut>=ie)continue;let Qt=[];if(ut==="Point"||ut==="MultiPoint")An(et,Qt,K,ie,ce);else if(ut==="LineString")fi(et,Qt,K,ie,ce,!1,Re.lineMetrics);else if(ut==="MultiLineString")$n(et,Qt,K,ie,ce,!1);else if(ut==="Polygon")$n(et,Qt,K,ie,ce,!0);else if(ut==="MultiPolygon")for(const ur of et){const Yr=[];$n(ur,Yr,K,ie,ce,!0),Yr.length&&Qt.push(Yr)}if(Qt.length){if(Re.lineMetrics&&ut==="LineString"){for(const ur of Qt)Ce.push(Kr(ze.id,ut,ur,ze.tags));continue}ut!=="LineString"&&ut!=="MultiLineString"||(Qt.length===1?(ut="LineString",Qt=Qt[0]):ut="MultiLineString"),ut!=="Point"&&ut!=="MultiPoint"||(ut=Qt.length===3?"Point":"MultiPoint"),Ce.push(Kr(ze.id,ut,Qt,ze.tags))}}return Ce.length?Ce:null}function An(ue,Z,K,ie,ce){for(let _e=0;_e<ue.length;_e+=3){const Ie=ue[_e+ce];Ie>=K&&Ie<=ie&&vi(Z,ue[_e],ue[_e+1],ue[_e+2])}}function fi(ue,Z,K,ie,ce,_e,Ie){let Re=Vi(ue);const Ce=ce===0?ii:Ds;let ze,et,ut=ue.start;for(let Yr=0;Yr<ue.length-3;Yr+=3){const Xr=ue[Yr],Rn=ue[Yr+1],Zi=ue[Yr+2],Rs=ue[Yr+3],gs=ue[Yr+4],is=ce===0?Xr:Rn,yi=ce===0?Rs:gs;let Un=!1;Ie&&(ze=Math.sqrt(Math.pow(Xr-Rs,2)+Math.pow(Rn-gs,2))),is<K?yi>K&&(et=Ce(Re,Xr,Rn,Rs,gs,K),Ie&&(Re.start=ut+ze*et)):is>ie?yi<ie&&(et=Ce(Re,Xr,Rn,Rs,gs,ie),Ie&&(Re.start=ut+ze*et)):vi(Re,Xr,Rn,Zi),yi<K&&is>=K&&(et=Ce(Re,Xr,Rn,Rs,gs,K),Un=!0),yi>ie&&is<=ie&&(et=Ce(Re,Xr,Rn,Rs,gs,ie),Un=!0),!_e&&Un&&(Ie&&(Re.end=ut+ze*et),Z.push(Re),Re=Vi(ue)),Ie&&(ut+=ze)}let Ut=ue.length-3;const Xt=ue[Ut],Qt=ue[Ut+1],ur=ce===0?Xt:Qt;ur>=K&&ur<=ie&&vi(Re,Xt,Qt,ue[Ut+2]),Ut=Re.length-3,_e&&Ut>=3&&(Re[Ut]!==Re[0]||Re[Ut+1]!==Re[1])&&vi(Re,Re[0],Re[1],Re[2]),Re.length&&Z.push(Re)}function Vi(ue){const Z=[];return Z.size=ue.size,Z.start=ue.start,Z.end=ue.end,Z}function $n(ue,Z,K,ie,ce,_e){for(const Ie of ue)fi(Ie,Z,K,ie,ce,_e,!1)}function vi(ue,Z,K,ie){ue.push(Z,K,ie)}function ii(ue,Z,K,ie,ce,_e){const Ie=(_e-Z)/(ie-Z);return vi(ue,_e,K+(ce-K)*Ie,1),Ie}function Ds(ue,Z,K,ie,ce,_e){const Ie=(_e-K)/(ce-K);return vi(ue,Z+(ie-Z)*Ie,_e,1),Ie}function Ua(ue,Z){const K=[];for(let ie=0;ie<ue.length;ie++){const ce=ue[ie],_e=ce.type;let Ie;if(_e==="Point"||_e==="MultiPoint"||_e==="LineString")Ie=Us(ce.geometry,Z);else if(_e==="MultiLineString"||_e==="Polygon"){Ie=[];for(const Re of ce.geometry)Ie.push(Us(Re,Z))}else if(_e==="MultiPolygon"){Ie=[];for(const Re of ce.geometry){const Ce=[];for(const ze of Re)Ce.push(Us(ze,Z));Ie.push(Ce)}}K.push(Kr(ce.id,_e,Ie,ce.tags))}return K}function Us(ue,Z){const K=[];K.size=ue.size,ue.start!==void 0&&(K.start=ue.start,K.end=ue.end);for(let ie=0;ie<ue.length;ie+=3)K.push(ue[ie]+Z,ue[ie+1],ue[ie+2]);return K}function Ot(ue,Z){if(ue.transformed)return ue;const K=1<<ue.z,ie=ue.x,ce=ue.y;for(const _e of ue.features){const Ie=_e.geometry,Re=_e.type;if(_e.geometry=[],Re===1)for(let Ce=0;Ce<Ie.length;Ce+=2)_e.geometry.push(Hr(Ie[Ce],Ie[Ce+1],Z,K,ie,ce));else for(let Ce=0;Ce<Ie.length;Ce++){const ze=[];for(let et=0;et<Ie[Ce].length;et+=2)ze.push(Hr(Ie[Ce][et],Ie[Ce][et+1],Z,K,ie,ce));_e.geometry.push(ze)}}return ue.transformed=!0,ue}function Hr(ue,Z,K,ie,ce,_e){return[Math.round(K*(ue*ie-ce)),Math.round(K*(Z*ie-_e))]}function hn(ue,Z,K,ie,ce){const _e=Z===ce.maxZoom?0:ce.tolerance/((1<<Z)*ce.extent),Ie={features:[],numPoints:0,numSimplified:0,numFeatures:ue.length,source:null,x:K,y:ie,z:Z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Re of ue)vn(Ie,Re,_e,ce);return Ie}function vn(ue,Z,K,ie){const ce=Z.geometry,_e=Z.type,Ie=[];if(ue.minX=Math.min(ue.minX,Z.minX),ue.minY=Math.min(ue.minY,Z.minY),ue.maxX=Math.max(ue.maxX,Z.maxX),ue.maxY=Math.max(ue.maxY,Z.maxY),_e==="Point"||_e==="MultiPoint")for(let Re=0;Re<ce.length;Re+=3)Ie.push(ce[Re],ce[Re+1]),ue.numPoints++,ue.numSimplified++;else if(_e==="LineString")ai(Ie,ce,ue,K,!1,!1);else if(_e==="MultiLineString"||_e==="Polygon")for(let Re=0;Re<ce.length;Re++)ai(Ie,ce[Re],ue,K,_e==="Polygon",Re===0);else if(_e==="MultiPolygon")for(let Re=0;Re<ce.length;Re++){const Ce=ce[Re];for(let ze=0;ze<Ce.length;ze++)ai(Ie,Ce[ze],ue,K,!0,ze===0)}if(Ie.length){let Re=Z.tags||null;if(_e==="LineString"&&ie.lineMetrics){Re={};for(const ze in Z.tags)Re[ze]=Z.tags[ze];Re.mapbox_clip_start=ce.start/ce.size,Re.mapbox_clip_end=ce.end/ce.size}const Ce={geometry:Ie,type:_e==="Polygon"||_e==="MultiPolygon"?3:_e==="LineString"||_e==="MultiLineString"?2:1,tags:Re};Z.id!==null&&(Ce.id=Z.id),ue.features.push(Ce)}}function ai(ue,Z,K,ie,ce,_e){const Ie=ie*ie;if(ie>0&&Z.size<(ce?Ie:ie))return void(K.numPoints+=Z.length/3);const Re=[];for(let Ce=0;Ce<Z.length;Ce+=3)(ie===0||Z[Ce+2]>Ie)&&(K.numSimplified++,Re.push(Z[Ce],Z[Ce+1])),K.numPoints++;ce&&function(Ce,ze){let et=0;for(let ut=0,Ut=Ce.length,Xt=Ut-2;ut<Ut;Xt=ut,ut+=2)et+=(Ce[ut]-Ce[Xt])*(Ce[ut+1]+Ce[Xt+1]);if(et>0===ze)for(let ut=0,Ut=Ce.length;ut<Ut/2;ut+=2){const Xt=Ce[ut],Qt=Ce[ut+1];Ce[ut]=Ce[Ut-2-ut],Ce[ut+1]=Ce[Ut-1-ut],Ce[Ut-2-ut]=Xt,Ce[Ut-1-ut]=Qt}}(Re,_e),ue.push(Re)}const At={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class $i{constructor(Z,K){const ie=(K=this.options=function(_e,Ie){for(const Re in Ie)_e[Re]=Ie[Re];return _e}(Object.create(At),K)).debug;if(ie&&console.time("preprocess data"),K.maxZoom<0||K.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(K.promoteId&&K.generateId)throw new Error("promoteId and generateId cannot be used together.");let ce=function(_e,Ie){const Re=[];if(_e.type==="FeatureCollection")for(let Ce=0;Ce<_e.features.length;Ce++)Yn(Re,_e.features[Ce],Ie,Ce);else Yn(Re,_e.type==="Feature"?_e:{geometry:_e},Ie);return Re}(Z,K);this.tiles={},this.tileCoords=[],ie&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",K.indexMaxZoom,K.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ce=function(_e,Ie){const Re=Ie.buffer/Ie.extent;let Ce=_e;const ze=hr(_e,1,-1-Re,Re,0,-1,2,Ie),et=hr(_e,1,1-Re,2+Re,0,-1,2,Ie);return(ze||et)&&(Ce=hr(_e,1,-Re,1+Re,0,-1,2,Ie)||[],ze&&(Ce=Ua(ze,1).concat(Ce)),et&&(Ce=Ce.concat(Ua(et,-1)))),Ce}(ce,K),ce.length&&this.splitTile(ce,0,0,0),ie&&(ce.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Z,K,ie,ce,_e,Ie,Re){const Ce=[Z,K,ie,ce],ze=this.options,et=ze.debug;for(;Ce.length;){ce=Ce.pop(),ie=Ce.pop(),K=Ce.pop(),Z=Ce.pop();const ut=1<<K,Ut=ha(K,ie,ce);let Xt=this.tiles[Ut];if(!Xt&&(et>1&&console.time("creation"),Xt=this.tiles[Ut]=hn(Z,K,ie,ce,ze),this.tileCoords.push({z:K,x:ie,y:ce}),et)){et>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",K,ie,ce,Xt.numFeatures,Xt.numPoints,Xt.numSimplified),console.timeEnd("creation"));const Un=`z${K}`;this.stats[Un]=(this.stats[Un]||0)+1,this.total++}if(Xt.source=Z,_e==null){if(K===ze.indexMaxZoom||Xt.numPoints<=ze.indexMaxPoints)continue}else{if(K===ze.maxZoom||K===_e)continue;if(_e!=null){const Un=_e-K;if(ie!==Ie>>Un||ce!==Re>>Un)continue}}if(Xt.source=null,Z.length===0)continue;et>1&&console.time("clipping");const Qt=.5*ze.buffer/ze.extent,ur=.5-Qt,Yr=.5+Qt,Xr=1+Qt;let Rn=null,Zi=null,Rs=null,gs=null,is=hr(Z,ut,ie-Qt,ie+Yr,0,Xt.minX,Xt.maxX,ze),yi=hr(Z,ut,ie+ur,ie+Xr,0,Xt.minX,Xt.maxX,ze);Z=null,is&&(Rn=hr(is,ut,ce-Qt,ce+Yr,1,Xt.minY,Xt.maxY,ze),Zi=hr(is,ut,ce+ur,ce+Xr,1,Xt.minY,Xt.maxY,ze),is=null),yi&&(Rs=hr(yi,ut,ce-Qt,ce+Yr,1,Xt.minY,Xt.maxY,ze),gs=hr(yi,ut,ce+ur,ce+Xr,1,Xt.minY,Xt.maxY,ze),yi=null),et>1&&console.timeEnd("clipping"),Ce.push(Rn||[],K+1,2*ie,2*ce),Ce.push(Zi||[],K+1,2*ie,2*ce+1),Ce.push(Rs||[],K+1,2*ie+1,2*ce),Ce.push(gs||[],K+1,2*ie+1,2*ce+1)}}getTile(Z,K,ie){Z=+Z,K=+K,ie=+ie;const ce=this.options,{extent:_e,debug:Ie}=ce;if(Z<0||Z>24)return null;const Re=1<<Z,Ce=ha(Z,K=K+Re&Re-1,ie);if(this.tiles[Ce])return Ot(this.tiles[Ce],_e);Ie>1&&console.log("drilling down to z%d-%d-%d",Z,K,ie);let ze,et=Z,ut=K,Ut=ie;for(;!ze&&et>0;)et--,ut>>=1,Ut>>=1,ze=this.tiles[ha(et,ut,Ut)];return ze&&ze.source?(Ie>1&&(console.log("found parent tile z%d-%d-%d",et,ut,Ut),console.time("drilling down")),this.splitTile(ze.source,et,ut,Ut,Z,K,ie),Ie>1&&console.timeEnd("drilling down"),this.tiles[Ce]?Ot(this.tiles[Ce],_e):null):null}}function ha(ue,Z,K){return 32*((1<<ue)*K+Z)+ue}function pt(ue,Z){const K=ue.tileID.canonical;if(!this._geoJSONIndex)return void Z(null,null);const ie=this._geoJSONIndex.getTile(K.z,K.x,K.y);if(!ie)return void Z(null,null);const ce=ze=>ze.tags&&"3d_elevation_id"in ze.tags&&"source"in ze.tags&&ze.tags.source==="elevation",_e=ie.features.filter(ze=>ce(ze));let Ie={_geojsonTileLayer:ie.features};_e.length>0&&(Ie={_geojsonTileLayer:ie.features.filter(ze=>!ce(ze)),hd_road_elevation:_e});const Re=new Qe(Ie),Ce=function(ze){const et=new i.bs;for(const ut of Object.keys(ze))et.writeMessage(3,Ue,{name:ut,features:ze[ut]});return et.finish()}(Ie).buffer;Z(null,{vectorTile:Re,rawData:Ce})}class lt extends ye{constructor(Z,K,ie,ce,_e,Ie,Re){super(Z,K,ie,ce,_e,pt,Re),Ie&&(this.loadGeoJSON=Ie),this._dynamicIndex=new ct}loadData(Z,K){const ie=Z&&Z.request,ce=ie&&ie.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(Z,(_e,Ie)=>{if(_e||!Ie)return K(_e);if(typeof Ie!="object")return K(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));{try{if(Z.filter){const Ce=i.U(Z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ce.result==="error")throw new Error(Ce.value.map(ze=>`${ze.key}: ${ze.message}`).join(", "));Ie.features=Ie.features.filter(ze=>Ce.value.evaluate({zoom:0},ze))}Z.dynamic?(Ie.type==="Feature"&&(Ie={type:"FeatureCollection",features:[Ie]}),Z.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ie.features,this.loaded),Z.cluster&&(Ie.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=Z.cluster?new Nn(function({superclusterOptions:Ce,clusterProperties:ze}){if(!ze||!Ce)return Ce;const et={},ut={},Ut={accumulated:null,zoom:0},Xt={properties:null},Qt=Object.keys(ze);for(const ur of Qt){const[Yr,Xr]=ze[ur],Rn=i.U(Xr),Zi=i.U(typeof Yr=="string"?[Yr,["accumulated"],["get",ur]]:Yr);et[ur]=Rn.value,ut[ur]=Zi.value}return Ce.map=ur=>{Xt.properties=ur;const Yr={};for(const Xr of Qt)Yr[Xr]=et[Xr].evaluate(Ut,Xt);return Yr},Ce.reduce=(ur,Yr)=>{Xt.properties=Yr;for(const Xr of Qt)Ut.accumulated=ur[Xr],ur[Xr]=ut[Xr].evaluate(Ut,Xt)},Ce}(Z)).load(Ie.features):Z.dynamic?this._dynamicIndex:function(Ce,ze){return new $i(Ce,ze)}(Ie,Z.geojsonVtOptions)}catch(Ce){return K(Ce)}const Re={};if(ce){const Ce=S(ie);Ce&&(Re.resourceTiming={},Re.resourceTiming[Z.source]=JSON.parse(JSON.stringify(Ce)))}K(null,Re)}})}reloadTile(Z,K){const ie=this.loaded;return ie&&ie[Z.uid]?Z.partial?K(null,void 0):super.reloadTile(Z,K):this.loadTile(Z,K)}loadGeoJSON(Z,K){if(Z.request)i.m(Z.request,K);else{if(typeof Z.data!="string")return K(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return K(null,JSON.parse(Z.data))}catch{return K(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(Z,K){try{K(null,this._geoJSONIndex.getClusterExpansionZoom(Z.clusterId))}catch(ie){K(ie)}}getClusterChildren(Z,K){try{K(null,this._geoJSONIndex.getChildren(Z.clusterId))}catch(ie){K(ie)}}getClusterLeaves(Z,K){try{K(null,this._geoJSONIndex.getLeaves(Z.clusterId,Z.limit,Z.offset))}catch(ie){K(ie)}}}class Er{constructor(Z,K,ie){this.tileID=new i.aP(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.tileZoom=Z.tileZoom,this.uid=Z.uid,this.zoom=Z.zoom,this.canonical=Z.tileID.canonical,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Z.projection,this.brightness=K,this.worldview=ie}parse(Z,K,ie,ce){this.status="parsing";const _e=new i.aP(ie.tileID.overscaledZ,ie.tileID.wrap,ie.tileID.canonical.z,ie.tileID.canonical.x,ie.tileID.canonical.y),Ie=[],Re=K.familiesBySource[ie.source],Ce=new i.fm(_e,ie.promoteId);Ce.bucketLayerIDs=[],Ce.is3DTile=!0,i.fB(Z).then(ze=>{if(!ze)return ce(new Error("Could not parse tile"));const et=ze.json.extensionsUsed&&ze.json.extensionsUsed.includes("MAPBOX_mesh_features")||ze.json.asset.extras&&ze.json.asset.extras.MAPBOX_mesh_features,ut=ze.json.extensionsUsed&&ze.json.extensionsUsed.includes("EXT_meshopt_compression"),Ut=new i.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Xt in Re)for(const Qt of Re[Xt]){const ur=Qt[0];Ce.bucketLayerIDs.push(Qt.map(Rn=>i.B(Rn.id,Rn.scope))),ur.recalculate(Ut,[]);const Yr=i.fC(ze,1/i.d6(ie.tileID.canonical)),Xr=new i.fD(Qt,Yr,_e,et,ut,this.brightness,Ce,this.worldview);et||(Xr.needsUpload=!0),Ie.push(Xr),Xr.evaluate(ur)}this.status="done",ce(null,{buckets:Ie,featureIndex:Ce,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(ze=>ce(new Error(ze.message)))}}class Jr{constructor(Z,K,ie,ce,_e,Ie,Re,Ce){this.actor=Z,this.layerIndex=K,this.availableImages=ie,this.availableModels=ce,this.brightness=Re,this.loading={},this.loaded={},this.worldview=Ce}loadTile(Z,K){const ie=Z.uid,ce=this.loading[ie]=new Er(Z,this.brightness,this.worldview);i.bt(Z.request,(_e,Ie)=>{const Re=!this.loading[ie];return delete this.loading[ie],Re||_e?(ce.status="done",Re||(this.loaded[ie]=ce),K(_e)):Ie&&Ie.byteLength!==0?void ce.parse(Ie,this.layerIndex,Z,(Ce,ze)=>{ce.status="done",this.loaded=this.loaded||{},this.loaded[ie]=ce,Ce||!ze?K(Ce):K(null,ze)}):(ce.status="done",this.loaded[ie]=ce,K())})}reloadTile(Z,K){const ie=this.loaded,ce=Z.uid;if(ie&&ie[ce]){const _e=ie[ce];_e.projection=Z.projection,_e.brightness=Z.brightness;const Ie=(Re,Ce)=>{_e.reloadCallback&&(delete _e.reloadCallback,this.loadTile(Z,K)),K(Re,Ce)};_e.status==="parsing"?_e.reloadCallback=Ie:_e.status==="done"&&this.loadTile(Z,K)}}abortTile(Z,K){const ie=Z.uid;this.loading[ie]&&delete this.loading[ie],K()}removeTile(Z,K){const ie=this.loaded,ce=Z.uid;ie&&ie[ce]&&delete ie[ce],K()}}class Ae{constructor(Z){this.self=Z,this.actor=new i.fF(Z,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new i.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=i.cl({name:"mercator"}),this.workerSourceTypes={vector:ye,geojson:lt,"raster-dem":pe,"raster-array":ke,"batched-model":Jr},this.workerSources={},this.self.registerWorkerSource=(K,ie)=>{if(this.workerSourceTypes[K])throw new Error(`Worker source with name "${K}" already registered.`);this.workerSourceTypes[K]=ie},this.self.registerRTLTextPlugin=K=>{if(i.fG.isParsed())throw new Error("RTL text plugin already registered.");i.fG.setState({pluginStatus:i.fH.parsed,pluginURL:i.fG.getPluginURL()}),i.fG.applyArabicShaping=K.applyArabicShaping,i.fG.processBidirectionalText=K.processBidirectionalText,i.fG.processStyledBidirectionalText=K.processStyledBidirectionalText;for(const ie of this.rtlPluginParsingListeners)ie(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(Z,K,ie){delete this.layerIndexes[Z],delete this.availableImages[Z],delete this.availableModels[Z],delete this.workerSources[Z],ie()}checkIfReady(Z,K,ie){ie()}setReferrer(Z,K){this.referrer=K}spriteLoaded(Z,K){this.isSpriteLoaded[Z]||(this.isSpriteLoaded[Z]={});const{scope:ie,isLoaded:ce}=K;if(this.isSpriteLoaded[Z][ie]=ce,this.workerSources[Z]&&this.workerSources[Z][ie])for(const _e in this.workerSources[Z][ie]){const Ie=this.workerSources[Z][ie][_e];for(const Re in Ie){const Ce=Ie[Re];Ce instanceof ye&&(Ce.isSpriteLoaded=ce,Ce.fire(new i.z("isSpriteLoaded")))}}}setImages(Z,K,ie){this.availableImages[Z]||(this.availableImages[Z]={});const{scope:ce,images:_e}=K;if(this.availableImages[Z][ce]=_e,this.workerSources[Z]&&this.workerSources[Z][ce]){for(const Ie in this.workerSources[Z][ce]){const Re=this.workerSources[Z][ce][Ie];for(const Ce in Re)Re[Ce].availableImages=_e}ie()}else ie()}setModels(Z,{scope:K,models:ie},ce){if(this.availableModels[Z]||(this.availableModels[Z]={}),this.availableModels[Z][K]=ie,this.workerSources[Z]&&this.workerSources[Z][K]){for(const _e in this.workerSources[Z][K]){const Ie=this.workerSources[Z][K][_e];for(const Re in Ie)Ie[Re].availableModels=ie}ce()}else ce()}setProjection(Z,K){this.projections[Z]=i.cl(K)}setBrightness(Z,K,ie){this.brightness=K,ie()}setWorldview(Z,K,ie){this.worldview=K,ie()}setLayers(Z,K,ie){this.getLayerIndex(Z,K.scope).replace(K.layers,K.options),ie()}updateLayers(Z,K,ie){this.getLayerIndex(Z,K.scope).update(K.layers,K.removedIds,K.options),ie()}loadTile(Z,K,ie){K.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,K.type,K.source,K.scope).loadTile(K,ie)}decodeRasterArray(Z,K,ie){this.getWorkerSource(Z,K.type,K.source,K.scope).decodeRasterArray(K,ie)}reloadTile(Z,K,ie){K.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,K.type,K.source,K.scope).reloadTile(K,ie)}abortTile(Z,K,ie){this.getWorkerSource(Z,K.type,K.source,K.scope).abortTile(K,ie)}removeTile(Z,K,ie){this.getWorkerSource(Z,K.type,K.source,K.scope).removeTile(K,ie)}removeSource(Z,K,ie){if(!(this.workerSources[Z]&&this.workerSources[Z][K.scope]&&this.workerSources[Z][K.scope][K.type]&&this.workerSources[Z][K.scope][K.type][K.source]))return;const ce=this.workerSources[Z][K.scope][K.type][K.source];delete this.workerSources[Z][K.scope][K.type][K.source],ce.removeSource!==void 0?ce.removeSource(K,ie):ie()}loadWorkerSource(Z,K,ie){try{this.self.importScripts(K.url),ie()}catch(ce){ie(ce.toString())}}syncRTLPluginState(Z,K,ie){if(i.fG.isParsed())ie(null,!0);else if(i.fG.isParsing())this.rtlPluginParsingListeners.push(ie);else try{i.fG.setState(K);const ce=i.fG.getPluginURL();!i.fG.isLoaded()||i.fG.isParsed()||i.fG.isParsing()||ce==null||(i.fG.setState({pluginStatus:i.fH.parsing,pluginURL:i.fG.getPluginURL()}),this.self.importScripts(ce),i.fG.isParsed()?ie(null,!0):this.rtlPluginParsingListeners.push(ie))}catch(ce){ie(ce.toString())}}setDracoUrl(Z,K){this.dracoUrl=K}getAvailableImages(Z,K){this.availableImages[Z]||(this.availableImages[Z]={});let ie=this.availableImages[Z][K];return ie||(ie=[]),ie}getAvailableModels(Z,K){this.availableModels[Z]||(this.availableModels[Z]={});let ie=this.availableModels[Z][K];return ie||(ie={}),ie}getLayerIndex(Z,K){this.layerIndexes[Z]||(this.layerIndexes[Z]={});let ie=this.layerIndexes[Z][K];return ie||(ie=this.layerIndexes[Z][K]=new D,ie.scope=K),ie}getWorkerSource(Z,K,ie,ce){const _e=this.workerSources;return _e[Z]||(_e[Z]={}),_e[Z][ce]||(_e[Z][ce]={}),_e[Z][ce][K]||(_e[Z][ce][K]={}),this.isSpriteLoaded[Z]||(this.isSpriteLoaded[Z]={}),_e[Z][ce][K][ie]||(_e[Z][ce][K][ie]=new this.workerSourceTypes[K]({send:(Ie,Re,Ce,ze,et,ut)=>this.actor.send(Ie,Re,Ce,Z,et,ut),scheduler:this.actor.scheduler},this.getLayerIndex(Z,ce),this.getAvailableImages(Z,ce),this.getAvailableModels(Z,ce),this.isSpriteLoaded[Z][ce],void 0,this.brightness,this.worldview)),_e[Z][ce][K][ie]}rasterizeImagesWorker(Z,K,ie){const ce=new Map;for(const[_e,{image:Ie,imageVariant:Re}]of K.tasks.entries()){const Ce=this.imageRasterizer.rasterize(Re,Ie,K.scope,Z);ce.set(_e,Ce)}ie(void 0,ce)}removeRasterizedImages(Z,K,ie){this.imageRasterizer.removeImagesFromCacheByIds(K.imageIds,K.scope,Z),ie()}enforceCacheSizeLimit(Z,K){i.fI(K)}getWorkerPerformanceMetrics(Z,K,ie){ie(void 0,void 0)}}return i.fE(self)&&(self.worker=new Ae(self)),Ae}),f(["./shared"],function(i){var S="3.16.0";const E={create:"create",load:"load",fullLoad:"fullLoad"},I={mark(g){performance.mark(g)},measure(g,a,d){performance.measure(g,a,d)}};function D(g){const a=g.name.split("?")[0];return i.a(a)&&a.includes("mapbox-gl.js")?"javascript":i.a(a)&&a.includes("mapbox-gl.css")?"css":i.b(a)?"fontRange":i.c(a)?"sprite":i.i(a)?"style":i.d(a)?"tilejson":"other"}var M,R={},H=function(){if(M)return R;function g(_){return!a(_)}function a(_){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var b,T,j=new Blob([""],{type:"text/javascript"}),N=URL.createObjectURL(j);try{T=new Worker(N),b=!0}catch{b=!1}return T&&T.terminate(),URL.revokeObjectURL(N),b}()?function(){var b=document.createElement("canvas");b.width=b.height=1;var T=b.getContext("2d");if(!T)return!1;var j=T.getImageData(0,0,1,1);return j&&j.width===b.width}()?(d[y=_&&_.failIfMajorPerformanceCaveat]===void 0&&(d[y]=function(b){var T,j=function(N){var L=document.createElement("canvas"),B=Object.create(g.webGLContextAttributes);return B.failIfMajorPerformanceCaveat=N,L.getContext("webgl2",B)}(b);if(!j)return!1;try{T=j.createShader(j.VERTEX_SHADER)}catch{return!1}return!(!T||j.isContextLost())&&(j.shaderSource(T,"void main() {}"),j.compileShader(T),j.getShaderParameter(T,j.COMPILE_STATUS)===!0)}(y)),d[y]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var y}M=1,R.supported=g,R.notSupportedReason=a;var d={};return g.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},R}();function F(g,a,d){const _=document.createElement(g);return a!=null&&(_.className=a),d&&d.appendChild(_),_}function U(g,a,d){const _=document.createElementNS("http://www.w3.org/2000/svg",g);for(const y of Object.keys(a))_.setAttributeNS(null,y,String(a[y]));return d&&d.appendChild(_),_}const Y=typeof document<"u"?document.documentElement&&document.documentElement.style:null,z=Y&&Y.userSelect!==void 0?"userSelect":"WebkitUserSelect";let J;function ne(){Y&&z&&(J=Y[z],Y[z]="none")}function me(){Y&&z&&(Y[z]=J)}function le(g){g.preventDefault(),g.stopPropagation(),window.removeEventListener("click",le,!0)}function ye(){window.addEventListener("click",le,!0),window.setTimeout(()=>{window.removeEventListener("click",le,!0)},0)}function pe(g,a){const d=g.getBoundingClientRect();return Oe(g,d,a)}function be(g,a){const d=g.getBoundingClientRect(),_=[];for(let y=0;y<a.length;y++)_.push(Oe(g,d,a[y]));return _}function ke(g){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&g.button===2&&g.ctrlKey?0:g.button}function Oe(g,a,d){const _=g.offsetWidth===a.width?1:g.offsetWidth/a.width;return new i.P((d.clientX-a.left)*_,(d.clientY-a.top)*_)}const Ee="01",qe="NO_ACCESS_TOKEN";class Qe{constructor(a,d,_){this._transformRequestFn=a,this._customAccessToken=d,this._silenceAuthErrors=!!_,this._createSkuToken()}_createSkuToken(){const a=function(){let d="";for(let _=0;_<10;_++)d+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ee,d].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(a,d){return this._transformRequestFn&&this._transformRequestFn(a,d)||{url:a}}normalizeStyleURL(a,d){if(!i.h(a))return a;const _=Xe(a);return _.params.push(`sdk=js-${S}`),_.path=`/styles/v1${_.path}`,this._makeAPIURL(_,this._customAccessToken||d)}normalizeGlyphsURL(a,d){if(!i.h(a))return a;const _=Xe(a);return _.path=`/fonts/v1${_.path}`,this._makeAPIURL(_,this._customAccessToken||d)}normalizeModelURL(a,d){if(!i.h(a))return a;const _=Xe(a);return _.path=`/models/v1${_.path}`,this._makeAPIURL(_,this._customAccessToken||d)}normalizeSourceURL(a,d,_,y){if(!i.h(a))return a;const b=Xe(a);return b.path=`/v4/${b.authority}.json`,b.params.push("secure"),_&&b.params.push(`language=${_}`),y&&b.params.push(`worldview=${y}`),this._makeAPIURL(b,this._customAccessToken||d)}normalizeIconsetURL(a,d){const _=Xe(a);return i.h(a)?(_.path=`/styles/v1${_.path}/iconset.pbf`,this._makeAPIURL(_,this._customAccessToken||d)):ct(_)}normalizeSpriteURL(a,d,_,y){const b=Xe(a);return i.h(a)?(b.path=`/styles/v1${b.path}/sprite${d}${_}`,this._makeAPIURL(b,this._customAccessToken||y)):(b.path+=`${d}${_}`,ct(b))}normalizeTileURL(a,d,_){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!i.h(a))return a;const y=Xe(a);y.path=y.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${d||_&&y.authority!=="raster"&&_===512?"@2x":""}${i.k.supported?".webp":"$1"}`),y.authority==="raster"?y.path=`/${i.e.RASTER_URL_PREFIX}${y.path}`:y.authority==="rasterarrays"?y.path=`/${i.e.RASTERARRAYS_URL_PREFIX}${y.path}`:y.authority==="3dtiles"?y.path=`/${i.e.TILES3D_URL_PREFIX}${y.path}`:(y.path=y.path.replace(/^.+\/v4\//,"/"),y.path=`/${i.e.TILE_URL_VERSION}${y.path}`);const b=this._customAccessToken||function(T){for(const j of T){const N=j.match(/^access_token=(.*)$/);if(N)return N[1]}return null}(y.params)||i.e.ACCESS_TOKEN;return i.e.REQUIRE_ACCESS_TOKEN&&b&&this._skuToken&&y.params.push(`sku=${this._skuToken}`),this._makeAPIURL(y,b)}canonicalizeTileURL(a,d){const _=Xe(a);if(!_.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!_.path.match(/\.[\w]+$/))return a;let y="mapbox://";_.path.match(/^\/raster\/v1\//)?y+=`raster/${_.path.replace(`/${i.e.RASTER_URL_PREFIX}/`,"")}`:_.path.match(/^\/rasterarrays\/v1\//)?y+=`rasterarrays/${_.path.replace(`/${i.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:y+=`tiles/${_.path.replace(`/${i.e.TILE_URL_VERSION}/`,"")}`;let b=_.params;return d&&(b=b.filter(T=>!T.match(/^access_token=/))),b.length&&(y+=`?${b.join("&")}`),y}canonicalizeTileset(a,d){const _=!!d&&i.h(d),y=[];for(const b of a.tiles||[])i.j(b)?y.push(this.canonicalizeTileURL(b,_)):y.push(b);return y}_makeAPIURL(a,d){const _="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",y=Xe(i.e.API_URL);if(a.protocol=y.protocol,a.authority=y.authority,a.protocol==="http"){const b=a.params.indexOf("secure");b>=0&&a.params.splice(b,1)}if(y.path!=="/"&&(a.path=`${y.path}${a.path}`),!i.e.REQUIRE_ACCESS_TOKEN)return ct(a);if(d=d||i.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!d)throw new Error(`An API access token is required to use Mapbox GL. ${_}`);if(d[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${_}`)}return a.params=a.params.filter(b=>b.indexOf("access_token")===-1),a.params.push(`access_token=${d||""}`),ct(a)}}const gt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Xe(g){const a=g.match(gt);if(!a)throw new Error("Unable to parse URL object");return{protocol:a[1],authority:a[2],path:a[3]||"/",params:a[4]?a[4].split("&"):[]}}function ct(g){const a=g.params.length?`?${g.params.join("&")}`:"";return`${g.protocol}://${g.authority}${g.path}${a}`}const Me="mapbox.eventData";function mt(g){if(!g)return null;const a=g.split(".");if(!a||a.length!==3)return null;try{return JSON.parse(i.l(a[1]))}catch{return null}}class Kt{constructor(a){this.type=a,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(a){const d=mt(i.e.ACCESS_TOKEN);let _="";return _=d&&d.u?i.f(d.u):i.e.ACCESS_TOKEN||"",a?`${Me}.${a}:${_}`:`${Me}:${_}`}fetchEventData(){const a=i.s("localStorage"),d=this.getStorageKey(),_=this.getStorageKey("uuid"),y=this.getStorageKey("uuidTimestamp");if(a)try{const b=localStorage.getItem(d);b&&(this.eventData=JSON.parse(b));const T=localStorage.getItem(_);T&&(this.anonId=T);const j=localStorage.getItem(y);j&&(this.anonIdTimestamp=Number(j));const N=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<N)&&this.refreshUUID()}catch{i.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=i.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const a=i.s("localStorage"),d=this.getStorageKey(),_=this.getStorageKey("uuid"),y=this.getStorageKey("uuidTimestamp"),b=this.anonId,T=this.anonIdTimestamp;if(a&&b)try{localStorage.setItem(_,b),Object.keys(this.eventData).length>=1&&localStorage.setItem(d,JSON.stringify(this.eventData)),T&&localStorage.setItem(y,T.toString())}catch{i.w("Unable to write to LocalStorage")}}processRequests(a){}postEvent(a,d,_,y){if(!i.e.EVENTS_URL)return;const b=Xe(i.e.EVENTS_URL);b.params.push(`access_token=${y||i.e.ACCESS_TOKEN||""}`);const T={event:this.type,created:new Date(a).toISOString()},j=d?Object.assign(T,d):T,N={url:ct(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([j])};this.pendingRequest=i.p(N,L=>{this.pendingRequest=null,_(L),this.saveEventData(),this.processRequests(y)})}queueRequest(a,d){this.queue.push(a),this.processRequests(d)}}const it=new class extends Kt{constructor(g){super("appUserTurnstile"),this._customAccessToken=g}postTurnstileEvent(g,a){i.e.EVENTS_URL&&i.e.ACCESS_TOKEN&&Array.isArray(g)&&g.some(d=>i.h(d)||i.j(d))&&this.queueRequest(Date.now(),a)}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const a=mt(i.e.ACCESS_TOKEN),d=a?a.u:i.e.ACCESS_TOKEN;let _=d!==this.eventData.tokenU;i.v(this.anonId)||(this.refreshUUID(),_=!0);const y=this.queue.shift();if(this.eventData.lastSuccess){const b=new Date(this.eventData.lastSuccess),T=new Date(y),j=(y-this.eventData.lastSuccess)/864e5;_=_||j>=1||j<-1||b.getDate()!==T.getDate()}else _=!0;_?this.postEvent(y,{sdkIdentifier:"mapbox-gl-js",sdkVersion:S,skuId:Ee,"enabled.telemetry":!1,userId:this.anonId},b=>{b||(this.eventData.lastSuccess=y,this.eventData.tokenU=d)},g):this.processRequests()}},ee=it.postTurnstileEvent.bind(it),he=new class extends Kt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(g,a,d,_){this.skuToken=a,this.errorCb=_,i.e.EVENTS_URL&&(d||i.e.ACCESS_TOKEN?this.queueRequest({id:g,timestamp:Date.now()},d):this.errorCb(new Error(qe)))}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{id:a,timestamp:d}=this.queue.shift();a&&this.success[a]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),i.v(this.anonId)||this.refreshUUID(),this.postEvent(d,{sdkIdentifier:"mapbox-gl-js",sdkVersion:S,skuId:Ee,skuToken:this.skuToken,userId:this.anonId},_=>{_?this.errorCb(_):a&&(this.success[a]=!0)},g))}remove(){this.errorCb=null}},Se=he.postMapLoadEvent.bind(he),Ue=new class extends Kt{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(g){let a=this.mapInstanceIdMap.get(g);return a||(a=i.u(),this.mapInstanceIdMap.set(g,a)),a}getEventId(g){const a=this.eventIdPerMapInstanceMap.get(g)||0;return this.eventIdPerMapInstanceMap.set(g,a+1),a}postStyleLoadEvent(g,a){const{map:d,style:_,importedStyles:y}=a;if(!i.e.EVENTS_URL||!g&&!i.e.ACCESS_TOKEN)return;const b=this.getMapInstanceId(d),T={mapInstanceId:b,eventId:this.getEventId(b),style:_};y.length&&(T.importedStyles=y),this.queueRequest({timestamp:Date.now(),payload:T},g)}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:a,payload:d}=this.queue.shift();this.postEvent(a,d,()=>{},g)}},nt=Ue.postStyleLoadEvent.bind(Ue),dt=new class extends Kt{constructor(g){super("metrics"),g&&(this.data=g)}postMetricsEvent(g){if(!i.e.EVENTS_URL||!g&&!i.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),i.v(this.anonId)||this.refreshUUID();const a=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:a},g)}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:a,payload:d}=this.queue.shift();this.postEvent(a,d,()=>{},g)}}({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),Vt=dt.postMetricsEvent.bind(dt),zt=new class extends Kt{constructor(){super("gljs.performance")}postPerformanceEvent(g,a){i.e.EVENTS_URL&&(g||i.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:a},g)}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:a,performanceData:d}=this.queue.shift(),_=function(y){const b=performance.getEntriesByType("resource"),T=performance.getEntriesByType("mark"),j=function(Q){const re={};if(Q){for(const ae in Q)if(ae!=="other")for(const fe of Q[ae]){const de=`${ae}ResolveRangeMin`,xe=`${ae}ResolveRangeMax`,je=`${ae}RequestCount`,we=`${ae}RequestCachedCount`;re[de]=Math.min(re[de]||1/0,fe.startTime),re[xe]=Math.max(re[xe]||-1/0,fe.responseEnd);const Ve=Ne=>{re[Ne]===void 0&&(re[Ne]=0),++re[Ne]};fe.transferSize!==void 0&&fe.transferSize===0&&Ve(we),Ve(je)}}return re}(function(Q,re){const ae={};if(Q)for(const fe of Q){const de=re(fe);ae[de]===void 0&&(ae[de]=[]),ae[de].push(fe)}return ae}(b,D)),N=window.devicePixelRatio,L=navigator.connection||navigator.mozConnection||navigator.webkitConnection,B=L?L.effectiveType:void 0,X={counters:[],metadata:[],attributes:[]},q=(Q,re,ae)=>{ae!=null&&Q.push({name:re,value:ae.toString()})};for(const Q in j)q(X.counters,Q,j[Q]);if(y.interactionRange[0]!==1/0&&y.interactionRange[1]!==-1/0&&(q(X.counters,"interactionRangeMin",y.interactionRange[0]),q(X.counters,"interactionRangeMax",y.interactionRange[1])),T)for(const Q of Object.values(E)){const re=T.find(ae=>ae.name===Q);re&&q(X.counters,Q,re.startTime)}return q(X.counters,"visibilityHidden",y.visibilityHidden),q(X.attributes,"style",function(Q){if(Q)for(const re of Q){const ae=re.name.split("?")[0];if(i.i(ae)){const fe=ae.split("/").slice(-2);if(fe.length===2)return`mapbox://styles/${fe[0]}/${fe[1]}`}}}(b)),q(X.attributes,"terrainEnabled",y.terrainEnabled?"true":"false"),q(X.attributes,"fogEnabled",y.fogEnabled?"true":"false"),q(X.attributes,"projection",y.projection),q(X.attributes,"zoom",y.zoom),q(X.metadata,"devicePixelRatio",N),q(X.metadata,"connectionEffectiveType",B),q(X.metadata,"navigatorUserAgent",navigator.userAgent),q(X.metadata,"screenWidth",window.screen.width),q(X.metadata,"screenHeight",window.screen.height),q(X.metadata,"windowWidth",window.innerWidth),q(X.metadata,"windowHeight",window.innerHeight),q(X.metadata,"mapWidth",y.width/N),q(X.metadata,"mapHeight",y.height/N),q(X.metadata,"webglRenderer",y.renderer),q(X.metadata,"webglVendor",y.vendor),q(X.metadata,"sdkVersion",S),q(X.metadata,"sdkIdentifier","mapbox-gl-js"),X}(d);for(const y of _.metadata);for(const y of _.counters);for(const y of _.attributes);this.postEvent(a,_,()=>{},g)}},Gt=zt.postPerformanceEvent.bind(zt),jr=new class extends Kt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(g,a,d,_){if(!i.e.API_URL||!i.e.SESSION_PATH)return;const y=Xe(i.e.API_URL+i.e.SESSION_PATH);y.params.push(`sku=${a||""}`),y.params.push(`access_token=${_||i.e.ACCESS_TOKEN||""}`);const b={url:ct(y),headers:{"Content-Type":"text/plain"}};this.pendingRequest=i.g(b,T=>{this.pendingRequest=null,d(T),this.saveEventData(),this.processRequests(_)})}getSessionAPI(g,a,d,_){this.skuToken=a,this.errorCb=_,i.e.SESSION_PATH&&i.e.API_URL&&(d||i.e.ACCESS_TOKEN?this.queueRequest({id:g,timestamp:Date.now()},d):this.errorCb(new Error(qe)))}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{id:a,timestamp:d}=this.queue.shift();a&&this.success[a]||this.getSession(d,this.skuToken,_=>{_?this.errorCb(_):a&&(this.success[a]=!0)},g)}remove(){this.errorCb=null}},Wr=jr.getSessionAPI.bind(jr),nn=new Set;function xn(g,a){a?nn.add(g):nn.delete(g)}class ei{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(a,d){this._updatedSourceCaches[a]=d,this.setDirty()}discardSourceCacheUpdate(a){delete this._updatedSourceCaches[a]}updateLayer(a){const d=a.scope;this._updatedLayers[d]=this._updatedLayers[d]||new Set,this._updatedLayers[d].add(a.id),this.setDirty()}removeLayer(a){const d=a.scope;this._removedLayers[d]=this._removedLayers[d]||{},this._updatedLayers[d]=this._updatedLayers[d]||new Set,this._removedLayers[d][a.id]=a,this._updatedLayers[d].delete(a.id),this._updatedPaintProps.delete(a.fqid),this.setDirty()}getRemovedLayer(a){return this._removedLayers[a.scope]?this._removedLayers[a.scope][a.id]:null}discardLayerRemoval(a){this._removedLayers[a.scope]&&delete this._removedLayers[a.scope][a.id]}getLayerUpdatesByScope(){const a={};for(const d in this._updatedLayers)a[d]=a[d]||{},a[d].updatedIds=Array.from(this._updatedLayers[d].values());for(const d in this._removedLayers)a[d]=a[d]||{},a[d].removedIds=Object.keys(this._removedLayers[d]);return a}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(a){this._updatedPaintProps.add(a.fqid),this.setDirty()}getUpdatedImages(a){return this._updatedImages[a]?Array.from(this._updatedImages[a].values()):[]}updateImage(a,d){this._updatedImages[d]=this._updatedImages[d]||new Set,this._updatedImages[d].add(i.I.toString(a)),this.setDirty()}resetUpdatedImages(a){this._updatedImages[a]&&this._updatedImages[a].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Dn(g){const{userImage:a}=g;return!!(a&&a.render&&a.render())&&(g.data.replace(new Uint8Array(a.data.buffer)),!0)}class Zr extends i.E{constructor(a){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=a,a!=="raster"&&i.r()&&(this.imageRasterizerDispatcher=new i.D(i.t(),this,"Image Rasterizer Worker",1))}addScope(a){this.loaded.set(a,!1),this.imageProviders.set(a,new Map),this.images.set(a,new Map),this.updatedImages.set(a,new Set),this.callbackDispatchedThisFrame.set(a,new Set),this.patterns.set(a,new Map),this.atlasImage.set(a,new i.q({width:1,height:1}))}removeScope(a){this.loaded.delete(a),this.imageProviders.delete(a),this.images.delete(a),this.updatedImages.delete(a),this.callbackDispatchedThisFrame.delete(a),this.patterns.delete(a),this.atlasImage.delete(a);const d=this.atlasTexture.get(a);d&&(d.destroy(),this.atlasTexture.delete(a))}addImageProvider(a,d){this.imageProviders.has(d)||this.imageProviders.set(d,new Map),this.imageProviders.get(d).set(a.id,a)}removeImageProvider(a,d){this.imageProviders.has(d)&&this.imageProviders.get(d).delete(a)}getPendingImageProviders(){const a=[];for(const d of this.imageProviders.values())for(const _ of d.values())_.hasPendingRequests()&&a.push(_);return a}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new i.x),this._imageRasterizer}isLoaded(){for(const a of this.loaded.keys())if(!this.loaded.get(a))return!1;return!0}setLoaded(a,d){if(this.loaded.get(d)!==a&&(this.loaded.set(d,a),a)){for(const{ids:_,callback:y}of this.requestors)this._notify(_,d,y);this.requestors=[]}}hasImage(a,d){return!!this.getImage(a,d)}getImage(a,d){return this.images.get(d).get(a.toString())}addImage(a,d,_){this._validate(a,_)&&this.images.get(d).set(a.toString(),_)}_validate(a,d){let _=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new i.y(new Error(`Image "${a.name}" has invalid "stretchX" value`))),_=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new i.y(new Error(`Image "${a.name}" has invalid "stretchY" value`))),_=!1),this._validateContent(d.content,d)||(this.fire(new i.y(new Error(`Image "${a.name}" has invalid "content" value`))),_=!1),_}_validateStretch(a,d){if(!a)return!0;let _=0;for(const y of a){if(y[0]<_||y[1]<y[0]||d<y[1])return!1;_=y[1]}return!0}_validateContent(a,d){return a?a.length!==4||!d.usvg&&(a[0]<0||d.data.width<a[0]||a[1]<0||d.data.height<a[1]||a[2]<0||d.data.width<a[2]||a[3]<0||d.data.height<a[3])?!1:!(a[2]<a[0]||a[3]<a[1]):!0}updateImage(a,d,_){const y=this.images.get(d).get(a.toString());_.version=y.version+1,this.images.get(d).set(a.toString(),_),this.updatedImages.get(d).add(a),this.removeFromImageRasterizerCache(a,d)}clearUpdatedImages(a){this.updatedImages.get(a).clear()}removeFromImageRasterizerCache(a,d){this.spriteFormat!=="raster"&&(i.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[a],scope:d}):this.imageRasterizer.removeImagesFromCacheByIds([a],d))}removeImage(a,d){const _=this.images.get(d),y=_.get(a.toString());_.delete(a.toString()),this.patterns.get(d).delete(a.toString()),this.removeFromImageRasterizerCache(a,d),y.userImage&&y.userImage.onRemove&&y.userImage.onRemove()}listImages(a){return Array.from(this.images.get(a).keys()).map(d=>i.I.from(d))}getImages(a,d,_){const y=[],b=[],T=this.imageProviders.get(d);for(const B of a){if(!B.iconsetId){y.push(B);continue}const X=T.get(B.iconsetId);X&&(this.getImage(B,d)?b.push(B):X.addPendingRequest(B))}if(y.length===0)return void this._notify(b,d,_);let j=!0;const N=!!this.loaded.get(d),L=this.images.get(d);if(!N)for(const B of y)L.has(B.toString())||(j=!1);N||j?this._notify(y,d,_):this.requestors.push({ids:y,scope:d,callback:_})}rasterizeImages(a,d){const _=new Map,{tasks:y,scope:b}=a;for(const[T,j]of y.entries()){const N=this.getImage(j.id,b);N&&_.set(T,{image:N,imageVariant:j})}this._rasterizeImages(b,_,d)}_rasterizeImages(a,d,_){if(i.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:d,scope:a},_);else{const y=new Map;for(const[b,{image:T,imageVariant:j}]of d.entries())y.set(b,this.imageRasterizer.rasterize(j,T,a,0));_(void 0,y)}}getUpdatedImages(a){return this.updatedImages.get(a)||new Set}_notify(a,d,_){const y=this.images.get(d),b=new Map;for(const T of a){if(!y.get(T.toString())){if(T.iconsetId)continue;this.fire(new i.z("styleimagemissing",{id:T.name}))}const j=y.get(T.toString());if(!j){i.w(`Image "${T.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const N={data:j.usvg?null:j.data.clone(),pixelRatio:j.pixelRatio,sdf:j.sdf,usvg:j.usvg,version:j.version,stretchX:j.stretchX,stretchY:j.stretchY,content:j.content,hasRenderCallback:!!(j.userImage&&j.userImage.render)};j.usvg&&Object.assign(N,{width:j.icon.usvg_tree.width,height:j.icon.usvg_tree.height}),b.set(i.I.toString(T),N)}_(null,b)}getPixelSize(a){const{width:d,height:_}=this.atlasImage.get(a);return{width:d,height:_}}getPattern(a,d,_){const y=a.toString(),b=this.patterns.get(d),T=b.get(y),j=this.getImage(a,d);if(!j)return null;if(T){if(T.position.version===j.version)return T.position;T.position.version=j.version}else{if(j.usvg&&!j.data){const N=this.getPatternInFlightId(y,d);if(this.patternsInFlight.has(N))return null;this.patternsInFlight.add(N);const L=new i.A(a).scaleSelf(i.o.devicePixelRatio),B=new Map([[L.toString(),{image:j,imageVariant:L}]]);return this._rasterizeImages(d,B,(X,q)=>this.storePatternImage(L,d,j,_,q)),null}this.storePattern(a,d,j)}return this._updatePatternAtlas(d,_),b.get(y).position}getPatternInFlightId(a,d){return i.B(a,d)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(a,d,_,y,b){const T=a.toString(),j=b?b.get(T):void 0;j&&(_.data=j,this.storePattern(a.id,d,_),this._updatePatternAtlas(d,y),this.patternsInFlight.delete(this.getPatternInFlightId(a.id.toString(),d)))}storePattern(a,d,_){const y={w:_.data.width+2*i.C,h:_.data.height+2*i.C,x:0,y:0},b=new i.F(y,_,i.C);this.patterns.get(d).set(a.toString(),{bin:y,position:b})}destroyAtlasTextures(){for(const a of this.atlasTexture.values())a&&a.destroy();this.atlasTexture.clear()}bind(a,d){const _=a.gl;let y=this.atlasTexture.get(d);y?this.dirty&&(y.update(this.atlasImage.get(d)),this.dirty=!1):(y=new i.T(a,this.atlasImage.get(d),_.RGBA8),this.atlasTexture.set(d,y)),y.bind(_.LINEAR,_.CLAMP_TO_EDGE)}_updatePatternAtlas(a,d){const _=this.patterns.get(a),y=Array.from(_.values()).map(({bin:L})=>L),{w:b,h:T}=i.G(y),j=this.atlasImage.get(a);j.resize({width:b||1,height:T||1});const N=this.images.get(a);for(const[L,{bin:B,position:X}]of _.entries()){let q=X.padding;const Q=B.x+q,re=B.y+q,ae=N.get(L).data,fe=ae.width,de=ae.height;q=q>1?q-1:q,i.q.copy(ae,j,{x:0,y:0},{x:Q,y:re},{width:fe,height:de},d),i.q.copy(ae,j,{x:0,y:de-q},{x:Q,y:re-q},{width:fe,height:q},d),i.q.copy(ae,j,{x:0,y:0},{x:Q,y:re+de},{width:fe,height:q},d),i.q.copy(ae,j,{x:fe-q,y:0},{x:Q-q,y:re},{width:q,height:de},d),i.q.copy(ae,j,{x:0,y:0},{x:Q+fe,y:re},{width:q,height:de},d),i.q.copy(ae,j,{x:fe-q,y:de-q},{x:Q-q,y:re-q},{width:q,height:q},d),i.q.copy(ae,j,{x:0,y:de-q},{x:Q+fe,y:re-q},{width:q,height:q},d),i.q.copy(ae,j,{x:0,y:0},{x:Q+fe,y:re+de},{width:q,height:q},d),i.q.copy(ae,j,{x:fe-q,y:0},{x:Q-q,y:re+de},{width:q,height:q},d)}this.dirty=!0}beginFrame(){for(const a of this.images.keys())this.callbackDispatchedThisFrame.set(a,new Set)}dispatchRenderCallbacks(a,d){const _=this.images.get(d);for(const y of a){if(this.callbackDispatchedThisFrame.get(d).has(y.toString()))continue;this.callbackDispatchedThisFrame.get(d).add(y.toString());const b=_.get(y.toString());Dn(b)&&this.updateImage(y,d,b)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Nn(g){const a=g.value,d=g.valueSpec,_=g.style,y=g.styleSpec,b=g.key,T=g.arrayElementValidator||ii;if(!Array.isArray(a))return[new i.V(b,a,`array expected, ${i.K(a)} found`)];if(d.length&&a.length!==d.length)return[new i.V(b,a,`array length ${d.length} expected, length ${a.length} found`)];if(d["min-length"]&&a.length<d["min-length"])return[new i.V(b,a,`array length at least ${d["min-length"]} expected, length ${a.length} found`)];let j={type:d.value,values:d.values,minimum:d.minimum,maximum:d.maximum,function:void 0};y.$version<7&&(j.function=d.function),i.H(d.value)&&(j=d.value);let N=[];for(let L=0;L<a.length;L++)N=N.concat(T({array:a,arrayIndex:L,value:a[L],valueSpec:j,style:_,styleSpec:y,key:`${b}[${L}]`},!0));return N}function Pi(g){const a=g.key,d=g.value,_=g.valueSpec;if(!i.L(d))return[new i.V(a,d,`number expected, ${i.K(d)} found`)];if(d!=d)return[new i.V(a,d,"number expected, NaN found")];if("minimum"in _){let y=_.minimum;if(Array.isArray(_.minimum)&&(y=_.minimum[g.arrayIndex]),d<y)return[new i.V(a,d,`${d} is less than the minimum value ${y}`)]}if("maximum"in _){let y=_.maximum;if(Array.isArray(_.maximum)&&(y=_.maximum[g.arrayIndex]),d>y)return[new i.V(a,d,`${d} is greater than the maximum value ${y}`)]}return[]}function ft(g){const a=g.key,d=g.value;if(!i.H(d))return[new i.V(a,d,`object expected, ${i.K(d)} found`)];const _=g.valueSpec,y=i.J(d.type);let b,T,j,N={};const L=y!=="categorical"&&d.property===void 0,B=!L,X=function(ae){const fe=ae.stops;return Array.isArray(fe)&&Array.isArray(fe[0])&&i.H(fe[0][0])}(d),q=Ds({key:g.key,value:g.value,valueSpec:g.styleSpec.function,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{stops:function(ae){if(y==="identity")return[new i.V(ae.key,ae.value,'identity function may not have a "stops" property')];let fe=[];const de=ae.value;return fe=fe.concat(Nn({key:ae.key,value:de,valueSpec:ae.valueSpec,style:ae.style,styleSpec:ae.styleSpec,arrayElementValidator:Q})),Array.isArray(de)&&de.length===0&&fe.push(new i.V(ae.key,de,"array must have at least one stop")),fe},default:function(ae){return ii({key:ae.key,value:ae.value,valueSpec:_,style:ae.style,styleSpec:ae.styleSpec})}}});return y==="identity"&&L&&q.push(new i.V(g.key,g.value,'missing required property "property"')),y==="identity"||d.stops||q.push(new i.V(g.key,g.value,'missing required property "stops"')),y==="exponential"&&_.expression&&!i.M(_)&&q.push(new i.V(g.key,g.value,"exponential functions not supported")),g.styleSpec.$version>=8&&(B&&!i.N(_)?q.push(new i.V(g.key,g.value,"property functions not supported")):L&&!i.O(_)&&q.push(new i.V(g.key,g.value,"zoom functions not supported"))),y!=="categorical"&&!X||d.property!==void 0||q.push(new i.V(g.key,g.value,'"property" property is required')),q;function Q(ae){let fe=[];const de=ae.value,xe=ae.key;if(!Array.isArray(de))return[new i.V(xe,de,`array expected, ${i.K(de)} found`)];if(de.length!==2)return[new i.V(xe,de,`array length 2 expected, length ${de.length} found`)];if(X){if(!i.H(de[0]))return[new i.V(xe,de,`object expected, ${i.K(de[0])} found`)];const je=de[0];if(je.zoom===void 0)return[new i.V(xe,de,"object stop key must have zoom")];if(je.value===void 0)return[new i.V(xe,de,"object stop key must have value")];const we=i.J(je.zoom);if(typeof we!="number")return[new i.V(xe,je.zoom,"stop zoom values must be numbers")];if(j&&j>we)return[new i.V(xe,je.zoom,"stop zoom values must appear in ascending order")];we!==j&&(j=we,T=void 0,N={}),fe=fe.concat(Ds({key:`${xe}[0]`,value:de[0],valueSpec:{zoom:{}},style:ae.style,styleSpec:ae.styleSpec,objectElementValidators:{zoom:Pi,value:re}}))}else fe=fe.concat(re({key:`${xe}[0]`,value:de[0],style:ae.style,styleSpec:ae.styleSpec},de));return i.Q(i.S(de[1]))?fe.concat([new i.V(`${xe}[1]`,de[1],"expressions are not allowed in function stops.")]):fe.concat(ii({key:`${xe}[1]`,value:de[1],valueSpec:_,style:ae.style,styleSpec:ae.styleSpec}))}function re(ae,fe){const de=i.K(ae.value),xe=i.J(ae.value),je=ae.value!==null?ae.value:fe;if(b){if(de!==b)return[new i.V(ae.key,je,`${de} stop domain type must match previous stop domain type ${b}`)]}else b=de;if(de!=="number"&&de!=="string"&&de!=="boolean"&&typeof xe!="number"&&typeof xe!="string"&&typeof xe!="boolean")return[new i.V(ae.key,je,"stop domain value must be a number, string, or boolean")];if(de!=="number"&&y!=="categorical"){let we=`number expected, ${de} found`;return i.N(_)&&y===void 0&&(we+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new i.V(ae.key,je,we)]}return y!=="categorical"||de!=="number"||typeof xe=="number"&&isFinite(xe)&&Math.floor(xe)===xe?y!=="categorical"&&de==="number"&&typeof xe=="number"&&typeof T=="number"&&T!==void 0&&xe<T?[new i.V(ae.key,je,"stop domain values must appear in ascending order")]:(T=xe,y==="categorical"&&xe in N?[new i.V(ae.key,je,"stop domain values must be unique")]:(N[xe]=!0,[])):[new i.V(ae.key,je,`integer expected, found ${String(xe)}`)]}}function Rt(g){const a=(g.expressionContext==="property"?i.W:i.U)(i.S(g.value),g.valueSpec);if(a.result==="error")return a.value.map(_=>new i.V(`${g.key}${_.key}`,g.value,_.message));const d=a.value.expression||a.value._styleExpression.expression;if(g.expressionContext==="property"&&g.propertyKey==="text-font"&&!d.outputDefined())return[new i.V(g.key,g.value,`Invalid data expression for "${g.propertyKey}". Output values must be contained as literals within the expression.`)];if(g.expressionContext==="property"&&g.propertyType==="layout"&&!i.Z(d))return[new i.V(g.key,g.value,'"feature-state" data expressions are not supported with layout properties.')];if(g.expressionContext==="filter")return Wt(d,g);if(g.expressionContext==="appearance")return Pr(d,g);if(g.expressionContext&&g.expressionContext.indexOf("cluster")===0){if(!i.X(d,["zoom","feature-state"]))return[new i.V(g.key,g.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(g.expressionContext==="cluster-initial"&&!i.Y(d))return[new i.V(g.key,g.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Wt(g,a){const d=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(a.valueSpec&&a.valueSpec.expression)for(const y of a.valueSpec.expression.parameters)d.delete(y);if(d.size===0)return[];const _=[];return g instanceof i._&&d.has(g.name)?[new i.V(a.key,a.value,`["${g.name}"] expression is not supported in a filter for a ${a.object.type} layer with id: ${a.object.id}`)]:(g.eachChild(y=>{_.push(...Wt(y,a))}),_)}function Pr(g,a){const d=new Set;if(a.valueSpec&&a.valueSpec.expression)for(const y of a.valueSpec.expression.parameters)d.add(y);if(d.size===0)return[];const _=[];return g instanceof i._&&!d.has(g.name)?[new i.V(a.key,a.value,`["${g.name}"] is not an allowed parameter`)]:(g.eachChild(y=>{_.push(...Pr(y,a))}),_)}function Sr(g){const a=g.key,d=g.value,_=g.valueSpec,y=[];return Array.isArray(_.values)?_.values.indexOf(i.J(d))===-1&&y.push(new i.V(a,d,`expected one of [${_.values.join(", ")}], ${JSON.stringify(d)} found`)):Object.keys(_.values).indexOf(i.J(d))===-1&&y.push(new i.V(a,d,`expected one of [${Object.keys(_.values).join(", ")}], ${JSON.stringify(d)} found`)),y}function Nr(g){return i.a2(i.S(g.value))?Rt(Object.assign({},g,{expressionContext:"filter",valueSpec:g.styleSpec[`filter_${g.layerType||"fill"}`]})):Kr(g)}function Kr(g){const a=g.value,d=g.key;if(!Array.isArray(a))return[new i.V(d,a,`array expected, ${i.K(a)} found`)];if(a.length<1)return[new i.V(d,a,"filter array must have at least 1 element")];const _=g.styleSpec;let y=Sr({key:`${d}[0]`,value:a[0],valueSpec:_.filter_operator});switch(i.J(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&i.J(a[1])==="$type"&&y.push(new i.V(d,a,`"$type" cannot be use with operator "${a[0]}"`));case"==":case"!=":a.length!==3&&y.push(new i.V(d,a,`filter array for operator "${a[0]}" must have 3 elements`));case"in":case"!in":a.length>=2&&(i.a0(a[1])||y.push(new i.V(`${d}[1]`,a[1],`string expected, ${i.K(a[1])} found`)));for(let b=2;b<a.length;b++)i.J(a[1])==="$type"?y=y.concat(Sr({key:`${d}[${b}]`,value:a[b],valueSpec:_.geometry_type})):i.a0(a[b])||i.L(a[b])||i.$(a[b])||y.push(new i.V(`${d}[${b}]`,a[b],`string, number, or boolean expected, ${i.K(a[b])} found.`));break;case"any":case"all":case"none":for(let b=1;b<a.length;b++)y=y.concat(Kr({key:`${d}[${b}]`,value:a[b],style:g.style,styleSpec:g.styleSpec}));break;case"has":case"!has":a.length!==2?y.push(new i.V(d,a,`filter array for "${a[0]}" operator must have 2 elements`)):i.a0(a[1])||y.push(new i.V(`${d}[1]`,a[1],`string expected, ${i.K(a[1])} found`))}return y}function Zn(g,a){const d=g.key,_=g.style,y=g.layer,b=g.styleSpec,T=g.value,j=g.objectKey,N=b[`${a}_${g.layerType}`];if(!N)return[];const L=j.match(/^(.*)-use-theme$/);if(L&&N[L[1]])return i.Q(i.S(T))?[].concat(ii({key:d,value:T,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:_,styleSpec:b,expressionContext:"property",propertyType:a,propertyKey:j})):ii({key:d,value:T,valueSpec:{type:"string"},style:_,styleSpec:b});const B=j.match(/^(.*)-transition$/);if(a==="paint"&&B&&N[B[1]]&&N[B[1]].transition)return ii({key:d,value:T,valueSpec:b.transition,style:_,styleSpec:b});const X=g.valueSpec||N[j];if(!X)return[new i.a3(d,T,`unknown property "${j}"`)];let q;if(i.a0(T)&&i.N(X)&&!X.tokens&&(q=/^{([^}]+)}$/.exec(T))){const re=`\`{ "type": "identity", "property": ${q?JSON.stringify(q[1]):'"_"'} }\``;return[new i.V(d,T,`"${j}" does not support interpolation syntax
Use an identity property function instead: ${re}.`)]}const Q=[];if(g.layerType==="symbol")j!=="text-field"||!_||_.glyphs||_.imports||Q.push(new i.V(d,T,'use of "text-field" requires a style "glyphs" property')),j==="text-font"&&i.a4(i.S(T))&&i.J(T.type)==="identity"&&Q.push(new i.V(d,T,'"text-font" does not support identity functions'));else if(g.layerType==="model"&&a==="paint"&&y&&y.layout&&y.layout.hasOwnProperty("model-id")&&i.N(X)&&(i.a5(X)||i.O(X))){const re=i.W(i.S(T),X).value,ae="expression"in re&&re.expression||"_styleExpression"in re&&re._styleExpression&&re._styleExpression.expression;ae&&!i.X(ae,["measure-light"])&&(j==="model-emissive-strength"&&i.Y(ae)&&i.Z(ae)||Q.push(new i.V(d,T,`${j} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return Q.concat(ii({key:g.key,value:T,valueSpec:X,style:_,styleSpec:b,expressionContext:"property",propertyType:a,propertyKey:j}))}function Yn(g){return Zn(g,"paint")}function Zt(g){return Zn(g,"layout")}function en(g){let a=[];const d=g.value,_=g.key,y=g.style,b=g.styleSpec;if(!i.H(d))return[new i.V(_,d,"object expected")];d.type||d.ref||a.push(new i.V(_,d,'either "type" or "ref" is required'));let T=i.J(d.type);const j=i.J(d.ref);if(d.id){const N=i.J(d.id);for(let L=0;L<g.arrayIndex;L++){const B=y.layers[L];i.J(B.id)===N&&a.push(new i.V(_,d.id,`duplicate layer id "${N}", previously used at line ${B.id.__line__}`))}}if("ref"in d){let N;["type","source","source-layer","filter","layout"].forEach(L=>{L in d&&a.push(new i.V(_,d[L],`"${L}" is prohibited for ref layers`))}),y.layers.forEach(L=>{i.J(L.id)===j&&(N=L)}),N?N.ref?a.push(new i.V(_,d.ref,"ref cannot reference another ref layer")):T=i.J(N.type):typeof j=="string"&&a.push(new i.V(_,d.ref,`ref layer "${j}" not found`))}else if(T!=="background"&&T!=="sky"&&T!=="slot")if(d.source)if(i.a0(d.source)){const N=y.sources&&y.sources[d.source],L=N&&i.J(N.type);N?L==="vector"&&T==="raster"?a.push(new i.V(_,d.source,`layer "${d.id}" requires a raster source`)):L==="raster"&&T!=="raster"?a.push(new i.V(_,d.source,`layer "${d.id}" requires a vector source`)):L!=="vector"||d["source-layer"]?L==="raster-dem"&&T!=="hillshade"?a.push(new i.V(_,d.source,"raster-dem source can only be used with layer type 'hillshade'.")):L!=="raster-array"||["raster","raster-particle"].includes(T)?T==="line"&&d.paint&&(d.paint["line-gradient"]||d.paint["line-trim-offset"])&&L==="geojson"&&!N.lineMetrics?a.push(new i.V(_,d,`layer "${d.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):T==="raster-particle"&&L!=="raster-array"&&a.push(new i.V(_,d.source,`layer "${d.id}" requires a 'raster-array' source.`)):a.push(new i.V(_,d.source,"raster-array source can only be used with layer type 'raster'.")):a.push(new i.V(_,d,`layer "${d.id}" must specify a "source-layer"`)):a.push(new i.V(_,d.source,`source "${d.source}" not found`))}else a.push(new i.V(`${_}.source`,d.source,'"source" must be a string'));else a.push(new i.V(_,d,'missing required property "source"'));return a=a.concat(Ds({key:_,value:d,valueSpec:b.layer,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ii({key:`${_}.type`,value:d.type,valueSpec:b.layer.type,style:g.style,styleSpec:g.styleSpec,object:d,objectKey:"type"}),filter:N=>Nr(Object.assign({layerType:T},N)),layout:N=>Ds({layer:d,key:N.key,value:N.value,valueSpec:{},style:N.style,styleSpec:N.styleSpec,objectElementValidators:{"*":L=>Zt(Object.assign({layerType:T},L))}}),paint:N=>Ds({layer:d,key:N.key,value:N.value,valueSpec:{},style:N.style,styleSpec:N.styleSpec,objectElementValidators:{"*":L=>Yn(Object.assign({layerType:T,layer:d},L))}}),appearances(N){const L=Nn({key:N.key,value:N.value,valueSpec:N.valueSpec,style:N.style,styleSpec:N.styleSpec,arrayElementValidator:q=>function(Q){const{key:re,layer:ae,layerType:fe}=Q,de=i.J(Q.value),xe=i.J(de.name),je=i.J(de.condition),we=Ds({key:re,value:de,valueSpec:Q.styleSpec.appearance,style:Q.style,styleSpec:Q.styleSpec,objectElementValidators:{condition:Ve=>function(Ne){const Ge=[];return Ge.push(...Rt({key:Ne.key,value:Ne.object.condition,valueSpec:i.a6.appearance.condition,expressionContext:"appearance"})),Ge}(Object.assign({layer:ae,layerType:fe},Ve)),properties:Ve=>function(Ne){const Ge=[],{styleSpec:Be,layer:De,layerType:We}=Ne,st=Be[`paint_${We}`],rt=Be[`layout_${We}`],bt=Ne.object[Ne.objectKey];for(const _t in bt){const kt=_t in st?"paint":_t in rt?"layout":void 0;if(!kt){Ge.push(new i.V(Ne.key,_t,`unknown property "${_t}" for layer type "${We}"`));continue}const nr=Object.assign({},Ne,{key:`${Ne.key}.${_t}`,object:bt,objectKey:_t,layer:De,layerType:We,value:bt[_t],valueSpec:kt==="paint"?st[_t]:rt[_t]});Ge.push(...Zn(nr,kt))}return Ge}(Object.assign({layer:ae,layerType:fe},Ve))}});return xe!=="hidden"&&je===void 0&&we.push(new i.V(Q.key,"name",'Appearance with name different than "hidden" must have a condition')),we}(Object.assign({layerType:T,layer:d},q))}),B=Array.isArray(N.value)?N.value:[],X=new Set;return B.forEach((q,Q)=>{const re=i.J(q.name);if(re)if(X.has(re)){const ae=i.J(d.id);L.push(new i.V(N.key,re,`Duplicated appearance name "${re}" for layer "${ae}"`))}else X.add(re)}),L}}})),a}function Sn({key:g,value:a}){return i.a0(a)?[]:[new i.V(g,a,`string expected, ${i.K(a)} found`)]}const fs={promoteId:function g({key:a,value:d}){if(i.a0(d))return Sn({key:a,value:d});if(Array.isArray(d)){const y=[],b=i.S(d),T=i.U(b);return T.result==="error"&&T.value.forEach(j=>{y.push(new i.V(`${a}${j.key}`,null,`${j.message}`))}),i.X(T.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||y.push(new i.V(`${a}`,null,"promoteId expression should be only feature dependent")),y}if(!i.H(d))return[new i.V(a,d,`string, expression or object expected, "${i.K(d)}" found`)];const _=[];for(const y in d)_.push(...g({key:`${a}.${y}`,value:d[y]}));return _}};function ms(g){const a=g.value,d=g.key,_=g.styleSpec,y=g.style;if(!i.H(a))return[new i.V(d,a,`object expected, ${i.K(a)} found`)];if(!("type"in a))return[new i.V(d,a,'"type" is required')];const b=i.J(a.type);let T=[];switch(["vector","raster","raster-dem","raster-array"].includes(b)&&("url"in a||"tiles"in a||T.push(new i.a3(d,a,'Either "url" or "tiles" is required.'))),b){case"vector":case"raster":case"raster-dem":case"raster-array":return T=T.concat(Ds({key:d,value:a,valueSpec:_[`source_${b.replace("-","_")}`],style:g.style,styleSpec:_,objectElementValidators:fs})),T;case"geojson":if(T=Ds({key:d,value:a,valueSpec:_.source_geojson,style:y,styleSpec:_,objectElementValidators:fs}),"cluster"in a&&"clusterProperties"in a){if(!i.H(a.clusterProperties))return[new i.V(`${d}.clusterProperties`,a,`object expected, ${i.K(a)} found`)];for(const j in a.clusterProperties){const N=a.clusterProperties[j];if(!Array.isArray(N))return[new i.V(`${d}.clusterProperties.${j}`,N,"array expected")];const[L,B]=N,X=typeof L=="string"?[L,["accumulated"],["get",j]]:L;T.push(...Rt({key:`${d}.${j}.map`,value:B,expressionContext:"cluster-map"})),T.push(...Rt({key:`${d}.${j}.reduce`,value:X,expressionContext:"cluster-reduce"}))}}return T;case"video":return Ds({key:d,value:a,valueSpec:_.source_video,style:y,styleSpec:_});case"image":return Ds({key:d,value:a,valueSpec:_.source_image,style:y,styleSpec:_});case"canvas":return[new i.V(d,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Sr({key:`${d}.type`,value:a.type,valueSpec:{values:hr(_)}})}}function hr(g){return g.source.reduce((a,d)=>{const _=g[d];return _.type.type==="enum"&&(a=a.concat(Object.keys(_.type.values||{}))),a},[])}function An(g){const a=g.value,d=g.styleSpec,_=d.light,y=g.style;if(a===void 0)return[];if(!i.H(a))return[new i.V("light",a,`object expected, ${i.K(a)} found`)];let b=[];for(const T in a){const j=T.match(/^(.*)-transition$/),N=T.match(/^(.*)-use-theme$/);b=b.concat(N&&_[N[1]]?ii({key:T,value:a[T],valueSpec:{type:"string"},style:y,styleSpec:d}):j&&_[j[1]]&&_[j[1]].transition?ii({key:T,value:a[T],valueSpec:d.transition,style:y,styleSpec:d}):_[T]?ii({key:T,value:a[T],valueSpec:_[T],style:y,styleSpec:d}):[new i.V(T,a[T],`unknown property "${T}"`)])}return b}function fi(g){const a=g.value;if(!a)return[];const d=g.key;if(!i.H(a))return[new i.V(d,a,`object expected, ${i.K(a)} found`)];let _=[];const y=g.styleSpec,b=y["light-3d"],T=g.style,j=g.style.lights;for(const B of["type","id"])if(!(B in a))return _=_.concat([new i.V(d,a,`missing property "${B}"`)]),_;if(!i.a0(a.type))return _=_.concat([new i.V(`${d}.type`,a.type,"string expected")]),_;if(j)for(let B=0;B<g.arrayIndex;B++){const X=i.J(a.type),q=j[B];i.J(q.type)===X&&_.push(new i.V(d,a.id,`duplicate light type "${a.type}", previously defined at line ${q.id.__line__}`))}const N=`properties_light_${a.type}`;if(!(N in y))return _=_.concat([new i.V(`${d}.type`,a,`Invalid light type ${a.type}`)]),_;const L=y[N];for(const B in a)if(B==="properties"){const X=a[B];if(!i.H(X))return _=_.concat([new i.V("properties",X,`object expected, ${i.K(X)} found`)]),_;for(const q in X){const Q=q.match(/^(.*)-transition$/),re=q.match(/^(.*)-use-theme$/);_=_.concat(re&&L[re[1]]?ii({key:B,value:X[q],valueSpec:{type:"string"},style:T,styleSpec:y}):Q&&L[Q[1]]&&L[Q[1]].transition?ii({key:B,value:a[B],valueSpec:y.transition,style:T,styleSpec:y}):L[q]?ii({key:q,value:X[q],valueSpec:L[q],style:T,styleSpec:y}):[new i.a3(g.key,X[q],`unknown property "${q}"`)])}}else _=_.concat(b[B]?ii({key:B,value:a[B],valueSpec:b[B],style:T,styleSpec:y}):[new i.a3(B,a[B],`unknown property "${B}"`)]);return _}function Vi(g){const a=g.value,d=g.key,_=g.style,y=g.styleSpec,b=y.terrain;if(a==null)return[];if(!i.H(a))return[new i.V("terrain",a,`object expected, ${i.K(a)} found`)];let T=[];for(const j in a){const N=j.match(/^(.*)-transition$/),L=j.match(/^(.*)-use-theme$/);T=T.concat(L&&b[L[1]]?ii({key:j,value:a[j],valueSpec:{type:"string"},style:_,styleSpec:y}):N&&b[N[1]]&&b[N[1]].transition?ii({key:j,value:a[j],valueSpec:y.transition,style:_,styleSpec:y}):b[j]?ii({key:j,value:a[j],valueSpec:b[j],style:_,styleSpec:y}):[new i.a3(j,a[j],`unknown property "${j}"`)])}if(a.source)if(i.a0(a.source)){const j=_.sources&&_.sources[a.source],N=j&&i.J(j.type);j?N!=="raster-dem"&&T.push(new i.V(`${d}.source`,a.source,`terrain cannot be used with a source of type ${N}, it only be used with a "raster-dem" source type`)):T.push(new i.V(`${d}.source`,a.source,`source "${a.source}" not found`))}else T.push(new i.V(`${d}.source`,a.source,"source must be a string"));else T.push(new i.V(d,a,'terrain is missing required property "source"'));return T}function $n(g){const a=g.value,d=g.style,_=g.styleSpec,y=_.fog;if(a===void 0)return[];if(!i.H(a))return[new i.V("fog",a,`object expected, ${i.K(a)} found`)];let b=[];for(const T in a){const j=T.match(/^(.*)-transition$/),N=T.match(/^(.*)-use-theme$/);b=b.concat(N&&y[N[1]]?ii({key:T,value:a[T],valueSpec:{type:"string"},style:d,styleSpec:_}):j&&y[j[1]]&&y[j[1]].transition?ii({key:T,value:a[T],valueSpec:_.transition,style:d,styleSpec:_}):y[T]?ii({key:T,value:a[T],valueSpec:y[T],style:d,styleSpec:_}):[new i.a3(T,a[T],`unknown property "${T}"`)])}return b}const vi={"*":()=>[],array:Nn,boolean:function(g){const a=g.value,d=g.key;return i.$(a)?[]:[new i.V(d,a,`boolean expected, ${i.K(a)} found`)]},number:Pi,color:function({key:g,value:a}){return i.a0(a)?i.a1.parseCSSColor(a)===null?[new i.V(g,a,`color expected, "${a}" found`)]:[]:[new i.V(g,a,`color expected, ${i.K(a)} found`)]},enum:Sr,filter:Nr,function:ft,layer:en,object:Ds,source:ms,model:i.a7,light:An,"light-3d":fi,terrain:Vi,fog:$n,string:Sn,formatted:function(g){return Sn(g).length===0?[]:Rt(g)},resolvedImage:function(g){return Sn(g).length===0?[]:Rt(g)},projection:function(g){const a=g.value,d=g.styleSpec,_=d.projection,y=g.style;if(i.H(a)){let b=[];for(const T in a)b=b.concat(ii({key:T,value:a[T],valueSpec:_[T],style:y,styleSpec:d}));return b}return i.a0(a)?[]:[new i.V("projection",a,`object or string expected, ${i.K(a)} found`)]},import:function(g){const a=g.key,{value:d,styleSpec:_}=g;if(!i.H(d))return[new i.V(a,d,"import must be an object")];const{data:y,...b}=d;Object.defineProperty(b,"__line__",{value:d.__line__,enumerable:!1});let T=Ds(Object.assign({},g,{value:b,valueSpec:_.import}));return i.J(b.id)===""&&T.push(new i.V(`${g.key}.id`,b,"import id can't be an empty string")),y&&(T=T.concat(Us(y,_,{key:`${g.key}.data`}))),T},iconset:function(g){const a=g.value,d=g.key,_=g.styleSpec,y=g.style;if(!i.H(a))return[new i.V(d,a,"object expected")];if(!a.type)return[new i.V(d,a,'"type" is required')];const b=i.J(a.type);let T=[];if(T=T.concat(Ds({key:d,value:a,valueSpec:_[`iconset_${b}`],style:y,styleSpec:_})),function(j,N){return!(j!=="source"||!N.source)}(b,a)){const j=y.sources&&y.sources[a.source],N=j&&i.J(j.type);j?N!=="raster-array"&&T.push(new i.V(d,a.source,`iconset cannot be used with a source of type ${String(N)}, it only be used with a "raster-array" source type`)):T.push(new i.V(d,a.source,`source "${a.source}" not found`))}return T}};function ii(g,a=!1){const d=g.value,_=g.valueSpec,y=g.styleSpec;if(_.expression){if(i.a4(i.J(d)))return ft(g);if(i.Q(i.S(d)))return Rt(g)}if(_.type&&vi[_.type]){const b=vi[_.type](g);return a===!0&&b.length>0&&Array.isArray(g.value)?Rt(g):b}return Ds(Object.assign({},g,{valueSpec:_.type?y[_.type]:_}))}function Ds(g){const a=g.key,d=g.value,_=g.valueSpec||{},y=g.objectElementValidators||{},b=g.style,T=g.styleSpec;if(!i.H(d))return[new i.V(a,d,`object expected, ${i.K(d)} found`)];let j=[];for(const N in d){const L=N.split(".")[0];let B;y[L]?B=y[L]:_[L]?B=ii:y["*"]?B=y["*"]:_["*"]&&(B=ii),B?j=j.concat(B({key:(a&&`${a}.`)+N,value:d[N],valueSpec:_[L]||_["*"],style:b,styleSpec:T,object:d,objectKey:N},d)):j.push(new i.a3(a,d[N],`unknown property "${N}"`))}for(const N in _){if(y[N])continue;const L=_[N];L.required&&L.default===void 0&&d[N]===void 0&&j.push(new i.V(a,d,`missing required property "${N}"`))}return j}function Ua({key:g,value:a}){const d=Sn({key:g,value:a});if(d.length)return d;const _=a;return _.indexOf("{fontstack}")===-1&&d.push(new i.V(g,a,'"glyphs" url must include a "{fontstack}" token')),_.indexOf("{range}")===-1&&d.push(new i.V(g,a,'"glyphs" url must include a "{range}" token')),d}function Us(g,a=i.a6,d={}){return Ds({key:d.key||"",value:g,valueSpec:Object.assign(a.$root,{"*":{type:"*"}}),styleSpec:a,style:g,objectElementValidators:{glyphs:Ua}})}function Ot(g,a=i.a6){return ue(Us(g,a))}const Hr=g=>ue(ms(g)),hn=g=>ue(An(g)),vn=g=>ue(fi(g)),ai=g=>ue(Vi(g)),At=g=>ue($n(g)),$i=g=>ue(function(a){const d=a.value,_=a.style,y=a.styleSpec,b=y.snow;if(d===void 0)return[];if(!i.H(d))return[new i.V("snow",d,`object expected, ${i.K(d)} found`)];let T=[];for(const j in d){const N=j.match(/^(.*)-transition$/);T=T.concat(N&&b[N[1]]&&b[N[1]].transition?ii({key:j,value:d[j],valueSpec:y.transition,style:_,styleSpec:y}):b[j]?ii({key:j,value:d[j],valueSpec:b[j],style:_,styleSpec:y}):[new i.a3(j,d[j],`unknown property "${j}"`)])}return T}(g)),ha=g=>ue(function(a){const d=a.value,_=a.style,y=a.styleSpec,b=y.rain;if(d===void 0)return[];if(!i.H(d))return[new i.V("rain",d,`object expected, ${i.K(d)} found`)];let T=[];for(const j in d){const N=j.match(/^(.*)-transition$/);T=T.concat(N&&b[N[1]]&&b[N[1]].transition?ii({key:j,value:d[j],valueSpec:y.transition,style:_,styleSpec:y}):b[j]?ii({key:j,value:d[j],valueSpec:b[j],style:_,styleSpec:y}):[new i.a3(j,d[j],`unknown property "${j}"`)])}return T}(g)),pt=g=>ue(en(g)),lt=g=>ue(Nr(g)),Er=g=>ue(Yn(g)),Jr=g=>ue(Zt(g)),Ae=g=>ue(i.a7(g));function ue(g){return g.slice().sort((a,d)=>a.line&&d.line?a.line-d.line:0)}function Z(g,a){let d=!1;if(a&&a.length)for(const _ of a)_ instanceof i.a3?i.w(_.message):(g.fire(new i.y(new Error(_.message))),d=!0);return d}const K=i.a6.light;let ie;class ce extends i.E{constructor(a,d="flat"){super(),this._transitionable=new i.a8(ie||(ie=new i.a9({anchor:new i.aa(K.anchor),position:new i.ab(K.position),color:new i.aa(K.color),intensity:new i.aa(K.intensity)}))),this.setLight(a,d),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,d,_={}){this._validate(hn,a,_)||(this._transitionable.setTransitionOrValue(a),this.id=d)}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,d,_){return(!_||_.validate!==!1)&&Z(this,a.call(Ot,Object.assign({value:d,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}}const _e=i.a6.terrain;let Ie=class extends i.E{constructor(g,a,d,_,y){super(),this.scope=d,this._transitionable=new i.a8(new i.a9({source:new i.aa(_e.source),exaggeration:new i.aa(_e.exaggeration)}),d,_),this._transitionable.setTransitionOrValue(g,_),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=a,this.worldview=y}get(){return this._transitionable.serialize()}set(g,a){this._transitionable.setTransitionOrValue(g,a)}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}getExaggeration(g){return this._transitioning.possiblyEvaluate(new i.ac(g,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const g=this._transitionable._values.exaggeration;if(!g)return null;const a=g.value.expression;if(!a)return null;let d=-1,_=-1,y=1;for(const b of a.zoomStops)y=a.evaluate(new i.ac(b,{worldview:this.worldview})),y>.01?(d=b,_=-1):_=b;return y<.01&&d>0&&_>d?[d,_]:null}isZoomDependent(){const g=this._transitionable._values.exaggeration;return g!=null&&g.value!=null&&g.value.expression!=null&&g.value.expression instanceof i.ad}};const Re=45,Ce=65,ze=.05;function et(g,a,d,_){const y=i.ah(Re,Ce,d),[b,T]=ut(g,_);let j=1-Math.min(1,Math.exp((a-b)/(T-b)*-6));return j*=j*j,j=Math.min(1,1.00747*j),j*y*g.alpha}function ut(g,a){const d=.5/Math.tan(.5*a);return[g.range[0]+d,g.range[1]+d]}function Ut(g,a,d,_,y){const b=i.af([],[a,d,_],y.mercatorFogMatrix);return et(g,i.ag(b),y.pitch,y._fov)}function Xt(g,a,d,_,y,b,T){const j=[[d,_,0],[y,_,0],[y,b,0],[d,b,0]];let N=Number.MAX_VALUE,L=-Number.MAX_VALUE;for(const B of j){const X=i.af([],B,a),q=i.ag(X);N=Math.min(N,q),L=Math.max(L,q)}return[et(g,N,T.pitch,T._fov),et(g,L,T.pitch,T._fov)]}const Qt=i.a6.fog;class ur extends i.E{constructor(a,d,_,y){super();const b=new i.a9({range:new i.aa(Qt.range),color:new i.aa(Qt.color),"color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new i.aa(Qt["high-color"]),"high-color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new i.aa(Qt["space-color"]),"space-color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new i.aa(Qt["horizon-blend"]),"star-intensity":new i.aa(Qt["star-intensity"]),"vertical-range":new i.aa(Qt["vertical-range"])});this._transitionable=new i.a8(b,_,new Map(y)),this.set(a,y),this._transitioning=this._transitionable.untransitioned(),this._transform=d,this.properties=new i.ai(b),this.scope=_}get state(){const a=this._transform,d=a.projection.name==="globe",_=i.aj(a.zoom),y=this.properties.get("range"),b=[.5,3];return{range:d?[i.ak(b[0],y[0],_),i.ak(b[1],y[1],_)]:y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(a,d,_={}){if(this._validate(At,a,_))return;const y=Object.assign({},a);for(const b of Object.keys(Qt))y[b]===void 0&&(y[b]=Qt[b].default);this._options=y,this._transitionable.setTransitionOrValue(this._options,d)}getOpacity(a){if(!this._transform.projection.supportsFog)return 0;const d=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.ah(Re,Ce,a))*d.a}getOpacityAtLatLng(a,d){return this._transform.projection.supportsFog?function(_,y,b){const T=i.ae.fromLngLat(y),j=b.elevation?b.elevation.getAtPointOrZero(T):0;return Ut(_,T.x,T.y,j,b)}(this.state,a,d):0}getOpacityForTile(a){if(!this._transform.projection.supportsFog)return[1,1];const d=this._transform.calculateFogTileMatrix(a.toUnwrapped());return Xt(this.state,d,0,0,i.al,i.al,this._transform)}getOpacityForBounds(a,d,_,y,b){return this._transform.projection.supportsFog?Xt(this.state,a,d,_,y,b,this._transform):[1,1]}getFovAdjustedRange(a){return this._transform.projection.supportsFog?ut(this.state,a):[0,1]}isVisibleOnFrustum(a){if(!this._transform.projection.supportsFog)return!1;const d=[4,5,6,7];for(const _ of d){const y=a.points[_];let b;if(y[2]>=0)b=y;else{const T=a.points[_-4];b=i.am(T,y,T[2]/(T[2]-y[2]))}if(Ut(this.state,b[0],b[1],0,this._transform)>=ze)return!0}return!1}updateConfig(a){this._transitionable.setTransitionOrValue(this._options,new Map(a))}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,d,_){return(!_||_.validate!==!1)&&Z(this,a.call(Ot,Object.assign({value:d,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}}let Yr,Xr,Rn,Zi,Rs=class extends i.E{constructor(g,a,d,_){super();const y=Yr||(Yr=new i.a9({density:new i.aa(i.a6.snow.density),intensity:new i.aa(i.a6.snow.intensity),color:new i.aa(i.a6.snow.color),opacity:new i.aa(i.a6.snow.opacity),vignette:new i.aa(i.a6.snow.vignette),"vignette-color":new i.aa(i.a6.snow["vignette-color"]),"center-thinning":new i.aa(i.a6.snow["center-thinning"]),direction:new i.aa(i.a6.snow.direction),"flake-size":new i.aa(i.a6.snow["flake-size"])}));this._transitionable=new i.a8(y,d,new Map(_)),this.set(g,_),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ai(y),this.scope=d}get state(){const g=this.properties.get("opacity"),a=this.properties.get("color"),d=this.properties.get("direction"),_=i.an(d[0]),y=-Math.max(i.an(d[1]),.01),b=[Math.cos(_)*Math.cos(y),Math.sin(_)*Math.cos(y),Math.sin(y)],T=this.properties.get("vignette"),j=this.properties.get("vignette-color");return j.a=T,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.ao(a.r,a.g,a.b,a.a*g),direction:b,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:j}}get(){return this._transitionable.serialize()}set(g,a,d={}){if(this._validate($i,g,d))return;const _=Object.assign({},g),y=i.a6.snow;for(const b of Object.keys(y))_[b]===void 0&&(_[b]=y[b].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,a)}updateConfig(g){this._transitionable.setTransitionOrValue(this._options,new Map(g))}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}_validate(g,a,d){return(!d||d.validate!==!1)&&Z(this,g.call(Ot,Object.assign({value:a,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}},gs=class extends i.E{constructor(g,a,d,_){super();const y=Xr||(Xr=new i.a9({density:new i.aa(i.a6.rain.density),intensity:new i.aa(i.a6.rain.intensity),color:new i.aa(i.a6.rain.color),opacity:new i.aa(i.a6.rain.opacity),vignette:new i.aa(i.a6.rain.vignette),"vignette-color":new i.aa(i.a6.rain["vignette-color"]),"center-thinning":new i.aa(i.a6.rain["center-thinning"]),direction:new i.aa(i.a6.rain.direction),"droplet-size":new i.aa(i.a6.rain["droplet-size"]),"distortion-strength":new i.aa(i.a6.rain["distortion-strength"])}));this._transitionable=new i.a8(y,d,new Map(_)),this.set(g,_),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ai(y),this.scope=d}get state(){const g=this.properties.get("opacity"),a=this.properties.get("color"),d=this.properties.get("direction"),_=i.an(d[0]),y=-Math.max(i.an(d[1]),.01),b=[Math.cos(_)*Math.cos(y),Math.sin(_)*Math.cos(y),Math.sin(y)],T=this.properties.get("vignette-color");return T.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.ao(a.r,a.g,a.b,a.a*g),direction:b,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:T}}get(){return this._transitionable.serialize()}set(g,a,d={}){if(this._validate(ha,g,d))return;const _=Object.assign({},g),y=i.a6.rain;for(const b of Object.keys(y))_[b]===void 0&&(_[b]=y[b].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,a)}updateConfig(g){this._transitionable.setTransitionOrValue(this._options,new Map(g))}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}_validate(g,a,d){return(!d||d.validate!==!1)&&Z(this,g.call(Ot,Object.assign({value:a,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}};class is extends i.E{constructor(a,d,_,y){super(),this.scope=_,this._options=a,this.properties=new i.ai(d),this._transitionable=new i.a8(d,_,new Map(y)),this._transitionable.setTransitionOrValue(a.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(a){this._transitionable.setTransitionOrValue(this._options.properties,new Map(a))}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(a,d){this._options=a,this._transitionable.setTransitionOrValue(a.properties,d)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class yi{constructor(a,d,_){this.screenBounds=a,this.cameraPoint=_.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=d,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(a,d){let _,y;if(a instanceof i.P||typeof a[0]=="number"){const b=i.P.convert(a);_=[b],y=d.isPointAboveHorizon(b)}else{const b=i.P.convert(a[0]),T=i.P.convert(a[1]),j=b.add(T)._div(2);_=[b,T],y=i.aq(b,T).every(N=>d.isPointAboveHorizon(N))&&d.isPointAboveHorizon(j)}return new yi(_,y,d)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(a){return i.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],a)}bufferedCameraGeometry(a){const d=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],y=i.aq(d,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>d.x&&this.cameraPoint.x<_.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?y[2]=this.cameraPoint:this.cameraPoint.x<=d.x&&(y[3]=this.cameraPoint)),i.ar(y,a)}bufferedCameraGeometryGlobe(a){const d=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],y=i.aq(d,_,a),b=this.cameraPoint.clone();switch(3*((b.y>d.y)+(b.y>_.y))+((b.x>d.x)+(b.x>_.x))){case 0:y[0]=b,y[4]=b.clone();break;case 1:y.splice(1,0,b);break;case 2:y[1]=b;break;case 3:y.splice(4,0,b);break;case 5:y.splice(2,0,b);break;case 6:y[3]=b;break;case 7:y.splice(3,0,b);break;case 8:y[2]=b}return y}containsTile(a,d,_,y=0){const b=Math.max(a.queryPadding,a.evaluateQueryRenderedFeaturePadding())/d._pixelsPerMercatorPixel+1,T=_?this._bufferedCameraMercator(b,d):this._bufferedScreenMercator(b,d);let j=a.tileID.wrap+(T.unwrapped?y:0);const N=T.polygon.map(fe=>i.as(a.tileTransform,fe,j));if(!i.at(N,0,0,i.al,i.al))return;j=a.tileID.wrap+(this.screenGeometryMercator.unwrapped?y:0);const L=this.screenGeometryMercator.polygon.map(fe=>i.au(a.tileTransform,fe,j)),B=L.map(fe=>new i.P(fe[0],fe[1])),X=d.getFreeCameraOptions().position||new i.ae(0,0,0),q=i.au(a.tileTransform,X,j),Q=L.map(fe=>{const de=i.av(fe,fe,q);return i.aw(de,de),new i.ax(q,de)}),re=i.ay(a,1,d.zoom)*d._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:B,tilespaceRays:Q,bufferedTilespaceGeometry:N,bufferedTilespaceBounds:(ae=i.az(N),ae.min.x=i.aA(ae.min.x,0,i.al),ae.min.y=i.aA(ae.min.y,0,i.al),ae.max.x=i.aA(ae.max.x,0,i.al),ae.max.y=i.aA(ae.max.y,0,i.al),ae),tile:a,tileID:a.tileID,pixelToTileUnitsFactor:re};var ae}_bufferedScreenMercator(a,d){const _=Ts(a);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let y;return y=d.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(a),d):{polygon:this.bufferedScreenGeometry(a).map(b=>d.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[_]=y,y}}_bufferedCameraMercator(a,d){const _=Ts(a);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let y;return y=d.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(a),d):{polygon:this.bufferedCameraGeometry(a).map(b=>d.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[_]=y,y}}_projectAndResample(a,d){const _=function(b,T){const j=i.aB([],T.pixelMatrix,T.globeMatrix),N=[0,-i.aD,0,1],L=[0,i.aD,0,1],B=[0,0,0,1];i.aC(N,N,j),i.aC(L,L,j),i.aC(B,B,j);const X=new i.P(N[0]/N[3],N[1]/N[3]),q=new i.P(L[0]/L[3],L[1]/L[3]),Q=i.aE(b,X)&&N[3]<B[3],re=i.aE(b,q)&&L[3]<B[3];if(!Q&&!re)return null;const ae=function(Ge,Be,De){for(let We=1;We<Ge.length;We++){const st=ls(Be.pointCoordinate3D(Ge[We-1]).x),rt=ls(Be.pointCoordinate3D(Ge[We]).x);if(De<0){if(st<rt)return{idx:We,t:-st/(rt-1-st)}}else if(rt<st)return{idx:We,t:(1-st)/(rt+1-st)}}return null}(b,T,Q?-1:1);if(!ae)return null;const{idx:fe,t:de}=ae;let xe=fe>1?Un(b.slice(0,fe),T):[],je=fe<b.length?Un(b.slice(fe),T):[];xe=xe.map(Ge=>new i.P(ls(Ge.x),Ge.y)),je=je.map(Ge=>new i.P(ls(Ge.x),Ge.y));const we=[...xe];we.length===0&&we.push(je[je.length-1]);const Ve=i.ak(we[we.length-1].y,(je.length===0?xe[0]:je[0]).y,de);let Ne;return Ne=Q?[new i.P(0,Ve),new i.P(0,0),new i.P(1,0),new i.P(1,Ve)]:[new i.P(1,Ve),new i.P(1,1),new i.P(0,1),new i.P(0,Ve)],we.push(...Ne),je.length===0?we.push(xe[0]):we.push(...je),{polygon:we.map(Ge=>new i.ae(Ge.x,Ge.y)),unwrapped:!1}}(a,d);if(_)return _;const y=function(b,T){let j=!1,N=-1/0,L=0;for(let X=0;X<b.length-1;X++)b[X].x>N&&(N=b[X].x,L=X);for(let X=0;X<b.length-1;X++){const q=(L+X)%(b.length-1),Q=b[q],re=b[q+1];Math.abs(Q.x-re.x)>.5&&(Q.x<re.x?(Q.x+=1,q===0&&(b[b.length-1].x+=1)):(re.x+=1,q+1===b.length-1&&(b[0].x+=1)),j=!0)}const B=i.aF(T.center.lng);return j&&B<Math.abs(B-1)&&b.forEach(X=>{X.x-=1}),{polygon:b,unwrapped:j}}(Un(a,d).map(b=>new i.P(ls(b.x),b.y)),d);return{polygon:y.polygon.map(b=>new i.ae(b.x,b.y)),unwrapped:y.unwrapped}}}function Un(g,a){return i.aG(g,d=>{const _=a.pointCoordinate3D(d);d.x=_.x,d.y=_.y},1/256)}function ls(g){return g<0?1+g%1:g%1}function Ts(g){return 100*g|0}function Di(g,a,d,_,y){const b=function(j,N){if(j)return y(j);if(N){if(g.url&&N.tiles&&g.tiles&&delete g.tiles,N.variants){if(!Array.isArray(N.variants))return y(new Error("variants must be an array"));for(const B of N.variants){if(B==null||typeof B!="object"||B.constructor!==Object)return y(new Error("variant must be an object"));if(!Array.isArray(B.capabilities))return y(new Error("capabilities must be an array"));if(B.capabilities.length===1&&B.capabilities[0]==="meshopt"){N=Object.assign(N,B);break}}}const L=i.aH(Object.assign({},N,g),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);L.tiles=a.canonicalizeTileset(L,g.url),y(null,L)}},T=function(j,N,L){if(!j)return null;if(!N&&!L)return j;L=L||j.worldview_default;const B=Object.values(j.language||{});if(B.length===0)return null;const X=Object.values(j.worldview||{});if(X.length===0)return null;const q=B.every(re=>re===N),Q=X.every(re=>re===L);return q&&Q?j:N in(j.language_options||{})||L in(j.worldview_options||{})?null:j.language_options&&j.worldview_options?j:null}(g.data,d,_);return T?i.o.frame(()=>b(null,T)):g.url?i.m(a.transformRequest(a.normalizeSourceURL(g.url,null,d,_),i.R.Source),b):i.o.frame(()=>{const{data:j,...N}=g;b(null,N)})}function cs(g,a){const d=Math.pow(2,a.z),_=Math.floor(i.aF(g.getWest())*d),y=Math.floor(i.aJ(g.getNorth())*d),b=Math.ceil(i.aF(g.getEast())*d),T=Math.ceil(i.aJ(g.getSouth())*d);return a.x>=_&&a.x<b&&a.y>=y&&a.y<T}class wa{constructor(a,d,_){this.bounds=a?i.aI.convert(this.validateBounds(a)):null,this.minzoom=d||0,this.maxzoom=_||24}validateBounds(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}addExtraBounds(a){if(a){this.extraBounds||(this.extraBounds=[]);for(const d of a)this.extraBounds.push(i.aI.convert(this.validateBounds(d)))}}contains(a){if(a.z>this.maxzoom||a.z<this.minzoom||this.bounds&&!cs(this.bounds,a))return!1;if(!this.extraBounds)return!0;for(const d of this.extraBounds)if(cs(d,a))return!0;return!1}static fromTileJSON(a){if(!a.bounds&&!a.extra_bounds)return null;const d=new wa(a.bounds,a.minzoom,a.maxzoom);return d.addExtraBounds(a.extra_bounds),d}}class ro extends i.E{constructor(a,d,_,y){if(super(),this.id=a,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,i.aH(d,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},d),this._collectResourceTiming=!!d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y),this._tileWorkers={},this._deduped=new i.aK}load(a){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const d=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map.getWorldview();this._tileJSONRequest=Di(this._options,this.map._requestManager,d,_,(y,b)=>{if(this._tileJSONRequest=null,this._loaded=!0,y)d&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${d}`),_&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new i.y(y));else if(b){if(Object.assign(this,b),this.hasWorldviews=!!b.worldview_options,b.worldview_default&&(this.worldviewDefault=b.worldview_default),b.vector_layers){this.vectorLayers=b.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const T of b.vector_layers)this.vectorLayerIds.push(T.id),b.worldview&&b.worldview[T.source]&&this.localizableLayerIds.add(T.id)}this.tileBounds=wa.fromTileJSON(b),ee(b.tiles,this.map._requestManager._customAccessToken),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}a&&a(y)})}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest();const a=i.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(a))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(a){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(a,d){const _=a.tileID.canonical.url(this.tiles,this.scheme),y=this.map._requestManager.normalizeTileURL(_),b=this.map._requestManager.transformRequest(y,i.R.Tile),T=this.map.style?this.map.style.getLut(this.scope):null,j=T?{image:T.image.clone()}:null,N={request:b,data:void 0,uid:a.uid,tileID:a.tileID,tileZoom:a.tileZoom,zoom:a.tileID.overscaledZ,maxZoom:this.maxzoom,lut:j,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:i.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:a.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:a.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&i.h(_)&&(N.localizableLayerIds=this.localizableLayerIds),N.request.collectResourceTiming=this._collectResourceTiming,a.actor&&a.state!=="expired")a.state==="loading"?a.reloadCallback=d:a.request=a.actor.send("reloadTile",N,L.bind(this));else if(a.actor=this._tileWorkers[y]=this._tileWorkers[y]||this.dispatcher.getActor(),this.dispatcher.ready)a.request=a.actor.send("loadTile",N,L.bind(this),void 0,!0);else{const B=i.aL.call({deduped:this._deduped},N,(X,q)=>{if(X||!q)L.call(this,X);else{const Q=i.aM(q.responseHeaders);N.data={cacheControl:Q.cacheControl,expires:Q.expires,rawData:q.rawData.slice(0)},a.actor&&a.actor.send("loadTile",N,L.bind(this),void 0,!0)}},!0);a.request={cancel:B}}function L(B,X){return delete a.request,a.aborted?d(null):B&&B.status!==404?d(B):(X&&X.resourceTiming&&(a.resourceTiming=X.resourceTiming),this.map._refreshExpiredTiles&&X&&a.setExpiryData(X),a.loadVectorData(X,this.map.painter),i.aN(this.dispatcher),d(null,X),void(a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)))}}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(a,d){a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id,scope:this.scope}),a.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ko extends i.E{constructor(a,d,_,y){super(),this.id=a,this.dispatcher=_,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},d),Object.assign(this,i.aH(d,["url","scheme","tileSize"]))}load(a){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const d=this.map.getWorldview();this._tileJSONRequest=Di(this._options,this.map._requestManager,null,d,(_,y)=>{this._tileJSONRequest=null,this._loaded=!0,_?this.fire(new i.y(_)):y&&(Object.assign(this,y),y.raster_layers&&(this.rasterLayers=y.raster_layers,this.rasterLayerIds=this.rasterLayers.map(b=>b.id)),this.tileBounds=wa.fromTileJSON(y),ee(y.tiles),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))),a&&a(_)})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest();const a=i.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(a))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(a){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a,d){const _=i.o.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);a.request=i.n(this.map._requestManager.transformRequest(y,i.R.Tile),(b,T,j)=>{if(delete a.request,a.aborted)return a.state="unloaded",d(null);if(b)return a.state="errored",d(b);if(!T)return d(null);const N=i.aM(j);this.map._refreshExpiredTiles&&a.setExpiryData(N),a.setTexture(T,this.map.painter),a.state="loaded",i.aN(this.dispatcher),d(null)})}abortTile(a,d){a.request&&(a.request.cancel(),delete a.request),d&&d()}unloadTile(a,d){a.texture&&a.texture instanceof i.T?(a.destroy(!0),a.texture&&a.texture instanceof i.T&&this.map.painter.saveTileTexture(a.texture)):a.destroy(),d&&d()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function au([g,a],d,_,{scaled:y=!0}={}){const{tileSize:b,buffer:T}=_,{x:j,y:N,z:L}=d;if(!isFinite(j)||!isFinite(N)||!isFinite(L))throw new Error("Invalid MRT header");const B=2**L,X=B*i.aF(g),q=B*i.aJ(a);return function([Q,re],ae,{scaled:fe=!0}={}){if(!ae)throw new Error("bandView is undefined");const{data:de,tileSize:xe,buffer:je,offset:we,scale:Ve,dimension:Ne}=ae;if(Q<-je||Q>xe+je||re<-je||re>xe+je)throw new Error(`Point (${Q}, ${re}) out of bounds for tileSize=${xe}, buffer=${je}`);const Ge=(re+je)*(xe+2*je)+(Q+je);if(new Uint32Array(de.buffer)[Ge]===4294967295)return null;let Be=[];Be=fe?[]:new ae.data.constructor(Ne);for(let De=0;De<Ne;De++)Be[De]=Math.round(1e12*(de[Ne*Ge+De]*Ve+we))/1e12;return Be}([Math.min(Math.max(-T,Math.floor((X-j)*b)),b-1+T),Math.min(Math.max(-T,Math.floor((q-N)*b)),b-1+T)],_,{scaled:y})}class He extends Ko{constructor(a,d,_,y){super(a,d,_,y),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},d)}triggerRepaint(a){const d=this.map.painter._terrain,_=this.map.style.getSourceCache(this.id);d&&d.enabled&&_&&d._clearRenderCacheForTile(_.id,a.tileID),this.map.triggerRepaint()}loadTile(a,d){const _=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),y=this.map._requestManager.transformRequest(_,i.R.Tile),b={request:y,uid:a.uid,tileID:a.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};a.source=this.id,a.scope=this.scope,a.requestParams=y,a.actor||(a.actor=this.dispatcher.getActor());const T=(j,N,L)=>{if(delete a.request,a.aborted)return a.state="unloaded",d(null);if(j)return j.name==="AbortError"?void 0:(a.state="errored",d(j));if(this.map._refreshExpiredTiles&&N){const B=i.aM(L);a.setExpiryData(B)}if(this.partial&&a.state!=="expired")a.state="empty";else if(!this.partial){if(!N)return d(null);a.state="loaded",a._isHeaderLoaded=!0,a._mrt=N}d(null)};a.request=this.partial?a.fetchHeader(void 0,T.bind(this)):a.actor.send("loadTile",b,T.bind(this),void 0,!0)}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(a,d){const _=a.texturePerLayer;if(a.flushAllQueues(),_.size){a.destroy(!0);for(const y of _.values())this.map.painter.saveTileTexture(y)}else a.destroy()}prepareTile(a,d,_,y){a._isHeaderLoaded&&(a.state!=="empty"&&(a.state="reloading"),a.fetchBandForRender(d,_,y,(b,T)=>{if(b)return a.state="errored",this.fire(new i.y(b)),void this.triggerRepaint(a);T&&(a._isHeaderLoaded=!0,a.setTexturePerLayer(_,T,this.map.painter),a.state="loaded",this.triggerRepaint(a))}))}getInitialBand(a){if(!this.rasterLayers)return 0;const d=this.rasterLayers.find(({id:b})=>b===a),_=d&&d.fields,y=_&&_.bands&&_.bands;return y?y[0]:0}getTextureDescriptor(a,d,_){if(!a)return;const y=d.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!y)return;let b=null;d instanceof i.aQ?b=d.paint.get("raster-array-band"):d instanceof i.aR&&(b=d.paint.get("raster-particle-array-band"));const T=b||this.getInitialBand(y);if(T==null)return;if(!a.textureDescriptorPerLayer.get(d.id))return void this.prepareTile(a,y,d.id,T);if(a.updateNeeded(d.id,T)&&!_)return;const j=a.textureDescriptorPerLayer.get(d.id);return Object.assign({},j,{texture:a.texturePerLayer.get(d.id)})}getImages(a,d){const _=new Map;for(const y of a)for(const b of d){const[T,j]=b.split("/"),N=y.getLayer(T);if(!N||!N.hasBand(j)||!N.hasDataForBand(j))continue;const{bytes:L,tileSize:B,buffer:X}=N.getBandView(j),q=B+2*X,Q={data:new i.q({width:q,height:q},L),pixelRatio:2,sdf:!1,usvg:!1,version:0};_.set(b,Q)}return _}queryRasterArrayValueByBandId(a,d,_){const y=d._mrt;return new Promise(b=>{const T={},j=new Set;for(const[N,L]of Object.entries(y.layers)){if(_.layerName&&N!==_.layerName)continue;const B={};T[N]=B;for(const{bands:X}of L.dataIndex)for(const q of X)_.bands&&!_.bands.includes(q)||(j.add(i.B(N,q)),d.fetchBand(N,null,q,Q=>{i.o.frame(()=>{B[q]=Q?null:au([a.lng,a.lat],y,L.getBandView(q)),j.delete(i.B(N,q)),j.size===0&&b(T)})},!1))}j.size===0&&b(T)})}_loadTileForQuery(a,d){if(this._loadTileLoaded[a.uid])return void d(null,a._mrt);if(this._loadTilePending[a.uid])return void this._loadTilePending[a.uid].push(d);this._loadTilePending[a.uid]=[d];const _=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),y=this.map._requestManager.transformRequest(_,i.R.Tile);a.actor.send("loadTile",{request:y,uid:a.uid,tileID:a.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(b,T,j)=>{if(b)return this._loadTilePending[a.uid].forEach(N=>N(b,null)),void delete this._loadTilePending[a.uid];if(!T)return this._loadTilePending[a.uid].forEach(N=>N(null,null)),void delete this._loadTilePending[a.uid];if(this.map._refreshExpiredTiles&&T){const N=i.aM(j);a.setExpiryData(N)}a._mrt=T,a._isHeaderLoaded=!0,a.state="loaded",this._loadTilePending[a.uid].forEach(N=>N(null,T)),this._loadTileLoaded[a.uid]=!0,delete this._loadTilePending[a.uid]},void 0,!0)}queryRasterArrayValueByAllBands(a,d,_){return new Promise((y,b)=>{this._loadTileForQuery(d,(T,j)=>{T?b(T):y(j?this.queryRasterArrayValueByBandId(a,d,_):null)})})}queryRasterArrayValue(a,d){const _=i.aS.convert(a),y=this.findLoadedParent(_);return y&&y._mrt?d.bands||!this.partial?this.queryRasterArrayValueByBandId(_,y,d):this.queryRasterArrayValueByAllBands(_,y,d):Promise.resolve(null)}findLoadedParent(a){const d=i.ae.fromLngLat(a,this.map.transform.tileSize),_=this.maxzoom+1,y=1<<_,b=Math.floor(d.x),T=Math.floor((d.x-b)*y),j=Math.floor(d.y*y),N=this.map.style.getSourceCache(this.id),L=new i.aP(_,b,_,T,j);return N.findLoadedParent(L,this.minzoom)}}const Et={vector:ro,raster:Ko,"raster-dem":class extends Ko{constructor(g,a,d,_){super(g,a,d,_),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox"}loadTile(g,a){const d=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(y,b){y&&(g.state="errored",a(y)),b&&(g.dem=b,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",a(null))}g.request=i.n(this.map._requestManager.transformRequest(d,i.R.Tile),(function(y,b,T){if(delete g.request,g.aborted)g.state="unloaded",a(null);else if(y)g.state="errored",a(y);else if(b){const j=i.aM(T);this.map._refreshExpiredTiles&&g.setExpiryData(j);const N=ImageBitmap&&b instanceof ImageBitmap&&i.r(),L=1-(b.width-i.aO(b.width))/2;L<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const B=N?b:i.o.getImageData(b,L),X={uid:g.uid,tileID:g.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:B,encoding:this.encoding,padding:L};g.actor&&g.state!=="expired"||(g.actor=this.dispatcher.getActor(),g.actor.send("loadTile",X,_.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(g){const a=g.canonical,d=Math.pow(2,a.z),_=(a.x-1+d)%d,y=a.x===0?g.wrap-1:g.wrap,b=(a.x+1+d)%d,T=a.x+1===d?g.wrap+1:g.wrap,j={};return j[new i.aP(g.overscaledZ,y,a.z,_,a.y).key]={backfilled:!1},j[new i.aP(g.overscaledZ,T,a.z,b,a.y).key]={backfilled:!1},a.y>0&&(j[new i.aP(g.overscaledZ,y,a.z,_,a.y-1).key]={backfilled:!1},j[new i.aP(g.overscaledZ,g.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},j[new i.aP(g.overscaledZ,T,a.z,b,a.y-1).key]={backfilled:!1}),a.y+1<d&&(j[new i.aP(g.overscaledZ,y,a.z,_,a.y+1).key]={backfilled:!1},j[new i.aP(g.overscaledZ,g.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},j[new i.aP(g.overscaledZ,T,a.z,b,a.y+1).key]={backfilled:!1}),j}},"raster-array":He,geojson:class extends i.E{constructor(g,a,d,_){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=d.getActor(),this.setEventedParent(_),this._data=a.data,this._options=Object.assign({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.minzoom!==void 0&&(this.minzoom=a.minzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const y=i.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(a.buffer!==void 0?a.buffer:128)*y,tolerance:(a.tolerance!==void 0?a.tolerance:.375)*y,extent:i.al,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:i.al,radius:(a.clusterRadius!==void 0?a.clusterRadius:50)*y,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter,dynamic:a.dynamic},a.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}updateData(g){if(!this._options.dynamic)return this.fire(new i.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof g!="string"&&(g.type==="Feature"&&(g={type:"FeatureCollection",features:[g]}),g.type!=="FeatureCollection"))return this.fire(new i.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof g!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const a=new Map;for(const d of this._data.features)a.set(d.id,d);for(const d of g.features)a.set(d.id,d);this._data.features=[...a.values()]}else this._data=g;return this._updateWorkerData(!0),this}getClusterExpansionZoom(g,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id,scope:this.scope},a),this}getClusterChildren(g,a){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id,scope:this.scope},a),this}getClusterLeaves(g,a,d,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:g,limit:a,offset:d},_),this}_updateWorkerData(g=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.z("dataloading",{dataType:"source"})),this._loaded=!1;const a=Object.assign({append:g},this.workerOptions);a.scope=this.scope;const d=this._data;typeof d=="string"?(a.request=this.map._requestManager.transformRequest(i.o.resolveURL(d),i.R.Source),a.request.collectResourceTiming=this._collectResourceTiming):a.data=JSON.stringify(d),this._pendingLoad=this.actor.send(`${this.type}.loadData`,a,(_,y)=>{if(this._loaded=!0,this._pendingLoad=null,_)this.fire(new i.y(_));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&y&&y.resourceTiming&&y.resourceTiming[this.id]&&(b.resourceTiming=y.resourceTiming[this.id]),g&&(this._partialReload=!0),this.fire(new i.z("data",b)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(g),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const g=i.B(this.id,this.scope);this.map.style.clearSource(g),this._updateWorkerData()}loadTile(g,a){const d=g.actor?"reloadTile":"loadTile";g.actor=this.actor;const _=this.map.style?this.map.style.getLut(this.scope):null,y=_?{image:_.image.clone()}:null,b=this._partialReload,T={type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:y,scope:this.scope,pixelRatio:i.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:g.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:b,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};g.request=this.actor.send(d,T,(j,N)=>b&&!N?(g.state="loaded",a(null)):(delete g.request,g.destroy(),g.aborted?a(null):j?a(j):(g.loadVectorData(N,this.map.painter,d==="reloadTile"),a(null))),void 0,d==="loadTile")}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g,a){this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id,scope:this.scope}),g.destroy()}onRemove(g){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends i.aT{constructor(g,a,d,_){super(g,a,d,_),this.roundZoom=!0,this.type="video",this.options=a}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const a of g.urls)this.urls.push(this.map._requestManager.transformRequest(a,i.R.Source).url);i.aU(this.urls,(a,d)=>{this._loaded=!0,a?this.fire(new i.y(a)):d&&(this.video=d,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const a=this.video.seekable;g<a.start(0)||g>a.end(0)?this.fire(new i.y(new i.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const g=this.map.painter.context,a=g.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new i.T(g,this.video,a.RGBA8),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:i.aT,model:i.aW,"batched-model":class extends i.E{constructor(g,a,d,_){super(),this.type="batched-model",this.id=g,this.tileSize=512,this._options=a,this.tiles=this._options.tiles,this.maxzoom=a.maxzoom||19,this.minzoom=a.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=d,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(_)}onAdd(g){this.map=g,this.load()}reload(){this.cancelTileJSONRequest();const g=i.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(g))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(g){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map.getWorldview();this._tileJSONRequest=Di(this._options,this.map._requestManager,a,d,(_,y)=>{this._tileJSONRequest=null,this._loaded=!0,_?(a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),d&&d.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new i.y(_))):y&&(Object.assign(this,y),y.bounds&&(this.tileBounds=new wa(y.bounds,this.minzoom,this.maxzoom)),ee(y.tiles,this.map._requestManager._customAccessToken),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))),g&&g(_)})}hasTransition(){return!1}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}loaded(){return this._loaded}loadTile(g,a){const d=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(d,i.R.Tile),data:void 0,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,tileSize:this.tileSize*g.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:g.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:i.o.devicePixelRatio,promoteId:this.promoteId};if(g.actor&&g.state!=="expired")if(g.state==="loading")g.reloadCallback=a;else{if(g.buckets){const b=Object.values(g.buckets);for(const T of b)T.dirty=!0;return void(g.state="loaded")}g.request=g.actor.send("reloadTile",_,y.bind(this))}else g.actor=this.dispatcher.getActor(),g.request=g.actor.send("loadTile",_,y.bind(this),void 0,!0);function y(b,T){return g.aborted?a(null):b&&b.status!==404?a(b):(this.map._refreshExpiredTiles&&T&&g.setExpiryData(T),g.loadModelData(T,this.map.painter),g.state="loaded",void a(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends i.aT{constructor(g,a,d,_){super(g,a,d,_),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(b=>typeof b!="number"))||this.fire(new i.y(new i.V(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.y(new i.V(`sources.${g}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new i.y(new i.V(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new i.y(new i.V(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.y(new i.V(`sources.${g}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(g){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context;this.texture?!g&&!this._playing||this.texture instanceof i.aV||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.T(a,this.canvas,a.gl.RGBA8,{premultiply:!0}),this._prepareData(a)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends i.E{constructor(g,a,d,_){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=d,this._implementation=a,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new wa(this._implementation.bounds,this.minzoom,this.maxzoom)),a.update=this._update.bind(this),a.clearTiles=this._clearTiles.bind(this),a.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,i.aH(a,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this.map=g,this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){const{x:a,y:d,z:_}=g.canonical;return this._implementation.hasTile({x:a,y:d,z:_})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,a){const{x:d,y:_,z:y}=g.tileID.canonical,b=new AbortController;g.request=Promise.resolve(this._implementation.loadTile({x:d,y:_,z:y},{signal:b.signal})).then((function(T){return delete g.request,g.aborted?(g.state="unloaded",a(null)):T===void 0?(g.state="errored",a(null)):T===null?(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",a(null)):function(j){return j instanceof ImageData||j instanceof HTMLCanvasElement||j instanceof ImageBitmap||j instanceof HTMLImageElement}(T)?(this.loadTileData(g,T),g.state="loaded",void a(null)):(g.state="errored",a(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(T=>{T.name!=="AbortError"&&(g.state="errored",a(T))}),g.request.cancel=()=>b.abort()}loadTileData(g,a){g.setTexture(a,this.map.painter)}unloadTile(g,a){if(g.texture&&g.texture instanceof i.T?(g.destroy(!0),g.texture&&g.texture instanceof i.T&&this.map.painter.saveTileTexture(g.texture)):g.destroy(),this._implementation.unloadTile){const{x:d,y:_,z:y}=g.tileID.canonical;this._implementation.unloadTile({x:d,y:_,z:y})}a&&a()}abortTile(g,a){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),a&&a()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z}))}_clearTiles(){const g=i.B(this.id,this.scope);this.map.style.clearSource(g)}_update(){this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}}},lr=function(g,a,d,_){const y=new Et[a.type](g,a,d,_);if(y.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${y.id}`);return i.aX(["load","abort","unload","serialize","prepare"],y),y};function qr(g,a,d=""){return`${d}:${a.id||""}:${a.layer.id}:${function(_){if("layerId"in _)return`layer:${_.layerId}`;{const{featuresetId:y,importId:b}=_;return`featureset:${y}${b?`:import:${b}`:""}`}}(g.target)}`}function oi(g,a,d,_=""){if(g.uniqueFeatureID){const y=qr(g,a,_);if(d.has(y))return!0;d.add(y)}return!1}function Ti(g,a,d,_,y=!1){const b=a.sourceCache.transform,T=a.sourceCache.tilesIn(g,a.has3DLayers,y);T.sort(ba);const j=[];for(const N of T){const L=N.tile.queryRenderedFeatures(a,N,d,_,b,y);Object.keys(L).length&&j.push({wrappedTileID:N.tile.tileID.wrapped().key,queryResults:L})}for(const N in a.layers){const L=a.layers[N];if(L.styleLayer){const B=L.styleLayer.queryRenderedFeatures(g,a.sourceCache,_);Object.keys(B).length&&j.push({wrappedTileID:0,queryResults:B})}}return j.length===0?{}:function(N){const L={},B={};for(const X of N){const q=X.queryResults,Q=X.wrappedTileID,re=B[Q]=B[Q]||{};for(const ae in q){const fe=q[ae],de=re[ae]=re[ae]||{},xe=L[ae]=L[ae]||[];for(const je of fe)de[je.featureIndex]||(de[je.featureIndex]=!0,xe.push(je))}}return L}(j)}function qi(g,a,d,_,y,b){const T={},j=_.queryRenderedSymbols(g),N=[];for(const L of Object.keys(j).map(Number))N.push(y[L]);N.sort(ba);for(const L of N){const B=L.featureIndex.lookupSymbolFeatures(j[L.bucketInstanceId],L.bucketIndex,L.sourceLayerIndex,a,d,b);for(const X in B){const q=T[X]=T[X]||[],Q=B[X];Q.sort((re,ae)=>{const fe=L.featureSortOrder;if(fe){const de=fe.indexOf(re.featureIndex);return fe.indexOf(ae.featureIndex)-de}return ae.featureIndex-re.featureIndex});for(const re of Q)q.push(re)}}return T}function Ms(g,a){const d=g.getRenderableIds().map(b=>g.getTileByID(b)),_=[],y={};for(let b=0;b<d.length;b++){const T=d[b],j=T.tileID.canonical.key;y[j]||(y[j]=!0,T.querySourceFeatures(_,a))}return _}function ba(g,a){const d=g.tileID,_=a.tileID;return d.overscaledZ-_.overscaledZ||d.canonical.y-_.canonical.y||d.wrap-_.wrap||d.canonical.x-_.canonical.x}function Da(g,a){const d={};if(!a)return d;for(const _ of g){const y=_.layerIds.map(b=>a.getLayer(b)).filter(Boolean);if(y.length!==0){_.layers=y,_.stateDependentLayerIds&&(_.stateDependentLayers=_.stateDependentLayerIds.map(b=>y.filter(T=>T.id===b)[0]));for(const b of y)d[b.fqid]=_}}return d}const Hs=32,no=33,Ea=new Uint16Array(8184);for(let g=0;g<2046;g++){let a=g+2,d=0,_=0,y=0,b=0,T=0,j=0;for(1&a?y=b=T=Hs:d=_=j=Hs;(a>>=1)>1;){const L=d+y>>1,B=_+b>>1;1&a?(y=d,b=_,d=T,_=j):(d=y,_=b,y=T,b=j),T=L,j=B}const N=4*g;Ea[N+0]=d,Ea[N+1]=_,Ea[N+2]=y,Ea[N+3]=b}const Fi=new Uint16Array(2178),Va=new Uint8Array(1089),Jo=new Uint16Array(1089);function nc(g){return g===0?-.03125:g===32?.03125:0}const Es={type:2,extent:i.al,loadGeometry:()=>[[new i.P(0,0),new i.P(i.al+1,0),new i.P(i.al+1,i.al+1),new i.P(0,i.al+1),new i.P(0,0)]]};class Sa{constructor(a,d,_,y,b,T){this.tileID=a,this.uid=i.b1(),this.uses=0,this.tileSize=d,this.tileZoom=_,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=b,y&&y.style&&(this._lastUpdatedBrightness=y.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",y&&y.transform&&(this.projection=y.transform.projection),this.worldview=T,this._hasAppearances=null}registerFadeDuration(a){const d=a+this.timeAdded;d<i.o.now()||this.fadeEndTime&&d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=i.aY(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(a,d,_){if(this.unloadVectorData(),this.state="loaded",a){a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=Da(a.buckets,d.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const b=this.buckets[y];if(b instanceof i.b3){if(this.hasSymbolBuckets=!0,!_)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const b=this.buckets[y];if(b instanceof i.b3&&b.hasRTLText){this.hasRTLText=!0,i.b4();break}}this.queryPadding=0;for(const y in this.buckets){const b=this.buckets[y],T=d.style.getOwnLayer(y);if(!T)continue;const j=T.queryRadius(b);this.queryPadding=Math.max(this.queryPadding,j)}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage),a.lineAtlas&&(this.lineAtlas=a.lineAtlas),this._lastUpdatedBrightness=a.brightness}else this.collisionBoxArray=new i.b2}unloadVectorData(){if(this.hasData()){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(a,d,_){a&&(a.resourceTiming&&(this.resourceTiming=a.resourceTiming),this.buckets=Object.assign({},this.buckets,Da(a.buckets,d.style)),a.featureIndex&&(this.latestFeatureIndex=a.featureIndex))}getBucket(a){return this.buckets[a.fqid]}upload(a,d){for(const b in this.buckets){const T=this.buckets[b];if(T.uploadPending()){let j={},N=[],L={zoom:0,pitch:0,brightness:0,worldview:""};if(d){if(d.style){N=d.style.listImages();const B=T.layers[0],X=B.sourceLayer||"_geojsonTileLayer",q=d.style.getLayerSourceCache(B);q&&(j=q._state.getState(X,void 0))}L={zoom:d.transform.zoom||0,pitch:d.transform.pitch||0,brightness:d.style.getBrightness()||0,worldview:d.worldview||""}}T.upload(a,this.tileID.canonical,j,N,L)}}const _=a.gl,y=this.imageAtlas;y&&!y.uploaded&&(this.imageAtlasTexture=new i.T(a,y.image,_.RGBA8,{useMipmap:!!y.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new i.T(a,this.glyphAtlasImage,_.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new i.T(a,this.lineAtlas.image,_.R8),this.lineAtlas.uploaded=!0)}prepare(a,d,_){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture,_),!d||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const y=d.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(d)),(this._lastUpdatedBrightness||y||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&y&&Math.abs(this._lastUpdatedBrightness-y)<.001||(this.updateBuckets(d,this._lastUpdatedBrightness!==y),this._lastUpdatedBrightness=y))}evaluateQueryRenderedFeaturePadding(){let a=0;for(const d in this.buckets){const _=this.buckets[d];_.evaluateQueryRenderedFeaturePadding&&(a=Math.max(a,_.evaluateQueryRenderedFeaturePadding()))}return a}queryRenderedFeatures(a,d,_,y,b,T){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const j=this.evaluateQueryRenderedFeaturePadding(),N=function(L,B){const X=i.bp([],[.5*L.width,.5*-L.height,1]);return i.bq(X,X,[1,-1,0]),i.aB(X,X,L.calculateProjMatrix(B.toUnwrapped())),Float32Array.from(X)}(b,this.tileID);return this.latestFeatureIndex.query(a,{tilespaceGeometry:d,pixelPosMatrix:N,transform:y,availableImages:_,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:j})}querySourceFeatures(a,d){const _=this.latestFeatureIndex;if(!_||!_.rawTileData)return;const y=_.loadVTLayers(),b=d?d.sourceLayer:"",T=y._geojsonTileLayer||y[b];if(!T)return;const j=i.b5(d&&d.filter),{z:N,x:L,y:B}=this.tileID.canonical,X={z:N,x:L,y:B};for(let q=0;q<T.length;q++){const Q=T.feature(q);if(j.needGeometry){const fe=i.b6(Q,!0);if(!j.filter(new i.ac(this.tileID.overscaledZ,{worldview:this.worldview}),fe,this.tileID.canonical))continue}else if(!j.filter(new i.ac(this.tileID.overscaledZ,{worldview:this.worldview}),Q))continue;const re=_.getId(Q,b),ae=new i.b7(Q,N,L,B,re);ae.tile=X,a.push(ae)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(a){const d=this.expirationTime;if(a.cacheControl){const _=i.b8(a.cacheControl);_["max-age"]&&(this.expirationTime=Date.now()+1e3*_["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){const _=Date.now();let y=!1;if(this.expirationTime>_)y=!1;else if(d)if(this.expirationTime<d)y=!0;else{const b=this.expirationTime-d;b?this.expirationTime=_+Math.max(b,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(a){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&a&&this.updateBuckets(a)}hasAppearances(a){for(const d in this.buckets)if(a.style.hasLayer(d)&&this.buckets[d].layers.some(_=>_.appearances&&_.appearances.length>0))return!0;return!1}updateBuckets(a,d){if(!this.latestFeatureIndex||!a.style)return;const _=this.latestFeatureIndex.loadVTLayers(),y=a.style.listImages(),b=a.style.getBrightness();for(const T in this.buckets){if(!a.style.hasLayer(T))continue;const j=this.buckets[T],N=j.layers[0],L=N.sourceLayer||"_geojsonTileLayer",B=_[L],X=a.style.getLayerSourceCache(N);let q={};X&&(q=X._state.getState(L,void 0));const Q=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},re=Object.keys(q).length>0&&!d;if(j.hasAppearances=j.layers.some(fe=>fe.appearances&&fe.appearances.length>0),(re&&j.stateDependentLayers.length!==0||d)&&j.update(q,B,y,Q,re?j.stateDependentLayers:j.layers,d,b),re&&j.stateDependentLayers.length!==0||d||j.hasAppearances){const fe={zoom:a.transform.zoom,pitch:a.transform.pitch,brightness:a.style.getBrightness()||0,worldview:a.worldview};j.updateAppearances(this.tileID.canonical,q,y,fe)}(j instanceof i.b9||j instanceof i.ba)&&a._terrain&&a._terrain.enabled&&X&&j.uploadPending()&&a._terrain._clearRenderCacheForTile(X.id,this.tileID);const ae=a&&a.style&&a.style.getOwnLayer(T);ae&&(this.queryPadding=Math.max(this.queryPadding,ae.queryRadius(j)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<i.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(a){this.symbolFadeHoldUntil=i.o.now()+a}setTexture(a,d){const _=d.context,y=_.gl;this.texture=this.texture||d.getTileTexture(a.width),this.texture&&this.texture instanceof i.T?this.texture.update(a):(this.texture=new i.T(_,a,y.RGBA8,{useMipmap:!0}),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE))}setDependencies(a,d){const _={};for(const y of d)_[y]=!0;this.dependencies[a]=_}hasDependency(a,d){for(const _ of a){const y=this.dependencies[_];if(y){for(const b of d)if(y[b])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(a,d){if(!d||d.name==="mercator"||this._tileDebugBuffer)return;const _=i.bb(Es,this.tileID.canonical,this.tileTransform)[0],y=new i.bc,b=new i.bd;for(let T=0;T<_.length;T++){const{x:j,y:N}=_[T];y.emplaceBack(j,N),b.emplaceBack(T)}b.emplaceBack(0),this._tileDebugIndexBuffer=a.createIndexBuffer(b),this._tileDebugBuffer=a.createVertexBuffer(y,i.be.members),this._tileDebugSegments=i.bf.simpleSegment(0,0,y.length,b.length)}_makeTileBoundsBuffers(a,d){if(this._tileBoundsBuffer||!d||d.name==="mercator")return;const _=i.bb(Es,this.tileID.canonical,this.tileTransform)[0];let y,b;if(this.isRaster){const T=function(j,N){const L=i.aY(j,N),B=Math.pow(2,j.z);for(let fe=0;fe<no;fe++)for(let de=0;de<no;de++){const xe=i.aZ((j.x+(de+nc(de))/Hs)/B),je=i.a_((j.y+(fe+nc(fe))/Hs)/B),we=N.project(xe,je),Ve=fe*no+de;Fi[2*Ve+0]=Math.round((we.x*L.scale-L.x)*i.al),Fi[2*Ve+1]=Math.round((we.y*L.scale-L.y)*i.al)}Va.fill(0),Jo.fill(0);for(let fe=2045;fe>=0;fe--){const de=4*fe,xe=Ea[de+0],je=Ea[de+1],we=Ea[de+2],Ve=Ea[de+3],Ne=xe+we>>1,Ge=je+Ve>>1,Be=Ne+Ge-je,De=Ge+xe-Ne,We=je*no+xe,st=Ve*no+we,rt=Ge*no+Ne,bt=Math.hypot((Fi[2*We+0]+Fi[2*st+0])/2-Fi[2*rt+0],(Fi[2*We+1]+Fi[2*st+1])/2-Fi[2*rt+1])>=16;Va[rt]=Va[rt]||(bt?1:0),fe<1022&&(Va[rt]=Va[rt]||Va[(je+De>>1)*no+(xe+Be>>1)]||Va[(Ve+De>>1)*no+(we+Be>>1)])}const X=new i.a$,q=new i.b0;let Q=0;function re(fe,de){const xe=de*no+fe;return Jo[xe]===0&&(X.emplaceBack(Fi[2*xe+0],Fi[2*xe+1],fe*i.al/Hs,de*i.al/Hs),Jo[xe]=++Q),Jo[xe]-1}function ae(fe,de,xe,je,we,Ve){const Ne=fe+xe>>1,Ge=de+je>>1;if(Math.abs(fe-we)+Math.abs(de-Ve)>1&&Va[Ge*no+Ne])ae(we,Ve,fe,de,Ne,Ge),ae(xe,je,we,Ve,Ne,Ge);else{const Be=re(fe,de),De=re(xe,je),We=re(we,Ve);q.emplaceBack(Be,De,We)}}return ae(0,0,Hs,Hs,Hs,0),ae(Hs,Hs,0,0,0,Hs),{vertices:X,indices:q}}(this.tileID.canonical,d);y=T.vertices,b=T.indices}else{y=new i.a$,b=new i.b0;for(const{x:j,y:N}of _)y.emplaceBack(j,N,0,0);const T=i.bg(y.int16.subarray(0,4*y.length),void 0,4);for(let j=0;j<T.length;j+=3)b.emplaceBack(T[j],T[j+1],T[j+2])}this._tileBoundsBuffer=a.createVertexBuffer(y,i.bh.members),this._tileBoundsIndexBuffer=a.createIndexBuffer(b),this._tileBoundsSegments=i.bf.simpleSegment(0,0,y.length,b.length)}_makeGlobeTileDebugBuffers(a,d){const _=d.projection;if(!_||_.name!=="globe"||d.freezeTileCoverage)return;const y=this.tileID.canonical,b=i.bi(y,d),T=i.bj(b),j=i.aj(d.zoom);let N;j>0&&(N=i.bk(new Float64Array(16),d.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(a,y,d,T,N,j),this._makeGlobeTileDebugTextBuffer(a,y,d,T,N,j)}_globePoint(a,d,_,y,b,T,j){let N=i.bl(a,d,_);if(T){const L=1<<_.z,B=i.aF(y.center.lng),X=i.aJ(y.center.lat),q=(_.x+.5)/L-B;let Q=0;q>.5?Q=-1:q<-.5&&(Q=1);let re=(a/i.al+_.x)/L+Q,ae=(d/i.al+_.y)/L;re=(re-B)*y._pixelsPerMercatorPixel+B,ae=(ae-X)*y._pixelsPerMercatorPixel+X;const fe=[re*y.worldSize,ae*y.worldSize,0];i.af(fe,fe,T),N=i.bm(N,fe,j)}return i.af(N,N,b)}_makeGlobeTileDebugBorderBuffer(a,d,_,y,b,T){const j=new i.bc,N=new i.bd,L=new i.bn,B=(q,Q,re,ae,fe)=>{const de=(re-q)/(fe-1),xe=(ae-Q)/(fe-1),je=j.length;for(let we=0;we<fe;we++){const Ve=q+we*de,Ne=Q+we*xe;j.emplaceBack(Ve,Ne);const Ge=this._globePoint(Ve,Ne,d,_,y,b,T);L.emplaceBack(Ge[0],Ge[1],Ge[2]),N.emplaceBack(je+we)}},X=i.al;B(0,0,X,0,16),B(X,0,X,X,16),B(X,X,0,X,16),B(0,X,0,0,16),this._tileDebugIndexBuffer=a.createIndexBuffer(N),this._tileDebugBuffer=a.createVertexBuffer(j,i.be.members),this._globeTileDebugBorderBuffer=a.createVertexBuffer(L,i.bo.members),this._tileDebugSegments=i.bf.simpleSegment(0,0,j.length,N.length)}_makeGlobeTileDebugTextBuffer(a,d,_,y,b,T){const j=i.al/4,N=new i.bc,L=new i.b0,B=new i.bn,X=25;L.reserve(32),N.reserve(X),B.reserve(X);const q=(Q,re)=>X*Q+re;for(let Q=0;Q<X;Q++){const re=Q*j;for(let ae=0;ae<X;ae++){const fe=ae*j;N.emplaceBack(fe,re);const de=this._globePoint(fe,re,d,_,y,b,T);B.emplaceBack(de[0],de[1],de[2])}}for(let Q=0;Q<4;Q++)for(let re=0;re<4;re++){const ae=q(Q,re),fe=q(Q,re+1),de=q(Q+1,re),xe=q(Q+1,re+1);L.emplaceBack(ae,fe,de),L.emplaceBack(de,fe,xe)}this._tileDebugTextIndexBuffer=a.createIndexBuffer(L),this._tileDebugTextBuffer=a.createVertexBuffer(N,i.be.members),this._globeTileDebugTextBuffer=a.createVertexBuffer(B,i.bo.members),this._tileDebugTextSegments=i.bf.simpleSegment(0,0,X,32)}destroy(a=!1){for(const d in this.buckets)this.buckets[d].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!a&&this.texture&&this.texture instanceof i.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}i.br.setPbf(i.bs);class Bo extends Sa{constructor(a,d,_,y,b){super(a,d,_,y,b),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(a){return this._mrt&&this._mrt.getLayer(a)}setTexturePerLayer(a,d,_){const y=_.context,b=y.gl;let T=this.texturePerLayer.get(a)||_.getTileTexture(d.width);T&&T instanceof i.T?T.update(d,{premultiply:!1}):T=new i.T(y,d,b.RGBA8,{premultiply:!1}),this.texturePerLayer.has(a)||this.texturePerLayer.set(a,T)}flushQueues(a){const d=this._workQueuePerLayer.get(a)||[],_=this._fetchQueuePerLayer.get(a)||[];for(;d.length;)d.pop()();for(;_.length;)_.pop()()}flushAllQueues(){for(const a of this._workQueuePerLayer.keys()){const d=this._workQueuePerLayer.get(a)||[];for(;d.length;)d.pop()()}for(const a of this._fetchQueuePerLayer.keys()){const d=this._fetchQueuePerLayer.get(a)||[];for(;d.length;)d.pop()()}}fetchHeader(a=16384,d){const _=this._mrt=new i.br(30),y=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(a-1)}});return this.entireBuffer=null,this.request=i.bt(y,(b,T,j)=>{if(b)d(b);else try{const N=_.getHeaderLength(T);if(N>a)return void(this.request=this.fetchHeader(N,d));_.parseHeader(T),this._isHeaderLoaded=!0;let L=0;for(const B of Object.values(_.layers))L=Math.max(L,B.dataIndex[B.dataIndex.length-1].lastByte);T.byteLength>=L&&(this.entireBuffer=T),d(null,this.entireBuffer||T,j)}catch(N){d(N)}}),this.request}fetchBandForRender(a,d,_,y){this.fetchBand(a,d,_,b=>{if(b)return void y(b);this.updateTextureDescriptor(a,d,_);const T=this.textureDescriptorPerLayer.get(d);y(null,T?T.img:null)})}fetchBand(a,d,_,y,b=!0){const T=this._mrt;if(!this._isHeaderLoaded||!T)return void y(new Error("Tile header is not ready"));const j=this.actor;if(!j)return void y(new Error("Can't fetch tile band without an actor"));let N;const L=i.B(String(_),i.B(this.tileID.key,a));let B=this._taskQueue.get(L);B?B.add(y):(B=new Set,B.add(y),this._taskQueue.set(L,B));const X=(ae,fe)=>{N.complete(ae,fe),ae?y(ae):(B.values().forEach(de=>de(null,fe)),this._taskQueue.delete(L))},q=(ae,fe)=>{if(ae)return y(ae);const de=j.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:fe,task:N},X,void 0,!0);if(d!==null){const xe=this._workQueuePerLayer.get(d)||[];xe.push(()=>{de&&de.cancel(),N.cancel()}),this._workQueuePerLayer.has(d)||this._workQueuePerLayer.set(d,xe)}};let Q;try{Q=T.getLayer(a)}catch(ae){if(this.state==="reloading")return;throw ae}if(!Q)return void y(new Error(`Unknown sourceLayer "${a}"`));if(Q.hasDataForBand(_))return B.values().forEach(ae=>ae(null,null)),void this._taskQueue.delete(L);const re=Q.getDataRange([_]);if(N=T.createDecodingTask(re),!N||N.tasks.length)if(d!==null&&this.flushQueues(d),this.entireBuffer)q(null,this.entireBuffer.slice(re.firstByte,re.lastByte+1));else{const ae=Object.assign({},this.requestParams,{headers:{Range:`bytes=${re.firstByte}-${re.lastByte}`}}),fe=i.bt(ae,q);if(d!==null){const de=this._fetchQueuePerLayer.get(d)||[];de.push(()=>{fe.cancel(),N.cancel()}),this._fetchQueuePerLayer.has(d)||this._fetchQueuePerLayer.set(d,de)}}}updateNeeded(a,d){return(!this.textureDescriptorPerLayer.get(a)||this.textureDescriptorPerLayer.get(a).band!==d||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(a,d,_){if(!this._mrt)return;const y=this._mrt.getLayer(a);if(!y||!y.hasBand(_)||!y.hasDataForBand(_))return;const{bytes:b,tileSize:T,buffer:j,offset:N,scale:L}=y.getBandView(_),B=T+2*j,X=new i.q({width:B,height:B},b),q=this.texturePerLayer.get(d);q&&q instanceof i.T&&q.update(X,{premultiply:!1}),this.textureDescriptorPerLayer.set(d,{layer:a,band:_,img:X,buffer:j,offset:N,tileSize:T,format:y.pixelFormat,mix:[L,256*L,65536*L,16777216*L]})}destroy(a=!1){if(super.destroy(a),delete this._mrt,!a)for(const d of this.texturePerLayer.values())d&&d instanceof i.T&&d.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class ta{constructor(a,d){this.max=a,this.onRemove=d,this.reset()}reset(){for(const a in this.data)for(const d of this.data[a])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(a,d,_){const y=a.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const b={value:d,timeout:void 0};if(_!==void 0&&(b.timeout=setTimeout(()=>{this.remove(a,b)},_)),this.data[y].push(b),this.order.push(y),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(a){return a.wrapped().key in this.data}getAndRemove(a){return this.has(a)?this._getAndRemoveByKey(a.wrapped().key):null}_getAndRemoveByKey(a){const d=this.data[a].shift();return d.timeout&&clearTimeout(d.timeout),this.data[a].length===0&&delete this.data[a],this.order.splice(this.order.indexOf(a),1),d.value}getByKey(a){const d=this.data[a];return d?d[0].value:null}get(a){return this.has(a)?this.data[a.wrapped().key][0].value:null}remove(a,d){if(!this.has(a))return this;const _=a.wrapped().key,y=d===void 0?0:this.data[_].indexOf(d),b=this.data[_][y];return this.data[_].splice(y,1),b.timeout&&clearTimeout(b.timeout),this.data[_].length===0&&delete this.data[_],this.onRemove(b.value),this.order.splice(this.order.indexOf(_),1),this}setMaxSize(a){for(this.max=a;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(a){const d=[];for(const _ in this.data)for(const y of this.data[_])a(y.value)||d.push(y);for(const _ of d)this.remove(_.value.tileID,_)}}class kd{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(a,d,_){const y=String(d);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][y]=this.stateChanges[a][y]||{},Object.assign(this.stateChanges[a][y],_),this.deletedStates[a]===null){this.deletedStates[a]={};for(const b in this.state[a])b!==y&&(this.deletedStates[a][b]=null)}else if(this.deletedStates[a]&&this.deletedStates[a][y]===null){this.deletedStates[a][y]={};for(const b in this.state[a][y])_[b]||(this.deletedStates[a][y][b]=null)}else for(const b in _)this.deletedStates[a]&&this.deletedStates[a][y]&&this.deletedStates[a][y][b]===null&&delete this.deletedStates[a][y][b]}removeFeatureState(a,d,_){if(this.deletedStates[a]===null)return;const y=String(d);if(this.deletedStates[a]=this.deletedStates[a]||{},_&&d!==void 0)this.deletedStates[a][y]!==null&&(this.deletedStates[a][y]=this.deletedStates[a][y]||{},this.deletedStates[a][y][_]=null);else if(d!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][y])for(_ in this.deletedStates[a][y]={},this.stateChanges[a][y])this.deletedStates[a][y][_]=null;else this.deletedStates[a][y]=null;else this.deletedStates[a]=null}getState(a,d){const _=this.state[a]||{},y=this.stateChanges[a]||{},b=this.deletedStates[a];if(b===null)return{};if(d!==void 0){const j=String(d),N=Object.assign({},_[j],y[j]);if(b){const L=b[d];if(L===null)return{};for(const B in L)delete N[B]}return N}const T=Object.assign({},_,y);if(b)for(const j in b)delete T[j];return T}initializeTileState(a,d){a.refreshFeatureState(d)}coalesceChanges(a,d){const _={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const b={};for(const T in this.stateChanges[y])this.state[y][T]||(this.state[y][T]={}),Object.assign(this.state[y][T],this.stateChanges[y][T]),b[T]=this.state[y][T];_[y]=b}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const b={};if(this.deletedStates[y]===null)for(const T in this.state[y])b[T]={},this.state[y][T]={};else for(const T in this.deletedStates[y]){if(this.deletedStates[y][T]===null)this.state[y][T]={};else if(this.state[y][T])for(const j of Object.keys(this.deletedStates[y][T]))delete this.state[y][T][j];b[T]=this.state[y][T]}_[y]=_[y]||{},Object.assign(_[y],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(_).length!==0)for(const y in a)a[y].refreshFeatureState(d)}}class Qo extends i.E{constructor(a,d,_){super(),this.id=a,this._onlySymbols=_,d.on("data",y=>{y.dataType==="source"&&y.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&y.dataType==="source"&&y.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),d.on("error",()=>{this._sourceErrored=!0}),this._source=d,this._tiles={},this._cache=new ta(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new kd,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(a){this.map=a,this._minTileCacheSize=this._minTileCacheSize===void 0&&a?a._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&a?a._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const a in this._tiles)if(!this._tiles[a].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const a=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,a&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(a,d){return a.isSymbolTile=this._onlySymbols,a.isExtraShadowCaster=this._shadowCasterTiles[a.tileID.key],this._source.loadTile(a,d)}_unloadTile(a){if(this._source.unloadTile)return this._source.unloadTile(a)}_abortTile(a){if(this._source.abortTile)return this._source.abortTile(a)}serialize(){return this._source.serialize()}prepare(a){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const _=this._tiles[d];_.upload(a,this.map?this.map.painter:void 0),_.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(a=>a.tileID).sort(Af).map(a=>a.key)}getRenderableIds(a,d){const _=[];for(const y in this._tiles)this._isIdRenderable(+y,a,d)&&_.push(this._tiles[y]);return a?_.sort((y,b)=>{const T=y.tileID,j=b.tileID,N=new i.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle),L=new i.P(j.canonical.x,j.canonical.y)._rotate(this.transform.angle);return T.overscaledZ-j.overscaledZ||L.y-N.y||L.x-N.x}).map(y=>y.tileID.key):_.map(y=>y.tileID).sort(Af).map(y=>y.key)}hasRenderableParent(a){const d=this.findLoadedParent(a,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(a,d,_){return this._tiles[a]&&this._tiles[a].hasData()&&!this._coveredTiles[a]&&(d||!this._tiles[a].holdingForFade())&&(_||!this._shadowCasterTiles[a])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const a in this._tiles)this._tiles[a].state!=="errored"&&this._reloadTile(+a,"reloading")}}_reloadTile(a,d){const _=this._tiles[a];_&&(_.state!=="loading"&&(_.state=d),this._loadTile(_,this._tileLoaded.bind(this,_,a,d)))}_tileLoaded(a,d,_,y,b){if(y){if(a.state="errored",y.status!==404)this._source.fire(new i.y(y,{tile:a}));else{if(this._source.fire(new i.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:a})),!(a.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const j=this.map.painter.terrain;this.update(this.transform,j.getScaledDemTileSize(),!0),j.resetTileLookupCache(this.id)}else this.update(this.transform)}return}a.timeAdded=i.o.now(),_==="expired"&&(a.refreshedUponExpiration=!0),this._setTileReloadTimer(d,a),this._source.type==="raster-dem"&&a.dem&&this._backfillDEM(a),this._state.initializeTileState(a,this.map?this.map.painter:null);let T=new Map;b&&b.responseHeaders&&(T=b.responseHeaders),this._source.fire(new i.z("data",{dataType:"source",tile:a,coord:a.tileID,sourceCacheId:this.id,responseHeaders:T}))}_backfillDEM(a){const d=this.getRenderableIds();for(let y=0;y<d.length;y++){const b=d[y];if(a.neighboringTiles&&a.neighboringTiles[b]){const T=this.getTileByID(b);_(a,T),_(T,a)}}function _(y,b){if(!y.dem||y.dem.borderReady)return;y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0;let T=b.tileID.canonical.x-y.tileID.canonical.x;const j=b.tileID.canonical.y-y.tileID.canonical.y,N=Math.pow(2,y.tileID.canonical.z),L=b.tileID.key;T===0&&j===0||Math.abs(j)>1||(Math.abs(T)>1&&(Math.abs(T+N)===1?T+=N:Math.abs(T-N)===1&&(T-=N)),b.dem&&y.dem&&(y.dem.backfillBorder(b.dem,T,j),y.neighboringTiles&&y.neighboringTiles[L]&&(y.neighboringTiles[L].backfilled=!0)))}}getTile(a){return this.getTileByID(a.key)}getTileByID(a){return this._tiles[a]}_retainLoadedChildren(a,d,_,y){for(const b in this._tiles){let T=this._tiles[b];if(y[b]||!T.hasData()||T.tileID.overscaledZ<=d||T.tileID.overscaledZ>_)continue;let j=T.tileID;for(;T&&T.tileID.overscaledZ>d+1;){const L=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[L.key],T&&T.hasData()&&(j=L)}let N=j;for(;N.overscaledZ>d;)if(N=N.scaledTo(N.overscaledZ-1),a[N.key]){y[j.key]=j;break}}}findLoadedParent(a,d){if(a.key in this._loadedParentTiles){const _=this._loadedParentTiles[a.key];return _&&_.tileID.overscaledZ>=d?_:null}for(let _=a.overscaledZ-1;_>=d;_--){const y=a.scaledTo(_),b=this._getLoadedTile(y);if(b)return b}}_getLoadedTile(a){const d=this._tiles[a.key];return d&&d.hasData()?d:this._cache.getByKey(this._source.reparseOverscaled?a.wrapped().key:a.canonical.key)}updateCacheSize(a,d){d=d||this._source.tileSize;const _=Math.ceil(a.width/d)+1,y=Math.ceil(a.height/d)+1,b=Math.floor(_*y*5),T=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,b):b,j=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,T):T;this._cache.setMaxSize(j)}handleWrapJump(a){const d=Math.round((a-(this._prevLng===void 0?a:this._prevLng))/360);if(this._prevLng=a,d){const _={};for(const y in this._tiles){const b=this._tiles[y];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+d),_[b.tileID.key]=b}this._tiles=_;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(+y,this._tiles[y])}}update(a,d,_,y,b){if(this.transform=a,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!_)return;this.updateCacheSize(a,d),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const T=this._source.type==="batched-model";let j,N=this._source.maxzoom;const L=this.map&&this.map.painter?this.map.painter._terrain:null;if(L&&L.sourceCache===this&&L.attenuationRange()){const q=L.attenuationRange()[0],Q=Math.floor(q)-Math.log2(L.getDemUpscale());N>Q&&(N=Q)}if(this.used||this.usedForTerrain){if(this._source.tileID)j=a.getVisibleUnwrappedCoordinates(this._source.tileID).map(q=>new i.aP(q.canonical.z,q.wrap,q.canonical.z,q.canonical.x,q.canonical.y));else if(this.tileCoverLift!==0){const q=a.clone();q.tileCoverLift=this.tileCoverLift,j=q.coveringTiles({tileSize:d||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:N,roundZoom:this._source.roundZoom&&!_,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:T}),this._source.minzoom<=1&&a.projection.name==="globe"&&(j.push(new i.aP(1,0,1,0,0)),j.push(new i.aP(1,0,1,1,0)),j.push(new i.aP(1,0,1,0,1)),j.push(new i.aP(1,0,1,1,1)))}else if(j=a.coveringTiles({tileSize:d||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:N,roundZoom:this._source.roundZoom&&!_,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:T}),this._source.hasTile){const q=this._source.hasTile.bind(this._source);j=j.filter(Q=>q(Q))}}else j=[];if(j.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!yh(this._source.type)){const q=a.coveringZoomLevel({tileSize:d||this._source.tileSize,roundZoom:this._source.roundZoom&&!_}),Q=Math.min(q,this._source.maxzoom);if(T){const re=a.extendTileCover(j,Q);for(const ae of re)j.push(ae)}else if(b){const re=a.extendTileCoverToNearPlane(j,this.transform.getFrustum(Q),Q);for(const ae of re)j.push(ae)}else if(this.castsShadows&&y){const re=a.extendTileCover(j,Q,y);for(const ae of re)this._shadowCasterTiles[ae.key]=!0,j.push(ae)}}const B=this._updateRetainedTiles(j);if(yh(this._source.type)&&j.length!==0){const q={},Q={},re=Object.keys(B);for(const fe of re){const de=B[fe],xe=this._tiles[fe];if(!xe||xe.fadeEndTime&&xe.fadeEndTime<=i.o.now())continue;const je=this.findLoadedParent(de,Math.max(de.overscaledZ-Qo.maxOverzooming,this._source.minzoom));je&&(this._addTile(je.tileID),q[je.tileID.key]=je.tileID),Q[fe]=de}const ae=j[j.length-1].overscaledZ;for(const fe in this._tiles){const de=this._tiles[fe];if(B[fe]||!de.hasData())continue;let xe=de.tileID;for(;xe.overscaledZ>ae;){xe=xe.scaledTo(xe.overscaledZ-1);const je=this._tiles[xe.key];if(je&&je.hasData()&&Q[xe.key]){B[fe]=de.tileID;break}}}for(const fe in q)B[fe]||(this._coveredTiles[fe]=!0,B[fe]=q[fe])}for(const q in B)this._tiles[q].clearFadeHold();const X=i.bu(this._tiles,B);for(const q of X){const Q=this._tiles[q];Q.hasSymbolBuckets&&!Q.holdingForFade()?Q.setHoldDuration(this.map._fadeDuration):Q.hasSymbolBuckets&&!Q.symbolFadeFinished()||this._removeTile(+q)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const a in this._tiles)this._tiles[a].holdingForFade()&&this._removeTile(+a)}_updateRetainedTiles(a){const d={};if(a.length===0)return d;const _={},y=a.reduce((L,B)=>Math.min(L,B.overscaledZ),1/0),b=a[0].overscaledZ,T=Math.max(b-Qo.maxOverzooming,this._source.minzoom),j=Math.max(b+Qo.maxUnderzooming,this._source.minzoom),N={};for(const L of a){const B=this._addTile(L);d[L.key]=L,B.hasData()||y<this._source.maxzoom&&(N[L.key]=L)}this._retainLoadedChildren(N,y,j,d);for(const L of a){let B=this._tiles[L.key];if(B.hasData())continue;if(L.canonical.z>=this._source.maxzoom){const q=L.children(this._source.maxzoom)[0],Q=this.getTile(q);if(Q&&Q.hasData()){d[q.key]=q;continue}}else{const q=L.children(this._source.maxzoom);if(d[q[0].key]&&d[q[1].key]&&d[q[2].key]&&d[q[3].key])continue}let X=B.wasRequested();for(let q=L.overscaledZ-1;q>=T;--q){const Q=L.scaledTo(q);if(_[Q.key]||(_[Q.key]=!0,B=this.getTile(Q),!B&&X&&(B=this._addTile(Q)),B&&(d[Q.key]=Q,X=B.wasRequested(),B.hasData())))break}}return d}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const a in this._tiles){const d=[];let _,y=this._tiles[a].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){_=this._loadedParentTiles[y.key];break}d.push(y.key);const b=y.scaledTo(y.overscaledZ-1);if(_=this._getLoadedTile(b),_)break;y=b}for(const b of d)this._loadedParentTiles[b]=_}}_addTile(a){let d=this._tiles[a.key];if(d)return d.isExtraShadowCaster!==!0||this._shadowCasterTiles[a.key]||this._reloadTile(a.key,"reloading"),d;d=this._cache.getAndRemove(a),d&&(this._setTileReloadTimer(a.key,d),d.tileID=a,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[a.key]&&(clearTimeout(this._cacheTimers[a.key]),delete this._cacheTimers[a.key],this._setTileReloadTimer(a.key,d)));const _=!!d;if(!_){const y=this.map?this.map.painter:null,b=this._source.tileSize*a.overscaleFactor();d=this._source.type==="raster-array"?new Bo(a,b,this.transform.tileZoom,y,this._isRaster):new Sa(a,b,this.transform.tileZoom,y,this._isRaster,this._source.worldview),this._loadTile(d,this._tileLoaded.bind(this,d,a.key,d.state))}return d.uses++,this._tiles[a.key]=d,_||this._source.fire(new i.z("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(a,d){a in this._timers&&(clearTimeout(this._timers[a]),delete this._timers[a]);const _=d.getExpiryTimeout();_&&(this._timers[a]=setTimeout(()=>{this._reloadTile(a,"expired"),delete this._timers[a]},_))}_removeTile(a){const d=this._tiles[a];d&&(d.uses--,delete this._tiles[a],this._timers[a]&&(clearTimeout(this._timers[a]),delete this._timers[a]),d.uses>0||(d.hasData()&&d.state!=="reloading"||d.state==="empty"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const a in this._tiles)this._removeTile(+a);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(a,d,_){const y=[],b=this.transform;if(!b)return y;const T=b.projection.name==="globe",j=i.aF(b.center.lng);for(const N in this._tiles){const L=this._tiles[N];if(_&&L.clearQueryDebugViz(),L.holdingForFade())continue;let B;if(T){const X=L.tileID.canonical;if(X.z===0){const q=[Math.abs(i.aA(j,...wh(X,-1))-j),Math.abs(i.aA(j,...wh(X,1))-j)];B=[0,2*q.indexOf(Math.min(...q))-1]}else{const q=[Math.abs(i.aA(j,...wh(X,-1))-j),Math.abs(i.aA(j,...wh(X,0))-j),Math.abs(i.aA(j,...wh(X,1))-j)];B=[q.indexOf(Math.min(...q))-1]}}else B=[0];for(const X of B){const q=a.containsTile(L,b,d,X);q&&y.push(q)}}return y}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(a){return this._getRenderableCoordinates(a)}_getRenderableCoordinates(a,d){const _=this.getRenderableIds(a,d).map(b=>this._tiles[b].tileID),y=this.transform.projection.name==="globe";for(const b of _)b.projMatrix=this.transform.calculateProjMatrix(b.toUnwrapped()),b.expandedProjMatrix=y?this.transform.calculateProjMatrix(b.toUnwrapped(),!1,!0):b.projMatrix;return _}sortCoordinatesByDistance(a){const d=a.slice(),_=this.transform._camera.position,y=this.transform._camera.forward(),b={};for(const T of d){const j=1/(1<<T.canonical.z);b[T.key]=((T.canonical.x+.5)*j+T.wrap-_[0])*y[0]+((T.canonical.y+.5)*j-_[1])*y[1]-_[2]*y[2]}return d.sort((T,j)=>b[T.key]-b[j.key]),d}hasTransition(){if(this._source.hasTransition())return!0;if(yh(this._source.type))for(const a in this._tiles){const d=this._tiles[a];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=i.o.now())return!0}return!1}setFeatureState(a,d,_){this._state.updateState(a=a||"_geojsonTileLayer",d,_)}removeFeatureState(a,d,_){this._state.removeFeatureState(a=a||"_geojsonTileLayer",d,_)}getFeatureState(a,d){return this._state.getState(a=a||"_geojsonTileLayer",d)}setDependencies(a,d,_){const y=this._tiles[a];y&&y.setDependencies(d,_)}reloadTilesForDependencies(a,d){for(const _ in this._tiles)this._tiles[_].hasDependency(a,d)&&this._reloadTile(+_,"reloading");this._cache.filter(_=>!_.hasDependency(a,d))}_preloadTiles(a,d){if(!this._sourceLoaded){const N=()=>{this._sourceLoaded&&(this._source.off("data",N),this._preloadTiles(a,d))};return void this._source.on("data",N)}const _=new Map,y=Array.isArray(a)?a:[a],b=this.map.painter.terrain,T=this.usedForTerrain&&b?b.getScaledDemTileSize():this._source.tileSize;for(const N of y){const L=N.coveringTiles({tileSize:T,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const B of L)_.set(B.key,B);this.usedForTerrain&&N.updateElevation(!1)}const j=Array.from(_.values());i.bv(j,(N,L)=>{const B=new Sa(N,this._source.tileSize*N.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(B,X=>{this._source.type==="raster-dem"&&B.dem&&this._backfillDEM(B),L(X,B)})},d)}}function Af(g,a){const d=Math.abs(2*g.wrap)-+(g.wrap<0),_=Math.abs(2*a.wrap)-+(a.wrap<0);return g.overscaledZ-a.overscaledZ||_-d||a.canonical.y-g.canonical.y||a.canonical.x-g.canonical.x}function yh(g){return g==="raster"||g==="image"||g==="video"||g==="custom"}function wh(g,a){const d=1<<g.z;return[g.x/d+a,(g.x+1)/d+a]}Qo.maxOverzooming=10,Qo.maxUnderzooming=3;class Jv{constructor(a){this.style=a,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const a=!1,d=!1;for(const _ in this.style._mergedLayers){const y=this.style._mergedLayers[_];if(y.type==="fill-extrusion"||y.type==="building")this.layers.push({layer:y,visible:a,visibilityChanged:d});else if(y.type==="model"){const b=this.style.getLayerSource(y);b&&b.type==="batched-model"&&this.layers.push({layer:y,visible:a,visibilityChanged:d})}}}onNewFrame(a){this.layersGotHidden=!1;for(const d of this.layers){const _=d.layer;let y=!1;_.type==="fill-extrusion"?y=!_.isHidden(a)&&_.paint.get("fill-extrusion-opacity")>0:_.type==="building"?y=!_.isHidden(a)&&_.paint.get("building-opacity")>0:_.type==="model"&&(y=!_.isHidden(a)&&_.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!y&&d.visible,d.visible=y}}updateZOffset(a,d){this.currentBuildingBuckets=[];for(const y of this.layers){const b=y.layer,T=this.style.getLayerSourceCache(b);let j=1;b.type==="fill-extrusion"?j=y.visible?b.paint.get("fill-extrusion-vertical-scale"):0:b.type==="building"&&(j=y.visible?b.paint.get("building-vertical-scale"):0);let N=T?T.getTile(d):null;if(!N&&T)for(const L in T._tiles){const B=T._tiles[L];if(d.canonical.isChildOf(B.tileID.canonical)){N=B;break}}this.currentBuildingBuckets.push({bucket:N?N.getBucket(b):null,tileID:N?N.tileID:d,verticalScale:j})}a.hasAnyZOffset=!1;let _=!1;for(let y=0;y<a.symbolInstances.length;y++){const b=a.symbolInstances.get(y),T=b.zOffset,j=this._getHeightAtTileOffset(d,b.tileAnchorX,b.tileAnchorY);b.zOffset=j!==Number.NEGATIVE_INFINITY?j:T,_||T===b.zOffset||(_=!0),a.hasAnyZOffset||b.zOffset===0||(a.hasAnyZOffset=!0)}_&&(a.zOffsetBuffersNeedUpload=!0,a.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(a,d,_,y){let b=d,T=_;if(a.canonical.z!==y.canonical.z){const j=y.canonical,N=1/(1<<a.canonical.z-j.z);b=(d+a.canonical.x*i.al)*N-j.x*i.al|0,T=(_+a.canonical.y*i.al)*N-j.y*i.al|0}return{tileX:b,tileY:T}}_getHeightAtTileOffset(a,d,_){let y,b;for(let T=0;T<this.layers.length;++T){const j=this.layers[T].layer;if(j.type!=="fill-extrusion"&&j.type!=="building")continue;const{bucket:N,tileID:L,verticalScale:B}=this.currentBuildingBuckets[T];if(!N)continue;const{tileX:X,tileY:q}=this._mapCoordToOverlappingTile(a,d,_,L),Q=N.getHeightAtTileCoord(X,q);Q&&Q.height!==void 0&&(Q.hidden?y=Q.height:b=Math.max(Q.height*B,b||0))}if(b!==void 0)return b;for(let T=0;T<this.layers.length;++T){const j=this.layers[T];if(j.layer.type!=="model"||!j.visible)continue;const{bucket:N,tileID:L}=this.currentBuildingBuckets[T];if(!N)continue;const{tileX:B,tileY:X}=this._mapCoordToOverlappingTile(a,d,_,L),q=N.getHeightAtTileCoord(B,X);if(q&&!q.hidden)return q.height===void 0&&y!==void 0?Math.min(q.maxHeight,y)*q.verticalScale:q.height?q.height*q.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Mm(g,a){const d={};for(const _ in g)_!=="ref"&&(d[_]=g[_]);return i.bw.forEach(_=>{_ in a&&(d[_]=a[_])}),d}function jf(g){g=g.slice();const a=Object.create(null);for(let d=0;d<g.length;d++)a[g[d].id]=g[d];for(let d=0;d<g.length;d++)"ref"in g[d]&&(g[d]=Mm(g[d],a[g[d].ref]));return g}const Ni={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Qv(g,a,d){d.push({command:Ni.addSource,args:[g,a[g]]})}function Om(g,a,d){a.push({command:Ni.removeSource,args:[g]}),d[g]=!0}function Fm(g,a,d,_){Om(g,d,_),Qv(g,a,d)}function ey(g,a,d){let _;for(_ in g[d])if(g[d].hasOwnProperty(_)&&_!=="data"&&!i.bx(g[d][_],a[d][_]))return!1;for(_ in a[d])if(a[d].hasOwnProperty(_)&&_!=="data"&&!i.bx(g[d][_],a[d][_]))return!1;return!0}function Lm(g,a,d,_,y,b){let T;for(T in a=a||{},g=g||{})g.hasOwnProperty(T)&&(i.bx(g[T],a[T])||d.push({command:b,args:[_,T,a[T],y]}));for(T in a)a.hasOwnProperty(T)&&!g.hasOwnProperty(T)&&(i.bx(g[T],a[T])||d.push({command:b,args:[_,T,a[T],y]}))}function zm(g){return g.id}function Bm(g,a){return g[a.id]=a,g}function bh(g,a,d){const _=a.createTileMatrix(g,g.worldSize,d.toUnwrapped());return i.aB(new Float32Array(16),g.projMatrix,_)}function o2(g,a,d){if(a.projection.name===d.projection.name)return g.projMatrix;const _=d.clone();return _.setProjection(a.projection),bh(_,a.getProjection(),g)}function O_(g,a,d){return a.name===d.projection.name?g.projMatrix:bh(d,a,g)}class kA{constructor(a,d){this.reset(a,d)}reset(a,d){this.points=a||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(this.points.length===1)return this.points[0];a=i.aA(a,0,1);let d=1,_=this._distances[d];const y=a*this.paddedLength+this.padding;for(;_<y&&d<this._distances.length;)_=this._distances[++d];const b=d-1,T=this._distances[b],j=_-T,N=j>0?(y-T)/j:0;return this.points[b].mult(1-N).add(this.points[d].mult(N))}}class Um{constructor(a,d,_){const y=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(a/_),this.yCellCount=Math.ceil(d/_);for(let T=0;T<this.xCellCount*this.yCellCount;T++)y.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=d,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,d,_,y,b){this._forEachCell(d,_,y,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(y),this.bboxes.push(b)}insertCircle(a,d,_,y){this._forEachCell(d-y,_-y,d+y,_+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(d),this.circles.push(_),this.circles.push(y)}_insertBoxCell(a,d,_,y,b,T){this.boxCells[b].push(T)}_insertCircleCell(a,d,_,y,b,T){this.circleCells[b].push(T)}_query(a,d,_,y,b,T){if(_<0||a>this.width||y<0||d>this.height)return!b&&[];const j=[];if(a<=0&&d<=0&&this.width<=_&&this.height<=y){if(b)return!0;for(let N=0;N<this.boxKeys.length;N++)j.push({key:this.boxKeys[N],x1:this.bboxes[4*N],y1:this.bboxes[4*N+1],x2:this.bboxes[4*N+2],y2:this.bboxes[4*N+3]});for(let N=0;N<this.circleKeys.length;N++){const L=this.circles[3*N],B=this.circles[3*N+1],X=this.circles[3*N+2];j.push({key:this.circleKeys[N],x1:L-X,y1:B-X,x2:L+X,y2:B+X})}return T?j.filter(T):j}return this._forEachCell(a,d,_,y,this._queryCell,j,{hitTest:b,seenUids:{box:{},circle:{}}},T),b?j.length>0:j}_queryCircle(a,d,_,y,b){const T=a-_,j=a+_,N=d-_,L=d+_;if(j<0||T>this.width||L<0||N>this.height)return!y&&[];const B=[];return this._forEachCell(T,N,j,L,this._queryCellCircle,B,{hitTest:y,circle:{x:a,y:d,radius:_},seenUids:{box:{},circle:{}}},b),y?B.length>0:B}query(a,d,_,y,b){return this._query(a,d,_,y,!1,b)}hitTest(a,d,_,y,b){return this._query(a,d,_,y,!0,b)}hitTestCircle(a,d,_,y){return this._queryCircle(a,d,_,!0,y)}_queryCell(a,d,_,y,b,T,j,N){const L=j.seenUids,B=this.boxCells[b];if(B!==null){const q=this.bboxes;for(const Q of B)if(!L.box[Q]){L.box[Q]=!0;const re=4*Q;if(a<=q[re+2]&&d<=q[re+3]&&_>=q[re+0]&&y>=q[re+1]&&(!N||N(this.boxKeys[Q]))){if(j.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[Q],x1:q[re],y1:q[re+1],x2:q[re+2],y2:q[re+3]})}}}const X=this.circleCells[b];if(X!==null){const q=this.circles;for(const Q of X)if(!L.circle[Q]){L.circle[Q]=!0;const re=3*Q;if(this._circleAndRectCollide(q[re],q[re+1],q[re+2],a,d,_,y)&&(!N||N(this.circleKeys[Q]))){if(j.hitTest)return T.push(!0),!0;{const ae=q[re],fe=q[re+1],de=q[re+2];T.push({key:this.circleKeys[Q],x1:ae-de,y1:fe-de,x2:ae+de,y2:fe+de})}}}}}_queryCellCircle(a,d,_,y,b,T,j,N){const L=j.circle,B=j.seenUids,X=this.boxCells[b];if(X!==null){const Q=this.bboxes;for(const re of X)if(!B.box[re]){B.box[re]=!0;const ae=4*re;if(this._circleAndRectCollide(L.x,L.y,L.radius,Q[ae+0],Q[ae+1],Q[ae+2],Q[ae+3])&&(!N||N(this.boxKeys[re])))return T.push(!0),!0}}const q=this.circleCells[b];if(q!==null){const Q=this.circles;for(const re of q)if(!B.circle[re]){B.circle[re]=!0;const ae=3*re;if(this._circlesCollide(Q[ae],Q[ae+1],Q[ae+2],L.x,L.y,L.radius)&&(!N||N(this.circleKeys[re])))return T.push(!0),!0}}}_forEachCell(a,d,_,y,b,T,j,N){const L=this._convertToXCellCoord(a),B=this._convertToYCellCoord(d),X=this._convertToXCellCoord(_),q=this._convertToYCellCoord(y);for(let Q=L;Q<=X;Q++)for(let re=B;re<=q;re++)if(b.call(this,a,d,_,y,this.xCellCount*re+Q,T,j,N))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,d,_,y,b,T){const j=y-a,N=b-d,L=_+T;return L*L>j*j+N*N}_circleAndRectCollide(a,d,_,y,b,T,j){const N=(T-y)/2,L=Math.abs(a-(y+N));if(L>N+_)return!1;const B=(j-b)/2,X=Math.abs(d-(b+B));if(X>B+_)return!1;if(L<=N||X<=B)return!0;const q=L-N,Q=X-B;return q*q+Q*Q<=_*_}}const jl={unknown:0,flipRequired:1,flipNotRequired:2},Vm=Math.tan(85*Math.PI/180);function If(g,a,d,_,y,b,T){const j=i.bB();if(d)if(b.name==="globe"){const N=i.bC(y,a);i.aB(j,j,N)}else{const N=i.bD([],T);j[0]=N[0],j[1]=N[1],j[4]=N[2],j[5]=N[3],_||i.bA(j,j,y.angle)}else i.aB(j,y.labelPlaneMatrix,g);return j}function $m(g,a,d,_,y,b,T){const j=If(g,a,d,_,y,b,T);return b.name==="globe"&&d||(j[2]=j[6]=j[10]=j[14]=0),j}function Ou(g,a,d,_,y,b,T){if(d){if(b.name==="globe"){const j=If(g,a,d,_,y,b,T);return i.bk(j,j),i.aB(j,g,j),j}{const j=i.by(g),N=i.bz([]);return N[0]=T[0],N[1]=T[1],N[4]=T[2],N[5]=T[3],i.aB(j,j,N),_||i.bA(j,j,-y.angle),j}}return y.glCoordMatrix}function Ra(g,a,d,_){const y=[g,a,d,1];d?i.aC(y,y,_):ic(y,y,_);const b=y[3];return y[0]/=b,y[1]/=b,y[2]/=b,y}function ty(g,a){return Math.min(.5+g/a*.5,1.5)}function ry(g,a){const d=g[0]/g[3],_=g[1]/g[3];return d>=-a[0]&&d<=a[0]&&_>=-a[1]&&_<=a[1]}function ny(g,a,d,_,y,b,T,j,N,L,B=1){const X=d.transform,q=_?g.textSizeData:g.iconSizeData,Q=i.bJ(q,d.transform.zoom,B),re=X.projection.name==="globe",ae=[256/d.width*2+1,256/d.height*2+1],fe=_?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;fe.clear();let de=null;re&&(de=_?g.text.globeExtVertexArray:g.icon.globeExtVertexArray);const xe=g.lineVertexArray,je=_?g.text.placedSymbolArray:g.icon.placedSymbolArray,we=d.transform.width/d.transform.height;let Ve,Ne=!1;for(let Ge=0;Ge<je.length;Ge++){const Be=je.get(Ge),{numGlyphs:De,writingMode:We}=Be;if(We!==i.bK.vertical||Ne||Ve===i.bK.horizontal||(Ne=!0),Ve=We,(Be.hidden||We===i.bK.vertical)&&!Ne){Fu(De,fe);continue}Ne=!1;const st=new i.P(Be.tileAnchorX,Be.tileAnchorY),rt=g.elevationType==="road",bt=!!X.elevation||rt;let{x:_t,y:kt,z:nr}=X.projection.projectTilePoint(st.x,st.y,L.canonical),ht=null;if(bt){const wr=rt?g.getElevationFeatureForText(Ge):null;ht={getElevation:N,elevation:X.elevation,elevationFeature:wr};const[on,Jn,ui]=N(st,X.elevation,wr);_t+=on,kt+=Jn,nr+=ui}const Ke=[_t,kt,nr,1];if(i.aC(Ke,Ke,a),!ry(Ke,ae)){Fu(De,fe);continue}const Pt=Ke[3],xt=ty(d.transform.getCameraToCenterDistance(X.projection),Pt),qt=i.bL(q,Q,Be),or=T?qt/xt:qt*xt,Ar=Ra(_t,kt,nr,y);if(Ar[3]<=0){Fu(De,fe);continue}let tr={};const sr=i.an(g.layers[0].layout.get("text-max-angle")),kr=Math.cos(sr),yr=T?null:ht,gr=l2(Be,or,!1,j,a,y,b,g.glyphOffsetArray,xe,fe,de,Ar,st,tr,we,yr,X.projection,L,T,kr);Ne=gr.useVertical,yr&&gr.needsFlipping&&(tr={}),(gr.notEnoughRoom||Ne||gr.needsFlipping&&l2(Be,or,!0,j,a,y,b,g.glyphOffsetArray,xe,fe,de,Ar,st,tr,we,yr,X.projection,L,T,kr).notEnoughRoom)&&Fu(De,fe)}_?(g.text.dynamicLayoutVertexBuffer.updateData(fe),de&&g.text.globeExtVertexBuffer&&g.text.globeExtVertexBuffer.updateData(de)):(g.icon.dynamicLayoutVertexBuffer.updateData(fe),de&&g.icon.globeExtVertexBuffer&&g.icon.globeExtVertexBuffer.updateData(de))}function Li(g,a,d,_,y,b,T,j,N,L,B,X,q,Q,re,ae,fe){const{lineStartIndex:de,glyphStartIndex:xe,segment:je}=j,we=xe+j.numGlyphs,Ve=de+j.lineLength,Ne=a.getoffsetX(xe),Ge=a.getoffsetX(we-1),Be=qm(g*Ne,d,_,y,b,T,je,de,Ve,N,L,B,X,q,!0,Q,re,ae,fe);if(!Be)return null;const De=qm(g*Ge,d,_,y,b,T,je,de,Ve,N,L,B,X,q,!0,Q,re,ae,fe);return De?{first:Be,last:De}:null}function iy(g,a,d,_){return g===i.bK.horizontal&&Math.abs(_)>Math.abs(d)?{useVertical:!0}:g===i.bK.vertical?_>0?{needsFlipping:!0}:null:a!==jl.unknown&&function(y,b){return y===0||Math.abs(b/y)>Vm}(d,_)?a===jl.flipRequired?{needsFlipping:!0}:null:d<0?{needsFlipping:!0}:null}function l2(g,a,d,_,y,b,T,j,N,L,B,X,q,Q,re,ae,fe,de,xe,je){const we=a/24,Ve=g.lineOffsetX*we,Ne=g.lineOffsetY*we,{lineStartIndex:Ge,glyphStartIndex:Be,numGlyphs:De,segment:We,writingMode:st,flipState:rt}=g,bt=Ge+g.lineLength,_t=kt=>{if(B){const[Pt,xt,qt]=kt.up,or=L.length;i.bM(B,or+0,Pt,xt,qt),i.bM(B,or+1,Pt,xt,qt),i.bM(B,or+2,Pt,xt,qt),i.bM(B,or+3,Pt,xt,qt)}const[nr,ht,Ke]=kt.point;i.bN(L,nr,ht,Ke,kt.angle)};if(De>1){const kt=Li(we,j,Ve,Ne,d,X,q,g,N,b,Q,ae,!1,fe,de,xe,je);if(!kt)return{notEnoughRoom:!0};if(_&&!d){let[nr,ht,Ke]=kt.first.point,[Pt,xt,qt]=kt.last.point;[nr,ht]=Ra(nr,ht,Ke,T),[Pt,xt]=Ra(Pt,xt,qt,T);const or=iy(st,rt,(Pt-nr)*re,xt-ht);if(g.flipState=or&&or.needsFlipping?jl.flipRequired:jl.flipNotRequired,or)return or}_t(kt.first);for(let nr=Be+1;nr<Be+De-1;nr++){const ht=qm(we*j.getoffsetX(nr),Ve,Ne,d,X,q,We,Ge,bt,N,b,Q,ae,!1,!1,fe,de,xe,je);if(!ht)return L.length-=4*(nr-Be),{notEnoughRoom:!0};_t(ht)}_t(kt.last)}else{if(_&&!d){const nr=Ra(q.x,q.y,0,y),ht=Ge+We+1,Ke=new i.P(N.getx(ht),N.gety(ht)),Pt=Ra(Ke.x,Ke.y,0,y),xt=Pt[3]>0?Pt:fn(q,Ke,nr,1,y,void 0,fe,de.canonical),qt=iy(st,rt,(xt[0]-nr[0])*re,xt[1]-nr[1]);if(g.flipState=qt&&qt.needsFlipping?jl.flipRequired:jl.flipNotRequired,qt)return qt}const kt=qm(we*j.getoffsetX(Be),Ve,Ne,d,X,q,We,Ge,bt,N,b,Q,ae,!1,!1,fe,de,xe,je);if(!kt)return{notEnoughRoom:!0};_t(kt)}return{}}function c2(g,a,d,_,y){const{x:b,y:T,z:j}=_.projectTilePoint(g.x,g.y,a);if(!y)return Ra(b,T,j,d);const[N,L,B]=y.getElevation(g,y.elevation,y.elevationFeature);return Ra(b+N,T+L,j+B,d)}function fn(g,a,d,_,y,b,T,j){const N=c2(g.sub(a)._unit()._add(g),j,y,T,b);return i.av(N,d,N),i.aw(N,N),i.bG(N,d,N,_)}function qm(g,a,d,_,y,b,T,j,N,L,B,X,q,Q,re,ae,fe,de,xe){const je=_?g-a:g+a;let we=je>0?1:-1,Ve=0;_&&(we*=-1,Ve=Math.PI),we<0&&(Ve+=Math.PI);let Ne=j+T+(we>0?0:1)|0,Ge=y,Be=y,De=0,We=0;const st=Math.abs(je),rt=[],bt=[];let _t=b,kt=_t,nr=i.bE([]);const ht=()=>fn(kt,_t,Be,st-De+1,B,q,ae,fe.canonical);for(;De+We<=st;){if(Ne+=we,Ne<j||Ne>=N)return null;if(Be=Ge,kt=_t,rt.push(Be),Q&&bt.push(kt),_t=new i.P(L.getx(Ne),L.gety(Ne)),Ge=X[Ne],!Ge){const yr=c2(_t,fe.canonical,B,ae,q);Ge=yr[3]>0?X[Ne]=yr:ht()}De+=We;const sr=i.av([],Ge,Be),kr=i.bF(Be,Ge);if(d&&kr>0&&We>0&&i.bI(nr,sr)/(We*kr)<xe)return null;We=kr,nr=sr}re&&q&&(X[Ne]&&(Ge=ht(),We=i.bF(Be,Ge),nr=i.av([],Ge,Be)),X[Ne]=Ge);const Ke=(st-De)/We,Pt=_t.sub(kt)._mult(Ke)._add(kt),xt=i.bG([],Be,nr,Ke);let qt=[0,0,1],or=nr[0],Ar=nr[1];if(de&&(qt=ae.upVector(fe.canonical,Pt.x,Pt.y),qt[0]!==0||qt[1]!==0||qt[2]!==1)){const sr=[qt[2],0,-qt[0]],kr=i.bH([],qt,sr);i.aw(sr,sr),i.aw(kr,kr),or=i.bI(nr,sr),Ar=i.bI(nr,kr)}if(d){const sr=i.bH([],qt,nr);i.aw(sr,sr),i.bG(xt,xt,sr,d*we)}const tr=Ve+Math.atan2(Ar,or);return rt.push(xt),Q&&bt.push(Pt),{point:xt,angle:tr,path:rt,tilePath:bt,up:qt}}function Fu(g,a){const d=a.length,_=d+4*g;a.resize(_),a.float32.fill(-1/0,4*d,4*_)}function ic(g,a,d){const _=a[0],y=a[1];return g[0]=d[0]*_+d[4]*y+d[12],g[1]=d[1]*_+d[5]*y+d[13],g[3]=d[3]*_+d[7]*y+d[15],g}const sc=100;class Nf{constructor(a,d,_=new Um(a.width+200,a.height+200,25),y=new Um(a.width+200,a.height+200,25)){this.transform=a,this.grid=_,this.ignoredGrid=y,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+sc,this.screenBottomBoundary=a.height+sc,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.fogState=d}placeCollisionBox(a,d,_,y,b,T,j,N,L,B,X){let q=_.projectedAnchorX,Q=_.projectedAnchorY,re=_.projectedAnchorZ;const ae=_.tileAnchorX,fe=_.tileAnchorY,de=_.elevation,xe=_.tileID,je=a.getProjection();if(de&&xe){const[bt,_t,kt]=je.upVector(xe.canonical,_.tileAnchorX,_.tileAnchorY),nr=je.upVectorScale(xe.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;q+=bt*de*nr,Q+=_t*de*nr,re+=kt*de*nr}const we=a.projection.name==="globe",Ve=a.projection.name==="globe"?i.aj(this.transform.zoom):0;if(xe&&we&&Ve<1&&!T){const bt=1<<xe.canonical.z,_t=i.bO(ae,fe);i.bP(_t,_t,1/i.al),i.bQ(_t,_t,i.bO(xe.canonical.x,xe.canonical.y)),i.bP(_t,_t,1/bt),i.bR(_t,_t,i.bO(y[0],y[1])),_t[0]=i.bS(_t[0],-.5,.5),i.bP(_t,_t,i.al);const kt=i.bT(_t[0],_t[1],i.al/(2*Math.PI),1);i.aC(kt,kt,b),q=i.ak(q,kt[0],Ve),Q=i.ak(Q,kt[1],Ve),re=i.ak(re,kt[2],Ve)}const Ne=this.projectAndGetPerspectiveRatio(B,q,Q,re,_.tileID,je.name==="globe"||!!de||this.transform.pitch>0,je),Ge=L*Ne.perspectiveRatio,Be=(_.x1*d+j.x-_.padding)*Ge+Ne.point.x,De=(_.y1*d+j.y-_.padding)*Ge+Ne.point.y,We=(_.x2*d+j.x+_.padding)*Ge+Ne.point.x,st=(_.y2*d+j.y+_.padding)*Ge+Ne.point.y,rt=Ne.perspectiveRatio<=.55||Ne.occluded;return!this.isInsideGrid(Be,De,We,st)||!N&&this.grid.hitTest(Be,De,We,st,X)||rt?{box:[],offscreen:!1,occluded:Ne.occluded}:{box:[Be,De,We,st],offscreen:this.isOffscreen(Be,De,We,st),occluded:!1}}placeCollisionCircles(a,d,_,y,b,T,j,N,L,B,X,q,Q,re,ae,fe){const de=[],xe=this.transform.elevation,je=a.getProjection(),we=a.elevationType==="road",Ve=!!xe||we,Ne=i.bU.getAtTileOffsetFunc(fe,this.transform.center.lat,this.transform.worldSize,je),Ge=new i.P(_.tileAnchorX,_.tileAnchorY),Be=new i.P(_.tileAnchorX,_.tileAnchorY);let{x:De,y:We,z:st}=je.projectTilePoint(Be.x,Be.y,fe.canonical),rt=null;if(Ve){const kr=we?a.getElevationFeatureForText(y):null;rt={getElevation:Ne,elevation:xe,elevationFeature:kr};const[yr,gr,wr]=Ne(Ge,xe,kr);De+=yr,We+=gr,st+=wr}const bt=je.name==="globe",_t=this.projectAndGetPerspectiveRatio(N,De,We,st,fe,bt||!!xe||this.transform.pitch>0,je),{perspectiveRatio:kt}=_t,nr=(q?j/kt:j*kt)/i.bX,ht=Ra(De,We,st,L),Ke=_.lineOffsetX*nr,Pt=_.lineOffsetY*nr,xt=i.an(a.layers[0].layout.get("text-max-angle")),qt=Math.cos(xt),or=_t.signedDistanceFromCamera>0?Li(nr,T,Ke,Pt,we&&_.flipState===1,ht,Be,_,b,L,{},Ve&&!q?rt:null,q&&Ve,je,fe,q,qt):null;let Ar=!1,tr=!1,sr=!0;if(or&&!_t.occluded){const kr=.5*re*kt+ae,yr=new i.P(-100,-100),gr=new i.P(this.screenRightBoundary,this.screenBottomBoundary),wr=new kA,{first:on,last:Jn}=or,ui=on.path.length;let Xi=[];for(let Fn=ui-1;Fn>=1;Fn--)Xi.push(on.path[Fn]);for(let Fn=1;Fn<Jn.path.length;Fn++)Xi.push(Jn.path[Fn]);const wn=2.5*kr;B&&(Xi=Xi.map(([Fn,Wi,di],rs)=>(Ve&&!bt&&(di=Ne(rs<ui-1?on.tilePath[ui-1-rs]:Jn.tilePath[rs-ui+2],xe,rt.elevationFeature)[2]),Ra(Fn,Wi,di,B))),Xi.some(Fn=>Fn[3]<=0)&&(Xi=[]));let li=[];if(Xi.length>0){let Fn=1/0,Wi=-1/0,di=1/0,rs=-1/0;for(const bi of Xi)Fn=Math.min(Fn,bi[0]),di=Math.min(di,bi[1]),Wi=Math.max(Wi,bi[0]),rs=Math.max(rs,bi[1]);Wi>=yr.x&&Fn<=gr.x&&rs>=yr.y&&di<=gr.y&&(li=[Xi.map(bi=>new i.P(bi[0],bi[1]))],(Fn<yr.x||Wi>gr.x||di<yr.y||rs>gr.y)&&(li=i.bV(li,yr.x,yr.y,gr.x,gr.y)))}for(const Fn of li){wr.reset(Fn,.25*kr);let Wi=0;Wi=wr.length<=.5*kr?1:Math.ceil(wr.paddedLength/wn)+1;for(let di=0;di<Wi;di++){const rs=di/Math.max(Wi-1,1),bi=wr.lerp(rs),Ln=bi.x+sc,ki=bi.y+sc;de.push(Ln,ki,kr,0);const qn=Ln-kr,ps=ki-kr,Mi=Ln+kr,Tn=ki+kr;if(sr=sr&&this.isOffscreen(qn,ps,Mi,Tn),tr=tr||this.isInsideGrid(qn,ps,Mi,Tn),!d&&this.grid.hitTestCircle(Ln,ki,kr,Q)&&(Ar=!0,!X))return{circles:[],offscreen:!1,collisionDetected:Ar,occluded:!1}}}}return{circles:!X&&Ar||!tr?[]:de,offscreen:sr,collisionDetected:Ar,occluded:_t.occluded}}queryRenderedSymbols(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let _=1/0,y=1/0,b=-1/0,T=-1/0;for(const B of a){const X=new i.P(B.x+sc,B.y+sc);_=Math.min(_,X.x),y=Math.min(y,X.y),b=Math.max(b,X.x),T=Math.max(T,X.y),d.push(X)}const j=this.grid.query(_,y,b,T).concat(this.ignoredGrid.query(_,y,b,T)),N={},L={};for(const B of j){const X=B.key;if(N[X.bucketInstanceId]===void 0&&(N[X.bucketInstanceId]={}),N[X.bucketInstanceId][X.featureIndex])continue;const q=[new i.P(B.x1,B.y1),new i.P(B.x2,B.y1),new i.P(B.x2,B.y2),new i.P(B.x1,B.y2)];i.bW(d,q)&&(N[X.bucketInstanceId][X.featureIndex]=!0,L[X.bucketInstanceId]===void 0&&(L[X.bucketInstanceId]=[]),L[X.bucketInstanceId].push(X.featureIndex))}return L}insertCollisionBox(a,d,_,y,b){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:y,collisionGroupID:b},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,d,_,y,b){const T=d?this.ignoredGrid:this.grid,j={bucketInstanceId:_,featureIndex:y,collisionGroupID:b};for(let N=0;N<a.length;N+=4)T.insertCircle(j,a[N],a[N+1],a[N+2])}projectAndGetPerspectiveRatio(a,d,_,y,b,T,j){const N=[d,_,y,1];let L=!1;y||this.transform.pitch>0?(i.aC(N,N,a),this.fogState&&b&&j.name!=="globe"&&(L=function(q,Q,re,ae,fe,de){const xe=de.calculateFogTileMatrix(fe),je=[Q,re,ae];return i.af(je,je,xe),et(q,i.ag(je),de.pitch,de._fov)}(this.fogState,d,_,y,b.toUnwrapped(),this.transform)>.9)):ic(N,N,a);const B=N[3];return{point:new i.P((N[0]/B+1)/2*this.transform.width+sc,(-N[1]/B+1)/2*this.transform.height+sc),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(j)/B*.5,1.5),signedDistanceFromCamera:B,occluded:T&&N[2]>B||L}}isOffscreen(a,d,_,y){return _<sc||a>=this.screenRightBoundary||y<sc||d>this.screenBottomBoundary}isInsideGrid(a,d,_,y){return _>=0&&a<this.gridRightBoundary&&y>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const a=i.bz([]);return i.bq(a,a,[-100,-100,0]),a}}class Gr{constructor(a,d,_,y){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?d:-d))):y&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class wi{constructor(a,d,_,y,b,T=!1){this.text=new Gr(a?a.text:null,d,_,b),this.icon=new Gr(a?a.icon:null,d,y,b),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ri{constructor(a,d,_,y=!1){this.text=a,this.icon=d,this.skipFade=_,this.clipped=y}}class ml{constructor(){this.invProjMatrix=i.bB(),this.viewportMatrix=i.bB(),this.circles=[]}}class kf{constructor(a,d,_,y,b){this.bucketInstanceId=a,this.featureIndex=d,this.sourceLayerIndex=_,this.bucketIndex=y,this.tileID=b}}class Gi{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const d=++this.maxGroupID;this.collisionGroups[a]={ID:d,predicate:_=>_.collisionGroupID===d}}return this.collisionGroups[a]}}function Gm(g,a,d,_,y){const{horizontalAlign:b,verticalAlign:T}=i.c0(g),j=-(b-.5)*a,N=-(T-.5)*d,L=i.c1(g,_);return new i.P(j+L[0]*y,N+L[1]*y)}function Sh(g,a,d,_,y){const b=new i.P(g,a);return d&&b._rotate(_?y:-y),b}class Wm{constructor(a,d,_,y,b,T){this.transform=a.clone(),this.projection=a.projection.name,this.collisionIndex=new Nf(this.transform,b),this.buildingIndex=T,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Gi(_),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,d,_,y,b=1){const T=_.getBucket(d),j=_.latestFeatureIndex;if(!T||!j||d.fqid!==T.layerIds[0])return;const N=T.layers[0].layout,L=T.layers[0].paint,B=_.collisionBoxArray,X=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),q=_.tileSize/i.al,Q=_.tileID.toUnwrapped();this.transform.setProjection(T.projection);const re=(ae=_.tileID,fe=T.getProjection(),de=this.transform,fe.name===this.projection?de.calculateProjMatrix(ae.toUnwrapped()):bh(de,fe,ae));var ae,fe,de;const xe=N.get("text-pitch-alignment")==="map",je=N.get("text-rotation-alignment")==="map";d.compileFilter(d.options);const we=d.dynamicFilter(),Ve=d.dynamicFilterNeedsFeature(),Ne=this.transform.calculatePixelsToTileUnitsMatrix(_),Ge=$m(re,_.tileID.canonical,xe,je,this.transform,T.getProjection(),Ne);let Be=null;const De=T.getProjection().createInversionMatrix(this.transform,_.tileID.canonical);if(xe){const Ke=Ou(re,_.tileID.canonical,xe,je,this.transform,T.getProjection(),Ne);Be=i.aB([],this.transform.labelPlaneMatrix,Ke)}let We=null;we&&_.latestFeatureIndex&&(We={unwrappedTileID:Q,dynamicFilter:we,dynamicFilterNeedsFeature:Ve}),this.retainedQueryData[T.bucketInstanceId]=new kf(T.bucketInstanceId,j,T.sourceLayerIndex,T.index,_.tileID);const[st,rt]=T.layers[0].layout.get("text-size-scale-range"),bt=i.aA(b,st,rt),[_t,kt]=N.get("icon-size-scale-range"),nr=i.aA(b,_t,kt),ht={bucket:T,layout:N,paint:L,posMatrix:re,invMatrix:De,mercatorCenter:[i.aF(this.transform.center.lng),i.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Ge,labelToScreenMatrix:Be,clippingData:We,scale:X,textPixelRatio:q,holdingForFade:_.holdingForFade(),collisionBoxArray:B,partiallyEvaluatedTextSize:i.bJ(T.textSizeData,this.transform.zoom,bt),partiallyEvaluatedIconSize:i.bJ(T.iconSizeData,this.transform.zoom,nr),collisionGroup:this.collisionGroups.get(T.sourceID),latestFeatureIndex:_.latestFeatureIndex};if(y)for(const Ke of T.sortKeyRanges){const{sortKey:Pt,symbolInstanceStart:xt,symbolInstanceEnd:qt}=Ke;a.push({sortKey:Pt,symbolInstanceStart:xt,symbolInstanceEnd:qt,parameters:ht})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:ht})}attemptAnchorPlacement(a,d,_,y,b,T,j,N,L,B,X,q,Q,re,ae,fe,de,xe,je,we,Ve){const{textOffset0:Ne,textOffset1:Ge,crossTileID:Be}=ae,De=[Ne,Ge],We=Gm(a,T,j,De,N),st=this.collisionIndex.placeCollisionBox(de,N,d,_,y,b,Sh(We.x,We.y,L,B,this.transform.angle),re,X,q,Q.predicate);if(je){const rt=de.getSymbolInstanceIconSize(Ve,this.transform.zoom,ae.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(de,rt,je,_,y,b,Sh(We.x,We.y,L,B,this.transform.angle),re,X,q,Q.predicate).box.length===0)return}if(st.box.length>0){let rt;return this.prevPlacement&&this.prevPlacement.variableOffsets[Be]&&this.prevPlacement.placements[Be]&&this.prevPlacement.placements[Be].text&&(rt=this.prevPlacement.variableOffsets[Be].anchor),this.variableOffsets[Be]={textOffset:De,width:T,height:j,anchor:a,textScale:N,prevAnchor:rt},this.markUsedJustification(de,a,ae,xe),de.allowVerticalPlacement&&(this.markUsedOrientation(de,xe,ae),this.placedOrientations[Be]=xe),{shift:We,placedGlyphBoxes:st}}}placeLayerBucketPart(a,d,_,y,b=1){const{bucket:T,layout:j,paint:N,posMatrix:L,textLabelPlaneMatrix:B,labelToScreenMatrix:X,clippingData:q,textPixelRatio:Q,mercatorCenter:re,invMatrix:ae,holdingForFade:fe,collisionBoxArray:de,partiallyEvaluatedTextSize:xe,partiallyEvaluatedIconSize:je,collisionGroup:we,latestFeatureIndex:Ve}=a.parameters,Ne=j.get("text-optional"),Ge=j.get("icon-optional"),Be=j.get("text-allow-overlap"),De=j.get("icon-allow-overlap"),We=j.get("text-rotation-alignment")==="map",st=j.get("icon-rotation-alignment")==="map",rt=j.get("text-pitch-alignment")==="map",bt=N.get("symbol-z-offset"),_t=j.get("symbol-elevation-reference")==="sea",kt=j.get("symbol-placement"),[nr,ht]=j.get("text-size-scale-range"),[Ke,Pt]=j.get("icon-size-scale-range"),xt=i.aA(b,nr,ht),qt=i.aA(b,Ke,Pt),or=j.get("text-variable-anchor"),Ar=We&&kt!=="point",tr=st&&kt!=="point",sr=or&&T.hasTextData(),kr=T.hasIconTextFit()&&sr&&T.hasIconData();this.transform.setProjection(T.projection);const yr=sr||Ar,gr=tr||kr;let wr=Be&&(De||!T.hasIconData()||Ge),on=De&&(Be||!T.hasTextData()||Ne);const Jn=!bt.isConstant();!T.collisionArrays&&de&&T.deserializeCollisionBoxes(de),_&&y&&T.updateCollisionDebugBuffers(this.transform.zoom,de,xt,qt);const ui=(wn,li,Fn)=>{const{crossTileID:Wi,numVerticalGlyphVertices:di}=wn;let rs=null;if(q&&q.dynamicFilterNeedsFeature||Jn){const Vs=this.retainedQueryData[T.bucketInstanceId];rs=Ve.loadFeature({featureIndex:wn.featureIndex,bucketIndex:Vs.bucketIndex,sourceLayerIndex:Vs.sourceLayerIndex,layoutVertexArrayOffset:0})}if(q&&!(0,q.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:T.worldview},rs,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new i.P(wn.tileAnchorX,wn.tileAnchorY),this.transform.calculateDistanceTileData(q.unwrappedTileID)))return this.placements[Wi]=new Ri(!1,!1,!1,!0),void d.add(Wi);const bi=bt.evaluate(rs,{});if(d.has(Wi))return;if(fe)return void(this.placements[Wi]=new Ri(!1,!1,!1));let Ln=!1,ki=!1,qn=!0,ps=!1,Mi=!1,Tn=null,pi={box:null,offscreen:null,occluded:null},Cs={box:null},ra=null,Ls=null,Xs=null,nl=0,Vo=0,mo=0;Fn.textFeatureIndex?nl=Fn.textFeatureIndex:wn.useRuntimeCollisionCircles&&(nl=wn.featureIndex),Fn.verticalTextFeatureIndex&&(Vo=Fn.verticalTextFeatureIndex);const wo=T.elevationFeatures?T.elevationFeatures[wn.elevationFeatureIndex]:void 0,Dl=Vs=>{Vs.tileID=this.retainedQueryData[T.bucketInstanceId].tileID;const na=this.transform.elevation;Vs.elevation=_t?bi:bi+i.bU.getAtTileOffset(Vs.tileID,new i.P(Vs.tileAnchorX,Vs.tileAnchorY),na,wo),Vs.elevation+=wn.zOffset},go=Fn.textBox;if(go){Dl(go);const Vs=ts=>{let la=i.bK.horizontal;if(T.allowVerticalPlacement&&!ts&&this.prevPlacement){const Xa=this.prevPlacement.placedOrientations[Wi];Xa&&(this.placedOrientations[Wi]=Xa,la=Xa,this.markUsedOrientation(T,la,wn))}return la},na=(ts,la)=>{if(T.allowVerticalPlacement&&di>0&&Fn.verticalTextBox){for(const Xa of T.writingModes)if(Xa===i.bK.vertical?(pi=la(),Cs=pi):pi=ts(),pi&&pi.box&&pi.box.length)break}else pi=ts()};if(or){let ts=or;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Wi]){const $s=this.prevPlacement.variableOffsets[Wi];ts.indexOf($s.anchor)>0&&(ts=ts.filter(Ml=>Ml!==$s.anchor),ts.unshift($s.anchor))}const la=($s,Ml,lp)=>{const Hu=T.getSymbolInstanceTextSize(xe,wn,this.transform.zoom,li),cp=($s.x2-$s.x1)*Hu+2*$s.padding,up=($s.y2-$s.y1)*Hu+2*$s.padding,Ol=wn.hasIconTextFit&&!De?Ml:null;Ol&&Dl(Ol);let hu={box:[],offscreen:!1,occluded:!1};const qa=Be?2*ts.length:ts.length;for(let Fl=0;Fl<qa;++Fl){const Fh=this.attemptAnchorPlacement(ts[Fl%ts.length],$s,re,ae,yr,cp,up,Hu,We,rt,Q,L,we,Fl>=ts.length,wn,li,T,lp,Ol,xe,je);if(Fh&&(hu=Fh.placedGlyphBoxes,hu&&hu.box&&hu.box.length)){Ln=!0,Tn=Fh.shift;break}}return hu};na(()=>la(go,Fn.iconBox,i.bK.horizontal),()=>{const $s=Fn.verticalTextBox;return $s&&Dl($s),T.allowVerticalPlacement&&!(pi&&pi.box&&pi.box.length)&&di>0&&$s?la($s,Fn.verticalIconBox,i.bK.vertical):{box:null,offscreen:null,occluded:null}}),pi&&(Ln=pi.box,qn=pi.offscreen,ps=pi.occluded);const Xa=Vs(!(!pi||!pi.box));if(!Ln&&this.prevPlacement){const $s=this.prevPlacement.variableOffsets[Wi];$s&&(this.variableOffsets[Wi]=$s,this.markUsedJustification(T,$s.anchor,wn,Xa))}}else{const ts=(la,Xa)=>{const $s=T.getSymbolInstanceTextSize(xe,wn,this.transform.zoom,li),Ml=this.collisionIndex.placeCollisionBox(T,$s,la,re,ae,yr,new i.P(0,0),Be,Q,L,we.predicate);return Ml&&Ml.box&&Ml.box.length&&(this.markUsedOrientation(T,Xa,wn),this.placedOrientations[Wi]=Xa),Ml};na(()=>ts(go,i.bK.horizontal),()=>{const la=Fn.verticalTextBox;return T.allowVerticalPlacement&&di>0&&la?(Dl(la),ts(la,i.bK.vertical)):{box:null,offscreen:null,occluded:null}}),Vs(!!(pi&&pi.box&&pi.box.length))}}if(ra=pi,Ln=ra&&ra.box&&ra.box.length>0,qn=ra&&ra.offscreen,ps=ra&&ra.occluded,wn.useRuntimeCollisionCircles){const Vs=wn.centerJustifiedTextSymbolIndex>=0?wn.centerJustifiedTextSymbolIndex:wn.verticalPlacedTextSymbolIndex,na=T.text.placedSymbolArray.get(Vs),ts=i.bL(T.textSizeData,xe,na),la=j.get("text-padding");Ls=this.collisionIndex.placeCollisionCircles(T,Be,na,Vs,T.lineVertexArray,T.glyphOffsetArray,ts,L,B,X,_,rt,we.predicate,wn.collisionCircleDiameter*ts/i.bX,la,this.retainedQueryData[T.bucketInstanceId].tileID),Ln=Be||Ls.circles.length>0&&!Ls.collisionDetected,qn=qn&&Ls.offscreen,ps=Ls.occluded}if(Fn.iconFeatureIndex&&(mo=Fn.iconFeatureIndex),Fn.iconBox){const Vs=na=>{Dl(na);const ts=wn.hasIconTextFit&&Tn?Sh(Tn.x,Tn.y,We,rt,this.transform.angle):new i.P(0,0),la=T.getSymbolInstanceIconSize(je,this.transform.zoom,wn.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(T,la,na,re,ae,gr,ts,De,Q,L,we.predicate)};Cs&&Cs.box&&Cs.box.length&&Fn.verticalIconBox?(Xs=Vs(Fn.verticalIconBox),ki=Xs.box.length>0):(Xs=Vs(Fn.iconBox),ki=Xs.box.length>0),qn=qn&&Xs.offscreen,Mi=Xs.occluded}const Rl=Ne||wn.numHorizontalGlyphVertices===0&&di===0,hc=Ge||wn.numIconVertices===0;if(Rl||hc?hc?Rl||(ki=ki&&Ln):Ln=ki&&Ln:ki=Ln=ki&&Ln,Ln&&ra&&ra.box&&this.collisionIndex.insertCollisionBox(ra.box,j.get("text-ignore-placement"),T.bucketInstanceId,Cs&&Cs.box&&Vo?Vo:nl,we.ID),ki&&Xs&&this.collisionIndex.insertCollisionBox(Xs.box,j.get("icon-ignore-placement"),T.bucketInstanceId,mo,we.ID),Ls&&(Ln&&this.collisionIndex.insertCollisionCircles(Ls.circles,j.get("text-ignore-placement"),T.bucketInstanceId,nl,we.ID),_)){const Vs=T.bucketInstanceId;let na=this.collisionCircleArrays[Vs];na===void 0&&(na=this.collisionCircleArrays[Vs]=new ml);for(let ts=0;ts<Ls.circles.length;ts+=4)na.circles.push(Ls.circles[ts+0]),na.circles.push(Ls.circles[ts+1]),na.circles.push(Ls.circles[ts+2]),na.circles.push(Ls.collisionDetected?1:0)}const Za=T.projection.name!=="globe";wr=wr&&(Za||!ps),on=on&&(Za||!Mi),this.placements[Wi]=new Ri(Ln||wr,ki||on,qn||T.justReloaded),d.add(Wi)},Xi=this.retainedQueryData[T.bucketInstanceId].tileID;if(T.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(T,Xi),T.elevationType==="road"&&T.updateRoadElevation(Xi.canonical),T.updateZOffset(),T.sortFeaturesByY){const wn=T.getSortedSymbolIndexes(this.transform.angle);for(let li=wn.length-1;li>=0;--li){const Fn=wn[li];ui(T.symbolInstances.get(Fn),Fn,T.collisionArrays[Fn])}T.hasAnyZOffset&&i.w(`${T.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(T.hasAnyZOffset){const wn=T.getSortedIndexesByZOffset();for(let li=0;li<wn.length;++li){const Fn=wn[li];ui(T.symbolInstances.get(Fn),Fn,T.collisionArrays[Fn])}}else for(let wn=a.symbolInstanceStart;wn<a.symbolInstanceEnd;wn++)ui(T.symbolInstances.get(wn),wn,T.collisionArrays[wn]);if(_&&T.bucketInstanceId in this.collisionCircleArrays){const wn=this.collisionCircleArrays[T.bucketInstanceId];i.bk(wn.invProjMatrix,L),wn.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(a,d,_,y){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:j,verticalPlacedTextSymbolIndex:N,crossTileID:L}=_,B=i.c2(d),X=y===i.bK.vertical?N:B==="left"?b:B==="center"?T:B==="right"?j:-1;b>=0&&(a.text.placedSymbolArray.get(b).crossTileID=X>=0&&b!==X?0:L),T>=0&&(a.text.placedSymbolArray.get(T).crossTileID=X>=0&&T!==X?0:L),j>=0&&(a.text.placedSymbolArray.get(j).crossTileID=X>=0&&j!==X?0:L),N>=0&&(a.text.placedSymbolArray.get(N).crossTileID=X>=0&&N!==X?0:L)}markUsedOrientation(a,d,_){const y=d===i.bK.horizontal||d===i.bK.horizontalOnly?d:0,b=d===i.bK.vertical?d:0,{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:j,rightJustifiedTextSymbolIndex:N,verticalPlacedTextSymbolIndex:L}=_,B=a.text.placedSymbolArray;T>=0&&(B.get(T).placedOrientation=y),j>=0&&(B.get(j).placedOrientation=y),N>=0&&(B.get(N).placedOrientation=y),L>=0&&(B.get(L).placedOrientation=b)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let _=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const y=d?d.symbolFadeChange(a):1,b=d?d.opacities:{},T=d?d.variableOffsets:{},j=d?d.placedOrientations:{};for(const N in this.placements){const L=this.placements[N],B=b[N];B?(this.opacities[N]=new wi(B,y,L.text,L.icon,null,L.clipped),_=_||L.text!==B.text.placed||L.icon!==B.icon.placed):(this.opacities[N]=new wi(null,y,L.text,L.icon,L.skipFade,L.clipped),_=_||L.text||L.icon)}for(const N in b){const L=b[N];if(!this.opacities[N]){const B=new wi(L,y,!1,!1);B.isHidden()||(this.opacities[N]=B,_=_||L.text.placed||L.icon.placed)}}for(const N in T)this.variableOffsets[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.variableOffsets[N]=T[N]);for(const N in j)this.placedOrientations[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.placedOrientations[N]=j[N]);_?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:a)}updateLayerOpacities(a,d,_,y){const b=new Set;for(const T of d){const j=T.getBucket(a);j&&T.latestFeatureIndex&&a.fqid===j.layerIds[0]&&(this.updateBucketOpacities(j,b,T,T.collisionBoxArray,_,y,T.tileID,a.scope),j.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(j,T.tileID),j.elevationType==="road"&&j.updateRoadElevation(T.tileID.canonical),j.updateZOffset())}}updateBucketOpacities(a,d,_,y,b,T,j,N){a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const L=a.layers[0].layout,B=a.layers[0].paint,X=!!a.layers[0].dynamicFilter(),q=new wi(null,0,!1,!1,!0),Q=L.get("text-allow-overlap"),re=L.get("icon-allow-overlap"),ae=L.get("text-variable-anchor"),fe=L.get("text-rotation-alignment")==="map",de=L.get("text-pitch-alignment")==="map",xe=B.get("symbol-z-offset"),je=L.get("symbol-elevation-reference")==="sea",we=!xe.isConstant(),Ve=new wi(null,0,Q&&(re||!a.hasIconData()||L.get("icon-optional")),re&&(Q||!a.hasTextData()||L.get("text-optional")),!0);!a.collisionArrays&&y&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(y);const Ne=(Be,De,We)=>{for(let st=0;st<De/4;st++)Be.opacityVertexArray.emplaceBack(We)};let Ge=0;T&&a.updateReplacement(j,T);for(let Be=0;Be<a.symbolInstances.length;Be++){const De=a.symbolInstances.get(Be),{numHorizontalGlyphVertices:We,numVerticalGlyphVertices:st,crossTileID:rt,numIconVertices:bt,tileAnchorX:_t,tileAnchorY:kt}=De;let nr=null;const ht=this.retainedQueryData[a.bucketInstanceId];we&&De&&ht&&(nr=_.latestFeatureIndex.loadFeature({featureIndex:De.featureIndex,bucketIndex:ht.bucketIndex,sourceLayerIndex:ht.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ke=xe.evaluate(nr,{}),Pt=d.has(rt);let xt=this.opacities[rt];Pt?xt=q:xt||(xt=Ve,this.opacities[rt]=xt),d.add(rt);const qt=We>0||st>0,or=bt>0,Ar=this.placedOrientations[rt],tr=Ar===i.bK.vertical,sr=Ar===i.bK.horizontal||Ar===i.bK.horizontalOnly;!qt&&!or||xt.isHidden()||Ge++;let kr=!1;if((qt||or)&&T)for(const yr of a.activeReplacements){if(i.bY(yr,b,i.bZ.Symbol,N)||yr.min.x>_t||_t>yr.max.x||yr.min.y>kt||kt>yr.max.y)continue;const gr=i.b_(_t,kt,j.canonical,yr.footprintTileId.canonical);if(kr=i.b$(gr,yr.footprint),kr)break}if(qt){const yr=kr?Ha:Xm(xt.text);Ne(a.text,We,tr?Ha:yr),Ne(a.text,st,sr?Ha:yr);const gr=xt.text.isHidden(),{leftJustifiedTextSymbolIndex:wr,centerJustifiedTextSymbolIndex:on,rightJustifiedTextSymbolIndex:Jn,verticalPlacedTextSymbolIndex:ui}=De,Xi=a.text.placedSymbolArray,wn=gr||tr?1:0;wr>=0&&(Xi.get(wr).hidden=wn),on>=0&&(Xi.get(on).hidden=wn),Jn>=0&&(Xi.get(Jn).hidden=wn),ui>=0&&(Xi.get(ui).hidden=gr||sr?1:0);const li=this.variableOffsets[rt];li&&this.markUsedJustification(a,li.anchor,De,Ar);const Fn=this.placedOrientations[rt];Fn&&(this.markUsedJustification(a,"left",De,Fn),this.markUsedOrientation(a,Fn,De))}if(or){const yr=kr?Ha:Xm(xt.icon),{placedIconSymbolIndex:gr,verticalPlacedIconSymbolIndex:wr}=De,on=a.icon.placedSymbolArray,Jn=xt.icon.isHidden()?1:0;gr>=0&&(Ne(a.icon,bt,tr?Ha:yr),on.get(gr).hidden=Jn),wr>=0&&(Ne(a.icon,De.numVerticalIconVertices,sr?Ha:yr),on.get(wr).hidden=Jn)}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const yr=a.collisionArrays[Be];if(yr){let gr=new i.P(0,0),wr=!0;if(yr.textBox||yr.verticalTextBox){if(ae){const Jn=this.variableOffsets[rt];Jn?(gr=Gm(Jn.anchor,Jn.width,Jn.height,Jn.textOffset,Jn.textScale),fe&&gr._rotate(de?this.transform.angle:-this.transform.angle)):wr=!1}X&&(wr=!xt.clipped),yr.textBox&&io(a.textCollisionBox.collisionVertexArray,xt.text.placed,!wr||tr,Ke,je,gr.x,gr.y),yr.verticalTextBox&&io(a.textCollisionBox.collisionVertexArray,xt.text.placed,!wr||sr,Ke,je,gr.x,gr.y)}const on=wr&&!!(!sr&&yr.verticalIconBox);yr.iconBox&&io(a.iconCollisionBox.collisionVertexArray,xt.icon.placed,on,Ke,je,De.hasIconTextFit?gr.x:0,De.hasIconTextFit?gr.y:0),yr.verticalIconBox&&io(a.iconCollisionBox.collisionVertexArray,xt.icon.placed,!on,Ke,je,De.hasIconTextFit?gr.x:0,De.hasIconTextFit?gr.y:0)}}}if(a.fullyClipped=Ge===0,a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.bucketInstanceId in this.collisionCircleArrays){const Be=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=Be.invProjMatrix,a.placementViewportMatrix=Be.viewportMatrix,a.collisionCircleArray=Be.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,d){const _=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*_>a}setStale(){this.stale=!0}}function io(g,a,d,_,y,b,T){g.emplaceBack(a?1:0,d?1:0,b||0,T||0,_,y?1:0),g.emplaceBack(a?1:0,d?1:0,b||0,T||0,_,y?1:0),g.emplaceBack(a?1:0,d?1:0,b||0,T||0,_,y?1:0),g.emplaceBack(a?1:0,d?1:0,b||0,T||0,_,y?1:0)}const ja=Math.pow(2,25),PA=Math.pow(2,24),Hm=Math.pow(2,17),sy=Math.pow(2,16),Zm=Math.pow(2,9),F_=Math.pow(2,8),ay=Math.pow(2,1);function Xm(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const a=g.placed?1:0,d=Math.floor(127*g.opacity);return d*ja+a*PA+d*Hm+a*sy+d*Zm+a*F_+d*ay+a}const Ha=0;class Lu{constructor(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&a.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(a,d,_,y,b,T){const j=this._bucketParts;for(;this._currentTileIndex<a.length;)if(d.getBucketParts(j,y,a[this._currentTileIndex],this._sortAcrossTiles,T),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,j.sort((N,L)=>N.sortKey-L.sortKey));this._currentPartIndex<j.length;){const N=j[this._currentPartIndex];if(d.placeLayerBucketPart(N,this._seenCrossTileIDs,_,N.symbolInstanceStart===0,T),this._currentPartIndex++,b())return!0}return!1}}class el{constructor(a,d,_,y,b,T,j,N,L){this.placement=new Wm(a,b,T,j,N,L),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(a,d,_,y,b){const T=i.o.now(),j=()=>{const N=i.o.now()-T;return!this._forceFullPlacement&&N>2};for(;this._currentPlacementIndex>=0;){const N=d[a[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(N.type==="symbol"&&(!N.minzoom||N.minzoom<=L)&&(!N.maxzoom||N.maxzoom>L)){const B=N,X=B.layout.get("symbol-z-elevate"),q=B.layout.get("symbol-sort-key").constantOr(1)!==void 0,Q=B.layout.get("symbol-z-order"),re=Q==="viewport-y"||Q==="auto"&&!(Q!=="viewport-y"&&q),ae=B.layout.get("text-allow-overlap")||B.layout.get("icon-allow-overlap")||B.layout.get("text-ignore-placement")||B.layout.get("icon-ignore-placement"),fe=re&&ae,de=this._inProgressLayer=this._inProgressLayer||new Lu(B),xe=i.B(N.source,N.scope);if(de.continuePlacement(X||fe?y[xe]:_[xe],this.placement,this._showCollisionBoxes,N,j,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const L_=512/i.al/2;class Pf{constructor(a,d,_){this.tileID=a,this.bucketInstanceId=_,this.index=new i.c3(d.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const y=a.canonical.x*i.al,b=a.canonical.y*i.al;for(let T=0;T<d.length;T++){const{key:j,crossTileID:N,tileAnchorX:L,tileAnchorY:B}=d.get(T),X=Math.floor((y+L)*L_),q=Math.floor((b+B)*L_);this.index.add(X,q),this.keys.push(j),this.crossTileIDs.push(N)}this.index.finish()}findMatches(a,d,_){const y=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),b=L_/Math.pow(2,d.canonical.z-this.tileID.canonical.z),T=d.canonical.x*i.al,j=d.canonical.y*i.al;for(let N=0;N<a.length;N++){const L=a.get(N);if(L.crossTileID)continue;const{key:B,tileAnchorX:X,tileAnchorY:q}=L,Q=Math.floor((T+X)*b),re=Math.floor((j+q)*b),ae=this.index.range(Q-y,re-y,Q+y,re+y).sort((fe,de)=>fe-de);for(const fe of ae){const de=this.crossTileIDs[fe];if(this.keys[fe]===B&&!_.has(de)){_.add(de),L.crossTileID=de;break}}}}}class $a{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ou{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const d=Math.round((a-this.lng)/360);if(d!==0)for(const _ in this.indexes){const y=this.indexes[_],b={};for(const T in y){const j=y[T];j.tileID=j.tileID.unwrapTo(j.tileID.wrap+d),b[j.tileID.key]=j}this.indexes[_]=b}this.lng=a}addBucket(a,d,_){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let b=0;b<d.symbolInstances.length;b++)d.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]=new Set);const y=this.usedCrossTileIDs[a.overscaledZ];for(const b in this.indexes){const T=this.indexes[b];if(Number(b)>a.overscaledZ)for(const j in T){const N=T[j];N.tileID.isChildOf(a)&&N.findMatches(d.symbolInstances,a,y)}else{const j=T[a.scaledTo(Number(b)).key];j&&j.findMatches(d.symbolInstances,a,y)}}for(let b=0;b<d.symbolInstances.length;b++){const T=d.symbolInstances.get(b);T.crossTileID||(T.crossTileID=_.generate(),y.add(T.crossTileID))}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new Pf(a,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(a,d){for(const _ of d.crossTileIDs)this.usedCrossTileIDs[a].delete(_)}removeStaleBuckets(a){let d=!1;for(const _ in this.indexes){const y=this.indexes[_];for(const b in y)a[y[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,y[b]),delete y[b],d=!0)}return d}}class zu{constructor(){this.layerIndexes={},this.crossTileIDs=new $a,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,d,_,y){let b=this.layerIndexes[a.fqid];b===void 0&&(b=this.layerIndexes[a.fqid]=new ou);let T=!1;const j={};y.name!=="globe"&&b.handleWrapJump(_);for(const N of d){const L=N.getBucket(a);L&&a.fqid===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(N.tileID,L,this.crossTileIDs)&&(T=!0),j[L.bucketInstanceId]=!0)}return b.removeStaleBuckets(j)&&(T=!0),T}pruneUnusedLayers(a){const d={};a.forEach(_=>{d[_]=!0});for(const _ in this.layerIndexes)d[_]||delete this.layerIndexes[_]}}const oa=771;class Vn{constructor(a,d,_,y){this.blendFunction=a,this.blendColor=d.toNonPremultipliedRenderColor(null),this.mask=_,this.blendEquation=y}}Vn.Replace=[1,0,1,0],Vn.disabled=new Vn(Vn.Replace,i.ao.transparent,[!1,!1,!1,!1]),Vn.unblended=new Vn(Vn.Replace,i.ao.transparent,[!0,!0,!0,!0]),Vn.alphaBlended=new Vn([1,oa,1,oa],i.ao.transparent,[!0,!0,!0,!0]),Vn.alphaBlendedNonPremultiplied=new Vn([770,oa,770,oa],i.ao.transparent,[!0,!0,!0,!0]),Vn.multiply=new Vn([774,0,774,0],i.ao.transparent,[!0,!0,!0,!0]),Vn.additive=new Vn([1,1,1,1],i.ao.transparent,[!0,!0,!0,!0]);class Rr{constructor(a,d,_){this.func=a,this.mask=d,this.range=_}}Rr.ReadOnly=!1,Rr.ReadWrite=!0,Rr.disabled=new Rr(519,Rr.ReadOnly,[0,1]);const Th=7680;class Cn{constructor(a,d,_,y,b,T){this.test=a,this.ref=d,this.mask=_,this.fail=y,this.depthFail=b,this.pass=T}}Cn.disabled=new Cn({func:519,mask:0},0,0,Th,Th,Th);const Df=1029,z_=2305;class yn{constructor(a,d,_){this.enable=a,this.mode=d,this.frontFace=_}}function Ym(g,a){const d=i.c9(g,3);i.cb(g,a),i.cf(g,3,d)}function B_(g,a){const d=i.c6([]);return i.c7(d,d,-a),i.c8(d,d,-g),d}function u2(g,a){const d=[g[0],g[1],0],_=[a[0],a[1],0];if(i.ag(d)>=1e-15){const T=i.aw([],d);i.c4(_,T,i.bI(_,T)),a[0]=_[0],a[1]=_[1]}const y=i.bH([],a,g);if(i.c5(y)<1e-15)return null;const b=Math.atan2(-y[1],y[0]);return B_(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),b)}yn.disabled=new yn(!1,Df,z_),yn.backCCW=new yn(!0,Df,z_),yn.backCW=new yn(!0,Df,2304),yn.frontCW=new yn(!0,1028,2304),yn.frontCCW=new yn(!0,1028,z_);class lu{constructor(a,d){this.position=a,this.orientation=d}get position(){return this._position}set position(a){if(a){const d=a instanceof i.ae?a:new i.ae(a[0],a[1],a[2]);this._renderWorldCopies&&(d.x=i.bS(d.x,0,1)),this._position=d}else this._position=null}lookAtPoint(a,d,_){if(this.orientation=null,!this.position)return;const y=this.position,b=_||(this._elevation?this._elevation.getAtPointOrZero(i.ae.fromLngLat(a)):0),T=i.ae.fromLngLat(a,b),j=[T.x-y.x,T.y-y.y,T.z-y.z];d||(d=[0,0,1]),d[2]=Math.abs(d[2]),this.orientation=u2(j,d)}setPitchBearing(a,d){this.orientation=B_(i.an(a),i.an(-d))}}class U_{constructor(a,d){this._transform=i.bz([]),this.orientation=d,this.position=a}get mercatorPosition(){const a=this.position;return new i.ae(a[0],a[1],a[2])}get position(){const a=i.c9(this._transform,3);return[a[0],a[1],a[2]]}set position(a){var d;a&&i.cf(this._transform,3,[(d=a)[0],d[1],d[2],1])}get orientation(){return this._orientation}set orientation(a){this._orientation=a||i.c6([]),a&&Ym(this._transform,this._orientation)}getPitchBearing(){const a=this.forward(),d=this.right();return{bearing:Math.atan2(-d[1],d[0]),pitch:Math.atan2(Math.sqrt(a[0]*a[0]+a[1]*a[1]),-a[2])}}setPitchBearing(a,d){this._orientation=B_(a,d),Ym(this._transform,this._orientation)}forward(){const a=i.c9(this._transform,2);return[-a[0],-a[1],-a[2]]}up(){const a=i.c9(this._transform,1);return[-a[0],-a[1],-a[2]]}right(){const a=i.c9(this._transform,0);return[a[0],a[1],a[2]]}getCameraToWorld(a,d){const _=new Float64Array(16);return i.bk(_,this.getWorldToCamera(a,d)),_}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(a,d,_){const y=this.position;i.c4(y,y,-a);const b=new Float64Array(16);return i.bp(b,[_,_,_]),i.bq(b,b,y),b[10]*=d,b}getWorldToCamera(a,d){const _=new Float64Array(16),y=new Float64Array(4),b=this.position;return i.ca(y,this._orientation),i.c4(b,b,-a),i.cb(_,y),i.bq(_,_,b),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=d,_[9]*=d,_[10]*=d,_[11]*=d,_}getCameraToClipPerspective(a,d,_,y){const b=new Float64Array(16);return i.cc(b,a,d,_,y),b}getCameraToClipOrthographic(a,d,_,y,b,T){const j=new Float64Array(16);return i.cd(j,a,d,_,y,b,T),j}getDistanceToElevation(a,d=!1){const _=a===0?0:i.ce(a,d?i.a_(this.position[1]):this.position[1]),y=this.forward();return(_-this.position[2])/y[2]}clone(){return new U_([...this.position],[...this.orientation])}}const so={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class ko{constructor(a=0,d=0,_=0,y=0){if(isNaN(a)||a<0||isNaN(d)||d<0||isNaN(_)||_<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=d,this.left=_,this.right=y}interpolate(a,d,_){return d.top!=null&&a.top!=null&&(this.top=i.ak(a.top,d.top,_)),d.bottom!=null&&a.bottom!=null&&(this.bottom=i.ak(a.bottom,d.bottom,_)),d.left!=null&&a.left!=null&&(this.left=i.ak(a.left,d.left,_)),d.right!=null&&a.right!=null&&(this.right=i.ak(a.right,d.right,_)),this}getCenter(a,d){const _=i.aA((this.left+a-this.right)/2,0,a),y=i.aA((this.top+d-this.bottom)/2,0,d);return new i.P(_,y)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new ko(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Eh=15;class Rf{constructor(a,d,_,y,b,T,j){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=a||0,this._maxZoom=d||22,this._minPitch=_??0,this._maxPitch=y??60,this.setProjection(T),this.setMaxBounds(j),this.width=0,this.height=0,this._center=new i.aS(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ko,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new U_,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const a=new Rf(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return a._elevation=this._elevation,a._centerAltitude=this._centerAltitude,a._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,a.tileSize=this.tileSize,a.mercatorFromTransition=this.mercatorFromTransition,a.width=this.width,a.height=this.height,a.cameraElevationReference=this.cameraElevationReference,a._center=this._center,a._setZoom(this.zoom),a._seaLevelZoom=this._seaLevelZoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._nearZ=this._nearZ,a._farZ=this._farZ,a._averageElevation=this._averageElevation,a._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._camera=this._camera.clone(),a._calcMatrices(),a.freezeTileCoverage=this.freezeTileCoverage,a.frustumCorners=this.frustumCorners,a._allowWorldUnderZoom=this._allowWorldUnderZoom,a}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Eh}get elevation(){return this._elevation}set elevation(a){this._elevation!==a&&(this._elevation=a,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(a,d=!1){const _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||_)&&this._updateCameraOnTerrain(),(a||_)&&this._constrainCamera(d),this._calcMatrices()}getProjection(){return i.aH(this.projection,["name","center","parallels"])}setProjection(a){this.projectionOptions=a||{name:"mercator"};const d=this.projection?this.getProjection():void 0;this.projection=i.cl(this.projectionOptions);const _=this.getProjection(),y=!i.bx(d,_);return y&&this._calcMatrices(),this.mercatorFromTransition=!1,y}setOrthographicProjectionAtLowPitch(a){return this._orthographicProjectionAtLowPitch!==a&&(this._orthographicProjectionAtLowPitch=a,this._calcMatrices(),!0)}setMercatorFromTransition(){const a=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.cl({name:"mercator"});const d=a!==this.projection.name;return d&&this._calcMatrices(),d}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get cameraWorldSize(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return i.bS(this.rotation,-180,180)}set bearing(a){this.rotation=a}get rotation(){return-this.angle/Math.PI*180}set rotation(a){const d=-a*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=i.cm(),i.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const d=i.aA(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=i.an(a),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const a=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/a)}get averageElevation(){return this._averageElevation}set averageElevation(a){this._averageElevation=a,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(a){const d=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._setZoom(d),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(a){this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(a){this._tileCoverLift!==a&&(this._tileCoverLift=a)}_updateCameraOnTerrain(){const a=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,d=this.elevation&&a===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||a===Number.NEGATIVE_INFINITY&&(!d||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const _=this._elevation;d||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&_.exaggeration()&&this._centerAltitudeValidForExaggeration!==_.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*_.exaggeration(),this._centerAltitudeValidForExaggeration=_.exaggeration()):(this._centerAltitude=a||0,this._centerAltitudeValidForExaggeration=_.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const a=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(a)}sampleAverageElevation(){if(!this._elevation)return 0;const a=this._elevation,d=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let y=0,b=0;for(let T=0;T<d.length;T++){const j=new i.P(d[T][0]*this.width,_+d[T][1]*(this.height-_)),N=a.pointCoordinate(j);if(!N)continue;const L=1/Math.hypot(N[0]-this._camera.position[0],N[1]-this._camera.position[1]);y+=N[3]*L,b+=L}return b===0?NaN:y/b}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const a=this._seaLevelZoom,d=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*d,y=this._mercatorZfromZoom(a),b=this._mercatorZfromZoom(this._maxZoom),T=Math.max(y-_,b);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}computeZoomRelativeTo(a){const d=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,a.toAltitude()));let _;_=a.z<this._camera.position[2]?[d.x,d.y,d.z]:[a.x,a.y,a.z];const y=i.ag(i.av([],this._camera.position,_));return i.aA(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(a){if(!this.height||!a.position&&!a.orientation)return;this._updateCameraState();let d=!1;if(a.orientation&&!i.co(a.orientation,this._camera.orientation)&&(d=this._setCameraOrientation(a.orientation)),a.position){const _=[a.position.x,a.position.y,a.position.z];i.cp(_,this._camera.position)||(this._setCameraPosition(_),d=!0)}d&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const a=this._camera.position,d=new lu;return d.position=new i.ae(a[0],a[1],a[2]),d.orientation=this._camera.orientation,d._elevation=this.elevation,d._renderWorldCopies=this.renderWorldCopies,d}_setCameraOrientation(a){if(!i.cq(a))return!1;i.cr(a,a);const d=i.cs([],[0,0,-1],a),_=i.cs([],[0,-1,0],a);if(_[2]<0)return!1;const y=u2(d,_);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(a){const d=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;a[2]=i.aA(a[2],y/_,y/d),this._camera.position=a}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,d,_){this._unmodified=!1,this._edgeInsets.interpolate(a,d,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const d=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(a){const d=[new i.ct(0,a)];if(this.renderWorldCopies){const _=this.pointCoordinate(new i.P(0,0)),y=this.pointCoordinate(new i.P(this.width,0)),b=this.pointCoordinate(new i.P(this.width,this.height)),T=this.pointCoordinate(new i.P(0,this.height)),j=Math.floor(Math.min(_.x,y.x,b.x,T.x)),N=Math.floor(Math.max(_.x,y.x,b.x,T.x)),L=1;for(let B=j-L;B<=N+L;B++)B!==0&&d.push(new i.ct(B,a))}return d}isLODDisabled(a){return(!a||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(a,d,_){let y=[];const b=_!=null,T=!b;if(T&&this.zoom<d||b&&_[0]===0&&_[1]===0)return y;const j=new Set,N=(B,X,q,Q,re)=>{const ae=i.cX(X,B,q,Q,re);j.has(ae)||(y.push(new i.aP(B,X,q,Q,re)),j.add(ae))};for(let B=0;B<a.length;B++){const X=a[B];if(T&&X.canonical.z!==d)continue;const q=X.canonical,Q=X.overscaledZ,re=X.wrap,ae=1<<q.z,fe=q.x+1<ae,de=q.x>0,xe=q.y+1<ae,je=q.y>0,we=X.wrap-(de?0:1),Ve=X.wrap+(fe?0:1),Ne=de?q.x-1:ae-1,Ge=fe?q.x+1:0;if(b)_[0]<0?(N(Q,Ve,q.z,Ge,q.y),_[1]<0&&xe&&(N(Q,re,q.z,q.x,q.y+1),N(Q,Ve,q.z,Ge,q.y+1)),_[1]>0&&je&&(N(Q,re,q.z,q.x,q.y-1),N(Q,Ve,q.z,Ge,q.y-1))):_[0]>0?(N(Q,we,q.z,Ne,q.y),_[1]<0&&xe&&(N(Q,re,q.z,q.x,q.y+1),N(Q,we,q.z,Ne,q.y+1)),_[1]>0&&je&&(N(Q,re,q.z,q.x,q.y-1),N(Q,we,q.z,Ne,q.y-1))):_[1]<0&&xe?N(Q,re,q.z,q.x,q.y+1):je&&N(Q,re,q.z,q.x,q.y-1);else{const Be=X.visibleQuadrants;1&Be&&(N(Q,we,q.z,Ne,q.y),je&&(N(Q,re,q.z,q.x,q.y-1),N(Q,we,q.z,Ne,q.y-1))),2&Be&&(N(Q,Ve,q.z,Ge,q.y),je&&(N(Q,re,q.z,q.x,q.y-1),N(Q,Ve,q.z,Ge,q.y-1))),4&Be&&(N(Q,we,q.z,Ne,q.y),xe&&(N(Q,re,q.z,q.x,q.y+1),N(Q,we,q.z,Ne,q.y+1))),8&Be&&(N(Q,Ve,q.z,Ge,q.y),xe&&(N(Q,re,q.z,q.x,q.y+1),N(Q,Ve,q.z,Ge,q.y+1)))}}const L=[];for(const B of y)y.some(X=>B.isChildOf(X))||L.push(B);if(y=L.filter(B=>!a.some(X=>!!(B.overscaledZ<d&&X.isChildOf(B))||B.equals(X)||B.isChildOf(X))),T){const B=1<<d,X=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),q=[B*X.x,B*X.y],Q=4,re=Q*Q;y=y.filter(ae=>{const fe=ae.canonical.x+.5-q[0],de=ae.canonical.y+.5-q[1];return fe*fe+de*de<re})}return y}extendTileCoverToNearPlane(a,d,_){const y=[],b=new Set;for(const xe of a)b.add(xe.key);const T=(xe,je,we,Ve,Ne)=>{const Ge=i.cX(je,xe,we,Ve,Ne);b.has(Ge)||(y.push(new i.aP(xe,je,we,Ve,Ne)),b.add(Ge))},j=a.reduce((xe,je)=>Math.max(xe,je.overscaledZ),_),N=1<<_,L=[new i.P(0,0),new i.P(i.al,0),new i.P(i.al,i.al),new i.P(0,i.al)],B=new i.P(0,0),X=new i.P(0,0),q=(xe,je)=>{const we=Math.floor(xe[0]),Ve=Math.floor(xe[1]),Ne=(xe[0]-we)*i.al,Ge=(xe[1]-Ve)*i.al,Be=Math.floor(je[0]),De=Math.floor(je[1]),We=(je[0]-Be)*i.al,st=(je[1]-De)*i.al;for(let rt=-1;rt<=1;rt++){const bt=we+rt;if(!(bt<0||bt>=N)){B.x=Ne-rt*i.al,X.x=We-(bt-Be)*i.al;for(let _t=-1;_t<=1;_t++){const kt=Ve+_t;B.y=Ge-_t*i.al,X.y=st-(kt-De)*i.al,i.cY(B,X,L)&&T(j,0,_,bt,kt)}}}},Q=d.points,re=Q[i.cu],ae=Q[i.cv],fe=this._projectToGround(re,Q[i.cw]),de=this._projectToGround(ae,Q[i.cx]);return q(re,fe),q(ae,de),y}_projectToGround(a,d){return i.cy(i.cz(),a,d,a[2]/(a[2]-d[2]))}coveringTiles(a){let d=this.coveringZoomLevel(a);const _=d,y=this.elevation&&this.elevation.exaggeration(),b=y&&!a.isTerrainDEM,T=this.projection.name==="mercator";if(a.minzoom!==void 0&&d<a.minzoom)return[];a.maxzoom!==void 0&&d>a.maxzoom&&(d=a.maxzoom);const j=this.locationCoordinate(this.center),N=this.center.lat,L=1<<d,B=[L*j.x,L*j.y,0],X=this.projection.name==="globe",q=!X,Q=i.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d,q),re=X?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ae=L*i.ce(1,this.center.lat),fe=this._camera.position[2]/i.ce(1,this.center.lat),de=[L*re.x,L*re.y,fe*(q?1:ae)],xe=X||y,je=this.cameraToCenterDistance/a.tileSize*(a.roundZoom?1:.502),we=this.isLODDisabled(!0)?d:0;let Ve;if(this._elevation&&a.isTerrainDEM)Ve=1e4*this._elevation.exaggeration();else if(this._elevation){const Ke=this._elevation.getMinMaxForVisibleTiles();Ve=Ke?Ke.max:this._centerAltitude}else Ve=this._centerAltitude;const Ne=a.isTerrainDEM?-Ve:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ge=this.projection.isReprojectedInTileSpace?i.cB(this):1,Be=Ke=>{const xt=new i.ae(Ke.x+25e-6,Ke.y,Ke.z),qt=new i.ae(Ke.x,Ke.y+25e-6,Ke.z),or=Ke.toLngLat(),Ar=xt.toLngLat(),tr=qt.toLngLat(),sr=this.locationCoordinate(or),kr=this.locationCoordinate(Ar),yr=this.locationCoordinate(tr),gr=Math.hypot(kr.x-sr.x,kr.y-sr.y),wr=Math.hypot(yr.x-sr.x,yr.y-sr.y);return Math.sqrt(gr*wr)*Ge/25e-6},De=Ke=>{const Pt=Ve,xt=Ne;return{aabb:i.cE(this,L,0,0,0,Ke,xt,Pt,this.projection),zoom:0,x:0,y:0,minZ:xt,maxZ:Pt,wrap:Ke,fullyVisible:!1}},We=[];let st=[];const rt=d,bt=a.reparseOverscaled?_:d,_t=(fe-this._centerAltitude)*ae,kt=Ke=>{if(!this._elevation||!Ke.tileID||!T)return;const Pt=this._elevation.getMinMaxForTile(Ke.tileID),xt=Ke.aabb;Pt?(xt.min[2]=Pt.min,xt.max[2]=Pt.max,xt.center[2]=(xt.min[2]+xt.max[2])/2):(Ke.shouldSplit=ht(Ke),Ke.shouldSplit||(xt.min[2]=xt.max[2]=xt.center[2]=this._centerAltitude))},nr=(Ke,Pt)=>{if(.707*Pt<Ke)return 1;const xt=Pt/Ke;return xt/(1.4144271570014144+(Math.pow(1.1,xt-1.4144271570014144+1)-1)/(1.1-1)-1)},ht=Ke=>{if(Ke.zoom<we)return!0;if(Ke.zoom===rt)return!1;if(Ke.shouldSplit!=null)return Ke.shouldSplit;const Pt=Ke.aabb.distanceX(de),xt=Ke.aabb.distanceY(de);let qt=_t,or=1;if(X){qt=Ke.aabb.distanceZ(de);const wr=Math.pow(2,Ke.zoom),on=i.a_((Ke.y+1)/wr),Jn=i.a_(Ke.y/wr),ui=Math.min(Math.max(N,on),Jn),Xi=i.d0(ui)/i.d0(N);if(or=ui===N?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Xi/this._mercatorScaleRatio),this.zoom<=i.cZ&&Ke.zoom===rt-1&&Xi>=.9)return!0}else if(b&&(qt=Ke.aabb.distanceZ(de)*ae),this.projection.isReprojectedInTileSpace&&_<=5){const wr=Math.pow(2,Ke.zoom),on=Be(new i.ae((Ke.x+.5)/wr,(Ke.y+.5)/wr));or=on>.85?1:on}if(!T&&!X){const wr=Math.sqrt(Pt*Pt+xt*xt+qt*qt);let on=(1<<rt-Ke.zoom)*je*or;return on*=nr(Math.max(qt,_t),wr),wr<on}let Ar=Number.MAX_VALUE,tr=0;const sr=Ke.aabb.getCorners(),kr=[];for(const wr of sr){i.av(kr,wr,de),X||(b?kr[2]*=ae:kr[2]=_t);const on=i.bI(kr,this._camera.forward());on<Ar&&(Ar=on,tr=Math.abs(kr[2]))}let yr=(1<<rt-Ke.zoom)*je*or;if(yr*=nr(Math.max(tr,_t),Ar),Ar<yr)return!0;const gr=Ke.aabb.closestPoint(B);return gr[0]===B[0]&&gr[1]===B[1]};if(this.renderWorldCopies)for(let Ke=1;Ke<=3;Ke++)We.push(De(-Ke)),We.push(De(Ke));for(We.push(De(0));We.length>0;){const Ke=We.pop(),Pt=Ke.x,xt=Ke.y;let qt=Ke.fullyVisible;const or=()=>this.projection.name==="globe"&&(Ke.y===0||Ke.y===(1<<Ke.zoom)-1);if(!qt){let Ar=xe?Ke.aabb.intersects(Q):Ke.aabb.intersectsFlat(Q);if(Ar===0&&or()){const tr=new i.cC(Ke.zoom,Pt,xt);Ar=i.cD(this,L,tr,!0).intersects(Q)}if(Ar===0)continue;qt=Ar===2}if(Ke.zoom!==rt&&ht(Ke))for(let Ar=0;Ar<4;Ar++){const tr=(Pt<<1)+Ar%2,sr=(xt<<1)+(Ar>>1),kr={aabb:T?Ke.aabb.quadrant(Ar):i.cE(this,L,Ke.zoom+1,tr,sr,Ke.wrap,Ke.minZ,Ke.maxZ,this.projection),zoom:Ke.zoom+1,x:tr,y:sr,wrap:Ke.wrap,fullyVisible:qt,tileID:void 0,shouldSplit:void 0,minZ:Ke.minZ,maxZ:Ke.maxZ};b&&!X&&(kr.tileID=new i.aP(Ke.zoom+1===rt?bt:Ke.zoom+1,Ke.wrap,Ke.zoom+1,tr,sr),kt(kr)),We.push(kr)}else{const Ar=Ke.zoom===rt?bt:Ke.zoom;if(a.minzoom&&a.minzoom>Ar)continue;let tr=0;if(!qt){let gr=xe?Ke.aabb.intersectsPrecise(Q):Ke.aabb.intersectsPreciseFlat(Q);if(gr===0&&or()){const wr=new i.cC(Ke.zoom,Pt,xt);gr=i.cD(this,L,wr,!0).intersectsPrecise(Q)}if(gr===0)continue;if(a.calculateQuadrantVisibility)if(Q.containsPoint(Ke.aabb.center))tr=15;else for(let wr=0;wr<4;wr++)Ke.aabb.quadrant(wr).intersects(Q)!==0&&(tr|=1<<wr)}const sr=B[0]-(.5+Pt+(Ke.wrap<<Ke.zoom))*(1<<d-Ke.zoom),kr=B[1]-.5-xt,yr=Ke.tileID?Ke.tileID:new i.aP(Ar,Ke.wrap,Ke.zoom,Pt,xt);a.calculateQuadrantVisibility&&(yr.visibleQuadrants=tr),st.push({tileID:yr,distanceSq:sr*sr+kr*kr})}}if(this.fogCullDistSq){const Ke=this.fogCullDistSq,Pt=this.horizonLineFromTop();st=st.filter(xt=>{const qt=[0,0,0,1],or=[i.al,i.al,0,1],Ar=this.calculateFogTileMatrix(xt.tileID.toUnwrapped());i.aC(qt,qt,Ar),i.aC(or,or,Ar);const tr=i.cF([],qt,or),sr=i.cG([],qt,or),kr=i.c_(tr,sr);if(kr===0)return!0;let yr=!1;const gr=this._elevation;if(gr&&kr>Ke&&Pt!==0){const wr=this.calculateProjMatrix(xt.tileID.toUnwrapped());let on;a.isTerrainDEM||(on=gr.getMinMaxForTile(xt.tileID)),on||(on={min:Ne,max:Ve});const Jn=i.cH(this.rotation),ui=[Jn[0]*i.al,Jn[1]*i.al,on.max];i.af(ui,ui,wr),yr=(1-ui[1])*this.height*.5<Pt}return kr<Ke||yr})}return st.sort((Ke,Pt)=>Ke.distanceSq-Pt.distanceSq).map(Ke=>Ke.tileID)}resize(a,d){this.width=a,this.height=d,this.pixelsToGLUnits=[2/a,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log2(a)}project(a){const d=i.aA(a.lat,-i.cI,i.cI),_=this.projection.project(a.lng,d);return new i.P(_.x*this.worldSize,_.y*this.worldSize)}unproject(a){return this.projection.unproject(a.x/this.worldSize,a.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(a,d){let _,y;const b=this.centerPoint;if(this.projection.name==="globe"){const j=this.worldSize;_=(d.x-b.x)/j,y=(d.y-b.y)/j}else{const j=this.pointCoordinate(d),N=this.pointCoordinate(b);_=j.x-N.x,y=j.y-N.y}const T=this.locationCoordinate(a);this.setLocation(new i.ae(T.x-_,T.y-y))}setLocation(a){this.center=this.coordinateLocation(a),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(a,d){return this.projection.locationPoint(this,a,d)}locationPoint3D(a,d){return this.projection.locationPoint(this,a,d,!0)}pointLocation(a){return this.coordinateLocation(this.pointCoordinate(a))}pointLocation3D(a,d){return this.coordinateLocation(this.pointCoordinate3D(a,d))}locationCoordinate(a,d){const _=d?i.ce(d,a.lat):void 0,y=this.projection.project(a.lng,a.lat);return new i.ae(y.x,y.y,_)}coordinateLocation(a){return this.projection.unproject(a.x,a.y)}pointRayIntersection(a,d){const _=d??this._centerAltitude,y=[a.x,a.y,0,1],b=[a.x,a.y,1,1];i.aC(y,y,this.pixelMatrixInverse),i.aC(b,b,this.pixelMatrixInverse);const T=b[3];i.cJ(y,y,1/y[3]),i.cJ(b,b,1/T);const j=y[2],N=b[2];return{p0:y,p1:b,t:j===N?0:(_-j)/(N-j)}}screenPointToMercatorRay(a){const d=[a.x,a.y,0,1],_=[a.x,a.y,1,1];return i.aC(d,d,this.pixelMatrixInverse),i.aC(_,_,this.pixelMatrixInverse),i.cJ(d,d,1/d[3]),i.cJ(_,_,1/_[3]),d[2]=i.ce(d[2],this._center.lat)*this.worldSize,_[2]=i.ce(_[2],this._center.lat)*this.worldSize,i.cJ(d,d,1/this.worldSize),i.cJ(_,_,1/this.worldSize),new i.ax([d[0],d[1],d[2]],i.aw([],i.av([],_,d)))}rayIntersectionCoordinate(a){const{p0:d,p1:_,t:y}=a,b=i.ce(d[2],this._center.lat),T=i.ce(_[2],this._center.lat);return new i.ae(i.ak(d[0],_[0],y)/this.worldSize,i.ak(d[1],_[1],y)/this.worldSize,i.ak(b,T,y))}pointCoordinate(a,d=this._centerAltitude){return this.projection.pointCoordinate(this,a.x,a.y,d)}pointCoordinate3D(a,d){if(!this.elevation)return this.pointCoordinate(a,d);let _=this.projection.pointCoordinate3D(this,a.x,a.y);if(_)return new i.ae(_[0],_[1],_[2]);let y=0,b=this.horizonLineFromTop();if(a.y>b)return this.pointCoordinate(a,d);const T=.02*b,j=a.clone();for(let N=0;N<10&&b-y>T;N++){j.y=i.ak(y,b,.66);const L=this.projection.pointCoordinate3D(this,j.x,j.y);L?(b=j.y,_=L):y=j.y}return _?new i.ae(_[0],_[1],_[2]):this.pointCoordinate(a)}isPointAboveHorizon(a){return this.projection.isPointAboveHorizon(this,a)}isPointOnSurface(a){if(a.y<0||a.y>this.height||a.x<0||a.x>this.width)return!1;if(this.elevation||this.zoom>=i.cK)return!this.isPointAboveHorizon(a);const d=this.pointCoordinate(a);return d.y>=0&&d.y<=1}_coordinatePoint(a,d){const _=d&&this.elevation?this.elevation.getAtPointOrZero(a,this._centerAltitude):this._centerAltitude,y=[a.x*this.worldSize,a.y*this.worldSize,_+a.toAltitude(),1];return i.aC(y,y,this.pixelMatrix),y[3]>0?new i.P(y[0]/y[3],y[1]/y[3]):new i.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:a,left:d}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,b=this.pointLocation3D(new i.P(d,a)),T=this.pointLocation3D(new i.P(y,a)),j=this.pointLocation3D(new i.P(y,_)),N=this.pointLocation3D(new i.P(d,_));let L=Math.min(b.lng,T.lng,j.lng,N.lng),B=Math.max(b.lng,T.lng,j.lng,N.lng),X=Math.min(b.lat,T.lat,j.lat,N.lat),q=Math.max(b.lat,T.lat,j.lat,N.lat);const Q=Math.pow(2,-this.zoom)/16*270,re=this.projection.name==="globe"?1:4,ae=(fe,de,xe,je,we)=>{const Ve=(fe+xe)/2,Ne=(de+je)/2,Ge=new i.P(Ve,Ne),{lng:Be,lat:De}=this.pointLocation3D(Ge),We=Math.max(0,L-Be,X-De,Be-B,De-q);L=Math.min(L,Be),B=Math.max(B,Be),X=Math.min(X,De),q=Math.max(q,De),(we<re||We>Q)&&(ae(fe,de,Ve,Ne,we+1),ae(Ve,Ne,xe,je,we+1))};if(ae(d,a,y,a,1),ae(y,a,y,_,1),ae(y,_,d,_,1),ae(d,_,d,a,1),this.projection.name==="globe"){const[fe,de]=i.cL(this);fe?(q=90,B=180,L=-180):de&&(X=-90,B=180,L=-180)}return new i.aI(new i.aS(L,X),new i.aS(B,q))}_getBoundsRectangular(a,d){const{top:_,left:y}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,j=new i.P(y,_),N=new i.P(T,_),L=new i.P(T,b),B=new i.P(y,b);let X=this.pointCoordinate(j,a),q=this.pointCoordinate(N,a);const Q=this.pointCoordinate(L,d),re=this.pointCoordinate(B,d),ae=(fe,de)=>(de.y-fe.y)/(de.x-fe.x);return X.y>1&&q.y>=0?X=new i.ae((1-re.y)/ae(re,X)+re.x,1):X.y<0&&q.y<=1&&(X=new i.ae(-re.y/ae(re,X)+re.x,0)),q.y>1&&X.y>=0?q=new i.ae((1-Q.y)/ae(Q,q)+Q.x,1):q.y<0&&X.y<=1&&(q=new i.ae(-Q.y/ae(Q,q)+Q.x,0)),new i.aI().extend(this.coordinateLocation(X)).extend(this.coordinateLocation(q)).extend(this.coordinateLocation(re)).extend(this.coordinateLocation(Q))}_getBoundsRectangularTerrain(){const a=this.elevation;if(!a.visibleDemTiles.length||a.isUsingMockSource())return this._getBoundsRectangular(0,0);const d=a.visibleDemTiles.reduce((_,y)=>{if(y.dem){const b=y.dem.tree;_.min=Math.min(_.min,b.minimums[0]),_.max=Math.max(_.max,b.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(d.min*a.exaggeration(),d.max*a.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(a=!0){const d=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,_=this.height/2-d*(1-this._horizonShift);return a?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(a){this.maxBounds=a,this.minLat=-i.cI,this.maxLat=i.cI,this.minLng=-180,this.maxLng=180,a&&(this.minLat=a.getSouth(),this.maxLat=a.getNorth(),this.minLng=a.getWest(),this.maxLng=a.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.aF(this.minLng)*this.tileSize,this.worldMaxX=i.aF(this.maxLng)*this.tileSize,this.worldMinY=i.aJ(this.maxLat)*this.tileSize,this.worldMaxY=i.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(a,d){return this.projection.createTileMatrix(this,d,a)}calculateDistanceTileData(a){const d=a.key,_=this._distanceTileDataCache;if(_[d])return _[d];const y=a.canonical,b=1/this.height,T=this.cameraWorldSize,j=T/this.zoomScale(y.z),N=(y.x+Math.pow(2,y.z)*a.wrap)*j,L=y.y*j,B=this.point;B.x*=T/this.worldSize,B.y*=T/this.worldSize;const X=this.angle,q=Math.sin(-X),Q=-Math.cos(-X);return _[d]={bearing:[q,Q],center:[(B.x-N)*b,(B.y-L)*b],scale:j/i.al*b},_[d]}calculateFogTileMatrix(a){const d=a.key,_=this._fogTileMatrixCache;if(_[d])return _[d];const y=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,a);return i.aB(y,this.worldToFogMatrix,y),_[d]=new Float32Array(y),_[d]}calculateProjMatrix(a,d=!1,_=!1){const y=a.key;let b;if(b=_?this._expandedProjMatrixCache:d?this._alignedProjMatrixCache:this._projMatrixCache,b[y])return b[y];const T=this.calculatePosMatrix(a,this.worldSize);let j;return j=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:_?this.expandedFarZProjMatrix:d?this.alignedProjMatrix:this.projMatrix,i.aB(T,j,T),b[y]=new Float32Array(T),b[y]}calculatePixelsToTileUnitsMatrix(a){const d=a.tileID.key,_=this._pixelsToTileUnitsCache;if(_[d])return _[d];const y=i.cM(a,this);return _[d]=y,_[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const a=1/this.worldSize,d=i.bp([],[a,a,a]);return i.aB(d,d,this.globeMatrix),d}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const a=this._elevation;this._updateCameraState();const d=i.ce(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(d),y=this._camera.forward(),b=i.ce(1,this._center.lat);_[2]/=b,y[2]/=b,i.aw(y,y);const T=a.raycast(_,y,a.exaggeration());if(T){const j=i.bG([],_,y,T),N=new i.ae(j[0],j[1],i.ce(j[2],i.a_(j[1]))),L=(N.z+i.ag([N.x-_[0],N.y-_[1],N.z-_[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(L),this._centerAltitude=N.toAltitude(),this._center=this.coordinateLocation(N),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(a=!1){if(!this._elevation)return;const d=this._elevation,_=i.ce(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(_),b=d.getAtPointOrZero(new i.ae(...y)),T=this.pixelsPerMeter/this.worldSize*b,j=this._minimumHeightOverTerrain(),N=y[2]-T;if(N<=j)if(N<0||a){const L=this.locationCoordinate(this._center,this._centerAltitude),B=[y[0],y[1],L.z-y[2]],X=i.ag(B);B[2]-=(j-N)/this._pixelsPerMercatorPixel;const q=i.ag(B);if(q===0)return;i.c4(B,B,X/q*this._pixelsPerMercatorPixel),this._camera.position=[y[0],y[1],L.z*this._pixelsPerMercatorPixel-B[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const a=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||a){const q=this.center;return q.lat=i.aA(q.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!a)&&(q.lng=i.aA(q.lng,this.minLng,this.maxLng)),this.center=q,void(this._constraining=!1)}const d=this._unmodified,{x:_,y}=this.point;let b=0,T=_,j=y;const N=this.width/2,L=this.height/2,B=this.worldMinY*this.scale,X=this.worldMaxY*this.scale;if(y-L<B&&(j=B+L),y+L>X&&(j=X-L),X-B<this.height&&(b=Math.max(b,this.height/(X-B)),j=(X+B)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const q=this.worldMinX*this.scale,Q=this.worldMaxX*this.scale,re=this.worldSize/2-(q+Q)/2;T=(_+re+this.worldSize)%this.worldSize-re,T-N<q&&(T=q+N),T+N>Q&&(T=Q-N),Q-q<this.width&&(b=Math.max(b,this.width/(Q-q)),T=(Q+q)/2)}T===_&&j===y||this._allowWorldUnderZoom||(this.center=this.unproject(new i.P(T,j))),b&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=d,this._constraining=!1}_minZoomForBounds(){let a=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(a=Math.max(a,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),a}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const a=this.centerOffset,d=this.projection.name==="globe",_=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.ce(1,this.center.lat)/i.ce(1,i.d1));const y=i.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,y),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b=this.projection.zAxisUnit==="meters"?_:1,T=this._camera.getWorldToCamera(this.worldSize,b);let j;const N=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(N[8]=2*-a.x/this.width,N[9]=2*a.y/this.height,this.isOrthographic){let De=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),We=De*this.aspect,st=-We,rt=-De;We-=a.x,st-=a.x,De+=a.y,rt+=a.y,j=this._camera.getCameraToClipOrthographic(st,We,rt,De,this._nearZ,this._farZ),((bt,_t,kt,nr)=>{for(let ht=0;ht<16;ht++)bt[ht]=i.ak(_t[ht],kt[ht],nr)})(j,j,N,i.c$(this.pitch>=Eh?1:this.pitch/Eh))}else j=N;const L=i.cO([],N,T);let B=i.cO([],j,T);if(this.projection.isReprojectedInTileSpace){const De=this.locationCoordinate(this.center),We=i.bz([]);i.bq(We,We,[De.x*this.worldSize,De.y*this.worldSize,0]),i.aB(We,We,i.cP(this)),i.bq(We,We,[-De.x*this.worldSize,-De.y*this.worldSize,0]),i.aB(B,B,We),i.aB(L,L,We),this.inverseAdjustmentMatrix=i.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=i.cR([],B,[this.worldSize,this.worldSize,this.worldSize/b,1]),this.projMatrix=B,this.invProjMatrix=i.bk(new Float64Array(16),this.projMatrix),d){const De=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);De[8]=2*-a.x/this.width,De[9]=2*a.y/this.height,this.expandedFarZProjMatrix=i.cO([],De,T)}else this.expandedFarZProjMatrix=this.projMatrix;const X=i.bk([],j);this.frustumCorners=i.cS.fromInvProjectionMatrix(X,this.horizonLineFromTop(),this.height),this.cameraFrustum=i.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!d);const q=new Float32Array(16);i.bz(q),i.cR(q,q,[1,-1,1]),i.cT(q,q,this._pitch),i.bA(q,q,this.angle);const Q=i.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=i.by(Q);const re=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Q[8]=2*-a.x/this.width,Q[9]=2*(a.y+re)/this.height,this.skyboxMatrix=i.aB(q,Q,q);const ae=this.point,fe=ae.x,de=ae.y,xe=this.width%2/2,je=this.height%2/2,we=Math.cos(this.angle),Ve=Math.sin(this.angle),Ne=fe-Math.round(fe)+we*xe+Ve*je,Ge=de-Math.round(de)+we*je+Ve*xe,Be=new Float64Array(B);if(i.bq(Be,Be,[Ne>.5?Ne-1:Ne,Ge>.5?Ge-1:Ge,0]),this.alignedProjMatrix=Be,B=i.bB(),i.cR(B,B,[this.width/2,-this.height/2,1]),i.bq(B,B,[1,-1,0]),this.labelPlaneMatrix=B,B=i.bB(),i.cR(B,B,[1,-1,1]),i.bq(B,B,[-1,-1,0]),i.cR(B,B,[2/this.width,2/this.height,1]),this.glCoordMatrix=B,this.pixelMatrix=i.aB(new Float64Array(16),this.labelPlaneMatrix,L),this._calcFogMatrices(),this._distanceTileDataCache={},B=i.bk(new Float64Array(16),this.pixelMatrix),!B)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=B,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.cU(this);const De=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.af(De,De,T),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=B;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const a=this.cameraWorldSizeForFog,d=this.cameraPixelsPerMeter,_=this._camera.position,y=1/this.height/this._pixelsPerMercatorPixel,b=[a,a,d];i.c4(b,b,y),i.c4(_,_,-1),i.cV(_,_,b);const T=i.bB();i.bq(T,T,_),i.cR(T,T,b),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(a,d,y)}_computeCameraPosition(a){const d=(a=a||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),y=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*d-a/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-_[0]*b,y.y/this.worldSize-_[1]*b,a/this.worldSize*this._centerAltitude-_[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(a){const d=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],y=a[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),y>0&&(b=Math.min((d-_)/y,1)),this._camera.position=i.bG([],this._camera.position,a,b),this._updateStateFromCamera()}_updateStateFromCamera(){const a=this._camera.position,d=this._camera.forward(),{pitch:_,bearing:y}=this._camera.getPitchBearing(),b=i.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.an(this._maxPitch)),j=Math.max((a[2]-b)/Math.cos(_),T),N=this._zoomFromMercatorZ(j);i.bG(a,a,d,j),this._pitch=i.aA(_,i.an(this.minPitch),i.an(this.maxPitch)),this.angle=i.bS(y,-Math.PI,Math.PI),this._setZoom(i.aA(N,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.ae(a[0],a[1],a[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(a){return Math.pow(2,a)*this.tileSize}_mercatorZfromZoom(a){return this.cameraToCenterDistance/this._worldSizeFromZoom(a)}_minimumHeightOverTerrain(){const a=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(a)}_zoomFromMercatorZ(a){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,a)*this.tileSize))}zoomFromMercatorZAdjusted(a){let d=0,_=i.cK,y=0,b=1/0;for(;_-d>1e-6&&_>d;){const T=d+.5*(_-d),j=this.tileSize*Math.pow(2,T),N=this.getCameraToCenterDistance(this.projection,T,j),L=this.scaleZoom(N/(Math.max(0,a)*this.tileSize)),B=Math.abs(T-L);B<b&&(b=B,y=T),T<L?d=T:_=T}return y}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(a,d){const _=Math.min(a.x,d.x),y=Math.max(a.x,d.x),b=Math.min(a.y,d.y),T=Math.max(a.y,d.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const j=[new i.P(_,b),new i.P(y,T),new i.P(_,T),new i.P(y,b)],N=this.renderWorldCopies?-3:0,L=this.renderWorldCopies?4:1;for(const B of j){const X=this.pointRayIntersection(B);if(X.t<0)return!0;const q=this.rayIntersectionCoordinate(X);if(q.x<N||q.y<0||q.x>L||q.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.P(0,0),new i.P(this.width,this.height))}zoomDeltaToMovement(a,d){const _=i.ag(i.av([],this._camera.position,a)),y=this._zoomFromMercatorZ(_)+d;return _-this._mercatorZfromZoom(y)}getCameraPoint(){if(this.projection.name==="globe"){const a=function([d,_,y],b){const T=[d,_,y,1];i.aC(T,T,b);const j=T[3]=Math.max(T[3],1e-6);return T[0]/=j,T[1]/=j,T[2]/=j,T}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.P(a[0],a[1])}{const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,a))}}getCameraToCenterDistance(a,d=this.zoom,_=this.worldSize){const y=i.cN(a,d,this.width,this.height,1024),b=a.pixelSpaceConversion(this.center.lat,_,y);let T=.5/Math.tan(.5*this._fov)*this.height*b;return this.isOrthographic&&(T=i.ak(1,T,i.c$(this.pitch>=Eh?1:this.pitch/Eh))),T}getWorldToCameraMatrix(){const a=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.aB(a,a,this.globeMatrix),a}getFrustum(a){return i.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,this.projection.zAxisUnit==="meters")}}const Bu=(g,a)=>{if(a>0&&g.terrain&&i.w("Cutoff is currently disabled on terrain"),a<=0||g.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const d=g.transform,_=Math.max(Math.abs(d._zoom-(g.minCutoffZoom-1)),1),y=d.isLODDisabled(!1)?i.ah(60,45,d.pitch):i.ah(30,15,d.pitch),b=d._farZ-d._nearZ,T=a*d.height,j=((1-(N=y))*d.cameraToCenterDistance+N*(d._farZ+T))*_;var N;return{shouldRenderCutoff:y<1,uniformValues:{u_cutoff_params:[d._nearZ,d._farZ,(j-d._nearZ)/b,(j-T-d._nearZ)/b]}}},ao={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class DA{constructor(a,d){this.aabb=a,this.lastCascade=d}}class RA{add(a,d){const _=this.receivers[a.key];_!==void 0?(_.aabb.min[0]=Math.min(_.aabb.min[0],d.min[0]),_.aabb.min[1]=Math.min(_.aabb.min[1],d.min[1]),_.aabb.min[2]=Math.min(_.aabb.min[2],d.min[2]),_.aabb.max[0]=Math.max(_.aabb.max[0],d.max[0]),_.aabb.max[1]=Math.max(_.aabb.max[1],d.max[1]),_.aabb.max[2]=Math.max(_.aabb.max[2],d.max[2])):this.receivers[a.key]=new DA(d,null)}clear(){this.receivers={}}get(a){return this.receivers[a.key]}computeRequiredCascades(a,d,_){const y=i.d8.fromPoints(a.points);let b=0;for(const T in this.receivers){const j=this.receivers[T];if(!j||!y.intersectsAabb(j.aabb))continue;j.aabb.min=y.closestPoint(j.aabb.min),j.aabb.max=y.closestPoint(j.aabb.max);const N=j.aabb.getCorners();for(let L=0;L<_.length;L++){let B=!0;for(const X of N){const q=[X[0]*d,X[1]*d,X[2]];if(i.af(q,q,_[L].matrix),q[0]<-1||q[0]>1||q[1]<-1||q[1]>1){B=!1;break}}if(j.lastCascade=L,b=Math.max(b,L),B)break}}return b+1}}class Km{constructor(a){this.painter=a,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new RA,this._depthMode=new Rr(a.context.gl.LEQUAL,Rr.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,a.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),a.tp.registerParameter(ao,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),a.tp.registerParameter(ao,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),a.tp.registerParameter(ao,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),a.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const a of this._cascades)a.texture.destroy(),a.framebuffer.destroy();this._cascades=[]}updateShadowParameters(a,d){const _=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!d||!d.properties)return;const y=d.properties.get("shadow-intensity");if(!d.shadowsEnabled()||y<=0||(this._shadowLayerCount=_.style.order.reduce((re,ae)=>{const fe=_.style._mergedLayers[ae];return re+(fe.hasShadowPass()&&!fe.isHidden(a.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const b=_.context,T=ao.shadowMapResolution,j=ao.shadowMapResolution;if(this._cascades.length===0||ao.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let re=0;re<ao.cascadeCount;++re){const ae=_._shadowMapDebug,fe=b.gl,de=b.createFramebuffer(T,j,ae,"texture"),xe=new i.T(b,{width:T,height:j,data:null},fe.DEPTH_COMPONENT16);if(de.depthAttachment.set(xe.texture),ae){const je=new i.T(b,{width:T,height:j,data:null},fe.RGBA8);de.colorAttachment.set(je.texture)}this._cascades.push({framebuffer:de,texture:xe,matrix:[],far:0,boundingSphereRadius:0,frustum:new i.cA,scale:0})}}this.shadowDirection=d2(d);let N=0;if(a.elevation){const re=a.elevation,ae=[1e4,-1e4];re.visibleDemTiles.filter(fe=>fe.dem).forEach(fe=>{const de=fe.dem.tree;ae[0]=Math.min(ae[0],de.minimums[0]),ae[1]=Math.max(ae[1],de.maximums[0])}),ae[0]!==1e4&&(N=(ae[1]-ae[0])*re.exaggeration())}const L=1.5*a.cameraToCenterDistance,B=3*L,X=new Float64Array(16);for(let re=0;re<this._cascades.length;++re){const ae=this._cascades[re];let fe=a.height/50,de=1;ao.cascadeCount===1?de=B:re===0?de=L:(fe=L,de=B);const[xe,je]=h2(a,this.shadowDirection,fe,de,ao.shadowMapResolution,N);ae.scale=a.scale,ae.matrix=xe,ae.boundingSphereRadius=je,i.bk(X,ae.matrix),ae.frustum=i.cA.fromInvProjectionMatrix(X,1,0,!0),ae.far=de}const q=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[q].far,this._cascades[q].far],this._uniformValues.u_shadow_intensity=y,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/ao.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=ao.shadowMapResolution,this._uniformValues.u_shadowmap_0=so.ShadowMap0,this._uniformValues.u_shadowmap_1=so.ShadowMap0+1,this._groundShadowTiles=_.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const Q=_.transform.elevation;for(const re of this._groundShadowTiles){let ae={min:0,max:0};if(Q){const fe=Q.getMinMaxForTile(re);fe&&(ae=fe)}this.addShadowReceiver(re.toUnwrapped(),ae.min,ae.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(a){this._enabled=a}drawShadowPass(a,d){if(!this.enabled)return;const _=this.painter,y=_.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(_.transform.getFrustum(0),_.transform.worldSize,this._cascades),y.viewport.set([0,0,ao.shadowMapResolution,ao.shadowMapResolution]);for(let b=0;b<this._numCascadesToRender;++b){_.currentShadowCascade=b,y.bindFramebuffer.set(this._cascades[b].framebuffer.framebuffer),y.clear({color:i.ao.white,depth:1});for(const T of a.order){const j=a._mergedLayers[T];if(!j.hasShadowPass()||j.isHidden(_.transform.zoom))continue;const N=a.getLayerSourceCache(j),L=N?d[N.id]:void 0;(j.type==="model"||L&&L.length)&&_.renderLayer(_,N,j,L)}}_.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const a=this.painter,d=a.style,_=a.context,y=_.gl,b=d.directionalLight,T=d.ambientLight;if(!b||!T)return;const j=[],N=Bu(a,a.longestCutoffRange);N.shouldRenderCutoff&&j.push("RENDER_CUTOFF"),j.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&j.push("NORMAL_OFFSET");const L=ac(d,b,T),B=new Rr(y.LEQUAL,Rr.ReadOnly,a.depthRangeFor3D),X=new Cn({func:y.EQUAL,mask:255},0,255,y.KEEP,y.KEEP,y.KEEP);for(const q of this._groundShadowTiles){const Q=q.toUnwrapped(),re=a.isTileAffectedByFog(q),ae=a.getOrCreateProgram("groundShadow",{defines:j,overrideFog:re});this.setupShadows(Q,ae),a.uploadCommonUniforms(_,ae,Q,null,N);const fe={u_matrix:a.transform.calculateProjMatrix(Q),u_ground_shadow_factor:L};ae.draw(a,y.TRIANGLES,B,X,Vn.multiply,yn.disabled,fe,"ground_shadow",a.tileExtentBuffer,a.quadTriangleIndexBuffer,a.tileExtentSegments,null,a.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Vn.unblended:Vn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(a){const d=this.painter.transform,_=d.calculatePosMatrix(a,d.worldSize);return i.aB(_,this._cascades[this.painter.currentShadowCascade].matrix,_),Float32Array.from(_)}calculateShadowPassMatrixFromMatrix(a){const d=i.by(a);return i.aB(d,this._cascades[this.painter.currentShadowCascade].matrix,a),d}setupShadows(a,d,_){if(!this.enabled)return;const y=this.painter.transform,b=this.painter.context,T=b.gl,j=this._uniformValues,N=new Float64Array(16),L=y.calculatePosMatrix(a,y.worldSize);for(let B=0;B<this._cascades.length;B++)i.aB(N,this._cascades[B].matrix,L),j[B===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(N),b.activeTexture.set(T.TEXTURE0+so.ShadowMap0+B),this._cascades[B].texture.bindExtraParam(T.LINEAR,T.LINEAR,T.CLAMP_TO_EDGE,T.CLAMP_TO_EDGE,T.GREATER);if(this.useNormalOffset=!!_,this.useNormalOffset){const B=i.d6(a.canonical),X=2/y.tileSize*i.al/ao.shadowMapResolution,q=X*this._cascades[0].boundingSphereRadius,Q=X*this._cascades[this._cascades.length-1].boundingSphereRadius,re=(_==="vector-tile"?1:3)*function(ae,fe,de,xe,je){const we=i.aA((ae-22)/-22,0,1);return .125*(1-we)+4*we}(y.zoom);j.u_shadow_normal_offset=[B,q*re,Q*re],j.u_shadow_bias=[1e-4,.0012,.012]}else j.u_shadow_bias=[36e-5,.0012,.012];d.setShadowUniformValues(b,j)}setupShadowsFromMatrix(a,d,_=!1){if(!this.enabled)return;const y=this.painter.context,b=y.gl,T=this._uniformValues,j=new Float64Array(16);for(let N=0;N<ao.cascadeCount;N++)i.aB(j,this._cascades[N].matrix,a),T[N===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(j),y.activeTexture.set(b.TEXTURE0+so.ShadowMap0+N),this._cascades[N].texture.bindExtraParam(b.LINEAR,b.LINEAR,b.CLAMP_TO_EDGE,b.CLAMP_TO_EDGE,b.GREATER);if(this.useNormalOffset=_,_){const N=ao.normalOffset;T.u_shadow_normal_offset=[1,N,N],T.u_shadow_bias=[6e-5,.0012,.012]}else T.u_shadow_bias=[36e-5,.0012,.012];d.setShadowUniformValues(y,T)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(a,d,_,y){if(y[2]>=0)return{};const b=function(N,L,B){const X=B/(1<<N.canonical.z);return new i.d8([N.canonical.x*X+N.wrap*B,N.canonical.y*X+N.wrap*B,0],[(N.canonical.x+1)*X+N.wrap*B,(N.canonical.y+1)*X+N.wrap*B,L])}(a,d,_).getCorners(),T=d/-y[2];y[0]<0?(i.d7(b[0],b[0],[y[0]*T,0,0]),i.d7(b[3],b[3],[y[0]*T,0,0])):y[0]>0&&(i.d7(b[1],b[1],[y[0]*T,0,0]),i.d7(b[2],b[2],[y[0]*T,0,0])),y[1]<0?(i.d7(b[0],b[0],[0,y[1]*T,0]),i.d7(b[1],b[1],[0,y[1]*T,0])):y[1]>0&&(i.d7(b[2],b[2],[0,y[1]*T,0]),i.d7(b[3],b[3],[0,y[1]*T,0]));const j={};return j.vertices=b,j.planes=[Pd(b[1],b[0],b[4]),Pd(b[2],b[1],b[5]),Pd(b[3],b[2],b[6]),Pd(b[0],b[3],b[7])],j}addShadowReceiver(a,d,_){this._receivers.add(a,i.d8.fromTileIdAndHeight(a,d,_))}getMaxCascadeForTile(a){const d=this._receivers.get(a);return d&&d.lastCascade?d.lastCascade:0}}function Pd(g,a,d){const _=i.av([],d,a),y=i.av([],g,a),b=i.bH([],_,y),T=i.ag(b);return T===0?[0,0,1,0]:(i.c4(b,b,1/T),[b[0],b[1],b[2],-i.bI(b,a)])}function d2(g){const a=g.properties.get("direction"),d=i.d3(a.x,a.y,a.z);d[2]=i.aA(d[2],0,75);const _=i.d5([d[0],d[1],d[2]]);return i.d4(_.x,_.y,_.z)}function ac(g,a,d){const _=a.properties.get("color-use-theme")==="none",y=a.properties.get("color"),b=a.properties.get("intensity"),T=a.properties.get("direction"),j=[T.x,T.y,T.z],N=d.properties.get("color-use-theme")==="none",L=d.properties.get("color"),B=d.properties.get("intensity"),X=Math.max(i.bI([0,0,1],j),0),q=[0,0,0];i.c4(q,L.toPremultipliedRenderColor(N?null:g.getLut(a.scope)).toArray01Linear().slice(0,3),B);const Q=[0,0,0];return i.c4(Q,y.toPremultipliedRenderColor(_?null:g.getLut(d.scope)).toArray01Linear().slice(0,3),X*b),i.da([q[0]>0?q[0]/(q[0]+Q[0]):0,q[1]>0?q[1]/(q[1]+Q[1]):0,q[2]>0?q[2]/(q[2]+Q[2]):0])}function h2(g,a,d,_,y,b){const T=g.zoom,j=g.scale,N=g.worldSize,L=1/N,B=g.aspect,X=Math.sqrt(1+B*B)*Math.tan(.5*g.fovX),q=X*X,Q=_-d,re=_+d;let ae,fe;q>Q/re?(ae=_,fe=_*X):(ae=.5*re*(1+q),fe=.5*Math.sqrt(Q*Q+2*(_*_+d*d)*q+re*re*q*q));const de=g.projection.pixelsPerMeter(g.center.lat,N),xe=g._camera.getCameraToWorldMercator(),je=[0,0,-ae*L];i.af(je,je,xe);let we=fe*L;const Ve=g._edgeInsets;if(!(Ve.left===0&&Ve.top===0&&Ve.right===0&&Ve.bottom===0||Ve.left===Ve.right&&Ve.top===Ve.bottom)){const qt=g._camera.getWorldToCamera(g.worldSize,g.projection.zAxisUnit==="meters"?de:1),or=g._camera.getCameraToClipPerspective(g._fov,g.width/g.height,d,_);or[8]=2*-g.centerOffset.x/g.width,or[9]=2*g.centerOffset.y/g.height;const Ar=new Float64Array(16);i.cO(Ar,or,qt);const tr=new Float64Array(16);i.bk(tr,Ar);const sr=i.cA.fromInvProjectionMatrix(tr,N,T,!0);for(const kr of sr.points){const yr=((Ne=kr)[0]/=j,Ne[1]/=j,Ne[2]=i.ce(Ne[2],g._center.lat),Ne);we=Math.max(we,i.c5(i.d9([],je,yr)))}}var Ne;we*=y/(y-1);const Ge=Math.acos(a[2]),Be=Math.atan2(-a[0],-a[1]),De=new U_;De.position=je,De.setPitchBearing(Ge,Be);const We=De.getWorldToCamera(N,de),st=we*N,rt=Math.min(g._mercatorZfromZoom(17)*N*-2,-2*st),bt=De.getCameraToClipOrthographic(-st,st,-st,st,rt,(st+b*de)/a[2]),_t=new Float64Array(16);i.aB(_t,bt,We);const kt=i.d4(Math.floor(1e6*je[0])/1e6*N,Math.floor(1e6*je[1])/1e6*N,0),nr=.5*y,ht=[0,0,0];i.af(ht,kt,_t),i.c4(ht,ht,nr);const Ke=[Math.floor(ht[0]),Math.floor(ht[1]),Math.floor(ht[2])],Pt=[0,0,0];i.av(Pt,ht,Ke),i.c4(Pt,Pt,-1/nr);const xt=new Float64Array(16);return i.bz(xt),i.bq(xt,xt,Pt),i.aB(_t,xt,_t),[_t,st]}class V_ extends i.E{constructor(a){super(),this.requestManager=a,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(a,d){return i.db(this.requestManager.transformRequest(d,i.R.Model).url).then(_=>{if(!_)return;const y=i.dc(_),b=new i.dd(a,d,void 0,void 0,y);return b.computeBoundsAndApplyParent(),b}).catch(_=>{if(_&&_.status===404)return null;this.fire(new i.y(new Error(`Could not load model ${a} from ${d}: ${_.message}`)))})}load(a,d,_={forceReload:!1}){this.models[d]||(this.models[d]={});const y=Object.keys(a),b=[],T=[];for(const j of y){const N=a[j];this.hasURLBeenRequested(N)&&!_.forceReload||(this.modelByURL[N]={modelId:j,scope:d},b.push(this.loadModel(j,N)),T.push(j)),this.models[d][j]||(this.models[d][j]={model:null,numReferences:1})}this.numModelsLoading[d]=(this.numModelsLoading[d]||0)+T.length,Promise.allSettled(b).then(j=>{for(let N=0;N<j.length;N++){const{status:L}=j[N];if(L==="rejected")continue;const{value:B}=j[N];this.models[d][T[N]]||(this.models[d][T[N]]={model:null,numReferences:1}),this.models[d][T[N]].model=B}this.numModelsLoading[d]-=T.length,this.fire(new i.z("data",{dataType:"style"}))}).catch(j=>{this.fire(new i.y(new Error(`Could not load models: ${j.message}`)))})}isLoaded(){for(const a in this.numModelsLoading)if(this.numModelsLoading[a]>0)return!1;return!0}hasModel(a,d,_={exactIdMatch:!1}){return!!(_.exactIdMatch?this.getModel(a,d):this.getModelByURL(this.modelUris[d][a]))}getModel(a,d){return this.models[d]||(this.models[d]={}),this.models[d][a]?this.models[d][a].model:void 0}getModelByURL(a){if(!a)return null;const d=this.modelByURL[a];return d?this.models[d.scope][d.modelId].model:null}hasModelBeenAdded(a,d){return this.models[d]&&this.models[d][a]!==void 0}getModelURIs(a){return this.modelUris[a]||{}}addModel(a,d,_){this.models[_]||(this.models[_]={}),this.modelUris[_]||(this.modelUris[_]={});const y=this.requestManager.normalizeModelURL(d);if((this.hasModel(a,_,{exactIdMatch:!0})||this.hasModelBeenAdded(a,_))&&this.modelUris[_][a]===y)this.models[_][a].numReferences++;else if(this.hasURLBeenRequested(y)){const{scope:b,modelId:T}=this.modelByURL[y];this.models[b][T].numReferences++}else this.modelUris[_][a]=y,this.load({[a]:this.modelUris[_][a]},_)}addModelURLs(a,d){this.models[d]||(this.models[d]={}),this.modelUris[d]||(this.modelUris[d]={});const _=this.modelUris[d];for(const y in a)_[y]=this.requestManager.normalizeModelURL(a[y])}reloadModels(a){this.load(this.modelUris[a],a,{forceReload:!0})}addModelsFromBucket(a,d){this.models[d]||(this.models[d]={}),this.modelUris[d]||(this.modelUris[d]={});const _={};for(const y of a)this.hasModel(y,d,{exactIdMatch:!0})||this.hasURLBeenRequested(y)?this.models[d][y].numReferences++:this.modelUris[d][y]&&!this.hasURLBeenRequested(y)?_[y]=this.modelUris[d][y]:!this.hasURLBeenRequested(y)&&i.de(y,!1)&&(this.modelUris[d][y]=this.requestManager.normalizeModelURL(y),_[y]=this.modelUris[d][y]);this.load(_,d)}hasURLBeenRequested(a){return this.modelByURL[a]!==void 0}removeModel(a,d,_=!1,y=!1){if(this.models[d]&&this.models[d][a]&&(this.models[d][a].numReferences--,this.models[d][a].numReferences===0||y)){const b=this.modelUris[d][a];_||delete this.modelUris[d][a],delete this.modelByURL[b];const T=this.models[d][a].model;if(!T)return;delete this.models[d][a],T.destroy()}}destroy(){for(const a of Object.keys(this.models))for(const d of Object.keys(this.models[a])){const _=this.models[a][d].model;delete this.models[a][d],_&&_.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(a){return this.models[a]||(this.models[a]={}),Object.keys(this.models[a])}upload(a,d){this.models[d]||(this.models[d]={});for(const _ in this.models[d])this.models[d][_].model&&this.models[d][_].model.upload(a.context)}}const Jm=i.a6.colorTheme,Dd=new i.a9({data:new i.aa(Jm.data)});function MA(g){if(!g.metadata||!g.metadata.content_area)return;const a=i.o.devicePixelRatio,{left:d,top:_,width:y,height:b}=g.metadata.content_area,T=d*a,j=_*a;return[T,j,T+y*a,j+b*a]}function f2(g){if(g)return g.map(([a,d])=>[a*i.o.devicePixelRatio,d*i.o.devicePixelRatio])}class OA{constructor(a,d,_){this.id=a,this.scope=d,this.sourceCache=_,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(a){this.missingRequests.has(a.name)||this.pendingRequests.has(a.name)||this.pendingRequests.add(a.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const a=new Map;if(!this.sourceCache.loaded())return a;const d=this.sourceCache.getVisibleCoordinates();if(d.length===0)return a;const _=this.sourceCache.getSource();if(!(_ instanceof He))return a;const y=d.map(T=>this.sourceCache.getTile(T)),b=_.getImages(y,Array.from(this.pendingRequests));for(const[T,j]of b)a.set(i.I.from({name:T,iconsetId:this.id}),j),this.pendingRequests.delete(T);for(const T of this.pendingRequests)this.missingRequests.add(T);return this.pendingRequests.clear(),a}}const Rd=(g,a)=>Z(g,a&&a.filter(d=>d.identifier!=="source.canvas")),FA=i.aH(Ni,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),oy=i.aH(Ni,["setCenter","setZoom","setBearing","setPitch"]),$_=new Set(["background","sky","slot","custom"]),ly={version:8,layers:[],sources:{}},cy={duration:300,delay:0};class oc extends i.E{constructor(a,d={}){super(),this.map=a,this.scope=d.scope||"",this.globalId=null,this.fragments=[],this.importDepth=d.importDepth||0,this.importsCache=d.importsCache||new Map,this.resolvedImports=d.resolvedImports||new Set,this.transition=Object.assign({},cy),this._buildingIndex=new Jv(this),this.crossTileSymbolIndex=new zu,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=d.styleChanges||new ei,this.dispatcher=d.dispatcher?d.dispatcher:new i.D(i.dg(),this),d.imageManager?this.imageManager=d.imageManager:(this.imageManager=new Zr(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=d.glyphManager?d.glyphManager:new i.dh(a._requestManager,d.localFontFamily?i.di.all:d.localIdeographFontFamily?i.di.ideographs:i.di.none,d.localFontFamily||d.localIdeographFontFamily),d.modelManager?this.modelManager=d.modelManager:(this.modelManager=new V_(a._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=d.configOptions?d.configOptions:new Map,this._configDependentLayers=d.configDependentLayers?d.configDependentLayers:new Set,this._indoorDependentLayers=d.indoorDependentLayers?d.indoorDependentLayers:new Set,this._config=d.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:d.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=d.initialConfig,this.dispatcher.broadcast("setReferrer",i.dj());const _=this;this._rtlTextPluginCallback=oc.registerForPluginStateChange(y=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(b,T)=>{if(i.dk(b),T&&T.every(j=>j))for(const j in _._sourceCaches){const N=_._sourceCaches[j],L=N.getSource().type;L!=="vector"&&L!=="geojson"||N.reload()}})}),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const b=this.getOwnSource(y.sourceId);if(b&&b.vectorLayerIds)for(const T in this._layers){const j=this._layers[T];j.source===b.id&&this._validateLayer(j)}})}load(a){return a?(typeof a=="string"?this.loadURL(a):this.loadJSON(a),this):this}_getGlobalId(a){if(!a)return null;if(typeof a=="string"){if(i.h(a))return a;const d=i.dl(a);if(!d.startsWith("http"))try{return new URL(d,location.href).toString()}catch{return d}return d}return`json://${i.dm(JSON.stringify(a))}`}_diffStyle(a,d,_){this.globalId=this._getGlobalId(a);const y=(b,T)=>{try{T(null,this.setState(b,_))}catch(j){T(j,!1)}};if(typeof a=="string"){const b=this.map._requestManager.normalizeStyleURL(a),T=this.map._requestManager.transformRequest(b,i.R.Style);i.m(T,(j,N)=>{j?this.fire(new i.y(j)):N&&y(N,d)})}else typeof a=="object"&&y(a,d)}loadURL(a,d={}){this.fire(new i.z("dataloading",{dataType:"style"}));const _=typeof d.validate=="boolean"?d.validate:!i.h(a);this.globalId=this._getGlobalId(a),a=this.map._requestManager.normalizeStyleURL(a,d.accessToken),this.resolvedImports.add(a);const y=this.importsCache.get(a);if(y)return this._load(y,_);const b=this.map._requestManager.transformRequest(a,i.R.Style);this._request=i.m(b,(T,j)=>{if(this._request=null,T)this.fire(new i.y(T));else if(j)return this.importsCache.set(a,j),this._load(j,_)})}loadJSON(a,d={}){this.fire(new i.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(a),this._request=i.o.frame(()=>{this._request=null,this._load(a,d.validate!==!1)})}loadEmpty(){this.fire(new i.z("dataloading",{dataType:"style"})),this._load(ly,!1)}_loadImports(a,d,_){if(this.importDepth>=4)return i.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const y=[];for(const b of a){const T=this._createFragmentStyle(b),j=new Promise(B=>{T.once("style.import.load",B),T.once("error",B)}).then(()=>this.mergeAll());if(y.push(j),this.resolvedImports.has(b.url)){T.loadEmpty();continue}const N=b.data||this.importsCache.get(b.url);N?(T.loadJSON(N,{validate:d}),this._isInternalStyle(N)&&(T.globalId=null)):b.url?T.loadURL(b.url,{validate:d}):T.loadEmpty();const L={style:T,id:b.id,config:b.config};if(_){const B=this.fragments.findIndex(({id:X})=>X===_);this.fragments=this.fragments.slice(0,B).concat(L).concat(this.fragments.slice(B))}else this.fragments.push(L)}return Promise.allSettled(y)}getImportGlobalIds(a=this,d=new Set){for(const _ of a.fragments)_.style.globalId&&d.add(_.style.globalId),this.getImportGlobalIds(_.style,d);return[...d.values()]}_createFragmentStyle(a){const d=this.scope?i.B(a.id,this.scope):a.id;let _;const y=this._initialConfig&&this._initialConfig[d];(a.config||y)&&(_=Object.assign({},a.config,y));const b=new oc(this.map,{scope:d,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:_,configOptions:this.options,colorThemeOverride:a["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return b.setEventedParent(this.map,{style:b}),b}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(a){return this.isRootStyle()&&(a.fragment||!!a.schema&&a.fragment!==!1)}_load(a,d){if(this._isInternalStyle(a)){const b=Object.assign({},ly,{imports:[{id:"basemap",data:a,url:""}]},a.center?{center:a.center}:{},a.bearing?{bearing:a.bearing}:{},a.pitch?{pitch:a.pitch}:{},a.zoom?{zoom:a.zoom}:{},a.light?{light:a.light}:{});return this._importedAsBasemap=!0,void this._load(b,d)}if(this.updateConfig(this._config,a.schema),d&&Rd(this,Ot(a)))return;this._loaded=!0,this.stylesheet=i.dn(a);const _=()=>{for(const N in a.sources)this.addSource(N,a.sources[N],{validate:!1,isInitialLoad:!0});if(a.iconsets)for(const N in a.iconsets)this.addIconset(N,a.iconsets[N]);a.sprite?this._loadIconset(a.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&a.glyphs&&this.glyphManager.setURL(a.glyphs);const b=jf(this.stylesheet.layers);if(this._order=b.map(N=>N.id),this.stylesheet.light&&i.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const N=this.stylesheet.lights[0];this.light=new ce(N.properties,N.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new ce(this.stylesheet.light)),this._layers={};for(const N of b){const L=i.dt(N,this.scope,this._styleColorTheme.lut,this.options);L.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(L.fqid),L.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(L.fqid),this._hasAppearances=this._hasAppearances||L.getAppearances().length!==0,L.setEventedParent(this,{layer:{id:L.id}}),this._layers[L.id]=L;const B=this.getOwnLayerSourceCache(L),X=!!this.directionalLight&&this.directionalLight.shadowsEnabled();B&&L.canCastShadows()&&X&&(B.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const T=this.stylesheet.terrain;T&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(T,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new i.z("data",{dataType:"style"}));const j=this.isRootStyle();a.imports?this._loadImports(a.imports,d).then(()=>{this._reloadImports(),this.fire(new i.z(j?"style.load":"style.import.load"))}).catch(N=>{this.fire(new i.y(new Error("Failed to load imports",N))),this.fire(new i.z(j?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new i.z(j?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const y=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(y){const b=this._evaluateColorThemeData(y);this._loadColorTheme(b).then(()=>{_()}).catch(T=>{i.w(`Couldn't load color theme from the stylesheet: ${T}`),_()})}else this._styleColorTheme.lut=null,_()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances}mergeAll(){let a,d,_,y,b,T,j,N,L,B;const X={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(q=>{if(q.stylesheet){if(q.light!=null&&(a=q.light),q.stylesheet.lights)for(const Q of q.stylesheet.lights)Q.type==="ambient"&&q.ambientLight!=null&&(d=q.ambientLight),Q.type==="directional"&&q.directionalLight!=null&&(_=q.directionalLight);y=this._prioritizeTerrain(y,q.terrain,q.stylesheet.terrain),q.stylesheet.fog&&q.fog!=null&&(b=q.fog),q.stylesheet.snow&&q.snow!=null&&(T=q.snow),q.stylesheet.rain&&q.rain!=null&&(j=q.rain),q.stylesheet.camera!=null&&(B=q.stylesheet.camera),q.stylesheet.projection!=null&&(N=q.stylesheet.projection),q.stylesheet.transition!=null&&(L=q.stylesheet.transition),X[q.scope]=q._styleColorTheme}}),this.light=a,this.ambientLight=d,this.directionalLight=_,this.fog=b,this.snow=T,this.rain=j,this._styleColorThemeForScope=X,y===null?delete this.terrain:this.terrain=y,this.camera=B||{"camera-projection":"perspective"},this.projection=N||{name:"mercator"},this.transition=Object.assign({},cy,L),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(a){const d=_=>{for(const y of _.fragments)d(y.style);a(_)};d(this)}_prioritizeTerrain(a,d,_){const y=a&&a.drapeRenderMode===0;return _===null?d&&d.drapeRenderMode===0?d:y?a:null:d!=null&&(!a||y||d&&d.drapeRenderMode===1)?d:a}mergeTerrain(){let a;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(d=>{a=this._prioritizeTerrain(a,d.terrain,d.stylesheet.terrain)}),a===null?delete this.terrain:this.terrain=a}mergeProjection(){let a;this.forEachFragmentStyle(d=>{d.stylesheet.projection!=null&&(a=d.stylesheet.projection)}),this.projection=a||{name:"mercator"}}mergeSources(){const a={},d={},_={};this.forEachFragmentStyle(y=>{for(const b in y._sourceCaches){const T=i.B(b,y.scope);a[T]=y._sourceCaches[b]}for(const b in y._otherSourceCaches){const T=i.B(b,y.scope);d[T]=y._otherSourceCaches[b]}for(const b in y._symbolSourceCaches){const T=i.B(b,y.scope);_[T]=y._symbolSourceCaches[b]}}),this._mergedSourceCaches=a,this._mergedOtherSourceCaches=d,this._mergedSymbolSourceCaches=_}mergeIndoor(){this.forEachFragmentStyle(a=>{if(a.stylesheet&&a.stylesheet.indoor)for(const d of Object.values(a.stylesheet.indoor)){const _=d,y=i.B(_.sourceId,a.scope);this._mergedIndoor[y]=new Set(_.sourceLayers||[])}})}mergeLayers(){const a={},d=[],_={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(T=>{for(const j of T._order){const N=T._layers[j];if(N.type==="slot"){const L=i.dp(j);if(a[L])continue;a[L]=[]}N.slot&&a[N.slot]?a[N.slot].push(N):d.push(N)}}),this._mergedOrder=[];let y=-1;const b=(T=[])=>{for(const j of T)if(j.type==="slot"){const N=i.dp(j.id);a[N]&&b(a[N]),this._mergedSlots.push(N)}else{const N=i.B(j.id,j.scope);this._mergedOrder.push(N),_[N]=j,j.is3D(!!this.terrain)&&(this._has3DLayers=!0,y=this._mergedOrder.length-1),j.type==="circle"&&(this._hasCircleLayers=!0),j.type==="symbol"&&(this._hasSymbolLayers=!0),j.type==="clip"&&(this._clipLayerPresent=!0)}};if(b(d),this._has3DLayers){const T={};for(let j=0;j<this._mergedOrder.length;++j){const N=this._mergedOrder[j];T[N]=j===y?1:j<y?_[N].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((j,N)=>T[j]-T[N])}this._mergedLayers=_,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(a){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,a),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(a){return a.data?function(d,_,y,b){const T=Object.assign({},_);for(const N of Object.keys(Jm))T[N]===void 0&&(T[N]=Jm[N].default);const j=new i.a8(Dd,d,new Map(y));return j.setTransitionOrValue(T,y),j.untransitioned().possiblyEvaluate(new i.ac(0,{worldview:void 0}))}(this.scope,a,this.options).get("data"):null}_loadColorTheme(a){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const d=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((_,y)=>{const b="data:image/png;base64,";if(!a||a.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void _();let T=a;T.startsWith(b)||(T=b+T);const j=i.I.from("mapbox-reserved-lut"),N=new Image;N.src=T,N.onerror=()=>{this._styleColorTheme.lutLoading=!1,y(new Error("Failed to load image data"))},N.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==d)return void _();this._styleColorTheme.lutLoading=!1;const{width:L,height:B,data:X}=i.o.getImageData(N);if(B>32)return void y(new Error("The height of the image must be less than or equal to 32 pixels."));if(L!==B*B)return void y(new Error("The width of the image must be equal to the height squared."));this.getImage(j)&&this.removeImage(j),this.addImage(j,{data:new i.q({width:L,height:B},X),pixelRatio:1,sdf:!1,usvg:!1,version:0});const q=this.imageManager.getImage(j,this.scope);q?(this._styleColorTheme.lut={image:q.data,data:a},_()):y(new Error("Missing LUT image."))}})}getLut(a){const d=this._styleColorThemeForScope[a];return d?d.lut:null}setProjection(a){a?this.stylesheet.projection=a:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(a){this._spriteRequest=function(d,_,y){let b,T,j;const N=i.o.devicePixelRatio>1?"@2x":"";let L=i.m(_.transformRequest(_.normalizeSpriteURL(d,N,".json"),i.R.SpriteJSON),(q,Q)=>{L=null,j||(j=q,b=Q,X())}),B=i.n(_.transformRequest(_.normalizeSpriteURL(d,N,".png"),i.R.SpriteImage),(q,Q)=>{B=null,j||(j=q,T=Q,X())});function X(){if(j)y(j);else if(b&&T){const q=i.o.getImageData(T),Q={};for(const re in b){const{width:ae,height:fe,x:de,y:xe,sdf:je,pixelRatio:we,stretchX:Ve,stretchY:Ne,content:Ge}=b[re],Be=new i.q({width:ae,height:fe});i.q.copy(q,Be,{x:de,y:xe},{x:0,y:0},{width:ae,height:fe},null),Q[re]={data:Be,pixelRatio:we!==void 0?we:1,sdf:je!==void 0&&je,stretchX:Ve,stretchY:Ne,content:Ge,usvg:!1,version:0}}y(null,Q)}}return{cancel(){L&&(L.cancel(),L=null),B&&(B.cancel(),B=null)}}}(a,this.map._requestManager,(d,_)=>{if(this._spriteRequest=null,d)this.fire(new i.y(d));else if(_){const y=new Map;for(const b in _)y.set(i.I.from(b),_[b]);this.addImages(y)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.z("data",{dataType:"style"}))})}addIconset(a,d){if(d.type==="sprite")return void this._loadSprite(d.url);const _=this.getOwnSourceCache(d.source);if(!_)return void this.fire(new i.y(new Error(`Source "${d.source}" as specified by iconset "${a}" does not exist and cannot be used as an iconset source`)));const y=_.getSource();if(y.type!=="raster-array")return void this.fire(new i.y(new Error(`Source "${d.source}" as specified by iconset "${a}" is not a "raster-array" source and cannot be used as an iconset source`)));y.partial=!1;const b=new OA(a,this.scope,_);this.imageManager.addImageProvider(b,this.scope)}removeIconset(a){this.imageManager.removeImageProvider(a,this.scope)}_loadIconset(a){if(!i.h(a)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(a);const d=this.map._spriteFormat==="auto";var _,y;this._spriteRequest=(y=(b,T)=>{if(this._spriteRequest=null,b)d?this._loadSprite(a):this.fire(new i.y(b));else if(T){const j=new Map;for(const N in T)j.set(i.I.from(N),T[N]);this.addImages(j)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.z("data",{dataType:"style"}))},i.bt((_=this.map._requestManager).transformRequest(_.normalizeIconsetURL(a),i.R.Iconset),(b,T)=>{if(b)return void y(b);const j={},N=i.df(new i.bs(T));for(const L of N.icons){const B={version:1,pixelRatio:i.o.devicePixelRatio,content:MA(L),stretchX:L.metadata?f2(L.metadata.stretch_x_areas):void 0,stretchY:L.metadata?f2(L.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:L};j[L.name]=B}y(null,j)}))}_validateLayer(a){const d=this.getOwnSource(a.source);if(!d)return;const _=a.sourceLayer;_&&(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(_)===-1)&&this.fire(new i.y(new Error(`Source layer "${_}" does not exist on source "${d.id}" as specified by style layer "${a.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const a in this._sourceCaches)if(!this._sourceCaches[a].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:a}of this.fragments)if(!a.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((a,d)=>{const _=this.fragments[d];return _&&_.style&&(a.data=_.style.serialize()),a})}_serializeSources(){const a={};for(const d in this._sourceCaches){const _=this._sourceCaches[d].getSource();a[_.id]||(a[_.id]=_.serialize())}return a}_serializeLayers(a){const d=[];for(const _ of a){const y=this._layers[_];y&&y.type!=="custom"&&d.push(y.serialize())}return d}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const a in this._sourceCaches)if(this._sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(a){return a?this.order:this._mergedOrder}isLayerDraped(a){return!!this.terrain&&a.isDraped(this.getLayerSourceCache(a))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(a){const d=this.getOwnLayer(a);if(d)return d;this.fire(new i.y(new Error(`The layer '${a}' does not exist in the map's style.`)))}_checkSource(a){const d=this.getOwnSource(a);if(d)return d;this.fire(new i.y(new Error(`The source '${a}' does not exist in the map's style.`)))}precompilePrograms(a,d){const _=this.map.painter;if(_)for(let y=a.minzoom||0;y<(a.maxzoom||25.5);y++){const b=a.getProgramIds();if(b)for(const T of b){const j=a.getDefaultProgramParams(T,d.zoom,this._styleColorTheme.lut);j&&(_.style=this,this.fog&&(_._fogVisible=!0,j.overrideFog=!0,_.getOrCreateProgram(T,j)),_._fogVisible=!1,j.overrideFog=!1,_.getOrCreateProgram(T,j),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(j.overrideRtt=!0,_.getOrCreateProgram(T,j)))}}}update(a){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(a),this.directionalLight&&this.directionalLight.recalculate(a);const d=this.calculateLightsBrightness();a.brightness=d||0,d!==this._brightness&&(this._brightness=d,this.dispatcher.broadcast("setBrightness",d)),a.worldview!==this._worldview&&(this._worldview=a.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const _=this._changes.isDirty();let y=!1;if(this._changes.isDirty()){const j=this._changes.getLayerUpdatesByScope();for(const N in j){const{updatedIds:L,removedIds:B}=j[N];(L||B)&&(this._updateWorkerLayers(N,L,B),y=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(a),this.light&&this.light.updateTransitions(a),this.ambientLight&&this.ambientLight.updateTransitions(a),this.directionalLight&&this.directionalLight.updateTransitions(a),this.fog&&this.fog.updateTransitions(a),this.snow&&this.snow.updateTransitions(a),this.rain&&this.rain.updateTransitions(a),this._changes.reset()}const b={};for(const j in this._mergedSourceCaches){const N=this._mergedSourceCaches[j];b[j]=N.used,N.used=!1,N.tileCoverLift=0}for(const j of this._mergedOrder){const N=this._mergedLayers[j];if(N.recalculate(a,this._availableImages),!N.isHidden(a.zoom)){const L=this.getLayerSourceCache(N);L&&(L.used=!0,L.tileCoverLift=Math.max(L.tileCoverLift,N.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(N,a)}):this.precompilePrograms(N,a))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&y&&this.mergeLayers();const T=this.imageManager.getPendingImageProviders();for(const j of T)j.sourceCache.used=!0;for(const j in b){const N=this._mergedSourceCaches[j];b[j]!==N.used&&N.getSource().fire(new i.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:N.getSource().id}))}this.light&&this.light.recalculate(a),this.terrain&&this.terrain.recalculate(a),this.fog&&this.fog.recalculate(a),this.snow&&this.snow.recalculate(a),this.rain&&this.rain.recalculate(a),this.z=a.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),_&&this.fire(new i.z("data",{dataType:"style"}))}updateImageProviders(){const a=this.imageManager.getPendingImageProviders();for(const d of a){const _=d.resolvePendingRequests(),y=this.getFragmentStyle(d.scope);y&&y.addImages(_)}}_updateTilesForChangedImages(){const a={};for(const d in this._mergedSourceCaches){const _=this._mergedSourceCaches[d].getSource().scope;a[_]=a[_]||this._changes.getUpdatedImages(_),a[_].length!==0&&this._mergedSourceCaches[d].reloadTilesForDependencies(["icons","patterns"],a[_])}for(const d in a)this._changes.resetUpdatedImages(d)}_updateWorkerLayers(a,d,_){const y=this.getFragmentStyle(a);y&&this.dispatcher.broadcast("updateLayers",{layers:d?y._serializeLayers(d):[],scope:a,removedIds:_||[],options:y.options})}setState(a,d){if(this._checkLoaded(),Rd(this,Ot(a)))return!1;(a=i.dn(a)).layers=jf(a.layers);const _=function(T,j){if(!T)return[{command:Ni.setStyle,args:[j]}];let N=[];try{if(!i.bx(T.version,j.version))return[{command:Ni.setStyle,args:[j]}];if(i.bx(T.center,j.center)||N.push({command:Ni.setCenter,args:[j.center]}),i.bx(T.zoom,j.zoom)||N.push({command:Ni.setZoom,args:[j.zoom]}),i.bx(T.bearing,j.bearing)||N.push({command:Ni.setBearing,args:[j.bearing]}),i.bx(T.pitch,j.pitch)||N.push({command:Ni.setPitch,args:[j.pitch]}),i.bx(T.sprite,j.sprite)||N.push({command:Ni.setSprite,args:[j.sprite]}),i.bx(T.glyphs,j.glyphs)||N.push({command:Ni.setGlyphs,args:[j.glyphs]}),i.bx(T.imports,j.imports)||function(Q=[],re=[],ae){re=re||[];const fe=(Q=Q||[]).map(zm),de=re.map(zm),xe=Q.reduce(Bm,{}),je=re.reduce(Bm,{}),we=fe.slice();let Ve,Ne,Ge,Be;for(Ve=0,Ne=0;Ve<fe.length;Ve++)Ge=fe[Ve],je.hasOwnProperty(Ge)?Ne++:(ae.push({command:Ni.removeImport,args:[Ge]}),we.splice(we.indexOf(Ge,Ne),1));for(Ve=0,Ne=0;Ve<de.length;Ve++)Ge=de[de.length-1-Ve],we[we.length-1-Ve]!==Ge&&(xe.hasOwnProperty(Ge)?(ae.push({command:Ni.removeImport,args:[Ge]}),we.splice(we.lastIndexOf(Ge,we.length-Ne),1)):Ne++,Be=we[we.length-Ve],ae.push({command:Ni.addImport,args:[je[Ge],Be]}),we.splice(we.length-Ve,0,Ge));for(const De of re){const We=xe[De.id];We&&(delete We.data,i.bx(We,De)||ae.push({command:Ni.updateImport,args:[De.id,De]}))}}(T.imports,j.imports,N),i.bx(T.transition,j.transition)||N.push({command:Ni.setTransition,args:[j.transition]}),i.bx(T.light,j.light)||N.push({command:Ni.setLight,args:[j.light]}),i.bx(T.fog,j.fog)||N.push({command:Ni.setFog,args:[j.fog]}),i.bx(T.snow,j.snow)||N.push({command:Ni.setSnow,args:[j.snow]}),i.bx(T.rain,j.rain)||N.push({command:Ni.setRain,args:[j.rain]}),i.bx(T.projection,j.projection)||N.push({command:Ni.setProjection,args:[j.projection]}),i.bx(T.lights,j.lights)||N.push({command:Ni.setLights,args:[j.lights]}),i.bx(T.camera,j.camera)||N.push({command:Ni.setCamera,args:[j.camera]}),i.bx(T.iconsets,j.iconsets)||function(Q,re,ae){let fe;for(fe in re=re||{},Q=Q||{})Q.hasOwnProperty(fe)&&(re.hasOwnProperty(fe)||ae.push({command:Ni.removeIconset,args:[fe]}));for(fe in re){if(!re.hasOwnProperty(fe))continue;const de=re[fe];Q.hasOwnProperty(fe)?i.bx(Q[fe],de)||(ae.push({command:Ni.removeIconset,args:[fe]}),ae.push({command:Ni.addIconset,args:[fe,de]})):ae.push({command:Ni.addIconset,args:[fe,de]})}}(T.iconsets,j.iconsets,N),!i.bx(T["color-theme"],j["color-theme"]))return[{command:Ni.setStyle,args:[j]}];const L={},B=[];(function(Q,re,ae,fe){let de;for(de in re=re||{},Q=Q||{})Q.hasOwnProperty(de)&&(re.hasOwnProperty(de)||Om(de,ae,fe));for(de in re){if(!re.hasOwnProperty(de))continue;const xe=re[de];Q.hasOwnProperty(de)?i.bx(Q[de],xe)||(Q[de].type==="geojson"&&xe.type==="geojson"&&ey(Q,re,de)?ae.push({command:Ni.setGeoJSONSourceData,args:[de,xe.data]}):Fm(de,re,ae,fe)):Qv(de,re,ae)}})(T.sources,j.sources,B,L);const X=[];T.layers&&T.layers.forEach(Q=>{Q.source&&L[Q.source]?N.push({command:Ni.removeLayer,args:[Q.id]}):X.push(Q)});let q=T.terrain;q&&L[q.source]&&(N.push({command:Ni.setTerrain,args:[void 0]}),q=void 0),N=N.concat(B),i.bx(q,j.terrain)||N.push({command:Ni.setTerrain,args:[j.terrain]}),function(Q,re,ae){re=re||[];const fe=(Q=Q||[]).map(zm),de=re.map(zm),xe=Q.reduce(Bm,{}),je=re.reduce(Bm,{}),we=fe.slice(),Ve=Object.create(null);let Ne,Ge,Be,De,We,st,rt;for(Ne=0,Ge=0;Ne<fe.length;Ne++)Be=fe[Ne],je.hasOwnProperty(Be)?Ge++:(ae.push({command:Ni.removeLayer,args:[Be]}),we.splice(we.indexOf(Be,Ge),1));for(Ne=0,Ge=0;Ne<de.length;Ne++)Be=de[de.length-1-Ne],we[we.length-1-Ne]!==Be&&(xe.hasOwnProperty(Be)?(ae.push({command:Ni.removeLayer,args:[Be]}),we.splice(we.lastIndexOf(Be,we.length-Ge),1)):Ge++,st=we[we.length-Ne],ae.push({command:Ni.addLayer,args:[je[Be],st]}),we.splice(we.length-Ne,0,Be),Ve[Be]=!0);for(Ne=0;Ne<de.length;Ne++)if(Be=de[Ne],De=xe[Be],We=je[Be],!Ve[Be]&&!i.bx(De,We))if(i.bx(De.source,We.source)&&i.bx(De["source-layer"],We["source-layer"])&&i.bx(De.type,We.type)){for(rt in Lm(De.layout,We.layout,ae,Be,null,Ni.setLayoutProperty),Lm(De.paint,We.paint,ae,Be,null,Ni.setPaintProperty),i.bx(De.slot,We.slot)||ae.push({command:Ni.setSlot,args:[Be,We.slot]}),i.bx(De.filter,We.filter)||ae.push({command:Ni.setFilter,args:[Be,We.filter]}),i.bx(De.minzoom,We.minzoom)&&i.bx(De.maxzoom,We.maxzoom)||ae.push({command:Ni.setLayerZoomRange,args:[Be,We.minzoom,We.maxzoom]}),De)De.hasOwnProperty(rt)&&rt!=="layout"&&rt!=="paint"&&rt!=="filter"&&rt!=="metadata"&&rt!=="minzoom"&&rt!=="maxzoom"&&rt!=="slot"&&(rt.indexOf("paint.")===0?Lm(De[rt],We[rt],ae,Be,rt.slice(6),Ni.setPaintProperty):i.bx(De[rt],We[rt])||ae.push({command:Ni.setLayerProperty,args:[Be,rt,We[rt]]}));for(rt in We)We.hasOwnProperty(rt)&&!De.hasOwnProperty(rt)&&rt!=="layout"&&rt!=="paint"&&rt!=="filter"&&rt!=="metadata"&&rt!=="minzoom"&&rt!=="maxzoom"&&rt!=="slot"&&(rt.indexOf("paint.")===0?Lm(De[rt],We[rt],ae,Be,rt.slice(6),Ni.setPaintProperty):i.bx(De[rt],We[rt])||ae.push({command:Ni.setLayerProperty,args:[Be,rt,We[rt]]}))}else ae.push({command:Ni.removeLayer,args:[Be]}),st=we[we.lastIndexOf(Be)+1],ae.push({command:Ni.addLayer,args:[We,st]})}(X,j.layers,N)}catch(L){console.warn("Unable to compute style diff:",L),N=[{command:Ni.setStyle,args:[j]}]}return N}(this.serialize(),a).filter(T=>!(T.command in oy));if(_.length===0)return!1;const y=_.filter(T=>!(T.command in FA));if(y.length>0)throw new Error(`Unimplemented: ${y.map(T=>T.command).join(", ")}.`);const b=[];return _.forEach(T=>{b.push(this[T.command](...T.args))}),d&&Promise.all(b).then(d).catch(d),this.stylesheet=a,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(a){if(a.size===0)return this;for(const[d,_]of a.entries()){if(this.getImage(d))return this.fire(new i.y(new Error(`An image with the name "${d.name}" already exists.`)));this.imageManager.addImage(d,this.scope,_),this._changes.updateImage(d,this.scope)}return this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this}addImage(a,d){return this.getImage(a)?this.fire(new i.y(new Error(`An image with the name "${a.name}" already exists.`))):(this.imageManager.addImage(a,this.scope,d),this._changes.updateImage(a,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this)}updateImage(a,d,_=!1){this.imageManager.updateImage(a,this.scope,d),_&&(this._changes.updateImage(a,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})))}getImage(a){return this.imageManager.getImage(a,this.scope)}removeImage(a){return this.getImage(a)?(this.imageManager.removeImage(a,this.scope),this._changes.updateImage(a,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this):this.fire(new i.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(a){return this.modelManager.addModelURLs(a,this.scope),this._updateWorkerModels(),this.fire(new i.z("data",{dataType:"style"})),this}addModel(a,d,_={}){return this._checkLoaded(),this._validate(Ae,`models.${a}`,d,null,_)||(this.modelManager.addModel(a,d,this.scope),this.fire(new i.z("data",{dataType:"style"}))),this}hasModel(a){return this.modelManager.hasModel(a,this.scope)}removeModel(a){return this.hasModel(a)?(this.modelManager.removeModel(a,this.scope,!1,!0),this.fire(new i.z("data",{dataType:"style"})),this):this.fire(new i.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(a,d,_={}){if(this._checkLoaded(),this.getOwnSource(a)!==void 0)throw new Error(`There is already a source with ID "${a}".`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(Hr,`sources.${a}`,d,null,_))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const y=lr(a,d,this.dispatcher,this);y.scope=this.scope,y.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(y.id),source:y.serialize(),sourceId:y.id}));const b=T=>{const j=(T?"symbol:":"other:")+y.id,N=i.B(j,this.scope),L=this._sourceCaches[j]=new Qo(N,y,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[y.id]=L,L.onAdd(this.map)};b(!1),d.type!=="vector"&&d.type!=="geojson"||b(!0),y.onAdd&&y.onAdd(this.map),_.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(a){this._checkLoaded();const d=this.getOwnSource(a);if(!d)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===a)return this.fire(new i.y(new Error(`Source "${a}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===a)return this.fire(new i.y(new Error(`Source "${a}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const y=Object.entries(this.stylesheet.iconsets).find(([b,T])=>T.type==="source"&&T.source===a);if(y)return this.fire(new i.y(new Error(`Source "${a}" cannot be removed while iconset "${y[0]}" is using it.`)))}const _=this.getOwnSourceCaches(a);for(const y of _){const b=i.dp(y.id);delete this._sourceCaches[b],this._changes.discardSourceCacheUpdate(y.id),y.fire(new i.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles()}return delete this._otherSourceCaches[a],delete this._symbolSourceCaches[a],this.mergeSources(),d.setEventedParent(null),d.onRemove&&d.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(a,d){this._checkLoaded(),this.getOwnSource(a).setData(d),this._changes.setDirty()}getOwnSource(a){const d=this.getOwnSourceCache(a);return d&&d.getSource()}getOwnSources(){const a=[];for(const d in this._otherSourceCaches){const _=this.getOwnSourceCache(d);_&&a.push(_.getSource())}return a}areTilesLoaded(){const a=this._mergedSourceCaches;for(const d in a){const _=a[d]._tiles;for(const y in _){const b=_[y];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}setLights(a){if(this._checkLoaded(),!a)return delete this.ambientLight,void delete this.directionalLight;const d=this._getTransitionParameters();for(const b of a){if(this._validate(vn,"lights",b))return;switch(b.type){case"ambient":if(this.ambientLight){const T=this.ambientLight;T.set(b),T.updateTransitions(d)}else this.ambientLight=new is(b,Rn||(Rn=new i.a9({color:new i.aa(i.a6.properties_light_ambient.color),"color-use-theme":new i.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.aa(i.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const T=this.directionalLight;T.set(b),T.updateTransitions(d)}else this.directionalLight=new is(b,Zi||(Zi=new i.a9({direction:new i.ap(i.a6.properties_light_directional.direction),color:new i.aa(i.a6.properties_light_directional.color),"color-use-theme":new i.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.aa(i.a6.properties_light_directional.intensity),"cast-shadows":new i.aa(i.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new i.aa(i.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new i.aa(i.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const _=Object.assign(d,{worldview:this.map.getWorldview()}),y=new i.ac(this.z||0,_);this.ambientLight&&this.ambientLight.recalculate(y),this.directionalLight&&this.directionalLight.recalculate(y),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const a=this.directionalLight,d=this.ambientLight;if(!a||!d)return;const _=q=>.2126*(q[0]<=.03928?q[0]/12.92:Math.pow((q[0]+.055)/1.055,2.4))+.7152*(q[1]<=.03928?q[1]/12.92:Math.pow((q[1]+.055)/1.055,2.4))+.0722*(q[2]<=.03928?q[2]/12.92:Math.pow((q[2]+.055)/1.055,2.4)),y=a.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),b=a.properties.get("intensity"),T=a.properties.get("direction"),j=1-i.d3(T.x,T.y,T.z)[2]/90,N=_(y)*b*j,L=d.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),B=d.properties.get("intensity"),X=_(L)*B;return Number(((N+X)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const a=[];return this.directionalLight&&a.push(this.directionalLight.get()),this.ambientLight&&a.push(this.ambientLight.get()),a}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(a){if(a==null||a===""&&this.isRootStyle())return this;if(i.dq(a)){const d=i.dr(a),_=this.fragments.find(({id:b})=>b===d);if(!_)return;const y=i.dp(a);return _.style.getFragmentStyle(y)}{const d=this.fragments.find(({id:_})=>_===a);return d?d.style:void 0}}setFeaturesetSelectors(a){if(!a)return;const d={},_=(y,b="")=>`${y}::${b}`;this._featuresetSelectors={};for(const y in a){const b=this._featuresetSelectors[y]=[];for(const T of a[y].selectors){if(T.featureNamespace){const N=this.getOwnLayer(T.layer);if(!N){i.w(`Layer is undefined for selector: ${T.layer}`);continue}const L=_(N.source,N.sourceLayer);if(L in d&&d[L]!==T.featureNamespace){i.w(`"featureNamespace ${T.featureNamespace} of featureset ${y}'s selector is not associated to the same source, skip this selector`);continue}d[L]=T.featureNamespace}let j;if(T.properties)for(const N in T.properties){const L=i.U(T.properties[N]);L.result==="success"&&(j=j||{},j[N]=L.value)}b.push({layerId:T.layer,namespace:T.featureNamespace,properties:j,uniqueFeatureID:T._uniqueFeatureID})}}}getFeaturesetDescriptors(a){const d=this.getFragmentStyle(a);if(!d||!d.stylesheet.featuresets)return[];const _=[];for(const y in d.stylesheet.featuresets)_.push({featuresetId:y,importId:d.scope?d.scope:void 0});return _}getFeaturesetLayers(a,d){const _=this.getFragmentStyle(d),y=_.stylesheet.featuresets;if(!y||!y[a])return this.fire(new i.y(new Error(`The featureset '${a}' does not exist in the map's style and cannot be queried.`))),[];const b=[];for(const T of y[a].selectors){const j=_.getOwnLayer(T.layer);j&&b.push(j)}return b}getConfigProperty(a,d){const _=this.getFragmentStyle(a);if(!_)return null;const y=i.B(d,_.scope),b=_.options.get(y),T=b?b.value||b.default:null;return T?T.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(a,d){const _=i.B(a,d);return this._mergedIndoor[_]}setIndoorData(a,d){this.map.indoor.setIndoorData(d)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(a,d,_){const y=this.getFragmentStyle(a);if(!y)return;const b=y.stylesheet.schema;if(!b||!b[d])return;const T=i.U(_);if(T.result!=="success")return void Rd(this,T.value);const j=T.value.expression,N=i.B(d,y.scope),L=y.options.get(N);if(!L)return;let B;const{minValue:X,maxValue:q,stepValue:Q,type:re,values:ae}=b[d],fe=i.U(b[d].default);fe.result==="success"&&(B=fe.value.expression),B?(this.options.set(N,Object.assign({},L,{value:j,default:B,minValue:X,maxValue:q,stepValue:Q,type:re,values:ae})),this.updateConfigDependencies(d)):this.fire(new i.y(new Error(`No schema defined for the config option "${d}" in the "${a}" fragment.`)))}getConfig(a){const d=this.getFragmentStyle(a);if(!d)return null;const _=d.stylesheet.schema;if(!_)return null;const y={};for(const b in _){const T=i.B(b,d.scope),j=d.options.get(T),N=j?j.value||j.default:null;y[b]=N?N.serialize():null}return y}setConfig(a,d){const _=this.getFragmentStyle(a);_&&(_.updateConfig(d,_.stylesheet.schema),this.updateConfigDependencies())}getSchema(a){const d=this.getFragmentStyle(a);return d?d.stylesheet.schema:null}setSchema(a,d){const _=this.getFragmentStyle(a);_&&(_.stylesheet.schema=d,_.updateConfig(_._config,d),this.updateConfigDependencies())}updateConfig(a,d){if(this._config=a,a||d)if(d)for(const _ in d){let y,b;const T=i.U(d[_].default);if(T.result==="success"&&(y=T.value.expression),a&&a[_]!==void 0){const q=i.U(a[_]);q.result==="success"&&(b=q.value.expression)}const{minValue:j,maxValue:N,stepValue:L,type:B,values:X}=d[_];if(y){const q=i.B(_,this.scope);this.options.set(q,{default:y,value:b,minValue:j,maxValue:N,stepValue:L,type:B,values:X})}else this.fire(new i.y(new Error(`No schema defined for config option "${_}".`)))}else this.fire(new i.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(a,d=()=>!0){for(const _ of a){const y=this.getLayer(_);y&&d(y)&&(y.possiblyEvaluateVisibility(),this._updateLayer(y),this._changes.setDirty())}}updateConfigDependencies(a){this._updateLayers(this._configDependentLayers,d=>!a||d.expressionDependencies.configDependencies.has(a)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(d=>{const _=d._styleColorTheme.colorThemeOverride?d._styleColorTheme.colorThemeOverride:d._styleColorTheme.colorTheme;if(_){const y=d._evaluateColorThemeData(_);(!d._styleColorTheme.lut&&y!==""||d._styleColorTheme.lut&&y!==d._styleColorTheme.lut.data)&&d.setColorTheme(_)}}),this._changes.setDirty()}addLayer(a,d,_={}){this._checkLoaded();const y=a.id;if(this._layers[y])return void this.fire(new i.y(new Error(`Layer with id "${y}" already exists on this map`)));let b;if(a.type==="custom"){if(Rd(this,i.ds(a)))return;b=i.dt(a,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof a.source=="object"&&(this.addSource(y,a.source),a=i.dn(a),a=Object.assign(a,{source:y})),this._validate(pt,`layers.${y}`,a,{arrayIndex:-1},_))return;b=i.dt(a,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(b),b.setEventedParent(this,{layer:{id:y}})}const T=i.B(b.source,b.scope);b.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(T),b.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(T);let j=this._order.length;if(d){const X=this._order.indexOf(d);if(X===-1)return void this.fire(new i.y(new Error(`Layer with id "${d}" does not exist on this map.`)));b.slot===this._layers[d].slot?j=X:i.w(`Layer with id "${d}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(j,0,y),this._layerOrderChanged=!0,this._layers[y]=b;const N=this.getOwnLayerSourceCache(b),L=!!this.directionalLight&&this.directionalLight.shadowsEnabled();N&&b.canCastShadows()&&L&&(N.castsShadows=!0);const B=this._changes.getRemovedLayer(b);if(B&&b.source&&N&&b.type!=="custom"){this._changes.discardLayerRemoval(b);const X=i.B(b.source,b.scope);B.type!==b.type?this._changes.updateSourceCache(X,"clear"):(this._changes.updateSourceCache(X,"reload"),N.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),b.scope=this.scope,this.mergeLayers()}moveLayer(a,d){this._checkLoaded();const _=this._checkLayer(a);if(!_||a===d)return;const y=this._order.indexOf(a);this._order.splice(y,1);let b=this._order.length;if(d){const T=this._order.indexOf(d);if(T===-1)return void this.fire(new i.y(new Error(`Layer with id "${d}" does not exist on this map.`)));_.slot===this._layers[d].slot?b=T:i.w(`Layer with id "${d}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,a),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(a){this._checkLoaded();const d=this._checkLayer(a);if(!d)return;d.setEventedParent(null);const _=this._order.indexOf(a);this._order.splice(_,1),delete this._layers[a],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(d.fqid),this._indoorDependentLayers.delete(d.fqid),this._changes.removeLayer(d);const y=this.getOwnLayerSourceCache(d);if(y&&y.castsShadows){let b=!1;for(const T in this._layers)if(this._layers[T].source===d.source&&this._layers[T].canCastShadows()){b=!0;break}y.castsShadows=b}d.onRemove&&d.onRemove(this.map),this.mergeLayers()}getOwnLayer(a){return this._layers[a]}hasLayer(a){return a in this._mergedLayers}hasLayerType(a){for(const d in this._layers)if(this._layers[d].type===a)return!0;return!1}setLayerZoomRange(a,d,_){this._checkLoaded();const y=this._checkLayer(a);y&&(y.minzoom===d&&y.maxzoom===_||(d!=null&&(y.minzoom=d),_!=null&&(y.maxzoom=_),this._updateLayer(y)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(a,d){this._checkLoaded();const _=this._checkLayer(a);_&&_.slot!==d&&(_.slot=d,this._updateLayer(_))}setFilter(a,d,_={}){this._checkLoaded();const y=this._checkLayer(a);if(y&&!i.bx(y.filter,d))return d==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(lt,`layers.${y.id}.filter`,d,{layerType:y.type},_)||(y.filter=i.dn(d),this._updateLayer(y)))}getFilter(a){const d=this._checkLayer(a);if(d)return i.dn(d.filter)}setLayoutProperty(a,d,_,y={}){this._checkLoaded();const b=this._checkLayer(a);if(b&&!i.bx(b.getLayoutProperty(d),_)){if(_!=null&&(!y||y.validate!==!1)&&Rd(b,Jr.call(Ot,{key:`layers.${a}.layout.${d}`,layerType:b.type,objectKey:d,value:_,styleSpec:i.a6,style:{glyphs:!0,sprite:!0}})))return;b.setLayoutProperty(d,_),b.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),b.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(b.fqid),this._updateLayer(b)}}setLayerProperty(a,d,_,y={}){this._checkLoaded();const b=this._checkLayer(a);b&&(d==="appearances"?(b.setAppearances(_),this._changes.setDirty()):b.isPaintProperty(d)?this.setPaintProperty(a,d,_,y):this.setLayoutProperty(a,d,_,y))}getLayoutProperty(a,d){const _=this._checkLayer(a);if(_)return _.getLayoutProperty(d)}setPaintProperty(a,d,_,y={}){this._checkLoaded();const b=this._checkLayer(a);if(!b||i.bx(b.getPaintProperty(d),_)||_!=null&&(!y||y.validate!==!1)&&Rd(b,Er.call(Ot,{key:`layers.${a}.paint.${d}`,layerType:b.type,objectKey:d,value:_,styleSpec:i.a6})))return;const T=b.setPaintProperty(d,_);b.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),b.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(b.fqid),T&&this._updateLayer(b),this._changes.updatePaintProperties(b)}getPaintProperty(a,d){const _=this._checkLayer(a);if(_)return _.getPaintProperty(d)}setFeatureState(a,d){if(this._checkLoaded(),"target"in a){if("featuresetId"in a.target){const{featuresetId:N,importId:L}=a.target,B=this.getFragmentStyle(L),X=B.getFeaturesetLayers(N);for(const{source:q,sourceLayer:Q}of X)B.setFeatureState({id:a.id,source:q,sourceLayer:Q},d)}else if("layerId"in a.target){const{layerId:N}=a.target,L=this.getLayer(N);this.setFeatureState({id:a.id,source:L.source,sourceLayer:L.sourceLayer},d)}return}const _=a.source,y=a.sourceLayer,b=this._checkSource(_);if(!b)return;const T=b.type;if(T==="geojson"&&y)return void this.fire(new i.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!y)return void this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")));a.id===void 0&&this.fire(new i.y(new Error("The feature id parameter must be provided.")));const j=this.getOwnSourceCaches(_);for(const N of j)N.setFeatureState(y,a.id,d)}removeFeatureState(a,d){if(this._checkLoaded(),"target"in a){if("featuresetId"in a.target){const{featuresetId:N,importId:L}=a.target,B=this.getFragmentStyle(L),X=B.getFeaturesetLayers(N);for(const{source:q,sourceLayer:Q}of X)B.removeFeatureState({id:a.id,source:q,sourceLayer:Q},d)}else if("layerId"in a.target){const{layerId:N}=a.target,L=this.getLayer(N);this.removeFeatureState({id:a.id,source:L.source,sourceLayer:L.sourceLayer},d)}return}const _=a.source,y=this._checkSource(_);if(!y)return;const b=y.type,T=b==="vector"?a.sourceLayer:void 0;if(b==="vector"&&!T)return void this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(d&&typeof a.id!="string"&&typeof a.id!="number")return void this.fire(new i.y(new Error("A feature id is required to remove its specific state property.")));const j=this.getOwnSourceCaches(_);for(const N of j)N.removeFeatureState(T,a.id,d)}getFeatureState(a){if(this._checkLoaded(),"target"in a){let b;if("featuresetId"in a.target){const{featuresetId:T,importId:j}=a.target,N=this.getFragmentStyle(j),L=N.getFeaturesetLayers(T);for(const{source:B,sourceLayer:X}of L){const q=N.getFeatureState({id:a.id,source:B,sourceLayer:X});if(q&&!b)b=q;else if(!i.bx(b,q))return void this.fire(new i.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in a.target){const{layerId:T}=a.target,j=this.getLayer(T);b=this.getFeatureState({id:a.id,source:j.source,sourceLayer:j.sourceLayer})}return b}const d=a.source,_=a.sourceLayer,y=this._checkSource(d);if(y){if(y.type!=="vector"||_)return a.id===void 0&&this.fire(new i.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(d)[0].getFeatureState(_,a.id);this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(a){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,a),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const a=this.getTerrain(),d=a&&this.terrain&&this.terrain.scope===this.scope?a:this.stylesheet.terrain;return i.du({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:d,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},_=>_!==void 0)}_updateFilteredLayers(a){for(const d of Object.values(this._mergedLayers))a(d)&&this._updateLayer(d)}_updateLayer(a){this._changes.updateLayer(a);const d=this.getLayerSourceCache(a),_=i.B(a.source,a.scope),y=this._changes.getUpdatedSourceCaches();a.source&&!y[_]&&d&&d.getSource().type!=="raster"&&(this._changes.updateSourceCache(_,"reload"),d.pause()),a.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(a){const d=j=>this._mergedLayers[j].is3D(!!this.terrain),_=this.order,y={},b=[];for(let j=_.length-1;j>=0;j--){const N=_[j];if(d(N)){y[N]=j;for(const L of a){const B=L[N];if(B)for(const X of B)b.push(X)}}}b.sort((j,N)=>N.intersectionZ-j.intersectionZ);const T=[];for(let j=_.length-1;j>=0;j--){const N=_[j];if(d(N))for(let L=b.length-1;L>=0;L--){const B=b[L].feature;if(B.layer&&y[B.layer.id]<j)break;T.push(B),b.pop()}else for(const L of a){const B=L[N];if(B)for(const X of B)T.push(X.feature)}}return T}queryRasterValue(a,d,_){const y=this.getOwnSource(a);return y?y.type!=="raster-array"?(this.fire(new i.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):y.queryRasterArrayValue(d,_):(this.fire(new i.y(new Error(`Source with id "${a}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(a,d,_){let y;d&&!Array.isArray(d)&&d.filter&&(this._validate(lt,"queryRenderedFeatures.filter",d.filter,null,d),y=i.b5(d.filter));const b={},T=B=>{if($_.has(B.type))return;const X=this.getOwnLayerSourceCache(B),q=b[X.id]=b[X.id]||{sourceCache:X,layers:{},has3DLayers:!1};B.is3D(!!this.terrain)&&(q.has3DLayers=!0),q.layers[B.fqid]=q.layers[B.fqid]||{styleLayer:B,targets:[]},q.layers[B.fqid].targets.push({filter:y})};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new i.y(new Error("parameters.layers must be an Array."))),[];for(const B of d.layers){const X=this._layers[B];if(!X)return this.fire(new i.y(new Error(`The layer '${B}' does not exist in the map's style and cannot be queried for features.`))),[];T(X)}}else for(const B in this._layers)T(this._layers[B]);const j=this._queryRenderedFeatures(a,b,_),N=this._flattenAndSortRenderedFeatures(j),L=[];for(const B of N)i.dv(B.layer.id)===this.scope&&L.push(B);return L}queryRenderedFeatureset(a,d,_){let y;d&&!Array.isArray(d)&&d.filter&&(this._validate(lt,"queryRenderedFeatures.filter",d.filter,null,d),y=i.b5(d.filter));const b="mock",T=[];if(d&&d.target)T.push(Object.assign({},d,{targetId:b,filter:y}));else{const B=this.getFeaturesetDescriptors();for(const X of B)T.push({targetId:b,filter:y,target:X});for(const{style:X}of this.fragments){const q=X.getFeaturesetDescriptors();for(const Q of q)T.push({targetId:b,filter:y,target:Q})}}const j=this.queryRenderedTargets(a,T,_),N=[],L=new Set;for(const B of j)for(const X of B.variants[b])oi(X,B,L)||N.push(new i.dw(B,X));return N}queryRenderedTargets(a,d,_){const y={},b=(j,N,L,B)=>{const X=y[N.id]=y[N.id]||{sourceCache:N,layers:{},has3DLayers:!1};if(X.layers[j.fqid]=X.layers[j.fqid]||{styleLayer:j,targets:[]},j.is3D(!!this.terrain)&&(X.has3DLayers=!0),!B)return L.uniqueFeatureID=!1,void X.layers[j.fqid].targets.push(L);X.layers[j.fqid].targets.push(Object.assign({},L,{namespace:B.namespace,properties:B.properties,uniqueFeatureID:B.uniqueFeatureID}))};for(const j of d)if("featuresetId"in j.target){const{featuresetId:N,importId:L}=j.target,B=this.getFragmentStyle(L);if(!B||!B._featuresetSelectors)continue;const X=B._featuresetSelectors[N];if(!X){this.fire(new i.y(new Error(`The featureset '${N}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const q of X){const Q=B.getOwnLayer(q.layerId);Q&&!$_.has(Q.type)&&b(Q,B.getOwnLayerSourceCache(Q),j,q)}}else if("layerId"in j.target){const{layerId:N}=j.target,L=this.getLayer(N);if(!L||$_.has(L.type))continue;b(L,this.getLayerSourceCache(L),j)}const T=this._queryRenderedFeatures(a,y,_);return this._flattenAndSortRenderedFeatures(T)}_queryRenderedFeatures(a,d,_){const y=[],b=!!this.map._showQueryGeometry,T=yi.createFromScreenPoints(a,_);for(const j in d){const N=Ti(T,d[j],this._availableImages,_,b);Object.keys(N).length&&y.push(N)}if(this.placement)for(const j in d){if(!d[j].sourceCache._onlySymbols)continue;const N=qi(T.screenGeometry,d[j],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(N).length&&y.push(N)}return y}querySourceFeatures(a,d){const _=d&&d.filter;_&&this._validate(lt,"querySourceFeatures.filter",_,null,d);let y=[];const b=this.getOwnSourceCaches(a);for(const T of b)y=y.concat(Ms(T,d));return y}addSourceType(a,d,_){return oc.getSourceType(a)?_(new Error(`A source type called "${a}" already exists.`)):(oc.setSourceType(a,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:d.workerSourceURL},_):_(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(a,d,_={}){this._checkLoaded();const y=this.light.getLight();let b=!1;for(const j in a)if(!i.bx(a[j],y[j])){b=!0;break}if(!b)return;const T=this._getTransitionParameters();this.light.setLight(a,d,_),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=i.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&i.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(a,d=1){if(this._checkLoaded(),!a)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),d===0&&delete this.terrain,a===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let _=a;const y=a.source==null;if(d===1){if(this.disableElevatedTerrain)return;if(typeof _.source=="object"){const j="terrain-dem-src";this.addSource(j,_.source),_=i.dn(_),_=Object.assign(_,{source:j})}const b=Object.assign({},_),T={};if(this.terrain&&y){b.source=this.terrain.get().source;const j=this.terrain?this.getFragmentStyle(this.terrain.scope):null;j&&(T.style=j.serialize())}if(this._validate(ai,"terrain",b,T))return}if(!this.terrain||this.terrain.scope!==this.scope&&!y||this.terrain&&d!==this.terrain.drapeRenderMode){if(!_)return;this._createTerrain(_,d),this.fire(new i.z("data",{dataType:"style"}))}else{const b=this.terrain,T=b.get();for(const j of Object.keys(i.a6.terrain))!_.hasOwnProperty(j)&&i.a6.terrain[j].default&&(_[j]=i.a6.terrain[j].default);for(const j in a)if(!i.bx(a[j],T[j])){b.set(a,this.options),this.stylesheet.terrain=a;const N=this._getTransitionParameters({duration:0});b.updateTransitions(N),this.fire(new i.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(a){const d=this.fog=new ur(a,this.map.transform,this.scope,this.options);this.stylesheet.fog=d.get();const _=this._getTransitionParameters({duration:0});d.updateTransitions(_)}_createSnow(a){const d=this.snow=new Rs(a,this.map.transform,this.scope,this.options);this.stylesheet.snow=d.get();const _=this._getTransitionParameters({duration:0});d.updateTransitions(_)}_createRain(a){const d=this.rain=new gs(a,this.map.transform,this.scope,this.options);this.stylesheet.rain=d.get();const _=this._getTransitionParameters({duration:0});d.updateTransitions(_)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const a of this.map._markers)a._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(a){if(this._checkLoaded(),!a)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const d=this.fog;if(!i.bx(d.get(),a)){d.set(a,this.options),this.stylesheet.fog=d.get();const _=this._getTransitionParameters({duration:0});d.updateTransitions(_)}}else this._createFog(a);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(a){if(this._checkLoaded(),!a)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const d=this.snow;if(!i.bx(d.get(),a)){d.set(a,this.options),this.stylesheet.snow=d.get();const _=this._getTransitionParameters({duration:0});d.updateTransitions(_)}}else this._createSnow(a);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(a){if(this._checkLoaded(),!a)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const d=this.rain;if(!i.bx(d.get(),a)){d.set(a,this.options),this.stylesheet.rain=d.get();const _=this._getTransitionParameters({duration:0});d.updateTransitions(_)}}else this._createRain(a);this._markersNeedUpdate=!0}_reloadColorTheme(){const a=()=>{for(const y in this._layers)this._layers[y].lut=this._styleColorTheme.lut;for(const y in this._sourceCaches)this._sourceCaches[y].clearTiles()},d=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!d)return this._styleColorTheme.lut=null,void a();const _=this._evaluateColorThemeData(d);this._loadColorTheme(_).then(()=>{this.fire(new i.z("colorthemeset")),a()}).catch(y=>{i.w(`Couldn't set color theme: ${y}`)})}setColorTheme(a){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&i.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=a,this._reloadColorTheme()}setImportColorTheme(a,d){const _=this.getFragmentStyle(a);_&&(_._styleColorTheme.colorThemeOverride=d,_._reloadColorTheme())}_getTransitionParameters(a){return{now:i.o.now(),transition:Object.assign(this.transition,a)}}updateDrapeFirstLayers(){if(!this.terrain)return;const a=[],d=[];for(const _ of this._mergedOrder)this.isLayerDraped(this._mergedLayers[_])?a.push(_):d.push(_);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...a),this._drapedFirstOrder.push(...d)}_createTerrain(a,d){const _=this.terrain=new Ie(a,d,this.scope,this.options,this.map.getWorldview());d===1&&(this.stylesheet.terrain=a),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const y=this._getTransitionParameters({duration:0});_.updateTransitions(y)}_force3DLayerUpdate(){for(const a in this._layers){const d=this._layers[a];d.type==="fill-extrusion"&&this._updateLayer(d)}}_forceSymbolLayerUpdate(){for(const a in this._layers){const d=this._layers[a];d.type==="symbol"&&this._updateLayer(d)}}_validate(a,d,_,y,b={}){if(b&&b.validate===!1)return!1;const T=Object.assign({},this.serialize());return Rd(this,a.call(Ot,Object.assign({key:d,style:T,value:_,styleSpec:i.a6},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.dx.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._mergedLayers)this._mergedLayers[a].setEventedParent(null);for(const a in this._mergedSourceCaches)this._mergedSourceCaches[a].clearTiles(),this._mergedSourceCaches[a].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(a){const d=this.getSourceCaches(a);for(const _ of d)_.clearTiles()}clearSources(){for(const a in this._mergedSourceCaches)this._mergedSourceCaches[a].clearTiles()}clearLayers(){for(const a in this._mergedLayers){const d=this._mergedLayers[a];d._clear&&d._clear()}}reloadSource(a){const d=this.getSourceCaches(a);for(const _ of d)_.resume(),_.reload()}reloadSources(){for(const a of this.getSources())a.reload&&a.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(a=>{a.modelManager.reloadModels(a.scope)})}updateSources(a){let d;this.directionalLight&&(d=d2(this.directionalLight));const _=new Set;for(const y in this._mergedLayers){const b=this._mergedLayers[y];b.hasElevation()&&!_.has(b.source)&&_.add(b.source)}for(const y in this._mergedSourceCaches){const b=this._mergedSourceCaches[y],T=_.has(b._source.id);b.update(a,void 0,void 0,d,T)}}_generateCollisionBoxes(){for(const a in this._sourceCaches){const d=this._sourceCaches[a];d.resume(),d.reload()}}_updatePlacement(a,d,_,y,b,T,j=!1){let N=!1,L=!1;const B={},X={};for(const q of this._mergedOrder){const Q=this._mergedLayers[q];if(Q.type!=="symbol")continue;const re=i.B(Q.source,Q.scope);let ae=B[re];if(!ae){const de=this.getLayerSourceCache(Q);if(!de)continue;const xe=de.getRenderableIds(!0).map(je=>de.getTileByID(je));X[re]=xe.slice(),ae=B[re]=xe.sort((je,we)=>we.tileID.overscaledZ-je.tileID.overscaledZ||(je.tileID.isLessThan(we.tileID)?-1:1))}const fe=this.crossTileSymbolIndex.addLayer(Q,ae,d.center.lng,d.projection);N=N||fe}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),j=j||this._layerOrderChanged||y===0,this._layerOrderChanged&&this.fire(new i.z("neworder")),(j||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.o.now(),d.zoom))&&(this.pauseablePlacement=new el(d,this._mergedOrder,j,_,y,b,this.placement,this.fog&&d.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,B,X,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.o.now()),L=!0),N&&this.pauseablePlacement.placement.setStale()),L||N){this._buildingIndex.onNewFrame(d.zoom);for(let q=0;q<this._mergedOrder.length;q++){const Q=this._mergedLayers[this._mergedOrder[q]];if(Q.type!=="symbol")continue;const re=this.isLayerClipped(Q);this.placement.updateLayerOpacities(Q,B[i.B(Q.source,Q.scope)],q,re?T:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.o.now())}}_releaseSymbolFadeTiles(){for(const a in this._sourceCaches)this._sourceCaches[a].releaseSymbolFadeTiles()}addImport(a,d){this._checkLoaded();const _=this.stylesheet.imports=this.stylesheet.imports||[];if(_.findIndex(({id:b})=>b===a.id)!==-1)return void this.fire(new i.y(new Error(`Import with id '${a.id}' already exists in the map's style.`)));if(!d)return _.push(a),this._loadImports([a],!0);const y=_.findIndex(({id:b})=>b===d);return y===-1&&this.fire(new i.y(new Error(`Import with id "${d}" does not exist on this map.`))),this.stylesheet.imports=_.slice(0,y).concat(a).concat(_.slice(y)),this._loadImports([a],!0,d)}updateImport(a,d){this._checkLoaded();const _=this.stylesheet.imports||[],y=this.getImportIndex(a);return y===-1?this:typeof d=="string"?(this.setImportUrl(a,d),this):(d.url&&d.url!==_[y].url&&this.setImportUrl(a,d.url),i.bx(d.config,_[y].config)||this.setImportConfig(a,d.config,d.data.schema),i.bx(d.data,_[y].data)||this.setImportData(a,d.data),this)}moveImport(a,d){this._checkLoaded();let _=this.stylesheet.imports||[];const y=this.getImportIndex(a);if(y===-1)return this;const b=this.getImportIndex(d);if(b===-1)return this;const T=_[y],j=this.fragments[y];return _=_.filter(({id:N})=>N!==a),this.fragments=this.fragments.filter(({id:N})=>N!==a),this.stylesheet.imports=_.slice(0,b).concat(T).concat(_.slice(b)),this.fragments=this.fragments.slice(0,b).concat(j).concat(this.fragments.slice(b)),this.mergeLayers(),this}setImportUrl(a,d){this._checkLoaded();const _=this.stylesheet.imports||[],y=this.getImportIndex(a);if(y===-1)return this;_[y].url=d;const b=this.fragments[y];return b.style=this._createFragmentStyle(_[y]),b.style.on("style.import.load",()=>this.mergeAll()),b.style.loadURL(d),this}setImportData(a,d){this._checkLoaded();const _=this.getImportIndex(a),y=this.stylesheet.imports||[];return _===-1?this:d?(this.fragments[_].style.setState(d),this._reloadImports(),this):(delete y[_].data,this.setImportUrl(a,y[_].url))}setImportConfig(a,d,_){this._checkLoaded();const y=this.getImportIndex(a),b=this.stylesheet.imports||[];if(y===-1)return this;d?b[y].config=d:delete b[y].config;const T=this.fragments[y];_&&T.style.stylesheet&&(T.style.stylesheet.schema=_);const j=T.style.stylesheet&&T.style.stylesheet.schema;return T.config=d,T.style.updateConfig(d,j),this.updateConfigDependencies(),this}removeImport(a){this._checkLoaded();const d=this.stylesheet.imports||[],_=this.getImportIndex(a);_!==-1&&(d.splice(_,1),this.fragments[_].style._remove(),this.fragments.splice(_,1),this._reloadImports())}getImportIndex(a){const d=(this.stylesheet.imports||[]).findIndex(_=>_.id===a);return d===-1&&this.fire(new i.y(new Error(`Import '${a}' does not exist in the map's style and cannot be updated.`))),d}getLayer(a){return this._mergedLayers[a]}getSources(){const a=[];for(const d in this._mergedOtherSourceCaches){const _=this._mergedOtherSourceCaches[d];_&&a.push(_.getSource())}return a}getSource(a,d){const _=this.getSourceCache(a,d);return _&&_.getSource()}getLayerSource(a){const d=this.getLayerSourceCache(a);return d&&d.getSource()}getSourceCache(a,d){const _=i.B(a,d);return this._mergedOtherSourceCaches[_]}getLayerSourceCache(a){const d=i.B(a.source,a.scope);return a.type==="symbol"?this._mergedSymbolSourceCaches[d]:this._mergedOtherSourceCaches[d]}getSourceCaches(a){if(a==null)return Object.values(this._mergedSourceCaches);const d=[];return this._mergedOtherSourceCaches[a]&&d.push(this._mergedOtherSourceCaches[a]),this._mergedSymbolSourceCaches[a]&&d.push(this._mergedSymbolSourceCaches[a]),d}updateSourceCaches(){const a=this._changes.getUpdatedSourceCaches();for(const d in a){const _=a[d];_==="reload"?this.reloadSource(d):_==="clear"&&this.clearSource(d)}}updateLayers(a){const d=this._changes.getUpdatedPaintProperties();for(const _ of d){const y=this.getLayer(_);y&&y.updateTransitions(a)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(a){this.stylesheet.glyphs=a,this.glyphManager.setURL(a)}getImages(a,d,_){this.imageManager.getImages(d.images,d.scope,_),this._updateTilesForChangedImages();const y=T=>{if(T){const j=d.images.map(N=>i.I.toString(N));T.setDependencies(d.tileID.key,d.type,j)}},b=i.B(d.source,d.scope);y(this._mergedOtherSourceCaches[b]),y(this._mergedSymbolSourceCaches[b]),d.images.some(T=>T.iconsetId)&&this.fire(new i.z("data",{dataType:"style"}))}rasterizeImages(a,d,_){this.imageManager.rasterizeImages(d,_)}getGlyphs(a,d,_){this.glyphManager.getGlyphs(d.stacks,_)}getResource(a,d,_){return i.dy(d,_)}getOwnSourceCache(a){return this._otherSourceCaches[a]}getOwnLayerSourceCache(a){return a.type==="symbol"?this._symbolSourceCaches[a.source]:this._otherSourceCaches[a.source]}getOwnSourceCaches(a){const d=[];return this._otherSourceCaches[a]&&d.push(this._otherSourceCaches[a]),this._symbolSourceCaches[a]&&d.push(this._symbolSourceCaches[a]),d}_isSourceCacheLoaded(a){const d=this.getOwnSourceCaches(a);return d.length===0?(this.fire(new i.y(new Error(`There is no source with ID '${a}'`))),!1):d.every(_=>_.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(a,d){if(!this._clipLayerPresent&&a.type!=="fill-extrusion"&&a.type!=="building")return!1;const _=a.type==="fill-extrusion"&&(a.sourceLayer==="building"||a.sourceLayer==="procedural_buildings"),y=a.type==="building";if(a.is3D(!!this.terrain)){if(_||y||d&&d.type==="batched-model"||a.type==="model")return!0}else if(a.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(a=>{a.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}oc.getSourceType=function(g){return Et[g]},oc.setSourceType=function(g,a){Et[g]=a},oc.registerForPluginStateChange=i.dz;class Ch extends i.E{constructor(a){super(),this._style=a,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},i.aX(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(a){a===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=a,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(a){this._activeFloorsVisible=a,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(a){for(const[d,_]of Object.entries(a.buildings))if(this._buildings[d])for(const y of _.floorIds)this._buildings[d].floors[y]||(this._buildings[d].floors[y]=_.floors[y]);else this._buildings[d]=_;for(const d of a.activeFloors)this._activeFloors.add(d);this._updateIndoorSelector()}getIndoorTileOptions(a,d){const _=this._style.getIndoorSourceLayers(a,d);return _&&this._indoorState?{sourceLayers:_,indoorState:this._indoorState}:null}_updateUI(a,d,_){const y=function(b,T,j,N){let L=null,B=Number.MAX_SAFE_INTEGER;if(N<16)return null;for(const[X,q]of Object.entries(b)){const Q=q.center;if(Q){const re=T.distanceTo(i.aS.convert(Q));re<B&&j.contains(Q)&&(B=re,L=X)}}return L}(this._buildings,d,_,a);y!==this._closestBuildingId&&(this._closestBuildingId=y,this._updateIndoorSelector())}_updateIndoorSelector(){const a=this._buildings,d=this._closestBuildingId,_=d&&a?a[d]:void 0;if(!_)return void this.fire(new i.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let y=null;for(const T of _.floorIds)if(this._activeFloors&&this._activeFloors.has(T)){y=T;break}const b=Array.from(_.floorIds).map(T=>({id:T,name:_.floors[T].name,zIndex:_.floors[T].zIndex})).sort((T,j)=>j.zIndex-T.zIndex);this.fire(new i.z("selector-update",{selectedFloorId:y,activeFloorsVisible:this._activeFloorsVisible,floors:b}))}_updateActiveFloors(){const a=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:a,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var Qm=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,uy=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,dy=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,Mf="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Of=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,hy=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,q_=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Il=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,G_=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,ar=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,fy=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Ff=[];lc(Qm,Ff),lc(dy,Ff),lc(uy,Ff);const Lf={"_prelude_fog.vertex.glsl":hy,"_prelude_terrain.vertex.glsl":Of,"_prelude_shadow.vertex.glsl":ar,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":q_,"_prelude_shadow.fragment.glsl":fy,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Il,"_prelude_raster_particle.glsl":G_},eg={};si("",Of),si(q_,hy),si(fy,ar),si(Il,""),si(G_,"");const tg=si(uy,dy),cu=Qm;var W_={background:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:si(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:si(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:si("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:si(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:si(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:si("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:si("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:si("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:si(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:si(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:si(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:si(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:si(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:si(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:si("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:si("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:si(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:si(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:si("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:si(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Mf),skyboxGradient:si(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Mf),skyboxCapture:si(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:si(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:si(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:si(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:si("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:si("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:si("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:si("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function lc(g,a){const d=g.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let _ of d)if(_=_.trim(),_[0]==="#"&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const y=_.split(" ");for(const b of y)a.includes(b)||a.push(b)}}function si(g,a){const d=/#include\s+"([^"]+)"/g,_=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,y={},b=[],T=[];if(g=g.replace(d,(N,L)=>(T.push(L),"")),(a=a.replace(d,(N,L)=>(b.push(L),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let j=[...Ff];lc(g,j),lc(a,j);for(const N of[...b,...T])Lf[N]||console.error(`Undefined include: ${N}`),eg[N]||(eg[N]=[],lc(Lf[N],eg[N])),j=[...j,...eg[N]];return{fragmentSource:g=g.replace(_,(N,L,B,X,q)=>(y[q]=!0,L==="define"?`
#ifndef HAS_UNIFORM_u_${q}
in ${B} ${X} ${q};
#else
uniform ${B} ${X} u_${q};
#endif
`:L==="initialize"?`
#ifdef HAS_UNIFORM_u_${q}
    ${B} ${X} ${q} = u_${q};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    in ${B} ${X} ${q};
#endif
`:L==="initialize-attribute"?"":void 0)),vertexSource:a=a.replace(_,(N,L,B,X,q)=>{const Q=`MATERIAL_ATTRIBUTE_OFFSET_${q}`,re=X==="float"?"vec2":X,ae=`GET_ATTRIBUTE_${re}(a_${q}, materialInfo, ${Q})`,fe=q.match(/color/)?"color":re;return L==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${q}
in ${B} ${X} a_${q};
#endif
`:y[q]?L==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
    #if !defined(${Q})
        in ${B} ${re} a_${q};
    #endif
out ${B} ${X} ${q};
#else
uniform ${B} ${X} u_${q};
#endif
`:L==="initialize"?fe==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = a_${q};
#else
    ${B} ${X} ${q} = u_${q};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${q}) 
    #ifdef ${Q}
        ${q} = unpack_mix_${fe}(${ae}, u_${q}_t);
    #else
        ${q} = unpack_mix_${fe}(a_${q}, u_${q}_t);
    #endif
#else
    ${B} ${X} ${q} = u_${q};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    in ${B} ${X} a_${q};
    out ${B} ${X} ${q};
#endif
`:L==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    ${q} = a_${q};
#endif
`:void 0:L==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
    #if !defined(${Q})
        in ${B} ${re} a_${q};
    #endif  
#else
uniform ${B} ${X} u_${q};
#endif
`:L==="define-instanced"?fe==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${q}0;
in vec4 a_${q}1;
in vec4 a_${q}2;
in vec4 a_${q}3;
#else
uniform ${B} ${X} u_${q};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${B} ${re} a_${q};
#else
uniform ${B} ${X} u_${q};
#endif
`:L==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    ${B} ${X} ${q} = a_${q};
#endif
`:fe==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    #ifdef ${Q}
        ${B} ${X} ${q} = ${ae};
    #else
        ${B} ${X} ${q} = a_${q};
    #endif
#else
    ${B} ${X} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    #ifdef ${Q}
        ${B} ${X} ${q} = unpack_mix_${fe}(${ae}, u_${q}_t);
    #else
        ${B} ${X} ${q} = unpack_mix_${fe}(a_${q}, u_${q}_t);
    #endif
#else
    ${B} ${X} ${q} = u_${q};
#endif
`}),usedDefines:j,vertexIncludes:b,fragmentIncludes:T}}class zf{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(a,d,_,y,b,T,j,N){this.context=a;let L=this.boundPaintVertexBuffers.length!==y.length;for(let X=0;!L&&X<y.length;X++)this.boundPaintVertexBuffers[X]!==y[X]&&(L=!0);let B=this.boundDynamicVertexBuffers.length!==j.length;for(let X=0;!B&&X<j.length;X++)this.boundDynamicVertexBuffers[X]!==j[X]&&(B=!0);if(!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==_||L||B||this.boundIndexBuffer!==b||this.boundVertexOffset!==T)this.freshBind(d,_,y,b,T,j,N);else{a.bindVertexArrayOES.set(this.vao);for(const X of j)X&&(X.bind(),N&&X.instanceCount&&X.setVertexAttribDivisor(a.gl,d,N));b&&b.dynamicDraw&&b.bind()}}freshBind(a,d,_,y,b,T,j){const N=this.context,L=N.gl;this.vao&&this.destroy(),this.vao=N.gl.createVertexArray(),N.bindVertexArrayOES.set(this.vao),this.boundProgram=a,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=y,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=T,d.enableAttributes(L,a),d.bind(),d.setVertexAttribPointers(L,a,b);for(const B of _)B.enableAttributes(L,a),B.bind(),B.setVertexAttribPointers(L,a,b);for(const B of T)B&&(B.enableAttributes(L,a),B.bind(),B.setVertexAttribPointers(L,a,b),j&&B.instanceCount&&B.setVertexAttribDivisor(L,a,j));y&&y.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function LA(g,a){const d=Math.pow(2,a.canonical.z),_=a.canonical.y;return[new i.ae(0,_/d).toLngLat().lat,new i.ae(0,(_+1)/d).toLngLat().lat]}function zA(g,a,d,_,y,b,T){const j=g.context,N=j.gl,L=d.hillshadeFBO;if(!L)return;g.prepareDrawTile();const B=g.isTileAffectedByFog(a),X=g.getOrCreateProgram("hillshade",{overrideFog:B});j.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,L.colorAttachment.get());const q=((fe,de,xe,je)=>{const we=xe.paint.get("hillshade-shadow-color"),Ve=xe.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Ne=xe.paint.get("hillshade-highlight-color"),Ge=xe.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Be=xe.paint.get("hillshade-accent-color"),De=xe.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",We=xe.paint.get("hillshade-emissive-strength");let st=i.an(xe.paint.get("hillshade-illumination-direction"));if(xe.paint.get("hillshade-illumination-anchor")==="viewport")st-=fe.transform.angle;else if(fe.style&&fe.style.enable3dLights()&&fe.style.directionalLight){const bt=fe.style.directionalLight.properties.get("direction"),_t=i.d3(bt.x,bt.y,bt.z);st=i.an(_t[1])}const rt=!fe.options.moving;return{u_matrix:je||fe.transform.calculateProjMatrix(de.tileID.toUnwrapped(),rt),u_image:0,u_latrange:LA(0,de.tileID),u_light:[xe.paint.get("hillshade-exaggeration"),st],u_shadow:we.toPremultipliedRenderColor(Ve?null:xe.lut),u_highlight:Ne.toPremultipliedRenderColor(Ge?null:xe.lut),u_emissive_strength:We,u_accent:Be.toPremultipliedRenderColor(De?null:xe.lut)}})(g,d,_,g.terrain?a.projMatrix:null);g.uploadCommonUniforms(j,X,a.toUnwrapped());const{tileBoundsBuffer:Q,tileBoundsIndexBuffer:re,tileBoundsSegments:ae}=g.getTileBoundsBuffers(d);X.draw(g,N.TRIANGLES,y,b,T,yn.disabled,q,_.id,Q,re,ae)}function H_(g,a,d){if(!a.needsDEMTextureUpload)return;const _=g.context,y=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||g.getTileTexture(d.stride);const b=d.getPixels();a.demTexture?a.demTexture.update(b,{premultiply:!1}):a.demTexture=new i.T(_,b,y.R32F,{premultiply:!1}),a.needsDEMTextureUpload=!1}function BA(g,a,d){const _=g.context,y=_.gl;if(!a.dem)return;const b=a.dem;if(_.activeTexture.set(y.TEXTURE1),H_(g,a,b),!a.demTexture)return;a.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE);const T=b.dim;_.activeTexture.set(y.TEXTURE0);let j=a.hillshadeFBO;if(!j){const q=new i.T(_,{width:T,height:T,data:null},y.RGBA8);q.bind(y.LINEAR,y.CLAMP_TO_EDGE),j=a.hillshadeFBO=_.createFramebuffer(T,T,!0,"renderbuffer"),j.colorAttachment.set(q.texture)}_.bindFramebuffer.set(j.framebuffer),_.viewport.set([0,0,T,T]);const{tileBoundsBuffer:N,tileBoundsIndexBuffer:L,tileBoundsSegments:B}=g.getMercatorTileBoundsBuffers(),X=[];g.linearFloatFilteringSupported()&&X.push("TERRAIN_DEM_FLOAT_FORMAT"),g.getOrCreateProgram("hillshadePrepare",{defines:X}).draw(g,y.TRIANGLES,Rr.disabled,Cn.disabled,Vn.unblended,yn.disabled,((q,Q)=>{const re=Q.stride,ae=i.bB();return i.cd(ae,0,i.al,-i.al,0,0,1),i.bq(ae,ae,[0,-i.al,0]),{u_matrix:ae,u_image:1,u_dimension:[re,re],u_zoom:q.overscaledZ}})(a.tileID,b),d.id,N,L,B),a.needsHillshadePrepare=!1}class Os{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class p2 extends Os{getDefault(){return i.ao.transparent.toNonPremultipliedRenderColor(null)}set(a){const d=this.current;(a.r!==d.r||a.g!==d.g||a.b!==d.b||a.a!==d.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class py extends Os{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class UA extends Os{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class VA extends Os{getDefault(){return[!0,!0,!0,!0]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||a[2]!==d[2]||a[3]!==d[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class $A extends Os{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class qA extends Os{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class m2 extends Os{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const d=this.current;(a.func!==d.func||a.ref!==d.ref||a.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class GA extends Os{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||a[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class Z_ extends Os{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=a,this.dirty=!1}}class WA extends Os{getDefault(){return[0,1]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class g2 extends Os{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=a,this.dirty=!1}}class my extends Os{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class X_ extends Os{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.BLEND):d.disable(d.BLEND),this.current=a,this.dirty=!1}}class gy extends Os{getDefault(){const a=this.gl;return[a.ONE,a.ZERO,a.ONE,a.ZERO]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||a[2]!==d[2]||a[3]!==d[3]||this.dirty)&&(this.gl.blendFuncSeparate(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Ah extends Os{getDefault(){return i.ao.transparent.toNonPremultipliedRenderColor(null)}set(a){const d=this.current;(a.r!==d.r||a.g!==d.g||a.b!==d.b||a.a!==d.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class Bf extends Os{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(a,a),this.current=a,this.dirty=!1)}}class rg extends Os{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=a,this.dirty=!1}}class Uf extends Os{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class _2 extends Os{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}let _y=class extends Os{getDefault(){return null}set(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)}};class x2 extends Os{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class Vf extends Os{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||a[2]!==d[2]||a[3]!==d[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Y_ extends Os{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class K_ extends Os{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class xy extends Os{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class J_ extends Os{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class ng extends Os{getDefault(){return null}set(a){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class v2 extends Os{getDefault(){return null}set(a){this.gl&&(a!==this.current||this.dirty)&&(this.gl.bindVertexArray(a),this.current=a,this.dirty=!1)}}class y2 extends Os{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class w2 extends Os{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class $f extends Os{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class Q_ extends Os{constructor(a,d){super(a),this.context=a,this.parent=d}getDefault(){return null}}class HA extends Q_{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class b2 extends Q_{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,this.attachment(),d.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class ZA extends Q_{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,this.attachment(),d.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class vy extends b2{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const yy=(g,a,d)=>({u_matrix:g,u_image0:0,u_skirt_height:a,u_ground_shadow_factor:d}),e0=(g,a,d,_,y,b,T,j,N,L,B,X,q,Q,re,ae)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:a,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:d,u_zoom_transition:y,u_merc_center:b,u_image0:0,u_frustum_tl:T,u_frustum_tr:j,u_frustum_br:N,u_frustum_bl:L,u_globe_pos:B,u_globe_radius:X,u_viewport:q,u_grid_matrix:ae?Float32Array.from(ae):new Float32Array(9),u_skirt_height:Q,u_far_z_cutoff:re});function t0(g,a){return g!=null&&a!=null&&!(!g.hasData()||!a.hasData())&&g.demTexture!=null&&a.demTexture!=null&&g.tileID.key!==a.tileID.key}const jh=new class{constructor(){this.operations={}}newMorphing(g,a,d,_,y){if(g in this.operations){const b=this.operations[g];b.to.tileID.key!==d.tileID.key&&(b.queued=d)}else this.operations[g]={startTime:_,phase:0,duration:y,from:a,to:d,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const a=this.operations[g];return{from:a.from,to:a.to,phase:a.phase}}update(g){for(const a in this.operations){const d=this.operations[a];for(d.phase=(g-d.startTime)/d.duration;d.phase>=1||!this._validOp(d);)if(!this._nextOp(d,g)){delete this.operations[a];break}}}_nextOp(g,a){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=a,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},wy={0:null,1:"TERRAIN_VERTEX_MORPHING"};function S2(g,a,d){if(a===0)return 0;const _=a<1&&d===514?.25/a:1;return 6*Math.pow(1.5,22-g)*Math.max(a,1)*_}function ig(g,a){const d=1<<g.z;return!a&&(g.x===0||g.x===d-1)||g.y===0||g.y===d-1}const Ih=g=>({u_matrix:g});function r0(g,a,d,_,y){if(y>0){const b=i.o.now(),T=(b-g.timeAdded)/y,j=a?(b-a.timeAdded)/y:-1,N=d.getSource(),L=_.coveringZoomLevel({tileSize:N.tileSize,roundZoom:N.roundZoom}),B=!a||Math.abs(a.tileID.overscaledZ-L)>Math.abs(g.tileID.overscaledZ-L),X=B&&g.refreshedUponExpiration?1:i.aA(B?T:1-j,0,1);return a?{opacity:1,mix:1-X,isFading:T<1}:{opacity:X,mix:0,isFading:T<1}}return{opacity:1,mix:0,isFading:!1}}class Nl extends Qo{constructor(a){const d=lr("mock-dem",{type:"raster-dem",maxzoom:a.transform.maxZoom},a.style.dispatcher,a.style);super("mock-dem",d,!1),d.setEventedParent(this),this._sourceLoaded=!0}_loadTile(a,d){a.state="loaded",d(null)}}class by extends Qo{constructor(a){const d=lr("proxy",{type:"geojson",maxzoom:a.transform.maxZoom},a.style.dispatcher,a.style);super("proxy",d,!1),d.setEventedParent(this),this.map=this.getSource().map=a,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(a,d,_){if(a.freezeTileCoverage)return;this.transform=a;const y=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,T)=>{if(b[T.key]="",!this._tiles[T.key]){const j=new Sa(T,this._source.tileSize*T.overscaleFactor(),a.tileZoom,void 0,void 0,this._source.worldview);j.state="loaded",this._tiles[T.key]=j}return b},{});for(const b in this._tiles)b in y||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(a){const d=this.proxyCachedFBO[a];if(d!==void 0){const _=Object.values(d);this.renderCachePool.push(..._),delete this.proxyCachedFBO[a]}}deallocRenderCache(){this.renderCache.forEach(a=>a.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class sg extends i.aP{constructor(a,d,_){super(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y),this.proxyTileKey=d,this.projMatrix=_}}class ag extends i.bU{constructor(a,d){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},a.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),a.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),a.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=a,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,y,b]=function(N){const L=new i.bc,B=new i.b0,X=131;L.reserve(17161),B.reserve(33800);const q=i.al/128,Q=i.al+q/2,re=Q+q;for(let fe=-q;fe<re;fe+=q)for(let de=-q;de<re;de+=q){const xe=de<0||de>Q||fe<0||fe>Q?24575:0,je=i.aA(Math.round(de),0,i.al),we=i.aA(Math.round(fe),0,i.al);L.emplaceBack(je+xe,we)}const ae=(fe,de)=>{const xe=de*X+fe;B.emplaceBack(xe+1,xe,xe+X),B.emplaceBack(xe+X,xe+X+1,xe+1)};for(let fe=1;fe<129;fe++)for(let de=1;de<129;de++)ae(de,fe);return[0,129].forEach(fe=>{for(let de=0;de<130;de++)ae(de,fe),ae(fe,de)}),[L,B,32768]}(),T=a.context;this.gridBuffer=T.createVertexBuffer(_,i.be.members),this.gridIndexBuffer=T.createIndexBuffer(y),this.gridSegments=i.bf.simpleSegment(0,0,_.length,y.length),this.gridNoSkirtSegments=i.bf.simpleSegment(0,0,_.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new by(d.map),this.orthoMatrix=i.bB(),i.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.al,0,i.al,0,1);const j=T.gl;this._overlapStencilMode=new Cn({func:j.GEQUAL,mask:255},0,255,j.KEEP,j.KEEP,j.REPLACE),this._previousZoom=a.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=d,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Nl(d.map),this._pendingGroundEffectLayers=[]}set style(a){a.on("data",this._onStyleDataEvent.bind(this)),this._style=a,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(a,d,_){if(a&&a.terrain){this._style!==a&&(this.style=a,this._evaluationZoom=void 0);const y=a.terrain.properties,b=a.terrain.drapeRenderMode===0,T=a.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=i.o.now();const j=a.terrain&&a.terrain.scope,N=y.get("source"),L=b?this._mockSourceCache:a.getSourceCache(N,j);if(!L)return void i.w(`Couldn't find terrain source "${N}".`);if(this.sourceCache=L,this._attenuationRange=a.terrain.getAttenuationRange(),this._exaggeration=T?this.calculateExaggeration(d):y.get("exaggeration"),!d.projection.requiresDraping&&T&&this._exaggeration===0)return void this._disable();this.enabled=!0;const B=()=>{this.sourceCache.used&&i.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const X=this.getScaledDemTileSize();this.sourceCache.update(d,X,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,B(),this._initializing=!0),B(),d.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(d),this._emptyDEMTextureDirty=!0,this._previousZoom=d.zoom}else this._disable()}calculateExaggeration(a){if(this._attenuationRange&&a.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(a.zoom);const d=this._previousCameraAltitude,_=a.getFreeCameraOptions().position.z/a.pixelsPerMeter*a.worldSize;this._previousCameraAltitude=_;const y=d!=null?_-d:Number.MAX_VALUE;if(Math.abs(y)<2)return this._exaggeration;const b=a.zoom,T=this._style.terrain;if(!this._previousUpdateTimestamp)return T.getExaggeration(b);let j=b-this._previousZoom;const N=this._previousUpdateTimestamp;let L=b;this._evaluationZoom!=null&&(L=this._evaluationZoom,Math.abs(b-L)>.5&&(j=.5*(b-L+j)),j*y<0&&(L+=j)),this._evaluationZoom=L;const B=T.getExaggeration(L),X=B===T.getExaggeration(Math.max(0,L-.1));if(X&&Math.abs(B-this._exaggeration)<.01)return B;let q=Math.min(.1,.00375*(this._updateTimestamp-N));return(X||B<.1||Math.abs(j)<1e-4)&&(q=Math.min(.2,4*q)),i.ak(this._exaggeration,B,q)}resetTileLookupCache(a){this._findCoveringTileCache[a]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(a){a.dataType==="source"&&a.coord?this._clearRenderCacheForTile(a.sourceCacheId,a.coord):a.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const a in this._style._mergedSourceCaches)this._style._mergedSourceCaches[a].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(a=>a.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const a=2*this.proxySourceCache.getSource().tileSize;return[a,a]}set useVertexMorphing(a){this._useVertexMorphing=a}updateTileBinding(a){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const d=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=_._centerAltitude===0&&this.getAtPointOrZero(i.ae.fromLngLat(_.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=d.getIds().map(N=>{const L=d.getTileByID(N).tileID;return L.projMatrix=_.calculateProjMatrix(L.toUnwrapped()),L});(function(N,L){const B=L.transform.pointCoordinate(L.transform.getCameraPoint()),X=new i.P(B.x,B.y);N.sort((q,Q)=>{if(Q.overscaledZ-q.overscaledZ)return Q.overscaledZ-q.overscaledZ;const re=new i.P(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),ae=new i.P(Q.canonical.x+(1<<Q.canonical.z)*Q.wrap,Q.canonical.y),fe=X.mult(1<<q.canonical.z);return fe.x-=.5,fe.y-=.5,fe.distSqr(re)-fe.distSqr(ae)})})(y,this.painter);const b=this.proxyToSource||{};this.proxyToSource={},y.forEach(N=>{this.proxyToSource[N.key]={}}),this.terrainTileForTile={};const T=this._style._mergedSourceCaches;for(const N in T){const L=T[N];if(!L.used||(L!==this.sourceCache&&this.resetTileLookupCache(L.id),this._setupProxiedCoordsForOrtho(L,a[N],b),L.usedForTerrain))continue;const B=a[N];L.getSource().reparseOverscaled&&this._assignTerrainTiles(B)}this.proxiedCoords[d.id]=y.map(N=>new sg(N,N.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1;const j={};this._visibleDemTiles=[];for(const N of this.proxyCoords){const L=this.terrainTileForTile[N.key];if(!L)continue;const B=L.tileID.key;B in j||(this._visibleDemTiles.push(L),j[B]=B)}}_assignTerrainTiles(a){this._initializing||a.forEach(d=>{if(this.terrainTileForTile[d.key])return;const _=this._findTileCoveringTileID(d,this.sourceCache);_&&(this.terrainTileForTile[d.key]=_)})}_prepareDEMTextures(){const a=this.painter.context,d=a.gl;for(const _ in this.terrainTileForTile){const y=this.terrainTileForTile[_],b=y.dem;!b||y.demTexture&&!y.needsDEMTextureUpload||(a.activeTexture.set(d.TEXTURE1),H_(this.painter,y,b))}}_prepareDemTileUniforms(a,d,_,y){if(!d||d.demTexture==null)return!1;const b=a.tileID.canonical,T=Math.pow(2,d.tileID.canonical.z-b.z),j=y||"";return _[`u_dem_tl${j}`]=[b.x*T%1,b.y*T%1],_[`u_dem_scale${j}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let a=0;const d=this._visibleDemTiles.reduce((_,y)=>{if(!y.dem)return _;const b=y.dem.tree.minimums[0];return b>0&&a++,_+b},0);return a?d/a:0}_updateEmptyDEMTexture(){const a=this.painter.context,d=a.gl;a.activeTexture.set(d.TEXTURE2);const _=this._getLoadedAreaMinimum(),y=new i.dK({width:1,height:1},new Float32Array([_]));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(y,{premultiply:!1}):b=this._emptyDEMTexture=new i.T(a,y,d.R32F,{premultiply:!1}),b}setupElevationDraw(a,d,_){const y=this.painter.context,b=y.gl,T={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};T.u_exaggeration=this.exaggeration();let j=null,N=null,L=1;if(_&&_.morphing&&this._useVertexMorphing){const Q=_.morphing.srcDemTile,re=_.morphing.dstDemTile;L=_.morphing.phase,Q&&re&&(this._prepareDemTileUniforms(a,Q,T,"_prev")&&(N=Q),this._prepareDemTileUniforms(a,re,T)&&(j=re))}const B=Q=>Q&&Q.demTexture&&this.painter.linearFloatFilteringSupported()?b.LINEAR:b.NEAREST;let X=null;var q;if(this.enabled?N&&j?(X=j.demTexture,y.activeTexture.set(b.TEXTURE4),N.demTexture.bind(B(N),b.CLAMP_TO_EDGE),T.u_dem_lerp=L):(j=this.terrainTileForTile[a.tileID.key],X=this._prepareDemTileUniforms(a,j,T)?j.demTexture:this.emptyDEMTexture):X=this.emptyDEMTexture,y.activeTexture.set(b.TEXTURE2),X&&(T.u_dem_size=(q=X).size[0]===1?1:q.size[0]-2,X.bind(B(j),b.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(_&&_.useDepthForOcclusion,d,T),_&&_.useMeterToDem&&j){const Q=(1<<j.tileID.canonical.z)*i.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=Q}if(_&&_.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),d.setTerrainUniformValues(y,T),this.painter.transform.projection.name==="globe"){const Q=this.globeUniformValues(this.painter.transform,a.tileID.canonical,_&&_.useDenormalizedUpVectorScale);d.setGlobeUniformValues(y,Q)}}globeUniformValues(a,d,_){const y=a.projection;return{u_tile_tl_up:y.upVector(d,0,0),u_tile_tr_up:y.upVector(d,i.al,0),u_tile_br_up:y.upVector(d,i.al,i.al),u_tile_bl_up:y.upVector(d,0,i.al),u_tile_up_scale:_?i.dL(1):y.upVectorScale(d,a.center.lat,a.worldSize).metersToTile}}renderToBackBuffer(a){const d=this.painter,_=this.painter.context;a.length!==0&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,d.width,d.height]),d.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(y,b,T,j,N){if(y.transform.projection.name==="globe")(function(L,B,X,q,Q){const re=L.context,ae=re.gl;let fe,de;const xe=L.transform,je=i.dD(L,re,xe),we=(bt,_t)=>{if(de===_t)return;const kt=[wy[_t],"PROJECTION_GLOBE_VIEW"];je&&kt.push("CUSTOM_ANTIALIASING");const nr=L.isTileAffectedByFog(bt);fe=L.getOrCreateProgram("globeRaster",{defines:kt,overrideFog:nr}),de=_t},Ve=L.colorModeForRenderPass(),Ne=new Rr(ae.LEQUAL,Rr.ReadWrite,L.depthRangeFor3D);jh.update(Q);const Ge=i.dE(xe),Be=[i.aF(xe.center.lng),i.aJ(xe.center.lat)],De=L.globeSharedBuffers,We=[xe.width*i.o.devicePixelRatio,xe.height*i.o.devicePixelRatio],st=Float32Array.from(xe.globeMatrix),rt={useDenormalizedUpVectorScale:!0};{const bt=L.transform,_t=S2(bt.zoom,B.exaggeration(),B.sourceCache._source.tileSize);de=-1;const kt=ae.TRIANGLES;for(const nr of q){const ht=X.getTile(nr),Ke=Cn.disabled,Pt=B.prevTerrainTileForTile[nr.key],xt=B.terrainTileForTile[nr.key];t0(Pt,xt)&&jh.newMorphing(nr.key,Pt,xt,Q,250),re.activeTexture.set(ae.TEXTURE0),ht.texture&&ht.texture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE);const qt=jh.getMorphValuesForProxy(nr.key),or=qt?1:0;qt&&Object.assign(rt,{morphing:{srcDemTile:qt.from,dstDemTile:qt.to,phase:i.dC(qt.phase)}});const Ar=i.dF(nr.canonical),tr=i.dG(Ar.getCenter().lat),sr=i.dH(nr.canonical,Ar,tr,bt.worldSize/bt._pixelsPerMercatorPixel),kr=i.bj(i.dI(nr.canonical)),yr=e0(bt.expandedFarZProjMatrix,st,Ge,kr,i.aj(bt.zoom),Be,bt.frustumCorners.TL,bt.frustumCorners.TR,bt.frustumCorners.BR,bt.frustumCorners.BL,bt.globeCenterInViewSpace,bt.globeRadius,We,_t,bt._farZ,sr);if(we(nr,or),fe&&(B.setupElevationDraw(ht,fe,rt),L.uploadCommonUniforms(re,fe,nr.toUnwrapped()),De)){const[gr,wr,on]=De.getGridBuffers(tr,_t!==0);fe.draw(L,kt,Ne,Ke,Ve,yn.backCCW,yr,"globe_raster",gr,wr,on)}}}if(De&&(L.renderDefaultNorthPole||L.renderDefaultSouthPole)){const bt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];je&&bt.push("CUSTOM_ANTIALIASING"),fe=L.getOrCreateProgram("globeRaster",{defines:bt});for(const _t of q){const{x:kt,y:nr,z:ht}=_t.canonical,Ke=nr===0,Pt=nr===(1<<ht)-1,[xt,qt,or,Ar]=De.getPoleBuffers(ht,!1);if(Ar&&(Ke||Pt)){const tr=X.getTile(_t);re.activeTexture.set(ae.TEXTURE0),tr.texture&&tr.texture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE);let sr=i.dJ(ht,kt,xe);const kr=i.bj(i.dI(_t.canonical)),yr=(gr,wr)=>gr.draw(L,ae.TRIANGLES,Ne,Cn.disabled,Ve,yn.disabled,e0(xe.expandedFarZProjMatrix,sr,sr,kr,0,Be,xe.frustumCorners.TL,xe.frustumCorners.TR,xe.frustumCorners.BR,xe.frustumCorners.BL,xe.globeCenterInViewSpace,xe.globeRadius,We,0,xe._farZ),"globe_pole_raster",wr,or,Ar);B.setupElevationDraw(tr,fe,rt),L.uploadCommonUniforms(re,fe,_t.toUnwrapped()),Ke&&L.renderDefaultNorthPole&&yr(fe,xt),Pt&&L.renderDefaultSouthPole&&(sr=i.cR(i.bB(),sr,[1,-1,1]),yr(fe,qt))}}}})(y,b,T,j,N);else{const L=y.context,B=L.gl;let X,q;const Q=y.shadowRenderer,re=Bu(y,y.longestCutoffRange),ae=Ve=>{if(q===Ve)return;const Ne=[];Ne.push(wy[Ve]),re.shouldRenderCutoff&&Ne.push("RENDER_CUTOFF"),Q&&(Ne.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Q.useNormalOffset&&Ne.push("NORMAL_OFFSET")),X=y.getOrCreateProgram("terrainRaster",{defines:Ne}),q=Ve},fe=y.colorModeForRenderPass(),de=new Rr(B.LEQUAL,Rr.ReadWrite,y.depthRangeFor3D);jh.update(N);const xe=y.transform,je=S2(xe.zoom,b.exaggeration(),b.sourceCache._source.tileSize);let we=[0,0,0];if(Q){const Ve=y.style.directionalLight,Ne=y.style.ambientLight;Ve&&Ne&&(we=ac(y.style,Ve,Ne))}{q=-1;const Ve=B.TRIANGLES,[Ne,Ge]=[b.gridIndexBuffer,b.gridSegments];for(const Be of j){const De=T.getTile(Be),We=Cn.disabled,st=b.prevTerrainTileForTile[Be.key],rt=b.terrainTileForTile[Be.key];t0(st,rt)&&jh.newMorphing(Be.key,st,rt,N,250),L.activeTexture.set(B.TEXTURE0),De.texture&&De.texture.bind(B.LINEAR,B.CLAMP_TO_EDGE);const bt=jh.getMorphValuesForProxy(Be.key),_t=bt?1:0;let kt;bt&&(kt={morphing:{srcDemTile:bt.from,dstDemTile:bt.to,phase:i.dC(bt.phase)}});const nr=yy(Be.projMatrix,ig(Be.canonical,xe.renderWorldCopies)?je/10:je,we);if(ae(_t),!X)continue;b.setupElevationDraw(De,X,kt);const ht=Be.toUnwrapped();Q&&Q.setupShadows(ht,X),y.uploadCommonUniforms(L,X,ht,null,re),X.draw(y,Ve,de,We,fe,yn.backCCW,nr,"terrain_raster",b.gridBuffer,Ne,Ge)}}}}(d,this,this.proxySourceCache,a,this._updateTimestamp),this.renderingToTexture=!0,d.gpuTimingDeferredRenderEnd(),a.splice(0,a.length))}renderBatch(a){if(this._drapedRenderBatches.length===0)return a+1;this.renderingToTexture=!0;const d=this.painter,_=this.painter.context,y=this.proxySourceCache,b=this.proxiedCoords[y.id],T=this._drapedRenderBatches.shift(),j=d.style.order,N=[];let L=0;for(const B of b){const X=y.getTileByID(B.proxyTileKey),q=y.proxyCachedFBO[B.key]?y.proxyCachedFBO[B.key][a]:void 0,Q=q!==void 0?y.renderCache[q]:this.pool[L++],re=q!==void 0;if(X.texture=Q.tex,re&&!Q.dirty){N.push(X.tileID);continue}let ae;_.bindFramebuffer.set(Q.fb.framebuffer),this.renderedToTile=!1,Q.dirty&&(_.clear({color:i.ao.transparent,stencil:0}),Q.dirty=!1);for(let fe=T.start;fe<=T.end;++fe){const de=d.style._mergedLayers[j[fe]];if(de.isHidden(d.transform.zoom))continue;const xe=d.style.getLayerSourceCache(de),je=xe?this.proxyToSource[B.key][xe.id]:[B];if(!je)continue;const we=je;_.viewport.set([0,0,Q.fb.width,Q.fb.height]),ae!==(xe?xe.id:null)&&(this._setupStencil(Q,je,de,xe),ae=xe?xe.id:null),d.renderLayer(d,xe,de,we)}if(this._drapedRenderBatches.length===0)for(const fe of this._pendingGroundEffectLayers){const de=d.style._mergedLayers[j[fe]];if(de.isHidden(d.transform.zoom))continue;const xe=d.style.getLayerSourceCache(de),je=xe?this.proxyToSource[B.key][xe.id]:[B];if(!je)continue;const we=je;_.viewport.set([0,0,Q.fb.width,Q.fb.height]),ae!==(xe?xe.id:null)&&(this._setupStencil(Q,je,de,xe),ae=xe?xe.id:null),d.renderLayer(d,xe,de,we)}this.renderedToTile?(Q.dirty=!0,N.push(X.tileID)):re||--L,L===5&&(L=0,this.renderToBackBuffer(N))}return this.renderToBackBuffer(N),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,d.width,d.height]),T.end+1}postRender(){}isLayerOrderingCorrect(a){const d=a.order.length;let _=-1,y=d;for(let b=0;b<d;++b)this._style.isLayerDraped(a._mergedLayers[a.order[b]])?_=Math.max(_,b):y=Math.min(y,b);return y>_}getMinElevationBelowMSL(){let a=0;return this._visibleDemTiles.filter(d=>d.dem).forEach(d=>{a=Math.min(a,d.dem.tree.minimums[0])}),a===0?a:(a-30)*this._exaggeration}raycast(a,d,_){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const T=b.tileID,j=1<<T.overscaledZ,{x:N,y:L}=T.canonical,B=N/j,X=(N+1)/j,q=L/j,Q=(L+1)/j;return{minx:B,miny:q,maxx:X,maxy:Q,t:b.dem.tree.raycastRoot(B,q,X,Q,a,d,_),tile:b}});y.sort((b,T)=>(b.t!==null?b.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE));for(const b of y){if(b.t==null)return null;const T=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,a,d,_);if(T!=null)return T}return null}_createFBO(){const a=this.painter.context,d=a.gl,_=this.drapeBufferSize;a.activeTexture.set(d.TEXTURE0);const y=new i.T(a,{width:_[0],height:_[1],data:null},d.RGBA8);y.bind(d.LINEAR,d.CLAMP_TO_EDGE);const b=a.createFramebuffer(_[0],_[1],!0,null);return b.colorAttachment.set(y.texture),b.depthAttachment=new vy(a,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=a.createRenderbuffer(a.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),a.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),a.extTextureFilterAnisotropic&&d.texParameterf(d.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax),{fb:b,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const a in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[a].hasTransition())return!0;return this._style.order.some(a=>{const d=this._style._mergedLayers[a],_=d.isHidden(this.painter.transform.zoom);return d.type==="hillshade"||d.type==="custom"?!_&&d.shouldRedrape():!_&&d.hasTransition()})}_clearLineLayersFromRenderCache(){let a=!1;for(const _ of this._style.getSources())if(_ instanceof ro){a=!0;break}if(!a)return;const d={};for(let _=0;_<this._style.order.length;++_){const y=this._style._mergedLayers[this._style.order[_]],b=this._style.getLayerSourceCache(y);if(b&&!d[b.id]&&!y.isHidden(this.painter.transform.zoom)&&y.type==="line"&&y.widthExpression()instanceof i.ad){d[b.id]=!0;for(const T of this.proxyCoords){const j=this.proxyToSource[T.key][b.id];if(j)for(const N of j)this._clearRenderCacheForTile(b.id,N)}}}}_clearRasterLayersFromRenderCache(){let a=!1;for(const _ in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[_]._source instanceof Ko){a=!0;break}if(!a)return;const d={};for(let _=0;_<this._style.order.length;++_){const y=this._style._mergedLayers[this._style.order[_]],b=this._style.getLayerSourceCache(y);if(!b||d[b.id]||y.isHidden(this.painter.transform.zoom)||y.type!=="raster")continue;const T=y.paint.get("raster-fade-duration");for(const j of this.proxyCoords){const N=this.proxyToSource[j.key][b.id];if(N)for(const L of N){const B=r0(b.getTile(L),b.findLoadedParent(L,0),b,this.painter.transform,T);(B.opacity!==1||B.mix!==0)&&this._clearRenderCacheForTile(b.id,L)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const a=this._style.order,d=a.length;if(d===0)return;const _=[];this._pendingGroundEffectLayers=[];let y,b=0,T=this._style._mergedLayers[a[b]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++b<d;)T=this._style._mergedLayers[a[b]];for(;b<d;++b){const j=this._style._mergedLayers[a[b]];j.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(j)?y===void 0&&(y=b):(j.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(b),y!==void 0&&(_.push({start:y,end:b-1}),y=void 0)))}if(y!==void 0&&_.push({start:y,end:b-1}),_.length!==0){const j=_[_.length-1];this._pendingGroundEffectLayers.every(N=>N>j.end)||i.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=_}_setupRenderCache(a){const d=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,d.renderCache.length>d.renderCachePool.length){const T=Object.values(d.proxyCachedFBO);d.proxyCachedFBO={};for(let j=0;j<T.length;++j){const N=Object.values(T[j]);d.renderCachePool.push(...N)}}return}this._clearRasterLayersFromRenderCache();const _=this.proxyCoords,y=this._tilesDirty;for(let T=_.length-1;T>=0;T--){const j=_[T];if(d.getTileByID(j.key),d.proxyCachedFBO[j.key]!==void 0){const N=a[j.key],L=this.proxyToSource[j.key];let B=0;for(const X in L){const q=L[X],Q=N[X];if(!Q||Q.length!==q.length||q.some((re,ae)=>re!==Q[ae]||y[X]&&y[X].hasOwnProperty(re.key))){B=-1;break}++B}for(const X in d.proxyCachedFBO[j.key])d.renderCache[d.proxyCachedFBO[j.key][X]].dirty=B<0||B!==Object.values(N).length}}const b=[...this._drapedRenderBatches];b.sort((T,j)=>j.end-j.start-(T.end-T.start));for(const T of b)for(const j of _){if(d.proxyCachedFBO[j.key])continue;let N=d.renderCachePool.pop();N===void 0&&d.renderCache.length<50&&(N=d.renderCache.length,d.renderCache.push(this._createFBO())),N!==void 0&&(d.proxyCachedFBO[j.key]={},d.proxyCachedFBO[j.key][T.start]=N,d.renderCache[N].dirty=!0)}this._tilesDirty={}}_setupStencil(a,d,_,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,T=b.gl;if(d.length<=1)return void(this._overlapStencilType=!1);let j;if(_.isTileClipped())j=d.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(d[0].overscaledZ>d[d.length-1].overscaledZ))return void(this._overlapStencilType=!1);j=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+j>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=j,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(d,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(a){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[a.key]),this._overlapStencilMode):Cn.disabled}_renderTileClippingMasks(a,d){const _=this.painter,y=this.painter.context,b=y.gl;_._tileClippingMaskIDs={},y.setColorMode(Vn.disabled),y.setDepthMode(Rr.disabled);const T=_.getOrCreateProgram("clippingMask");for(const j of a){const N=_._tileClippingMaskIDs[j.key]=--d;T.draw(_,b.TRIANGLES,Rr.disabled,new Cn({func:b.ALWAYS,mask:0},N,255,b.KEEP,b.KEEP,b.REPLACE),Vn.disabled,yn.disabled,Ih(j.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(a){const d=this.painter.transform;if(a.x<0||a.x>d.width||a.y<0||a.y>d.height)return null;const _=[a.x,a.y,1,1];i.aC(_,_,d.pixelMatrixInverse),i.cJ(_,_,1/_[3]),_[0]/=d.worldSize,_[1]/=d.worldSize;const y=d._camera.position,b=i.ce(1,d.center.lat),T=[y[0],y[1],y[2]/b,0],j=i.d9([],_.slice(0,3),T);i.aw(j,j);const N=this.raycast(T,j,this._exaggeration);return N!==null&&N?(i.bG(T,T,j,N),T[3]=T[2],T[2]*=b,T):null}_setupProxiedCoordsForOrtho(a,d,_){if(a.getSource()instanceof i.aT)return this._setupProxiedCoordsForImageSource(a,d,_);this._findCoveringTileCache[a.id]=this._findCoveringTileCache[a.id]||{};const y=this.proxiedCoords[a.id]=[],b=this.proxyCoords;for(let N=0;N<b.length;N++){const L=b[N],B=this._findTileCoveringTileID(L,a);if(B){const X=this._createProxiedId(L,B,_[L.key]&&_[L.key][a.id]);y.push(X),this.proxyToSource[L.key][a.id]=[X]}}let T=!1;const j=new Set;for(let N=0;N<d.length;N++){const L=a.getTile(d[N]);if(!L||!L.hasData())continue;const B=this._findTileCoveringTileID(L.tileID,this.proxySourceCache);if(B&&B.tileID.canonical.z!==L.tileID.canonical.z){const X=this.proxyToSource[B.tileID.key][a.id],q=this._createProxiedId(B.tileID,L,_[B.tileID.key]&&_[B.tileID.key][a.id]);X?X.splice(X.length-1,0,q):this.proxyToSource[B.tileID.key][a.id]=[q];const Q=this.proxyToSource[B.tileID.key][a.id];j.has(Q)||j.add(Q),y.push(q),T=!0}}if(this._sourceTilesOverlap[a.id]=T,T&&this._debugParams.sortTilesHiZFirst)for(const N of j)N.sort((L,B)=>B.overscaledZ-L.overscaledZ)}_setupProxiedCoordsForImageSource(a,d,_){if(!a.getSource().loaded())return;const y=this.proxiedCoords[a.id]=[],b=this.proxyCoords,T=a.getSource(),j=T.tileID;if(!j)return;const N=new i.P(j.x,j.y)._div(1<<j.z),L=T.coordinates.map(i.ae.fromLngLat).reduce((X,q)=>(X.min.x=Math.min(X.min.x,q.x-N.x),X.min.y=Math.min(X.min.y,q.y-N.y),X.max.x=Math.max(X.max.x,q.x-N.x),X.max.y=Math.max(X.max.y,q.y-N.y),X),{min:new i.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),B=(X,q)=>{const Q=X.wrap+X.canonical.x/(1<<X.canonical.z),re=X.canonical.y/(1<<X.canonical.z),ae=i.al/(1<<X.canonical.z),fe=q.wrap+q.canonical.x/(1<<q.canonical.z),de=q.canonical.y/(1<<q.canonical.z);return Q+ae<fe+L.min.x||Q>fe+L.max.x||re+ae<de+L.min.y||re>de+L.max.y};for(let X=0;X<b.length;X++){const q=b[X];for(let Q=0;Q<d.length;Q++){const re=a.getTile(d[Q]);if(!re||!re.hasData()||B(q,re.tileID))continue;const ae=this._createProxiedId(q,re,_[q.key]&&_[q.key][a.id]),fe=this.proxyToSource[q.key][a.id];fe?fe.push(ae):this.proxyToSource[q.key][a.id]=[ae],y.push(ae)}}}_createProxiedId(a,d,_){let y=this.orthoMatrix;if(_){const b=_.find(T=>T.key===d.tileID.key);if(b)return b}if(d.tileID.key!==a.key){const b=a.canonical.z-d.tileID.canonical.z;let T,j,N;y=i.bB();const L=d.tileID.wrap-a.wrap<<a.overscaledZ;b>0?(T=i.al>>b,j=T*((d.tileID.canonical.x<<b)-a.canonical.x+L),N=T*((d.tileID.canonical.y<<b)-a.canonical.y)):(T=i.al<<-b,j=i.al*(d.tileID.canonical.x-(a.canonical.x+L<<-b)),N=i.al*(d.tileID.canonical.y-(a.canonical.y<<-b))),i.cd(y,0,T,0,T,0,1),i.bq(y,y,[j,N,0])}return new sg(d.tileID,a.key,y)}_findTileCoveringTileID(a,d){let _=d.getTile(a);if(_&&_.hasData())return _;const y=this._findCoveringTileCache[d.id],b=y[a.key];if(_=b?d.getTileByID(b):null,_&&_.hasData()||b===null)return _;let T=_?_.tileID:a,j=T.overscaledZ;const N=d.getSource().minzoom,L=[];if(!b){const X=d.getSource().maxzoom;if(a.canonical.z>=X){const q=a.canonical.z-X;d.getSource().reparseOverscaled?(j=Math.max(a.canonical.z+2,d.transform.tileZoom),T=new i.aP(j,a.wrap,X,a.canonical.x>>q,a.canonical.y>>q)):q!==0&&(j=X,T=new i.aP(j,a.wrap,X,a.canonical.x>>q,a.canonical.y>>q))}T.key!==a.key&&(L.push(T.key),_=d.getTile(T))}const B=X=>{L.forEach(q=>{y[q]=X}),L.length=0};for(j-=1;j>=N&&(!_||!_.hasData());j--){_&&B(_.tileID.key);const X=T.calculateScaledKey(j);if(_=d.getTileByID(X),_&&_.hasData())break;const q=y[X];if(q===null)break;q===void 0?L.push(X):_=d.getTileByID(q)}return B(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(a){return this.enabled?this._findTileCoveringTileID(a,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(a,d){let _=this._tilesDirty[a];_||(_=this._tilesDirty[a]={}),_[d.key]=!0}}function Sy(g,a,d){const _=function(j,N,L){const B=i.bI(N,j),X=i.bI(L,[.2126,.7152,.0722]),q=(re,ae,fe)=>(1-fe)*re+fe*ae,Q=q(1-.3*Math.min(X,1),1,Math.min(B+1,1));return q(.92,1,Math.asin(i.aA(N[2],-1,1))/Math.PI+.5)*Q}(g,[0,0,1],a),y=[0,0,0];i.c4(y,d.slice(0,3),_);const b=[0,0,0];i.c4(b,a.slice(0,3),g[2]);const T=[0,0,0];return i.d7(T,y,b),i.da(T)}const Ty=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Ey=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class og{static cacheKey(a,d,_,y){let b=`${d}${y?y.cacheKey:""}`;for(const T of _)a.usedDefines.includes(T)&&(b+=`/${T}`);return b}constructor(a,d,_,y,b,T){const j=a.gl;this.program=j.createProgram(),this.configuration=y,this.name=d,this.fixedDefines=[...T];let N=y?y.defines():[];N=N.concat(T.map(re=>`#define ${re}`));const L=`#version 300 es
`;let B=L+N.concat("precision mediump float;",cu,tg.fragmentSource).join(`
`);for(const re of _.fragmentIncludes)B+=`
${Lf[re]}`;B+=`
${_.fragmentSource}`;let X=L+N.concat("precision highp float;",cu,tg.vertexSource).join(`
`);for(const re of _.vertexIncludes)X+=`
${Lf[re]}`;this.forceManualRenderingForInstanceIDShaders=a.forceManualRenderingForInstanceIDShaders&&_.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(X+=`
uniform int u_instanceID;
`),X+=`
${_.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(X=X.replaceAll("gl_InstanceID","u_instanceID"));const q=j.createShader(j.FRAGMENT_SHADER);if(j.isContextLost())return void(this.failedToCreate=!0);j.shaderSource(q,B),j.compileShader(q),j.attachShader(this.program,q);const Q=j.createShader(j.VERTEX_SHADER);j.isContextLost()?this.failedToCreate=!0:(j.shaderSource(Q,X),j.compileShader(Q),j.attachShader(this.program,Q),this.attributes={},j.linkProgram(this.program),j.deleteShader(Q),j.deleteShader(q),this.fixedUniforms=b(a),this.binderUniforms=y?y.getUniforms(a):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(re=>({u_instanceID:new i.cg(re)}))(a)),(T.includes("TERRAIN")||d.indexOf("symbol")!==-1||d.indexOf("circle")!==-1)&&(this.terrainUniforms=(re=>({u_dem:new i.cg(re),u_dem_prev:new i.cg(re),u_dem_tl:new i.cj(re),u_dem_scale:new i.ci(re),u_dem_tl_prev:new i.cj(re),u_dem_scale_prev:new i.ci(re),u_dem_size:new i.ci(re),u_dem_lerp:new i.ci(re),u_exaggeration:new i.ci(re),u_depth:new i.cg(re),u_depth_size_inv:new i.cj(re),u_depth_range_unpack:new i.cj(re),u_occluder_half_size:new i.ci(re),u_occlusion_depth_offset:new i.ci(re),u_meter_to_dem:new i.ci(re),u_label_plane_matrix_inv:new i.ck(re)}))(a)),T.includes("GLOBE")&&(this.globeUniforms=(re=>({u_tile_tl_up:new i.ch(re),u_tile_tr_up:new i.ch(re),u_tile_br_up:new i.ch(re),u_tile_bl_up:new i.ch(re),u_tile_up_scale:new i.ci(re)}))(a)),T.includes("FOG")&&(this.fogUniforms=(re=>({u_fog_matrix:new i.ck(re),u_fog_range:new i.cj(re),u_fog_color:new i.d2(re),u_fog_horizon_blend:new i.ci(re),u_fog_vertical_limit:new i.cj(re),u_fog_temporal_offset:new i.ci(re),u_frustum_tl:new i.ch(re),u_frustum_tr:new i.ch(re),u_frustum_br:new i.ch(re),u_frustum_bl:new i.ch(re),u_globe_pos:new i.ch(re),u_globe_radius:new i.ci(re),u_globe_transition:new i.ci(re),u_is_globe:new i.cg(re),u_viewport:new i.cj(re)}))(a)),T.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(re=>({u_cutoff_params:new i.d2(re)}))(a)),T.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(re=>({u_lighting_ambient_color:new i.ch(re),u_lighting_directional_dir:new i.ch(re),u_lighting_directional_color:new i.ch(re),u_ground_radiance:new i.ch(re)}))(a)),T.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(re=>({u_light_matrix_0:new i.ck(re),u_light_matrix_1:new i.ck(re),u_fade_range:new i.cj(re),u_shadow_normal_offset:new i.ch(re),u_shadow_intensity:new i.ci(re),u_shadow_texel_size:new i.ci(re),u_shadow_map_resolution:new i.ci(re),u_shadow_direction:new i.ch(re),u_shadow_bias:new i.ch(re),u_shadowmap_0:new i.cg(re),u_shadowmap_1:new i.cg(re)}))(a)))}getAttributeLocation(a,d){let _=this.attributes[d];return _===void 0&&(_=this.attributes[d]=a.getAttribLocation(this.program,d)),_}setTerrainUniformValues(a,d){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const y in d)_[y]&&_[y].set(this.program,y,d[y])}}setGlobeUniformValues(a,d){if(!this.globeUniforms)return;const _=this.globeUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const y in d)_[y]&&_[y].set(this.program,y,d[y])}}setFogUniformValues(a,d){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const y in d)_[y].set(this.program,y,d[y])}}setCutoffUniformValues(a,d){if(!this.cutoffUniforms)return;const _=this.cutoffUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const y in d)_[y].set(this.program,y,d[y])}}setLightsUniformValues(a,d){if(!this.lightsUniforms)return;const _=this.lightsUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const y in d)_[y].set(this.program,y,d[y])}}setShadowUniformValues(a,d){if(this.failedToCreate||!this.shadowUniforms)return;const _=this.shadowUniforms;a.program.set(this.program);for(const y in d)_[y].set(this.program,y,d[y])}_drawDebugWireframe(a,d,_,y,b,T,j,N,L,B){const X=a.options.wireframe;if(X.terrain===!1&&X.layers2D===!1&&X.layers3D===!1)return;const q=a.context;if(!(!(!X.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!X.layers2D||a._terrain&&a._terrain.renderingToTexture||!Ty.includes(this.name))||!(!X.layers3D||!Ey.includes(this.name))))return;const Q=q.gl,re=a.wireframeDebugCache.getLinesFromTrianglesBuffer(a.frameCounter,b,q);if(!re)return;const ae=[...this.fixedDefines];ae.push("DEBUG_WIREFRAME");const fe=a.getOrCreateProgram(this.name,{config:this.configuration,defines:ae});q.program.set(fe.program);const de=(we,Ve,Ne)=>{if(Ve[we]&&Ne[we])for(const Ge in Ve[we])Ne[we][Ge]&&Ne[we][Ge].set(Ne.program,Ge,Ve[we][Ge].current)};L&&L.setUniforms(fe.program,q,fe.binderUniforms,j,{zoom:N}),de("fixedUniforms",this,fe),de("terrainUniforms",this,fe),de("globeUniforms",this,fe),de("fogUniforms",this,fe),de("lightsUniforms",this,fe),de("shadowUniforms",this,fe),re.bind(),q.setColorMode(new Vn([Q.ONE,Q.ONE_MINUS_SRC_ALPHA,Q.ZERO,Q.ONE],i.ao.transparent,[!0,!0,!0,!1])),q.setDepthMode(new Rr(d.func===Q.LESS?Q.LEQUAL:d.func,Rr.ReadOnly,d.range)),q.setStencilMode(Cn.disabled);const xe=3*T.primitiveLength*2,je=3*T.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const we=B||1;for(let Ve=0;Ve<we;++Ve)fe.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ve),Q.drawElements(Q.LINES,xe,Q.UNSIGNED_SHORT,je)}else B&&B>1?Q.drawElementsInstanced(Q.LINES,xe,Q.UNSIGNED_SHORT,je,B):Q.drawElements(Q.LINES,xe,Q.UNSIGNED_SHORT,je);b.bind(),q.program.set(this.program),q.setDepthMode(d),q.setStencilMode(_),q.setColorMode(y)}checkUniforms(a,d,_){if(this.fixedDefines.includes(d)){for(const y of Object.keys(_))if(!_[y].initialized)throw new Error(`Program '${this.name}', from draw '${a}': uniform ${y} not set but required by ${d} being defined`)}}draw(a,d,_,y,b,T,j,N,L,B,X,q,Q,re,ae,fe){const de=a.context,xe=de.gl;if(this.failedToCreate)return;de.program.set(this.program),de.setDepthMode(_),de.setStencilMode(y),de.setColorMode(b),de.setCullFace(T);for(const Ve of Object.keys(this.fixedUniforms))this.fixedUniforms[Ve].set(this.program,Ve,j[Ve]);re&&re.setUniforms(this.program,de,this.binderUniforms,q,{zoom:Q});const je={[xe.POINTS]:1,[xe.LINES]:2,[xe.TRIANGLES]:3,[xe.LINE_STRIP]:1}[d];this.checkUniforms(N,"RENDER_SHADOWS",this.shadowUniforms);const we=fe&&fe>0?1:void 0;for(const Ve of X.get()){const Ne=Ve.vaos||(Ve.vaos={});if((Ne[N]||(Ne[N]=new zf)).bind(de,this,L,re?re.getPaintVertexBuffers():[],B,Ve.vertexOffset,ae||[],we),this.forceManualRenderingForInstanceIDShaders){const Ge=fe||1;for(let Be=0;Be<Ge;++Be)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Be),B?xe.drawElements(d,Ve.primitiveLength*je,xe.UNSIGNED_SHORT,Ve.primitiveOffset*je*2):xe.drawArrays(d,Ve.vertexOffset,Ve.vertexLength)}else fe&&fe>1?xe.drawElementsInstanced(d,Ve.primitiveLength*je,xe.UNSIGNED_SHORT,Ve.primitiveOffset*je*2,fe):B?xe.drawElements(d,Ve.primitiveLength*je,xe.UNSIGNED_SHORT,Ve.primitiveOffset*je*2):xe.drawArrays(d,Ve.vertexOffset,Ve.vertexLength);d===xe.TRIANGLES&&B&&this._drawDebugWireframe(a,_,y,b,B,Ve,q,Q,re,fe)}}}function n0(g,a,d=0){const _=Math.pow(2,a.tileID.overscaledZ),y=a.tileSize*Math.pow(2,g.transform.tileZoom)/_,b=y*(a.tileID.canonical.x+a.tileID.wrap*_),T=y*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture?a.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/i.ay(a,1,g.transform.tileZoom),u_pixel_coord_upper:[b>>16,T>>16],u_pixel_coord_lower:[65535&b,65535&T],u_pattern_transition:d}}const qf={terrain:0,flat:1},i0=i.bB(),s0=(g,a,d,_,y,b,T,j,N,L,B,X,q,Q,re,ae,fe,de)=>{const xe=a.style.light,je=xe.properties.get("position"),we=[je.x,je.y,je.z],Ve=i.dN();xe.properties.get("anchor")==="viewport"&&(i.dO(Ve,-a.transform.angle),i.dP(we,we,Ve));const Ne=xe.properties.get("color").toPremultipliedRenderColor(null),Ge=a.transform,Be={u_matrix:g,u_lightpos:we,u_lightintensity:xe.properties.get("intensity"),u_lightcolor:[Ne.r,Ne.g,Ne.b],u_vertical_gradient:+d,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:i0,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:qf[L],u_base_type:qf[B],u_ao:y,u_edge_radius:b,u_width_scale:T,u_flood_light_color:re,u_vertical_scale:ae,u_flood_light_intensity:fe,u_ground_shadow_factor:de};return Ge.projection.name==="globe"&&(Be.u_tile_id=[j.canonical.x,j.canonical.y,1<<j.canonical.z],Be.u_zoom_transition=X,Be.u_inv_rot_matrix=Q,Be.u_merc_center=q,Be.u_up_dir=Ge.projection.upVector(new i.cC(0,0,0),q[0]*i.al,q[1]*i.al),Be.u_height_lift=N),Be},T2=(g,a,d,_,y,b)=>({u_matrix:g,u_edge_radius:a,u_width_scale:d,u_vertical_scale:_,u_height_type:qf[y],u_base_type:qf[b]}),E2=(g,a,d,_,y,b,T,j,N,L,B,X,q,Q,re,ae,fe,de)=>{const xe=s0(g,a,d,_,y,b,T,j,L,B,X,q,Q,re,ae,fe,1,[0,0,0]),je={u_height_factor:-Math.pow(2,j.overscaledZ)/N.tileSize/8};return Object.assign(xe,n0(a,N,de),je)},Gf=(g,a,d,_,y,b,T,j,N,L,B)=>({u_matrix:a,u_opacity:d,u_ao_pass:_?1:0,u_meter_to_tile:y,u_ao:b,u_flood_light_intensity:T,u_flood_light_color:j,u_attenuation:N,u_edge_radius:L,u_fb:0,u_fb_size:B,u_dynamic_offset:1}),C2=(g,a,d)=>({u_matrix:g,u_emissive_strength:a,u_ground_shadow_factor:d}),A2=(g,a,d,_,y,b=0)=>Object.assign(C2(g,a,y),n0(d,_,b)),XA=(g,a,d,_)=>({u_matrix:g,u_world:d,u_emissive_strength:a,u_ground_shadow_factor:_}),YA=(g,a,d,_,y,b,T=0)=>Object.assign(A2(g,a,d,_,b,T),{u_world:y}),KA=(g,a)=>({u_matrix:g,u_ground_shadow_factor:a}),a0=(g,a,d,_,y)=>({u_matrix:g,u_camera_pos:[a[0],a[1],a[2]],u_depth_bias:d,u_height_scale:_,u_reset_depth:y}),Cy=(g,a,d,_,y,b,T,j,N)=>({u_matrix:g,u_normal_matrix:a,u_opacity:d,u_faux_facade_ao_intensity:_,u_camera_pos:y,u_tile_to_meter:b,u_facade_emissive_chance:T,u_flood_light_color:j,u_flood_light_intensity:N}),Ay=g=>({u_matrix:g}),j2=g=>({u_matrix:g}),Wf=(g,a,d,_,y,b,T,j)=>{const N=i.al/b.tileSize;return{u_matrix:g,u_inv_rot_matrix:a,u_camera_to_center_distance:d.getCameraToCenterDistance(j),u_extrude_scale:[d.pixelsToGLUnits[0]/N,d.pixelsToGLUnits[1]/N],u_zoom_transition:_,u_tile_id:T,u_merc_center:y}},jy=(g,a,d=1)=>({u_matrix:g,u_color:a,u_overlay:0,u_overlay_scale:d}),I2=i.bB(),N2=(g,a,d,_,y,b,T)=>{const j=g.transform,N=j.projection.name==="globe",L=N?i.dQ(j.zoom,a.canonical)*j._pixelsPerMercatorPixel:i.ay(d,1,b),B={u_matrix:a.projMatrix,u_extrude_scale:L,u_intensity:T,u_inv_rot_matrix:I2,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(N){B.u_inv_rot_matrix=_,B.u_merc_center=y,B.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],B.u_zoom_transition=i.aj(j.zoom);const X=y[0]*i.al,q=y[1]*i.al;B.u_up_dir=j.projection.upVector(new i.cC(0,0,0),X,q)}return B};function o0(g,[a,d,_,y],[b,T]){if(b===T)return[0,0,0,0];const j=255*(g-1)/(g*(T-b));return[a*j,d*j,_*j,y*j]}function Uu(g,a,[d,_]){return d===_?0:.5/g+(a-d)*(g-1)/(g*(_-d))}const lg=(g,a,d,_,y,b,T,j,N,L,B,X,q,Q,re,ae,fe,de,xe,je,we)=>({u_matrix:g,u_normalize_matrix:a,u_globe_matrix:d,u_merc_matrix:_,u_grid_matrix:y,u_tl_parent:b,u_scale_parent:L,u_fade_t:B.mix,u_opacity:B.opacity*X.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:X.paint.get("raster-brightness-min"),u_brightness_high:X.paint.get("raster-brightness-max"),u_saturation_factor:i.dS(X.paint.get("raster-saturation")),u_contrast_factor:i.dR(X.paint.get("raster-contrast")),u_spin_weights:l0(X.paint.get("raster-hue-rotate")),u_perspective_transform:q,u_raster_elevation:Q,u_zoom_transition:T,u_merc_center:j,u_cutoff_params:N,u_colorization_mix:o0(i.dT,ae,de),u_colorization_offset:Uu(i.dT,fe,de),u_color_ramp:re,u_texture_offset:[je/(xe+2*je),xe/(xe+2*je)],u_texture_res:[xe+2*je,xe+2*je],u_emissive_strength:we});function l0(g){g*=Math.PI/180;const a=Math.sin(g),d=Math.cos(g);return[(2*d+1)/3,(-Math.sqrt(3)*a-d+1)/3,(Math.sqrt(3)*a-d+1)/3]}const Nh=.05,Md=(g,a,d,_,y,b,T,j,N,L,B,X)=>({u_matrix:g,u_normalize_matrix:a,u_globe_matrix:d,u_merc_matrix:_,u_grid_matrix:y,u_tl_parent:b,u_scale_parent:L,u_fade_t:B.mix,u_opacity:B.opacity,u_image0:0,u_image1:1,u_raster_elevation:X,u_zoom_transition:T,u_merc_center:j,u_cutoff_params:N}),Iy=(g,a,d,_,y,b,T,j,N,L)=>({u_particle_texture:g,u_particle_texture_side_len:a,u_tile_offset:d,u_velocity:_,u_color_ramp:b,u_velocity_res:y,u_max_speed:T,u_uv_offset:j,u_data_scale:[255*N[0],255*N[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[Nh,Nh]}),c0=(g,a,d,_,y,b,T,j,N,L)=>({u_particle_texture:g,u_particle_texture_side_len:a,u_velocity:d,u_velocity_res:_,u_max_speed:y,u_speed_factor:b,u_reset_rate:T,u_rand_seed:Math.random(),u_uv_offset:j,u_data_scale:[255*N[0],255*N[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[Nh,Nh]}),Ny=i.bB(),ky=(g,a,d,_,y,b,T,j,N,L,B,X,q,Q,re,ae,fe,de,xe,je,we,Ve,Ne,Ge)=>{const Be=y.transform,De={u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:Be.getCameraToCenterDistance(xe),u_rotate_symbol:+d,u_aspect_ratio:Be.width/Be.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:T,u_coord_matrix:j,u_is_text:+L,u_elevation_from_sea:N?1:0,u_pitch_with_map:+_,u_texsize:B,u_texsize_icon:X,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ny,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Ny,u_up_vector:[0,-1,0],u_color_adj_mat:Ve,u_icon_transition:Ne||0,u_gamma_scale:_?y.transform.getCameraToCenterDistance(xe)*Math.cos(y.terrain?0:y.transform._pitch):1,u_device_pixel_ratio:i.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Ge||1,u_ground_shadow_factor:je,u_inv_matrix:i.bk(i.bB(),T),u_normal_scale:we,u_lutTexture:so.LUT};return xe.name==="globe"&&(De.u_tile_id=[Q.canonical.x,Q.canonical.y,1<<Q.canonical.z],De.u_zoom_transition=re,De.u_inv_rot_matrix=fe,De.u_merc_center=ae,De.u_camera_forward=Be._camera.forward(),De.u_ecef_origin=i.dU(Be.globeMatrix,Q.toUnwrapped()),De.u_tile_matrix=Float32Array.from(Be.globeMatrix),De.u_up_vector=de),De},u0=(g,a,d,_)=>({u_matrix:g,u_emissive_strength:a,u_opacity:d,u_color:_}),d0=(g,a,d,_,y,b,T,j,N)=>Object.assign(function(L,B,X,q,Q,re){const{width:ae,height:fe}=q.imageManager.getPixelSize(B),de=Math.pow(2,re.tileID.overscaledZ),xe=re.tileSize*Math.pow(2,q.transform.tileZoom)/de,je=xe*(re.tileID.canonical.x+re.tileID.wrap*de),we=xe*re.tileID.canonical.y;return{u_image:0,u_pattern_tl:X.tl,u_pattern_br:X.br,u_texsize:[ae,fe],u_pattern_size:X.displaySize,u_pattern_units_to_pixels:Q?[q.transform.width,-1*q.transform.height]:[1/i.ay(re,1,q.transform.tileZoom),1/i.ay(re,1,q.transform.tileZoom)],u_pixel_coord_upper:[je>>16,we>>16],u_pixel_coord_lower:[65535&je,65535&we]}}(0,b,T,_,j,N),{u_matrix:g,u_emissive_strength:a,u_opacity:d}),Py=new Float32Array(i.bz([])),h0=(g,a,d,_,y,b,T,j,N,L,B,X,q,Q=[0,0,0],re,ae,fe)=>{const de=y.style.light,xe=de.properties.get("position"),je=[-xe.x,-xe.y,xe.z],we=i.dN();de.properties.get("anchor")==="viewport"&&(i.dO(we,-y.transform.angle),i.dP(je,je,we));const Ve=B.alphaMode==="MASK",Ne=de.properties.get("color").toNonPremultipliedRenderColor(null),Ge=q.paint.get("model-ambient-occlusion-intensity"),Be=q.paint.get("model-color").constantOr(i.ao.white).toNonPremultipliedRenderColor(null);return Be.a=q.paint.get("model-color-mix-intensity").constantOr(0),fe&&(Be.r=fe[0],Be.g=fe[1],Be.b=fe[2],Be.a=fe[3]),ae&&(Be.r=ae.color.r,Be.g=ae.color.g,Be.b=ae.color.b,Be.a=ae.colorMix,X=ae.emissionStrength,b=ae.opacity),{u_matrix:g,u_lighting_matrix:a,u_normal_matrix:d,u_node_matrix:_||Py,u_lightpos:je,u_lightintensity:de.properties.get("intensity"),u_lightcolor:[Ne.r,Ne.g,Ne.b],u_camera_pos:Q,u_opacity:b,u_baseTextureIsAlpha:0,u_alphaMask:+Ve,u_alphaCutoff:B.alphaCutoff,u_baseColorFactor:T.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:j.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:N,u_roughnessFactor:L,u_baseColorTexture:so.BaseColor,u_metallicRoughnessTexture:so.MetallicRoughness,u_normalTexture:so.Normal,u_occlusionTexture:so.Occlusion,u_emissionTexture:so.Emission,u_lutTexture:so.LUT,u_color_mix:Be.toArray01(),u_aoIntensity:Ge,u_emissive_strength:X,u_occlusionTextureTransform:re||[0,0,0,0]}},Hf=(g,a=Py,d=Py)=>({u_matrix:g,u_instance:a,u_node_matrix:d}),JA={fillExtrusion:g=>({u_matrix:new i.ck(g),u_lightpos:new i.ch(g),u_lightintensity:new i.ci(g),u_lightcolor:new i.ch(g),u_vertical_gradient:new i.ci(g),u_opacity:new i.ci(g),u_edge_radius:new i.ci(g),u_width_scale:new i.ci(g),u_ao:new i.cj(g),u_height_type:new i.cg(g),u_base_type:new i.cg(g),u_tile_id:new i.ch(g),u_zoom_transition:new i.ci(g),u_inv_rot_matrix:new i.ck(g),u_merc_center:new i.cj(g),u_up_dir:new i.ch(g),u_height_lift:new i.ci(g),u_flood_light_color:new i.ch(g),u_vertical_scale:new i.ci(g),u_flood_light_intensity:new i.ci(g),u_ground_shadow_factor:new i.ch(g)}),fillExtrusionDepth:g=>({u_matrix:new i.ck(g),u_edge_radius:new i.ci(g),u_width_scale:new i.ci(g),u_vertical_scale:new i.ci(g),u_height_type:new i.cg(g),u_base_type:new i.cg(g)}),fillExtrusionPattern:g=>({u_matrix:new i.ck(g),u_lightpos:new i.ch(g),u_lightintensity:new i.ci(g),u_lightcolor:new i.ch(g),u_vertical_gradient:new i.ci(g),u_height_factor:new i.ci(g),u_edge_radius:new i.ci(g),u_width_scale:new i.ci(g),u_ao:new i.cj(g),u_height_type:new i.cg(g),u_base_type:new i.cg(g),u_tile_id:new i.ch(g),u_zoom_transition:new i.ci(g),u_inv_rot_matrix:new i.ck(g),u_merc_center:new i.cj(g),u_up_dir:new i.ch(g),u_height_lift:new i.ci(g),u_image:new i.cg(g),u_texsize:new i.cj(g),u_pixel_coord_upper:new i.cj(g),u_pixel_coord_lower:new i.cj(g),u_tile_units_to_pixels:new i.ci(g),u_opacity:new i.ci(g),u_pattern_transition:new i.ci(g)}),fillExtrusionGroundEffect:g=>({u_matrix:new i.ck(g),u_opacity:new i.ci(g),u_ao_pass:new i.ci(g),u_meter_to_tile:new i.ci(g),u_ao:new i.cj(g),u_flood_light_intensity:new i.ci(g),u_flood_light_color:new i.ch(g),u_attenuation:new i.ci(g),u_edge_radius:new i.ci(g),u_fb:new i.cg(g),u_fb_size:new i.ci(g),u_dynamic_offset:new i.ci(g)}),fill:g=>({u_matrix:new i.ck(g),u_emissive_strength:new i.ci(g),u_ground_shadow_factor:new i.ch(g)}),fillPattern:g=>({u_matrix:new i.ck(g),u_emissive_strength:new i.ci(g),u_image:new i.cg(g),u_texsize:new i.cj(g),u_pixel_coord_upper:new i.cj(g),u_pixel_coord_lower:new i.cj(g),u_tile_units_to_pixels:new i.ci(g),u_ground_shadow_factor:new i.ch(g),u_pattern_transition:new i.ci(g)}),fillOutline:g=>({u_matrix:new i.ck(g),u_emissive_strength:new i.ci(g),u_world:new i.cj(g),u_ground_shadow_factor:new i.ch(g)}),fillOutlinePattern:g=>({u_matrix:new i.ck(g),u_emissive_strength:new i.ci(g),u_world:new i.cj(g),u_image:new i.cg(g),u_texsize:new i.cj(g),u_pixel_coord_upper:new i.cj(g),u_pixel_coord_lower:new i.cj(g),u_tile_units_to_pixels:new i.ci(g),u_ground_shadow_factor:new i.ch(g),u_pattern_transition:new i.ci(g)}),building:g=>({u_matrix:new i.ck(g),u_normal_matrix:new i.ck(g),u_opacity:new i.ci(g),u_faux_facade_ao_intensity:new i.ci(g),u_camera_pos:new i.ch(g),u_tile_to_meter:new i.ci(g),u_facade_emissive_chance:new i.ci(g),u_flood_light_color:new i.ch(g),u_flood_light_intensity:new i.ci(g)}),buildingBloom:g=>({u_matrix:new i.ck(g)}),buildingDepth:g=>({u_matrix:new i.ck(g)}),elevatedStructuresDepth:g=>({u_matrix:new i.ck(g),u_depth_bias:new i.ci(g)}),elevatedStructures:g=>({u_matrix:new i.ck(g),u_ground_shadow_factor:new i.ch(g)}),elevatedStructuresDepthReconstruct:g=>({u_matrix:new i.ck(g),u_camera_pos:new i.ch(g),u_depth_bias:new i.ci(g),u_height_scale:new i.ci(g),u_reset_depth:new i.ci(g)}),circle:i.dX,collisionBox:g=>({u_matrix:new i.ck(g),u_inv_rot_matrix:new i.ck(g),u_camera_to_center_distance:new i.ci(g),u_extrude_scale:new i.cj(g),u_zoom_transition:new i.ci(g),u_merc_center:new i.cj(g),u_tile_id:new i.ch(g)}),collisionCircle:g=>({u_matrix:new i.ck(g),u_inv_matrix:new i.ck(g),u_camera_to_center_distance:new i.ci(g),u_viewport_size:new i.cj(g)}),debug:g=>({u_color:new i.dA(g),u_matrix:new i.ck(g),u_overlay:new i.cg(g),u_overlay_scale:new i.ci(g)}),clippingMask:g=>({u_matrix:new i.ck(g)}),heatmap:g=>({u_extrude_scale:new i.ci(g),u_intensity:new i.ci(g),u_matrix:new i.ck(g),u_inv_rot_matrix:new i.ck(g),u_merc_center:new i.cj(g),u_tile_id:new i.ch(g),u_zoom_transition:new i.ci(g),u_up_dir:new i.ch(g)}),heatmapTexture:g=>({u_image:new i.cg(g),u_color_ramp:new i.cg(g),u_opacity:new i.ci(g)}),hillshade:g=>({u_matrix:new i.ck(g),u_image:new i.cg(g),u_latrange:new i.cj(g),u_light:new i.cj(g),u_shadow:new i.dA(g),u_highlight:new i.dA(g),u_emissive_strength:new i.ci(g),u_accent:new i.dA(g)}),hillshadePrepare:g=>({u_matrix:new i.ck(g),u_image:new i.cg(g),u_dimension:new i.cj(g),u_zoom:new i.ci(g)}),line:i.dW,linePattern:i.dV,raster:g=>({u_matrix:new i.ck(g),u_normalize_matrix:new i.ck(g),u_globe_matrix:new i.ck(g),u_merc_matrix:new i.ck(g),u_grid_matrix:new i.dB(g),u_tl_parent:new i.cj(g),u_scale_parent:new i.ci(g),u_fade_t:new i.ci(g),u_opacity:new i.ci(g),u_image0:new i.cg(g),u_image1:new i.cg(g),u_brightness_low:new i.ci(g),u_brightness_high:new i.ci(g),u_saturation_factor:new i.ci(g),u_contrast_factor:new i.ci(g),u_spin_weights:new i.ch(g),u_perspective_transform:new i.cj(g),u_raster_elevation:new i.ci(g),u_zoom_transition:new i.ci(g),u_merc_center:new i.cj(g),u_cutoff_params:new i.d2(g),u_colorization_mix:new i.d2(g),u_colorization_offset:new i.ci(g),u_color_ramp:new i.cg(g),u_texture_offset:new i.cj(g),u_texture_res:new i.cj(g),u_emissive_strength:new i.ci(g)}),rasterParticle:g=>({u_matrix:new i.ck(g),u_normalize_matrix:new i.ck(g),u_globe_matrix:new i.ck(g),u_merc_matrix:new i.ck(g),u_grid_matrix:new i.dB(g),u_tl_parent:new i.cj(g),u_scale_parent:new i.ci(g),u_fade_t:new i.ci(g),u_opacity:new i.ci(g),u_image0:new i.cg(g),u_image1:new i.cg(g),u_raster_elevation:new i.ci(g),u_zoom_transition:new i.ci(g),u_merc_center:new i.cj(g),u_cutoff_params:new i.d2(g)}),rasterParticleTexture:g=>({u_texture:new i.cg(g),u_opacity:new i.ci(g)}),rasterParticleDraw:g=>({u_particle_texture:new i.cg(g),u_particle_texture_side_len:new i.ci(g),u_tile_offset:new i.cj(g),u_velocity:new i.cg(g),u_color_ramp:new i.cg(g),u_velocity_res:new i.cj(g),u_max_speed:new i.ci(g),u_uv_offset:new i.cj(g),u_data_scale:new i.cj(g),u_data_offset:new i.ci(g),u_particle_pos_scale:new i.ci(g),u_particle_pos_offset:new i.cj(g)}),rasterParticleUpdate:g=>({u_particle_texture:new i.cg(g),u_particle_texture_side_len:new i.ci(g),u_velocity:new i.cg(g),u_velocity_res:new i.cj(g),u_max_speed:new i.ci(g),u_speed_factor:new i.ci(g),u_reset_rate:new i.ci(g),u_rand_seed:new i.ci(g),u_uv_offset:new i.cj(g),u_data_scale:new i.cj(g),u_data_offset:new i.ci(g),u_particle_pos_scale:new i.ci(g),u_particle_pos_offset:new i.cj(g)}),symbol:g=>({u_is_size_zoom_constant:new i.cg(g),u_is_size_feature_constant:new i.cg(g),u_size_t:new i.ci(g),u_size:new i.ci(g),u_camera_to_center_distance:new i.ci(g),u_rotate_symbol:new i.cg(g),u_aspect_ratio:new i.ci(g),u_fade_change:new i.ci(g),u_matrix:new i.ck(g),u_label_plane_matrix:new i.ck(g),u_coord_matrix:new i.ck(g),u_is_text:new i.cg(g),u_elevation_from_sea:new i.cg(g),u_pitch_with_map:new i.cg(g),u_texsize:new i.cj(g),u_texsize_icon:new i.cj(g),u_texture:new i.cg(g),u_texture_icon:new i.cg(g),u_gamma_scale:new i.ci(g),u_device_pixel_ratio:new i.ci(g),u_tile_id:new i.ch(g),u_zoom_transition:new i.ci(g),u_inv_rot_matrix:new i.ck(g),u_merc_center:new i.cj(g),u_camera_forward:new i.ch(g),u_tile_matrix:new i.ck(g),u_up_vector:new i.ch(g),u_ecef_origin:new i.ch(g),u_is_halo:new i.cg(g),u_icon_transition:new i.ci(g),u_color_adj_mat:new i.ck(g),u_scale_factor:new i.ci(g),u_ground_shadow_factor:new i.ch(g),u_inv_matrix:new i.ck(g),u_normal_scale:new i.ci(g),u_lutTexture:new i.cg(g)}),background:g=>({u_matrix:new i.ck(g),u_emissive_strength:new i.ci(g),u_opacity:new i.ci(g),u_color:new i.dA(g)}),backgroundPattern:g=>({u_matrix:new i.ck(g),u_emissive_strength:new i.ci(g),u_opacity:new i.ci(g),u_image:new i.cg(g),u_pattern_tl:new i.cj(g),u_pattern_br:new i.cj(g),u_texsize:new i.cj(g),u_pattern_size:new i.cj(g),u_pixel_coord_upper:new i.cj(g),u_pixel_coord_lower:new i.cj(g),u_pattern_units_to_pixels:new i.cj(g)}),terrainRaster:g=>({u_matrix:new i.ck(g),u_image0:new i.cg(g),u_skirt_height:new i.ci(g),u_ground_shadow_factor:new i.ch(g)}),skybox:g=>({u_matrix:new i.ck(g),u_sun_direction:new i.ch(g),u_cubemap:new i.cg(g),u_opacity:new i.ci(g),u_temporal_offset:new i.ci(g)}),skyboxGradient:g=>({u_matrix:new i.ck(g),u_color_ramp:new i.cg(g),u_center_direction:new i.ch(g),u_radius:new i.ci(g),u_opacity:new i.ci(g),u_temporal_offset:new i.ci(g)}),skyboxCapture:g=>({u_matrix_3f:new i.dB(g),u_sun_direction:new i.ch(g),u_sun_intensity:new i.ci(g),u_color_tint_r:new i.d2(g),u_color_tint_m:new i.d2(g),u_luminance:new i.ci(g)}),globeRaster:g=>({u_proj_matrix:new i.ck(g),u_globe_matrix:new i.ck(g),u_normalize_matrix:new i.ck(g),u_merc_matrix:new i.ck(g),u_zoom_transition:new i.ci(g),u_merc_center:new i.cj(g),u_image0:new i.cg(g),u_grid_matrix:new i.dB(g),u_skirt_height:new i.ci(g),u_far_z_cutoff:new i.ci(g),u_frustum_tl:new i.ch(g),u_frustum_tr:new i.ch(g),u_frustum_br:new i.ch(g),u_frustum_bl:new i.ch(g),u_globe_pos:new i.ch(g),u_globe_radius:new i.ci(g),u_viewport:new i.cj(g)}),globeAtmosphere:g=>({u_frustum_tl:new i.ch(g),u_frustum_tr:new i.ch(g),u_frustum_br:new i.ch(g),u_frustum_bl:new i.ch(g),u_horizon:new i.ci(g),u_transition:new i.ci(g),u_fadeout_range:new i.ci(g),u_atmosphere_fog_color:new i.d2(g),u_high_color:new i.d2(g),u_space_color:new i.d2(g),u_temporal_offset:new i.ci(g),u_horizon_angle:new i.ci(g)}),model:g=>({u_matrix:new i.ck(g),u_lighting_matrix:new i.ck(g),u_normal_matrix:new i.ck(g),u_node_matrix:new i.ck(g),u_lightpos:new i.ch(g),u_lightintensity:new i.ci(g),u_lightcolor:new i.ch(g),u_camera_pos:new i.ch(g),u_opacity:new i.ci(g),u_baseColorFactor:new i.d2(g),u_emissiveFactor:new i.d2(g),u_metallicFactor:new i.ci(g),u_roughnessFactor:new i.ci(g),u_baseTextureIsAlpha:new i.cg(g),u_alphaMask:new i.cg(g),u_alphaCutoff:new i.ci(g),u_baseColorTexture:new i.cg(g),u_metallicRoughnessTexture:new i.cg(g),u_normalTexture:new i.cg(g),u_occlusionTexture:new i.cg(g),u_emissionTexture:new i.cg(g),u_lutTexture:new i.cg(g),u_color_mix:new i.d2(g),u_aoIntensity:new i.ci(g),u_emissive_strength:new i.ci(g),u_occlusionTextureTransform:new i.d2(g)}),modelDepth:g=>({u_matrix:new i.ck(g),u_instance:new i.ck(g),u_node_matrix:new i.ck(g)}),groundShadow:g=>({u_matrix:new i.ck(g),u_ground_shadow_factor:new i.ch(g)}),stars:g=>({u_matrix:new i.ck(g),u_up:new i.ch(g),u_right:new i.ch(g),u_intensity_multiplier:new i.ci(g)}),snowParticle:g=>({u_modelview:new i.ck(g),u_projection:new i.ck(g),u_time:new i.ci(g),u_cam_pos:new i.ch(g),u_velocityConeAperture:new i.ci(g),u_velocity:new i.ci(g),u_horizontalOscillationRadius:new i.ci(g),u_horizontalOscillationRate:new i.ci(g),u_boxSize:new i.ci(g),u_billboardSize:new i.ci(g),u_simpleShapeParameters:new i.cj(g),u_screenSize:new i.cj(g),u_thinningCenterPos:new i.cj(g),u_thinningShape:new i.ch(g),u_thinningAffectedRatio:new i.ci(g),u_thinningParticleOffset:new i.ci(g),u_particleColor:new i.d2(g),u_direction:new i.ch(g)}),rainParticle:g=>({u_modelview:new i.ck(g),u_projection:new i.ck(g),u_time:new i.ci(g),u_cam_pos:new i.ch(g),u_texScreen:new i.cg(g),u_velocityConeAperture:new i.ci(g),u_velocity:new i.ci(g),u_boxSize:new i.ci(g),u_rainDropletSize:new i.cj(g),u_distortionStrength:new i.ci(g),u_rainDirection:new i.ch(g),u_color:new i.d2(g),u_screenSize:new i.cj(g),u_thinningCenterPos:new i.cj(g),u_thinningShape:new i.ch(g),u_thinningAffectedRatio:new i.ci(g),u_thinningParticleOffset:new i.ci(g),u_shapeDirectionalPower:new i.ci(g),u_shapeNormalPower:new i.ci(g),u_mode:new i.ci(g)}),vignette:g=>({u_vignetteShape:new i.ch(g),u_vignetteColor:new i.d2(g)}),occlusion:g=>({u_matrix:new i.ck(g),u_anchorPos:new i.ch(g),u_screenSizePx:new i.cj(g),u_occluderSizePx:new i.cj(g),u_color:new i.d2(g)})};class Od{constructor(a,d,_,y){this.id=Od.uniqueIdxCounter,Od.uniqueIdxCounter++,this.context=a;const b=a.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||y||d.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){this.id=Od.uniqueIdxCounter,Od.uniqueIdxCounter++;const d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Od.uniqueIdxCounter=0;const k2={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class QA{constructor(a,d,_,y,b,T){this.length=d.length,this.attributes=_,this.itemSize=d.bytesPerElement,this.dynamicDraw=y,this.instanceCount=T,this.context=a;const j=a.gl;this.buffer=j.createBuffer(),a.bindVertexBuffer.set(this.buffer),j.bufferData(j.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?j.DYNAMIC_DRAW:j.STATIC_DRAW),this.dynamicDraw||b||d.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,d){for(let _=0;_<this.attributes.length;_++){const y=d.getAttributeLocation(a,this.attributes[_].name);y!==-1&&a.enableVertexAttribArray(y)}}setVertexAttribPointers(a,d,_){for(let y=0;y<this.attributes.length;y++){const b=this.attributes[y],T=d.getAttributeLocation(a,b.name);T!==-1&&a.vertexAttribPointer(T,b.components,a[k2[b.type]],!1,this.itemSize,b.offset+this.itemSize*(_||0))}}setVertexAttribDivisor(a,d,_){for(let y=0;y<this.attributes.length;y++){const b=d.getAttributeLocation(a,this.attributes[y].name);b!==-1&&this.instanceCount&&this.instanceCount>0&&a.vertexAttribDivisor(b,_)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class f0{constructor(a,d,_,y,b){this.context=a,this.width=d,this.height=_;const T=this.framebuffer=a.gl.createFramebuffer();y&&(this.colorAttachment=new HA(a,T)),b&&(this.depthAttachmentType=b,this.depthAttachment=b==="renderbuffer"?new b2(a,T):new ZA(a,T))}destroy(){const a=this.context.gl;if(this.colorAttachment){const d=this.colorAttachment.get();d&&a.deleteTexture(d)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const d=this.depthAttachment.get();d&&a.deleteRenderbuffer(d)}else{const d=this.depthAttachment.get();d&&a.deleteTexture(d)}a.deleteFramebuffer(this.framebuffer)}}class p0{constructor(a,d){this.gl=a,this.clearColor=new p2(this),this.clearDepth=new py(this),this.clearStencil=new UA(this),this.colorMask=new VA(this),this.depthMask=new $A(this),this.stencilMask=new qA(this),this.stencilFunc=new m2(this),this.stencilOp=new GA(this),this.stencilTest=new Z_(this),this.depthRange=new WA(this),this.depthTest=new g2(this),this.depthFunc=new my(this),this.blend=new X_(this),this.blendFunc=new gy(this),this.blendColor=new Ah(this),this.blendEquation=new Bf(this),this.cullFace=new rg(this),this.cullFaceSide=new Uf(this),this.frontFace=new _2(this),this.program=new _y(this),this.activeTexture=new x2(this),this.viewport=new Vf(this),this.bindFramebuffer=new Y_(this),this.bindRenderbuffer=new K_(this),this.bindTexture=new xy(this),this.bindVertexBuffer=new J_(this),this.bindElementBuffer=new ng(this),this.bindVertexArrayOES=new v2(this),this.pixelStoreUnpack=new y2(this),this.pixelStoreUnpackPremultiplyAlpha=new w2(this),this.pixelStoreUnpackFlipY=new $f(this),this.options=d?Object.assign({},d):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=a.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=a.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=a.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=d&&!!d.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=a.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE),this.maxPointSize=a.getParameter(a.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,d,_){return new Od(this,a,d,_)}createVertexBuffer(a,d,_,y,b){return new QA(this,a,d,_,y,b)}createRenderbuffer(a,d,_){const y=this.gl,b=y.createRenderbuffer();return this.bindRenderbuffer.set(b),y.renderbufferStorage(y.RENDERBUFFER,a,d,_),this.bindRenderbuffer.set(null),b}createFramebuffer(a,d,_,y){return new f0(this,a,d,_,y)}clear({color:a,depth:d,stencil:_,colorMask:y}){const b=this.gl;let T=0;a&&(T|=b.COLOR_BUFFER_BIT,this.clearColor.set(a.toNonPremultipliedRenderColor(null)),this.colorMask.set(y||[!0,!0,!0,!0])),d!==void 0&&(T|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),_!==void 0&&(T|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),b.clear(T)}setCullFace(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){i.bx(a.blendFunction,Vn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor),a.blendEquation?this.blendEquation.set(a.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(a.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let uu;function cg(g,a,d,_,y,b,T){const j=g.context,N=j.gl,L=g.transform,B=[i.aF(L.center.lng),i.aJ(L.center.lat)],X=d.layout.get("symbol-placement"),q=d.layout.get("text-variable-anchor"),Q=d.layout.get("icon-rotation-alignment")==="map",re=d.layout.get("text-rotation-alignment")==="map",ae=X!=="point",fe=[];let de=0,xe=0;for(let De=0;De<_.length;De++){const We=_[De],st=a.getTile(We),rt=st.getBucket(d);if(!rt)continue;const bt=rt.getProjection().createInversionMatrix(L,We.canonical),_t=[],kt=o2(We,rt,L),nr=!T&&Q&&ae,ht=T&&re&&ae,Ke=q&&rt.hasTextData(),Pt=rt.hasIconTextFit()&&Ke&&rt.hasIconData(),xt=nr||ht||T&&Ke||Pt,qt=rt.projection.name==="globe",or=qt?i.aj(L.zoom):0;qt&&(_t.push("PROJECTION_GLOBE_VIEW"),xt&&_t.push("PROJECTED_POS_ON_VIEWPORT"));const Ar=g.getOrCreateProgram("collisionBox",{defines:_t});let tr=kt;y[0]===0&&y[1]===0||(tr=g.translatePosMatrix(kt,st,y,b));const sr=T?rt.textCollisionBox:rt.iconCollisionBox,kr=rt.collisionCircleArray;if(kr.length>0){const gr=i.bB(),wr=tr;i.cO(gr,rt.placementInvProjMatrix,L.glCoordMatrix),i.cO(gr,gr,rt.placementViewportMatrix),fe.push({circleArray:kr,circleOffset:xe,transform:wr,invTransform:gr,projection:rt.getProjection()}),de+=kr.length/4,xe=de}if(!sr)continue;g.terrain&&g.terrain.setupElevationDraw(st,Ar);const yr=qt?[We.canonical.x,We.canonical.y,1<<We.canonical.z]:[0,0,0];Ar.draw(g,N.LINES,Rr.disabled,Cn.disabled,g.colorModeForRenderPass(),yn.disabled,Wf(tr,bt,L,or,B,st,yr,rt.getProjection()),d.id,sr.layoutVertexBuffer,sr.indexBuffer,sr.segments,null,L.zoom,null,[sr.collisionVertexBuffer,sr.collisionVertexBufferExt])}if(!T||!fe.length)return;const je=g.getOrCreateProgram("collisionCircle"),we=new i.dY;we.resize(4*de),we._trim();let Ve=0;for(const De of fe)for(let We=0;We<De.circleArray.length/4;We++){const st=4*We,rt=De.circleArray[st+0],bt=De.circleArray[st+1],_t=De.circleArray[st+2],kt=De.circleArray[st+3];we.emplace(Ve++,rt,bt,_t,kt,0),we.emplace(Ve++,rt,bt,_t,kt,1),we.emplace(Ve++,rt,bt,_t,kt,2),we.emplace(Ve++,rt,bt,_t,kt,3)}(!uu||uu.length<2*de)&&(uu=function(De){const We=2*De,st=new i.b0;st.resize(We),st._trim();for(let rt=0;rt<We;rt++){const bt=6*rt;st.uint16[bt+0]=4*rt+0,st.uint16[bt+1]=4*rt+1,st.uint16[bt+2]=4*rt+2,st.uint16[bt+3]=4*rt+2,st.uint16[bt+4]=4*rt+3,st.uint16[bt+5]=4*rt+0}return st}(de));const Ne=j.createIndexBuffer(uu,!0),Ge=j.createVertexBuffer(we,i.dZ.members,!0);for(const De of fe){const We={u_matrix:De.transform,u_inv_matrix:De.invTransform,u_camera_to_center_distance:(Be=L).getCameraToCenterDistance(De.projection),u_viewport_size:[Be.width,Be.height]};je.draw(g,N.TRIANGLES,Rr.disabled,Cn.disabled,g.colorModeForRenderPass(),yn.disabled,We,d.id,Ge,Ne,i.bf.simpleSegment(0,2*De.circleOffset,De.circleArray.length,De.circleArray.length/2),null,L.zoom)}var Be;Ge.destroy(),Ne.destroy()}const Fd=i.bB();function Dy(g){const a=g._camera.getWorldToCamera(g.worldSize,1),d=i.aB([],a,g.globeMatrix);i.bk(d,d);const _=[0,0,0],y=[0,1,0,0];return i.aC(y,y,d),_[0]=y[0],_[1]=y[1],_[2]=y[2],i.aw(_,_),_}function m0({width:g,height:a,anchor:d,textOffset:_,textScale:y},b){const{horizontalAlign:T,verticalAlign:j}=i.c0(d),N=-(T-.5)*g,L=-(j-.5)*a,B=i.c1(d,_);return new i.P((N/y+B[0])*b,(L/y+B[1])*b)}function g0(g,a,d,_,y,b,T,j,N,L){const B=g.text.placedSymbolArray,X=g.text.dynamicLayoutVertexArray,q=g.icon.dynamicLayoutVertexArray,Q={},re=g.getProjection(),ae=O_(T,re,y),fe=y.elevation,de=re.upVectorScale(T.canonical,y.center.lat,y.worldSize).metersToTile;X.clear();for(let xe=0;xe<B.length;xe++){const je=B.get(xe),{tileAnchorX:we,tileAnchorY:Ve,numGlyphs:Ne}=je,Ge=je.hidden||!je.crossTileID||g.allowVerticalPlacement&&!je.placedOrientation?null:_[je.crossTileID];if(Ge){let Be=0,De=0,We=0;const st=g.elevationType==="road";if(fe||st){const xt=st?g.getElevationFeatureForText(xe):null,qt=i.bU.getAtTileOffset(T,new i.P(we,Ve),fe,xt),[or,Ar,tr]=re.upVector(T.canonical,we,Ve);Be=qt*or*de,De=qt*Ar*de,We=qt*tr*de}let[rt,bt,_t,kt]=Ra(je.projectedAnchorX+Be,je.projectedAnchorY+De,je.projectedAnchorZ+We,d?ae:b);const nr=ty(y.getCameraToCenterDistance(re),kt);let ht=i.bL(g.textSizeData,N,je)*nr/i.bX;d&&(ht*=g.tilePixelRatio/j);const Ke=m0(Ge,ht);d?({x:rt,y:bt,z:_t}=re.projectTilePoint(we+Ke.x,Ve+Ke.y,T.canonical),[rt,bt,_t]=Ra(rt+Be,bt+De,_t+We,b)):(a&&Ke._rotate(-y.angle),rt+=Ke.x,bt+=Ke.y,_t=0);const Pt=g.allowVerticalPlacement&&je.placedOrientation===i.bK.vertical?Math.PI/2:0;for(let xt=0;xt<Ne;xt++)i.bN(X,rt,bt,_t,Pt);L&&je.associatedIconIndex>=0&&(Q[je.associatedIconIndex]={x:rt,y:bt,z:_t,angle:Pt})}else Fu(Ne,X)}if(L){q.clear();const xe=g.icon.placedSymbolArray;for(let je=0;je<xe.length;je++){const we=xe.get(je),{numGlyphs:Ve}=we,Ne=Q[je];if(we.hidden||!Ne)Fu(Ve,q);else{const{x:Ge,y:Be,z:De,angle:We}=Ne;for(let st=0;st<Ve;st++)i.bN(q,Ge,Be,De,We)}}g.icon.dynamicLayoutVertexBuffer.updateData(q)}g.text.dynamicLayoutVertexBuffer.updateData(X)}function ug(g,a,d,_,y,b,T={}){const j=d.paint.get("icon-translate"),N=d.paint.get("text-translate"),L=d.paint.get("icon-translate-anchor"),B=d.paint.get("text-translate-anchor"),X=d.layout.get("icon-rotation-alignment"),q=d.layout.get("text-rotation-alignment"),Q=d.layout.get("icon-pitch-alignment"),re=d.layout.get("text-pitch-alignment"),ae=d.layout.get("icon-keep-upright"),fe=d.layout.get("text-keep-upright"),de=d.paint.get("icon-color-saturation"),xe=d.paint.get("icon-color-contrast"),je=d.paint.get("icon-color-brightness-min"),we=d.paint.get("icon-color-brightness-max"),Ve=d.layout.get("symbol-elevation-reference")==="sea",Ne=d.layout.get("icon-image-use-theme")==="none",Ge=g.context,Be=Ge.gl,De=g.transform,We=X==="map",st=q==="map",rt=Q==="map",bt=re==="map",_t=d.layout.get("symbol-sort-key").constantOr(1)!==void 0;let kt=!1;const nr=g.depthModeForSublayer(0,Rr.ReadOnly),ht=new Rr(g.context.gl.LEQUAL,Rr.ReadOnly,g.depthRangeFor3D),Ke=[i.aF(De.center.lng),i.aJ(De.center.lat)],Pt=d.layout.get("text-variable-anchor"),xt=De.projection.name==="globe",qt=[],or=[0,-1,0];for(const Ar of _){const tr=a.getTile(Ar),sr=tr.getBucket(d);if(!sr||sr.projection.name==="mercator"&&xt||sr.fullyClipped)continue;const kr=sr.projection.name==="globe",yr=kr?i.aj(De.zoom):0,gr=O_(Ar,sr.getProjection(),De),wr=De.calculatePixelsToTileUnitsMatrix(tr),on=Pt&&sr.hasTextData(),Jn=sr.hasIconTextFit()&&on&&sr.hasIconData(),ui=sr.getProjection().createInversionMatrix(De,Ar.canonical),Xi=(1<<tr.tileID.canonical.z)*i.al/g.transform.worldSize,wn=Mi=>{let Tn=[0,0,0];if(Mi){const pi=g.style.directionalLight,Cs=g.style.ambientLight;pi&&Cs&&(Tn=ac(g.style,pi,Cs))}return Tn},li=Mi=>{De.depthOcclusionForSymbolsAndCircles&&(d.hasOcclusionOpacityProperties||g.terrain)&&(Mi.push("DEPTH_D24"),Mi.push("DEPTH_OCCLUSION"))},Fn=Mi=>{d.lut&&!Ne&&(d.lut.texture||(d.lut.texture=new i.d_(g.context,d.lut.image,[d.lut.image.height,d.lut.image.height,d.lut.image.height],Ge.gl.RGBA8)),Ge.activeTexture.set(Ge.gl.TEXTURE0+so.LUT),d.lut.texture&&d.lut.texture.bind(Ge.gl.LINEAR,Ge.gl.CLAMP_TO_EDGE),Mi.push("APPLY_LUT_ON_GPU"))},Wi=()=>{const Mi=We&&d.layout.get("symbol-placement")!=="point",Tn=[];li(Tn),Fn(Tn);const pi=Mi||Jn,Cs=sr.elevationType==="road",ra=g.shadowRenderer,Ls=Cs&&rt&&!!ra&&ra.enabled,Xs=wn(Ls),nl=Cs&&rt&&!g.terrain?ht:nr,Vo=d.paint.get("icon-image-cross-fade");g.terrainRenderModeElevated()&&rt&&Tn.push("PITCH_WITH_MAP_TERRAIN"),kr&&(Tn.push("PROJECTION_GLOBE_VIEW"),pi&&Tn.push("PROJECTED_POS_ON_VIEWPORT")),Vo>0&&sr.hasAnySecondaryIcon&&Tn.push("ICON_TRANSITION"),!sr.icon.zOffsetVertexBuffer||Cs&&g.terrain||Tn.push("Z_OFFSET"),de===0&&xe===0&&je===0&&we===1||Tn.push("COLOR_ADJUSTMENT"),sr.sdfIcons&&Tn.push("RENDER_SDF"),Ls&&Tn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Cs&&rt&&!g.terrain&&sr.icon.orientationVertexBuffer&&Tn.push("ELEVATED_ROADS");const mo=sr.icon.programConfigurations.get(d.id),wo=g.getOrCreateProgram("symbol",{config:mo,defines:Tn}),Dl=tr.imageAtlasTexture?tr.imageAtlasTexture.size:[0,0],go=sr.iconSizeData,Rl=i.bJ(go,De.zoom),hc=rt||!De.isOrthographic,Za=If(gr,tr.tileID.canonical,rt,We,De,sr.getProjection(),wr),Vs=Ou(gr,tr.tileID.canonical,rt,We,De,sr.getProjection(),wr),na=g.translatePosMatrix(Vs,tr,j,L,!0),ts=g.translatePosMatrix(gr,tr,j,L),la=pi?Fd:Za,Xa=We&&!rt&&!Mi;let $s=or;!xt&&!De.mercatorFromTransition||We||($s=Dy(De));const Ml=kr?$s:or,lp=d.getColorAdjustmentMatrix(de,xe,je,we),Hu=ky(go.kind,Rl,Xa,rt,g,ts,la,na,Ve,!1,Dl,[0,0],0,Ar,yr,Ke,ui,Ml,sr.getProjection(),Xs,Xi,lp,Vo,null),cp=tr.imageAtlasTexture?tr.imageAtlasTexture:null,up=d.layout.get("icon-size").constantOr(0)!==1||sr.iconsNeedLinear,Ol=sr.sdfIcons||g.options.rotating||g.options.zooming||up||hc?Be.LINEAR:Be.NEAREST,hu=sr.sdfIcons&&d.paint.get("icon-halo-width").constantOr(1)!==0,qa=g.terrain&&rt&&Mi?i.bk(i.bB(),Za):Fd;if(Mi&&sr.icon){const Fl=i.bU.getAtTileOffsetFunc(Ar,De.center.lat,De.worldSize,sr.getProjection()),Fh=$m(gr,tr.tileID.canonical,rt,We,De,sr.getProjection(),wr),tS=d.layout.get("icon-size-scale-range"),F0=i.aA(g.scaleFactor,tS[0],tS[1]);ny(sr,gr,g,!1,Fh,Vs,rt,ae,Fl,Ar,F0)}return{program:wo,buffers:sr.icon,uniformValues:Hu,atlasTexture:cp,atlasTextureIcon:null,atlasInterpolation:Ol,atlasInterpolationIcon:null,isSDF:sr.sdfIcons,hasHalo:hu,depthMode:nl,tile:tr,renderWithShadows:Ls,labelPlaneMatrixInv:qa}},di=()=>{const Mi=st&&d.layout.get("symbol-placement")!=="point",Tn=[],pi=Mi||Pt||Jn,Cs=sr.elevationType==="road",ra=g.shadowRenderer,Ls=Cs&&bt&&!!ra&&ra.enabled,Xs=wn(Ls),nl=Cs&&bt&&!g.terrain?ht:nr;g.terrainRenderModeElevated()&&bt&&Tn.push("PITCH_WITH_MAP_TERRAIN"),kr&&(Tn.push("PROJECTION_GLOBE_VIEW"),pi&&Tn.push("PROJECTED_POS_ON_VIEWPORT")),!sr.text.zOffsetVertexBuffer||Cs&&g.terrain||Tn.push("Z_OFFSET"),sr.iconsInText&&Tn.push("RENDER_TEXT_AND_SYMBOL"),Tn.push("RENDER_SDF"),Ls&&Tn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Cs&&bt&&!g.terrain&&sr.text.orientationVertexBuffer&&Tn.push("ELEVATED_ROADS"),li(Tn);const Vo=sr.text.programConfigurations.get(d.id),mo=g.getOrCreateProgram("symbol",{config:Vo,defines:Tn});let wo,Dl=[0,0],go=null;const Rl=sr.textSizeData;sr.iconsInText&&(Dl=tr.imageAtlasTexture?tr.imageAtlasTexture.size:[0,0],go=tr.imageAtlasTexture?tr.imageAtlasTexture:null,wo=bt||!De.isOrthographic||g.options.rotating||g.options.zooming||Rl.kind==="composite"||Rl.kind==="camera"?Be.LINEAR:Be.NEAREST);const hc=tr.glyphAtlasTexture?tr.glyphAtlasTexture.size:[0,0],Za=d.layout.get("text-size-scale-range"),Vs=i.aA(g.scaleFactor,Za[0],Za[1]),na=i.bJ(Rl,De.zoom,Vs),ts=If(gr,tr.tileID.canonical,bt,st,De,sr.getProjection(),wr),la=Ou(gr,tr.tileID.canonical,bt,st,De,sr.getProjection(),wr),Xa=g.translatePosMatrix(la,tr,N,B,!0),$s=g.translatePosMatrix(gr,tr,N,B),Ml=pi?Fd:ts,lp=st&&!bt&&!Mi;let Hu=or;!xt&&!De.mercatorFromTransition||st||(Hu=Dy(De));const cp=ky(Rl.kind,na,lp,bt,g,$s,Ml,Xa,Ve,!0,hc,Dl,0,Ar,yr,Ke,ui,kr?Hu:or,sr.getProjection(),Xs,Xi,null,null,Vs),up=tr.glyphAtlasTexture?tr.glyphAtlasTexture:null,Ol=Be.LINEAR,hu=d.paint.get("text-halo-width").constantOr(1)!==0,qa=g.terrain&&bt&&Mi?i.bk(i.bB(),ts):Fd;if(Mi&&sr.text){const Fl=i.bU.getAtTileOffsetFunc(Ar,De.center.lat,De.worldSize,sr.getProjection()),Fh=$m(gr,tr.tileID.canonical,bt,st,De,sr.getProjection(),wr);ny(sr,gr,g,!0,Fh,la,bt,fe,Fl,Ar,Vs)}return{program:mo,buffers:sr.text,uniformValues:cp,atlasTexture:up,atlasTextureIcon:go,atlasInterpolation:Ol,atlasInterpolationIcon:wo,isSDF:!0,hasHalo:hu,depthMode:nl,tile:tr,renderWithShadows:Ls,labelPlaneMatrixInv:qa}},rs=sr.icon.segments.get().length,bi=sr.text.segments.get().length,Ln=rs&&!T.onlyText?Wi():null,ki=bi&&!T.onlyIcons?di():null,qn=d.paint.get("icon-opacity").constantOr(1),ps=d.paint.get("text-opacity").constantOr(1);if(_t&&sr.canOverlap){kt=!0;const Mi=qn&&!T.onlyText?sr.icon.segments.get():[],Tn=ps&&!T.onlyIcons?sr.text.segments.get():[];for(const pi of Mi)qt.push({segments:new i.bf([pi]),sortKey:pi.sortKey,state:Ln});for(const pi of Tn)qt.push({segments:new i.bf([pi]),sortKey:pi.sortKey,state:ki})}else T.onlyText||qt.push({segments:qn?sr.icon.segments:new i.bf([]),sortKey:0,state:Ln}),T.onlyIcons||qt.push({segments:ps?sr.text.segments:new i.bf([]),sortKey:0,state:ki})}kt&&qt.sort((Ar,tr)=>Ar.sortKey-tr.sortKey);for(const Ar of qt){const tr=Ar.state;if(tr)if(g.terrain?g.terrain.setupElevationDraw(tr.tile,tr.program,{useDepthForOcclusion:De.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:tr.labelPlaneMatrixInv}):g.setupDepthForOcclusion(De.depthOcclusionForSymbolsAndCircles,tr.program),Ge.activeTexture.set(Be.TEXTURE0),tr.atlasTexture&&tr.atlasTexture.bind(tr.atlasInterpolation,Be.CLAMP_TO_EDGE,!0),tr.atlasTextureIcon&&(Ge.activeTexture.set(Be.TEXTURE1),tr.atlasTextureIcon&&tr.atlasTextureIcon.bind(tr.atlasInterpolationIcon,Be.CLAMP_TO_EDGE,!0)),tr.renderWithShadows&&g.shadowRenderer.setupShadows(tr.tile.tileID.toUnwrapped(),tr.program,"vector-tile"),g.uploadCommonLightUniforms(g.context,tr.program),tr.hasHalo){const sr=tr.uniformValues;sr.u_is_halo=1,_0(tr.buffers,Ar.segments,d,g,tr.program,tr.depthMode,y,b,sr,2),sr.u_is_halo=0}else{if(tr.isSDF){const sr=tr.uniformValues;tr.hasHalo&&(sr.u_is_halo=1,_0(tr.buffers,Ar.segments,d,g,tr.program,tr.depthMode,y,b,sr,1)),sr.u_is_halo=0}_0(tr.buffers,Ar.segments,d,g,tr.program,tr.depthMode,y,b,tr.uniformValues,1)}}}function _0(g,a,d,_,y,b,T,j,N,L){const B=[g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer,g.iconTransitioningVertexBuffer,g.globeExtVertexBuffer,g.zOffsetVertexBuffer,g.orientationVertexBuffer];y.draw(_,_.context.gl.TRIANGLES,b,T,j,yn.disabled,N,d.id,g.layoutVertexBuffer,g.indexBuffer,a,d.paint,_.transform.zoom,g.programConfigurations.get(d.id),B,L)}function P2(g,a){const d=1<<g.canonical.z,_=(a.x*d-g.canonical.x-g.wrap*d)*i.al,y=(a.y*d-g.canonical.y)*i.al,b=i.e7(a.z,a.y);return i.d4(_,y,b)}function kh(g,a,d,_,y){if(!d.layout||d.layout.get("fill-elevation-reference")==="none"||d.paint.get("fill-opacity").constantOr(1)===0)return;const b=g.context.gl,T=new Rr(g.context.gl.LEQUAL,Rr.ReadWrite,g.depthRangeFor3D),j=new Rr(g.context.gl.GREATER,Rr.ReadWrite,g.depthRangeFor3D),N=function(Q){let re=.01;return Q.isOrthographic&&(re=i.ak(1e-4,re,i.c$(Q.pitch>=Eh?1:Q.pitch/Eh))),2*re}(g.transform),L=g.transform.getFreeCameraOptions().position,B="elevatedStructuresDepthReconstruct",X=g.getOrCreateProgram(B,{defines:["DEPTH_RECONSTRUCTION"]}),q=g.getOrCreateProgram(B);for(const Q of _){const re=a.getTile(Q),ae=re.getBucket(d);if(!ae)continue;const fe=ae.elevatedStructures;if(!fe)continue;const de=ae.elevationBufferData.heightRange,xe=P2(Q.toUnwrapped(),L),je=g.translatePosMatrix(Q.projMatrix,re,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));let we,Ve,Ne,Ge;if(y==="initialize"){if(!de||de.min>=1||fe.depthSegments.segments[0].primitiveLength===0)continue;we=a0(je,xe,N,1,0),Ve=T,Ne=fe.depthSegments,Ge=X}else if(y==="reset"){if(!de||de.min>=0||fe.maskSegments.segments[0].primitiveLength===0)continue;we=a0(je,xe,0,0,1),Ve=j,Ne=fe.maskSegments,Ge=X}else if(y==="geometry"){if(fe.depthSegments.segments[0].primitiveLength===0)continue;we=a0(je,xe,N,1,0),Ve=T,Ne=fe.depthSegments,Ge=q}Ge.draw(g,b.TRIANGLES,Ve,Cn.disabled,Vn.disabled,yn.disabled,we,d.id,fe.vertexBuffer,fe.indexBuffer,Ne,d.paint,g.transform.zoom)}}function Zf(g,a,d){const{painter:_,sourceCache:y,layer:b,coords:T,colorMode:j,elevationType:N,terrainEnabled:L,pass:B}=g,X=_.context.gl,q=b.paint.get("fill-pattern"),Q=b.paint.get("fill-pattern-cross-fade"),re=q.constantOr(null);let ae=N;N!=="road"||a&&!L||(ae="none");const fe=ae==="road",de=g.painter.shadowRenderer,xe=fe&&!!de&&de.enabled,je=new Rr(_.context.gl.LEQUAL,Rr.ReadOnly,_.depthRangeFor3D);let we=[0,0,0];if(xe){const Ge=_.style.directionalLight,Be=_.style.ambientLight;Ge&&Be&&(we=ac(_.style,Ge,Be))}const Ve=q&&q.constantOr(1),Ne=(Ge,Be)=>{let De,We,st,rt,bt;Be?(De=Ve&&!b.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",st=X.LINES):(De=Ve?"fillPattern":"fill",st=X.TRIANGLES);for(const _t of T){const kt=y.getTile(_t);if(Ve&&!kt.patternsLoaded())continue;const nr=kt.getBucket(b);if(!nr)continue;const ht=a?nr.elevationBufferData:nr.bufferData;if(ht.isEmpty())continue;_.prepareDrawTile();const Ke=ht.programConfigurations.get(b.id),Pt=_.isTileAffectedByFog(_t),xt=[],qt=[];fe&&(xt.push("ELEVATED_ROADS"),qt.push(ht.elevatedLayoutVertexBuffer)),xe&&xt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ve&&(_.context.activeTexture.set(X.TEXTURE0),kt.imageAtlasTexture&&kt.imageAtlasTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),Ke.updatePaintBuffers());let or=!1;if(re&&kt.imageAtlas){const yr=kt.imageAtlas,gr=i.e2.from(re),wr=gr.getPrimary().scaleSelf(i.o.devicePixelRatio).toString(),on=gr.getSecondary(),Jn=yr.patternPositions.get(wr),ui=on?yr.patternPositions.get(on.scaleSelf(i.o.devicePixelRatio).toString()):null;or=!!Jn&&!!ui,Jn&&Ke.setConstantPatternPositions(Jn,ui)}Q>0&&(or||Ke.getPatternTransitionVertexBuffer("fill-pattern"))&&xt.push("FILL_PATTERN_TRANSITION");const Ar=_.getOrCreateProgram(De,{config:Ke,overrideFog:Pt,defines:xt}),tr=_.translatePosMatrix(_t.projMatrix,kt,b.paint.get("fill-translate"),b.paint.get("fill-translate-anchor"));xe&&de.setupShadows(kt.tileID.toUnwrapped(),Ar,"vector-tile");const sr=b.paint.get("fill-emissive-strength");if(Be){rt=ht.lineIndexBuffer,bt=ht.lineSegments;const yr=_.terrain&&_.terrain.renderingToTexture?_.terrain.drapeBufferSize:[X.drawingBufferWidth,X.drawingBufferHeight];We=De==="fillOutlinePattern"&&Ve?YA(tr,sr,_,kt,yr,we,Q):XA(tr,sr,yr,we)}else rt=ht.indexBuffer,bt=ht.triangleSegments,We=Ve?A2(tr,sr,_,kt,we,Q):C2(tr,sr,we);_.uploadCommonUniforms(_.context,Ar,_t.toUnwrapped());let kr=Ge;(N==="road"&&!L||N==="offset")&&(kr=je),Ar.draw(_,st,kr,d||_.stencilModeForClipping(_t),j,yn.disabled,We,b.id,ht.layoutVertexBuffer,rt,bt,b.paint,_.transform.zoom,Ke,qt)}};_.renderPass===B&&Ne(_.depthModeForSublayer(1,_.renderPass==="opaque"?Rr.ReadWrite:Rr.ReadOnly),!1),ae==="none"&&_.renderPass==="translucent"&&b.paint.get("fill-antialias")&&Ne(_.depthModeForSublayer(b.getPaintProperty("fill-outline-color")?2:0,Rr.ReadOnly),!0)}function Tr(g,a,d,_,y,b,T,j){d.resetLayerRenderingStats(g);const N=g.context,L=N.gl,B=g.transform,X=d.paint.get("fill-extrusion-pattern"),q=d.paint.get("fill-extrusion-pattern-cross-fade"),Q=X.constantOr(null),re=X.constantOr(1),ae=d.paint.get("fill-extrusion-opacity"),fe=g.style.enable3dLights(),de=d.paint.get(fe&&!re?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),xe=[d.paint.get("fill-extrusion-ambient-occlusion-intensity"),de],je=d.layout.get("fill-extrusion-edge-radius"),we=je>0&&!d.paint.get("fill-extrusion-rounded-roof"),Ve=we?0:je,Ne=B.projection.name==="globe"?i.ea():0,Ge=B.projection.name==="globe",Be=Ge?i.aj(B.zoom):0,De=[i.aF(B.center.lng),i.aJ(B.center.lat)],We=d.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",st=d.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(We?null:d.lut).toArray01().slice(0,3),rt=d.paint.get("fill-extrusion-flood-light-intensity"),bt=d.paint.get("fill-extrusion-vertical-scale"),_t=d.paint.get("fill-extrusion-line-width").constantOr(1)!==0,kt=d.paint.get("fill-extrusion-height-alignment"),nr=d.paint.get("fill-extrusion-base-alignment"),ht=Bu(g,d.paint.get("fill-extrusion-cutoff-fade-range")),Ke=[];let Pt;Ge&&Ke.push("PROJECTION_GLOBE_VIEW"),xe[0]>0&&Ke.push("FAUX_AO"),we&&Ke.push("ZERO_ROOF_RADIUS"),j&&Ke.push("HAS_CENTROID"),rt>0&&Ke.push("FLOOD_LIGHT"),ht.shouldRenderCutoff&&Ke.push("RENDER_CUTOFF"),_t&&Ke.push("RENDER_WALL_MODE");const xt=g.renderPass==="shadow",qt=g.shadowRenderer,or=xt&&!!qt,Ar=xt?yn.disabled:yn.backCCW;g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!0);let tr=[0,0,0];if(qt){const yr=g.style.directionalLight,gr=g.style.ambientLight;yr&&gr&&(tr=ac(g.style,yr,gr)),xt||(Ke.push("RENDER_SHADOWS","DEPTH_TEXTURE"),qt.useNormalOffset&&Ke.push("NORMAL_OFFSET")),Pt=Ke.concat(["SHADOWS_SINGLE_CASCADE"])}const sr=or?"fillExtrusionDepth":re?"fillExtrusionPattern":"fillExtrusion",kr=d.getLayerRenderingStats();for(const yr of _){const gr=a.getTile(yr),wr=gr.getBucket(d);if(!wr||wr.projection.name!==B.projection.name)continue;let on=!1;qt&&(on=qt.getMaxCascadeForTile(yr.toUnwrapped())===0);const Jn=g.isTileAffectedByFog(yr),ui=wr.programConfigurations.get(d.id);let Xi=!1;if(Q&&gr.imageAtlas){const bi=gr.imageAtlas,Ln=i.e2.from(Q),ki=Ln.getPrimary().scaleSelf(i.o.devicePixelRatio).toString(),qn=Ln.getSecondary(),ps=bi.patternPositions.get(ki),Mi=qn?bi.patternPositions.get(qn.scaleSelf(i.o.devicePixelRatio).toString()):null;Xi=!!ps&&!!Mi,ps&&ui.setConstantPatternPositions(ps,Mi)}q>0&&(Xi||ui.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Ke.push("FILL_EXTRUSION_PATTERN_TRANSITION");const wn=g.getOrCreateProgram(sr,{config:ui,defines:on?Pt:Ke,overrideFog:Jn});if(g.terrain&&g.terrain.setupElevationDraw(gr,wn,{useMeterToDem:!0}),!wr.centroidVertexBuffer){const bi=wn.getAttributeLocation(L,"a_centroid_pos");bi!==-1&&L.vertexAttrib2f(bi,0,0)}!xt&&qt&&qt.setupShadows(gr.tileID.toUnwrapped(),wn,"vector-tile"),re&&(g.context.activeTexture.set(L.TEXTURE0),gr.imageAtlasTexture&&gr.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),ui.updatePaintBuffers());const li=d.paint.get("fill-extrusion-vertical-gradient"),Fn=1/wr.tileToMeter;let Wi;if(xt&&qt){if(D2(gr.tileID,wr.maxHeight,g))continue;const bi=qt.calculateShadowPassMatrixFromTile(gr.tileID.toUnwrapped());Wi=T2(bi,Ve,Fn,bt,kt,nr)}else{const bi=g.translatePosMatrix(yr.expandedProjMatrix,gr,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Ln=B.projection.createInversionMatrix(B,yr.canonical);Wi=re?E2(bi,g,li,ae,xe,Ve,Fn,yr,gr,Ne,kt,nr,Be,De,Ln,st,bt,q):s0(bi,g,li,ae,xe,Ve,Fn,yr,Ne,kt,nr,Be,De,Ln,st,bt,rt,tr)}g.uploadCommonUniforms(N,wn,yr.toUnwrapped(),null,ht);let di=wr.segments;if(B.projection.name==="mercator"&&!xt&&(di=wr.getVisibleSegments(gr.tileID,g.terrain,g.transform.getFrustum(0)),!di.get().length))continue;if(kr)if(xt)for(const bi of di.get())kr.numRenderedVerticesInShadowPass+=bi.primitiveLength;else for(const bi of di.get())kr.numRenderedVerticesInTransparentPass+=bi.primitiveLength;const rs=[];(g.terrain||j)&&rs.push(wr.centroidVertexBuffer),Ge&&rs.push(wr.layoutVertexExtBuffer),_t&&rs.push(wr.wallVertexBuffer),wn.draw(g,N.gl.TRIANGLES,y,b,T,Ar,Wi,d.id,wr.layoutVertexBuffer,wr.indexBuffer,di,d.paint,g.transform.zoom,ui,rs)}g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!1)}class Ry{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Vu(g,a,d,_,y,b,T,j,N,L,B,X,q,Q,re,ae,fe,de,xe,je){const we=a.context,Ve=we.gl,Ne=a.transform,Ge=a.transform.zoom,Be=[],De=g.translate,We=g.translateAnchor,st=g.edgeRadius,rt=Bu(a,g.cutoffFadeRange);B==="clear"?(Be.push("CLEAR_SUBPASS"),je&&(Be.push("CLEAR_FROM_TEXTURE"),we.activeTexture.set(Ve.TEXTURE0),je.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE))):B==="sdf"&&Be.push("SDF_SUBPASS"),de&&Be.push("HAS_CENTROID"),rt.shouldRenderCutoff&&Be.push("RENDER_CUTOFF");const bt=(_t,kt,nr,ht,Ke)=>{let Pt=Be;kt.groundRadiusBuffer!=null&&(Pt=Be.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const xt=kt.programConfigurations.get(_.id),qt=a.isTileAffectedByFog(_t),or=a.getOrCreateProgram("fillExtrusionGroundEffect",{config:xt,defines:Pt,overrideFog:qt}),Ar=Gf(a,ht,X,L,Ke,[q,Q*Ke],re,ae,fe,Ge>=17?0:st*Ke,je?je.size[0]:0),tr=[];de&&tr.push(kt.hiddenByLandmarkVertexBuffer),kt.groundRadiusBuffer!=null&&tr.push(kt.groundRadiusBuffer),a.uploadCommonUniforms(we,or,_t.toUnwrapped(),null,rt),or.draw(a,we.gl.TRIANGLES,b,T,j,N,Ar,_.id,kt.vertexBuffer,kt.indexBuffer,nr,_.paint,Ge,xt,tr)};for(const _t of y){const kt=d.getTile(_t),nr=kt.getBucket(_);if(!nr||nr.projection.name!==Ne.projection.name||!nr.groundEffect||nr.groundEffect&&!nr.groundEffect.hasData())continue;const ht=nr.groundEffect,Ke=1/nr.tileToMeter;{const Pt=a.translatePosMatrix(_t.projMatrix,kt,De,We),xt=ht.getDefaultSegment();bt(_t,ht,xt,Pt,Ke)}if(xe)for(let Pt=0;Pt<4;Pt++){const xt=i.e8[Pt](_t),qt=d.getTile(xt);if(!qt)continue;const or=qt.getBucket(_);if(!or||or.projection.name!==Ne.projection.name||!or.groundEffect||or.groundEffect&&!or.groundEffect.hasData())continue;const Ar=or.groundEffect;let tr,sr;Pt===0?(tr=[-i.al,0,0],sr=1):Pt===1?(tr=[i.al,0,0],sr=0):Pt===2?(tr=[0,-i.al,0],sr=3):(tr=[0,i.al,0],sr=2);const kr=Ar.regionSegments[sr];if(!kr)continue;const yr=new Float32Array(16);i.bq(yr,_t.projMatrix,tr),bt(_t,Ar,kr,a.translatePosMatrix(yr,kt,De,We),Ke)}}}function Ld(g,a,d,_,y,b,T){_.centroidVertexArray.length===0&&_.createCentroidsBuffer();const j=b?b.findDEMTileFor(d):null;if(!(j&&j.dem||T))return;b&&j&&j.dem&&_.selfDEMTileTimestamp!==j.dem._timestamp&&(_.borderDoneWithNeighborZ=[-1,-1,-1,-1],_.selfDEMTileTimestamp=j.dem._timestamp);const N=de=>new i.P(Math.ceil((de+i.ec)*i.ed),0),L=de=>{const xe=a.getSource().minzoom,je=Ve=>{const Ne=a.getTileByID(Ve);if(Ne&&Ne.hasData())return Ne.getBucket(y)},we=[0,-1,1];for(const Ve of we){if(de.overscaledZ+Ve<xe)continue;const Ne=je(de.calculateScaledKey(de.overscaledZ+Ve));if(Ne)return Ne}},B=[0,0,0],X=(de,xe)=>(B[0]=Math.min(de.min.y,xe.min.y),B[1]=Math.max(de.max.y,xe.max.y),B[2]=i.al-xe.min.x>de.max.x?xe.min.x-i.al:de.max.x,B),q=(de,xe)=>(B[0]=Math.min(de.min.x,xe.min.x),B[1]=Math.max(de.max.x,xe.max.x),B[2]=i.al-xe.min.y>de.max.y?xe.min.y-i.al:de.max.y,B),Q=[(de,xe)=>X(de,xe),(de,xe)=>X(xe,de),(de,xe)=>q(de,xe),(de,xe)=>q(xe,de)],re=(de,xe,je,we,Ve,Ne,Ge)=>{if(!b)return 0;const Be=[[Ne?je:de,Ne?de:je,0],[Ne?je:xe,Ne?xe:je,0]],De=Ge<0?i.al+Ge:Ge,We=[Ne?De:(de+xe)/2,Ne?(de+xe)/2:De,0];return je===0&&Ge<0||je!==0&&Ge>0?b.getForTilePoints(Ve,[We],!0,we):Be.push(We),b.getForTilePoints(d,Be,!0,j),Math.max(Be[0][2],Be[1][2],We[2])/b.exaggeration()};for(let de=0;de<4;de++){const xe=_.borderFeatureIndices[de];if(xe.length===0)continue;const je=i.e8[de](d),we=L(je);if(!(we&&we instanceof i.e9))continue;const Ve=b?b.findDEMTileFor(je):null;if(!(Ve&&Ve.dem||T)||(b&&Ve&&Ve.dem&&_.borderDEMTileTimestamp[de]!==Ve.dem._timestamp&&(_.borderDoneWithNeighborZ[de]=-1,_.borderDEMTileTimestamp[de]=Ve.dem._timestamp),_.borderDoneWithNeighborZ[de]===we.canonical.z))continue;we.centroidVertexArray.length===0&&we.createCentroidsBuffer();const Ne=(de<2?1:5)-de,Ge=we.borderDoneWithNeighborZ[Ne]!==_.canonical.z,Be=we.borderFeatureIndices[Ne];let De=0;if(_.canonical.z!==we.canonical.z){for(const We of xe)_.showCentroid(_.featuresOnBorder[We]);if(Ge)for(const We of Be)we.showCentroid(we.featuresOnBorder[We]);_.borderDoneWithNeighborZ[de]=we.canonical.z,we.borderDoneWithNeighborZ[Ne]=_.canonical.z}for(const We of xe){const st=_.featuresOnBorder[We],rt=_.centroidData[st.centroidDataIndex],bt=st.borders[de];let _t;for(;De<Be.length;){_t=we.featuresOnBorder[Be[De]];const kt=_t.borders[Ne];if(kt[1]>bt[0]+3||kt[0]>bt[0]-3)break;we.showCentroid(_t),De++}if(_t&&De<Be.length){const kt=De;let nr=0;for(;!(_t.borders[Ne][0]>bt[1]-3)&&(nr++,++De!==Be.length);)_t=we.featuresOnBorder[Be[De]];_t=we.featuresOnBorder[Be[kt]];let ht=!1;if(nr>=1){const xt=_t.borders[Ne];Math.abs(bt[0]-xt[0])<3&&Math.abs(bt[1]-xt[1])<3&&(nr=1,ht=!0,De=kt+1)}else if(nr===0){_.showCentroid(st);continue}const Ke=we.centroidData[_t.centroidDataIndex];T&&ht&&(((ae=rt).flags|(fe=Ke).flags)&i.eb?(ae.flags|=i.eb,fe.flags|=i.eb):(ae.flags&=~i.eb,fe.flags&=~i.eb));const Pt=st.intersectsCount()>1||_t.intersectsCount()>1;if(nr>1)De=kt,rt.centroidXY=Ke.centroidXY=new i.P(0,0);else if(Ve&&Ve.dem&&!Pt){const xt=Q[de](rt,Ke),qt=de%2?i.al-1:0,or=re(xt[0],Math.min(i.al-1,xt[1]),qt,Ve,je,de<2,xt[2]);rt.centroidXY=Ke.centroidXY=N(or)}else Pt?rt.centroidXY=Ke.centroidXY=new i.P(0,0):(rt.centroidXY=_.encodeBorderCentroid(st),Ke.centroidXY=we.encodeBorderCentroid(_t));_.writeCentroidToBuffer(rt),we.writeCentroidToBuffer(Ke)}else _.showCentroid(st)}_.borderDoneWithNeighborZ[de]=we.canonical.z,we.borderDoneWithNeighborZ[Ne]=_.canonical.z}var ae,fe;(_.needsCentroidUpdate||!_.centroidVertexBuffer&&_.centroidVertexArray.length!==0)&&_.uploadCentroid(g)}const zd=[1,0,0],an=[0,1,0],My=[0,0,1];function D2(g,a,d){const _=d.transform,y=d.shadowRenderer;if(!y)return!0;const b=g.toUnwrapped(),T=_.tileSize*y._cascades[d.currentShadowCascade].scale;let j=a;if(_.elevation){const ae=_.elevation.getMinMaxForTile(g);ae&&(j+=ae.max)}const N=[...y.shadowDirection];N[2]=-N[2];const L=y.computeSimplifiedTileShadowVolume(b,j,T,N);if(!L)return!1;const B=[zd,an,My,N,[N[0],0,N[2]],[0,N[1],N[2]]],X=_.projection.name==="globe",q=_.scaleZoom(T),Q=i.cA.fromInvProjectionMatrix(_.invProjMatrix,_.worldSize,q,!X),re=y.getCurrentCascadeFrustum();return Q.intersectsPrecise(L.vertices,L.planes,B)===0||re.intersectsPrecise(L.vertices,L.planes,B)===0}function x0(g){const{painter:a,source:d,layer:_,coords:y}=g;let b=g.defines;const T=a.context,j=a.renderPass==="shadow",N=a.renderPass==="light-beam",L=a.shadowRenderer,B=i.ee(a.transform.center.lat,a.transform.zoom),X=Bu(a,_.paint.get("building-cutoff-fade-range"));X.shouldRenderCutoff&&(b=b.concat("RENDER_CUTOFF")),g.floodLightIntensity>0&&(b=b.concat("FLOOD_LIGHT"));for(const q of y){const Q=d.getTile(q),re=Q.getBucket(_);if(!re)continue;L&&L.getMaxCascadeForTile(q.toUnwrapped())===0&&(b=b.concat("SHADOWS_SINGLE_CASCADE"));const ae=re.programConfigurations.get(_.id);let fe,de,xe,je=a.translatePosMatrix(q.expandedProjMatrix,Q,[0,0],"map");if(je=i.cR(i.bB(),je,[1,1,g.verticalScale]),j&&L){if(D2(Q.tileID,re.maxHeight*B,a))continue;let Ve=L.calculateShadowPassMatrixFromTile(Q.tileID.toUnwrapped());Ve=i.cR(i.bB(),Ve,[1,1,g.verticalScale]),xe=j2(Ve),fe=de=a.getOrCreateProgram("buildingDepth",{config:ae,defines:b,overrideFog:!1})}else if(N)fe=de=a.getOrCreateProgram("buildingBloom",{config:ae,defines:b,overrideFog:!1}),xe=Ay(je);else{const Ve=a.transform.calculatePosMatrix(q.toUnwrapped(),a.transform.worldSize);i.cR(Ve,Ve,[1,1,g.verticalScale]);const Ne=i.bB();i.cR(Ne,Ve,[1,-1,1/B]),i.bk(Ne,Ne),i.ef(Ne,Ne);const Ge=a.transform.getFreeCameraOptions().position,Be=1<<q.canonical.z;if(xe=Cy(je,Ne,g.opacity,g.facadeAOIntensity,[((Ge.x-q.wrap)*Be-q.canonical.x)*i.al,(Ge.y*Be-q.canonical.y)*i.al,Ge.z*Be*i.al],re.tileToMeter,g.facadeEmissiveChance,g.floodLightColor,g.floodLightIntensity),de=a.getOrCreateProgram("building",{config:ae,defines:b,overrideFog:!1}),g.depthOnly===!0)fe=de;else{const De=b.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);fe=a.getOrCreateProgram("building",{config:ae,defines:De,overrideFog:!1})}L&&(L.setupShadowsFromMatrix(Ve,de,!0),fe!==de&&L.setupShadowsFromMatrix(Ve,fe,!0))}const we=(Ve,Ne)=>{if(N){const Ge=Ve.entranceBloom;Ne.draw(a,T.gl.TRIANGLES,g.depthMode,Cn.disabled,g.blendMode,yn.disabled,xe,_.id,Ge.layoutVertexBuffer,Ge.indexBuffer,Ge.segmentsBucket,_.paint,a.transform.zoom,ae,[Ge.layoutAttenuationBuffer,Ge.layoutColorBuffer])}else{const Ge=Ve.segmentsBucket;let Be=[Ve.layoutNormalBuffer,Ve.layoutCentroidBuffer,Ve.layoutColorBuffer,Ve.layoutFloodLightDataBuffer];Ve.layoutFacadePaintBuffer&&(Be=Be.concat([Ve.layoutFacadeDataBuffer,Ve.layoutFacadeVerticalRangeBuffer,Ve.layoutFacadePaintBuffer])),Ne.draw(a,T.gl.TRIANGLES,g.depthMode,Cn.disabled,g.blendMode,j?yn.disabled:yn.backCW,xe,_.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ge,_.paint,a.transform.zoom,ae,Be)}};a.uploadCommonUniforms(T,de,q.toUnwrapped(),null,X),re.buildingWithoutFacade&&we(re.buildingWithoutFacade,de),re.buildingWithFacade&&(fe!==de&&a.uploadCommonUniforms(T,fe,q.toUnwrapped(),null,X),we(re.buildingWithFacade,fe))}}function v0(g,a,d,_,y,b,T,j,N,L,B,X,q){const Q=g.context.gl,re=g.depthModeForSublayer(1,Rr.ReadOnly,Q.LEQUAL,!0),ae=.1*(1-(fe=B))+3*fe;var fe;const de=g._showOverdrawInspector,xe=X,je=new Ry;de||Vu(je,g,a,d,_,re,new Cn({func:Q.ALWAYS,mask:255},255,255,Q.KEEP,Q.KEEP,Q.REPLACE),new Vn([Q.ONE,Q.ONE,Q.ONE,Q.ONE],i.ao.transparent,[!1,!1,!1,!0],Q.MIN),yn.disabled,y,"sdf",b,T,j,N,L,ae,xe,!1);{const we=de?Cn.disabled:new Cn({func:Q.EQUAL,mask:255},255,255,Q.KEEP,Q.DECR,Q.DECR),Ve=de?g.colorModeForRenderPass():new Vn([Q.ONE_MINUS_DST_ALPHA,Q.DST_ALPHA,Q.ONE,Q.ONE],i.ao.transparent,[!0,!0,!0,!0]);Vu(je,g,a,d,_,re,we,Ve,yn.disabled,y,"color",b,T,j,N,L,ae,xe,!1)}}function Oy(g){return[g[0]*i.eg,g[1]*i.eg,g[2]*i.eg,0]}function Fy(g,a,d,_,y,b,T,j,N){const L=_.getSource(),B=d.globeSharedBuffers;if(!B)return;let X,q,Q;if(a&&(X=_.getTile(a)),L instanceof i.aT?(q=L.texture,Q=i.dJ(0,0,d.transform)):X&&a&&(q=X.texture,Q=i.dJ(a.canonical.z,a.canonical.x,d.transform)),!q||!Q)return;g||(Q=i.cR(i.bB(),Q,[1,-1,1]));const re=d.context,ae=re.gl,fe=y.paint.get("raster-resampling")==="nearest"?ae.NEAREST:ae.LINEAR,de=d.colorModeForDrapableLayerRenderPass(b),xe=T.defines;xe.push("GLOBE_POLES");const je=new Rr(ae.LEQUAL,Rr.ReadWrite,d.depthRangeFor3D),we=Float32Array.from(d.transform.expandedFarZProjMatrix),Ve=Float32Array.from(i.bj(i.dI(new i.cC(0,0,0))));d.terrain&&d.terrain.prepareDrawTile(),re.activeTexture.set(ae.TEXTURE0),q.bind(fe,ae.CLAMP_TO_EDGE),re.activeTexture.set(ae.TEXTURE1),q.bind(fe,ae.CLAMP_TO_EDGE),"useMipmap"in q&&re.extTextureFilterAnisotropic&&d.transform.pitch>20&&ae.texParameterf(ae.TEXTURE_2D,re.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,re.extTextureFilterAnisotropicMax);const[Ne,Ge,Be,De]=a?B.getPoleBuffers(a.canonical.z,!1):B.getPoleBuffers(0,!0),We=y.paint.get("raster-elevation");let st;g?(st=Ne,d.renderDefaultNorthPole=We!==0):(st=Ge,d.renderDefaultSouthPole=We!==0);const rt=Oy(T.mix),bt=((kt,nr,ht,Ke,Pt,xt,qt,or,Ar,tr,sr,kr,yr)=>lg(kt,nr,ht,new Float32Array(16),new Float32Array(9),[0,0],Ke,[0,0],[0,0,0,0],1,{opacity:1,mix:0},xt,[0,0],or,2,tr,sr,kr,1,0,yr))(we,Ve,Q,i.aj(d.transform.zoom),0,y,0,We,0,rt,T.offset,T.range,b),_t=d.getOrCreateProgram("raster",{defines:xe});d.uploadCommonUniforms(re,_t,null),_t.draw(d,ae.TRIANGLES,je,N,de,j,bt,y.id,st,Be,De)}function R2(g){const a=g._nearZ,d=g.projection.farthestPixelDistance(g),_=d-a,y=.2*g.height,b=a+y;return[a,d,(b-y-a)/_,(b-a)/_]}function ej(g,a,d,_){if(g)return a instanceof He&&g instanceof Bo?a.getTextureDescriptor(g,d,!0):{texture:g.texture,mix:Oy(_.mix),offset:_.offset,buffer:0,tileSize:1}}var tj=i.eh([{name:"a_index",type:"Int16",components:1}]);class gl{constructor(a,d,_,y){const b={width:_[0],height:_[1],data:null},T=a.gl;this.targetColorTexture=new i.T(a,b,T.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new i.T(a,b,T.RGBA8,{useMipmap:!1}),this.context=a,this.updateParticleTexture(d,y),this.lastInvalidatedAt=0}updateParticleTexture(a,d){if(this.particleTextureDimension===d.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const _=this.context.gl,y=d.width*d.height;this.particleTexture0=new i.T(this.context,d,_.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new i.T(this.context,d,_.RGBA8,{premultiply:!1,useMipmap:!1});const b=new i.ei;b.reserve(y);for(let T=0;T<y;T++)b.emplaceBack(T);this.particleIndexBuffer=this.context.createVertexBuffer(b,tj.members,!0),this.particleSegment=i.bf.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=d.width}update(a){return!(this.lastInvalidatedAt<a&&(this.lastInvalidatedAt=i.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Ly(g,a,d){if(!g)return null;const _=a.getTextureDescriptor(g,d,!0);if(!_)return null;let{texture:y,mix:b,offset:T,tileSize:j,buffer:N,format:L}=_;if(!y||!L)return null;let B=!1;return L==="uint32"&&(B=!0,b[3]=0,b=o0(i.ej,b,[0,d.paint.get("raster-particle-max-speed")]),T=Uu(i.ej,T,[0,d.paint.get("raster-particle-max-speed")])),{texture:y,textureOffset:[N/(j+2*N),j/(j+2*N)],tileSize:j,scalarData:B,scale:b,offset:T,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[L]]}}function Uo(g){const a=g._nearZ,d=g.projection.farthestPixelDistance(g),_=d-a,y=.2*g.height,b=a+y;return[a,d,(b-y-a)/_,(b-a)/_]}const Bd=new i.ao(1,0,0,1),M2=new i.ao(0,1,0,1),zy=new i.ao(0,0,1,1),By=new i.ao(1,0,1,1),Uy=new i.ao(0,1,1,1);function Vy(g,a,d,_,y,b){for(let T=0;T<d.length;T++)if(y){const L=new i.ao(_.r*.8,_.g*.8,_.b*.8,1);_l(g,a,d[T],_,-1,-1,b),_l(g,a,d[T],_,-1,1,b),_l(g,a,d[T],_,1,1,b),_l(g,a,d[T],_,1,-1,b),_l(g,a,d[T],L,0,0,b)}else _l(g,a,d[T],_,0,0,b)}function _l(g,a,d,_,y,b,T){const j=g.context,N=g.transform,L=j.gl,B=N.projection.name==="globe",X=B?["PROJECTION_GLOBE_VIEW"]:[];let q=i.by(d.projMatrix);if(B&&i.aj(N.zoom)>0){const rt=i.bi(d.canonical,N),bt=i.ek(rt);q=i.aB(new Float32Array(16),N.globeMatrix,bt),i.aB(q,N.projMatrix,q)}const Q=i.bB();Q[12]+=2*y/(i.o.devicePixelRatio*N.width),Q[13]+=2*b/(i.o.devicePixelRatio*N.height),i.aB(q,Q,q);const re=g.getOrCreateProgram("debug",{defines:X}),ae=a.getTileByID(d.key);g.terrain&&g.terrain.setupElevationDraw(ae,re);const fe=Rr.disabled,de=Cn.disabled,xe=g.colorModeForRenderPass(),je="$debug";j.activeTexture.set(L.TEXTURE0),g.emptyTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),B?ae._makeGlobeTileDebugBuffers(g.context,N):ae._makeDebugTileBoundsBuffers(g.context,N.projection);const we=ae._tileDebugBuffer||g.debugBuffer,Ve=ae._tileDebugIndexBuffer||g.debugIndexBuffer,Ne=ae._tileDebugSegments||g.debugSegments;if(re.draw(g,L.LINE_STRIP,fe,de,xe,yn.disabled,jy(q,_.toPremultipliedRenderColor(null)),je,we,Ve,Ne,null,null,null,[ae._globeTileDebugBorderBuffer]),T){const rt=ae.latestRawTileData,bt=Math.floor((rt&&rt.byteLength||0)/1024);let _t=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(_t+=` => ${d.overscaledZ}`),_t+=` ${ae.state}`,_t+=` ${bt}kb`,function(kt,nr){kt.initDebugOverlayCanvas();const ht=kt.debugOverlayCanvas,Ke=kt.context.gl,Pt=kt.debugOverlayCanvas.getContext("2d");Pt.clearRect(0,0,ht.width,ht.height),Pt.shadowColor="white",Pt.shadowBlur=2,Pt.lineWidth=1.5,Pt.strokeStyle="white",Pt.textBaseline="top",Pt.font="bold 36px Open Sans, sans-serif",Pt.fillText(nr,5,5),Pt.strokeText(nr,5,5),kt.debugOverlayTexture.update(ht),kt.debugOverlayTexture.bind(Ke.LINEAR,Ke.CLAMP_TO_EDGE)}(g,_t)}const Ge=a.getTile(d).tileSize,Be=512/Math.min(Ge,512)*(d.overscaledZ/N.zoom)*.5,De=ae._tileDebugTextBuffer||g.debugBuffer,We=ae._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,st=ae._tileDebugTextSegments||g.debugSegments;re.draw(g,L.TRIANGLES,fe,de,Vn.alphaBlended,yn.disabled,jy(q,i.ao.transparent.toPremultipliedRenderColor(null),Be),je,De,We,st,null,null,null,[ae._globeTileDebugTextBuffer])}function us(g,a,d,_){Xf(g,0,a+d/2,g.transform.width,d,_)}function dg(g,a,d,_){Xf(g,a-d/2,0,d,g.transform.height,_)}function Xf(g,a,d,_,y,b){const T=g.context,j=T.gl;j.enable(j.SCISSOR_TEST),j.scissor(a*i.o.devicePixelRatio,d*i.o.devicePixelRatio,_*i.o.devicePixelRatio,y*i.o.devicePixelRatio),T.clear({color:b}),j.disable(j.SCISSOR_TEST)}const O2=i.eh([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:F2}=O2;function $u(g,a,d,_){g.emplaceBack(a,d,_)}class $y{constructor(a){this.vertexArray=new i.el,this.indices=new i.b0,$u(this.vertexArray,-1,-1,1),$u(this.vertexArray,1,-1,1),$u(this.vertexArray,-1,1,1),$u(this.vertexArray,1,1,1),$u(this.vertexArray,-1,-1,-1),$u(this.vertexArray,1,-1,-1),$u(this.vertexArray,-1,1,-1),$u(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=a.createVertexBuffer(this.vertexArray,F2),this.indexBuffer=a.createIndexBuffer(this.indices),this.segment=i.bf.simpleSegment(0,0,36,12)}}function cc(g,a,d,_,y,b){const T=g.context.gl,j=a.paint.get("sky-atmosphere-color"),N=a.paint.get("sky-atmosphere-halo-color"),L=a.paint.get("sky-atmosphere-sun-intensity"),B=((X,q,Q,re,ae)=>({u_matrix_3f:X,u_sun_direction:q,u_sun_intensity:Q,u_color_tint_r:[re.r,re.g,re.b,re.a],u_color_tint_m:[ae.r,ae.g,ae.b,ae.a],u_luminance:5e-5}))(i.en(i.dN(),_),y,L,j.toPremultipliedRenderColor(null),N.toPremultipliedRenderColor(null));T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+b,a.skyboxTexture,0),d.draw(g,T.TRIANGLES,Rr.disabled,Cn.disabled,Vn.unblended,yn.frontCW,B,"skyboxCapture",a.skyboxGeometry.vertexBuffer,a.skyboxGeometry.indexBuffer,a.skyboxGeometry.segment)}const Ph=i.eh([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class er{constructor(a){const d=new i.eo;d.emplaceBack(-1,1,1,0,0),d.emplaceBack(1,1,1,1,0),d.emplaceBack(1,-1,1,1,1),d.emplaceBack(-1,-1,1,0,1);const _=new i.b0;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=a.createVertexBuffer(d,Ph.members),this.indexBuffer=a.createIndexBuffer(_),this.segments=i.bf.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const mr=i.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Yf{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Zs{constructor(a){this.colorModeAlphaBlendedWriteRGB=new Vn([1,oa,1,oa],i.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Vn([1,0,1,0],i.ao.transparent,[!1,!1,!1,!0]),this.params=new Yf,this.updateNeeded=!0,a.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),a.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),a.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),a.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(a){const d=a.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new er(d);const _=this.params.sizeRange,y=this.params.intensityRange,b=function(B){const X=i.eq(30),q=[];for(let Q=0;Q<B;++Q){const re=2*Math.PI*X(),ae=Math.acos(1-2*X())-.5*Math.PI;q.push(i.d4(Math.cos(ae)*Math.cos(re),Math.cos(ae)*Math.sin(re),Math.sin(ae)))}return q}(this.params.starsCount),T=i.eq(300),j=new i.ep,N=new i.b0;let L=0;for(let B=0;B<b.length;++B){const X=i.c4([],b[B],200),q=Math.max(0,1+.01*_*(1*T()-.5)),Q=Math.max(0,1+.01*y*(1*T()-.5));j.emplaceBack(X[0],X[1],X[2],-1,-1,q,Q),j.emplaceBack(X[0],X[1],X[2],1,-1,q,Q),j.emplaceBack(X[0],X[1],X[2],1,1,q,Q),j.emplaceBack(X[0],X[1],X[2],-1,1,q,Q),N.emplaceBack(L+0,L+1,L+2),N.emplaceBack(L+0,L+2,L+3),L+=4}this.starsVx=d.createVertexBuffer(j,mr.members),this.starsIdx=d.createIndexBuffer(N),this.starsSegments=i.bf.simpleSegment(0,0,j.length,N.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(a,d){const _=a.context,y=_.gl,b=a.transform,T=new Rr(y.LEQUAL,Rr.ReadOnly,[0,1]),j=i.aj(b.zoom),N=a.style.getLut(d.scope),L=d.properties.get("color-use-theme")==="none",B=d.properties.get("color").toNonPremultipliedRenderColor(L?null:N),X=d.properties.get("high-color-use-theme")==="none",q=d.properties.get("high-color").toNonPremultipliedRenderColor(X?null:N),Q=d.properties.get("space-color-use-theme")==="none",re=d.properties.get("space-color").toNonPremultipliedRenderColor(Q?null:N),ae=5e-4,fe=i.er(d.properties.get("horizon-blend"),0,1,ae,.25),de=i.dD(a,_,b)&&fe===ae?b.worldSize/(2*Math.PI*1.025)-1:b.globeRadius,xe=a.frameCounter/1e3%1,je=i.ag(b.globeCenterInViewSpace),we=Math.sqrt(Math.pow(je,2)-Math.pow(de,2)),Ve=Math.acos(we/je),Ne=Ge=>{const Be=b.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Ge&&Be.push("ALPHA_PASS");const De=a.getOrCreateProgram("globeAtmosphere",{defines:Be}),We=((rt,bt,_t,kt,nr,ht,Ke,Pt,xt,qt,or,Ar)=>({u_frustum_tl:rt,u_frustum_tr:bt,u_frustum_br:_t,u_frustum_bl:kt,u_horizon:nr,u_transition:ht,u_fadeout_range:Ke,u_atmosphere_fog_color:Pt.toArray01(),u_high_color:xt.toArray01(),u_space_color:qt.toArray01(),u_temporal_offset:or,u_horizon_angle:Ar}))(b.frustumCorners.TL,b.frustumCorners.TR,b.frustumCorners.BR,b.frustumCorners.BL,b.frustumCorners.horizon,j,fe,B,q,re,xe,Ve);a.uploadCommonUniforms(_,De);const st=this.atmosphereBuffer;st&&De.draw(a,y.TRIANGLES,T,Cn.disabled,Ge?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,yn.backCW,We,Ge?"atmosphere_glow_alpha":"atmosphere_glow",st.vertexBuffer,st.indexBuffer,st.segments)};Ne(!1),Ne(!0)}drawStars(a,d){const _=i.aA(d.properties.get("star-intensity"),0,1);if(_===0)return;const y=a.context,b=y.gl,T=a.transform,j=a.getOrCreateProgram("stars"),N=i.c6([]);i.c8(N,N,-T._pitch),i.c7(N,N,-T.angle),i.c8(N,N,i.an(T._center.lat)),i.es(N,N,-i.an(T._center.lng));const L=i.cb(new Float32Array(16),N),B=i.aB([],T.starsProjMatrix,L),X=i.en([],L),q=i.et([],X),Q=[0,1,0];i.dP(Q,Q,q),i.c4(Q,Q,this.params.sizeMultiplier);const re=[1,0,0];i.dP(re,re,q),i.c4(re,re,this.params.sizeMultiplier);const ae=(fe=Q,de=re,xe=_,{u_matrix:Float32Array.from(B),u_up:fe,u_right:de,u_intensity_multiplier:xe});var fe,de,xe;a.uploadCommonUniforms(y,j),this.starsVx&&this.starsIdx&&j.draw(a,b.TRIANGLES,Rr.disabled,Cn.disabled,this.colorModeAlphaBlendedWriteRGB,yn.disabled,ae,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class at{constructor(){this.visibleTiles=[]}updateBorders(a,d){const _=[],y=[],b=a._getRenderableCoordinates(!1,!0);for(const N of b){const L=a.getTile(N);if(!L.hasData())continue;const B=L.getBucket(d);B&&(B.isEmpty()||(_.push(N.key),y.push({bucket:B,tileID:N.canonical})))}let T=_.length!==this.visibleTiles.length;if(!T){_.sort();for(let N=0;N<_.length;N++)if(_[N]!==this.visibleTiles[N]){T=!0;break}}if(!T)return;const j=new Set;this.visibleTiles=_,y.sort((N,L)=>N.tileID.z-L.tileID.z||N.tileID.x-L.tileID.x||N.tileID.y-L.tileID.y);for(const N of y){const L=new Array,B=new Array,X=N.bucket;for(const q of X.featuresOnBorder)j.has(q.featureId)?B.push(q.footprintIndex):(j.add(q.featureId),L.push(q.footprintIndex));X.updateFootprintHiddenFlags(L,i.eu,!1),X.updateFootprintHiddenFlags(B,i.eu,!0)}}}function qy(g,a){const d=[...g],_=a.cameraWorldSizeForFog/a.worldSize,y=i.bz([]);return i.cR(y,y,[_,_,1]),i.aB(d,y,d),i.aB(d,a.worldToFogMatrix,d),d}function Kf(g,a,d,_,y){const b=d.material,T=_.context,{baseColorTexture:j,metallicRoughnessTexture:N}=b.pbrMetallicRoughness,{normalTexture:L,occlusionTexture:B,emissionTexture:X}=b;function q(re,ae,fe){if(re&&(g.push(ae),T.activeTexture.set(T.gl.TEXTURE0+fe),re.gfxTexture)){const{minFilter:de,magFilter:xe,wrapS:je,wrapT:we}=re.sampler;re.gfxTexture.bindExtraParam(de,xe,je,we)}}q(j,"HAS_TEXTURE_u_baseColorTexture",so.BaseColor),q(N,"HAS_TEXTURE_u_metallicRoughnessTexture",so.MetallicRoughness),q(L,"HAS_TEXTURE_u_normalTexture",so.Normal),q(B,"HAS_TEXTURE_u_occlusionTexture",so.Occlusion),q(X,"HAS_TEXTURE_u_emissionTexture",so.Emission),y&&(y.texture||(y.texture=new i.d_(_.context,y.image,[y.image.height,y.image.height,y.image.height],T.gl.RGBA8)),T.activeTexture.set(T.gl.TEXTURE0+so.LUT),y.texture&&y.texture.bind(T.gl.LINEAR,T.gl.CLAMP_TO_EDGE),g.push("APPLY_LUT_ON_GPU")),d.texcoordBuffer&&(g.push("HAS_ATTRIBUTE_a_uv_2f"),a.push(d.texcoordBuffer)),d.colorBuffer&&(g.push(d.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),a.push(d.colorBuffer)),d.normalBuffer&&(g.push("HAS_ATTRIBUTE_a_normal_3f"),a.push(d.normalBuffer)),d.pbrBuffer&&(g.push("HAS_ATTRIBUTE_a_pbr"),g.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),a.push(d.pbrBuffer)),b.alphaMode!=="OPAQUE"&&b.alphaMode!=="MASK"||g.push("UNPREMULT_TEXTURE_IN_SHADER"),b.defined||g.push("DIFFUSE_SHADED");const Q=_.shadowRenderer;Q&&(g.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Q.useNormalOffset&&g.push("NORMAL_OFFSET"))}function Jf(g,a,d,_,y,b){const T=d.paint.get("model-opacity").constantOr(1),j=a.context,N=new Rr(a.context.gl.LEQUAL,g.isLightMesh?Rr.ReadOnly:Rr.ReadWrite,a.depthRangeFor3D),L=a.transform,B=g.mesh,X=B.material,q=X.pbrMetallicRoughness,Q=a.style.fog;let re;re=a.transform.projection.zAxisUnit==="pixels"?[...g.nodeModelMatrix]:i.aB([],_.zScaleMatrix,g.nodeModelMatrix),i.aB(re,_.negCameraPosMatrix,re);const ae=i.bk([],re);i.ef(ae,ae);const fe=d.paint.get("model-color-use-theme").constantOr("default")==="none",de=d.paint.get("model-emissive-strength").constantOr(0),xe=h0(new Float32Array(g.worldViewProjection),new Float32Array(re),new Float32Array(ae),null,a,T,q.baseColorFactor,X.emissiveFactor,q.metallicFactor,q.roughnessFactor,X,de,d,void 0,void 0,g.materialOverride,g.modelColor),je={defines:[]},we=[],Ve=a.shadowRenderer;Ve&&(Ve.useNormalOffset=!1),Kf(je.defines,we,B,a,fe?null:d.lut);let Ne=null;if(Q){const De=qy(g.nodeModelMatrix,a.transform);if(Ne=new Float32Array(De),L.projection.name!=="globe"){const We=B.aabb.min,st=B.aabb.max,[rt,bt]=Q.getOpacityForBounds(De,We[0],We[1],st[0],st[1]);je.overrideFog=rt>=ze||bt>=ze}}const Ge=Bu(a,d.paint.get("model-cutoff-fade-range"));Ge.shouldRenderCutoff&&je.defines.push("RENDER_CUTOFF");const Be=a.getOrCreateProgram("model",je);a.uploadCommonUniforms(j,Be,null,Ne,Ge),a.renderPass!=="shadow"&&Ve&&Ve.setupShadowsFromMatrix(g.nodeModelMatrix,Be),Be.draw(a,j.gl.TRIANGLES,N,y,b,B.material.doubleSided?yn.disabled:yn.backCCW,xe,d.id,B.vertexBuffer,B.indexBuffer,B.segments,d.paint,a.transform.zoom,void 0,we)}function y0(g,a,d){return g.type==="vector"?a.scope:d?"basemap":""}function w0(g,a,d,_,y,b,T,j,N){const L=g.transform,B=!!a.isGeometryBloom&&a.isGeometryBloom;if(B&&g.renderPass==="shadow")return;const X=L.projection.name==="globe"?i.eC(d,L):[...d];i.aB(X,X,a.globalMatrix);const q=i.aB([],_,X);if(a.meshes)for(const Q of a.meshes){const re=j.get(Q.material.name);if(re&&re.opacity<=0)continue;if(Q.material.alphaMode!=="BLEND"){T.push({mesh:Q,depth:0,modelIndex:y,worldViewProjection:q,nodeModelMatrix:X,isLightMesh:B,materialOverride:re,modelColor:N});continue}const ae=i.af([],Q.centroid,q);!L.isOrthographic&&ae[2]<=0||b.push({mesh:Q,depth:ae[2],modelIndex:y,worldViewProjection:q,nodeModelMatrix:X,isLightMesh:B,materialOverride:re,modelColor:N})}if(a.children)for(const Q of a.children)w0(g,Q,d,_,y,b,T,j,N)}function Qf(g,a,d,_){const y=d.shadowRenderer;if(!y)return;const b=y.getShadowPassDepthMode(),T=y.getShadowPassColorMode(),j=y.calculateShadowPassMatrixFromMatrix(a),N=Hf(j);d.getOrCreateProgram("modelDepth",{defines:d._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(d,d.context.gl.TRIANGLES,b,Cn.disabled,T,yn.disabled,N,_.id,g.vertexBuffer,g.indexBuffer,g.segments,_.paint,d.transform.zoom,void 0,void 0)}function ep(g,a,d,_,y,b){for(const T of y){const j=Object.assign({},_);j.part=T;const N={type:"Unknown",id:a,properties:j},L={orientation:g.paint.get("model-rotation").evaluate(N,d)};b.set(T,L)}}function rj(g,a,d,_,y,b){for(const T of y){const j=Object.assign({},_);j.part=T;const N={type:"Unknown",id:a,properties:j},L={color:g.paint.get("model-color").evaluate(N,d),colorMix:g.paint.get("model-color-mix-intensity").evaluate(N,d),opacity:g.paint.get("model-opacity").evaluate(N,d),emissionStrength:g.paint.get("model-emissive-strength").evaluate(N,d)};b.set(T,L)}}function L2(g,a,d,_,y,b){if(d===1)for(const j of y)Jf(j,g,a,b[j.modelIndex],Cn.disabled,g.colorModeForRenderPass());else{for(const j of y)Jf(j,g,a,b[j.modelIndex],Cn.disabled,Vn.disabled);for(const j of y)Jf(j,g,a,b[j.modelIndex],g.stencilModeFor3D(),g.colorModeForRenderPass());g.resetStencilClippingMasks()}const T=Vn.additive;for(const j of _)Jf(j,g,a,b[j.modelIndex],Cn.disabled,j.isLightMesh?T:g.colorModeForRenderPass())}function z2(g,a,d){const _=a.updateZoomBasedPaintProperties(),y=function(b,T,j){let N,L,B,X=b.terrain?b.terrain.exaggeration():0;if(b.terrain&&X>0){const q=b.terrain,Q=q.findDEMTileFor(j);Q&&Q.dem?N=i.eE.create(q,j,Q):X=0}if(X===0&&(T.terrainElevationMin=0,T.terrainElevationMax=0),X===T.validForExaggeration&&(X===0||N&&N._demTile&&N._demTile.tileID===T.validForDEMTile.id&&N._dem._timestamp===T.validForDEMTile.timestamp))return!1;for(const q in T.instancesPerModel){const Q=T.instancesPerModel[q];for(let re=0;re<Q.instancedDataArray.length;++re){const ae=(N?X*N.getElevationAt(0|Q.instancedDataArray.float32[16*re],0|Q.instancedDataArray.float32[16*re+1],!0,!0):0)+Q.instancesEvaluatedElevation[re];Q.instancedDataArray.float32[16*re+6]=ae,L=L?Math.min(T.terrainElevationMin,ae):ae,B=B?Math.max(T.terrainElevationMax,ae):ae}}return T.terrainElevationMin=L||0,T.terrainElevationMax=B||0,T.validForExaggeration=X,T.validForDEMTile=N&&N._demTile?{id:N._demTile.tileID,timestamp:N._dem._timestamp}:{id:void 0,timestamp:0},!0}(g,a,d);(_||y)&&(a.uploaded=!1,a.upload(g.context))}const kl={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new i.d8([0,0,0],[i.al,i.al,0])};function Gy(g,a){const d=1<<g.canonical.z,_=a.getFreeCameraOptions().position,y=a.elevation,b=g.canonical.x/d,T=(g.canonical.x+1)/d,j=g.canonical.y/d,N=(g.canonical.y+1)/d;let L=a._centerAltitude;if(y){const Q=y.getMinMaxForTile(g);Q&&Q.max>L&&(L=Q.max)}const B=i.aA(_.x,b,T)-_.x,X=i.aA(_.y,j,N)-_.y,q=i.ce(L,a.center.lat)-_.z;return a._zoomFromMercatorZ(Math.sqrt(B*B+X*X+q*q))}function Wy(g,a,d,_,y,b,T){const j=g.context,N=g.renderPass==="shadow",L=g.shadowRenderer,B=N&&L?L.getShadowPassDepthMode():new Rr(j.gl.LEQUAL,Rr.ReadWrite,g.depthRangeFor3D),X=g.isTileAffectedByFog(b),q=g.transform.projection.name==="globe";if(d.meshes)for(const Q of d.meshes){const re=q?[]:["MODEL_POSITION_ON_GPU"],ae=[];let fe,de,xe;const je=!q&&_.instancedDataArray.length>20;je&&re.push("INSTANCED_ARRAYS");const we=Bu(g,a.paint.get("model-cutoff-fade-range"));if(we.shouldRenderCutoff&&re.push("RENDER_CUTOFF"),N&&L)fe=g.getOrCreateProgram("modelDepth",{defines:re}),de=Hf(T.shadowTileMatrix,T.shadowTileMatrix,Float32Array.from(d.globalMatrix)),xe=L.getShadowPassColorMode();else{Kf(re,ae,Q,g,a.paint.get("model-color-use-theme").constantOr("default")==="none"?null:a.lut),fe=g.getOrCreateProgram("model",{defines:re,overrideFog:X});const Ne=Q.material,Ge=Ne.pbrMetallicRoughness,Be=a.paint.get("model-opacity").constantOr(1),De=a.paint.get("model-emissive-strength").constantOr(0);de=h0(b.expandedProjMatrix,Float32Array.from(d.globalMatrix),new Float32Array(16),null,g,Be,Ge.baseColorFactor,Ne.emissiveFactor,Ge.metallicFactor,Ge.roughnessFactor,Ne,De,a,y),L&&(T.shadowUniformsInitialized?fe.setShadowUniformValues(j,L.getShadowUniformValues()):(L.setupShadows(b.toUnwrapped(),fe,"model-tile"),T.shadowUniformsInitialized=!0)),xe=we.shouldRenderCutoff||Be<1||Ne.alphaMode!=="OPAQUE"?Vn.alphaBlended:Vn.unblended}g.uploadCommonUniforms(j,fe,b.toUnwrapped(),null,we);const Ve=Q.material.doubleSided?yn.disabled:yn.backCCW;if(je)ae.push(_.instancedDataBuffer),fe.draw(g,j.gl.TRIANGLES,B,Cn.disabled,xe,Ve,de,a.id,Q.vertexBuffer,Q.indexBuffer,Q.segments,a.paint,g.transform.zoom,void 0,ae,_.instancedDataArray.length);else{const Ne=N?"u_instance":"u_normal_matrix";for(let Ge=0;Ge<_.instancedDataArray.length;++Ge)de[Ne]=new Float32Array(_.instancedDataArray.arrayBuffer,64*Ge,16),fe.draw(g,j.gl.TRIANGLES,B,Cn.disabled,xe,Ve,de,a.id,Q.vertexBuffer,Q.indexBuffer,Q.segments,a.paint,g.transform.zoom,void 0,ae)}}if(d.children)for(const Q of d.children)Wy(g,a,Q,_,y,b,T)}const B2=[1,-1,1];function b0(g,a,d,_){if(!d.modelManager)return!0;const y=d.modelManager;if(!d.shadowRenderer)return!0;const b=d.shadowRenderer,T=a.aabb;let j=!0,N=g.maxHeight;if(N===0){let B=0;for(const X in g.instancesPerModel){const q=y.getModel(X,_);q?B=Math.max(B,Math.max(Math.max(q.aabb.max[0],q.aabb.max[1]),q.aabb.max[2])):j=!1}N=g.maxScale*B*1.41+g.maxVerticalOffset,j&&(g.maxHeight=N)}T.max[2]=N,T.min[2]+=g.terrainElevationMin,T.max[2]+=g.terrainElevationMax,i.af(T.min,T.min,a.tileMatrix),i.af(T.max,T.max,a.tileMatrix);const L=T.intersects(b.getCurrentCascadeFrustum());return d.currentShadowCascade===0&&(g.isInsideFirstShadowMapFrustum=L===2),L===0}function hg(g,a){const d=g.uniformValues.u_cutoff_params[0],_=g.uniformValues.u_cutoff_params[1],y=g.uniformValues.u_cutoff_params[2],b=g.uniformValues.u_cutoff_params[3];return _===d||b===y?1:i.aA(((a-d)/(_-d)-y)/(b-y),0,1)}function Dh(g,a,d,_){if(a.pitch<20)return 1;const y=a.getWorldToCameraMatrix();i.aB(y,y,g);const b=i.bT(d.min[0],d.min[1],d.min[2],1);let T=i.aC(i.eF(),b,y),j=T,N=T;b[1]=d.max[1],T=i.aC(i.eF(),b,y),j=T[1]<j[1]?T:j,N=T[1]>N[1]?T:N,b[0]=d.max[0],T=i.aC(i.eF(),b,y),j=T[1]<j[1]?T:j,N=T[1]>N[1]?T:N,b[1]=d.min[1],T=i.aC(i.eF(),b,y),j=T[1]<j[1]?T:j,N=T[1]>N[1]?T:N;const L=i.aA(_[0],0,1),B=100*a.pixelsPerMeter*i.aA(_[1],0,1),X=i.aA(_[2],0,1),q=i.eG(i.eF(),j,N,L),Q=Math.tan(.5*a.fovX),re=-q[2]*Q;if(B===0)return q[1]<-Math.abs(re)?X:1;const ae=(-Math.abs(re)-q[1])/B,fe=(xe,je,we)=>(1-we)*xe+we*je,de=i.aA(fe(1,X,ae),X,1);return fe(1,de,i.aA((a.pitch-20)/20,0,1))}class U2{}class V2{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(a,d,_){{const X=this._storage.get(d.id);if(X)return X.lastUsedFrameIdx=a,X.buf}const y=_.gl,b=y.getBufferParameter(y.ELEMENT_ARRAY_BUFFER,y.BUFFER_SIZE),T=new ArrayBuffer(b),j=new Int16Array(T);y.getBufferSubData(y.ELEMENT_ARRAY_BUFFER,0,new Int16Array(T));const N=new i.eI;for(let X=0;X<b/2;X+=3){const q=j[X],Q=j[X+1],re=j[X+2];N.emplaceBack(q,Q),N.emplaceBack(Q,re),N.emplaceBack(re,q)}const L=_.bindVertexArrayOES.current,B=new U2;return B.buf=new Od(_,N),B.lastUsedFrameIdx=a,this._storage.set(d.id,B),_.bindVertexArrayOES.set(L),B.buf}update(a){for(const[d,_]of this._storage)a-_.lastUsedFrameIdx>30&&(_.buf.destroy(),this._storage.delete(d))}destroy(){for(const[a,d]of this._storage)d.buf.destroy(),this._storage.delete(a)}}class nj{constructor(a){this.occluderSize=30,this.depthOffset=-1e-4,a.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),a.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const $2=i.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class ij{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Po{constructor(a,d){this.revealStart=11,this.revealRange=2,a.registerParameter(this,[...d,"Reveal"],"revealStart",{min:0,max:17,step:.05}),a.registerParameter(this,[...d,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const sj=i.eh([{type:"Float32",name:"a_pos_2f",components:2}]);class fg{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(a,d){const _=a.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const T=new i.eJ,j=new i.b0;T.emplaceBack(-1,-1),T.emplaceBack(1,-1),T.emplaceBack(1,1),T.emplaceBack(-1,1),j.emplaceBack(0,1,2),j.emplaceBack(0,2,3),this.vignetteVx=a.context.createVertexBuffer(T,sj.members),this.vignetteIdx=a.context.createIndexBuffer(j)}const y=i.bf.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){a.uploadCommonUniforms(a.context,_);const T={u_vignetteShape:(b={vignetteShape:[d.start,d.range,Math.pow(10,d.fadePower)],vignetteColor:[d.color.r,d.color.g,d.color.b,d.color.a*d.strength]}).vignetteShape,u_vignetteColor:b.vignetteColor};_.draw(a,a.context.gl.TRIANGLES,Rr.disabled,Cn.disabled,Vn.alphaBlended,yn.disabled,T,"vignette",this.vignetteVx,this.vignetteIdx,y)}var b}}class _s{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(a,d){const _=a.getFreeCameraOptions().position,y=_.toAltitude(),b=_.toLngLat(),T=i.an(b.lng),j=i.an(b.lat),N=a.pixelsPerMeter/d,L=T*i.eL,B=i.eL*Math.log(Math.tan(Math.PI/4+j/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const X=-this._offsetYPrev+B,q=-this._elevationPrev+y;this._accumulatedOffsetX+=(-this._offsetXPrev+L)*N,this._accumulatedOffsetY+=X*N,this._accumulatedElevation+=q*N,this._offsetXPrev=L,this._offsetYPrev=B,this._elevationPrev=y}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Kn(g,a){return[-(g[0]-Math.floor(g[0]/a)*a),-(g[1]-Math.floor(g[1]/a)*a),-(g[2]-Math.floor(g[2]/a)*a)]}function Hy(g){const a=i.eq(1323123451230),d=[];for(let _=0;_<g;++_){const y=2*a()-1,b=2*a()-1,T=2*a()-1;d.push(i.d4(y,b,T))}return d}function tl(g,a,d,_,y){const b=i.aA((y-d)/(_-d),0,1);return(1-b)*g+b*a}class Rh{constructor(a){this._movement=new _s,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new fg,this._ppmScaleFactor=a}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(a,d){const _=a.transform;this._movement.update(_,this._ppmScaleFactor);const y=_.starsProjMatrix,b=i.c6([]);i.c8(b,b,i.an(90)-_._pitch),i.c7(b,b,-_.angle);const T=i.cb(new Float32Array(16),b),j=i.eK(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),N=i.ef([],j),L=i.aB([],N,T),B=Date.now()/1e3;return this._accumulatedTimeFromStart+=(B-this._prevTime)*d,this._prevTime=B,{projectionMatrix:y,modelviewMatrix:L}}}class tp extends Rh{constructor(a){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Po(a.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(a){const d=a.context;if(!this.particlesVx){const _=Hy(this.particlesCount),y=new i.eM,b=new i.b0;let T=0;const j=i.eq(1323123451230);for(let N=0;N<_.length;++N){const L=_[N],B=[2*j()-1,j(),j(),j()];y.emplaceBack(L[0],L[1],L[2],-1,-1,...B),y.emplaceBack(L[0],L[1],L[2],1,-1,...B),y.emplaceBack(L[0],L[1],L[2],1,1,...B),y.emplaceBack(L[0],L[1],L[2],-1,1,...B),b.emplaceBack(T+0,T+1,T+2),b.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=d.createVertexBuffer(y,$2.members),this.particlesIdx=d.createIndexBuffer(b)}}draw(a){if(!this._params.overrideStyleParameters&&!a.style.rain)return;const d=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},_=a.transform.zoom;if(d.revealStart>_)return;const y=tl(0,1,d.revealStart,d.revealStart+d.revealRange,_);if(!this.particlesVx||!this.particlesIdx)return;const b=structuredClone(this._params);let T=[-b.direction.x,b.direction.y,-100];i.aw(T,T);const j=structuredClone(this._vignetteParams);j.strength*=y,b.overrideStyleParameters||(b.intensity=a.style.rain.state.density,b.timeFactor=a.style.rain.state.intensity,b.color=structuredClone(a.style.rain.state.color),T=structuredClone(a.style.rain.state.direction),b.screenThinning.intensity=a.style.rain.state.centerThinning,b.dropletSizeX=a.style.rain.state.dropletSize[0],b.dropletSizeYScale=a.style.rain.state.dropletSize[1]/a.style.rain.state.dropletSize[0],b.distortionStrength=100*a.style.rain.state.distortionStrength,j.strength=1,j.color=structuredClone(a.style.rain.state.vignetteColor));const N=this.updateOnRender(a,b.timeFactor),L=a.context,B=L.gl,X=a.transform;this.screenTexture&&this.screenTexture.size[0]===a.width&&this.screenTexture.size[1]===a.height||(this.screenTexture=new i.T(L,{width:a.width,height:a.height,data:null},B.RGBA8)),b.distortionStrength>0&&(L.activeTexture.set(B.TEXTURE0),this.screenTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),B.copyTexSubImage2D(B.TEXTURE_2D,0,0,0,0,0,a.width,a.height));const q=a.getOrCreateProgram("rainParticle");a.uploadCommonUniforms(L,q),L.activeTexture.set(B.TEXTURE0),this.screenTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE);const Q=[b.color.r,b.color.g,b.color.b,b.color.a],re=(ae,fe)=>{const de=Kn(this._movement.getPosition(),ae),xe=b.dropletSizeX,je=b.dropletSizeX*b.dropletSizeYScale,we=a.width/2,Ve=a.height/2,Ne=tl(0,b.screenThinning.start,0,1,b.screenThinning.intensity),Ge=tl(.001,b.screenThinning.range,0,1,b.screenThinning.intensity),Be=tl(0,b.screenThinning.particleOffset,0,1,b.screenThinning.intensity),De=(We={modelview:N.modelviewMatrix,projection:N.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:de,velocityConeAperture:b.velocityConeAperture,velocity:b.velocity,boxSize:ae,rainDropletSize:[xe,je],distortionStrength:b.distortionStrength,rainDirection:T,color:Q,screenSize:[X.width,X.height],thinningCenterPos:[we,Ve],thinningShape:[Ne,Ge,Math.pow(10,b.screenThinning.fadePower)],thinningAffectedRatio:b.screenThinning.affectedRatio,thinningParticleOffset:Be,shapeDirectionalPower:b.shapeDirPower,shapeNormalPower:b.shapeNormalPower,mode:fe?0:1},{u_modelview:Float32Array.from(We.modelview),u_projection:Float32Array.from(We.projection),u_time:We.time,u_cam_pos:We.camPos,u_texScreen:0,u_velocityConeAperture:We.velocityConeAperture,u_velocity:We.velocity,u_boxSize:We.boxSize,u_rainDropletSize:We.rainDropletSize,u_distortionStrength:We.distortionStrength,u_rainDirection:We.rainDirection,u_color:We.color,u_screenSize:We.screenSize,u_thinningCenterPos:We.thinningCenterPos,u_thinningShape:We.thinningShape,u_thinningAffectedRatio:We.thinningAffectedRatio,u_thinningParticleOffset:We.thinningParticleOffset,u_shapeDirectionalPower:We.shapeDirectionalPower,u_shapeNormalPower:We.shapeNormalPower,u_mode:We.mode});var We;const st=Math.round(b.intensity*this.particlesCount),rt=i.bf.simpleSegment(0,0,4*st,2*st);q.draw(a,B.TRIANGLES,Rr.disabled,Cn.disabled,Vn.alphaBlended,yn.disabled,De,"rain_particles",this.particlesVx,this.particlesIdx,rt)};b.distortionStrength>0&&re(b.boxSize,!0),re(b.boxSize,!1),this._vignette.draw(a,j)}}const qu=i.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Zy extends Rh{constructor(a){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Po(a.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(a){const d=a.context;if(!this.particlesVx){const _=Hy(this.particlesCount),y=new i.eN,b=new i.b0;let T=0;const j=i.eq(1323123451230);for(let N=0;N<_.length;++N){const L=_[N],B=j(),X=j(),q=j(),Q=[N/_.length,B,X,q],re=[j(),j()];y.emplaceBack(L[0],L[1],L[2],-1,-1,...Q,...re),y.emplaceBack(L[0],L[1],L[2],1,-1,...Q,...re),y.emplaceBack(L[0],L[1],L[2],1,1,...Q,...re),y.emplaceBack(L[0],L[1],L[2],-1,1,...Q,...re),b.emplaceBack(T+0,T+1,T+2),b.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=d.createVertexBuffer(y,qu.members),this.particlesIdx=d.createIndexBuffer(b)}}draw(a){if(!this._params.overrideStyleParameters&&!a.style.snow)return;const d=structuredClone(this._params);let _=[-d.direction.x,d.direction.y,-100];i.aw(_,_);const y=structuredClone(this._vignetteParams),b=d.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},T=a.transform.zoom;if(b.revealStart>T)return;const j=tl(0,1,b.revealStart,b.revealStart+b.revealRange,T);y.strength*=j,d.overrideStyleParameters||(d.intensity=a.style.snow.state.density,d.timeFactor=a.style.snow.state.intensity,d.color=structuredClone(a.style.snow.state.color),_=structuredClone(a.style.snow.state.direction),d.screenThinning.intensity=a.style.snow.state.centerThinning,d.billboardSize=2.79*a.style.snow.state.flakeSize,y.strength=1,y.color=structuredClone(a.style.snow.state.vignetteColor));const N=this.updateOnRender(a,d.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const L=a.context,B=L.gl,X=a.transform,q=a.getOrCreateProgram("snowParticle");a.uploadCommonUniforms(L,q),((Q,re,ae)=>{const fe=Kn(this._movement.getPosition(),Q),de=X.width/2,xe=X.height/2,je=tl(0,ae.screenThinning.start,0,1,ae.screenThinning.intensity),we=tl(.001,ae.screenThinning.range,0,1,ae.screenThinning.intensity),Ve=tl(0,ae.screenThinning.particleOffset,0,1,ae.screenThinning.intensity),Ne=(Ge={modelview:N.modelviewMatrix,projection:N.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:fe,velocityConeAperture:ae.velocityConeAperture,velocity:ae.velocity,horizontalOscillationRadius:ae.horizontalOscillationRadius,horizontalOscillationRate:ae.horizontalOscillationRate,boxSize:Q,billboardSize:1*ae.billboardSize,simpleShapeParameters:[ae.shapeFadeStart,ae.shapeFadePower],screenSize:[X.width,X.height],thinningCenterPos:[de,xe],thinningShape:[je,we,Math.pow(10,ae.screenThinning.fadePower)],thinningAffectedRatio:ae.screenThinning.affectedRatio,thinningParticleOffset:Ve,color:[ae.color.r,ae.color.g,ae.color.b,ae.color.a],direction:_},{u_modelview:Float32Array.from(Ge.modelview),u_projection:Float32Array.from(Ge.projection),u_time:Ge.time,u_cam_pos:Ge.camPos,u_velocityConeAperture:Ge.velocityConeAperture,u_velocity:Ge.velocity,u_horizontalOscillationRadius:Ge.horizontalOscillationRadius,u_horizontalOscillationRate:Ge.horizontalOscillationRate,u_boxSize:Ge.boxSize,u_billboardSize:Ge.billboardSize,u_simpleShapeParameters:Ge.simpleShapeParameters,u_screenSize:Ge.screenSize,u_thinningCenterPos:Ge.thinningCenterPos,u_thinningShape:Ge.thinningShape,u_thinningAffectedRatio:Ge.thinningAffectedRatio,u_thinningParticleOffset:Ge.thinningParticleOffset,u_particleColor:Ge.color,u_direction:Ge.direction});var Ge;const Be=Math.round(ae.intensity*this.particlesCount),De=i.bf.simpleSegment(0,0,4*Be,2*Be);this.particlesVx&&this.particlesIdx&&q.draw(a,B.TRIANGLES,Rr.disabled,Cn.disabled,Vn.alphaBlended,yn.disabled,Ne,"snow_particles",this.particlesVx,this.particlesIdx,De)})(d.boxSize,0,d),this._vignette.draw(a,y)}}const Xy={symbol:function(g,a,d,_,y){if(g.renderPass!=="translucent")return;const b=Cn.disabled,T=g.colorModeForRenderPass(),j=d.layout.get("text-variable-anchor"),N=d.layout.get("text-size-scale-range"),L=i.aA(g.scaleFactor,N[0],N[1]);j&&function(q,Q,re,ae,fe,de,xe,je){const we=Q.transform,Ve=fe==="map",Ne=de==="map";for(const Ge of q){const Be=ae.getTile(Ge),De=Be.getBucket(re);if(!De||!De.text||!De.text.segments.get().length)continue;const We=i.bJ(De.textSizeData,we.zoom,je),st=O_(Ge,De.getProjection(),we),rt=we.calculatePixelsToTileUnitsMatrix(Be),bt=If(st,Be.tileID.canonical,Ne,Ve,we,De.getProjection(),rt),_t=De.hasIconTextFit()&&De.hasIconData();We&&g0(De,Ve,Ne,xe,we,bt,Ge,Math.pow(2,we.zoom-Be.tileID.overscaledZ),We,_t)}}(_,g,d,a,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),y,L);const B=d.paint.get("icon-opacity").constantOr(1)!==0,X=d.paint.get("text-opacity").constantOr(1)!==0;d.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(B||X)?ug(g,a,d,_,b,T):(B&&ug(g,a,d,_,b,T,{onlyIcons:!0}),X&&ug(g,a,d,_,b,T,{onlyText:!0})),a.map.showCollisionBoxes&&(cg(g,a,d,_,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),cg(g,a,d,_,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))},circle:function(g,a,d,_){if(g.renderPass!=="translucent")return;const y=d.paint.get("circle-opacity"),b=d.paint.get("circle-stroke-width"),T=d.paint.get("circle-stroke-opacity"),j=d.layout.get("circle-sort-key").constantOr(1)!==void 0,N=d.paint.get("circle-emissive-strength");if(y.constantOr(1)===0&&(b.constantOr(1)===0||T.constantOr(1)===0))return;const L=g.context,B=L.gl,X=g.transform,q=!(!g.terrain||!g.terrain.enabled),Q=d.layout.get("circle-elevation-reference"),re=g.depthModeForSublayer(0,Rr.ReadOnly),ae=new Rr(g.context.gl.LEQUAL,Rr.ReadOnly,g.depthRangeFor3D),fe=Q==="none"||q?re:ae,de=Cn.disabled,xe=g.colorModeForDrapableLayerRenderPass(N),je=X.projection.name==="globe",we=[i.aF(X.center.lng),i.aJ(X.center.lat)],Ve=[];for(let Ge=0;Ge<_.length;Ge++){const Be=_[Ge],De=a.getTile(Be),We=De.getBucket(d);if(!We||We.projection.name!==X.projection.name)continue;const st=We.programConfigurations.get(d.id),rt=We.layoutVertexBuffer,bt=We.globeExtVertexBuffer,_t=We.indexBuffer,kt=i.d$(d),nr=[bt],ht=g.isTileAffectedByFog(Be);je&&kt.push("PROJECTION_GLOBE_VIEW"),kt.push("DEPTH_D24"),g.terrain&&X.depthOcclusionForSymbolsAndCircles&&kt.push("DEPTH_OCCLUSION"),We.hasElevation&&!g.terrain&&(kt.push("ELEVATED_ROADS"),nr.push(We.elevatedLayoutVertexBuffer));const Ke=g.getOrCreateProgram("circle",{config:st,defines:kt,overrideFog:ht}),Pt=X.projection.createInversionMatrix(X,Be.canonical),xt={programConfiguration:st,program:Ke,layoutVertexBuffer:rt,dynamicBuffers:nr,indexBuffer:_t,uniformValues:i.e0(g,Be,De,Pt,we,d),tile:De};if(j){const qt=We.segments.get();for(const or of qt)Ve.push({segments:new i.bf([or]),sortKey:or.sortKey,state:xt})}else Ve.push({segments:We.segments,sortKey:0,state:xt})}j&&Ve.sort((Ge,Be)=>Ge.sortKey-Be.sortKey);const Ne={useDepthForOcclusion:X.depthOcclusionForSymbolsAndCircles};for(const Ge of Ve){const{programConfiguration:Be,program:De,layoutVertexBuffer:We,dynamicBuffers:st,indexBuffer:rt,uniformValues:bt,tile:_t}=Ge.state,kt=Ge.segments;g.terrain&&g.terrain.setupElevationDraw(_t,De,Ne),g.uploadCommonUniforms(L,De,_t.tileID.toUnwrapped()),De.draw(g,B.TRIANGLES,fe,de,xe,yn.disabled,bt,d.id,We,rt,kt,d.paint,X.zoom,Be,st)}},heatmap:function(g,a,d,_){if(d.paint.get("heatmap-opacity")!==0)if(g.renderPass==="offscreen"){const y=g.context,b=y.gl,T=Cn.disabled,j=new Vn([b.ONE,b.ONE,b.ONE,b.ONE],i.ao.transparent,[!0,!0,!0,!0]);(function(Q,re,ae,fe){const de=Q.gl,xe=re.width*fe,je=re.height*fe;Q.activeTexture.set(de.TEXTURE1),Q.viewport.set([0,0,xe,je]);let we=ae.heatmapFbo;if(!we||we&&(we.width!==xe||we.height!==je)){we&&we.destroy();const Ve=de.createTexture();de.bindTexture(de.TEXTURE_2D,Ve),de.texParameteri(de.TEXTURE_2D,de.TEXTURE_WRAP_S,de.CLAMP_TO_EDGE),de.texParameteri(de.TEXTURE_2D,de.TEXTURE_WRAP_T,de.CLAMP_TO_EDGE),de.texParameteri(de.TEXTURE_2D,de.TEXTURE_MIN_FILTER,de.LINEAR),de.texParameteri(de.TEXTURE_2D,de.TEXTURE_MAG_FILTER,de.LINEAR),we=ae.heatmapFbo=Q.createFramebuffer(xe,je,!0,null),function(Ne,Ge,Be,De,We,st){const rt=Ne.gl;rt.texImage2D(rt.TEXTURE_2D,0,Ne.extRenderToTextureHalfFloat?rt.RGBA16F:rt.RGBA,We,st,0,rt.RGBA,Ne.extRenderToTextureHalfFloat?rt.HALF_FLOAT:rt.UNSIGNED_BYTE,null),De.colorAttachment.set(Be)}(Q,0,Ve,we,xe,je)}else de.bindTexture(de.TEXTURE_2D,we.colorAttachment.get()),Q.bindFramebuffer.set(we.framebuffer)})(y,g,d,g.transform.projection.name==="globe"?.5:.25),y.clear({color:i.ao.transparent});const N=g.transform,L=N.projection.name==="globe",B=L?["PROJECTION_GLOBE_VIEW"]:[],X=L?yn.frontCCW:yn.disabled,q=[i.aF(N.center.lng),i.aJ(N.center.lat)];for(let Q=0;Q<_.length;Q++){const re=_[Q];if(a.hasRenderableParent(re))continue;const ae=a.getTile(re),fe=ae.getBucket(d);if(!fe||fe.projection.name!==N.projection.name)continue;const de=g.isTileAffectedByFog(re),xe=fe.programConfigurations.get(d.id),je=g.getOrCreateProgram("heatmap",{config:xe,defines:B,overrideFog:de}),{zoom:we}=g.transform;g.terrain&&g.terrain.setupElevationDraw(ae,je),g.uploadCommonUniforms(y,je,re.toUnwrapped());const Ve=N.projection.createInversionMatrix(N,re.canonical);je.draw(g,b.TRIANGLES,Rr.disabled,T,j,X,N2(g,re,ae,Ve,q,we,d.paint.get("heatmap-intensity")),d.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,d.paint,g.transform.zoom,xe,L?[fe.globeExtVertexBuffer]:null)}y.viewport.set([0,0,g.width,g.height])}else g.renderPass==="translucent"&&(g.context.setColorMode(g.colorModeForRenderPass()),function(y,b){const T=y.context,j=T.gl,N=b.heatmapFbo;if(!N)return;T.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,N.colorAttachment.get()),T.activeTexture.set(j.TEXTURE1);let L=b.colorRampTexture;L||(L=b.colorRampTexture=new i.T(T,b.colorRamp,j.RGBA8)),L.bind(j.LINEAR,j.CLAMP_TO_EDGE),y.getOrCreateProgram("heatmapTexture").draw(y,j.TRIANGLES,Rr.disabled,Cn.disabled,y.colorModeForRenderPass(),yn.disabled,((B,X,q,Q)=>({u_image:0,u_color_ramp:1,u_opacity:X.paint.get("heatmap-opacity")}))(0,b),b.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,b.paint,y.transform.zoom)}(g,d))},line:function(g,a,d,_){if(g.renderPass!=="translucent")return;const y=d.paint.get("line-opacity"),b=d.paint.get("line-width");if(y.constantOr(1)===0||b.constantOr(1)===0)return;const T=d.paint.get("line-emissive-strength"),j=d.paint.get("line-occlusion-opacity"),N=d.layout.get("line-elevation-reference"),L=d.layout.get("line-width-unit")==="meters",B=N==="sea",X=!(!g.terrain||!g.terrain.enabled),q=g.context,Q=q.gl;if(d.hasElevatedBuckets&&g.transform.projection.name==="globe")return;const re=d.layout.get("line-cross-slope"),ae=re!==void 0,fe=re<1,de=g.colorModeForDrapableLayerRenderPass(T),xe=g.terrain&&g.terrain.renderingToTexture,je=xe?1:i.o.devicePixelRatio,we=d.paint.get("line-dasharray"),Ve=we.constantOr(1),Ne=d.layout.get("line-cap"),Ge=we.constantOr(null),Be=Ne.constantOr(null),De=d.paint.get("line-pattern"),We=De.constantOr(1),st=d.paint.get("line-pattern-cross-fade"),rt=De.constantOr(null),bt=d.paint.get("line-opacity").constantOr(1);let _t=!We&&bt!==1||g.depthOcclusion&&j>0&&j<1;const kt=d.paint.get("line-gradient"),nr=We?"linePattern":"line",ht=i.e1(d);let Ke;if(xe&&g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&(_t=!1),j!==0&&g.depthOcclusion){const or=d.paint._values["line-opacity"];or&&or.value&&or.value.kind==="constant"?Ke=or.value:i.w(`Occlusion opacity for layer ${d.id} is supported only when line-opacity isn't data-driven.`)}b.value.kind!=="constant"&&b.value.isLineProgressConstant===!1&&ht.push("VARIABLE_LINE_WIDTH");const Pt=(or,Ar,tr,sr,kr,yr)=>{for(const gr of or){const wr=a.getTile(gr);if(We&&!wr.patternsLoaded())continue;const on=wr.getBucket(d);if(!on||on.elevationType!=="none"&&!kr||on.elevationType==="none"&&kr)continue;g.prepareDrawTile();const Jn=[...Ar],ui=g.shadowRenderer,Xi=on.elevationType==="road"&&!!ui&&ui.enabled;let wn=[0,0,0];if(Xi){const Tn=g.style.directionalLight,pi=g.style.ambientLight;Tn&&pi&&(wn=ac(g.style,Tn,pi)),Jn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const li=on.programConfigurations.get(d.id);let Fn=!1;if(rt&&wr.imageAtlas){const Tn=i.e2.from(rt),pi=Tn.getPrimary().scaleSelf(je).toString(),Cs=wr.imageAtlas.patternPositions.get(pi),ra=Tn.getSecondary(),Ls=ra?wr.imageAtlas.patternPositions.get(ra.scaleSelf(je).toString()):null;Fn=!!Cs&&!!Ls,Cs&&li.setConstantPatternPositions(Cs,Ls)}st>0&&(Fn||li.getPatternTransitionVertexBuffer("line-pattern"))&&Jn.push("LINE_PATTERN_TRANSITION");const Wi=g.isTileAffectedByFog(gr),di=g.getOrCreateProgram(nr,{config:li,defines:Jn,overrideFog:Wi});if(!We&&Ge&&Be&&wr.lineAtlas){const Tn=wr.lineAtlas.getDash(Ge,Be);Tn&&li.setConstantPatternPositions(Tn)}Xi&&ui.setupShadows(wr.tileID.toUnwrapped(),di,"vector-tile");let[rs,bi]=d.paint.get("line-trim-offset");(Be==="round"||Be==="square")&&rs!==bi&&(rs===0&&(rs-=1),bi===1&&(bi+=1));const Ln=xe?gr.projMatrix:null,ki=L?1/on.tileToMeter/i.ay(wr,1,g.transform.zoom):1,qn=L?1/on.tileToMeter/i.ay(wr,1,Math.floor(g.transform.zoom)):1,ps=We?i.e3(g,wr,d,Ln,je,ki,qn,[rs,bi],wn,st):i.e4(g,wr,d,Ln,on.lineClipsArray.length,je,ki,qn,[rs,bi],wn);if(kt){const Tn=on.gradients[d.id];let pi=Tn.texture;if(d.gradientVersion!==Tn.version){let Cs=256;if(d.stepInterpolant){const ra=a.getSource().maxzoom,Ls=gr.canonical.z===ra?Math.ceil(1<<g.transform.maxZoom-gr.canonical.z):1;Cs=i.aA(i.e5(on.maxLineLength/i.al*1024*Ls),256,q.maxTextureSize)}Tn.gradient=i.e6({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:Cs,image:Tn.gradient||void 0,clips:on.lineClipsArray}),Tn.texture?Tn.texture.update(Tn.gradient):Tn.texture=new i.T(q,Tn.gradient,Q.RGBA8),Tn.version=d.gradientVersion,pi=Tn.texture}q.activeTexture.set(Q.TEXTURE1),pi.bind(d.stepInterpolant?Q.NEAREST:Q.LINEAR,Q.CLAMP_TO_EDGE)}Ve&&(q.activeTexture.set(Q.TEXTURE0),wr.lineAtlasTexture&&wr.lineAtlasTexture.bind(Q.LINEAR,Q.REPEAT),li.updatePaintBuffers()),We&&(q.activeTexture.set(Q.TEXTURE0),wr.imageAtlasTexture&&wr.imageAtlasTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),li.updatePaintBuffers()),kr&&!B&&g.terrain.setupElevationDraw(wr,di),g.uploadCommonUniforms(q,di,gr.toUnwrapped());const Mi=Tn=>{Ke!=null&&(Ke.value=bt*j),di.draw(g,Q.TRIANGLES,tr,Tn,de,yn.disabled,ps,d.id,on.layoutVertexBuffer,on.indexBuffer,on.segments,d.paint,g.transform.zoom,li,[on.layoutVertexBuffer2,on.patternVertexBuffer,on.zOffsetVertexBuffer]),Ke!=null&&(Ke.value=bt)};if(_t&&!kr){const Tn=g.stencilModeForClipping(gr).ref;Tn===0&&xe&&q.clear({stencil:0});const pi={func:Q.EQUAL,mask:255};ps.u_alpha_discard_threshold=.8,Mi(new Cn(pi,Tn,255,Q.KEEP,Q.KEEP,Q.INVERT)),ps.u_alpha_discard_threshold=0,Mi(new Cn(pi,Tn,255,Q.KEEP,Q.KEEP,Q.KEEP))}else ps.u_alpha_discard_threshold=_t&&kr&&yr?.8:0,Mi(kr?sr:g.stencilModeForClipping(gr))}};let xt=g.depthModeForSublayer(0,Rr.ReadOnly);const qt=new Rr(g.depthOcclusion?Q.GREATER:Q.LEQUAL,Rr.ReadOnly,g.depthRangeFor3D);if(d.hasNonElevatedBuckets){const or=!xe&&g.terrain;j!==0&&or?i.w(`Occlusion opacity for layer ${d.id} is supported on terrain only if the layer has line-z-offset enabled.`):or?i.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${d.id}.`):Pt(_,ht,xt,Cn.disabled,!1,!0)}if(d.hasElevatedBuckets){N==="hd-road-markup"?X||(xt=qt,ht.push("ELEVATED_ROADS")):(ht.push("ELEVATED"),xt=qt,ae&&ht.push(fe?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),B&&ht.push("ELEVATION_REFERENCE_SEA"));const or=_t?g.stencilModeFor3D():Cn.disabled;g.forceTerrainMode=!0,Pt(_,ht,xt,or,!0,!0),_t&&Pt(_,ht,xt,or,!0,!1),g.forceTerrainMode=!1}_t&&(g.resetStencilClippingMasks(),xe&&q.clear({stencil:0})),j===0||g.depthOcclusion||xe||g.layersWithOcclusionOpacity.push(g.currentLayer)},fill:function(g,a,d,_){const y=d.paint.get("fill-color"),b=d.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const T=d.paint.get("fill-emissive-strength"),j=g.colorModeForDrapableLayerRenderPass(T),N=d.paint.get("fill-pattern"),L=g.opaquePassEnabledForLayer()&&!N.constantOr(1)&&y.constantOr(i.ao.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";let B="none";d.layout.get("fill-elevation-reference")!=="none"?B="road":d.paint.get("fill-z-offset").constantOr(1)!==0&&(B="offset");const X=!(!g.terrain||!g.terrain.enabled),q={painter:g,sourceCache:a,layer:d,coords:_,colorMode:j,elevationType:B,terrainEnabled:X,pass:L};if(g.renderPass!=="shadow")if(B!=="offset"){if(Zf(q,!1),B==="road"){const Q=!X&&g.renderPass==="translucent";Q&&kh(g,a,d,_,"geometry"),Zf(q,!0,Cn.disabled),Q&&function(re){const{painter:ae,sourceCache:fe,layer:de,coords:xe,colorMode:je}=re,we=ae.context.gl,Ve=re.painter.shadowRenderer,Ne=!!Ve&&Ve.enabled,Ge=new Rr(ae.context.gl.LEQUAL,Rr.ReadOnly,ae.depthRangeFor3D);let Be=[0,0,0];if(Ne){const We=ae.style.directionalLight,st=ae.style.ambientLight;We&&st&&(Be=ac(ae.style,We,st))}const De=We=>{for(const st of xe){const rt=fe.getTile(st),bt=rt.getBucket(de);if(!bt)continue;const _t=bt.elevatedStructures;if(!_t)continue;let kt,nr;if(We?(kt=_t.renderableBridgeSegments,nr=_t.bridgeProgramConfigurations.get(de.id)):(kt=_t.renderableTunnelSegments,nr=_t.tunnelProgramConfigurations.get(de.id)),!kt||kt.segments[0].primitiveLength===0)continue;nr.updatePaintBuffers(),ae.prepareDrawTile();const ht=ae.isTileAffectedByFog(st),Ke=[];Ne&&Ke.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const Pt=ae.getOrCreateProgram("elevatedStructures",{config:nr,overrideFog:ht,defines:Ke}),xt=ae.translatePosMatrix(st.projMatrix,rt,de.paint.get("fill-translate"),de.paint.get("fill-translate-anchor"));Ne&&Ve.setupShadows(rt.tileID.toUnwrapped(),Pt,"vector-tile");const qt=KA(xt,Be);ae.uploadCommonUniforms(ae.context,Pt,st.toUnwrapped()),Pt.draw(ae,we.TRIANGLES,Ge,Cn.disabled,je,yn.backCCW,qt,de.id,_t.vertexBuffer,_t.indexBuffer,kt,de.paint,ae.transform.zoom,nr,[_t.vertexBufferNormal])}};De(!0),De(!1)}(q)}}else Zf(q,!1,g.stencilModeFor3D());else g.shadowRenderer&&B==="road"&&!X&&function(Q){const{painter:re,sourceCache:ae,layer:fe,coords:de}=Q,xe=re.context.gl,je=Q.painter.shadowRenderer;for(const we of de){const Ve=ae.getTile(we),Ne=Ve.getBucket(fe);if(!Ne)continue;const Ge=Ne.elevatedStructures;if(!Ge||!Ge.shadowCasterSegments||Ge.shadowCasterSegments.segments[0].primitiveLength===0)continue;re.prepareDrawTile();const Be=Ne.bufferData.programConfigurations.get(fe.id),De=re.isTileAffectedByFog(we),We=re.getOrCreateProgram("elevatedStructuresDepth",{config:Be,overrideFog:De}),st=je.calculateShadowPassMatrixFromTile(Ve.tileID.toUnwrapped());re.uploadCommonUniforms(re.context,We,we.toUnwrapped());const rt={u_matrix:st,u_depth_bias:0};We.draw(re,xe.TRIANGLES,je.getShadowPassDepthMode(),Cn.disabled,je.getShadowPassColorMode(),yn.disabled,rt,fe.id,Ge.vertexBuffer,Ge.indexBuffer,Ge.shadowCasterSegments,fe.paint,re.transform.zoom,Be)}}(q)},"fill-extrusion":function(g,a,d,_){const y=d.paint.get("fill-extrusion-opacity"),b=g.context,T=b.gl,j=g.terrain,N=j&&j.renderingToTexture;if(y===0)return;const L=g.conflationActive&&g.style.isLayerClipped(d,a.getSource()),B=g.style.order.indexOf(d.fqid);if(L&&function(X,q,Q,re,ae){for(const fe of re){const de=q.getTile(fe).getBucket(Q);de&&(de.updateReplacement(fe,X.replacementSource,ae),de.uploadCentroid(X.context))}}(g,a,d,_,B),j||L)for(const X of _){const q=a.getTile(X).getBucket(d);q&&Ld(g.context,a,X,q,d,j,L)}if(g.renderPass==="shadow"&&g.shadowRenderer){const X=g.shadowRenderer;if(j&&y<.65&&d._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof i.ad)return;const q=X.getShadowPassDepthMode(),Q=X.getShadowPassColorMode();Tr(g,a,d,_,q,Cn.disabled,Q,L)}else if(g.renderPass==="translucent"){const X=!d.paint.get("fill-extrusion-pattern").constantOr(1),q=d.paint.get("fill-extrusion-color").constantOr(i.ao.white);if(!N&&q.a!==0){const Q=new Rr(g.context.gl.LEQUAL,Rr.ReadWrite,g.depthRangeFor3D);y===1&&X?Tr(g,a,d,_,Q,Cn.disabled,Vn.unblended,L):(Tr(g,a,d,_,Q,Cn.disabled,Vn.disabled,L),Tr(g,a,d,_,Q,g.stencilModeFor3D(),g.colorModeForRenderPass(),L),g.resetStencilClippingMasks())}if(g.style.enable3dLights()&&X&&(!j&&g.transform.projection.name!=="globe"||N)){const Q=d.paint.get("fill-extrusion-opacity"),re=d.paint.get("fill-extrusion-ambient-occlusion-intensity"),ae=d.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),fe=d.paint.get("fill-extrusion-flood-light-intensity"),de=d.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",xe=d.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(de?null:d.lut).toArray01().slice(0,3),je=re>0&&ae>0,we=fe>0,Ve=(Be,De,We)=>(1-We)*Be+We*De,Ne=new Ry;Ne.translate=d.paint.get("fill-extrusion-translate"),Ne.translateAnchor=d.paint.get("fill-extrusion-translate-anchor"),Ne.edgeRadius=d.layout.get("fill-extrusion-edge-radius"),Ne.cutoffFadeRange=d.paint.get("fill-extrusion-cutoff-fade-range");const Ge=Be=>{const De=g.depthModeForSublayer(1,Rr.ReadOnly,T.LEQUAL,!0),We=d.paint.get(Be?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),st=Ve(.1,3,We),rt=g._showOverdrawInspector;if(!rt){const bt=new Cn({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),_t=new Vn([T.ONE,T.ONE,T.ONE,T.ONE],i.ao.transparent,[!1,!1,!1,!0],T.MIN);Vu(Ne,g,a,d,_,De,bt,_t,yn.disabled,Be,"sdf",Q,re,ae,fe,xe,st,L,!1)}{const bt=rt?Cn.disabled:new Cn({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),_t=rt?g.colorModeForRenderPass():new Vn([T.ONE_MINUS_DST_ALPHA,T.DST_ALPHA,T.ONE,T.ONE],i.ao.transparent,[!0,!0,!0,!0]);Vu(Ne,g,a,d,_,De,bt,_t,yn.disabled,Be,"color",Q,re,ae,fe,xe,st,L,!1)}};if(N){const Be=(De,We,st)=>{const rt=g.depthModeForSublayer(1,Rr.ReadOnly,T.LEQUAL,!1),bt=d.paint.get(De?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),_t=Ve(.1,3,bt);{const kt=new Vn([T.ONE,T.ONE,T.ONE,T.ONE],i.ao.transparent,[!1,!1,!1,!0]);Vu(Ne,g,a,d,_,rt,Cn.disabled,kt,yn.disabled,De,"clear",Q,re,ae,fe,xe,_t,L,We)}{const kt=new Cn({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),nr=new Vn([T.ONE,T.ONE,T.ONE,T.ONE],i.ao.transparent,[!1,!1,!1,!0],T.MIN);Vu(Ne,g,a,d,_,rt,kt,nr,yn.disabled,De,"sdf",Q,re,ae,fe,xe,_t,L,We)}{const kt=De?T.ZERO:T.ONE_MINUS_DST_ALPHA,nr=new Cn({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),ht=new Vn([kt,T.DST_ALPHA,T.ONE_MINUS_DST_ALPHA,T.ZERO],i.ao.transparent,[!0,!0,!0,!0]);Vu(Ne,g,a,d,_,rt,nr,ht,yn.disabled,De,"color",Q,re,ae,fe,xe,_t,L,We)}{const kt=new Vn([T.ONE,T.ONE,T.ONE,De?T.ZERO:T.ONE],i.ao.transparent,[!1,!1,!1,!0],De?T.FUNC_ADD:T.MAX);Vu(Ne,g,a,d,_,rt,Cn.disabled,kt,yn.disabled,De,"clear",Q,re,ae,fe,xe,_t,L,We,st)}};if(je||we){let De;if(g.prepareDrawTile(),j){const We=j.drapeBufferSize[0],st=j.drapeBufferSize[1];De=j.framebufferCopyTexture,De&&(!De||De.size[0]===We&&De.size[1]===st)||(De&&De.destroy(),De=j.framebufferCopyTexture=new i.T(b,new i.q({width:We,height:st}),T.RGBA8)),De.bind(T.LINEAR,T.CLAMP_TO_EDGE),T.copyTexSubImage2D(T.TEXTURE_2D,0,0,0,0,0,We,st)}je&&Be(!0,!1,De),we&&Be(!1,!0,De)}}else je&&Ge(!0),we&&Ge(!1),(je||we)&&g.resetStencilClippingMasks()}}},building:function(g,a,d,_){g.currentLayer<g.firstLightBeamLayer&&(g.firstLightBeamLayer=g.currentLayer);const y=d.paint.get("building-ambient-occlusion-ground-intensity"),b=d.paint.get("building-ambient-occlusion-ground-radius"),T=d.paint.get("building-ambient-occlusion-ground-attenuation"),j=d.paint.get("building-opacity");if(j<=0)return;let N=y>0&&b>0,L=!0;const B=d.paint.get("building-vertical-scale");if(B<=0)return;(!g.shadowRenderer||B<1)&&(L=!1);const X=g.conflationActive&&g.style.isLayerClipped(d,a.getSource()),q=g.style.order.indexOf(d.fqid);if(function(Q,re,ae,fe,de,xe){for(const je of xe){const we=re.getTile(je).getBucket(ae);we&&(de&&we.updateReplacement(je,Q.replacementSource,fe),we.uploadUpdatedIndexBuffer(Q.context))}}(g,a,d,q,X,_),function(Q,re,ae,fe){for(const de of fe){const xe=re.getTile(de).getBucket(ae);xe&&xe.needsEvaluation()&&xe.uploadUpdatedColorBuffer(Q.context)}}(g,a,d,_),d.resetLayerRenderingStats(g),g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!0),g.renderPass==="shadow"&&g.shadowRenderer){const Q=g.shadowRenderer,re=[],ae=Q.getShadowPassDepthMode();x0({painter:g,source:a,layer:d,coords:_,defines:re,blendMode:Q.getShadowPassColorMode(),depthMode:ae,opacity:j,verticalScale:B,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(g.renderPass==="translucent"){let Q=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];L&&(Q=Q.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),g.shadowRenderer&&g.shadowRenderer.useNormalOffset&&(Q=Q.concat("NORMAL_OFFSET"));const re=d.paint.get("building-facade-emissive-chance"),ae=d.paint.get("building-ambient-occlusion-intensity"),fe=d.paint.get("building-flood-light-intensity"),de=d.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",xe=d.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(de?null:d.lut).toArray01().slice(0,3),je=d.paint.get("building-flood-light-ground-attenuation"),we=fe>0,Ve=new Rr(g.context.gl.LEQUAL,Rr.ReadWrite,g.depthRangeFor3D);j<1&&x0({painter:g,source:a,layer:d,coords:_,defines:Q,blendMode:Vn.disabled,depthMode:Ve,opacity:j,verticalScale:B,facadeEmissiveChance:re,facadeAOIntensity:ae,floodLightIntensity:fe,floodLightColor:xe,depthOnly:!0});const Ne=g.colorModeForRenderPass();x0({painter:g,source:a,layer:d,coords:_,defines:Q,blendMode:Ne,depthMode:Ve,opacity:j,verticalScale:B,facadeEmissiveChance:re,facadeAOIntensity:ae,floodLightIntensity:fe,floodLightColor:xe}),N&&v0(g,a,d,_,!0,j,y,b,fe,xe,T,X),we&&v0(g,a,d,_,!1,j,y,b,fe,xe,je,X)}else if(g.renderPass==="light-beam"){const Q=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],re=new Rr(g.context.gl.LEQUAL,Rr.ReadOnly,g.depthRangeFor3D);x0({painter:g,source:a,layer:d,coords:_,defines:Q,blendMode:Vn.alphaBlended,depthMode:re,opacity:j,verticalScale:B,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!1),g.resetStencilClippingMasks()},hillshade:function(g,a,d,_){if(g.renderPass!=="offscreen"&&g.renderPass!=="translucent"||g.style.disableElevatedTerrain)return;const y=g.context,b=g.terrain&&g.terrain.renderingToTexture,[T,j]=g.renderPass!=="translucent"||b?[{},_]:g.stencilConfigForOverlap(_);for(const N of j){const L=a.getTile(N);if(L.needsHillshadePrepare&&g.renderPass==="offscreen")BA(g,L,d);else if(g.renderPass==="translucent"){const B=g.depthModeForSublayer(0,Rr.ReadOnly),X=d.paint.get("hillshade-emissive-strength"),q=g.colorModeForDrapableLayerRenderPass(X),Q=b&&g.terrain?g.terrain.stencilModeForRTTOverlap(N):T[N.overscaledZ];zA(g,N,L,d,B,Q,q)}}y.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,a,d,_,y,b){if(g.renderPass!=="translucent"||d.paint.get("raster-opacity")===0)return;const T=g.transform.projection.name==="globe",j=d.paint.get("raster-elevation")!==0,N=j&&T;if(g.renderElevatedRasterBackface&&!N)return;const L=g.context,B=L.gl,X=a.getSource(),q=function(Ne,Ge,Be,De){const We=Ge.paint.get("raster-color"),st=Ne.type==="raster-array",rt=[],bt=Ge.paint.get("raster-resampling"),_t=Ge.paint.get("raster-color-mix");let kt=Ge.paint.get("raster-color-range");const nr=[_t[0],_t[1],_t[2],0],ht=_t[3];let Ke=bt==="nearest"?De.NEAREST:De.LINEAR;if(st&&(rt.push("RASTER_ARRAY"),We||rt.push("RASTER_COLOR"),bt==="linear"&&rt.push("RASTER_ARRAY_LINEAR"),Ke=De.NEAREST,!kt&&Ne.rasterLayers)){const Pt=Ne.rasterLayers.find(({id:xt})=>xt===Ge.sourceLayer);Pt&&Pt.fields&&Pt.fields.range&&(kt=Pt.fields.range)}if(kt=kt||[0,1],We){rt.push("RASTER_COLOR"),Be.activeTexture.set(De.TEXTURE2),Ge.updateColorRamp(kt);let Pt=Ge.colorRampTexture;Pt||(Pt=Ge.colorRampTexture=new i.T(Be,Ge.colorRamp,De.RGBA8)),Pt.bind(De.LINEAR,De.CLAMP_TO_EDGE)}return{mix:nr,range:kt,offset:ht,defines:rt,resampling:Ke}}(X,d,L,B);if(X instanceof i.aT&&!_.length&&!T)return;const Q=d.paint.get("raster-emissive-strength"),re=g.colorModeForDrapableLayerRenderPass(Q),ae=g.terrain&&g.terrain.renderingToTexture,fe=!g.options.moving,de=d.paint.get("raster-resampling")==="nearest"?B.NEAREST:B.LINEAR;if(X instanceof i.aT&&!_.length&&(X.onNorthPole||X.onSouthPole)){const Ne=j?g.stencilModeFor3D():Cn.disabled;return void Fy(!!X.onNorthPole,null,g,a,d,Q,q,yn.disabled,Ne)}if(!_.length)return;const[xe,je]=X instanceof i.aT||ae?[{},_]:g.stencilConfigForOverlap(_),we=je[je.length-1].overscaledZ;N&&q.defines.push("PROJECTION_GLOBE_VIEW"),j&&q.defines.push("RENDER_CUTOFF");const Ve=(Ne,Ge,Be)=>{for(const De of Ne){const We=De.toUnwrapped(),st=a.getTile(De);if(ae&&(!st||!st.hasData()))continue;L.activeTexture.set(B.TEXTURE0);const rt=ej(st,X,d,q);if(!rt||!rt.texture)continue;const{texture:bt,mix:_t,offset:kt,tileSize:nr,buffer:ht}=rt;let Ke,Pt;ae?(Ke=Rr.disabled,Pt=De.projMatrix):j?(Ke=new Rr(B.LEQUAL,Rr.ReadWrite,g.depthRangeFor3D),Pt=T?Float32Array.from(g.transform.expandedFarZProjMatrix):g.transform.calculateProjMatrix(We,fe)):(Ke=g.depthModeForSublayer(De.overscaledZ-we,d.paint.get("raster-opacity")===1?Rr.ReadWrite:Rr.ReadOnly,B.LESS),Pt=g.transform.calculateProjMatrix(We,fe));const xt=g.terrain&&ae?g.terrain.stencilModeForRTTOverlap(De):xe[De.overscaledZ],qt=b?0:d.paint.get("raster-fade-duration");st.registerFadeDuration(qt);const or=a.findLoadedParent(De,0),Ar=r0(st,or,a,g.transform,qt);let tr,sr;!Ar.isFading&&st.refreshedUponExpiration&&(st.refreshedUponExpiration=!1),g.terrain&&g.terrain.prepareDrawTile(),L.activeTexture.set(B.TEXTURE0),bt.bind(de,B.CLAMP_TO_EDGE),L.activeTexture.set(B.TEXTURE1),or?(or.texture&&or.texture.bind(de,B.CLAMP_TO_EDGE),tr=Math.pow(2,or.tileID.overscaledZ-st.tileID.overscaledZ),sr=[st.tileID.canonical.x*tr%1,st.tileID.canonical.y*tr%1]):bt.bind(de,B.CLAMP_TO_EDGE),"useMipmap"in bt&&L.extTextureFilterAnisotropic&&g.transform.pitch>20&&B.texParameterf(B.TEXTURE_2D,L.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,L.extTextureFilterAnisotropicMax);const kr=g.transform;let yr;const gr=j?R2(kr):[0,0,0,0];let wr,on,Jn,ui,Xi,wn=0;if(N&&X instanceof i.aT&&X.coordinates.length>3)wr=Float32Array.from(i.bj(i.dI(new i.cC(0,0,0)))),on=Float32Array.from(kr.globeMatrix),Jn=Float32Array.from(i.dE(kr)),ui=[i.aF(kr.center.lng),i.aJ(kr.center.lat)],yr=X.elevatedGlobePerspectiveTransform,Xi=X.elevatedGlobeGridMatrix||new Float32Array(9);else if(N){const di=i.dF(De.canonical);wn=i.dG(di.getCenter().lat),wr=Float32Array.from(i.bj(i.dI(De.canonical))),on=Float32Array.from(kr.globeMatrix),Jn=Float32Array.from(i.dE(kr)),ui=[i.aF(kr.center.lng),i.aJ(kr.center.lat)],yr=[0,0],Xi=Float32Array.from(i.dH(De.canonical,di,wn,kr.worldSize/kr._pixelsPerMercatorPixel))}else yr=X instanceof i.aT?X.perspectiveTransform:[0,0],wr=new Float32Array(16),on=new Float32Array(9),Jn=new Float32Array(16),ui=[0,0],Xi=new Float32Array(9);const li=lg(Pt,wr,on,Jn,Xi,sr||[0,0],i.aj(g.transform.zoom),ui,gr,tr||1,Ar,d,yr,j?d.paint.get("raster-elevation"):0,2,_t,kt,q.range,nr,ht,Q),Fn=g.isTileAffectedByFog(De),Wi=g.getOrCreateProgram("raster",{defines:q.defines,overrideFog:Fn});if(g.uploadCommonUniforms(L,Wi,We),X instanceof i.aT){const di=X.elevatedGlobeVertexBuffer,rs=X.elevatedGlobeIndexBuffer;if(ae||!T)X.boundsBuffer&&X.boundsSegments&&Wi.draw(g,B.TRIANGLES,Ke,Cn.disabled,re,yn.disabled,li,d.id,X.boundsBuffer,g.quadTriangleIndexBuffer,X.boundsSegments);else if(di&&rs){const bi=kr.zoom<=i.cZ?X.elevatedGlobeSegments:X.getSegmentsForLongitude(kr.center.lng);bi&&Wi.draw(g,B.TRIANGLES,Ke,Cn.disabled,re,Ge,li,d.id,di,rs,bi)}}else if(N){Ke=new Rr(B.LEQUAL,Rr.ReadOnly,g.depthRangeFor3D);const di=g.globeSharedBuffers;if(di){const[rs,bi,Ln]=di.getGridBuffers(wn,!1);Wi.draw(g,B.TRIANGLES,Ke,Be||xt,g.colorModeForRenderPass(),Ge,li,d.id,rs,bi,Ln)}}else{const{tileBoundsBuffer:di,tileBoundsIndexBuffer:rs,tileBoundsSegments:bi}=g.getTileBoundsBuffers(st);Wi.draw(g,B.TRIANGLES,Ke,xt,re,yn.disabled,li,d.id,di,rs,bi)}}if(!(X instanceof i.aT)&&N)for(const De of Ne){const We=De.canonical.y===(1<<De.canonical.z)-1;De.canonical.y===0&&Fy(!0,De,g,a,d,Q,q,Ge,Be||Cn.disabled),We&&Fy(!1,De,g,a,d,Q,q,Ge===yn.frontCW?yn.backCW:yn.frontCW,Be||Cn.disabled)}};N?Ve(je,g.renderElevatedRasterBackface?yn.backCW:yn.frontCW,g.stencilModeFor3D()):Ve(je,yn.disabled,void 0),g.resetStencilClippingMasks()},"raster-particle":function(g,a,d,_,y,b){g.renderPass==="offscreen"&&function(T,j,N,L){if(!L.length)return;const B=T.context,X=B.gl,q=j.getSource();if(!(q instanceof He))return;const Q=Math.ceil(Math.sqrt(N.paint.get("raster-particle-count")));let re=N.particlePositionRGBAImage;if(!re||re.width!==Q){const je=function(we){const Ve=we*we,Ne=new Uint8Array(4*Ve),Ge=function(De){return De|=0,De=Math.imul(2747636419^De,2654435769),De=Math.imul(De^De>>>16,2654435769),((De=Math.imul(De^De>>>16,2654435769))>>>0)/4294967296},Be=1/1.1;for(let De=0;De<Ve;De++){const We=Be*(Ge(2*De+0)+Nh),st=Be*(Ge(2*De+1)+Nh),rt=255*We%1,bt=255*st%1,_t=rt,kt=st-bt/255,nr=bt;Ne[4*De+0]=255*(We-rt/255),Ne[4*De+1]=255*_t,Ne[4*De+2]=255*kt,Ne[4*De+3]=255*nr}return Ne}(Q);re=N.particlePositionRGBAImage=new i.q({width:Q,height:Q},je)}let ae=N.particleFramebuffer;ae?ae.width!==Q&&(ae.destroy(),ae=N.particleFramebuffer=B.createFramebuffer(Q,Q,!0,null)):ae=N.particleFramebuffer=B.createFramebuffer(Q,Q,!0,null);const fe=[];for(const je of L){const we=j.getTile(je);if(!(we instanceof Bo))continue;const Ve=Ly(we,q,N);if(!Ve)continue;const Ne=[we.tileSize,we.tileSize];let Ge=N.tileFramebuffer;Ge||(Ge=N.tileFramebuffer=B.createFramebuffer(Ne[0],Ne[1],!0,null));let Be=we.rasterParticleState;Be||(Be=we.rasterParticleState=new gl(B,je,Ne,re));const De=Be.update(N.lastInvalidatedAt);Be.particleTextureDimension!==Q&&Be.updateParticleTexture(je,re);const We=Be.targetColorTexture;Be.targetColorTexture=Be.backgroundColorTexture,Be.backgroundColorTexture=We;const st=Be.particleTexture0;Be.particleTexture0=Be.particleTexture1,Be.particleTexture1=st,fe.push([je,Ve,Be,De])}if(fe.length===0)return;const de=i.o.now(),xe=N.previousDrawTimestamp?.001*(de-N.previousDrawTimestamp):.0167;if(N.previousDrawTimestamp=de,N.hasColorMap()){B.activeTexture.set(X.TEXTURE0+2);let je=N.colorRampTexture;je||(je=N.colorRampTexture=new i.T(B,N.colorRamp,X.RGBA8)),je.bind(X.LINEAR,X.CLAMP_TO_EDGE)}B.bindFramebuffer.set(N.tileFramebuffer.framebuffer),function(je,we,Ve){const Ne=je.context,Ge=Ne.gl,Be=we.tileFramebuffer;Ne.activeTexture.set(Ge.TEXTURE0);const De={u_texture:0,u_opacity:1.05*(st=we.paint.get("raster-particle-fade-opacity-factor"))/(st+.05)},We=je.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var st;for(const rt of Ve){const[,,bt,_t]=rt;Be.colorAttachment.set(bt.targetColorTexture.texture),Ne.viewport.set([0,0,Be.width,Be.height]),Ne.clear({color:i.ao.transparent}),_t&&(bt.backgroundColorTexture.bind(Ge.NEAREST,Ge.CLAMP_TO_EDGE),We.draw(je,Ge.TRIANGLES,Rr.disabled,Cn.disabled,Vn.alphaBlended,yn.disabled,De,we.id,je.viewportBuffer,je.quadTriangleIndexBuffer,je.viewportSegments))}}(T,N,fe),function(je,we,Ve,Ne){const Ge=je.context,Be=Ge.gl,De=Ve.tileFramebuffer,We=je.transform.projection.name==="globe",st=Ve.paint.get("raster-particle-max-speed");for(const rt of Ne){const[bt,_t,kt]=rt;Ge.activeTexture.set(Be.TEXTURE0+0),_t.texture.bind(Be.LINEAR,Be.CLAMP_TO_EDGE),De.colorAttachment.set(kt.targetColorTexture.texture);const nr=je.getOrCreateProgram("rasterParticleDraw",{defines:_t.defines,overrideFog:!1});Ge.activeTexture.set(Be.TEXTURE0+1);const ht=_t.scalarData?[]:[0,1,2,3].map(xt=>i.e8[xt](bt));ht.push(bt);const Ke=bt.canonical.x,Pt=bt.canonical.y;for(const xt of ht){const qt=we.getTile(We?xt.wrapped():xt);if(!qt)continue;const or=qt.rasterParticleState;if(!or)continue;const Ar=xt.canonical.x+(1<<xt.canonical.z)*(xt.wrap-bt.wrap),tr=xt.canonical.y;or.particleTexture0.bind(Be.NEAREST,Be.CLAMP_TO_EDGE);const sr=Iy(1,or.particleTexture0.size[0],[Ar-Ke,tr-Pt],0,_t.texture.size,2,st,_t.textureOffset,_t.scale,_t.offset);nr.draw(je,Be.POINTS,Rr.disabled,Cn.disabled,Vn.alphaBlended,yn.disabled,sr,Ve.id,or.particleIndexBuffer,void 0,or.particleSegment)}}}(T,j,N,fe),B.bindFramebuffer.set(N.particleFramebuffer.framebuffer),function(je,we,Ve,Ne){const Ge=je.context,Be=Ge.gl,De=we.paint.get("raster-particle-max-speed"),We=Ne*we.paint.get("raster-particle-speed-factor")*.15,st=function(bt){return Math.pow(bt,6)}(.01+1*we.paint.get("raster-particle-reset-rate-factor")),rt=we.particleFramebuffer;Ge.viewport.set([0,0,rt.width,rt.height]);for(const bt of Ve){const[,_t,kt]=bt;Ge.activeTexture.set(Be.TEXTURE0+0),_t.texture.bind(Be.LINEAR,Be.CLAMP_TO_EDGE),Ge.activeTexture.set(Be.TEXTURE0+1);const nr=kt.particleTexture0;nr.bind(Be.NEAREST,Be.CLAMP_TO_EDGE);const ht=c0(1,nr.size[0],0,_t.texture.size,De,We,st,_t.textureOffset,_t.scale,_t.offset);rt.colorAttachment.set(kt.particleTexture1.texture),Ge.clear({color:i.ao.transparent}),je.getOrCreateProgram("rasterParticleUpdate",{defines:_t.defines}).draw(je,Be.TRIANGLES,Rr.disabled,Cn.disabled,Vn.unblended,yn.disabled,ht,we.id,je.viewportBuffer,je.quadTriangleIndexBuffer,je.viewportSegments)}}(T,N,fe,xe)}(g,a,d,_),g.renderPass==="translucent"&&(function(T,j,N,L,B){const X=T.context,q=X.gl,Q=j.getSource().tileSize,re=5*(1-i.ah(i.cK,i.cK+1,T.transform.zoom))*Q+N.paint.get("raster-particle-elevation"),ae=!T.options.moving,fe=T.transform.projection.name==="globe";if(!L.length)return;const[de,xe]=T.stencilConfigForOverlap(L),je=[];fe&&je.push("PROJECTION_GLOBE_VIEW");const we=T.stencilModeFor3D();for(const Ve of xe){const Ne=Ve.toUnwrapped(),Ge=j.getTile(Ve);if(!Ge.rasterParticleState)continue;const Be=Ge.rasterParticleState,De=100;Ge.registerFadeDuration(De);const We=j.findLoadedParent(Ve,0),st=r0(Ge,We,j,T.transform,De);let rt,bt;T.terrain&&T.terrain.prepareDrawTile(),X.activeTexture.set(q.TEXTURE0),Be.targetColorTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),X.activeTexture.set(q.TEXTURE1),We&&We.rasterParticleState?(We.rasterParticleState.targetColorTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),rt=Math.pow(2,We.tileID.overscaledZ-Ge.tileID.overscaledZ),bt=[Ge.tileID.canonical.x*rt%1,Ge.tileID.canonical.y*rt%1]):Be.targetColorTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE);const _t=fe?Float32Array.from(T.transform.expandedFarZProjMatrix):T.transform.calculateProjMatrix(Ne,ae),kt=T.transform,nr=Uo(kt),ht=i.dF(Ve.canonical),Ke=i.dG(ht.getCenter().lat);let Pt,xt,qt,or,Ar;fe?(Pt=Float32Array.from(i.bj(i.dI(Ve.canonical))),xt=Float32Array.from(kt.globeMatrix),qt=Float32Array.from(i.dE(kt)),or=[i.aF(kt.center.lng),i.aJ(kt.center.lat)],Ar=Float32Array.from(i.dH(Ve.canonical,ht,Ke,kt.worldSize/kt._pixelsPerMercatorPixel))):(Pt=new Float32Array(16),xt=new Float32Array(9),qt=new Float32Array(16),or=[0,0],Ar=new Float32Array(9));const tr=Md(_t,Pt,xt,qt,Ar,bt||[0,0],i.aj(T.transform.zoom),or,nr,rt||1,st,re),sr=T.isTileAffectedByFog(Ve),kr=T.getOrCreateProgram("rasterParticle",{defines:je,overrideFog:sr});if(T.uploadCommonUniforms(X,kr,Ne),fe){const yr=new Rr(q.LEQUAL,Rr.ReadOnly,T.depthRangeFor3D),gr=0,wr=T.globeSharedBuffers;if(wr){const[on,Jn,ui]=wr.getGridBuffers(Ke,gr!==0);kr.draw(T,q.TRIANGLES,yr,we,Vn.alphaBlended,T.renderElevatedRasterBackface?yn.frontCCW:yn.backCCW,tr,N.id,on,Jn,ui)}}else{const yr=T.depthModeForSublayer(0,Rr.ReadOnly),gr=de[Ve.overscaledZ],{tileBoundsBuffer:wr,tileBoundsIndexBuffer:on,tileBoundsSegments:Jn}=T.getTileBoundsBuffers(Ge);kr.draw(T,q.TRIANGLES,yr,gr,Vn.alphaBlended,yn.disabled,tr,N.id,wr,on,Jn)}}T.resetStencilClippingMasks()}(g,a,d,_),g.style.map.triggerRepaint())},background:function(g,a,d,_){const y=d.paint.get("background-color"),b=d.paint.get("background-color-use-theme").constantOr("default")==="none",T=d.paint.get("background-opacity"),j=d.paint.get("background-emissive-strength"),N=d.paint.get("background-pitch-alignment")==="viewport";if(T===0)return;const L=g.context,B=L.gl,X=g.transform,q=X.tileSize,Q=d.paint.get("background-pattern");let re;if(Q!==void 0&&(Q===null||(re=g.imageManager.getPattern(i.I.from(Q.toString()),d.scope,g.style.getLut(d.scope)),!re)))return;const ae=!Q&&y.a===1&&T===1&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==ae)return;const fe=Cn.disabled,de=g.depthModeForSublayer(0,ae==="opaque"?Rr.ReadWrite:Rr.ReadOnly),xe=g.colorModeForDrapableLayerRenderPass(j),je=Q?"backgroundPattern":"background";let we,Ve=_;if(Ve||(we=g.getBackgroundTiles(),Ve=Object.values(we).map(Ne=>Ne.tileID)),Q&&(L.activeTexture.set(B.TEXTURE0),g.imageManager.bind(g.context,d.scope)),N){const Ne=g.getOrCreateProgram(je,{overrideFog:!1,overrideRtt:!0}),Ge=new Float32Array(i.bz([])),Be=new i.aP(0,0,0,0,0),De=Q?d0(Ge,j,T,g,0,d.scope,re,N,{tileID:Be,tileSize:q}):u0(Ge,j,T,y.toPremultipliedRenderColor(b?null:d.lut));Ne.draw(g,B.TRIANGLES,de,fe,xe,yn.disabled,De,d.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments)}else for(const Ne of Ve){const Ge=g.isTileAffectedByFog(Ne),Be=g.getOrCreateProgram(je,{overrideFog:Ge}),De=Ne.toUnwrapped(),We=_?Ne.projMatrix:g.transform.calculateProjMatrix(De);g.prepareDrawTile();const st=a?a.getTile(Ne):we?we[Ne.key]:new Sa(Ne,q,X.zoom,g),rt=Q?d0(We,j,T,g,0,d.scope,re,N,{tileID:Ne,tileSize:q}):u0(We,j,T,y.toPremultipliedRenderColor(b?null:d.lut));g.uploadCommonUniforms(L,Be,De);const{tileBoundsBuffer:bt,tileBoundsIndexBuffer:_t,tileBoundsSegments:kt}=g.getTileBoundsBuffers(st);Be.draw(g,B.TRIANGLES,de,fe,xe,yn.disabled,rt,d.id,bt,_t,kt)}},sky:function(g,a,d){const _=g._atmosphere?i.aj(g.transform.zoom):1,y=d.paint.get("sky-opacity")*_;if(y===0)return;const b=g.context,T=d.paint.get("sky-type"),j=new Rr(b.gl.LEQUAL,Rr.ReadOnly,[0,1]),N=g.frameCounter/1e3%1;T==="atmosphere"?g.renderPass==="offscreen"?d.needsSkyboxCapture(g)&&(function(L,B,X,q){const Q=L.context,re=Q.gl;let ae=B.skyboxFbo;if(!ae){ae=B.skyboxFbo=Q.createFramebuffer(32,32,!0,null),B.skyboxGeometry=new $y(Q),B.skyboxTexture=Q.gl.createTexture(),re.bindTexture(re.TEXTURE_CUBE_MAP,B.skyboxTexture),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_WRAP_S,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_WRAP_T,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_MIN_FILTER,re.LINEAR),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_MAG_FILTER,re.LINEAR);for(let je=0;je<6;++je)re.texImage2D(re.TEXTURE_CUBE_MAP_POSITIVE_X+je,0,re.RGBA,32,32,0,re.RGBA,re.UNSIGNED_BYTE,null)}Q.bindFramebuffer.set(ae.framebuffer),Q.viewport.set([0,0,32,32]);const fe=B.getCenter(L,!0),de=L.getOrCreateProgram("skyboxCapture"),xe=new Float64Array(16);i.bz(xe),i.em(xe,xe,.5*-Math.PI),cc(L,B,de,xe,fe,0),i.bz(xe),i.em(xe,xe,.5*Math.PI),cc(L,B,de,xe,fe,1),i.bz(xe),i.cT(xe,xe,.5*-Math.PI),cc(L,B,de,xe,fe,2),i.bz(xe),i.cT(xe,xe,.5*Math.PI),cc(L,B,de,xe,fe,3),i.bz(xe),cc(L,B,de,xe,fe,4),i.bz(xe),i.em(xe,xe,Math.PI),cc(L,B,de,xe,fe,5),Q.viewport.set([0,0,L.width,L.height])}(g,d),d.markSkyboxValid(g)):g.renderPass==="sky"&&function(L,B,X,q,Q){const re=L.context,ae=re.gl,fe=L.transform,de=L.getOrCreateProgram("skybox");re.activeTexture.set(ae.TEXTURE0),ae.bindTexture(ae.TEXTURE_CUBE_MAP,B.skyboxTexture);const xe=((je,we,Ve,Ne,Ge)=>({u_matrix:je,u_sun_direction:we,u_cubemap:0,u_opacity:Ne,u_temporal_offset:Ge}))(fe.skyboxMatrix,B.getCenter(L,!1),0,q,Q);L.uploadCommonUniforms(re,de),de.draw(L,ae.TRIANGLES,X,Cn.disabled,L.colorModeForRenderPass(),yn.backCW,xe,"skybox",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(g,d,j,y,N):T==="gradient"&&g.renderPass==="sky"&&function(L,B,X,q,Q){const re=L.context,ae=re.gl,fe=L.transform,de=L.getOrCreateProgram("skyboxGradient");B.skyboxGeometry||(B.skyboxGeometry=new $y(re)),re.activeTexture.set(ae.TEXTURE0);let xe=B.colorRampTexture;xe||(xe=B.colorRampTexture=new i.T(re,B.colorRamp,ae.RGBA8)),xe.bind(ae.LINEAR,ae.CLAMP_TO_EDGE);const je=((we,Ve,Ne,Ge,Be)=>({u_matrix:we,u_color_ramp:0,u_center_direction:Ve,u_radius:i.an(Ne),u_opacity:Ge,u_temporal_offset:Be}))(fe.skyboxMatrix,B.getCenter(L,!1),B.paint.get("sky-gradient-radius"),q,Q);L.uploadCommonUniforms(re,de),de.draw(L,ae.TRIANGLES,X,Cn.disabled,L.colorModeForRenderPass(),yn.backCW,je,"skyboxGradient",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(g,d,j,y,N)},custom:function(g,a,d,_){const y=g.context,b=d.implementation;if(!g.transform.projection.unsupportedLayers||!g.transform.projection.unsupportedLayers.includes("custom")||g.terrain&&(g.terrain.renderingToTexture||g.renderPass==="offscreen")&&d.isDraped(a)){if(g.renderPass==="offscreen"){const T=b.prerender;if(T){if(g.setCustomLayerDefaults(),y.setColorMode(g.colorModeForRenderPass()),g.transform.projection.name==="globe"){const j=g.transform.pointMerc;T.call(b,y.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),i.aj(g.transform.zoom),[j.x,j.y],g.transform.pixelsPerMeterRatio)}else T.call(b,y.gl,g.transform.customLayerMatrix());y.setDirty(),g.setBaseState()}}else if(g.renderPass==="translucent"){if(g.terrain&&g.terrain.renderingToTexture){const j=b.renderToTile;if(j){const N=_[0].canonical,L={x:N.x+_[0].wrap*(b.wrapTileId?0:1<<N.z),y:N.y,z:N.z};y.setDepthMode(Rr.disabled),y.setStencilMode(Cn.disabled),y.setColorMode(g.colorModeForRenderPass()),g.setCustomLayerDefaults(),j.call(b,y.gl,L),y.setDirty(),g.setBaseState()}return}g.setCustomLayerDefaults(),y.setColorMode(g.colorModeForRenderPass()),y.setStencilMode(Cn.disabled);const T=b.renderingMode==="3d"?new Rr(g.context.gl.LEQUAL,Rr.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,Rr.ReadOnly);if(y.setDepthMode(T),g.transform.projection.name==="globe"){const j=g.transform.pointMerc;b.render(y.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),i.aj(g.transform.zoom),[j.x,j.y],g.transform.pixelsPerMeterRatio)}else b.render(y.gl,g.transform.customLayerMatrix());y.setDirty(),g.setBaseState(),y.bindFramebuffer.set(null)}}else i.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(g,a,d,_){if(g.renderPass==="opaque")return;const y=d.paint.get("model-opacity").constantOr(1),b=d.paint.get("model-elevation-reference"),T=b==="ground",j=b==="ground";if(y===0)return;const N=d.paint.get("model-cast-shadows");if(g.renderPass==="shadow"&&(!N||g.terrain&&y<.65&&d._transitionablePaint._values["model-opacity"].value.expression instanceof i.ad))return;const L=g.shadowRenderer,B=d.paint.get("model-receive-shadows");L&&(L.useNormalOffset=!0,B||(L.enabled=!1));const X=()=>{L&&(L.useNormalOffset=!0,B||(L.enabled=!0))},q=a.getSource();if(g.renderPass==="light-beam"&&q.type!=="batched-model")return;if(q.type==="vector"||q.type==="geojson")return function(we,Ve,Ne,Ge,Be){const De=we.transform,We=De.projection.name==="globe",st=De.getFreeCameraOptions().position;if(!we.modelManager)return;const rt=we.modelManager;Ne.modelManager=rt;const bt=we.shadowRenderer;if(!Ne._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const _t=Ne._unevaluatedLayout._values["model-id"],kt=Object.assign({},Ne.layout.get("model-id").parameters),nr=we.style.order.indexOf(Ne.fqid);for(const ht of Ge){const Ke=Ve.getTile(ht).getBucket(Ne);if(!Ke||Ke.projection.name!==De.projection.name)continue;const Pt=Ke.getModelUris();if(Pt&&!Ke.modelsRequested&&(rt.addModelsFromBucket(Pt,Be),Ke.modelsRequested=!0),We)kt.zoom=ht.overscaledZ;else{const yr=Gy(ht,De);kt.zoom=yr}const xt=_t.possiblyEvaluate(kt);if(z2(we,Ke,ht),kl.shadowUniformsInitialized=!1,kl.useSingleShadowCascade=!!bt&&bt.getMaxCascadeForTile(ht.toUnwrapped())===0,we.renderPass==="shadow"&&bt){if(we.currentShadowCascade===1&&Ke.isInsideFirstShadowMapFrustum)continue;const yr=De.calculatePosMatrix(ht.toUnwrapped(),De.worldSize);if(kl.tileMatrix.set(yr),kl.shadowTileMatrix=Float32Array.from(bt.calculateShadowPassMatrixFromMatrix(yr)),kl.aabb.min=[0,0,0],kl.aabb.max[0]=kl.aabb.max[1]=i.al,kl.aabb.max[2]=0,b0(Ke,kl,we,Ne.scope))continue}const qt=1<<ht.canonical.z,or=[((st.x-ht.wrap)*qt-ht.canonical.x)*i.al,(st.y*qt-ht.canonical.y)*i.al,st.z*qt*i.al];we.conflationActive&&Object.keys(Ke.instancesPerModel).length>0&&we.style.isLayerClipped(Ne,Ve.getSource())&&Ke.updateReplacement(ht,we.replacementSource,nr,Be)&&(Ke.uploaded=!1,Ke.upload(we.context));let Ar=0;const tr=new Array,sr=new Array,kr=new Array;for(let yr in Ke.instancesPerModel){const gr=Ke.instancesPerModel[yr];gr.features.length>0&&!We&&(yr=xt.evaluate(gr.features[0].feature,{}));const wr=rt.getModel(yr,Be);if(wr||rt.hasURLBeenRequested(yr)||Ke.modelUris.includes(yr)||(Ke.modelUris.push(yr),Ke.modelsRequested=!1),wr&&wr.uploaded)if(We){const on=i.c4([],[st.x,st.y,st.z],we.transform.worldSize);i.ev(on,on);for(let Jn=0;Jn<gr.instancedDataArray.length;++Jn){const ui=[0,0,0],Xi=[1,1,1],wn=i.ew(),li=gr.tileCoordinatesForInstance(Jn),Fn=gr.transformForInstance(Jn);i.ex(Xi,Fn),i.ey(wn,Fn),i.ez(ui,wn);const Wi=gr.translationForInstance(Jn),di=new i.aS(0,0);i.eA(Ke.canonical,di,li.x,li.y);const rs=i.bB();i.eB(rs,wr,we.transform,di,ui,Xi,Wi,!0,!1,!1);const bi=gr.colorForInstance(Jn),Ln=i.bz([]),ki=i.ee(di.lat,we.transform.zoom),qn=i.bp([],[1,1,1/ki]);i.bq(Ln,Ln,on),kr.push({zScaleMatrix:qn,negCameraPosMatrix:Ln});for(const ps of wr.nodes)w0(we,ps,rs,we.transform.expandedFarZProjMatrix,Ar,tr,sr,wr.materialOverrides,bi);++Ar}}else for(const on of wr.nodes)Wy(we,Ne,on,gr,or,ht,kl)}if(We)if(we.renderPass==="shadow"){for(const yr of sr)Qf(yr.mesh,yr.nodeModelMatrix,we,Ne);for(const yr of tr)Qf(yr.mesh,yr.nodeModelMatrix,we,Ne)}else L2(we,Ne,1,tr,sr,kr)}}(g,a,d,_,y0(q,d,g.style._importedAsBasemap)),void X();if(!q.loaded())return;if(q.type==="batched-model")return function(we,Ve,Ne,Ge){Ne.resetLayerRenderingStats(we);const Be=we.context,De=we.transform,We=we.style.fog,st=we.shadowRenderer;if(De.projection.name!=="mercator")return void i.w(`Drawing 3D landmark models for ${De.projection.name} projection is not yet implemented`);const rt=we.transform.getFreeCameraOptions().position,bt=i.c4([],[rt.x,rt.y,rt.z],we.transform.worldSize),_t=i.ev([],bt),kt=i.bz([]),nr=i.ee(De.center.lat,De.zoom),ht=i.bp([],[1,1,1/nr]);i.bq(kt,kt,_t);const Ke=Ne.paint.get("model-opacity").constantOr(1),Pt=new Rr(Be.gl.LEQUAL,Rr.ReadWrite,we.depthRangeFor3D),xt=new Rr(Be.gl.LEQUAL,Rr.ReadOnly,we.depthRangeFor3D),qt=new i.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),or=we.renderPass==="shadow",Ar=or&&st?st.getCurrentCascadeFrustum():De.getFrustum(De.scaleZoom(De.worldSize)),tr=Ne.paint.get("model-front-cutoff"),sr=tr[2]<1,kr=Bu(we,Ne.paint.get("model-cutoff-fade-range")),yr=Ne.getLayerRenderingStats();(function(gr,wr,on,Jn){const ui=gr.terrain?gr.terrain.exaggeration():0,Xi=gr.transform.zoom;for(const wn of Jn){const li=wr.getTile(wn).getBucket(on);li&&(li.setFilter(on.filter),gr.conflationActive&&li.updateReplacement(wn,gr.replacementSource),li.evaluateTransform(gr,on),gr.terrain&&ui>0&&li.elevationUpdate(gr.terrain,ui,wn,on.source),li.needsReEvaluation(gr,Xi,on)&&li.evaluate(on))}})(we,Ve,Ne,Ge),function(){let gr,wr,on;sr?(gr=Ge.length-1,wr=-1,on=-1):(gr=0,wr=Ge.length,on=1);const Jn=new Float64Array(16),ui=i.cz(),Xi=new i.P(0,0);for(let wn=gr;wn!==wr;wn+=on){const li=Ge[wn],Fn=Ve.getTile(li).getBucket(Ne);if(!Fn||!Fn.uploaded)continue;let Wi=!1;st&&(Wi=st.getMaxCascadeForTile(li.toUnwrapped())===0);const di=De.calculatePosMatrix(li.toUnwrapped(),De.worldSize),rs=Fn.modelTraits;!or&&sr&&(i.bk(Jn,di),i.af(ui,bt,Jn),Xi.x=ui[0],Xi.y=ui[1]);const bi=[];Fn.setFilter(Ne.filter);for(const Ln of Fn.getNodesInfo()){if(Ln.hiddenByReplacement||!Ln.node.meshes)continue;const ki=Ln.node;let qn=0;we.terrain&&ki.elevation&&(qn=ki.elevation*we.terrain.exaggeration());const ps=(()=>{const wo=Ln.aabb;return qt.min=[...wo.min],qt.max=[...wo.max],qt.min[2]+=qn,qt.max[2]+=qn,i.af(qt.min,qt.min,di),i.af(qt.max,qt.max,di),qt})(),Mi=Ln.evaluatedScale;if(Mi[0]<=1&&Mi[1]<=1&&Mi[2]<=1&&ps.intersects(Ar)===0)continue;if(!or&&sr){const wo=.16666666666666666;Ln.cameraCollisionOpacity=bt[0]>ps.min[0]&&bt[0]<ps.max[0]&&bt[1]>ps.min[1]&&bt[1]<ps.max[1]&&bt[2]*nr<ps.max[2]&&ki.footprint&&i.b$(Xi,ki.footprint)?Math.max(Ln.cameraCollisionOpacity-wo,0):Math.min(1,Ln.cameraCollisionOpacity+wo)}const Tn=[...di],pi=1/i.d6(li.canonical),Cs=ki.anchor?ki.anchor[0]:0,ra=ki.anchor?ki.anchor[1]:0;i.bq(Tn,Tn,[Cs*(Mi[0]-1)+Ln.evaluatedTranslation[0]*pi,ra*(Mi[1]-1)+Ln.evaluatedTranslation[1]*pi,qn+Ln.evaluatedTranslation[2]]),i.cp(Mi,i.eD)||i.cR(Tn,Tn,Mi);const Ls=i.aB([],Tn,ki.globalMatrix),Xs=i.aB([],De.expandedFarZProjMatrix,Ls),nl=i.aB([],De.expandedFarZProjMatrix,Tn),Vo=i.aC([],[Cs,ra,qn,1],Xs)[2];ki.hidden=!1;let mo=Ke;or||(sr&&(mo*=Ln.cameraCollisionOpacity,mo*=Dh(Tn,De,Ln.aabb,tr)),mo*=hg(kr,Vo)),mo!==0?bi.push({nodeInfo:Ln,depth:Vo,opacity:mo,wvpForNode:Xs,wvpForTile:nl,nodeModelMatrix:Ls,tileModelMatrix:Tn}):ki.hidden=!0}or||bi.sort((Ln,ki)=>!sr||Ln.opacity===1&&ki.opacity===1?Ln.depth<ki.depth?-1:1:Ln.opacity===1?-1:ki.opacity===1?1:Ln.depth>ki.depth?-1:1);for(const Ln of bi){const ki=Ln.nodeInfo,qn=ki.node;let ps=i.aB([],ht,Ln.tileModelMatrix);i.aB(ps,kt,ps);const Mi=i.bk([],ps);i.ef(Mi,Mi),i.cR(Mi,Mi,B2),ps=i.aB(ps,ps,qn.globalMatrix);const Tn=we.renderPass==="light-beam",pi=Ne.paint.get("model-color-use-theme").constantOr("default")==="none",Cs=rs&i.eH.HasMapboxMeshFeatures,ra=Cs?0:ki.evaluatedRMEA[0][2];for(let Ls=0;Ls<qn.meshes.length;++Ls){const Xs=qn.meshes[Ls],nl=Ls===qn.lightMeshIndex;let Vo=Ln.wvpForNode;if(nl){if(!Tn&&!we.terrain&&we.shadowRenderer){we.currentLayer<we.firstLightBeamLayer&&(we.firstLightBeamLayer=we.currentLayer);continue}Vo=Ln.wvpForTile}else if(Tn)continue;const mo={defines:[]},wo=[];if(!or&&st&&(st.useNormalOffset=!!Xs.normalBuffer),Kf(mo.defines,wo,Xs,we,pi?null:Ne.lut),Cs||mo.defines.push("DIFFUSE_SHADED"),Wi&&mo.defines.push("SHADOWS_SINGLE_CASCADE"),yr&&(or?yr.numRenderedVerticesInShadowPass+=Xs.vertexArray.length:yr.numRenderedVerticesInTransparentPass+=Xs.vertexArray.length),or){Qf(Xs,Ln.nodeModelMatrix,we,Ne);continue}let Dl=null;if(We){const na=qy(Ln.nodeModelMatrix,we.transform);if(Dl=new Float32Array(na),De.projection.name!=="globe"){const ts=Xs.aabb.min,la=Xs.aabb.max,[Xa,$s]=We.getOpacityForBounds(na,ts[0],ts[1],la[0],la[1]);mo.overrideFog=Xa>=ze||$s>=ze}}const go=Xs.material;let Rl;go.occlusionTexture&&go.occlusionTexture.offsetScale&&(Rl=go.occlusionTexture.offsetScale,mo.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const hc=we.getOrCreateProgram("model",mo);!or&&st&&st.setupShadowsFromMatrix(Ln.tileModelMatrix,hc,st.useNormalOffset),we.uploadCommonUniforms(Be,hc,null,Dl);const Za=go.pbrMetallicRoughness;Za.metallicFactor=.9,Za.roughnessFactor=.5;const Vs=h0(new Float32Array(Vo),new Float32Array(ps),new Float32Array(Mi),new Float32Array(qn.globalMatrix),we,Ln.opacity,Za.baseColorFactor,go.emissiveFactor,Za.metallicFactor,Za.roughnessFactor,go,ra,Ne,[0,0,0],Rl);!nl&&(ki.hasTranslucentParts||Ln.opacity<1)&&hc.draw(we,Be.gl.TRIANGLES,Pt,Cn.disabled,Vn.disabled,yn.backCCW,Vs,Ne.id,Xs.vertexBuffer,Xs.indexBuffer,Xs.segments,Ne.paint,we.transform.zoom,void 0,wo),hc.draw(we,Be.gl.TRIANGLES,nl?xt:Pt,Cn.disabled,nl||Ln.opacity<1||ki.hasTranslucentParts?Vn.alphaBlended:Vn.unblended,yn.backCCW,Vs,Ne.id,Xs.vertexBuffer,Xs.indexBuffer,Xs.segments,Ne.paint,we.transform.zoom,void 0,wo)}}}}()}(g,a,d,_),void X();if(q.type!=="model")return;const Q=q.getModels(),re=[],ae=g.transform.getFreeCameraOptions().position,fe=i.c4([],[ae.x,ae.y,ae.z],g.transform.worldSize);i.ev(fe,fe);const de=[],xe=[];let je=0;for(const we of Q){const Ve=a.getFeatureState("",we.id),Ne={type:"Unknown",id:we.id,properties:we.featureProperties},Ge=d.paint.get("model-rotation").evaluate(Ne,Ve),Be=d.paint.get("model-scale").evaluate(Ne,Ve),De=d.paint.get("model-translation").evaluate(Ne,Ve);ep(d,we.id,Ve,we.featureProperties,we.nodeOverrideNames,we.nodeOverrides),rj(d,we.id,Ve,we.featureProperties,we.materialOverrideNames,we.materialOverrides),we.nodeOverrides.size>0&&we.computeBoundsAndApplyParent(),we.computeModelMatrix(g,Ge,Be,De,j,T,!1);const We=i.bz([]),st=i.ee(we.position.lat,g.transform.zoom),rt=i.bp([],[1,1,1/st]);i.bq(We,We,fe),re.push({zScaleMatrix:rt,negCameraPosMatrix:We});for(const bt of we.nodes)w0(g,bt,we.matrix,g.transform.expandedFarZProjMatrix,je,de,xe,we.materialOverrides);je++}if(de.sort((we,Ve)=>Ve.depth-we.depth),g.renderPass!=="shadow")L2(g,d,y,de,xe,re),X();else{for(const we of xe)Qf(we.mesh,we.nodeModelMatrix,g,d);for(const we of de)Qf(we.mesh,we.nodeModelMatrix,g,d);X()}}},S0={line:function(g,a,d){if(g.hasElevatedBuckets=!1,g.hasNonElevatedBuckets=!1,g._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||g._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(a){const _=a.getVisibleCoordinates();for(const y of _){const b=a.getTile(y).getBucket(g);if(b&&(b.elevationType!=="none"?g.hasElevatedBuckets=!0:g.hasNonElevatedBuckets=!0,g.hasElevatedBuckets&&g.hasNonElevatedBuckets))break}}}else g.hasNonElevatedBuckets=!0},model:function(g,a,d){const _=a.getSource();if(!_.loaded())return;if(_.type==="vector"||_.type==="geojson"){const b=y0(_,g,d.style._importedAsBasemap);return void(d.modelManager&&d.modelManager.upload(d,b))}if(_.type==="batched-model"||_.type!=="model")return;const y=_.getModels();for(const b of y)b.upload(d.context)},raster:function(g,a,d){const _=a.getSource();if(!(_ instanceof He&&_.loaded()))return;const y=g.sourceLayer||_.rasterLayerIds&&_.rasterLayerIds[0];if(!y)return;const b=g.paint.get("raster-array-band")||_.getInitialBand(y);if(b==null)return;const T=a.getIds().map(j=>a.getTileByID(j));for(const j of T)j.updateNeeded(g.id,b)&&_.prepareTile(j,y,g.id,b)},"raster-particle":function(g,a,d){const _=a.getSource();if(!(_ instanceof He&&_.loaded()))return;const y=g.sourceLayer||_.rasterLayerIds&&_.rasterLayerIds[0];if(!y)return;const b=g.paint.get("raster-particle-array-band")||_.getInitialBand(y);if(b==null)return;const T=a.getIds().map(j=>a.getTileByID(j));for(const j of T)j.updateNeeded(g.id,b)&&_.prepareTile(j,y,g.id,b)}},T0={fill:kh},Pl={fill:function(g,a,d,_){if(!d.layout||d.layout.get("fill-elevation-reference")==="none"||d.paint.get("fill-opacity").constantOr(1)===0)return;const y=g.context.gl,b=new Rr(y.LEQUAL,Rr.ReadOnly,g.depthRangeFor3D),T=new Cn({func:y.ALWAYS,mask:255},255,255,y.KEEP,y.KEEP,y.REPLACE),j=g.transform.getFreeCameraOptions().position,N=g.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const L of _){const B=a.getTile(L),X=B.getBucket(d);if(!X)continue;const q=X.elevatedStructures;if(!q||q.depthSegments.segments[0].primitiveLength===0)continue;const Q=P2(L.toUnwrapped(),j),re=g.translatePosMatrix(L.projMatrix,B,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor")),ae=a0(re,Q,0,1,0);N.draw(g,y.TRIANGLES,b,T,Vn.disabled,yn.disabled,ae,d.id,q.vertexBuffer,q.indexBuffer,q.depthSegments,d.paint,g.transform.zoom)}}};class Ud{constructor(a,d,_,y,b,T){this.context=new p0(a,d),this.transform=_,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=b,this._timeStamp=i.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const j=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const L of j)this._debugParams.enabledLayers[L]=!0;b.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),b.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),b.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),b.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const L of j)b.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],L);this.occlusionParams=new nj(b),this.setup(),this.numSublayers=Qo.maxUnderzooming+Qo.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new i.eO,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Km(this),this._wireframeDebugCache=new V2,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const N=new i.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new i.T(this.context,N,a.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=y,this.worldview=T}updateTerrain(a,d){const _=!!a&&!!a.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new ag(this,a));const y=this._terrain;this.transform.elevation=_?y:null,y.update(a,this.transform,d),this.transform.elevation&&!y.enabled&&(this.transform.elevation=null)}_updateFog(a){const d=a.fog;if(!d||this.transform.projection.name==="globe"||d.getOpacity(this.transform.pitch)<1||d.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,y]=d.getFovAdjustedRange(this.transform._fov);if(_>y)return void(this.transform.fogCullDistSq=null);const b=_+.78*(y-_);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(a){a&&!this._terrain&&(this._terrain=new ag(this,this.style)),this._forceTerrainMode=a}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(a,d){if(this.width=a*i.o.devicePixelRatio,this.height=d*i.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._mergedLayers[_].resize()}setup(){const a=this.context,d=new i.bc;d.emplaceBack(0,0),d.emplaceBack(i.al,0),d.emplaceBack(0,i.al),d.emplaceBack(i.al,i.al),this.tileExtentBuffer=a.createVertexBuffer(d,i.be.members),this.tileExtentSegments=i.bf.simpleSegment(0,0,4,2);const _=new i.bc;_.emplaceBack(0,0),_.emplaceBack(i.al,0),_.emplaceBack(0,i.al),_.emplaceBack(i.al,i.al),this.debugBuffer=a.createVertexBuffer(_,i.be.members),this.debugSegments=i.bf.simpleSegment(0,0,4,5);const y=new i.bc;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(y,i.be.members),this.viewportSegments=i.bf.simpleSegment(0,0,4,2);const b=new i.a$;b.emplaceBack(0,0,0,0),b.emplaceBack(i.al,0,i.al,0),b.emplaceBack(0,i.al,0,i.al),b.emplaceBack(i.al,i.al,i.al,i.al),this.mercatorBoundsBuffer=a.createVertexBuffer(b,i.bh.members),this.mercatorBoundsSegments=i.bf.simpleSegment(0,0,4,2);const T=new i.b0;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(T);const j=new i.bd;for(const L of[0,1,3,2,0])j.emplaceBack(L);this.debugIndexBuffer=a.createIndexBuffer(j),this.emptyTexture=new i.T(a,new i.q({width:1,height:1},Uint8Array.of(0,0,0,0)),a.gl.RGBA8),this.identityMat=i.bB();const N=this.context.gl;this.stencilClearMode=new Cn({func:N.ALWAYS,mask:0},0,255,N.ZERO,N.ZERO,N.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(a){return a._makeTileBoundsBuffers(this.context,this.transform.projection),a._tileBoundsBuffer?{tileBoundsBuffer:a._tileBoundsBuffer,tileBoundsIndexBuffer:a._tileBoundsIndexBuffer,tileBoundsSegments:a._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const a=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,a.TRIANGLES,Rr.disabled,this.stencilClearMode,Vn.disabled,yn.disabled,Ih(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(a,d,_){if(!d||this.currentStencilSource===d.id||!a.isTileClipped()||!_||_.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let j=!1;for(const N of _)if(this._tileClippingMaskIDs[N.key]===void 0){j=!0;break}if(!j)return}this.currentStencilSource=d.id;const y=this.context,b=y.gl;this.nextStencilID+_.length>256&&this.clearStencil(),y.setColorMode(Vn.disabled),y.setDepthMode(Rr.disabled);const T=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const j of _){const N=d.getTile(j),L=this._tileClippingMaskIDs[j.key]=this.nextStencilID++,{tileBoundsBuffer:B,tileBoundsIndexBuffer:X,tileBoundsSegments:q}=this.getTileBoundsBuffers(N);T.draw(this,b.TRIANGLES,Rr.disabled,new Cn({func:b.ALWAYS,mask:0},L,255,b.KEEP,b.KEEP,b.REPLACE),Vn.disabled,yn.disabled,Ih(j.projMatrix),"$clipping",B,X,q)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,d=this.context.gl;return new Cn({func:d.NOTEQUAL,mask:255},a,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(a){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(a);const d=this.context.gl;return new Cn({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(a){const d=this.context.gl,_=a.sort((T,j)=>j.overscaledZ-T.overscaledZ),y=_[_.length-1].overscaledZ,b=_[0].overscaledZ-y+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const T={};for(let j=0;j<b;j++)T[j+y]=new Cn({func:d.GEQUAL,mask:255},j+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=b,[T,_]}return[{[y]:Cn.disabled},_]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new Vn([a.CONSTANT_COLOR,a.ONE,a.CONSTANT_COLOR,a.ONE],new i.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Vn.unblended:Vn.alphaBlended}colorModeForDrapableLayerRenderPass(a){const d=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Vn([d.ONE,d.ONE_MINUS_SRC_ALPHA,d.CONSTANT_ALPHA,d.ONE_MINUS_SRC_ALPHA],new i.ao(0,0,0,a===void 0?0:a),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(a,d,_,y=!1){if(this.depthOcclusion)return new Rr(this.context.gl.GREATER,Rr.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!y)return Rr.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new Rr(_||this.context.gl.LEQUAL,d,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const a=this.context.gl,d=Math.ceil(this.width),_=Math.ceil(this.height),y=this.context.bindFramebuffer.get(),b=a.getParameter(a.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===d&&this.depthFBO.height===_||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),d!==0&&_!==0&&(this.depthFBO=new f0(this.context,d,_,!1,"texture"),this.depthTexture=new i.T(this.context,{width:d,height:_,data:null},a.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(y),a.bindTexture(a.TEXTURE_2D,b),this.depthFBO&&(a.bindFramebuffer(a.READ_FRAMEBUFFER,null),a.bindFramebuffer(a.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),a.blitFramebuffer(0,0,d,_,0,0,d,_,a.DEPTH_BUFFER_BIT,a.NEAREST),a.bindFramebuffer(a.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((a,d)=>a+d/this._fpsHistory.length,0))}render(a,d){const _=i.o.now();this._dt=_-this._timeStamp,this._timeStamp=_,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=a.map.repaint,this.style=a,this.options=d;const y=this.style._mergedLayers,b=!(!this.terrain||!this.terrain.enabled),T=()=>this.style._getOrder(b).filter(ht=>{const Ke=y[ht];return!(Ke.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ke.type]});let j=T(),N=!1,L=!1,B=null;for(const ht of j){const Ke=y[ht];Ke.type==="circle"?N=!0:Ke.type==="building"?B=Ke:Ke.type==="symbol"&&(Ke.hasOcclusionOpacityProperties?L=!0:N=!0)}let X=j.map(ht=>y[ht]);const q=this.style._mergedSourceCaches;this.imageManager=a.imageManager,this.modelManager=a.modelManager,this.symbolFadeChange=a.placement.symbolFadeChange(i.o.now()),this.imageManager.beginFrame();let Q=0,re=!1;for(const ht in q){const Ke=q[ht];Ke.used&&(Ke.prepare(this.context),Ke.getSource().usedInConflation&&++Q)}let ae=!1;for(const ht of X)ht.isHidden(this.transform.zoom)||(ht.type==="clip"&&(ae=!0),this.prepareLayer(ht));const fe={},de={},xe={},je={},we={};for(const ht in q){const Ke=q[ht];fe[ht]=Ke.getVisibleCoordinates(),de[ht]=fe[ht].slice().reverse(),xe[ht]=Ke.getVisibleCoordinates(!0).reverse(),je[ht]=Ke.getShadowCasterCoordinates(),we[ht]=Ke.sortCoordinatesByDistance(fe[ht])}const Ve=ht=>{const Ke=this.style.getLayerSourceCache(ht);return Ke&&Ke.used?Ke.getSource():null};if(Q||ae||this._clippingActiveLastFrame){const ht=[],Ke=[];let Pt=0;for(const xt of X)this.isSourceForClippingOrConflation(xt,Ve(xt))&&(ht.push(xt),Ke.push(Pt)),Pt++;if(ht&&(ae||ht.length>1)||this._clippingActiveLastFrame){ae=!1;const xt=[];for(let qt=0;qt<ht.length;qt++){const or=ht[qt],Ar=Ke[qt],tr=this.style.getLayerSourceCache(or);if(!tr||!tr.used||!tr.getSource().usedInConflation&&or.type!=="clip"&&or.type!=="building")continue;let sr=i.eP,kr=i.bZ.None;const yr=[];let gr=!0;if(or.type==="building")sr=i.eR;else if(or.type==="clip"){sr=Ar;for(const wr of or.layout.get("clip-layer-types"))kr|=wr==="model"?i.bZ.Model:wr==="symbol"?i.bZ.Symbol:i.bZ.FillExtrusion;for(const wr of or.layout.get("clip-layer-scope"))yr.push(wr);or.isHidden(this.transform.zoom)?gr=!1:ae=!0}gr&&xt.push({layer:or.fqid,cache:tr,order:sr,clipMask:kr,clipScope:yr})}this.replacementSource.setSources(xt),re=!0}}this._clippingActiveLastFrame=ae,re||this.replacementSource.clear(),this.conflationActive=re,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let ht=0;ht<X.length;ht++){const Ke=X[ht],Pt=Ke.cutoffRange();if(this.longestCutoffRange=Math.max(Pt,this.longestCutoffRange),Pt>0){const xt=Ve(Ke);xt&&(this.minCutoffZoom=Math.max(xt.minzoom,this.minCutoffZoom)),Ke.minzoom&&(this.minCutoffZoom=Math.max(Ke.minzoom,this.minCutoffZoom))}Ke.is3D(b)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=ht),this._lastOcclusionLayer=ht)}const Ne=this.style&&this.style.fog;Ne?(this._fogVisible=Ne.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ne.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(xe),this.opaquePassCutoff=0,j=T(),X=j.map(ht=>y[ht]));const Ge=this._shadowRenderer;if(Ge){Ge.updateShadowParameters(this.transform,this.style.directionalLight);for(const ht in q)for(const Ke of fe[ht]){let Pt={min:0,max:0};this.terrain&&(Pt=this.terrain.getMinMaxForTile(Ke)||Pt),Ge.addShadowReceiver(Ke.toUnwrapped(),Pt.min,Pt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.eQ(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Zs(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Be=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),De=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Be&&!this._snow&&(this._snow=new Zy(this)),!Be&&this._snow&&(this._snow.destroy(),delete this._snow),De&&!this._rain&&(this._rain=new tp(this)),!De&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),B){this.buildingTileBorderManager||(this.buildingTileBorderManager=new at);const ht=this.style.getLayerSourceCache(B);this.buildingTileBorderManager.updateBorders(ht,B)}if(!nn.has(this.context.gl))return;this.renderPass="offscreen";for(const ht of X){const Ke=a.getLayerSourceCache(ht);if(!ht.hasOffscreenPass()||ht.isHidden(this.transform.zoom))continue;const Pt=Ke?de[Ke.id]:void 0;(ht.type==="custom"||ht.type==="raster"||ht.type==="raster-particle"||ht.isSky()||Pt&&Pt.length)&&this.renderLayer(this,Ke,ht,Pt)}this.depthRangeFor3D=[0,1-(X.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,je)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const We=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),st=(()=>{if(d.showOverdrawInspector)return i.ao.black;const ht=this.style.fog;if(ht&&this.transform.projection.supportsFog){const Ke=this.style.getLut(ht.scope);if(!We){const Pt=ht.properties.get("color-use-theme")==="none",xt=ht.properties.get("color").toNonPremultipliedRenderColor(Pt?null:Ke).toArray01();return new i.ao(...xt)}if(We){const Pt=ht.properties.get("space-color-use-theme")==="none",xt=ht.properties.get("space-color").toNonPremultipliedRenderColor(Pt?null:Ke).toArray01();return new i.ao(...xt)}}return i.ao.transparent})();if(this.context.clear({color:st,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&We&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=j.length-1;this.currentLayer>=0;this.currentLayer--){const ht=X[this.currentLayer],Ke=a.getLayerSourceCache(ht);if(ht.isSky())continue;const Pt=Ke?(ht.is3D(b)?we:de)[Ke.id]:void 0;this._renderTileClippingMasks(ht,Ke,Pt),this.renderLayer(this,Ke,ht,Pt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&We&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||i.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<j.length;this.currentLayer++){const ht=X[this.currentLayer],Ke=a.getLayerSourceCache(ht);ht.isSky()&&this.renderLayer(this,Ke,ht,Ke?de[Ke.id]:void 0)}function rt(ht,Ke){let Pt;return Ke&&(Pt=(ht.type==="symbol"?xe:ht.is3D(b)?we:de)[Ke.id]),Pt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<j.length;){const ht=X[this.currentLayer];if(ht.type==="raster"||ht.type==="raster-particle"){const Ke=a.getLayerSourceCache(ht);this.renderLayer(this,Ke,ht,rt(ht,Ke))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let bt=0;Ge&&(bt=Ge.getShadowCastingLayerCount());let _t=!1,kt=-1;for(let ht=0;ht<j.length;++ht){const Ke=X[ht];Ke.isHidden(this.transform.zoom)||Ke.is3D(b)&&(kt=ht)}L&&kt===-1&&(N=!0);let nr=!1;for(;this.currentLayer<j.length;){const ht=X[this.currentLayer],Ke=a.getLayerSourceCache(ht);if(ht.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(ht)){if(ht.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!nr&&ht.is3D(b)&&!b){const Pt=this.currentLayer,xt=qt=>{for(this.currentLayer=0;this.currentLayer<X.length;this.currentLayer++){const or=X[this.currentLayer];if(T0[or.type]){const Ar=this.style.getLayerSourceCache(or);T0[or.type](this,Ar,or,rt(or,Ar),qt)}}};xt("initialize"),xt("reset"),this.currentLayer=Pt,nr=!0}if(N&&!_t&&this.terrain&&!this.transform.isOrthographic&&(_t=!0,this.blitDepth()),L&&kt!==-1&&this.currentLayer===kt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(ht,Ke,Ke?fe[Ke.id]:void 0),this.renderLayer(this,Ke,ht,rt(ht,Ke)),!this.terrain&&Ge&&bt>0&&ht.hasShadowPass()&&--bt==0){{this.clearStencil(),this.resetStencilClippingMasks();const Pt=this.currentLayer;for(this.currentLayer=0;this.currentLayer<X.length;this.currentLayer++){const xt=X[this.currentLayer];if(Pl[xt.type]){const qt=this.style.getLayerSourceCache(xt);Pl[xt.type](this,qt,xt,rt(xt,qt))}}this.currentLayer=Pt}if(Ge.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const Pt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Pt;this.currentLayer++){const xt=X[this.currentLayer];if(!xt.hasLightBeamPass())continue;const qt=a.getLayerSourceCache(xt);this.renderLayer(this,qt,xt,qt?de[qt.id]:void 0)}this.currentLayer=Pt,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Pt=this.currentLayer;this.depthOcclusion=!0;for(const xt of this.layersWithOcclusionOpacity){this.currentLayer=xt;const qt=X[this.currentLayer],or=a.getLayerSourceCache(qt),Ar=or?de[or.id]:void 0;this.terrain||this._renderTileClippingMasks(qt,or,or?fe[or.id]:void 0),this.renderLayer(this,or,qt,Ar)}this.depthOcclusion=!1,this.currentLayer=Pt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ht=null;X.forEach(Ke=>{const Pt=a.getLayerSourceCache(Ke);Pt&&!Ke.isHidden(this.transform.zoom)&&Pt.getVisibleCoordinates().length&&(!ht||ht.getSource().maxzoom<Pt.getSource().maxzoom)&&(ht=Pt)}),ht&&this.options.showTileBoundaries&&Vy(this,ht,ht.getVisibleCoordinates(),i.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Vy(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new i.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(ht){const Ke=ht.transform.padding;us(ht,ht.transform.height-(Ke.top||0),3,Bd),us(ht,Ke.bottom||0,3,M2),dg(ht,Ke.left||0,3,zy),dg(ht,ht.transform.width-(Ke.right||0),3,By);const Pt=ht.transform.centerPoint;(function(xt,qt,or,Ar){Xf(xt,qt-1,or-10,2,20,Ar),Xf(xt,qt-10,or-1,20,2,Ar)})(ht,Pt.x,ht.transform.height-Pt.y,Uy)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),re||(this.conflationActive=!1)}prepareLayer(a){this.gpuTimingStart(a);const{unsupportedLayers:d}=this.transform.projection,_=!d||!d.includes(a.type);if(S0[a.type]&&(_||this.terrain&&a.type==="custom")){const y=this.style.getLayerSourceCache(a);S0[a.type](a,y,this)}this.gpuTimingEnd()}renderLayer(a,d,_,y){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="sky"||_.type==="custom"||_.type==="model"||_.type==="raster"||_.type==="raster-particle"||y&&y.length)&&(this.id=_.id,this.gpuTimingStart(_),a.transform.projection.unsupportedLayers&&a.transform.projection.unsupportedLayers.includes(_.type)&&(!a.terrain||_.type!=="custom")||_.type==="clip"||Xy[_.type](a,d,_,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(a){if(!this.options.gpuTiming)return;const d=this.context.extTimerQuery,_=this.context.gl;let y=this.gpuTimers[a.id];y||(y=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:_.createQuery()}),y.calls++,_.beginQuery(d.TIME_ELAPSED_EXT,y.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const a=this.context.extTimerQuery,d=this.context.gl,_=d.createQuery();this.deferredRenderGpuTimeQueries.push(_),d.beginQuery(a.TIME_ELAPSED_EXT,_)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const a=this.gpuTimers;return this.gpuTimers={},a}collectDeferredRenderGpuQueries(){const a=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],a}queryGpuTimers(a){const d={};for(const _ in a){const y=a[_],b=this.context.extTimerQuery,T=b.getQueryParameter(y.query,this.context.gl.QUERY_RESULT)/1e6;b.deleteQueryEXT(y.query),d[_]=T}return d}queryGpuTimeDeferredRender(a){if(!this.options.gpuTimingDeferredRender)return 0;const d=this.context.gl;let _=0;for(const y of a)_+=d.getQueryParameter(y,d.QUERY_RESULT)/1e6,d.deleteQuery(y);return _}translatePosMatrix(a,d,_,y,b){if(!_[0]&&!_[1])return a;const T=b?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(T){const L=Math.sin(T),B=Math.cos(T);_=[_[0]*B-_[1]*L,_[0]*L+_[1]*B]}const j=[b?_[0]:i.ay(d,_[0],this.transform.zoom),b?_[1]:i.ay(d,_[1],this.transform.zoom),0],N=new Float32Array(16);return i.bq(N,a,j),N}saveTileTexture(a){if(a.context!==this.context)return;const d=a.size[0],_=this._tileTextures[d];_?_.push(a):this._tileTextures[d]=[a]}getTileTexture(a){const d=this._tileTextures[a];return d&&d.length>0?d.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(a,d,_){const y=_===void 0?this.terrain&&this.terrain.renderingToTexture:_,b=[];return this.style&&this.style.enable3dLights()&&(a==="globeRaster"||a==="terrainRaster"?(b.push("LIGHTING_3D_MODE"),b.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):y||b.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||b.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(b.push("TERRAIN"),this.linearFloatFilteringSupported()&&b.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&b.push("GLOBE"),!this._fogVisible||y||d!==void 0&&!d||b.push("FOG","FOG_DITHERING"),y&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}getOrCreateProgram(a,d){this.cache=this.cache||{};const _=d&&d.defines||[],y=d&&d.config,b=this.currentGlobalDefines(a,d&&d.overrideFog,d&&d.overrideRtt).concat(_),T=og.cacheKey(W_[a],a,b,y);return this.cache[T]||(this.cache[T]=new og(this.context,a,W_[a],y,JA[a],b)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(a,d){if(this.style.enable3dLights()){const _=this.style.directionalLight,y=this.style.ambientLight;if(_&&y){const b=((T,j,N)=>{const L=T.properties.get("direction"),B=T.properties.get("color-use-theme")==="none",X=T.properties.get("color").toNonPremultipliedRenderColor(B?null:N.getLut(T.scope)).toArray01(),q=T.properties.get("intensity"),Q=j.properties.get("color-use-theme")==="none",re=j.properties.get("color").toNonPremultipliedRenderColor(Q?null:N.getLut(j.scope)).toArray01(),ae=j.properties.get("intensity"),fe=[L.x,L.y,L.z],de=i.dM(re,ae),xe=i.dM(X,q);return{u_lighting_ambient_color:de,u_lighting_directional_dir:fe,u_lighting_directional_color:xe,u_ground_radiance:Sy(fe,xe,de)}})(_,y,this.style);d.setLightsUniformValues(a,b)}}}uploadCommonUniforms(a,d,_,y,b){if(this.uploadCommonLightUniforms(a,d),this.terrain&&this.terrain.renderingToTexture)return;const T=this.style.fog;if(T){const j=T.getOpacity(this.transform.pitch),N=((L,B,X,q,Q,re,ae,fe,de,xe,je,we)=>{const Ve=L.transform,Ne=B.properties.get("color-use-theme")==="none",Ge=B.properties.get("color").toNonPremultipliedRenderColor(Ne?null:L.style.getLut(B.scope)).toArray01();Ge[3]=q;const Be=L.frameCounter/1e3%1,[De,We]=B.properties.get("vertical-range");return{u_fog_matrix:X?Ve.calculateFogTileMatrix(X):we||L.identityMat,u_fog_range:B.getFovAdjustedRange(Ve._fov),u_fog_color:Ge,u_fog_horizon_blend:B.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(De,We),We],u_fog_temporal_offset:Be,u_frustum_tl:Q,u_frustum_tr:re,u_frustum_br:ae,u_frustum_bl:fe,u_globe_pos:de,u_globe_radius:xe,u_viewport:je,u_globe_transition:i.aj(Ve.zoom),u_is_globe:+(Ve.projection.name==="globe")}})(this,T,_,j,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.o.devicePixelRatio,this.transform.height*i.o.devicePixelRatio],y);d.setFogUniformValues(a,N)}b&&d.setCutoffUniformValues(a,b.uniformValues)}setTileLoadedFlag(a){this.tileLoaded=a}saveCanvasCopy(){const a=this.canvasCopy();a&&(this.frameCopies.push(a),this.tileLoaded=!1)}canvasCopy(){const a=this.context.gl,d=a.createTexture();return a.bindTexture(a.TEXTURE_2D,d),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,a.drawingBufferWidth,a.drawingBufferHeight,0),d}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const a=this.style&&this.style.fog;return!!a&&a.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const a=this._backgroundTiles,d=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const y of _)d[y.key]=a[y.key]||new Sa(y,512,this.transform.tileZoom,this,void 0,this.worldview);return d}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(a,d){return!(!a.is3D(!(!this.terrain||!this.terrain.enabled))||a.type!=="clip"&&a.type!=="building"&&(a.minzoom&&a.minzoom>this.transform.zoom||(this.style._clipLayerPresent||a.sourceLayer!=="building"&&a.sourceLayer!=="procedural_buildings")&&(!d||d.type!=="batched-model")))}isTileAffectedByFog(a){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let d=this._cachedTileFogOpacities[a.key];return d||(this._cachedTileFogOpacities[a.key]=d=this.style.fog.getOpacityForTile(a)),d[0]>=ze||d[1]>=ze}setupDepthForOcclusion(a,d,_){const y=this.context,b=y.gl,T=!!_;var j;_||(_={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),y.activeTexture.set(b.TEXTURE3),a&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),_.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],_.u_depth_range_unpack=[2/((j=this.depthRangeFor3D)[1]-j[0]),-1-2*j[0]/(j[1]-j[0])],_.u_occluder_half_size=.5*this.occlusionParams.occluderSize,_.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),y.activeTexture.set(b.TEXTURE0),T||d.setTerrainUniformValues(y,_)}}function Mh(g,a){let d=!1,_=null;const y=()=>{_=null,d&&(g(),_=setTimeout(y,a),d=!1)};return()=>(d=!0,_||y(),_)}class E0{constructor(a){this._hashName=a&&encodeURIComponent(a),i.aX(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Mh(this._updateHashUnthrottled.bind(this),300)}addTo(a){return this._map=a,window.addEventListener("hashchange",this._onHashChange,!1),a.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const a=this._map;if(!a)return"";const d=C0(a);if(this._hashName){const _=this._hashName;let y=!1;const b=location.hash.slice(1).split("&").map(T=>{const j=T.split("=")[0];return j===_?(y=!0,`${j}=${d}`):T}).filter(T=>T);return y||b.push(`${_}=${d}`),`#${b.join("&")}`}return`#${d}`}_getCurrentHash(){const a=location.hash.replace("#","");if(this._hashName){let d;return a.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(d=_)}),(d&&d[1]||"").split("/")}return a.split("/")}_onHashChange(){const a=this._map;if(!a)return!1;const d=this._getCurrentHash();if(d.length>=3&&!d.some(_=>isNaN(Number(_)))){const _=a.dragRotate.isEnabled()&&a.touchZoomRotate.isEnabled()?+(d[3]||0):a.getBearing();return a.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:_,pitch:+(d[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function C0(g,a){const d=g.getCenter(),_=Math.round(100*g.getZoom())/100,y=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,y),T=Math.round(d.lng*b)/b,j=Math.round(d.lat*b)/b,N=g.getBearing(),L=g.getPitch();let B=a?`/${T}/${j}/${_}`:`${_}/${j}/${T}`;return(N||L)&&(B+="/"+Math.round(10*N)/10),L&&(B+=`/${Math.round(L)}`),B}const rp={linearity:.3,easing:i.eS(0,0,.3,1)},Vd=Object.assign({deceleration:2500,maxSpeed:1400},rp),Yy=Object.assign({deceleration:20,maxSpeed:1400},rp),uc=Object.assign({deceleration:1e3,maxSpeed:360},rp),Ky=Object.assign({deceleration:1e3,maxSpeed:90},rp);class A0{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.o.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,d=i.o.now();for(;a.length>0&&d-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const d={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)d.zoom+=b.zoomDelta||0,d.bearing+=b.bearingDelta||0,d.pitch+=b.pitchDelta||0,b.panDelta&&d.pan._add(b.panDelta),b.around&&(d.around=b.around),b.pinchAround&&(d.pinchAround=b.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(d.pan.mag()){const b=ip(d.pan.mag(),_,Object.assign({},Vd,a||{}));y.offset=d.pan.mult(b.amount/d.pan.mag()),y.center=this._map.transform.center,np(y,b)}if(d.zoom){const b=ip(d.zoom,_,Yy);y.zoom=this._map.transform.zoom+b.amount,np(y,b)}if(d.bearing){const b=ip(d.bearing,_,uc);y.bearing=this._map.transform.bearing+i.aA(b.amount,-179,179),np(y,b)}if(d.pitch){const b=ip(d.pitch,_,Ky);y.pitch=this._map.transform.pitch+b.amount,np(y,b)}if(y.zoom||y.bearing){const b=d.pinchAround===void 0?d.around:d.pinchAround;y.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function np(g,a){(!g.duration||g.duration<a.duration)&&(g.duration=a.duration,g.easing=a.easing)}function ip(g,a,d){const{maxSpeed:_,linearity:y,deceleration:b}=d,T=i.aA(g*y/(a/1e3),-_,_),j=Math.abs(T)/(b*y);return{easing:d.easing,duration:1e3*j,amount:T*(j/2)}}class bs extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,d,_,y={}){const b=pe(d.getCanvasContainer(),_),T=d.unproject(b);super(a,Object.assign({point:b,lngLat:T,originalEvent:_},y)),this._defaultPrevented=!1,this.target=d}}class sp extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,d,_){const y=a==="touchend"?_.changedTouches:_.touches,b=be(d.getCanvasContainer(),y),T=b.map(N=>d.unproject(N)),j=b.reduce((N,L,B,X)=>N.add(L.div(X.length)),new i.P(0,0));super(a,{points:b,point:j,lngLats:T,lngLat:d.unproject(j),originalEvent:_}),this._defaultPrevented=!1}}class Jy extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,d){super("wheel",{originalEvent:d}),this._defaultPrevented=!1}}class Qy{constructor(a,d){this._map=a,this._clickTolerance=d.clickTolerance}reset(){this._mousedownPos=void 0}wheel(a){return this._firePreventable(new Jy(this._map,a))}mousedown(a,d){return this._mousedownPos=d,this._firePreventable(new bs(a.type,this._map,a))}mouseup(a){this._map.fire(new bs(a.type,this._map,a))}preclick(a){const d=new MouseEvent("preclick",a);this._map.fire(new bs(d.type,this._map,d))}click(a,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||(this.preclick(a),this._map.fire(new bs(a.type,this._map,a)))}dblclick(a){return this._firePreventable(new bs(a.type,this._map,a))}mouseover(a){this._map.fire(new bs(a.type,this._map,a))}mouseout(a){this._map.fire(new bs(a.type,this._map,a))}touchstart(a){return this._firePreventable(new sp(a.type,this._map,a))}touchmove(a){this._map.fire(new sp(a.type,this._map,a))}touchend(a){this._map.fire(new sp(a.type,this._map,a))}touchcancel(a){this._map.fire(new sp(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Oh{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(a){this._map.fire(new bs(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new bs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new bs(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class e1{constructor(a,d){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,d){this.isEnabled()&&a.shiftKey&&a.button===0&&(ne(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(a,d){if(!this._active)return;const _=d,y=this._startPos,b=this._lastPos;if(!y||!b||b.equals(_)||!this._box&&_.dist(y)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=F("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));const T=Math.min(y.x,_.x),j=Math.max(y.x,_.x),N=Math.min(y.y,_.y),L=Math.max(y.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${T}px,${N}px)`,this._box.style.width=j-T+"px",this._box.style.height=L-N+"px")})}mouseupWindow(a,d){if(!this._active)return;const _=this._startPos,y=d;if(_&&a.button===0){if(this.reset(),ye(),_.x!==y.x||_.y!==y.y)return this._map.fire(new i.z("boxzoomend",{originalEvent:a})),{cameraAnimation:b=>b.fitScreenCoordinates(_,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",a)}}keydown(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),me(),delete this._startPos,delete this._lastPos}_fireEvent(a,d){return this._map.fire(new i.z(a,{originalEvent:d}))}}function pg(g,a){const d={};for(let _=0;_<g.length;_++)d[g[_].identifier]=a[_];return d}class t1{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(a,d,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=a.timeStamp),_.length===this.numTouches&&(this.centroid=function(y){const b=new i.P(0,0);for(const T of y)b._add(T);return b.div(y.length)}(d),this.touches=pg(_,d)))}touchmove(a,d,_){if(this.aborted||!this.centroid)return;const y=pg(_,d);for(const b in this.touches){const T=y[b];(!T||T.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(a,d,_){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class $d{constructor(a){this.singleTap=new t1(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(a,d,_){this.singleTap.touchstart(a,d,_)}touchmove(a,d,_){this.singleTap.touchmove(a,d,_)}touchend(a,d,_){const y=this.singleTap.touchend(a,d,_);if(y){const b=a.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(y)<30;if(b&&T||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class r1{constructor(){this._zoomIn=new $d({numTouches:1,numTaps:2}),this._zoomOut=new $d({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,d,_){this._zoomIn.touchstart(a,d,_),this._zoomOut.touchstart(a,d,_)}touchmove(a,d,_){this._zoomIn.touchmove(a,d,_),this._zoomOut.touchmove(a,d,_)}touchend(a,d,_){const y=this._zoomIn.touchend(a,d,_),b=this._zoomOut.touchend(a,d,_);return y?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(y)},{originalEvent:a})}):b?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(b)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const j0={0:1,2:2},I0={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class ap{constructor(a){this.reset(),this._clickTolerance=a.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(a,d){return!1}_move(a,d){return{}}mousedown(a,d){if(this._lastPoint)return;const _=ke(a);this._correctButton(a,_)&&(this._lastPoint=d,this._eventButton=_)}mousemoveWindow(a,d){const _=this._lastPoint;if(_){if(a.preventDefault(),this._eventButton!=null&&function(y,b){const T=j0[b];return y.buttons===void 0||(y.buttons&T)!==T}(a,this._eventButton))this.reset();else if(this._moved||!(d.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(_,d)}}mouseupWindow(a){this._lastPoint&&ke(a)===this._eventButton&&(this._moved&&ye(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class n1 extends ap{mousedown(a,d){super.mousedown(a,d),this._lastPoint&&(this._active=!0)}_correctButton(a,d){return d===0&&!a.ctrlKey}_move(a,d){return{around:d,panDelta:d.sub(a)}}}class N0 extends ap{constructor(a){super(a),this._pitchRotateKey=a.pitchRotateKey?I0[a.pitchRotateKey]:void 0}_correctButton(a,d){return this._pitchRotateKey?d===0&&a[this._pitchRotateKey]:d===0&&a.ctrlKey||d===2}_move(a,d){const _=.8*(d.x-a.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(a){this._pitchRotateKey||a.preventDefault()}}class i1 extends ap{constructor(a){super(a),this._pitchRotateKey=a.pitchRotateKey?I0[a.pitchRotateKey]:void 0}_correctButton(a,d){return this._pitchRotateKey?d===0&&a[this._pitchRotateKey]:d===0&&a.ctrlKey||d===2}_move(a,d){const _=-.5*(d.y-a.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(a){this._pitchRotateKey||a.preventDefault()}}class q2{constructor(a,d){this._map=a,this._el=a.getCanvasContainer(),this._minTouches=1,this._clickTolerance=d.clickTolerance||1,this.reset(),i.aX(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0)}touchstart(a,d,_){return this._calculateTransform(a,d,_)}touchmove(a,d,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(_.length===1&&!i.eT())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return a.cancelable&&a.preventDefault(),this._calculateTransform(a,d,_)}}touchend(a,d,_){this._calculateTransform(a,d,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,d,_){_.length>0&&(this._active=!0);const y=pg(_,d),b=new i.P(0,0),T=new i.P(0,0);let j=0;for(const L in y){const B=y[L],X=this._touches[L];X&&(b._add(B),T._add(B.sub(X)),j++,y[L]=B)}if(this._touches=y,j<this._minTouches||!T.mag())return;const N=T.div(j);return this._sum._add(N),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(j),panDelta:N}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=F("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class k0{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(a){}_move(a,d,_){return{}}touchstart(a,d,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([d[0],d[1]]))}touchmove(a,d,_){const y=this._firstTwoTouches;if(!y)return;a.preventDefault();const[b,T]=y,j=mg(_,d,b),N=mg(_,d,T);if(!j||!N)return;const L=this._aroundCenter?null:j.add(N).div(2);return this._move([j,N],L,a)}touchend(a,d,_){if(!this._firstTwoTouches)return;const[y,b]=this._firstTwoTouches,T=mg(_,d,y),j=mg(_,d,b);T&&j||(this._active&&ye(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function mg(g,a,d){for(let _=0;_<g.length;_++)if(g[_].identifier===d)return a[_]}function s1(g,a){return Math.log2(g/a)}class G2 extends k0{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,d){const _=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(s1(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:s1(this._distance,_),pinchAround:d}}}function a1(g,a){return 180*g.angleWith(a)/Math.PI}class W2 extends k0{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,d){const _=this._vector;if(this._vector=a[0].sub(a[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:a1(this._vector,_),pinchAround:d}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const d=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;const y=a1(a,_);return Math.abs(y)<d}}function P0(g){return Math.abs(g.y)>Math.abs(g.x)}class H2 extends k0{constructor(a){super(),this._map=a}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(a){this._lastPoints=a,P0(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,d,_){const y=this._lastPoints;if(!y)return;const b=a[0].sub(y[0]),T=a[1].sub(y[1]);return this._map._cooperativeGestures&&!i.eT()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(b,T,_.timeStamp),!this._valid)?void 0:(this._lastPoints=a,this._active=!0,{pitchDelta:(b.y+T.y)/2*-.5})}gestureBeginsVertically(a,d,_){if(this._valid!==void 0)return this._valid;const y=a.mag()>=2,b=d.mag()>=2;if(!y&&!b)return;if(!y||!b)return this._firstMove==null&&(this._firstMove=_),_-this._firstMove<100&&void 0;const T=a.y>0==d.y>0;return P0(a)&&P0(d)&&T}}const Z2={panStep:100,bearingStep:15,pitchStep:10};class X2{constructor(){const a=Z2;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let d=0,_=0,y=0,b=0,T=0;switch(a.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:a.shiftKey?_=-1:(a.preventDefault(),b=-1);break;case 39:a.shiftKey?_=1:(a.preventDefault(),b=1);break;case 38:a.shiftKey?y=1:(a.preventDefault(),T=-1);break;case 40:a.shiftKey?y=-1:(a.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(_=0,y=0),{cameraAnimation:j=>{const N=j.getZoom();j.easeTo({duration:300,easeId:"keyboardHandler",easing:Y2,zoom:d?Math.round(N)+d*(a.shiftKey?2:1):N,bearing:j.getBearing()+_*this._bearingStep,pitch:j.getPitch()+y*this._pitchStep,offset:[-b*this._panStep,-T*this._panStep],center:j.getCenter()},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Y2(g){return g*(2-g)}const K2=4.000244140625,aj=1/450;class oj{constructor(a,d){this._map=a,this._el=a.getCanvasContainer(),this._handler=d,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=aj,i.aX(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&a.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(a){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(a.ctrlKey||a.metaKey||this.isZooming()||i.eT()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let d=a.deltaMode===WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const _=i.o.now(),y=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,d!==0&&d%K2==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=d,this._timeout=window.setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(y*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),a.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=a,this._delta-=d,this._active||this._start(a)),a.preventDefault()}_onTimeout(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=pe(this._el,a);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:d,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._map.transform;this._type==="wheel"&&a.projection.wrap&&(a._center.lng>=180||a._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const d=()=>a._terrainEnabled()&&this._aroundCoord?a.computeZoomRelativeTo(this._aroundCoord):a.zoom;if(this._delta!==0){const L=this._type==="wheel"&&Math.abs(this._delta)>K2?this._wheelZoomRate:this._defaultZoomRate;let B=2/(1+Math.exp(-Math.abs(this._delta*L)));this._delta<0&&B!==0&&(B=1/B);const X=d(),q=Math.pow(2,X),Q=typeof this._targetZoom=="number"?a.zoomScale(this._targetZoom):q;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(Q*B))),this._type==="wheel"&&(this._startZoom=X,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const _=typeof this._targetZoom=="number"?this._targetZoom:d(),y=this._startZoom,b=this._easing;let T,j=!1;if(this._type==="wheel"&&y&&b){const L=Math.min((i.o.now()-this._lastWheelEventTime)/200,1),B=b(L);T=i.ak(y,_,B),L<1?this._frameId||(this._frameId=!0):j=!0}else T=_,j=!0;this._active=!0,j&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let N=T-d();return N*this._lastDelta<0&&(N=0),{noInertia:!0,needsRenderFrame:!j,zoomDelta:N,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let d=i.eU;if(this._prevEase){const _=this._prevEase,y=(i.o.now()-_.start)/_.duration,b=_.easing(y+.01)-_.easing(y),T=.27/Math.sqrt(b*b+1e-4)*.01,j=Math.sqrt(.0729-T*T);d=i.eS(T,j,.25,1)}return this._prevEase={start:i.o.now(),duration:a,easing:d},d}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=F("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Fs{constructor(a,d){this._clickZoom=a,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class J2{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(a,d){return a.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(a.shiftKey?-1:1),around:_.unproject(d)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class lj{constructor(){this._tap=new $d({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(a,d,_){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=d[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(a,d,_))}touchmove(a,d,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const y=d[0],b=y.y-this._swipePoint.y;return this._swipePoint=y,a.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(a,d,_)}touchend(a,d,_){this._tapTime?this._swipePoint&&_.length===0&&this.reset():this._tap.touchend(a,d,_)&&(this._tapTime=a.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cj{constructor(a,d,_){this._el=a,this._mousePan=d,this._touchPan=_}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class uj{constructor(a,d,_){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=d,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class gg{constructor(a,d,_,y){this._el=a,this._touchZoom=d,this._touchRotate=_,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const _g=g=>g.zoom||g.drag||g.pitch||g.rotate;class o1 extends i.z{}class D0{constructor(){this.constants=[1,1,.01],this.radius=0}setup(a,d){const _=i.av([],d,a);this.radius=i.ag(_[2]<0?i.eW([],_,this.constants):[_[0],_[1],0])}projectRay(a){i.eW(a,a,this.constants),i.aw(a,a),i.eX(a,a,this.constants);const d=i.c4([],a,this.radius);if(d[2]>0){const _=i.c4([],[0,0,1],i.bI(d,[0,0,1])),y=i.c4([],i.aw([],[d[0],d[1],0]),this.radius),b=i.d7([],d,i.c4([],i.av([],i.d7([],y,_),d),2));d[0]=b[0],d[1]=b[1]}return d}}function dc(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class R0{constructor(a,d){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new A0(a),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new D0,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(d),i.aX(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,b,T]of this._listeners){const j=y===document?this.handleWindowEvent:this.handleEvent;y.addEventListener(b,j,T)}}destroy(){for(const[a,d,_]of this._listeners){const y=a===document?this.handleWindowEvent:this.handleEvent;a.removeEventListener(d,y,_)}}_addDefaultHandlers(a){const d=this._map,_=d.getCanvasContainer();this._add("mapEvent",new Qy(d,a));const y=d.boxZoom=new e1(d,a);this._add("boxZoom",y);const b=new r1,T=new J2;d.doubleClickZoom=new Fs(T,b),this._add("tapZoom",b),this._add("clickZoom",T);const j=new lj;this._add("tapDragZoom",j);const N=d.touchPitch=new H2(d);this._add("touchPitch",N);const L=new N0(a),B=new i1(a);d.dragRotate=new uj(a,L,B),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",B,["mouseRotate"]);const X=new n1(a),q=new q2(d,a);d.dragPan=new cj(_,X,q),this._add("mousePan",X),this._add("touchPan",q,["touchZoom","touchRotate"]);const Q=new W2,re=new G2;d.touchZoomRotate=new gg(_,re,Q,j),this._add("touchRotate",Q,["touchPan","touchZoom"]),this._add("touchZoom",re,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Oh(d));const ae=d.scrollZoom=new oj(d,this);this._add("scrollZoom",ae,["mousePan"]);const fe=d.keyboard=new X2;this._add("keyboard",fe);for(const de of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])a.interactive&&a[de]&&d[de].enable(a[de])}_add(a,d,_){this._handlers.push({handlerName:a,handler:d,allowed:_}),this._handlersById[a]=d}stop(a){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!_g(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(a,d,_){for(const y in a)if(y!==_&&(!d||d.indexOf(y)<0))return!0;return!1}handleWindowEvent(a){this.handleEvent(a,`${a.type}Window`)}_getMapTouches(a){const d=[];for(const _ of a)this._el.contains(_.target)&&d.push(_);return d}handleEvent(a,d){this._updatingCamera=!0;const _=a.type==="renderFrame",y=_?void 0:a,b={needsRenderFrame:!1},T={},j={},N=a.touches?this._getMapTouches(a.touches):void 0,L=N?be(this._el,N):_?void 0:pe(this._el,a);for(const{handlerName:q,handler:Q,allowed:re}of this._handlers){if(!Q.isEnabled())continue;let ae;this._blockedByActive(j,re,q)?Q.reset():Q[d||a.type]&&(ae=Q[d||a.type](a,L,N),this.mergeHandlerResult(b,T,ae,q,y),ae&&ae.needsRenderFrame&&this._triggerRenderFrame()),(ae||Q.isActive())&&(j[q]=Q)}const B={};for(const q in this._previousActiveHandlers)j[q]||(B[q]=y);this._previousActiveHandlers=j,(Object.keys(B).length||dc(b))&&(this._changes.push([b,T,B]),this._triggerRenderFrame()),(Object.keys(j).length||dc(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:X}=b;X&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],X(this._map))}mergeHandlerResult(a,d,_,y,b){if(!_)return;Object.assign(a,_);const T={handlerName:y,originalEvent:_.originalEvent||b};_.zoomDelta!==void 0&&(d.zoom=T),_.panDelta!==void 0&&(d.drag=T),_.pitchDelta!==void 0&&(d.pitch=T),_.bearingDelta!==void 0&&(d.rotate=T)}_applyChanges(){const a={},d={},_={};for(const[y,b,T]of this._changes)y.panDelta&&(a.panDelta=(a.panDelta||new i.P(0,0))._add(y.panDelta)),y.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(a.around=y.around),y.aroundCoord!==void 0&&(a.aroundCoord=y.aroundCoord),y.pinchAround!==void 0&&(a.pinchAround=y.pinchAround),y.noInertia&&(a.noInertia=y.noInertia),Object.assign(d,b),Object.assign(_,T);this._updateMapTransform(a,d,_),this._changes=[]}_updateMapTransform(a,d,_){const y=this._map,b=y.transform,T=xe=>[xe.x,xe.y,xe.z];if((xe=>{const je=this._eventsInProgress.drag;return je&&!this._handlersById[je.handlerName].isActive()})()&&!dc(a)){const xe=b.zoom;b.cameraElevationReference="sea",this._originalZoom!=null&&b._orthographicProjectionAtLowPitch&&b.projection.name!=="globe"&&b.pitch===0?(b.cameraElevationReference="ground",b.zoom=this._originalZoom):(b.recenterOnTerrain(),b.cameraElevationReference="ground"),xe!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&y._stop(!0),!dc(a))return void this._fireEvents(d,_,!0);let{panDelta:j,zoomDelta:N,bearingDelta:L,pitchDelta:B,around:X,aroundCoord:q,pinchAround:Q}=a;b._isCameraConstrained&&(N>0&&(N=0),b._isCameraConstrained=!1),Q!==void 0&&(X=Q),(N||(xe=>d[xe]&&!this._eventsInProgress[xe])("drag"))&&X&&(this._dragOrigin=T(b.pointCoordinate3D(X)),this._originalZoom=b.zoom,this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",y._stop(!0),X=X||y.transform.centerPoint,L&&(b.bearing+=L),B&&(b.pitch+=B),b._updateCameraState();const re=[0,0,0];if(j)if(b.projection.name==="mercator"){const xe=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(X).dir),je=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(X.sub(j)).dir);re[0]=je[0]-xe[0],re[1]=je[1]-xe[1]}else{const xe=b.pointCoordinate(X);if(b.projection.name==="globe"){j=j.rotate(-b.angle);const je=b._pixelsPerMercatorPixel/b.worldSize;re[0]=-j.x*i.eV(i.a_(xe.y))*je,re[1]=-j.y*i.eV(b.center.lat)*je}else{const je=b.pointCoordinate(X.sub(j));xe&&je&&(re[0]=je.x-xe.x,re[1]=je.y-xe.y)}}const ae=b.zoom,fe=[0,0,0];if(N){const xe=T(q||b.pointCoordinate3D(X)),je={dir:i.aw([],i.av([],xe,b._camera.position))};if(je.dir[2]<0){const we=b.zoomDeltaToMovement(xe,N);i.c4(fe,je.dir,we)}}const de=i.d7(re,re,fe);b._translateCameraConstrained(de),N&&Math.abs(b.zoom-ae)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(d,_,!0)}_fireEvents(a,d,_){const y=_g(this._eventsInProgress),b=_g(a),T={};for(const B in a){const{originalEvent:X}=a[B];this._eventsInProgress[B]||(T[`${B}start`]=X),this._eventsInProgress[B]=a[B]}!y&&b&&this._fireEvent("movestart",b.originalEvent);for(const B in T)this._fireEvent(B,T[B]);b&&this._fireEvent("move",b.originalEvent);for(const B in a){const{originalEvent:X}=a[B];this._fireEvent(B,X)}const j={};let N;for(const B in this._eventsInProgress){const{handlerName:X,originalEvent:q}=this._eventsInProgress[B];this._handlersById[X].isActive()||(delete this._eventsInProgress[B],N=d[X]||q,j[`${B}end`]=N)}for(const B in j)this._fireEvent(B,j[B]);const L=_g(this._eventsInProgress);if(_&&(y||b)&&!L){this._updatingCamera=!0;const B=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),X=q=>q!==0&&-this._bearingSnap<q&&q<this._bearingSnap;B?(X(B.bearing||this._map.getBearing())&&(B.bearing=0),this._map.easeTo(B,{originalEvent:N})):(this._map.fire(new i.z("moveend",{originalEvent:N})),X(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(a,d){this._map.fire(new i.z(a,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{this._frameId=void 0,this.handleEvent(new o1("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const fa="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class du extends i.E{constructor(a,d){super(),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=d.bearingSnap,this._respectPrefersReducedMotion=d.respectPrefersReducedMotion!==!1,i.aX(["_renderFrameCallback"],this)}getCenter(){return new i.aS(this.transform.center.lng,this.transform.center.lat)}setCenter(a,d){return this.jumpTo({center:a},d)}panBy(a,d,_){return a=i.P.convert(a).mult(-1),this.panTo(this.transform.center,Object.assign({offset:a},d),_)}panTo(a,d,_){return this.easeTo(Object.assign({center:a},d),_)}getZoom(){return this.transform.zoom}setZoom(a,d){return this.jumpTo({zoom:a},d),this}zoomTo(a,d,_){return this.easeTo(Object.assign({zoom:a},d),_)}zoomIn(a,d){return this.zoomTo(this.getZoom()+1,a,d),this}zoomOut(a,d){return this.zoomTo(this.getZoom()-1,a,d),this}getBearing(){return this.transform.bearing}setBearing(a,d){return this.jumpTo({bearing:a},d),this}getPadding(){return this.transform.padding}setPadding(a,d){return this.jumpTo({padding:a},d),this}rotateTo(a,d,_){return this.easeTo(Object.assign({bearing:a},d),_)}resetNorth(a,d){return this.rotateTo(0,Object.assign({duration:1e3},a),d),this}resetNorthPitch(a,d){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},a),d),this}snapToNorth(a,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,d):this}getPitch(){return this.transform.pitch}setPitch(a,d){return this.jumpTo({pitch:a},d),this}cameraForBounds(a,d){a=i.aI.convert(a);const _=d&&d.bearing||0,y=d&&d.pitch||0,b=a.getNorthWest(),T=a.getSouthEast();return this._cameraForBounds(this.transform,b,T,_,y,d)}_extendPadding(a){const d={top:0,right:0,bottom:0,left:0};return a==null?Object.assign({},d,this.transform.padding):typeof a=="number"?{top:a,bottom:a,right:a,left:a}:Object.assign({},d,a)}_extendCameraOptions(a){return(a=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},a)).padding=this._extendPadding(a.padding),a}_minimumAABBFrustumDistance(a,d){const _=d.max[0]-d.min[0],y=d.max[1]-d.min[1];return _/y>a.aspect?_/(2*Math.tan(.5*a.fovX)*a.aspect):y/(2*Math.tan(.5*a.fovY)*a.aspect)}_cameraForBoundsOnGlobe(a,d,_,y,b,T){const j=a.clone(),N=this._extendCameraOptions(T);j.bearing=y,j.pitch=b;const L=i.aS.convert(d),B=i.aS.convert(_),X=.5*(L.lat+B.lat),q=.5*(L.lng+B.lng),Q=i.eY(X,q),re=i.aw([],Q),ae=i.aw([],i.bH([],re,[0,1,0])),fe=i.bH([],ae,re),de=[ae[0],ae[1],ae[2],0,fe[0],fe[1],fe[2],0,re[0],re[1],re[2],0,0,0,0,1],xe=[Q,i.eY(L.lat,L.lng),i.eY(B.lat,L.lng),i.eY(B.lat,B.lng),i.eY(L.lat,B.lng),i.eY(X,L.lng),i.eY(X,B.lng),i.eY(L.lat,q),i.eY(B.lat,q)];let je=i.d8.fromPoints(xe.map(xt=>[i.bI(ae,xt),i.bI(fe,xt),i.bI(re,xt)]));const we=i.af([],je.center,de);i.eZ(we)===0&&i.e_(we,0,0,1),i.aw(we,we),i.c4(we,we,i.aD),j.center=i.e$(we);const Ve=j.getWorldToCameraMatrix(),Ne=i.bk(new Float64Array(16),Ve);je=i.d8.applyTransform(je,i.aB([],Ve,de));const Ge=this._extendAABB(je,j,N,y);if(!Ge)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");je=Ge,i.af(we,we,Ve);const Be=.5*(je.max[2]-je.min[2]),De=this._minimumAABBFrustumDistance(j,je),We=i.c4([],[0,0,1],Be),st=i.d7(We,we,We),rt=De+(j.pitch===0?0:i.bF(we,st)),bt=j.globeCenterInViewSpace,_t=i.av([],we,[bt[0],bt[1],bt[2]]);i.aw(_t,_t),i.c4(_t,_t,rt);const kt=i.d7([],we,_t);i.af(kt,kt,Ne);const nr=i.eL/i.aD,ht=i.ag(kt),Ke=i.ce(Math.max(ht*nr-i.eL,Number.EPSILON),0),Pt=Math.min(j.zoomFromMercatorZAdjusted(Ke),N.maxZoom);return Pt>.5*(i.cZ+i.cK)?(j.setProjection({name:"mercator"}),j.zoom=Pt,this._cameraForBounds(j,d,_,y,b,T)):{center:j.center,zoom:Pt,bearing:y,pitch:b}}_extendAABB(a,d,_,y){const b=.5*((_.padding.left||0)+(_.padding.right||0)),T=.5*((_.padding.top||0)+(_.padding.bottom||0)),j=T,N=b,L=b,B=T,X=d.width-(N+L),q=d.height-(j+B),Q=i.av([],a.max,a.min),re=Math.min(X/Q[0],q/Q[1]),ae=Math.min(d.scaleZoom(d.scale*re),_.maxZoom);if(isNaN(ae))return null;const fe=d.scale/d.zoomScale(ae),de=new i.d8([a.min[0]-N*fe,a.min[1]-B*fe,a.min[2]],[a.max[0]+L*fe,a.max[1]+j*fe,a.max[2]]),xe=(typeof _.offset.x=="number"&&typeof _.offset.y=="number"?new i.P(_.offset.x,_.offset.y):i.P.convert(_.offset)).rotate(-i.an(y));return de.center[0]-=xe.x*fe,de.center[1]+=xe.y*fe,de}queryTerrainElevation(a,d){const _=this.transform.elevation;return _?(d=Object.assign({},{exaggerated:!0},d),_.getAtPoint(i.ae.fromLngLat(a),null,d.exaggerated)):null}_cameraForBounds(a,d,_,y,b,T){if(a.projection.name==="globe")return this._cameraForBoundsOnGlobe(a,d,_,y,b,T);const j=a.clone(),N=this._extendCameraOptions(T);j.bearing=y,j.pitch=b;const L=i.aS.convert(d),B=i.aS.convert(_),X=new i.aS(L.lng,B.lat),q=new i.aS(B.lng,L.lat),Q=j.project(L),re=j.project(B),ae=this.queryTerrainElevation(L),fe=this.queryTerrainElevation(B),de=this.queryTerrainElevation(X),xe=this.queryTerrainElevation(q),je=[[Q.x,Q.y,Math.min(ae||0,fe||0,de||0,xe||0)],[re.x,re.y,Math.max(ae||0,fe||0,de||0,xe||0)]];let we=i.d8.fromPoints(je);const Ve=j.getWorldToCameraMatrix(),Ne=i.bk(new Float64Array(16),Ve);we=i.d8.applyTransform(we,Ve);const Ge=this._extendAABB(we,j,N,y);if(!Ge)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");we=Ge;const Be=.5*i.av([],we.max,we.min)[2],De=this._minimumAABBFrustumDistance(j,we),We=[0,0,1,0];i.aC(We,We,Ve),i.f0(We,We);const st=i.c4([],We,De+Be),rt=i.d7([],we.center,st);i.af(we.center,we.center,Ne),i.af(rt,rt,Ne);const bt=j.unproject(new i.P(we.center[0],we.center[1])),_t=i.f1(j.projection,bt),kt=Math.pow(2,_t),nr=Math.min(j._zoomFromMercatorZ(rt[2]*j.pixelsPerMeter*kt/j.worldSize),N.maxZoom);return j.mercatorFromTransition&&nr<.5*(i.cZ+i.cK)?(j.setProjection({name:"globe"}),j.zoom=nr,this._cameraForBounds(j,d,_,y,b,T)):{center:bt,zoom:nr,bearing:y,pitch:b}}fitBounds(a,d,_){const y=this.cameraForBounds(a,d);return this._fitInternal(y,d,_)}fitScreenCoordinates(a,d,_,y,b){const T=i.P.convert(a),j=i.P.convert(d),N=new i.P(Math.min(T.x,j.x),Math.min(T.y,j.y)),L=new i.P(Math.max(T.x,j.x),Math.max(T.y,j.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(T,j))return this;const B=this.transform.pointLocation3D(N),X=this.transform.pointLocation3D(L),q=this.transform.pointLocation3D(new i.P(N.x,L.y)),Q=this.transform.pointLocation3D(new i.P(L.x,N.y)),re=[Math.min(B.lng,X.lng,q.lng,Q.lng),Math.min(B.lat,X.lat,q.lat,Q.lat)],ae=[Math.max(B.lng,X.lng,q.lng,Q.lng),Math.max(B.lat,X.lat,q.lat,Q.lat)],fe=y&&y.pitch?y.pitch:this.getPitch(),de=this._cameraForBounds(this.transform,re,ae,_,fe,y);return this._fitInternal(de,y,b)}_fitInternal(a,d,_){return a?(d=Object.assign(a,d)).linear?this.easeTo(d,_):this.flyTo(d,_):this}jumpTo(a,d){this.stop();const _=a.preloadOnly?this.transform.clone():this.transform;let y=!1,b=!1,T=!1;"zoom"in a&&_.zoom!==+a.zoom&&(y=!0,_.zoom=+a.zoom),a.center!==void 0&&(_.center=i.aS.convert(a.center)),"bearing"in a&&_.bearing!==+a.bearing&&(b=!0,_.bearing=+a.bearing),"pitch"in a&&_.pitch!==+a.pitch&&(T=!0,_.pitch=+a.pitch);const j=typeof a.padding=="number"?this._extendPadding(a.padding):a.padding;if(a.padding!=null&&!_.isPaddingEqual(j))if(a.retainPadding===!1){const N=_.clone();N.padding=j,_.setLocationAtPoint(_.center,N.centerPoint)}else _.padding=j;return a.preloadOnly?(this._preloadTiles(_),this):(this.fire(new i.z("movestart",d)).fire(new i.z("move",d)),y&&this.fire(new i.z("zoomstart",d)).fire(new i.z("zoom",d)).fire(new i.z("zoomend",d)),b&&this.fire(new i.z("rotatestart",d)).fire(new i.z("rotate",d)).fire(new i.z("rotateend",d)),T&&this.fire(new i.z("pitchstart",d)).fire(new i.z("pitch",d)).fire(new i.z("pitchend",d)),this.fire(new i.z("moveend",d)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.w(fa),this.transform.getFreeCameraOptions()}setFreeCameraOptions(a,d){const _=this.transform;if(!_.projection.supportsFreeCamera)return i.w(fa),this;this.stop();const y=_.zoom,b=_.pitch,T=_.bearing;_.setFreeCameraOptions(a);const j=y!==_.zoom,N=b!==_.pitch,L=T!==_.bearing;return this.fire(new i.z("movestart",d)).fire(new i.z("move",d)),j&&this.fire(new i.z("zoomstart",d)).fire(new i.z("zoom",d)).fire(new i.z("zoomend",d)),L&&this.fire(new i.z("rotatestart",d)).fire(new i.z("rotate",d)).fire(new i.z("rotateend",d)),N&&this.fire(new i.z("pitchstart",d)).fire(new i.z("pitch",d)).fire(new i.z("pitchend",d)),this.fire(new i.z("moveend",d)),this}easeTo(a,d){this._stop(!1,a.easeId),((a=Object.assign({offset:[0,0],duration:500,easing:i.eU},a)).animate===!1||this._prefersReducedMotion(a))&&(a.duration=0);const _=this.transform,y=this.getZoom(),b=this.getBearing(),T=this.getPitch(),j=this.getPadding(),N="zoom"in a?+a.zoom:y,L="bearing"in a?this._normalizeBearing(a.bearing,b):b,B="pitch"in a?+a.pitch:T,X=this._extendPadding(a.padding),q=i.P.convert(a.offset);let Q,re,ae;if(_.projection.name==="globe"){const We=i.ae.fromLngLat(_.center),st=q.rotate(-_.angle);We.x+=st.x/_.worldSize,We.y+=st.y/_.worldSize;const rt=We.toLngLat(),bt=i.aS.convert(a.center||rt);this._normalizeCenter(bt),Q=_.centerPoint.add(st),re=new i.P(We.x,We.y).mult(_.worldSize),ae=new i.P(i.aF(bt.lng),i.aJ(bt.lat)).mult(_.worldSize).sub(re)}else{Q=_.centerPoint.add(q);const We=_.pointLocation(Q),st=i.aS.convert(a.center||We);this._normalizeCenter(st),re=_.project(We),ae=_.project(st).sub(re)}const fe=_.zoomScale(N-y);let de,xe;a.around&&(de=i.aS.convert(a.around),xe=_.locationPoint(de));const je=this._zooming||N!==y,we=this._rotating||b!==L,Ve=this._pitching||B!==T,Ne=!_.isPaddingEqual(X),Ge=a.retainPadding===!1?_.clone():_,Be=We=>st=>{if(je&&(We.zoom=i.ak(y,N,st)),we&&(We.bearing=i.ak(b,L,st)),Ve&&(We.pitch=i.ak(T,B,st)),Ne&&(Ge.interpolatePadding(j,X,st),Q=Ge.centerPoint.add(q)),de)We.setLocationAtPoint(de,xe);else{const rt=We.zoomScale(We.zoom-y),bt=N>y?Math.min(2,fe):Math.max(.5,fe),_t=Math.pow(bt,1-st),kt=We.unproject(re.add(ae.mult(st*_t)).mult(rt));We.setLocationAtPoint(We.renderWorldCopies?kt.wrap():kt,Q)}return a.preloadOnly||this._fireMoveEvents(d),We};if(a.preloadOnly){const We=this._emulate(Be,a.duration,_);return this._preloadTiles(We),this}const De={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=je,this._rotating=we,this._pitching=Ve,this._padding=Ne,this._easeId=a.easeId,this._prepareEase(d,a.noMoveStart,De),this._ease(Be(_),We=>{_.cameraElevationReference==="sea"&&_.recenterOnTerrain(),this._afterEase(d,We)},a),this}_prepareEase(a,d,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),d||_.moving||this.fire(new i.z("movestart",a)),this._zooming&&!_.zooming&&this.fire(new i.z("zoomstart",a)),this._rotating&&!_.rotating&&this.fire(new i.z("rotatestart",a)),this._pitching&&!_.pitching&&this.fire(new i.z("pitchstart",a))}_fireMoveEvents(a){this.fire(new i.z("move",a)),this._zooming&&this.fire(new i.z("zoom",a)),this._rotating&&this.fire(new i.z("rotate",a)),this._pitching&&this.fire(new i.z("pitch",a))}_afterEase(a,d){if(this._easeId&&d&&this._easeId===d)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,y=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new i.z("zoomend",a)),y&&this.fire(new i.z("rotateend",a)),b&&this.fire(new i.z("pitchend",a)),this.fire(new i.z("moveend",a))}flyTo(a,d){if(this._prefersReducedMotion(a)){const xt=i.aH(a,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(xt,d)}this.stop(),a=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:i.eU},a);const _=this.transform,y=this.getZoom(),b=this.getBearing(),T=this.getPitch(),j=this.getPadding(),N="zoom"in a?i.aA(+a.zoom,_.minZoom,_.maxZoom):y,L="bearing"in a?this._normalizeBearing(a.bearing,b):b,B="pitch"in a?+a.pitch:T,X=this._extendPadding(a.padding),q=_.zoomScale(N-y),Q=i.P.convert(a.offset);let re=_.centerPoint.add(Q);const ae=_.pointLocation(re),fe=i.aS.convert(a.center||ae);this._normalizeCenter(fe);const de=_.project(ae),xe=_.project(fe).sub(de);let je=a.curve;const we=Math.max(_.width,_.height),Ve=we/q,Ne=xe.mag();if("minZoom"in a){const xt=i.aA(Math.min(a.minZoom,y,N),_.minZoom,_.maxZoom),qt=we/_.zoomScale(xt-y);je=Math.sqrt(qt/Ne*2)}const Ge=je*je;function Be(xt){const qt=(Ve*Ve-we*we+(xt?-1:1)*Ge*Ge*Ne*Ne)/(2*(xt?Ve:we)*Ge*Ne);return Math.log(Math.sqrt(qt*qt+1)-qt)}function De(xt){return(Math.exp(xt)-Math.exp(-xt))/2}function We(xt){return(Math.exp(xt)+Math.exp(-xt))/2}const st=Be(0);let rt=function(xt){return We(st)/We(st+je*xt)},bt=function(xt){return we*((We(st)*(De(qt=st+je*xt)/We(qt))-De(st))/Ge)/Ne;var qt},_t=(Be(1)-st)/je;if(Math.abs(Ne)<1e-6||!isFinite(_t)){if(Math.abs(we-Ve)<1e-6)return this.easeTo(a,d);const xt=Ve<we?-1:1;_t=Math.abs(Math.log(Ve/we))/je,bt=function(){return 0},rt=function(qt){return Math.exp(xt*je*qt)}}a.duration="duration"in a?+a.duration:1e3*_t/("screenSpeed"in a?+a.screenSpeed/je:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0);const kt=b!==L,nr=B!==T,ht=!_.isPaddingEqual(X),Ke=a.retainPadding===!1?_.clone():_,Pt=xt=>qt=>{const or=qt*_t,Ar=1/rt(or);xt.zoom=qt===1?N:y+xt.scaleZoom(Ar),kt&&(xt.bearing=i.ak(b,L,qt)),nr&&(xt.pitch=i.ak(T,B,qt)),ht&&(Ke.interpolatePadding(j,X,qt),re=Ke.centerPoint.add(Q));const tr=qt===1?fe:xt.unproject(de.add(xe.mult(bt(or))).mult(Ar));return xt.setLocationAtPoint(xt.renderWorldCopies?tr.wrap():tr,re),xt._updateCameraOnTerrain(),a.preloadOnly||this._fireMoveEvents(d),xt};if(a.preloadOnly){const xt=this._emulate(Pt,a.duration,_);return this._preloadTiles(xt),this}return this._zooming=!0,this._rotating=kt,this._pitching=nr,this._padding=ht,this._prepareEase(d,!1),this._ease(Pt(_),()=>this._afterEase(d),a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(a){}_cancelRenderFrame(a){}_stop(a,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,d)}if(!a){const _=this.handlers;_&&_.stop(!1)}return this}_ease(a,d,_){_.animate===!1||_.duration===0?(a(1),d()):(this._easeStart=i.o.now(),this._easeOptions=_,this._onEaseFrame=a,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const a=Math.min((i.o.now()-this._easeStart)/this._easeOptions.duration,1),d=this._onEaseFrame;d&&d(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(a,d){a=i.bS(a,-180,180);const _=Math.abs(a-d);return Math.abs(a-360-d)<_&&(a-=360),Math.abs(a+360-d)<_&&(a+=360),a}_normalizeCenter(a){const d=this.transform;if(d.maxBounds||d.projection.name!=="globe"&&!d.renderWorldCopies)return;const _=a.lng-d.center.lng;a.lng+=_>180?-360:_<-180?360:0}_prefersReducedMotion(a){return this._respectPrefersReducedMotion&&i.o.prefersReducedMotion&&!(a&&a.essential)}_emulate(a,d,_){const y=Math.ceil(15*d/1e3),b=[],T=a(_.clone());for(let j=0;j<=y;j++){const N=T(j/y);b.push(N.clone())}return b}_preloadTiles(a,d){}}class op{constructor(a={}){this.options=a,i.aX(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(a){const d=this.options&&this.options.compact,_=a._getUIString("AttributionControl.ToggleAttribution");this._map=a,this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=F("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",_);const y=F("span","mapboxgl-ctrl-icon",this._compactButton);return y.setAttribute("aria-hidden","true"),y.setAttribute("title",_),this._innerContainer=F("div","mapboxgl-ctrl-attrib-inner",this._container),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let a=this._editLink;a||(a=this._editLink=this._container.querySelector(".mapbox-improve-map"));const d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.e.ACCESS_TOKEN}];if(a){const _=d.reduce((y,b,T)=>(b.value&&(y+=`${b.key}=${b.value}${T<d.length-1?"&":""}`),y),"?");a.href=`${i.e.FEEDBACK_URL}/${_}#${C0(this._map,!0)}`,a.rel="noopener nofollow"}}_updateData(a){!a||(a.dataType!=="source"||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility")&&a.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let a=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const d=this._map.style._mergedSourceCaches;for(const y in d){const b=d[y];if(b.used){const T=b.getSource();T.attribution&&a.indexOf(T.attribution)<0&&a.push(T.attribution)}}a.sort((y,b)=>y.length-b.length),a=a.filter((y,b)=>{for(let T=b+1;T<a.length;T++)if(a[T].indexOf(y)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=[...this.options.customAttribution,...a]:a.unshift(this.options.customAttribution));const _=a.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,a.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class xg{constructor(){i.aX(["_updateLogo","_updateCompact"],this)}onAdd(a){this._map=a,this._container=F("div","mapboxgl-ctrl");const d=F("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(a){a&&a.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const a=this._map.style._sourceCaches;if(Object.entries(a).length===0)return!0;for(const d in a){const _=a[d].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const a=this._container.children;if(a.length){const d=a[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}}}class l1{constructor(){i.aX(["_onIndoorUpdate"],this)}onAdd(a){return this._map=a,this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",d=>this._onIndoorUpdate(d)),this._container}_createButton(a,d){const _=F("button",a,this._container);return _.type="button",_.addEventListener("click",d),_}_createSeparator(){return F("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(a,d){this._map&&(a.setAttribute("aria-label",d),a.textContent=d)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(a){if(!a||!a.floors)return this._model=a,void(this._container.style.display="none");const d=this._model;this._model=a,this._container.style.display="inline-block",this._container.style.borderRadius="8px",d&&Array.from(this._container.children).forEach(_=>_.remove()),a.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(a.floors,a.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const a=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const d=this._map;this._model&&d&&d._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});F("span","mapboxgl-ctrl-icon",a).setAttribute("aria-hidden","true"),a.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&a.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(a),this._createSeparator()}_updateBuildingsButtonState(){const a=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");a&&this._model&&(this._model.activeFloorsVisible?a.classList.remove("mapboxgl-ctrl-level-button-selected"):a.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(a,d){for(let _=0;_<a.length;_++){const y=a[_],b=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(y.id)});this._setButtonTitle(b,y.zIndex.toString()),this._model&&y.id===this._model.selectedFloorId&&d&&b.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(b),_<a.length-1&&this._createSeparator()}}}class Q2{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const d=++this._id;return this._queue.push({callback:a,id:d,cancelled:!1}),d}remove(a){const d=this._currentlyRunning,_=d?this._queue.concat(d):this._queue;for(const y of _)if(y.id===a)return void(y.cancelled=!0)}run(a=0){const d=this._currentlyRunning=this._queue;this._queue=[];for(const _ of d)if(!_.cancelled&&(_.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class vg{constructor(a){this.jumpTo(a)}getValue(a){if(a<=this._startTime)return this._start;if(a>=this._endTime)return this._end;const d=i.dC((a-this._startTime)/(this._endTime-this._startTime));return this._start*(1-d)+this._end*d}isEasing(a){return a>=this._startTime&&a<=this._endTime}jumpTo(a){this._startTime=-1/0,this._endTime=-1/0,this._start=a,this._end=a}easeTo(a,d,_){this._start=this.getValue(d),this._end=a,this._startTime=d,this._endTime=d+_}}const dj={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class eS extends i.z{constructor(a,d,_,y){const{point:b,lngLat:T,originalEvent:j,target:N}=a;super(a.type,{point:b,lngLat:T,originalEvent:j,target:N}),this.preventDefault=()=>{a.preventDefault()},this.id=d,this.interaction=_,this.feature=y}}class c1{constructor(a){this.map=a,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(a,d){if(this.typeById.has(a))throw new Error(`Interaction id "${a}" already exists.`);const _=d.filter;let y=d.type;_&&this.filters.set(a,i.b5(_)),y==="mouseover"&&(y="mouseenter"),y==="mouseout"&&(y="mouseleave");const b=this.interactionsByType.get(y)||new Map;y==="mouseenter"||y==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(a,d)):b.size===0&&this.map.on(y,this.handleType),b.size===0&&this.interactionsByType.set(y,b),b.set(a,d),this.typeById.set(a,y)}get(a){const d=this.typeById.get(a);if(!d)return;const _=this.interactionsByType.get(d);return _?_.get(a):void 0}remove(a){const d=this.typeById.get(a);if(!d)return;this.typeById.delete(a),this.filters.delete(a);const _=this.interactionsByType.get(d);_&&(_.delete(a),d==="mouseenter"||d==="mouseleave"?(this.delegatedInteractions.delete(a),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):_.size===0&&this.map.off(d,this.handleType))}queryTargets(a,d){const _=[];for(const[y,b]of d)b.target&&_.push({targetId:y,target:b.target,filter:this.filters.get(y)});return this.map.style.queryRenderedTargets(a,_,this.map.transform)}handleMove(a){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const d=this.queryTargets(a.point,Array.from(this.delegatedInteractions).reverse());d.length&&(a.type="mouseenter",this.handleType(a,d));const _=new Map;for(const[y,{feature:b}]of this.prevHoveredFeatures)this.hoveredFeatures.has(y)||_.set(b.id,b);_.size&&(a.type="mouseleave",this.handleType(a,Array.from(_.values())))}handleOut(a){const d=Array.from(this.hoveredFeatures.values()).map(({feature:_})=>_);d.length&&(a.type="mouseleave",this.handleType(a,d)),this.hoveredFeatures.clear()}handleType(a,d){const _=a.type==="mouseenter";if(_&&!this.interactionsByType.has(a.type))return void i.w("mouseenter interaction required for mouseleave to work.");const y=Array.from(this.interactionsByType.get(a.type)).reverse(),b=!!d;d=d||this.queryTargets(a.point,y);let T=!1;const j=new Set;for(const N of d){for(const[L,B]of y){if(!B.target)continue;const X=N.variants?N.variants[L]:null;if(X){for(const q of X){if(oi(q,N,j,L))continue;const Q=new i.dw(N,q),re=qr(q,N,L);b&&Q.id!==void 0&&(Q.state=this.map.getFeatureState(Q));const ae=_?this.prevHoveredFeatures.get(re):null,fe=new eS(a,L,B,Q),de=ae?ae.stop:B.handler(fe);if(_&&this.hoveredFeatures.set(re,{feature:N,stop:de}),de!==!1){T=!0;break}}if(T)break}}if(T)break}if(!T)for(const[N,L]of y){const{handler:B,target:X}=L;if(!X&&B(new eS(a,N,L,null))!==!1)break}}}function u1(g,a){if(Array.isArray(g)&&Array.isArray(a)){const d=new Set(g),_=new Set(a);return d.size===_.size&&g.every(y=>_.has(y))}return i.bx(g,a)}const M0={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},O0={showCompass:!0,showZoom:!0,visualizePitch:!1};class yg{constructor(a,d,_=!1){this._clickTolerance=10,this.element=d,this.mouseRotate=new N0({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,_&&(this.mousePitch=new i1({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),i.aX(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),d.addEventListener("mousedown",this.mousedown),d.addEventListener("touchstart",this.touchstart,{passive:!1}),d.addEventListener("touchmove",this.touchmove),d.addEventListener("touchend",this.touchend),d.addEventListener("touchcancel",this.reset)}down(a,d){this.mouseRotate.mousedown(a,d),this.mousePitch&&this.mousePitch.mousedown(a,d),ne()}move(a,d){const _=this.map,y=this.mouseRotate.mousemoveWindow(a,d),b=y&&y.bearingDelta;if(b&&_.setBearing(_.getBearing()+b),this.mousePitch){const T=this.mousePitch.mousemoveWindow(a,d),j=T&&T.pitchDelta;j&&_.setPitch(_.getPitch()+j)}}off(){const a=this.element;a.removeEventListener("mousedown",this.mousedown),a.removeEventListener("touchstart",this.touchstart),a.removeEventListener("touchmove",this.touchmove),a.removeEventListener("touchend",this.touchend),a.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){me(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(a){this.down(Object.assign({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),pe(this.element,a)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(a){this.move(a,pe(this.element,a))}mouseup(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()}touchstart(a){a.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=be(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>a.preventDefault()},this._startPos))}touchmove(a){a.targetTouches.length!==1?this.reset():(this._lastPos=be(this.element,a.targetTouches)[0],this.move({preventDefault:()=>a.preventDefault()},this._lastPos))}touchend(a){a.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Gu(g,a,d){if(g=new i.aS(g.lng,g.lat),a){const _=new i.aS(g.lng-360,g.lat),y=new i.aS(g.lng+360,g.lat),b=360*Math.ceil(Math.abs(g.lng-d.center.lng)/360),T=d.locationPoint3D(g).distSqr(a),j=a.x<0||a.y<0||a.x>d.width||a.y>d.height;d.locationPoint3D(_).distSqr(a)<T&&(j||Math.abs(_.lng-d.center.lng)<b)?g=_:d.locationPoint3D(y).distSqr(a)<T&&(j||Math.abs(y.lng-d.center.lng)<b)&&(g=y)}for(;Math.abs(g.lng-d.center.lng)>180;){const _=d.locationPoint3D(g);if(_.x>=0&&_.y>=0&&_.x<=d.width&&_.y<=d.height)break;g.lng>d.center.lng?g.lng-=360:g.lng+=360}return g}const Dc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},yo={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Wu extends i.E{constructor(a,d){super(),(a instanceof HTMLElement||d)&&(a=Object.assign({element:a},d)),i.aX(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:_="center",color:y="#3FB1CE",scale:b=1,draggable:T=!1,clickTolerance:j=0,rotation:N=yo.rotation,rotationAlignment:L=yo.rotationAlignment,pitchAlignment:B=yo.pitchAlignment,occludedOpacity:X=yo.occludedOpacity,altitude:q=yo.altitude}=a||{};this._anchor=_,this._color=y,this._scale=b,this._draggable=T,this._clickTolerance=j,this._rotation=N,this._rotationAlignment=L,this._pitchAlignment=B,this._occludedOpacity=X,this._altitude=q,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),a&&a.element?(this._element=a.element,this._offset=i.P.convert(a&&a.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=i.P.convert(a&&a.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",ae=>{ae.preventDefault()}),this._element.addEventListener("mousedown",ae=>{ae.preventDefault()});const Q=this._element.classList;for(const ae in Dc)Q.remove(`mapboxgl-marker-anchor-${ae}`);Q.add(`mapboxgl-marker-anchor-${this._anchor}`);const re=a&&a.className?a.className.trim().split(/\s+/):[];Q.add(...re),this._popup=null}_createDefaultMarker(){const a=F("div"),d=U("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},a);if(this._altitude===0){const _=U("radialGradient",{id:"shadowGradient"},U("defs",{},d));U("stop",{offset:"10%","stop-opacity":.4},_),U("stop",{offset:"100%","stop-opacity":.05},_),U("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},d)}return U("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},d),U("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},d),U("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},d),a}addTo(a){return a===this._map||(this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._updateMoving),a.on("moveend",this._update),a.on("remove",this._clearFadeTimer),a._addMarker(this),this.setDraggable(this._draggable),this._update(),a.on("click",this._onMapClick)),this}remove(){const a=this._map;return a&&(a.off("click",this._onMapClick),a.off("move",this._updateMoving),a.off("moveend",this._update),a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler),a.off("mouseup",this._onUp),a.off("touchend",this._onUp),a.off("mousemove",this._onMove),a.off("touchmove",this._onMove),a.off("remove",this._clearFadeTimer),a._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=i.aS.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(a){return a===this._altitude||(this._defaultMarker&&(this._altitude===0&&a!==0||this._altitude!==0&&a===0)&&(this._element=this._createDefaultMarker()),this._altitude=a||yo.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=a,a._marker=this,a._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(a){const d=a.code,_=a.charCode||a.keyCode;d!=="Space"&&d!=="Enter"&&_!==32&&_!==13||this.togglePopup()}_onMapClick(a){const d=a.originalEvent.target,_=this._element;this._popup&&(d===_||_.contains(d))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const a=this._popup;return a?(a.isOpen()?(a.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(a.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const a=this._map,d=this._pos;if(!a||!d)return!1;const _=a.unproject(d,this._altitude),y=a.getFreeCameraOptions();if(!y.position)return!1;const b=y.position.toLngLat();return b.distanceTo(_)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const a=this._map;if(!a)return;const d=this._pos;if(!d||d.x<0||d.x>a.transform.width||d.y<0||d.y>a.transform.height)return void this._clearFadeTimer();const _=a.unproject(d,this._altitude);let y;a._showingGlobe()&&i.f4(a.transform,this._lngLat)?y=0:(y=1-a._queryFogOpacity(_),a.transform._terrainEnabled()&&a.getTerrain()&&this._behindTerrain()&&(y*=this._occludedOpacity)),this._element.style.opacity=`${y}`,this._element.style.pointerEvents=y>0?"auto":"none",this._popup&&this._popup._setOpacity(y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const a=this._pos;if(!a||!this._map)return;const d=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${a.x}px,${a.y}px)
            ${Dc[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${d.x}px,${d.y}px)
        `}_calculateXYTransform(){const a=this._pos,d=this._map,_=this.getPitchAlignment();if(!d||!a||_!=="map")return"";if(!d._showingGlobe()){const N=d.getPitch();return N?`rotateX(${N}deg)`:""}const y=i.cW(i.f5(d.transform,this._lngLat)),b=a.sub(i.f6(d.transform)),T=Math.abs(b.x)+Math.abs(b.y);if(T===0)return"";const j=y/T;return`rotateX(${-b.y*j}deg) rotateY(${b.x*j}deg)`}_calculateZTransform(){const a=this._pos,d=this._map;if(!d||!a)return"";let _=0;const y=this.getRotationAlignment();if(y==="map")if(d._showingGlobe()){const b=d.project(new i.aS(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),T=d.project(new i.aS(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(b);_=i.cW(Math.atan2(T.y,T.x))-90}else _=-d.getBearing();else if(y==="horizon"){const b=i.ah(4,6,d.getZoom()),T=i.f6(d.transform);T.y+=b*d.transform.height;const j=a.sub(T),N=i.cW(Math.atan2(j.y,j.x));_=(N>90?N-270:N+90)*(1-b)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(a){cancelAnimationFrame(this._updateFrameId);const d=this._map;d&&(d.transform.renderWorldCopies&&(this._lngLat=Gu(this._lngLat,this._pos,d.transform)),this._pos=d.project(this._lngLat,this._altitude),a===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),d._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(d._showingGlobe()||d.getTerrain()||d.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(a){return this._offset=i.P.convert(a),this._update(),this}addClassName(a){return this._element.classList.add(a),this}removeClassName(a){return this._element.classList.remove(a),this}toggleClassName(a){return this._element.classList.toggle(a)}_onMove(a){const d=this._map;if(!d)return;const _=this._pointerdownPos,y=this._positionDelta;if(_&&y){if(!this._isDragging){const b=this._clickTolerance||d._clickTolerance;if(a.point.dist(_)<b)return;this._isDragging=!0}this._pos=a.point.sub(y),this._lngLat=d.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.z("dragstart"))),this.fire(new i.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const a=this._map;a&&(a.off("mousemove",this._onMove),a.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.z("dragend")),this._state="inactive"}_addDragHandler(a){const d=this._map,_=this._pos;d&&_&&this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(_),this._pointerdownPos=a.point,this._state="pending",d.on("mousemove",this._onMove),d.on("touchmove",this._onMove),d.once("mouseup",this._onUp),d.once("touchend",this._onUp))}setDraggable(a){this._draggable=!!a;const d=this._map;return d&&(a?(d.on("mousedown",this._addDragHandler),d.on("touchstart",this._addDragHandler)):(d.off("mousedown",this._addDragHandler),d.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||yo.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||yo.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a||yo.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(a){return this._occludedOpacity=a||yo.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Rc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},hj={maxWidth:100,unit:"metric"},fj={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},pj={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},mj=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function d1(g=new i.P(0,0),a="bottom"){if(typeof g=="number"){const d=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(a){case"top":return new i.P(0,g);case"top-left":return new i.P(d,d);case"top-right":return new i.P(-d,d);case"bottom":return new i.P(0,-g);case"bottom-left":return new i.P(d,-d);case"bottom-right":return new i.P(-d,-d);case"left":return new i.P(g,0);case"right":return new i.P(-g,0)}return new i.P(0,0)}return g instanceof i.P||Array.isArray(g)?i.P.convert(g):i.P.convert(g[a]||[0,0])}return{version:S,supported:H.supported,setRTLTextPlugin:i.fa,getRTLTextPluginStatus:i.f9,Map:class extends du{constructor(g){I.mark(E.create);const a=g;if((g=Object.assign({},M0,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&i.f2(window)&&(g.antialias=!1,i.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Rf(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies,null,null),g),this._repaint=!!g.repaint,this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._collectResourceTiming=g.collectResourceTiming,this._language=this._parseLanguage(g.language),this._worldview=g.worldview,this._renderTaskQueue=new Q2,this._domRenderTaskQueue=new Q2,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.b1(),this._locale=Object.assign({},dj,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._performanceMetricsCollection=g.performanceMetricsCollection,this._tessellationStep=g.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=g.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new vg(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=g.scaleFactor,this._requestManager=new Qe(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,this._contextCreateOptions=g.contextCreateOptions?Object.assign({},g.contextCreateOptions):{},typeof g.container=="string"){const d=document.getElementById(g.container);if(!d)throw new Error(`Container '${g.container.toString()}' not found.`);this._container=d}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&i.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),this._spriteFormat=g.spriteFormat,i.aX(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new ij),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new R0(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,(g.style||!g.testMode)&&this.setStyle(g.style||i.e.DEFAULT_STYLE,{config:g.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),g.hash&&(this._hash=new E0(typeof g.hash=="string"&&g.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){a.center==null&&a.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch});const d=g.bounds;d&&(this.resize(),this.fitBounds(d,Object.assign({},g.fitBoundsOptions,{duration:0})))}this.resize(),g.attributionControl&&this.addControl(new op({customAttribution:g.customAttribution})),this._logoControl=new xg,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()}),this.on("data",d=>{this._update(d.dataType==="style"),this.fire(new i.z(`${d.dataType}data`,d))}),this.on("dataloading",d=>{this.fire(new i.z(`${d.dataType}dataloading`,d))}),this._interactions=new c1(this)}_getMapId(){return this._mapId}addControl(g,a){if(a===void 0&&(a=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new i.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=g.onAdd(this);this._controls.push(g);const _=this._controlPositions[a];return a.indexOf("bottom")!==-1?_.insertBefore(d,_.firstChild):_.appendChild(d),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new i.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(g);return a>-1&&this._controls.splice(a,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const a=!this._moving;return a&&this.fire(new i.z("movestart",g)).fire(new i.z("move",g)),this.fire(new i.z("resize",g)),a&&this.fire(new i.z("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(i.aI.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new i.z("zoomstart")).fire(new i.z("zoom")).fire(new i.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new i.z("zoomstart")).fire(new i.z("zoom")).fire(new i.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new i.z("pitchstart")).fire(new i.z("pitch")).fire(new i.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new i.z("pitchstart")).fire(new i.z("pitch")).fire(new i.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(g){return this._scaleFactor=g,this.painter.scaleFactor=g,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(a=>a.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(g){return g==="auto"?navigator.language:Array.isArray(g)?g.length===0?void 0:g.map(a=>a==="auto"?navigator.language:a):g}setLanguage(g){const a=this._parseLanguage(g);if(!this.style||a===this._language)return this;this._language=a,this.style.reloadSources();for(const d of this._controls)d._setLanguage&&d._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(g){return this.style&&g!==this._worldview?(this._worldview=g,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(g){return this._lazyInitEmptyStyle(),g?typeof g=="string"&&(g={name:g}):g=null,this._useExplicitProjection=!!g,this._prioritizeAndUpdateProjection(g,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const g=this.transform,a=g.projection.name;let d;a==="globe"&&g.zoom>=i.cK?(g.setMercatorFromTransition(),d=!0):a==="mercator"&&g.zoom<i.cK&&(g.setProjection({name:"globe"}),d=!0),d&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(g,a){return this._updateProjection(g||a||{name:"mercator"})}_updateProjection(g){let a;const d=this.transform.mercatorFromTransition;a=g.name==="globe"&&this.transform.zoom>=i.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(g),this.style.applyProjectionUpdate();const _=this.transform.getProjection().name==="mercator"&&d!==this.transform.mercatorFromTransition;return(a||_)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(g,a){return this.transform.locationPoint3D(i.aS.convert(g),a)}unproject(g,a){return this.transform.pointLocation3D(i.P.convert(g),a)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(g,a,d){const _=y=>{let b=[];if(Array.isArray(a)){const T=a.filter(j=>this.getLayer(j));b=T.length?this.queryRenderedFeatures(y,{layers:T}):[]}else b=this.queryRenderedFeatures(y,{target:a});return b};if(g==="mouseenter"||g==="mouseover"){let y=!1;return{listener:d,targets:a,delegates:{mousemove:T=>{const j=_(T.point);j.length?y||(y=!0,d.call(this,new bs(g,this,T.originalEvent,{features:j}))):y=!1},mouseout:()=>{y=!1}}}}if(g==="mouseleave"||g==="mouseout"){let y=!1;return{listener:d,targets:a,delegates:{mousemove:j=>{_(j.point).length?y=!0:y&&(y=!1,d.call(this,new bs(g,this,j.originalEvent)))},mouseout:j=>{y&&(y=!1,d.call(this,new bs(g,this,j.originalEvent)))}}}}{const y=b=>{const T=_(b.point);T.length&&(b.features=T,d.call(this,b),delete b.features)};return{listener:d,targets:a,delegates:{[g]:y}}}}on(g,a,d){if(typeof a=="function"||d===void 0)return super.on(g,a);if(typeof a=="string"&&(a=[a]),!this._areTargetsValid(a))return this;const _=this._createDelegatedListener(g,a,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(_);for(const y in _.delegates)this.on(y,_.delegates[y]);return this}once(g,a,d){if(typeof a=="function"||d===void 0)return super.once(g,a);if(typeof a=="string"&&(a=[a]),!this._areTargetsValid(a))return this;const _=this._createDelegatedListener(g,a,d);for(const y in _.delegates)this.once(y,_.delegates[y]);return this}off(g,a,d){if(typeof a=="function"||d===void 0)return super.off(g,a);if(typeof a=="string"&&(a=[a]),!this._areTargetsValid(a))return this;const _=this._delegatedListeners?this._delegatedListeners[g]:void 0;return _&&(y=>{for(let b=0;b<y.length;b++){const T=y[b];if(T.listener===d&&u1(T.targets,a)){for(const j in T.delegates)this.off(j,T.delegates[j]);return y.splice(b,1),this}}})(_),this}queryRenderedFeatures(g,a){if(!this.style)return[];if(g===void 0||g instanceof i.P||Array.isArray(g)||a!==void 0||(a=g,g=void 0),g=g||[[0,0],[this.transform.width,this.transform.height]],!a){const b=this.style.queryRenderedFeatures(g,void 0,this.transform),T=this.style.queryRenderedFeatureset(g,void 0,this.transform);return b.concat(T)}let d=!0;if(a.target&&(d=this._isTargetValid(a.target),d&&!a.layers))return this.style.queryRenderedFeatureset(g,a,this.transform);let _=!0;if(a.layers&&Array.isArray(a.layers)){for(const b of a.layers)if(!this._isValidId(b)){_=!1;break}if(_&&!a.target)return this.style.queryRenderedFeatures(g,a,this.transform)}let y=[];return _&&(y=y.concat(this.style.queryRenderedFeatures(g,a,this.transform))),d&&(y=y.concat(this.style.queryRenderedFeatureset(g,a,this.transform))),y}querySourceFeatures(g,a){return!g||typeof g=="string"&&!this._isValidId(g)?[]:this.style.querySourceFeatures(g,a)}queryRasterValue(g,a,d){return this._isValidId(g)?this.style.queryRasterValue(g,a,d):Promise.resolve(null)}isPointOnSurface(g){const{name:a}=this.transform.projection;return a!=="globe"&&a!=="mercator"&&i.w(`${a} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.P.convert(g))}addInteraction(g,a){return this._interactions.add(g,a),this}removeInteraction(g){return this._interactions.remove(g),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(g){return this._cooperativeGestures=g,this}setStyle(g,a){return a=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},a),this.style&&g&&a.diff!==!1&&a.localFontFamily===this._localFontFamily&&a.localIdeographFontFamily===this._localIdeographFontFamily&&!a.config?(this.style._diffStyle(g,(d,_)=>{if(d){const y=typeof d=="string"?d:d instanceof Error?d.message:d.error;i.w(`Unable to perform style diff: ${y}. Rebuilding the style from scratch.`),this._updateStyle(g,a)}else _&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._localFontFamily=a.localFontFamily,this._updateStyle(g,a))}_getUIString(g){const a=this._locale[g];if(a==null)throw new Error(`Missing UI string '${g}'`);return a}_updateStyle(g,a){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g){const d=Object.assign({},a);a&&a.config&&(d.initialConfig=a.config,delete d.config),this.style=new oc(this,d).load(g),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new oc(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.w("There is no style added to the map."),!1)}_isValidId(g){return g==null?(this.fire(new i.y(new Error("IDs can't be empty."))),!1):!i.dq(g)||(this.fire(new i.y(new Error(`IDs can't contain special symbols: "${g}".`))),!1)}_isTargetValid(g){return"featuresetId"in g?this._isValidId("importId"in g?g.importId:g.featuresetId):"layerId"in g&&this._isValidId(g.layerId)}_areTargetsValid(g){if(Array.isArray(g)){for(const a of g)if(!this._isValidId(a))return!1;return!0}return this._isTargetValid(g)}addSource(g,a){return this._isValidId(g)?(this._lazyInitEmptyStyle(),this.style.addSource(g,a),this._update(!0)):this}isSourceLoaded(g){return!!this._isValidId(g)&&!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(g,a,d){this._lazyInitEmptyStyle(),this.style.addSourceType(g,a,d)}removeSource(g){return this._isValidId(g)?(this.style.removeSource(g),this._updateTerrain(),this._update(!0)):this}getSource(g){return this._isValidId(g)?this.style.getOwnSource(g):null}addImage(g,a,{pixelRatio:d=1,sdf:_=!1,stretchX:y,stretchY:b,content:T}={}){this._lazyInitEmptyStyle();const j=i.I.from(g);if(a instanceof HTMLImageElement||ImageBitmap&&a instanceof ImageBitmap){const{width:N,height:L,data:B}=i.o.getImageData(a);this.style.addImage(j,{data:new i.q({width:N,height:L},B),pixelRatio:d,stretchX:y,stretchY:b,content:T,sdf:_,version:0,usvg:!1})}else if(a.width===void 0||a.height===void 0)this.fire(new i.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:N,height:L}=a,B=a;this.style.addImage(j,{data:new i.q({width:N,height:L},new Uint8Array(B.data)),pixelRatio:d,stretchX:y,stretchY:b,content:T,sdf:_,usvg:!1,version:0,userImage:B}),B.onAdd&&B.onAdd(this,g)}}updateImage(g,a){this._lazyInitEmptyStyle();const d=i.I.from(g),_=this.style.getImage(d);if(!_)return void this.fire(new i.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=a instanceof HTMLImageElement||ImageBitmap&&a instanceof ImageBitmap?i.o.getImageData(a):a,{width:b,height:T,data:j}=y;if(b===void 0||T===void 0)return void this.fire(new i.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==(_.usvg?_.icon.usvg_tree.width:_.data.width)||T!==(_.usvg?_.icon.usvg_tree.height:_.data.height))return void this.fire(new i.y(new Error(`The width and height of the updated image (${b}, ${T})
                must be that same as the previous version of the image
                (${_.data.width}, ${_.data.height})`)));const N=!(a instanceof HTMLImageElement||ImageBitmap&&a instanceof ImageBitmap);let L=!1;_.usvg?(_.data=new i.q({width:b,height:T},new Uint8Array(j)),_.usvg=!1,_.icon=void 0,L=!0):_.data.replace(j,N),this.style.updateImage(d,_,L)}hasImage(g){return g?!!this.style&&!!this.style.getImage(i.I.from(g)):(this.fire(new i.y(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(i.I.from(g))}loadImage(g,a){i.n(this._requestManager.transformRequest(g,i.R.Image),(d,_)=>{a(d,_ instanceof HTMLImageElement?i.o.getImageData(_):_)})}listImages(){return this.style.listImages().map(g=>g.name)}addModel(g,a){this._lazyInitEmptyStyle(),this.style.addModel(g,a)}hasModel(g){return g?this.style.hasModel(g):(this.fire(new i.y(new Error("Missing required model id"))),!1)}removeModel(g){this.style.removeModel(g)}listModels(){return this.style.listModels()}addLayer(g,a){return this._isValidId(g.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(g,a),this._update(!0)):this}getSlot(g){const a=this.getLayer(g);return a&&a.slot||null}setSlot(g,a){return this.style.setSlot(g,a),this.style.mergeLayers(),this._update(!0)}addImport(g,a){return this.style.addImport(g,a).catch(d=>this.fire(new i.y(new Error("Failed to add import",d)))),this}updateImport(g,a){return typeof a!="string"&&a.id!==g?(this.removeImport(g),this.addImport(a)):(this.style.updateImport(g,a),this._update(!0))}removeImport(g){return this.style.removeImport(g),this}moveImport(g,a){return this.style.moveImport(g,a),this._update(!0)}moveLayer(g,a){return this._isValidId(g)?(this.style.moveLayer(g,a),this._update(!0)):this}removeLayer(g){return this._isValidId(g)?(this.style.removeLayer(g),this._update(!0)):this}getLayer(g){if(!this._isValidId(g))return null;const a=this.style.getOwnLayer(g);return a?a.type==="custom"?a.implementation:a.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(g,a,d){return this._isValidId(g)?(this.style.setLayerZoomRange(g,a,d),this._update(!0)):this}setFilter(g,a,d={}){return this._isValidId(g)?(this.style.setFilter(g,a,d),this._update(!0)):this}getFilter(g){return this._isValidId(g)?this.style.getFilter(g):null}setPaintProperty(g,a,d,_={}){return this._isValidId(g)?(this.style.setPaintProperty(g,a,d,_),this._update(!0)):this}getPaintProperty(g,a){return this._isValidId(g)?this.style.getPaintProperty(g,a):null}setLayoutProperty(g,a,d,_={}){return this._isValidId(g)?(this.style.setLayoutProperty(g,a,d,_),this._update(!0)):this}getLayoutProperty(g,a){return this._isValidId(g)?this.style.getLayoutProperty(g,a):null}setLayerProperty(g,a,d,_={}){return this._isValidId(g)?(this.style.setLayerProperty(g,a,d,_),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(g){return this.style.setGlyphsUrl(g),this._update(!0)}getSchema(g){return this.style.getSchema(g)}setSchema(g,a){return this.style.setSchema(g,a),this._update(!0)}getConfig(g){return this.style.getConfig(g)}setConfig(g,a){return this.style.setConfig(g,a),this._update(!0)}getConfigProperty(g,a){return this.style.getConfigProperty(g,a)}setConfigProperty(g,a,d){return this.style.setConfigProperty(g,a,d),this._update(!0)}getFeaturesetDescriptors(g){return this.style.getFeaturesetDescriptors(g)}setLights(g){if(this._lazyInitEmptyStyle(),g&&g.length===1&&g[0].type==="flat"){const a=g[0];a.properties?this.style.setFlatLight(a.properties,a.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(g),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const g=this.style.getLights()||[];return g.length===0&&g.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),g}setLight(g,a={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:g}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(g){return this._lazyInitEmptyStyle(),this.style.setSnow(g),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(g){return this._lazyInitEmptyStyle(),this.style.setRain(g),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(g){return this._lazyInitEmptyStyle(),this.style.setColorTheme(g),this._update(!0)}setImportColorTheme(g,a){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(g,a),this._update(!0)}setCamera(g){return this.style.setCamera(g),this._triggerCameraUpdate(g)}_triggerCameraUpdate(g){return this._update(this.transform.setOrthographicProjectionAtLowPitch(g["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.aS.convert(g),this.transform):0}setFeatureState(g,a){return g.source&&!this._isValidId(g.source)?this:(this.style.setFeatureState(g,a),this._update())}removeFeatureState(g,a){return g.source&&!this._isValidId(g.source)?this:(this.style.removeFeatureState(g,a),this._update())}getFeatureState(g){return g.source&&!this._isValidId(g.source)?null:this.style.getFeatureState(g)}_selectIndoorFloor(g){this.indoor.selectFloor(g)}_setIndoorActiveFloorsVisibility(g){this.indoor.setActiveFloorsVisibility(g)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new l1),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,a=this._container.getBoundingClientRect().height||300;let d,_,y,b=this._container;for(;b&&(!_||!y);){const T=window.getComputedStyle(b).transform;T&&T!=="none"&&(d=T.match(/matrix.*\((.+)\)/)[1].split(", "),d[0]&&d[0]!=="0"&&d[0]!=="1"&&(_=d[0]),d[3]&&d[3]!=="0"&&d[3]!=="1"&&(y=d[3])),b=b.parentElement}this._containerWidth=_?Math.abs(g/_):g,this._containerHeight=y?Math.abs(a/y):a}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new Ch(this.style),this.on("load",()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}),this.on("idle",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})}))}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=F("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const a=this._canvasContainer=F("div","mapboxgl-canvas-container",g);this._canvas=F("canvas","mapboxgl-canvas",a),this._interactive&&(a.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const d=this._controlContainer=F("div","mapboxgl-control-container",g),_=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(y=>{_[y]=F("div",`mapboxgl-ctrl-${y}`,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,a){const d=i.o.devicePixelRatio||1;this._canvas.width=d*Math.ceil(g),this._canvas.height=d*Math.ceil(a),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${a}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const a=this._markers.indexOf(g);a!==-1&&this._markers.splice(a,1)}_addPopup(g){this._popups.push(g)}_removePopup(g){const a=this._popups.indexOf(g);a!==-1&&this._popups.splice(a,1)}_setupPainter(){const g=Object.assign({},H.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),a=this._canvas.getContext("webgl2",g);a?(xn(a,!0),this.painter=new Ud(a,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",d=>{d.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),i.k.testSupport(a)):this.fire(new i.y(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.z("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new i.z("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let a;this.fire(new i.z("renderstart")),++this._frameId;const d=this.painter.context.extTimerQuery,_=i.o.now(),y=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(a=y.createQuery(),y.beginQuery(d.TIME_ELAPSED_EXT,a)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;this._updateProjectionTransition();const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const L=this.transform.zoom,B=this.transform.pitch,X=i.o.now(),q=new i.ac(L,{now:X,fadeDuration:b,pitch:B,transition:this.style.transition,worldview:this._worldview});this.style.update(q)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(_),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):T=this._updateAverageElevation(_);const j=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),j&&(this._placementDirty=j.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,I.mark(E.load),this.fire(new i.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),a){const L=i.o.now()-_;y.endQuery(d.TIME_ELAPSED_EXT),setTimeout(()=>{const B=y.getQueryParameter(a,y.QUERY_RESULT)/1e6;y.deleteQuery(a),this.fire(new i.z("gpu-timing-frame",{cpuTime:L,gpuTime:B}))},50)}if(this.listens("gpu-timing-layer")){const L=this.painter.collectGpuTimers();setTimeout(()=>{const B=this.painter.queryGpuTimers(L);this.fire(new i.z("gpu-timing-layer",{layerTimes:B}))},50)}if(this.listens("gpu-timing-deferred-render")){const L=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const B=this.painter.queryGpuTimeDeferredRender(L);this.fire(new i.z("gpu-timing-deferred-render",{gpuTime:B}))},50)}const N=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(N||this._repaint)this.triggerRepaint();else{const L=this.idle();if(L&&(T=this._updateAverageElevation(_,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),L&&(this.fire(new i.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const B=this._calculateSpeedIndex();this.fire(new i.z("speedindexcompleted",{speedIndex:B})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||N||(this._fullyLoaded=!0,I.mark(E.fullLoad),this._performanceMetricsCollection&&Gt(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(g){for(const a of this._markers)g&&!this.getRenderWorldCopies()&&(a._lngLat=a._lngLat.wrap()),a._update();for(const a of this._popups)!g||this.getRenderWorldCopies()||a._trackPointer||(a._lngLat=a._lngLat.wrap()),a._update()}_updateAverageElevation(g,a=!1){const d=y=>(this.transform.averageElevation=y,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&d(0);const _=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(_||(a||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const y=this.transform.averageElevation;let b=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=g;const T=Math.abs(y-b);if(T>1){if(this._isInitialLoad||_)return this._averageElevation.jumpTo(b),d(b);this._averageElevation.easeTo(b,g,300)}else if(T>1e-4)return this._averageElevation.jumpTo(b),d(b)}return!!this._averageElevation.isEasing(g)&&d(this._averageElevation.getValue(g))}_authenticate(){Wr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===qe||g.status===401)){const a=this.painter.context.gl;xn(a,!1),this._logoControl instanceof xg&&this._logoControl._updateLogo(),a&&a.clear(a.DEPTH_BUFFER_BIT|a.COLOR_BUFFER_BIT|a.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Se(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&nt(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&Vt(this._requestManager._customAccessToken)}_updateTerrain(){const g=this._isDragging();this.painter.updateTerrain(this.style,g)}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),a=this.painter.getCanvasCopiesAndTimestamps();a.timeStamps.push(performance.now());const d=this.painter.context.gl,_=d.createFramebuffer();function y(b){d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,b,0);const T=new Uint8Array(d.drawingBufferWidth*d.drawingBufferHeight*4);return d.readPixels(0,0,d.drawingBufferWidth,d.drawingBufferHeight,d.RGBA,d.UNSIGNED_BYTE,T),T}return d.bindFramebuffer(d.FRAMEBUFFER,_),this._canvasPixelComparison(y(g),a.canvasCopies.map(y),a.timeStamps)}_canvasPixelComparison(g,a,d){let _=d[1]-d[0];const y=g.length/4;for(let b=0;b<a.length;b++){const T=a[b];let j=0;for(let N=0;N<T.length;N+=4)T[N]===g[N]&&T[N+1]===g[N+1]&&T[N+2]===g[N+2]&&T[N+3]===g[N+3]&&(j+=1);_+=(d[b+2]-d[b+1])*(1-j/y)}return _}remove(){this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),nn.delete(this.painter.context.gl),jr.remove(),he.remove(),this._removed=!0,this.fire(new i.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=i.o.frame(a=>{const d=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,d&&this._render(a)}))}_preloadTiles(g){const a=this.style?this.style.getSourceCaches():[];return i.bv(a,(d,_)=>d._preloadTiles(g,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(g){this._showParseStatus!==g&&(this._showParseStatus=g,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(g){this._showLayers2DWireframe!==g&&(this._showLayers2DWireframe=g,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(g){this._showLayers3DWireframe!==g&&(this._showLayers3DWireframe=g,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,this._tp.refreshUI(),g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(g){this._showTileAABBs!==g&&(this._showTileAABBs=g,this._tp.refreshUI(),g&&this._update())}_setCacheLimits(g,a){i.f3(g,a)}get version(){return S}},NavigationControl:class{constructor(g={}){this.options=Object.assign({},O0,g),this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(i.aX(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",a=>{this._map&&this._map.zoomIn({},{originalEvent:a})}),F("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",a=>{this._map&&this._map.zoomOut({},{originalEvent:a})}),F("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.aX(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",a=>{const d=this._map;d&&(this.options.visualizePitch?d.resetNorthPitch({},{originalEvent:a}):d.resetNorth({},{originalEvent:a}))}),this._compassIcon=F("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map;if(!g)return;const a=g.getZoom(),d=a===g.getMaxZoom(),_=a===g.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const g=this._map;if(!g)return;const a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=a)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new yg(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){const g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,a){const d=F("button",g,this._container);return d.type="button",d.addEventListener("click",a),d}_setButtonTitle(g,a){if(!this._map)return;const d=this._map._getUIString(`NavigationControl.${a}`);g.setAttribute("aria-label",d),g.firstElementChild&&g.firstElementChild.setAttribute("title",d)}},GeolocateControl:class extends i.E{constructor(g={}){super();const a=navigator.geolocation;this.options=Object.assign({geolocation:a},Rc,g),i.aX(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Mh(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(g){return this._map=g,this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(g){const a=(d=!!this.options.geolocation)=>{this._supportsGeolocation=d,g(d)};this._supportsGeolocation!==void 0?g(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(d=>a(d.state!=="denied")).catch(()=>a()):a()}_isOutOfMapMaxBounds(g){const a=this._map.getMaxBounds(),d=g.coords;return!!a&&(d.longitude<a.getWest()||d.longitude>a.getEast()||d.latitude<a.getSouth()||d.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new i.z("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(g),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(g),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.z("geolocate",Object.assign({coords:g.coords,timestamp:g.timestamp},g.toJSON?{toJSON:g.toJSON.bind(g)}:{}))),this._finish()}}_updateCamera(g){const a=new i.aS(g.coords.longitude,g.coords.latitude),d=g.coords.accuracy,_=this._map.getBearing(),y=Object.assign({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(a.toBounds(d),y,{geolocateSource:!0})}_updateMarker(g){if(g){const a=new i.aS(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map.transform,a=i.ce(1,g._center.lat)*g.worldSize,d=Math.ceil(2*this._accuracy*a);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(g.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(g.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.z("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=F("button","mapboxgl-ctrl-geolocate",this._container),F("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",g===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=F("div","mapboxgl-user-location"),this._dotElement.appendChild(F("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(F("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Wu({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=F("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Wu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.z("trackuserlocationend")))})}}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:g.absolute===!0&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(g={maximumAge:6e5,timeout:0},this._noTimeout=!0):(g=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(a=>{a==="granted"&&g()}).catch(console.error):g()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:op,ScaleControl:class{constructor(g={}){this.options=Object.assign({},hj,g),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),i.aX(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const g=this.options.maxWidth||100,a=this._map,d=a._containerHeight/2,_=a._containerWidth/2-g/2,y=a.unproject([_,d]),b=a.unproject([_+g,d]),T=y.distanceTo(b);if(this.options.unit==="imperial"){const j=3.2808*T;j>5280?this._setScale(g,j/5280,"mile"):this._setScale(g,j,"foot")}else this.options.unit==="nautical"?this._setScale(g,T/1852,"nautical-mile"):T>=1e3?this._setScale(g,T/1e3,"kilometer"):this._setScale(g,T,"meter")}_setScale(g,a,d){this._map._requestDomTask(()=>{const _=function(b){const T=Math.pow(10,`${Math.floor(b)}`.length-1);let j=b/T;return j=j>=10?10:j>=5?5:j>=3?3:j>=2?2:j>=1?1:function(N){const L=Math.pow(10,Math.ceil(-Math.log(N)/Math.LN10));return Math.round(N*L)/L}(j),T*j}(a),y=_/a;this._container.innerHTML=this._isNumberFormatSupported&&d!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:d}).format(_):`${_}&nbsp;${fj[d]}`,this._container.style.width=g*y+"px"})}onAdd(g){return this._map=g,this._language=g.getLanguage(),this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(g){this._language=g,this._update()}setUnit(g){this.options.unit=g,this._update()}},FullscreenControl:class{constructor(g={}){this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:i.w("Full screen control 'container' must be a DOM element.")),i.aX(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=F("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=F("button","mapboxgl-ctrl-fullscreen",this._controlContainer);F("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:l1,Popup:class extends i.E{constructor(g){super(),this.options=Object.assign(Object.create(pj),g),this._altitude=this.options.altitude,i.aX(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),g._addPopup(this),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new i.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),g._canvasContainer&&g._canvasContainer.classList.remove("mapboxgl-track-pointer"),g._removePopup(this),this._map=void 0),this.fire(new i.z("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=i.aS.convert(g),this._pos=null,this._trackPointer=!1,this._update();const a=this._map;return a&&(a.on("move",this._update),a.off("mousemove",this._onMouseEvent),a._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(g){return this._altitude=g,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const a=document.createDocumentFragment(),d=document.createElement("body");let _;for(d.innerHTML=g;_=d.firstChild,_;)a.appendChild(_);return this.setDOMContent(a)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let a=this._content;if(a)for(;a.hasChildNodes();)a.firstChild&&a.removeChild(a.firstChild);else a=this._content=F("div","mapboxgl-popup-content",this._container||void 0);if(a.appendChild(g),this.options.closeButton){const d=this._closeButton=F("button","mapboxgl-popup-close-button",a);d.type="button",d.setAttribute("aria-label","Close popup"),d.innerHTML='<span aria-hidden="true">&#215;</span>',d.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let a;return this._classList.delete(g)?a=!1:(this._classList.add(g),a=!0),this._updateClassList(),a}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const a=this._map,d=this._container,_=this._pos;if(!a||!d||!_)return"bottom";const y=d.offsetWidth,b=d.offsetHeight,T=_.x<y/2,j=_.x>a.transform.width-y/2;if(_.y+g<b)return T?"top-left":j?"top-right":"top";if(_.y>a.transform.height-b){if(T)return"bottom-left";if(j)return"bottom-right"}return T?"left":j?"right":"bottom"}_updateClassList(){const g=this._container;if(!g)return;const a=[...this._classList];a.push("mapboxgl-popup"),this._anchor&&a.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&a.push("mapboxgl-popup-track-pointer"),g.className=a.join(" ")}_update(g){const a=this._map,d=this._content;if(!a||!this._lngLat&&!this._trackPointer||!d)return;let _=this._container;if(_||(_=this._container=F("div","mapboxgl-popup",a.getContainer()),this._tip=F("div","mapboxgl-popup-tip",_),_.appendChild(d)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),a.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Gu(this._lngLat,this._pos,a.transform)),!this._trackPointer||g){const y=this._pos=this._trackPointer&&g instanceof i.P?g:a.project(this._lngLat,this._altitude),b=d1(this.options.offset),T=this._anchor=this._getAnchor(b.y),j=d1(this.options.offset,T),N=y.add(j).round();a._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${Dc[T]} translate(${N.x}px,${N.y}px)`)})}if(!this._marker&&a._showingGlobe()){const y=i.f4(a.transform,this._lngLat)?0:1;this._setOpacity(y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(mj);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._container&&(this._container.style.opacity=`${g}`),this._content&&(this._content.style.pointerEvents=g?"auto":"none")}},Marker:Wu,Style:oc,LngLat:i.aS,LngLatBounds:i.aI,Point:i.P,MercatorCoordinate:i.ae,FreeCameraOptions:lu,Evented:i.E,config:i.e,prewarm:i.f8,clearPrewarmedResources:i.f7,get accessToken(){return i.e.ACCESS_TOKEN},set accessToken(g){i.e.ACCESS_TOKEN=g},get baseApiUrl(){return i.e.API_URL},set baseApiUrl(g){i.e.API_URL=g},get workerCount(){return i.fh.workerCount},set workerCount(g){i.fh.workerCount=g},get maxParallelImageRequests(){return i.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){i.e.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){i.fg(g)},get workerUrl(){return i.ff.workerUrl},set workerUrl(g){i.ff.workerUrl=g},get workerClass(){return i.ff.workerClass},set workerClass(g){i.ff.workerClass=g},get workerParams(){return i.ff.workerParams},set workerParams(g){i.ff.workerParams=g},get dracoUrl(){return i.fe()},set dracoUrl(g){i.fd(g)},get meshoptUrl(){return i.fc()},set meshoptUrl(g){i.fb(g)},setNow:i.o.setNow,restoreNow:i.o.restoreNow}});var m=u;return m})})(v7);var Aue=v7.exports;const ih=sD(Aue);function jue(){const e=Id(),t=V.useRef(null),r=V.useRef(null),[s,u]=V.useState([]),[f,m]=V.useState([]),[i,S]=V.useState([]),[E,I]=V.useState(!0),[D,M]=V.useState(null);V.useState("all"),V.useState("all"),V.useState("all"),V.useState("all");const[R,H]=V.useState({sla_dia:0,incidentes_critico:0,incidentes_alto:0,incidentes_medio:0,chamados_urgente:0,chamados_alto:0,chamados_medio:0,postos_cobertos:0,postos_total:0,variacao_presenca:0,preventivas_prazo:0,nps_7d:0,nps_30d:0,inspecoes_total:0});V.useEffect(()=>{F()},[]),V.useEffect(()=>{s.length>0&&pe()},[s]);const F=async()=>{try{const{data:{user:Oe}}=await tt.auth.getUser();if(!Oe){e("/auth");return}const{data:Ee}=await tt.from("user_roles").select("role").eq("user_id",Oe.id).single();M((Ee==null?void 0:Ee.role)||null),await Promise.all([U(Ee==null?void 0:Ee.role),me(Ee==null?void 0:Ee.role),ye(),le()])}catch(Oe){console.error("Error:",Oe),$t.error("Erro ao carregar dados")}finally{I(!1)}},U=async Oe=>{try{let Ee=tt.from("unidades").select(`
          id,
          nome,
          latitude,
          longitude,
          cidade,
          uf,
          contrato_id,
          contratos (
            negocio,
            conq_perd,
            cliente_id,
            clientes (
              razao_social
            )
          )
        `).not("latitude","is",null).not("longitude","is",null);const{data:qe,error:Qe}=await Ee;if(Qe)throw Qe;const gt=await Promise.all((qe||[]).map(async Xe=>{var he,Se,Ue,nt;const[ct,Me,mt,Kt]=await Promise.all([z(Xe.id),J(Xe.id),ne(Xe.id),Y(Xe.id)]),it=Kt.cobertos,ee=Kt.total>0?Math.round(it/Kt.total*100):0;return{id:Xe.id,nome:Xe.nome,latitude:Number(Xe.latitude),longitude:Number(Xe.longitude),cidade:Xe.cidade||"",uf:Xe.uf||"",contrato:{negocio:((he=Xe.contratos)==null?void 0:he.negocio)||"Sem contrato",conq_perd:((Se=Xe.contratos)==null?void 0:Se.conq_perd)??null,cliente:{razao_social:((nt=(Ue=Xe.contratos)==null?void 0:Ue.clientes)==null?void 0:nt.razao_social)||"Sem cliente"}},sla_atual:ct,chamados_abertos:Me,nps_atual:mt,postos_vagos:Kt.vagos,total_postos:Kt.total,postos_preenchidos:it,porcentagem_ocupacao:ee}}));u(gt)}catch(Ee){console.error("Error loading unidades:",Ee),$t.error("Erro ao carregar unidades")}},Y=async Oe=>{try{const{data:Ee,error:qe}=await tt.from("postos_servico").select("id, status").eq("unidade_id",Oe);if(qe)throw qe;if(!Ee||Ee.length===0)return{total:0,vagos:0,cobertos:0};const Qe=Ee.length,gt=Ee.filter(ct=>ct.status==="ocupado").length,Xe=Qe-gt;return{total:Qe,vagos:Xe,cobertos:gt}}catch(Ee){return console.error("Error getting postos info:",Ee),{total:0,vagos:0,cobertos:0}}},z=async Oe=>{const{data:Ee}=await tt.from("ordens_servico").select("status").eq("unidade_id",Oe);if(!Ee||Ee.length===0)return 100;const qe=Ee.filter(Qe=>Qe.status==="concluida").length;return Math.round(qe/Ee.length*100)},J=async Oe=>{const{count:Ee}=await tt.from("chamados").select("*",{count:"exact",head:!0}).eq("unidade_id",Oe).in("status",["aberto","em_andamento"]);return Ee||0},ne=async Oe=>{const{data:Ee}=await tt.from("chamados").select("avaliacao").eq("unidade_id",Oe).not("avaliacao","is",null).gte("created_at",new Date(Date.now()-6048e5).toISOString());if(!Ee||Ee.length===0)return 0;const qe=Ee.filter(gt=>gt.avaliacao>=9).length,Qe=Ee.filter(gt=>gt.avaliacao<=6).length;return Math.round((qe-Qe)/Ee.length*100)},me=async Oe=>{try{const{data:Ee}=await tt.from("ordens_servico").select("status").gte("data_abertura",new Date().toISOString().split("T")[0]),qe=Ee&&Ee.length>0?Math.round(Ee.filter(nt=>nt.status==="concluida").length/Ee.length*100):100,{data:Qe}=await tt.from("incidentes").select("severidade").in("status",["aberto","em_investigacao"]),{data:gt}=await tt.from("chamados").select("prioridade").in("status",["aberto","em_andamento"]),{data:Xe}=await tt.from("postos_servico").select("status"),ct=(Xe==null?void 0:Xe.length)||0,Me=(Xe==null?void 0:Xe.filter(nt=>nt.status==="ocupado").length)||0,{data:mt}=await tt.from("ordens_servico").select("data_prevista, data_conclusao").eq("tipo","preventiva").eq("status","concluida").gte("created_at",new Date(Date.now()-30*24*60*60*1e3).toISOString()),Kt=mt?mt.filter(nt=>nt.data_conclusao&&nt.data_prevista&&new Date(nt.data_conclusao)<=new Date(nt.data_prevista)).length:0,it=mt&&mt.length>0?Math.round(Kt/mt.length*100):100,{data:ee}=await tt.from("chamados").select("avaliacao").not("avaliacao","is",null).gte("created_at",new Date(Date.now()-7*24*60*60*1e3).toISOString()),{data:he}=await tt.from("chamados").select("avaliacao").not("avaliacao","is",null).gte("created_at",new Date(Date.now()-30*24*60*60*1e3).toISOString()),{count:Se}=await tt.from("inspecoes").select("*",{count:"exact",head:!0}),Ue=nt=>{if(!nt||nt.length===0)return 0;const dt=nt.filter(zt=>zt.avaliacao>=9).length,Vt=nt.filter(zt=>zt.avaliacao<=6).length;return Math.round((dt-Vt)/nt.length*100)};H({sla_dia:qe,incidentes_critico:(Qe==null?void 0:Qe.filter(nt=>nt.severidade==="critica").length)||0,incidentes_alto:(Qe==null?void 0:Qe.filter(nt=>nt.severidade==="alta").length)||0,incidentes_medio:(Qe==null?void 0:Qe.filter(nt=>nt.severidade==="media").length)||0,chamados_urgente:(gt==null?void 0:gt.filter(nt=>nt.prioridade==="urgente").length)||0,chamados_alto:(gt==null?void 0:gt.filter(nt=>nt.prioridade==="alta").length)||0,chamados_medio:(gt==null?void 0:gt.filter(nt=>nt.prioridade==="media").length)||0,postos_cobertos:Me,postos_total:ct,variacao_presenca:95,preventivas_prazo:it,nps_7d:Ue(ee||[]),nps_30d:Ue(he||[]),inspecoes_total:Se||0})}catch(Ee){console.error("Error loading stats:",Ee)}},le=async()=>{try{const{data:Oe,error:Ee}=await tt.from("execucao_checklist").select(`
          id,
          checklist_id,
          data_prevista,
          status,
          finalizado_em,
          checklist:checklist ( nome ),
          supervisor:profiles ( full_name )
        `).order("data_prevista",{ascending:!1}).limit(5);if(Ee)throw Ee;const qe=(Oe==null?void 0:Oe.filter(Qe=>Qe.status!=="concluido"&&Qe.status!=="cancelado"))||[];S(qe)}catch(Oe){console.error("Error loading checklist executions:",Oe)}},ye=async()=>{try{const{data:Oe,error:Ee}=await tt.from("chamados").select(`
          id,
          numero,
          titulo,
          prioridade,
          status,
          data_abertura,
          unidade:unidades(nome)
        `).neq("status","concluido").order("data_abertura",{ascending:!1});if(Ee)throw Ee;m(Oe||[])}catch(Oe){console.error("Error loading chamados feed:",Oe)}},pe=async()=>{if(!(!t.current||r.current))try{const{data:Oe,error:Ee}=await tt.functions.invoke("get-mapbox-token");if(Ee||!(Oe!=null&&Oe.token)){$t.error("Erro ao carregar token do Mapbox");return}ih.accessToken=Oe.token,r.current=new ih.Map({container:t.current,style:"mapbox://styles/mapbox/light-v11",center:[-47.9292,-15.7801],zoom:4}),r.current.addControl(new ih.NavigationControl,"top-right"),s.forEach(qe=>{if(!r.current)return;const Qe=document.createElement("div");Qe.className="marker",Qe.style.backgroundColor=be(qe.porcentagem_ocupacao),Qe.style.width="24px",Qe.style.height="24px",Qe.style.borderRadius="50%",Qe.style.border="3px solid white",Qe.style.cursor="pointer",Qe.style.boxShadow="0 2px 4px rgba(0,0,0,0.3)";const gt=new ih.Marker(Qe).setLngLat([qe.longitude,qe.latitude]).addTo(r.current),Xe=new ih.Popup({offset:25}).setHTML(`<div style="padding: 12px; min-width: 200px;">
            <h3 style="font-weight: bold; margin-bottom: 8px; font-size: 14px;">${qe.nome}</h3>
            <p style="font-size: 12px; color: #666; margin-bottom: 8px;">${qe.cidade}/${qe.uf}</p>
            <div style="border-top: 1px solid #e5e7eb; padding-top: 8px;">
              <p style="font-size: 12px; margin-bottom: 4px;">Contrato: <strong>${qe.contrato.negocio}</strong>${qe.contrato.conq_perd?` (${qe.contrato.conq_perd})`:""}</p>
              <p style="font-size: 12px; margin-bottom: 4px;">Postos Preenchidos: <strong>${qe.postos_preenchidos}/${qe.total_postos}</strong></p>
              <p style="font-size: 12px;">Taxa de Ocupao: <strong style="color: ${qe.porcentagem_ocupacao>=90?"#22c55e":qe.porcentagem_ocupacao>=70?"#eab308":"#ef4444"};">${qe.porcentagem_ocupacao}%</strong></p>
            </div>
          </div>`);gt.setPopup(Xe)})}catch(Oe){console.error("Error initializing map:",Oe),$t.error("Erro ao inicializar mapa")}},be=Oe=>Oe>=100?"#22c55e":Oe>=70?"#eab308":"#ef4444",ke=Oe=>Oe==="concluido"?"default":Oe==="atrasado"?"destructive":Oe==="cancelado"?"outline":"secondary";return E?c.jsx(Wa,{children:c.jsx("div",{className:"flex items-center justify-center h-screen",children:c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),c.jsx("p",{className:"text-muted-foreground",children:"Carregando dashboard..."})]})})}):c.jsx(Wa,{children:c.jsxs("div",{className:"min-h-screen bg-background p-6 space-y-6",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold",children:"Dashboard 24/7 Resumo Executivo"}),c.jsx("p",{className:"text-muted-foreground",children:"Monitoramento em tempo real"})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(jc,{className:"h-4 w-4 text-muted-foreground"}),c.jsx("span",{className:"text-sm text-muted-foreground",children:new Date().toLocaleDateString("pt-BR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]})]}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs($r,{children:[c.jsx(Xn,{children:c.jsxs(ti,{className:"flex items-center gap-2",children:[c.jsx(i_,{className:"h-5 w-5 text-destructive"}),"Incidentes por Severidade (Disponvel em breve!)"]})}),c.jsxs(_n,{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-sm",children:"Crtico"}),c.jsx(Oi,{variant:"destructive",children:R.incidentes_critico})]}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-sm",children:"Alto"}),c.jsx(Oi,{variant:"destructive",children:R.incidentes_alto})]}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-sm",children:"Mdio"}),c.jsx(Oi,{variant:"secondary",children:R.incidentes_medio})]})]})]}),c.jsxs($r,{children:[c.jsx(Xn,{children:c.jsxs(ti,{className:"flex items-center gap-2",children:[c.jsx(ob,{className:"h-5 w-5 text-primary"}),"Chamados por Prioridade"]})}),c.jsxs(_n,{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-sm",children:"Urgente"}),c.jsx(Oi,{variant:"destructive",children:R.chamados_urgente})]}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-sm",children:"Alta"}),c.jsx(Oi,{variant:"destructive",children:R.chamados_alto})]}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-sm",children:"Mdia"}),c.jsx(Oi,{variant:"secondary",children:R.chamados_medio})]})]})]})]}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[c.jsxs($r,{className:"h-[500px]",children:[c.jsxs(Xn,{children:[c.jsx(ti,{children:"Chamados em aberto"}),c.jsx(Gs,{children:"Chamados ainda no concludos"})]}),c.jsxs(_n,{className:"h-[calc(100%-100px)] overflow-y-auto space-y-3",children:[f.length===0&&c.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum chamado pendente no momento."}),f.map(Oe=>{var Ee;return c.jsxs("div",{className:"p-3 rounded-lg border bg-background space-y-2",children:[c.jsxs("div",{className:"flex items-start justify-between gap-2",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-semibold",children:Oe.titulo||`Chamado ${Oe.numero??"-"}`}),c.jsx("p",{className:"text-xs text-muted-foreground",children:(Ee=Oe.unidade)!=null&&Ee.nome?`Unidade: ${Oe.unidade.nome}`:"Unidade no informada"})]}),c.jsx(Oi,{variant:"outline",className:"capitalize",children:Oe.status})]}),c.jsxs("div",{className:"flex flex-wrap gap-2 text-xs text-muted-foreground",children:[c.jsxs("span",{children:["Prioridade: ",Oe.prioridade||"-"]}),c.jsxs("span",{children:["Aberto em:"," ",Oe.data_abertura?new Date(Oe.data_abertura).toLocaleString("pt-BR"):"-"]})]}),c.jsx("div",{className:"flex justify-end",children:c.jsx(Nt,{size:"sm",variant:"outline",onClick:()=>e("/chamados"),children:"Ver detalhes"})})]},Oe.id)})]})]}),c.jsxs($r,{className:"h-[500px]",children:[c.jsxs(Xn,{children:[c.jsx(ti,{children:"Execuo de Checklists"}),c.jsx(Gs,{children:"Acompanhamento das execues registradas"})]}),c.jsxs(_n,{className:"h-[calc(100%-100px)] overflow-y-auto space-y-3",children:[i.length===0&&c.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhuma execuo de checklist cadastrada at o momento."}),i.map(Oe=>{var Ee,qe;return c.jsxs("div",{className:"p-3 rounded-lg border bg-background space-y-2",children:[c.jsxs("div",{className:"flex items-start justify-between gap-2",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-semibold",children:((Ee=Oe.checklist)==null?void 0:Ee.nome)||`Checklist ${Oe.checklist_id??"-"}`}),c.jsx("p",{className:"text-xs text-muted-foreground",children:(qe=Oe.supervisor)!=null&&qe.full_name?`Supervisor: ${Oe.supervisor.full_name}`:"Supervisor nao informado"})]}),c.jsx(Oi,{variant:ke(Oe.status),className:"capitalize",children:Oe.status})]}),c.jsxs("div",{className:"flex flex-wrap gap-2 text-xs text-muted-foreground",children:[c.jsxs("span",{children:["Previsto:"," ",Oe.data_prevista?new Date(Oe.data_prevista).toLocaleDateString("pt-BR"):"-"]}),c.jsxs("span",{children:["Finalizado:"," ",Oe.finalizado_em?new Date(Oe.finalizado_em).toLocaleString("pt-BR"):"-"]})]}),c.jsx("div",{className:"flex justify-end",children:c.jsx(Nt,{size:"sm",variant:"outline",onClick:()=>e("/checklist-execucoes"),children:"Ver detalhes"})})]},Oe.id)})]}),c.jsx("div",{className:"px-6 pb-6",children:c.jsx(Nt,{className:"w-full",variant:"outline",onClick:()=>e("/checklist-execucoes"),children:"Gerenciar execues"})})]})]})]})})}function IB(e,[t,r]){return Math.min(r,Math.max(t,e))}var Iue=V.createContext(void 0);function qR(e){const t=V.useContext(Iue);return e||t||"ltr"}function w7(e){const t=V.useRef({value:e,previous:e});return V.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var Nue=[" ","Enter","ArrowUp","ArrowDown"],kue=[" ","Enter"],w_="Select",[dA,hA,Pue]=tR(w_),[Hv,P2e]=xh(w_,[Pue,QC]),fA=QC(),[Due,jm]=Hv(w_),[Rue,Mue]=Hv(w_),b7=e=>{const{__scopeSelect:t,children:r,open:s,defaultOpen:u,onOpenChange:f,value:m,defaultValue:i,onValueChange:S,dir:E,name:I,autoComplete:D,disabled:M,required:R,form:H}=e,F=fA(t),[U,Y]=V.useState(null),[z,J]=V.useState(null),[ne,me]=V.useState(!1),le=qR(E),[ye,pe]=lm({prop:s,defaultProp:u??!1,onChange:f,caller:w_}),[be,ke]=lm({prop:m,defaultProp:i,onChange:S,caller:w_}),Oe=V.useRef(null),Ee=U?H||!!U.closest("form"):!0,[qe,Qe]=V.useState(new Set),gt=Array.from(qe).map(Xe=>Xe.props.value).join(";");return c.jsx(z8,{...F,children:c.jsxs(Due,{required:R,scope:t,trigger:U,onTriggerChange:Y,valueNode:z,onValueNodeChange:J,valueNodeHasChildren:ne,onValueNodeHasChildrenChange:me,contentId:lf(),value:be,onValueChange:ke,open:ye,onOpenChange:pe,dir:le,triggerPointerDownPosRef:Oe,disabled:M,children:[c.jsx(dA.Provider,{scope:t,children:c.jsx(Rue,{scope:e.__scopeSelect,onNativeOptionAdd:V.useCallback(Xe=>{Qe(ct=>new Set(ct).add(Xe))},[]),onNativeOptionRemove:V.useCallback(Xe=>{Qe(ct=>{const Me=new Set(ct);return Me.delete(Xe),Me})},[]),children:r})}),Ee?c.jsxs(W7,{"aria-hidden":!0,required:R,tabIndex:-1,name:I,autoComplete:D,value:be,onChange:Xe=>ke(Xe.target.value),disabled:M,form:H,children:[be===void 0?c.jsx("option",{value:""}):null,Array.from(qe)]},gt):null]})})};b7.displayName=w_;var S7="SelectTrigger",T7=V.forwardRef((e,t)=>{const{__scopeSelect:r,disabled:s=!1,...u}=e,f=fA(r),m=jm(S7,r),i=m.disabled||s,S=da(t,m.onTriggerChange),E=hA(r),I=V.useRef("touch"),[D,M,R]=Z7(F=>{const U=E().filter(J=>!J.disabled),Y=U.find(J=>J.value===m.value),z=X7(U,F,Y);z!==void 0&&m.onValueChange(z.value)}),H=F=>{i||(m.onOpenChange(!0),R()),F&&(m.triggerPointerDownPosRef.current={x:Math.round(F.pageX),y:Math.round(F.pageY)})};return c.jsx(B8,{asChild:!0,...f,children:c.jsx(es.button,{type:"button",role:"combobox","aria-controls":m.contentId,"aria-expanded":m.open,"aria-required":m.required,"aria-autocomplete":"none",dir:m.dir,"data-state":m.open?"open":"closed",disabled:i,"data-disabled":i?"":void 0,"data-placeholder":H7(m.value)?"":void 0,...u,ref:S,onClick:xi(u.onClick,F=>{F.currentTarget.focus(),I.current!=="mouse"&&H(F)}),onPointerDown:xi(u.onPointerDown,F=>{I.current=F.pointerType;const U=F.target;U.hasPointerCapture(F.pointerId)&&U.releasePointerCapture(F.pointerId),F.button===0&&F.ctrlKey===!1&&F.pointerType==="mouse"&&(H(F),F.preventDefault())}),onKeyDown:xi(u.onKeyDown,F=>{const U=D.current!=="";!(F.ctrlKey||F.altKey||F.metaKey)&&F.key.length===1&&M(F.key),!(U&&F.key===" ")&&Nue.includes(F.key)&&(H(),F.preventDefault())})})})});T7.displayName=S7;var E7="SelectValue",C7=V.forwardRef((e,t)=>{const{__scopeSelect:r,className:s,style:u,children:f,placeholder:m="",...i}=e,S=jm(E7,r),{onValueNodeHasChildrenChange:E}=S,I=f!==void 0,D=da(t,S.onValueNodeChange);return fl(()=>{E(I)},[E,I]),c.jsx(es.span,{...i,ref:D,style:{pointerEvents:"none"},children:H7(S.value)?c.jsx(c.Fragment,{children:m}):f})});C7.displayName=E7;var Oue="SelectIcon",A7=V.forwardRef((e,t)=>{const{__scopeSelect:r,children:s,...u}=e;return c.jsx(es.span,{"aria-hidden":!0,...u,ref:t,children:s||""})});A7.displayName=Oue;var Fue="SelectPortal",j7=e=>c.jsx(qC,{asChild:!0,...e});j7.displayName=Fue;var b_="SelectContent",I7=V.forwardRef((e,t)=>{const r=jm(b_,e.__scopeSelect),[s,u]=V.useState();if(fl(()=>{u(new DocumentFragment)},[]),!r.open){const f=s;return f?I_.createPortal(c.jsx(N7,{scope:e.__scopeSelect,children:c.jsx(dA.Slot,{scope:e.__scopeSelect,children:c.jsx("div",{children:e.children})})}),f):null}return c.jsx(k7,{...e,ref:t})});I7.displayName=b_;var sd=10,[N7,Im]=Hv(b_),Lue="SelectContentImpl",zue=bv("SelectContent.RemoveScroll"),k7=V.forwardRef((e,t)=>{const{__scopeSelect:r,position:s="item-aligned",onCloseAutoFocus:u,onEscapeKeyDown:f,onPointerDownOutside:m,side:i,sideOffset:S,align:E,alignOffset:I,arrowPadding:D,collisionBoundary:M,collisionPadding:R,sticky:H,hideWhenDetached:F,avoidCollisions:U,...Y}=e,z=jm(b_,r),[J,ne]=V.useState(null),[me,le]=V.useState(null),ye=da(t,dt=>ne(dt)),[pe,be]=V.useState(null),[ke,Oe]=V.useState(null),Ee=hA(r),[qe,Qe]=V.useState(!1),gt=V.useRef(!1);V.useEffect(()=>{if(J)return L9(J)},[J]),N9();const Xe=V.useCallback(dt=>{const[Vt,...zt]=Ee().map(Wr=>Wr.ref.current),[Gt]=zt.slice(-1),jr=document.activeElement;for(const Wr of dt)if(Wr===jr||(Wr==null||Wr.scrollIntoView({block:"nearest"}),Wr===Vt&&me&&(me.scrollTop=0),Wr===Gt&&me&&(me.scrollTop=me.scrollHeight),Wr==null||Wr.focus(),document.activeElement!==jr))return},[Ee,me]),ct=V.useCallback(()=>Xe([pe,J]),[Xe,pe,J]);V.useEffect(()=>{qe&&ct()},[qe,ct]);const{onOpenChange:Me,triggerPointerDownPosRef:mt}=z;V.useEffect(()=>{if(J){let dt={x:0,y:0};const Vt=Gt=>{var jr,Wr;dt={x:Math.abs(Math.round(Gt.pageX)-(((jr=mt.current)==null?void 0:jr.x)??0)),y:Math.abs(Math.round(Gt.pageY)-(((Wr=mt.current)==null?void 0:Wr.y)??0))}},zt=Gt=>{dt.x<=10&&dt.y<=10?Gt.preventDefault():J.contains(Gt.target)||Me(!1),document.removeEventListener("pointermove",Vt),mt.current=null};return mt.current!==null&&(document.addEventListener("pointermove",Vt),document.addEventListener("pointerup",zt,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Vt),document.removeEventListener("pointerup",zt,{capture:!0})}}},[J,Me,mt]),V.useEffect(()=>{const dt=()=>Me(!1);return window.addEventListener("blur",dt),window.addEventListener("resize",dt),()=>{window.removeEventListener("blur",dt),window.removeEventListener("resize",dt)}},[Me]);const[Kt,it]=Z7(dt=>{const Vt=Ee().filter(jr=>!jr.disabled),zt=Vt.find(jr=>jr.ref.current===document.activeElement),Gt=X7(Vt,dt,zt);Gt&&setTimeout(()=>Gt.ref.current.focus())}),ee=V.useCallback((dt,Vt,zt)=>{const Gt=!gt.current&&!zt;(z.value!==void 0&&z.value===Vt||Gt)&&(be(dt),Gt&&(gt.current=!0))},[z.value]),he=V.useCallback(()=>J==null?void 0:J.focus(),[J]),Se=V.useCallback((dt,Vt,zt)=>{const Gt=!gt.current&&!zt;(z.value!==void 0&&z.value===Vt||Gt)&&Oe(dt)},[z.value]),Ue=s==="popper"?VP:P7,nt=Ue===VP?{side:i,sideOffset:S,align:E,alignOffset:I,arrowPadding:D,collisionBoundary:M,collisionPadding:R,sticky:H,hideWhenDetached:F,avoidCollisions:U}:{};return c.jsx(N7,{scope:r,content:J,viewport:me,onViewportChange:le,itemRefCallback:ee,selectedItem:pe,onItemLeave:he,itemTextRefCallback:Se,focusSelectedItem:ct,selectedItemText:ke,position:s,isPositioned:qe,searchRef:Kt,children:c.jsx(LR,{as:zue,allowPinchZoom:!0,children:c.jsx(FR,{asChild:!0,trapped:z.open,onMountAutoFocus:dt=>{dt.preventDefault()},onUnmountAutoFocus:xi(u,dt=>{var Vt;(Vt=z.trigger)==null||Vt.focus({preventScroll:!0}),dt.preventDefault()}),children:c.jsx(Fb,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:f,onPointerDownOutside:m,onFocusOutside:dt=>dt.preventDefault(),onDismiss:()=>z.onOpenChange(!1),children:c.jsx(Ue,{role:"listbox",id:z.contentId,"data-state":z.open?"open":"closed",dir:z.dir,onContextMenu:dt=>dt.preventDefault(),...Y,...nt,onPlaced:()=>Qe(!0),ref:ye,style:{display:"flex",flexDirection:"column",outline:"none",...Y.style},onKeyDown:xi(Y.onKeyDown,dt=>{const Vt=dt.ctrlKey||dt.altKey||dt.metaKey;if(dt.key==="Tab"&&dt.preventDefault(),!Vt&&dt.key.length===1&&it(dt.key),["ArrowUp","ArrowDown","Home","End"].includes(dt.key)){let Gt=Ee().filter(jr=>!jr.disabled).map(jr=>jr.ref.current);if(["ArrowUp","End"].includes(dt.key)&&(Gt=Gt.slice().reverse()),["ArrowUp","ArrowDown"].includes(dt.key)){const jr=dt.target,Wr=Gt.indexOf(jr);Gt=Gt.slice(Wr+1)}setTimeout(()=>Xe(Gt)),dt.preventDefault()}})})})})})})});k7.displayName=Lue;var Bue="SelectItemAlignedPosition",P7=V.forwardRef((e,t)=>{const{__scopeSelect:r,onPlaced:s,...u}=e,f=jm(b_,r),m=Im(b_,r),[i,S]=V.useState(null),[E,I]=V.useState(null),D=da(t,ye=>I(ye)),M=hA(r),R=V.useRef(!1),H=V.useRef(!0),{viewport:F,selectedItem:U,selectedItemText:Y,focusSelectedItem:z}=m,J=V.useCallback(()=>{if(f.trigger&&f.valueNode&&i&&E&&F&&U&&Y){const ye=f.trigger.getBoundingClientRect(),pe=E.getBoundingClientRect(),be=f.valueNode.getBoundingClientRect(),ke=Y.getBoundingClientRect();if(f.dir!=="rtl"){const jr=ke.left-pe.left,Wr=be.left-jr,nn=ye.left-Wr,xn=ye.width+nn,ei=Math.max(xn,pe.width),Dn=window.innerWidth-sd,Zr=IB(Wr,[sd,Math.max(sd,Dn-ei)]);i.style.minWidth=xn+"px",i.style.left=Zr+"px"}else{const jr=pe.right-ke.right,Wr=window.innerWidth-be.right-jr,nn=window.innerWidth-ye.right-Wr,xn=ye.width+nn,ei=Math.max(xn,pe.width),Dn=window.innerWidth-sd,Zr=IB(Wr,[sd,Math.max(sd,Dn-ei)]);i.style.minWidth=xn+"px",i.style.right=Zr+"px"}const Oe=M(),Ee=window.innerHeight-sd*2,qe=F.scrollHeight,Qe=window.getComputedStyle(E),gt=parseInt(Qe.borderTopWidth,10),Xe=parseInt(Qe.paddingTop,10),ct=parseInt(Qe.borderBottomWidth,10),Me=parseInt(Qe.paddingBottom,10),mt=gt+Xe+qe+Me+ct,Kt=Math.min(U.offsetHeight*5,mt),it=window.getComputedStyle(F),ee=parseInt(it.paddingTop,10),he=parseInt(it.paddingBottom,10),Se=ye.top+ye.height/2-sd,Ue=Ee-Se,nt=U.offsetHeight/2,dt=U.offsetTop+nt,Vt=gt+Xe+dt,zt=mt-Vt;if(Vt<=Se){const jr=Oe.length>0&&U===Oe[Oe.length-1].ref.current;i.style.bottom="0px";const Wr=E.clientHeight-F.offsetTop-F.offsetHeight,nn=Math.max(Ue,nt+(jr?he:0)+Wr+ct),xn=Vt+nn;i.style.height=xn+"px"}else{const jr=Oe.length>0&&U===Oe[0].ref.current;i.style.top="0px";const nn=Math.max(Se,gt+F.offsetTop+(jr?ee:0)+nt)+zt;i.style.height=nn+"px",F.scrollTop=Vt-Se+F.offsetTop}i.style.margin=`${sd}px 0`,i.style.minHeight=Kt+"px",i.style.maxHeight=Ee+"px",s==null||s(),requestAnimationFrame(()=>R.current=!0)}},[M,f.trigger,f.valueNode,i,E,F,U,Y,f.dir,s]);fl(()=>J(),[J]);const[ne,me]=V.useState();fl(()=>{E&&me(window.getComputedStyle(E).zIndex)},[E]);const le=V.useCallback(ye=>{ye&&H.current===!0&&(J(),z==null||z(),H.current=!1)},[J,z]);return c.jsx(Vue,{scope:r,contentWrapper:i,shouldExpandOnScrollRef:R,onScrollButtonChange:le,children:c.jsx("div",{ref:S,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:ne},children:c.jsx(es.div,{...u,ref:D,style:{boxSizing:"border-box",maxHeight:"100%",...u.style}})})})});P7.displayName=Bue;var Uue="SelectPopperPosition",VP=V.forwardRef((e,t)=>{const{__scopeSelect:r,align:s="start",collisionPadding:u=sd,...f}=e,m=fA(r);return c.jsx(U8,{...m,...f,ref:t,align:s,collisionPadding:u,style:{boxSizing:"border-box",...f.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});VP.displayName=Uue;var[Vue,GR]=Hv(b_,{}),$P="SelectViewport",D7=V.forwardRef((e,t)=>{const{__scopeSelect:r,nonce:s,...u}=e,f=Im($P,r),m=GR($P,r),i=da(t,f.onViewportChange),S=V.useRef(0);return c.jsxs(c.Fragment,{children:[c.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:s}),c.jsx(dA.Slot,{scope:r,children:c.jsx(es.div,{"data-radix-select-viewport":"",role:"presentation",...u,ref:i,style:{position:"relative",flex:1,overflow:"hidden auto",...u.style},onScroll:xi(u.onScroll,E=>{const I=E.currentTarget,{contentWrapper:D,shouldExpandOnScrollRef:M}=m;if(M!=null&&M.current&&D){const R=Math.abs(S.current-I.scrollTop);if(R>0){const H=window.innerHeight-sd*2,F=parseFloat(D.style.minHeight),U=parseFloat(D.style.height),Y=Math.max(F,U);if(Y<H){const z=Y+R,J=Math.min(H,z),ne=z-J;D.style.height=J+"px",D.style.bottom==="0px"&&(I.scrollTop=ne>0?ne:0,D.style.justifyContent="flex-end")}}}S.current=I.scrollTop})})})]})});D7.displayName=$P;var R7="SelectGroup",[$ue,que]=Hv(R7),Gue=V.forwardRef((e,t)=>{const{__scopeSelect:r,...s}=e,u=lf();return c.jsx($ue,{scope:r,id:u,children:c.jsx(es.div,{role:"group","aria-labelledby":u,...s,ref:t})})});Gue.displayName=R7;var M7="SelectLabel",O7=V.forwardRef((e,t)=>{const{__scopeSelect:r,...s}=e,u=que(M7,r);return c.jsx(es.div,{id:u.id,...s,ref:t})});O7.displayName=M7;var sC="SelectItem",[Wue,F7]=Hv(sC),L7=V.forwardRef((e,t)=>{const{__scopeSelect:r,value:s,disabled:u=!1,textValue:f,...m}=e,i=jm(sC,r),S=Im(sC,r),E=i.value===s,[I,D]=V.useState(f??""),[M,R]=V.useState(!1),H=da(t,z=>{var J;return(J=S.itemRefCallback)==null?void 0:J.call(S,z,s,u)}),F=lf(),U=V.useRef("touch"),Y=()=>{u||(i.onValueChange(s),i.onOpenChange(!1))};if(s==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return c.jsx(Wue,{scope:r,value:s,disabled:u,textId:F,isSelected:E,onItemTextChange:V.useCallback(z=>{D(J=>J||((z==null?void 0:z.textContent)??"").trim())},[]),children:c.jsx(dA.ItemSlot,{scope:r,value:s,disabled:u,textValue:I,children:c.jsx(es.div,{role:"option","aria-labelledby":F,"data-highlighted":M?"":void 0,"aria-selected":E&&M,"data-state":E?"checked":"unchecked","aria-disabled":u||void 0,"data-disabled":u?"":void 0,tabIndex:u?void 0:-1,...m,ref:H,onFocus:xi(m.onFocus,()=>R(!0)),onBlur:xi(m.onBlur,()=>R(!1)),onClick:xi(m.onClick,()=>{U.current!=="mouse"&&Y()}),onPointerUp:xi(m.onPointerUp,()=>{U.current==="mouse"&&Y()}),onPointerDown:xi(m.onPointerDown,z=>{U.current=z.pointerType}),onPointerMove:xi(m.onPointerMove,z=>{var J;U.current=z.pointerType,u?(J=S.onItemLeave)==null||J.call(S):U.current==="mouse"&&z.currentTarget.focus({preventScroll:!0})}),onPointerLeave:xi(m.onPointerLeave,z=>{var J;z.currentTarget===document.activeElement&&((J=S.onItemLeave)==null||J.call(S))}),onKeyDown:xi(m.onKeyDown,z=>{var ne;((ne=S.searchRef)==null?void 0:ne.current)!==""&&z.key===" "||(kue.includes(z.key)&&Y(),z.key===" "&&z.preventDefault())})})})})});L7.displayName=sC;var vw="SelectItemText",z7=V.forwardRef((e,t)=>{const{__scopeSelect:r,className:s,style:u,...f}=e,m=jm(vw,r),i=Im(vw,r),S=F7(vw,r),E=Mue(vw,r),[I,D]=V.useState(null),M=da(t,Y=>D(Y),S.onItemTextChange,Y=>{var z;return(z=i.itemTextRefCallback)==null?void 0:z.call(i,Y,S.value,S.disabled)}),R=I==null?void 0:I.textContent,H=V.useMemo(()=>c.jsx("option",{value:S.value,disabled:S.disabled,children:R},S.value),[S.disabled,S.value,R]),{onNativeOptionAdd:F,onNativeOptionRemove:U}=E;return fl(()=>(F(H),()=>U(H)),[F,U,H]),c.jsxs(c.Fragment,{children:[c.jsx(es.span,{id:S.textId,...f,ref:M}),S.isSelected&&m.valueNode&&!m.valueNodeHasChildren?I_.createPortal(f.children,m.valueNode):null]})});z7.displayName=vw;var B7="SelectItemIndicator",U7=V.forwardRef((e,t)=>{const{__scopeSelect:r,...s}=e;return F7(B7,r).isSelected?c.jsx(es.span,{"aria-hidden":!0,...s,ref:t}):null});U7.displayName=B7;var qP="SelectScrollUpButton",V7=V.forwardRef((e,t)=>{const r=Im(qP,e.__scopeSelect),s=GR(qP,e.__scopeSelect),[u,f]=V.useState(!1),m=da(t,s.onScrollButtonChange);return fl(()=>{if(r.viewport&&r.isPositioned){let i=function(){const E=S.scrollTop>0;f(E)};const S=r.viewport;return i(),S.addEventListener("scroll",i),()=>S.removeEventListener("scroll",i)}},[r.viewport,r.isPositioned]),u?c.jsx(q7,{...e,ref:m,onAutoScroll:()=>{const{viewport:i,selectedItem:S}=r;i&&S&&(i.scrollTop=i.scrollTop-S.offsetHeight)}}):null});V7.displayName=qP;var GP="SelectScrollDownButton",$7=V.forwardRef((e,t)=>{const r=Im(GP,e.__scopeSelect),s=GR(GP,e.__scopeSelect),[u,f]=V.useState(!1),m=da(t,s.onScrollButtonChange);return fl(()=>{if(r.viewport&&r.isPositioned){let i=function(){const E=S.scrollHeight-S.clientHeight,I=Math.ceil(S.scrollTop)<E;f(I)};const S=r.viewport;return i(),S.addEventListener("scroll",i),()=>S.removeEventListener("scroll",i)}},[r.viewport,r.isPositioned]),u?c.jsx(q7,{...e,ref:m,onAutoScroll:()=>{const{viewport:i,selectedItem:S}=r;i&&S&&(i.scrollTop=i.scrollTop+S.offsetHeight)}}):null});$7.displayName=GP;var q7=V.forwardRef((e,t)=>{const{__scopeSelect:r,onAutoScroll:s,...u}=e,f=Im("SelectScrollButton",r),m=V.useRef(null),i=hA(r),S=V.useCallback(()=>{m.current!==null&&(window.clearInterval(m.current),m.current=null)},[]);return V.useEffect(()=>()=>S(),[S]),fl(()=>{var I;const E=i().find(D=>D.ref.current===document.activeElement);(I=E==null?void 0:E.ref.current)==null||I.scrollIntoView({block:"nearest"})},[i]),c.jsx(es.div,{"aria-hidden":!0,...u,ref:t,style:{flexShrink:0,...u.style},onPointerDown:xi(u.onPointerDown,()=>{m.current===null&&(m.current=window.setInterval(s,50))}),onPointerMove:xi(u.onPointerMove,()=>{var E;(E=f.onItemLeave)==null||E.call(f),m.current===null&&(m.current=window.setInterval(s,50))}),onPointerLeave:xi(u.onPointerLeave,()=>{S()})})}),Hue="SelectSeparator",G7=V.forwardRef((e,t)=>{const{__scopeSelect:r,...s}=e;return c.jsx(es.div,{"aria-hidden":!0,...s,ref:t})});G7.displayName=Hue;var WP="SelectArrow",Zue=V.forwardRef((e,t)=>{const{__scopeSelect:r,...s}=e,u=fA(r),f=jm(WP,r),m=Im(WP,r);return f.open&&m.position==="popper"?c.jsx(V8,{...u,...s,ref:t}):null});Zue.displayName=WP;var Xue="SelectBubbleInput",W7=V.forwardRef(({__scopeSelect:e,value:t,...r},s)=>{const u=V.useRef(null),f=da(s,u),m=w7(t);return V.useEffect(()=>{const i=u.current;if(!i)return;const S=window.HTMLSelectElement.prototype,I=Object.getOwnPropertyDescriptor(S,"value").set;if(m!==t&&I){const D=new Event("change",{bubbles:!0});I.call(i,t),i.dispatchEvent(D)}},[m,t]),c.jsx(es.select,{...r,style:{...kV,...r.style},ref:f,defaultValue:t})});W7.displayName=Xue;function H7(e){return e===""||e===void 0}function Z7(e){const t=Cu(e),r=V.useRef(""),s=V.useRef(0),u=V.useCallback(m=>{const i=r.current+m;t(i),function S(E){r.current=E,window.clearTimeout(s.current),E!==""&&(s.current=window.setTimeout(()=>S(""),1e3))}(i)},[t]),f=V.useCallback(()=>{r.current="",window.clearTimeout(s.current)},[]);return V.useEffect(()=>()=>window.clearTimeout(s.current),[]),[r,u,f]}function X7(e,t,r){const u=t.length>1&&Array.from(t).every(E=>E===t[0])?t[0]:t,f=r?e.indexOf(r):-1;let m=Yue(e,Math.max(f,0));u.length===1&&(m=m.filter(E=>E!==r));const S=m.find(E=>E.textValue.toLowerCase().startsWith(u.toLowerCase()));return S!==r?S:void 0}function Yue(e,t){return e.map((r,s)=>e[(t+s)%e.length])}var Kue=b7,Y7=T7,Jue=C7,Que=A7,ede=j7,K7=I7,tde=D7,J7=O7,Q7=L7,rde=z7,nde=U7,eq=V7,tq=$7,rq=G7;const Lr=Kue,zr=Jue,Or=V.forwardRef(({className:e,children:t,...r},s)=>c.jsxs(Y7,{ref:s,className:sn("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...r,children:[t,c.jsx(Que,{asChild:!0,children:c.jsx(t8,{className:"h-4 w-4 opacity-50"})})]}));Or.displayName=Y7.displayName;const nq=V.forwardRef(({className:e,...t},r)=>c.jsx(eq,{ref:r,className:sn("flex cursor-default items-center justify-center py-1",e),...t,children:c.jsx(Fee,{className:"h-4 w-4"})}));nq.displayName=eq.displayName;const iq=V.forwardRef(({className:e,...t},r)=>c.jsx(tq,{ref:r,className:sn("flex cursor-default items-center justify-center py-1",e),...t,children:c.jsx(t8,{className:"h-4 w-4"})}));iq.displayName=tq.displayName;const Fr=V.forwardRef(({className:e,children:t,position:r="popper",...s},u)=>c.jsx(ede,{children:c.jsxs(K7,{ref:u,className:sn("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:r,...s,children:[c.jsx(nq,{}),c.jsx(tde,{className:sn("p-1",r==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),c.jsx(iq,{})]})}));Fr.displayName=K7.displayName;const ide=V.forwardRef(({className:e,...t},r)=>c.jsx(J7,{ref:r,className:sn("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t}));ide.displayName=J7.displayName;const yt=V.forwardRef(({className:e,children:t,...r},s)=>c.jsxs(Q7,{ref:s,className:sn("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),...r,children:[c.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:c.jsx(nde,{children:c.jsx(e8,{className:"h-4 w-4"})})}),c.jsx(rde,{children:t})]}));yt.displayName=Q7.displayName;const sde=V.forwardRef(({className:e,...t},r)=>c.jsx(rq,{ref:r,className:sn("-mx-1 my-1 h-px bg-muted",e),...t}));sde.displayName=rq.displayName;const ade=()=>{const[e,t]=V.useState([]),[r,s]=V.useState([]),[u,f]=V.useState(""),[m,i]=V.useState(!0),[S,E]=V.useState(!1),I=Id(),{toast:D}=wm();V.useEffect(()=>{M()},[]),V.useEffect(()=>{H()},[u,e]);const M=async()=>{try{const{data:{user:z}}=await tt.auth.getUser();if(!z){I("/auth");return}const{data:J}=await tt.from("user_roles").select("role").eq("user_id",z.id).single();if((J==null?void 0:J.role)!=="admin"){D({title:"Acesso negado",description:"Apenas administradores podem acessar esta pgina.",variant:"destructive"}),I("/dashboard");return}E(!0),await R()}catch(z){console.error("Error:",z)}finally{i(!1)}},R=async()=>{try{const{data:z,error:J}=await tt.from("profiles").select(`
          id,
          email,
          full_name,
          phone,
          user_roles (role)
        `);if(J)throw J;const ne=(z==null?void 0:z.map(me=>{var le,ye;return{id:me.id,email:me.email,full_name:me.full_name,phone:me.phone,role:((ye=(le=me.user_roles)==null?void 0:le[0])==null?void 0:ye.role)||"tecnico"}}))||[];t(ne),s(ne)}catch(z){D({title:"Erro ao carregar usurios",description:z.message,variant:"destructive"})}},H=()=>{if(!u.trim()){s(e);return}const z=u.toLowerCase(),J=e.filter(ne=>{var me,le;return((me=ne.email)==null?void 0:me.toLowerCase().includes(z))||((le=ne.full_name)==null?void 0:le.toLowerCase().includes(z))});s(J)},F=async(z,J)=>{try{const{error:ne}=await tt.from("user_roles").update({role:J}).eq("user_id",z);if(ne)throw ne;D({title:"Perfil atualizado",description:"O perfil do usurio foi alterado com sucesso."}),await R()}catch(ne){D({title:"Erro ao atualizar perfil",description:ne.message,variant:"destructive"})}},U={admin:"Administrador",gestor_operacoes:"Gestor de Operaes",supervisor:"Supervisor",analista_centro_controle:"Analista Centro Controle",tecnico:"Tcnico",cliente_view:"Cliente (Visualizao)"},Y=z=>({admin:"bg-red-500",gestor_operacoes:"bg-purple-500",supervisor:"bg-blue-500",analista_centro_controle:"bg-cyan-500",tecnico:"bg-green-500",cliente_view:"bg-gray-500"})[z]||"bg-gray-500";return m?c.jsx("div",{className:"min-h-screen flex items-center justify-center",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):S?c.jsx(Wa,{children:c.jsxs("div",{className:"min-h-screen bg-background",children:[c.jsx("header",{className:"border-b bg-card shadow-sm",children:c.jsx("div",{className:"container mx-auto px-4 py-4",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"p-2 bg-gradient-to-br from-primary to-accent rounded-lg",children:c.jsx(cm,{className:"h-6 w-6 text-primary-foreground"})}),c.jsxs("div",{children:[c.jsx("h1",{className:"text-xl font-bold",children:"Facilities Center"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Gesto de Usurios"})]})]})})}),c.jsxs("main",{className:"container mx-auto px-4 py-8",children:[c.jsxs("div",{className:"mb-6",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[c.jsx(aR,{className:"h-6 w-6 text-primary"}),c.jsx("h2",{className:"text-2xl font-bold",children:"Gesto de Perfis de Usurios"})]}),c.jsx("p",{className:"text-muted-foreground mb-6",children:"Gerencie os perfis de acesso de todos os usurios do sistema"}),c.jsxs("div",{className:"relative max-w-md",children:[c.jsx(gd,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),c.jsx(xr,{placeholder:"Buscar por nome ou email...",value:u,onChange:z=>f(z.target.value),className:"pl-10"})]})]}),c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(z=>c.jsxs($r,{className:"hover:shadow-md transition-shadow",children:[c.jsx(Xn,{children:c.jsx("div",{className:"flex items-start justify-between",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:c.jsx(rte,{className:"h-5 w-5 text-primary"})}),c.jsxs("div",{children:[c.jsx(ti,{className:"text-base",children:z.full_name||"Sem nome"}),c.jsx(Gs,{className:"text-xs",children:z.email})]})]})})}),c.jsx(_n,{children:c.jsxs("div",{className:"space-y-3",children:[z.phone&&c.jsxs("p",{className:"text-sm text-muted-foreground",children:["Tel: ",z.phone]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("label",{className:"text-sm font-medium",children:"Perfil de Acesso"}),c.jsxs(Lr,{value:z.role,onValueChange:J=>F(z.id,J),children:[c.jsx(Or,{children:c.jsx(zr,{})}),c.jsx(Fr,{children:Object.entries(U).map(([J,ne])=>c.jsx(yt,{value:J,children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:`w-2 h-2 rounded-full ${Y(J)}`}),ne]})},J))})]})]}),c.jsx(Oi,{className:`${Y(z.role)} text-white`,children:U[z.role]})]})})]},z.id))}),r.length===0&&c.jsx($r,{className:"mt-8",children:c.jsx(_n,{className:"py-12 text-center",children:c.jsx("p",{className:"text-muted-foreground",children:"Nenhum usurio encontrado com os filtros aplicados."})})})]})]})}):null},ode=Vb({password:ol().min(6,{message:"Senha deve ter no minimo 6 caracteres"}).max(72,{message:"Senha deve ter no maximo 72 caracteres"}),confirmPassword:ol()}).refine(e=>e.password===e.confirmPassword,{message:"As senhas nao coincidem",path:["confirmPassword"]}),NB=()=>{const[e,t]=V.useState(""),[r,s]=V.useState(""),[u,f]=V.useState(!1),[m,i]=V.useState(!1),[S,E]=V.useState(!1),I=Id(),D=Tf(),{toast:M}=wm(),R=V.useMemo(()=>new URLSearchParams(D.search).get("token"),[D.search]);V.useEffect(()=>{R||(M({title:"Link invalido",description:"Token de redefinicao nao encontrado.",variant:"destructive"}),I("/auth"))},[I,M,R]);const H=async F=>{if(F.preventDefault(),!R){M({title:"Link invalido",description:"Token de redefinicao nao encontrado.",variant:"destructive"}),I("/auth");return}f(!0);try{const U=ode.parse({password:e,confirmPassword:r}),{error:Y,data:z}=await tt.functions.invoke("reset-password",{body:{token:R,newPassword:U.password}});if(Y)throw Y;if(z&&z.success===!1)throw new Error(z.message||"Nao foi possivel redefinir a senha");M({title:"Senha redefinida!",description:"Sua senha foi alterada com sucesso. Faca login com a nova senha."}),I("/auth")}catch(U){U instanceof Au?M({title:"Erro de validacao",description:U.errors[0].message,variant:"destructive"}):M({title:"Erro",description:U.message||"Nao foi possivel redefinir a senha",variant:"destructive"})}finally{f(!1)}};return R?c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-primary/5 via-background to-accent/5 p-4",children:c.jsxs($r,{className:"w-full max-w-md shadow-lg",children:[c.jsxs(Xn,{className:"space-y-3 text-center",children:[c.jsx("div",{className:"flex justify-center mb-2",children:c.jsx("div",{className:"p-3 bg-gradient-to-br from-destructive to-destructive/80 rounded-xl",children:c.jsx(Wee,{className:"h-8 w-8 text-destructive-foreground"})})}),c.jsx(ti,{className:"text-2xl font-bold",children:"Nova Senha"}),c.jsx(Gs,{children:"Crie uma nova senha segura para sua conta"})]}),c.jsxs(_n,{children:[c.jsxs("form",{onSubmit:H,className:"space-y-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"password",children:"Nova Senha"}),c.jsxs("div",{className:"relative",children:[c.jsx(xr,{id:"password",type:m?"text":"password",placeholder:"Digite a nova senha",value:e,onChange:F=>t(F.target.value),required:!0,disabled:u,minLength:6,maxLength:72}),c.jsx("button",{type:"button",className:"absolute inset-y-0 right-3 flex items-center text-muted-foreground hover:text-foreground",onClick:()=>i(F=>!F),"aria-label":m?"Ocultar senha":"Mostrar senha",children:m?c.jsx(Yk,{className:"h-4 w-4"}):c.jsx(f_,{className:"h-4 w-4"})})]}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Minimo de 6 caracteres"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"confirmPassword",children:"Confirmar Nova Senha"}),c.jsxs("div",{className:"relative",children:[c.jsx(xr,{id:"confirmPassword",type:S?"text":"password",placeholder:"Confirme a nova senha",value:r,onChange:F=>s(F.target.value),required:!0,disabled:u,minLength:6,maxLength:72}),c.jsx("button",{type:"button",className:"absolute inset-y-0 right-3 flex items-center text-muted-foreground hover:text-foreground",onClick:()=>E(F=>!F),"aria-label":S?"Ocultar confirmacao":"Mostrar confirmacao",children:S?c.jsx(Yk,{className:"h-4 w-4"}):c.jsx(f_,{className:"h-4 w-4"})})]})]}),c.jsx(Nt,{type:"submit",className:"w-full",disabled:u,children:u?c.jsxs(c.Fragment,{children:[c.jsx(bf,{className:"mr-2 h-4 w-4 animate-spin"}),"Redefinindo..."]}):"Redefinir Senha"})]}),c.jsx("div",{className:"mt-6 text-center",children:c.jsx("button",{type:"button",onClick:()=>I("/auth"),className:"text-sm text-muted-foreground hover:text-primary",disabled:u,children:"Voltar para login"})})]})]})}):null},nu=V.forwardRef(({className:e,...t},r)=>c.jsx("div",{className:"relative w-full overflow-auto",children:c.jsx("table",{ref:r,className:sn("w-full caption-bottom text-sm",e),...t})}));nu.displayName="Table";const iu=V.forwardRef(({className:e,...t},r)=>c.jsx("thead",{ref:r,className:sn("[&_tr]:border-b",e),...t}));iu.displayName="TableHeader";const su=V.forwardRef(({className:e,...t},r)=>c.jsx("tbody",{ref:r,className:sn("[&_tr:last-child]:border-0",e),...t}));su.displayName="TableBody";const lde=V.forwardRef(({className:e,...t},r)=>c.jsx("tfoot",{ref:r,className:sn("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t}));lde.displayName="TableFooter";const Ws=V.forwardRef(({className:e,...t},r)=>c.jsx("tr",{ref:r,className:sn("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",e),...t}));Ws.displayName="TableRow";const gn=V.forwardRef(({className:e,...t},r)=>c.jsx("th",{ref:r,className:sn("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));gn.displayName="TableHead";const tn=V.forwardRef(({className:e,...t},r)=>c.jsx("td",{ref:r,className:sn("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));tn.displayName="TableCell";const cde=V.forwardRef(({className:e,...t},r)=>c.jsx("caption",{ref:r,className:sn("mt-4 text-sm text-muted-foreground",e),...t}));cde.displayName="TableCaption";var Zb=e=>e.type==="checkbox",Wg=e=>e instanceof Date,Hl=e=>e==null;const sq=e=>typeof e=="object";var vo=e=>!Hl(e)&&!Array.isArray(e)&&sq(e)&&!Wg(e),aq=e=>vo(e)&&e.target?Zb(e.target)?e.target.checked:e.target.value:e,ude=e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e,oq=(e,t)=>e.has(ude(t)),dde=e=>{const t=e.constructor&&e.constructor.prototype;return vo(t)&&t.hasOwnProperty("isPrototypeOf")},WR=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Ro(e){let t;const r=Array.isArray(e),s=typeof FileList<"u"?e instanceof FileList:!1;if(e instanceof Date)t=new Date(e);else if(!(WR&&(e instanceof Blob||s))&&(r||vo(e)))if(t=r?[]:{},!r&&!dde(e))t=e;else for(const u in e)e.hasOwnProperty(u)&&(t[u]=Ro(e[u]));else return e;return t}var pA=e=>/^\w*$/.test(e),_o=e=>e===void 0,HR=e=>Array.isArray(e)?e.filter(Boolean):[],ZR=e=>HR(e.replace(/["|']|\]/g,"").split(/\.|\[/)),kn=(e,t,r)=>{if(!t||!vo(e))return r;const s=(pA(t)?[t]:ZR(t)).reduce((u,f)=>Hl(u)?u:u[f],e);return _o(s)||s===e?_o(e[t])?r:e[t]:s},Uc=e=>typeof e=="boolean",pa=(e,t,r)=>{let s=-1;const u=pA(t)?[t]:ZR(t),f=u.length,m=f-1;for(;++s<f;){const i=u[s];let S=r;if(s!==m){const E=e[i];S=vo(E)||Array.isArray(E)?E:isNaN(+u[s+1])?{}:[]}if(i==="__proto__"||i==="constructor"||i==="prototype")return;e[i]=S,e=e[i]}};const aC={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},fd={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},$h={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},XR=Cr.createContext(null);XR.displayName="HookFormContext";const mA=()=>Cr.useContext(XR),hde=e=>{const{children:t,...r}=e;return Cr.createElement(XR.Provider,{value:r},t)};var lq=(e,t,r,s=!0)=>{const u={defaultValues:t._defaultValues};for(const f in e)Object.defineProperty(u,f,{get:()=>{const m=f;return t._proxyFormState[m]!==fd.all&&(t._proxyFormState[m]=!s||fd.all),r&&(r[m]=!0),e[m]}});return u};const YR=typeof window<"u"?Cr.useLayoutEffect:Cr.useEffect;function fde(e){const t=mA(),{control:r=t.control,disabled:s,name:u,exact:f}=e||{},[m,i]=Cr.useState(r._formState),S=Cr.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1});return YR(()=>r._subscribe({name:u,formState:S.current,exact:f,callback:E=>{!s&&i({...r._formState,...E})}}),[u,s,f]),Cr.useEffect(()=>{S.current.isValid&&r._setValid(!0)},[r]),Cr.useMemo(()=>lq(m,r,S.current,!1),[m,r])}var lh=e=>typeof e=="string",cq=(e,t,r,s,u)=>lh(e)?(s&&t.watch.add(e),kn(r,e,u)):Array.isArray(e)?e.map(f=>(s&&t.watch.add(f),kn(r,f))):(s&&(t.watchAll=!0),r),HP=e=>Hl(e)||!sq(e);function Kh(e,t,r=new WeakSet){if(HP(e)||HP(t))return e===t;if(Wg(e)&&Wg(t))return e.getTime()===t.getTime();const s=Object.keys(e),u=Object.keys(t);if(s.length!==u.length)return!1;if(r.has(e)||r.has(t))return!0;r.add(e),r.add(t);for(const f of s){const m=e[f];if(!u.includes(f))return!1;if(f!=="ref"){const i=t[f];if(Wg(m)&&Wg(i)||vo(m)&&vo(i)||Array.isArray(m)&&Array.isArray(i)?!Kh(m,i,r):m!==i)return!1}}return!0}function pde(e){const t=mA(),{control:r=t.control,name:s,defaultValue:u,disabled:f,exact:m,compute:i}=e||{},S=Cr.useRef(u),E=Cr.useRef(i),I=Cr.useRef(void 0);E.current=i;const D=Cr.useMemo(()=>r._getWatch(s,S.current),[r,s]),[M,R]=Cr.useState(E.current?E.current(D):D);return YR(()=>r._subscribe({name:s,formState:{values:!0},exact:m,callback:H=>{if(!f){const F=cq(s,r._names,H.values||r._formValues,!1,S.current);if(E.current){const U=E.current(F);Kh(U,I.current)||(R(U),I.current=U)}else R(F)}}}),[r,f,s,m]),Cr.useEffect(()=>r._removeUnmounted()),M}function mde(e){const t=mA(),{name:r,disabled:s,control:u=t.control,shouldUnregister:f,defaultValue:m}=e,i=oq(u._names.array,r),S=Cr.useMemo(()=>kn(u._formValues,r,kn(u._defaultValues,r,m)),[u,r,m]),E=pde({control:u,name:r,defaultValue:S,exact:!0}),I=fde({control:u,name:r,exact:!0}),D=Cr.useRef(e),M=Cr.useRef(u.register(r,{...e.rules,value:E,...Uc(e.disabled)?{disabled:e.disabled}:{}}));D.current=e;const R=Cr.useMemo(()=>Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!kn(I.errors,r)},isDirty:{enumerable:!0,get:()=>!!kn(I.dirtyFields,r)},isTouched:{enumerable:!0,get:()=>!!kn(I.touchedFields,r)},isValidating:{enumerable:!0,get:()=>!!kn(I.validatingFields,r)},error:{enumerable:!0,get:()=>kn(I.errors,r)}}),[I,r]),H=Cr.useCallback(z=>M.current.onChange({target:{value:aq(z),name:r},type:aC.CHANGE}),[r]),F=Cr.useCallback(()=>M.current.onBlur({target:{value:kn(u._formValues,r),name:r},type:aC.BLUR}),[r,u._formValues]),U=Cr.useCallback(z=>{const J=kn(u._fields,r);J&&z&&(J._f.ref={focus:()=>z.focus&&z.focus(),select:()=>z.select&&z.select(),setCustomValidity:ne=>z.setCustomValidity(ne),reportValidity:()=>z.reportValidity()})},[u._fields,r]),Y=Cr.useMemo(()=>({name:r,value:E,...Uc(s)||I.disabled?{disabled:I.disabled||s}:{},onChange:H,onBlur:F,ref:U}),[r,s,I.disabled,H,F,U,E]);return Cr.useEffect(()=>{const z=u._options.shouldUnregister||f;u.register(r,{...D.current.rules,...Uc(D.current.disabled)?{disabled:D.current.disabled}:{}});const J=(ne,me)=>{const le=kn(u._fields,ne);le&&le._f&&(le._f.mount=me)};if(J(r,!0),z){const ne=Ro(kn(u._options.defaultValues,r));pa(u._defaultValues,r,ne),_o(kn(u._formValues,r))&&pa(u._formValues,r,ne)}return!i&&u.register(r),()=>{(i?z&&!u._state.action:z)?u.unregister(r):J(r,!1)}},[r,u,i,f]),Cr.useEffect(()=>{u._setDisabledField({disabled:s,name:r})},[s,r,u]),Cr.useMemo(()=>({field:Y,formState:I,fieldState:R}),[Y,I,R])}const gde=e=>e.render(mde(e));var uq=(e,t,r,s,u)=>t?{...r[e],types:{...r[e]&&r[e].types?r[e].types:{},[s]:u||!0}}:{},Ow=e=>Array.isArray(e)?e:[e],kB=()=>{let e=[];return{get observers(){return e},next:u=>{for(const f of e)f.next&&f.next(u)},subscribe:u=>(e.push(u),{unsubscribe:()=>{e=e.filter(f=>f!==u)}}),unsubscribe:()=>{e=[]}}},xc=e=>vo(e)&&!Object.keys(e).length,KR=e=>e.type==="file",pd=e=>typeof e=="function",oC=e=>{if(!WR)return!1;const t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},dq=e=>e.type==="select-multiple",JR=e=>e.type==="radio",_de=e=>JR(e)||Zb(e),DN=e=>oC(e)&&e.isConnected;function xde(e,t){const r=t.slice(0,-1).length;let s=0;for(;s<r;)e=_o(e)?s++:e[t[s++]];return e}function vde(e){for(const t in e)if(e.hasOwnProperty(t)&&!_o(e[t]))return!1;return!0}function Co(e,t){const r=Array.isArray(t)?t:pA(t)?[t]:ZR(t),s=r.length===1?e:xde(e,r),u=r.length-1,f=r[u];return s&&delete s[f],u!==0&&(vo(s)&&xc(s)||Array.isArray(s)&&vde(s))&&Co(e,r.slice(0,-1)),e}var hq=e=>{for(const t in e)if(pd(e[t]))return!0;return!1};function lC(e,t={}){const r=Array.isArray(e);if(vo(e)||r)for(const s in e)Array.isArray(e[s])||vo(e[s])&&!hq(e[s])?(t[s]=Array.isArray(e[s])?[]:{},lC(e[s],t[s])):Hl(e[s])||(t[s]=!0);return t}function fq(e,t,r){const s=Array.isArray(e);if(vo(e)||s)for(const u in e)Array.isArray(e[u])||vo(e[u])&&!hq(e[u])?_o(t)||HP(r[u])?r[u]=Array.isArray(e[u])?lC(e[u],[]):{...lC(e[u])}:fq(e[u],Hl(t)?{}:t[u],r[u]):r[u]=!Kh(e[u],t[u]);return r}var lw=(e,t)=>fq(e,t,lC(t));const PB={value:!1,isValid:!1},DB={value:!0,isValid:!0};var pq=e=>{if(Array.isArray(e)){if(e.length>1){const t=e.filter(r=>r&&r.checked&&!r.disabled).map(r=>r.value);return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!_o(e[0].attributes.value)?_o(e[0].value)||e[0].value===""?DB:{value:e[0].value,isValid:!0}:DB:PB}return PB},mq=(e,{valueAsNumber:t,valueAsDate:r,setValueAs:s})=>_o(e)?e:t?e===""?NaN:e&&+e:r&&lh(e)?new Date(e):s?s(e):e;const RB={isValid:!1,value:null};var gq=e=>Array.isArray(e)?e.reduce((t,r)=>r&&r.checked&&!r.disabled?{isValid:!0,value:r.value}:t,RB):RB;function MB(e){const t=e.ref;return KR(t)?t.files:JR(t)?gq(e.refs).value:dq(t)?[...t.selectedOptions].map(({value:r})=>r):Zb(t)?pq(e.refs).value:mq(_o(t.value)?e.ref.value:t.value,e)}var yde=(e,t,r,s)=>{const u={};for(const f of e){const m=kn(t,f);m&&pa(u,f,m._f)}return{criteriaMode:r,names:[...e],fields:u,shouldUseNativeValidation:s}},cC=e=>e instanceof RegExp,cw=e=>_o(e)?e:cC(e)?e.source:vo(e)?cC(e.value)?e.value.source:e.value:e,OB=e=>({isOnSubmit:!e||e===fd.onSubmit,isOnBlur:e===fd.onBlur,isOnChange:e===fd.onChange,isOnAll:e===fd.all,isOnTouch:e===fd.onTouched});const FB="AsyncFunction";var wde=e=>!!e&&!!e.validate&&!!(pd(e.validate)&&e.validate.constructor.name===FB||vo(e.validate)&&Object.values(e.validate).find(t=>t.constructor.name===FB)),bde=e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate),LB=(e,t,r)=>!r&&(t.watchAll||t.watch.has(e)||[...t.watch].some(s=>e.startsWith(s)&&/^\.\w+/.test(e.slice(s.length))));const Fw=(e,t,r,s)=>{for(const u of r||Object.keys(e)){const f=kn(e,u);if(f){const{_f:m,...i}=f;if(m){if(m.refs&&m.refs[0]&&t(m.refs[0],u)&&!s)return!0;if(m.ref&&t(m.ref,m.name)&&!s)return!0;if(Fw(i,t))break}else if(vo(i)&&Fw(i,t))break}}};function zB(e,t,r){const s=kn(e,r);if(s||pA(r))return{error:s,name:r};const u=r.split(".");for(;u.length;){const f=u.join("."),m=kn(t,f),i=kn(e,f);if(m&&!Array.isArray(m)&&r!==f)return{name:r};if(i&&i.type)return{name:f,error:i};if(i&&i.root&&i.root.type)return{name:`${f}.root`,error:i.root};u.pop()}return{name:r}}var Sde=(e,t,r,s)=>{r(e);const{name:u,...f}=e;return xc(f)||Object.keys(f).length>=Object.keys(t).length||Object.keys(f).find(m=>t[m]===(!s||fd.all))},Tde=(e,t,r)=>!e||!t||e===t||Ow(e).some(s=>s&&(r?s===t:s.startsWith(t)||t.startsWith(s))),Ede=(e,t,r,s,u)=>u.isOnAll?!1:!r&&u.isOnTouch?!(t||e):(r?s.isOnBlur:u.isOnBlur)?!e:(r?s.isOnChange:u.isOnChange)?e:!0,Cde=(e,t)=>!HR(kn(e,t)).length&&Co(e,t),Ade=(e,t,r)=>{const s=Ow(kn(e,r));return pa(s,"root",t[r]),pa(e,r,s),e},dE=e=>lh(e);function BB(e,t,r="validate"){if(dE(e)||Array.isArray(e)&&e.every(dE)||Uc(e)&&!e)return{type:r,message:dE(e)?e:"",ref:t}}var gx=e=>vo(e)&&!cC(e)?e:{value:e,message:""},UB=async(e,t,r,s,u,f)=>{const{ref:m,refs:i,required:S,maxLength:E,minLength:I,min:D,max:M,pattern:R,validate:H,name:F,valueAsNumber:U,mount:Y}=e._f,z=kn(r,F);if(!Y||t.has(F))return{};const J=i?i[0]:m,ne=Ee=>{u&&J.reportValidity&&(J.setCustomValidity(Uc(Ee)?"":Ee||""),J.reportValidity())},me={},le=JR(m),ye=Zb(m),pe=le||ye,be=(U||KR(m))&&_o(m.value)&&_o(z)||oC(m)&&m.value===""||z===""||Array.isArray(z)&&!z.length,ke=uq.bind(null,F,s,me),Oe=(Ee,qe,Qe,gt=$h.maxLength,Xe=$h.minLength)=>{const ct=Ee?qe:Qe;me[F]={type:Ee?gt:Xe,message:ct,ref:m,...ke(Ee?gt:Xe,ct)}};if(f?!Array.isArray(z)||!z.length:S&&(!pe&&(be||Hl(z))||Uc(z)&&!z||ye&&!pq(i).isValid||le&&!gq(i).isValid)){const{value:Ee,message:qe}=dE(S)?{value:!!S,message:S}:gx(S);if(Ee&&(me[F]={type:$h.required,message:qe,ref:J,...ke($h.required,qe)},!s))return ne(qe),me}if(!be&&(!Hl(D)||!Hl(M))){let Ee,qe;const Qe=gx(M),gt=gx(D);if(!Hl(z)&&!isNaN(z)){const Xe=m.valueAsNumber||z&&+z;Hl(Qe.value)||(Ee=Xe>Qe.value),Hl(gt.value)||(qe=Xe<gt.value)}else{const Xe=m.valueAsDate||new Date(z),ct=Kt=>new Date(new Date().toDateString()+" "+Kt),Me=m.type=="time",mt=m.type=="week";lh(Qe.value)&&z&&(Ee=Me?ct(z)>ct(Qe.value):mt?z>Qe.value:Xe>new Date(Qe.value)),lh(gt.value)&&z&&(qe=Me?ct(z)<ct(gt.value):mt?z<gt.value:Xe<new Date(gt.value))}if((Ee||qe)&&(Oe(!!Ee,Qe.message,gt.message,$h.max,$h.min),!s))return ne(me[F].message),me}if((E||I)&&!be&&(lh(z)||f&&Array.isArray(z))){const Ee=gx(E),qe=gx(I),Qe=!Hl(Ee.value)&&z.length>+Ee.value,gt=!Hl(qe.value)&&z.length<+qe.value;if((Qe||gt)&&(Oe(Qe,Ee.message,qe.message),!s))return ne(me[F].message),me}if(R&&!be&&lh(z)){const{value:Ee,message:qe}=gx(R);if(cC(Ee)&&!z.match(Ee)&&(me[F]={type:$h.pattern,message:qe,ref:m,...ke($h.pattern,qe)},!s))return ne(qe),me}if(H){if(pd(H)){const Ee=await H(z,r),qe=BB(Ee,J);if(qe&&(me[F]={...qe,...ke($h.validate,qe.message)},!s))return ne(qe.message),me}else if(vo(H)){let Ee={};for(const qe in H){if(!xc(Ee)&&!s)break;const Qe=BB(await H[qe](z,r),J,qe);Qe&&(Ee={...Qe,...ke(qe,Qe.message)},ne(Qe.message),s&&(me[F]=Ee))}if(!xc(Ee)&&(me[F]={ref:J,...Ee},!s))return me}}return ne(!0),me};const jde={mode:fd.onSubmit,reValidateMode:fd.onChange,shouldFocusError:!0};function Ide(e={}){let t={...jde,...e},r={submitCount:0,isDirty:!1,isReady:!1,isLoading:pd(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},s={},u=vo(t.defaultValues)||vo(t.values)?Ro(t.defaultValues||t.values)||{}:{},f=t.shouldUnregister?{}:Ro(u),m={action:!1,mount:!1,watch:!1},i={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},S,E=0;const I={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let D={...I};const M={array:kB(),state:kB()},R=t.criteriaMode===fd.all,H=ft=>Rt=>{clearTimeout(E),E=setTimeout(ft,Rt)},F=async ft=>{if(!t.disabled&&(I.isValid||D.isValid||ft)){const Rt=t.resolver?xc((await ye()).errors):await be(s,!0);Rt!==r.isValid&&M.state.next({isValid:Rt})}},U=(ft,Rt)=>{!t.disabled&&(I.isValidating||I.validatingFields||D.isValidating||D.validatingFields)&&((ft||Array.from(i.mount)).forEach(Wt=>{Wt&&(Rt?pa(r.validatingFields,Wt,Rt):Co(r.validatingFields,Wt))}),M.state.next({validatingFields:r.validatingFields,isValidating:!xc(r.validatingFields)}))},Y=(ft,Rt=[],Wt,Pr,Sr=!0,Nr=!0)=>{if(Pr&&Wt&&!t.disabled){if(m.action=!0,Nr&&Array.isArray(kn(s,ft))){const Kr=Wt(kn(s,ft),Pr.argA,Pr.argB);Sr&&pa(s,ft,Kr)}if(Nr&&Array.isArray(kn(r.errors,ft))){const Kr=Wt(kn(r.errors,ft),Pr.argA,Pr.argB);Sr&&pa(r.errors,ft,Kr),Cde(r.errors,ft)}if((I.touchedFields||D.touchedFields)&&Nr&&Array.isArray(kn(r.touchedFields,ft))){const Kr=Wt(kn(r.touchedFields,ft),Pr.argA,Pr.argB);Sr&&pa(r.touchedFields,ft,Kr)}(I.dirtyFields||D.dirtyFields)&&(r.dirtyFields=lw(u,f)),M.state.next({name:ft,isDirty:Oe(ft,Rt),dirtyFields:r.dirtyFields,errors:r.errors,isValid:r.isValid})}else pa(f,ft,Rt)},z=(ft,Rt)=>{pa(r.errors,ft,Rt),M.state.next({errors:r.errors})},J=ft=>{r.errors=ft,M.state.next({errors:r.errors,isValid:!1})},ne=(ft,Rt,Wt,Pr)=>{const Sr=kn(s,ft);if(Sr){const Nr=kn(f,ft,_o(Wt)?kn(u,ft):Wt);_o(Nr)||Pr&&Pr.defaultChecked||Rt?pa(f,ft,Rt?Nr:MB(Sr._f)):Qe(ft,Nr),m.mount&&F()}},me=(ft,Rt,Wt,Pr,Sr)=>{let Nr=!1,Kr=!1;const Zn={name:ft};if(!t.disabled){if(!Wt||Pr){(I.isDirty||D.isDirty)&&(Kr=r.isDirty,r.isDirty=Zn.isDirty=Oe(),Nr=Kr!==Zn.isDirty);const Yn=Kh(kn(u,ft),Rt);Kr=!!kn(r.dirtyFields,ft),Yn?Co(r.dirtyFields,ft):pa(r.dirtyFields,ft,!0),Zn.dirtyFields=r.dirtyFields,Nr=Nr||(I.dirtyFields||D.dirtyFields)&&Kr!==!Yn}if(Wt){const Yn=kn(r.touchedFields,ft);Yn||(pa(r.touchedFields,ft,Wt),Zn.touchedFields=r.touchedFields,Nr=Nr||(I.touchedFields||D.touchedFields)&&Yn!==Wt)}Nr&&Sr&&M.state.next(Zn)}return Nr?Zn:{}},le=(ft,Rt,Wt,Pr)=>{const Sr=kn(r.errors,ft),Nr=(I.isValid||D.isValid)&&Uc(Rt)&&r.isValid!==Rt;if(t.delayError&&Wt?(S=H(()=>z(ft,Wt)),S(t.delayError)):(clearTimeout(E),S=null,Wt?pa(r.errors,ft,Wt):Co(r.errors,ft)),(Wt?!Kh(Sr,Wt):Sr)||!xc(Pr)||Nr){const Kr={...Pr,...Nr&&Uc(Rt)?{isValid:Rt}:{},errors:r.errors,name:ft};r={...r,...Kr},M.state.next(Kr)}},ye=async ft=>{U(ft,!0);const Rt=await t.resolver(f,t.context,yde(ft||i.mount,s,t.criteriaMode,t.shouldUseNativeValidation));return U(ft),Rt},pe=async ft=>{const{errors:Rt}=await ye(ft);if(ft)for(const Wt of ft){const Pr=kn(Rt,Wt);Pr?pa(r.errors,Wt,Pr):Co(r.errors,Wt)}else r.errors=Rt;return Rt},be=async(ft,Rt,Wt={valid:!0})=>{for(const Pr in ft){const Sr=ft[Pr];if(Sr){const{_f:Nr,...Kr}=Sr;if(Nr){const Zn=i.array.has(Nr.name),Yn=Sr._f&&wde(Sr._f);Yn&&I.validatingFields&&U([Pr],!0);const Zt=await UB(Sr,i.disabled,f,R,t.shouldUseNativeValidation&&!Rt,Zn);if(Yn&&I.validatingFields&&U([Pr]),Zt[Nr.name]&&(Wt.valid=!1,Rt))break;!Rt&&(kn(Zt,Nr.name)?Zn?Ade(r.errors,Zt,Nr.name):pa(r.errors,Nr.name,Zt[Nr.name]):Co(r.errors,Nr.name))}!xc(Kr)&&await be(Kr,Rt,Wt)}}return Wt.valid},ke=()=>{for(const ft of i.unMount){const Rt=kn(s,ft);Rt&&(Rt._f.refs?Rt._f.refs.every(Wt=>!DN(Wt)):!DN(Rt._f.ref))&&dt(ft)}i.unMount=new Set},Oe=(ft,Rt)=>!t.disabled&&(ft&&Rt&&pa(f,ft,Rt),!Kh(Kt(),u)),Ee=(ft,Rt,Wt)=>cq(ft,i,{...m.mount?f:_o(Rt)?u:lh(ft)?{[ft]:Rt}:Rt},Wt,Rt),qe=ft=>HR(kn(m.mount?f:u,ft,t.shouldUnregister?kn(u,ft,[]):[])),Qe=(ft,Rt,Wt={})=>{const Pr=kn(s,ft);let Sr=Rt;if(Pr){const Nr=Pr._f;Nr&&(!Nr.disabled&&pa(f,ft,mq(Rt,Nr)),Sr=oC(Nr.ref)&&Hl(Rt)?"":Rt,dq(Nr.ref)?[...Nr.ref.options].forEach(Kr=>Kr.selected=Sr.includes(Kr.value)):Nr.refs?Zb(Nr.ref)?Nr.refs.forEach(Kr=>{(!Kr.defaultChecked||!Kr.disabled)&&(Array.isArray(Sr)?Kr.checked=!!Sr.find(Zn=>Zn===Kr.value):Kr.checked=Sr===Kr.value||!!Sr)}):Nr.refs.forEach(Kr=>Kr.checked=Kr.value===Sr):KR(Nr.ref)?Nr.ref.value="":(Nr.ref.value=Sr,Nr.ref.type||M.state.next({name:ft,values:Ro(f)})))}(Wt.shouldDirty||Wt.shouldTouch)&&me(ft,Sr,Wt.shouldTouch,Wt.shouldDirty,!0),Wt.shouldValidate&&mt(ft)},gt=(ft,Rt,Wt)=>{for(const Pr in Rt){if(!Rt.hasOwnProperty(Pr))return;const Sr=Rt[Pr],Nr=ft+"."+Pr,Kr=kn(s,Nr);(i.array.has(ft)||vo(Sr)||Kr&&!Kr._f)&&!Wg(Sr)?gt(Nr,Sr,Wt):Qe(Nr,Sr,Wt)}},Xe=(ft,Rt,Wt={})=>{const Pr=kn(s,ft),Sr=i.array.has(ft),Nr=Ro(Rt);pa(f,ft,Nr),Sr?(M.array.next({name:ft,values:Ro(f)}),(I.isDirty||I.dirtyFields||D.isDirty||D.dirtyFields)&&Wt.shouldDirty&&M.state.next({name:ft,dirtyFields:lw(u,f),isDirty:Oe(ft,Nr)})):Pr&&!Pr._f&&!Hl(Nr)?gt(ft,Nr,Wt):Qe(ft,Nr,Wt),LB(ft,i)&&M.state.next({...r,name:ft}),M.state.next({name:m.mount?ft:void 0,values:Ro(f)})},ct=async ft=>{m.mount=!0;const Rt=ft.target;let Wt=Rt.name,Pr=!0;const Sr=kn(s,Wt),Nr=Yn=>{Pr=Number.isNaN(Yn)||Wg(Yn)&&isNaN(Yn.getTime())||Kh(Yn,kn(f,Wt,Yn))},Kr=OB(t.mode),Zn=OB(t.reValidateMode);if(Sr){let Yn,Zt;const en=Rt.type?MB(Sr._f):aq(ft),Sn=ft.type===aC.BLUR||ft.type===aC.FOCUS_OUT,fs=!bde(Sr._f)&&!t.resolver&&!kn(r.errors,Wt)&&!Sr._f.deps||Ede(Sn,kn(r.touchedFields,Wt),r.isSubmitted,Zn,Kr),ms=LB(Wt,i,Sn);pa(f,Wt,en),Sn?(Sr._f.onBlur&&Sr._f.onBlur(ft),S&&S(0)):Sr._f.onChange&&Sr._f.onChange(ft);const hr=me(Wt,en,Sn),An=!xc(hr)||ms;if(!Sn&&M.state.next({name:Wt,type:ft.type,values:Ro(f)}),fs)return(I.isValid||D.isValid)&&(t.mode==="onBlur"?Sn&&F():Sn||F()),An&&M.state.next({name:Wt,...ms?{}:hr});if(!Sn&&ms&&M.state.next({...r}),t.resolver){const{errors:fi}=await ye([Wt]);if(Nr(en),Pr){const Vi=zB(r.errors,s,Wt),$n=zB(fi,s,Vi.name||Wt);Yn=$n.error,Wt=$n.name,Zt=xc(fi)}}else U([Wt],!0),Yn=(await UB(Sr,i.disabled,f,R,t.shouldUseNativeValidation))[Wt],U([Wt]),Nr(en),Pr&&(Yn?Zt=!1:(I.isValid||D.isValid)&&(Zt=await be(s,!0)));Pr&&(Sr._f.deps&&mt(Sr._f.deps),le(Wt,Zt,Yn,hr))}},Me=(ft,Rt)=>{if(kn(r.errors,Rt)&&ft.focus)return ft.focus(),1},mt=async(ft,Rt={})=>{let Wt,Pr;const Sr=Ow(ft);if(t.resolver){const Nr=await pe(_o(ft)?ft:Sr);Wt=xc(Nr),Pr=ft?!Sr.some(Kr=>kn(Nr,Kr)):Wt}else ft?(Pr=(await Promise.all(Sr.map(async Nr=>{const Kr=kn(s,Nr);return await be(Kr&&Kr._f?{[Nr]:Kr}:Kr)}))).every(Boolean),!(!Pr&&!r.isValid)&&F()):Pr=Wt=await be(s);return M.state.next({...!lh(ft)||(I.isValid||D.isValid)&&Wt!==r.isValid?{}:{name:ft},...t.resolver||!ft?{isValid:Wt}:{},errors:r.errors}),Rt.shouldFocus&&!Pr&&Fw(s,Me,ft?Sr:i.mount),Pr},Kt=ft=>{const Rt={...m.mount?f:u};return _o(ft)?Rt:lh(ft)?kn(Rt,ft):ft.map(Wt=>kn(Rt,Wt))},it=(ft,Rt)=>({invalid:!!kn((Rt||r).errors,ft),isDirty:!!kn((Rt||r).dirtyFields,ft),error:kn((Rt||r).errors,ft),isValidating:!!kn(r.validatingFields,ft),isTouched:!!kn((Rt||r).touchedFields,ft)}),ee=ft=>{ft&&Ow(ft).forEach(Rt=>Co(r.errors,Rt)),M.state.next({errors:ft?r.errors:{}})},he=(ft,Rt,Wt)=>{const Pr=(kn(s,ft,{_f:{}})._f||{}).ref,Sr=kn(r.errors,ft)||{},{ref:Nr,message:Kr,type:Zn,...Yn}=Sr;pa(r.errors,ft,{...Yn,...Rt,ref:Pr}),M.state.next({name:ft,errors:r.errors,isValid:!1}),Wt&&Wt.shouldFocus&&Pr&&Pr.focus&&Pr.focus()},Se=(ft,Rt)=>pd(ft)?M.state.subscribe({next:Wt=>"values"in Wt&&ft(Ee(void 0,Rt),Wt)}):Ee(ft,Rt,!0),Ue=ft=>M.state.subscribe({next:Rt=>{Tde(ft.name,Rt.name,ft.exact)&&Sde(Rt,ft.formState||I,Zr,ft.reRenderRoot)&&ft.callback({values:{...f},...r,...Rt,defaultValues:u})}}).unsubscribe,nt=ft=>(m.mount=!0,D={...D,...ft.formState},Ue({...ft,formState:D})),dt=(ft,Rt={})=>{for(const Wt of ft?Ow(ft):i.mount)i.mount.delete(Wt),i.array.delete(Wt),Rt.keepValue||(Co(s,Wt),Co(f,Wt)),!Rt.keepError&&Co(r.errors,Wt),!Rt.keepDirty&&Co(r.dirtyFields,Wt),!Rt.keepTouched&&Co(r.touchedFields,Wt),!Rt.keepIsValidating&&Co(r.validatingFields,Wt),!t.shouldUnregister&&!Rt.keepDefaultValue&&Co(u,Wt);M.state.next({values:Ro(f)}),M.state.next({...r,...Rt.keepDirty?{isDirty:Oe()}:{}}),!Rt.keepIsValid&&F()},Vt=({disabled:ft,name:Rt})=>{(Uc(ft)&&m.mount||ft||i.disabled.has(Rt))&&(ft?i.disabled.add(Rt):i.disabled.delete(Rt))},zt=(ft,Rt={})=>{let Wt=kn(s,ft);const Pr=Uc(Rt.disabled)||Uc(t.disabled);return pa(s,ft,{...Wt||{},_f:{...Wt&&Wt._f?Wt._f:{ref:{name:ft}},name:ft,mount:!0,...Rt}}),i.mount.add(ft),Wt?Vt({disabled:Uc(Rt.disabled)?Rt.disabled:t.disabled,name:ft}):ne(ft,!0,Rt.value),{...Pr?{disabled:Rt.disabled||t.disabled}:{},...t.progressive?{required:!!Rt.required,min:cw(Rt.min),max:cw(Rt.max),minLength:cw(Rt.minLength),maxLength:cw(Rt.maxLength),pattern:cw(Rt.pattern)}:{},name:ft,onChange:ct,onBlur:ct,ref:Sr=>{if(Sr){zt(ft,Rt),Wt=kn(s,ft);const Nr=_o(Sr.value)&&Sr.querySelectorAll&&Sr.querySelectorAll("input,select,textarea")[0]||Sr,Kr=_de(Nr),Zn=Wt._f.refs||[];if(Kr?Zn.find(Yn=>Yn===Nr):Nr===Wt._f.ref)return;pa(s,ft,{_f:{...Wt._f,...Kr?{refs:[...Zn.filter(DN),Nr,...Array.isArray(kn(u,ft))?[{}]:[]],ref:{type:Nr.type,name:ft}}:{ref:Nr}}}),ne(ft,!1,void 0,Nr)}else Wt=kn(s,ft,{}),Wt._f&&(Wt._f.mount=!1),(t.shouldUnregister||Rt.shouldUnregister)&&!(oq(i.array,ft)&&m.action)&&i.unMount.add(ft)}}},Gt=()=>t.shouldFocusError&&Fw(s,Me,i.mount),jr=ft=>{Uc(ft)&&(M.state.next({disabled:ft}),Fw(s,(Rt,Wt)=>{const Pr=kn(s,Wt);Pr&&(Rt.disabled=Pr._f.disabled||ft,Array.isArray(Pr._f.refs)&&Pr._f.refs.forEach(Sr=>{Sr.disabled=Pr._f.disabled||ft}))},0,!1))},Wr=(ft,Rt)=>async Wt=>{let Pr;Wt&&(Wt.preventDefault&&Wt.preventDefault(),Wt.persist&&Wt.persist());let Sr=Ro(f);if(M.state.next({isSubmitting:!0}),t.resolver){const{errors:Nr,values:Kr}=await ye();r.errors=Nr,Sr=Ro(Kr)}else await be(s);if(i.disabled.size)for(const Nr of i.disabled)Co(Sr,Nr);if(Co(r.errors,"root"),xc(r.errors)){M.state.next({errors:{}});try{await ft(Sr,Wt)}catch(Nr){Pr=Nr}}else Rt&&await Rt({...r.errors},Wt),Gt(),setTimeout(Gt);if(M.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:xc(r.errors)&&!Pr,submitCount:r.submitCount+1,errors:r.errors}),Pr)throw Pr},nn=(ft,Rt={})=>{kn(s,ft)&&(_o(Rt.defaultValue)?Xe(ft,Ro(kn(u,ft))):(Xe(ft,Rt.defaultValue),pa(u,ft,Ro(Rt.defaultValue))),Rt.keepTouched||Co(r.touchedFields,ft),Rt.keepDirty||(Co(r.dirtyFields,ft),r.isDirty=Rt.defaultValue?Oe(ft,Ro(kn(u,ft))):Oe()),Rt.keepError||(Co(r.errors,ft),I.isValid&&F()),M.state.next({...r}))},xn=(ft,Rt={})=>{const Wt=ft?Ro(ft):u,Pr=Ro(Wt),Sr=xc(ft),Nr=Sr?u:Pr;if(Rt.keepDefaultValues||(u=Wt),!Rt.keepValues){if(Rt.keepDirtyValues){const Kr=new Set([...i.mount,...Object.keys(lw(u,f))]);for(const Zn of Array.from(Kr))kn(r.dirtyFields,Zn)?pa(Nr,Zn,kn(f,Zn)):Xe(Zn,kn(Nr,Zn))}else{if(WR&&_o(ft))for(const Kr of i.mount){const Zn=kn(s,Kr);if(Zn&&Zn._f){const Yn=Array.isArray(Zn._f.refs)?Zn._f.refs[0]:Zn._f.ref;if(oC(Yn)){const Zt=Yn.closest("form");if(Zt){Zt.reset();break}}}}if(Rt.keepFieldsRef)for(const Kr of i.mount)Xe(Kr,kn(Nr,Kr));else s={}}f=t.shouldUnregister?Rt.keepDefaultValues?Ro(u):{}:Ro(Nr),M.array.next({values:{...Nr}}),M.state.next({values:{...Nr}})}i={mount:Rt.keepDirtyValues?i.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},m.mount=!I.isValid||!!Rt.keepIsValid||!!Rt.keepDirtyValues,m.watch=!!t.shouldUnregister,M.state.next({submitCount:Rt.keepSubmitCount?r.submitCount:0,isDirty:Sr?!1:Rt.keepDirty?r.isDirty:!!(Rt.keepDefaultValues&&!Kh(ft,u)),isSubmitted:Rt.keepIsSubmitted?r.isSubmitted:!1,dirtyFields:Sr?{}:Rt.keepDirtyValues?Rt.keepDefaultValues&&f?lw(u,f):r.dirtyFields:Rt.keepDefaultValues&&ft?lw(u,ft):Rt.keepDirty?r.dirtyFields:{},touchedFields:Rt.keepTouched?r.touchedFields:{},errors:Rt.keepErrors?r.errors:{},isSubmitSuccessful:Rt.keepIsSubmitSuccessful?r.isSubmitSuccessful:!1,isSubmitting:!1})},ei=(ft,Rt)=>xn(pd(ft)?ft(f):ft,Rt),Dn=(ft,Rt={})=>{const Wt=kn(s,ft),Pr=Wt&&Wt._f;if(Pr){const Sr=Pr.refs?Pr.refs[0]:Pr.ref;Sr.focus&&(Sr.focus(),Rt.shouldSelect&&pd(Sr.select)&&Sr.select())}},Zr=ft=>{r={...r,...ft}},Pi={control:{register:zt,unregister:dt,getFieldState:it,handleSubmit:Wr,setError:he,_subscribe:Ue,_runSchema:ye,_focusError:Gt,_getWatch:Ee,_getDirty:Oe,_setValid:F,_setFieldArray:Y,_setDisabledField:Vt,_setErrors:J,_getFieldArray:qe,_reset:xn,_resetDefaultValues:()=>pd(t.defaultValues)&&t.defaultValues().then(ft=>{ei(ft,t.resetOptions),M.state.next({isLoading:!1})}),_removeUnmounted:ke,_disableForm:jr,_subjects:M,_proxyFormState:I,get _fields(){return s},get _formValues(){return f},get _state(){return m},set _state(ft){m=ft},get _defaultValues(){return u},get _names(){return i},set _names(ft){i=ft},get _formState(){return r},get _options(){return t},set _options(ft){t={...t,...ft}}},subscribe:nt,trigger:mt,register:zt,handleSubmit:Wr,watch:Se,setValue:Xe,getValues:Kt,reset:ei,resetField:nn,clearErrors:ee,unregister:dt,setError:he,setFocus:Dn,getFieldState:it};return{...Pi,formControl:Pi}}function QR(e={}){const t=Cr.useRef(void 0),r=Cr.useRef(void 0),[s,u]=Cr.useState({isDirty:!1,isValidating:!1,isLoading:pd(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,isReady:!1,defaultValues:pd(e.defaultValues)?void 0:e.defaultValues});if(!t.current)if(e.formControl)t.current={...e.formControl,formState:s},e.defaultValues&&!pd(e.defaultValues)&&e.formControl.reset(e.defaultValues,e.resetOptions);else{const{formControl:m,...i}=Ide(e);t.current={...i,formState:s}}const f=t.current.control;return f._options=e,YR(()=>{const m=f._subscribe({formState:f._proxyFormState,callback:()=>u({...f._formState}),reRenderRoot:!0});return u(i=>({...i,isReady:!0})),f._formState.isReady=!0,m},[f]),Cr.useEffect(()=>f._disableForm(e.disabled),[f,e.disabled]),Cr.useEffect(()=>{e.mode&&(f._options.mode=e.mode),e.reValidateMode&&(f._options.reValidateMode=e.reValidateMode)},[f,e.mode,e.reValidateMode]),Cr.useEffect(()=>{e.errors&&(f._setErrors(e.errors),f._focusError())},[f,e.errors]),Cr.useEffect(()=>{e.shouldUnregister&&f._subjects.state.next({values:f._getWatch()})},[f,e.shouldUnregister]),Cr.useEffect(()=>{if(f._proxyFormState.isDirty){const m=f._getDirty();m!==s.isDirty&&f._subjects.state.next({isDirty:m})}},[f,s.isDirty]),Cr.useEffect(()=>{e.values&&!Kh(e.values,r.current)?(f._reset(e.values,{keepFieldsRef:!0,...f._options.resetOptions}),r.current=e.values,u(m=>({...m}))):f._resetDefaultValues()},[f,e.values]),Cr.useEffect(()=>{f._state.mount||(f._setValid(),f._state.mount=!0),f._state.watch&&(f._state.watch=!1,f._subjects.state.next({...f._formState})),f._removeUnmounted()}),t.current.formState=lq(s,f),t.current}const VB=(e,t,r)=>{if(e&&"reportValidity"in e){const s=kn(r,t);e.setCustomValidity(s&&s.message||""),e.reportValidity()}},_q=(e,t)=>{for(const r in t.fields){const s=t.fields[r];s&&s.ref&&"reportValidity"in s.ref?VB(s.ref,r,e):s.refs&&s.refs.forEach(u=>VB(u,r,e))}},Nde=(e,t)=>{t.shouldUseNativeValidation&&_q(e,t);const r={};for(const s in e){const u=kn(t.fields,s),f=Object.assign(e[s]||{},{ref:u&&u.ref});if(kde(t.names||Object.keys(e),s)){const m=Object.assign({},kn(r,s));pa(m,"root",f),pa(r,s,m)}else pa(r,s,f)}return r},kde=(e,t)=>e.some(r=>r.startsWith(t+"."));var Pde=function(e,t){for(var r={};e.length;){var s=e[0],u=s.code,f=s.message,m=s.path.join(".");if(!r[m])if("unionErrors"in s){var i=s.unionErrors[0].errors[0];r[m]={message:i.message,type:i.code}}else r[m]={message:f,type:u};if("unionErrors"in s&&s.unionErrors.forEach(function(I){return I.errors.forEach(function(D){return e.push(D)})}),t){var S=r[m].types,E=S&&S[s.code];r[m]=uq(m,t,r,u,E?[].concat(E,s.message):s.message)}e.shift()}return r},Dde=function(e,t,r){return r===void 0&&(r={}),function(s,u,f){try{return Promise.resolve(function(m,i){try{var S=Promise.resolve(e[r.mode==="sync"?"parse":"parseAsync"](s,t)).then(function(E){return f.shouldUseNativeValidation&&_q({},f),{errors:{},values:r.raw?s:E}})}catch(E){return i(E)}return S&&S.then?S.then(void 0,i):S}(0,function(m){if(function(i){return Array.isArray(i==null?void 0:i.errors)}(m))return{values:{},errors:Nde(Pde(m.errors,!f.shouldUseNativeValidation&&f.criteriaMode==="all"),f)};throw m}))}catch(m){return Promise.reject(m)}}};const Rde=hde,xq=V.createContext({}),pu=({...e})=>c.jsx(xq.Provider,{value:{name:e.name},children:c.jsx(gde,{...e})}),gA=()=>{const e=V.useContext(xq),t=V.useContext(vq),{getFieldState:r,formState:s}=mA(),u=r(e.name,s);if(!e)throw new Error("useFormField should be used within <FormField>");const{id:f}=t;return{id:f,name:e.name,formItemId:`${f}-form-item`,formDescriptionId:`${f}-form-item-description`,formMessageId:`${f}-form-item-message`,...u}},vq=V.createContext({}),fc=V.forwardRef(({className:e,...t},r)=>{const s=V.useId();return c.jsx(vq.Provider,{value:{id:s},children:c.jsx("div",{ref:r,className:sn("space-y-2",e),...t})})});fc.displayName="FormItem";const pc=V.forwardRef(({className:e,...t},r)=>{const{error:s,formItemId:u}=gA();return c.jsx(Dt,{ref:r,className:sn(s&&"text-destructive",e),htmlFor:u,...t})});pc.displayName="FormLabel";const mc=V.forwardRef(({...e},t)=>{const{error:r,formItemId:s,formDescriptionId:u,formMessageId:f}=gA();return c.jsx(N_,{ref:t,id:s,"aria-describedby":r?`${u} ${f}`:`${u}`,"aria-invalid":!!r,...e})});mc.displayName="FormControl";const Mde=V.forwardRef(({className:e,...t},r)=>{const{formDescriptionId:s}=gA();return c.jsx("p",{ref:r,id:s,className:sn("text-sm text-muted-foreground",e),...t})});Mde.displayName="FormDescription";const Lc=V.forwardRef(({className:e,children:t,...r},s)=>{const{error:u,formMessageId:f}=gA(),m=u?String(u==null?void 0:u.message):t;return m?c.jsx("p",{ref:s,id:f,className:sn("text-sm font-medium text-destructive",e),...r,children:m}):null});Lc.displayName="FormMessage";const ec=V.forwardRef(({className:e,...t},r)=>c.jsx("textarea",{className:sn("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:r,...t}));ec.displayName="Textarea";const Ode=Vb({titulo:ol().min(3,"Ttulo deve ter no mnimo 3 caracteres"),descricao:ol().optional(),tipo:ol().min(1,"Tipo  obrigatrio"),categoria:IT(["manutencao","rh","suprimentos","atendimento"]),subcategoria:ol().optional(),prioridade:IT(["baixa","media","alta","critica"]),status:IT(["aberto","em_andamento","pendente","concluido"]),unidade_id:ol().uuid("Unidade  obrigatria"),posto_servico_id:ol().uuid().optional(),contrato_id:ol().uuid().optional(),solicitante_id:ol().uuid().optional(),sla_horas:Rle.number().min(1).default(24),canal:IT(["app","webhook","qr"]).default("app")}),$B=[".pdf",".doc",".docx",".xls",".xlsx",".jpg",".jpeg",".png"],Fde=e=>{if(!e)return"";const t=e.replace(/_/g," ");return t.charAt(0).toUpperCase()+t.slice(1)},Lde={manutencao:["Equipamento","Veculo","Infraestrutura"],rh:["Benefcios","Movimentao","Dvidas"],suprimentos:["Material","Uniforme","EPI"],atendimento:["Limpeza","Organizao","Predial","Outros"]};function zde({open:e,onOpenChange:t,chamado:r,onSuccess:s}){const{toast:u}=wm(),f=Tm(),[m,i]=V.useState(!1),[S,E]=V.useState(null),[I,D]=V.useState(null),[M,R]=V.useState([]),[H,F]=V.useState(null),U=(r==null?void 0:r.id)??null,Y=QR({resolver:Dde(Ode),defaultValues:{titulo:"",descricao:"",tipo:"",categoria:"atendimento",subcategoria:"",prioridade:"media",status:"aberto",sla_horas:24,canal:"app"}}),z=Y.watch("contrato_id"),J=V.useRef(null);V.useEffect(()=>{if(J.current===null){J.current=z??null;return}J.current!==z&&(Y.setValue("unidade_id",""),Y.setValue("posto_servico_id",""),J.current=z??null)},[z,Y]);const ne=Y.watch("unidade_id"),me=Y.watch("posto_servico_id");V.useEffect(()=>{(async()=>{const{data:{user:he}}=await tt.auth.getUser();if(he){E(he.id);const{data:Se}=await tt.from("user_roles").select("role").eq("user_id",he.id).single();Se&&D(Se.role)}})()},[]);const{data:le}=aa({queryKey:["unidades",z],queryFn:async()=>{let ee=tt.from("unidades").select("id, nome").order("nome");z&&(ee=ee.eq("contrato_id",z));const{data:he,error:Se}=await ee;if(Se)throw Se;return he}}),{data:ye}=aa({queryKey:["contratos"],queryFn:async()=>{const{data:ee,error:he}=await tt.from("contratos").select("id, negocio, conq_perd").order("negocio");if(he)throw he;return ee}}),{data:pe,isLoading:be,refetch:ke}=aa({queryKey:["chamado-anexos",U],enabled:!!U&&e,initialData:r==null?void 0:r.anexos,queryFn:async()=>{if(!U)return[];const{data:ee,error:he}=await tt.from("chamados_anexos").select(`
          *,
          usuario:profiles(full_name)
        `).eq("chamado_id",U).order("created_at",{ascending:!1});if(he)throw he;return ee||[]}}),{data:Oe}=aa({queryKey:["postos",ne],queryFn:async()=>{if(!ne)return[];const{data:ee,error:he}=await tt.from("postos_servico").select("id, nome, status").eq("unidade_id",ne).neq("status","inativo").order("nome");if(he)throw he;return ee},enabled:!!ne}),{data:Ee}=aa({queryKey:["colaboradores",me],queryFn:async()=>{let ee=tt.from("colaboradores").select("id, nome_completo, cpf").eq("status_colaborador","ativo").order("nome_completo");me&&(ee=ee.eq("posto_servico_id",me));const{data:he,error:Se}=await ee;if(Se)throw Se;return he}}),qe=V.useRef(null);V.useEffect(()=>{if(qe.current===null){qe.current=me??null;return}qe.current!==me&&(Y.setValue("solicitante_id",""),qe.current=me??null)},[me,Y]);const Qe=pe??(r==null?void 0:r.anexos)??[],gt=(ee,he)=>{if(!ee||ee.length===0){he==null||he();return}const Se=Array.from(ee),Ue=[],nt=[];Se.forEach(dt=>{var zt;const Vt=`.${((zt=dt.name.split(".").pop())==null?void 0:zt.toLowerCase())||""}`;$B.includes(Vt)?Ue.push(dt):nt.push(dt.name)}),nt.length>0&&u({title:"Formato no suportado",description:`Os arquivos (${nt.join(", ")}) no so permitidos. Use PDF, DOCX, XLS ou imagens.`,variant:"destructive"}),R(dt=>[...dt,...Ue]),he==null||he()},Xe=async ee=>{try{const{data:he,error:Se}=await tt.storage.from("chamados-anexos").download(ee.caminho_storage);if(Se||!he)throw Se;const Ue=URL.createObjectURL(he),nt=document.createElement("a");nt.href=Ue,nt.download=ee.nome_arquivo,document.body.appendChild(nt),nt.click(),nt.remove(),URL.revokeObjectURL(Ue)}catch(he){console.error("Erro ao baixar anexo:",he),u({title:"Erro ao baixar anexo",description:"No foi possvel baixar o arquivo. Tente novamente.",variant:"destructive"})}},ct=async ee=>{if(U)try{F(ee.id);const{error:he}=await tt.storage.from("chamados-anexos").remove([ee.caminho_storage]);if(he)throw he;const{error:Se}=await tt.from("chamados_anexos").delete().eq("id",ee.id);if(Se)throw Se;[["chamado-anexos",U],["chamado-anexos-detalhes",U]].forEach(nt=>{f.setQueryData(nt,dt=>(dt||[]).filter(Vt=>Vt.id!==ee.id))}),u({title:"Anexo removido com sucesso"}),await ke()}catch(he){console.error("Erro ao remover anexo:",he),u({title:"Erro ao remover anexo",description:(he==null?void 0:he.message)??"Tente novamente.",variant:"destructive"})}finally{F(null)}},Me=ee=>{R(he=>he.filter((Se,Ue)=>Ue!==ee))},mt=Y.watch("categoria");V.useEffect(()=>{r&&Y.reset({titulo:r.titulo||"",descricao:r.descricao||"",tipo:r.tipo||"",categoria:r.categoria||"atendimento",subcategoria:r.subcategoria||"",prioridade:r.prioridade||"media",status:r.status||"aberto",unidade_id:r.unidade_id||"",posto_servico_id:r.posto_servico_id||"",contrato_id:r.contrato_id||"",solicitante_id:r.solicitante_id||"",sla_horas:r.sla_horas||24,canal:r.canal||"app"})},[r,Y]);const Kt=async ee=>{var he;i(!0);try{const Se={titulo:ee.titulo,descricao:ee.descricao||null,tipo:ee.tipo,categoria:ee.categoria,subcategoria:ee.subcategoria||null,prioridade:ee.prioridade,status:ee.status,unidade_id:ee.unidade_id,posto_servico_id:ee.posto_servico_id||null,contrato_id:ee.contrato_id||null,sla_horas:ee.sla_horas,canal:ee.canal,numero:(r==null?void 0:r.numero)||`CH-${Date.now()}`};let Ue=r==null?void 0:r.id;if(r){const{error:nt}=await tt.from("chamados").update(Se).eq("id",r.id);if(nt)throw nt;u({title:"Chamado atualizado com sucesso!"})}else{const{data:nt,error:dt}=await tt.from("chamados").insert([Se]).select().single();if(dt)throw dt;Ue=nt.id,u({title:"Chamado criado com sucesso!"})}if(M.length>0&&Ue){const{data:{user:nt},error:dt}=await tt.auth.getUser();if(dt||!nt)throw new Error("No foi possvel identificar o usurio para salvar os anexos.");for(const Vt of M){const zt=`.${((he=Vt.name.split(".").pop())==null?void 0:he.toLowerCase())||""}`;if(!$B.includes(zt)){u({title:"Formato no permitido",description:`O arquivo ${Vt.name} no est em um formato suportado.`,variant:"destructive"});continue}const Gt=Vt.name.toLowerCase().replace(/[^\w.-]/g,"_"),jr=`${Ue}/${Date.now()}-${Gt}`,{error:Wr}=await tt.storage.from("chamados-anexos").upload(jr,Vt,{cacheControl:"3600",upsert:!1});if(Wr){console.error("Erro ao fazer upload:",Wr),u({title:"Erro ao enviar anexo",description:`No foi possvel enviar o arquivo ${Vt.name}.`,variant:"destructive"});continue}const{error:nn}=await tt.from("chamados_anexos").insert({chamado_id:Ue,usuario_id:nt.id,nome_arquivo:Vt.name,caminho_storage:jr,tipo_arquivo:Vt.type,tamanho_bytes:Vt.size});nn&&(console.error("Erro ao registrar anexo:",nn),u({title:"Erro ao registrar anexo",description:`O arquivo ${Vt.name} foi enviado, mas no foi registrado no banco.`,variant:"destructive"}))}}s(),Y.reset(),R([])}catch(Se){console.error(Se),u({title:"Erro ao salvar chamado",description:Se.message??"Ocorreu um erro inesperado.",variant:"destructive"})}finally{i(!1)}},it=I==="admin";return c.jsx(Bs,{open:e,onOpenChange:t,children:c.jsxs(Is,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[c.jsxs(Ns,{children:[c.jsx(ks,{children:r?"Editar Chamado":"Novo Chamado"}),c.jsx(La,{children:r?"Atualize dados, anexos e informaes operacionais deste chamado.":"Preencha os campos para registrar um novo chamado."})]}),c.jsx(Rde,{...Y,children:c.jsxs("form",{onSubmit:Y.handleSubmit(Kt),className:"space-y-4",children:[c.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[c.jsx(pu,{control:Y.control,name:"titulo",render:({field:ee})=>c.jsxs(fc,{className:"md:col-span-2",children:[c.jsx(pc,{children:"Ttulo *"}),c.jsx(mc,{children:c.jsx(xr,{...ee,placeholder:"Digite o ttulo do chamado"})}),c.jsx(Lc,{})]})}),c.jsx(pu,{control:Y.control,name:"tipo",render:({field:ee})=>c.jsxs(fc,{children:[c.jsx(pc,{children:"Tipo *"}),c.jsx(mc,{children:c.jsx(xr,{...ee,placeholder:"Ex: Corretiva, Preventiva"})}),c.jsx(Lc,{})]})}),c.jsx(pu,{control:Y.control,name:"categoria",render:({field:ee})=>c.jsxs(fc,{children:[c.jsx(pc,{children:"Categoria *"}),c.jsxs(Lr,{onValueChange:ee.onChange,value:ee.value,children:[c.jsx(mc,{children:c.jsx(Or,{children:c.jsx(zr,{})})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"manutencao",children:"Manuteno"}),c.jsx(yt,{value:"rh",children:"RH"}),c.jsx(yt,{value:"suprimentos",children:"Suprimentos"}),c.jsx(yt,{value:"atendimento",children:"Atendimento"})]})]}),c.jsx(Lc,{})]})}),c.jsx(pu,{control:Y.control,name:"subcategoria",render:({field:ee})=>{var he;return c.jsxs(fc,{children:[c.jsx(pc,{children:"Subcategoria"}),c.jsxs(Lr,{onValueChange:ee.onChange,value:ee.value,children:[c.jsx(mc,{children:c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione..."})})}),c.jsx(Fr,{children:(he=Lde[mt])==null?void 0:he.map(Se=>c.jsx(yt,{value:Se.toLowerCase(),children:Se},Se))})]}),c.jsx(Lc,{})]})}}),c.jsx(pu,{control:Y.control,name:"prioridade",render:({field:ee})=>c.jsxs(fc,{children:[c.jsx(pc,{children:"Prioridade *"}),c.jsxs(Lr,{onValueChange:ee.onChange,value:ee.value,children:[c.jsx(mc,{children:c.jsx(Or,{children:c.jsx(zr,{})})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"baixa",children:"Baixa"}),c.jsx(yt,{value:"media",children:"Mdia"}),c.jsx(yt,{value:"alta",children:"Alta"}),c.jsx(yt,{value:"critica",children:"Crtica"})]})]}),c.jsx(Lc,{})]})}),c.jsx(pu,{control:Y.control,name:"status",render:({field:ee})=>c.jsxs(fc,{children:[c.jsx(pc,{children:"Status *"}),c.jsxs(Lr,{onValueChange:ee.onChange,value:ee.value,children:[c.jsx(mc,{children:c.jsx(Or,{children:c.jsx(zr,{})})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"aberto",children:"Aberto"}),c.jsx(yt,{value:"em_andamento",children:"Em Andamento"}),c.jsx(yt,{value:"pendente",children:"Pendente"}),c.jsx(yt,{value:"concluido",children:"Concludo"})]})]}),c.jsx(Lc,{})]})}),c.jsx(pu,{control:Y.control,name:"sla_horas",render:({field:ee})=>c.jsxs(fc,{children:[c.jsx(pc,{children:"SLA (horas) *"}),c.jsx(mc,{children:c.jsx(xr,{type:"number",...ee,min:1})}),c.jsx(Lc,{})]})}),c.jsx(pu,{control:Y.control,name:"contrato_id",render:({field:ee})=>c.jsxs(fc,{children:[c.jsx(pc,{children:"Contrato"}),c.jsxs(Lr,{onValueChange:ee.onChange,value:ee.value,children:[c.jsx(mc,{children:c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione o contrato"})})}),c.jsx(Fr,{children:ye==null?void 0:ye.map(he=>c.jsxs(yt,{value:he.id,children:[he.negocio," (",he.conq_perd,")"]},he.id))})]}),c.jsx(Lc,{})]})}),c.jsx(pu,{control:Y.control,name:"unidade_id",render:({field:ee})=>c.jsxs(fc,{children:[c.jsx(pc,{children:"Unidade *"}),c.jsxs(Lr,{onValueChange:ee.onChange,value:ee.value,children:[c.jsx(mc,{children:c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione a unidade"})})}),c.jsx(Fr,{children:le==null?void 0:le.map(he=>c.jsx(yt,{value:he.id,children:he.nome},he.id))})]}),c.jsx(Lc,{})]})}),c.jsx(pu,{control:Y.control,name:"posto_servico_id",render:({field:ee})=>c.jsxs(fc,{children:[c.jsx(pc,{children:"Posto de Servio"}),c.jsxs(Lr,{onValueChange:ee.onChange,value:ee.value,disabled:!ne,children:[c.jsx(mc,{children:c.jsx(Or,{children:c.jsx(zr,{placeholder:ne?"Selecione o posto":"Selecione a unidade primeiro"})})}),c.jsx(Fr,{children:Oe==null?void 0:Oe.map(he=>{const Se=Fde(he.status);return c.jsxs(yt,{value:he.id,children:[he.nome,Se?` (${Se})`:""]},he.id)})})]}),c.jsx(Lc,{})]})}),it&&c.jsx(pu,{control:Y.control,name:"solicitante_id",render:({field:ee})=>c.jsxs(fc,{children:[c.jsx(pc,{children:"Solicitante"}),c.jsxs(Lr,{onValueChange:ee.onChange,value:ee.value,children:[c.jsx(mc,{children:c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione o solicitante"})})}),c.jsx(Fr,{children:Ee==null?void 0:Ee.map(he=>c.jsx(yt,{value:he.id,children:he.nome_completo},he.id))})]}),c.jsx(Lc,{})]})}),c.jsx(pu,{control:Y.control,name:"descricao",render:({field:ee})=>c.jsxs(fc,{className:"md:col-span-2",children:[c.jsx(pc,{children:"Descrio"}),c.jsx(mc,{children:c.jsx(ec,{...ee,placeholder:"Descreva os detalhes do chamado",rows:4})}),c.jsx(Lc,{})]})}),c.jsxs(fc,{className:"md:col-span-2",children:[c.jsx(pc,{children:"Anexos"}),c.jsx(mc,{children:c.jsx(xr,{type:"file",multiple:!0,accept:".doc,.docx,.pdf,.xls,.xlsx,.jpg,.jpeg,.png,image/*,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onChange:ee=>gt(ee.target.files,()=>{ee.target.value=""})})}),M.length>0&&c.jsx("div",{className:"mt-2 space-y-2",children:M.map((ee,he)=>c.jsxs("div",{className:"flex items-center justify-between rounded-md border px-3 py-2 text-sm",children:[c.jsxs("div",{className:"min-w-0",children:[c.jsx("p",{className:"truncate font-medium",children:ee.name}),c.jsxs("p",{className:"text-xs text-muted-foreground",children:[(ee.size/1024).toFixed(1)," KB"]})]}),c.jsx(Nt,{type:"button",variant:"ghost",size:"sm",onClick:()=>Me(he),children:"Remover"})]},ee.name+he))})]}),r&&c.jsxs("div",{className:"md:col-span-2 space-y-2",children:[c.jsxs("p",{className:"text-sm font-medium flex items-center gap-2",children:[c.jsx(sR,{className:"h-4 w-4"}),"Anexos atuais"]}),be?c.jsx("p",{className:"text-sm text-muted-foreground",children:"Carregando anexos..."}):Qe.length>0?c.jsx("div",{className:"space-y-2",children:Qe.map(ee=>{var he;return c.jsxs("div",{className:"flex items-center justify-between gap-2 rounded-md border px-3 py-2 text-sm",children:[c.jsxs("div",{className:"min-w-0",children:[c.jsx("p",{className:"truncate font-medium",children:ee.nome_arquivo}),c.jsxs("p",{className:"text-xs text-muted-foreground",children:[ee.created_at?new Date(ee.created_at).toLocaleString("pt-BR"):"Sem data",(he=ee.usuario)!=null&&he.full_name?`  ${ee.usuario.full_name}`:""]})]}),c.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[c.jsx(Nt,{type:"button",variant:"ghost",size:"sm",onClick:()=>Xe(ee),children:"Baixar"}),c.jsx(Nt,{type:"button",variant:"ghost",size:"sm",className:"text-destructive",disabled:H===ee.id,onClick:()=>ct(ee),children:H===ee.id?"Removendo...":"Remover"})]})]},ee.id)})}):c.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum anexo cadastrado para este chamado."})]})]}),c.jsxs("div",{className:"flex justify-end gap-2",children:[c.jsx(Nt,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Cancelar"}),c.jsxs(Nt,{type:"submit",disabled:m,children:[m&&c.jsx(bf,{className:"mr-2 h-4 w-4 animate-spin"}),r?"Atualizar":"Criar"," Chamado"]})]})]})})]})})}function Ps(e){const t=Object.prototype.toString.call(e);return e instanceof Date||typeof e=="object"&&t==="[object Date]"?new e.constructor(+e):typeof e=="number"||t==="[object Number]"||typeof e=="string"||t==="[object String]"?new Date(e):new Date(NaN)}function Qc(e,t){return e instanceof Date?new e.constructor(t):new Date(t)}function Zl(e,t){const r=Ps(e);return isNaN(t)?Qc(e,NaN):(t&&r.setDate(r.getDate()+t),r)}function Ed(e,t){const r=Ps(e);if(isNaN(t))return Qc(e,NaN);if(!t)return r;const s=r.getDate(),u=Qc(e,r.getTime());u.setMonth(r.getMonth()+t+1,0);const f=u.getDate();return s>=f?u:(r.setFullYear(u.getFullYear(),u.getMonth(),s),r)}const eM=6048e5,Bde=864e5,yq=6e4,wq=36e5;let Ude={};function Xb(){return Ude}function mh(e,t){var i,S,E,I;const r=Xb(),s=(t==null?void 0:t.weekStartsOn)??((S=(i=t==null?void 0:t.locale)==null?void 0:i.options)==null?void 0:S.weekStartsOn)??r.weekStartsOn??((I=(E=r.locale)==null?void 0:E.options)==null?void 0:I.weekStartsOn)??0,u=Ps(e),f=u.getDay(),m=(f<s?7:0)+f-s;return u.setDate(u.getDate()-m),u.setHours(0,0,0,0),u}function S_(e){return mh(e,{weekStartsOn:1})}function bq(e){const t=Ps(e),r=t.getFullYear(),s=Qc(e,0);s.setFullYear(r+1,0,4),s.setHours(0,0,0,0);const u=S_(s),f=Qc(e,0);f.setFullYear(r,0,4),f.setHours(0,0,0,0);const m=S_(f);return t.getTime()>=u.getTime()?r+1:t.getTime()>=m.getTime()?r:r-1}function Pv(e){const t=Ps(e);return t.setHours(0,0,0,0),t}function uC(e){const t=Ps(e),r=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return r.setUTCFullYear(t.getFullYear()),+e-+r}function ch(e,t){const r=Pv(e),s=Pv(t),u=+r-uC(r),f=+s-uC(s);return Math.round((u-f)/Bde)}function Vde(e){const t=bq(e),r=Qc(e,0);return r.setFullYear(t,0,4),r.setHours(0,0,0,0),S_(r)}function ZP(e,t){const r=t*7;return Zl(e,r)}function $de(e,t){return Ed(e,t*12)}function qde(e){let t;return e.forEach(function(r){const s=Ps(r);(t===void 0||t<s||isNaN(Number(s)))&&(t=s)}),t||new Date(NaN)}function Gde(e){let t;return e.forEach(r=>{const s=Ps(r);(!t||t>s||isNaN(+s))&&(t=s)}),t||new Date(NaN)}function Tc(e,t){const r=Pv(e),s=Pv(t);return+r==+s}function tM(e){return e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}function Wde(e){if(!tM(e)&&typeof e!="number")return!1;const t=Ps(e);return!isNaN(Number(t))}function yb(e,t){const r=Ps(e),s=Ps(t),u=r.getFullYear()-s.getFullYear(),f=r.getMonth()-s.getMonth();return u*12+f}function Hde(e,t,r){const s=mh(e,r),u=mh(t,r),f=+s-uC(s),m=+u-uC(u);return Math.round((f-m)/eM)}function _A(e){const t=Ps(e),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(23,59,59,999),t}function Ic(e){const t=Ps(e);return t.setDate(1),t.setHours(0,0,0,0),t}function Sq(e){const t=Ps(e),r=Qc(e,0);return r.setFullYear(t.getFullYear(),0,1),r.setHours(0,0,0,0),r}function rM(e,t){var i,S,E,I;const r=Xb(),s=(t==null?void 0:t.weekStartsOn)??((S=(i=t==null?void 0:t.locale)==null?void 0:i.options)==null?void 0:S.weekStartsOn)??r.weekStartsOn??((I=(E=r.locale)==null?void 0:E.options)==null?void 0:I.weekStartsOn)??0,u=Ps(e),f=u.getDay(),m=(f<s?-7:0)+6-(f-s);return u.setDate(u.getDate()+m),u.setHours(23,59,59,999),u}function Tq(e){return rM(e,{weekStartsOn:1})}const Zde={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Xde=(e,t,r)=>{let s;const u=Zde[e];return typeof u=="string"?s=u:t===1?s=u.one:s=u.other.replace("{{count}}",t.toString()),r!=null&&r.addSuffix?r.comparison&&r.comparison>0?"in "+s:s+" ago":s};function Yx(e){return(t={})=>{const r=t.width?String(t.width):e.defaultWidth;return e.formats[r]||e.formats[e.defaultWidth]}}const Yde={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Kde={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Jde={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Qde={date:Yx({formats:Yde,defaultWidth:"full"}),time:Yx({formats:Kde,defaultWidth:"full"}),dateTime:Yx({formats:Jde,defaultWidth:"full"})},ehe={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},the=(e,t,r,s)=>ehe[e];function sh(e){return(t,r)=>{const s=r!=null&&r.context?String(r.context):"standalone";let u;if(s==="formatting"&&e.formattingValues){const m=e.defaultFormattingWidth||e.defaultWidth,i=r!=null&&r.width?String(r.width):m;u=e.formattingValues[i]||e.formattingValues[m]}else{const m=e.defaultWidth,i=r!=null&&r.width?String(r.width):e.defaultWidth;u=e.values[i]||e.values[m]}const f=e.argumentCallback?e.argumentCallback(t):t;return u[f]}}const rhe={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},nhe={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},ihe={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},she={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},ahe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},ohe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},lhe=(e,t)=>{const r=Number(e),s=r%100;if(s>20||s<10)switch(s%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},che={ordinalNumber:lhe,era:sh({values:rhe,defaultWidth:"wide"}),quarter:sh({values:nhe,defaultWidth:"wide",argumentCallback:e=>e-1}),month:sh({values:ihe,defaultWidth:"wide"}),day:sh({values:she,defaultWidth:"wide"}),dayPeriod:sh({values:ahe,defaultWidth:"wide",formattingValues:ohe,defaultFormattingWidth:"wide"})};function ah(e){return(t,r={})=>{const s=r.width,u=s&&e.matchPatterns[s]||e.matchPatterns[e.defaultMatchWidth],f=t.match(u);if(!f)return null;const m=f[0],i=s&&e.parsePatterns[s]||e.parsePatterns[e.defaultParseWidth],S=Array.isArray(i)?dhe(i,D=>D.test(m)):uhe(i,D=>D.test(m));let E;E=e.valueCallback?e.valueCallback(S):S,E=r.valueCallback?r.valueCallback(E):E;const I=t.slice(m.length);return{value:E,rest:I}}}function uhe(e,t){for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t(e[r]))return r}function dhe(e,t){for(let r=0;r<e.length;r++)if(t(e[r]))return r}function Eq(e){return(t,r={})=>{const s=t.match(e.matchPattern);if(!s)return null;const u=s[0],f=t.match(e.parsePattern);if(!f)return null;let m=e.valueCallback?e.valueCallback(f[0]):f[0];m=r.valueCallback?r.valueCallback(m):m;const i=t.slice(u.length);return{value:m,rest:i}}}const hhe=/^(\d+)(th|st|nd|rd)?/i,fhe=/\d+/i,phe={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},mhe={any:[/^b/i,/^(a|c)/i]},ghe={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},_he={any:[/1/i,/2/i,/3/i,/4/i]},xhe={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},vhe={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},yhe={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},whe={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},bhe={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},She={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},The={ordinalNumber:Eq({matchPattern:hhe,parsePattern:fhe,valueCallback:e=>parseInt(e,10)}),era:ah({matchPatterns:phe,defaultMatchWidth:"wide",parsePatterns:mhe,defaultParseWidth:"any"}),quarter:ah({matchPatterns:ghe,defaultMatchWidth:"wide",parsePatterns:_he,defaultParseWidth:"any",valueCallback:e=>e+1}),month:ah({matchPatterns:xhe,defaultMatchWidth:"wide",parsePatterns:vhe,defaultParseWidth:"any"}),day:ah({matchPatterns:yhe,defaultMatchWidth:"wide",parsePatterns:whe,defaultParseWidth:"any"}),dayPeriod:ah({matchPatterns:bhe,defaultMatchWidth:"any",parsePatterns:She,defaultParseWidth:"any"})},Cq={code:"en-US",formatDistance:Xde,formatLong:Qde,formatRelative:the,localize:che,match:The,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Ehe(e){const t=Ps(e);return ch(t,Sq(t))+1}function Aq(e){const t=Ps(e),r=+S_(t)-+Vde(t);return Math.round(r/eM)+1}function jq(e,t){var I,D,M,R;const r=Ps(e),s=r.getFullYear(),u=Xb(),f=(t==null?void 0:t.firstWeekContainsDate)??((D=(I=t==null?void 0:t.locale)==null?void 0:I.options)==null?void 0:D.firstWeekContainsDate)??u.firstWeekContainsDate??((R=(M=u.locale)==null?void 0:M.options)==null?void 0:R.firstWeekContainsDate)??1,m=Qc(e,0);m.setFullYear(s+1,0,f),m.setHours(0,0,0,0);const i=mh(m,t),S=Qc(e,0);S.setFullYear(s,0,f),S.setHours(0,0,0,0);const E=mh(S,t);return r.getTime()>=i.getTime()?s+1:r.getTime()>=E.getTime()?s:s-1}function Che(e,t){var i,S,E,I;const r=Xb(),s=(t==null?void 0:t.firstWeekContainsDate)??((S=(i=t==null?void 0:t.locale)==null?void 0:i.options)==null?void 0:S.firstWeekContainsDate)??r.firstWeekContainsDate??((I=(E=r.locale)==null?void 0:E.options)==null?void 0:I.firstWeekContainsDate)??1,u=jq(e,t),f=Qc(e,0);return f.setFullYear(u,0,s),f.setHours(0,0,0,0),mh(f,t)}function Iq(e,t){const r=Ps(e),s=+mh(r,t)-+Che(r,t);return Math.round(s/eM)+1}function ga(e,t){const r=e<0?"-":"",s=Math.abs(e).toString().padStart(t,"0");return r+s}const Sp={y(e,t){const r=e.getFullYear(),s=r>0?r:1-r;return ga(t==="yy"?s%100:s,t.length)},M(e,t){const r=e.getMonth();return t==="M"?String(r+1):ga(r+1,2)},d(e,t){return ga(e.getDate(),t.length)},a(e,t){const r=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];case"aaaa":default:return r==="am"?"a.m.":"p.m."}},h(e,t){return ga(e.getHours()%12||12,t.length)},H(e,t){return ga(e.getHours(),t.length)},m(e,t){return ga(e.getMinutes(),t.length)},s(e,t){return ga(e.getSeconds(),t.length)},S(e,t){const r=t.length,s=e.getMilliseconds(),u=Math.trunc(s*Math.pow(10,r-3));return ga(u,t.length)}},_x={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},qB={G:function(e,t,r){const s=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return r.era(s,{width:"abbreviated"});case"GGGGG":return r.era(s,{width:"narrow"});case"GGGG":default:return r.era(s,{width:"wide"})}},y:function(e,t,r){if(t==="yo"){const s=e.getFullYear(),u=s>0?s:1-s;return r.ordinalNumber(u,{unit:"year"})}return Sp.y(e,t)},Y:function(e,t,r,s){const u=jq(e,s),f=u>0?u:1-u;if(t==="YY"){const m=f%100;return ga(m,2)}return t==="Yo"?r.ordinalNumber(f,{unit:"year"}):ga(f,t.length)},R:function(e,t){const r=bq(e);return ga(r,t.length)},u:function(e,t){const r=e.getFullYear();return ga(r,t.length)},Q:function(e,t,r){const s=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(s);case"QQ":return ga(s,2);case"Qo":return r.ordinalNumber(s,{unit:"quarter"});case"QQQ":return r.quarter(s,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(s,{width:"narrow",context:"formatting"});case"QQQQ":default:return r.quarter(s,{width:"wide",context:"formatting"})}},q:function(e,t,r){const s=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(s);case"qq":return ga(s,2);case"qo":return r.ordinalNumber(s,{unit:"quarter"});case"qqq":return r.quarter(s,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(s,{width:"narrow",context:"standalone"});case"qqqq":default:return r.quarter(s,{width:"wide",context:"standalone"})}},M:function(e,t,r){const s=e.getMonth();switch(t){case"M":case"MM":return Sp.M(e,t);case"Mo":return r.ordinalNumber(s+1,{unit:"month"});case"MMM":return r.month(s,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(s,{width:"narrow",context:"formatting"});case"MMMM":default:return r.month(s,{width:"wide",context:"formatting"})}},L:function(e,t,r){const s=e.getMonth();switch(t){case"L":return String(s+1);case"LL":return ga(s+1,2);case"Lo":return r.ordinalNumber(s+1,{unit:"month"});case"LLL":return r.month(s,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(s,{width:"narrow",context:"standalone"});case"LLLL":default:return r.month(s,{width:"wide",context:"standalone"})}},w:function(e,t,r,s){const u=Iq(e,s);return t==="wo"?r.ordinalNumber(u,{unit:"week"}):ga(u,t.length)},I:function(e,t,r){const s=Aq(e);return t==="Io"?r.ordinalNumber(s,{unit:"week"}):ga(s,t.length)},d:function(e,t,r){return t==="do"?r.ordinalNumber(e.getDate(),{unit:"date"}):Sp.d(e,t)},D:function(e,t,r){const s=Ehe(e);return t==="Do"?r.ordinalNumber(s,{unit:"dayOfYear"}):ga(s,t.length)},E:function(e,t,r){const s=e.getDay();switch(t){case"E":case"EE":case"EEE":return r.day(s,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(s,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(s,{width:"short",context:"formatting"});case"EEEE":default:return r.day(s,{width:"wide",context:"formatting"})}},e:function(e,t,r,s){const u=e.getDay(),f=(u-s.weekStartsOn+8)%7||7;switch(t){case"e":return String(f);case"ee":return ga(f,2);case"eo":return r.ordinalNumber(f,{unit:"day"});case"eee":return r.day(u,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(u,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(u,{width:"short",context:"formatting"});case"eeee":default:return r.day(u,{width:"wide",context:"formatting"})}},c:function(e,t,r,s){const u=e.getDay(),f=(u-s.weekStartsOn+8)%7||7;switch(t){case"c":return String(f);case"cc":return ga(f,t.length);case"co":return r.ordinalNumber(f,{unit:"day"});case"ccc":return r.day(u,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(u,{width:"narrow",context:"standalone"});case"cccccc":return r.day(u,{width:"short",context:"standalone"});case"cccc":default:return r.day(u,{width:"wide",context:"standalone"})}},i:function(e,t,r){const s=e.getDay(),u=s===0?7:s;switch(t){case"i":return String(u);case"ii":return ga(u,t.length);case"io":return r.ordinalNumber(u,{unit:"day"});case"iii":return r.day(s,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(s,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(s,{width:"short",context:"formatting"});case"iiii":default:return r.day(s,{width:"wide",context:"formatting"})}},a:function(e,t,r){const u=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.dayPeriod(u,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(u,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(u,{width:"narrow",context:"formatting"});case"aaaa":default:return r.dayPeriod(u,{width:"wide",context:"formatting"})}},b:function(e,t,r){const s=e.getHours();let u;switch(s===12?u=_x.noon:s===0?u=_x.midnight:u=s/12>=1?"pm":"am",t){case"b":case"bb":return r.dayPeriod(u,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(u,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(u,{width:"narrow",context:"formatting"});case"bbbb":default:return r.dayPeriod(u,{width:"wide",context:"formatting"})}},B:function(e,t,r){const s=e.getHours();let u;switch(s>=17?u=_x.evening:s>=12?u=_x.afternoon:s>=4?u=_x.morning:u=_x.night,t){case"B":case"BB":case"BBB":return r.dayPeriod(u,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(u,{width:"narrow",context:"formatting"});case"BBBB":default:return r.dayPeriod(u,{width:"wide",context:"formatting"})}},h:function(e,t,r){if(t==="ho"){let s=e.getHours()%12;return s===0&&(s=12),r.ordinalNumber(s,{unit:"hour"})}return Sp.h(e,t)},H:function(e,t,r){return t==="Ho"?r.ordinalNumber(e.getHours(),{unit:"hour"}):Sp.H(e,t)},K:function(e,t,r){const s=e.getHours()%12;return t==="Ko"?r.ordinalNumber(s,{unit:"hour"}):ga(s,t.length)},k:function(e,t,r){let s=e.getHours();return s===0&&(s=24),t==="ko"?r.ordinalNumber(s,{unit:"hour"}):ga(s,t.length)},m:function(e,t,r){return t==="mo"?r.ordinalNumber(e.getMinutes(),{unit:"minute"}):Sp.m(e,t)},s:function(e,t,r){return t==="so"?r.ordinalNumber(e.getSeconds(),{unit:"second"}):Sp.s(e,t)},S:function(e,t){return Sp.S(e,t)},X:function(e,t,r){const s=e.getTimezoneOffset();if(s===0)return"Z";switch(t){case"X":return WB(s);case"XXXX":case"XX":return Og(s);case"XXXXX":case"XXX":default:return Og(s,":")}},x:function(e,t,r){const s=e.getTimezoneOffset();switch(t){case"x":return WB(s);case"xxxx":case"xx":return Og(s);case"xxxxx":case"xxx":default:return Og(s,":")}},O:function(e,t,r){const s=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+GB(s,":");case"OOOO":default:return"GMT"+Og(s,":")}},z:function(e,t,r){const s=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+GB(s,":");case"zzzz":default:return"GMT"+Og(s,":")}},t:function(e,t,r){const s=Math.trunc(e.getTime()/1e3);return ga(s,t.length)},T:function(e,t,r){const s=e.getTime();return ga(s,t.length)}};function GB(e,t=""){const r=e>0?"-":"+",s=Math.abs(e),u=Math.trunc(s/60),f=s%60;return f===0?r+String(u):r+String(u)+t+ga(f,2)}function WB(e,t){return e%60===0?(e>0?"-":"+")+ga(Math.abs(e)/60,2):Og(e,t)}function Og(e,t=""){const r=e>0?"-":"+",s=Math.abs(e),u=ga(Math.trunc(s/60),2),f=ga(s%60,2);return r+u+t+f}const HB=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},Nq=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},Ahe=(e,t)=>{const r=e.match(/(P+)(p+)?/)||[],s=r[1],u=r[2];if(!u)return HB(e,t);let f;switch(s){case"P":f=t.dateTime({width:"short"});break;case"PP":f=t.dateTime({width:"medium"});break;case"PPP":f=t.dateTime({width:"long"});break;case"PPPP":default:f=t.dateTime({width:"full"});break}return f.replace("{{date}}",HB(s,t)).replace("{{time}}",Nq(u,t))},jhe={p:Nq,P:Ahe},Ihe=/^D+$/,Nhe=/^Y+$/,khe=["D","DD","YY","YYYY"];function Phe(e){return Ihe.test(e)}function Dhe(e){return Nhe.test(e)}function Rhe(e,t,r){const s=Mhe(e,t,r);if(console.warn(s),khe.includes(e))throw new RangeError(s)}function Mhe(e,t,r){const s=e[0]==="Y"?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${t}\`) for formatting ${s} to the input \`${r}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const Ohe=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Fhe=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Lhe=/^'([^]*?)'?$/,zhe=/''/g,Bhe=/[a-zA-Z]/;function Ii(e,t,r){var I,D,M,R,H,F,U,Y;const s=Xb(),u=(r==null?void 0:r.locale)??s.locale??Cq,f=(r==null?void 0:r.firstWeekContainsDate)??((D=(I=r==null?void 0:r.locale)==null?void 0:I.options)==null?void 0:D.firstWeekContainsDate)??s.firstWeekContainsDate??((R=(M=s.locale)==null?void 0:M.options)==null?void 0:R.firstWeekContainsDate)??1,m=(r==null?void 0:r.weekStartsOn)??((F=(H=r==null?void 0:r.locale)==null?void 0:H.options)==null?void 0:F.weekStartsOn)??s.weekStartsOn??((Y=(U=s.locale)==null?void 0:U.options)==null?void 0:Y.weekStartsOn)??0,i=Ps(e);if(!Wde(i))throw new RangeError("Invalid time value");let S=t.match(Fhe).map(z=>{const J=z[0];if(J==="p"||J==="P"){const ne=jhe[J];return ne(z,u.formatLong)}return z}).join("").match(Ohe).map(z=>{if(z==="''")return{isToken:!1,value:"'"};const J=z[0];if(J==="'")return{isToken:!1,value:Uhe(z)};if(qB[J])return{isToken:!0,value:z};if(J.match(Bhe))throw new RangeError("Format string contains an unescaped latin alphabet character `"+J+"`");return{isToken:!1,value:z}});u.localize.preprocessor&&(S=u.localize.preprocessor(i,S));const E={firstWeekContainsDate:f,weekStartsOn:m,locale:u};return S.map(z=>{if(!z.isToken)return z.value;const J=z.value;(!(r!=null&&r.useAdditionalWeekYearTokens)&&Dhe(J)||!(r!=null&&r.useAdditionalDayOfYearTokens)&&Phe(J))&&Rhe(J,t,String(e));const ne=qB[J[0]];return ne(i,J,u.localize,E)}).join("")}function Uhe(e){const t=e.match(Lhe);return t?t[1].replace(zhe,"'"):e}function Vhe(e){const t=Ps(e),r=t.getFullYear(),s=t.getMonth(),u=Qc(e,0);return u.setFullYear(r,s+1,0),u.setHours(0,0,0,0),u.getDate()}function $he(e){return Math.trunc(+Ps(e)/1e3)}function qhe(e){const t=Ps(e),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(0,0,0,0),t}function Ghe(e,t){return Hde(qhe(e),Ic(e),t)+1}function XP(e,t){const r=Ps(e),s=Ps(t);return r.getTime()>s.getTime()}function kq(e,t){const r=Ps(e),s=Ps(t);return+r<+s}function nM(e,t){const r=Ps(e),s=Ps(t);return r.getFullYear()===s.getFullYear()&&r.getMonth()===s.getMonth()}function Whe(e,t){const r=Ps(e),s=Ps(t);return r.getFullYear()===s.getFullYear()}function YP(e,t){const r=+Ps(e),[s,u]=[+Ps(t.start),+Ps(t.end)].sort((f,m)=>f-m);return r>=s&&r<=u}function RN(e,t){return Zl(e,-t)}function rf(e,t){const s=Yhe(e);let u;if(s.date){const S=Khe(s.date,2);u=Jhe(S.restDateString,S.year)}if(!u||isNaN(u.getTime()))return new Date(NaN);const f=u.getTime();let m=0,i;if(s.time&&(m=Qhe(s.time),isNaN(m)))return new Date(NaN);if(s.timezone){if(i=efe(s.timezone),isNaN(i))return new Date(NaN)}else{const S=new Date(f+m),E=new Date(0);return E.setFullYear(S.getUTCFullYear(),S.getUTCMonth(),S.getUTCDate()),E.setHours(S.getUTCHours(),S.getUTCMinutes(),S.getUTCSeconds(),S.getUTCMilliseconds()),E}return new Date(f+m+i)}const RT={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Hhe=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Zhe=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Xhe=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Yhe(e){const t={},r=e.split(RT.dateTimeDelimiter);let s;if(r.length>2)return t;if(/:/.test(r[0])?s=r[0]:(t.date=r[0],s=r[1],RT.timeZoneDelimiter.test(t.date)&&(t.date=e.split(RT.timeZoneDelimiter)[0],s=e.substr(t.date.length,e.length))),s){const u=RT.timezone.exec(s);u?(t.time=s.replace(u[1],""),t.timezone=u[1]):t.time=s}return t}function Khe(e,t){const r=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),s=e.match(r);if(!s)return{year:NaN,restDateString:""};const u=s[1]?parseInt(s[1]):null,f=s[2]?parseInt(s[2]):null;return{year:f===null?u:f*100,restDateString:e.slice((s[1]||s[2]).length)}}function Jhe(e,t){if(t===null)return new Date(NaN);const r=e.match(Hhe);if(!r)return new Date(NaN);const s=!!r[4],u=uw(r[1]),f=uw(r[2])-1,m=uw(r[3]),i=uw(r[4]),S=uw(r[5])-1;if(s)return sfe(t,i,S)?tfe(t,i,S):new Date(NaN);{const E=new Date(0);return!nfe(t,f,m)||!ife(t,u)?new Date(NaN):(E.setUTCFullYear(t,f,Math.max(u,m)),E)}}function uw(e){return e?parseInt(e):1}function Qhe(e){const t=e.match(Zhe);if(!t)return NaN;const r=MN(t[1]),s=MN(t[2]),u=MN(t[3]);return afe(r,s,u)?r*wq+s*yq+u*1e3:NaN}function MN(e){return e&&parseFloat(e.replace(",","."))||0}function efe(e){if(e==="Z")return 0;const t=e.match(Xhe);if(!t)return 0;const r=t[1]==="+"?-1:1,s=parseInt(t[2]),u=t[3]&&parseInt(t[3])||0;return ofe(s,u)?r*(s*wq+u*yq):NaN}function tfe(e,t,r){const s=new Date(0);s.setUTCFullYear(e,0,4);const u=s.getUTCDay()||7,f=(t-1)*7+r+1-u;return s.setUTCDate(s.getUTCDate()+f),s}const rfe=[31,null,31,30,31,30,31,31,30,31,30,31];function Pq(e){return e%400===0||e%4===0&&e%100!==0}function nfe(e,t,r){return t>=0&&t<=11&&r>=1&&r<=(rfe[t]||(Pq(e)?29:28))}function ife(e,t){return t>=1&&t<=(Pq(e)?366:365)}function sfe(e,t,r){return t>=1&&t<=53&&r>=0&&r<=6}function afe(e,t,r){return e===24?t===0&&r===0:r>=0&&r<60&&t>=0&&t<60&&e>=0&&e<25}function ofe(e,t){return t>=0&&t<=59}function ON(e,t){const r=Ps(e),s=r.getFullYear(),u=r.getDate(),f=Qc(e,0);f.setFullYear(s,t,15),f.setHours(0,0,0,0);const m=Vhe(f);return r.setMonth(t,Math.min(u,m)),r}function ZB(e,t){const r=Ps(e);return isNaN(+r)?Qc(e,NaN):(r.setFullYear(t),r)}const lfe={lessThanXSeconds:{one:"menos de um segundo",other:"menos de {{count}} segundos"},xSeconds:{one:"1 segundo",other:"{{count}} segundos"},halfAMinute:"meio minuto",lessThanXMinutes:{one:"menos de um minuto",other:"menos de {{count}} minutos"},xMinutes:{one:"1 minuto",other:"{{count}} minutos"},aboutXHours:{one:"cerca de 1 hora",other:"cerca de {{count}} horas"},xHours:{one:"1 hora",other:"{{count}} horas"},xDays:{one:"1 dia",other:"{{count}} dias"},aboutXWeeks:{one:"cerca de 1 semana",other:"cerca de {{count}} semanas"},xWeeks:{one:"1 semana",other:"{{count}} semanas"},aboutXMonths:{one:"cerca de 1 ms",other:"cerca de {{count}} meses"},xMonths:{one:"1 ms",other:"{{count}} meses"},aboutXYears:{one:"cerca de 1 ano",other:"cerca de {{count}} anos"},xYears:{one:"1 ano",other:"{{count}} anos"},overXYears:{one:"mais de 1 ano",other:"mais de {{count}} anos"},almostXYears:{one:"quase 1 ano",other:"quase {{count}} anos"}},cfe=(e,t,r)=>{let s;const u=lfe[e];return typeof u=="string"?s=u:t===1?s=u.one:s=u.other.replace("{{count}}",String(t)),r!=null&&r.addSuffix?r.comparison&&r.comparison>0?"em "+s:"h "+s:s},ufe={full:"EEEE, d 'de' MMMM 'de' y",long:"d 'de' MMMM 'de' y",medium:"d MMM y",short:"dd/MM/yyyy"},dfe={full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},hfe={full:"{{date}} 's' {{time}}",long:"{{date}} 's' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},ffe={date:Yx({formats:ufe,defaultWidth:"full"}),time:Yx({formats:dfe,defaultWidth:"full"}),dateTime:Yx({formats:hfe,defaultWidth:"full"})},pfe={lastWeek:e=>{const t=e.getDay();return"'"+(t===0||t===6?"ltimo":"ltima")+"' eeee 's' p"},yesterday:"'ontem s' p",today:"'hoje s' p",tomorrow:"'amanh s' p",nextWeek:"eeee 's' p",other:"P"},mfe=(e,t,r,s)=>{const u=pfe[e];return typeof u=="function"?u(t):u},gfe={narrow:["AC","DC"],abbreviated:["AC","DC"],wide:["antes de cristo","depois de cristo"]},_fe={narrow:["1","2","3","4"],abbreviated:["T1","T2","T3","T4"],wide:["1 trimestre","2 trimestre","3 trimestre","4 trimestre"]},xfe={narrow:["j","f","m","a","m","j","j","a","s","o","n","d"],abbreviated:["jan","fev","mar","abr","mai","jun","jul","ago","set","out","nov","dez"],wide:["janeiro","fevereiro","maro","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"]},vfe={narrow:["D","S","T","Q","Q","S","S"],short:["dom","seg","ter","qua","qui","sex","sab"],abbreviated:["domingo","segunda","tera","quarta","quinta","sexta","sbado"],wide:["domingo","segunda-feira","tera-feira","quarta-feira","quinta-feira","sexta-feira","sbado"]},yfe={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"manh",afternoon:"tarde",evening:"tarde",night:"noite"},abbreviated:{am:"AM",pm:"PM",midnight:"meia-noite",noon:"meio-dia",morning:"manh",afternoon:"tarde",evening:"tarde",night:"noite"},wide:{am:"a.m.",pm:"p.m.",midnight:"meia-noite",noon:"meio-dia",morning:"manh",afternoon:"tarde",evening:"tarde",night:"noite"}},wfe={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"da manh",afternoon:"da tarde",evening:"da tarde",night:"da noite"},abbreviated:{am:"AM",pm:"PM",midnight:"meia-noite",noon:"meio-dia",morning:"da manh",afternoon:"da tarde",evening:"da tarde",night:"da noite"},wide:{am:"a.m.",pm:"p.m.",midnight:"meia-noite",noon:"meio-dia",morning:"da manh",afternoon:"da tarde",evening:"da tarde",night:"da noite"}},bfe=(e,t)=>{const r=Number(e);return(t==null?void 0:t.unit)==="week"?r+"":r+""},Sfe={ordinalNumber:bfe,era:sh({values:gfe,defaultWidth:"wide"}),quarter:sh({values:_fe,defaultWidth:"wide",argumentCallback:e=>e-1}),month:sh({values:xfe,defaultWidth:"wide"}),day:sh({values:vfe,defaultWidth:"wide"}),dayPeriod:sh({values:yfe,defaultWidth:"wide",formattingValues:wfe,defaultFormattingWidth:"wide"})},Tfe=/^(\d+)[o]?/i,Efe=/\d+/i,Cfe={narrow:/^(ac|dc|a|d)/i,abbreviated:/^(a\.?\s?c\.?|d\.?\s?c\.?)/i,wide:/^(antes de cristo|depois de cristo)/i},Afe={any:[/^ac/i,/^dc/i],wide:[/^antes de cristo/i,/^depois de cristo/i]},jfe={narrow:/^[1234]/i,abbreviated:/^T[1234]/i,wide:/^[1234]()? trimestre/i},Ife={any:[/1/i,/2/i,/3/i,/4/i]},Nfe={narrow:/^[jfmajsond]/i,abbreviated:/^(jan|fev|mar|abr|mai|jun|jul|ago|set|out|nov|dez)/i,wide:/^(janeiro|fevereiro|maro|abril|maio|junho|julho|agosto|setembro|outubro|novembro|dezembro)/i},kfe={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^fev/i,/^mar/i,/^abr/i,/^mai/i,/^jun/i,/^jul/i,/^ago/i,/^set/i,/^out/i,/^nov/i,/^dez/i]},Pfe={narrow:/^(dom|[23456]?|s[a]b)/i,short:/^(dom|[23456]?|s[a]b)/i,abbreviated:/^(dom|seg|ter|qua|qui|sex|s[a]b)/i,wide:/^(domingo|(segunda|ter[c]a|quarta|quinta|sexta)([- ]feira)?|s[a]bado)/i},Dfe={short:[/^d/i,/^2/i,/^3/i,/^4/i,/^5/i,/^6/i,/^s[a]/i],narrow:[/^d/i,/^2/i,/^3/i,/^4/i,/^5/i,/^6/i,/^s[a]/i],any:[/^d/i,/^seg/i,/^t/i,/^qua/i,/^qui/i,/^sex/i,/^s[a]b/i]},Rfe={narrow:/^(a|p|mn|md|(da) (manh|tarde|noite))/i,any:/^([ap]\.?\s?m\.?|meia[-\s]noite|meio[-\s]dia|(da) (manh|tarde|noite))/i},Mfe={any:{am:/^a/i,pm:/^p/i,midnight:/^mn|^meia[-\s]noite/i,noon:/^md|^meio[-\s]dia/i,morning:/manh/i,afternoon:/tarde/i,evening:/tarde/i,night:/noite/i}},Ofe={ordinalNumber:Eq({matchPattern:Tfe,parsePattern:Efe,valueCallback:e=>parseInt(e,10)}),era:ah({matchPatterns:Cfe,defaultMatchWidth:"wide",parsePatterns:Afe,defaultParseWidth:"any"}),quarter:ah({matchPatterns:jfe,defaultMatchWidth:"wide",parsePatterns:Ife,defaultParseWidth:"any",valueCallback:e=>e+1}),month:ah({matchPatterns:Nfe,defaultMatchWidth:"wide",parsePatterns:kfe,defaultParseWidth:"any"}),day:ah({matchPatterns:Pfe,defaultMatchWidth:"wide",parsePatterns:Dfe,defaultParseWidth:"any"}),dayPeriod:ah({matchPatterns:Rfe,defaultMatchWidth:"any",parsePatterns:Mfe,defaultParseWidth:"any"})},ia={code:"pt-BR",formatDistance:cfe,formatLong:ffe,formatRelative:mfe,localize:Sfe,match:Ofe,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Ffe({chamado:e,open:t,onOpenChange:r,onEdit:s,onDelete:u}){var Kt;const{toast:f}=wm(),m=Tm(),[i,S]=V.useState(""),[E,I]=V.useState(e.avaliacao||null),[D,M]=V.useState(null),[R,H]=V.useState(null),[F,U]=V.useState(""),[Y,z]=V.useState(null);V.useEffect(()=>{(async()=>{const{data:{user:ee}}=await tt.auth.getUser();ee&&M(ee.id)})()},[]);const{data:J,isLoading:ne}=aa({queryKey:["chamado-anexos-detalhes",e.id],enabled:t&&!!e.id,queryFn:async()=>{const{data:it,error:ee}=await tt.from("chamados_anexos").select("*").eq("chamado_id",e.id).order("created_at",{ascending:!1});if(ee)throw ee;return it||[]}}),me=async it=>{var ee;try{const{data:he,error:Se}=await tt.storage.from("chamados-anexos").download(it.caminho_storage);if(Se||!he)throw Se||new Error("Nenhum dado retornado do Storage");const Ue=he,nt=URL.createObjectURL(Ue);if((ee=it.tipo_arquivo)!=null&&ee.startsWith("image/")||it.tipo_arquivo==="application/pdf")window.open(nt,"_blank"),setTimeout(()=>URL.revokeObjectURL(nt),6e4);else{const dt=document.createElement("a");dt.href=nt,dt.download=it.nome_arquivo,document.body.appendChild(dt),dt.click(),dt.remove(),URL.revokeObjectURL(nt)}}catch(he){console.error("Erro ao abrir/baixar anexo:",he),f({title:"Erro ao abrir anexo",description:"No foi possvel abrir o arquivo. Tente novamente.",variant:"destructive"})}},{data:le,isLoading:ye}=aa({queryKey:["chamados_comentarios",e.id],enabled:t&&!!e.id,queryFn:async()=>{const{data:it,error:ee}=await tt.from("chamados_comentarios").select(`
          *,
          usuario:profiles(full_name)
        `).eq("chamado_id",e.id).order("created_at",{ascending:!0});if(ee)throw ee;return it}}),pe=ox({mutationFn:async it=>{const{data:{user:ee}}=await tt.auth.getUser();if(!ee)throw new Error("Usurio no autenticado");const{data:he,error:Se}=await tt.from("chamados_comentarios").insert([{chamado_id:e.id,usuario_id:ee.id,comentario:it}]).select(`
        *,
        usuario:profiles(full_name)
      `).single();if(Se)throw Se;return he},onSuccess:it=>{m.setQueryData(["chamados_comentarios",e.id],ee=>[...ee||[],it]),S(""),f({title:"Comentrio adicionado com sucesso!"})},onError:it=>{f({title:"Erro ao adicionar comentrio",description:it.message,variant:"destructive"})}}),be=ox({mutationFn:async it=>{const{error:ee}=await tt.from("chamados").update({avaliacao:it}).eq("id",e.id);if(ee)throw ee},onSuccess:()=>{f({title:"Avaliao registrada com sucesso!"})},onError:it=>{f({title:"Erro ao avaliar chamado",description:it.message,variant:"destructive"})}}),ke=ox({mutationFn:async()=>{if(!D)throw new Error("Usurio no autenticado");const{error:it}=await tt.from("chamados").update({atribuido_para_id:D}).eq("id",e.id);if(it)throw it},onSuccess:()=>{m.invalidateQueries({queryKey:["chamados"]}),f({title:"Voc foi atribudo ao chamado com sucesso!"}),r(!1)},onError:it=>{f({title:"Erro ao atribuir chamado",description:it.message,variant:"destructive"})}}),Oe=ox({mutationFn:async()=>{const{error:it}=await tt.from("chamados").update({status:"concluido",data_conclusao:new Date().toISOString()}).eq("id",e.id);if(it)throw it},onSuccess:()=>{m.invalidateQueries({queryKey:["chamados"]}),f({title:"Chamado concludo com sucesso!"}),r(!1)},onError:it=>{f({title:"Erro ao concluir chamado",description:it.message,variant:"destructive"})}}),Ee=()=>{i.trim()&&pe.mutate(i)},qe=ox({mutationFn:async({id:it,comentario:ee})=>{const{data:he,error:Se}=await tt.from("chamados_comentarios").update({comentario:ee}).eq("id",it).select(`
          *,
          usuario:profiles(full_name)
        `).single();if(Se)throw Se;return he},onSuccess:it=>{m.setQueryData(["chamados_comentarios",e.id],ee=>(ee||[]).map(Se=>Se.id===it.id?it:Se)),H(null),U(""),f({title:"Comentrio atualizado com sucesso!"})},onError:it=>{f({title:"Erro ao atualizar comentrio",description:it.message,variant:"destructive"})}}),Qe=ox({mutationFn:async it=>{const{error:ee}=await tt.from("chamados_comentarios").delete().eq("id",it);if(ee)throw ee;return it},onSuccess:it=>{m.setQueryData(["chamados_comentarios",e.id],ee=>(ee||[]).filter(Se=>Se.id!==it)),f({title:"Comentrio removido com sucesso!"})},onError:it=>{f({title:"Erro ao remover comentrio",description:it.message,variant:"destructive"})},onSettled:()=>z(null)}),gt=it=>{if(!F.trim()){f({title:"Comentrio vazio",description:"Escreva algo antes de salvar a edio.",variant:"destructive"});return}confirm("Tem certeza que deseja atualizar este comentrio?")&&qe.mutate({id:it,comentario:F.trim()})},Xe=it=>{H(it.id),U(it.comentario)},ct=()=>{H(null),U("")},Me=it=>{confirm("Tem certeza que deseja excluir este comentrio?")&&(z(it),Qe.mutate(it))},mt=it=>{I(it),be.mutate(it)};return c.jsx(Bs,{open:t,onOpenChange:r,children:c.jsxs(Is,{className:"max-w-4xl w-[95vw] max-h-[90vh] overflow-y-auto",children:[c.jsxs(Ns,{children:[c.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[c.jsxs(ks,{className:"flex flex-col gap-1 sm:flex-row sm:items-center sm:gap-2",children:[c.jsx("span",{children:e.numero}),c.jsx(Oi,{children:(Kt=e.status)==null?void 0:Kt.replace("_"," ")})]}),c.jsxs("div",{className:"flex flex-wrap gap-2",children:[!e.atribuido_para_id&&D&&c.jsxs(Nt,{variant:"default",size:"sm",onClick:()=>ke.mutate(),disabled:ke.isPending,children:[c.jsx(XC,{className:"mr-2 h-4 w-4"}),"Atribuir para mim"]}),e.comentario_avaliacao&&c.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Comentrio: ",e.comentario_avaliacao]}),e.atribuido_para_id===D&&e.status!=="concluido"&&c.jsx(Nt,{variant:"default",size:"sm",onClick:()=>{confirm("Tem certeza que deseja concluir este chamado?")&&Oe.mutate()},disabled:Oe.isPending,children:"Concluir"}),c.jsx(Nt,{variant:"outline",size:"sm",onClick:()=>{s({...e,anexos:J??[]}),r(!1)},children:"Editar"}),c.jsx(Nt,{variant:"destructive",size:"sm",onClick:()=>{confirm("Tem certeza que deseja excluir este chamado?")&&(u(e.id),r(!1))},children:"Excluir"})]})]}),c.jsx(La,{children:"Consulte dados completos, anexos e comentrios antes de atualizar o chamado."})]}),c.jsx(s_,{}),c.jsxs($r,{className:"p-4",children:[c.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2",children:[c.jsx(sR,{className:"h-5 w-5"}),"Anexos"]}),ne?c.jsx(iC,{className:"h-16 w-full"}):J&&J.length>0?c.jsx("div",{className:"space-y-2",children:J.map(it=>c.jsxs("button",{type:"button",onClick:()=>me(it),className:"w-full flex items-center justify-between rounded-md border px-3 py-2 text-sm hover:bg-accent transition-colors",children:[c.jsxs("div",{className:"min-w-0 text-left",children:[c.jsx("p",{className:"truncate font-medium",children:it.nome_arquivo}),c.jsx("p",{className:"text-xs text-muted-foreground",children:it.created_at?Ii(new Date(it.created_at),"dd/MM/yyyy HH:mm",{locale:ia}):"Sem data"})]}),c.jsx("span",{className:"text-xs text-primary underline",children:"Abrir / Baixar"})]},it.id))}):c.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum anexo cadastrado para este chamado."})]}),c.jsx(s_,{}),c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{children:[c.jsx("h2",{className:"text-2xl font-bold mb-2",children:e.titulo}),e.descricao&&c.jsx("p",{className:"text-muted-foreground",children:e.descricao})]}),c.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[c.jsxs($r,{className:"p-4 space-y-2",children:[c.jsx("h3",{className:"font-semibold",children:"Informaes"}),c.jsxs("div",{className:"text-sm space-y-1",children:[c.jsxs("div",{children:[c.jsx("span",{className:"font-medium",children:"Tipo:"})," ",e.tipo]}),e.categoria&&c.jsxs("div",{children:[c.jsx("span",{className:"font-medium",children:"Categoria:"})," ",e.categoria]}),e.subcategoria&&c.jsxs("div",{children:[c.jsx("span",{className:"font-medium",children:"Subcategoria:"})," ",e.subcategoria]}),c.jsxs("div",{children:[c.jsx("span",{className:"font-medium",children:"Prioridade:"})," ",e.prioridade]}),c.jsxs("div",{children:[c.jsx("span",{className:"font-medium",children:"Canal:"})," ",e.canal]}),e.sla_horas&&c.jsxs("div",{children:[c.jsx("span",{className:"font-medium",children:"SLA:"})," ",e.sla_horas," horas"]}),typeof e.avaliacao=="number"&&c.jsxs("div",{children:[c.jsx("span",{className:"font-medium",children:"Nota NPS:"})," ",e.avaliacao,"/5"]}),e.comentario_avaliacao&&c.jsxs("div",{children:[c.jsx("span",{className:"font-medium",children:"Comentrio NPS:"})," ",e.comentario_avaliacao]})]})]}),c.jsxs($r,{className:"p-4 space-y-2",children:[c.jsx("h3",{className:"font-semibold",children:"Localizao"}),c.jsxs("div",{className:"text-sm space-y-1",children:[e.contrato&&c.jsxs("div",{children:[c.jsx("span",{className:"font-medium",children:"Contrato:"})," ",e.contrato.negocio,e.contrato.conq_perd?` (${e.contrato.conq_perd})`:null]}),e.unidade&&c.jsxs("div",{children:[c.jsx("span",{className:"font-medium",children:"Unidade:"})," ",e.unidade.nome]}),e.posto_servico&&c.jsxs("div",{children:[c.jsx("span",{className:"font-medium",children:"Posto:"})," ",e.posto_servico.nome]})]})]}),c.jsxs($r,{className:"p-4 space-y-2",children:[c.jsx("h3",{className:"font-semibold",children:"Pessoas"}),c.jsxs("div",{className:"text-sm space-y-1",children:[e.solicitante&&c.jsxs("div",{children:[c.jsx("span",{className:"font-medium",children:"Solicitante:"})," ",e.solicitante.nome_completo]}),e.atribuido&&c.jsxs("div",{children:[c.jsx("span",{className:"font-medium",children:"Atribudo:"})," ",e.atribuido.nome_completo]}),e.responsavel&&c.jsxs("div",{children:[c.jsx("span",{className:"font-medium",children:"Responsvel:"})," ",e.responsavel.full_name||e.responsavel.nome_completo]})]})]}),c.jsxs($r,{className:"p-4 space-y-2",children:[c.jsx("h3",{className:"font-semibold",children:"Datas"}),c.jsxs("div",{className:"text-sm space-y-1",children:[c.jsxs("div",{children:[c.jsx("span",{className:"font-medium",children:"Abertura:"})," ",Ii(new Date(e.data_abertura),"dd/MM/yyyy HH:mm",{locale:ia})]}),e.data_conclusao&&c.jsxs("div",{children:[c.jsx("span",{className:"font-medium",children:"Concluso:"})," ",Ii(new Date(e.data_conclusao),"dd/MM/yyyy HH:mm",{locale:ia})]})]})]})]}),e.status==="concluido"&&c.jsxs($r,{className:"p-4",children:[c.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2",children:[c.jsx(Qee,{className:"h-5 w-5"}),"Avaliacao do Chamado"]}),c.jsx("div",{className:"flex flex-wrap gap-2",children:[1,2,3,4,5].map(it=>c.jsx(Nt,{variant:E===it?"default":"outline",size:"sm",onClick:()=>mt(it),children:it},it))}),E&&c.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Avaliao: ",E,"/5"]}),e.comentario_avaliacao&&c.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Comentrio: ",e.comentario_avaliacao]})]}),c.jsx(s_,{}),c.jsxs("div",{children:[c.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2",children:[c.jsx(ob,{className:"h-5 w-5"}),"Comentrios (",(le==null?void 0:le.length)||0,")"]}),c.jsx("div",{className:"space-y-3 mb-4",children:ye?c.jsx(iC,{className:"h-20 w-full"}):le&&le.length>0?le.map(it=>{var Se;const ee=D===it.usuario_id,he=R===it.id;return c.jsx($r,{className:"p-3",children:c.jsxs("div",{className:"flex items-start gap-3",children:[c.jsx(r8,{className:"h-8 w-8 text-muted-foreground"}),c.jsxs("div",{className:"flex-1",children:[c.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 mb-2",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-sm font-medium",children:((Se=it.usuario)==null?void 0:Se.full_name)||"Usurio"}),c.jsx("span",{className:"text-xs text-muted-foreground",children:Ii(new Date(it.created_at),"dd/MM/yyyy HH:mm",{locale:ia})})]}),ee&&!he&&c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsxs(Nt,{size:"icon",variant:"ghost",onClick:()=>Xe(it),disabled:Y===it.id,children:[c.jsx(s8,{className:"h-4 w-4"}),c.jsx("span",{className:"sr-only",children:"Editar comentrio"})]}),c.jsxs(Nt,{size:"icon",variant:"ghost",className:"text-destructive",onClick:()=>Me(it.id),disabled:Y===it.id||qe.isPending,children:[c.jsx(zo,{className:"h-4 w-4"}),c.jsx("span",{className:"sr-only",children:"Excluir comentrio"})]})]})]}),he?c.jsxs("div",{className:"space-y-2",children:[c.jsx(ec,{value:F,onChange:Ue=>U(Ue.target.value),rows:3}),c.jsxs("div",{className:"flex justify-end gap-2",children:[c.jsx(Nt,{variant:"outline",size:"sm",onClick:ct,disabled:qe.isPending,children:"Cancelar"}),c.jsx(Nt,{size:"sm",onClick:()=>gt(it.id),disabled:qe.isPending,children:"Salvar"})]})]}):c.jsx("p",{className:"text-sm",children:it.comentario})]})]})},it.id)}):c.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum comentrio ainda"})}),c.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-start",children:[c.jsx(ec,{className:"w-full",placeholder:"Adicione um comentrio...",value:i,onChange:it=>S(it.target.value),rows:2}),c.jsx(Nt,{onClick:Ee,disabled:!i.trim()||pe.isPending,children:c.jsx(a8,{className:"h-4 w-4"})})]})]})]})]})})}function Lfe(){const[e,t]=V.useState(""),[r,s]=V.useState("todos"),[u,f]=V.useState("todos"),[m,i]=V.useState("todos"),[S,E]=V.useState("todos"),[I,D]=V.useState(()=>Ii(new Date,"yyyy-MM")),[M,R]=V.useState(!1),[H,F]=V.useState(null),[U,Y]=V.useState(null),[z,J]=V.useState(null);V.useEffect(()=>{(async()=>{const{data:{user:ct}}=await tt.auth.getUser();ct&&J(ct.id)})()},[]);const{data:ne,isLoading:me,refetch:le}=aa({queryKey:["chamados",r,u,m,S,z],queryFn:async()=>{let Xe=tt.from("chamados").select(`
          *,
          unidade:unidades(nome),
          contrato:contratos(negocio, conq_perd),
          responsavel:profiles(full_name)
        `).order("data_abertura",{ascending:!1});r!=="todos"&&(Xe=Xe.eq("status",r)),u!=="todos"&&(Xe=Xe.eq("categoria",u)),m!=="todos"&&(Xe=Xe.eq("prioridade",m)),S==="meus"&&z&&(Xe=Xe.eq("atribuido_para_id",z));const{data:ct,error:Me}=await Xe;if(Me)throw Me;return ct}}),ye=ne==null?void 0:ne.filter(Xe=>{var ct,Me,mt;return((ct=Xe.titulo)==null?void 0:ct.toLowerCase().includes(e.toLowerCase()))||((Me=Xe.numero)==null?void 0:Me.toLowerCase().includes(e.toLowerCase()))||((mt=Xe.descricao)==null?void 0:mt.toLowerCase().includes(e.toLowerCase()))}),pe={total:(ne==null?void 0:ne.length)||0,abertos:(ne==null?void 0:ne.filter(Xe=>Xe.status==="aberto").length)||0,em_andamento:(ne==null?void 0:ne.filter(Xe=>Xe.status==="em_andamento").length)||0,concluidos:(ne==null?void 0:ne.filter(Xe=>Xe.status==="concluido").length)||0},be=Array.from(new Set((ne||[]).flatMap(Xe=>[Xe.data_abertura,Xe.data_conclusao].filter(Boolean)).map(Xe=>Ii(new Date(Xe),"yyyy-MM")))).sort((Xe,ct)=>Xe>ct?-1:1),ke=(ne==null?void 0:ne.filter(Xe=>Xe.data_abertura&&Ii(new Date(Xe.data_abertura),"yyyy-MM")===I).length)||0,Oe=(ne==null?void 0:ne.filter(Xe=>Xe.status==="concluido"&&Xe.data_conclusao&&Ii(new Date(Xe.data_conclusao),"yyyy-MM")===I).length)||0,Ee=Xe=>{F(Xe),R(!0)},qe=async Xe=>{const{error:ct}=await tt.from("chamados").delete().eq("id",Xe);ct||le()},Qe=Xe=>({aberto:"bg-yellow-500/10 text-yellow-600 border-yellow-500/20",em_andamento:"bg-blue-500/10 text-blue-600 border-blue-500/20",pendente:"bg-orange-500/10 text-orange-600 border-orange-500/20",concluido:"bg-green-500/10 text-green-600 border-green-500/20"})[Xe]||"",gt=Xe=>({baixa:"bg-gray-500/10 text-gray-600 border-gray-500/20",media:"bg-blue-500/10 text-blue-600 border-blue-500/20",alta:"bg-orange-500/10 text-orange-600 border-orange-500/20",critica:"bg-red-500/10 text-red-600 border-red-500/20"})[Xe]||"";return c.jsx(Wa,{children:c.jsxs("div",{className:"space-y-6 p-4 md:p-6",children:[c.jsxs("div",{className:"flex flex-col gap-3 rounded-lg border bg-card p-4 md:flex-row md:items-center md:justify-between",children:[c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold",children:"Chamados"}),c.jsx("p",{className:"text-muted-foreground",children:"Gesto completa de chamados e solicitaes"})]}),c.jsxs(Nt,{className:"w-full md:w-auto",onClick:()=>{F(null),R(!0)},children:[c.jsx(Sc,{className:"mr-2 h-4 w-4"}),"Novo Chamado"]})]}),c.jsxs("div",{className:"grid gap-4 rounded-lg border bg-card p-4 sm:grid-cols-2",children:[c.jsxs($r,{className:"p-4 text-center space-y-1",children:[c.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Abertos"}),c.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:pe.abertos})]}),c.jsxs($r,{className:"p-4 text-center space-y-1",children:[c.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Em Andamento"}),c.jsx("div",{className:"text-2xl font-bold text-blue-600",children:pe.em_andamento})]})]}),c.jsxs("div",{className:"rounded-lg border bg-card p-4 space-y-4",children:[c.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[c.jsx("h2",{className:"text-lg font-semibold",children:"Indicadores por ms"}),c.jsxs(Lr,{value:I,onValueChange:D,children:[c.jsx(Or,{className:"w-full sm:w-[200px]",children:c.jsx(zr,{placeholder:"Selecione o ms"})}),c.jsxs(Fr,{children:[be.length===0&&c.jsx(yt,{value:I,children:Ii(new Date,"MMMM/yyyy",{locale:ia})}),be.map(Xe=>c.jsx(yt,{value:Xe,children:Ii(new Date(Xe+"-01"),"MMMM/yyyy",{locale:ia})},Xe))]})]})]}),c.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[c.jsxs($r,{className:"p-4 text-center space-y-1",children:[c.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Total do ms"}),c.jsx("div",{className:"text-2xl font-bold",children:ke})]}),c.jsxs($r,{className:"p-4 text-center space-y-1",children:[c.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Concludos no ms"}),c.jsx("div",{className:"text-2xl font-bold text-green-600",children:Oe})]})]})]}),c.jsxs("div",{className:"rounded-lg border bg-card p-4 space-y-3",children:[c.jsxs("div",{className:"relative",children:[c.jsx(gd,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),c.jsx(xr,{placeholder:"Buscar por ttulo, nmero ou descrio...",value:e,onChange:Xe=>t(Xe.target.value),className:"pl-9"})]}),c.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-4",children:[c.jsxs(Lr,{value:r,onValueChange:s,children:[c.jsx(Or,{className:"w-full",children:c.jsx(zr,{placeholder:"Status"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"todos",children:"Todos Status"}),c.jsx(yt,{value:"aberto",children:"Aberto"}),c.jsx(yt,{value:"em_andamento",children:"Em Andamento"}),c.jsx(yt,{value:"pendente",children:"Pendente"}),c.jsx(yt,{value:"concluido",children:"Concludo"})]})]}),c.jsxs(Lr,{value:u,onValueChange:f,children:[c.jsx(Or,{className:"w-full",children:c.jsx(zr,{placeholder:"Categoria"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"todos",children:"Todas Categorias"}),c.jsx(yt,{value:"manutencao",children:"Manuteno"}),c.jsx(yt,{value:"rh",children:"RH"}),c.jsx(yt,{value:"suprimentos",children:"Suprimentos"}),c.jsx(yt,{value:"atendimento",children:"Atendimento"})]})]}),c.jsxs(Lr,{value:m,onValueChange:i,children:[c.jsx(Or,{className:"w-full",children:c.jsx(zr,{placeholder:"Prioridade"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"todos",children:"Todas Prioridades"}),c.jsx(yt,{value:"baixa",children:"Baixa"}),c.jsx(yt,{value:"media",children:"Mdia"}),c.jsx(yt,{value:"alta",children:"Alta"}),c.jsx(yt,{value:"critica",children:"Crtica"})]})]}),c.jsxs(Lr,{value:S,onValueChange:E,children:[c.jsx(Or,{className:"w-full",children:c.jsx(zr,{placeholder:"Atribuio"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"todos",children:"Todos"}),c.jsx(yt,{value:"meus",children:"Meus Chamados"})]})]})]})]}),c.jsx("div",{className:"rounded-md border p-4 overflow-x-auto",children:c.jsxs(nu,{children:[c.jsx(iu,{children:c.jsxs(Ws,{children:[c.jsx(gn,{className:"hidden sm:table-cell",children:"Nmero"}),c.jsx(gn,{children:"Ttulo"}),c.jsx(gn,{className:"hidden sm:table-cell",children:"Unidade"}),c.jsx(gn,{children:"Status"}),c.jsx(gn,{children:"Prioridade"}),c.jsx(gn,{className:"hidden sm:table-cell",children:"Data Abertura"}),c.jsx(gn,{className:"hidden sm:table-cell text-right",children:"Aes"})]})}),c.jsx(su,{children:ye==null?void 0:ye.map(Xe=>{var ct,Me;return c.jsxs(Ws,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>Y(Xe),children:[c.jsx(tn,{className:"hidden font-mono text-sm sm:table-cell",children:Xe.numero}),c.jsx(tn,{className:"font-medium",children:Xe.titulo}),c.jsx(tn,{className:"hidden sm:table-cell",children:((ct=Xe.unidade)==null?void 0:ct.nome)||"-"}),c.jsx(tn,{children:c.jsx(Oi,{variant:"outline",className:Qe(Xe.status),children:(Me=Xe.status)==null?void 0:Me.replace("_"," ")})}),c.jsx(tn,{children:c.jsx(Oi,{variant:"outline",className:gt(Xe.prioridade),children:Xe.prioridade})}),c.jsx(tn,{className:"hidden sm:table-cell",children:Ii(new Date(Xe.data_abertura),"dd/MM/yyyy HH:mm",{locale:ia})}),c.jsx(tn,{className:"hidden sm:table-cell text-right",children:c.jsx(Nt,{variant:"ghost",size:"icon",onClick:mt=>{mt.stopPropagation(),Y(Xe)},children:c.jsx(f_,{className:"h-4 w-4"})})})]},Xe.id)})})]})}),M&&c.jsx(zde,{open:M,onOpenChange:Xe=>{R(Xe),Xe||F(null)},chamado:H,onSuccess:()=>{R(!1),F(null),le()}}),U&&c.jsx(Ffe,{chamado:U,open:!!U,onOpenChange:Xe=>!Xe&&Y(null),onEdit:Ee,onDelete:qe})]})})}var FN="rovingFocusGroup.onEntryFocus",zfe={bubbles:!1,cancelable:!0},Yb="RovingFocusGroup",[KP,Dq,Bfe]=tR(Yb),[Ufe,Rq]=xh(Yb,[Bfe]),[Vfe,$fe]=Ufe(Yb),Mq=V.forwardRef((e,t)=>c.jsx(KP.Provider,{scope:e.__scopeRovingFocusGroup,children:c.jsx(KP.Slot,{scope:e.__scopeRovingFocusGroup,children:c.jsx(qfe,{...e,ref:t})})}));Mq.displayName=Yb;var qfe=V.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,orientation:s,loop:u=!1,dir:f,currentTabStopId:m,defaultCurrentTabStopId:i,onCurrentTabStopIdChange:S,onEntryFocus:E,preventScrollOnEntryFocus:I=!1,...D}=e,M=V.useRef(null),R=da(t,M),H=qR(f),[F,U]=lm({prop:m,defaultProp:i??null,onChange:S,caller:Yb}),[Y,z]=V.useState(!1),J=Cu(E),ne=Dq(r),me=V.useRef(!1),[le,ye]=V.useState(0);return V.useEffect(()=>{const pe=M.current;if(pe)return pe.addEventListener(FN,J),()=>pe.removeEventListener(FN,J)},[J]),c.jsx(Vfe,{scope:r,orientation:s,dir:H,loop:u,currentTabStopId:F,onItemFocus:V.useCallback(pe=>U(pe),[U]),onItemShiftTab:V.useCallback(()=>z(!0),[]),onFocusableItemAdd:V.useCallback(()=>ye(pe=>pe+1),[]),onFocusableItemRemove:V.useCallback(()=>ye(pe=>pe-1),[]),children:c.jsx(es.div,{tabIndex:Y||le===0?-1:0,"data-orientation":s,...D,ref:R,style:{outline:"none",...e.style},onMouseDown:xi(e.onMouseDown,()=>{me.current=!0}),onFocus:xi(e.onFocus,pe=>{const be=!me.current;if(pe.target===pe.currentTarget&&be&&!Y){const ke=new CustomEvent(FN,zfe);if(pe.currentTarget.dispatchEvent(ke),!ke.defaultPrevented){const Oe=ne().filter(Xe=>Xe.focusable),Ee=Oe.find(Xe=>Xe.active),qe=Oe.find(Xe=>Xe.id===F),gt=[Ee,qe,...Oe].filter(Boolean).map(Xe=>Xe.ref.current);Lq(gt,I)}}me.current=!1}),onBlur:xi(e.onBlur,()=>z(!1))})})}),Oq="RovingFocusGroupItem",Fq=V.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,focusable:s=!0,active:u=!1,tabStopId:f,children:m,...i}=e,S=lf(),E=f||S,I=$fe(Oq,r),D=I.currentTabStopId===E,M=Dq(r),{onFocusableItemAdd:R,onFocusableItemRemove:H,currentTabStopId:F}=I;return V.useEffect(()=>{if(s)return R(),()=>H()},[s,R,H]),c.jsx(KP.ItemSlot,{scope:r,id:E,focusable:s,active:u,children:c.jsx(es.span,{tabIndex:D?0:-1,"data-orientation":I.orientation,...i,ref:t,onMouseDown:xi(e.onMouseDown,U=>{s?I.onItemFocus(E):U.preventDefault()}),onFocus:xi(e.onFocus,()=>I.onItemFocus(E)),onKeyDown:xi(e.onKeyDown,U=>{if(U.key==="Tab"&&U.shiftKey){I.onItemShiftTab();return}if(U.target!==U.currentTarget)return;const Y=Hfe(U,I.orientation,I.dir);if(Y!==void 0){if(U.metaKey||U.ctrlKey||U.altKey||U.shiftKey)return;U.preventDefault();let J=M().filter(ne=>ne.focusable).map(ne=>ne.ref.current);if(Y==="last")J.reverse();else if(Y==="prev"||Y==="next"){Y==="prev"&&J.reverse();const ne=J.indexOf(U.currentTarget);J=I.loop?Zfe(J,ne+1):J.slice(ne+1)}setTimeout(()=>Lq(J))}}),children:typeof m=="function"?m({isCurrentTabStop:D,hasTabStop:F!=null}):m})})});Fq.displayName=Oq;var Gfe={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Wfe(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function Hfe(e,t,r){const s=Wfe(e.key,r);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(s))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(s)))return Gfe[s]}function Lq(e,t=!1){const r=document.activeElement;for(const s of e)if(s===r||(s.focus({preventScroll:t}),document.activeElement!==r))return}function Zfe(e,t){return e.map((r,s)=>e[(t+s)%e.length])}var Xfe=Mq,Yfe=Fq,xA="Tabs",[Kfe,D2e]=xh(xA,[Rq]),zq=Rq(),[Jfe,iM]=Kfe(xA),Bq=V.forwardRef((e,t)=>{const{__scopeTabs:r,value:s,onValueChange:u,defaultValue:f,orientation:m="horizontal",dir:i,activationMode:S="automatic",...E}=e,I=qR(i),[D,M]=lm({prop:s,onChange:u,defaultProp:f??"",caller:xA});return c.jsx(Jfe,{scope:r,baseId:lf(),value:D,onValueChange:M,orientation:m,dir:I,activationMode:S,children:c.jsx(es.div,{dir:I,"data-orientation":m,...E,ref:t})})});Bq.displayName=xA;var Uq="TabsList",Vq=V.forwardRef((e,t)=>{const{__scopeTabs:r,loop:s=!0,...u}=e,f=iM(Uq,r),m=zq(r);return c.jsx(Xfe,{asChild:!0,...m,orientation:f.orientation,dir:f.dir,loop:s,children:c.jsx(es.div,{role:"tablist","aria-orientation":f.orientation,...u,ref:t})})});Vq.displayName=Uq;var $q="TabsTrigger",qq=V.forwardRef((e,t)=>{const{__scopeTabs:r,value:s,disabled:u=!1,...f}=e,m=iM($q,r),i=zq(r),S=Hq(m.baseId,s),E=Zq(m.baseId,s),I=s===m.value;return c.jsx(Yfe,{asChild:!0,...i,focusable:!u,active:I,children:c.jsx(es.button,{type:"button",role:"tab","aria-selected":I,"aria-controls":E,"data-state":I?"active":"inactive","data-disabled":u?"":void 0,disabled:u,id:S,...f,ref:t,onMouseDown:xi(e.onMouseDown,D=>{!u&&D.button===0&&D.ctrlKey===!1?m.onValueChange(s):D.preventDefault()}),onKeyDown:xi(e.onKeyDown,D=>{[" ","Enter"].includes(D.key)&&m.onValueChange(s)}),onFocus:xi(e.onFocus,()=>{const D=m.activationMode!=="manual";!I&&!u&&D&&m.onValueChange(s)})})})});qq.displayName=$q;var Gq="TabsContent",Wq=V.forwardRef((e,t)=>{const{__scopeTabs:r,value:s,forceMount:u,children:f,...m}=e,i=iM(Gq,r),S=Hq(i.baseId,s),E=Zq(i.baseId,s),I=s===i.value,D=V.useRef(I);return V.useEffect(()=>{const M=requestAnimationFrame(()=>D.current=!1);return()=>cancelAnimationFrame(M)},[]),c.jsx(bm,{present:u||I,children:({present:M})=>c.jsx(es.div,{"data-state":I?"active":"inactive","data-orientation":i.orientation,role:"tabpanel","aria-labelledby":S,hidden:!M,id:E,tabIndex:0,...m,ref:t,style:{...e.style,animationDuration:D.current?"0s":void 0},children:M&&f})})});Wq.displayName=Gq;function Hq(e,t){return`${e}-trigger-${t}`}function Zq(e,t){return`${e}-content-${t}`}var Qfe=Bq,Xq=Vq,Yq=qq,Kq=Wq;const sM=Qfe,vA=V.forwardRef(({className:e,...t},r)=>c.jsx(Xq,{ref:r,className:sn("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));vA.displayName=Xq.displayName;const nf=V.forwardRef(({className:e,...t},r)=>c.jsx(Yq,{ref:r,className:sn("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",e),...t}));nf.displayName=Yq.displayName;const sf=V.forwardRef(({className:e,...t},r)=>c.jsx(Kq,{ref:r,className:sn("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));sf.displayName=Kq.displayName;const epe=({clienteId:e,onClose:t,onSuccess:r})=>{const[s,u]=V.useState(!1),f={razao_social:"",nome_fantasia:"",cnpj:"",contato_nome:"",contato_email:"",contato_telefone:""},[m,i]=V.useState(f);V.useEffect(()=>{if(!e){i(f);return}(async()=>{u(!0);const{data:I,error:D}=await tt.from("clientes").select("razao_social, nome_fantasia, cnpj, contato_nome, contato_email, contato_telefone").eq("id",e).single();D?bn({title:"Erro",description:"No foi possvel carregar os dados do cliente",variant:"destructive"}):I&&i({razao_social:I.razao_social??"",nome_fantasia:I.nome_fantasia??"",cnpj:I.cnpj??"",contato_nome:I.contato_nome??"",contato_email:I.contato_email??"",contato_telefone:I.contato_telefone??""}),u(!1)})()},[e]);const S=async E=>{E.preventDefault(),u(!0);try{const I=m.razao_social.trim(),D=m.nome_fantasia.trim()||I,M={...m,razao_social:I,nome_fantasia:D,cnpj:m.cnpj.trim(),contato_nome:m.contato_nome.trim(),contato_email:m.contato_email.trim(),contato_telefone:m.contato_telefone.trim()};if(e){const R={...M},{error:H}=await tt.from("clientes").update(R).eq("id",e);if(H)throw H;bn({title:"Cliente atualizado",description:"Cliente atualizado com sucesso"})}else{const R={...M},{error:H}=await tt.from("clientes").insert([R]);if(H)throw H;bn({title:"Cliente criado",description:"Cliente criado com sucesso"})}r()}catch(I){bn({title:"Erro",description:I.message,variant:"destructive"})}finally{u(!1)}};return c.jsx(Bs,{open:!0,onOpenChange:t,children:c.jsxs(Is,{className:"max-w-2xl w-full",children:[c.jsxs(Ns,{children:[c.jsx(ks,{children:e?"Editar Cliente":"Novo Cliente"}),c.jsx(La,{children:"Preencha os dados do cliente"})]}),c.jsxs("form",{onSubmit:S,className:"space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"razao_social",children:"Razao Social *"}),c.jsx(xr,{id:"razao_social",value:m.razao_social,onChange:E=>i({...m,razao_social:E.target.value}),required:!0})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"nome_fantasia",children:"Nome Fantasia *"}),c.jsx(xr,{id:"nome_fantasia",value:m.nome_fantasia,onChange:E=>i({...m,nome_fantasia:E.target.value}),required:!0})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"cnpj",children:"CNPJ *"}),c.jsx(xr,{id:"cnpj",value:m.cnpj,onChange:E=>i({...m,cnpj:E.target.value}),placeholder:"00.000.000/0000-00",required:!0})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"contato_nome",children:"Nome do Contato"}),c.jsx(xr,{id:"contato_nome",value:m.contato_nome,onChange:E=>i({...m,contato_nome:E.target.value})})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"contato_email",children:"Email do Contato"}),c.jsx(xr,{id:"contato_email",type:"email",value:m.contato_email,onChange:E=>i({...m,contato_email:E.target.value})})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"contato_telefone",children:"Telefone do Contato"}),c.jsx(xr,{id:"contato_telefone",value:m.contato_telefone,onChange:E=>i({...m,contato_telefone:E.target.value}),placeholder:"(00) 00000-0000"})]})]}),c.jsxs("div",{className:"flex justify-end gap-2",children:[c.jsx(Nt,{type:"button",variant:"outline",onClick:t,children:"Cancelar"}),c.jsxs(Nt,{type:"submit",disabled:s,children:[s&&c.jsx(bf,{className:"mr-2 h-4 w-4 animate-spin"}),e?"Atualizar":"Criar"]})]})]})]})})},tpe=({contratoId:e,clienteId:t,onClose:r,onSuccess:s})=>{const[u,f]=V.useState(!1),[m,i]=V.useState([]),S={cliente_id:t||"",negocio:"",data_inicio:"",data_fim:"",conq_perd:new Date().getFullYear().toString()},[E,I]=V.useState(S);V.useEffect(()=>{D()},[]),V.useEffect(()=>{if(!e){I(H=>({...S,cliente_id:t||""}));return}(async()=>{var U,Y,z;f(!0);const{data:H,error:F}=await tt.from("contratos").select("cliente_id, negocio, data_inicio, data_fim, conq_perd").eq("id",e).single();F?bn({title:"Erro",description:"No foi possvel carregar os dados do contrato",variant:"destructive"}):H&&I({cliente_id:((Y=(U=H.cliente_id)==null?void 0:U.toString)==null?void 0:Y.call(U))??"",negocio:H.negocio??"",data_inicio:H.data_inicio??"",data_fim:H.data_fim??"",conq_perd:((z=H.conq_perd)==null?void 0:z.toString())??new Date().getFullYear().toString()}),f(!1)})()},[e,t]);const D=async()=>{const{data:R}=await tt.from("clientes").select("id, razao_social, nome_fantasia").order("razao_social"),H=(R||[]).map(F=>{var U,Y;return{...F,id:((Y=(U=F.id)==null?void 0:U.toString)==null?void 0:Y.call(U))??""}});i(H)},M=async R=>{R.preventDefault(),f(!0);try{if(!E.cliente_id){bn({title:"Cliente obrigatrio",description:"Selecione o cliente responsvel pelo contrato.",variant:"destructive"});return}if(!E.negocio.trim()){bn({title:"Nome do negcio obrigatrio",description:"Informe um identificador para o contrato.",variant:"destructive"});return}const H=parseInt(E.conq_perd,10);if(Number.isNaN(H)){bn({title:"Ano invlido",description:"Informe um ano vlido para Conq/Perd.",variant:"destructive"});return}const F=Number(E.cliente_id);if(!Number.isFinite(F)){bn({title:"Cliente invlido",description:"No foi possvel identificar o cliente selecionado.",variant:"destructive"});return}const U={cliente_id:F,negocio:E.negocio.trim(),data_inicio:E.data_inicio,data_fim:E.data_fim||null,conq_perd:H};if(e){const{error:Y}=await tt.from("contratos").update(U).eq("id",e);if(Y)throw Y;bn({title:"Contrato atualizado",description:"Contrato atualizado com sucesso"})}else{const{error:Y}=await tt.from("contratos").insert([U]);if(Y)throw Y;bn({title:"Contrato criado",description:"Contrato criado com sucesso"})}s()}catch(H){bn({title:"Erro",description:H.message,variant:"destructive"})}finally{f(!1)}};return c.jsx(Bs,{open:!0,onOpenChange:r,children:c.jsxs(Is,{className:"max-w-2xl w-full",children:[c.jsxs(Ns,{children:[c.jsx(ks,{children:e?"Editar Contrato":"Novo Contrato"}),c.jsx(La,{children:"Preencha os dados do contrato"})]}),c.jsxs("form",{onSubmit:M,className:"space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[c.jsxs("div",{className:"space-y-2 sm:col-span-2",children:[c.jsx(Dt,{htmlFor:"cliente_id",children:"Cliente *"}),c.jsxs(Lr,{value:E.cliente_id,onValueChange:R=>I({...E,cliente_id:R}),disabled:!!t,children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione um cliente"})}),c.jsx(Fr,{children:m.map(R=>c.jsx(yt,{value:R.id,children:R.nome_fantasia||R.razao_social||R.id},R.id))})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"negocio",children:"Nome do negcio *"}),c.jsx(xr,{id:"negocio",value:E.negocio,onChange:R=>I({...E,negocio:R.target.value}),required:!0})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"data_inicio",children:"Data Incio *"}),c.jsx(xr,{id:"data_inicio",type:"date",value:E.data_inicio,onChange:R=>I({...E,data_inicio:R.target.value}),required:!0})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"data_fim",children:"Data Fim"}),c.jsx(xr,{id:"data_fim",type:"date",value:E.data_fim,onChange:R=>I({...E,data_fim:R.target.value})})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"conq_perd",children:"Ano Conq/Perd *"}),c.jsx(xr,{id:"conq_perd",type:"number",min:"1900",max:"2100",value:E.conq_perd,onChange:R=>I({...E,conq_perd:R.target.value}),required:!0})]})]}),c.jsxs("div",{className:"flex justify-end gap-2",children:[c.jsx(Nt,{type:"button",variant:"outline",onClick:r,children:"Cancelar"}),c.jsxs(Nt,{type:"submit",disabled:u,children:[u&&c.jsx(bf,{className:"mr-2 h-4 w-4 animate-spin"}),e?"Atualizar":"Criar"]})]})]})]})})},rpe=({unidadeId:e,contratoId:t,onClose:r,onSuccess:s})=>{const[u,f]=V.useState(!1),[m,i]=V.useState([]),[S,E]=V.useState({contrato_id:t||"",nome:"",endereco:"",cidade:"",uf:"",cep:"",latitude:"",longitude:"",created_at:"",faturamento_vendido:""}),[I,D]=V.useState(!1);V.useEffect(()=>{M(),e&&R()},[e]);const M=async()=>{const{data:U}=await tt.from("contratos").select("id, negocio, conq_perd").order("negocio");i(U||[])},R=async()=>{if(!e)return;const{data:U,error:Y}=await tt.from("unidades").select("*").eq("id",e).single();if(Y){bn({title:"Erro ao carregar unidade",description:Y.message,variant:"destructive"});return}U&&E({contrato_id:U.contrato_id||"",nome:U.nome,endereco:U.endereco||"",cidade:U.cidade||"",uf:U.uf||"",cep:U.cep||"",latitude:U.latitude?String(U.latitude):"",longitude:U.longitude?String(U.longitude):"",created_at:U.created_at||"",faturamento_vendido:U.faturamento_vendido!==void 0&&U.faturamento_vendido!==null?String(U.faturamento_vendido):""})},H=async U=>{if(U.preventDefault(),!S.contrato_id){bn({title:"Contrato obrigatrio",description:"Selecione um contrato para vincular a unidade.",variant:"destructive"});return}const Y=S.nome.trim(),z=S.endereco.trim(),J=S.cidade.trim(),ne=S.uf.trim().toUpperCase();if(!Y||!z||!J||ne.length!==2){bn({title:"Preencha todos os campos obrigatrios",description:"Nome, endereo, cidade e UF precisam ser informados.",variant:"destructive"});return}if(!S.latitude||!S.longitude){bn({title:"Coordenadas obrigatrias",description:"Informe latitude e longitude vlidas para a unidade.",variant:"destructive"});return}if(!S.faturamento_vendido){bn({title:"Faturamento obrigatrio",description:"Informe o faturamento vendido da unidade.",variant:"destructive"});return}const me=parseFloat(S.latitude),le=parseFloat(S.longitude),ye=parseFloat(S.faturamento_vendido);if(Number.isNaN(me)||Number.isNaN(le)){bn({title:"Coordenadas invlidas",description:"Latitude e longitude devem ser nmeros vlidos.",variant:"destructive"});return}if(Number.isNaN(ye)){bn({title:"Valor invlido",description:"O faturamento vendido deve ser um nmero vlido.",variant:"destructive"});return}f(!0);try{const pe=new Date().toISOString(),be={contrato_id:S.contrato_id,nome:Y,endereco:z,cidade:J,uf:ne,cep:S.cep||null,latitude:me,longitude:le,faturamento_vendido:ye,created_at:e&&S.created_at||pe,updated_at:pe};if(e){const{error:ke}=await tt.from("unidades").update(be).eq("id",e);if(ke)throw ke;bn({title:"Unidade atualizada",description:"Unidade atualizada com sucesso"})}else{const{error:ke}=await tt.from("unidades").insert([be]);if(ke)throw ke;bn({title:"Unidade criada",description:"Unidade criada com sucesso"})}s()}catch(pe){bn({title:"Erro",description:pe.message,variant:"destructive"})}finally{f(!1)}},F=async U=>{E(z=>({...z,cep:U}));const Y=U.replace(/\D/g,"");if(Y.length===8)try{D(!0);const z=await fetch(`https://viacep.com.br/ws/${Y}/json/`);if(!z.ok)return;const J=await z.json();if(J.erro){bn({title:"CEP no encontrado",description:"Verifique o CEP informado e tente novamente.",variant:"destructive"});return}E(ne=>({...ne,endereco:J.logradouro||ne.endereco,cidade:J.localidade||ne.cidade,uf:(J.uf||ne.uf||"").toUpperCase(),cep:U}))}catch(z){console.error("Erro ao buscar CEP",z),bn({title:"Erro ao buscar CEP",description:"No foi possvel obter o endereo automaticamente.",variant:"destructive"})}finally{D(!1)}};return c.jsx(Bs,{open:!0,onOpenChange:r,children:c.jsxs(Is,{className:"max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[c.jsxs(Ns,{children:[c.jsx(ks,{children:e?"Editar Unidade":"Nova Unidade"}),c.jsx(La,{children:"Preencha os dados da unidade"})]}),c.jsxs("form",{onSubmit:H,className:"space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[c.jsxs("div",{className:"space-y-2 sm:col-span-2",children:[c.jsx(Dt,{htmlFor:"contrato_id",children:"Contrato *"}),c.jsxs(Lr,{value:S.contrato_id,onValueChange:U=>E({...S,contrato_id:U}),disabled:!!t,children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione um contrato"})}),c.jsx(Fr,{children:m.map(U=>c.jsxs(yt,{value:U.id,children:[U.negocio," (",U.conq_perd,")"]},U.id))})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"nome",children:"Nome *"}),c.jsx(xr,{id:"nome",value:S.nome,onChange:U=>E({...S,nome:U.target.value}),required:!0})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"faturamento_vendido",children:"Faturamento vendido (R$)"}),c.jsx(xr,{id:"faturamento_vendido",type:"number",step:"0.01",value:S.faturamento_vendido,onChange:U=>E({...S,faturamento_vendido:U.target.value}),required:!0})]}),c.jsxs("div",{className:"space-y-2 sm:col-span-2",children:[c.jsx(Dt,{htmlFor:"endereco",children:"Endereo"}),c.jsx(xr,{id:"endereco",value:S.endereco,onChange:U=>E({...S,endereco:U.target.value}),required:!0})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"cidade",children:"Cidade"}),c.jsx(xr,{id:"cidade",value:S.cidade,onChange:U=>E({...S,cidade:U.target.value}),required:!0})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"uf",children:"UF"}),c.jsx(xr,{id:"uf",value:S.uf,onChange:U=>E({...S,uf:U.target.value.toUpperCase()}),maxLength:2,placeholder:"SP",required:!0})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"cep",children:"CEP"}),c.jsx(xr,{id:"cep",value:S.cep,onChange:U=>F(U.target.value),placeholder:"00000-000",disabled:I}),I&&c.jsx("p",{className:"text-xs text-muted-foreground",children:"Buscando endereo..."})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"latitude",children:"Latitude"}),c.jsx(xr,{id:"latitude",type:"number",step:"any",value:S.latitude,onChange:U=>E({...S,latitude:U.target.value}),placeholder:"-15.7801",required:!0})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"longitude",children:"Longitude"}),c.jsx(xr,{id:"longitude",type:"number",step:"any",value:S.longitude,onChange:U=>E({...S,longitude:U.target.value}),placeholder:"-47.9292",required:!0})]})]}),c.jsxs("div",{className:"flex justify-end gap-2",children:[c.jsx(Nt,{type:"button",variant:"outline",onClick:r,children:"Cancelar"}),c.jsxs(Nt,{type:"submit",disabled:u,children:[u&&c.jsx(bf,{className:"mr-2 h-4 w-4 animate-spin"}),e?"Atualizar":"Criar"]})]})]})]})})};var yA="Checkbox",[npe,R2e]=xh(yA),[ipe,aM]=npe(yA);function spe(e){const{__scopeCheckbox:t,checked:r,children:s,defaultChecked:u,disabled:f,form:m,name:i,onCheckedChange:S,required:E,value:I="on",internal_do_not_use_render:D}=e,[M,R]=lm({prop:r,defaultProp:u??!1,onChange:S,caller:yA}),[H,F]=V.useState(null),[U,Y]=V.useState(null),z=V.useRef(!1),J=H?!!m||!!H.closest("form"):!0,ne={checked:M,disabled:f,setChecked:R,control:H,setControl:F,name:i,form:m,value:I,hasConsumerStoppedPropagationRef:z,required:E,defaultChecked:sm(u)?!1:u,isFormControl:J,bubbleInput:U,setBubbleInput:Y};return c.jsx(ipe,{scope:t,...ne,children:ape(D)?D(ne):s})}var Jq="CheckboxTrigger",Qq=V.forwardRef(({__scopeCheckbox:e,onKeyDown:t,onClick:r,...s},u)=>{const{control:f,value:m,disabled:i,checked:S,required:E,setControl:I,setChecked:D,hasConsumerStoppedPropagationRef:M,isFormControl:R,bubbleInput:H}=aM(Jq,e),F=da(u,I),U=V.useRef(S);return V.useEffect(()=>{const Y=f==null?void 0:f.form;if(Y){const z=()=>D(U.current);return Y.addEventListener("reset",z),()=>Y.removeEventListener("reset",z)}},[f,D]),c.jsx(es.button,{type:"button",role:"checkbox","aria-checked":sm(S)?"mixed":S,"aria-required":E,"data-state":iG(S),"data-disabled":i?"":void 0,disabled:i,value:m,...s,ref:F,onKeyDown:xi(t,Y=>{Y.key==="Enter"&&Y.preventDefault()}),onClick:xi(r,Y=>{D(z=>sm(z)?!0:!z),H&&R&&(M.current=Y.isPropagationStopped(),M.current||Y.stopPropagation())})})});Qq.displayName=Jq;var oM=V.forwardRef((e,t)=>{const{__scopeCheckbox:r,name:s,checked:u,defaultChecked:f,required:m,disabled:i,value:S,onCheckedChange:E,form:I,...D}=e;return c.jsx(spe,{__scopeCheckbox:r,checked:u,defaultChecked:f,disabled:i,required:m,onCheckedChange:E,name:s,form:I,value:S,internal_do_not_use_render:({isFormControl:M})=>c.jsxs(c.Fragment,{children:[c.jsx(Qq,{...D,ref:t,__scopeCheckbox:r}),M&&c.jsx(nG,{__scopeCheckbox:r})]})})});oM.displayName=yA;var eG="CheckboxIndicator",tG=V.forwardRef((e,t)=>{const{__scopeCheckbox:r,forceMount:s,...u}=e,f=aM(eG,r);return c.jsx(bm,{present:s||sm(f.checked)||f.checked===!0,children:c.jsx(es.span,{"data-state":iG(f.checked),"data-disabled":f.disabled?"":void 0,...u,ref:t,style:{pointerEvents:"none",...e.style}})})});tG.displayName=eG;var rG="CheckboxBubbleInput",nG=V.forwardRef(({__scopeCheckbox:e,...t},r)=>{const{control:s,hasConsumerStoppedPropagationRef:u,checked:f,defaultChecked:m,required:i,disabled:S,name:E,value:I,form:D,bubbleInput:M,setBubbleInput:R}=aM(rG,e),H=da(r,R),F=w7(f),U=I8(s);V.useEffect(()=>{const z=M;if(!z)return;const J=window.HTMLInputElement.prototype,me=Object.getOwnPropertyDescriptor(J,"checked").set,le=!u.current;if(F!==f&&me){const ye=new Event("click",{bubbles:le});z.indeterminate=sm(f),me.call(z,sm(f)?!1:f),z.dispatchEvent(ye)}},[M,F,f,u]);const Y=V.useRef(sm(f)?!1:f);return c.jsx(es.input,{type:"checkbox","aria-hidden":!0,defaultChecked:m??Y.current,required:i,disabled:S,name:E,value:I,form:D,...t,tabIndex:-1,ref:H,style:{...t.style,...U,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});nG.displayName=rG;function ape(e){return typeof e=="function"}function sm(e){return e==="indeterminate"}function iG(e){return sm(e)?"indeterminate":e?"checked":"unchecked"}const sG=V.forwardRef(({className:e,...t},r)=>c.jsx(oM,{ref:r,className:sn("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...t,children:c.jsx(tG,{className:sn("flex items-center justify-center text-current"),children:c.jsx(e8,{className:"h-4 w-4"})})}));sG.displayName=oM.displayName;const ope=[{value:0,label:"Domingo"},{value:1,label:"Segunda-feira"},{value:2,label:"Tera-feira"},{value:3,label:"Quarta-feira"},{value:4,label:"Quinta-feira"},{value:5,label:"Sexta-feira"},{value:6,label:"Sbado"}],dC=[{value:"vago",label:"Vago"},{value:"ocupado",label:"Ocupado"},{value:"vago_temporariamente",label:"Vago temporariamente"},{value:"ocupado_temporariamente",label:"Ocupado temporariamente"},{value:"presenca_confirmada",label:"Presenca confirmada"},{value:"inativo",label:"Inativo (encerrado)"}],LN=new Set(["5x2","6x1"]),lpe=e=>{var t;return((t=dC.find(r=>r.value===e))==null?void 0:t.value)??dC[0].value},cpe=({postoId:e,unidadeId:t,onClose:r,onSuccess:s})=>{const[u,f]=V.useState(!1),[m,i]=V.useState([]),S={unidade_id:t||"",nome:"",funcao:"",valor_diaria:"",escala:"",dias_semana:[],jornada:"",horario_inicio:"",horario_fim:"",intervalo_refeicao:"",status:dC[0].value,observacoes:"",beneficios:[],primeiro_dia_atividade:"",ultimo_dia_atividade:""},[E,I]=V.useState(S);V.useEffect(()=>{D()},[]),V.useEffect(()=>{I(H=>!LN.has(H.escala)&&H.dias_semana.length>0?{...H,dias_semana:[]}:H)},[E.escala]),V.useEffect(()=>{if(!e){I({...S,unidade_id:t||""});return}(async()=>{var Y,z,J;f(!0);const{data:F,error:U}=await tt.from("postos_servico").select("unidade_id, nome, funcao, valor_diaria, escala, dias_semana, jornada, horario_inicio, horario_fim, intervalo_refeicao, status, observacoes, beneficios, primeiro_dia_atividade, ultimo_dia_atividade").eq("id",e).single();U?bn({title:"Erro",description:"No foi possvel carregar os dados do posto",variant:"destructive"}):F&&I({unidade_id:F.unidade_id??"",nome:F.nome??"",funcao:F.funcao??"",valor_diaria:((Y=F.valor_diaria)==null?void 0:Y.toString())??"",escala:F.escala??"",dias_semana:Array.isArray(F.dias_semana)?F.dias_semana.map(ne=>Number(ne)):[],jornada:((z=F.jornada)==null?void 0:z.toString())??"",horario_inicio:F.horario_inicio??"",horario_fim:F.horario_fim??"",intervalo_refeicao:((J=F.intervalo_refeicao)==null?void 0:J.toString())??"",status:lpe(F.status),observacoes:F.observacoes??"",beneficios:Array.isArray(F.beneficios)?F.beneficios.filter(ne=>typeof ne=="string"):[],primeiro_dia_atividade:F.primeiro_dia_atividade??"",ultimo_dia_atividade:F.ultimo_dia_atividade??""}),f(!1)})()},[e,t]);const D=async()=>{const{data:H}=await tt.from("unidades").select("id, nome").order("nome");i(H||[])},M=async H=>{H.preventDefault(),f(!0);try{const{unidade_id:F,nome:U,funcao:Y,valor_diaria:z,escala:J,dias_semana:ne,jornada:me,horario_inicio:le,horario_fim:ye,intervalo_refeicao:pe,status:be,observacoes:ke,beneficios:Oe,primeiro_dia_atividade:Ee,ultimo_dia_atividade:qe}=E;if(LN.has(J)&&ne.length===0){bn({title:"Dias obrigatorios",description:"Selecione ao menos um dia da semana para as escalas 5x2 ou 6x1.",variant:"destructive"}),f(!1);return}const Qe=Oe.map(Xe=>Xe.trim()).filter(Xe=>Xe.length>0),gt={unidade_id:F,nome:U,funcao:Y,valor_diaria:z?parseFloat(z):0,escala:J,dias_semana:ne.length?ne:null,jornada:me?parseInt(me):null,horario_inicio:le,horario_fim:ye,intervalo_refeicao:pe?parseInt(pe):null,status:be,observacoes:ke||null,beneficios:Qe.length?Qe:null,primeiro_dia_atividade:Ee||null,ultimo_dia_atividade:qe||null};if(e){const{error:Xe}=await tt.from("postos_servico").update(gt).eq("id",e);if(Xe)throw Xe;bn({title:"Posto atualizado",description:"Posto atualizado com sucesso"})}else{const{error:Xe}=await tt.from("postos_servico").insert([gt]);if(Xe)throw Xe;bn({title:"Posto criado",description:"Posto criado com sucesso"})}s()}catch(F){const U=typeof(F==null?void 0:F.message)=="string"?F.message:"No foi possvel salvar o posto. Tente novamente.",Y=U.includes("ON CONFLICT DO UPDATE not supported")?"O posto foi salvo, mas houve uma tentativa duplicada de sincronizar dias vagos. Recarregue a pgina ou tente novamente.":U;bn({title:"Erro",description:Y,variant:"destructive"})}finally{f(!1)}},R=LN.has(E.escala);return c.jsx(Bs,{open:!0,onOpenChange:r,children:c.jsxs(Is,{className:"max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[c.jsxs(Ns,{children:[c.jsx(ks,{children:e?"Editar Posto":"Novo Posto"}),c.jsx(La,{children:"Preencha os dados do posto de servio"})]}),c.jsxs("form",{onSubmit:M,className:"space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[c.jsxs("div",{className:"space-y-2 sm:col-span-2",children:[c.jsx(Dt,{htmlFor:"unidade_id",children:"Unidade *"}),c.jsxs(Lr,{value:E.unidade_id,onValueChange:H=>I({...E,unidade_id:H}),disabled:!!t,children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione"})}),c.jsx(Fr,{children:m.map(H=>c.jsx(yt,{value:H.id,children:H.nome},H.id))})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"nome",children:"Nome *"}),c.jsx(xr,{id:"nome",value:E.nome,onChange:H=>I({...E,nome:H.target.value}),required:!0})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"funcao",children:"Funo"}),c.jsx(xr,{id:"funcao",value:E.funcao,onChange:H=>I({...E,funcao:H.target.value})})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"escala",children:"Escala"}),c.jsxs(Lr,{value:E.escala,onValueChange:H=>I({...E,escala:H}),children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione a escala"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"5x1",children:"5x1"}),c.jsx(yt,{value:"5x2",children:"5x2"}),c.jsx(yt,{value:"4x2",children:"4x2"}),c.jsx(yt,{value:"6x1",children:"6x1"}),c.jsx(yt,{value:"12x36",children:"12x36"}),c.jsx(yt,{value:"18x36",children:"18x36"}),c.jsx(yt,{value:"24x48",children:"24x48"})]})]})]}),R&&c.jsxs("div",{className:"space-y-2 sm:col-span-2",children:[c.jsx(Dt,{children:"Dias da semana"}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Para as escalas 5x2 ou 6x1, selecione pelo menos um dia."}),c.jsx("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-3",children:ope.map(H=>c.jsxs("label",{className:"flex items-center space-x-2 rounded-md border border-border p-2 text-sm font-medium",children:[c.jsx(sG,{checked:E.dias_semana.includes(H.value),onCheckedChange:F=>{R&&I(U=>{const Y=F===!0,z=U.dias_semana.filter(ne=>ne!==H.value),J=Y?[...z,H.value]:z;return{...U,dias_semana:J}})}}),c.jsx("span",{children:H.label})]},H.value))})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"valor_diaria",children:"Valor da diria (R$)"}),c.jsx(xr,{id:"valor_diaria",type:"number",min:"0",step:"0.01",value:E.valor_diaria,onChange:H=>I({...E,valor_diaria:H.target.value}),placeholder:"0,00"}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Esse valor ser aplicado automaticamente ao registrar novas dirias para este posto."})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"jornada",children:"Jornada (horas)"}),c.jsx(xr,{id:"jornada",type:"number",min:"0",value:E.jornada,onChange:H=>I({...E,jornada:H.target.value}),placeholder:"Ex: 44"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"horario_inicio",children:"Horrio Incio"}),c.jsx(xr,{id:"horario_inicio",type:"time",value:E.horario_inicio,onChange:H=>I({...E,horario_inicio:H.target.value})})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"horario_fim",children:"Horrio Fim"}),c.jsx(xr,{id:"horario_fim",type:"time",value:E.horario_fim,onChange:H=>I({...E,horario_fim:H.target.value})})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"intervalo_refeicao",children:"Intervalo Refeio (min)"}),c.jsx(xr,{id:"intervalo_refeicao",type:"number",value:E.intervalo_refeicao,onChange:H=>I({...E,intervalo_refeicao:H.target.value}),placeholder:"60"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"primeiro_dia_atividade",children:"Primeiro dia de atividade"}),c.jsx(xr,{id:"primeiro_dia_atividade",type:"date",value:E.primeiro_dia_atividade,onChange:H=>I({...E,primeiro_dia_atividade:H.target.value})})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"ultimo_dia_atividade",children:"ltimo dia de atividade"}),c.jsx(xr,{id:"ultimo_dia_atividade",type:"date",value:E.ultimo_dia_atividade,onChange:H=>I({...E,ultimo_dia_atividade:H.target.value})}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Ao definir essa data, o posto ser encerrado automaticamente e deixar de gerar escala aps o dia informado. Os dias futuros e a alocao corrente sero limpos pelo sistema."})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"status",children:"Status"}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Valores alinhados ao novo ENUM: vago, ocupado, vago temporariamente, ocupado temporariamente, presena confirmada ou inativo (encerrado)."}),c.jsxs(Lr,{value:E.status,onValueChange:H=>I({...E,status:H}),children:[c.jsx(Or,{children:c.jsx(zr,{})}),c.jsx(Fr,{children:dC.map(H=>c.jsx(yt,{value:H.value,children:H.label},H.value))})]})]}),c.jsxs("div",{className:"space-y-2 sm:col-span-2",children:[c.jsx(Dt,{htmlFor:"observacoes",children:"Observaes"}),c.jsx(ec,{id:"observacoes",value:E.observacoes,onChange:H=>I({...E,observacoes:H.target.value}),rows:3})]}),c.jsxs("div",{className:"space-y-2 sm:col-span-2",children:[c.jsx(Dt,{htmlFor:"beneficios",children:"Beneficios"}),c.jsxs("div",{className:"space-y-2",children:[E.beneficios.map((H,F)=>c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(xr,{value:H,onChange:U=>I(Y=>{const z=[...Y.beneficios];return z[F]=U.target.value,{...Y,beneficios:z}}),placeholder:"Descreva o beneficio"}),c.jsx(Nt,{type:"button",variant:"outline",onClick:()=>I(U=>{const Y=U.beneficios.filter((z,J)=>J!==F);return{...U,beneficios:Y}}),children:"Remover"})]},F)),c.jsx(Nt,{type:"button",variant:"secondary",onClick:()=>I(H=>({...H,beneficios:[...H.beneficios,""]})),children:"Adicionar beneficio"})]})]})]}),c.jsxs("div",{className:"flex justify-end gap-2",children:[c.jsx(Nt,{type:"button",variant:"outline",onClick:r,children:"Cancelar"}),c.jsxs(Nt,{type:"submit",disabled:u,children:[u&&c.jsx(bf,{className:"mr-2 h-4 w-4 animate-spin"}),e?"Atualizar":"Criar"]})]})]})]})})};var aG="AlertDialog",[upe,M2e]=xh(aG,[B9]),Ef=B9(),oG=e=>{const{__scopeAlertDialog:t,...r}=e,s=Ef(t);return c.jsx(VR,{...s,...r,modal:!0})};oG.displayName=aG;var dpe="AlertDialogTrigger",lG=V.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...s}=e,u=Ef(r);return c.jsx(r7,{...u,...s,ref:t})});lG.displayName=dpe;var hpe="AlertDialogPortal",cG=e=>{const{__scopeAlertDialog:t,...r}=e,s=Ef(t);return c.jsx($R,{...s,...r})};cG.displayName=hpe;var fpe="AlertDialogOverlay",uG=V.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...s}=e,u=Ef(r);return c.jsx($b,{...u,...s,ref:t})});uG.displayName=fpe;var Kx="AlertDialogContent",[ppe,mpe]=upe(Kx),gpe=CV("AlertDialogContent"),dG=V.forwardRef((e,t)=>{const{__scopeAlertDialog:r,children:s,...u}=e,f=Ef(r),m=V.useRef(null),i=da(t,m),S=V.useRef(null);return c.jsx(Fce,{contentName:Kx,titleName:hG,docsSlug:"alert-dialog",children:c.jsx(ppe,{scope:r,cancelRef:S,children:c.jsxs(qb,{role:"alertdialog",...f,...u,ref:i,onOpenAutoFocus:xi(u.onOpenAutoFocus,E=>{var I;E.preventDefault(),(I=S.current)==null||I.focus({preventScroll:!0})}),onPointerDownOutside:E=>E.preventDefault(),onInteractOutside:E=>E.preventDefault(),children:[c.jsx(gpe,{children:s}),c.jsx(xpe,{contentRef:m})]})})})});dG.displayName=Kx;var hG="AlertDialogTitle",fG=V.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...s}=e,u=Ef(r);return c.jsx(Gb,{...u,...s,ref:t})});fG.displayName=hG;var pG="AlertDialogDescription",mG=V.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...s}=e,u=Ef(r);return c.jsx(Wb,{...u,...s,ref:t})});mG.displayName=pG;var _pe="AlertDialogAction",gG=V.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...s}=e,u=Ef(r);return c.jsx(uA,{...u,...s,ref:t})});gG.displayName=_pe;var _G="AlertDialogCancel",xG=V.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...s}=e,{cancelRef:u}=mpe(_G,r),f=Ef(r),m=da(t,u);return c.jsx(uA,{...f,...s,ref:m})});xG.displayName=_G;var xpe=({contentRef:e})=>{const t=`\`${Kx}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${Kx}\` by passing a \`${pG}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${Kx}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return V.useEffect(()=>{var s;document.getElementById((s=e.current)==null?void 0:s.getAttribute("aria-describedby"))||console.warn(t)},[t,e]),null},vpe=oG,ype=lG,wpe=cG,vG=uG,yG=dG,wG=gG,bG=xG,SG=fG,TG=mG;const Cd=vpe,Kb=ype,bpe=wpe,EG=V.forwardRef(({className:e,...t},r)=>c.jsx(vG,{className:sn("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:r}));EG.displayName=vG.displayName;const ju=V.forwardRef(({className:e,...t},r)=>c.jsxs(bpe,{children:[c.jsx(EG,{}),c.jsx(yG,{ref:r,className:sn("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t})]}));ju.displayName=yG.displayName;const Iu=({className:e,...t})=>c.jsx("div",{className:sn("flex flex-col space-y-2 text-center sm:text-left",e),...t});Iu.displayName="AlertDialogHeader";const Nu=({className:e,...t})=>c.jsx("div",{className:sn("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});Nu.displayName="AlertDialogFooter";const ku=V.forwardRef(({className:e,...t},r)=>c.jsx(SG,{ref:r,className:sn("text-lg font-semibold",e),...t}));ku.displayName=SG.displayName;const Pu=V.forwardRef(({className:e,...t},r)=>c.jsx(TG,{ref:r,className:sn("text-sm text-muted-foreground",e),...t}));Pu.displayName=TG.displayName;const Du=V.forwardRef(({className:e,...t},r)=>c.jsx(wG,{ref:r,className:sn(xb(),e),...t}));Du.displayName=wG.displayName;const gh=V.forwardRef(({className:e,...t},r)=>c.jsx(bG,{ref:r,className:sn(xb({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));gh.displayName=bG.displayName;const Spe=({cliente:e,onSelect:t,onEdit:r,onDelete:s})=>{const u=async()=>{try{const f=Number(e.id)||e.id,{data:m}=await tt.from("contratos").select("id").eq("cliente_id",f).limit(1);if(m&&m.length>0){bn({title:"No  possvel excluir",description:"Este cliente possui contratos relacionados. Exclua os contratos primeiro.",variant:"destructive"});return}const{error:i}=await tt.from("clientes").delete().eq("id",f);if(i)throw i;bn({title:"Cliente excludo",description:"Cliente excludo com sucesso"}),s()}catch(f){bn({title:"Erro",description:f.message,variant:"destructive"})}};return c.jsxs($r,{className:"hover:shadow-lg transition-shadow cursor-pointer",children:[c.jsx(Xn,{onClick:t,children:c.jsxs("div",{className:"flex items-start gap-2",children:[c.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:c.jsx(cm,{className:"h-4 w-4 text-primary"})}),c.jsxs("div",{children:[c.jsx(ti,{className:"text-base",children:e.razao_social}),e.nome_fantasia&&c.jsx("p",{className:"text-xs text-muted-foreground",children:e.nome_fantasia}),c.jsx("p",{className:"text-sm text-muted-foreground",children:e.cnpj})]})]})}),c.jsxs(_n,{children:[c.jsxs("div",{className:"space-y-2",children:[e.contato_nome&&c.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[c.jsx(lb,{className:"h-4 w-4 text-muted-foreground"}),c.jsx("span",{children:e.contato_nome})]}),e.contato_email&&c.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[c.jsx(Zee,{className:"h-4 w-4 text-muted-foreground"}),c.jsx("span",{className:"truncate",children:e.contato_email})]}),e.contato_telefone&&c.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[c.jsx(Kee,{className:"h-4 w-4 text-muted-foreground"}),c.jsx("span",{children:e.contato_telefone})]})]}),c.jsxs("div",{className:"flex gap-2 mt-4",children:[c.jsxs(Nt,{variant:"outline",size:"sm",className:"flex-1",onClick:r,children:[c.jsx(jd,{className:"h-3 w-3 mr-1"}),"Editar"]}),c.jsxs(Cd,{children:[c.jsx(Kb,{asChild:!0,children:c.jsx(Nt,{variant:"outline",size:"sm",onClick:f=>f.stopPropagation(),children:c.jsx(zo,{className:"h-3 w-3"})})}),c.jsxs(ju,{children:[c.jsxs(Iu,{children:[c.jsx(ku,{children:"Confirmar excluso"}),c.jsx(Pu,{children:"Tem certeza que deseja excluir este cliente? Esta ao no pode ser desfeita."})]}),c.jsxs(Nu,{children:[c.jsx(gh,{children:"Cancelar"}),c.jsx(Du,{onClick:u,children:"Excluir"})]})]})]})]})]})]})},Tpe=({contrato:e,cliente:t,onSelect:r,onEdit:s,onDelete:u})=>{const f=async()=>{try{const{data:m}=await tt.from("chamados").select("id").eq("contrato_id",e.id).limit(1),{data:i}=await tt.from("unidades").select("id").eq("contrato_id",e.id).limit(1);if(m&&m.length>0){bn({title:"No  possvel excluir",description:"Este contrato possui chamados relacionados. Exclua os chamados primeiro.",variant:"destructive"});return}if(i&&i.length>0){bn({title:"No  possvel excluir",description:"Este contrato possui unidades relacionadas. Exclua as unidades primeiro.",variant:"destructive"});return}const{error:S}=await tt.from("contratos").delete().eq("id",e.id);if(S)throw S;bn({title:"Contrato excludo",description:"Contrato excludo com sucesso"}),u()}catch(m){bn({title:"Erro",description:m.message,variant:"destructive"})}};return c.jsxs($r,{className:"hover:shadow-lg transition-shadow cursor-pointer",children:[c.jsx(Xn,{onClick:r,children:c.jsxs("div",{className:"flex items-start gap-2",children:[c.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:c.jsx(Sm,{className:"h-4 w-4 text-primary"})}),c.jsxs("div",{children:[c.jsx(ti,{className:"text-base",children:e.negocio}),c.jsxs("p",{className:"text-sm text-muted-foreground",children:["Conq/Perd: ",e.conq_perd]})]})]})}),c.jsxs(_n,{children:[c.jsxs("div",{className:"space-y-2",children:[t&&c.jsxs("p",{className:"text-sm text-muted-foreground",children:["Cliente: ",t.nome_fantasia||t.razao_social]}),c.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[c.jsx(jc,{className:"h-4 w-4 text-muted-foreground"}),c.jsxs("span",{children:[Ii(new Date(e.data_inicio),"dd/MM/yyyy"),e.data_fim&&` - ${Ii(new Date(e.data_fim),"dd/MM/yyyy")}`]})]}),c.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[c.jsx(oR,{className:"h-4 w-4 text-muted-foreground"}),c.jsxs("span",{children:["Ano Conq/Perd: ",e.conq_perd]})]})]}),c.jsxs("div",{className:"flex gap-2 mt-4",children:[c.jsxs(Nt,{variant:"outline",size:"sm",className:"flex-1",onClick:s,children:[c.jsx(jd,{className:"h-3 w-3 mr-1"}),"Editar"]}),c.jsxs(Cd,{children:[c.jsx(Kb,{asChild:!0,children:c.jsx(Nt,{variant:"outline",size:"sm",onClick:m=>m.stopPropagation(),children:c.jsx(zo,{className:"h-3 w-3"})})}),c.jsxs(ju,{children:[c.jsxs(Iu,{children:[c.jsx(ku,{children:"Confirmar excluso"}),c.jsx(Pu,{children:"Tem certeza que deseja excluir este contrato? Esta ao no pode ser desfeita."})]}),c.jsxs(Nu,{children:[c.jsx(gh,{children:"Cancelar"}),c.jsx(Du,{onClick:f,children:"Excluir"})]})]})]})]})]})]})},Epe=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:2}),Cpe=({unidade:e,contrato:t,onSelect:r,onEdit:s,onDelete:u})=>{const f=async()=>{try{const{data:m}=await tt.from("postos_servico").select("id").eq("unidade_id",e.id).limit(1),{data:i}=await tt.from("colaboradores").select("id").eq("unidade_id",e.id).limit(1),{data:S}=await tt.from("chamados").select("id").eq("unidade_id",e.id).limit(1),{data:E}=await tt.from("ordens_servico").select("id").eq("unidade_id",e.id).limit(1);if(m&&m.length>0){bn({title:"No  possvel excluir",description:"Esta unidade possui postos de servio relacionados. Exclua os postos primeiro.",variant:"destructive"});return}if(i&&i.length>0){bn({title:"No  possvel excluir",description:"Esta unidade possui colaboradores relacionados. Remova a vinculao dos colaboradores primeiro.",variant:"destructive"});return}if(S&&S.length>0){bn({title:"No  possvel excluir",description:"Esta unidade possui chamados relacionados. Exclua os chamados primeiro.",variant:"destructive"});return}if(E&&E.length>0){bn({title:"No  possvel excluir",description:"Esta unidade possui ordens de servio relacionadas. Exclua as ordens primeiro.",variant:"destructive"});return}const{error:I}=await tt.from("unidades").delete().eq("id",e.id);if(I)throw I;bn({title:"Unidade excluda",description:"Unidade excluda com sucesso"}),u()}catch(m){bn({title:"Erro",description:m.message,variant:"destructive"})}};return c.jsxs($r,{className:"hover:shadow-lg transition-shadow cursor-pointer",children:[c.jsx(Xn,{onClick:r,children:c.jsx("div",{className:"flex items-start justify-between",children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:c.jsx(um,{className:"h-4 w-4 text-primary"})}),c.jsx("div",{children:c.jsx(ti,{className:"text-base",children:e.nome})})]})})}),c.jsxs(_n,{children:[c.jsxs("div",{className:"space-y-2",children:[t&&c.jsxs("p",{className:"text-sm text-muted-foreground",children:["Contrato: ",t.negocio]}),c.jsxs("p",{className:"text-sm text-muted-foreground",children:["Faturamento vendido: ",Epe.format(e.faturamento_vendido)]}),e.endereco&&c.jsx("p",{className:"text-sm",children:e.endereco}),(e.cidade||e.uf)&&c.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.cidade,e.cidade&&e.uf?"/":"",e.uf]})]}),c.jsxs("div",{className:"flex gap-2 mt-4",children:[c.jsxs(Nt,{variant:"outline",size:"sm",className:"flex-1",onClick:s,children:[c.jsx(jd,{className:"h-3 w-3 mr-1"}),"Editar"]}),c.jsxs(Cd,{children:[c.jsx(Kb,{asChild:!0,children:c.jsx(Nt,{variant:"outline",size:"sm",onClick:m=>m.stopPropagation(),children:c.jsx(zo,{className:"h-3 w-3"})})}),c.jsxs(ju,{children:[c.jsxs(Iu,{children:[c.jsx(ku,{children:"Confirmar excluso"}),c.jsx(Pu,{children:"Tem certeza que deseja excluir esta unidade? Esta ao no pode ser desfeita."})]}),c.jsxs(Nu,{children:[c.jsx(gh,{children:"Cancelar"}),c.jsx(Du,{onClick:f,children:"Excluir"})]})]})]})]})]})]})};var Ui=function(){return Ui=Object.assign||function(t){for(var r,s=1,u=arguments.length;s<u;s++){r=arguments[s];for(var f in r)Object.prototype.hasOwnProperty.call(r,f)&&(t[f]=r[f])}return t},Ui.apply(this,arguments)};function Ape(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,s=Object.getOwnPropertySymbols(e);u<s.length;u++)t.indexOf(s[u])<0&&Object.prototype.propertyIsEnumerable.call(e,s[u])&&(r[s[u]]=e[s[u]]);return r}function CG(e,t,r){for(var s=0,u=t.length,f;s<u;s++)(f||!(s in t))&&(f||(f=Array.prototype.slice.call(t,0,s)),f[s]=t[s]);return e.concat(f||Array.prototype.slice.call(t))}function Jb(e){return e.mode==="multiple"}function Qb(e){return e.mode==="range"}function wA(e){return e.mode==="single"}var jpe={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};function Ipe(e,t){return Ii(e,"LLLL y",t)}function Npe(e,t){return Ii(e,"d",t)}function kpe(e,t){return Ii(e,"LLLL",t)}function Ppe(e){return"".concat(e)}function Dpe(e,t){return Ii(e,"cccccc",t)}function Rpe(e,t){return Ii(e,"yyyy",t)}var Mpe=Object.freeze({__proto__:null,formatCaption:Ipe,formatDay:Npe,formatMonthCaption:kpe,formatWeekNumber:Ppe,formatWeekdayName:Dpe,formatYearCaption:Rpe}),Ope=function(e,t,r){return Ii(e,"do MMMM (EEEE)",r)},Fpe=function(){return"Month: "},Lpe=function(){return"Go to next month"},zpe=function(){return"Go to previous month"},Bpe=function(e,t){return Ii(e,"cccc",t)},Upe=function(e){return"Week n. ".concat(e)},Vpe=function(){return"Year: "},$pe=Object.freeze({__proto__:null,labelDay:Ope,labelMonthDropdown:Fpe,labelNext:Lpe,labelPrevious:zpe,labelWeekNumber:Upe,labelWeekday:Bpe,labelYearDropdown:Vpe});function qpe(){var e="buttons",t=jpe,r=Cq,s={},u={},f=1,m={},i=new Date;return{captionLayout:e,classNames:t,formatters:Mpe,labels:$pe,locale:r,modifiersClassNames:s,modifiers:u,numberOfMonths:f,styles:m,today:i,mode:"default"}}function Gpe(e){var t=e.fromYear,r=e.toYear,s=e.fromMonth,u=e.toMonth,f=e.fromDate,m=e.toDate;return s?f=Ic(s):t&&(f=new Date(t,0,1)),u?m=_A(u):r&&(m=new Date(r,11,31)),{fromDate:f?Pv(f):void 0,toDate:m?Pv(m):void 0}}var AG=V.createContext(void 0);function Wpe(e){var t,r=e.initialProps,s=qpe(),u=Gpe(r),f=u.fromDate,m=u.toDate,i=(t=r.captionLayout)!==null&&t!==void 0?t:s.captionLayout;i!=="buttons"&&(!f||!m)&&(i="buttons");var S;(wA(r)||Jb(r)||Qb(r))&&(S=r.onSelect);var E=Ui(Ui(Ui({},s),r),{captionLayout:i,classNames:Ui(Ui({},s.classNames),r.classNames),components:Ui({},r.components),formatters:Ui(Ui({},s.formatters),r.formatters),fromDate:f,labels:Ui(Ui({},s.labels),r.labels),mode:r.mode||s.mode,modifiers:Ui(Ui({},s.modifiers),r.modifiers),modifiersClassNames:Ui(Ui({},s.modifiersClassNames),r.modifiersClassNames),onSelect:S,styles:Ui(Ui({},s.styles),r.styles),toDate:m});return c.jsx(AG.Provider,{value:E,children:e.children})}function Pa(){var e=V.useContext(AG);if(!e)throw new Error("useDayPicker must be used within a DayPickerProvider.");return e}function jG(e){var t=Pa(),r=t.locale,s=t.classNames,u=t.styles,f=t.formatters.formatCaption;return c.jsx("div",{className:s.caption_label,style:u.caption_label,"aria-live":"polite",role:"presentation",id:e.id,children:f(e.displayMonth,{locale:r})})}function Hpe(e){return c.jsx("svg",Ui({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},e,{children:c.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function IG(e){var t,r,s=e.onChange,u=e.value,f=e.children,m=e.caption,i=e.className,S=e.style,E=Pa(),I=(r=(t=E.components)===null||t===void 0?void 0:t.IconDropdown)!==null&&r!==void 0?r:Hpe;return c.jsxs("div",{className:i,style:S,children:[c.jsx("span",{className:E.classNames.vhidden,children:e["aria-label"]}),c.jsx("select",{name:e.name,"aria-label":e["aria-label"],className:E.classNames.dropdown,style:E.styles.dropdown,value:u,onChange:s,children:f}),c.jsxs("div",{className:E.classNames.caption_label,style:E.styles.caption_label,"aria-hidden":"true",children:[m,c.jsx(I,{className:E.classNames.dropdown_icon,style:E.styles.dropdown_icon})]})]})}function Zpe(e){var t,r=Pa(),s=r.fromDate,u=r.toDate,f=r.styles,m=r.locale,i=r.formatters.formatMonthCaption,S=r.classNames,E=r.components,I=r.labels.labelMonthDropdown;if(!s)return c.jsx(c.Fragment,{});if(!u)return c.jsx(c.Fragment,{});var D=[];if(Whe(s,u))for(var M=Ic(s),R=s.getMonth();R<=u.getMonth();R++)D.push(ON(M,R));else for(var M=Ic(new Date),R=0;R<=11;R++)D.push(ON(M,R));var H=function(U){var Y=Number(U.target.value),z=ON(Ic(e.displayMonth),Y);e.onChange(z)},F=(t=E==null?void 0:E.Dropdown)!==null&&t!==void 0?t:IG;return c.jsx(F,{name:"months","aria-label":I(),className:S.dropdown_month,style:f.dropdown_month,onChange:H,value:e.displayMonth.getMonth(),caption:i(e.displayMonth,{locale:m}),children:D.map(function(U){return c.jsx("option",{value:U.getMonth(),children:i(U,{locale:m})},U.getMonth())})})}function Xpe(e){var t,r=e.displayMonth,s=Pa(),u=s.fromDate,f=s.toDate,m=s.locale,i=s.styles,S=s.classNames,E=s.components,I=s.formatters.formatYearCaption,D=s.labels.labelYearDropdown,M=[];if(!u)return c.jsx(c.Fragment,{});if(!f)return c.jsx(c.Fragment,{});for(var R=u.getFullYear(),H=f.getFullYear(),F=R;F<=H;F++)M.push(ZB(Sq(new Date),F));var U=function(z){var J=ZB(Ic(r),Number(z.target.value));e.onChange(J)},Y=(t=E==null?void 0:E.Dropdown)!==null&&t!==void 0?t:IG;return c.jsx(Y,{name:"years","aria-label":D(),className:S.dropdown_year,style:i.dropdown_year,onChange:U,value:r.getFullYear(),caption:I(r,{locale:m}),children:M.map(function(z){return c.jsx("option",{value:z.getFullYear(),children:I(z,{locale:m})},z.getFullYear())})})}function Ype(e,t){var r=V.useState(e),s=r[0],u=r[1],f=t===void 0?s:t;return[f,u]}function Kpe(e){var t=e.month,r=e.defaultMonth,s=e.today,u=t||r||s||new Date,f=e.toDate,m=e.fromDate,i=e.numberOfMonths,S=i===void 0?1:i;if(f&&yb(f,u)<0){var E=-1*(S-1);u=Ed(f,E)}return m&&yb(u,m)<0&&(u=m),Ic(u)}function Jpe(){var e=Pa(),t=Kpe(e),r=Ype(t,e.month),s=r[0],u=r[1],f=function(m){var i;if(!e.disableNavigation){var S=Ic(m);u(S),(i=e.onMonthChange)===null||i===void 0||i.call(e,S)}};return[s,f]}function Qpe(e,t){for(var r=t.reverseMonths,s=t.numberOfMonths,u=Ic(e),f=Ic(Ed(u,s)),m=yb(f,u),i=[],S=0;S<m;S++){var E=Ed(u,S);i.push(E)}return r&&(i=i.reverse()),i}function eme(e,t){if(!t.disableNavigation){var r=t.toDate,s=t.pagedNavigation,u=t.numberOfMonths,f=u===void 0?1:u,m=s?f:1,i=Ic(e);if(!r)return Ed(i,m);var S=yb(r,e);if(!(S<f))return Ed(i,m)}}function tme(e,t){if(!t.disableNavigation){var r=t.fromDate,s=t.pagedNavigation,u=t.numberOfMonths,f=u===void 0?1:u,m=s?f:1,i=Ic(e);if(!r)return Ed(i,-m);var S=yb(i,r);if(!(S<=0))return Ed(i,-m)}}var NG=V.createContext(void 0);function rme(e){var t=Pa(),r=Jpe(),s=r[0],u=r[1],f=Qpe(s,t),m=eme(s,t),i=tme(s,t),S=function(D){return f.some(function(M){return nM(D,M)})},E=function(D,M){S(D)||(M&&kq(D,M)?u(Ed(D,1+t.numberOfMonths*-1)):u(D))},I={currentMonth:s,displayMonths:f,goToMonth:u,goToDate:E,previousMonth:i,nextMonth:m,isDateDisplayed:S};return c.jsx(NG.Provider,{value:I,children:e.children})}function e2(){var e=V.useContext(NG);if(!e)throw new Error("useNavigation must be used within a NavigationProvider");return e}function XB(e){var t,r=Pa(),s=r.classNames,u=r.styles,f=r.components,m=e2().goToMonth,i=function(I){m(Ed(I,e.displayIndex?-e.displayIndex:0))},S=(t=f==null?void 0:f.CaptionLabel)!==null&&t!==void 0?t:jG,E=c.jsx(S,{id:e.id,displayMonth:e.displayMonth});return c.jsxs("div",{className:s.caption_dropdowns,style:u.caption_dropdowns,children:[c.jsx("div",{className:s.vhidden,children:E}),c.jsx(Zpe,{onChange:i,displayMonth:e.displayMonth}),c.jsx(Xpe,{onChange:i,displayMonth:e.displayMonth})]})}function nme(e){return c.jsx("svg",Ui({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:c.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function ime(e){return c.jsx("svg",Ui({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:c.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var hC=V.forwardRef(function(e,t){var r=Pa(),s=r.classNames,u=r.styles,f=[s.button_reset,s.button];e.className&&f.push(e.className);var m=f.join(" "),i=Ui(Ui({},u.button_reset),u.button);return e.style&&Object.assign(i,e.style),c.jsx("button",Ui({},e,{ref:t,type:"button",className:m,style:i}))});function sme(e){var t,r,s=Pa(),u=s.dir,f=s.locale,m=s.classNames,i=s.styles,S=s.labels,E=S.labelPrevious,I=S.labelNext,D=s.components;if(!e.nextMonth&&!e.previousMonth)return c.jsx(c.Fragment,{});var M=E(e.previousMonth,{locale:f}),R=[m.nav_button,m.nav_button_previous].join(" "),H=I(e.nextMonth,{locale:f}),F=[m.nav_button,m.nav_button_next].join(" "),U=(t=D==null?void 0:D.IconRight)!==null&&t!==void 0?t:ime,Y=(r=D==null?void 0:D.IconLeft)!==null&&r!==void 0?r:nme;return c.jsxs("div",{className:m.nav,style:i.nav,children:[!e.hidePrevious&&c.jsx(hC,{name:"previous-month","aria-label":M,className:R,style:i.nav_button_previous,disabled:!e.previousMonth,onClick:e.onPreviousClick,children:u==="rtl"?c.jsx(U,{className:m.nav_icon,style:i.nav_icon}):c.jsx(Y,{className:m.nav_icon,style:i.nav_icon})}),!e.hideNext&&c.jsx(hC,{name:"next-month","aria-label":H,className:F,style:i.nav_button_next,disabled:!e.nextMonth,onClick:e.onNextClick,children:u==="rtl"?c.jsx(Y,{className:m.nav_icon,style:i.nav_icon}):c.jsx(U,{className:m.nav_icon,style:i.nav_icon})})]})}function YB(e){var t=Pa().numberOfMonths,r=e2(),s=r.previousMonth,u=r.nextMonth,f=r.goToMonth,m=r.displayMonths,i=m.findIndex(function(H){return nM(e.displayMonth,H)}),S=i===0,E=i===m.length-1,I=t>1&&(S||!E),D=t>1&&(E||!S),M=function(){s&&f(s)},R=function(){u&&f(u)};return c.jsx(sme,{displayMonth:e.displayMonth,hideNext:I,hidePrevious:D,nextMonth:u,previousMonth:s,onPreviousClick:M,onNextClick:R})}function ame(e){var t,r=Pa(),s=r.classNames,u=r.disableNavigation,f=r.styles,m=r.captionLayout,i=r.components,S=(t=i==null?void 0:i.CaptionLabel)!==null&&t!==void 0?t:jG,E;return u?E=c.jsx(S,{id:e.id,displayMonth:e.displayMonth}):m==="dropdown"?E=c.jsx(XB,{displayMonth:e.displayMonth,id:e.id}):m==="dropdown-buttons"?E=c.jsxs(c.Fragment,{children:[c.jsx(XB,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id}),c.jsx(YB,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id})]}):E=c.jsxs(c.Fragment,{children:[c.jsx(S,{id:e.id,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),c.jsx(YB,{displayMonth:e.displayMonth,id:e.id})]}),c.jsx("div",{className:s.caption,style:f.caption,children:E})}function ome(e){var t=Pa(),r=t.footer,s=t.styles,u=t.classNames.tfoot;return r?c.jsx("tfoot",{className:u,style:s.tfoot,children:c.jsx("tr",{children:c.jsx("td",{colSpan:8,children:r})})}):c.jsx(c.Fragment,{})}function lme(e,t,r){for(var s=r?S_(new Date):mh(new Date,{locale:e,weekStartsOn:t}),u=[],f=0;f<7;f++){var m=Zl(s,f);u.push(m)}return u}function cme(){var e=Pa(),t=e.classNames,r=e.styles,s=e.showWeekNumber,u=e.locale,f=e.weekStartsOn,m=e.ISOWeek,i=e.formatters.formatWeekdayName,S=e.labels.labelWeekday,E=lme(u,f,m);return c.jsxs("tr",{style:r.head_row,className:t.head_row,children:[s&&c.jsx("td",{style:r.head_cell,className:t.head_cell}),E.map(function(I,D){return c.jsx("th",{scope:"col",className:t.head_cell,style:r.head_cell,"aria-label":S(I,{locale:u}),children:i(I,{locale:u})},D)})]})}function ume(){var e,t=Pa(),r=t.classNames,s=t.styles,u=t.components,f=(e=u==null?void 0:u.HeadRow)!==null&&e!==void 0?e:cme;return c.jsx("thead",{style:s.head,className:r.head,children:c.jsx(f,{})})}function dme(e){var t=Pa(),r=t.locale,s=t.formatters.formatDay;return c.jsx(c.Fragment,{children:s(e.date,{locale:r})})}var lM=V.createContext(void 0);function hme(e){if(!Jb(e.initialProps)){var t={selected:void 0,modifiers:{disabled:[]}};return c.jsx(lM.Provider,{value:t,children:e.children})}return c.jsx(fme,{initialProps:e.initialProps,children:e.children})}function fme(e){var t=e.initialProps,r=e.children,s=t.selected,u=t.min,f=t.max,m=function(E,I,D){var M,R;(M=t.onDayClick)===null||M===void 0||M.call(t,E,I,D);var H=!!(I.selected&&u&&(s==null?void 0:s.length)===u);if(!H){var F=!!(!I.selected&&f&&(s==null?void 0:s.length)===f);if(!F){var U=s?CG([],s):[];if(I.selected){var Y=U.findIndex(function(z){return Tc(E,z)});U.splice(Y,1)}else U.push(E);(R=t.onSelect)===null||R===void 0||R.call(t,U,E,I,D)}}},i={disabled:[]};s&&i.disabled.push(function(E){var I=f&&s.length>f-1,D=s.some(function(M){return Tc(M,E)});return!!(I&&!D)});var S={selected:s,onDayClick:m,modifiers:i};return c.jsx(lM.Provider,{value:S,children:r})}function cM(){var e=V.useContext(lM);if(!e)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return e}function pme(e,t){var r=t||{},s=r.from,u=r.to;return s&&u?Tc(u,e)&&Tc(s,e)?void 0:Tc(u,e)?{from:u,to:void 0}:Tc(s,e)?void 0:XP(s,e)?{from:e,to:u}:{from:s,to:e}:u?XP(e,u)?{from:u,to:e}:{from:e,to:u}:s?kq(e,s)?{from:e,to:s}:{from:s,to:e}:{from:e,to:void 0}}var uM=V.createContext(void 0);function mme(e){if(!Qb(e.initialProps)){var t={selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}};return c.jsx(uM.Provider,{value:t,children:e.children})}return c.jsx(gme,{initialProps:e.initialProps,children:e.children})}function gme(e){var t=e.initialProps,r=e.children,s=t.selected,u=s||{},f=u.from,m=u.to,i=t.min,S=t.max,E=function(R,H,F){var U,Y;(U=t.onDayClick)===null||U===void 0||U.call(t,R,H,F);var z=pme(R,s);(Y=t.onSelect)===null||Y===void 0||Y.call(t,z,R,H,F)},I={range_start:[],range_end:[],range_middle:[],disabled:[]};if(f?(I.range_start=[f],m?(I.range_end=[m],Tc(f,m)||(I.range_middle=[{after:f,before:m}])):I.range_end=[f]):m&&(I.range_start=[m],I.range_end=[m]),i&&(f&&!m&&I.disabled.push({after:RN(f,i-1),before:Zl(f,i-1)}),f&&m&&I.disabled.push({after:f,before:Zl(f,i-1)}),!f&&m&&I.disabled.push({after:RN(m,i-1),before:Zl(m,i-1)})),S){if(f&&!m&&(I.disabled.push({before:Zl(f,-S+1)}),I.disabled.push({after:Zl(f,S-1)})),f&&m){var D=ch(m,f)+1,M=S-D;I.disabled.push({before:RN(f,M)}),I.disabled.push({after:Zl(m,M)})}!f&&m&&(I.disabled.push({before:Zl(m,-S+1)}),I.disabled.push({after:Zl(m,S-1)}))}return c.jsx(uM.Provider,{value:{selected:s,onDayClick:E,modifiers:I},children:r})}function dM(){var e=V.useContext(uM);if(!e)throw new Error("useSelectRange must be used within a SelectRangeProvider");return e}function hE(e){return Array.isArray(e)?CG([],e):e!==void 0?[e]:[]}function _me(e){var t={};return Object.entries(e).forEach(function(r){var s=r[0],u=r[1];t[s]=hE(u)}),t}var Ad;(function(e){e.Outside="outside",e.Disabled="disabled",e.Selected="selected",e.Hidden="hidden",e.Today="today",e.RangeStart="range_start",e.RangeEnd="range_end",e.RangeMiddle="range_middle"})(Ad||(Ad={}));var xme=Ad.Selected,qh=Ad.Disabled,vme=Ad.Hidden,yme=Ad.Today,zN=Ad.RangeEnd,BN=Ad.RangeMiddle,UN=Ad.RangeStart,wme=Ad.Outside;function bme(e,t,r){var s,u=(s={},s[xme]=hE(e.selected),s[qh]=hE(e.disabled),s[vme]=hE(e.hidden),s[yme]=[e.today],s[zN]=[],s[BN]=[],s[UN]=[],s[wme]=[],s);return e.fromDate&&u[qh].push({before:e.fromDate}),e.toDate&&u[qh].push({after:e.toDate}),Jb(e)?u[qh]=u[qh].concat(t.modifiers[qh]):Qb(e)&&(u[qh]=u[qh].concat(r.modifiers[qh]),u[UN]=r.modifiers[UN],u[BN]=r.modifiers[BN],u[zN]=r.modifiers[zN]),u}var kG=V.createContext(void 0);function Sme(e){var t=Pa(),r=cM(),s=dM(),u=bme(t,r,s),f=_me(t.modifiers),m=Ui(Ui({},u),f);return c.jsx(kG.Provider,{value:m,children:e.children})}function PG(){var e=V.useContext(kG);if(!e)throw new Error("useModifiers must be used within a ModifiersProvider");return e}function Tme(e){return!!(e&&typeof e=="object"&&"before"in e&&"after"in e)}function Eme(e){return!!(e&&typeof e=="object"&&"from"in e)}function Cme(e){return!!(e&&typeof e=="object"&&"after"in e)}function Ame(e){return!!(e&&typeof e=="object"&&"before"in e)}function jme(e){return!!(e&&typeof e=="object"&&"dayOfWeek"in e)}function Ime(e,t){var r,s=t.from,u=t.to;if(s&&u){var f=ch(u,s)<0;f&&(r=[u,s],s=r[0],u=r[1]);var m=ch(e,s)>=0&&ch(u,e)>=0;return m}return u?Tc(u,e):s?Tc(s,e):!1}function Nme(e){return tM(e)}function kme(e){return Array.isArray(e)&&e.every(tM)}function Pme(e,t){return t.some(function(r){if(typeof r=="boolean")return r;if(Nme(r))return Tc(e,r);if(kme(r))return r.includes(e);if(Eme(r))return Ime(e,r);if(jme(r))return r.dayOfWeek.includes(e.getDay());if(Tme(r)){var s=ch(r.before,e),u=ch(r.after,e),f=s>0,m=u<0,i=XP(r.before,r.after);return i?m&&f:f||m}return Cme(r)?ch(e,r.after)>0:Ame(r)?ch(r.before,e)>0:typeof r=="function"?r(e):!1})}function hM(e,t,r){var s=Object.keys(t).reduce(function(f,m){var i=t[m];return Pme(e,i)&&f.push(m),f},[]),u={};return s.forEach(function(f){return u[f]=!0}),r&&!nM(e,r)&&(u.outside=!0),u}function Dme(e,t){for(var r=Ic(e[0]),s=_A(e[e.length-1]),u,f,m=r;m<=s;){var i=hM(m,t),S=!i.disabled&&!i.hidden;if(!S){m=Zl(m,1);continue}if(i.selected)return m;i.today&&!f&&(f=m),u||(u=m),m=Zl(m,1)}return f||u}var Rme=365;function DG(e,t){var r=t.moveBy,s=t.direction,u=t.context,f=t.modifiers,m=t.retry,i=m===void 0?{count:0,lastFocused:e}:m,S=u.weekStartsOn,E=u.fromDate,I=u.toDate,D=u.locale,M={day:Zl,week:ZP,month:Ed,year:$de,startOfWeek:function(U){return u.ISOWeek?S_(U):mh(U,{locale:D,weekStartsOn:S})},endOfWeek:function(U){return u.ISOWeek?Tq(U):rM(U,{locale:D,weekStartsOn:S})}},R=M[r](e,s==="after"?1:-1);s==="before"&&E?R=qde([E,R]):s==="after"&&I&&(R=Gde([I,R]));var H=!0;if(f){var F=hM(R,f);H=!F.disabled&&!F.hidden}return H?R:i.count>Rme?i.lastFocused:DG(R,{moveBy:r,direction:s,context:u,modifiers:f,retry:Ui(Ui({},i),{count:i.count+1})})}var RG=V.createContext(void 0);function Mme(e){var t=e2(),r=PG(),s=V.useState(),u=s[0],f=s[1],m=V.useState(),i=m[0],S=m[1],E=Dme(t.displayMonths,r),I=u??(i&&t.isDateDisplayed(i))?i:E,D=function(){S(u),f(void 0)},M=function(U){f(U)},R=Pa(),H=function(U,Y){if(u){var z=DG(u,{moveBy:U,direction:Y,context:R,modifiers:r});Tc(u,z)||(t.goToDate(z,u),M(z))}},F={focusedDay:u,focusTarget:I,blur:D,focus:M,focusDayAfter:function(){return H("day","after")},focusDayBefore:function(){return H("day","before")},focusWeekAfter:function(){return H("week","after")},focusWeekBefore:function(){return H("week","before")},focusMonthBefore:function(){return H("month","before")},focusMonthAfter:function(){return H("month","after")},focusYearBefore:function(){return H("year","before")},focusYearAfter:function(){return H("year","after")},focusStartOfWeek:function(){return H("startOfWeek","before")},focusEndOfWeek:function(){return H("endOfWeek","after")}};return c.jsx(RG.Provider,{value:F,children:e.children})}function fM(){var e=V.useContext(RG);if(!e)throw new Error("useFocusContext must be used within a FocusProvider");return e}function Ome(e,t){var r=PG(),s=hM(e,r,t);return s}var pM=V.createContext(void 0);function Fme(e){if(!wA(e.initialProps)){var t={selected:void 0};return c.jsx(pM.Provider,{value:t,children:e.children})}return c.jsx(Lme,{initialProps:e.initialProps,children:e.children})}function Lme(e){var t=e.initialProps,r=e.children,s=function(f,m,i){var S,E,I;if((S=t.onDayClick)===null||S===void 0||S.call(t,f,m,i),m.selected&&!t.required){(E=t.onSelect)===null||E===void 0||E.call(t,void 0,f,m,i);return}(I=t.onSelect)===null||I===void 0||I.call(t,f,f,m,i)},u={selected:t.selected,onDayClick:s};return c.jsx(pM.Provider,{value:u,children:r})}function MG(){var e=V.useContext(pM);if(!e)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return e}function zme(e,t){var r=Pa(),s=MG(),u=cM(),f=dM(),m=fM(),i=m.focusDayAfter,S=m.focusDayBefore,E=m.focusWeekAfter,I=m.focusWeekBefore,D=m.blur,M=m.focus,R=m.focusMonthBefore,H=m.focusMonthAfter,F=m.focusYearBefore,U=m.focusYearAfter,Y=m.focusStartOfWeek,z=m.focusEndOfWeek,J=function(ct){var Me,mt,Kt,it;wA(r)?(Me=s.onDayClick)===null||Me===void 0||Me.call(s,e,t,ct):Jb(r)?(mt=u.onDayClick)===null||mt===void 0||mt.call(u,e,t,ct):Qb(r)?(Kt=f.onDayClick)===null||Kt===void 0||Kt.call(f,e,t,ct):(it=r.onDayClick)===null||it===void 0||it.call(r,e,t,ct)},ne=function(ct){var Me;M(e),(Me=r.onDayFocus)===null||Me===void 0||Me.call(r,e,t,ct)},me=function(ct){var Me;D(),(Me=r.onDayBlur)===null||Me===void 0||Me.call(r,e,t,ct)},le=function(ct){var Me;(Me=r.onDayMouseEnter)===null||Me===void 0||Me.call(r,e,t,ct)},ye=function(ct){var Me;(Me=r.onDayMouseLeave)===null||Me===void 0||Me.call(r,e,t,ct)},pe=function(ct){var Me;(Me=r.onDayPointerEnter)===null||Me===void 0||Me.call(r,e,t,ct)},be=function(ct){var Me;(Me=r.onDayPointerLeave)===null||Me===void 0||Me.call(r,e,t,ct)},ke=function(ct){var Me;(Me=r.onDayTouchCancel)===null||Me===void 0||Me.call(r,e,t,ct)},Oe=function(ct){var Me;(Me=r.onDayTouchEnd)===null||Me===void 0||Me.call(r,e,t,ct)},Ee=function(ct){var Me;(Me=r.onDayTouchMove)===null||Me===void 0||Me.call(r,e,t,ct)},qe=function(ct){var Me;(Me=r.onDayTouchStart)===null||Me===void 0||Me.call(r,e,t,ct)},Qe=function(ct){var Me;(Me=r.onDayKeyUp)===null||Me===void 0||Me.call(r,e,t,ct)},gt=function(ct){var Me;switch(ct.key){case"ArrowLeft":ct.preventDefault(),ct.stopPropagation(),r.dir==="rtl"?i():S();break;case"ArrowRight":ct.preventDefault(),ct.stopPropagation(),r.dir==="rtl"?S():i();break;case"ArrowDown":ct.preventDefault(),ct.stopPropagation(),E();break;case"ArrowUp":ct.preventDefault(),ct.stopPropagation(),I();break;case"PageUp":ct.preventDefault(),ct.stopPropagation(),ct.shiftKey?F():R();break;case"PageDown":ct.preventDefault(),ct.stopPropagation(),ct.shiftKey?U():H();break;case"Home":ct.preventDefault(),ct.stopPropagation(),Y();break;case"End":ct.preventDefault(),ct.stopPropagation(),z();break}(Me=r.onDayKeyDown)===null||Me===void 0||Me.call(r,e,t,ct)},Xe={onClick:J,onFocus:ne,onBlur:me,onKeyDown:gt,onKeyUp:Qe,onMouseEnter:le,onMouseLeave:ye,onPointerEnter:pe,onPointerLeave:be,onTouchCancel:ke,onTouchEnd:Oe,onTouchMove:Ee,onTouchStart:qe};return Xe}function Bme(){var e=Pa(),t=MG(),r=cM(),s=dM(),u=wA(e)?t.selected:Jb(e)?r.selected:Qb(e)?s.selected:void 0;return u}function Ume(e){return Object.values(Ad).includes(e)}function Vme(e,t){var r=[e.classNames.day];return Object.keys(t).forEach(function(s){var u=e.modifiersClassNames[s];if(u)r.push(u);else if(Ume(s)){var f=e.classNames["day_".concat(s)];f&&r.push(f)}}),r}function $me(e,t){var r=Ui({},e.styles.day);return Object.keys(t).forEach(function(s){var u;r=Ui(Ui({},r),(u=e.modifiersStyles)===null||u===void 0?void 0:u[s])}),r}function qme(e,t,r){var s,u,f,m=Pa(),i=fM(),S=Ome(e,t),E=zme(e,S),I=Bme(),D=!!(m.onDayClick||m.mode!=="default");V.useEffect(function(){var le;S.outside||i.focusedDay&&D&&Tc(i.focusedDay,e)&&((le=r.current)===null||le===void 0||le.focus())},[i.focusedDay,e,r,D,S.outside]);var M=Vme(m,S).join(" "),R=$me(m,S),H=!!(S.outside&&!m.showOutsideDays||S.hidden),F=(f=(u=m.components)===null||u===void 0?void 0:u.DayContent)!==null&&f!==void 0?f:dme,U=c.jsx(F,{date:e,displayMonth:t,activeModifiers:S}),Y={style:R,className:M,children:U,role:"gridcell"},z=i.focusTarget&&Tc(i.focusTarget,e)&&!S.outside,J=i.focusedDay&&Tc(i.focusedDay,e),ne=Ui(Ui(Ui({},Y),(s={disabled:S.disabled,role:"gridcell"},s["aria-selected"]=S.selected,s.tabIndex=J||z?0:-1,s)),E),me={isButton:D,isHidden:H,activeModifiers:S,selectedDays:I,buttonProps:ne,divProps:Y};return me}function Gme(e){var t=V.useRef(null),r=qme(e.date,e.displayMonth,t);return r.isHidden?c.jsx("div",{role:"gridcell"}):r.isButton?c.jsx(hC,Ui({name:"day",ref:t},r.buttonProps)):c.jsx("div",Ui({},r.divProps))}function Wme(e){var t=e.number,r=e.dates,s=Pa(),u=s.onWeekNumberClick,f=s.styles,m=s.classNames,i=s.locale,S=s.labels.labelWeekNumber,E=s.formatters.formatWeekNumber,I=E(Number(t),{locale:i});if(!u)return c.jsx("span",{className:m.weeknumber,style:f.weeknumber,children:I});var D=S(Number(t),{locale:i}),M=function(R){u(t,r,R)};return c.jsx(hC,{name:"week-number","aria-label":D,className:m.weeknumber,style:f.weeknumber,onClick:M,children:I})}function Hme(e){var t,r,s=Pa(),u=s.styles,f=s.classNames,m=s.showWeekNumber,i=s.components,S=(t=i==null?void 0:i.Day)!==null&&t!==void 0?t:Gme,E=(r=i==null?void 0:i.WeekNumber)!==null&&r!==void 0?r:Wme,I;return m&&(I=c.jsx("td",{className:f.cell,style:u.cell,children:c.jsx(E,{number:e.weekNumber,dates:e.dates})})),c.jsxs("tr",{className:f.row,style:u.row,children:[I,e.dates.map(function(D){return c.jsx("td",{className:f.cell,style:u.cell,role:"presentation",children:c.jsx(S,{displayMonth:e.displayMonth,date:D})},$he(D))})]})}function KB(e,t,r){for(var s=r!=null&&r.ISOWeek?Tq(t):rM(t,r),u=r!=null&&r.ISOWeek?S_(e):mh(e,r),f=ch(s,u),m=[],i=0;i<=f;i++)m.push(Zl(u,i));var S=m.reduce(function(E,I){var D=r!=null&&r.ISOWeek?Aq(I):Iq(I,r),M=E.find(function(R){return R.weekNumber===D});return M?(M.dates.push(I),E):(E.push({weekNumber:D,dates:[I]}),E)},[]);return S}function Zme(e,t){var r=KB(Ic(e),_A(e),t);if(t!=null&&t.useFixedWeeks){var s=Ghe(e,t);if(s<6){var u=r[r.length-1],f=u.dates[u.dates.length-1],m=ZP(f,6-s),i=KB(ZP(f,1),m,t);r.push.apply(r,i)}}return r}function Xme(e){var t,r,s,u=Pa(),f=u.locale,m=u.classNames,i=u.styles,S=u.hideHead,E=u.fixedWeeks,I=u.components,D=u.weekStartsOn,M=u.firstWeekContainsDate,R=u.ISOWeek,H=Zme(e.displayMonth,{useFixedWeeks:!!E,ISOWeek:R,locale:f,weekStartsOn:D,firstWeekContainsDate:M}),F=(t=I==null?void 0:I.Head)!==null&&t!==void 0?t:ume,U=(r=I==null?void 0:I.Row)!==null&&r!==void 0?r:Hme,Y=(s=I==null?void 0:I.Footer)!==null&&s!==void 0?s:ome;return c.jsxs("table",{id:e.id,className:m.table,style:i.table,role:"grid","aria-labelledby":e["aria-labelledby"],children:[!S&&c.jsx(F,{}),c.jsx("tbody",{className:m.tbody,style:i.tbody,children:H.map(function(z){return c.jsx(U,{displayMonth:e.displayMonth,dates:z.dates,weekNumber:z.weekNumber},z.weekNumber)})}),c.jsx(Y,{displayMonth:e.displayMonth})]})}function Yme(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var Kme=Yme()?V.useLayoutEffect:V.useEffect,VN=!1,Jme=0;function JB(){return"react-day-picker-".concat(++Jme)}function Qme(e){var t,r=e??(VN?JB():null),s=V.useState(r),u=s[0],f=s[1];return Kme(function(){u===null&&f(JB())},[]),V.useEffect(function(){VN===!1&&(VN=!0)},[]),(t=e??u)!==null&&t!==void 0?t:void 0}function ege(e){var t,r,s=Pa(),u=s.dir,f=s.classNames,m=s.styles,i=s.components,S=e2().displayMonths,E=Qme(s.id?"".concat(s.id,"-").concat(e.displayIndex):void 0),I=s.id?"".concat(s.id,"-grid-").concat(e.displayIndex):void 0,D=[f.month],M=m.month,R=e.displayIndex===0,H=e.displayIndex===S.length-1,F=!R&&!H;u==="rtl"&&(t=[R,H],H=t[0],R=t[1]),R&&(D.push(f.caption_start),M=Ui(Ui({},M),m.caption_start)),H&&(D.push(f.caption_end),M=Ui(Ui({},M),m.caption_end)),F&&(D.push(f.caption_between),M=Ui(Ui({},M),m.caption_between));var U=(r=i==null?void 0:i.Caption)!==null&&r!==void 0?r:ame;return c.jsxs("div",{className:D.join(" "),style:M,children:[c.jsx(U,{id:E,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),c.jsx(Xme,{id:I,"aria-labelledby":E,displayMonth:e.displayMonth})]},e.displayIndex)}function tge(e){var t=Pa(),r=t.classNames,s=t.styles;return c.jsx("div",{className:r.months,style:s.months,children:e.children})}function rge(e){var t,r,s=e.initialProps,u=Pa(),f=fM(),m=e2(),i=V.useState(!1),S=i[0],E=i[1];V.useEffect(function(){u.initialFocus&&f.focusTarget&&(S||(f.focus(f.focusTarget),E(!0)))},[u.initialFocus,S,f.focus,f.focusTarget,f]);var I=[u.classNames.root,u.className];u.numberOfMonths>1&&I.push(u.classNames.multiple_months),u.showWeekNumber&&I.push(u.classNames.with_weeknumber);var D=Ui(Ui({},u.styles.root),u.style),M=Object.keys(s).filter(function(H){return H.startsWith("data-")}).reduce(function(H,F){var U;return Ui(Ui({},H),(U={},U[F]=s[F],U))},{}),R=(r=(t=s.components)===null||t===void 0?void 0:t.Months)!==null&&r!==void 0?r:tge;return c.jsx("div",Ui({className:I.join(" "),style:D,dir:u.dir,id:u.id,nonce:s.nonce,title:s.title,lang:s.lang},M,{children:c.jsx(R,{children:m.displayMonths.map(function(H,F){return c.jsx(ege,{displayIndex:F,displayMonth:H},F)})})}))}function nge(e){var t=e.children,r=Ape(e,["children"]);return c.jsx(Wpe,{initialProps:r,children:c.jsx(rme,{children:c.jsx(Fme,{initialProps:r,children:c.jsx(hme,{initialProps:r,children:c.jsx(mme,{initialProps:r,children:c.jsx(Sme,{children:c.jsx(Mme,{children:t})})})})})})})}function ige(e){return c.jsx(nge,Ui({},e,{children:c.jsx(rge,{initialProps:e})}))}function mM({className:e,classNames:t,showOutsideDays:r=!0,...s}){return c.jsx(ige,{showOutsideDays:r,className:sn("p-3",e),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:sn(xb({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:sn(xb({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:({...u})=>c.jsx(Mee,{className:"h-4 w-4"}),IconRight:({...u})=>c.jsx(Oee,{className:"h-4 w-4"})},...s})}mM.displayName="Calendar";const Pg=e=>Ii(e,"yyyy-MM-dd"),yw=e=>new Date(`${e}T00:00:00`),QB=e=>Ii(yw(e),"dd/MM/yyyy"),sge=["falta justificada","falta injustificada","afastamento INSS","frias","suspenso","Posto vago"],age=e=>{switch(e==null?void 0:e.replace(/_/g," ").trim().toLowerCase()){case"falta justificada":return"falta justificada";case"falta injustificada":return"falta injustificada";case"afastamento inss":return"afastamento INSS";case"f?rias":case"ferias":return"f?rias";case"suspens?o":case"suspensao":return"suspens?o";case"posto vago":return"Posto vago";default:return e==null?void 0:e.replace(/_/g," ").trim()}},oge="00000000-0000-0000-0000-000000000000",lge={vago:"Vago",ocupado:"Ocupado",vago_temporariamente:"Vago temporariamente",ocupado_temporariamente:"Ocupado temporariamente",presenca_confirmada:"Presenca confirmada",ocupacao_agendada:"Ocupao agendada",inativo:"Inativo"},cge=e=>{switch(e){case"ocupado":case"presenca_confirmada":return"default";case"ocupacao_agendada":case"ocupado_temporariamente":return"secondary";case"vago":return"destructive";case"inativo":return"outline";default:return"outline"}},uge=e=>{switch(e){case"ocupado":case"presenca_confirmada":return c.jsx(XC,{className:"h-4 w-4"});case"ocupacao_agendada":return c.jsx(jc,{className:"h-4 w-4"});case"vago":case"vago_temporariamente":return c.jsx(Jk,{className:"h-4 w-4"});case"inativo":return c.jsx(Jk,{className:"h-4 w-4"});default:return c.jsx(of,{className:"h-4 w-4"})}},dge=({posto:e,unidade:t,onEdit:r,onDelete:s})=>{const[u,f]=V.useState([]),[m,i]=V.useState(e.status??"vago"),[S,E]=V.useState(e.ultimo_dia_atividade??null),[I,D]=V.useState(),[M,R]=V.useState(!1),[H,F]=V.useState([]),[U,Y]=V.useState([]),[z,J]=V.useState([]),[ne,me]=V.useState([]),[le,ye]=V.useState(!1),[pe,be]=V.useState(null),[ke,Oe]=V.useState("");V.useEffect(()=>{i(e.status??"vago"),E(e.ultimo_dia_atividade??null)},[e.status,e.ultimo_dia_atividade]);const Ee=V.useCallback(async()=>{const it=new Date,ee=new Date(it.getFullYear(),it.getMonth(),1),he=new Date(it.getFullYear(),it.getMonth()+1,0),{data:Se,error:Ue}=await tt.from("dias_trabalho").select("data, status").eq("posto_servico_id",e.id).in("status",["vago","presenca_confirmada","ocupacao_agendada"]).gte("data",Pg(ee)).lte("data",Pg(he));if(!Ue&&Se){const nt=Se.filter(Vt=>Vt.status==="presenca_confirmada").map(Vt=>yw(Vt.data)),dt=Se.filter(Vt=>Vt.status==="ocupacao_agendada").map(Vt=>yw(Vt.data));Y(nt),me(dt)}else Y([]),me([])},[e.id]),qe=V.useCallback(async()=>{const it=new Date,ee=new Date(it.getFullYear(),it.getMonth(),1),he=new Date(it.getFullYear(),it.getMonth()+1,0),{data:Se,error:Ue}=await tt.from("posto_dias_vagos").select("data").eq("posto_servico_id",e.id).gte("data",Pg(ee)).lte("data",Pg(he));if(!Ue&&Se){const nt=Se.map(dt=>yw(dt.data));J(nt)}else J([])},[e.id]),Qe=V.useCallback(async()=>{const it=new Date,ee=it.getMonth()+1,he=it.getFullYear(),{data:Se,error:Ue}=await tt.from("posto_jornadas").select("dias_trabalho").eq("posto_servico_id",e.id).eq("mes",ee).eq("ano",he).maybeSingle();if(!Ue&&Se){const nt=Se.dias_trabalho.map(dt=>new Date(dt+"T00:00:00"));F(nt)}},[e.id]),gt=V.useCallback(async()=>{const{data:it,error:ee}=await tt.from("colaboradores").select("id, nome_completo, status_colaborador").eq("posto_servico_id",e.id).eq("status_colaborador","ativo");!ee&&it&&f(it)},[e.id]);V.useEffect(()=>{gt(),Qe(),Ee(),qe();const it=tt.channel(`posto-${e.id}-updates`).on("postgres_changes",{event:"*",schema:"public",table:"colaboradores",filter:`posto_servico_id=eq.${e.id}`},()=>{gt()}).on("postgres_changes",{event:"*",schema:"public",table:"dias_trabalho",filter:`posto_servico_id=eq.${e.id}`},()=>{Ee(),qe()}).on("postgres_changes",{event:"*",schema:"public",table:"posto_dias_vagos",filter:`posto_servico_id=eq.${e.id}`},()=>{qe()}).on("postgres_changes",{event:"*",schema:"public",table:"postos_servico",filter:`id=eq.${e.id}`},ee=>{const he=ee.new;he!=null&&he.status&&i(he.status),he&&"ultimo_dia_atividade"in he&&E(he.ultimo_dia_atividade??null)}).subscribe();return()=>{tt.removeChannel(it)}},[e.id,gt,Ee,qe,Qe]);const Xe=async()=>{try{const{data:it}=await tt.from("colaboradores").select("id").eq("posto_servico_id",e.id).limit(1),{data:ee}=await tt.from("chamados").select("id").eq("posto_servico_id",e.id).limit(1);if(it&&it.length>0){bn({title:"No  possvel excluir",description:"Este posto possui colaboradores relacionados. Remova a vinculao dos colaboradores primeiro.",variant:"destructive"});return}if(ee&&ee.length>0){bn({title:"No  possvel excluir",description:"Este posto possui chamados relacionados. Exclua os chamados primeiro.",variant:"destructive"});return}const{error:he}=await tt.from("postos_servico").delete().eq("id",e.id);if(he)throw he;bn({title:"Posto excludo",description:"Posto de servio excludo com sucesso"}),s()}catch(it){bn({title:"Erro",description:it.message,variant:"destructive"})}},ct=async()=>{try{const it=new Date,ee=new Date(it.getFullYear(),it.getMonth(),1),he=new Date(it.getFullYear(),it.getMonth()+1,0),Se=S?yw(S):null;if(Se&&Se<ee){bn({title:"Posto encerrado",description:`O ultimo dia de atividade foi ${QB(S)}. Nao ha jornadas disponiveis para o periodo atual.`,variant:"destructive"});return}const Ue=Se&&Se<he?Se:he,nt=ee.toISOString().split("T")[0],dt=Ue.toISOString().split("T")[0],{data:Vt,error:zt}=await tt.from("dias_trabalho").select("data").eq("posto_servico_id",e.id).gte("data",nt).lte("data",dt).order("data");if(zt)throw zt;let Gt=(Vt==null?void 0:Vt.map(Dn=>new Date(Dn.data+"T00:00:00")))||[],jr=(Vt==null?void 0:Vt.map(Dn=>Dn.data))||[];if(!Gt.length){if(!e.escala){bn({title:"Escala nao configurada",description:"Defina a escala do posto para gerar a jornada.",variant:"destructive"});return}const Dn=e.primeiro_dia_atividade||nt,{data:Zr,error:Nn}=await tt.rpc("calcular_dias_escala",{p_escala:e.escala,p_data_inicio:nt,p_data_fim:dt,p_dias_semana:e.dias_semana??null,p_primeiro_dia_atividade:Dn});if(Nn)throw Nn;if(Gt=(Zr||[]).map(Pi=>new Date(Pi.data_trabalho+"T00:00:00")),jr=Gt.map(Pi=>Pg(Pi)),!Gt.length){bn({title:"Sem dias programados",description:"Nenhum dia de trabalho foi retornado pela funcao calcular_dias_escala.",variant:"destructive"});return}}if(!Gt.length){bn({title:"Sem dias programados",description:"Nenhum dia de trabalho esta disponivel dentro do periodo permitido.",variant:"destructive"});return}const{data:{user:Wr}}=await tt.auth.getUser();if(!Wr)throw new Error("Usuario nao autenticado");const nn=it.getMonth()+1,xn=it.getFullYear(),{error:ei}=await tt.from("posto_jornadas").upsert({posto_servico_id:e.id,mes:nn,ano:xn,dias_trabalho:jr,created_by:Wr.id},{onConflict:"posto_servico_id,mes,ano"});if(ei)throw ei;F(Gt),bn({title:"Jornada confirmada",description:`Jornada confirmada para ${Gt.length} dias do mes corrente`})}catch(it){bn({title:"Erro ao salvar jornada",description:it.message,variant:"destructive"})}},Me=it=>{it&&(be(it),ye(!0))},mt=async()=>{if(pe)try{const it=Pg(pe),{error:ee}=await tt.from("dias_trabalho").update({status:"presenca_confirmada",motivo_vago:null}).eq("posto_servico_id",e.id).eq("data",it);if(ee)throw ee;const{error:he}=await tt.from("posto_dias_vagos").delete().eq("posto_servico_id",e.id).eq("data",it);if(he)throw he;J(Se=>Se.filter(Ue=>Ue.getTime()!==pe.getTime())),U.some(Se=>Se.getTime()===pe.getTime())||Y(Se=>[...Se,pe]),ye(!1),bn({title:"Presena confirmada",description:`Presena confirmada para ${pe.toLocaleDateString("pt-BR")}`})}catch(it){bn({title:"Erro ao confirmar presena",description:it.message,variant:"destructive"})}},Kt=async()=>{if(!pe||!ke){bn({title:"Motivo obrigatrio",description:"Selecione um motivo para marcar o posto como vago",variant:"destructive"});return}try{const it=Pg(pe),ee=age(ke),{error:he}=await tt.from("dias_trabalho").update({status:"vago",motivo_vago:ee}).eq("posto_servico_id",e.id).eq("data",it);if(he)throw he;const{data:{user:Se}}=await tt.auth.getUser(),{error:Ue}=await tt.from("posto_dias_vagos").upsert({posto_servico_id:e.id,colaborador_id:null,data:it,motivo:ee,created_by:(Se==null?void 0:Se.id)??oge});if(Ue)throw Ue;Y(nt=>nt.filter(dt=>dt.getTime()!==pe.getTime())),await qe(),await Ee(),await Ee(),await qe(),ye(!1),Oe(""),bn({title:"Posto vago",description:`Posto marcado como vago para ${pe.toLocaleDateString("pt-BR")}`,variant:"destructive"})}catch(it){bn({title:"Erro ao marcar dia vago",description:it.message,variant:"destructive"})}};return c.jsxs($r,{className:"hover:shadow-lg transition-shadow",children:[c.jsx(Xn,{children:c.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:c.jsx(J4,{className:"h-4 w-4 text-primary"})}),c.jsx("div",{children:c.jsx(ti,{className:"text-base",children:e.nome})})]}),c.jsxs("div",{className:"flex flex-wrap gap-2 items-center sm:justify-end",children:[c.jsxs(Bs,{open:M,onOpenChange:R,children:[c.jsx(n7,{asChild:!0,children:c.jsx(Nt,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:c.jsx(jc,{className:"h-4 w-4"})})}),c.jsxs(Is,{className:"sm:max-w-md",children:[c.jsx(Ns,{children:c.jsxs(ks,{children:["Calendrio - ",e.nome]})}),c.jsxs("div",{className:"space-y-4",children:[c.jsx("div",{className:"flex justify-center",children:c.jsx(mM,{mode:"single",selected:I,onSelect:Me,className:"rounded-md border pointer-events-auto",modifiers:{confirmado:H,presenca:U,vago:z,agendado:ne},modifiersStyles:{confirmado:{backgroundColor:"hsl(var(--primary) / 0.2)",color:"hsl(var(--foreground))"},presenca:{backgroundColor:"hsl(142 76% 36%)",color:"white",fontWeight:"bold"},vago:{backgroundColor:"hsl(0 84% 60%)",color:"white",fontWeight:"bold"},agendado:{backgroundColor:"hsl(31 97% 45%)",color:"white",fontWeight:"bold"}}})}),e.escala&&c.jsx("div",{className:"space-y-2",children:c.jsxs("div",{className:"flex justify-center gap-2",children:[c.jsx(Nt,{onClick:ct,className:"w-full",disabled:H.length>0,children:H.length>0?"Jornada Confirmada":"Confirmar Jornada"}),H.length>0&&c.jsx(Nt,{onClick:async()=>{try{const it=new Date,{error:ee}=await tt.from("posto_jornadas").delete().eq("posto_servico_id",e.id).eq("mes",it.getMonth()+1).eq("ano",it.getFullYear());if(ee)throw ee;F([]),bn({title:"Jornada limpa",description:"Jornada removida com sucesso"})}catch(it){bn({title:"Erro ao limpar jornada",description:it.message,variant:"destructive"})}},variant:"outline",children:"Limpar"})]})})]})]})]}),c.jsxs(Oi,{variant:cge(m),className:"flex items-center gap-1",children:[uge(m),lge[m]??m]})]})]})}),c.jsxs(_n,{children:[c.jsxs("div",{className:"space-y-2",children:[t&&c.jsxs("p",{className:"text-sm text-muted-foreground",children:["Unidade: ",t.nome]}),c.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[c.jsx(of,{className:"h-4 w-4 text-muted-foreground"}),c.jsx("span",{children:e.funcao})]}),e.escala&&c.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[c.jsx(J4,{className:"h-4 w-4"}),c.jsxs("span",{children:["Escala: ",e.escala]})]}),S&&c.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[c.jsx(jc,{className:"h-4 w-4"}),c.jsxs("span",{children:["ltimo dia previsto: ",QB(S)]})]}),c.jsxs("div",{className:"flex items-center justify-between text-sm pt-2 border-t",children:[c.jsx("span",{className:"text-muted-foreground",children:"Colaboradores lotados:"}),c.jsxs("span",{className:"font-semibold",children:[u.length,"/1"]})]}),e.horario_inicio&&e.horario_fim&&c.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[c.jsx(Lv,{className:"h-4 w-4"}),c.jsxs("span",{children:[e.horario_inicio," - ",e.horario_fim]})]})]}),c.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mt-4",children:[c.jsxs(Nt,{variant:"outline",size:"sm",className:"flex-1",onClick:r,children:[c.jsx(jd,{className:"h-3 w-3 mr-1"}),"Editar"]}),c.jsxs(Cd,{children:[c.jsx(Kb,{asChild:!0,children:c.jsx(Nt,{variant:"outline",size:"sm",className:"sm:w-auto",children:c.jsx(zo,{className:"h-3 w-3"})})}),c.jsxs(ju,{children:[c.jsxs(Iu,{children:[c.jsx(ku,{children:"Confirmar excluso"}),c.jsx(Pu,{children:"Tem certeza que deseja excluir este posto? Esta ao no pode ser desfeita."})]}),c.jsxs(Nu,{children:[c.jsx(gh,{children:"Cancelar"}),c.jsx(Du,{onClick:Xe,children:"Excluir"})]})]})]})]})]}),c.jsx(Bs,{open:le,onOpenChange:ye,children:c.jsxs(Is,{className:"sm:max-w-md",children:[c.jsx(Ns,{children:c.jsx(ks,{children:pe&&`Marcar dia ${pe.toLocaleDateString("pt-BR")}`})}),pe&&ne.some(it=>it.getTime()===pe.getTime())&&c.jsx("p",{className:"text-sm text-muted-foreground",children:"Este dia possui uma ocupao agendada para um colaborador."}),c.jsxs("div",{className:"flex flex-col gap-4",children:[c.jsxs(Nt,{onClick:mt,className:"w-full bg-green-600 hover:bg-green-700",children:[c.jsx(XC,{className:"h-4 w-4 mr-2"}),"Confirmar Presena"]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"motivo",children:"Motivo da Ausncia"}),c.jsxs(Lr,{value:ke,onValueChange:Oe,children:[c.jsx(Or,{id:"motivo",children:c.jsx(zr,{placeholder:"Selecione o motivo"})}),c.jsx(Fr,{children:sge.map(it=>c.jsx(yt,{value:it,children:it},it))})]})]}),c.jsxs(Nt,{onClick:Kt,variant:"destructive",className:"w-full",disabled:!ke,children:[c.jsx(Jk,{className:"h-4 w-4 mr-2"}),"Posto Vago"]})]})]})})]})},JP=e=>1,hge=()=>{var fs,ms;const e=Id(),[t,r]=V.useState(!0),[s,u]=V.useState(""),[f,m]=V.useState("clientes"),[i,S]=V.useState("all"),[E,I]=V.useState("all"),[D,M]=V.useState({}),[R,H]=V.useState(0),[F,U]=V.useState(0),[Y,z]=V.useState(0),[J,ne]=V.useState(0),[me,le]=V.useState(0),[ye,pe]=V.useState([]),[be,ke]=V.useState([]),[Oe,Ee]=V.useState([]),[qe,Qe]=V.useState([]),[gt,Xe]=V.useState(!1),[ct,Me]=V.useState(!1),[mt,Kt]=V.useState(!1),[it,ee]=V.useState(!1),[he,Se]=V.useState(void 0),[Ue,nt]=V.useState(void 0),[dt,Vt]=V.useState(void 0),[zt,Gt]=V.useState(void 0),[jr,Wr]=V.useState(null),[nn,xn]=V.useState(null),[ei,Dn]=V.useState(null),Zr=hr=>{if(!hr)return"";const An=ye.find(fi=>fi.id===hr);return An?An.nome_fantasia||An.razao_social:""};V.useEffect(()=>{Nn(),Pi()},[]);const Nn=async()=>{const{data:{user:hr}}=await tt.auth.getUser();hr||e("/auth")},Pi=async()=>{r(!0);try{await Promise.all([ft(),Rt(),Wt(),Pr(),Sr(),Nr(),Kr(),Zn()])}catch(hr){console.error("Erro ao carregar dados:",hr),bn({title:"Erro",description:"Erro ao carregar dados",variant:"destructive"})}finally{r(!1)}},ft=async()=>{const{data:hr,error:An}=await tt.from("clientes").select("*").order("razao_social");if(An)throw An;const fi=(hr||[]).map(Vi=>{var $n,vi;return{...Vi,id:((vi=($n=Vi.id)==null?void 0:$n.toString)==null?void 0:vi.call($n))??""}});pe(fi)},Rt=async()=>{const{data:hr,error:An}=await tt.from("contratos").select("*").order("negocio");if(An)throw An;const fi=(hr||[]).map(Vi=>{var $n,vi,ii,Ds;return{...Vi,id:((vi=($n=Vi.id)==null?void 0:$n.toString)==null?void 0:vi.call($n))??"",cliente_id:((Ds=(ii=Vi.cliente_id)==null?void 0:ii.toString)==null?void 0:Ds.call(ii))??""}});ke(fi)},Wt=async()=>{const{data:hr,error:An}=await tt.from("unidades").select("*").order("nome");if(An)throw An;Ee(hr||[])},Pr=async()=>{const{data:hr,error:An}=await tt.from("postos_servico").select("*").order("nome");if(An)throw An;if(Qe(hr||[]),hr){const fi=hr.map($n=>$n.id),{data:Vi}=await tt.from("colaboradores").select("posto_servico_id").in("posto_servico_id",fi);if(Vi){const $n={};Vi.forEach(vi=>{vi.posto_servico_id&&($n[vi.posto_servico_id]=($n[vi.posto_servico_id]||0)+1)}),M($n)}}},Sr=async()=>{const{count:hr,error:An}=await tt.from("ordens_servico").select("id",{count:"exact",head:!0}).eq("status","aberta");if(An)throw An;H(hr||0)},Nr=async()=>{const{data:hr,error:An}=await tt.from("chamados").select("sla_horas, avaliacao").eq("status","concluido").not("avaliacao","is",null);if(An)throw An;if(hr&&hr.length>0){const fi=hr.map($n=>$n.sla_horas).filter($n=>typeof $n=="number"),Vi=hr.map($n=>$n.avaliacao).filter($n=>typeof $n=="number");if(fi.length>0){const $n=fi.reduce((vi,ii)=>vi+ii,0);U(Math.round($n/fi.length*100)/100)}if(Vi.length>0){const $n=Vi.reduce((vi,ii)=>vi+ii,0);z(Math.round($n/Vi.length*10)/10)}}else U(0),z(0)},Kr=async()=>{const{count:hr,error:An}=await tt.from("checklist").select("id",{count:"exact",head:!0});if(An)throw An;ne(hr||0)},Zn=async()=>{const{count:hr,error:An}=await tt.from("inspecoes").select("id",{count:"exact",head:!0});if(An)throw An;le(hr||0)},Yn=ye.filter(hr=>{const An=s.toLowerCase();return hr.razao_social.toLowerCase().includes(An)||(hr.nome_fantasia?hr.nome_fantasia.toLowerCase().includes(An):!1)||hr.cnpj.includes(s)}),Zt=jr?be.filter(hr=>hr.cliente_id===jr):be.filter(hr=>hr.negocio.toLowerCase().includes(s.toLowerCase())||String(hr.conq_perd).includes(s)),en=nn?Oe.filter(hr=>hr.contrato_id===nn):Oe.filter(hr=>hr.nome.toLowerCase().includes(s.toLowerCase())),Sn=ei?qe.filter(hr=>{const An=hr.unidade_id===ei,fi=hr.nome.toLowerCase().includes(s.toLowerCase());if(E==="all")return An&&fi;const Vi=D[hr.id]||0,$n=JP(),vi=Vi>=$n;return An&&fi&&(E==="ocupado"?vi:!vi)}):qe.filter(hr=>{const An=hr.nome.toLowerCase().includes(s.toLowerCase()),fi=i==="all"||hr.unidade_id===i;if(E==="all")return An&&fi;const Vi=D[hr.id]||0,$n=JP(),vi=Vi>=$n;return An&&fi&&(E==="ocupado"?vi:!vi)});return t?c.jsx("div",{className:"min-h-screen flex items-center justify-center",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):c.jsx(Wa,{children:c.jsxs("div",{className:"min-h-screen bg-background",children:[c.jsx("header",{className:"border-b bg-card shadow-sm",children:c.jsx("div",{className:"container mx-auto px-4 py-4",children:c.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-start",children:[c.jsx("div",{className:"p-2 bg-gradient-to-br from-primary to-accent rounded-lg",children:c.jsx(cm,{className:"h-6 w-6 text-primary-foreground"})}),c.jsxs("div",{children:[c.jsx("h1",{className:"text-xl font-bold",children:"Gesto de Contratos"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Hierarquia: Cliente  Contrato  Unidade  Posto"})]})]})})}),c.jsxs("main",{className:"container mx-auto px-4 py-8",children:[c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-8",children:[c.jsx($r,{children:c.jsxs(Xn,{className:"pb-3 text-center flex flex-col items-center gap-2",children:[c.jsx(of,{className:"h-5 w-5 text-primary"}),c.jsx(ti,{className:"text-sm font-medium text-muted-foreground",children:"Total Clientes"}),c.jsx("p",{className:"text-2xl font-bold",children:ye.length})]})}),c.jsx($r,{children:c.jsxs(Xn,{className:"pb-3 text-center flex flex-col items-center gap-2",children:[c.jsx(i8,{className:"h-5 w-5 text-emerald-600"}),c.jsx(ti,{className:"text-sm font-medium text-muted-foreground",children:"Checklists Ativos"}),c.jsx("p",{className:"text-2xl font-bold text-emerald-600",children:J})]})}),c.jsx($r,{children:c.jsxs(Xn,{className:"pb-3 text-center flex flex-col items-center gap-2",children:[c.jsx(Pee,{className:"h-5 w-5 text-indigo-600"}),c.jsx(ti,{className:"text-sm font-medium text-muted-foreground",children:"Inspees Registradas"}),c.jsx("p",{className:"text-2xl font-bold text-indigo-600",children:me})]})}),c.jsx($r,{children:c.jsxs(Xn,{className:"pb-3 text-center flex flex-col items-center gap-2",children:[c.jsx(oR,{className:"h-5 w-5 text-blue-600"}),c.jsx(ti,{className:"text-sm font-medium text-muted-foreground",children:"Chamados: NPS Mdio Geral"}),c.jsx("p",{className:"text-2xl font-bold text-blue-600",children:Y>0?Y.toFixed(1):"0"})]})}),c.jsx($r,{children:c.jsxs(Xn,{className:"pb-3 text-center flex flex-col items-center gap-2",children:[c.jsx(Sm,{className:"h-5 w-5 text-orange-600"}),c.jsx(ti,{className:"text-sm font-medium text-muted-foreground",children:"OS Abertas"}),c.jsx("p",{className:"text-2xl font-bold text-orange-600",children:R})]})})]}),(jr||nn||ei)&&c.jsxs("div",{className:"mb-4 flex items-center gap-2 text-sm",children:[c.jsx(Nt,{variant:"link",size:"sm",onClick:()=>{Wr(null),xn(null),Dn(null),m("clientes")},children:"Clientes"}),jr&&c.jsxs(c.Fragment,{children:[c.jsx("span",{children:"/"}),c.jsx(Nt,{variant:"link",size:"sm",onClick:()=>{xn(null),Dn(null),m("contratos")},children:Zr(jr)})]}),nn&&c.jsxs(c.Fragment,{children:[c.jsx("span",{children:"/"}),c.jsx(Nt,{variant:"link",size:"sm",onClick:()=>{Dn(null),m("unidades")},children:(fs=be.find(hr=>hr.id===nn))==null?void 0:fs.negocio})]}),ei&&c.jsxs(c.Fragment,{children:[c.jsx("span",{children:"/"}),c.jsx("span",{className:"text-muted-foreground",children:(ms=Oe.find(hr=>hr.id===ei))==null?void 0:ms.nome})]})]}),c.jsxs(sM,{value:f,onValueChange:m,children:[c.jsxs(vA,{className:"grid w-full grid-cols-4",children:[c.jsx(nf,{value:"clientes",children:"Clientes"}),c.jsx(nf,{value:"contratos",children:"Contratos"}),c.jsx(nf,{value:"unidades",children:"Unidades"}),c.jsx(nf,{value:"postos",children:"Postos"})]}),c.jsxs(sf,{value:"clientes",className:"space-y-4",children:[c.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[c.jsxs("div",{className:"relative flex-1 w-full md:max-w-sm",children:[c.jsx(gd,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),c.jsx(xr,{placeholder:"Buscar cliente...",value:s,onChange:hr=>u(hr.target.value),className:"pl-10"})]}),c.jsxs(Nt,{className:"w-full md:w-auto",onClick:()=>Xe(!0),children:[c.jsx(Sc,{className:"h-4 w-4 mr-2"}),"Novo Cliente"]})]}),gt&&c.jsx(epe,{clienteId:he,onClose:()=>{Xe(!1),Se(void 0)},onSuccess:()=>{ft(),Xe(!1),Se(void 0)}}),c.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4",children:Yn.map(hr=>c.jsx(Spe,{cliente:hr,onSelect:()=>{Wr(hr.id),m("contratos")},onEdit:()=>{Se(hr.id),Xe(!0)},onDelete:()=>ft()},hr.id))}),Yn.length===0&&c.jsx($r,{children:c.jsxs(_n,{className:"flex flex-col items-center justify-center py-12",children:[c.jsx(Lx,{className:"h-12 w-12 text-muted-foreground mb-4"}),c.jsx("p",{className:"text-muted-foreground",children:"Nenhum cliente encontrado"})]})})]}),c.jsxs(sf,{value:"contratos",className:"space-y-4",children:[c.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[c.jsxs("div",{className:"relative flex-1 w-full md:max-w-sm",children:[c.jsx(gd,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),c.jsx(xr,{placeholder:"Buscar contrato...",value:s,onChange:hr=>u(hr.target.value),className:"pl-10"})]}),c.jsxs(Nt,{className:"w-full md:w-auto",onClick:()=>Me(!0),children:[c.jsx(Sc,{className:"h-4 w-4 mr-2"}),"Novo Contrato"]})]}),ct&&c.jsx(tpe,{contratoId:Ue,clienteId:jr||void 0,onClose:()=>{Me(!1),nt(void 0)},onSuccess:()=>{Rt(),Me(!1),nt(void 0)}}),c.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4",children:Zt.map(hr=>c.jsx(Tpe,{contrato:hr,cliente:ye.find(An=>An.id===hr.cliente_id),onSelect:()=>{xn(hr.id),m("unidades")},onEdit:()=>{nt(hr.id),Me(!0)},onDelete:()=>Rt()},hr.id))}),Zt.length===0&&c.jsx($r,{children:c.jsxs(_n,{className:"flex flex-col items-center justify-center py-12",children:[c.jsx(Lx,{className:"h-12 w-12 text-muted-foreground mb-4"}),c.jsx("p",{className:"text-muted-foreground",children:"Nenhum contrato encontrado"})]})})]}),c.jsxs(sf,{value:"unidades",className:"space-y-4",children:[c.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[c.jsxs("div",{className:"relative flex-1 w-full md:max-w-sm",children:[c.jsx(gd,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),c.jsx(xr,{placeholder:"Buscar unidade...",value:s,onChange:hr=>u(hr.target.value),className:"pl-10"})]}),c.jsxs(Nt,{className:"w-full md:w-auto",onClick:()=>Kt(!0),children:[c.jsx(Sc,{className:"h-4 w-4 mr-2"}),"Nova Unidade"]})]}),mt&&c.jsx(rpe,{unidadeId:dt,contratoId:nn||void 0,onClose:()=>{Kt(!1),Vt(void 0)},onSuccess:()=>{Wt(),Kt(!1),Vt(void 0)}}),c.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4",children:en.map(hr=>c.jsx(Cpe,{unidade:hr,contrato:be.find(An=>An.id===hr.contrato_id),onSelect:()=>{Dn(hr.id),m("postos")},onEdit:()=>{Vt(hr.id),Kt(!0)},onDelete:()=>Wt()},hr.id))}),en.length===0&&c.jsx($r,{children:c.jsxs(_n,{className:"flex flex-col items-center justify-center py-12",children:[c.jsx(Lx,{className:"h-12 w-12 text-muted-foreground mb-4"}),c.jsx("p",{className:"text-muted-foreground",children:"Nenhuma unidade encontrada"})]})})]}),c.jsxs(sf,{value:"postos",className:"space-y-4",children:[c.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between",children:[c.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center lg:gap-2 flex-1",children:[c.jsxs("div",{className:"relative flex-1 w-full lg:max-w-sm",children:[c.jsx(gd,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),c.jsx(xr,{placeholder:"Buscar posto...",value:s,onChange:hr=>u(hr.target.value),className:"pl-10"})]}),!ei&&c.jsxs(Lr,{value:i,onValueChange:S,children:[c.jsx(Or,{className:"w-full lg:w-[250px]",children:c.jsx(zr,{placeholder:"Filtrar por unidade"})}),c.jsxs(Fr,{className:"bg-popover z-50",children:[c.jsx(yt,{value:"all",children:"Todas as unidades"}),Oe.map(hr=>c.jsx(yt,{value:hr.id,children:hr.nome},hr.id))]})]}),c.jsxs(Lr,{value:E,onValueChange:I,children:[c.jsx(Or,{className:"w-full lg:w-[200px]",children:c.jsx(zr,{placeholder:"Filtrar por ocupao"})}),c.jsxs(Fr,{className:"bg-popover z-50",children:[c.jsx(yt,{value:"all",children:"Todos os postos"}),c.jsx(yt,{value:"ocupado",children:"Ocupados"}),c.jsx(yt,{value:"vago",children:"Vagos"})]})]})]}),c.jsxs(Nt,{className:"w-full lg:w-auto",onClick:()=>ee(!0),children:[c.jsx(Sc,{className:"h-4 w-4 mr-2"}),"Novo Posto"]})]}),it&&c.jsx(cpe,{postoId:zt,unidadeId:ei||void 0,onClose:()=>{ee(!1),Gt(void 0)},onSuccess:()=>{Pr(),ee(!1),Gt(void 0)}}),c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Sn.map(hr=>c.jsx(dge,{posto:hr,unidade:Oe.find(An=>An.id===hr.unidade_id),onEdit:()=>{Gt(hr.id),ee(!0)},onDelete:()=>Pr()},hr.id))}),Sn.length===0&&c.jsx($r,{children:c.jsxs(_n,{className:"flex flex-col items-center justify-center py-12",children:[c.jsx(Lx,{className:"h-12 w-12 text-muted-foreground mb-4"}),c.jsx("p",{className:"text-muted-foreground",children:"Nenhum posto encontrado"})]})})]})]})]})]})})},fE=async({postoId:e,colaboradorId:t,data:r,usuarioId:s=null})=>{const{error:u}=await tt.rpc("agendar_ocupacao_posto",{p_posto_servico_id:e,p_colaborador_id:t,p_data:r,p_usuario_id:s});if(u)throw u},fge=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:2}),Yd=e=>{const[t,r,s]=e.split("-").map(Number);return new Date(t,(r||1)-1,s||1)},pge=e=>(e==null?void 0:e.toLowerCase().trim())==="posto vago";function mge({open:e,onClose:t}){var Ua,Us;const[r,s]=V.useState(!0),[u,f]=V.useState([]),[m,i]=V.useState([]),[S,E]=V.useState([]),[I,D]=V.useState([]),[M,R]=V.useState("all"),[H,F]=V.useState(void 0),[U,Y]=V.useState("all"),[z,J]=V.useState([]),[ne,me]=V.useState(!1),[le,ye]=V.useState(null),[pe,be]=V.useState(""),[ke,Oe]=V.useState(!1),[Ee,qe]=V.useState(!1),[Qe,gt]=V.useState(null),[Xe,ct]=V.useState(""),[Me,mt]=V.useState(!1),[Kt,it]=V.useState(!1),[ee,he]=V.useState(null),[Se,Ue]=V.useState([]),[nt,dt]=V.useState(""),[Vt,zt]=V.useState(""),[Gt,jr]=V.useState(!1),[Wr,nn]=V.useState(!1),[xn,ei]=V.useState(null),[Dn,Zr]=V.useState(""),[Nn,Pi]=V.useState(!1),ft=Tm();V.useEffect(()=>{e&&Rt(),e||(me(!1),ye(null),be(""),qe(!1),gt(null),ct(""),mt(!1),it(!1),he(null),Ue([]),dt(""),zt(""),jr(!1),nn(!1),ei(null),Zr(""),Pi(!1))},[e]);const Rt=async()=>{s(!0);try{await Promise.all([Pr(),Sr(),Wt(),Nr(),Kr()])}catch(Ot){bn({title:"Erro ao carregar dados",description:Ot.message,variant:"destructive"})}finally{s(!1)}},Wt=async()=>{const{data:Ot,error:Hr}=await tt.from("postos_servico").select("id, nome").in("status",["vago","vago_temporariamente"]).order("nome");if(Hr)throw Hr;J(Ot||[])},Pr=async()=>{var vn,ai,At;const{data:Ot,error:Hr}=await tt.from("postos_servico").select(`
        id,
        nome,
        funcao,
        escala,
        unidade_id,
        unidades (
          id,
          nome,
          contratos (
            negocio,
            conq_perd
          )
        )
      `).in("status",["vago","vago_temporariamente"]);if(Hr)throw Hr;const hn=[];for(const $i of Ot||[]){const{data:ha}=await tt.from("colaboradores").select("id").eq("posto_servico_id",$i.id).eq("status_colaborador","ativo"),pt=(ha==null?void 0:ha.length)||0,lt=JP();pt<lt&&hn.push({id:$i.id,nome:$i.nome,funcao:$i.funcao,efetivo_planejado:lt,efetivo_atual:pt,unidadeId:$i.unidade_id,unidade:{id:((vn=$i.unidades)==null?void 0:vn.id)??null,nome:((ai=$i.unidades)==null?void 0:ai.nome)||"Sem unidade",contrato:(At=$i.unidades)!=null&&At.contratos?{negocio:$i.unidades.contratos.negocio,conq_perd:$i.unidades.contratos.conq_perd}:null}})}f(hn)},Sr=async()=>{const{data:Ot,error:Hr}=await tt.from("posto_dias_vagos").select(`
        id,
        data,
        motivo,
        posto_servico_id,
        postos_servico (
          id,
          nome,
          valor_diaria,
          unidades (
            nome,
            contratos (
              negocio,
              conq_perd
            )
          )
        ),
        colaboradores (
          nome_completo,
          cargo
        ),
        diarias:diarias_posto_dia_vago_id_fkey (
          id,
          status,
          valor,
          diaristas (
            id,
            nome_completo,
            telefone
          )
        )
      `).gte("data",new Date().toISOString().split("T")[0]).order("data");if(Hr)throw Hr;const vn=(Ot||[]).map(ai=>{var At,$i,ha,pt,lt,Er,Jr,Ae;return{id:ai.id,data:ai.data,motivo:ai.motivo,postoId:ai.posto_servico_id,posto:{id:(At=ai.postos_servico)==null?void 0:At.id,nome:(($i=ai.postos_servico)==null?void 0:$i.nome)||"Desconhecido",valor_diaria:((ha=ai.postos_servico)==null?void 0:ha.valor_diaria)??null,unidade:{nome:((lt=(pt=ai.postos_servico)==null?void 0:pt.unidades)==null?void 0:lt.nome)||"Sem unidade",contrato:(Jr=(Er=ai.postos_servico)==null?void 0:Er.unidades)!=null&&Jr.contratos?{negocio:ai.postos_servico.unidades.contratos.negocio,conq_perd:ai.postos_servico.unidades.contratos.conq_perd}:null}},colaborador:ai.colaboradores?{nome_completo:ai.colaboradores.nome_completo,cargo:ai.colaboradores.cargo||"Sem cargo"}:null,diarias:((Ae=ai.diarias)==null?void 0:Ae.map(ue=>({id:ue.id,status:ue.status,valor:ue.valor||0,diarista:ue.diaristas?{id:ue.diaristas.id,nome_completo:ue.diaristas.nome_completo,telefone:ue.diaristas.telefone}:void 0})))||[]}}).filter(ai=>ai.diarias.length===0);i(vn)},Nr=async()=>{const{data:Ot,error:Hr}=await tt.from("colaboradores").select("id, nome_completo, cargo").is("posto_servico_id",null).eq("status_colaborador","ativo").order("nome_completo");if(Hr)throw Hr;const hn=(Ot||[]).map(vn=>({id:vn.id,nome_completo:vn.nome_completo,cargo:vn.cargo||"Sem cargo",funcao:vn.cargo||"Sem funo"}));E(hn)},Kr=async()=>{const{data:Ot,error:Hr}=await tt.from("diaristas").select("id, nome_completo, telefone, cidade").eq("status","ativo").order("nome_completo");if(Hr)throw Hr;D(Ot||[])},Zn=Ot=>{ye(Ot),be(""),me(!0)},Yn=()=>{me(!1),ye(null),be("")},Zt=Ot=>{gt(Ot),ct(""),qe(!0)},en=()=>{qe(!1),gt(null),ct("")},Sn=async()=>{if(Qe){if(!Xe){bn({title:"Selecione um colaborador",description:"Escolha um colaborador de reserva para ocupar este dia.",variant:"destructive"});return}if(!Qe.postoId){bn({title:"Posto no encontrado",description:"No foi possvel identificar o posto deste dia.",variant:"destructive"});return}mt(!0);try{const{data:{user:Ot}}=await tt.auth.getUser();if(!Ot)throw new Error("Usurio no autenticado");await fE({postoId:Qe.postoId,colaboradorId:Xe,data:Qe.data,usuarioId:Ot.id});const Hr=S.find(hn=>hn.id===Xe);bn({title:"Ocupao agendada",description:Hr?`${Hr.nome_completo} iniciar em ${Ii(Yd(Qe.data),"dd/MM/yyyy",{locale:ia})}.`:"Ocupao confirmada para o dia selecionado."}),en(),await Promise.all([Sr(),Pr(),Wt(),Nr()])}catch(Ot){bn({title:"Erro ao agendar ocupao",description:(Ot==null?void 0:Ot.message)||"No foi possvel agendar a ocupao.",variant:"destructive"})}finally{mt(!1)}}},fs=async Ot=>{he(Ot),it(!0),zt(""),dt("");try{const Hr=new Date().toISOString().split("T")[0],{data:hn,error:vn}=await tt.from("dias_trabalho").select("data").eq("posto_servico_id",Ot.id).is("colaborador_id",null).gte("data",Hr).order("data");if(vn)throw vn;const ai=(hn==null?void 0:hn.map(At=>At.data))??[];Ue(ai),ai.length>0&&dt(ai[0])}catch(Hr){bn({title:"Erro ao carregar datas",description:(Hr==null?void 0:Hr.message)||"No foi possvel listar os dias disponveis.",variant:"destructive"}),Ue([])}},ms=()=>{it(!1),he(null),Ue([]),zt(""),dt("")},hr=async()=>{if(ee){if(!Vt){bn({title:"Selecione um colaborador",description:"Escolha um colaborador de reserva para assumir o posto.",variant:"destructive"});return}if(!nt){bn({title:"Selecione uma data",description:"Escolha um dia disponvel da agenda do posto.",variant:"destructive"});return}jr(!0);try{const{data:{user:Ot}}=await tt.auth.getUser();if(!Ot)throw new Error("Usurio no autenticado");await fE({postoId:ee.id,colaboradorId:Vt,data:nt,usuarioId:Ot.id});const Hr=S.find(hn=>hn.id===Vt);bn({title:"Ocupao agendada",description:Hr?`${Hr.nome_completo} iniciar em ${Ii(Yd(nt),"dd/MM/yyyy",{locale:ia})}.`:"Ocupao confirmada para a data selecionada."}),ms(),await Promise.all([Pr(),Sr(),Nr()])}catch(Ot){bn({title:"Erro ao agendar ocupao",description:(Ot==null?void 0:Ot.message)||"No foi possvel agendar a ocupao.",variant:"destructive"})}finally{jr(!1)}}},An=Ot=>{ei(Ot),Zr(""),nn(!0)},fi=()=>{nn(!1),ei(null),Zr("")},Vi=async()=>{if(xn){if(!Dn){bn({title:"Selecione um colaborador",description:"Escolha um colaborador de reserva para assumir o posto.",variant:"destructive"});return}Pi(!0);try{const{data:{user:Ot}}=await tt.auth.getUser();if(!Ot)throw new Error("Usurio no autenticado");const Hr=new Date().toISOString().split("T")[0];let hn=Hr;const{data:vn,error:ai}=await tt.from("dias_trabalho").select("data").eq("posto_servico_id",xn.id).gte("data",Hr).order("data").limit(1);if(ai)throw ai;vn&&vn.length>0&&(hn=vn[0].data),await fE({postoId:xn.id,colaboradorId:Dn,data:hn,usuarioId:Ot.id});const At=S.find($i=>$i.id===Dn);bn({title:"Posto atribudo",description:At?`${At.nome_completo} foi alocado ao posto ${xn.nome} a partir de ${Ii(Yd(hn),"dd/MM/yyyy",{locale:ia})}.`:"Posto atribudo com sucesso."}),fi(),await Promise.all([Pr(),Sr(),Nr(),Wt()]);try{await ft.invalidateQueries({queryKey:["colaboradores"]}),await ft.invalidateQueries({queryKey:["postos-disponiveis-agendamento"]})}catch{}}catch(Ot){bn({title:"Erro ao atribuir posto",description:(Ot==null?void 0:Ot.message)||"No foi possvel concluir a atribuio.",variant:"destructive"})}finally{Pi(!1)}}},$n=async()=>{var Ot,Hr;if(le){if(!pe){bn({title:"Selecione um diarista",description:"Escolha um diarista para registrar a diria.",variant:"destructive"});return}Oe(!0);try{const hn=le,{data:vn,error:ai}=await tt.from("diarias").select(`
            id,
            posto_dia_vago:posto_dia_vago_id (
              data
            )
          `).eq("diarista_id",pe).eq("posto_dia_vago.data",hn.data).limit(1);if(ai)throw ai;if(vn&&vn.length>0){bn({title:"Conflito de data",description:"Este diarista j possui uma diria cadastrada para esta data.",variant:"destructive"}),Oe(!1);return}const At={posto_dia_vago_id:hn.id,diarista_id:pe};((Ot=hn.posto)==null?void 0:Ot.valor_diaria)!==void 0&&((Hr=hn.posto)==null?void 0:Hr.valor_diaria)!==null&&(At.valor=hn.posto.valor_diaria);const{error:$i}=await tt.from("diarias").insert(At);if($i)throw $i;bn({title:"Diria cadastrada",description:"Diarista vinculado ao dia selecionado."}),Yn(),await Sr()}catch(hn){bn({title:"Erro ao cadastrar diria",description:(hn==null?void 0:hn.message)||"No foi possvel registrar a diria.",variant:"destructive"})}finally{Oe(!1)}}},vi=u.filter(Ot=>!(M!=="all"&&Ot.id!==M)),ii=m.filter(Ot=>{if(M!=="all"){const Hr=z.find(hn=>hn.id===M);if(Hr&&Ot.posto.id!==Hr.id)return!1}if(H){const Hr=Yd(Ot.data);if(Hr.getDate()!==H.getDate()||Hr.getMonth()!==H.getMonth()||Hr.getFullYear()!==H.getFullYear())return!1}return!(U!=="all"&&Ot.data!==U)}),Ds=Array.from(new Set(m.map(Ot=>Ot.data))).sort();return c.jsx(Bs,{open:e,onOpenChange:t,children:c.jsxs(Is,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[c.jsxs(Ns,{children:[c.jsxs(ks,{className:"text-2xl flex items-center gap-2",children:[c.jsx(Lx,{className:"h-6 w-6 text-orange-500"}),"Gesto de Cobertura"]}),c.jsx(La,{children:"Monitore postos vagos e dias com ausncias programadas"})]}),c.jsxs("div",{className:"space-y-6",children:[c.jsxs($r,{children:[c.jsx(Xn,{children:c.jsx(ti,{className:"text-lg",children:"Filtros"})}),c.jsxs(_n,{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Posto"}),c.jsxs(Lr,{value:M,onValueChange:R,children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Todos os postos"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"all",children:"Todos os postos"}),z.map(Ot=>c.jsx(yt,{value:Ot.id,children:Ot.nome},Ot.id))]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Data"}),c.jsx(mM,{mode:"single",selected:H,onSelect:F,className:"border rounded-md",locale:ia})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Filtrar por dia especfico"}),c.jsxs(Lr,{value:U,onValueChange:Y,children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Todos os dias"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"all",children:"Todos os dias"}),Ds.map(Ot=>c.jsx(yt,{value:Ot,children:Ii(Yd(Ot),"dd/MM/yyyy",{locale:ia})},Ot))]})]})]})]})]}),c.jsxs($r,{children:[c.jsxs(Xn,{children:[c.jsxs(ti,{className:"flex items-center gap-2",children:[c.jsx(of,{className:"h-5 w-5 text-red-500"}),"Postos Vagos (",vi.length,")"]}),c.jsx(Gs,{children:"Postos com vagas no preenchidas"})]}),c.jsx(_n,{children:r?c.jsx("p",{className:"text-sm text-muted-foreground",children:"Carregando..."}):vi.length===0?c.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum posto vago encontrado"}):c.jsxs("div",{className:"space-y-3",children:[vi.map(Ot=>c.jsx($r,{className:"border-red-200 bg-red-100 dark:bg-red-900/50 dark:border-red-800",children:c.jsxs(_n,{className:"p-4",children:[c.jsx("div",{className:"flex items-start justify-between",children:c.jsxs("div",{className:"flex-1",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[c.jsx("h4",{className:"font-semibold",children:Ot.nome}),c.jsx(Oi,{variant:"outline",children:Ot.nome})]}),c.jsxs("div",{className:"space-y-1 mb-2",children:[Ot.unidade.contrato&&c.jsxs("p",{className:"text-sm text-muted-foreground",children:[c.jsx("span",{className:"font-medium",children:"Contrato:"})," ",Ot.unidade.contrato.negocio," (",Ot.unidade.contrato.conq_perd,")"]}),c.jsxs("p",{className:"text-sm text-muted-foreground",children:[c.jsx("span",{className:"font-medium",children:"Unidade:"})," ",Ot.unidade.nome,"  ",Ot.funcao]})]}),c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("div",{className:"text-sm",children:[c.jsx("span",{className:"text-muted-foreground",children:"Efetivo atual: "}),c.jsx("span",{className:"font-medium text-red-500",children:Ot.efetivo_atual})]}),c.jsxs("div",{className:"text-sm",children:[c.jsx("span",{className:"text-muted-foreground",children:"Efetivo necessrio: "}),c.jsx("span",{className:"font-medium",children:Ot.efetivo_planejado})]}),c.jsxs(Oi,{variant:"destructive",children:["Faltam ",Ot.efetivo_planejado-Ot.efetivo_atual," colaboradores"]})]})]})}),c.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[c.jsx(Nt,{variant:"outline",size:"sm",onClick:()=>fs(Ot),disabled:S.length===0,title:S.length===0?"Nenhum colaborador de reserva disponvel":"Agendar ocupao para este posto",children:"Agendar ocupao"}),c.jsx(Nt,{variant:"secondary",size:"sm",onClick:()=>An(Ot),disabled:S.length===0,title:S.length===0?"Nenhum colaborador de reserva disponvel":"Atribuir posto diretamente a um colaborador",children:"Atribuir posto"})]})]})},Ot.id)),S.length>0&&c.jsxs("div",{className:"mt-6 pt-6 border-t",children:[c.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[c.jsx(of,{className:"h-5 w-5 text-green-500"}),"Reservas Tcnicas Disponveis (",S.length,")"]}),c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:S.map(Ot=>c.jsx($r,{className:"border-green-200",children:c.jsx(_n,{className:"p-3",children:c.jsxs("div",{children:[c.jsx("h4",{className:"font-semibold text-sm mb-1",children:Ot.nome_completo}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Oi,{variant:"secondary",className:"text-xs",children:Ot.cargo}),c.jsx(Oi,{variant:"outline",className:"text-xs bg-green-50",children:"Disponvel"})]})]})})},Ot.id))})]})]})})]}),c.jsxs($r,{children:[c.jsxs(Xn,{children:[c.jsxs(ti,{className:"flex items-center gap-2",children:[c.jsx(Dee,{className:"h-5 w-5 text-orange-500"}),"Dias Vagos (",ii.length,")"]}),c.jsx(Gs,{children:"Dias com ausncias programadas de colaboradores"})]}),c.jsx(_n,{children:r?c.jsx("p",{className:"text-sm text-muted-foreground",children:"Carregando..."}):ii.length===0?c.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum dia vago encontrado"}):c.jsxs("div",{className:"space-y-3",children:[ii.map(Ot=>{const Hr=pge(Ot.motivo);return c.jsx($r,{className:"border-orange-200 bg-orange-100 dark:bg-orange-900/50 dark:border-orange-800",children:c.jsx(_n,{className:"p-4",children:c.jsxs("div",{className:"flex items-start justify-between gap-4",children:[c.jsxs("div",{className:"flex-1",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[c.jsx("h4",{className:"font-semibold",children:Ii(Yd(Ot.data),"dd 'de' MMMM 'de' yyyy",{locale:ia})}),c.jsx(Oi,{variant:"outline",children:Ot.posto.nome})]}),c.jsxs("div",{className:"space-y-1 mb-2",children:[Ot.posto.unidade.contrato&&c.jsxs("p",{className:"text-sm text-muted-foreground",children:[c.jsx("span",{className:"font-medium",children:"Contrato:"})," ",Ot.posto.unidade.contrato.negocio," (",Ot.posto.unidade.contrato.conq_perd,")"]}),c.jsxs("p",{className:"text-sm text-muted-foreground",children:[c.jsx("span",{className:"font-medium",children:"Unidade:"})," ",Ot.posto.unidade.nome,"  ",Ot.posto.nome]})]}),Ot.colaborador?c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"text-sm",children:[c.jsx("span",{className:"text-muted-foreground",children:"Colaborador: "}),c.jsx("span",{className:"font-medium",children:Ot.colaborador.nome_completo})]}),c.jsxs("div",{className:"text-sm",children:[c.jsx("span",{className:"text-muted-foreground",children:"Cargo: "}),c.jsx("span",{className:"font-medium",children:Ot.colaborador.cargo})]})]}):c.jsx("p",{className:"text-sm text-muted-foreground italic",children:"Sem colaborador atribudo"}),Ot.motivo&&c.jsxs("div",{className:"mt-2 text-sm",children:[c.jsx("span",{className:"text-muted-foreground",children:"Motivo: "}),c.jsx(Oi,{variant:"secondary",children:Ot.motivo==="falta_justificada"?"Falta Justificada":Ot.motivo==="falta_injustificada"?"Falta Injustificada":Ot.motivo==="pedido"?"Pedido":Ot.motivo==="afastamento_inss"?"Afastamento INSS":Ot.motivo==="folga"?"Folga":Ot.motivo==="ferias"?"Frias":Ot.motivo==="suspensao"?"Suspenso":Ot.motivo})]}),c.jsx("div",{className:"mt-3",children:Ot.diarias.length>0?c.jsxs("div",{className:"space-y-2",children:[c.jsxs("p",{className:"text-sm font-medium",children:["Diarias cadastradas (",Ot.diarias.length,")"]}),c.jsx("div",{className:"space-y-2",children:Ot.diarias.map(hn=>{var vn;return c.jsxs("div",{className:"rounded-md border px-3 py-2 text-sm",children:[c.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[c.jsx(Oi,{variant:"outline",children:hn.status}),c.jsx("span",{className:"font-semibold",children:fge.format(Number(hn.valor)||0)})]}),hn.diarista&&c.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Diarista: ",hn.diarista.nome_completo,hn.diarista.telefone?c.jsxs("span",{children:[" - ",hn.diarista.telefone]}):null]}),c.jsxs("div",{className:"mt-2 text-xs text-muted-foreground space-y-1",children:[c.jsxs("p",{children:["Data:"," ",Ii(Yd(Ot.data),"dd/MM/yyyy",{locale:ia})]}),c.jsxs("p",{children:["Posto: ",Ot.posto.nome]}),c.jsxs("p",{children:["Unidade: ",((vn=Ot.posto.unidade)==null?void 0:vn.nome)||"Sem unidade"]}),c.jsxs("p",{children:["Motivo do dia: ",Ot.motivo||"No informado"]})]})]},hn.id)})})]}):c.jsx("p",{className:"text-xs text-muted-foreground",children:"Nenhuma diaria cadastrada para este dia"})})]}),c.jsxs("div",{className:"flex w-full flex-col gap-2 sm:w-auto",children:[c.jsx(Nt,{variant:"outline",size:"sm",onClick:()=>Zn(Ot),children:"Cadastrar diria"}),Hr&&c.jsx(Nt,{variant:"secondary",size:"sm",onClick:()=>Zt(Ot),disabled:S.length===0,title:S.length===0?"Nenhum colaborador de reserva disponvel":"Agendar ocupao para este dia",children:"Agendar ocupao"})]})]})})},Ot.id)}),I.length>0&&c.jsxs("div",{className:"mt-6 pt-6 border-t",children:[c.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[c.jsx(of,{className:"h-5 w-5 text-blue-500"}),"Diaristas Disponveis (",I.length,")"]}),c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:I.map(Ot=>c.jsx($r,{className:"border-blue-200",children:c.jsx(_n,{className:"p-3",children:c.jsxs("div",{children:[c.jsx("h4",{className:"font-semibold text-sm mb-2",children:Ot.nome_completo}),c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[c.jsx("span",{className:"text-muted-foreground",children:"Telefone:"}),c.jsx("span",{className:"font-medium",children:Ot.telefone})]}),c.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[c.jsx("span",{className:"text-muted-foreground",children:"Cidade:"}),c.jsx("span",{className:"font-medium",children:Ot.cidade||"No informada"})]})]}),c.jsx(Oi,{variant:"outline",className:"text-xs bg-blue-50 mt-2",children:"Diarista"})]})})},Ot.id))})]})]})})]})]}),c.jsx(Bs,{open:ne,onOpenChange:Ot=>Ot?null:Yn(),children:c.jsxs(Is,{children:[c.jsxs(Ns,{children:[c.jsx(ks,{children:"Registrar diria para o dia selecionado"}),c.jsx(La,{children:"Escolha um diarista disponvel para assumir o dia vago informado. O sistema impede duplicidades na mesma data."})]}),le?c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"rounded-md border bg-muted/40 p-3 text-sm text-muted-foreground space-y-1",children:[c.jsxs("p",{children:[c.jsx("span",{className:"font-medium text-foreground",children:"Data:"})," ",Ii(Yd(le.data),"dd/MM/yyyy",{locale:ia})]}),c.jsxs("p",{children:[c.jsx("span",{className:"font-medium text-foreground",children:"Posto:"})," ",le.posto.nome]}),c.jsxs("p",{children:[c.jsx("span",{className:"font-medium text-foreground",children:"Unidade:"})," ",((Ua=le.posto.unidade)==null?void 0:Ua.nome)||"Sem unidade"]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("label",{className:"text-sm font-medium",children:"Selecionar diarista"}),c.jsxs(Lr,{value:pe,onValueChange:be,children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione um diarista"})}),c.jsx(Fr,{children:I.length===0?c.jsx(yt,{value:"",disabled:!0,children:"Nenhum diarista dispon\\u00edvel"}):I.map(Ot=>c.jsxs(yt,{value:Ot.id,children:[Ot.nome_completo,Ot.cidade?` - ${Ot.cidade}`:""]},Ot.id))})]})]})]}):c.jsx("p",{className:"text-sm text-muted-foreground",children:"Selecione um dia vago para registrar a diria."}),c.jsxs(_d,{children:[c.jsx(Nt,{type:"button",variant:"outline",onClick:Yn,children:"Cancelar"}),c.jsx(Nt,{type:"button",onClick:$n,disabled:!le||!pe||ke,children:ke?"Salvando...":"Registrar diria"})]})]})}),c.jsx(Bs,{open:Ee,onOpenChange:Ot=>Ot?null:en(),children:c.jsxs(Is,{children:[c.jsxs(Ns,{children:[c.jsx(ks,{children:"Agendar ocupao para o dia selecionado"}),c.jsx(La,{children:"Escolha um colaborador de reserva para iniciar no posto na data escolhida."})]}),Qe?c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"rounded-md border bg-muted/40 p-3 text-sm text-muted-foreground space-y-1",children:[c.jsxs("p",{children:[c.jsx("span",{className:"font-medium text-foreground",children:"Data:"})," ",Ii(Yd(Qe.data),"dd/MM/yyyy",{locale:ia})]}),c.jsxs("p",{children:[c.jsx("span",{className:"font-medium text-foreground",children:"Posto:"})," ",Qe.posto.nome]}),c.jsxs("p",{children:[c.jsx("span",{className:"font-medium text-foreground",children:"Unidade:"})," ",((Us=Qe.posto.unidade)==null?void 0:Us.nome)||"Sem unidade"]})]}),S.length===0?c.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum colaborador de reserva disponvel no momento."}):c.jsxs("div",{className:"space-y-2",children:[c.jsx("label",{className:"text-sm font-medium",children:"Selecionar colaborador"}),c.jsxs(Lr,{value:Xe,onValueChange:ct,children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione um colaborador"})}),c.jsx(Fr,{children:S.map(Ot=>c.jsxs(yt,{value:Ot.id,children:[Ot.nome_completo,Ot.cargo?` - ${Ot.cargo}`:""]},Ot.id))})]})]})]}):c.jsx("p",{className:"text-sm text-muted-foreground",children:"Selecione um dia vago para agendar a ocupao."}),c.jsxs(_d,{children:[c.jsx(Nt,{type:"button",variant:"outline",onClick:en,children:"Cancelar"}),c.jsx(Nt,{type:"button",onClick:Sn,disabled:!Qe||!Xe||Me||S.length===0,children:Me?"Agendando...":"Agendar ocupao"})]})]})}),c.jsx(Bs,{open:Kt,onOpenChange:Ot=>Ot?null:ms(),children:c.jsxs(Is,{children:[c.jsxs(Ns,{children:[c.jsx(ks,{children:"Agendar ocupao para o posto"}),c.jsx(La,{children:"Escolha um colaborador de reserva e um dia disponvel da agenda do posto."})]}),ee?c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"rounded-md border bg-muted/40 p-3 text-sm text-muted-foreground space-y-1",children:[c.jsxs("p",{children:[c.jsx("span",{className:"font-medium text-foreground",children:"Posto:"})," ",ee.nome]}),c.jsxs("p",{children:[c.jsx("span",{className:"font-medium text-foreground",children:"Unidade:"})," ",ee.unidade.nome]})]}),S.length===0?c.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum colaborador de reserva disponvel no momento."}):c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx("p",{className:"text-sm font-medium",children:"Colaborador reserva"}),c.jsxs(Lr,{value:Vt,onValueChange:zt,children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione o colaborador"})}),c.jsx(Fr,{children:S.map(Ot=>c.jsxs(yt,{value:Ot.id,children:[Ot.nome_completo,Ot.cargo?` - ${Ot.cargo}`:""]},Ot.id))})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("p",{className:"text-sm font-medium",children:"Dia disponvel"}),c.jsxs(Lr,{value:nt,onValueChange:dt,disabled:Se.length===0,children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:Se.length===0?"Nenhum dia disponvel":"Selecione o dia"})}),c.jsx(Fr,{className:"max-h-56 overflow-y-auto",children:Se.map(Ot=>c.jsx(yt,{value:Ot,children:Ii(Yd(Ot),"dd/MM/yyyy",{locale:ia})},Ot))})]}),Se.length===0&&c.jsx("p",{className:"text-xs text-muted-foreground",children:"Nenhum dia sem colaborador encontrado em dias_trabalho."})]})]})]}):c.jsx("p",{className:"text-sm text-muted-foreground",children:"Selecione um posto vago para agendar a ocupao."}),c.jsxs(_d,{children:[c.jsx(Nt,{type:"button",variant:"outline",onClick:ms,children:"Cancelar"}),c.jsx(Nt,{type:"button",onClick:hr,disabled:!ee||!Vt||!nt||Gt||S.length===0||Se.length===0,children:Gt?"Agendando...":"Agendar ocupao"})]})]})}),c.jsx(Bs,{open:Wr,onOpenChange:Ot=>Ot?null:fi(),children:c.jsxs(Is,{children:[c.jsxs(Ns,{children:[c.jsx(ks,{children:"Atribuir posto ao colaborador"}),c.jsx(La,{children:"Selecionar um colaborador de reserva para assumir imediatamente este posto de servi\\u00e7o."})]}),xn?c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"rounded-md border bg-muted/40 p-3 text-sm text-muted-foreground space-y-1",children:[c.jsxs("p",{children:[c.jsx("span",{className:"font-medium text-foreground",children:"Unidade:"})," ",xn.unidade.nome]}),xn.unidade.contrato&&c.jsxs("p",{children:[c.jsx("span",{className:"font-medium text-foreground",children:"Contrato:"})," ",xn.unidade.contrato.negocio," (",xn.unidade.contrato.conq_perd,")"]})]}),S.length===0?c.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum colaborador de reserva disponvel."}):c.jsxs("div",{className:"space-y-2",children:[c.jsx("p",{className:"text-sm font-medium",children:"Colaborador reserva"}),c.jsxs(Lr,{value:Dn,onValueChange:Zr,children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione o colaborador"})}),c.jsx(Fr,{children:S.map(Ot=>c.jsxs(yt,{value:Ot.id,children:[Ot.nome_completo,Ot.cargo?` - ${Ot.cargo}`:""]},Ot.id))})]})]})]}):c.jsx("p",{className:"text-sm text-muted-foreground",children:"Selecione um posto vago para atribuir."}),c.jsxs(_d,{children:[c.jsx(Nt,{type:"button",variant:"outline",onClick:fi,children:"Cancelar"}),c.jsx(Nt,{type:"button",onClick:Vi,disabled:!xn||!Dn||Nn||S.length===0,children:Nn?"Atribuindo...":"Confirmar atribuio"})]})]})})]})})}const gge=()=>{Id();const e=V.useRef(null),t=V.useRef(null),[r,s]=V.useState([]),[u,f]=V.useState(null),[m,i]=V.useState(!0),[S,E]=V.useState(""),[I,D]=V.useState(!1);V.useEffect(()=>{R(),M();const le=tt.channel("incidentes-changes").on("postgres_changes",{event:"*",schema:"public",table:"incidentes"},()=>{R()}).subscribe(),ye=tt.channel("chamados-changes").on("postgres_changes",{event:"*",schema:"public",table:"chamados"},()=>{R()}).subscribe(),pe=tt.channel("colaboradores-changes").on("postgres_changes",{event:"*",schema:"public",table:"colaboradores"},()=>{R()}).subscribe(),be=tt.channel("postos-servico-changes").on("postgres_changes",{event:"*",schema:"public",table:"postos_servico"},()=>{R()}).subscribe();return()=>{tt.removeChannel(le),tt.removeChannel(ye),tt.removeChannel(pe),tt.removeChannel(be)}},[]);const M=async()=>{try{const{data:le,error:ye}=await tt.functions.invoke("get-mapbox-token");if(ye)throw ye;le!=null&&le.token?E(le.token):bn({title:"Token do Mapbox no configurado",description:"Configure o token MAPBOX_PUBLIC_TOKEN nos secrets do projeto",variant:"destructive"})}catch(le){console.error("Erro ao buscar token do Mapbox:",le),bn({title:"Erro ao carregar token do Mapbox",description:"Usando formulrio manual",variant:"destructive"})}};V.useEffect(()=>{S&&r.length>0&&e.current&&!t.current&&Y()});const R=async()=>{try{const{data:le,error:ye}=await tt.from("unidades").select(`
          id,
          nome,
          latitude,
          longitude,
          cidade,
          uf,
          contrato_id,
          contratos (
            negocio,
            conq_perd
          )
        `).not("latitude","is",null).not("longitude","is",null);if(ye)throw ye;const pe=await Promise.all((le||[]).map(async be=>{var Ee,qe;const ke=await F(be.id),Oe=await H(be.id);return{id:be.id,nome:be.nome,latitude:Number(be.latitude),longitude:Number(be.longitude),cidade:be.cidade||"",uf:be.uf||"",contrato:{negocio:((Ee=be.contratos)==null?void 0:Ee.negocio)||"Sem contrato",conq_perd:((qe=be.contratos)==null?void 0:qe.conq_perd)??new Date().getFullYear()},sla_atual:ke,postos_total:Oe.total,postos_preenchidos:Oe.preenchidos,postos_vagos:Oe.vagos,porcentagem_preenchimento:Oe.porcentagem}}));s(pe)}catch(le){bn({title:"Erro ao carregar unidades",description:le.message,variant:"destructive"})}finally{i(!1)}},H=async le=>{const{data:ye}=await tt.from("postos_servico").select("id, status").eq("unidade_id",le).in("status",["vago","ocupado"]);if(!ye)return{total:0,preenchidos:0,porcentagem:0};const pe=ye.length,be=ye.filter(Ee=>Ee.status==="ocupado").length,ke=ye.filter(Ee=>Ee.status==="vago").length,Oe=pe>0?Math.round(be/pe*100):0;return{total:pe,preenchidos:be,vagos:ke,porcentagem:Oe}},F=async le=>{const{data:ye}=await tt.from("ordens_servico").select("status").eq("unidade_id",le);if(!ye||ye.length===0)return 100;const pe=ye.filter(be=>be.status==="concluida").length;return Math.round(pe/ye.length*100)},U=le=>le===100?"#22c55e":le>=70?"#eab308":"#ef4444",Y=()=>{e.current&&(ih.accessToken=S,t.current=new ih.Map({container:e.current,style:"mapbox://styles/mapbox/light-v11",center:[-47.9292,-15.7801],zoom:4}),t.current.addControl(new ih.NavigationControl,"top-right"),r.forEach(le=>{if(!t.current)return;const ye=document.createElement("div");ye.className="marker",ye.style.backgroundColor=U(le.porcentagem_preenchimento),ye.style.width="24px",ye.style.height="24px",ye.style.borderRadius="50%",ye.style.border="3px solid white",ye.style.cursor="pointer",ye.style.boxShadow="0 2px 4px rgba(0,0,0,0.3)";const pe=new ih.Marker(ye).setLngLat([le.longitude,le.latitude]).addTo(t.current);ye.addEventListener("click",()=>{f(le)});const be=new ih.Popup({offset:25}).setHTML(`<div style="padding: 12px; min-width: 200px;">
          <h3 style="font-weight: bold; margin-bottom: 8px; font-size: 14px;">${le.nome}</h3>
          <p style="font-size: 12px; color: #666; margin-bottom: 8px;">${le.cidade}/${le.uf}</p>
          <div style="border-top: 1px solid #e5e7eb; padding-top: 8px;">
            <p style="font-size: 12px; margin-bottom: 4px;">Contrato: <strong>${le.contrato.negocio}</strong> (${le.contrato.conq_perd})</p>
            <p style="font-size: 12px; margin-bottom: 4px;">Postos Preenchidos: <strong>${le.postos_preenchidos}/${le.postos_total}</strong></p>
            <p style="font-size: 12px;">Taxa de Ocupao: <strong style="color: ${le.porcentagem_preenchimento>=90?"#22c55e":le.porcentagem_preenchimento>=70?"#eab308":"#ef4444"};">${le.porcentagem_preenchimento}%</strong></p>
          </div>
        </div>`);pe.setPopup(be)}))},z=le=>{le.preventDefault();const pe=new FormData(le.currentTarget).get("token");pe&&(E(pe),bn({title:"Token configurado",description:"Carregando mapa..."}))},J={total:r.length,slaVerde:r.filter(le=>le.sla_atual>=100).length,slaAmarelo:r.filter(le=>le.sla_atual>=90&&le.sla_atual<100).length,slaVermelho:r.filter(le=>le.sla_atual<90).length},ne=r.reduce((le,ye)=>{const pe=`${ye.cidade}/${ye.uf}`;return le[pe]||(le[pe]={cidade:ye.cidade,uf:ye.uf,postos_total:0,postos_preenchidos:0,postos_vagos:0,unidades_count:0}),le[pe].postos_total+=ye.postos_total,le[pe].postos_preenchidos+=ye.postos_preenchidos,le[pe].postos_vagos+=ye.postos_vagos,le[pe].unidades_count+=1,le},{}),me=Object.entries(ne).map(([le,ye])=>({cidadeUf:le,...ye,porcentagem_ocupacao:ye.postos_total>0?Math.round(ye.postos_preenchidos/ye.postos_total*100):0})).sort((le,ye)=>ye.porcentagem_ocupacao-le.porcentagem_ocupacao);return m?c.jsx("div",{className:"flex items-center justify-center h-screen",children:c.jsxs("div",{className:"text-center",children:[c.jsx(iE,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),c.jsx("p",{className:"text-muted-foreground",children:"Carregando dados..."})]})}):S?c.jsxs(Wa,{children:[c.jsxs("div",{className:"h-screen flex flex-col",children:[c.jsx("div",{className:"border-b bg-background p-4",children:c.jsxs("div",{className:"container mx-auto",children:[c.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold",children:"Mesa de Operaes 24/7"}),c.jsx("p",{className:"text-muted-foreground",children:"Monitoramento em tempo real de todas as unidades"})]}),c.jsxs(Nt,{onClick:()=>D(!0),variant:"default",className:"gap-2",children:[c.jsx(HC,{className:"h-4 w-4"}),"Gesto de Cobertura"]})]}),c.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[c.jsx($r,{children:c.jsx(_n,{className:"p-4",children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(um,{className:"h-4 w-4 text-primary"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:J.total}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Unidades"})]})]})})}),c.jsx($r,{className:"border-green-500/50",children:c.jsx(_n,{className:"p-4",children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(oR,{className:"h-4 w-4 text-green-500"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold text-green-500",children:J.slaVerde}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"SLA 100%"})]})]})})}),c.jsx($r,{className:"border-yellow-500/50",children:c.jsx(_n,{className:"p-4",children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(iE,{className:"h-4 w-4 text-yellow-500"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold text-yellow-500",children:J.slaAmarelo}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"SLA 90-99%"})]})]})})}),c.jsx($r,{className:"border-red-500/50",children:c.jsx(_n,{className:"p-4",children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Lx,{className:"h-4 w-4 text-red-500"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold text-red-500",children:J.slaVermelho}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"SLA <90%"})]})]})})})]}),me.length>0&&c.jsxs("div",{className:"mt-4",children:[c.jsx("h3",{className:"text-sm font-semibold mb-3 text-muted-foreground uppercase",children:"Ocupao por Regio"}),c.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-3",children:me.map(le=>c.jsx($r,{className:`transition-all hover:shadow-md ${le.porcentagem_ocupacao===100?"border-green-500/50":le.porcentagem_ocupacao>=70?"border-yellow-500/50":"border-red-500/50"}`,children:c.jsx(_n,{className:"p-4",children:c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(um,{className:"h-3 w-3 text-muted-foreground"}),c.jsx("p",{className:"text-sm font-semibold truncate",children:le.cidade})]}),c.jsxs("div",{children:[c.jsxs("p",{className:`text-2xl font-bold ${le.porcentagem_ocupacao===100?"text-green-500":le.porcentagem_ocupacao>=70?"text-yellow-500":"text-red-500"}`,children:[le.porcentagem_ocupacao,"%"]}),c.jsxs("p",{className:"text-xs text-muted-foreground",children:[le.postos_preenchidos,"/",le.postos_total," ","postos"]}),c.jsxs("p",{className:"text-xs text-muted-foreground",children:["Vagos: ",le.postos_vagos]})]}),c.jsxs(Oi,{variant:"outline",className:"text-xs",children:[le.unidades_count," ",le.unidades_count===1?"unidade":"unidades"]})]})})},le.cidadeUf))})]})]})}),c.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[c.jsx("div",{className:"flex-[3] relative",children:c.jsx("div",{ref:e,className:"absolute inset-0"})}),u&&c.jsxs("div",{className:"w-80 border-l bg-background p-6 overflow-y-auto",children:[c.jsxs("div",{className:"flex items-start justify-between mb-4",children:[c.jsx("div",{children:c.jsx("h2",{className:"text-xl font-bold",children:u.nome})}),c.jsx(Nt,{variant:"ghost",size:"sm",onClick:()=>f(null),children:""})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium mb-1",children:"Localizao"}),c.jsxs("p",{className:"text-sm text-muted-foreground",children:[u.cidade,"/",u.uf]})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium mb-1",children:"Contrato"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:u.contrato.negocio})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium mb-1",children:"Ano Conq/Perd"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:u.contrato.conq_perd})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium mb-2",children:"Postos de Servio"}),c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex justify-between text-sm",children:[c.jsx("span",{className:"text-muted-foreground",children:"Preenchidos"}),c.jsxs("span",{className:"font-medium",children:[u.postos_preenchidos,"/",u.postos_total]})]}),c.jsxs("div",{className:"flex justify-between text-sm",children:[c.jsx("span",{className:"text-muted-foreground",children:"Vagos"}),c.jsx("span",{className:"font-medium",children:u.postos_vagos})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"flex-1 bg-secondary rounded-full h-2",children:c.jsx("div",{className:"h-2 rounded-full transition-all",style:{width:`${u.porcentagem_preenchimento}%`,backgroundColor:u.porcentagem_preenchimento>=90?"#22c55e":u.porcentagem_preenchimento>=70?"#eab308":"#ef4444"}})}),c.jsxs(Oi,{variant:u.porcentagem_preenchimento>=90?"default":u.porcentagem_preenchimento>=70?"secondary":"destructive",children:[u.porcentagem_preenchimento,"%"]})]})]})]})]})]})]})]}),c.jsx(mge,{open:I,onClose:()=>D(!1)})]}):c.jsx(Wa,{children:c.jsx("div",{className:"container mx-auto p-6",children:c.jsxs($r,{className:"max-w-md mx-auto mt-20",children:[c.jsx(Xn,{children:c.jsx(ti,{children:"Carregando Mapa"})}),c.jsxs(_n,{children:[c.jsxs("div",{className:"text-center py-8",children:[c.jsx(iE,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Carregando token do Mapbox..."})]}),c.jsxs("div",{className:"mt-6 border-t pt-6",children:[c.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Ou insira manualmente seu token pblico do Mapbox:"}),c.jsxs("form",{onSubmit:z,className:"space-y-4",children:[c.jsx("input",{name:"token",type:"text",placeholder:"pk.eyJ1...",className:"w-full px-3 py-2 border rounded-md"}),c.jsx(Nt,{type:"submit",className:"w-full",children:"Usar Token Manual"})]})]})]})]})})})};function _ge({os:e,open:t,onClose:r,onSuccess:s}){const[u,f]=V.useState(!1),[m,i]=V.useState({numero:"",titulo:"",descricao:"",tipo:"corretiva",prioridade:"media",status:"aberta",unidade_id:"",ativo_id:"",data_prevista:"",observacoes:""}),S=V.useRef(null),{data:E}=aa({queryKey:["unidades"],queryFn:async()=>{const{data:R,error:H}=await tt.from("unidades").select("id, nome").order("nome");if(H)throw H;return R}}),{data:I}=aa({queryKey:["ativos",m.unidade_id],queryFn:async()=>{let R=tt.from("ativos").select("id, tag_patrimonio, categoria, modelo, unidade_id").eq("status","operacional").order("tag_patrimonio");m.unidade_id&&(R=R.eq("unidade_id",m.unidade_id));const{data:H,error:F}=await R;if(F)throw F;return H}});V.useEffect(()=>{e?i({numero:e.numero||"",titulo:e.titulo||"",descricao:e.descricao||"",tipo:e.tipo||"corretiva",prioridade:e.prioridade||"media",status:e.status||"aberta",unidade_id:e.unidade_id||"",ativo_id:e.ativo_id||"",data_prevista:e.data_prevista||"",observacoes:e.observacoes||""}):D()},[e]),V.useEffect(()=>{if(S.current===null){S.current=m.unidade_id||null;return}S.current!==m.unidade_id&&(i(R=>({...R,ativo_id:""})),S.current=m.unidade_id||null)},[m.unidade_id]);const D=async()=>{const{data:R}=await tt.from("ordens_servico").select("numero").order("created_at",{ascending:!1}).limit(1);let H="OS-0001";if(R&&R.length>0){const F=parseInt(R[0].numero.split("-")[1]);H=`OS-${String(F+1).padStart(4,"0")}`}i(F=>({...F,numero:H}))},M=async R=>{R.preventDefault(),f(!0);try{const{data:{user:H}}=await tt.auth.getUser();if(!H)throw new Error("Usuario nao autenticado");const F={...m,solicitante_id:(e==null?void 0:e.solicitante_id)||H.id,data_prevista:m.data_prevista||null,ativo_id:m.ativo_id||null};if(e){const{error:U}=await tt.from("ordens_servico").update(F).eq("id",e.id);if(U)throw U;$t.success("OS atualizada com sucesso")}else{const{error:U}=await tt.from("ordens_servico").insert(F);if(U)throw U;$t.success("OS criada com sucesso")}s()}catch(H){$t.error("Erro ao salvar OS: "+H.message)}finally{f(!1)}};return c.jsx(Bs,{open:t,onOpenChange:r,children:c.jsxs(Is,{className:"max-w-3xl w-[95vw]",children:[c.jsx(Ns,{children:c.jsx(ks,{children:e?"Editar Ordem de Servico":"Nova Ordem de Servico"})}),c.jsxs("form",{onSubmit:M,className:"flex flex-col gap-4",children:[c.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"numero",children:"Numero *"}),c.jsx(xr,{id:"numero",value:m.numero,onChange:R=>i({...m,numero:R.target.value}),required:!0,disabled:!0})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"tipo",children:"Tipo *"}),c.jsxs(Lr,{value:m.tipo,onValueChange:R=>i({...m,tipo:R}),children:[c.jsx(Or,{children:c.jsx(zr,{})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"preventiva",children:"Preventiva"}),c.jsx(yt,{value:"corretiva",children:"Corretiva"}),c.jsx(yt,{value:"emergencial",children:"Emergencial"}),c.jsx(yt,{value:"melhoria",children:"Melhoria"})]})]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"titulo",children:"Titulo *"}),c.jsx(xr,{id:"titulo",value:m.titulo,onChange:R=>i({...m,titulo:R.target.value}),required:!0})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"descricao",children:"Descricao"}),c.jsx(ec,{id:"descricao",value:m.descricao,onChange:R=>i({...m,descricao:R.target.value}),rows:3})]}),c.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"prioridade",children:"Prioridade *"}),c.jsxs(Lr,{value:m.prioridade,onValueChange:R=>i({...m,prioridade:R}),children:[c.jsx(Or,{children:c.jsx(zr,{})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"baixa",children:"Baixa"}),c.jsx(yt,{value:"media",children:"Media"}),c.jsx(yt,{value:"alta",children:"Alta"}),c.jsx(yt,{value:"urgente",children:"Urgente"})]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"status",children:"Status *"}),c.jsxs(Lr,{value:m.status,onValueChange:R=>i({...m,status:R}),children:[c.jsx(Or,{children:c.jsx(zr,{})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"aberta",children:"Aberta"}),c.jsx(yt,{value:"em_andamento",children:"Em Andamento"}),c.jsx(yt,{value:"concluida",children:"Concluida"}),c.jsx(yt,{value:"cancelada",children:"Cancelada"})]})]})]})]}),c.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"unidade_id",children:"Unidade"}),c.jsxs(Lr,{value:m.unidade_id,onValueChange:R=>i({...m,unidade_id:R}),children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione..."})}),c.jsx(Fr,{children:E==null?void 0:E.map(R=>c.jsx(yt,{value:R.id,children:R.nome},R.id))})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"ativo_id",children:"Ativo"}),c.jsxs(Lr,{value:m.ativo_id,onValueChange:R=>i({...m,ativo_id:R}),children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione..."})}),c.jsx(Fr,{children:I==null?void 0:I.map(R=>c.jsxs(yt,{value:R.id,children:[R.tag_patrimonio," - ",R.categoria," ",R.modelo]},R.id))})]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"data_prevista",children:"Data Prevista"}),c.jsx(xr,{id:"data_prevista",type:"date",value:m.data_prevista,onChange:R=>i({...m,data_prevista:R.target.value})})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"observacoes",children:"Observacoes"}),c.jsx(ec,{id:"observacoes",value:m.observacoes,onChange:R=>i({...m,observacoes:R.target.value}),rows:3})]}),c.jsxs("div",{className:"flex justify-end gap-2",children:[c.jsx(Nt,{type:"button",variant:"outline",onClick:r,children:"Cancelar"}),c.jsx(Nt,{type:"submit",disabled:u,children:u?"Salvando...":e?"Atualizar":"Criar"})]})]})]})})}function xge({osId:e}){const[t,r]=V.useState(!1),[s,u]=V.useState(null),[f,m]=V.useState(null),[i,S]=V.useState(""),E=V.useRef(null),{data:I,refetch:D}=aa({queryKey:["os-anexos",e],queryFn:async()=>{const{data:J,error:ne}=await tt.from("os_anexos").select("*").eq("os_id",e).order("created_at",{ascending:!1});if(ne)throw ne;return await Promise.all((J||[]).map(async le=>{const{data:ye}=await tt.from("profiles").select("full_name").eq("id",le.uploaded_by).single();return{...le,uploader:ye}}))}}),M=async J=>{var me;const ne=(me=J.target.files)==null?void 0:me[0];if(ne){r(!0);try{const{data:{user:le}}=await tt.auth.getUser();if(!le)throw new Error("Usurio no autenticado");const ye=ne.name.split(".").pop(),pe=`${e}/${Date.now()}.${ye}`,{error:be}=await tt.storage.from("os-anexos").upload(pe,ne);if(be)throw be;const{error:ke}=await tt.from("os_anexos").insert({os_id:e,nome_arquivo:ne.name,caminho_storage:pe,tamanho_bytes:ne.size,tipo_arquivo:ne.type,uploaded_by:le.id});if(ke)throw ke;$t.success("Arquivo enviado com sucesso"),D()}catch(le){$t.error("Erro ao enviar arquivo: "+le.message)}finally{r(!1),E.current&&(E.current.value="")}}},R=async J=>{const{data:ne,error:me}=await tt.storage.from("os-anexos").createSignedUrl(J,60);if(me||!(ne!=null&&ne.signedUrl))throw me||new Error("No foi possvel gerar o link");return ne.signedUrl},H=async J=>{try{const ne=await R(J.caminho_storage),me=document.createElement("a");me.href=ne,me.download=J.nome_arquivo,me.target="_blank",document.body.appendChild(me),me.click(),document.body.removeChild(me),$t.success("Download iniciado.")}catch(ne){$t.error("Erro ao baixar arquivo: "+ne.message)}},F=async J=>{try{const ne=await R(J.caminho_storage);m(ne),S(J.nome_arquivo)}catch(ne){$t.error("Erro ao visualizar arquivo: "+ne.message)}},U=async()=>{if(s)try{const J=I==null?void 0:I.find(le=>le.id===s);if(!J)return;const{error:ne}=await tt.storage.from("os-anexos").remove([J.caminho_storage]);if(ne)throw ne;const{error:me}=await tt.from("os_anexos").delete().eq("id",s);if(me)throw me;$t.success("Arquivo excludo com sucesso"),D()}catch(J){$t.error("Erro ao excluir arquivo: "+J.message)}finally{u(null)}},Y=J=>J.startsWith("image/")?c.jsx(Vee,{className:"h-5 w-5"}):J.includes("pdf")?c.jsx(Sm,{className:"h-5 w-5"}):c.jsx(zee,{className:"h-5 w-5"}),z=J=>J<1024?J+" B":J<1024*1024?(J/1024).toFixed(1)+" KB":(J/(1024*1024)).toFixed(1)+" MB";return c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("input",{ref:E,type:"file",onChange:M,className:"hidden"}),c.jsxs(Nt,{onClick:()=>{var J;return(J=E.current)==null?void 0:J.click()},disabled:t,children:[c.jsx(tte,{className:"mr-2 h-4 w-4"}),t?"Enviando...":"Adicionar Anexo"]})]}),I&&I.length>0?c.jsx("div",{className:"space-y-2",children:I.map(J=>{var ne;return c.jsx($r,{children:c.jsx(_n,{className:"p-4",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[Y(J.tipo_arquivo||""),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("p",{className:"font-medium truncate",children:J.nome_arquivo}),c.jsxs("p",{className:"text-sm text-muted-foreground",children:[z(J.tamanho_bytes||0),"  ",(ne=J.uploader)==null?void 0:ne.full_name," "," ",new Date(J.created_at).toLocaleDateString("pt-BR")]})]})]}),c.jsxs("div",{className:"flex gap-1",children:[c.jsx(Nt,{variant:"ghost",size:"icon",onClick:()=>H(J),children:c.jsx(Lee,{className:"h-4 w-4"})}),c.jsx(Nt,{variant:"ghost",size:"icon",onClick:()=>F(J),children:c.jsx(f_,{className:"h-4 w-4"})}),c.jsx(Nt,{variant:"ghost",size:"icon",onClick:()=>u(J.id),children:c.jsx(zo,{className:"h-4 w-4 text-destructive"})})]})]})})},J.id)})}):c.jsx($r,{children:c.jsx(_n,{className:"py-8 text-center text-muted-foreground",children:"Nenhum anexo adicionado"})}),c.jsx(Cd,{open:!!s,onOpenChange:()=>u(null),children:c.jsxs(ju,{children:[c.jsxs(Iu,{children:[c.jsx(ku,{children:"Confirmar excluso"}),c.jsx(Pu,{children:"Tem certeza que deseja excluir este arquivo? Esta ao no pode ser desfeita."})]}),c.jsxs(Nu,{children:[c.jsx(gh,{children:"Cancelar"}),c.jsx(Du,{onClick:U,className:"bg-destructive text-destructive-foreground",children:"Excluir"})]})]})}),f&&c.jsx(Cd,{open:!0,onOpenChange:()=>{m(null),S("")},children:c.jsxs(ju,{className:"max-w-3xl",children:[c.jsxs(Iu,{children:[c.jsx(ku,{children:i}),c.jsx(Pu,{children:"Visualizao do anexo. Para salvar, utilize o boto de download."})]}),c.jsx("div",{className:"max-h-[70vh] overflow-auto border rounded-md p-4 bg-muted",children:i.toLowerCase().match(/\.(png|jpg|jpeg|gif|webp)$/)?c.jsx("img",{src:f,alt:i,className:"max-w-full h-auto mx-auto"}):c.jsx("iframe",{src:f,className:"w-full h-[60vh]",title:"Preview"})}),c.jsx(Nu,{children:c.jsx(Du,{onClick:()=>{f&&URL.revokeObjectURL(f),m(null),S("")},children:"Fechar"})})]})})]})}function vge({osId:e}){const{data:t,isLoading:r}=aa({queryKey:["os-historico",e],queryFn:async()=>{const{data:m,error:i}=await tt.from("os_historico").select("*").eq("os_id",e).order("created_at",{ascending:!1});if(i)throw i;return await Promise.all((m||[]).map(async E=>{const{data:I}=await tt.from("profiles").select("full_name").eq("id",E.usuario_id).single();return{...E,usuario:I}}))}}),s=m=>new Date(m).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),u=m=>{switch(m){case"criacao":return"Criao";case"atualizacao":return"Atualizao";case"exclusao":return"Excluso";default:return m}},f=m=>{switch(m){case"status":return"Status";case"responsavel_id":return"Responsvel";case"prioridade":return"Prioridade";case"tipo":return"Tipo";default:return m}};return r?c.jsx($r,{children:c.jsx(_n,{className:"py-8 text-center text-muted-foreground",children:"Carregando histrico..."})}):!t||t.length===0?c.jsx($r,{children:c.jsx(_n,{className:"py-8 text-center text-muted-foreground",children:"Nenhuma alterao registrada"})}):c.jsx("div",{className:"space-y-4",children:t.map((m,i)=>{var S;return c.jsx($r,{children:c.jsx(_n,{className:"p-4",children:c.jsx("div",{className:"flex items-start gap-3",children:c.jsxs("div",{className:"flex-1 space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Oi,{variant:"outline",children:u(m.acao)}),m.campo_alterado&&c.jsx("span",{className:"text-sm text-muted-foreground",children:f(m.campo_alterado)})]}),m.campo_alterado&&c.jsxs("div",{className:"text-sm space-y-1",children:[m.valor_anterior&&c.jsxs("div",{children:[c.jsx("span",{className:"text-muted-foreground",children:"De: "}),c.jsx("span",{className:"line-through",children:m.valor_anterior})]}),m.valor_novo&&c.jsxs("div",{children:[c.jsx("span",{className:"text-muted-foreground",children:"Para: "}),c.jsx("span",{className:"font-medium",children:m.valor_novo})]})]}),m.observacao&&c.jsx("p",{className:"text-sm text-muted-foreground",children:m.observacao}),c.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground pt-2",children:[c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx(lb,{className:"h-3 w-3"}),c.jsx("span",{children:((S=m.usuario)==null?void 0:S.full_name)||"Sistema"})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx(Lv,{className:"h-3 w-3"}),c.jsx("span",{children:s(m.created_at)})]})]})]})})})},m.id)})})}function yge({os:e,open:t,onClose:r}){var f,m,i;const s=S=>new Date(S).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"}),u=S=>new Date(S).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return c.jsx(Bs,{open:t,onOpenChange:r,children:c.jsxs(Is,{className:"max-w-4xl w-[95vw] max-h-[90vh] overflow-y-auto",children:[c.jsx(Ns,{children:c.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between",children:[c.jsxs(ks,{children:["Ordem de Servio ",e.numero]}),c.jsxs("div",{className:"flex flex-wrap gap-2",children:[c.jsx(Oi,{children:e.tipo}),c.jsx(Oi,{children:e.prioridade}),c.jsx(Oi,{children:e.status.replace("_"," ")})]})]})}),c.jsxs(sM,{defaultValue:"detalhes",className:"w-full",children:[c.jsxs(vA,{className:"grid w-full grid-cols-1 sm:grid-cols-3",children:[c.jsxs(nf,{value:"detalhes",children:[c.jsx(Sm,{className:"h-4 w-4 mr-2"}),"Detalhes"]}),c.jsxs(nf,{value:"anexos",children:[c.jsx(sR,{className:"h-4 w-4 mr-2"}),"Anexos"]}),c.jsxs(nf,{value:"historico",children:[c.jsx(Uee,{className:"h-4 w-4 mr-2"}),"Histrico"]})]}),c.jsx(sf,{value:"detalhes",className:"space-y-4",children:c.jsxs($r,{children:[c.jsx(Xn,{children:c.jsx(ti,{className:"text-lg",children:"Informaes Gerais"})}),c.jsxs(_n,{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("h4",{className:"font-semibold mb-1",children:e.titulo}),e.descricao&&c.jsx("p",{className:"text-sm text-muted-foreground",children:e.descricao})]}),c.jsx(s_,{}),c.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[((f=e.unidade)==null?void 0:f.nome)&&c.jsxs("div",{className:"flex items-start gap-2",children:[c.jsx(um,{className:"h-4 w-4 text-muted-foreground mt-1"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium",children:"Unidade"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:e.unidade.nome})]})]}),((m=e.responsavel)==null?void 0:m.full_name)&&c.jsxs("div",{className:"flex items-start gap-2",children:[c.jsx(lb,{className:"h-4 w-4 text-muted-foreground mt-1"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium",children:"Responsvel"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:e.responsavel.full_name})]})]}),((i=e.solicitante)==null?void 0:i.full_name)&&c.jsxs("div",{className:"flex items-start gap-2",children:[c.jsx(lb,{className:"h-4 w-4 text-muted-foreground mt-1"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium",children:"Solicitante"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:e.solicitante.full_name})]})]}),e.data_abertura&&c.jsxs("div",{className:"flex items-start gap-2",children:[c.jsx(Lv,{className:"h-4 w-4 text-muted-foreground mt-1"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium",children:"Data de Abertura"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:u(e.data_abertura)})]})]}),e.data_prevista&&c.jsxs("div",{className:"flex items-start gap-2",children:[c.jsx(jc,{className:"h-4 w-4 text-muted-foreground mt-1"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium",children:"Data Prevista"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:s(e.data_prevista)})]})]}),e.data_conclusao&&c.jsxs("div",{className:"flex items-start gap-2",children:[c.jsx(jc,{className:"h-4 w-4 text-muted-foreground mt-1"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium",children:"Data de Concluso"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:u(e.data_conclusao)})]})]})]}),e.observacoes&&c.jsxs(c.Fragment,{children:[c.jsx(s_,{}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium mb-1",children:"Observaes"}),c.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:e.observacoes})]})]})]})]})}),c.jsx(sf,{value:"anexos",children:c.jsx(xge,{osId:e.id})}),c.jsx(sf,{value:"historico",children:c.jsx(vge,{osId:e.id})})]})]})})}function wge({os:e,onEdit:t,onDelete:r,onConcluir:s,onAtribuir:u}){var F,U;const[f,m]=V.useState(!1),[i,S]=V.useState(!1),[E,I]=V.useState(!1),D=Y=>{switch(Y){case"aberta":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-100";case"em_andamento":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100";case"concluida":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100";case"cancelada":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-100";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-100"}},M=Y=>{switch(Y){case"baixa":return"bg-gray-100 text-gray-800";case"media":return"bg-blue-100 text-blue-800";case"alta":return"bg-orange-100 text-orange-800";case"urgente":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},R=Y=>{switch(Y){case"preventiva":return"bg-green-100 text-green-800";case"corretiva":return"bg-yellow-100 text-yellow-800";case"emergencial":return"bg-red-100 text-red-800";case"melhoria":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},H=Y=>new Date(Y).toLocaleDateString("pt-BR");return c.jsxs(c.Fragment,{children:[c.jsxs($r,{className:"hover:shadow-md transition-shadow",children:[c.jsx(Xn,{className:"pb-3",children:c.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between",children:[c.jsxs("div",{className:"space-y-1 flex-1",children:[c.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[c.jsx("span",{className:"font-mono text-sm text-muted-foreground hidden sm:inline",children:e.numero}),c.jsx(Oi,{className:R(e.tipo),children:e.tipo}),c.jsx(Oi,{className:M(e.prioridade),children:e.prioridade}),c.jsx(Oi,{className:D(e.status),children:e.status.replace("_"," ")})]}),c.jsx("h3",{className:"text-lg font-semibold",children:e.titulo})]}),c.jsxs("div",{className:"flex flex-wrap gap-1",children:[c.jsx(Nt,{variant:"ghost",size:"icon",onClick:()=>m(!0),children:c.jsx(f_,{className:"h-4 w-4"})}),e.status!=="concluida"&&c.jsxs(c.Fragment,{children:[c.jsx(Nt,{variant:"ghost",size:"icon",onClick:()=>{window.confirm("Se atribuir como tecnico?")&&u(e.id)},className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:c.jsx(nte,{className:"h-4 w-4"})}),c.jsx(Nt,{variant:"ghost",size:"icon",onClick:()=>I(!0),className:"text-green-600 hover:text-green-700 hover:bg-green-50",children:c.jsx(zb,{className:"h-4 w-4"})}),c.jsx(Nt,{variant:"ghost",size:"icon",onClick:()=>t(e),children:c.jsx(Yee,{className:"h-4 w-4"})})]}),c.jsx(Nt,{variant:"ghost",size:"icon",onClick:()=>S(!0),children:c.jsx(zo,{className:"h-4 w-4 text-destructive"})})]})]})}),c.jsx(_n,{children:c.jsxs("div",{className:"hidden sm:block",children:[e.descricao&&c.jsx("p",{className:"text-sm text-muted-foreground mb-3 line-clamp-2",children:e.descricao}),c.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[((F=e.unidade)==null?void 0:F.nome)&&c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(um,{className:"h-4 w-4 text-muted-foreground"}),c.jsx("span",{className:"truncate",children:e.unidade.nome})]}),((U=e.responsavel)==null?void 0:U.full_name)&&c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(lb,{className:"h-4 w-4 text-muted-foreground"}),c.jsx("span",{className:"truncate",children:e.responsavel.full_name})]}),e.data_abertura&&c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Lv,{className:"h-4 w-4 text-muted-foreground"}),c.jsx("span",{children:H(e.data_abertura)})]}),e.data_prevista&&c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(jc,{className:"h-4 w-4 text-muted-foreground"}),c.jsx("span",{children:H(e.data_prevista)})]})]})]})})]}),f&&c.jsx(yge,{os:e,open:f,onClose:()=>m(!1)}),c.jsx(Cd,{open:i,onOpenChange:S,children:c.jsxs(ju,{children:[c.jsxs(Iu,{children:[c.jsx(ku,{children:"Confirmar exclusao"}),c.jsxs(Pu,{children:["Tem certeza que deseja excluir a OS ",e.numero,"? Esta acao nao pode ser desfeita."]})]}),c.jsxs(Nu,{children:[c.jsx(gh,{children:"Cancelar"}),c.jsx(Du,{onClick:()=>r(e.id),className:"bg-destructive text-destructive-foreground",children:"Excluir"})]})]})}),c.jsx(Cd,{open:E,onOpenChange:I,children:c.jsxs(ju,{children:[c.jsxs(Iu,{children:[c.jsx(ku,{children:"Concluir Ordem de Servico"}),c.jsxs(Pu,{children:["Tem certeza que deseja concluir a OS ",e.numero,"? Esta acao marcara a ordem como concluida."]})]}),c.jsxs(Nu,{children:[c.jsx(gh,{children:"Cancelar"}),c.jsx(Du,{onClick:()=>s(e.id),className:"bg-green-600 hover:bg-green-700",children:"Concluir"})]})]})})]})}function bge(){const[e,t]=V.useState(""),[r,s]=V.useState("ativas"),[u,f]=V.useState("all"),[m,i]=V.useState("all"),[S,E]=V.useState(!1),[I,D]=V.useState(null),{data:M,isLoading:R,refetch:H}=aa({queryKey:["ordens-servico",r,u,m],queryFn:async()=>{let me=tt.from("ordens_servico").select(`
          *,
          unidade:unidades(nome),
          solicitante:profiles!ordens_servico_solicitante_id_fkey(full_name),
          responsavel:profiles!ordens_servico_responsavel_id_fkey(full_name)
        `).order("created_at",{ascending:!1});r==="ativas"?me=me.neq("status","concluida"):r!=="all"&&(me=me.eq("status",r)),u!=="all"&&(me=me.eq("prioridade",u)),m!=="all"&&(me=me.eq("tipo",m));const{data:le,error:ye}=await me;if(ye)throw ye;return le}}),F=M==null?void 0:M.filter(me=>{var le;return me.numero.toLowerCase().includes(e.toLowerCase())||me.titulo.toLowerCase().includes(e.toLowerCase())||((le=me.descricao)==null?void 0:le.toLowerCase().includes(e.toLowerCase()))}),U={total:(M==null?void 0:M.length)||0,abertas:(M==null?void 0:M.filter(me=>me.status==="aberta").length)||0,emAndamento:(M==null?void 0:M.filter(me=>me.status==="em_andamento").length)||0,concluidas:(M==null?void 0:M.filter(me=>me.status==="concluida").length)||0},Y=me=>{D(me),E(!0)},z=async me=>{try{const{error:le}=await tt.from("ordens_servico").delete().eq("id",me);if(le)throw le;$t.success("OS excluida com sucesso"),H()}catch(le){$t.error("Erro ao excluir OS: "+le.message)}},J=async me=>{try{const{error:le}=await tt.from("ordens_servico").update({status:"concluida",data_conclusao:new Date().toISOString()}).eq("id",me);if(le)throw le;$t.success("OS concluida com sucesso"),H()}catch(le){$t.error("Erro ao concluir OS: "+le.message)}},ne=async me=>{try{const{data:{user:le}}=await tt.auth.getUser();if(!le)throw new Error("Usuario nao autenticado");const{error:ye}=await tt.from("ordens_servico").update({responsavel_id:le.id}).eq("id",me);if(ye)throw ye;$t.success("Atribuido como responsavel da OS"),H()}catch(le){$t.error("Erro ao atribuir responsavel: "+le.message)}};return c.jsx(Wa,{children:c.jsx("div",{className:"min-h-screen bg-background p-8",children:c.jsxs("div",{className:"flex flex-col gap-6",children:[c.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[c.jsxs("div",{children:[c.jsx("h1",{className:"text-2xl font-bold",children:"Ordens de Servico"}),c.jsx("p",{className:"text-muted-foreground",children:"Gerencie as ordens de servico em aberto e concluidas."})]}),c.jsxs(Nt,{onClick:()=>E(!0),className:"self-start md:self-auto",children:[c.jsx(Sc,{className:"mr-2 h-4 w-4"}),"Nova OS"]})]}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[c.jsxs($r,{children:[c.jsxs(Xn,{className:"pb-2",children:[c.jsx(Gs,{children:"Total"}),c.jsx(ti,{className:"text-3xl",children:U.total})]}),c.jsx(_n,{children:c.jsx(Oi,{variant:"secondary",children:"Todas"})})]}),c.jsxs($r,{children:[c.jsxs(Xn,{className:"pb-2",children:[c.jsx(Gs,{children:"Abertas"}),c.jsx(ti,{className:"text-3xl text-yellow-600",children:U.abertas})]}),c.jsx(_n,{children:c.jsx(n8,{className:"h-4 w-4 text-yellow-600"})})]}),c.jsxs($r,{children:[c.jsxs(Xn,{className:"pb-2",children:[c.jsx(Gs,{children:"Em Andamento"}),c.jsx(ti,{className:"text-3xl text-blue-600",children:U.emAndamento})]}),c.jsx(_n,{children:c.jsx(HC,{className:"h-4 w-4 text-blue-600"})})]}),c.jsxs($r,{children:[c.jsxs(Xn,{className:"pb-2",children:[c.jsx(Gs,{children:"Concluidas"}),c.jsx(ti,{className:"text-3xl text-green-600",children:U.concluidas})]}),c.jsx(_n,{children:c.jsx(zb,{className:"h-4 w-4 text-green-600"})})]})]}),c.jsx($r,{children:c.jsx(_n,{className:"pt-6",children:c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[c.jsxs("div",{className:"relative",children:[c.jsx(gd,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),c.jsx(xr,{placeholder:"Buscar por numero, titulo...",value:e,onChange:me=>t(me.target.value),className:"pl-9"})]}),c.jsxs(Lr,{value:r,onValueChange:s,children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Status"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"ativas",children:"Ativas (Abertas e Em Andamento)"}),c.jsx(yt,{value:"all",children:"Todos os Status"}),c.jsx(yt,{value:"aberta",children:"Aberta"}),c.jsx(yt,{value:"em_andamento",children:"Em Andamento"}),c.jsx(yt,{value:"concluida",children:"Concluida"}),c.jsx(yt,{value:"cancelada",children:"Cancelada"})]})]}),c.jsxs(Lr,{value:u,onValueChange:f,children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Prioridade"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"all",children:"Todas as Prioridades"}),c.jsx(yt,{value:"baixa",children:"Baixa"}),c.jsx(yt,{value:"media",children:"Media"}),c.jsx(yt,{value:"alta",children:"Alta"}),c.jsx(yt,{value:"urgente",children:"Urgente"})]})]}),c.jsxs(Lr,{value:m,onValueChange:i,children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Tipo"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"all",children:"Todos os Tipos"}),c.jsx(yt,{value:"preventiva",children:"Preventiva"}),c.jsx(yt,{value:"corretiva",children:"Corretiva"}),c.jsx(yt,{value:"emergencial",children:"Emergencial"}),c.jsx(yt,{value:"melhoria",children:"Melhoria"})]})]})]})})}),c.jsxs(sM,{defaultValue:"lista",className:"w-full",children:[c.jsx(vA,{children:c.jsx(nf,{value:"lista",children:"Lista"})}),c.jsx(sf,{value:"lista",className:"space-y-4 pt-4",children:R?c.jsx("div",{className:"text-center py-12",children:c.jsx("p",{className:"text-muted-foreground",children:"Carregando ordens de servico..."})}):F&&F.length>0?c.jsx("div",{className:"grid gap-4",children:F.map(me=>c.jsx(wge,{os:me,onEdit:Y,onDelete:z,onConcluir:J,onAtribuir:ne},me.id))}):c.jsx($r,{children:c.jsxs(_n,{className:"py-12 text-center",children:[c.jsx(Sm,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),c.jsx("p",{className:"text-muted-foreground",children:"Nenhuma ordem de servico encontrada"}),c.jsxs(Nt,{onClick:()=>E(!0),className:"mt-4",children:[c.jsx(Sc,{className:"mr-2 h-4 w-4"}),"Criar primeira OS"]})]})})})]}),S&&c.jsx(_ge,{os:I,open:S,onClose:()=>{E(!1),D(null)},onSuccess:()=>{E(!1),D(null),H()}})]})})})}function Sge({colaborador:e,open:t,onClose:r,onSuccess:s}){const[u,f]=V.useState(!1),[m,i]=V.useState({nome_completo:"",cpf:"",telefone:"",email:"",data_admissao:"",data_desligamento:"",cargo:"",status_colaborador:"ativo",observacoes:""});V.useEffect(()=>{e&&i({nome_completo:e.nome_completo||"",cpf:e.cpf||"",telefone:e.telefone||"",email:e.email||"",data_admissao:e.data_admissao||"",data_desligamento:e.data_desligamento||"",cargo:e.cargo||"",status_colaborador:e.status_colaborador||"ativo",observacoes:e.observacoes||""})},[e]);const S=async E=>{E.preventDefault(),f(!0);try{const I={...m,cargo:m.cargo||null,data_desligamento:m.status_colaborador==="inativo"&&m.data_desligamento||null};if(e){const{error:D}=await tt.from("colaboradores").update(I).eq("id",e.id);if(D)throw D;$t.success("Colaborador atualizado com sucesso")}else{const{error:D}=await tt.from("colaboradores").insert(I);if(D)throw D;$t.success("Colaborador cadastrado com sucesso")}s()}catch(I){$t.error("Erro ao salvar colaborador: "+I.message)}finally{f(!1)}};return c.jsx(Bs,{open:t,onOpenChange:r,children:c.jsxs(Is,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[c.jsx(Ns,{children:c.jsx(ks,{children:e?"Editar Colaborador":"Novo Colaborador"})}),c.jsxs("form",{onSubmit:S,className:"space-y-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"nome_completo",children:"Nome Completo *"}),c.jsx(xr,{id:"nome_completo",value:m.nome_completo,onChange:E=>i({...m,nome_completo:E.target.value}),required:!0})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"cpf",children:"CPF *"}),c.jsx(xr,{id:"cpf",value:m.cpf,onChange:E=>i({...m,cpf:E.target.value}),placeholder:"000.000.000-00",required:!0})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"telefone",children:"Telefone"}),c.jsx(xr,{id:"telefone",value:m.telefone,onChange:E=>i({...m,telefone:E.target.value}),placeholder:"(00) 00000-0000"})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"email",children:"Email"}),c.jsx(xr,{id:"email",type:"email",value:m.email,onChange:E=>i({...m,email:E.target.value})})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"data_admissao",children:"Data de Admisso"}),c.jsx(xr,{id:"data_admissao",type:"date",value:m.data_admissao,onChange:E=>i({...m,data_admissao:E.target.value})})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"status_colaborador",children:"Status *"}),c.jsxs(Lr,{value:m.status_colaborador,onValueChange:E=>i({...m,status_colaborador:E}),children:[c.jsx(Or,{children:c.jsx(zr,{})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"ativo",children:"Ativo"}),c.jsx(yt,{value:"inativo",children:"Inativo"})]})]})]})]}),m.status_colaborador==="inativo"&&c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"data_desligamento",children:"Data de Desligamento"}),c.jsx(xr,{id:"data_desligamento",type:"date",value:m.data_desligamento,onChange:E=>i({...m,data_desligamento:E.target.value})})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"cargo",children:"Cargo"}),c.jsx(xr,{id:"cargo",value:m.cargo,onChange:E=>i({...m,cargo:E.target.value}),placeholder:"Ex: Vigilante, Supervisor, etc."})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"observacoes",children:"Observaes"}),c.jsx(ec,{id:"observacoes",value:m.observacoes,onChange:E=>i({...m,observacoes:E.target.value}),rows:3})]}),c.jsxs("div",{className:"flex justify-end gap-2",children:[c.jsx(Nt,{type:"button",variant:"outline",onClick:r,children:"Cancelar"}),c.jsx(Nt,{type:"submit",disabled:u,children:u?"Salvando...":e?"Atualizar":"Cadastrar"})]})]})]})})}function Tge({open:e,onClose:t,missingEntities:r}){return c.jsx(Cd,{open:e,onOpenChange:t,children:c.jsxs(ju,{children:[c.jsxs(Iu,{children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(i_,{className:"h-5 w-5 text-destructive"}),c.jsx(ku,{children:"Requisitos No Atendidos"})]}),c.jsxs(Pu,{className:"space-y-3",children:[c.jsx("p",{children:"Para cadastrar um colaborador,  necessrio ter pelo menos uma instncia cadastrada de cada uma das seguintes entidades:"}),c.jsxs("div",{className:"bg-muted p-3 rounded-md",children:[c.jsx("p",{className:"font-medium mb-2",children:"Entidades faltantes:"}),c.jsx("ul",{className:"list-disc list-inside space-y-1",children:r.map(s=>c.jsx("li",{className:"text-sm",children:s},s))})]}),c.jsx("p",{className:"text-sm",children:"Por favor, cadastre as entidades necessrias antes de adicionar colaboradores."})]})]}),c.jsx(Nu,{children:c.jsx(Du,{onClick:t,children:"Entendi"})})]})})}function Ege({colaborador:e,open:t,onClose:r,onSuccess:s}){const[u,f]=V.useState(!1),[m,i]=V.useState((e==null?void 0:e.escala_id)||""),{data:S,isLoading:E}=aa({queryKey:["escalas"],queryFn:async()=>{const{data:D,error:M}=await tt.from("escalas").select("id, nome, tipo, descricao").order("nome");if(M)throw M;return D}}),I=async D=>{if(D.preventDefault(),!m){$t.error("Selecione uma escala");return}f(!0);try{const{error:M}=await tt.from("colaboradores").update({escala_id:m}).eq("id",e.id);if(M)throw M;$t.success("Escala atribuda com sucesso"),s()}catch(M){$t.error("Erro ao atribuir escala: "+M.message)}finally{f(!1)}};return c.jsx(Bs,{open:t,onOpenChange:r,children:c.jsxs(Is,{className:"max-w-md",children:[c.jsxs(Ns,{children:[c.jsxs(ks,{className:"flex items-center gap-2",children:[c.jsx(jc,{className:"h-5 w-5"}),"Atribuir Escala"]}),c.jsxs(La,{children:["Atribuir escala ao colaborador ",c.jsx("strong",{children:e==null?void 0:e.nome_completo})]})]}),E?c.jsx("div",{className:"text-center py-8",children:c.jsx("p",{className:"text-muted-foreground",children:"Carregando escalas..."})}):!S||S.length===0?c.jsxs("div",{className:"text-center py-8 space-y-4",children:[c.jsx("p",{className:"text-muted-foreground",children:"Nenhuma escala cadastrada. Crie uma escala primeiro no mdulo de Escalas."}),c.jsx(Nt,{variant:"outline",onClick:r,children:"Fechar"})]}):c.jsxs("form",{onSubmit:I,className:"space-y-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"escala",children:"Escala *"}),c.jsxs(Lr,{value:m,onValueChange:i,children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione uma escala..."})}),c.jsx(Fr,{children:S.map(D=>c.jsxs(yt,{value:D.id,children:[D.nome," - ",D.tipo,D.descricao&&` (${D.descricao})`]},D.id))})]})]}),c.jsxs("div",{className:"flex justify-end gap-2",children:[c.jsx(Nt,{type:"button",variant:"outline",onClick:r,children:"Cancelar"}),c.jsx(Nt,{type:"submit",disabled:u,children:u?"Atribuindo...":"Atribuir Escala"})]})]})]})})}const Cge=e=>{try{return new Date(`${e}T00:00:00`).toLocaleDateString("pt-BR")}catch{return e}};function Age({colaborador:e,open:t,onClose:r,onSuccess:s}){const[u,f]=V.useState(!1),[m,i]=V.useState((e==null?void 0:e.unidade_id)||""),[S,E]=V.useState((e==null?void 0:e.posto_servico_id)||""),{data:I,isLoading:D}=aa({queryKey:["unidades"],queryFn:async()=>{const{data:H,error:F}=await tt.from("unidades").select("id, nome").order("nome");if(F)throw F;return H}}),{data:M}=aa({queryKey:["postos-unidade",m],queryFn:async()=>{if(!m)return[];const{data:H,error:F}=await tt.from("postos_servico").select("id, nome, status, ultimo_dia_atividade").eq("unidade_id",m).order("nome");if(F)throw F;return H},enabled:!!m}),R=async H=>{if(H.preventDefault(),!m){$t.error("Selecione uma unidade");return}f(!0);try{if((e==null?void 0:e.posto_servico_id)&&e.posto_servico_id!==S){const{error:Y}=await tt.from("colaboradores").update({posto_servico_id:null}).eq("id",e.id);if(Y)throw Y}const{error:U}=await tt.from("colaboradores").update({unidade_id:m,posto_servico_id:S||null}).eq("id",e.id);if(U)throw U;$t.success("Unidade atribuida com sucesso"),s(),r()}catch(F){const U=typeof(F==null?void 0:F.message)=="string"?F.message:"Erro ao atribuir unidade. Tente novamente.",Y=U.includes('status" is of type status_posto')||U.includes("status_posto")?"Erro ao atribuir unidade: o status do posto deve usar valores do enum (vago, ocupado, vago_temporariamente, ocupado_temporariamente, presenca_confirmada ou inativo).":U;$t.error(Y)}finally{f(!1)}};return c.jsx(Bs,{open:t,onOpenChange:r,children:c.jsxs(Is,{children:[c.jsx(Ns,{children:c.jsxs(ks,{children:["Atribuir Unidade - ",e==null?void 0:e.nome_completo]})}),c.jsxs("form",{onSubmit:R,className:"space-y-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"unidade",children:"Unidade *"}),D?c.jsx("p",{className:"text-sm text-muted-foreground",children:"Carregando unidades..."}):!I||I.length===0?c.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhuma unidade encontrada. Cadastre unidades primeiro."}):c.jsxs(Lr,{value:m,onValueChange:H=>{i(H),E("")},children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione uma unidade..."})}),c.jsx(Fr,{children:I.map(H=>c.jsx(yt,{value:H.id,children:H.nome},H.id))})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"posto",children:"Posto de Servio (Opcional)"}),c.jsxs(Lr,{value:S,onValueChange:E,disabled:!m,children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:m?"Selecione um posto...":"Selecione uma unidade primeiro..."})}),c.jsx(Fr,{children:M==null?void 0:M.map(H=>{const F=H.status?`(${H.status.replaceAll("_"," ")})`:"",U=H.status==="inativo",Y=H.ultimo_dia_atividade?Cge(H.ultimo_dia_atividade):null,z=Y?U?`Encerrado em ${Y}`:`Ultimo dia planejado: ${Y}`:null;return c.jsxs(yt,{value:H.id,disabled:U,className:"flex flex-col",children:[c.jsxs("span",{children:[H.nome," ",F]}),z&&c.jsxs("span",{className:"text-xs text-muted-foreground",children:[z,U?"  selecione outro posto":""]})]},H.id)})})]})]}),c.jsxs("div",{className:"flex justify-end gap-2",children:[c.jsx(Nt,{type:"button",variant:"outline",onClick:r,children:"Cancelar"}),c.jsx(Nt,{type:"submit",disabled:u||!m,children:u?"Atribuindo...":"Atribuir"})]})]})]})})}const jge=[{value:"presente",label:"Presente"},{value:"falta",label:"Falta"},{value:"falta_justificada",label:"Falta Justificada"},{value:"ferias",label:"Frias"},{value:"atestado",label:"Atestado"},{value:"folga",label:"Folga"}],Ige="00000000-0000-0000-0000-000000000000",Nge=e=>{switch(e){case"falta":return"falta injustificada";case"falta_justificada":return"falta justificada";case"ferias":return"frias";case"atestado":return"atestado";case"folga":return"folga";default:return e.replace(/_/g," ").trim()}};function kge({colaborador:e,open:t,onClose:r,onSuccess:s}){const[u,f]=V.useState(!1),[m,i]=V.useState({data:new Date().toISOString().split("T")[0],tipo:"presente",horario_entrada:"",horario_saida:"",observacao:""});V.useEffect(()=>{t&&i({data:new Date().toISOString().split("T")[0],tipo:"presente",horario_entrada:"",horario_saida:"",observacao:""})},[t,e==null?void 0:e.id]);const S=async I=>{var D;if(I.preventDefault(),!!e){f(!0);try{const{data:{user:M}}=await tt.auth.getUser();if(!M)throw new Error("Usurio no autenticado");const R={colaborador_id:e.id,data:m.data,tipo:m.tipo,horario_entrada:m.horario_entrada?new Date(`${m.data}T${m.horario_entrada}`).toISOString():null,horario_saida:m.horario_saida?new Date(`${m.data}T${m.horario_saida}`).toISOString():null,observacao:m.observacao||null,registrado_por:M.id},{error:H}=await tt.from("presencas").insert(R);if(H)throw H;if(m.tipo!=="presente"&&(e!=null&&e.posto_servico_id)){const F=Nge(m.tipo),{error:U}=await tt.from("dias_trabalho").update({status:"vago",motivo_vago:F,colaborador_id:null}).eq("posto_servico_id",e.posto_servico_id).eq("colaborador_id",e.id).eq("data",m.data);if(U)throw U;const{error:Y}=await tt.from("posto_dias_vagos").upsert({posto_servico_id:e.posto_servico_id,colaborador_id:e.id,data:m.data,motivo:F,created_by:R.registrado_por??Ige});if(Y)throw Y}$t.success("Presena registrada com sucesso"),s(),r()}catch(M){(D=M==null?void 0:M.message)!=null&&D.includes("duplicate key")?$t.error("J existe um registro de presena para este colaborador nesta data."):$t.error((M==null?void 0:M.message)||"Erro ao registrar presena.")}finally{f(!1)}}},E=(I,D)=>{i(M=>({...M,[I]:D}))};return c.jsx(Bs,{open:t,onOpenChange:r,children:c.jsxs(Is,{className:"max-w-md",children:[c.jsxs(Ns,{children:[c.jsx(ks,{children:"Registrar Presena"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:e==null?void 0:e.nome_completo})]}),c.jsxs("form",{onSubmit:S,className:"space-y-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"data",children:"Data *"}),c.jsx(xr,{id:"data",type:"date",value:m.data,onChange:I=>E("data",I.target.value),required:!0})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"tipo",children:"Tipo *"}),c.jsxs(Lr,{value:m.tipo,onValueChange:I=>E("tipo",I),children:[c.jsx(Or,{id:"tipo",children:c.jsx(zr,{})}),c.jsx(Fr,{children:jge.map(I=>c.jsx(yt,{value:I.value,children:I.label},I.value))})]})]}),m.tipo==="presente"&&c.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"horario_entrada",children:"Horrio Entrada"}),c.jsx(xr,{id:"horario_entrada",type:"time",value:m.horario_entrada,onChange:I=>E("horario_entrada",I.target.value)})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"horario_saida",children:"Horrio Sada"}),c.jsx(xr,{id:"horario_saida",type:"time",value:m.horario_saida,onChange:I=>E("horario_saida",I.target.value)})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"observacao",children:"Observao"}),c.jsx(ec,{id:"observacao",value:m.observacao,onChange:I=>E("observacao",I.target.value),rows:3,placeholder:"Informaes adicionais..."})]}),c.jsxs("div",{className:"flex justify-end gap-2",children:[c.jsx(Nt,{type:"button",variant:"outline",onClick:r,children:"Cancelar"}),c.jsx(Nt,{type:"submit",disabled:u,children:u?"Registrando...":"Registrar"})]})]})]})})}const OG={vago:"Vago",ocupado:"Ocupado",vago_temporariamente:"Vago temporariamente",ocupado_temporariamente:"Ocupado temporariamente",presenca_confirmada:"Presenca confirmada",ocupacao_agendada:"Ocupacao agendada",inativo:"Inativo"},Pge={vago:"secondary",ocupado:"default",vago_temporariamente:"outline",ocupado_temporariamente:"outline",presenca_confirmada:"default",ocupacao_agendada:"outline",inativo:"outline"},$N={ativo:"Ativo",inativo:"Inativo"},Dge={ativo:"default",inativo:"secondary"},e5=e=>new Date(`${e}T00:00:00`),Rge=["FALTA JUSTIFICADA","FALTA INJUSTIFICADA","AFASTAMENTO INSS","FRIAS","SUSPENSO","VAGA EM ABERTO (COBERTURA SALRIO)","LICENA MATERNIDADE","LICENA PATERNIDADE","LICENA CASAMENTO","LICENA NOJO (FALECIMENTO)"],Mge="00000000-0000-0000-0000-000000000000",Oge=e=>{const t=e==null?void 0:e.replace(/_/g," ").trim().toUpperCase();switch(t){case"FALTA JUSTIFICADA":return"FALTA JUSTIFICADA";case"FALTA INJUSTIFICADA":return"FALTA INJUSTIFICADA";case"AFASTAMENTO INSS":return"AFASTAMENTO INSS";case"FERIAS":case"FRIAS":return"FRIAS";case"SUSPENSAO":case"SUSPENSO":return"SUSPENSO";case"VAGA EM ABERTO (COBERTURA SALARIO)":case"VAGA EM ABERTO (COBERTURA SALRIO)":case"POSTO VAGO":return"VAGA EM ABERTO (COBERTURA SALRIO)";case"LICENCA MATERNIDADE":case"LICENA MATERNIDADE":return"LICENA MATERNIDADE";case"LICENCA PATERNIDADE":case"LICENA PATERNIDADE":return"LICENA PATERNIDADE";case"LICENCA CASAMENTO":case"LICENA CASAMENTO":return"LICENA CASAMENTO";case"LICENCA NOJO (FALECIMENTO)":case"LICENA NOJO (FALECIMENTO)":return"LICENA NOJO (FALECIMENTO)";default:return t}},Fge=e=>e?e==="ativo"?"Ocupado":OG[e]||e:"Sem status",Lge=e=>e?e==="ativo"?"default":Pge[e]||"outline":"outline";function zge(){var Pi,ft,Rt,Wt,Pr,Sr,Nr,Kr,Zn,Yn;const e=Tm(),[t,r]=V.useState(""),[s,u]=V.useState("all"),[f,m]=V.useState("all"),[i,S]=V.useState("all"),[E,I]=V.useState("all"),[D,M]=V.useState(!1),[R,H]=V.useState(null),[F,U]=V.useState(!1),[Y,z]=V.useState([]),[J,ne]=V.useState(null),[me,le]=V.useState(null);V.useState(null);const[ye,pe]=V.useState(null),[be,ke]=V.useState(null),[Oe,Ee]=V.useState(null),[qe,Qe]=V.useState({}),[gt,Xe]=V.useState(null),[ct,Me]=V.useState({data:"",postoDestino:""}),[mt,Kt]=V.useState(!1),[it,ee]=V.useState([]),{data:he,refetch:Se}=aa({queryKey:["colaboradores",s,E,f,i],queryFn:async()=>{let Zt=tt.from("colaboradores").select(`

          *,

          unidade:unidades(id, nome, contratos(id, negocio, conq_perd)),

          escala:escalas(nome, tipo),

          posto:postos_servico(

            id,

            nome,

            status,
            ultimo_dia_atividade,

            unidade:unidades(id, nome, contratos(id, negocio, conq_perd))

          )

        `).order("nome_completo");s!=="all"&&(Zt=Zt.eq("status_colaborador",s)),E!=="all"&&(Zt=Zt.eq("unidade_id",E)),f==="alocado"?Zt=Zt.not("posto_servico_id","is",null):f==="nao_alocado"&&(Zt=Zt.is("posto_servico_id",null)),i!=="all"&&(Zt=Zt.eq("cargo",i));const{data:en,error:Sn}=await Zt;if(Sn)throw Sn;return en}}),{data:Ue}=aa({queryKey:["unidades"],queryFn:async()=>{const{data:Zt,error:en}=await tt.from("unidades").select("id, nome").order("nome");if(en)throw en;return Zt}}),{data:nt=[]}=aa({queryKey:["postos-disponiveis-agendamento"],queryFn:async()=>{const{data:Zt,error:en}=await tt.from("postos_servico").select("id, nome, status").eq("status","vago").order("nome");if(en)throw en;return Zt}});V.useEffect(()=>{const Zt=async en=>{try{const Sn=Ii(new Date,"yyyy-MM-dd"),{data:fs,error:ms}=await tt.from("dias_trabalho").select("data").eq("posto_servico_id",en).is("colaborador_id",null).gte("data",Sn).order("data");if(ms)throw ms;const hr=(fs==null?void 0:fs.map(An=>An.data))??[];ee(hr),Me(An=>({...An,data:hr[0]??""}))}catch(Sn){$t.error(Sn.message||"Erro ao carregar dias disponveis para o posto."),ee([]),Me(fs=>({...fs,data:""}))}};(gt==null?void 0:gt.tipo)==="vincular"&&ct.postoDestino?Zt(ct.postoDestino):(gt==null?void 0:gt.tipo)==="vincular"&&(ee([]),Me(en=>({...en,data:""})))},[gt==null?void 0:gt.tipo,ct.postoDestino]);const dt=he==null?void 0:he.filter(Zt=>{var en,Sn;return Zt.nome_completo.toLowerCase().includes(t.toLowerCase())||((en=Zt.cpf)==null?void 0:en.includes(t))||((Sn=Zt.email)==null?void 0:Sn.toLowerCase().includes(t.toLowerCase()))}),Vt=Array.from(new Set(["ativo","inativo"].concat((he??[]).map(Zt=>Zt.status_colaborador).filter(Zt=>!!Zt)))),zt=Array.from(new Set((he??[]).map(Zt=>Zt.cargo).filter(Zt=>!!Zt))),Gt=(dt==null?void 0:dt.length)??0,jr=Zt=>{window.confirm(`Deseja editar o colaborador ${Zt.nome_completo}?`)&&(H(Zt),M(!0))},Wr=async Zt=>{if(window.confirm("Tem certeza que deseja excluir este colaborador?"))try{const{error:en}=await tt.from("colaboradores").delete().eq("id",Zt);if(en)throw en;$t.success("Colaborador excludo com sucesso"),Se()}catch(en){$t.error(en.message||"Erro ao excluir colaborador")}},nn=async Zt=>{if(window.confirm("Deseja realmente desvincular o colaborador do posto atual?"))try{const{error:en}=await tt.from("colaboradores").update({posto_servico_id:null}).eq("id",Zt.id);if(en)throw en;$t.success("Posto de servio desvinculado com sucesso"),Se()}catch(en){$t.error(en.message||"Erro ao desvincular posto de servio")}},xn=()=>{if(!window.confirm("Deseja cadastrar um novo colaborador?"))return;const Zt=[];if((!Ue||Ue.length===0)&&Zt.push("Unidades"),Zt.length>0){z(Zt),U(!0);return}M(!0)},ei=async Zt=>{if(!Zt.posto_servico_id){$t.error("Colaborador nao esta vinculado a um posto no momento.");return}try{const{data:en,error:Sn}=await tt.from("dias_trabalho").select("id, data, status, motivo_vago").eq("posto_servico_id",Zt.posto_servico_id).order("data");if(Sn)throw Sn;ke({colaborador:Zt,postoId:Zt.posto_servico_id,dias:en||[]})}catch(en){$t.error(en.message||"Erro ao carregar escala do colaborador")}},Dn=(Zt,en)=>{Xe({tipo:Zt,colaborador:en}),Me({data:"",postoDestino:""}),ee([])},Zr=async Zt=>{if(Zt.preventDefault(),!!gt){if(!ct.data){$t.error("Selecione uma data para o agendamento.");return}if(gt.tipo==="vincular"&&!ct.postoDestino){$t.error("Selecione o posto de destino para a vinculao.");return}if(gt.tipo==="vincular"&&(!ct.data||!it.includes(ct.data))){$t.error("Selecione uma data disponvel para o posto escolhido.");return}Kt(!0);try{const{data:{user:en}}=await tt.auth.getUser();if(!en)throw new Error("Usurio no autenticado");const Sn={colaborador_id:gt.colaborador.id,status:"agendado",created_by:en.id,posto_servico_id_origem:gt.colaborador.posto_servico_id};gt.tipo==="desvincular"?Sn.data_desvinculacao=ct.data:(Sn.data_vinculacao=ct.data,Sn.posto_servico_id_destino=ct.postoDestino,await fE({postoId:ct.postoDestino,colaboradorId:gt.colaborador.id,data:ct.data,usuarioId:en.id}));const{error:fs}=await tt.from("colaborador_movimentacoes_posto").insert([Sn]);if(fs)throw fs;await Promise.all([Se(),e.invalidateQueries({queryKey:["colaboradores"]}),e.invalidateQueries({queryKey:["postos-disponiveis-agendamento"]})]),$t.success(gt.tipo==="desvincular"?"Desvinculao agendada com sucesso.":"Vinculao agendada com sucesso."),Xe(null),Me({data:"",postoDestino:""})}catch(en){$t.error(en.message||"Erro ao agendar movimentao.")}finally{Kt(!1)}}},Nn=async Zt=>{var ms,hr;if(!(be!=null&&be.postoId)){$t.error("Nao foi possivel identificar o posto para atualizar o dia.");return}const en=qe[Zt];if(!en){$t.error("Selecione um motivo para marcar o dia como vago.");return}const Sn=Oge(en),fs=(ms=be.colaborador)!=null&&ms.id?"vago_temporariamente":"vago";try{const{data:{user:An}}=await tt.auth.getUser(),{error:fi}=await tt.from("dias_trabalho").update({status:fs,motivo_vago:Sn}).eq("posto_servico_id",be.postoId).eq("data",Zt);if(fi)throw fi;const{error:Vi}=await tt.from("posto_dias_vagos").upsert({posto_servico_id:be.postoId,colaborador_id:((hr=be.colaborador)==null?void 0:hr.id)??null,data:Zt,motivo:Sn,created_by:(An==null?void 0:An.id)??Mge});if(Vi)throw Vi;ke($n=>$n&&{...$n,dias:$n.dias.map(vi=>vi.data===Zt?{...vi,status:fs,motivo_vago:Sn}:vi)}),await e.invalidateQueries({queryKey:["posto-dias-vagos"]}),$t.success("Dia marcado como vago.")}catch(An){$t.error(An.message||"Erro ao marcar dia vago.")}};return c.jsx(Wa,{children:c.jsxs("div",{className:"space-y-6 p-4 md:p-6",children:[c.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold",children:"Colaboradores"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Gerencie cadastros, alocacoes e presencas dos colaboradores."})]}),c.jsxs(Nt,{onClick:xn,className:"w-full md:w-auto",children:[c.jsx(Sc,{className:"mr-2 h-4 w-4"}),"Novo colaborador"]})]}),c.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[c.jsxs("div",{className:"space-y-2 md:col-span-2",children:[c.jsx(Dt,{htmlFor:"search-colaboradores",children:"Buscar"}),c.jsxs("div",{className:"relative",children:[c.jsx(gd,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),c.jsx(xr,{id:"search-colaboradores",placeholder:"Nome, CPF ou email",value:t,onChange:Zt=>r(Zt.target.value),className:"pl-9"})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Status"}),c.jsxs(Lr,{value:s,onValueChange:u,children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Todos"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"all",children:"Todos"}),Vt.map(Zt=>c.jsx(yt,{value:Zt,children:$N[Zt]||Zt},Zt))]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Alocao"}),c.jsxs(Lr,{value:f,onValueChange:m,children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Todos"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"all",children:"Todos"}),c.jsx(yt,{value:"alocado",children:"Alocados"}),c.jsx(yt,{value:"nao_alocado",children:"No alocados"})]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Cargo"}),c.jsxs(Lr,{value:i,onValueChange:S,children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Todos"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"all",children:"Todos"}),zt.map(Zt=>c.jsx(yt,{value:Zt,children:Zt},Zt))]})]})]}),c.jsxs("div",{className:"space-y-2 lg:col-span-2",children:[c.jsx(Dt,{children:"Unidade"}),c.jsxs(Lr,{value:E,onValueChange:I,children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Todas"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"all",children:"Todas"}),Ue==null?void 0:Ue.map(Zt=>c.jsx(yt,{value:Zt.id,children:Zt.nome},Zt.id))]})]})]})]}),c.jsxs("div",{className:"rounded-md border bg-card",children:[c.jsx("div",{className:"flex flex-wrap items-center justify-between gap-3 border-b p-4",children:c.jsxs("div",{children:[c.jsxs("p",{className:"text-sm font-semibold",children:[Gt," ",Gt===1?"colaborador":"colaboradores"]}),c.jsx("p",{className:"text-xs text-muted-foreground",children:dt&&Gt!==(he==null?void 0:he.length)?"Exibindo resultados com filtros aplicados":"Exibindo todos os colaboradores disponveis"})]})}),c.jsxs(nu,{children:[c.jsx(iu,{children:c.jsxs(Ws,{children:[c.jsx(gn,{children:"Colaborador"}),c.jsx(gn,{children:"Posto"}),c.jsx(gn,{className:"w-[360px]",children:"Aes"})]})}),c.jsx(su,{children:dt!=null&&dt.length?dt.map(Zt=>{var en;return c.jsxs(Ws,{className:"cursor-pointer",role:"button",tabIndex:0,onClick:()=>Ee(Zt),onKeyDown:Sn=>{(Sn.key==="Enter"||Sn.key===" ")&&(Sn.preventDefault(),Ee(Zt))},children:[c.jsx(tn,{className:"align-top",children:c.jsxs("div",{className:"space-y-2 rounded-md border border-transparent p-2 transition group-hover:border-muted",children:[c.jsx("p",{className:"font-semibold leading-tight",children:Zt.nome_completo}),Zt.status_colaborador&&c.jsx(Oi,{variant:Dge[Zt.status_colaborador]||"outline",className:"capitalize",children:$N[Zt.status_colaborador]||Zt.status_colaborador})]})}),c.jsx(tn,{className:"align-top",children:Zt.posto?c.jsxs("div",{className:"space-y-1 text-sm",children:[c.jsx("p",{className:"font-medium",children:Zt.posto.nome}),((en=Zt.posto.unidade)==null?void 0:en.nome)&&c.jsxs("p",{className:"text-xs text-muted-foreground",children:["Unidade: ",Zt.posto.unidade.nome]}),Zt.posto.ultimo_dia_atividade&&c.jsxs("p",{className:"text-xs text-muted-foreground",children:["ltimo dia: ",Ii(e5(Zt.posto.ultimo_dia_atividade),"dd/MM/yyyy",{locale:ia})]})]}):c.jsx("p",{className:"text-sm text-muted-foreground",children:"Sem posto associado"})}),c.jsx(tn,{className:"align-top",children:c.jsxs("div",{className:"flex flex-wrap gap-1",children:[c.jsxs(Nt,{variant:"ghost",size:"icon",onClick:Sn=>{Sn.stopPropagation(),Ee(Zt)},title:"Ver detalhes",children:[c.jsx($ee,{className:"h-4 w-4"}),c.jsx("span",{className:"sr-only",children:"Ver detalhes"})]}),!Zt.posto_servico_id&&c.jsxs(Nt,{variant:"ghost",size:"icon",onClick:Sn=>{Sn.stopPropagation(),le(Zt)},title:"Atribuir unidade",children:[c.jsx(um,{className:"h-4 w-4"}),c.jsx("span",{className:"sr-only",children:"Atribuir unidade"})]}),!Zt.posto_servico_id&&c.jsxs(Nt,{variant:"ghost",size:"icon",onClick:Sn=>{Sn.stopPropagation(),Dn("vincular",Zt)},title:"Agendar ocupao",children:[c.jsx(Ree,{className:"h-4 w-4"}),c.jsx("span",{className:"sr-only",children:"Agendar ocupao"})]}),Zt.posto_servico_id&&c.jsxs(Nt,{variant:"ghost",size:"icon",onClick:Sn=>{Sn.stopPropagation(),nn(Zt)},title:"Desvincular do posto",children:[c.jsx(ete,{className:"h-4 w-4"}),c.jsx("span",{className:"sr-only",children:"Desvincular do posto"})]}),c.jsxs(Nt,{variant:"ghost",size:"icon",onClick:Sn=>{Sn.stopPropagation(),ei(Zt)},disabled:!Zt.posto_servico_id,title:"Visualizar escala prevista",children:[c.jsx(jc,{className:"h-4 w-4"}),c.jsx("span",{className:"sr-only",children:"Visualizar escala prevista"})]}),c.jsxs(Nt,{variant:"ghost",size:"icon",onClick:Sn=>{Sn.stopPropagation(),jr(Zt)},title:"Editar colaborador",children:[c.jsx(jd,{className:"h-4 w-4"}),c.jsx("span",{className:"sr-only",children:"Editar colaborador"})]}),c.jsxs(Cd,{children:[c.jsx(Kb,{asChild:!0,children:c.jsxs(Nt,{variant:"ghost",size:"icon",title:"Excluir colaborador",onClick:Sn=>Sn.stopPropagation(),children:[c.jsx(zo,{className:"h-4 w-4 text-destructive"}),c.jsx("span",{className:"sr-only",children:"Excluir colaborador"})]})}),c.jsxs(ju,{children:[c.jsxs(Iu,{children:[c.jsx(ku,{children:"Confirmar excluso"}),c.jsx(Pu,{children:"Tem certeza que deseja excluir este colaborador?"})]}),c.jsxs(Nu,{children:[c.jsx(gh,{children:"Cancelar"}),c.jsx(Du,{onClick:()=>Wr(Zt.id),children:"Excluir"})]})]})]})]})})]},Zt.id)}):c.jsx(Ws,{children:c.jsx(tn,{colSpan:5,className:"py-10 text-center text-sm text-muted-foreground",children:"Nenhum colaborador encontrado com os filtros selecionados."})})})]})]}),D&&c.jsx(Sge,{open:D,onClose:()=>{M(!1),H(null)},colaborador:R,onSuccess:()=>{M(!1),H(null),Se()}}),F&&c.jsx(Tge,{open:F,onClose:()=>U(!1),missingEntities:Y}),J&&c.jsx(Ege,{open:!!J,onClose:()=>ne(null),colaborador:J,onSuccess:Se}),me&&c.jsx(Age,{open:!!me,onClose:()=>le(null),colaborador:me,onSuccess:Se}),ye&&c.jsx(kge,{open:!!ye,colaborador:ye,onClose:()=>pe(null),onSuccess:Se}),gt&&c.jsx(Bs,{open:!!gt,onOpenChange:Zt=>{Zt||Xe(null)},children:c.jsxs(Is,{children:[c.jsxs(Ns,{children:[c.jsx(ks,{children:gt.tipo==="desvincular"?"Agendar desvinculao":"Agendar vinculao"}),c.jsx(La,{children:gt.colaborador.nome_completo})]}),c.jsxs("form",{className:"space-y-4",onSubmit:Zr,children:[gt.tipo==="vincular"?c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Posto de destino"}),c.jsxs(Lr,{value:ct.postoDestino,onValueChange:Zt=>Me(en=>({...en,postoDestino:Zt,data:""})),children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione o posto"})}),c.jsx(Fr,{className:"max-h-72 overflow-y-auto",children:nt.length===0?c.jsx(yt,{value:"none",disabled:!0,children:"Nenhum posto vago disponvel"}):nt.map(Zt=>c.jsx(yt,{value:Zt.id,children:Zt.nome},Zt.id))})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Data disponvel"}),c.jsxs(Lr,{value:ct.data,onValueChange:Zt=>Me(en=>({...en,data:Zt})),disabled:it.length===0,children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:it.length===0?"Selecione um posto para listar as datas":"Selecione a data"})}),c.jsx(Fr,{className:"max-h-72 overflow-y-auto",children:it.map(Zt=>c.jsx(yt,{value:Zt,children:Ii(new Date(`${Zt}T00:00:00`),"dd/MM/yyyy",{locale:ia})},Zt))})]}),ct.postoDestino&&it.length===0&&c.jsx("p",{className:"text-xs text-muted-foreground",children:"Nenhuma data disponvel para o posto selecionado."})]})]}):c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Data"}),c.jsx(xr,{type:"date",value:ct.data,min:new Date().toISOString().split("T")[0],onChange:Zt=>Me(en=>({...en,data:Zt.target.value})),required:!0})]}),c.jsxs("div",{className:"flex justify-end gap-2",children:[c.jsx(Nt,{type:"button",variant:"outline",onClick:()=>Xe(null),children:"Cancelar"}),c.jsx(Nt,{type:"submit",disabled:mt||(gt==null?void 0:gt.tipo)==="vincular"&&!ct.data,children:mt?"Salvando...":"Confirmar agendamento"})]})]})]})}),c.jsx(Bs,{open:!!be,onOpenChange:Zt=>{Zt||ke(null)},children:c.jsxs(Is,{children:[c.jsxs(Ns,{children:[c.jsxs(ks,{children:["Escala prevista - ",(Pi=be==null?void 0:be.colaborador)==null?void 0:Pi.nome_completo]}),c.jsx(La,{children:"Dias cadastrados na tabela de dias de trabalho para este colaborador."})]}),be?be.dias.length>0?c.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:be.dias.map(Zt=>c.jsxs("div",{className:"flex items-center justify-between rounded-md border px-3 py-2 text-sm",children:[c.jsx("span",{children:Ii(e5(Zt.data),"dd/MM/yyyy",{locale:ia})}),c.jsxs("div",{className:"flex flex-col items-end gap-2",children:[Zt.status&&c.jsx(Oi,{variant:Lge(Zt.status),className:"capitalize",children:Fge(Zt.status)}),Zt.motivo_vago&&c.jsxs("span",{className:"text-xs text-muted-foreground",children:["Motivo: ",Zt.motivo_vago]}),c.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[c.jsxs(Lr,{value:qe[Zt.data]||"",onValueChange:en=>Qe(Sn=>({...Sn,[Zt.data]:en})),children:[c.jsx(Or,{className:"w-[160px]",children:c.jsx(zr,{placeholder:"Motivo"})}),c.jsx(Fr,{children:Rge.map(en=>c.jsx(yt,{value:en,children:en},en))})]}),c.jsx("div",{className:"flex gap-2",children:c.jsx(Nt,{size:"sm",variant:"outline",onClick:()=>Nn(Zt.data),children:"Marcar vago"})})]})]})]},Zt.id||`${be.colaborador.id}-${Zt.data}`))}):c.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum dia de trabalho encontrado para este colaborador."}):null]})}),c.jsx(Bs,{open:!!Oe,onOpenChange:Zt=>{Zt||Ee(null)},children:c.jsxs(Is,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[c.jsxs(Ns,{children:[c.jsx(ks,{children:(Oe==null?void 0:Oe.nome_completo)||"Colaborador"}),c.jsx(La,{children:"Informaes completas do colaborador"})]}),Oe&&c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-xs text-muted-foreground",children:"Email"}),c.jsx("p",{className:"font-medium",children:Oe.email||"-"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-xs text-muted-foreground",children:"Telefone"}),c.jsx("p",{className:"font-medium",children:Oe.telefone||"-"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-xs text-muted-foreground",children:"Status"}),c.jsx("p",{className:"font-medium",children:$N[Oe.status_colaborador||""]||Oe.status_colaborador||"-"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-xs text-muted-foreground",children:"Cargo"}),c.jsx("p",{className:"font-medium",children:Oe.cargo||"-"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-xs text-muted-foreground",children:"Tipo / Escala"}),c.jsx("p",{className:"font-medium",children:(ft=Oe.escala)!=null&&ft.tipo?Oe.escala.tipo:"efetivo"})]})]}),c.jsxs("div",{className:"rounded-md border p-4 space-y-2",children:[c.jsx("p",{className:"font-semibold",children:"Alocao"}),Oe.posto_servico_id?c.jsxs("div",{className:"space-y-1 text-sm",children:[c.jsxs("p",{children:[c.jsx("span",{className:"font-medium",children:"Posto: "}),((Rt=Oe.posto)==null?void 0:Rt.nome)||"-"]}),c.jsxs("p",{children:[c.jsx("span",{className:"font-medium",children:"Status do Posto: "}),OG[((Wt=Oe.posto)==null?void 0:Wt.status)||"vago"]||"vago"]}),c.jsxs("p",{children:[c.jsx("span",{className:"font-medium",children:"Unidade: "}),((Sr=(Pr=Oe.posto)==null?void 0:Pr.unidade)==null?void 0:Sr.nome)||((Nr=Oe.unidade)==null?void 0:Nr.nome)||"-"]}),c.jsxs("p",{children:[c.jsx("span",{className:"font-medium",children:"Contrato: "}),(Zn=(Kr=Oe.posto)==null?void 0:Kr.unidade)!=null&&Zn.contratos?`${Oe.posto.unidade.contratos.negocio} (${Oe.posto.unidade.contratos.conq_perd})`:(Yn=Oe.unidade)!=null&&Yn.contratos?`${Oe.unidade.contratos.negocio} (${Oe.unidade.contratos.conq_perd})`:"-"]})]}):c.jsx("p",{className:"text-sm text-muted-foreground",children:"No alocado a um posto de servio."})]})]})]})})]})})}function Bge({escala:e,open:t,onClose:r,onSuccess:s}){const[u,f]=V.useState(!1),[m,i]=V.useState({nome:"",tipo:"fixa",descricao:"",dias_trabalhados:"",dias_folga:""});V.useEffect(()=>{var E,I;e&&i({nome:e.nome||"",tipo:e.tipo||"fixa",descricao:e.descricao||"",dias_trabalhados:((E=e.dias_trabalhados)==null?void 0:E.toString())||"",dias_folga:((I=e.dias_folga)==null?void 0:I.toString())||""})},[e]);const S=async E=>{E.preventDefault(),f(!0);try{const I={nome:m.nome,tipo:m.tipo,descricao:m.descricao||null,dias_trabalhados:m.dias_trabalhados?parseInt(m.dias_trabalhados):null,dias_folga:m.dias_folga?parseInt(m.dias_folga):null};if(e){const{error:D}=await tt.from("escalas").update(I).eq("id",e.id);if(D)throw D;$t.success("Escala atualizada com sucesso")}else{const{error:D}=await tt.from("escalas").insert(I);if(D)throw D;$t.success("Escala cadastrada com sucesso")}s()}catch(I){$t.error("Erro ao salvar escala: "+I.message)}finally{f(!1)}};return c.jsx(Bs,{open:t,onOpenChange:r,children:c.jsxs(Is,{className:"max-w-md",children:[c.jsx(Ns,{children:c.jsx(ks,{children:e?"Editar Escala Modelo":"Nova Escala Modelo"})}),c.jsxs("form",{onSubmit:S,className:"space-y-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"nome",children:"Nome *"}),c.jsx(xr,{id:"nome",value:m.nome,onChange:E=>i({...m,nome:E.target.value}),placeholder:"Ex: 12x36, 5x2",required:!0})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"tipo",children:"Tipo *"}),c.jsxs(Lr,{value:m.tipo,onValueChange:E=>i({...m,tipo:E}),children:[c.jsx(Or,{children:c.jsx(zr,{})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"fixa",children:"Fixa"}),c.jsx(yt,{value:"alternada",children:"Alternada"}),c.jsx(yt,{value:"flexivel",children:"Flexvel"}),c.jsx(yt,{value:"plantao",children:"Planto"})]})]})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"dias_trabalhados",children:"Dias Trabalhados"}),c.jsx(xr,{id:"dias_trabalhados",type:"number",min:"1",value:m.dias_trabalhados,onChange:E=>i({...m,dias_trabalhados:E.target.value}),placeholder:"Ex: 12"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"dias_folga",children:"Dias de Folga"}),c.jsx(xr,{id:"dias_folga",type:"number",min:"1",value:m.dias_folga,onChange:E=>i({...m,dias_folga:E.target.value}),placeholder:"Ex: 36"})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"descricao",children:"Descrio"}),c.jsx(ec,{id:"descricao",value:m.descricao,onChange:E=>i({...m,descricao:E.target.value}),rows:3,placeholder:"Descreva os detalhes da escala..."})]}),c.jsxs("div",{className:"flex justify-end gap-2",children:[c.jsx(Nt,{type:"button",variant:"outline",onClick:r,children:"Cancelar"}),c.jsx(Nt,{type:"submit",disabled:u,children:u?"Salvando...":e?"Atualizar":"Cadastrar"})]})]})]})})}function Uge(){const[e,t]=V.useState(!1),[r,s]=V.useState(null),{data:u,isLoading:f,refetch:m}=aa({queryKey:["escalas-detalhes"],queryFn:async()=>{const{data:E,error:I}=await tt.from("postos_servico").select(`
          id,
          nome,
          escala,
          turno,
          jornada,
          horario_inicio,
          horario_fim,
          de,
          ate,
          dias_semana,
          unidade:unidades(nome)
        `).eq("status","ativo").order("escala");if(I)throw I;const D=new Map;return E==null||E.forEach(M=>{if(M.escala){D.has(M.escala)||D.set(M.escala,{escala:M.escala,turno:M.turno,jornada:M.jornada,horario_inicio:M.horario_inicio,horario_fim:M.horario_fim,dias_semana:M.dias_semana,postos:[]});const R=D.get(M.escala);!R.turno&&M.turno&&(R.turno=M.turno),R.jornada==null&&M.jornada!=null&&(R.jornada=M.jornada),!R.horario_inicio&&M.horario_inicio&&(R.horario_inicio=M.horario_inicio),!R.horario_fim&&M.horario_fim&&(R.horario_fim=M.horario_fim),R.postos.push({id:M.id,nome:M.nome,unidade:M.unidade})}}),Array.from(D.values())}}),{data:i}=aa({queryKey:["escalas-modelo"],queryFn:async()=>{const{data:E,error:I}=await tt.from("escalas").select("*").order("nome");if(I)throw I;return E}}),S=async E=>{try{const{error:I}=await tt.from("escalas").delete().eq("id",E);if(I)throw I;$t.success("Escala excluda com sucesso"),m()}catch(I){$t.error("Erro ao excluir escala: "+I.message)}};return c.jsxs(Wa,{children:[c.jsx("div",{className:"min-h-screen bg-background p-8",children:c.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("h1",{className:"text-4xl font-bold text-foreground",children:"Escalas"}),c.jsx("p",{className:"text-muted-foreground mt-2",children:"Gesto de escalas e turnos de trabalho"})]}),c.jsxs(Nt,{onClick:()=>{s(null),t(!0)},children:[c.jsx(Sc,{className:"mr-2 h-4 w-4"}),"Nova Escala Modelo"]})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsx("h2",{className:"text-2xl font-semibold",children:"Escalas em Uso"}),f?c.jsx("div",{className:"text-center py-12",children:c.jsx("p",{className:"text-muted-foreground",children:"Carregando escalas..."})}):u&&u.length>0?c.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:u.map((E,I)=>{const D=!!E.turno&&(E.escala||"").toLowerCase()!=="12x36";return c.jsxs($r,{children:[c.jsx(Xn,{children:c.jsxs("div",{className:"flex items-start justify-between",children:[c.jsxs("div",{children:[c.jsxs(ti,{className:"flex items-center gap-2",children:[c.jsx(jc,{className:"h-5 w-5"}),E.escala]}),c.jsxs(Gs,{className:"mt-2",children:[E.postos.length," posto(s) de servio"]})]}),D&&c.jsx(Oi,{variant:"outline",children:E.turno})]})}),c.jsxs(_n,{className:"space-y-4",children:[E.horario_inicio&&E.horario_fim&&c.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[c.jsx(Lv,{className:"h-4 w-4 text-muted-foreground"}),c.jsxs("span",{children:[E.horario_inicio.slice(0,5)," s ",E.horario_fim.slice(0,5)]})]}),D&&c.jsxs("div",{className:"text-sm",children:[c.jsx("span",{className:"font-medium",children:"Turno:"})," ",E.turno]}),typeof E.jornada=="number"&&c.jsxs("div",{className:"text-sm",children:[c.jsx("span",{className:"font-medium",children:"Jornada:"})," ",E.jornada,"h"]}),E.dias_semana&&E.dias_semana.length>0&&c.jsxs("div",{className:"text-sm",children:[c.jsx("span",{className:"font-medium",children:"Dias:"})," ",E.dias_semana.join(", ")]}),c.jsxs("div",{className:"pt-3 border-t",children:[c.jsx("p",{className:"text-sm font-medium mb-2",children:"Postos de Servio:"}),c.jsx("div",{className:"space-y-2",children:E.postos.map(M=>c.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[c.jsx(um,{className:"h-3 w-3 text-muted-foreground"}),c.jsxs("span",{children:[M.nome,M.unidade&&c.jsxs("span",{className:"text-muted-foreground ml-1",children:["(",M.unidade.nome,")"]})]})]},M.id))})]})]})]},I)})}):c.jsx($r,{children:c.jsxs(_n,{className:"py-12 text-center",children:[c.jsx(jc,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),c.jsx("p",{className:"text-muted-foreground",children:"Nenhuma escala em uso. Crie postos de servio com escalas definidas."})]})})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsx("h2",{className:"text-2xl font-semibold",children:"Escalas Modelo"}),i&&i.length>0?c.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:i.map(E=>{const I=!!E.turno&&(E.tipo||"").toLowerCase()!=="12x36";return c.jsxs($r,{children:[c.jsx(Xn,{children:c.jsxs("div",{className:"flex items-start justify-between",children:[c.jsxs("div",{children:[c.jsx(ti,{children:E.nome}),E.descricao&&c.jsx(Gs,{className:"mt-2",children:E.descricao})]}),c.jsx(Oi,{variant:"outline",children:E.tipo})]})}),c.jsxs(_n,{className:"space-y-2",children:[E.dias_trabalhados&&E.dias_folga&&c.jsxs("div",{className:"text-sm",children:[c.jsx("span",{className:"font-medium",children:"Regime:"})," ",E.dias_trabalhados,"x",E.dias_folga]}),I&&c.jsxs("div",{className:"text-sm",children:[c.jsx("span",{className:"font-medium",children:"Turno:"})," ",E.turno]}),typeof E.jornada=="number"&&c.jsxs("div",{className:"text-sm",children:[c.jsx("span",{className:"font-medium",children:"Jornada:"})," ",E.jornada,"h"]}),E.horario_inicio&&E.horario_fim&&c.jsxs("div",{className:"text-sm",children:[c.jsx("span",{className:"font-medium",children:"Horrio:"})," ",E.horario_inicio.slice(0,5)," s ",E.horario_fim.slice(0,5)]}),c.jsxs("div",{className:"flex gap-2 pt-3",children:[c.jsx(Nt,{variant:"outline",size:"sm",onClick:()=>{s(E),t(!0)},children:"Editar"}),c.jsx(Nt,{variant:"outline",size:"sm",onClick:()=>S(E.id),children:"Excluir"})]})]})]},E.id)})}):c.jsx($r,{children:c.jsxs(_n,{className:"py-12 text-center",children:[c.jsx(jc,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),c.jsx("p",{className:"text-muted-foreground",children:"Nenhuma escala modelo cadastrada"}),c.jsxs(Nt,{onClick:()=>t(!0),className:"mt-4",children:[c.jsx(Sc,{className:"mr-2 h-4 w-4"}),"Criar primeira escala modelo"]})]})})]})]})}),e&&c.jsx(Bge,{escala:r,open:e,onClose:()=>{t(!1),s(null)},onSuccess:()=>{t(!1),s(null),m()}})]})}function Vge({open:e,onOpenChange:t,ativo:r,onSuccess:s}){var F;const[u,f]=V.useState(!1),[m,i]=V.useState([]),{register:S,handleSubmit:E,setValue:I,watch:D,reset:M}=QR({defaultValues:{unidade_id:(r==null?void 0:r.unidade_id)||"",categoria:(r==null?void 0:r.categoria)||"",tag_patrimonio:(r==null?void 0:r.tag_patrimonio)||"",fabricante:(r==null?void 0:r.fabricante)||"",modelo:(r==null?void 0:r.modelo)||"",numero_serie:(r==null?void 0:r.numero_serie)||"",status:(r==null?void 0:r.status)||"operacional",critico:(r==null?void 0:r.critico)||!1,data_instalacao:(r==null?void 0:r.data_instalacao)||"",frequencia_preventiva_dias:(r==null?void 0:r.frequencia_preventiva_dias)||90}});V.useEffect(()=>{R()},[]),V.useEffect(()=>{r&&M({unidade_id:r.unidade_id||"",categoria:r.categoria||"",tag_patrimonio:r.tag_patrimonio||"",fabricante:r.fabricante||"",modelo:r.modelo||"",numero_serie:r.numero_serie||"",status:r.status||"operacional",critico:r.critico||!1,data_instalacao:r.data_instalacao||"",frequencia_preventiva_dias:r.frequencia_preventiva_dias||90})},[r,M]);const R=async()=>{const{data:U}=await tt.from("unidades").select("*").order("nome");i(U||[])},H=async U=>{f(!0);try{const Y={...U,critico:U.critico==="true"||U.critico===!0};if(r){const{error:z}=await tt.from("ativos").update(Y).eq("id",r.id);if(z)throw z;$t.success("Ativo atualizado com sucesso!")}else{const{error:z}=await tt.from("ativos").insert([Y]);if(z)throw z;$t.success("Ativo cadastrado com sucesso!")}s(),t(!1),M()}catch(Y){$t.error(Y.message)}finally{f(!1)}};return c.jsx(Bs,{open:e,onOpenChange:t,children:c.jsxs(Is,{className:"max-w-2xl max-h-[90vh] overflow-y-auto w-full",children:[c.jsx(Ns,{children:c.jsx(ks,{children:r?"Editar Ativo":"Cadastrar Novo Ativo"})}),c.jsxs("form",{onSubmit:E(H),className:"space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"unidade_id",children:"Unidade *"}),c.jsxs(Lr,{value:D("unidade_id"),onValueChange:U=>I("unidade_id",U),children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione"})}),c.jsx(Fr,{children:m.map(U=>c.jsx(yt,{value:U.id,children:U.nome},U.id))})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"categoria",children:"Categoria *"}),c.jsx(xr,{...S("categoria",{required:!0})})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"tag_patrimonio",children:"Tag Patrimnio *"}),c.jsx(xr,{...S("tag_patrimonio",{required:!0})})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"fabricante",children:"Fabricante"}),c.jsx(xr,{...S("fabricante")})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"modelo",children:"Modelo"}),c.jsx(xr,{...S("modelo")})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"numero_serie",children:"Nmero de Srie"}),c.jsx(xr,{...S("numero_serie")})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"status",children:"Status *"}),c.jsxs(Lr,{value:D("status"),onValueChange:U=>I("status",U),children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Operacional"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"operacional",children:"Operacional"}),c.jsx(yt,{value:"manutencao",children:"Manuteno"}),c.jsx(yt,{value:"inativo",children:"Inativo"}),c.jsx(yt,{value:"descartado",children:"Descartado"})]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"critico",children:"Crtico *"}),c.jsxs(Lr,{value:(F=D("critico"))==null?void 0:F.toString(),onValueChange:U=>I("critico",U==="true"),children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"No"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"false",children:"No"}),c.jsx(yt,{value:"true",children:"Sim"})]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"data_instalacao",children:"Data Instalao"}),c.jsx(xr,{type:"date",...S("data_instalacao")})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"frequencia_preventiva_dias",children:"Frequncia Preventiva (dias)"}),c.jsx(xr,{type:"number",...S("frequencia_preventiva_dias")})]})]}),c.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:justify-end",children:[c.jsx(Nt,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Cancelar"}),c.jsx(Nt,{type:"submit",disabled:u,className:"sm:w-auto",children:u?"Salvando...":"Cadastrar"})]})]})]})})}function $ge(){var ct;const[e,t]=V.useState([]),[r,s]=V.useState([]),[u,f]=V.useState(""),[m,i]=V.useState("all"),[S,E]=V.useState("all"),[I,D]=V.useState("all"),[M,R]=V.useState("all"),[H,F]=V.useState("all"),[U,Y]=V.useState(!1),[z,J]=V.useState(null),[ne,me]=V.useState(null),[le,ye]=V.useState({});V.useEffect(()=>{pe()},[]),V.useEffect(()=>{const Me=e.filter(mt=>{var nt,dt,Vt,zt,Gt;const Kt=((nt=mt.tag_patrimonio)==null?void 0:nt.toLowerCase().includes(u.toLowerCase()))||((dt=mt.categoria)==null?void 0:dt.toLowerCase().includes(u.toLowerCase()))||((Vt=mt.fabricante)==null?void 0:Vt.toLowerCase().includes(u.toLowerCase()))||((zt=mt.modelo)==null?void 0:zt.toLowerCase().includes(u.toLowerCase())),it=m==="all"||mt.categoria===m,ee=S==="all"||mt.fabricante===S,he=I==="all"||((Gt=mt.unidades)==null?void 0:Gt.id)===I,Se=M==="all"||mt.status===M,Ue=H==="all"||(H==="critico"?!!mt.critico:!mt.critico);return Kt&&it&&ee&&he&&Se&&Ue});s(Me)},[u,e,m,S,I,M,H]);const pe=async()=>{const{data:Me,error:mt}=await tt.from("ativos").select("*, unidades(id, nome)").order("created_at",{ascending:!1});if(mt){$t.error("Erro ao carregar ativos");return}t(Me||[]),be(Me||[])},be=Me=>{const mt=Me.length,Kt=Me.reduce((he,Se)=>{const Ue=Se.categoria||"Sem categoria";return he[Ue]=(he[Ue]||0)+1,he},{}),it=Me.filter(he=>he.status==="operacional").length,ee=Me.filter(he=>he.critico).length;ye({totalAtivos:mt,categorias:Kt,operacionais:it,criticos:ee})},ke=async Me=>{if(!confirm("Tem certeza que deseja deletar este ativo?"))return;const{error:mt}=await tt.from("ativos").delete().eq("id",Me);if(mt){$t.error("Erro ao deletar ativo");return}$t.success("Ativo deletado com sucesso!"),pe()},Oe=Me=>{me(Me),Y(!0)},Ee=()=>{me(null),Y(!0)},qe=Array.from(new Set(e.map(Me=>Me.categoria).filter(Boolean))),Qe=Array.from(new Set(e.map(Me=>Me.fabricante).filter(Boolean))),gt=Array.from(new Set(e.map(Me=>Me.unidades?{id:Me.unidades.id,nome:Me.unidades.nome}:null).filter(Boolean).map(Me=>JSON.stringify(Me)))).map(Me=>JSON.parse(Me)),Xe=Array.from(new Set(e.map(Me=>Me.status).filter(Boolean)));return c.jsxs(Wa,{children:[c.jsxs("div",{className:"p-6 space-y-6",children:[c.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[c.jsx("h1",{className:"text-3xl font-bold",children:"Gesto de Ativos"}),c.jsxs(Nt,{onClick:Ee,children:[c.jsx(Sc,{className:"h-4 w-4 mr-2"}),"Novo Ativo"]})]}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[c.jsxs($r,{children:[c.jsxs(Xn,{className:"flex flex-col items-center justify-center space-y-1 pb-2 text-center",children:[c.jsx(ti,{className:"text-sm font-medium",children:"Total de Ativos"}),c.jsx(ef,{className:"h-4 w-4 text-muted-foreground"})]}),c.jsx(_n,{className:"text-center",children:c.jsx("div",{className:"text-2xl font-bold",children:le.totalAtivos||0})})]}),c.jsxs($r,{children:[c.jsxs(Xn,{className:"flex flex-col items-center justify-center space-y-1 pb-2 text-center",children:[c.jsx(ti,{className:"text-sm font-medium",children:"Operacionais"}),c.jsx(ef,{className:"h-4 w-4 text-muted-foreground"})]}),c.jsx(_n,{className:"text-center",children:c.jsx("div",{className:"text-2xl font-bold",children:le.operacionais||0})})]}),c.jsxs($r,{children:[c.jsxs(Xn,{className:"flex flex-col items-center justify-center space-y-1 pb-2 text-center",children:[c.jsx(ti,{className:"text-sm font-medium",children:"Crticos"}),c.jsx(ef,{className:"h-4 w-4 text-muted-foreground"})]}),c.jsx(_n,{className:"text-center",children:c.jsx("div",{className:"text-2xl font-bold",children:le.criticos||0})})]})]}),c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:Object.entries(le.categorias||{}).map(([Me,mt])=>c.jsxs($r,{children:[c.jsxs(Xn,{className:"flex flex-col items-center justify-center space-y-1 pb-2 text-center",children:[c.jsx(ti,{className:"text-sm font-medium capitalize",children:Me}),c.jsx(ef,{className:"h-4 w-4 text-muted-foreground"})]}),c.jsx(_n,{className:"text-center",children:c.jsx("div",{className:"text-2xl font-bold",children:mt})})]},Me))}),c.jsxs($r,{children:[c.jsx(Xn,{children:c.jsxs("div",{className:"flex flex-col gap-3",children:[c.jsxs("div",{className:"relative w-full",children:[c.jsx(gd,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),c.jsx(xr,{placeholder:"Buscar por tag, categoria, fabricante ou modelo...",value:u,onChange:Me=>f(Me.target.value),className:"pl-8"})]}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-2 md:gap-3 w-full",children:[c.jsxs(Lr,{value:m,onValueChange:i,children:[c.jsx(Or,{className:"w-full",children:c.jsx(zr,{placeholder:"Categoria"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"all",children:"Todas categorias"}),qe.map(Me=>c.jsx(yt,{value:Me,children:Me},Me))]})]}),c.jsxs(Lr,{value:S,onValueChange:E,children:[c.jsx(Or,{className:"w-full",children:c.jsx(zr,{placeholder:"Fabricante"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"all",children:"Todos fabricantes"}),Qe.map(Me=>c.jsx(yt,{value:Me,children:Me},Me))]})]}),c.jsxs(Lr,{value:I,onValueChange:D,children:[c.jsx(Or,{className:"w-full",children:c.jsx(zr,{placeholder:"Unidade"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"all",children:"Todas unidades"}),gt.map(Me=>c.jsx(yt,{value:Me.id,children:Me.nome},Me.id))]})]}),c.jsxs(Lr,{value:M,onValueChange:R,children:[c.jsx(Or,{className:"w-full",children:c.jsx(zr,{placeholder:"Status"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"all",children:"Todos status"}),Xe.map(Me=>c.jsx(yt,{value:Me,children:Me},Me))]})]}),c.jsxs(Lr,{value:H,onValueChange:F,children:[c.jsx(Or,{className:"w-full",children:c.jsx(zr,{placeholder:"Crtico"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"all",children:"Todos"}),c.jsx(yt,{value:"critico",children:"Crtico"}),c.jsx(yt,{value:"nao_critico",children:"No crtico"})]})]})]})]})}),c.jsx(_n,{className:"overflow-x-auto sm:overflow-x-visible",children:c.jsxs(nu,{children:[c.jsx(iu,{children:c.jsxs(Ws,{children:[c.jsx(gn,{children:"Tag Patrimnio"}),c.jsx(gn,{className:"hidden sm:table-cell",children:"Categoria"}),c.jsx(gn,{className:"hidden sm:table-cell",children:"Fabricante"}),c.jsx(gn,{className:"hidden sm:table-cell",children:"Modelo"}),c.jsx(gn,{className:"hidden sm:table-cell",children:"Unidade"}),c.jsx(gn,{children:"Status"}),c.jsx(gn,{children:"Crtico"}),c.jsx(gn,{className:"hidden sm:table-cell",children:"Aes"})]})}),c.jsx(su,{children:r.map(Me=>{var mt;return c.jsxs(Ws,{className:"cursor-pointer",onClick:()=>J(Me),children:[c.jsx(tn,{className:"font-medium",children:Me.tag_patrimonio}),c.jsx(tn,{className:"hidden sm:table-cell",children:Me.categoria}),c.jsx(tn,{className:"hidden sm:table-cell",children:Me.fabricante}),c.jsx(tn,{className:"hidden sm:table-cell",children:Me.modelo}),c.jsx(tn,{className:"hidden sm:table-cell",children:((mt=Me.unidades)==null?void 0:mt.nome)||"-"}),c.jsx(tn,{children:c.jsx(Oi,{variant:Me.status==="operacional"?"default":Me.status==="manutencao"?"secondary":"outline",children:Me.status})}),c.jsx(tn,{children:Me.critico?c.jsx(Oi,{variant:"destructive",children:"Sim"}):c.jsx(Oi,{variant:"outline",children:"No"})}),c.jsx(tn,{className:"hidden sm:table-cell",children:c.jsxs("div",{className:"flex gap-2",children:[c.jsx(Nt,{variant:"ghost",size:"icon",onClick:Kt=>{Kt.stopPropagation(),Oe(Me)},children:c.jsx(jd,{className:"h-4 w-4"})}),c.jsx(Nt,{variant:"ghost",size:"icon",onClick:Kt=>{Kt.stopPropagation(),ke(Me.id)},children:c.jsx(zo,{className:"h-4 w-4"})})]})})]},Me.id)})})]})})]})]}),c.jsx(Vge,{open:U,onOpenChange:Y,ativo:ne,onSuccess:pe}),c.jsx(Bs,{open:!!z,onOpenChange:Me=>{Me||J(null)},children:c.jsxs(Is,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[c.jsxs(Ns,{className:"space-y-1",children:[c.jsx(ks,{children:(z==null?void 0:z.tag_patrimonio)||"Ativo"}),c.jsx(La,{children:"Detalhes completos do ativo"})]}),z&&c.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("span",{className:"text-xs text-muted-foreground",children:"Categoria"}),c.jsx("span",{className:"font-medium",children:z.categoria||"-"})]}),c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("span",{className:"text-xs text-muted-foreground",children:"Fabricante"}),c.jsx("span",{className:"font-medium",children:z.fabricante||"-"})]}),c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("span",{className:"text-xs text-muted-foreground",children:"Modelo"}),c.jsx("span",{className:"font-medium",children:z.modelo||"-"})]}),c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("span",{className:"text-xs text-muted-foreground",children:"Unidade"}),c.jsx("span",{className:"font-medium",children:((ct=z.unidades)==null?void 0:ct.nome)||"-"})]}),c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("span",{className:"text-xs text-muted-foreground",children:"Status"}),c.jsx("span",{className:"font-medium",children:z.status})]}),c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("span",{className:"text-xs text-muted-foreground",children:"Crtico"}),c.jsx("span",{className:"font-medium",children:z.critico?"Sim":"No"})]}),c.jsxs("div",{className:"flex flex-col gap-2 pt-2 sm:col-span-2 sm:flex-row sm:justify-end",children:[c.jsx(Nt,{variant:"outline",onClick:()=>{me(z),Y(!0),J(null)},children:"Editar"}),c.jsx(Nt,{variant:"destructive",onClick:()=>{ke(z.id),J(null)},children:"Excluir"})]})]})]})})]})}function qge({open:e,onOpenChange:t,item:r,onSuccess:s}){const[u,f]=V.useState(!1),[m,i]=V.useState([]),{register:S,handleSubmit:E,setValue:I,watch:D,reset:M}=QR({defaultValues:{unidade_id:(r==null?void 0:r.unidade_id)||"",nome:(r==null?void 0:r.nome)||"",sku:(r==null?void 0:r.sku)||"",descricao:(r==null?void 0:r.descricao)||"",unidade_medida:(r==null?void 0:r.unidade_medida)||"",quantidade_minima:(r==null?void 0:r.quantidade_minima)||0,quantidade_atual:(r==null?void 0:r.quantidade_atual)||0}});V.useEffect(()=>{R()},[]),V.useEffect(()=>{M(r?{unidade_id:r.unidade_id||"",nome:r.nome||"",sku:r.sku||"",descricao:r.descricao||"",unidade_medida:r.unidade_medida||"",quantidade_minima:r.quantidade_minima||0,quantidade_atual:r.quantidade_atual||0}:{unidade_id:"",nome:"",sku:"",descricao:"",unidade_medida:"",quantidade_minima:0,quantidade_atual:0})},[r,M]);const R=async()=>{const{data:F,error:U}=await tt.from("unidades").select("id, nome").order("nome");if(U){$t.error("Erro ao carregar unidades");return}i(F||[])},H=async F=>{f(!0);try{if(r){const{error:U}=await tt.from("itens_estoque").update(F).eq("id",r.id);if(U)throw U;$t.success("Item atualizado com sucesso!")}else{const{error:U}=await tt.from("itens_estoque").insert([F]);if(U)throw U;$t.success("Item cadastrado com sucesso!")}s(),t(!1),M()}catch(U){$t.error(U.message)}finally{f(!1)}};return c.jsx(Bs,{open:e,onOpenChange:t,children:c.jsxs(Is,{className:"max-w-xl max-h-[90vh] overflow-y-auto",children:[c.jsx(Ns,{children:c.jsx(ks,{children:r?"Editar Item":"Cadastrar Novo Item"})}),c.jsxs("form",{onSubmit:E(H),className:"space-y-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"unidade_id",children:"Unidade *"}),c.jsxs(Lr,{value:D("unidade_id"),onValueChange:F=>I("unidade_id",F),children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione"})}),c.jsx(Fr,{children:m.map(F=>c.jsx(yt,{value:F.id,children:F.nome},F.id))})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"sku",children:"SKU *"}),c.jsx(xr,{...S("sku",{required:!0})})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"nome",children:"Nome *"}),c.jsx(xr,{...S("nome",{required:!0})})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"descricao",children:"Descrio *"}),c.jsx(xr,{...S("descricao",{required:!0})})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"unidade_medida",children:"Unidade de Medida *"}),c.jsx(xr,{placeholder:"Ex: UN, KG, L",...S("unidade_medida",{required:!0})})]}),c.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"quantidade_minima",children:"Quantidade Mnima *"}),c.jsx(xr,{type:"number",...S("quantidade_minima",{required:!0,min:0})})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"quantidade_atual",children:"Quantidade Atual *"}),c.jsx(xr,{type:"number",...S("quantidade_atual",{required:!0,min:0})})]})]}),c.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:justify-end",children:[c.jsx(Nt,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Cancelar"}),c.jsx(Nt,{type:"submit",disabled:u,className:"sm:w-auto",children:u?"Salvando...":r?"Atualizar":"Cadastrar"})]})]})]})})}const Gge=()=>{const[e,t]=V.useState([]),[r,s]=V.useState(""),[u,f]=V.useState(!1),[m,i]=V.useState(null),[S,E]=V.useState({total:0,abaixoMinimo:0,quantidadeTotal:0});V.useEffect(()=>{I()},[]);const I=async()=>{const{data:z,error:J}=await tt.from("itens_estoque").select("*, unidades(nome)").order("created_at",{ascending:!1});if(J){$t.error("Erro ao carregar itens");return}t(z||[]),D(z||[])},D=z=>{const J=z.length,ne=z.filter(le=>le.quantidade_atual<le.quantidade_minima).length,me=z.reduce((le,ye)=>le+(ye.quantidade_atual||0),0);E({total:J,abaixoMinimo:ne,quantidadeTotal:me})},M=V.useMemo(()=>{const z=r.toLowerCase();return e.filter(J=>{var ne,me,le;return((ne=J.sku)==null?void 0:ne.toLowerCase().includes(z))||((me=J.nome)==null?void 0:me.toLowerCase().includes(z))||((le=J.descricao)==null?void 0:le.toLowerCase().includes(z))})},[e,r]),R=async z=>{if(!confirm("Tem certeza que deseja deletar este item?"))return;const{error:J}=await tt.from("itens_estoque").delete().eq("id",z);if(J){$t.error("Erro ao deletar item");return}$t.success("Item deletado com sucesso!"),I()},H=z=>{i(z),f(!0)},F=()=>{i(null),f(!0)},U=z=>z.quantidade_atual<z.quantidade_minima,Y=z=>z.quantidade_atual<z.quantidade_minima?{borderClass:"border-red-500",textClass:"text-red-600",label:"Abaixo do mnimo",Icon:i_}:z.quantidade_atual===z.quantidade_minima?{borderClass:"border-amber-400",textClass:"text-amber-500",label:"No limite",Icon:i_}:{borderClass:"border-emerald-500",textClass:"text-emerald-600",label:"Estoque saudvel",Icon:zb};return c.jsxs(Wa,{children:[c.jsxs("div",{className:"p-6 space-y-6",children:[c.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold",children:"Estoque"}),c.jsx("p",{className:"text-muted-foreground",children:"Controle de materiais e insumos."})]}),c.jsxs(Nt,{onClick:F,className:"w-full sm:w-auto",children:[c.jsx(Sc,{className:"h-4 w-4 mr-2"}),"Novo Item"]})]}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[c.jsxs($r,{children:[c.jsxs(Xn,{className:"flex items-center justify-between space-y-0 pb-2",children:[c.jsx(ti,{className:"text-sm font-medium",children:"Total de itens"}),c.jsx(ef,{className:"h-4 w-4 text-muted-foreground"})]}),c.jsx(_n,{className:"text-center",children:c.jsx("div",{className:"text-lg font-bold",children:S.total})})]}),c.jsxs($r,{children:[c.jsxs(Xn,{className:"flex items-center justify-between space-y-0 pb-2",children:[c.jsx(ti,{className:"text-sm font-medium",children:"Abaixo do mnimo"}),c.jsx(i_,{className:"h-4 w-4 text-muted-foreground"})]}),c.jsx(_n,{className:"text-center",children:c.jsx("div",{className:"text-lg font-bold",children:S.abaixoMinimo})})]}),c.jsxs($r,{children:[c.jsxs(Xn,{className:"flex items-center justify-between space-y-0 pb-2",children:[c.jsx(ti,{className:"text-sm font-medium",children:"Quantidade total"}),c.jsx(ef,{className:"h-4 w-4 text-muted-foreground"})]}),c.jsx(_n,{className:"text-center",children:c.jsx("div",{className:"text-lg font-bold",children:S.quantidadeTotal})})]})]}),c.jsxs($r,{children:[c.jsx(Xn,{children:c.jsxs("div",{className:"relative w-full",children:[c.jsx(gd,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),c.jsx(xr,{placeholder:"Buscar por SKU, nome ou descricao...",value:r,onChange:z=>s(z.target.value),className:"pl-9"})]})}),c.jsxs(_n,{children:[c.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[M.map(z=>{const J=Y(z);return c.jsx($r,{className:`border-2 ${J.borderClass} bg-transparent`,children:c.jsxs(_n,{className:"py-4 flex flex-col items-center text-center space-y-2",children:[c.jsx(J.Icon,{className:`h-6 w-6 ${J.textClass}`}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-semibold",children:z.nome}),c.jsx("p",{className:`text-xs ${J.textClass}`,children:J.label})]}),c.jsxs("div",{className:"text-lg font-bold",children:[z.quantidade_atual," ",c.jsxs("span",{className:"text-sm font-normal text-muted-foreground",children:["/ ",z.quantidade_minima]})]})]})},`indicator-${z.id}`)}),M.length===0&&c.jsx("div",{className:"col-span-full text-center text-sm text-muted-foreground",children:"Nenhum item para exibir nos indicadores."})]}),c.jsx("div",{className:"overflow-x-auto",children:c.jsxs(nu,{children:[c.jsx(iu,{children:c.jsxs(Ws,{children:[c.jsx(gn,{children:"SKU"}),c.jsx(gn,{children:"Nome"}),c.jsx(gn,{children:"Descricao"}),c.jsx(gn,{children:"Unidade"}),c.jsx(gn,{children:"Un. Medida"}),c.jsx(gn,{children:"Qtd. Minima"}),c.jsx(gn,{children:"Qtd. Atual"}),c.jsx(gn,{children:"Status"}),c.jsx(gn,{children:"Acoes"})]})}),c.jsxs(su,{children:[M.map(z=>{var J;return c.jsxs(Ws,{children:[c.jsx(tn,{className:"font-medium",children:z.sku}),c.jsx(tn,{children:z.nome}),c.jsx(tn,{children:z.descricao}),c.jsx(tn,{children:((J=z.unidades)==null?void 0:J.nome)||"-"}),c.jsx(tn,{children:z.unidade_medida}),c.jsx(tn,{children:z.quantidade_minima}),c.jsx(tn,{children:z.quantidade_atual}),c.jsx(tn,{children:U(z)?c.jsx(Oi,{variant:"destructive",children:"Abaixo do minimo"}):c.jsx(Oi,{children:"Normal"})}),c.jsx(tn,{children:c.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row",children:[c.jsx(Nt,{variant:"ghost",size:"icon",onClick:()=>H(z),className:"sm:w-auto",children:c.jsx(jd,{className:"h-4 w-4"})}),c.jsx(Nt,{variant:"ghost",size:"icon",onClick:()=>R(z.id),className:"sm:w-auto",children:c.jsx(zo,{className:"h-4 w-4"})})]})})]},z.id)}),M.length===0&&c.jsx(Ws,{children:c.jsx(tn,{colSpan:9,className:"text-center text-sm text-muted-foreground",children:"Nenhum item encontrado"})})]})]})})]})]})]}),c.jsx(qge,{open:u,onOpenChange:f,item:m,onSuccess:I})]})},xx="diaristas-anexos",zg=[{key:"anexo_cpf",label:"Documento CPF"},{key:"anexo_comprovante_endereco",label:"Comprovante de endereco"},{key:"anexo_dados_bancarios",label:"Dados bancarios"},{key:"anexo_possui_antecedente",label:"Comprovante antecedentes"}],Wge=["Banco do Brasil","Caixa Economica Federal","Bradesco","Itau Unibanco","Santander","Banco Safra","Banco BV","Banco Inter","Nubank","C6 Bank","Banco Pan","Banco Original","Banco BTG Pactual","Banco Daycoval","Banco Mercantil do Brasil","Banco Banrisul","Banco Sicoob","Banco Sicredi","Banco Modal","Banco Sofisa","Banco Cooperativo do Brasil","Banco Cooperativo Sicredi","Banco Neon","Banco Rendimento","Banco Topazio","Banco BS2","Banco Banestes","Banco Industrial do Brasil","Banco Agibank","Banco Votorantim"],t5=()=>({nome_completo:"",cpf:"",cep:"",endereco:"",cidade:"",telefone:"",email:"",possui_antecedente:!1,status:"ativo",banco:"",agencia:"",tipo_conta:"conta corrente",numero_conta:"",pix:""}),qN=()=>zg.reduce((e,t)=>(e[t.key]=null,e),{}),r5=()=>zg.reduce((e,t)=>(e[t.key]="",e),{});function Hge({open:e,onClose:t,onSuccess:r,diarista:s}){const[u,f]=V.useState(!1),[m,i]=V.useState(t5()),[S,E]=V.useState([]),[I,D]=V.useState([]),[M,R]=V.useState(!1),[H,F]=V.useState(r5()),[U,Y]=V.useState(qN()),[z,J]=V.useState(!1),ne=V.useRef(""),me=V.useCallback(async()=>{if(!(s!=null&&s.id)){E([]);return}R(!0);try{const{data:ee,error:he}=await tt.from("diaristas_anexos").select("*").eq("diarista_id",s.id).order("created_at",{ascending:!1});if(he)throw he;E(ee||[])}catch(ee){$t.error("Erro ao carregar anexos: "+ee.message)}finally{R(!1)}},[s==null?void 0:s.id]),le=V.useCallback(()=>{const ee=r5();s&&zg.forEach(({key:he})=>{ee[he]=s[he]||""}),F(ee)},[s]);V.useEffect(()=>{var ee;s?(i({nome_completo:s.nome_completo||"",cpf:s.cpf||"",cep:s.cep||"",endereco:s.endereco||"",cidade:s.cidade||"",telefone:s.telefone||"",email:s.email||"",possui_antecedente:s.possui_antecedente||!1,status:s.status||"ativo",banco:s.banco||"",agencia:s.agencia||"",tipo_conta:s.tipo_conta||"conta corrente",numero_conta:s.numero_conta||"",pix:s.pix||""}),ne.current=((ee=s.cep)==null?void 0:ee.replace(/\D/g,""))||"",me(),le()):(i(t5()),E([]),le(),ne.current=""),D([]),Y(qN())},[s,e,me,le]);const ye=ee=>{const he=ee.target.files;!he||he.length===0||(D(Se=>[...Se,...Array.from(he)]),ee.target.value="")},pe=(ee,he)=>{const Se=(he==null?void 0:he[0])||null;Y(Ue=>({...Ue,[ee]:Se}))},be=ee=>{Y(he=>({...he,[ee]:null}))},ke=ee=>{D(he=>he.filter((Se,Ue)=>Ue!==ee))},Oe=ee=>{const he=ee.replace(/\D/g,"").slice(0,8),Se=he.length>5?`${he.slice(0,5)}-${he.slice(5)}`:he;i(Ue=>({...Ue,cep:Se})),he.length<8&&(ne.current="")};V.useEffect(()=>{const ee=m.cep.replace(/\D/g,"");if(ee.length!==8||ee===ne.current)return;let he=!1;return(async()=>{J(!0);try{const Ue=await fetch(`https://viacep.com.br/ws/${ee}/json/`);if(!Ue.ok)throw new Error("CEP invlido");const nt=await Ue.json();if(nt.erro)throw new Error("CEP no encontrado");if(he)return;i(dt=>({...dt,endereco:nt.logradouro?`${nt.logradouro}${nt.bairro?` - ${nt.bairro}`:""}`:dt.endereco,cidade:nt.localidade||dt.cidade})),ne.current=ee,$t.success("Endereo preenchido automaticamente")}catch(Ue){if(he)return;ne.current="",$t.error((Ue==null?void 0:Ue.message)||"Erro ao buscar CEP")}finally{he||J(!1)}})(),()=>{he=!0}},[m.cep]);const Ee=async ee=>{R(!0);try{const{error:he}=await tt.storage.from(xx).remove([ee.caminho_storage]);if(he)throw he;const{error:Se}=await tt.from("diaristas_anexos").delete().eq("id",ee.id);if(Se)throw Se;$t.success("Anexo removido"),me()}catch(he){$t.error("Erro ao remover anexo: "+he.message)}finally{R(!1)}},qe=async ee=>{const{data:he,error:Se}=await tt.storage.from(xx).createSignedUrl(ee,120);if(Se||!(he!=null&&he.signedUrl))throw new Error("Link temporario indisponivel");return he.signedUrl},Qe=async ee=>{try{const he=await qe(ee.caminho_storage);window.open(he,"_blank","noopener,noreferrer")}catch(he){$t.error("Erro ao visualizar anexo: "+((he==null?void 0:he.message)||"Tente novamente"))}},gt=async ee=>{try{const he=await qe(ee.caminho_storage),Se=document.createElement("a");Se.href=he,Se.download=ee.nome_arquivo||"anexo",Se.target="_blank",document.body.appendChild(Se),Se.click(),document.body.removeChild(Se)}catch(he){$t.error("Erro ao baixar anexo: "+((he==null?void 0:he.message)||"Tente novamente"))}},Xe=async ee=>{if(!I.length)return;const{data:he,error:Se}=await tt.auth.getUser();if(Se||!he.user)throw new Error("Usuario nao autenticado");for(const Ue of I){const nt=`${ee}/${Date.now()}-${Ue.name}`,{error:dt}=await tt.storage.from(xx).upload(nt,Ue,{upsert:!1});if(dt)throw dt;const{error:Vt}=await tt.from("diaristas_anexos").insert({diarista_id:ee,nome_arquivo:Ue.name,caminho_storage:nt,tipo_arquivo:Ue.type||null,tamanho_bytes:Ue.size,uploaded_by:he.user.id});if(Vt)throw await tt.storage.from(xx).remove([nt]),Vt}D([]),await me()},ct=async ee=>{const he={...H};for(const Se of zg){const Ue=U[Se.key];if(!Ue)continue;const nt=`${ee}/docs/${Se.key}-${Date.now()}-${Ue.name}`,{error:dt}=await tt.storage.from(xx).upload(nt,Ue,{upsert:!1});if(dt)throw dt;const Vt=he[Se.key];Vt&&await tt.storage.from(xx).remove([Vt]),he[Se.key]=nt}for(const Se of zg)if(!he[Se.key])throw new Error(`Envie o arquivo: ${Se.label}`);return F(he),Y(qN()),he},Me=ee=>{var he;return((he=zg.find(Se=>Se.key===ee))==null?void 0:he.label)||"Documento"},mt=async ee=>{const he=H[ee];if(he)try{await Qe({nome:ee,caminho_storage:he})}catch(Se){$t.error("Erro ao visualizar anexo: "+Se.message)}},Kt=async ee=>{const he=H[ee];if(he)try{const Se=await qe(he),Ue=document.createElement("a");Ue.href=Se,Ue.download=Me(ee),Ue.target="_blank",document.body.appendChild(Ue),Ue.click(),document.body.removeChild(Ue)}catch(Se){$t.error("Erro ao baixar anexo: "+Se.message)}},it=async ee=>{if(ee.preventDefault(),!m.cpf.trim()){$t.error("Informe o CPF.");return}if(!m.banco){$t.error("Selecione o banco do diarista");return}if(m.possui_antecedente){$t.error("Nao e permitido cadastrar diaristas com antecedentes criminais");return}f(!0);try{const he=(s==null?void 0:s.id)??crypto.randomUUID(),Se=await ct(he);if(s){const{error:Ue}=await tt.from("diaristas").update({...m,...Se}).eq("id",he);if(Ue)throw Ue;$t.success("Diarista atualizado com sucesso")}else{const{error:Ue}=await tt.from("diaristas").insert([{id:he,...m,...Se}]);if(Ue)throw Ue;$t.success("Diarista cadastrado com sucesso")}await Xe(he),r()}catch(he){$t.error("Erro ao salvar diarista: "+he.message)}finally{f(!1)}};return c.jsx(Bs,{open:e,onOpenChange:t,children:c.jsxs(Is,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[c.jsx(Ns,{children:c.jsx(ks,{children:s?"Editar Diarista":"Novo Diarista"})}),c.jsxs("form",{onSubmit:it,className:"space-y-6",children:[c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{className:"space-y-2 md:col-span-2",children:[c.jsx(Dt,{htmlFor:"nome_completo",children:"Nome completo *"}),c.jsx(xr,{id:"nome_completo",value:m.nome_completo,onChange:ee=>i({...m,nome_completo:ee.target.value}),required:!0})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"cpf",children:"CPF *"}),c.jsx(xr,{id:"cpf",value:m.cpf,onChange:ee=>i({...m,cpf:ee.target.value.replace(/\\D/g,"").slice(0,14)}),placeholder:"Somente nmeros",required:!0})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"cep",children:"CEP *"}),c.jsx(xr,{id:"cep",value:m.cep,onChange:ee=>Oe(ee.target.value),placeholder:"00000-000",required:!0}),z&&c.jsx("p",{className:"text-xs text-muted-foreground",children:"Consultando CEP..."})]}),c.jsxs("div",{className:"space-y-2 md:col-span-2",children:[c.jsx(Dt,{htmlFor:"endereco",children:"Endereco *"}),c.jsx(xr,{id:"endereco",value:m.endereco,onChange:ee=>i({...m,endereco:ee.target.value}),required:!0})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"cidade",children:"Cidade *"}),c.jsx(xr,{id:"cidade",value:m.cidade,onChange:ee=>i({...m,cidade:ee.target.value}),required:!0})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"telefone",children:"Telefone *"}),c.jsx(xr,{id:"telefone",type:"tel",value:m.telefone,onChange:ee=>i({...m,telefone:ee.target.value}),required:!0})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"email",children:"Email *"}),c.jsx(xr,{id:"email",type:"email",value:m.email,onChange:ee=>i({...m,email:ee.target.value}),required:!0})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"possui_antecedente",children:"Possui antecedente criminal? *"}),c.jsxs(Lr,{value:m.possui_antecedente?"true":"false",onValueChange:ee=>i({...m,possui_antecedente:ee==="true"}),children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"false",children:"Nao"}),c.jsx(yt,{value:"true",children:"Sim"})]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"status",children:"Status *"}),c.jsxs(Lr,{value:m.status,onValueChange:ee=>i({...m,status:ee}),children:[c.jsx(Or,{children:c.jsx(zr,{})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"ativo",children:"Ativo"}),c.jsx(yt,{value:"inativo",children:"Inativo"}),c.jsx(yt,{value:"desligado",children:"Desligado"})]})]})]})]}),c.jsxs("div",{className:"border rounded-md p-4 space-y-4",children:[c.jsx("p",{className:"text-sm font-medium",children:"Dados bancarios"}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"banco",children:"Banco *"}),c.jsxs(Lr,{value:m.banco,onValueChange:ee=>i({...m,banco:ee}),children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione o banco"})}),c.jsx(Fr,{className:"max-h-64",children:Wge.map(ee=>c.jsx(yt,{value:ee,children:ee},ee))})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"agencia",children:"Agencia *"}),c.jsx(xr,{id:"agencia",value:m.agencia,onChange:ee=>i({...m,agencia:ee.target.value}),required:!0})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"tipo_conta",children:"Tipo de conta *"}),c.jsxs(Lr,{value:m.tipo_conta,onValueChange:ee=>i({...m,tipo_conta:ee}),children:[c.jsx(Or,{children:c.jsx(zr,{})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"conta corrente",children:"Conta corrente"}),c.jsx(yt,{value:"conta poupanca",children:"Conta poupanca"}),c.jsx(yt,{value:"conta salario",children:"Conta salario"})]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"numero_conta",children:"Numero da conta *"}),c.jsx(xr,{id:"numero_conta",value:m.numero_conta,onChange:ee=>i({...m,numero_conta:ee.target.value}),required:!0})]}),c.jsxs("div",{className:"space-y-2 md:col-span-2",children:[c.jsx(Dt,{htmlFor:"pix",children:"Chave PIX *"}),c.jsx(xr,{id:"pix",value:m.pix,onChange:ee=>i({...m,pix:ee.target.value}),required:!0})]})]})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsx("p",{className:"text-sm font-medium",children:"Documentos obrigatorios"}),c.jsx("div",{className:"grid grid-cols-1 gap-4",children:zg.map(({key:ee,label:he})=>{const Se=H[ee],Ue=U[ee];return c.jsxs("div",{className:"rounded-md border p-3 space-y-2",children:[c.jsxs("div",{className:"flex items-center justify-between gap-2",children:[c.jsx(Dt,{children:he}),Se&&c.jsxs("div",{className:"flex flex-wrap gap-2",children:[c.jsx(Nt,{type:"button",variant:"outline",size:"sm",onClick:()=>mt(ee),children:"Visualizar"}),c.jsx(Nt,{type:"button",variant:"outline",size:"sm",onClick:()=>Kt(ee),children:"Baixar"})]})]}),c.jsx(xr,{type:"file",onChange:nt=>pe(ee,nt.target.files)}),Ue?c.jsxs("div",{className:"flex items-center justify-between text-xs",children:[c.jsx("span",{className:"truncate",children:Ue.name}),c.jsx(Nt,{type:"button",variant:"ghost",size:"sm",className:"h-7 px-2",onClick:()=>be(ee),children:"Remover"})]}):Se?c.jsxs("p",{className:"text-xs text-muted-foreground break-all",children:["Arquivo atual: ",Se.split("/").pop()]}):c.jsx("p",{className:"text-xs text-muted-foreground",children:"Nenhum arquivo enviado."})]},ee)})})]}),c.jsxs("div",{className:"space-y-3",children:[c.jsx(Dt,{children:"Documentos / anexos adicionais"}),c.jsx(xr,{type:"file",multiple:!0,onChange:ye}),I.length>0&&c.jsxs("div",{className:"rounded-md border p-3 space-y-2 text-sm",children:[c.jsx("p",{className:"font-medium",children:"Anexos novos"}),I.map((ee,he)=>c.jsxs("div",{className:"flex items-center justify-between gap-2 text-xs",children:[c.jsx("span",{className:"truncate",children:ee.name}),c.jsx(Nt,{type:"button",variant:"ghost",size:"sm",className:"h-7 px-2",onClick:()=>ke(he),children:"Remover"})]},`${ee.name}-${he}`))]}),c.jsxs("div",{className:"rounded-md border p-3 space-y-2 text-sm",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("p",{className:"font-medium",children:"Anexos existentes"}),M&&c.jsx("span",{className:"text-xs text-muted-foreground",children:"Atualizando..."})]}),S.length===0?c.jsx("p",{className:"text-xs text-muted-foreground",children:"Nenhum anexo cadastrado."}):S.map(ee=>c.jsxs("div",{className:"flex items-center justify-between gap-2 text-xs",children:[c.jsx("span",{className:"truncate",children:ee.nome_arquivo}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx(Nt,{type:"button",variant:"outline",size:"sm",className:"h-7 px-2",onClick:()=>Qe(ee),children:"Visualizar"}),c.jsx(Nt,{type:"button",variant:"outline",size:"sm",className:"h-7 px-2",onClick:()=>gt(ee),children:"Baixar"}),c.jsx(Nt,{type:"button",variant:"ghost",size:"sm",className:"h-7 px-2",onClick:()=>Ee(ee),children:"Excluir"})]})]},ee.id))]})]}),c.jsxs("div",{className:"flex justify-end gap-2",children:[c.jsx(Nt,{type:"button",variant:"outline",onClick:t,children:"Cancelar"}),c.jsx(Nt,{type:"submit",disabled:u,children:u?"Salvando...":s?"Atualizar":"Cadastrar"})]})]})]})})}const n5="diaristas-anexos",Zge=[{key:"anexo_cpf",label:"Documento CPF"},{key:"anexo_comprovante_endereco",label:"Comprovante de endereco"},{key:"anexo_dados_bancarios",label:"Dados bancarios"},{key:"anexo_possui_antecedente",label:"Comprovante antecedentes"}],Xge=e=>e==="ativo"?"default":e==="desligado"?"destructive":"secondary";function Yge(){const[e,t]=V.useState(""),[r,s]=V.useState(!1),[u,f]=V.useState(null),[m,i]=V.useState(null),[S,E]=V.useState(null),[I,D]=V.useState([]),[M,R]=V.useState(!1),H=Tm(),{data:F,isLoading:U}=aa({queryKey:["diaristas"],queryFn:async()=>{const{data:pe,error:be}=await tt.from("diaristas").select("*").order("nome_completo");if(be)throw be;return pe||[]}}),Y=F==null?void 0:F.filter(pe=>pe.nome_completo.toLowerCase().includes(e.toLowerCase())||pe.email.toLowerCase().includes(e.toLowerCase())||pe.telefone.includes(e)),z=pe=>{f(pe),s(!0)},J=async pe=>{try{const{error:be}=await tt.from("diaristas").delete().eq("id",pe);if(be)throw be;$t.success("Diarista excludo com sucesso"),H.invalidateQueries({queryKey:["diaristas"]}),i(null)}catch(be){$t.error("Erro ao excluir diarista: "+be.message)}},ne=async pe=>{R(!0);try{const{data:be,error:ke}=await tt.from("diaristas_anexos").select("*").eq("diarista_id",pe).order("created_at",{ascending:!1});if(ke)throw ke;const Oe=await Promise.all((be||[]).map(async Ee=>{const{data:qe}=await tt.storage.from(n5).createSignedUrl(Ee.caminho_storage,120);return{id:Ee.id,nome_arquivo:Ee.nome_arquivo,caminho_storage:Ee.caminho_storage,created_at:Ee.created_at,url:(qe==null?void 0:qe.signedUrl)||null}}));D(Oe)}catch(be){$t.error("Erro ao carregar anexos: "+be.message),D([])}finally{R(!1)}},me=async pe=>{const{data:be,error:ke}=await tt.storage.from(n5).createSignedUrl(pe,120);if(ke||!(be!=null&&be.signedUrl))throw new Error((ke==null?void 0:ke.message)||"No foi possvel gerar o link");return be.signedUrl},le=async pe=>{try{const be=await me(pe);window.open(be,"_blank")}catch(be){$t.error("Erro ao visualizar documento: "+be.message)}},ye=async pe=>{try{const be=await me(pe),ke=document.createElement("a");ke.href=be,ke.download=pe.split("/").pop()||"documento",ke.target="_blank",document.body.appendChild(ke),ke.click(),document.body.removeChild(ke)}catch(be){$t.error("Erro ao baixar documento: "+be.message)}};return V.useEffect(()=>{S!=null&&S.id?ne(S.id):D([])},[S==null?void 0:S.id]),c.jsxs(Wa,{children:[c.jsxs("div",{className:"space-y-6 p-4 md:p-6",children:[c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsx("h1",{className:"text-3xl font-bold",children:"Diaristas"}),c.jsxs(Nt,{onClick:()=>{f(null),s(!0)},children:[c.jsx(Sc,{className:"mr-2 h-4 w-4"}),"Novo Diarista"]})]}),c.jsx("div",{className:"flex items-center gap-4",children:c.jsxs("div",{className:"relative flex-1",children:[c.jsx(gd,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),c.jsx(xr,{placeholder:"Buscar por nome, email ou telefone...",value:e,onChange:pe=>t(pe.target.value),className:"pl-10"})]})}),c.jsx("div",{className:"border rounded-lg overflow-x-auto",children:c.jsxs(nu,{children:[c.jsx(iu,{children:c.jsxs(Ws,{children:[c.jsx(gn,{children:"Nome"}),c.jsx(gn,{children:"Cidade"}),c.jsx(gn,{children:"Telefone"}),c.jsx(gn,{className:"hidden sm:table-cell",children:"Email"}),c.jsx(gn,{className:"hidden lg:table-cell",children:"Banco"}),c.jsx(gn,{children:"Status"}),c.jsx(gn,{className:"text-right",children:"Aes"})]})}),c.jsx(su,{children:U?c.jsx(Ws,{children:c.jsx(tn,{colSpan:8,className:"text-center",children:"Carregando..."})}):(Y==null?void 0:Y.length)===0?c.jsx(Ws,{children:c.jsx(tn,{colSpan:8,className:"text-center",children:"Nenhum diarista encontrado"})}):Y==null?void 0:Y.map(pe=>c.jsxs(Ws,{className:"cursor-pointer",onClick:()=>E(pe),children:[c.jsx(tn,{className:"font-medium",children:pe.nome_completo}),c.jsx(tn,{children:pe.cidade||"-"}),c.jsx(tn,{children:pe.telefone}),c.jsx(tn,{className:"hidden sm:table-cell",children:pe.email}),c.jsx(tn,{className:"hidden lg:table-cell",children:pe.banco||"-"}),c.jsx(tn,{children:c.jsx(Oi,{variant:Xge(pe.status),children:pe.status})}),c.jsx(tn,{className:"text-right",children:c.jsxs("div",{className:"flex justify-end gap-2",children:[c.jsx(Nt,{variant:"ghost",size:"icon",onClick:be=>{be.stopPropagation(),z(pe)},children:c.jsx(jd,{className:"h-4 w-4"})}),c.jsx(Nt,{variant:"ghost",size:"icon",onClick:be=>{be.stopPropagation(),i(pe.id)},children:c.jsx(zo,{className:"h-4 w-4"})})]})})]},pe.id))})]})})]}),c.jsx(Hge,{open:r,onClose:()=>{s(!1),f(null)},onSuccess:()=>{H.invalidateQueries({queryKey:["diaristas"]}),s(!1),f(null)},diarista:u}),c.jsx(Cd,{open:!!m,onOpenChange:()=>i(null),children:c.jsxs(ju,{children:[c.jsxs(Iu,{children:[c.jsx(ku,{children:"Confirmar excluso"}),c.jsx(Pu,{children:"Tem certeza que deseja excluir este diarista? Esta ao no pode ser desfeita."})]}),c.jsxs(Nu,{children:[c.jsx(gh,{children:"Cancelar"}),c.jsx(Du,{onClick:()=>m&&J(m),children:"Excluir"})]})]})}),c.jsx(Bs,{open:!!S,onOpenChange:pe=>{pe||E(null)},children:c.jsxs(Is,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[c.jsxs(Ns,{children:[c.jsx(ks,{children:(S==null?void 0:S.nome_completo)||"Diarista"}),c.jsx(La,{children:"Dados completos do diarista"})]}),S&&c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-xs text-muted-foreground",children:"Email"}),c.jsx("p",{className:"font-medium break-words",children:S.email||"-"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-xs text-muted-foreground",children:"Telefone"}),c.jsx("p",{className:"font-medium break-words",children:S.telefone||"-"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-xs text-muted-foreground",children:"Cidade"}),c.jsx("p",{className:"font-medium break-words",children:S.cidade||"-"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-xs text-muted-foreground",children:"CEP"}),c.jsx("p",{className:"font-medium break-words",children:S.cep||"-"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-xs text-muted-foreground",children:"Status"}),c.jsx("p",{className:"font-medium break-words",children:S.status})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-xs text-muted-foreground",children:"Banco"}),c.jsx("p",{className:"font-medium break-words",children:S.banco||"-"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-xs text-muted-foreground",children:"Agencia"}),c.jsx("p",{className:"font-medium break-words",children:S.agencia||"-"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-xs text-muted-foreground",children:"Tipo de conta"}),c.jsx("p",{className:"font-medium break-words",children:S.tipo_conta||"-"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-xs text-muted-foreground",children:"Numero da conta"}),c.jsx("p",{className:"font-medium break-words",children:S.numero_conta||"-"})]}),c.jsxs("div",{className:"sm:col-span-2",children:[c.jsx("p",{className:"text-xs text-muted-foreground",children:"Chave PIX"}),c.jsx("p",{className:"font-medium break-words",children:S.pix||"-"})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("p",{className:"text-sm font-medium",children:"Documentos obrigatorios"}),c.jsx("div",{className:"space-y-2",children:Zge.map(({key:pe,label:be})=>{const ke=S[pe];return c.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 rounded-md border px-3 py-2",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-xs text-muted-foreground",children:be}),c.jsx("p",{className:"text-sm font-medium break-all",children:ke?ke.split("/").pop():"Nao enviado"})]}),ke?c.jsxs("div",{className:"flex flex-wrap gap-2",children:[c.jsx(Nt,{size:"sm",variant:"outline",onClick:()=>le(ke),children:"Visualizar"}),c.jsx(Nt,{size:"sm",variant:"secondary",onClick:()=>ye(ke),children:"Baixar"})]}):c.jsx("span",{className:"text-xs text-muted-foreground",children:"Sem arquivo"})]},pe)})})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("p",{className:"text-sm font-medium",children:"Anexos"}),M?c.jsx("p",{className:"text-xs text-muted-foreground",children:"Carregando anexos..."}):I.length===0?c.jsx("p",{className:"text-xs text-muted-foreground",children:"Nenhum anexo cadastrado."}):c.jsx("div",{className:"space-y-2",children:I.map(pe=>c.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 rounded-md border px-3 py-2",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium break-all",children:pe.nome_arquivo}),c.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(pe.created_at).toLocaleString("pt-BR")})]}),pe.url?c.jsxs("div",{className:"flex flex-wrap gap-2 mt-1",children:[c.jsx(Nt,{asChild:!0,size:"sm",variant:"outline",children:c.jsx("a",{href:pe.url,target:"_blank",rel:"noreferrer",children:"Visualizar"})}),c.jsx(Nt,{asChild:!0,size:"sm",variant:"secondary",children:c.jsx("a",{href:pe.url,target:"_blank",rel:"noreferrer",download:pe.nome_arquivo,children:"Baixar"})})]}):c.jsx("span",{className:"text-xs text-muted-foreground",children:"Sem link"})]},pe.id))})]})]})]})})]})}/*! xlsx.js (C) 2013-present SheetJS -- http://sheetjs.com */var fC={};fC.version="0.18.5";var FG=1252,Kge=[874,932,936,949,950,1250,1251,1252,1253,1254,1255,1256,1257,1258,1e4],LG=function(e){Kge.indexOf(e)!=-1&&(FG=e)};function Jge(){LG(1252)}var wb=function(e){LG(e)};function Qge(){wb(1200),Jge()}var MT=function(t){return String.fromCharCode(t)},i5=function(t){return String.fromCharCode(t)},Bg,Wp="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function bb(e){for(var t="",r=0,s=0,u=0,f=0,m=0,i=0,S=0,E=0;E<e.length;)r=e.charCodeAt(E++),f=r>>2,s=e.charCodeAt(E++),m=(r&3)<<4|s>>4,u=e.charCodeAt(E++),i=(s&15)<<2|u>>6,S=u&63,isNaN(s)?i=S=64:isNaN(u)&&(S=64),t+=Wp.charAt(f)+Wp.charAt(m)+Wp.charAt(i)+Wp.charAt(S);return t}function vf(e){var t="",r=0,s=0,u=0,f=0,m=0,i=0,S=0;e=e.replace(/[^\w\+\/\=]/g,"");for(var E=0;E<e.length;)f=Wp.indexOf(e.charAt(E++)),m=Wp.indexOf(e.charAt(E++)),r=f<<2|m>>4,t+=String.fromCharCode(r),i=Wp.indexOf(e.charAt(E++)),s=(m&15)<<4|i>>2,i!==64&&(t+=String.fromCharCode(s)),S=Wp.indexOf(e.charAt(E++)),u=(i&3)<<6|S,S!==64&&(t+=String.fromCharCode(u));return t}var sa=function(){return typeof Buffer<"u"&&typeof process<"u"&&typeof process.versions<"u"&&!!process.versions.node}(),Cf=function(){if(typeof Buffer<"u"){var e=!Buffer.from;if(!e)try{Buffer.from("foo","utf8")}catch{e=!0}return e?function(t,r){return r?new Buffer(t,r):new Buffer(t)}:Buffer.from.bind(Buffer)}return function(){}}();function T_(e){return sa?Buffer.alloc?Buffer.alloc(e):new Buffer(e):typeof Uint8Array<"u"?new Uint8Array(e):new Array(e)}function s5(e){return sa?Buffer.allocUnsafe?Buffer.allocUnsafe(e):new Buffer(e):typeof Uint8Array<"u"?new Uint8Array(e):new Array(e)}var md=function(t){return sa?Cf(t,"binary"):t.split("").map(function(r){return r.charCodeAt(0)&255})};function bA(e){if(typeof ArrayBuffer>"u")return md(e);for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),s=0;s!=e.length;++s)r[s]=e.charCodeAt(s)&255;return t}function t2(e){if(Array.isArray(e))return e.map(function(s){return String.fromCharCode(s)}).join("");for(var t=[],r=0;r<e.length;++r)t[r]=String.fromCharCode(e[r]);return t.join("")}function e_e(e){if(typeof Uint8Array>"u")throw new Error("Unsupported");return new Uint8Array(e)}var ll=sa?function(e){return Buffer.concat(e.map(function(t){return Buffer.isBuffer(t)?t:Cf(t)}))}:function(e){if(typeof Uint8Array<"u"){var t=0,r=0;for(t=0;t<e.length;++t)r+=e[t].length;var s=new Uint8Array(r),u=0;for(t=0,r=0;t<e.length;r+=u,++t)if(u=e[t].length,e[t]instanceof Uint8Array)s.set(e[t],r);else{if(typeof e[t]=="string")throw"wtf";s.set(new Uint8Array(e[t]),r)}return s}return[].concat.apply([],e.map(function(f){return Array.isArray(f)?f:[].slice.call(f)}))};function t_e(e){for(var t=[],r=0,s=e.length+250,u=T_(e.length+255),f=0;f<e.length;++f){var m=e.charCodeAt(f);if(m<128)u[r++]=m;else if(m<2048)u[r++]=192|m>>6&31,u[r++]=128|m&63;else if(m>=55296&&m<57344){m=(m&1023)+64;var i=e.charCodeAt(++f)&1023;u[r++]=240|m>>8&7,u[r++]=128|m>>2&63,u[r++]=128|i>>6&15|(m&3)<<4,u[r++]=128|i&63}else u[r++]=224|m>>12&15,u[r++]=128|m>>6&63,u[r++]=128|m&63;r>s&&(t.push(u.slice(0,r)),r=0,u=T_(65535),s=65530)}return t.push(u.slice(0,r)),ll(t)}var Lw=/\u0000/g,OT=/[\u0001-\u0006]/g;function Jx(e){for(var t="",r=e.length-1;r>=0;)t+=e.charAt(r--);return t}function xd(e,t){var r=""+e;return r.length>=t?r:fo("0",t-r.length)+r}function gM(e,t){var r=""+e;return r.length>=t?r:fo(" ",t-r.length)+r}function pC(e,t){var r=""+e;return r.length>=t?r:r+fo(" ",t-r.length)}function r_e(e,t){var r=""+Math.round(e);return r.length>=t?r:fo("0",t-r.length)+r}function n_e(e,t){var r=""+e;return r.length>=t?r:fo("0",t-r.length)+r}var a5=Math.pow(2,32);function vx(e,t){if(e>a5||e<-a5)return r_e(e,t);var r=Math.round(e);return n_e(r,t)}function mC(e,t){return t=t||0,e.length>=7+t&&(e.charCodeAt(t)|32)===103&&(e.charCodeAt(t+1)|32)===101&&(e.charCodeAt(t+2)|32)===110&&(e.charCodeAt(t+3)|32)===101&&(e.charCodeAt(t+4)|32)===114&&(e.charCodeAt(t+5)|32)===97&&(e.charCodeAt(t+6)|32)===108}var o5=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],GN=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];function i_e(e){return e||(e={}),e[0]="General",e[1]="0",e[2]="0.00",e[3]="#,##0",e[4]="#,##0.00",e[9]="0%",e[10]="0.00%",e[11]="0.00E+00",e[12]="# ?/?",e[13]="# ??/??",e[14]="m/d/yy",e[15]="d-mmm-yy",e[16]="d-mmm",e[17]="mmm-yy",e[18]="h:mm AM/PM",e[19]="h:mm:ss AM/PM",e[20]="h:mm",e[21]="h:mm:ss",e[22]="m/d/yy h:mm",e[37]="#,##0 ;(#,##0)",e[38]="#,##0 ;[Red](#,##0)",e[39]="#,##0.00;(#,##0.00)",e[40]="#,##0.00;[Red](#,##0.00)",e[45]="mm:ss",e[46]="[h]:mm:ss",e[47]="mmss.0",e[48]="##0.0E+0",e[49]="@",e[56]='"/ "hh""mm""ss" "',e}var po={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",56:'"/ "hh""mm""ss" "'},l5={5:37,6:38,7:39,8:40,23:0,24:0,25:0,26:0,27:14,28:14,29:14,30:14,31:14,50:14,51:14,52:14,53:14,54:14,55:14,56:14,57:14,58:14,59:1,60:2,61:3,62:4,67:9,68:10,69:12,70:13,71:14,72:14,73:15,74:16,75:17,76:20,77:21,78:22,79:45,80:46,81:47,82:0},s_e={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function gC(e,t,r){for(var s=e<0?-1:1,u=e*s,f=0,m=1,i=0,S=1,E=0,I=0,D=Math.floor(u);E<t&&(D=Math.floor(u),i=D*m+f,I=D*E+S,!(u-D<5e-8));)u=1/(u-D),f=m,m=i,S=E,E=I;if(I>t&&(E>t?(I=S,i=f):(I=E,i=m)),!r)return[0,s*i,I];var M=Math.floor(s*i/I);return[M,s*i-M*I,I]}function FT(e,t,r){if(e>2958465||e<0)return null;var s=e|0,u=Math.floor(86400*(e-s)),f=0,m=[],i={D:s,T:u,u:86400*(e-s)-u,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(i.u)<1e-6&&(i.u=0),t&&t.date1904&&(s+=1462),i.u>.9999&&(i.u=0,++u==86400&&(i.T=u=0,++s,++i.D)),s===60)m=r?[1317,10,29]:[1900,2,29],f=3;else if(s===0)m=r?[1317,8,29]:[1900,1,0],f=6;else{s>60&&--s;var S=new Date(1900,0,1);S.setDate(S.getDate()+s-1),m=[S.getFullYear(),S.getMonth()+1,S.getDate()],f=S.getDay(),s<60&&(f=(f+6)%7),r&&(f=h_e(S,m))}return i.y=m[0],i.m=m[1],i.d=m[2],i.S=u%60,u=Math.floor(u/60),i.M=u%60,u=Math.floor(u/60),i.H=u,i.q=f,i}var zG=new Date(1899,11,31,0,0,0),a_e=zG.getTime(),o_e=new Date(1900,2,1,0,0,0);function BG(e,t){var r=e.getTime();return t?r-=1461*24*60*60*1e3:e>=o_e&&(r+=24*60*60*1e3),(r-(a_e+(e.getTimezoneOffset()-zG.getTimezoneOffset())*6e4))/(24*60*60*1e3)}function _M(e){return e.indexOf(".")==-1?e:e.replace(/(?:\.0*|(\.\d*[1-9])0+)$/,"$1")}function l_e(e){return e.indexOf("E")==-1?e:e.replace(/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,"$1E").replace(/(E[+-])(\d)$/,"$10$2")}function c_e(e){var t=e<0?12:11,r=_M(e.toFixed(12));return r.length<=t||(r=e.toPrecision(10),r.length<=t)?r:e.toExponential(5)}function u_e(e){var t=_M(e.toFixed(11));return t.length>(e<0?12:11)||t==="0"||t==="-0"?e.toPrecision(6):t}function d_e(e){var t=Math.floor(Math.log(Math.abs(e))*Math.LOG10E),r;return t>=-4&&t<=-1?r=e.toPrecision(10+t):Math.abs(t)<=9?r=c_e(e):t===10?r=e.toFixed(10).substr(0,12):r=u_e(e),_M(l_e(r.toUpperCase()))}function QP(e,t){switch(typeof e){case"string":return e;case"boolean":return e?"TRUE":"FALSE";case"number":return(e|0)===e?e.toString(10):d_e(e);case"undefined":return"";case"object":if(e==null)return"";if(e instanceof Date)return mm(14,BG(e,t&&t.date1904),t)}throw new Error("unsupported value in General format: "+e)}function h_e(e,t){t[0]-=581;var r=e.getDay();return e<60&&(r=(r+6)%7),r}function f_e(e,t,r,s){var u="",f=0,m=0,i=r.y,S,E=0;switch(e){case 98:i=r.y+543;case 121:switch(t.length){case 1:case 2:S=i%100,E=2;break;default:S=i%1e4,E=4;break}break;case 109:switch(t.length){case 1:case 2:S=r.m,E=t.length;break;case 3:return GN[r.m-1][1];case 5:return GN[r.m-1][0];default:return GN[r.m-1][2]}break;case 100:switch(t.length){case 1:case 2:S=r.d,E=t.length;break;case 3:return o5[r.q][0];default:return o5[r.q][1]}break;case 104:switch(t.length){case 1:case 2:S=1+(r.H+11)%12,E=t.length;break;default:throw"bad hour format: "+t}break;case 72:switch(t.length){case 1:case 2:S=r.H,E=t.length;break;default:throw"bad hour format: "+t}break;case 77:switch(t.length){case 1:case 2:S=r.M,E=t.length;break;default:throw"bad minute format: "+t}break;case 115:if(t!="s"&&t!="ss"&&t!=".0"&&t!=".00"&&t!=".000")throw"bad second format: "+t;return r.u===0&&(t=="s"||t=="ss")?xd(r.S,t.length):(s>=2?m=s===3?1e3:100:m=s===1?10:1,f=Math.round(m*(r.S+r.u)),f>=60*m&&(f=0),t==="s"?f===0?"0":""+f/m:(u=xd(f,2+s),t==="ss"?u.substr(0,2):"."+u.substr(2,t.length-1)));case 90:switch(t){case"[h]":case"[hh]":S=r.D*24+r.H;break;case"[m]":case"[mm]":S=(r.D*24+r.H)*60+r.M;break;case"[s]":case"[ss]":S=((r.D*24+r.H)*60+r.M)*60+Math.round(r.S+r.u);break;default:throw"bad abstime format: "+t}E=t.length===3?1:2;break;case 101:S=i,E=1;break}var I=E>0?xd(S,E):"";return I}function Hp(e){var t=3;if(e.length<=t)return e;for(var r=e.length%t,s=e.substr(0,r);r!=e.length;r+=t)s+=(s.length>0?",":"")+e.substr(r,t);return s}var UG=/%/g;function p_e(e,t,r){var s=t.replace(UG,""),u=t.length-s.length;return cf(e,s,r*Math.pow(10,2*u))+fo("%",u)}function m_e(e,t,r){for(var s=t.length-1;t.charCodeAt(s-1)===44;)--s;return cf(e,t.substr(0,s),r/Math.pow(10,3*(t.length-s)))}function VG(e,t){var r,s=e.indexOf("E")-e.indexOf(".")-1;if(e.match(/^#+0.0E\+0$/)){if(t==0)return"0.0E+0";if(t<0)return"-"+VG(e,-t);var u=e.indexOf(".");u===-1&&(u=e.indexOf("E"));var f=Math.floor(Math.log(t)*Math.LOG10E)%u;if(f<0&&(f+=u),r=(t/Math.pow(10,f)).toPrecision(s+1+(u+f)%u),r.indexOf("e")===-1){var m=Math.floor(Math.log(t)*Math.LOG10E);for(r.indexOf(".")===-1?r=r.charAt(0)+"."+r.substr(1)+"E+"+(m-r.length+f):r+="E+"+(m-f);r.substr(0,2)==="0.";)r=r.charAt(0)+r.substr(2,u)+"."+r.substr(2+u),r=r.replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");r=r.replace(/\+-/,"-")}r=r.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(i,S,E,I){return S+E+I.substr(0,(u+f)%u)+"."+I.substr(f)+"E"})}else r=t.toExponential(s);return e.match(/E\+00$/)&&r.match(/e[+-]\d$/)&&(r=r.substr(0,r.length-1)+"0"+r.charAt(r.length-1)),e.match(/E\-/)&&r.match(/e\+/)&&(r=r.replace(/e\+/,"e")),r.replace("e","E")}var $G=/# (\?+)( ?)\/( ?)(\d+)/;function g_e(e,t,r){var s=parseInt(e[4],10),u=Math.round(t*s),f=Math.floor(u/s),m=u-f*s,i=s;return r+(f===0?"":""+f)+" "+(m===0?fo(" ",e[1].length+1+e[4].length):gM(m,e[1].length)+e[2]+"/"+e[3]+xd(i,e[4].length))}function __e(e,t,r){return r+(t===0?"":""+t)+fo(" ",e[1].length+2+e[4].length)}var qG=/^#*0*\.([0#]+)/,GG=/\).*[0#]/,WG=/\(###\) ###\\?-####/;function Xl(e){for(var t="",r,s=0;s!=e.length;++s)switch(r=e.charCodeAt(s)){case 35:break;case 63:t+=" ";break;case 48:t+="0";break;default:t+=String.fromCharCode(r)}return t}function c5(e,t){var r=Math.pow(10,t);return""+Math.round(e*r)/r}function u5(e,t){var r=e-Math.floor(e),s=Math.pow(10,t);return t<(""+Math.round(r*s)).length?0:Math.round(r*s)}function x_e(e,t){return t<(""+Math.round((e-Math.floor(e))*Math.pow(10,t))).length?1:0}function v_e(e){return e<2147483647&&e>-2147483648?""+(e>=0?e|0:e-1|0):""+Math.floor(e)}function mu(e,t,r){if(e.charCodeAt(0)===40&&!t.match(GG)){var s=t.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return r>=0?mu("n",s,r):"("+mu("n",s,-r)+")"}if(t.charCodeAt(t.length-1)===44)return m_e(e,t,r);if(t.indexOf("%")!==-1)return p_e(e,t,r);if(t.indexOf("E")!==-1)return VG(t,r);if(t.charCodeAt(0)===36)return"$"+mu(e,t.substr(t.charAt(1)==" "?2:1),r);var u,f,m,i,S=Math.abs(r),E=r<0?"-":"";if(t.match(/^00+$/))return E+vx(S,t.length);if(t.match(/^[#?]+$/))return u=vx(r,0),u==="0"&&(u=""),u.length>t.length?u:Xl(t.substr(0,t.length-u.length))+u;if(f=t.match($G))return g_e(f,S,E);if(t.match(/^#+0+$/))return E+vx(S,t.length-t.indexOf("0"));if(f=t.match(qG))return u=c5(r,f[1].length).replace(/^([^\.]+)$/,"$1."+Xl(f[1])).replace(/\.$/,"."+Xl(f[1])).replace(/\.(\d*)$/,function(H,F){return"."+F+fo("0",Xl(f[1]).length-F.length)}),t.indexOf("0.")!==-1?u:u.replace(/^0\./,".");if(t=t.replace(/^#+([0.])/,"$1"),f=t.match(/^(0*)\.(#*)$/))return E+c5(S,f[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,f[1].length?"0.":".");if(f=t.match(/^#{1,3},##0(\.?)$/))return E+Hp(vx(S,0));if(f=t.match(/^#,##0\.([#0]*0)$/))return r<0?"-"+mu(e,t,-r):Hp(""+(Math.floor(r)+x_e(r,f[1].length)))+"."+xd(u5(r,f[1].length),f[1].length);if(f=t.match(/^#,#*,#0/))return mu(e,t.replace(/^#,#*,/,""),r);if(f=t.match(/^([0#]+)(\\?-([0#]+))+$/))return u=Jx(mu(e,t.replace(/[\\-]/g,""),r)),m=0,Jx(Jx(t.replace(/\\/g,"")).replace(/[0#]/g,function(H){return m<u.length?u.charAt(m++):H==="0"?"0":""}));if(t.match(WG))return u=mu(e,"##########",r),"("+u.substr(0,3)+") "+u.substr(3,3)+"-"+u.substr(6);var I="";if(f=t.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return m=Math.min(f[4].length,7),i=gC(S,Math.pow(10,m)-1,!1),u=""+E,I=cf("n",f[1],i[1]),I.charAt(I.length-1)==" "&&(I=I.substr(0,I.length-1)+"0"),u+=I+f[2]+"/"+f[3],I=pC(i[2],m),I.length<f[4].length&&(I=Xl(f[4].substr(f[4].length-I.length))+I),u+=I,u;if(f=t.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return m=Math.min(Math.max(f[1].length,f[4].length),7),i=gC(S,Math.pow(10,m)-1,!0),E+(i[0]||(i[1]?"":"0"))+" "+(i[1]?gM(i[1],m)+f[2]+"/"+f[3]+pC(i[2],m):fo(" ",2*m+1+f[2].length+f[3].length));if(f=t.match(/^[#0?]+$/))return u=vx(r,0),t.length<=u.length?u:Xl(t.substr(0,t.length-u.length))+u;if(f=t.match(/^([#0?]+)\.([#0]+)$/)){u=""+r.toFixed(Math.min(f[2].length,10)).replace(/([^0])0+$/,"$1"),m=u.indexOf(".");var D=t.indexOf(".")-m,M=t.length-u.length-D;return Xl(t.substr(0,D)+u+t.substr(t.length-M))}if(f=t.match(/^00,000\.([#0]*0)$/))return m=u5(r,f[1].length),r<0?"-"+mu(e,t,-r):Hp(v_e(r)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(H){return"00,"+(H.length<3?xd(0,3-H.length):"")+H})+"."+xd(m,f[1].length);switch(t){case"###,##0.00":return mu(e,"#,##0.00",r);case"###,###":case"##,###":case"#,###":var R=Hp(vx(S,0));return R!=="0"?E+R:"";case"###,###.00":return mu(e,"###,##0.00",r).replace(/^0\./,".");case"#,###.00":return mu(e,"#,##0.00",r).replace(/^0\./,".")}throw new Error("unsupported format |"+t+"|")}function y_e(e,t,r){for(var s=t.length-1;t.charCodeAt(s-1)===44;)--s;return cf(e,t.substr(0,s),r/Math.pow(10,3*(t.length-s)))}function w_e(e,t,r){var s=t.replace(UG,""),u=t.length-s.length;return cf(e,s,r*Math.pow(10,2*u))+fo("%",u)}function HG(e,t){var r,s=e.indexOf("E")-e.indexOf(".")-1;if(e.match(/^#+0.0E\+0$/)){if(t==0)return"0.0E+0";if(t<0)return"-"+HG(e,-t);var u=e.indexOf(".");u===-1&&(u=e.indexOf("E"));var f=Math.floor(Math.log(t)*Math.LOG10E)%u;if(f<0&&(f+=u),r=(t/Math.pow(10,f)).toPrecision(s+1+(u+f)%u),!r.match(/[Ee]/)){var m=Math.floor(Math.log(t)*Math.LOG10E);r.indexOf(".")===-1?r=r.charAt(0)+"."+r.substr(1)+"E+"+(m-r.length+f):r+="E+"+(m-f),r=r.replace(/\+-/,"-")}r=r.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(i,S,E,I){return S+E+I.substr(0,(u+f)%u)+"."+I.substr(f)+"E"})}else r=t.toExponential(s);return e.match(/E\+00$/)&&r.match(/e[+-]\d$/)&&(r=r.substr(0,r.length-1)+"0"+r.charAt(r.length-1)),e.match(/E\-/)&&r.match(/e\+/)&&(r=r.replace(/e\+/,"e")),r.replace("e","E")}function Kd(e,t,r){if(e.charCodeAt(0)===40&&!t.match(GG)){var s=t.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return r>=0?Kd("n",s,r):"("+Kd("n",s,-r)+")"}if(t.charCodeAt(t.length-1)===44)return y_e(e,t,r);if(t.indexOf("%")!==-1)return w_e(e,t,r);if(t.indexOf("E")!==-1)return HG(t,r);if(t.charCodeAt(0)===36)return"$"+Kd(e,t.substr(t.charAt(1)==" "?2:1),r);var u,f,m,i,S=Math.abs(r),E=r<0?"-":"";if(t.match(/^00+$/))return E+xd(S,t.length);if(t.match(/^[#?]+$/))return u=""+r,r===0&&(u=""),u.length>t.length?u:Xl(t.substr(0,t.length-u.length))+u;if(f=t.match($G))return __e(f,S,E);if(t.match(/^#+0+$/))return E+xd(S,t.length-t.indexOf("0"));if(f=t.match(qG))return u=(""+r).replace(/^([^\.]+)$/,"$1."+Xl(f[1])).replace(/\.$/,"."+Xl(f[1])),u=u.replace(/\.(\d*)$/,function(H,F){return"."+F+fo("0",Xl(f[1]).length-F.length)}),t.indexOf("0.")!==-1?u:u.replace(/^0\./,".");if(t=t.replace(/^#+([0.])/,"$1"),f=t.match(/^(0*)\.(#*)$/))return E+(""+S).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,f[1].length?"0.":".");if(f=t.match(/^#{1,3},##0(\.?)$/))return E+Hp(""+S);if(f=t.match(/^#,##0\.([#0]*0)$/))return r<0?"-"+Kd(e,t,-r):Hp(""+r)+"."+fo("0",f[1].length);if(f=t.match(/^#,#*,#0/))return Kd(e,t.replace(/^#,#*,/,""),r);if(f=t.match(/^([0#]+)(\\?-([0#]+))+$/))return u=Jx(Kd(e,t.replace(/[\\-]/g,""),r)),m=0,Jx(Jx(t.replace(/\\/g,"")).replace(/[0#]/g,function(H){return m<u.length?u.charAt(m++):H==="0"?"0":""}));if(t.match(WG))return u=Kd(e,"##########",r),"("+u.substr(0,3)+") "+u.substr(3,3)+"-"+u.substr(6);var I="";if(f=t.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return m=Math.min(f[4].length,7),i=gC(S,Math.pow(10,m)-1,!1),u=""+E,I=cf("n",f[1],i[1]),I.charAt(I.length-1)==" "&&(I=I.substr(0,I.length-1)+"0"),u+=I+f[2]+"/"+f[3],I=pC(i[2],m),I.length<f[4].length&&(I=Xl(f[4].substr(f[4].length-I.length))+I),u+=I,u;if(f=t.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return m=Math.min(Math.max(f[1].length,f[4].length),7),i=gC(S,Math.pow(10,m)-1,!0),E+(i[0]||(i[1]?"":"0"))+" "+(i[1]?gM(i[1],m)+f[2]+"/"+f[3]+pC(i[2],m):fo(" ",2*m+1+f[2].length+f[3].length));if(f=t.match(/^[#0?]+$/))return u=""+r,t.length<=u.length?u:Xl(t.substr(0,t.length-u.length))+u;if(f=t.match(/^([#0]+)\.([#0]+)$/)){u=""+r.toFixed(Math.min(f[2].length,10)).replace(/([^0])0+$/,"$1"),m=u.indexOf(".");var D=t.indexOf(".")-m,M=t.length-u.length-D;return Xl(t.substr(0,D)+u+t.substr(t.length-M))}if(f=t.match(/^00,000\.([#0]*0)$/))return r<0?"-"+Kd(e,t,-r):Hp(""+r).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(H){return"00,"+(H.length<3?xd(0,3-H.length):"")+H})+"."+xd(0,f[1].length);switch(t){case"###,###":case"##,###":case"#,###":var R=Hp(""+S);return R!=="0"?E+R:"";default:if(t.match(/\.[0#?]*$/))return Kd(e,t.slice(0,t.lastIndexOf(".")),r)+Xl(t.slice(t.lastIndexOf(".")))}throw new Error("unsupported format |"+t+"|")}function cf(e,t,r){return(r|0)===r?Kd(e,t,r):mu(e,t,r)}function b_e(e){for(var t=[],r=!1,s=0,u=0;s<e.length;++s)switch(e.charCodeAt(s)){case 34:r=!r;break;case 95:case 42:case 92:++s;break;case 59:t[t.length]=e.substr(u,s-u),u=s+1}if(t[t.length]=e.substr(u),r===!0)throw new Error("Format |"+e+"| unterminated string ");return t}var ZG=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function XG(e){for(var t=0,r="",s="";t<e.length;)switch(r=e.charAt(t)){case"G":mC(e,t)&&(t+=6),t++;break;case'"':for(;e.charCodeAt(++t)!==34&&t<e.length;);++t;break;case"\\":t+=2;break;case"_":t+=2;break;case"@":++t;break;case"B":case"b":if(e.charAt(t+1)==="1"||e.charAt(t+1)==="2")return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"":if(e.substr(t,3).toUpperCase()==="A/P"||e.substr(t,5).toUpperCase()==="AM/PM"||e.substr(t,5).toUpperCase()==="/")return!0;++t;break;case"[":for(s=r;e.charAt(t++)!=="]"&&t<e.length;)s+=e.charAt(t);if(s.match(ZG))return!0;break;case".":case"0":case"#":for(;t<e.length&&("0#?.,E+-%".indexOf(r=e.charAt(++t))>-1||r=="\\"&&e.charAt(t+1)=="-"&&"0#".indexOf(e.charAt(t+2))>-1););break;case"?":for(;e.charAt(++t)===r;);break;case"*":++t,(e.charAt(t)==" "||e.charAt(t)=="*")&&++t;break;case"(":case")":++t;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;t<e.length&&"0123456789".indexOf(e.charAt(++t))>-1;);break;case" ":++t;break;default:++t;break}return!1}function S_e(e,t,r,s){for(var u=[],f="",m=0,i="",S="t",E,I,D,M="H";m<e.length;)switch(i=e.charAt(m)){case"G":if(!mC(e,m))throw new Error("unrecognized character "+i+" in "+e);u[u.length]={t:"G",v:"General"},m+=7;break;case'"':for(f="";(D=e.charCodeAt(++m))!==34&&m<e.length;)f+=String.fromCharCode(D);u[u.length]={t:"t",v:f},++m;break;case"\\":var R=e.charAt(++m),H=R==="("||R===")"?R:"t";u[u.length]={t:H,v:R},++m;break;case"_":u[u.length]={t:"t",v:" "},m+=2;break;case"@":u[u.length]={t:"T",v:t},++m;break;case"B":case"b":if(e.charAt(m+1)==="1"||e.charAt(m+1)==="2"){if(E==null&&(E=FT(t,r,e.charAt(m+1)==="2"),E==null))return"";u[u.length]={t:"X",v:e.substr(m,2)},S=i,m+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":i=i.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(t<0||E==null&&(E=FT(t,r),E==null))return"";for(f=i;++m<e.length&&e.charAt(m).toLowerCase()===i;)f+=i;i==="m"&&S.toLowerCase()==="h"&&(i="M"),i==="h"&&(i=M),u[u.length]={t:i,v:f},S=i;break;case"A":case"a":case"":var F={t:i,v:i};if(E==null&&(E=FT(t,r)),e.substr(m,3).toUpperCase()==="A/P"?(E!=null&&(F.v=E.H>=12?"P":"A"),F.t="T",M="h",m+=3):e.substr(m,5).toUpperCase()==="AM/PM"?(E!=null&&(F.v=E.H>=12?"PM":"AM"),F.t="T",m+=5,M="h"):e.substr(m,5).toUpperCase()==="/"?(E!=null&&(F.v=E.H>=12?"":""),F.t="T",m+=5,M="h"):(F.t="t",++m),E==null&&F.t==="T")return"";u[u.length]=F,S=i;break;case"[":for(f=i;e.charAt(m++)!=="]"&&m<e.length;)f+=e.charAt(m);if(f.slice(-1)!=="]")throw'unterminated "[" block: |'+f+"|";if(f.match(ZG)){if(E==null&&(E=FT(t,r),E==null))return"";u[u.length]={t:"Z",v:f.toLowerCase()},S=f.charAt(1)}else f.indexOf("$")>-1&&(f=(f.match(/\$([^-\[\]]*)/)||[])[1]||"$",XG(e)||(u[u.length]={t:"t",v:f}));break;case".":if(E!=null){for(f=i;++m<e.length&&(i=e.charAt(m))==="0";)f+=i;u[u.length]={t:"s",v:f};break}case"0":case"#":for(f=i;++m<e.length&&"0#?.,E+-%".indexOf(i=e.charAt(m))>-1;)f+=i;u[u.length]={t:"n",v:f};break;case"?":for(f=i;e.charAt(++m)===i;)f+=i;u[u.length]={t:i,v:f},S=i;break;case"*":++m,(e.charAt(m)==" "||e.charAt(m)=="*")&&++m;break;case"(":case")":u[u.length]={t:s===1?"t":i,v:i},++m;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(f=i;m<e.length&&"0123456789".indexOf(e.charAt(++m))>-1;)f+=e.charAt(m);u[u.length]={t:"D",v:f};break;case" ":u[u.length]={t:i,v:i},++m;break;case"$":u[u.length]={t:"t",v:"$"},++m;break;default:if(",$-+/():!^&'~{}<>=acfijklopqrtuvwxzP".indexOf(i)===-1)throw new Error("unrecognized character "+i+" in "+e);u[u.length]={t:"t",v:i},++m;break}var U=0,Y=0,z;for(m=u.length-1,S="t";m>=0;--m)switch(u[m].t){case"h":case"H":u[m].t=M,S="h",U<1&&(U=1);break;case"s":(z=u[m].v.match(/\.0+$/))&&(Y=Math.max(Y,z[0].length-1)),U<3&&(U=3);case"d":case"y":case"M":case"e":S=u[m].t;break;case"m":S==="s"&&(u[m].t="M",U<2&&(U=2));break;case"X":break;case"Z":U<1&&u[m].v.match(/[Hh]/)&&(U=1),U<2&&u[m].v.match(/[Mm]/)&&(U=2),U<3&&u[m].v.match(/[Ss]/)&&(U=3)}switch(U){case 0:break;case 1:E.u>=.5&&(E.u=0,++E.S),E.S>=60&&(E.S=0,++E.M),E.M>=60&&(E.M=0,++E.H);break;case 2:E.u>=.5&&(E.u=0,++E.S),E.S>=60&&(E.S=0,++E.M);break}var J="",ne;for(m=0;m<u.length;++m)switch(u[m].t){case"t":case"T":case" ":case"D":break;case"X":u[m].v="",u[m].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":u[m].v=f_e(u[m].t.charCodeAt(0),u[m].v,E,Y),u[m].t="t";break;case"n":case"?":for(ne=m+1;u[ne]!=null&&((i=u[ne].t)==="?"||i==="D"||(i===" "||i==="t")&&u[ne+1]!=null&&(u[ne+1].t==="?"||u[ne+1].t==="t"&&u[ne+1].v==="/")||u[m].t==="("&&(i===" "||i==="n"||i===")")||i==="t"&&(u[ne].v==="/"||u[ne].v===" "&&u[ne+1]!=null&&u[ne+1].t=="?"));)u[m].v+=u[ne].v,u[ne]={v:"",t:";"},++ne;J+=u[m].v,m=ne-1;break;case"G":u[m].t="t",u[m].v=QP(t,r);break}var me="",le,ye;if(J.length>0){J.charCodeAt(0)==40?(le=t<0&&J.charCodeAt(0)===45?-t:t,ye=cf("n",J,le)):(le=t<0&&s>1?-t:t,ye=cf("n",J,le),le<0&&u[0]&&u[0].t=="t"&&(ye=ye.substr(1),u[0].v="-"+u[0].v)),ne=ye.length-1;var pe=u.length;for(m=0;m<u.length;++m)if(u[m]!=null&&u[m].t!="t"&&u[m].v.indexOf(".")>-1){pe=m;break}var be=u.length;if(pe===u.length&&ye.indexOf("E")===-1){for(m=u.length-1;m>=0;--m)u[m]==null||"n?".indexOf(u[m].t)===-1||(ne>=u[m].v.length-1?(ne-=u[m].v.length,u[m].v=ye.substr(ne+1,u[m].v.length)):ne<0?u[m].v="":(u[m].v=ye.substr(0,ne+1),ne=-1),u[m].t="t",be=m);ne>=0&&be<u.length&&(u[be].v=ye.substr(0,ne+1)+u[be].v)}else if(pe!==u.length&&ye.indexOf("E")===-1){for(ne=ye.indexOf(".")-1,m=pe;m>=0;--m)if(!(u[m]==null||"n?".indexOf(u[m].t)===-1)){for(I=u[m].v.indexOf(".")>-1&&m===pe?u[m].v.indexOf(".")-1:u[m].v.length-1,me=u[m].v.substr(I+1);I>=0;--I)ne>=0&&(u[m].v.charAt(I)==="0"||u[m].v.charAt(I)==="#")&&(me=ye.charAt(ne--)+me);u[m].v=me,u[m].t="t",be=m}for(ne>=0&&be<u.length&&(u[be].v=ye.substr(0,ne+1)+u[be].v),ne=ye.indexOf(".")+1,m=pe;m<u.length;++m)if(!(u[m]==null||"n?(".indexOf(u[m].t)===-1&&m!==pe)){for(I=u[m].v.indexOf(".")>-1&&m===pe?u[m].v.indexOf(".")+1:0,me=u[m].v.substr(0,I);I<u[m].v.length;++I)ne<ye.length&&(me+=ye.charAt(ne++));u[m].v=me,u[m].t="t",be=m}}}for(m=0;m<u.length;++m)u[m]!=null&&"n?".indexOf(u[m].t)>-1&&(le=s>1&&t<0&&m>0&&u[m-1].v==="-"?-t:t,u[m].v=cf(u[m].t,u[m].v,le),u[m].t="t");var ke="";for(m=0;m!==u.length;++m)u[m]!=null&&(ke+=u[m].v);return ke}var d5=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function h5(e,t){if(t==null)return!1;var r=parseFloat(t[2]);switch(t[1]){case"=":if(e==r)return!0;break;case">":if(e>r)return!0;break;case"<":if(e<r)return!0;break;case"<>":if(e!=r)return!0;break;case">=":if(e>=r)return!0;break;case"<=":if(e<=r)return!0;break}return!1}function T_e(e,t){var r=b_e(e),s=r.length,u=r[s-1].indexOf("@");if(s<4&&u>-1&&--s,r.length>4)throw new Error("cannot find right format for |"+r.join("|")+"|");if(typeof t!="number")return[4,r.length===4||u>-1?r[r.length-1]:"@"];switch(r.length){case 1:r=u>-1?["General","General","General",r[0]]:[r[0],r[0],r[0],"@"];break;case 2:r=u>-1?[r[0],r[0],r[0],r[1]]:[r[0],r[1],r[0],"@"];break;case 3:r=u>-1?[r[0],r[1],r[0],r[2]]:[r[0],r[1],r[2],"@"];break}var f=t>0?r[0]:t<0?r[1]:r[2];if(r[0].indexOf("[")===-1&&r[1].indexOf("[")===-1)return[s,f];if(r[0].match(/\[[=<>]/)!=null||r[1].match(/\[[=<>]/)!=null){var m=r[0].match(d5),i=r[1].match(d5);return h5(t,m)?[s,r[0]]:h5(t,i)?[s,r[1]]:[s,r[m!=null&&i!=null?2:1]]}return[s,f]}function mm(e,t,r){r==null&&(r={});var s="";switch(typeof e){case"string":e=="m/d/yy"&&r.dateNF?s=r.dateNF:s=e;break;case"number":e==14&&r.dateNF?s=r.dateNF:s=(r.table!=null?r.table:po)[e],s==null&&(s=r.table&&r.table[l5[e]]||po[l5[e]]),s==null&&(s=s_e[e]||"General");break}if(mC(s,0))return QP(t,r);t instanceof Date&&(t=BG(t,r.date1904));var u=T_e(s,t);if(mC(u[1]))return QP(t,r);if(t===!0)t="TRUE";else if(t===!1)t="FALSE";else if(t===""||t==null)return"";return S_e(u[1],t,r,u[0])}function YG(e,t){if(typeof t!="number"){t=+t||-1;for(var r=0;r<392;++r){if(po[r]==null){t<0&&(t=r);continue}if(po[r]==e){t=r;break}}t<0&&(t=391)}return po[t]=e,t}function SA(e){for(var t=0;t!=392;++t)e[t]!==void 0&&YG(e[t],t)}function TA(){po=i_e()}var KG=/[dD]+|[mM]+|[yYeE]+|[Hh]+|[Ss]+/g;function E_e(e){var t=typeof e=="number"?po[e]:e;return t=t.replace(KG,"(\\d+)"),new RegExp("^"+t+"$")}function C_e(e,t,r){var s=-1,u=-1,f=-1,m=-1,i=-1,S=-1;(t.match(KG)||[]).forEach(function(D,M){var R=parseInt(r[M+1],10);switch(D.toLowerCase().charAt(0)){case"y":s=R;break;case"d":f=R;break;case"h":m=R;break;case"s":S=R;break;case"m":m>=0?i=R:u=R;break}}),S>=0&&i==-1&&u>=0&&(i=u,u=-1);var E=(""+(s>=0?s:new Date().getFullYear())).slice(-4)+"-"+("00"+(u>=1?u:1)).slice(-2)+"-"+("00"+(f>=1?f:1)).slice(-2);E.length==7&&(E="0"+E),E.length==8&&(E="20"+E);var I=("00"+(m>=0?m:0)).slice(-2)+":"+("00"+(i>=0?i:0)).slice(-2)+":"+("00"+(S>=0?S:0)).slice(-2);return m==-1&&i==-1&&S==-1?E:s==-1&&u==-1&&f==-1?I:E+"T"+I}var A_e=function(){var e={};e.version="1.2.0";function t(){for(var ye=0,pe=new Array(256),be=0;be!=256;++be)ye=be,ye=ye&1?-306674912^ye>>>1:ye>>>1,ye=ye&1?-306674912^ye>>>1:ye>>>1,ye=ye&1?-306674912^ye>>>1:ye>>>1,ye=ye&1?-306674912^ye>>>1:ye>>>1,ye=ye&1?-306674912^ye>>>1:ye>>>1,ye=ye&1?-306674912^ye>>>1:ye>>>1,ye=ye&1?-306674912^ye>>>1:ye>>>1,ye=ye&1?-306674912^ye>>>1:ye>>>1,pe[be]=ye;return typeof Int32Array<"u"?new Int32Array(pe):pe}var r=t();function s(ye){var pe=0,be=0,ke=0,Oe=typeof Int32Array<"u"?new Int32Array(4096):new Array(4096);for(ke=0;ke!=256;++ke)Oe[ke]=ye[ke];for(ke=0;ke!=256;++ke)for(be=ye[ke],pe=256+ke;pe<4096;pe+=256)be=Oe[pe]=be>>>8^ye[be&255];var Ee=[];for(ke=1;ke!=16;++ke)Ee[ke-1]=typeof Int32Array<"u"?Oe.subarray(ke*256,ke*256+256):Oe.slice(ke*256,ke*256+256);return Ee}var u=s(r),f=u[0],m=u[1],i=u[2],S=u[3],E=u[4],I=u[5],D=u[6],M=u[7],R=u[8],H=u[9],F=u[10],U=u[11],Y=u[12],z=u[13],J=u[14];function ne(ye,pe){for(var be=pe^-1,ke=0,Oe=ye.length;ke<Oe;)be=be>>>8^r[(be^ye.charCodeAt(ke++))&255];return~be}function me(ye,pe){for(var be=pe^-1,ke=ye.length-15,Oe=0;Oe<ke;)be=J[ye[Oe++]^be&255]^z[ye[Oe++]^be>>8&255]^Y[ye[Oe++]^be>>16&255]^U[ye[Oe++]^be>>>24]^F[ye[Oe++]]^H[ye[Oe++]]^R[ye[Oe++]]^M[ye[Oe++]]^D[ye[Oe++]]^I[ye[Oe++]]^E[ye[Oe++]]^S[ye[Oe++]]^i[ye[Oe++]]^m[ye[Oe++]]^f[ye[Oe++]]^r[ye[Oe++]];for(ke+=15;Oe<ke;)be=be>>>8^r[(be^ye[Oe++])&255];return~be}function le(ye,pe){for(var be=pe^-1,ke=0,Oe=ye.length,Ee=0,qe=0;ke<Oe;)Ee=ye.charCodeAt(ke++),Ee<128?be=be>>>8^r[(be^Ee)&255]:Ee<2048?(be=be>>>8^r[(be^(192|Ee>>6&31))&255],be=be>>>8^r[(be^(128|Ee&63))&255]):Ee>=55296&&Ee<57344?(Ee=(Ee&1023)+64,qe=ye.charCodeAt(ke++)&1023,be=be>>>8^r[(be^(240|Ee>>8&7))&255],be=be>>>8^r[(be^(128|Ee>>2&63))&255],be=be>>>8^r[(be^(128|qe>>6&15|(Ee&3)<<4))&255],be=be>>>8^r[(be^(128|qe&63))&255]):(be=be>>>8^r[(be^(224|Ee>>12&15))&255],be=be>>>8^r[(be^(128|Ee>>6&63))&255],be=be>>>8^r[(be^(128|Ee&63))&255]);return~be}return e.table=r,e.bstr=ne,e.buf=me,e.str=le,e}(),Ta=function(){var t={};t.version="1.2.1";function r(Ae,ue){for(var Z=Ae.split("/"),K=ue.split("/"),ie=0,ce=0,_e=Math.min(Z.length,K.length);ie<_e;++ie){if(ce=Z[ie].length-K[ie].length)return ce;if(Z[ie]!=K[ie])return Z[ie]<K[ie]?-1:1}return Z.length-K.length}function s(Ae){if(Ae.charAt(Ae.length-1)=="/")return Ae.slice(0,-1).indexOf("/")===-1?Ae:s(Ae.slice(0,-1));var ue=Ae.lastIndexOf("/");return ue===-1?Ae:Ae.slice(0,ue+1)}function u(Ae){if(Ae.charAt(Ae.length-1)=="/")return u(Ae.slice(0,-1));var ue=Ae.lastIndexOf("/");return ue===-1?Ae:Ae.slice(ue+1)}function f(Ae,ue){typeof ue=="string"&&(ue=new Date(ue));var Z=ue.getHours();Z=Z<<6|ue.getMinutes(),Z=Z<<5|ue.getSeconds()>>>1,Ae.write_shift(2,Z);var K=ue.getFullYear()-1980;K=K<<4|ue.getMonth()+1,K=K<<5|ue.getDate(),Ae.write_shift(2,K)}function m(Ae){var ue=Ae.read_shift(2)&65535,Z=Ae.read_shift(2)&65535,K=new Date,ie=Z&31;Z>>>=5;var ce=Z&15;Z>>>=4,K.setMilliseconds(0),K.setFullYear(Z+1980),K.setMonth(ce-1),K.setDate(ie);var _e=ue&31;ue>>>=5;var Ie=ue&63;return ue>>>=6,K.setHours(ue),K.setMinutes(Ie),K.setSeconds(_e<<1),K}function i(Ae){Vc(Ae,0);for(var ue={},Z=0;Ae.l<=Ae.length-4;){var K=Ae.read_shift(2),ie=Ae.read_shift(2),ce=Ae.l+ie,_e={};switch(K){case 21589:Z=Ae.read_shift(1),Z&1&&(_e.mtime=Ae.read_shift(4)),ie>5&&(Z&2&&(_e.atime=Ae.read_shift(4)),Z&4&&(_e.ctime=Ae.read_shift(4))),_e.mtime&&(_e.mt=new Date(_e.mtime*1e3));break}Ae.l=ce,ue[K]=_e}return ue}var S;function E(){return S||(S={})}function I(Ae,ue){if(Ae[0]==80&&Ae[1]==75)return ii(Ae,ue);if((Ae[0]|32)==109&&(Ae[1]|32)==105)return At(Ae,ue);if(Ae.length<512)throw new Error("CFB file size "+Ae.length+" < 512");var Z=3,K=512,ie=0,ce=0,_e=0,Ie=0,Re=0,Ce=[],ze=Ae.slice(0,512);Vc(ze,0);var et=D(ze);switch(Z=et[0],Z){case 3:K=512;break;case 4:K=4096;break;case 0:if(et[1]==0)return ii(Ae,ue);default:throw new Error("Major Version: Expected 3 or 4 saw "+Z)}K!==512&&(ze=Ae.slice(0,K),Vc(ze,28));var ut=Ae.slice(0,K);M(ze,Z);var Ut=ze.read_shift(4,"i");if(Z===3&&Ut!==0)throw new Error("# Directory Sectors: Expected 0 saw "+Ut);ze.l+=4,_e=ze.read_shift(4,"i"),ze.l+=4,ze.chk("00100000","Mini Stream Cutoff Size: "),Ie=ze.read_shift(4,"i"),ie=ze.read_shift(4,"i"),Re=ze.read_shift(4,"i"),ce=ze.read_shift(4,"i");for(var Xt=-1,Qt=0;Qt<109&&(Xt=ze.read_shift(4,"i"),!(Xt<0));++Qt)Ce[Qt]=Xt;var ur=R(Ae,K);U(Re,ce,ur,K,Ce);var Yr=z(ur,_e,Ce,K);Yr[_e].name="!Directory",ie>0&&Ie!==qe&&(Yr[Ie].name="!MiniFAT"),Yr[Ce[0]].name="!FAT",Yr.fat_addrs=Ce,Yr.ssz=K;var Xr={},Rn=[],Zi=[],Rs=[];J(_e,Yr,ur,Rn,ie,Xr,Zi,Ie),H(Zi,Rs,Rn),Rn.shift();var gs={FileIndex:Zi,FullPaths:Rs};return ue&&ue.raw&&(gs.raw={header:ut,sectors:ur}),gs}function D(Ae){if(Ae[Ae.l]==80&&Ae[Ae.l+1]==75)return[0,0];Ae.chk(Qe,"Header Signature: "),Ae.l+=16;var ue=Ae.read_shift(2,"u");return[Ae.read_shift(2,"u"),ue]}function M(Ae,ue){var Z=9;switch(Ae.l+=2,Z=Ae.read_shift(2)){case 9:if(ue!=3)throw new Error("Sector Shift: Expected 9 saw "+Z);break;case 12:if(ue!=4)throw new Error("Sector Shift: Expected 12 saw "+Z);break;default:throw new Error("Sector Shift: Expected 9 or 12 saw "+Z)}Ae.chk("0600","Mini Sector Shift: "),Ae.chk("000000000000","Reserved: ")}function R(Ae,ue){for(var Z=Math.ceil(Ae.length/ue)-1,K=[],ie=1;ie<Z;++ie)K[ie-1]=Ae.slice(ie*ue,(ie+1)*ue);return K[Z-1]=Ae.slice(Z*ue),K}function H(Ae,ue,Z){for(var K=0,ie=0,ce=0,_e=0,Ie=0,Re=Z.length,Ce=[],ze=[];K<Re;++K)Ce[K]=ze[K]=K,ue[K]=Z[K];for(;Ie<ze.length;++Ie)K=ze[Ie],ie=Ae[K].L,ce=Ae[K].R,_e=Ae[K].C,Ce[K]===K&&(ie!==-1&&Ce[ie]!==ie&&(Ce[K]=Ce[ie]),ce!==-1&&Ce[ce]!==ce&&(Ce[K]=Ce[ce])),_e!==-1&&(Ce[_e]=K),ie!==-1&&K!=Ce[K]&&(Ce[ie]=Ce[K],ze.lastIndexOf(ie)<Ie&&ze.push(ie)),ce!==-1&&K!=Ce[K]&&(Ce[ce]=Ce[K],ze.lastIndexOf(ce)<Ie&&ze.push(ce));for(K=1;K<Re;++K)Ce[K]===K&&(ce!==-1&&Ce[ce]!==ce?Ce[K]=Ce[ce]:ie!==-1&&Ce[ie]!==ie&&(Ce[K]=Ce[ie]));for(K=1;K<Re;++K)if(Ae[K].type!==0){if(Ie=K,Ie!=Ce[Ie])do Ie=Ce[Ie],ue[K]=ue[Ie]+"/"+ue[K];while(Ie!==0&&Ce[Ie]!==-1&&Ie!=Ce[Ie]);Ce[K]=-1}for(ue[0]+="/",K=1;K<Re;++K)Ae[K].type!==2&&(ue[K]+="/")}function F(Ae,ue,Z){for(var K=Ae.start,ie=Ae.size,ce=[],_e=K;Z&&ie>0&&_e>=0;)ce.push(ue.slice(_e*Ee,_e*Ee+Ee)),ie-=Ee,_e=Ug(Z,_e*4);return ce.length===0?vr(0):ll(ce).slice(0,Ae.size)}function U(Ae,ue,Z,K,ie){var ce=qe;if(Ae===qe){if(ue!==0)throw new Error("DIFAT chain shorter than expected")}else if(Ae!==-1){var _e=Z[Ae],Ie=(K>>>2)-1;if(!_e)return;for(var Re=0;Re<Ie&&(ce=Ug(_e,Re*4))!==qe;++Re)ie.push(ce);U(Ug(_e,K-4),ue-1,Z,K,ie)}}function Y(Ae,ue,Z,K,ie){var ce=[],_e=[];ie||(ie=[]);var Ie=K-1,Re=0,Ce=0;for(Re=ue;Re>=0;){ie[Re]=!0,ce[ce.length]=Re,_e.push(Ae[Re]);var ze=Z[Math.floor(Re*4/K)];if(Ce=Re*4&Ie,K<4+Ce)throw new Error("FAT boundary crossed: "+Re+" 4 "+K);if(!Ae[ze])break;Re=Ug(Ae[ze],Ce)}return{nodes:ce,data:y5([_e])}}function z(Ae,ue,Z,K){var ie=Ae.length,ce=[],_e=[],Ie=[],Re=[],Ce=K-1,ze=0,et=0,ut=0,Ut=0;for(ze=0;ze<ie;++ze)if(Ie=[],ut=ze+ue,ut>=ie&&(ut-=ie),!_e[ut]){Re=[];var Xt=[];for(et=ut;et>=0;){Xt[et]=!0,_e[et]=!0,Ie[Ie.length]=et,Re.push(Ae[et]);var Qt=Z[Math.floor(et*4/K)];if(Ut=et*4&Ce,K<4+Ut)throw new Error("FAT boundary crossed: "+et+" 4 "+K);if(!Ae[Qt]||(et=Ug(Ae[Qt],Ut),Xt[et]))break}ce[ut]={nodes:Ie,data:y5([Re])}}return ce}function J(Ae,ue,Z,K,ie,ce,_e,Ie){for(var Re=0,Ce=K.length?2:0,ze=ue[Ae].data,et=0,ut=0,Ut;et<ze.length;et+=128){var Xt=ze.slice(et,et+128);Vc(Xt,64),ut=Xt.read_shift(2),Ut=bM(Xt,0,ut-Ce),K.push(Ut);var Qt={name:Ut,type:Xt.read_shift(1),color:Xt.read_shift(1),L:Xt.read_shift(4,"i"),R:Xt.read_shift(4,"i"),C:Xt.read_shift(4,"i"),clsid:Xt.read_shift(16),state:Xt.read_shift(4,"i"),start:0,size:0},ur=Xt.read_shift(2)+Xt.read_shift(2)+Xt.read_shift(2)+Xt.read_shift(2);ur!==0&&(Qt.ct=ne(Xt,Xt.l-8));var Yr=Xt.read_shift(2)+Xt.read_shift(2)+Xt.read_shift(2)+Xt.read_shift(2);Yr!==0&&(Qt.mt=ne(Xt,Xt.l-8)),Qt.start=Xt.read_shift(4,"i"),Qt.size=Xt.read_shift(4,"i"),Qt.size<0&&Qt.start<0&&(Qt.size=Qt.type=0,Qt.start=qe,Qt.name=""),Qt.type===5?(Re=Qt.start,ie>0&&Re!==qe&&(ue[Re].name="!StreamData")):Qt.size>=4096?(Qt.storage="fat",ue[Qt.start]===void 0&&(ue[Qt.start]=Y(Z,Qt.start,ue.fat_addrs,ue.ssz)),ue[Qt.start].name=Qt.name,Qt.content=ue[Qt.start].data.slice(0,Qt.size)):(Qt.storage="minifat",Qt.size<0?Qt.size=0:Re!==qe&&Qt.start!==qe&&ue[Re]&&(Qt.content=F(Qt,ue[Re].data,(ue[Ie]||{}).data))),Qt.content&&Vc(Qt.content,0),ce[Ut]=Qt,_e.push(Qt)}}function ne(Ae,ue){return new Date((Gc(Ae,ue+4)/1e7*Math.pow(2,32)+Gc(Ae,ue)/1e7-11644473600)*1e3)}function me(Ae,ue){return E(),I(S.readFileSync(Ae),ue)}function le(Ae,ue){var Z=ue&&ue.type;switch(Z||sa&&Buffer.isBuffer(Ae)&&(Z="buffer"),Z||"base64"){case"file":return me(Ae,ue);case"base64":return I(md(vf(Ae)),ue);case"binary":return I(md(Ae),ue)}return I(Ae,ue)}function ye(Ae,ue){var Z=ue||{},K=Z.root||"Root Entry";if(Ae.FullPaths||(Ae.FullPaths=[]),Ae.FileIndex||(Ae.FileIndex=[]),Ae.FullPaths.length!==Ae.FileIndex.length)throw new Error("inconsistent CFB structure");Ae.FullPaths.length===0&&(Ae.FullPaths[0]=K+"/",Ae.FileIndex[0]={name:K,type:5}),Z.CLSID&&(Ae.FileIndex[0].clsid=Z.CLSID),pe(Ae)}function pe(Ae){var ue="Sh33tJ5";if(!Ta.find(Ae,"/"+ue)){var Z=vr(4);Z[0]=55,Z[1]=Z[3]=50,Z[2]=54,Ae.FileIndex.push({name:ue,type:2,content:Z,size:4,L:69,R:69,C:69}),Ae.FullPaths.push(Ae.FullPaths[0]+ue),be(Ae)}}function be(Ae,ue){ye(Ae);for(var Z=!1,K=!1,ie=Ae.FullPaths.length-1;ie>=0;--ie){var ce=Ae.FileIndex[ie];switch(ce.type){case 0:K?Z=!0:(Ae.FileIndex.pop(),Ae.FullPaths.pop());break;case 1:case 2:case 5:K=!0,isNaN(ce.R*ce.L*ce.C)&&(Z=!0),ce.R>-1&&ce.L>-1&&ce.R==ce.L&&(Z=!0);break;default:Z=!0;break}}if(!(!Z&&!ue)){var _e=new Date(1987,1,19),Ie=0,Re=Object.create?Object.create(null):{},Ce=[];for(ie=0;ie<Ae.FullPaths.length;++ie)Re[Ae.FullPaths[ie]]=!0,Ae.FileIndex[ie].type!==0&&Ce.push([Ae.FullPaths[ie],Ae.FileIndex[ie]]);for(ie=0;ie<Ce.length;++ie){var ze=s(Ce[ie][0]);K=Re[ze],K||(Ce.push([ze,{name:u(ze).replace("/",""),type:1,clsid:Xe,ct:_e,mt:_e,content:null}]),Re[ze]=!0)}for(Ce.sort(function(Ut,Xt){return r(Ut[0],Xt[0])}),Ae.FullPaths=[],Ae.FileIndex=[],ie=0;ie<Ce.length;++ie)Ae.FullPaths[ie]=Ce[ie][0],Ae.FileIndex[ie]=Ce[ie][1];for(ie=0;ie<Ce.length;++ie){var et=Ae.FileIndex[ie],ut=Ae.FullPaths[ie];if(et.name=u(ut).replace("/",""),et.L=et.R=et.C=-(et.color=1),et.size=et.content?et.content.length:0,et.start=0,et.clsid=et.clsid||Xe,ie===0)et.C=Ce.length>1?1:-1,et.size=0,et.type=5;else if(ut.slice(-1)=="/"){for(Ie=ie+1;Ie<Ce.length&&s(Ae.FullPaths[Ie])!=ut;++Ie);for(et.C=Ie>=Ce.length?-1:Ie,Ie=ie+1;Ie<Ce.length&&s(Ae.FullPaths[Ie])!=s(ut);++Ie);et.R=Ie>=Ce.length?-1:Ie,et.type=1}else s(Ae.FullPaths[ie+1]||"")==s(ut)&&(et.R=ie+1),et.type=2}}}function ke(Ae,ue){var Z=ue||{};if(Z.fileType=="mad")return $i(Ae,Z);switch(be(Ae),Z.fileType){case"zip":return Ua(Ae,Z)}var K=function(Ut){for(var Xt=0,Qt=0,ur=0;ur<Ut.FileIndex.length;++ur){var Yr=Ut.FileIndex[ur];if(Yr.content){var Xr=Yr.content.length;Xr>0&&(Xr<4096?Xt+=Xr+63>>6:Qt+=Xr+511>>9)}}for(var Rn=Ut.FullPaths.length+3>>2,Zi=Xt+7>>3,Rs=Xt+127>>7,gs=Zi+Qt+Rn+Rs,is=gs+127>>7,yi=is<=109?0:Math.ceil((is-109)/127);gs+is+yi+127>>7>is;)yi=++is<=109?0:Math.ceil((is-109)/127);var Un=[1,yi,is,Rs,Rn,Qt,Xt,0];return Ut.FileIndex[0].size=Xt<<6,Un[7]=(Ut.FileIndex[0].start=Un[0]+Un[1]+Un[2]+Un[3]+Un[4]+Un[5])+(Un[6]+7>>3),Un}(Ae),ie=vr(K[7]<<9),ce=0,_e=0;{for(ce=0;ce<8;++ce)ie.write_shift(1,gt[ce]);for(ce=0;ce<8;++ce)ie.write_shift(2,0);for(ie.write_shift(2,62),ie.write_shift(2,3),ie.write_shift(2,65534),ie.write_shift(2,9),ie.write_shift(2,6),ce=0;ce<3;++ce)ie.write_shift(2,0);for(ie.write_shift(4,0),ie.write_shift(4,K[2]),ie.write_shift(4,K[0]+K[1]+K[2]+K[3]-1),ie.write_shift(4,0),ie.write_shift(4,4096),ie.write_shift(4,K[3]?K[0]+K[1]+K[2]-1:qe),ie.write_shift(4,K[3]),ie.write_shift(-4,K[1]?K[0]-1:qe),ie.write_shift(4,K[1]),ce=0;ce<109;++ce)ie.write_shift(-4,ce<K[2]?K[1]+ce:-1)}if(K[1])for(_e=0;_e<K[1];++_e){for(;ce<236+_e*127;++ce)ie.write_shift(-4,ce<K[2]?K[1]+ce:-1);ie.write_shift(-4,_e===K[1]-1?qe:_e+1)}var Ie=function(Ut){for(_e+=Ut;ce<_e-1;++ce)ie.write_shift(-4,ce+1);Ut&&(++ce,ie.write_shift(-4,qe))};for(_e=ce=0,_e+=K[1];ce<_e;++ce)ie.write_shift(-4,ct.DIFSECT);for(_e+=K[2];ce<_e;++ce)ie.write_shift(-4,ct.FATSECT);Ie(K[3]),Ie(K[4]);for(var Re=0,Ce=0,ze=Ae.FileIndex[0];Re<Ae.FileIndex.length;++Re)ze=Ae.FileIndex[Re],ze.content&&(Ce=ze.content.length,!(Ce<4096)&&(ze.start=_e,Ie(Ce+511>>9)));for(Ie(K[6]+7>>3);ie.l&511;)ie.write_shift(-4,ct.ENDOFCHAIN);for(_e=ce=0,Re=0;Re<Ae.FileIndex.length;++Re)ze=Ae.FileIndex[Re],ze.content&&(Ce=ze.content.length,!(!Ce||Ce>=4096)&&(ze.start=_e,Ie(Ce+63>>6)));for(;ie.l&511;)ie.write_shift(-4,ct.ENDOFCHAIN);for(ce=0;ce<K[4]<<2;++ce){var et=Ae.FullPaths[ce];if(!et||et.length===0){for(Re=0;Re<17;++Re)ie.write_shift(4,0);for(Re=0;Re<3;++Re)ie.write_shift(4,-1);for(Re=0;Re<12;++Re)ie.write_shift(4,0);continue}ze=Ae.FileIndex[ce],ce===0&&(ze.start=ze.size?ze.start-1:qe);var ut=ce===0&&Z.root||ze.name;if(Ce=2*(ut.length+1),ie.write_shift(64,ut,"utf16le"),ie.write_shift(2,Ce),ie.write_shift(1,ze.type),ie.write_shift(1,ze.color),ie.write_shift(-4,ze.L),ie.write_shift(-4,ze.R),ie.write_shift(-4,ze.C),ze.clsid)ie.write_shift(16,ze.clsid,"hex");else for(Re=0;Re<4;++Re)ie.write_shift(4,0);ie.write_shift(4,ze.state||0),ie.write_shift(4,0),ie.write_shift(4,0),ie.write_shift(4,0),ie.write_shift(4,0),ie.write_shift(4,ze.start),ie.write_shift(4,ze.size),ie.write_shift(4,0)}for(ce=1;ce<Ae.FileIndex.length;++ce)if(ze=Ae.FileIndex[ce],ze.size>=4096)if(ie.l=ze.start+1<<9,sa&&Buffer.isBuffer(ze.content))ze.content.copy(ie,ie.l,0,ze.size),ie.l+=ze.size+511&-512;else{for(Re=0;Re<ze.size;++Re)ie.write_shift(1,ze.content[Re]);for(;Re&511;++Re)ie.write_shift(1,0)}for(ce=1;ce<Ae.FileIndex.length;++ce)if(ze=Ae.FileIndex[ce],ze.size>0&&ze.size<4096)if(sa&&Buffer.isBuffer(ze.content))ze.content.copy(ie,ie.l,0,ze.size),ie.l+=ze.size+63&-64;else{for(Re=0;Re<ze.size;++Re)ie.write_shift(1,ze.content[Re]);for(;Re&63;++Re)ie.write_shift(1,0)}if(sa)ie.l=ie.length;else for(;ie.l<ie.length;)ie.write_shift(1,0);return ie}function Oe(Ae,ue){var Z=Ae.FullPaths.map(function(Re){return Re.toUpperCase()}),K=Z.map(function(Re){var Ce=Re.split("/");return Ce[Ce.length-(Re.slice(-1)=="/"?2:1)]}),ie=!1;ue.charCodeAt(0)===47?(ie=!0,ue=Z[0].slice(0,-1)+ue):ie=ue.indexOf("/")!==-1;var ce=ue.toUpperCase(),_e=ie===!0?Z.indexOf(ce):K.indexOf(ce);if(_e!==-1)return Ae.FileIndex[_e];var Ie=!ce.match(OT);for(ce=ce.replace(Lw,""),Ie&&(ce=ce.replace(OT,"!")),_e=0;_e<Z.length;++_e)if((Ie?Z[_e].replace(OT,"!"):Z[_e]).replace(Lw,"")==ce||(Ie?K[_e].replace(OT,"!"):K[_e]).replace(Lw,"")==ce)return Ae.FileIndex[_e];return null}var Ee=64,qe=-2,Qe="d0cf11e0a1b11ae1",gt=[208,207,17,224,161,177,26,225],Xe="00000000000000000000000000000000",ct={MAXREGSECT:-6,DIFSECT:-4,FATSECT:-3,ENDOFCHAIN:qe,FREESECT:-1,HEADER_SIGNATURE:Qe,HEADER_MINOR_VERSION:"3e00",MAXREGSID:-6,NOSTREAM:-1,HEADER_CLSID:Xe,EntryTypes:["unknown","storage","stream","lockbytes","property","root"]};function Me(Ae,ue,Z){E();var K=ke(Ae,Z);S.writeFileSync(ue,K)}function mt(Ae){for(var ue=new Array(Ae.length),Z=0;Z<Ae.length;++Z)ue[Z]=String.fromCharCode(Ae[Z]);return ue.join("")}function Kt(Ae,ue){var Z=ke(Ae,ue);switch(ue&&ue.type||"buffer"){case"file":return E(),S.writeFileSync(ue.filename,Z),Z;case"binary":return typeof Z=="string"?Z:mt(Z);case"base64":return bb(typeof Z=="string"?Z:mt(Z));case"buffer":if(sa)return Buffer.isBuffer(Z)?Z:Cf(Z);case"array":return typeof Z=="string"?md(Z):Z}return Z}var it;function ee(Ae){try{var ue=Ae.InflateRaw,Z=new ue;if(Z._processChunk(new Uint8Array([3,0]),Z._finishFlushFlag),Z.bytesRead)it=Ae;else throw new Error("zlib does not expose bytesRead")}catch(K){console.error("cannot use native zlib: "+(K.message||K))}}function he(Ae,ue){if(!it)return $n(Ae,ue);var Z=it.InflateRaw,K=new Z,ie=K._processChunk(Ae.slice(Ae.l),K._finishFlushFlag);return Ae.l+=K.bytesRead,ie}function Se(Ae){return it?it.deflateRawSync(Ae):en(Ae)}var Ue=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],nt=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],dt=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];function Vt(Ae){var ue=(Ae<<1|Ae<<11)&139536|(Ae<<5|Ae<<15)&558144;return(ue>>16|ue>>8|ue)&255}for(var zt=typeof Uint8Array<"u",Gt=zt?new Uint8Array(256):[],jr=0;jr<256;++jr)Gt[jr]=Vt(jr);function Wr(Ae,ue){var Z=Gt[Ae&255];return ue<=8?Z>>>8-ue:(Z=Z<<8|Gt[Ae>>8&255],ue<=16?Z>>>16-ue:(Z=Z<<8|Gt[Ae>>16&255],Z>>>24-ue))}function nn(Ae,ue){var Z=ue&7,K=ue>>>3;return(Ae[K]|(Z<=6?0:Ae[K+1]<<8))>>>Z&3}function xn(Ae,ue){var Z=ue&7,K=ue>>>3;return(Ae[K]|(Z<=5?0:Ae[K+1]<<8))>>>Z&7}function ei(Ae,ue){var Z=ue&7,K=ue>>>3;return(Ae[K]|(Z<=4?0:Ae[K+1]<<8))>>>Z&15}function Dn(Ae,ue){var Z=ue&7,K=ue>>>3;return(Ae[K]|(Z<=3?0:Ae[K+1]<<8))>>>Z&31}function Zr(Ae,ue){var Z=ue&7,K=ue>>>3;return(Ae[K]|(Z<=1?0:Ae[K+1]<<8))>>>Z&127}function Nn(Ae,ue,Z){var K=ue&7,ie=ue>>>3,ce=(1<<Z)-1,_e=Ae[ie]>>>K;return Z<8-K||(_e|=Ae[ie+1]<<8-K,Z<16-K)||(_e|=Ae[ie+2]<<16-K,Z<24-K)||(_e|=Ae[ie+3]<<24-K),_e&ce}function Pi(Ae,ue,Z){var K=ue&7,ie=ue>>>3;return K<=5?Ae[ie]|=(Z&7)<<K:(Ae[ie]|=Z<<K&255,Ae[ie+1]=(Z&7)>>8-K),ue+3}function ft(Ae,ue,Z){var K=ue&7,ie=ue>>>3;return Z=(Z&1)<<K,Ae[ie]|=Z,ue+1}function Rt(Ae,ue,Z){var K=ue&7,ie=ue>>>3;return Z<<=K,Ae[ie]|=Z&255,Z>>>=8,Ae[ie+1]=Z,ue+8}function Wt(Ae,ue,Z){var K=ue&7,ie=ue>>>3;return Z<<=K,Ae[ie]|=Z&255,Z>>>=8,Ae[ie+1]=Z&255,Ae[ie+2]=Z>>>8,ue+16}function Pr(Ae,ue){var Z=Ae.length,K=2*Z>ue?2*Z:ue+5,ie=0;if(Z>=ue)return Ae;if(sa){var ce=s5(K);if(Ae.copy)Ae.copy(ce);else for(;ie<Ae.length;++ie)ce[ie]=Ae[ie];return ce}else if(zt){var _e=new Uint8Array(K);if(_e.set)_e.set(Ae);else for(;ie<Z;++ie)_e[ie]=Ae[ie];return _e}return Ae.length=K,Ae}function Sr(Ae){for(var ue=new Array(Ae),Z=0;Z<Ae;++Z)ue[Z]=0;return ue}function Nr(Ae,ue,Z){var K=1,ie=0,ce=0,_e=0,Ie=0,Re=Ae.length,Ce=zt?new Uint16Array(32):Sr(32);for(ce=0;ce<32;++ce)Ce[ce]=0;for(ce=Re;ce<Z;++ce)Ae[ce]=0;Re=Ae.length;var ze=zt?new Uint16Array(Re):Sr(Re);for(ce=0;ce<Re;++ce)Ce[ie=Ae[ce]]++,K<ie&&(K=ie),ze[ce]=0;for(Ce[0]=0,ce=1;ce<=K;++ce)Ce[ce+16]=Ie=Ie+Ce[ce-1]<<1;for(ce=0;ce<Re;++ce)Ie=Ae[ce],Ie!=0&&(ze[ce]=Ce[Ie+16]++);var et=0;for(ce=0;ce<Re;++ce)if(et=Ae[ce],et!=0)for(Ie=Wr(ze[ce],K)>>K-et,_e=(1<<K+4-et)-1;_e>=0;--_e)ue[Ie|_e<<et]=et&15|ce<<4;return K}var Kr=zt?new Uint16Array(512):Sr(512),Zn=zt?new Uint16Array(32):Sr(32);if(!zt){for(var Yn=0;Yn<512;++Yn)Kr[Yn]=0;for(Yn=0;Yn<32;++Yn)Zn[Yn]=0}(function(){for(var Ae=[],ue=0;ue<32;ue++)Ae.push(5);Nr(Ae,Zn,32);var Z=[];for(ue=0;ue<=143;ue++)Z.push(8);for(;ue<=255;ue++)Z.push(9);for(;ue<=279;ue++)Z.push(7);for(;ue<=287;ue++)Z.push(8);Nr(Z,Kr,288)})();var Zt=function(){for(var ue=zt?new Uint8Array(32768):[],Z=0,K=0;Z<dt.length-1;++Z)for(;K<dt[Z+1];++K)ue[K]=Z;for(;K<32768;++K)ue[K]=29;var ie=zt?new Uint8Array(259):[];for(Z=0,K=0;Z<nt.length-1;++Z)for(;K<nt[Z+1];++K)ie[K]=Z;function ce(Ie,Re){for(var Ce=0;Ce<Ie.length;){var ze=Math.min(65535,Ie.length-Ce),et=Ce+ze==Ie.length;for(Re.write_shift(1,+et),Re.write_shift(2,ze),Re.write_shift(2,~ze&65535);ze-- >0;)Re[Re.l++]=Ie[Ce++]}return Re.l}function _e(Ie,Re){for(var Ce=0,ze=0,et=zt?new Uint16Array(32768):[];ze<Ie.length;){var ut=Math.min(65535,Ie.length-ze);if(ut<10){for(Ce=Pi(Re,Ce,+(ze+ut==Ie.length)),Ce&7&&(Ce+=8-(Ce&7)),Re.l=Ce/8|0,Re.write_shift(2,ut),Re.write_shift(2,~ut&65535);ut-- >0;)Re[Re.l++]=Ie[ze++];Ce=Re.l*8;continue}Ce=Pi(Re,Ce,+(ze+ut==Ie.length)+2);for(var Ut=0;ut-- >0;){var Xt=Ie[ze];Ut=(Ut<<5^Xt)&32767;var Qt=-1,ur=0;if((Qt=et[Ut])&&(Qt|=ze&-32768,Qt>ze&&(Qt-=32768),Qt<ze))for(;Ie[Qt+ur]==Ie[ze+ur]&&ur<250;)++ur;if(ur>2){Xt=ie[ur],Xt<=22?Ce=Rt(Re,Ce,Gt[Xt+1]>>1)-1:(Rt(Re,Ce,3),Ce+=5,Rt(Re,Ce,Gt[Xt-23]>>5),Ce+=3);var Yr=Xt<8?0:Xt-4>>2;Yr>0&&(Wt(Re,Ce,ur-nt[Xt]),Ce+=Yr),Xt=ue[ze-Qt],Ce=Rt(Re,Ce,Gt[Xt]>>3),Ce-=3;var Xr=Xt<4?0:Xt-2>>1;Xr>0&&(Wt(Re,Ce,ze-Qt-dt[Xt]),Ce+=Xr);for(var Rn=0;Rn<ur;++Rn)et[Ut]=ze&32767,Ut=(Ut<<5^Ie[ze])&32767,++ze;ut-=ur-1}else Xt<=143?Xt=Xt+48:Ce=ft(Re,Ce,1),Ce=Rt(Re,Ce,Gt[Xt]),et[Ut]=ze&32767,++ze}Ce=Rt(Re,Ce,0)-1}return Re.l=(Ce+7)/8|0,Re.l}return function(Re,Ce){return Re.length<8?ce(Re,Ce):_e(Re,Ce)}}();function en(Ae){var ue=vr(50+Math.floor(Ae.length*1.1)),Z=Zt(Ae,ue);return ue.slice(0,Z)}var Sn=zt?new Uint16Array(32768):Sr(32768),fs=zt?new Uint16Array(32768):Sr(32768),ms=zt?new Uint16Array(128):Sr(128),hr=1,An=1;function fi(Ae,ue){var Z=Dn(Ae,ue)+257;ue+=5;var K=Dn(Ae,ue)+1;ue+=5;var ie=ei(Ae,ue)+4;ue+=4;for(var ce=0,_e=zt?new Uint8Array(19):Sr(19),Ie=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Re=1,Ce=zt?new Uint8Array(8):Sr(8),ze=zt?new Uint8Array(8):Sr(8),et=_e.length,ut=0;ut<ie;++ut)_e[Ue[ut]]=ce=xn(Ae,ue),Re<ce&&(Re=ce),Ce[ce]++,ue+=3;var Ut=0;for(Ce[0]=0,ut=1;ut<=Re;++ut)ze[ut]=Ut=Ut+Ce[ut-1]<<1;for(ut=0;ut<et;++ut)(Ut=_e[ut])!=0&&(Ie[ut]=ze[Ut]++);var Xt=0;for(ut=0;ut<et;++ut)if(Xt=_e[ut],Xt!=0){Ut=Gt[Ie[ut]]>>8-Xt;for(var Qt=(1<<7-Xt)-1;Qt>=0;--Qt)ms[Ut|Qt<<Xt]=Xt&7|ut<<3}var ur=[];for(Re=1;ur.length<Z+K;)switch(Ut=ms[Zr(Ae,ue)],ue+=Ut&7,Ut>>>=3){case 16:for(ce=3+nn(Ae,ue),ue+=2,Ut=ur[ur.length-1];ce-- >0;)ur.push(Ut);break;case 17:for(ce=3+xn(Ae,ue),ue+=3;ce-- >0;)ur.push(0);break;case 18:for(ce=11+Zr(Ae,ue),ue+=7;ce-- >0;)ur.push(0);break;default:ur.push(Ut),Re<Ut&&(Re=Ut);break}var Yr=ur.slice(0,Z),Xr=ur.slice(Z);for(ut=Z;ut<286;++ut)Yr[ut]=0;for(ut=K;ut<30;++ut)Xr[ut]=0;return hr=Nr(Yr,Sn,286),An=Nr(Xr,fs,30),ue}function Vi(Ae,ue){if(Ae[0]==3&&!(Ae[1]&3))return[T_(ue),2];for(var Z=0,K=0,ie=s5(ue||1<<18),ce=0,_e=ie.length>>>0,Ie=0,Re=0;!(K&1);){if(K=xn(Ae,Z),Z+=3,K>>>1)K>>1==1?(Ie=9,Re=5):(Z=fi(Ae,Z),Ie=hr,Re=An);else{Z&7&&(Z+=8-(Z&7));var Ce=Ae[Z>>>3]|Ae[(Z>>>3)+1]<<8;if(Z+=32,Ce>0)for(!ue&&_e<ce+Ce&&(ie=Pr(ie,ce+Ce),_e=ie.length);Ce-- >0;)ie[ce++]=Ae[Z>>>3],Z+=8;continue}for(;;){!ue&&_e<ce+32767&&(ie=Pr(ie,ce+32767),_e=ie.length);var ze=Nn(Ae,Z,Ie),et=K>>>1==1?Kr[ze]:Sn[ze];if(Z+=et&15,et>>>=4,!(et>>>8&255))ie[ce++]=et;else{if(et==256)break;et-=257;var ut=et<8?0:et-4>>2;ut>5&&(ut=0);var Ut=ce+nt[et];ut>0&&(Ut+=Nn(Ae,Z,ut),Z+=ut),ze=Nn(Ae,Z,Re),et=K>>>1==1?Zn[ze]:fs[ze],Z+=et&15,et>>>=4;var Xt=et<4?0:et-2>>1,Qt=dt[et];for(Xt>0&&(Qt+=Nn(Ae,Z,Xt),Z+=Xt),!ue&&_e<Ut&&(ie=Pr(ie,Ut+100),_e=ie.length);ce<Ut;)ie[ce]=ie[ce-Qt],++ce}}}return ue?[ie,Z+7>>>3]:[ie.slice(0,ce),Z+7>>>3]}function $n(Ae,ue){var Z=Ae.slice(Ae.l||0),K=Vi(Z,ue);return Ae.l+=K[1],K[0]}function vi(Ae,ue){if(Ae)typeof console<"u"&&console.error(ue);else throw new Error(ue)}function ii(Ae,ue){var Z=Ae;Vc(Z,0);var K=[],ie=[],ce={FileIndex:K,FullPaths:ie};ye(ce,{root:ue.root});for(var _e=Z.length-4;(Z[_e]!=80||Z[_e+1]!=75||Z[_e+2]!=5||Z[_e+3]!=6)&&_e>=0;)--_e;Z.l=_e+4,Z.l+=4;var Ie=Z.read_shift(2);Z.l+=6;var Re=Z.read_shift(4);for(Z.l=Re,_e=0;_e<Ie;++_e){Z.l+=20;var Ce=Z.read_shift(4),ze=Z.read_shift(4),et=Z.read_shift(2),ut=Z.read_shift(2),Ut=Z.read_shift(2);Z.l+=8;var Xt=Z.read_shift(4),Qt=i(Z.slice(Z.l+et,Z.l+et+ut));Z.l+=et+ut+Ut;var ur=Z.l;Z.l=Xt+4,Ds(Z,Ce,ze,ce,Qt),Z.l=ur}return ce}function Ds(Ae,ue,Z,K,ie){Ae.l+=2;var ce=Ae.read_shift(2),_e=Ae.read_shift(2),Ie=m(Ae);if(ce&8257)throw new Error("Unsupported ZIP encryption");for(var Re=Ae.read_shift(4),Ce=Ae.read_shift(4),ze=Ae.read_shift(4),et=Ae.read_shift(2),ut=Ae.read_shift(2),Ut="",Xt=0;Xt<et;++Xt)Ut+=String.fromCharCode(Ae[Ae.l++]);if(ut){var Qt=i(Ae.slice(Ae.l,Ae.l+ut));(Qt[21589]||{}).mt&&(Ie=Qt[21589].mt),((ie||{})[21589]||{}).mt&&(Ie=ie[21589].mt)}Ae.l+=ut;var ur=Ae.slice(Ae.l,Ae.l+Ce);switch(_e){case 8:ur=he(Ae,ze);break;case 0:break;default:throw new Error("Unsupported ZIP Compression method "+_e)}var Yr=!1;ce&8&&(Re=Ae.read_shift(4),Re==134695760&&(Re=Ae.read_shift(4),Yr=!0),Ce=Ae.read_shift(4),ze=Ae.read_shift(4)),Ce!=ue&&vi(Yr,"Bad compressed size: "+ue+" != "+Ce),ze!=Z&&vi(Yr,"Bad uncompressed size: "+Z+" != "+ze),pt(K,Ut,ur,{unsafe:!0,mt:Ie})}function Ua(Ae,ue){var Z=ue||{},K=[],ie=[],ce=vr(1),_e=Z.compression?8:0,Ie=0,Re=0,Ce=0,ze=0,et=0,ut=Ae.FullPaths[0],Ut=ut,Xt=Ae.FileIndex[0],Qt=[],ur=0;for(Re=1;Re<Ae.FullPaths.length;++Re)if(Ut=Ae.FullPaths[Re].slice(ut.length),Xt=Ae.FileIndex[Re],!(!Xt.size||!Xt.content||Ut=="Sh33tJ5")){var Yr=ze,Xr=vr(Ut.length);for(Ce=0;Ce<Ut.length;++Ce)Xr.write_shift(1,Ut.charCodeAt(Ce)&127);Xr=Xr.slice(0,Xr.l),Qt[et]=A_e.buf(Xt.content,0);var Rn=Xt.content;_e==8&&(Rn=Se(Rn)),ce=vr(30),ce.write_shift(4,67324752),ce.write_shift(2,20),ce.write_shift(2,Ie),ce.write_shift(2,_e),Xt.mt?f(ce,Xt.mt):ce.write_shift(4,0),ce.write_shift(-4,Qt[et]),ce.write_shift(4,Rn.length),ce.write_shift(4,Xt.content.length),ce.write_shift(2,Xr.length),ce.write_shift(2,0),ze+=ce.length,K.push(ce),ze+=Xr.length,K.push(Xr),ze+=Rn.length,K.push(Rn),ce=vr(46),ce.write_shift(4,33639248),ce.write_shift(2,0),ce.write_shift(2,20),ce.write_shift(2,Ie),ce.write_shift(2,_e),ce.write_shift(4,0),ce.write_shift(-4,Qt[et]),ce.write_shift(4,Rn.length),ce.write_shift(4,Xt.content.length),ce.write_shift(2,Xr.length),ce.write_shift(2,0),ce.write_shift(2,0),ce.write_shift(2,0),ce.write_shift(2,0),ce.write_shift(4,0),ce.write_shift(4,Yr),ur+=ce.l,ie.push(ce),ur+=Xr.length,ie.push(Xr),++et}return ce=vr(22),ce.write_shift(4,101010256),ce.write_shift(2,0),ce.write_shift(2,0),ce.write_shift(2,et),ce.write_shift(2,et),ce.write_shift(4,ur),ce.write_shift(4,ze),ce.write_shift(2,0),ll([ll(K),ll(ie),ce])}var Us={htm:"text/html",xml:"text/xml",gif:"image/gif",jpg:"image/jpeg",png:"image/png",mso:"application/x-mso",thmx:"application/vnd.ms-officetheme",sh33tj5:"application/octet-stream"};function Ot(Ae,ue){if(Ae.ctype)return Ae.ctype;var Z=Ae.name||"",K=Z.match(/\.([^\.]+)$/);return K&&Us[K[1]]||ue&&(K=(Z=ue).match(/[\.\\]([^\.\\])+$/),K&&Us[K[1]])?Us[K[1]]:"application/octet-stream"}function Hr(Ae){for(var ue=bb(Ae),Z=[],K=0;K<ue.length;K+=76)Z.push(ue.slice(K,K+76));return Z.join(`\r
`)+`\r
`}function hn(Ae){var ue=Ae.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF=]/g,function(Ce){var ze=Ce.charCodeAt(0).toString(16).toUpperCase();return"="+(ze.length==1?"0"+ze:ze)});ue=ue.replace(/ $/mg,"=20").replace(/\t$/mg,"=09"),ue.charAt(0)==`
`&&(ue="=0D"+ue.slice(1)),ue=ue.replace(/\r(?!\n)/mg,"=0D").replace(/\n\n/mg,`
=0A`).replace(/([^\r\n])\n/mg,"$1=0A");for(var Z=[],K=ue.split(`\r
`),ie=0;ie<K.length;++ie){var ce=K[ie];if(ce.length==0){Z.push("");continue}for(var _e=0;_e<ce.length;){var Ie=76,Re=ce.slice(_e,_e+Ie);Re.charAt(Ie-1)=="="?Ie--:Re.charAt(Ie-2)=="="?Ie-=2:Re.charAt(Ie-3)=="="&&(Ie-=3),Re=ce.slice(_e,_e+Ie),_e+=Ie,_e<ce.length&&(Re+="="),Z.push(Re)}}return Z.join(`\r
`)}function vn(Ae){for(var ue=[],Z=0;Z<Ae.length;++Z){for(var K=Ae[Z];Z<=Ae.length&&K.charAt(K.length-1)=="=";)K=K.slice(0,K.length-1)+Ae[++Z];ue.push(K)}for(var ie=0;ie<ue.length;++ie)ue[ie]=ue[ie].replace(/[=][0-9A-Fa-f]{2}/g,function(ce){return String.fromCharCode(parseInt(ce.slice(1),16))});return md(ue.join(`\r
`))}function ai(Ae,ue,Z){for(var K="",ie="",ce="",_e,Ie=0;Ie<10;++Ie){var Re=ue[Ie];if(!Re||Re.match(/^\s*$/))break;var Ce=Re.match(/^(.*?):\s*([^\s].*)$/);if(Ce)switch(Ce[1].toLowerCase()){case"content-location":K=Ce[2].trim();break;case"content-type":ce=Ce[2].trim();break;case"content-transfer-encoding":ie=Ce[2].trim();break}}switch(++Ie,ie.toLowerCase()){case"base64":_e=md(vf(ue.slice(Ie).join("")));break;case"quoted-printable":_e=vn(ue.slice(Ie));break;default:throw new Error("Unsupported Content-Transfer-Encoding "+ie)}var ze=pt(Ae,K.slice(Z.length),_e,{unsafe:!0});ce&&(ze.ctype=ce)}function At(Ae,ue){if(mt(Ae.slice(0,13)).toLowerCase()!="mime-version:")throw new Error("Unsupported MAD header");var Z=ue&&ue.root||"",K=(sa&&Buffer.isBuffer(Ae)?Ae.toString("binary"):mt(Ae)).split(`\r
`),ie=0,ce="";for(ie=0;ie<K.length;++ie)if(ce=K[ie],!!/^Content-Location:/i.test(ce)&&(ce=ce.slice(ce.indexOf("file")),Z||(Z=ce.slice(0,ce.lastIndexOf("/")+1)),ce.slice(0,Z.length)!=Z))for(;Z.length>0&&(Z=Z.slice(0,Z.length-1),Z=Z.slice(0,Z.lastIndexOf("/")+1),ce.slice(0,Z.length)!=Z););var _e=(K[1]||"").match(/boundary="(.*?)"/);if(!_e)throw new Error("MAD cannot find boundary");var Ie="--"+(_e[1]||""),Re=[],Ce=[],ze={FileIndex:Re,FullPaths:Ce};ye(ze);var et,ut=0;for(ie=0;ie<K.length;++ie){var Ut=K[ie];Ut!==Ie&&Ut!==Ie+"--"||(ut++&&ai(ze,K.slice(et,ie),Z),et=ie)}return ze}function $i(Ae,ue){var Z=ue||{},K=Z.boundary||"SheetJS";K="------="+K;for(var ie=["MIME-Version: 1.0",'Content-Type: multipart/related; boundary="'+K.slice(2)+'"',"","",""],ce=Ae.FullPaths[0],_e=ce,Ie=Ae.FileIndex[0],Re=1;Re<Ae.FullPaths.length;++Re)if(_e=Ae.FullPaths[Re].slice(ce.length),Ie=Ae.FileIndex[Re],!(!Ie.size||!Ie.content||_e=="Sh33tJ5")){_e=_e.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF]/g,function(ur){return"_x"+ur.charCodeAt(0).toString(16)+"_"}).replace(/[\u0080-\uFFFF]/g,function(ur){return"_u"+ur.charCodeAt(0).toString(16)+"_"});for(var Ce=Ie.content,ze=sa&&Buffer.isBuffer(Ce)?Ce.toString("binary"):mt(Ce),et=0,ut=Math.min(1024,ze.length),Ut=0,Xt=0;Xt<=ut;++Xt)(Ut=ze.charCodeAt(Xt))>=32&&Ut<128&&++et;var Qt=et>=ut*4/5;ie.push(K),ie.push("Content-Location: "+(Z.root||"file:///C:/SheetJS/")+_e),ie.push("Content-Transfer-Encoding: "+(Qt?"quoted-printable":"base64")),ie.push("Content-Type: "+Ot(Ie,_e)),ie.push(""),ie.push(Qt?hn(ze):Hr(ze))}return ie.push(K+`--\r
`),ie.join(`\r
`)}function ha(Ae){var ue={};return ye(ue,Ae),ue}function pt(Ae,ue,Z,K){var ie=K&&K.unsafe;ie||ye(Ae);var ce=!ie&&Ta.find(Ae,ue);if(!ce){var _e=Ae.FullPaths[0];ue.slice(0,_e.length)==_e?_e=ue:(_e.slice(-1)!="/"&&(_e+="/"),_e=(_e+ue).replace("//","/")),ce={name:u(ue),type:2},Ae.FileIndex.push(ce),Ae.FullPaths.push(_e),ie||Ta.utils.cfb_gc(Ae)}return ce.content=Z,ce.size=Z?Z.length:0,K&&(K.CLSID&&(ce.clsid=K.CLSID),K.mt&&(ce.mt=K.mt),K.ct&&(ce.ct=K.ct)),ce}function lt(Ae,ue){ye(Ae);var Z=Ta.find(Ae,ue);if(Z){for(var K=0;K<Ae.FileIndex.length;++K)if(Ae.FileIndex[K]==Z)return Ae.FileIndex.splice(K,1),Ae.FullPaths.splice(K,1),!0}return!1}function Er(Ae,ue,Z){ye(Ae);var K=Ta.find(Ae,ue);if(K){for(var ie=0;ie<Ae.FileIndex.length;++ie)if(Ae.FileIndex[ie]==K)return Ae.FileIndex[ie].name=u(Z),Ae.FullPaths[ie]=Z,!0}return!1}function Jr(Ae){be(Ae,!0)}return t.find=Oe,t.read=le,t.parse=I,t.write=Kt,t.writeFile=Me,t.utils={cfb_new:ha,cfb_add:pt,cfb_del:lt,cfb_mov:Er,cfb_gc:Jr,ReadShift:Bw,CheckField:mW,prep_blob:Vc,bconcat:ll,use_zlib:ee,_deflateRaw:en,_inflateRaw:$n,consts:ct},t}();function j_e(e){return typeof e=="string"?bA(e):Array.isArray(e)?e_e(e):e}function r2(e,t,r){if(typeof Deno<"u"){if(r&&typeof t=="string")switch(r){case"utf8":t=new TextEncoder(r).encode(t);break;case"binary":t=bA(t);break;default:throw new Error("Unsupported encoding "+r)}return Deno.writeFileSync(e,t)}var s=r=="utf8"?Tb(t):t;if(typeof IE_SaveFile<"u")return IE_SaveFile(s,e);if(typeof Blob<"u"){var u=new Blob([j_e(s)],{type:"application/octet-stream"});if(typeof navigator<"u"&&navigator.msSaveBlob)return navigator.msSaveBlob(u,e);if(typeof saveAs<"u")return saveAs(u,e);if(typeof URL<"u"&&typeof document<"u"&&document.createElement&&URL.createObjectURL){var f=URL.createObjectURL(u);if(typeof chrome=="object"&&typeof(chrome.downloads||{}).download=="function")return URL.revokeObjectURL&&typeof setTimeout<"u"&&setTimeout(function(){URL.revokeObjectURL(f)},6e4),chrome.downloads.download({url:f,filename:e,saveAs:!0});var m=document.createElement("a");if(m.download!=null)return m.download=e,m.href=f,document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL&&typeof setTimeout<"u"&&setTimeout(function(){URL.revokeObjectURL(f)},6e4),f}}if(typeof $<"u"&&typeof File<"u"&&typeof Folder<"u")try{var i=File(e);return i.open("w"),i.encoding="binary",Array.isArray(t)&&(t=t2(t)),i.write(t),i.close(),t}catch(S){if(!S.message||!S.message.match(/onstruct/))throw S}throw new Error("cannot save file "+e)}function pl(e){for(var t=Object.keys(e),r=[],s=0;s<t.length;++s)Object.prototype.hasOwnProperty.call(e,t[s])&&r.push(t[s]);return r}function f5(e,t){for(var r=[],s=pl(e),u=0;u!==s.length;++u)r[e[s[u]][t]]==null&&(r[e[s[u]][t]]=s[u]);return r}function xM(e){for(var t=[],r=pl(e),s=0;s!==r.length;++s)t[e[r[s]]]=r[s];return t}function EA(e){for(var t=[],r=pl(e),s=0;s!==r.length;++s)t[e[r[s]]]=parseInt(r[s],10);return t}function I_e(e){for(var t=[],r=pl(e),s=0;s!==r.length;++s)t[e[r[s]]]==null&&(t[e[r[s]]]=[]),t[e[r[s]]].push(r[s]);return t}var _C=new Date(1899,11,30,0,0,0);function kc(e,t){var r=e.getTime(),s=_C.getTime()+(e.getTimezoneOffset()-_C.getTimezoneOffset())*6e4;return(r-s)/(24*60*60*1e3)}var JG=new Date,N_e=_C.getTime()+(JG.getTimezoneOffset()-_C.getTimezoneOffset())*6e4,p5=JG.getTimezoneOffset();function QG(e){var t=new Date;return t.setTime(e*24*60*60*1e3+N_e),t.getTimezoneOffset()!==p5&&t.setTime(t.getTime()+(t.getTimezoneOffset()-p5)*6e4),t}var m5=new Date("2017-02-19T19:06:09.000Z"),eW=isNaN(m5.getFullYear())?new Date("2/19/17"):m5,k_e=eW.getFullYear()==2017;function Ql(e,t){var r=new Date(e);if(k_e)return t>0?r.setTime(r.getTime()+r.getTimezoneOffset()*60*1e3):t<0&&r.setTime(r.getTime()-r.getTimezoneOffset()*60*1e3),r;if(e instanceof Date)return e;if(eW.getFullYear()==1917&&!isNaN(r.getFullYear())){var s=r.getFullYear();return e.indexOf(""+s)>-1||r.setFullYear(r.getFullYear()+100),r}var u=e.match(/\d+/g)||["2017","2","19","0","0","0"],f=new Date(+u[0],+u[1]-1,+u[2],+u[3]||0,+u[4]||0,+u[5]||0);return e.indexOf("Z")>-1&&(f=new Date(f.getTime()-f.getTimezoneOffset()*60*1e3)),f}function CA(e,t){if(sa&&Buffer.isBuffer(e))return e.toString("binary");if(typeof TextDecoder<"u")try{var r={"":"","":"",:"","":"","":"","":"","":"","":"","":"",:"","":"",:"",:"","":"","":"","":"","":"","":"","":"","":"","":"","":"",:"","":"",:"",:"",:""};return Array.isArray(e)&&(e=new Uint8Array(e)),new TextDecoder("latin1").decode(e).replace(/[]/g,function(f){return r[f]||f})}catch{}for(var s=[],u=0;u!=e.length;++u)s.push(String.fromCharCode(e[u]));return s.join("")}function Pc(e){if(typeof JSON<"u"&&!Array.isArray(e))return JSON.parse(JSON.stringify(e));if(typeof e!="object"||e==null)return e;if(e instanceof Date)return new Date(e.getTime());var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=Pc(e[r]));return t}function fo(e,t){for(var r="";r.length<t;)r+=e;return r}function uf(e){var t=Number(e);if(!isNaN(t))return isFinite(t)?t:NaN;if(!/\d/.test(e))return t;var r=1,s=e.replace(/([\d]),([\d])/g,"$1$2").replace(/[$]/g,"").replace(/[%]/g,function(){return r*=100,""});return!isNaN(t=Number(s))||(s=s.replace(/[(](.*)[)]/,function(u,f){return r=-r,f}),!isNaN(t=Number(s)))?t/r:t}var P_e=["january","february","march","april","may","june","july","august","september","october","november","december"];function Sb(e){var t=new Date(e),r=new Date(NaN),s=t.getYear(),u=t.getMonth(),f=t.getDate();if(isNaN(f))return r;var m=e.toLowerCase();if(m.match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/)){if(m=m.replace(/[^a-z]/g,"").replace(/([^a-z]|^)[ap]m?([^a-z]|$)/,""),m.length>3&&P_e.indexOf(m)==-1)return r}else if(m.match(/[a-z]/))return r;return s<0||s>8099?r:(u>0||f>1)&&s!=101?t:e.match(/[^-0-9:,\/\\]/)?r:t}function hs(e,t,r){if(e.FullPaths){if(typeof r=="string"){var s;return sa?s=Cf(r):s=t_e(r),Ta.utils.cfb_add(e,t,s)}Ta.utils.cfb_add(e,t,r)}else e.file(t,r)}function vM(){return Ta.utils.cfb_new()}var No=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r
`,D_e={"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"},yM=xM(D_e),wM=/[&<>'"]/g,R_e=/[\u0000-\u0008\u000b-\u001f]/g;function xa(e){var t=e+"";return t.replace(wM,function(r){return yM[r]}).replace(R_e,function(r){return"_x"+("000"+r.charCodeAt(0).toString(16)).slice(-4)+"_"})}function g5(e){return xa(e).replace(/ /g,"_x0020_")}var tW=/[\u0000-\u001f]/g;function M_e(e){var t=e+"";return t.replace(wM,function(r){return yM[r]}).replace(/\n/g,"<br/>").replace(tW,function(r){return"&#x"+("000"+r.charCodeAt(0).toString(16)).slice(-4)+";"})}function O_e(e){var t=e+"";return t.replace(wM,function(r){return yM[r]}).replace(tW,function(r){return"&#x"+r.charCodeAt(0).toString(16).toUpperCase()+";"})}function F_e(e){return e.replace(/(\r\n|[\r\n])/g,"&#10;")}function L_e(e){switch(e){case 1:case!0:case"1":case"true":case"TRUE":return!0;default:return!1}}function WN(e){for(var t="",r=0,s=0,u=0,f=0,m=0,i=0;r<e.length;){if(s=e.charCodeAt(r++),s<128){t+=String.fromCharCode(s);continue}if(u=e.charCodeAt(r++),s>191&&s<224){m=(s&31)<<6,m|=u&63,t+=String.fromCharCode(m);continue}if(f=e.charCodeAt(r++),s<240){t+=String.fromCharCode((s&15)<<12|(u&63)<<6|f&63);continue}m=e.charCodeAt(r++),i=((s&7)<<18|(u&63)<<12|(f&63)<<6|m&63)-65536,t+=String.fromCharCode(55296+(i>>>10&1023)),t+=String.fromCharCode(56320+(i&1023))}return t}function _5(e){var t=T_(2*e.length),r,s,u=1,f=0,m=0,i;for(s=0;s<e.length;s+=u)u=1,(i=e.charCodeAt(s))<128?r=i:i<224?(r=(i&31)*64+(e.charCodeAt(s+1)&63),u=2):i<240?(r=(i&15)*4096+(e.charCodeAt(s+1)&63)*64+(e.charCodeAt(s+2)&63),u=3):(u=4,r=(i&7)*262144+(e.charCodeAt(s+1)&63)*4096+(e.charCodeAt(s+2)&63)*64+(e.charCodeAt(s+3)&63),r-=65536,m=55296+(r>>>10&1023),r=56320+(r&1023)),m!==0&&(t[f++]=m&255,t[f++]=m>>>8,m=0),t[f++]=r%256,t[f++]=r>>>8;return t.slice(0,f).toString("ucs2")}function x5(e){return Cf(e,"binary").toString("utf8")}var LT="foo bar baz",zw=sa&&(x5(LT)==WN(LT)&&x5||_5(LT)==WN(LT)&&_5)||WN,Tb=sa?function(e){return Cf(e,"utf8").toString("binary")}:function(e){for(var t=[],r=0,s=0,u=0;r<e.length;)switch(s=e.charCodeAt(r++),!0){case s<128:t.push(String.fromCharCode(s));break;case s<2048:t.push(String.fromCharCode(192+(s>>6))),t.push(String.fromCharCode(128+(s&63)));break;case(s>=55296&&s<57344):s-=55296,u=e.charCodeAt(r++)-56320+(s<<10),t.push(String.fromCharCode(240+(u>>18&7))),t.push(String.fromCharCode(144+(u>>12&63))),t.push(String.fromCharCode(128+(u>>6&63))),t.push(String.fromCharCode(128+(u&63)));break;default:t.push(String.fromCharCode(224+(s>>12))),t.push(String.fromCharCode(128+(s>>6&63))),t.push(String.fromCharCode(128+(s&63)))}return t.join("")},z_e=function(){var e=[["nbsp"," "],["middot",""],["quot",'"'],["apos","'"],["gt",">"],["lt","<"],["amp","&"]].map(function(t){return[new RegExp("&"+t[0]+";","ig"),t[1]]});return function(r){for(var s=r.replace(/^[\t\n\r ]+/,"").replace(/[\t\n\r ]+$/,"").replace(/>\s+/g,">").replace(/\s+</g,"<").replace(/[\t\n\r ]+/g," ").replace(/<\s*[bB][rR]\s*\/?>/g,`
`).replace(/<[^>]*>/g,""),u=0;u<e.length;++u)s=s.replace(e[u][0],e[u][1]);return s}}(),rW=/(^\s|\s$|\n)/;function cl(e,t){return"<"+e+(t.match(rW)?' xml:space="preserve"':"")+">"+t+"</"+e+">"}function Eb(e){return pl(e).map(function(t){return" "+t+'="'+e[t]+'"'}).join("")}function pn(e,t,r){return"<"+e+(r!=null?Eb(r):"")+(t!=null?(t.match(rW)?' xml:space="preserve"':"")+">"+t+"</"+e:"/")+">"}function eD(e,t){try{return e.toISOString().replace(/\.\d*/,"")}catch(r){if(t)throw r}return""}function B_e(e,t){switch(typeof e){case"string":var r=pn("vt:lpwstr",xa(e));return r=r.replace(/&quot;/g,"_x0022_"),r;case"number":return pn((e|0)==e?"vt:i4":"vt:r8",xa(String(e)));case"boolean":return pn("vt:bool",e?"true":"false")}if(e instanceof Date)return pn("vt:filetime",eD(e));throw new Error("Unable to serialize "+e)}var Ho={CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/metadata/core-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/custom-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/extended-properties",CT:"http://schemas.openxmlformats.org/package/2006/content-types",RELS:"http://schemas.openxmlformats.org/package/2006/relationships",TCMNT:"http://schemas.microsoft.com/office/spreadsheetml/2018/threadedcomments",dc:"http://purl.org/dc/elements/1.1/",dcterms:"http://purl.org/dc/terms/",dcmitype:"http://purl.org/dc/dcmitype/",mx:"http://schemas.microsoft.com/office/mac/excel/2008/main",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",sjs:"http://schemas.openxmlformats.org/package/2006/sheetjs/core-properties",vt:"http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes",xsi:"http://www.w3.org/2001/XMLSchema-instance",xsd:"http://www.w3.org/2001/XMLSchema"},Zv=["http://schemas.openxmlformats.org/spreadsheetml/2006/main","http://purl.oclc.org/ooxml/spreadsheetml/main","http://schemas.microsoft.com/office/excel/2006/main","http://schemas.microsoft.com/office/excel/2006/2"],qc={o:"urn:schemas-microsoft-com:office:office",x:"urn:schemas-microsoft-com:office:excel",ss:"urn:schemas-microsoft-com:office:spreadsheet",dt:"uuid:C2F41010-65B3-11d1-A29F-00AA00C14882",mv:"http://macVmlSchemaUri",v:"urn:schemas-microsoft-com:vml",html:"http://www.w3.org/TR/REC-html40"};function U_e(e,t){for(var r=1-2*(e[t+7]>>>7),s=((e[t+7]&127)<<4)+(e[t+6]>>>4&15),u=e[t+6]&15,f=5;f>=0;--f)u=u*256+e[t+f];return s==2047?u==0?r*(1/0):NaN:(s==0?s=-1022:(s-=1023,u+=Math.pow(2,52)),r*Math.pow(2,s-52)*u)}function V_e(e,t,r){var s=(t<0||1/t==-1/0?1:0)<<7,u=0,f=0,m=s?-t:t;isFinite(m)?m==0?u=f=0:(u=Math.floor(Math.log(m)/Math.LN2),f=m*Math.pow(2,52-u),u<=-1023&&(!isFinite(f)||f<Math.pow(2,52))?u=-1022:(f-=Math.pow(2,52),u+=1023)):(u=2047,f=isNaN(t)?26985:0);for(var i=0;i<=5;++i,f/=256)e[r+i]=f&255;e[r+6]=(u&15)<<4|f&15,e[r+7]=u>>4|s}var v5=function(e){for(var t=[],r=10240,s=0;s<e[0].length;++s)if(e[0][s])for(var u=0,f=e[0][s].length;u<f;u+=r)t.push.apply(t,e[0][s].slice(u,u+r));return t},y5=sa?function(e){return e[0].length>0&&Buffer.isBuffer(e[0][0])?Buffer.concat(e[0].map(function(t){return Buffer.isBuffer(t)?t:Cf(t)})):v5(e)}:v5,w5=function(e,t,r){for(var s=[],u=t;u<r;u+=2)s.push(String.fromCharCode(ww(e,u)));return s.join("").replace(Lw,"")},bM=sa?function(e,t,r){return Buffer.isBuffer(e)?e.toString("utf16le",t,r).replace(Lw,""):w5(e,t,r)}:w5,b5=function(e,t,r){for(var s=[],u=t;u<t+r;++u)s.push(("0"+e[u].toString(16)).slice(-2));return s.join("")},nW=sa?function(e,t,r){return Buffer.isBuffer(e)?e.toString("hex",t,t+r):b5(e,t,r)}:b5,S5=function(e,t,r){for(var s=[],u=t;u<r;u++)s.push(String.fromCharCode(Ex(e,u)));return s.join("")},n2=sa?function(t,r,s){return Buffer.isBuffer(t)?t.toString("utf8",r,s):S5(t,r,s)}:S5,iW=function(e,t){var r=Gc(e,t);return r>0?n2(e,t+4,t+4+r-1):""},sW=iW,aW=function(e,t){var r=Gc(e,t);return r>0?n2(e,t+4,t+4+r-1):""},oW=aW,lW=function(e,t){var r=2*Gc(e,t);return r>0?n2(e,t+4,t+4+r-1):""},cW=lW,uW=function(t,r){var s=Gc(t,r);return s>0?bM(t,r+4,r+4+s):""},dW=uW,hW=function(e,t){var r=Gc(e,t);return r>0?n2(e,t+4,t+4+r):""},fW=hW,pW=function(e,t){return U_e(e,t)},xC=pW,SM=function(t){return Array.isArray(t)||typeof Uint8Array<"u"&&t instanceof Uint8Array};sa&&(sW=function(t,r){if(!Buffer.isBuffer(t))return iW(t,r);var s=t.readUInt32LE(r);return s>0?t.toString("utf8",r+4,r+4+s-1):""},oW=function(t,r){if(!Buffer.isBuffer(t))return aW(t,r);var s=t.readUInt32LE(r);return s>0?t.toString("utf8",r+4,r+4+s-1):""},cW=function(t,r){if(!Buffer.isBuffer(t))return lW(t,r);var s=2*t.readUInt32LE(r);return t.toString("utf16le",r+4,r+4+s-1)},dW=function(t,r){if(!Buffer.isBuffer(t))return uW(t,r);var s=t.readUInt32LE(r);return t.toString("utf16le",r+4,r+4+s)},fW=function(t,r){if(!Buffer.isBuffer(t))return hW(t,r);var s=t.readUInt32LE(r);return t.toString("utf8",r+4,r+4+s)},xC=function(t,r){return Buffer.isBuffer(t)?t.readDoubleLE(r):pW(t,r)},SM=function(t){return Buffer.isBuffer(t)||Array.isArray(t)||typeof Uint8Array<"u"&&t instanceof Uint8Array});var Ex=function(e,t){return e[t]},ww=function(e,t){return e[t+1]*256+e[t]},$_e=function(e,t){var r=e[t+1]*256+e[t];return r<32768?r:(65535-r+1)*-1},Gc=function(e,t){return e[t+3]*(1<<24)+(e[t+2]<<16)+(e[t+1]<<8)+e[t]},Ug=function(e,t){return e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]},q_e=function(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]};function Bw(e,t){var r="",s,u,f=[],m,i,S,E;switch(t){case"dbcs":if(E=this.l,sa&&Buffer.isBuffer(this))r=this.slice(this.l,this.l+2*e).toString("utf16le");else for(S=0;S<e;++S)r+=String.fromCharCode(ww(this,E)),E+=2;e*=2;break;case"utf8":r=n2(this,this.l,this.l+e);break;case"utf16le":e*=2,r=bM(this,this.l,this.l+e);break;case"wstr":return Bw.call(this,e,"dbcs");case"lpstr-ansi":r=sW(this,this.l),e=4+Gc(this,this.l);break;case"lpstr-cp":r=oW(this,this.l),e=4+Gc(this,this.l);break;case"lpwstr":r=cW(this,this.l),e=4+2*Gc(this,this.l);break;case"lpp4":e=4+Gc(this,this.l),r=dW(this,this.l),e&2&&(e+=2);break;case"8lpp4":e=4+Gc(this,this.l),r=fW(this,this.l),e&3&&(e+=4-(e&3));break;case"cstr":for(e=0,r="";(m=Ex(this,this.l+e++))!==0;)f.push(MT(m));r=f.join("");break;case"_wstr":for(e=0,r="";(m=ww(this,this.l+e))!==0;)f.push(MT(m)),e+=2;e+=2,r=f.join("");break;case"dbcs-cont":for(r="",E=this.l,S=0;S<e;++S){if(this.lens&&this.lens.indexOf(E)!==-1)return m=Ex(this,E),this.l=E+1,i=Bw.call(this,e-S,m?"dbcs-cont":"sbcs-cont"),f.join("")+i;f.push(MT(ww(this,E))),E+=2}r=f.join(""),e*=2;break;case"cpstr":case"sbcs-cont":for(r="",E=this.l,S=0;S!=e;++S){if(this.lens&&this.lens.indexOf(E)!==-1)return m=Ex(this,E),this.l=E+1,i=Bw.call(this,e-S,m?"dbcs-cont":"sbcs-cont"),f.join("")+i;f.push(MT(Ex(this,E))),E+=1}r=f.join("");break;default:switch(e){case 1:return s=Ex(this,this.l),this.l++,s;case 2:return s=(t==="i"?$_e:ww)(this,this.l),this.l+=2,s;case 4:case-4:return t==="i"||!(this[this.l+3]&128)?(s=(e>0?Ug:q_e)(this,this.l),this.l+=4,s):(u=Gc(this,this.l),this.l+=4,u);case 8:case-8:if(t==="f")return e==8?u=xC(this,this.l):u=xC([this[this.l+7],this[this.l+6],this[this.l+5],this[this.l+4],this[this.l+3],this[this.l+2],this[this.l+1],this[this.l+0]],0),this.l+=8,u;e=8;case 16:r=nW(this,this.l,e);break}}return this.l+=e,r}var G_e=function(e,t,r){e[r]=t&255,e[r+1]=t>>>8&255,e[r+2]=t>>>16&255,e[r+3]=t>>>24&255},W_e=function(e,t,r){e[r]=t&255,e[r+1]=t>>8&255,e[r+2]=t>>16&255,e[r+3]=t>>24&255},H_e=function(e,t,r){e[r]=t&255,e[r+1]=t>>>8&255};function Z_e(e,t,r){var s=0,u=0;if(r==="dbcs"){for(u=0;u!=t.length;++u)H_e(this,t.charCodeAt(u),this.l+2*u);s=2*t.length}else if(r==="sbcs"){for(t=t.replace(/[^\x00-\x7F]/g,"_"),u=0;u!=t.length;++u)this[this.l+u]=t.charCodeAt(u)&255;s=t.length}else if(r==="hex"){for(;u<e;++u)this[this.l++]=parseInt(t.slice(2*u,2*u+2),16)||0;return this}else if(r==="utf16le"){var f=Math.min(this.l+e,this.length);for(u=0;u<Math.min(t.length,e);++u){var m=t.charCodeAt(u);this[this.l++]=m&255,this[this.l++]=m>>8}for(;this.l<f;)this[this.l++]=0;return this}else switch(e){case 1:s=1,this[this.l]=t&255;break;case 2:s=2,this[this.l]=t&255,t>>>=8,this[this.l+1]=t&255;break;case 3:s=3,this[this.l]=t&255,t>>>=8,this[this.l+1]=t&255,t>>>=8,this[this.l+2]=t&255;break;case 4:s=4,G_e(this,t,this.l);break;case 8:if(s=8,r==="f"){V_e(this,t,this.l);break}case 16:break;case-4:s=4,W_e(this,t,this.l);break}return this.l+=s,this}function mW(e,t){var r=nW(this,this.l,e.length>>1);if(r!==e)throw new Error(t+"Expected "+e+" saw "+r);this.l+=e.length>>1}function Vc(e,t){e.l=t,e.read_shift=Bw,e.chk=mW,e.write_shift=Z_e}function _h(e,t){e.l+=t}function vr(e){var t=T_(e);return Vc(t,0),t}function Nc(){var e=[],t=sa?256:2048,r=function(E){var I=vr(E);return Vc(I,0),I},s=r(t),u=function(){s&&(s.length>s.l&&(s=s.slice(0,s.l),s.l=s.length),s.length>0&&e.push(s),s=null)},f=function(E){return s&&E<s.length-s.l?s:(u(),s=r(Math.max(E+1,t)))},m=function(){return u(),ll(e)},i=function(E){u(),s=E,s.l==null&&(s.l=s.length),f(t)};return{next:f,push:i,end:m,_bufs:e}}function Ur(e,t,r,s){var u=+t,f;if(!isNaN(u)){s||(s=Uwe[u].p||(r||[]).length||0),f=1+(u>=128?1:0)+1,s>=128&&++f,s>=16384&&++f,s>=2097152&&++f;var m=e.next(f);u<=127?m.write_shift(1,u):(m.write_shift(1,(u&127)+128),m.write_shift(1,u>>7));for(var i=0;i!=4;++i)if(s>=128)m.write_shift(1,(s&127)+128),s>>=7;else{m.write_shift(1,s);break}s>0&&SM(r)&&e.push(r)}}function Uw(e,t,r){var s=Pc(e);if(t.s?(s.cRel&&(s.c+=t.s.c),s.rRel&&(s.r+=t.s.r)):(s.cRel&&(s.c+=t.c),s.rRel&&(s.r+=t.r)),!r||r.biff<12){for(;s.c>=256;)s.c-=256;for(;s.r>=65536;)s.r-=65536}return s}function T5(e,t,r){var s=Pc(e);return s.s=Uw(s.s,t.s,r),s.e=Uw(s.e,t.s,r),s}function Vw(e,t){if(e.cRel&&e.c<0)for(e=Pc(e);e.c<0;)e.c+=t>8?16384:256;if(e.rRel&&e.r<0)for(e=Pc(e);e.r<0;)e.r+=t>8?1048576:t>5?65536:16384;var r=ya(e);return!e.cRel&&e.cRel!=null&&(r=K_e(r)),!e.rRel&&e.rRel!=null&&(r=X_e(r)),r}function HN(e,t){return e.s.r==0&&!e.s.rRel&&e.e.r==(t.biff>=12?1048575:t.biff>=8?65536:16384)&&!e.e.rRel?(e.s.cRel?"":"$")+El(e.s.c)+":"+(e.e.cRel?"":"$")+El(e.e.c):e.s.c==0&&!e.s.cRel&&e.e.c==(t.biff>=12?16383:255)&&!e.e.cRel?(e.s.rRel?"":"$")+dl(e.s.r)+":"+(e.e.rRel?"":"$")+dl(e.e.r):Vw(e.s,t.biff)+":"+Vw(e.e,t.biff)}function TM(e){return parseInt(Y_e(e),10)-1}function dl(e){return""+(e+1)}function X_e(e){return e.replace(/([A-Z]|^)(\d+)$/,"$1$$$2")}function Y_e(e){return e.replace(/\$(\d+)$/,"$1")}function EM(e){for(var t=J_e(e),r=0,s=0;s!==t.length;++s)r=26*r+t.charCodeAt(s)-64;return r-1}function El(e){if(e<0)throw new Error("invalid column "+e);var t="";for(++e;e;e=Math.floor((e-1)/26))t=String.fromCharCode((e-1)%26+65)+t;return t}function K_e(e){return e.replace(/^([A-Z])/,"$$$1")}function J_e(e){return e.replace(/^\$([A-Z])/,"$1")}function Q_e(e){return e.replace(/(\$?[A-Z]*)(\$?\d*)/,"$1,$2").split(",")}function Zo(e){for(var t=0,r=0,s=0;s<e.length;++s){var u=e.charCodeAt(s);u>=48&&u<=57?t=10*t+(u-48):u>=65&&u<=90&&(r=26*r+(u-64))}return{c:r-1,r:t-1}}function ya(e){for(var t=e.c+1,r="";t;t=(t-1)/26|0)r=String.fromCharCode((t-1)%26+65)+r;return r+(e.r+1)}function eu(e){var t=e.indexOf(":");return t==-1?{s:Zo(e),e:Zo(e)}:{s:Zo(e.slice(0,t)),e:Zo(e.slice(t+1))}}function Io(e,t){return typeof t>"u"||typeof t=="number"?Io(e.s,e.e):(typeof e!="string"&&(e=ya(e)),typeof t!="string"&&(t=ya(t)),e==t?e:e+":"+t)}function Ba(e){var t={s:{c:0,r:0},e:{c:0,r:0}},r=0,s=0,u=0,f=e.length;for(r=0;s<f&&!((u=e.charCodeAt(s)-64)<1||u>26);++s)r=26*r+u;for(t.s.c=--r,r=0;s<f&&!((u=e.charCodeAt(s)-48)<0||u>9);++s)r=10*r+u;if(t.s.r=--r,s===f||u!=10)return t.e.c=t.s.c,t.e.r=t.s.r,t;for(++s,r=0;s!=f&&!((u=e.charCodeAt(s)-64)<1||u>26);++s)r=26*r+u;for(t.e.c=--r,r=0;s!=f&&!((u=e.charCodeAt(s)-48)<0||u>9);++s)r=10*r+u;return t.e.r=--r,t}function E5(e,t){var r=e.t=="d"&&t instanceof Date;if(e.z!=null)try{return e.w=mm(e.z,r?kc(t):t)}catch{}try{return e.w=mm((e.XF||{}).numFmtId||(r?14:0),r?kc(t):t)}catch{return""+t}}function yf(e,t,r){return e==null||e.t==null||e.t=="z"?"":e.w!==void 0?e.w:(e.t=="d"&&!e.z&&r&&r.dateNF&&(e.z=r.dateNF),e.t=="e"?i2[e.v]||e.v:t==null?E5(e,e.v):E5(e,t))}function k_(e,t){var r=t&&t.sheet?t.sheet:"Sheet1",s={};return s[r]=e,{SheetNames:[r],Sheets:s}}function gW(e,t,r){var s=r||{},u=e?Array.isArray(e):s.dense,f=e||(u?[]:{}),m=0,i=0;if(f&&s.origin!=null){if(typeof s.origin=="number")m=s.origin;else{var S=typeof s.origin=="string"?Zo(s.origin):s.origin;m=S.r,i=S.c}f["!ref"]||(f["!ref"]="A1:A1")}var E={s:{c:1e7,r:1e7},e:{c:0,r:0}};if(f["!ref"]){var I=Ba(f["!ref"]);E.s.c=I.s.c,E.s.r=I.s.r,E.e.c=Math.max(E.e.c,I.e.c),E.e.r=Math.max(E.e.r,I.e.r),m==-1&&(E.e.r=m=I.e.r+1)}for(var D=0;D!=t.length;++D)if(t[D]){if(!Array.isArray(t[D]))throw new Error("aoa_to_sheet expects an array of arrays");for(var M=0;M!=t[D].length;++M)if(!(typeof t[D][M]>"u")){var R={v:t[D][M]},H=m+D,F=i+M;if(E.s.r>H&&(E.s.r=H),E.s.c>F&&(E.s.c=F),E.e.r<H&&(E.e.r=H),E.e.c<F&&(E.e.c=F),t[D][M]&&typeof t[D][M]=="object"&&!Array.isArray(t[D][M])&&!(t[D][M]instanceof Date))R=t[D][M];else if(Array.isArray(R.v)&&(R.f=t[D][M][1],R.v=R.v[0]),R.v===null)if(R.f)R.t="n";else if(s.nullError)R.t="e",R.v=0;else if(s.sheetStubs)R.t="z";else continue;else typeof R.v=="number"?R.t="n":typeof R.v=="boolean"?R.t="b":R.v instanceof Date?(R.z=s.dateNF||po[14],s.cellDates?(R.t="d",R.w=mm(R.z,kc(R.v))):(R.t="n",R.v=kc(R.v),R.w=mm(R.z,R.v))):R.t="s";if(u)f[H]||(f[H]=[]),f[H][F]&&f[H][F].z&&(R.z=f[H][F].z),f[H][F]=R;else{var U=ya({c:F,r:H});f[U]&&f[U].z&&(R.z=f[U].z),f[U]=R}}}return E.s.c<1e7&&(f["!ref"]=Io(E)),f}function Xv(e,t){return gW(null,e,t)}function e0e(e){return e.read_shift(4,"i")}function wd(e,t){return t||(t=vr(4)),t.write_shift(4,e),t}function Cl(e){var t=e.read_shift(4);return t===0?"":e.read_shift(t,"dbcs")}function Xo(e,t){var r=!1;return t==null&&(r=!0,t=vr(4+2*e.length)),t.write_shift(4,e.length),e.length>0&&t.write_shift(0,e,"dbcs"),r?t.slice(0,t.l):t}function t0e(e){return{ich:e.read_shift(2),ifnt:e.read_shift(2)}}function r0e(e,t){return t||(t=vr(4)),t.write_shift(2,0),t.write_shift(2,0),t}function CM(e,t){var r=e.l,s=e.read_shift(1),u=Cl(e),f=[],m={t:u,h:u};if(s&1){for(var i=e.read_shift(4),S=0;S!=i;++S)f.push(t0e(e));m.r=f}else m.r=[{ich:0,ifnt:0}];return e.l=r+t,m}function n0e(e,t){var r=!1;return t==null&&(r=!0,t=vr(15+4*e.t.length)),t.write_shift(1,0),Xo(e.t,t),r?t.slice(0,t.l):t}var i0e=CM;function s0e(e,t){var r=!1;return t==null&&(r=!0,t=vr(23+4*e.t.length)),t.write_shift(1,1),Xo(e.t,t),t.write_shift(4,1),r0e({ich:0,ifnt:0},t),r?t.slice(0,t.l):t}function Mu(e){var t=e.read_shift(4),r=e.read_shift(2);return r+=e.read_shift(1)<<16,e.l++,{c:t,iStyleRef:r}}function P_(e,t){return t==null&&(t=vr(8)),t.write_shift(-4,e.c),t.write_shift(3,e.iStyleRef||e.s),t.write_shift(1,0),t}function D_(e){var t=e.read_shift(2);return t+=e.read_shift(1)<<16,e.l++,{c:-1,iStyleRef:t}}function R_(e,t){return t==null&&(t=vr(4)),t.write_shift(3,e.iStyleRef||e.s),t.write_shift(1,0),t}var a0e=Cl,_W=Xo;function AM(e){var t=e.read_shift(4);return t===0||t===4294967295?"":e.read_shift(t,"dbcs")}function vC(e,t){var r=!1;return t==null&&(r=!0,t=vr(127)),t.write_shift(4,e.length>0?e.length:4294967295),e.length>0&&t.write_shift(0,e,"dbcs"),r?t.slice(0,t.l):t}var o0e=Cl,tD=AM,jM=vC;function xW(e){var t=e.slice(e.l,e.l+4),r=t[0]&1,s=t[0]&2;e.l+=4;var u=s===0?xC([0,0,0,0,t[0]&252,t[1],t[2],t[3]],0):Ug(t,0)>>2;return r?u/100:u}function vW(e,t){t==null&&(t=vr(4));var r=0,s=0,u=e*100;if(e==(e|0)&&e>=-(1<<29)&&e<1<<29?s=1:u==(u|0)&&u>=-(1<<29)&&u<1<<29&&(s=1,r=1),s)t.write_shift(-4,((r?u:e)<<2)+(r+2));else throw new Error("unsupported RkNumber "+e)}function yW(e){var t={s:{},e:{}};return t.s.r=e.read_shift(4),t.e.r=e.read_shift(4),t.s.c=e.read_shift(4),t.e.c=e.read_shift(4),t}function l0e(e,t){return t||(t=vr(16)),t.write_shift(4,e.s.r),t.write_shift(4,e.e.r),t.write_shift(4,e.s.c),t.write_shift(4,e.e.c),t}var M_=yW,Yv=l0e;function Kv(e){if(e.length-e.l<8)throw"XLS Xnum Buffer underflow";return e.read_shift(8,"f")}function E_(e,t){return(t||vr(8)).write_shift(8,e,"f")}function c0e(e){var t={},r=e.read_shift(1),s=r>>>1,u=e.read_shift(1),f=e.read_shift(2,"i"),m=e.read_shift(1),i=e.read_shift(1),S=e.read_shift(1);switch(e.l++,s){case 0:t.auto=1;break;case 1:t.index=u;var E=x0e[u];E&&(t.rgb=O5(E));break;case 2:t.rgb=O5([m,i,S]);break;case 3:t.theme=u;break}return f!=0&&(t.tint=f>0?f/32767:f/32768),t}function yC(e,t){if(t||(t=vr(8)),!e||e.auto)return t.write_shift(4,0),t.write_shift(4,0),t;e.index!=null?(t.write_shift(1,2),t.write_shift(1,e.index)):e.theme!=null?(t.write_shift(1,6),t.write_shift(1,e.theme)):(t.write_shift(1,5),t.write_shift(1,0));var r=e.tint||0;if(r>0?r*=32767:r<0&&(r*=32768),t.write_shift(2,r),!e.rgb||e.theme!=null)t.write_shift(2,0),t.write_shift(1,0),t.write_shift(1,0);else{var s=e.rgb||"FFFFFF";typeof s=="number"&&(s=("000000"+s.toString(16)).slice(-6)),t.write_shift(1,parseInt(s.slice(0,2),16)),t.write_shift(1,parseInt(s.slice(2,4),16)),t.write_shift(1,parseInt(s.slice(4,6),16)),t.write_shift(1,255)}return t}function u0e(e){var t=e.read_shift(1);e.l++;var r={fBold:t&1,fItalic:t&2,fUnderline:t&4,fStrikeout:t&8,fOutline:t&16,fShadow:t&32,fCondense:t&64,fExtend:t&128};return r}function d0e(e,t){t||(t=vr(2));var r=(e.italic?2:0)|(e.strike?8:0)|(e.outline?16:0)|(e.shadow?32:0)|(e.condense?64:0)|(e.extend?128:0);return t.write_shift(1,r),t.write_shift(1,0),t}var wW=2,zc=3,zT=11,wC=19,BT=64,h0e=65,f0e=71,p0e=4108,m0e=4126,al=80,C5={1:{n:"CodePage",t:wW},2:{n:"Category",t:al},3:{n:"PresentationFormat",t:al},4:{n:"ByteCount",t:zc},5:{n:"LineCount",t:zc},6:{n:"ParagraphCount",t:zc},7:{n:"SlideCount",t:zc},8:{n:"NoteCount",t:zc},9:{n:"HiddenCount",t:zc},10:{n:"MultimediaClipCount",t:zc},11:{n:"ScaleCrop",t:zT},12:{n:"HeadingPairs",t:p0e},13:{n:"TitlesOfParts",t:m0e},14:{n:"Manager",t:al},15:{n:"Company",t:al},16:{n:"LinksUpToDate",t:zT},17:{n:"CharacterCount",t:zc},19:{n:"SharedDoc",t:zT},22:{n:"HyperlinksChanged",t:zT},23:{n:"AppVersion",t:zc,p:"version"},24:{n:"DigSig",t:h0e},26:{n:"ContentType",t:al},27:{n:"ContentStatus",t:al},28:{n:"Language",t:al},29:{n:"Version",t:al},255:{},2147483648:{n:"Locale",t:wC},2147483651:{n:"Behavior",t:wC},1919054434:{}},A5={1:{n:"CodePage",t:wW},2:{n:"Title",t:al},3:{n:"Subject",t:al},4:{n:"Author",t:al},5:{n:"Keywords",t:al},6:{n:"Comments",t:al},7:{n:"Template",t:al},8:{n:"LastAuthor",t:al},9:{n:"RevNumber",t:al},10:{n:"EditTime",t:BT},11:{n:"LastPrinted",t:BT},12:{n:"CreatedDate",t:BT},13:{n:"ModifiedDate",t:BT},14:{n:"PageCount",t:zc},15:{n:"WordCount",t:zc},16:{n:"CharCount",t:zc},17:{n:"Thumbnail",t:f0e},18:{n:"Application",t:al},19:{n:"DocSecurity",t:zc},255:{},2147483648:{n:"Locale",t:wC},2147483651:{n:"Behavior",t:wC},1919054434:{}};function g0e(e){return e.map(function(t){return[t>>16&255,t>>8&255,t&255]})}var _0e=g0e([0,16777215,16711680,65280,255,16776960,16711935,65535,0,16777215,16711680,65280,255,16776960,16711935,65535,8388608,32768,128,8421376,8388736,32896,12632256,8421504,10066431,10040166,16777164,13434879,6684774,16744576,26316,13421823,128,16711935,16776960,65535,8388736,8388608,32896,255,52479,13434879,13434828,16777113,10079487,16751052,13408767,16764057,3368703,3394764,10079232,16763904,16750848,16737792,6710937,9868950,13158,3381606,13056,3355392,10040064,10040166,3355545,3355443,16777215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),x0e=Pc(_0e),i2={0:"#NULL!",7:"#DIV/0!",15:"#VALUE!",23:"#REF!",29:"#NAME?",36:"#NUM!",42:"#N/A",43:"#GETTING_DATA",255:"#WTF?"},v0e={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":"workbooks","application/vnd.ms-excel.sheet.macroEnabled.main+xml":"workbooks","application/vnd.ms-excel.sheet.binary.macroEnabled.main":"workbooks","application/vnd.ms-excel.addin.macroEnabled.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":"sheets","application/vnd.ms-excel.worksheet":"sheets","application/vnd.ms-excel.binIndexWs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":"charts","application/vnd.ms-excel.chartsheet":"charts","application/vnd.ms-excel.macrosheet+xml":"macros","application/vnd.ms-excel.macrosheet":"macros","application/vnd.ms-excel.intlmacrosheet":"TODO","application/vnd.ms-excel.binIndexMs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":"dialogs","application/vnd.ms-excel.dialogsheet":"dialogs","application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml":"strs","application/vnd.ms-excel.sharedStrings":"strs","application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":"styles","application/vnd.ms-excel.styles":"styles","application/vnd.openxmlformats-package.core-properties+xml":"coreprops","application/vnd.openxmlformats-officedocument.custom-properties+xml":"custprops","application/vnd.openxmlformats-officedocument.extended-properties+xml":"extprops","application/vnd.openxmlformats-officedocument.customXmlProperties+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.customProperty":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":"comments","application/vnd.ms-excel.comments":"comments","application/vnd.ms-excel.threadedcomments+xml":"threadedcomments","application/vnd.ms-excel.person+xml":"people","application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml":"metadata","application/vnd.ms-excel.sheetMetadata":"metadata","application/vnd.ms-excel.pivotTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotTable+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chart+xml":"TODO","application/vnd.ms-office.chartcolorstyle+xml":"TODO","application/vnd.ms-office.chartstyle+xml":"TODO","application/vnd.ms-office.chartex+xml":"TODO","application/vnd.ms-excel.calcChain":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.calcChain+xml":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings":"TODO","application/vnd.ms-office.activeX":"TODO","application/vnd.ms-office.activeX+xml":"TODO","application/vnd.ms-excel.attachedToolbars":"TODO","application/vnd.ms-excel.connections":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":"TODO","application/vnd.ms-excel.externalLink":"links","application/vnd.openxmlformats-officedocument.spreadsheetml.externalLink+xml":"links","application/vnd.ms-excel.pivotCacheDefinition":"TODO","application/vnd.ms-excel.pivotCacheRecords":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheDefinition+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheRecords+xml":"TODO","application/vnd.ms-excel.queryTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.queryTable+xml":"TODO","application/vnd.ms-excel.userNames":"TODO","application/vnd.ms-excel.revisionHeaders":"TODO","application/vnd.ms-excel.revisionLog":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionHeaders+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionLog+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.userNames+xml":"TODO","application/vnd.ms-excel.tableSingleCells":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.tableSingleCells+xml":"TODO","application/vnd.ms-excel.slicer":"TODO","application/vnd.ms-excel.slicerCache":"TODO","application/vnd.ms-excel.slicer+xml":"TODO","application/vnd.ms-excel.slicerCache+xml":"TODO","application/vnd.ms-excel.wsSortMap":"TODO","application/vnd.ms-excel.table":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":"TODO","application/vnd.openxmlformats-officedocument.theme+xml":"themes","application/vnd.openxmlformats-officedocument.themeOverride+xml":"TODO","application/vnd.ms-excel.Timeline+xml":"TODO","application/vnd.ms-excel.TimelineCache+xml":"TODO","application/vnd.ms-office.vbaProject":"vba","application/vnd.ms-office.vbaProjectSignature":"TODO","application/vnd.ms-office.volatileDependencies":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.volatileDependencies+xml":"TODO","application/vnd.ms-excel.controlproperties+xml":"TODO","application/vnd.openxmlformats-officedocument.model+data":"TODO","application/vnd.ms-excel.Survey+xml":"TODO","application/vnd.openxmlformats-officedocument.drawing+xml":"drawings","application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml":"TODO","application/vnd.openxmlformats-officedocument.vmlDrawing":"TODO","application/vnd.openxmlformats-package.relationships+xml":"rels","application/vnd.openxmlformats-officedocument.oleObject":"TODO","image/png":"TODO",sheet:"js"},UT={workbooks:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.main+xml",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.main",xlam:"application/vnd.ms-excel.addin.macroEnabled.main+xml",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml"},strs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml",xlsb:"application/vnd.ms-excel.sharedStrings"},comments:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml",xlsb:"application/vnd.ms-excel.comments"},sheets:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml",xlsb:"application/vnd.ms-excel.worksheet"},charts:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml",xlsb:"application/vnd.ms-excel.chartsheet"},dialogs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml",xlsb:"application/vnd.ms-excel.dialogsheet"},macros:{xlsx:"application/vnd.ms-excel.macrosheet+xml",xlsb:"application/vnd.ms-excel.macrosheet"},metadata:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml",xlsb:"application/vnd.ms-excel.sheetMetadata"},styles:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml",xlsb:"application/vnd.ms-excel.styles"}};function bW(){return{workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""}}function SW(e,t){var r=I_e(v0e),s=[],u;s[s.length]=No,s[s.length]=pn("Types",null,{xmlns:Ho.CT,"xmlns:xsd":Ho.xsd,"xmlns:xsi":Ho.xsi}),s=s.concat([["xml","application/xml"],["bin","application/vnd.ms-excel.sheet.binary.macroEnabled.main"],["vml","application/vnd.openxmlformats-officedocument.vmlDrawing"],["data","application/vnd.openxmlformats-officedocument.model+data"],["bmp","image/bmp"],["png","image/png"],["gif","image/gif"],["emf","image/x-emf"],["wmf","image/x-wmf"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["tif","image/tiff"],["tiff","image/tiff"],["pdf","application/pdf"],["rels","application/vnd.openxmlformats-package.relationships+xml"]].map(function(S){return pn("Default",null,{Extension:S[0],ContentType:S[1]})}));var f=function(S){e[S]&&e[S].length>0&&(u=e[S][0],s[s.length]=pn("Override",null,{PartName:(u[0]=="/"?"":"/")+u,ContentType:UT[S][t.bookType]||UT[S].xlsx}))},m=function(S){(e[S]||[]).forEach(function(E){s[s.length]=pn("Override",null,{PartName:(E[0]=="/"?"":"/")+E,ContentType:UT[S][t.bookType]||UT[S].xlsx})})},i=function(S){(e[S]||[]).forEach(function(E){s[s.length]=pn("Override",null,{PartName:(E[0]=="/"?"":"/")+E,ContentType:r[S][0]})})};return f("workbooks"),m("sheets"),m("charts"),i("themes"),["strs","styles"].forEach(f),["coreprops","extprops","custprops"].forEach(i),i("vba"),i("comments"),i("threadedcomments"),i("drawings"),m("metadata"),i("people"),s.length>2&&(s[s.length]="</Types>",s[1]=s[1].replace("/>",">")),s.join("")}var Qs={WB:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",SHEET:"http://sheetjs.openxmlformats.org/officeDocument/2006/relationships/officeDocument",HLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",VML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",XPATH:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLinkPath",XMISS:"http://schemas.microsoft.com/office/2006/relationships/xlExternalLinkPath/xlPathMissing",XLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLink",CXML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXml",CXMLP:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXmlProps",CMNT:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments",CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties",SST:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",STY:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",THEME:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",CHART:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chart",CHARTEX:"http://schemas.microsoft.com/office/2014/relationships/chartEx",CS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chartsheet",WS:["http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","http://purl.oclc.org/ooxml/officeDocument/relationships/worksheet"],DS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/dialogsheet",MS:"http://schemas.microsoft.com/office/2006/relationships/xlMacrosheet",IMG:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",DRAW:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",XLMETA:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sheetMetadata",TCMNT:"http://schemas.microsoft.com/office/2017/10/relationships/threadedComment",PEOPLE:"http://schemas.microsoft.com/office/2017/10/relationships/person",VBA:"http://schemas.microsoft.com/office/2006/relationships/vbaProject"};function TW(e){var t=e.lastIndexOf("/");return e.slice(0,t+1)+"_rels/"+e.slice(t+1)+".rels"}function Qx(e){var t=[No,pn("Relationships",null,{xmlns:Ho.RELS})];return pl(e["!id"]).forEach(function(r){t[t.length]=pn("Relationship",null,e["!id"][r])}),t.length>2&&(t[t.length]="</Relationships>",t[1]=t[1].replace("/>",">")),t.join("")}function _a(e,t,r,s,u,f){if(u||(u={}),e["!id"]||(e["!id"]={}),e["!idx"]||(e["!idx"]=1),t<0)for(t=e["!idx"];e["!id"]["rId"+t];++t);if(e["!idx"]=t+1,u.Id="rId"+t,u.Type=s,u.Target=r,[Qs.HLINK,Qs.XPATH,Qs.XMISS].indexOf(u.Type)>-1&&(u.TargetMode="External"),e["!id"][u.Id])throw new Error("Cannot rewrite rId "+t);return e["!id"][u.Id]=u,e[("/"+u.Target).replace("//","/")]=u,t}function y0e(e){var t=[No];t.push(`<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2">
`),t.push(`  <manifest:file-entry manifest:full-path="/" manifest:version="1.2" manifest:media-type="application/vnd.oasis.opendocument.spreadsheet"/>
`);for(var r=0;r<e.length;++r)t.push('  <manifest:file-entry manifest:full-path="'+e[r][0]+'" manifest:media-type="'+e[r][1]+`"/>
`);return t.push("</manifest:manifest>"),t.join("")}function j5(e,t,r){return['  <rdf:Description rdf:about="'+e+`">
`,'    <rdf:type rdf:resource="http://docs.oasis-open.org/ns/office/1.2/meta/'+(r||"odf")+"#"+t+`"/>
`,`  </rdf:Description>
`].join("")}function w0e(e,t){return['  <rdf:Description rdf:about="'+e+`">
`,'    <ns0:hasPart xmlns:ns0="http://docs.oasis-open.org/ns/office/1.2/meta/pkg#" rdf:resource="'+t+`"/>
`,`  </rdf:Description>
`].join("")}function b0e(e){var t=[No];t.push(`<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
`);for(var r=0;r!=e.length;++r)t.push(j5(e[r][0],e[r][1])),t.push(w0e("",e[r][0]));return t.push(j5("","Document","pkg")),t.push("</rdf:RDF>"),t.join("")}function EW(){return'<office:document-meta xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:xlink="http://www.w3.org/1999/xlink" office:version="1.2"><office:meta><meta:generator>SheetJS '+fC.version+"</meta:generator></office:meta></office:document-meta>"}var a_=[["cp:category","Category"],["cp:contentStatus","ContentStatus"],["cp:keywords","Keywords"],["cp:lastModifiedBy","LastAuthor"],["cp:lastPrinted","LastPrinted"],["cp:revision","RevNumber"],["cp:version","Version"],["dc:creator","Author"],["dc:description","Comments"],["dc:identifier","Identifier"],["dc:language","Language"],["dc:subject","Subject"],["dc:title","Title"],["dcterms:created","CreatedDate","date"],["dcterms:modified","ModifiedDate","date"]];function ZN(e,t,r,s,u){u[e]!=null||t==null||t===""||(u[e]=t,t=xa(t),s[s.length]=r?pn(e,t,r):cl(e,t))}function CW(e,t){var r=t||{},s=[No,pn("cp:coreProperties",null,{"xmlns:cp":Ho.CORE_PROPS,"xmlns:dc":Ho.dc,"xmlns:dcterms":Ho.dcterms,"xmlns:dcmitype":Ho.dcmitype,"xmlns:xsi":Ho.xsi})],u={};if(!e&&!r.Props)return s.join("");e&&(e.CreatedDate!=null&&ZN("dcterms:created",typeof e.CreatedDate=="string"?e.CreatedDate:eD(e.CreatedDate,r.WTF),{"xsi:type":"dcterms:W3CDTF"},s,u),e.ModifiedDate!=null&&ZN("dcterms:modified",typeof e.ModifiedDate=="string"?e.ModifiedDate:eD(e.ModifiedDate,r.WTF),{"xsi:type":"dcterms:W3CDTF"},s,u));for(var f=0;f!=a_.length;++f){var m=a_[f],i=r.Props&&r.Props[m[1]]!=null?r.Props[m[1]]:e?e[m[1]]:null;i===!0?i="1":i===!1?i="0":typeof i=="number"&&(i=String(i)),i!=null&&ZN(m[0],i,null,s,u)}return s.length>2&&(s[s.length]="</cp:coreProperties>",s[1]=s[1].replace("/>",">")),s.join("")}var ev=[["Application","Application","string"],["AppVersion","AppVersion","string"],["Company","Company","string"],["DocSecurity","DocSecurity","string"],["Manager","Manager","string"],["HyperlinksChanged","HyperlinksChanged","bool"],["SharedDoc","SharedDoc","bool"],["LinksUpToDate","LinksUpToDate","bool"],["ScaleCrop","ScaleCrop","bool"],["HeadingPairs","HeadingPairs","raw"],["TitlesOfParts","TitlesOfParts","raw"]],AW=["Worksheets","SheetNames","NamedRanges","DefinedNames","Chartsheets","ChartNames"];function jW(e){var t=[],r=pn;return e||(e={}),e.Application="SheetJS",t[t.length]=No,t[t.length]=pn("Properties",null,{xmlns:Ho.EXT_PROPS,"xmlns:vt":Ho.vt}),ev.forEach(function(s){if(e[s[1]]!==void 0){var u;switch(s[2]){case"string":u=xa(String(e[s[1]]));break;case"bool":u=e[s[1]]?"true":"false";break}u!==void 0&&(t[t.length]=r(s[0],u))}}),t[t.length]=r("HeadingPairs",r("vt:vector",r("vt:variant","<vt:lpstr>Worksheets</vt:lpstr>")+r("vt:variant",r("vt:i4",String(e.Worksheets))),{size:2,baseType:"variant"})),t[t.length]=r("TitlesOfParts",r("vt:vector",e.SheetNames.map(function(s){return"<vt:lpstr>"+xa(s)+"</vt:lpstr>"}).join(""),{size:e.Worksheets,baseType:"lpstr"})),t.length>2&&(t[t.length]="</Properties>",t[1]=t[1].replace("/>",">")),t.join("")}function IW(e){var t=[No,pn("Properties",null,{xmlns:Ho.CUST_PROPS,"xmlns:vt":Ho.vt})];if(!e)return t.join("");var r=1;return pl(e).forEach(function(u){++r,t[t.length]=pn("property",B_e(e[u]),{fmtid:"{D5CDD505-2E9C-101B-9397-08002B2CF9AE}",pid:r,name:xa(u)})}),t.length>2&&(t[t.length]="</Properties>",t[1]=t[1].replace("/>",">")),t.join("")}var I5={Title:"Title",Subject:"Subject",Author:"Author",Keywords:"Keywords",Comments:"Description",LastAuthor:"LastAuthor",RevNumber:"Revision",Application:"AppName",LastPrinted:"LastPrinted",CreatedDate:"Created",ModifiedDate:"LastSaved",Category:"Category",Manager:"Manager",Company:"Company",AppVersion:"Version",ContentStatus:"ContentStatus",Identifier:"Identifier",Language:"Language"};function S0e(e,t){var r=[];return pl(I5).map(function(s){for(var u=0;u<a_.length;++u)if(a_[u][1]==s)return a_[u];for(u=0;u<ev.length;++u)if(ev[u][1]==s)return ev[u];throw s}).forEach(function(s){if(e[s[1]]!=null){var u=t&&t.Props&&t.Props[s[1]]!=null?t.Props[s[1]]:e[s[1]];switch(s[2]){case"date":u=new Date(u).toISOString().replace(/\.\d*Z/,"Z");break}typeof u=="number"?u=String(u):u===!0||u===!1?u=u?"1":"0":u instanceof Date&&(u=new Date(u).toISOString().replace(/\.\d*Z/,"")),r.push(cl(I5[s[1]]||s[1],u))}}),pn("DocumentProperties",r.join(""),{xmlns:qc.o})}function T0e(e,t){var r=["Worksheets","SheetNames"],s="CustomDocumentProperties",u=[];return e&&pl(e).forEach(function(f){if(Object.prototype.hasOwnProperty.call(e,f)){for(var m=0;m<a_.length;++m)if(f==a_[m][1])return;for(m=0;m<ev.length;++m)if(f==ev[m][1])return;for(m=0;m<r.length;++m)if(f==r[m])return;var i=e[f],S="string";typeof i=="number"?(S="float",i=String(i)):i===!0||i===!1?(S="boolean",i=i?"1":"0"):i=String(i),u.push(pn(g5(f),i,{"dt:dt":S}))}}),t&&pl(t).forEach(function(f){if(Object.prototype.hasOwnProperty.call(t,f)&&!(e&&Object.prototype.hasOwnProperty.call(e,f))){var m=t[f],i="string";typeof m=="number"?(i="float",m=String(m)):m===!0||m===!1?(i="boolean",m=m?"1":"0"):m instanceof Date?(i="dateTime.tz",m=m.toISOString()):m=String(m),u.push(pn(g5(f),m,{"dt:dt":i}))}}),"<"+s+' xmlns="'+qc.o+'">'+u.join("")+"</"+s+">"}function E0e(e){var t=typeof e=="string"?new Date(Date.parse(e)):e,r=t.getTime()/1e3+11644473600,s=r%Math.pow(2,32),u=(r-s)/Math.pow(2,32);s*=1e7,u*=1e7;var f=s/Math.pow(2,32)|0;f>0&&(s=s%Math.pow(2,32),u+=f);var m=vr(8);return m.write_shift(4,s),m.write_shift(4,u),m}function N5(e,t){var r=vr(4),s=vr(4);switch(r.write_shift(4,e==80?31:e),e){case 3:s.write_shift(-4,t);break;case 5:s=vr(8),s.write_shift(8,t,"f");break;case 11:s.write_shift(4,t?1:0);break;case 64:s=E0e(t);break;case 31:case 80:for(s=vr(4+2*(t.length+1)+(t.length%2?0:2)),s.write_shift(4,t.length+1),s.write_shift(0,t,"dbcs");s.l!=s.length;)s.write_shift(1,0);break;default:throw new Error("TypedPropertyValue unrecognized type "+e+" "+t)}return ll([r,s])}var NW=["CodePage","Thumbnail","_PID_LINKBASE","_PID_HLINKS","SystemIdentifier","FMTID"];function C0e(e){switch(typeof e){case"boolean":return 11;case"number":return(e|0)==e?3:5;case"string":return 31;case"object":if(e instanceof Date)return 64;break}return-1}function k5(e,t,r){var s=vr(8),u=[],f=[],m=8,i=0,S=vr(8),E=vr(8);if(S.write_shift(4,2),S.write_shift(4,1200),E.write_shift(4,1),f.push(S),u.push(E),m+=8+S.length,!t){E=vr(8),E.write_shift(4,0),u.unshift(E);var I=[vr(4)];for(I[0].write_shift(4,e.length),i=0;i<e.length;++i){var D=e[i][0];for(S=vr(8+2*(D.length+1)+(D.length%2?0:2)),S.write_shift(4,i+2),S.write_shift(4,D.length+1),S.write_shift(0,D,"dbcs");S.l!=S.length;)S.write_shift(1,0);I.push(S)}S=ll(I),f.unshift(S),m+=8+S.length}for(i=0;i<e.length;++i)if(!(t&&!t[e[i][0]])&&!(NW.indexOf(e[i][0])>-1||AW.indexOf(e[i][0])>-1)&&e[i][1]!=null){var M=e[i][1],R=0;if(t){R=+t[e[i][0]];var H=r[R];if(H.p=="version"&&typeof M=="string"){var F=M.split(".");M=(+F[0]<<16)+(+F[1]||0)}S=N5(H.t,M)}else{var U=C0e(M);U==-1&&(U=31,M=String(M)),S=N5(U,M)}f.push(S),E=vr(8),E.write_shift(4,t?R:2+i),u.push(E),m+=8+S.length}var Y=8*(f.length+1);for(i=0;i<f.length;++i)u[i].write_shift(4,Y),Y+=f[i].length;return s.write_shift(4,m),s.write_shift(4,f.length),ll([s].concat(u).concat(f))}function P5(e,t,r,s,u,f){var m=vr(u?68:48),i=[m];m.write_shift(2,65534),m.write_shift(2,0),m.write_shift(4,842412599),m.write_shift(16,Ta.utils.consts.HEADER_CLSID,"hex"),m.write_shift(4,u?2:1),m.write_shift(16,t,"hex"),m.write_shift(4,u?68:48);var S=k5(e,r,s);if(i.push(S),u){var E=k5(u,null,null);m.write_shift(16,f,"hex"),m.write_shift(4,68+S.length),i.push(E)}return ll(i)}function A0e(e,t){t||(t=vr(e));for(var r=0;r<e;++r)t.write_shift(1,0);return t}function j0e(e,t){return e.read_shift(t)===1}function Yl(e,t){return t||(t=vr(2)),t.write_shift(2,+!!e),t}function kW(e){return e.read_shift(2,"u")}function _u(e,t){return t||(t=vr(2)),t.write_shift(2,e),t}function PW(e,t,r){return r||(r=vr(2)),r.write_shift(1,t=="e"?+e:+!!e),r.write_shift(1,t=="e"?1:0),r}function DW(e,t,r){var s=e.read_shift(r&&r.biff>=12?2:1),u="sbcs-cont";if(r&&r.biff>=8,!r||r.biff==8){var f=e.read_shift(1);f&&(u="dbcs-cont")}else r.biff==12&&(u="wstr");r.biff>=2&&r.biff<=5&&(u="cpstr");var m=s?e.read_shift(s,u):"";return m}function I0e(e){var t=e.t||"",r=vr(3);r.write_shift(2,t.length),r.write_shift(1,1);var s=vr(2*t.length);s.write_shift(2*t.length,t,"utf16le");var u=[r,s];return ll(u)}function N0e(e,t,r){var s;if(r){if(r.biff>=2&&r.biff<=5)return e.read_shift(t,"cpstr");if(r.biff>=12)return e.read_shift(t,"dbcs-cont")}var u=e.read_shift(1);return u===0?s=e.read_shift(t,"sbcs-cont"):s=e.read_shift(t,"dbcs-cont"),s}function k0e(e,t,r){var s=e.read_shift(r&&r.biff==2?1:2);return s===0?(e.l++,""):N0e(e,s,r)}function P0e(e,t,r){if(r.biff>5)return k0e(e,t,r);var s=e.read_shift(1);return s===0?(e.l++,""):e.read_shift(s,r.biff<=4||!e.lens?"cpstr":"sbcs-cont")}function RW(e,t,r){return r||(r=vr(3+2*e.length)),r.write_shift(2,e.length),r.write_shift(1,1),r.write_shift(31,e,"utf16le"),r}function D5(e,t){t||(t=vr(6+e.length*2)),t.write_shift(4,1+e.length);for(var r=0;r<e.length;++r)t.write_shift(2,e.charCodeAt(r));return t.write_shift(2,0),t}function D0e(e){var t=vr(512),r=0,s=e.Target;s.slice(0,7)=="file://"&&(s=s.slice(7));var u=s.indexOf("#"),f=u>-1?31:23;switch(s.charAt(0)){case"#":f=28;break;case".":f&=-3;break}t.write_shift(4,2),t.write_shift(4,f);var m=[8,6815827,6619237,4849780,83];for(r=0;r<m.length;++r)t.write_shift(4,m[r]);if(f==28)s=s.slice(1),D5(s,t);else if(f&2){for(m="e0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),r=0;r<m.length;++r)t.write_shift(1,parseInt(m[r],16));var i=u>-1?s.slice(0,u):s;for(t.write_shift(4,2*(i.length+1)),r=0;r<i.length;++r)t.write_shift(2,i.charCodeAt(r));t.write_shift(2,0),f&8&&D5(u>-1?s.slice(u+1):"",t)}else{for(m="03 03 00 00 00 00 00 00 c0 00 00 00 00 00 00 46".split(" "),r=0;r<m.length;++r)t.write_shift(1,parseInt(m[r],16));for(var S=0;s.slice(S*3,S*3+3)=="../"||s.slice(S*3,S*3+3)=="..\\";)++S;for(t.write_shift(2,S),t.write_shift(4,s.length-3*S+1),r=0;r<s.length-3*S;++r)t.write_shift(1,s.charCodeAt(r+3*S)&255);for(t.write_shift(1,0),t.write_shift(2,65535),t.write_shift(2,57005),r=0;r<6;++r)t.write_shift(4,0)}return t.slice(0,t.l)}function C_(e,t,r,s){return s||(s=vr(6)),s.write_shift(2,e),s.write_shift(2,t),s.write_shift(2,r||0),s}function R0e(e,t,r){var s=r.biff>8?4:2,u=e.read_shift(s),f=e.read_shift(s,"i"),m=e.read_shift(s,"i");return[u,f,m]}function M0e(e){var t=e.read_shift(2),r=e.read_shift(2),s=e.read_shift(2),u=e.read_shift(2);return{s:{c:s,r:t},e:{c:u,r}}}function MW(e,t){return t||(t=vr(8)),t.write_shift(2,e.s.r),t.write_shift(2,e.e.r),t.write_shift(2,e.s.c),t.write_shift(2,e.e.c),t}function IM(e,t,r){var s=1536,u=16;switch(r.bookType){case"biff8":break;case"biff5":s=1280,u=8;break;case"biff4":s=4,u=6;break;case"biff3":s=3,u=6;break;case"biff2":s=2,u=4;break;case"xla":break;default:throw new Error("unsupported BIFF version")}var f=vr(u);return f.write_shift(2,s),f.write_shift(2,t),u>4&&f.write_shift(2,29282),u>6&&f.write_shift(2,1997),u>8&&(f.write_shift(2,49161),f.write_shift(2,1),f.write_shift(2,1798),f.write_shift(2,0)),f}function O0e(e,t){var r=!t||t.biff==8,s=vr(r?112:54);for(s.write_shift(t.biff==8?2:1,7),r&&s.write_shift(1,0),s.write_shift(4,859007059),s.write_shift(4,5458548|(r?0:536870912));s.l<s.length;)s.write_shift(1,r?0:32);return s}function F0e(e,t){var r=!t||t.biff>=8?2:1,s=vr(8+r*e.name.length);s.write_shift(4,e.pos),s.write_shift(1,e.hs||0),s.write_shift(1,e.dt),s.write_shift(1,e.name.length),t.biff>=8&&s.write_shift(1,1),s.write_shift(r*e.name.length,e.name,t.biff<8?"sbcs":"utf16le");var u=s.slice(0,s.l);return u.l=s.l,u}function L0e(e,t){var r=vr(8);r.write_shift(4,e.Count),r.write_shift(4,e.Unique);for(var s=[],u=0;u<e.length;++u)s[u]=I0e(e[u]);var f=ll([r].concat(s));return f.parts=[r.length].concat(s.map(function(m){return m.length})),f}function z0e(){var e=vr(18);return e.write_shift(2,0),e.write_shift(2,0),e.write_shift(2,29280),e.write_shift(2,17600),e.write_shift(2,56),e.write_shift(2,0),e.write_shift(2,0),e.write_shift(2,1),e.write_shift(2,500),e}function B0e(e){var t=vr(18),r=1718;return e&&e.RTL&&(r|=64),t.write_shift(2,r),t.write_shift(4,0),t.write_shift(4,64),t.write_shift(4,0),t.write_shift(4,0),t}function U0e(e,t){var r=e.name||"Arial",s=t&&t.biff==5,u=s?15+r.length:16+2*r.length,f=vr(u);return f.write_shift(2,(e.sz||12)*20),f.write_shift(4,0),f.write_shift(2,400),f.write_shift(4,0),f.write_shift(2,0),f.write_shift(1,r.length),s||f.write_shift(1,1),f.write_shift((s?1:2)*r.length,r,s?"sbcs":"utf16le"),f}function V0e(e,t,r,s){var u=vr(10);return C_(e,t,s,u),u.write_shift(4,r),u}function $0e(e,t,r,s,u){var f=!u||u.biff==8,m=vr(8+ +f+(1+f)*r.length);return C_(e,t,s,m),m.write_shift(2,r.length),f&&m.write_shift(1,1),m.write_shift((1+f)*r.length,r,f?"utf16le":"sbcs"),m}function q0e(e,t,r,s){var u=r&&r.biff==5;s||(s=vr(u?3+t.length:5+2*t.length)),s.write_shift(2,e),s.write_shift(u?1:2,t.length),u||s.write_shift(1,1),s.write_shift((u?1:2)*t.length,t,u?"sbcs":"utf16le");var f=s.length>s.l?s.slice(0,s.l):s;return f.l==null&&(f.l=f.length),f}function G0e(e,t){var r=t.biff==8||!t.biff?4:2,s=vr(2*r+6);return s.write_shift(r,e.s.r),s.write_shift(r,e.e.r+1),s.write_shift(2,e.s.c),s.write_shift(2,e.e.c+1),s.write_shift(2,0),s}function R5(e,t,r,s){var u=r&&r.biff==5;s||(s=vr(u?16:20)),s.write_shift(2,0),e.style?(s.write_shift(2,e.numFmtId||0),s.write_shift(2,65524)):(s.write_shift(2,e.numFmtId||0),s.write_shift(2,t<<4));var f=0;return e.numFmtId>0&&u&&(f|=1024),s.write_shift(4,f),s.write_shift(4,0),u||s.write_shift(4,0),s.write_shift(2,0),s}function W0e(e){var t=vr(8);return t.write_shift(4,0),t.write_shift(2,0),t.write_shift(2,0),t}function H0e(e,t,r,s,u,f){var m=vr(8);return C_(e,t,s,m),PW(r,f,m),m}function Z0e(e,t,r,s){var u=vr(14);return C_(e,t,s,u),E_(r,u),u}function X0e(e,t,r){if(r.biff<8)return Y0e(e,t,r);for(var s=[],u=e.l+t,f=e.read_shift(r.biff>8?4:2);f--!==0;)s.push(R0e(e,r.biff>8?12:6,r));if(e.l!=u)throw new Error("Bad ExternSheet: "+e.l+" != "+u);return s}function Y0e(e,t,r){e[e.l+1]==3&&e[e.l]++;var s=DW(e,t,r);return s.charCodeAt(0)==3?s.slice(1):s}function K0e(e){var t=vr(2+e.length*8);t.write_shift(2,e.length);for(var r=0;r<e.length;++r)MW(e[r],t);return t}function J0e(e){var t=vr(24),r=Zo(e[0]);t.write_shift(2,r.r),t.write_shift(2,r.r),t.write_shift(2,r.c),t.write_shift(2,r.c);for(var s="d0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),u=0;u<16;++u)t.write_shift(1,parseInt(s[u],16));return ll([t,D0e(e[1])])}function Q0e(e){var t=e[1].Tooltip,r=vr(10+2*(t.length+1));r.write_shift(2,2048);var s=Zo(e[0]);r.write_shift(2,s.r),r.write_shift(2,s.r),r.write_shift(2,s.c),r.write_shift(2,s.c);for(var u=0;u<t.length;++u)r.write_shift(2,t.charCodeAt(u));return r.write_shift(2,0),r}function exe(e){return e||(e=vr(4)),e.write_shift(2,1),e.write_shift(2,1),e}function txe(e,t,r){if(!r.cellStyles)return _h(e,t);var s=r&&r.biff>=12?4:2,u=e.read_shift(s),f=e.read_shift(s),m=e.read_shift(s),i=e.read_shift(s),S=e.read_shift(2);s==2&&(e.l+=2);var E={s:u,e:f,w:m,ixfe:i,flags:S};return(r.biff>=5||!r.biff)&&(E.level=S>>8&7),E}function rxe(e,t){var r=vr(12);r.write_shift(2,t),r.write_shift(2,t),r.write_shift(2,e.width*256),r.write_shift(2,0);var s=0;return e.hidden&&(s|=1),r.write_shift(1,s),s=e.level||0,r.write_shift(1,s),r.write_shift(2,0),r}function nxe(e){for(var t=vr(2*e),r=0;r<e;++r)t.write_shift(2,r+1);return t}function ixe(e,t,r){var s=vr(15);return a2(s,e,t),s.write_shift(8,r,"f"),s}function sxe(e,t,r){var s=vr(9);return a2(s,e,t),s.write_shift(2,r),s}var axe=function(){var e={1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127,8:865,9:437,10:850,11:437,13:437,14:850,15:437,16:850,17:437,18:850,19:932,20:850,21:437,22:850,23:865,24:437,25:437,26:850,27:437,28:863,29:850,31:852,34:852,35:852,36:860,37:850,38:866,55:850,64:852,77:936,78:949,79:950,80:874,87:1252,88:1252,89:1252,108:863,134:737,135:852,136:857,204:1257,255:16969},t=xM({1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127});function r(i,S){var E=[],I=T_(1);switch(S.type){case"base64":I=md(vf(i));break;case"binary":I=md(i);break;case"buffer":case"array":I=i;break}Vc(I,0);var D=I.read_shift(1),M=!!(D&136),R=!1,H=!1;switch(D){case 2:break;case 3:break;case 48:R=!0,M=!0;break;case 49:R=!0,M=!0;break;case 131:break;case 139:break;case 140:H=!0;break;case 245:break;default:throw new Error("DBF Unsupported Version: "+D.toString(16))}var F=0,U=521;D==2&&(F=I.read_shift(2)),I.l+=3,D!=2&&(F=I.read_shift(4)),F>1048576&&(F=1e6),D!=2&&(U=I.read_shift(2));var Y=I.read_shift(2),z=S.codepage||1252;D!=2&&(I.l+=16,I.read_shift(1),I[I.l]!==0&&(z=e[I[I.l]]),I.l+=1,I.l+=2),H&&(I.l+=36);for(var J=[],ne={},me=Math.min(I.length,D==2?521:U-10-(R?264:0)),le=H?32:11;I.l<me&&I[I.l]!=13;)switch(ne={},ne.name=Bg.utils.decode(z,I.slice(I.l,I.l+le)).replace(/[\u0000\r\n].*$/g,""),I.l+=le,ne.type=String.fromCharCode(I.read_shift(1)),D!=2&&!H&&(ne.offset=I.read_shift(4)),ne.len=I.read_shift(1),D==2&&(ne.offset=I.read_shift(2)),ne.dec=I.read_shift(1),ne.name.length&&J.push(ne),D!=2&&(I.l+=H?13:14),ne.type){case"B":(!R||ne.len!=8)&&S.WTF&&console.log("Skipping "+ne.name+":"+ne.type);break;case"G":case"P":S.WTF&&console.log("Skipping "+ne.name+":"+ne.type);break;case"+":case"0":case"@":case"C":case"D":case"F":case"I":case"L":case"M":case"N":case"O":case"T":case"Y":break;default:throw new Error("Unknown Field Type: "+ne.type)}if(I[I.l]!==13&&(I.l=U-1),I.read_shift(1)!==13)throw new Error("DBF Terminator not found "+I.l+" "+I[I.l]);I.l=U;var ye=0,pe=0;for(E[0]=[],pe=0;pe!=J.length;++pe)E[0][pe]=J[pe].name;for(;F-- >0;){if(I[I.l]===42){I.l+=Y;continue}for(++I.l,E[++ye]=[],pe=0,pe=0;pe!=J.length;++pe){var be=I.slice(I.l,I.l+J[pe].len);I.l+=J[pe].len,Vc(be,0);var ke=Bg.utils.decode(z,be);switch(J[pe].type){case"C":ke.trim().length&&(E[ye][pe]=ke.replace(/\s+$/,""));break;case"D":ke.length===8?E[ye][pe]=new Date(+ke.slice(0,4),+ke.slice(4,6)-1,+ke.slice(6,8)):E[ye][pe]=ke;break;case"F":E[ye][pe]=parseFloat(ke.trim());break;case"+":case"I":E[ye][pe]=H?be.read_shift(-4,"i")^2147483648:be.read_shift(4,"i");break;case"L":switch(ke.trim().toUpperCase()){case"Y":case"T":E[ye][pe]=!0;break;case"N":case"F":E[ye][pe]=!1;break;case"":case"?":break;default:throw new Error("DBF Unrecognized L:|"+ke+"|")}break;case"M":if(!M)throw new Error("DBF Unexpected MEMO for type "+D.toString(16));E[ye][pe]="##MEMO##"+(H?parseInt(ke.trim(),10):be.read_shift(4));break;case"N":ke=ke.replace(/\u0000/g,"").trim(),ke&&ke!="."&&(E[ye][pe]=+ke||0);break;case"@":E[ye][pe]=new Date(be.read_shift(-8,"f")-621356832e5);break;case"T":E[ye][pe]=new Date((be.read_shift(4)-2440588)*864e5+be.read_shift(4));break;case"Y":E[ye][pe]=be.read_shift(4,"i")/1e4+be.read_shift(4,"i")/1e4*Math.pow(2,32);break;case"O":E[ye][pe]=-be.read_shift(-8,"f");break;case"B":if(R&&J[pe].len==8){E[ye][pe]=be.read_shift(8,"f");break}case"G":case"P":be.l+=J[pe].len;break;case"0":if(J[pe].name==="_NullFlags")break;default:throw new Error("DBF Unsupported data type "+J[pe].type)}}}if(D!=2&&I.l<I.length&&I[I.l++]!=26)throw new Error("DBF EOF Marker missing "+(I.l-1)+" of "+I.length+" "+I[I.l-1].toString(16));return S&&S.sheetRows&&(E=E.slice(0,S.sheetRows)),S.DBF=J,E}function s(i,S){var E=S||{};E.dateNF||(E.dateNF="yyyymmdd");var I=Xv(r(i,E),E);return I["!cols"]=E.DBF.map(function(D){return{wch:D.len,DBF:D}}),delete E.DBF,I}function u(i,S){try{return k_(s(i,S),S)}catch(E){if(S&&S.WTF)throw E}return{SheetNames:[],Sheets:{}}}var f={B:8,C:250,L:1,D:8,"?":0,"":0};function m(i,S){var E=S||{};if(+E.codepage>=0&&wb(+E.codepage),E.type=="string")throw new Error("Cannot write DBF to JS string");var I=Nc(),D=CC(i,{header:1,raw:!0,cellDates:!0}),M=D[0],R=D.slice(1),H=i["!cols"]||[],F=0,U=0,Y=0,z=1;for(F=0;F<M.length;++F){if(((H[F]||{}).DBF||{}).name){M[F]=H[F].DBF.name,++Y;continue}if(M[F]!=null){if(++Y,typeof M[F]=="number"&&(M[F]=M[F].toString(10)),typeof M[F]!="string")throw new Error("DBF Invalid column name "+M[F]+" |"+typeof M[F]+"|");if(M.indexOf(M[F])!==F){for(U=0;U<1024;++U)if(M.indexOf(M[F]+"_"+U)==-1){M[F]+="_"+U;break}}}}var J=Ba(i["!ref"]),ne=[],me=[],le=[];for(F=0;F<=J.e.c-J.s.c;++F){var ye="",pe="",be=0,ke=[];for(U=0;U<R.length;++U)R[U][F]!=null&&ke.push(R[U][F]);if(ke.length==0||M[F]==null){ne[F]="?";continue}for(U=0;U<ke.length;++U){switch(typeof ke[U]){case"number":pe="B";break;case"string":pe="C";break;case"boolean":pe="L";break;case"object":pe=ke[U]instanceof Date?"D":"C";break;default:pe="C"}be=Math.max(be,String(ke[U]).length),ye=ye&&ye!=pe?"C":pe}be>250&&(be=250),pe=((H[F]||{}).DBF||{}).type,pe=="C"&&H[F].DBF.len>be&&(be=H[F].DBF.len),ye=="B"&&pe=="N"&&(ye="N",le[F]=H[F].DBF.dec,be=H[F].DBF.len),me[F]=ye=="C"||pe=="N"?be:f[ye]||0,z+=me[F],ne[F]=ye}var Oe=I.next(32);for(Oe.write_shift(4,318902576),Oe.write_shift(4,R.length),Oe.write_shift(2,296+32*Y),Oe.write_shift(2,z),F=0;F<4;++F)Oe.write_shift(4,0);for(Oe.write_shift(4,0|(+t[FG]||3)<<8),F=0,U=0;F<M.length;++F)if(M[F]!=null){var Ee=I.next(32),qe=(M[F].slice(-10)+"\0\0\0\0\0\0\0\0\0\0\0").slice(0,11);Ee.write_shift(1,qe,"sbcs"),Ee.write_shift(1,ne[F]=="?"?"C":ne[F],"sbcs"),Ee.write_shift(4,U),Ee.write_shift(1,me[F]||f[ne[F]]||0),Ee.write_shift(1,le[F]||0),Ee.write_shift(1,2),Ee.write_shift(4,0),Ee.write_shift(1,0),Ee.write_shift(4,0),Ee.write_shift(4,0),U+=me[F]||f[ne[F]]||0}var Qe=I.next(264);for(Qe.write_shift(4,13),F=0;F<65;++F)Qe.write_shift(4,0);for(F=0;F<R.length;++F){var gt=I.next(z);for(gt.write_shift(1,0),U=0;U<M.length;++U)if(M[U]!=null)switch(ne[U]){case"L":gt.write_shift(1,R[F][U]==null?63:R[F][U]?84:70);break;case"B":gt.write_shift(8,R[F][U]||0,"f");break;case"N":var Xe="0";for(typeof R[F][U]=="number"&&(Xe=R[F][U].toFixed(le[U]||0)),Y=0;Y<me[U]-Xe.length;++Y)gt.write_shift(1,32);gt.write_shift(1,Xe,"sbcs");break;case"D":R[F][U]?(gt.write_shift(4,("0000"+R[F][U].getFullYear()).slice(-4),"sbcs"),gt.write_shift(2,("00"+(R[F][U].getMonth()+1)).slice(-2),"sbcs"),gt.write_shift(2,("00"+R[F][U].getDate()).slice(-2),"sbcs")):gt.write_shift(8,"00000000","sbcs");break;case"C":var ct=String(R[F][U]!=null?R[F][U]:"").slice(0,me[U]);for(gt.write_shift(1,ct,"sbcs"),Y=0;Y<me[U]-ct.length;++Y)gt.write_shift(1,32);break}}return I.next(1).write_shift(1,26),I.end()}return{to_workbook:u,to_sheet:s,from_sheet:m}}(),oxe=function(){var e={AA:"",BA:"",CA:"",DA:195,HA:"",JA:197,AE:"",BE:"",CE:"",HE:"",AI:"",BI:"",CI:"",HI:"",AO:"",BO:"",CO:"",DO:213,HO:"",AU:"",BU:"",CU:"",HU:"",Aa:"",Ba:"",Ca:"",Da:227,Ha:"",Ja:229,Ae:"",Be:"",Ce:"",He:"",Ai:"",Bi:"",Ci:"",Hi:"",Ao:"",Bo:"",Co:"",Do:245,Ho:"",Au:"",Bu:"",Cu:"",Hu:"",KC:"",Kc:"",q:"",z:"",a:"",j:"",DN:209,Dn:241,Hy:255,S:169,c:170,R:174,"B ":180,0:176,1:177,2:178,3:179,5:181,6:182,7:183,Q:185,k:186,b:208,i:216,l:222,s:240,y:248,"!":161,'"':162,"#":163,"(":164,"%":165,"'":167,"H ":168,"+":171,";":187,"<":188,"=":189,">":190,"?":191,"{":223},t=new RegExp("\x1BN("+pl(e).join("|").replace(/\|\|\|/,"|\\||").replace(/([?()+])/g,"\\$1")+"|\\|)","gm"),r=function(M,R){var H=e[R];return typeof H=="number"?i5(H):H},s=function(M,R,H){var F=R.charCodeAt(0)-32<<4|H.charCodeAt(0)-48;return F==59?M:i5(F)};e["|"]=254;function u(M,R){switch(R.type){case"base64":return f(vf(M),R);case"binary":return f(M,R);case"buffer":return f(sa&&Buffer.isBuffer(M)?M.toString("binary"):t2(M),R);case"array":return f(CA(M),R)}throw new Error("Unrecognized type "+R.type)}function f(M,R){var H=M.split(/[\n\r]+/),F=-1,U=-1,Y=0,z=0,J=[],ne=[],me=null,le={},ye=[],pe=[],be=[],ke=0,Oe;for(+R.codepage>=0&&wb(+R.codepage);Y!==H.length;++Y){ke=0;var Ee=H[Y].trim().replace(/\x1B([\x20-\x2F])([\x30-\x3F])/g,s).replace(t,r),qe=Ee.replace(/;;/g,"\0").split(";").map(function(Ue){return Ue.replace(/\u0000/g,";")}),Qe=qe[0],gt;if(Ee.length>0)switch(Qe){case"ID":break;case"E":break;case"B":break;case"O":break;case"W":break;case"P":qe[1].charAt(0)=="P"&&ne.push(Ee.slice(3).replace(/;;/g,";"));break;case"C":var Xe=!1,ct=!1,Me=!1,mt=!1,Kt=-1,it=-1;for(z=1;z<qe.length;++z)switch(qe[z].charAt(0)){case"A":break;case"X":U=parseInt(qe[z].slice(1))-1,ct=!0;break;case"Y":for(F=parseInt(qe[z].slice(1))-1,ct||(U=0),Oe=J.length;Oe<=F;++Oe)J[Oe]=[];break;case"K":gt=qe[z].slice(1),gt.charAt(0)==='"'?gt=gt.slice(1,gt.length-1):gt==="TRUE"?gt=!0:gt==="FALSE"?gt=!1:isNaN(uf(gt))?isNaN(Sb(gt).getDate())||(gt=Ql(gt)):(gt=uf(gt),me!==null&&XG(me)&&(gt=QG(gt))),Xe=!0;break;case"E":mt=!0;var ee=sve(qe[z].slice(1),{r:F,c:U});J[F][U]=[J[F][U],ee];break;case"S":Me=!0,J[F][U]=[J[F][U],"S5S"];break;case"G":break;case"R":Kt=parseInt(qe[z].slice(1))-1;break;case"C":it=parseInt(qe[z].slice(1))-1;break;default:if(R&&R.WTF)throw new Error("SYLK bad record "+Ee)}if(Xe&&(J[F][U]&&J[F][U].length==2?J[F][U][0]=gt:J[F][U]=gt,me=null),Me){if(mt)throw new Error("SYLK shared formula cannot have own formula");var he=Kt>-1&&J[Kt][it];if(!he||!he[1])throw new Error("SYLK shared formula cannot find base");J[F][U][1]=ave(he[1],{r:F-Kt,c:U-it})}break;case"F":var Se=0;for(z=1;z<qe.length;++z)switch(qe[z].charAt(0)){case"X":U=parseInt(qe[z].slice(1))-1,++Se;break;case"Y":for(F=parseInt(qe[z].slice(1))-1,Oe=J.length;Oe<=F;++Oe)J[Oe]=[];break;case"M":ke=parseInt(qe[z].slice(1))/20;break;case"F":break;case"G":break;case"P":me=ne[parseInt(qe[z].slice(1))];break;case"S":break;case"D":break;case"N":break;case"W":for(be=qe[z].slice(1).split(" "),Oe=parseInt(be[0],10);Oe<=parseInt(be[1],10);++Oe)ke=parseInt(be[2],10),pe[Oe-1]=ke===0?{hidden:!0}:{wch:ke},NM(pe[Oe-1]);break;case"C":U=parseInt(qe[z].slice(1))-1,pe[U]||(pe[U]={});break;case"R":F=parseInt(qe[z].slice(1))-1,ye[F]||(ye[F]={}),ke>0?(ye[F].hpt=ke,ye[F].hpx=BW(ke)):ke===0&&(ye[F].hidden=!0);break;default:if(R&&R.WTF)throw new Error("SYLK bad record "+Ee)}Se<1&&(me=null);break;default:if(R&&R.WTF)throw new Error("SYLK bad record "+Ee)}}return ye.length>0&&(le["!rows"]=ye),pe.length>0&&(le["!cols"]=pe),R&&R.sheetRows&&(J=J.slice(0,R.sheetRows)),[J,le]}function m(M,R){var H=u(M,R),F=H[0],U=H[1],Y=Xv(F,R);return pl(U).forEach(function(z){Y[z]=U[z]}),Y}function i(M,R){return k_(m(M,R),R)}function S(M,R,H,F){var U="C;Y"+(H+1)+";X"+(F+1)+";K";switch(M.t){case"n":U+=M.v||0,M.f&&!M.F&&(U+=";E"+PM(M.f,{r:H,c:F}));break;case"b":U+=M.v?"TRUE":"FALSE";break;case"e":U+=M.w||M.v;break;case"d":U+='"'+(M.w||M.v)+'"';break;case"s":U+='"'+M.v.replace(/"/g,"").replace(/;/g,";;")+'"';break}return U}function E(M,R){R.forEach(function(H,F){var U="F;W"+(F+1)+" "+(F+1)+" ";H.hidden?U+="0":(typeof H.width=="number"&&!H.wpx&&(H.wpx=bC(H.width)),typeof H.wpx=="number"&&!H.wch&&(H.wch=SC(H.wpx)),typeof H.wch=="number"&&(U+=Math.round(H.wch))),U.charAt(U.length-1)!=" "&&M.push(U)})}function I(M,R){R.forEach(function(H,F){var U="F;";H.hidden?U+="M0;":H.hpt?U+="M"+20*H.hpt+";":H.hpx&&(U+="M"+20*TC(H.hpx)+";"),U.length>2&&M.push(U+"R"+(F+1))})}function D(M,R){var H=["ID;PWXL;N;E"],F=[],U=Ba(M["!ref"]),Y,z=Array.isArray(M),J=`\r
`;H.push("P;PGeneral"),H.push("F;P0;DG0G8;M255"),M["!cols"]&&E(H,M["!cols"]),M["!rows"]&&I(H,M["!rows"]),H.push("B;Y"+(U.e.r-U.s.r+1)+";X"+(U.e.c-U.s.c+1)+";D"+[U.s.c,U.s.r,U.e.c,U.e.r].join(" "));for(var ne=U.s.r;ne<=U.e.r;++ne)for(var me=U.s.c;me<=U.e.c;++me){var le=ya({r:ne,c:me});Y=z?(M[ne]||[])[me]:M[le],!(!Y||Y.v==null&&(!Y.f||Y.F))&&F.push(S(Y,M,ne,me))}return H.join(J)+J+F.join(J)+J+"E"+J}return{to_workbook:i,to_sheet:m,from_sheet:D}}(),lxe=function(){function e(f,m){switch(m.type){case"base64":return t(vf(f),m);case"binary":return t(f,m);case"buffer":return t(sa&&Buffer.isBuffer(f)?f.toString("binary"):t2(f),m);case"array":return t(CA(f),m)}throw new Error("Unrecognized type "+m.type)}function t(f,m){for(var i=f.split(`
`),S=-1,E=-1,I=0,D=[];I!==i.length;++I){if(i[I].trim()==="BOT"){D[++S]=[],E=0;continue}if(!(S<0)){var M=i[I].trim().split(","),R=M[0],H=M[1];++I;for(var F=i[I]||"";(F.match(/["]/g)||[]).length&1&&I<i.length-1;)F+=`
`+i[++I];switch(F=F.trim(),+R){case-1:if(F==="BOT"){D[++S]=[],E=0;continue}else if(F!=="EOD")throw new Error("Unrecognized DIF special command "+F);break;case 0:F==="TRUE"?D[S][E]=!0:F==="FALSE"?D[S][E]=!1:isNaN(uf(H))?isNaN(Sb(H).getDate())?D[S][E]=H:D[S][E]=Ql(H):D[S][E]=uf(H),++E;break;case 1:F=F.slice(1,F.length-1),F=F.replace(/""/g,'"'),F&&F.match(/^=".*"$/)&&(F=F.slice(2,-1)),D[S][E++]=F!==""?F:null;break}if(F==="EOD")break}}return m&&m.sheetRows&&(D=D.slice(0,m.sheetRows)),D}function r(f,m){return Xv(e(f,m),m)}function s(f,m){return k_(r(f,m),m)}var u=function(){var f=function(S,E,I,D,M){S.push(E),S.push(I+","+D),S.push('"'+M.replace(/"/g,'""')+'"')},m=function(S,E,I,D){S.push(E+","+I),S.push(E==1?'"'+D.replace(/"/g,'""')+'"':D)};return function(S){var E=[],I=Ba(S["!ref"]),D,M=Array.isArray(S);f(E,"TABLE",0,1,"sheetjs"),f(E,"VECTORS",0,I.e.r-I.s.r+1,""),f(E,"TUPLES",0,I.e.c-I.s.c+1,""),f(E,"DATA",0,0,"");for(var R=I.s.r;R<=I.e.r;++R){m(E,-1,0,"BOT");for(var H=I.s.c;H<=I.e.c;++H){var F=ya({r:R,c:H});if(D=M?(S[R]||[])[H]:S[F],!D){m(E,1,0,"");continue}switch(D.t){case"n":var U=D.w;!U&&D.v!=null&&(U=D.v),U==null?D.f&&!D.F?m(E,1,0,"="+D.f):m(E,1,0,""):m(E,0,U,"V");break;case"b":m(E,0,D.v?1:0,D.v?"TRUE":"FALSE");break;case"s":m(E,1,0,isNaN(D.v)?D.v:'="'+D.v+'"');break;case"d":D.w||(D.w=mm(D.z||po[14],kc(Ql(D.v)))),m(E,0,D.w,"V");break;default:m(E,1,0,"")}}}m(E,-1,0,"EOD");var Y=`\r
`,z=E.join(Y);return z}}();return{to_workbook:s,to_sheet:r,from_sheet:u}}(),OW=function(){function e(D){return D.replace(/\\b/g,"\\").replace(/\\c/g,":").replace(/\\n/g,`
`)}function t(D){return D.replace(/\\/g,"\\b").replace(/:/g,"\\c").replace(/\n/g,"\\n")}function r(D,M){for(var R=D.split(`
`),H=-1,F=-1,U=0,Y=[];U!==R.length;++U){var z=R[U].trim().split(":");if(z[0]==="cell"){var J=Zo(z[1]);if(Y.length<=J.r)for(H=Y.length;H<=J.r;++H)Y[H]||(Y[H]=[]);switch(H=J.r,F=J.c,z[2]){case"t":Y[H][F]=e(z[3]);break;case"v":Y[H][F]=+z[3];break;case"vtf":var ne=z[z.length-1];case"vtc":switch(z[3]){case"nl":Y[H][F]=!!+z[4];break;default:Y[H][F]=+z[4];break}z[2]=="vtf"&&(Y[H][F]=[Y[H][F],ne])}}}return M&&M.sheetRows&&(Y=Y.slice(0,M.sheetRows)),Y}function s(D,M){return Xv(r(D,M),M)}function u(D,M){return k_(s(D,M),M)}var f=["socialcalc:version:1.5","MIME-Version: 1.0","Content-Type: multipart/mixed; boundary=SocialCalcSpreadsheetControlSave"].join(`
`),m=["--SocialCalcSpreadsheetControlSave","Content-type: text/plain; charset=UTF-8"].join(`
`)+`
`,i=["# SocialCalc Spreadsheet Control Save","part:sheet"].join(`
`),S="--SocialCalcSpreadsheetControlSave--";function E(D){if(!D||!D["!ref"])return"";for(var M=[],R=[],H,F="",U=eu(D["!ref"]),Y=Array.isArray(D),z=U.s.r;z<=U.e.r;++z)for(var J=U.s.c;J<=U.e.c;++J)if(F=ya({r:z,c:J}),H=Y?(D[z]||[])[J]:D[F],!(!H||H.v==null||H.t==="z")){switch(R=["cell",F,"t"],H.t){case"s":case"str":R.push(t(H.v));break;case"n":H.f?(R[2]="vtf",R[3]="n",R[4]=H.v,R[5]=t(H.f)):(R[2]="v",R[3]=H.v);break;case"b":R[2]="vt"+(H.f?"f":"c"),R[3]="nl",R[4]=H.v?"1":"0",R[5]=t(H.f||(H.v?"TRUE":"FALSE"));break;case"d":var ne=kc(Ql(H.v));R[2]="vtc",R[3]="nd",R[4]=""+ne,R[5]=H.w||mm(H.z||po[14],ne);break;case"e":continue}M.push(R.join(":"))}return M.push("sheet:c:"+(U.e.c-U.s.c+1)+":r:"+(U.e.r-U.s.r+1)+":tvf:1"),M.push("valueformat:1:text-wiki"),M.join(`
`)}function I(D){return[f,m,i,m,E(D),S].join(`
`)}return{to_workbook:u,to_sheet:s,from_sheet:I}}(),cxe=function(){function e(I,D,M,R,H){H.raw?D[M][R]=I:I===""||(I==="TRUE"?D[M][R]=!0:I==="FALSE"?D[M][R]=!1:isNaN(uf(I))?isNaN(Sb(I).getDate())?D[M][R]=I:D[M][R]=Ql(I):D[M][R]=uf(I))}function t(I,D){var M=D||{},R=[];if(!I||I.length===0)return R;for(var H=I.split(/[\r\n]/),F=H.length-1;F>=0&&H[F].length===0;)--F;for(var U=10,Y=0,z=0;z<=F;++z)Y=H[z].indexOf(" "),Y==-1?Y=H[z].length:Y++,U=Math.max(U,Y);for(z=0;z<=F;++z){R[z]=[];var J=0;for(e(H[z].slice(0,U).trim(),R,z,J,M),J=1;J<=(H[z].length-U)/10+1;++J)e(H[z].slice(U+(J-1)*10,U+J*10).trim(),R,z,J,M)}return M.sheetRows&&(R=R.slice(0,M.sheetRows)),R}var r={44:",",9:"	",59:";",124:"|"},s={44:3,9:2,59:1,124:0};function u(I){for(var D={},M=!1,R=0,H=0;R<I.length;++R)(H=I.charCodeAt(R))==34?M=!M:!M&&H in r&&(D[H]=(D[H]||0)+1);H=[];for(R in D)Object.prototype.hasOwnProperty.call(D,R)&&H.push([D[R],R]);if(!H.length){D=s;for(R in D)Object.prototype.hasOwnProperty.call(D,R)&&H.push([D[R],R])}return H.sort(function(F,U){return F[0]-U[0]||s[F[1]]-s[U[1]]}),r[H.pop()[1]]||44}function f(I,D){var M=D||{},R="",H=M.dense?[]:{},F={s:{c:0,r:0},e:{c:0,r:0}};I.slice(0,4)=="sep="?I.charCodeAt(5)==13&&I.charCodeAt(6)==10?(R=I.charAt(4),I=I.slice(7)):I.charCodeAt(5)==13||I.charCodeAt(5)==10?(R=I.charAt(4),I=I.slice(6)):R=u(I.slice(0,1024)):M&&M.FS?R=M.FS:R=u(I.slice(0,1024));var U=0,Y=0,z=0,J=0,ne=0,me=R.charCodeAt(0),le=!1,ye=0,pe=I.charCodeAt(0);I=I.replace(/\r\n/mg,`
`);var be=M.dateNF!=null?E_e(M.dateNF):null;function ke(){var Oe=I.slice(J,ne),Ee={};if(Oe.charAt(0)=='"'&&Oe.charAt(Oe.length-1)=='"'&&(Oe=Oe.slice(1,-1).replace(/""/g,'"')),Oe.length===0)Ee.t="z";else if(M.raw)Ee.t="s",Ee.v=Oe;else if(Oe.trim().length===0)Ee.t="s",Ee.v=Oe;else if(Oe.charCodeAt(0)==61)Oe.charCodeAt(1)==34&&Oe.charCodeAt(Oe.length-1)==34?(Ee.t="s",Ee.v=Oe.slice(2,-1).replace(/""/g,'"')):ove(Oe)?(Ee.t="n",Ee.f=Oe.slice(1)):(Ee.t="s",Ee.v=Oe);else if(Oe=="TRUE")Ee.t="b",Ee.v=!0;else if(Oe=="FALSE")Ee.t="b",Ee.v=!1;else if(!isNaN(z=uf(Oe)))Ee.t="n",M.cellText!==!1&&(Ee.w=Oe),Ee.v=z;else if(!isNaN(Sb(Oe).getDate())||be&&Oe.match(be)){Ee.z=M.dateNF||po[14];var qe=0;be&&Oe.match(be)&&(Oe=C_e(Oe,M.dateNF,Oe.match(be)||[]),qe=1),M.cellDates?(Ee.t="d",Ee.v=Ql(Oe,qe)):(Ee.t="n",Ee.v=kc(Ql(Oe,qe))),M.cellText!==!1&&(Ee.w=mm(Ee.z,Ee.v instanceof Date?kc(Ee.v):Ee.v)),M.cellNF||delete Ee.z}else Ee.t="s",Ee.v=Oe;if(Ee.t=="z"||(M.dense?(H[U]||(H[U]=[]),H[U][Y]=Ee):H[ya({c:Y,r:U})]=Ee),J=ne+1,pe=I.charCodeAt(J),F.e.c<Y&&(F.e.c=Y),F.e.r<U&&(F.e.r=U),ye==me)++Y;else if(Y=0,++U,M.sheetRows&&M.sheetRows<=U)return!0}e:for(;ne<I.length;++ne)switch(ye=I.charCodeAt(ne)){case 34:pe===34&&(le=!le);break;case me:case 10:case 13:if(!le&&ke())break e;break}return ne-J>0&&ke(),H["!ref"]=Io(F),H}function m(I,D){return!(D&&D.PRN)||D.FS||I.slice(0,4)=="sep="||I.indexOf("	")>=0||I.indexOf(",")>=0||I.indexOf(";")>=0?f(I,D):Xv(t(I,D),D)}function i(I,D){var M="",R=D.type=="string"?[0,0,0,0]:wbe(I,D);switch(D.type){case"base64":M=vf(I);break;case"binary":M=I;break;case"buffer":D.codepage==65001?M=I.toString("utf8"):D.codepage&&typeof Bg<"u"?M=Bg.utils.decode(D.codepage,I):M=sa&&Buffer.isBuffer(I)?I.toString("binary"):t2(I);break;case"array":M=CA(I);break;case"string":M=I;break;default:throw new Error("Unrecognized type "+D.type)}return R[0]==239&&R[1]==187&&R[2]==191?M=zw(M.slice(3)):D.type!="string"&&D.type!="buffer"&&D.codepage==65001?M=zw(M):D.type=="binary"&&typeof Bg<"u"&&D.codepage&&(M=Bg.utils.decode(D.codepage,Bg.utils.encode(28591,M))),M.slice(0,19)=="socialcalc:version:"?OW.to_sheet(D.type=="string"?M:zw(M),D):m(M,D)}function S(I,D){return k_(i(I,D),D)}function E(I){for(var D=[],M=Ba(I["!ref"]),R,H=Array.isArray(I),F=M.s.r;F<=M.e.r;++F){for(var U=[],Y=M.s.c;Y<=M.e.c;++Y){var z=ya({r:F,c:Y});if(R=H?(I[F]||[])[Y]:I[z],!R||R.v==null){U.push("          ");continue}for(var J=(R.w||(yf(R),R.w)||"").slice(0,10);J.length<10;)J+=" ";U.push(J+(Y===0?" ":""))}D.push(U.join(""))}return D.join(`
`)}return{to_workbook:S,to_sheet:i,from_sheet:E}}(),M5=function(){function e(ee,he,Se){if(ee){Vc(ee,ee.l||0);for(var Ue=Se.Enum||Kt;ee.l<ee.length;){var nt=ee.read_shift(2),dt=Ue[nt]||Ue[65535],Vt=ee.read_shift(2),zt=ee.l+Vt,Gt=dt.f&&dt.f(ee,Vt,Se);if(ee.l=zt,he(Gt,dt,nt))return}}}function t(ee,he){switch(he.type){case"base64":return r(md(vf(ee)),he);case"binary":return r(md(ee),he);case"buffer":case"array":return r(ee,he)}throw"Unsupported type "+he.type}function r(ee,he){if(!ee)return ee;var Se=he||{},Ue=Se.dense?[]:{},nt="Sheet1",dt="",Vt=0,zt={},Gt=[],jr=[],Wr={s:{r:0,c:0},e:{r:0,c:0}},nn=Se.sheetRows||0;if(ee[2]==0&&(ee[3]==8||ee[3]==9)&&ee.length>=16&&ee[14]==5&&ee[15]===108)throw new Error("Unsupported Works 3 for Mac file");if(ee[2]==2)Se.Enum=Kt,e(ee,function(Zr,Nn,Pi){switch(Pi){case 0:Se.vers=Zr,Zr>=4096&&(Se.qpro=!0);break;case 6:Wr=Zr;break;case 204:Zr&&(dt=Zr);break;case 222:dt=Zr;break;case 15:case 51:Se.qpro||(Zr[1].v=Zr[1].v.slice(1));case 13:case 14:case 16:Pi==14&&(Zr[2]&112)==112&&(Zr[2]&15)>1&&(Zr[2]&15)<15&&(Zr[1].z=Se.dateNF||po[14],Se.cellDates&&(Zr[1].t="d",Zr[1].v=QG(Zr[1].v))),Se.qpro&&Zr[3]>Vt&&(Ue["!ref"]=Io(Wr),zt[nt]=Ue,Gt.push(nt),Ue=Se.dense?[]:{},Wr={s:{r:0,c:0},e:{r:0,c:0}},Vt=Zr[3],nt=dt||"Sheet"+(Vt+1),dt="");var ft=Se.dense?(Ue[Zr[0].r]||[])[Zr[0].c]:Ue[ya(Zr[0])];if(ft){ft.t=Zr[1].t,ft.v=Zr[1].v,Zr[1].z!=null&&(ft.z=Zr[1].z),Zr[1].f!=null&&(ft.f=Zr[1].f);break}Se.dense?(Ue[Zr[0].r]||(Ue[Zr[0].r]=[]),Ue[Zr[0].r][Zr[0].c]=Zr[1]):Ue[ya(Zr[0])]=Zr[1];break}},Se);else if(ee[2]==26||ee[2]==14)Se.Enum=it,ee[2]==14&&(Se.qpro=!0,ee.l=0),e(ee,function(Zr,Nn,Pi){switch(Pi){case 204:nt=Zr;break;case 22:Zr[1].v=Zr[1].v.slice(1);case 23:case 24:case 25:case 37:case 39:case 40:if(Zr[3]>Vt&&(Ue["!ref"]=Io(Wr),zt[nt]=Ue,Gt.push(nt),Ue=Se.dense?[]:{},Wr={s:{r:0,c:0},e:{r:0,c:0}},Vt=Zr[3],nt="Sheet"+(Vt+1)),nn>0&&Zr[0].r>=nn)break;Se.dense?(Ue[Zr[0].r]||(Ue[Zr[0].r]=[]),Ue[Zr[0].r][Zr[0].c]=Zr[1]):Ue[ya(Zr[0])]=Zr[1],Wr.e.c<Zr[0].c&&(Wr.e.c=Zr[0].c),Wr.e.r<Zr[0].r&&(Wr.e.r=Zr[0].r);break;case 27:Zr[14e3]&&(jr[Zr[14e3][0]]=Zr[14e3][1]);break;case 1537:jr[Zr[0]]=Zr[1],Zr[0]==Vt&&(nt=Zr[1]);break}},Se);else throw new Error("Unrecognized LOTUS BOF "+ee[2]);if(Ue["!ref"]=Io(Wr),zt[dt||nt]=Ue,Gt.push(dt||nt),!jr.length)return{SheetNames:Gt,Sheets:zt};for(var xn={},ei=[],Dn=0;Dn<jr.length;++Dn)zt[Gt[Dn]]?(ei.push(jr[Dn]||Gt[Dn]),xn[jr[Dn]]=zt[jr[Dn]]||zt[Gt[Dn]]):(ei.push(jr[Dn]),xn[jr[Dn]]={"!ref":"A1"});return{SheetNames:ei,Sheets:xn}}function s(ee,he){var Se=he||{};if(+Se.codepage>=0&&wb(+Se.codepage),Se.type=="string")throw new Error("Cannot write WK1 to JS string");var Ue=Nc(),nt=Ba(ee["!ref"]),dt=Array.isArray(ee),Vt=[];mn(Ue,0,f(1030)),mn(Ue,6,S(nt));for(var zt=Math.min(nt.e.r,8191),Gt=nt.s.r;Gt<=zt;++Gt)for(var jr=dl(Gt),Wr=nt.s.c;Wr<=nt.e.c;++Wr){Gt===nt.s.r&&(Vt[Wr]=El(Wr));var nn=Vt[Wr]+jr,xn=dt?(ee[Gt]||[])[Wr]:ee[nn];if(!(!xn||xn.t=="z"))if(xn.t=="n")(xn.v|0)==xn.v&&xn.v>=-32768&&xn.v<=32767?mn(Ue,13,R(Gt,Wr,xn.v)):mn(Ue,14,F(Gt,Wr,xn.v));else{var ei=yf(xn);mn(Ue,15,D(Gt,Wr,ei.slice(0,239)))}}return mn(Ue,1),Ue.end()}function u(ee,he){var Se=he||{};if(+Se.codepage>=0&&wb(+Se.codepage),Se.type=="string")throw new Error("Cannot write WK3 to JS string");var Ue=Nc();mn(Ue,0,m(ee));for(var nt=0,dt=0;nt<ee.SheetNames.length;++nt)(ee.Sheets[ee.SheetNames[nt]]||{})["!ref"]&&mn(Ue,27,mt(ee.SheetNames[nt],dt++));var Vt=0;for(nt=0;nt<ee.SheetNames.length;++nt){var zt=ee.Sheets[ee.SheetNames[nt]];if(!(!zt||!zt["!ref"])){for(var Gt=Ba(zt["!ref"]),jr=Array.isArray(zt),Wr=[],nn=Math.min(Gt.e.r,8191),xn=Gt.s.r;xn<=nn;++xn)for(var ei=dl(xn),Dn=Gt.s.c;Dn<=Gt.e.c;++Dn){xn===Gt.s.r&&(Wr[Dn]=El(Dn));var Zr=Wr[Dn]+ei,Nn=jr?(zt[xn]||[])[Dn]:zt[Zr];if(!(!Nn||Nn.t=="z"))if(Nn.t=="n")mn(Ue,23,ke(xn,Dn,Vt,Nn.v));else{var Pi=yf(Nn);mn(Ue,22,ye(xn,Dn,Vt,Pi.slice(0,239)))}}++Vt}}return mn(Ue,1),Ue.end()}function f(ee){var he=vr(2);return he.write_shift(2,ee),he}function m(ee){var he=vr(26);he.write_shift(2,4096),he.write_shift(2,4),he.write_shift(4,0);for(var Se=0,Ue=0,nt=0,dt=0;dt<ee.SheetNames.length;++dt){var Vt=ee.SheetNames[dt],zt=ee.Sheets[Vt];if(!(!zt||!zt["!ref"])){++nt;var Gt=eu(zt["!ref"]);Se<Gt.e.r&&(Se=Gt.e.r),Ue<Gt.e.c&&(Ue=Gt.e.c)}}return Se>8191&&(Se=8191),he.write_shift(2,Se),he.write_shift(1,nt),he.write_shift(1,Ue),he.write_shift(2,0),he.write_shift(2,0),he.write_shift(1,1),he.write_shift(1,2),he.write_shift(4,0),he.write_shift(4,0),he}function i(ee,he,Se){var Ue={s:{c:0,r:0},e:{c:0,r:0}};return he==8&&Se.qpro?(Ue.s.c=ee.read_shift(1),ee.l++,Ue.s.r=ee.read_shift(2),Ue.e.c=ee.read_shift(1),ee.l++,Ue.e.r=ee.read_shift(2),Ue):(Ue.s.c=ee.read_shift(2),Ue.s.r=ee.read_shift(2),he==12&&Se.qpro&&(ee.l+=2),Ue.e.c=ee.read_shift(2),Ue.e.r=ee.read_shift(2),he==12&&Se.qpro&&(ee.l+=2),Ue.s.c==65535&&(Ue.s.c=Ue.e.c=Ue.s.r=Ue.e.r=0),Ue)}function S(ee){var he=vr(8);return he.write_shift(2,ee.s.c),he.write_shift(2,ee.s.r),he.write_shift(2,ee.e.c),he.write_shift(2,ee.e.r),he}function E(ee,he,Se){var Ue=[{c:0,r:0},{t:"n",v:0},0,0];return Se.qpro&&Se.vers!=20768?(Ue[0].c=ee.read_shift(1),Ue[3]=ee.read_shift(1),Ue[0].r=ee.read_shift(2),ee.l+=2):(Ue[2]=ee.read_shift(1),Ue[0].c=ee.read_shift(2),Ue[0].r=ee.read_shift(2)),Ue}function I(ee,he,Se){var Ue=ee.l+he,nt=E(ee,he,Se);if(nt[1].t="s",Se.vers==20768){ee.l++;var dt=ee.read_shift(1);return nt[1].v=ee.read_shift(dt,"utf8"),nt}return Se.qpro&&ee.l++,nt[1].v=ee.read_shift(Ue-ee.l,"cstr"),nt}function D(ee,he,Se){var Ue=vr(7+Se.length);Ue.write_shift(1,255),Ue.write_shift(2,he),Ue.write_shift(2,ee),Ue.write_shift(1,39);for(var nt=0;nt<Ue.length;++nt){var dt=Se.charCodeAt(nt);Ue.write_shift(1,dt>=128?95:dt)}return Ue.write_shift(1,0),Ue}function M(ee,he,Se){var Ue=E(ee,he,Se);return Ue[1].v=ee.read_shift(2,"i"),Ue}function R(ee,he,Se){var Ue=vr(7);return Ue.write_shift(1,255),Ue.write_shift(2,he),Ue.write_shift(2,ee),Ue.write_shift(2,Se,"i"),Ue}function H(ee,he,Se){var Ue=E(ee,he,Se);return Ue[1].v=ee.read_shift(8,"f"),Ue}function F(ee,he,Se){var Ue=vr(13);return Ue.write_shift(1,255),Ue.write_shift(2,he),Ue.write_shift(2,ee),Ue.write_shift(8,Se,"f"),Ue}function U(ee,he,Se){var Ue=ee.l+he,nt=E(ee,he,Se);if(nt[1].v=ee.read_shift(8,"f"),Se.qpro)ee.l=Ue;else{var dt=ee.read_shift(2);ne(ee.slice(ee.l,ee.l+dt),nt),ee.l+=dt}return nt}function Y(ee,he,Se){var Ue=he&32768;return he&=-32769,he=(Ue?ee:0)+(he>=8192?he-16384:he),(Ue?"":"$")+(Se?El(he):dl(he))}var z={51:["FALSE",0],52:["TRUE",0],70:["LEN",1],80:["SUM",69],81:["AVERAGEA",69],82:["COUNTA",69],83:["MINA",69],84:["MAXA",69],111:["T",1]},J=["","","","","","","","","","+","-","*","/","^","=","<>","<=",">=","<",">","","","","","&","","","","","","",""];function ne(ee,he){Vc(ee,0);for(var Se=[],Ue=0,nt="",dt="",Vt="",zt="";ee.l<ee.length;){var Gt=ee[ee.l++];switch(Gt){case 0:Se.push(ee.read_shift(8,"f"));break;case 1:dt=Y(he[0].c,ee.read_shift(2),!0),nt=Y(he[0].r,ee.read_shift(2),!1),Se.push(dt+nt);break;case 2:{var jr=Y(he[0].c,ee.read_shift(2),!0),Wr=Y(he[0].r,ee.read_shift(2),!1);dt=Y(he[0].c,ee.read_shift(2),!0),nt=Y(he[0].r,ee.read_shift(2),!1),Se.push(jr+Wr+":"+dt+nt)}break;case 3:if(ee.l<ee.length){console.error("WK1 premature formula end");return}break;case 4:Se.push("("+Se.pop()+")");break;case 5:Se.push(ee.read_shift(2));break;case 6:{for(var nn="";Gt=ee[ee.l++];)nn+=String.fromCharCode(Gt);Se.push('"'+nn.replace(/"/g,'""')+'"')}break;case 8:Se.push("-"+Se.pop());break;case 23:Se.push("+"+Se.pop());break;case 22:Se.push("NOT("+Se.pop()+")");break;case 20:case 21:zt=Se.pop(),Vt=Se.pop(),Se.push(["AND","OR"][Gt-20]+"("+Vt+","+zt+")");break;default:if(Gt<32&&J[Gt])zt=Se.pop(),Vt=Se.pop(),Se.push(Vt+J[Gt]+zt);else if(z[Gt]){if(Ue=z[Gt][1],Ue==69&&(Ue=ee[ee.l++]),Ue>Se.length){console.error("WK1 bad formula parse 0x"+Gt.toString(16)+":|"+Se.join("|")+"|");return}var xn=Se.slice(-Ue);Se.length-=Ue,Se.push(z[Gt][0]+"("+xn.join(",")+")")}else return Gt<=7?console.error("WK1 invalid opcode "+Gt.toString(16)):Gt<=24?console.error("WK1 unsupported op "+Gt.toString(16)):Gt<=30?console.error("WK1 invalid opcode "+Gt.toString(16)):Gt<=115?console.error("WK1 unsupported function opcode "+Gt.toString(16)):console.error("WK1 unrecognized opcode "+Gt.toString(16))}}Se.length==1?he[1].f=""+Se[0]:console.error("WK1 bad formula parse |"+Se.join("|")+"|")}function me(ee){var he=[{c:0,r:0},{t:"n",v:0},0];return he[0].r=ee.read_shift(2),he[3]=ee[ee.l++],he[0].c=ee[ee.l++],he}function le(ee,he){var Se=me(ee);return Se[1].t="s",Se[1].v=ee.read_shift(he-4,"cstr"),Se}function ye(ee,he,Se,Ue){var nt=vr(6+Ue.length);nt.write_shift(2,ee),nt.write_shift(1,Se),nt.write_shift(1,he),nt.write_shift(1,39);for(var dt=0;dt<Ue.length;++dt){var Vt=Ue.charCodeAt(dt);nt.write_shift(1,Vt>=128?95:Vt)}return nt.write_shift(1,0),nt}function pe(ee,he){var Se=me(ee);Se[1].v=ee.read_shift(2);var Ue=Se[1].v>>1;if(Se[1].v&1)switch(Ue&7){case 0:Ue=(Ue>>3)*5e3;break;case 1:Ue=(Ue>>3)*500;break;case 2:Ue=(Ue>>3)/20;break;case 3:Ue=(Ue>>3)/200;break;case 4:Ue=(Ue>>3)/2e3;break;case 5:Ue=(Ue>>3)/2e4;break;case 6:Ue=(Ue>>3)/16;break;case 7:Ue=(Ue>>3)/64;break}return Se[1].v=Ue,Se}function be(ee,he){var Se=me(ee),Ue=ee.read_shift(4),nt=ee.read_shift(4),dt=ee.read_shift(2);if(dt==65535)return Ue===0&&nt===3221225472?(Se[1].t="e",Se[1].v=15):Ue===0&&nt===3489660928?(Se[1].t="e",Se[1].v=42):Se[1].v=0,Se;var Vt=dt&32768;return dt=(dt&32767)-16446,Se[1].v=(1-Vt*2)*(nt*Math.pow(2,dt+32)+Ue*Math.pow(2,dt)),Se}function ke(ee,he,Se,Ue){var nt=vr(14);if(nt.write_shift(2,ee),nt.write_shift(1,Se),nt.write_shift(1,he),Ue==0)return nt.write_shift(4,0),nt.write_shift(4,0),nt.write_shift(2,65535),nt;var dt=0,Vt=0,zt=0,Gt=0;return Ue<0&&(dt=1,Ue=-Ue),Vt=Math.log2(Ue)|0,Ue/=Math.pow(2,Vt-31),Gt=Ue>>>0,Gt&2147483648||(Ue/=2,++Vt,Gt=Ue>>>0),Ue-=Gt,Gt|=2147483648,Gt>>>=0,Ue*=Math.pow(2,32),zt=Ue>>>0,nt.write_shift(4,zt),nt.write_shift(4,Gt),Vt+=16383+(dt?32768:0),nt.write_shift(2,Vt),nt}function Oe(ee,he){var Se=be(ee);return ee.l+=he-14,Se}function Ee(ee,he){var Se=me(ee),Ue=ee.read_shift(4);return Se[1].v=Ue>>6,Se}function qe(ee,he){var Se=me(ee),Ue=ee.read_shift(8,"f");return Se[1].v=Ue,Se}function Qe(ee,he){var Se=qe(ee);return ee.l+=he-10,Se}function gt(ee,he){return ee[ee.l+he-1]==0?ee.read_shift(he,"cstr"):""}function Xe(ee,he){var Se=ee[ee.l++];Se>he-1&&(Se=he-1);for(var Ue="";Ue.length<Se;)Ue+=String.fromCharCode(ee[ee.l++]);return Ue}function ct(ee,he,Se){if(!(!Se.qpro||he<21)){var Ue=ee.read_shift(1);ee.l+=17,ee.l+=1,ee.l+=2;var nt=ee.read_shift(he-21,"cstr");return[Ue,nt]}}function Me(ee,he){for(var Se={},Ue=ee.l+he;ee.l<Ue;){var nt=ee.read_shift(2);if(nt==14e3){for(Se[nt]=[0,""],Se[nt][0]=ee.read_shift(2);ee[ee.l];)Se[nt][1]+=String.fromCharCode(ee[ee.l]),ee.l++;ee.l++}}return Se}function mt(ee,he){var Se=vr(5+ee.length);Se.write_shift(2,14e3),Se.write_shift(2,he);for(var Ue=0;Ue<ee.length;++Ue){var nt=ee.charCodeAt(Ue);Se[Se.l++]=nt>127?95:nt}return Se[Se.l++]=0,Se}var Kt={0:{n:"BOF",f:kW},1:{n:"EOF"},2:{n:"CALCMODE"},3:{n:"CALCORDER"},4:{n:"SPLIT"},5:{n:"SYNC"},6:{n:"RANGE",f:i},7:{n:"WINDOW1"},8:{n:"COLW1"},9:{n:"WINTWO"},10:{n:"COLW2"},11:{n:"NAME"},12:{n:"BLANK"},13:{n:"INTEGER",f:M},14:{n:"NUMBER",f:H},15:{n:"LABEL",f:I},16:{n:"FORMULA",f:U},24:{n:"TABLE"},25:{n:"ORANGE"},26:{n:"PRANGE"},27:{n:"SRANGE"},28:{n:"FRANGE"},29:{n:"KRANGE1"},32:{n:"HRANGE"},35:{n:"KRANGE2"},36:{n:"PROTEC"},37:{n:"FOOTER"},38:{n:"HEADER"},39:{n:"SETUP"},40:{n:"MARGINS"},41:{n:"LABELFMT"},42:{n:"TITLES"},43:{n:"SHEETJS"},45:{n:"GRAPH"},46:{n:"NGRAPH"},47:{n:"CALCCOUNT"},48:{n:"UNFORMATTED"},49:{n:"CURSORW12"},50:{n:"WINDOW"},51:{n:"STRING",f:I},55:{n:"PASSWORD"},56:{n:"LOCKED"},60:{n:"QUERY"},61:{n:"QUERYNAME"},62:{n:"PRINT"},63:{n:"PRINTNAME"},64:{n:"GRAPH2"},65:{n:"GRAPHNAME"},66:{n:"ZOOM"},67:{n:"SYMSPLIT"},68:{n:"NSROWS"},69:{n:"NSCOLS"},70:{n:"RULER"},71:{n:"NNAME"},72:{n:"ACOMM"},73:{n:"AMACRO"},74:{n:"PARSE"},102:{n:"PRANGES??"},103:{n:"RRANGES??"},104:{n:"FNAME??"},105:{n:"MRANGES??"},204:{n:"SHEETNAMECS",f:gt},222:{n:"SHEETNAMELP",f:Xe},65535:{n:""}},it={0:{n:"BOF"},1:{n:"EOF"},2:{n:"PASSWORD"},3:{n:"CALCSET"},4:{n:"WINDOWSET"},5:{n:"SHEETCELLPTR"},6:{n:"SHEETLAYOUT"},7:{n:"COLUMNWIDTH"},8:{n:"HIDDENCOLUMN"},9:{n:"USERRANGE"},10:{n:"SYSTEMRANGE"},11:{n:"ZEROFORCE"},12:{n:"SORTKEYDIR"},13:{n:"FILESEAL"},14:{n:"DATAFILLNUMS"},15:{n:"PRINTMAIN"},16:{n:"PRINTSTRING"},17:{n:"GRAPHMAIN"},18:{n:"GRAPHSTRING"},19:{n:"??"},20:{n:"ERRCELL"},21:{n:"NACELL"},22:{n:"LABEL16",f:le},23:{n:"NUMBER17",f:be},24:{n:"NUMBER18",f:pe},25:{n:"FORMULA19",f:Oe},26:{n:"FORMULA1A"},27:{n:"XFORMAT",f:Me},28:{n:"DTLABELMISC"},29:{n:"DTLABELCELL"},30:{n:"GRAPHWINDOW"},31:{n:"CPA"},32:{n:"LPLAUTO"},33:{n:"QUERY"},34:{n:"HIDDENSHEET"},35:{n:"??"},37:{n:"NUMBER25",f:Ee},38:{n:"??"},39:{n:"NUMBER27",f:qe},40:{n:"FORMULA28",f:Qe},142:{n:"??"},147:{n:"??"},150:{n:"??"},151:{n:"??"},152:{n:"??"},153:{n:"??"},154:{n:"??"},155:{n:"??"},156:{n:"??"},163:{n:"??"},174:{n:"??"},175:{n:"??"},176:{n:"??"},177:{n:"??"},184:{n:"??"},185:{n:"??"},186:{n:"??"},187:{n:"??"},188:{n:"??"},195:{n:"??"},201:{n:"??"},204:{n:"SHEETNAMECS",f:gt},205:{n:"??"},206:{n:"??"},207:{n:"??"},208:{n:"??"},256:{n:"??"},259:{n:"??"},260:{n:"??"},261:{n:"??"},262:{n:"??"},263:{n:"??"},265:{n:"??"},266:{n:"??"},267:{n:"??"},268:{n:"??"},270:{n:"??"},271:{n:"??"},384:{n:"??"},389:{n:"??"},390:{n:"??"},393:{n:"??"},396:{n:"??"},512:{n:"??"},514:{n:"??"},513:{n:"??"},516:{n:"??"},517:{n:"??"},640:{n:"??"},641:{n:"??"},642:{n:"??"},643:{n:"??"},644:{n:"??"},645:{n:"??"},646:{n:"??"},647:{n:"??"},648:{n:"??"},658:{n:"??"},659:{n:"??"},660:{n:"??"},661:{n:"??"},662:{n:"??"},665:{n:"??"},666:{n:"??"},768:{n:"??"},772:{n:"??"},1537:{n:"SHEETINFOQP",f:ct},1600:{n:"??"},1602:{n:"??"},1793:{n:"??"},1794:{n:"??"},1795:{n:"??"},1796:{n:"??"},1920:{n:"??"},2048:{n:"??"},2049:{n:"??"},2052:{n:"??"},2688:{n:"??"},10998:{n:"??"},12849:{n:"??"},28233:{n:"??"},28484:{n:"??"},65535:{n:""}};return{sheet_to_wk1:s,book_to_wk3:u,to_workbook:t}}(),uxe=/^\s|\s$|[\t\n\r]/;function FW(e,t){if(!t.bookSST)return"";var r=[No];r[r.length]=pn("sst",null,{xmlns:Zv[0],count:e.Count,uniqueCount:e.Unique});for(var s=0;s!=e.length;++s)if(e[s]!=null){var u=e[s],f="<si>";u.r?f+=u.r:(f+="<t",u.t||(u.t=""),u.t.match(uxe)&&(f+=' xml:space="preserve"'),f+=">"+xa(u.t)+"</t>"),f+="</si>",r[r.length]=f}return r.length>2&&(r[r.length]="</sst>",r[1]=r[1].replace("/>",">")),r.join("")}function dxe(e){return[e.read_shift(4),e.read_shift(4)]}function hxe(e,t){return t||(t=vr(8)),t.write_shift(4,e.Count),t.write_shift(4,e.Unique),t}var fxe=n0e;function pxe(e){var t=Nc();Ur(t,159,hxe(e));for(var r=0;r<e.length;++r)Ur(t,19,fxe(e[r]));return Ur(t,160),t.end()}function mxe(e){for(var t=[],r=e.split(""),s=0;s<r.length;++s)t[s]=r[s].charCodeAt(0);return t}function LW(e){var t=0,r,s=mxe(e),u=s.length+1,f,m,i,S,E;for(r=T_(u),r[0]=s.length,f=1;f!=u;++f)r[f]=s[f-1];for(f=u-1;f>=0;--f)m=r[f],i=t&16384?1:0,S=t<<1&32767,E=i|S,t=E^m;return t^52811}var gxe=function(){function e(u,f){switch(f.type){case"base64":return t(vf(u),f);case"binary":return t(u,f);case"buffer":return t(sa&&Buffer.isBuffer(u)?u.toString("binary"):t2(u),f);case"array":return t(CA(u),f)}throw new Error("Unrecognized type "+f.type)}function t(u,f){var m=f||{},i=m.dense?[]:{},S=u.match(/\\trowd.*?\\row\b/g);if(!S.length)throw new Error("RTF missing table");var E={s:{c:0,r:0},e:{c:0,r:S.length-1}};return S.forEach(function(I,D){Array.isArray(i)&&(i[D]=[]);for(var M=/\\\w+\b/g,R=0,H,F=-1;H=M.exec(I);){switch(H[0]){case"\\cell":var U=I.slice(R,M.lastIndex-H[0].length);if(U[0]==" "&&(U=U.slice(1)),++F,U.length){var Y={v:U,t:"s"};Array.isArray(i)?i[D][F]=Y:i[ya({r:D,c:F})]=Y}break}R=M.lastIndex}F>E.e.c&&(E.e.c=F)}),i["!ref"]=Io(E),i}function r(u,f){return k_(e(u,f),f)}function s(u){for(var f=["{\\rtf1\\ansi"],m=Ba(u["!ref"]),i,S=Array.isArray(u),E=m.s.r;E<=m.e.r;++E){f.push("\\trowd\\trautofit1");for(var I=m.s.c;I<=m.e.c;++I)f.push("\\cellx"+(I+1));for(f.push("\\pard\\intbl"),I=m.s.c;I<=m.e.c;++I){var D=ya({r:E,c:I});i=S?(u[E]||[])[I]:u[D],!(!i||i.v==null&&(!i.f||i.F))&&(f.push(" "+(i.w||(yf(i),i.w))),f.push("\\cell"))}f.push("\\pard\\intbl\\row")}return f.join("")+"}"}return{to_workbook:r,to_sheet:e,from_sheet:s}}();function O5(e){for(var t=0,r=1;t!=3;++t)r=r*256+(e[t]>255?255:e[t]<0?0:e[t]);return r.toString(16).toUpperCase().slice(1)}var _xe=6,df=_xe;function bC(e){return Math.floor((e+Math.round(128/df)/256)*df)}function SC(e){return Math.floor((e-5)/df*100+.5)/100}function rD(e){return Math.round((e*df+5)/df*256)/256}function NM(e){e.width?(e.wpx=bC(e.width),e.wch=SC(e.wpx),e.MDW=df):e.wpx?(e.wch=SC(e.wpx),e.width=rD(e.wch),e.MDW=df):typeof e.wch=="number"&&(e.width=rD(e.wch),e.wpx=bC(e.width),e.MDW=df),e.customWidth&&delete e.customWidth}var xxe=96,zW=xxe;function TC(e){return e*96/zW}function BW(e){return e*zW/96}function vxe(e){var t=["<numFmts>"];return[[5,8],[23,26],[41,44],[50,392]].forEach(function(r){for(var s=r[0];s<=r[1];++s)e[s]!=null&&(t[t.length]=pn("numFmt",null,{numFmtId:s,formatCode:xa(e[s])}))}),t.length===1?"":(t[t.length]="</numFmts>",t[0]=pn("numFmts",null,{count:t.length-2}).replace("/>",">"),t.join(""))}function yxe(e){var t=[];return t[t.length]=pn("cellXfs",null),e.forEach(function(r){t[t.length]=pn("xf",null,r)}),t[t.length]="</cellXfs>",t.length===2?"":(t[0]=pn("cellXfs",null,{count:t.length-2}).replace("/>",">"),t.join(""))}function UW(e,t){var r=[No,pn("styleSheet",null,{xmlns:Zv[0],"xmlns:vt":Ho.vt})],s;return e.SSF&&(s=vxe(e.SSF))!=null&&(r[r.length]=s),r[r.length]='<fonts count="1"><font><sz val="12"/><color theme="1"/><name val="Calibri"/><family val="2"/><scheme val="minor"/></font></fonts>',r[r.length]='<fills count="2"><fill><patternFill patternType="none"/></fill><fill><patternFill patternType="gray125"/></fill></fills>',r[r.length]='<borders count="1"><border><left/><right/><top/><bottom/><diagonal/></border></borders>',r[r.length]='<cellStyleXfs count="1"><xf numFmtId="0" fontId="0" fillId="0" borderId="0"/></cellStyleXfs>',(s=yxe(t.cellXfs))&&(r[r.length]=s),r[r.length]='<cellStyles count="1"><cellStyle name="Normal" xfId="0" builtinId="0"/></cellStyles>',r[r.length]='<dxfs count="0"/>',r[r.length]='<tableStyles count="0" defaultTableStyle="TableStyleMedium9" defaultPivotStyle="PivotStyleMedium4"/>',r.length>2&&(r[r.length]="</styleSheet>",r[1]=r[1].replace("/>",">")),r.join("")}function wxe(e,t){var r=e.read_shift(2),s=Cl(e);return[r,s]}function bxe(e,t,r){r||(r=vr(6+4*t.length)),r.write_shift(2,e),Xo(t,r);var s=r.length>r.l?r.slice(0,r.l):r;return r.l==null&&(r.l=r.length),s}function Sxe(e,t,r){var s={};s.sz=e.read_shift(2)/20;var u=u0e(e);u.fItalic&&(s.italic=1),u.fCondense&&(s.condense=1),u.fExtend&&(s.extend=1),u.fShadow&&(s.shadow=1),u.fOutline&&(s.outline=1),u.fStrikeout&&(s.strike=1);var f=e.read_shift(2);switch(f===700&&(s.bold=1),e.read_shift(2)){case 1:s.vertAlign="superscript";break;case 2:s.vertAlign="subscript";break}var m=e.read_shift(1);m!=0&&(s.underline=m);var i=e.read_shift(1);i>0&&(s.family=i);var S=e.read_shift(1);switch(S>0&&(s.charset=S),e.l++,s.color=c0e(e),e.read_shift(1)){case 1:s.scheme="major";break;case 2:s.scheme="minor";break}return s.name=Cl(e),s}function Txe(e,t){t||(t=vr(25+4*32)),t.write_shift(2,e.sz*20),d0e(e,t),t.write_shift(2,e.bold?700:400);var r=0;e.vertAlign=="superscript"?r=1:e.vertAlign=="subscript"&&(r=2),t.write_shift(2,r),t.write_shift(1,e.underline||0),t.write_shift(1,e.family||0),t.write_shift(1,e.charset||0),t.write_shift(1,0),yC(e.color,t);var s=0;return e.scheme=="major"&&(s=1),e.scheme=="minor"&&(s=2),t.write_shift(1,s),Xo(e.name,t),t.length>t.l?t.slice(0,t.l):t}var Exe=["none","solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"],XN,Cxe=_h;function F5(e,t){t||(t=vr(4*3+8*7+16*1)),XN||(XN=xM(Exe));var r=XN[e.patternType];r==null&&(r=40),t.write_shift(4,r);var s=0;if(r!=40)for(yC({auto:1},t),yC({auto:1},t);s<12;++s)t.write_shift(4,0);else{for(;s<4;++s)t.write_shift(4,0);for(;s<12;++s)t.write_shift(4,0)}return t.length>t.l?t.slice(0,t.l):t}function Axe(e,t){var r=e.l+t,s=e.read_shift(2),u=e.read_shift(2);return e.l=r,{ixfe:s,numFmtId:u}}function VW(e,t,r){r||(r=vr(16)),r.write_shift(2,t||0),r.write_shift(2,e.numFmtId||0),r.write_shift(2,0),r.write_shift(2,0),r.write_shift(2,0),r.write_shift(1,0),r.write_shift(1,0);var s=0;return r.write_shift(1,s),r.write_shift(1,0),r.write_shift(1,0),r.write_shift(1,0),r}function dw(e,t){return t||(t=vr(10)),t.write_shift(1,0),t.write_shift(1,0),t.write_shift(4,0),t.write_shift(4,0),t}var jxe=_h;function Ixe(e,t){return t||(t=vr(51)),t.write_shift(1,0),dw(null,t),dw(null,t),dw(null,t),dw(null,t),dw(null,t),t.length>t.l?t.slice(0,t.l):t}function Nxe(e,t){return t||(t=vr(12+4*10)),t.write_shift(4,e.xfId),t.write_shift(2,1),t.write_shift(1,+e.builtinId),t.write_shift(1,0),vC(e.name||"",t),t.length>t.l?t.slice(0,t.l):t}function kxe(e,t,r){var s=vr(2052);return s.write_shift(4,e),vC(t,s),vC(r,s),s.length>s.l?s.slice(0,s.l):s}function Pxe(e,t){if(t){var r=0;[[5,8],[23,26],[41,44],[50,392]].forEach(function(s){for(var u=s[0];u<=s[1];++u)t[u]!=null&&++r}),r!=0&&(Ur(e,615,wd(r)),[[5,8],[23,26],[41,44],[50,392]].forEach(function(s){for(var u=s[0];u<=s[1];++u)t[u]!=null&&Ur(e,44,bxe(u,t[u]))}),Ur(e,616))}}function Dxe(e){var t=1;Ur(e,611,wd(t)),Ur(e,43,Txe({sz:12,color:{theme:1},name:"Calibri",family:2,scheme:"minor"})),Ur(e,612)}function Rxe(e){var t=2;Ur(e,603,wd(t)),Ur(e,45,F5({patternType:"none"})),Ur(e,45,F5({patternType:"gray125"})),Ur(e,604)}function Mxe(e){var t=1;Ur(e,613,wd(t)),Ur(e,46,Ixe()),Ur(e,614)}function Oxe(e){var t=1;Ur(e,626,wd(t)),Ur(e,47,VW({numFmtId:0,fontId:0,fillId:0,borderId:0},65535)),Ur(e,627)}function Fxe(e,t){Ur(e,617,wd(t.length)),t.forEach(function(r){Ur(e,47,VW(r,0))}),Ur(e,618)}function Lxe(e){var t=1;Ur(e,619,wd(t)),Ur(e,48,Nxe({xfId:0,builtinId:0,name:"Normal"})),Ur(e,620)}function zxe(e){var t=0;Ur(e,505,wd(t)),Ur(e,506)}function Bxe(e){var t=0;Ur(e,508,kxe(t,"TableStyleMedium9","PivotStyleMedium4")),Ur(e,509)}function Uxe(e,t){var r=Nc();return Ur(r,278),Pxe(r,e.SSF),Dxe(r),Rxe(r),Mxe(r),Oxe(r),Fxe(r,t.cellXfs),Lxe(r),zxe(r),Bxe(r),Ur(r,279),r.end()}function $W(e,t){if(t&&t.themeXLSX)return t.themeXLSX;if(e&&typeof e.raw=="string")return e.raw;var r=[No];return r[r.length]='<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">',r[r.length]="<a:themeElements>",r[r.length]='<a:clrScheme name="Office">',r[r.length]='<a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1>',r[r.length]='<a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1>',r[r.length]='<a:dk2><a:srgbClr val="1F497D"/></a:dk2>',r[r.length]='<a:lt2><a:srgbClr val="EEECE1"/></a:lt2>',r[r.length]='<a:accent1><a:srgbClr val="4F81BD"/></a:accent1>',r[r.length]='<a:accent2><a:srgbClr val="C0504D"/></a:accent2>',r[r.length]='<a:accent3><a:srgbClr val="9BBB59"/></a:accent3>',r[r.length]='<a:accent4><a:srgbClr val="8064A2"/></a:accent4>',r[r.length]='<a:accent5><a:srgbClr val="4BACC6"/></a:accent5>',r[r.length]='<a:accent6><a:srgbClr val="F79646"/></a:accent6>',r[r.length]='<a:hlink><a:srgbClr val="0000FF"/></a:hlink>',r[r.length]='<a:folHlink><a:srgbClr val="800080"/></a:folHlink>',r[r.length]="</a:clrScheme>",r[r.length]='<a:fontScheme name="Office">',r[r.length]="<a:majorFont>",r[r.length]='<a:latin typeface="Cambria"/>',r[r.length]='<a:ea typeface=""/>',r[r.length]='<a:cs typeface=""/>',r[r.length]='<a:font script="Jpan" typeface=" "/>',r[r.length]='<a:font script="Hang" typeface=" "/>',r[r.length]='<a:font script="Hans" typeface=""/>',r[r.length]='<a:font script="Hant" typeface=""/>',r[r.length]='<a:font script="Arab" typeface="Times New Roman"/>',r[r.length]='<a:font script="Hebr" typeface="Times New Roman"/>',r[r.length]='<a:font script="Thai" typeface="Tahoma"/>',r[r.length]='<a:font script="Ethi" typeface="Nyala"/>',r[r.length]='<a:font script="Beng" typeface="Vrinda"/>',r[r.length]='<a:font script="Gujr" typeface="Shruti"/>',r[r.length]='<a:font script="Khmr" typeface="MoolBoran"/>',r[r.length]='<a:font script="Knda" typeface="Tunga"/>',r[r.length]='<a:font script="Guru" typeface="Raavi"/>',r[r.length]='<a:font script="Cans" typeface="Euphemia"/>',r[r.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',r[r.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',r[r.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',r[r.length]='<a:font script="Thaa" typeface="MV Boli"/>',r[r.length]='<a:font script="Deva" typeface="Mangal"/>',r[r.length]='<a:font script="Telu" typeface="Gautami"/>',r[r.length]='<a:font script="Taml" typeface="Latha"/>',r[r.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',r[r.length]='<a:font script="Orya" typeface="Kalinga"/>',r[r.length]='<a:font script="Mlym" typeface="Kartika"/>',r[r.length]='<a:font script="Laoo" typeface="DokChampa"/>',r[r.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',r[r.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',r[r.length]='<a:font script="Viet" typeface="Times New Roman"/>',r[r.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',r[r.length]='<a:font script="Geor" typeface="Sylfaen"/>',r[r.length]="</a:majorFont>",r[r.length]="<a:minorFont>",r[r.length]='<a:latin typeface="Calibri"/>',r[r.length]='<a:ea typeface=""/>',r[r.length]='<a:cs typeface=""/>',r[r.length]='<a:font script="Jpan" typeface=" "/>',r[r.length]='<a:font script="Hang" typeface=" "/>',r[r.length]='<a:font script="Hans" typeface=""/>',r[r.length]='<a:font script="Hant" typeface=""/>',r[r.length]='<a:font script="Arab" typeface="Arial"/>',r[r.length]='<a:font script="Hebr" typeface="Arial"/>',r[r.length]='<a:font script="Thai" typeface="Tahoma"/>',r[r.length]='<a:font script="Ethi" typeface="Nyala"/>',r[r.length]='<a:font script="Beng" typeface="Vrinda"/>',r[r.length]='<a:font script="Gujr" typeface="Shruti"/>',r[r.length]='<a:font script="Khmr" typeface="DaunPenh"/>',r[r.length]='<a:font script="Knda" typeface="Tunga"/>',r[r.length]='<a:font script="Guru" typeface="Raavi"/>',r[r.length]='<a:font script="Cans" typeface="Euphemia"/>',r[r.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',r[r.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',r[r.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',r[r.length]='<a:font script="Thaa" typeface="MV Boli"/>',r[r.length]='<a:font script="Deva" typeface="Mangal"/>',r[r.length]='<a:font script="Telu" typeface="Gautami"/>',r[r.length]='<a:font script="Taml" typeface="Latha"/>',r[r.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',r[r.length]='<a:font script="Orya" typeface="Kalinga"/>',r[r.length]='<a:font script="Mlym" typeface="Kartika"/>',r[r.length]='<a:font script="Laoo" typeface="DokChampa"/>',r[r.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',r[r.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',r[r.length]='<a:font script="Viet" typeface="Arial"/>',r[r.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',r[r.length]='<a:font script="Geor" typeface="Sylfaen"/>',r[r.length]="</a:minorFont>",r[r.length]="</a:fontScheme>",r[r.length]='<a:fmtScheme name="Office">',r[r.length]="<a:fillStyleLst>",r[r.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',r[r.length]='<a:gradFill rotWithShape="1">',r[r.length]="<a:gsLst>",r[r.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',r[r.length]="</a:gsLst>",r[r.length]='<a:lin ang="16200000" scaled="1"/>',r[r.length]="</a:gradFill>",r[r.length]='<a:gradFill rotWithShape="1">',r[r.length]="<a:gsLst>",r[r.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="100000"/><a:shade val="100000"/><a:satMod val="130000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="50000"/><a:shade val="100000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',r[r.length]="</a:gsLst>",r[r.length]='<a:lin ang="16200000" scaled="0"/>',r[r.length]="</a:gradFill>",r[r.length]="</a:fillStyleLst>",r[r.length]="<a:lnStyleLst>",r[r.length]='<a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln>',r[r.length]='<a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',r[r.length]='<a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',r[r.length]="</a:lnStyleLst>",r[r.length]="<a:effectStyleLst>",r[r.length]="<a:effectStyle>",r[r.length]="<a:effectLst>",r[r.length]='<a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw>',r[r.length]="</a:effectLst>",r[r.length]="</a:effectStyle>",r[r.length]="<a:effectStyle>",r[r.length]="<a:effectLst>",r[r.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',r[r.length]="</a:effectLst>",r[r.length]="</a:effectStyle>",r[r.length]="<a:effectStyle>",r[r.length]="<a:effectLst>",r[r.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',r[r.length]="</a:effectLst>",r[r.length]='<a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d>',r[r.length]='<a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d>',r[r.length]="</a:effectStyle>",r[r.length]="</a:effectStyleLst>",r[r.length]="<a:bgFillStyleLst>",r[r.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',r[r.length]='<a:gradFill rotWithShape="1">',r[r.length]="<a:gsLst>",r[r.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs>',r[r.length]="</a:gsLst>",r[r.length]='<a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path>',r[r.length]="</a:gradFill>",r[r.length]='<a:gradFill rotWithShape="1">',r[r.length]="<a:gsLst>",r[r.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs>',r[r.length]="</a:gsLst>",r[r.length]='<a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path>',r[r.length]="</a:gradFill>",r[r.length]="</a:bgFillStyleLst>",r[r.length]="</a:fmtScheme>",r[r.length]="</a:themeElements>",r[r.length]="<a:objectDefaults>",r[r.length]="<a:spDef>",r[r.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="1"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="3"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="2"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="lt1"/></a:fontRef></a:style>',r[r.length]="</a:spDef>",r[r.length]="<a:lnDef>",r[r.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="2"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="0"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="1"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="tx1"/></a:fontRef></a:style>',r[r.length]="</a:lnDef>",r[r.length]="</a:objectDefaults>",r[r.length]="<a:extraClrSchemeLst/>",r[r.length]="</a:theme>",r.join("")}function Vxe(e,t){return{flags:e.read_shift(4),version:e.read_shift(4),name:Cl(e)}}function $xe(e){var t=vr(12+2*e.name.length);return t.write_shift(4,e.flags),t.write_shift(4,e.version),Xo(e.name,t),t.slice(0,t.l)}function qxe(e){for(var t=[],r=e.read_shift(4);r-- >0;)t.push([e.read_shift(4),e.read_shift(4)]);return t}function Gxe(e){var t=vr(4+8*e.length);t.write_shift(4,e.length);for(var r=0;r<e.length;++r)t.write_shift(4,e[r][0]),t.write_shift(4,e[r][1]);return t}function Wxe(e,t){var r=vr(8+2*t.length);return r.write_shift(4,e),Xo(t,r),r.slice(0,r.l)}function Hxe(e){return e.l+=4,e.read_shift(4)!=0}function Zxe(e,t){var r=vr(8);return r.write_shift(4,e),r.write_shift(4,1),r}function Xxe(){var e=Nc();return Ur(e,332),Ur(e,334,wd(1)),Ur(e,335,$xe({name:"XLDAPR",version:12e4,flags:3496657072})),Ur(e,336),Ur(e,339,Wxe(1,"XLDAPR")),Ur(e,52),Ur(e,35,wd(514)),Ur(e,4096,wd(0)),Ur(e,4097,_u(1)),Ur(e,36),Ur(e,53),Ur(e,340),Ur(e,337,Zxe(1)),Ur(e,51,Gxe([[1,0]])),Ur(e,338),Ur(e,333),e.end()}function qW(){var e=[No];return e.push(`<metadata xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:xlrd="http://schemas.microsoft.com/office/spreadsheetml/2017/richdata" xmlns:xda="http://schemas.microsoft.com/office/spreadsheetml/2017/dynamicarray">
  <metadataTypes count="1">
    <metadataType name="XLDAPR" minSupportedVersion="120000" copy="1" pasteAll="1" pasteValues="1" merge="1" splitFirst="1" rowColShift="1" clearFormats="1" clearComments="1" assign="1" coerce="1" cellMeta="1"/>
  </metadataTypes>
  <futureMetadata name="XLDAPR" count="1">
    <bk>
      <extLst>
        <ext uri="{bdbb8cdc-fa1e-496e-a857-3c3f30c029c3}">
          <xda:dynamicArrayProperties fDynamic="1" fCollapsed="0"/>
        </ext>
      </extLst>
    </bk>
  </futureMetadata>
  <cellMetadata count="1">
    <bk>
      <rc t="1" v="0"/>
    </bk>
  </cellMetadata>
</metadata>`),e.join("")}function Yxe(e){var t={};t.i=e.read_shift(4);var r={};r.r=e.read_shift(4),r.c=e.read_shift(4),t.r=ya(r);var s=e.read_shift(1);return s&2&&(t.l="1"),s&8&&(t.a="1"),t}var zx=1024;function GW(e,t){for(var r=[21600,21600],s=["m0,0l0",r[1],r[0],r[1],r[0],"0xe"].join(","),u=[pn("xml",null,{"xmlns:v":qc.v,"xmlns:o":qc.o,"xmlns:x":qc.x,"xmlns:mv":qc.mv}).replace(/\/>/,">"),pn("o:shapelayout",pn("o:idmap",null,{"v:ext":"edit",data:e}),{"v:ext":"edit"}),pn("v:shapetype",[pn("v:stroke",null,{joinstyle:"miter"}),pn("v:path",null,{gradientshapeok:"t","o:connecttype":"rect"})].join(""),{id:"_x0000_t202","o:spt":202,coordsize:r.join(","),path:s})];zx<e*1e3;)zx+=1e3;return t.forEach(function(f){var m=Zo(f[0]),i={color2:"#BEFF82",type:"gradient"};i.type=="gradient"&&(i.angle="-180");var S=i.type=="gradient"?pn("o:fill",null,{type:"gradientUnscaled","v:ext":"view"}):null,E=pn("v:fill",S,i),I={on:"t",obscured:"t"};++zx,u=u.concat(["<v:shape"+Eb({id:"_x0000_s"+zx,type:"#_x0000_t202",style:"position:absolute; margin-left:80pt;margin-top:5pt;width:104pt;height:64pt;z-index:10"+(f[1].hidden?";visibility:hidden":""),fillcolor:"#ECFAD4",strokecolor:"#edeaa1"})+">",E,pn("v:shadow",null,I),pn("v:path",null,{"o:connecttype":"none"}),'<v:textbox><div style="text-align:left"></div></v:textbox>','<x:ClientData ObjectType="Note">',"<x:MoveWithCells/>","<x:SizeWithCells/>",cl("x:Anchor",[m.c+1,0,m.r+1,0,m.c+3,20,m.r+5,20].join(",")),cl("x:AutoFill","False"),cl("x:Row",String(m.r)),cl("x:Column",String(m.c)),f[1].hidden?"":"<x:Visible/>","</x:ClientData>","</v:shape>"])}),u.push("</xml>"),u.join("")}function WW(e){var t=[No,pn("comments",null,{xmlns:Zv[0]})],r=[];return t.push("<authors>"),e.forEach(function(s){s[1].forEach(function(u){var f=xa(u.a);r.indexOf(f)==-1&&(r.push(f),t.push("<author>"+f+"</author>")),u.T&&u.ID&&r.indexOf("tc="+u.ID)==-1&&(r.push("tc="+u.ID),t.push("<author>tc="+u.ID+"</author>"))})}),r.length==0&&(r.push("SheetJ5"),t.push("<author>SheetJ5</author>")),t.push("</authors>"),t.push("<commentList>"),e.forEach(function(s){var u=0,f=[];if(s[1][0]&&s[1][0].T&&s[1][0].ID?u=r.indexOf("tc="+s[1][0].ID):s[1].forEach(function(S){S.a&&(u=r.indexOf(xa(S.a))),f.push(S.t||"")}),t.push('<comment ref="'+s[0]+'" authorId="'+u+'"><text>'),f.length<=1)t.push(cl("t",xa(f[0]||"")));else{for(var m=`Comment:
    `+f[0]+`
`,i=1;i<f.length;++i)m+=`Reply:
    `+f[i]+`
`;t.push(cl("t",xa(m)))}t.push("</text></comment>")}),t.push("</commentList>"),t.length>2&&(t[t.length]="</comments>",t[1]=t[1].replace("/>",">")),t.join("")}function Kxe(e,t,r){var s=[No,pn("ThreadedComments",null,{xmlns:Ho.TCMNT}).replace(/[\/]>/,">")];return e.forEach(function(u){var f="";(u[1]||[]).forEach(function(m,i){if(!m.T){delete m.ID;return}m.a&&t.indexOf(m.a)==-1&&t.push(m.a);var S={ref:u[0],id:"{54EE7951-7262-4200-6969-"+("000000000000"+r.tcid++).slice(-12)+"}"};i==0?f=S.id:S.parentId=f,m.ID=S.id,m.a&&(S.personId="{54EE7950-7262-4200-6969-"+("000000000000"+t.indexOf(m.a)).slice(-12)+"}"),s.push(pn("threadedComment",cl("text",m.t||""),S))})}),s.push("</ThreadedComments>"),s.join("")}function Jxe(e){var t=[No,pn("personList",null,{xmlns:Ho.TCMNT,"xmlns:x":Zv[0]}).replace(/[\/]>/,">")];return e.forEach(function(r,s){t.push(pn("person",null,{displayName:r,id:"{54EE7950-7262-4200-6969-"+("000000000000"+s).slice(-12)+"}",userId:r,providerId:"None"}))}),t.push("</personList>"),t.join("")}function Qxe(e){var t={};t.iauthor=e.read_shift(4);var r=M_(e);return t.rfx=r.s,t.ref=ya(r.s),e.l+=16,t}function eve(e,t){return t==null&&(t=vr(36)),t.write_shift(4,e[1].iauthor),Yv(e[0],t),t.write_shift(4,0),t.write_shift(4,0),t.write_shift(4,0),t.write_shift(4,0),t}var tve=Cl;function rve(e){return Xo(e.slice(0,54))}function nve(e){var t=Nc(),r=[];return Ur(t,628),Ur(t,630),e.forEach(function(s){s[1].forEach(function(u){r.indexOf(u.a)>-1||(r.push(u.a.slice(0,54)),Ur(t,632,rve(u.a)))})}),Ur(t,631),Ur(t,633),e.forEach(function(s){s[1].forEach(function(u){u.iauthor=r.indexOf(u.a);var f={s:Zo(s[0]),e:Zo(s[0])};Ur(t,635,eve([f,u])),u.t&&u.t.length>0&&Ur(t,637,s0e(u)),Ur(t,636),delete u.iauthor})}),Ur(t,634),Ur(t,629),t.end()}function ive(e,t){t.FullPaths.forEach(function(r,s){if(s!=0){var u=r.replace(/[^\/]*[\/]/,"/_VBA_PROJECT_CUR/");u.slice(-1)!=="/"&&Ta.utils.cfb_add(e,u,t.FileIndex[s].content)}})}var HW=["xlsb","xlsm","xlam","biff8","xla"],sve=function(){var e=/(^|[^A-Za-z_])R(\[?-?\d+\]|[1-9]\d*|)C(\[?-?\d+\]|[1-9]\d*|)(?![A-Za-z0-9_])/g,t={r:0,c:0};function r(s,u,f,m){var i=!1,S=!1;f.length==0?S=!0:f.charAt(0)=="["&&(S=!0,f=f.slice(1,-1)),m.length==0?i=!0:m.charAt(0)=="["&&(i=!0,m=m.slice(1,-1));var E=f.length>0?parseInt(f,10)|0:0,I=m.length>0?parseInt(m,10)|0:0;return i?I+=t.c:--I,S?E+=t.r:--E,u+(i?"":"$")+El(I)+(S?"":"$")+dl(E)}return function(u,f){return t=f,u.replace(e,r)}}(),kM=/(^|[^._A-Z0-9])([$]?)([A-Z]{1,2}|[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D])([$]?)(10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})(?![_.\(A-Za-z0-9])/g,PM=function(){return function(t,r){return t.replace(kM,function(s,u,f,m,i,S){var E=EM(m)-(f?0:r.c),I=TM(S)-(i?0:r.r),D=I==0?"":i?I+1:"["+I+"]",M=E==0?"":f?E+1:"["+E+"]";return u+"R"+D+"C"+M})}}();function ave(e,t){return e.replace(kM,function(r,s,u,f,m,i){return s+(u=="$"?u+f:El(EM(f)+t.c))+(m=="$"?m+i:dl(TM(i)+t.r))})}function ove(e){return e.length!=1}function Eo(e){e.l+=1}function gm(e,t){var r=e.read_shift(2);return[r&16383,r>>14&1,r>>15&1]}function ZW(e,t,r){var s=2;if(r){if(r.biff>=2&&r.biff<=5)return XW(e);r.biff==12&&(s=4)}var u=e.read_shift(s),f=e.read_shift(s),m=gm(e),i=gm(e);return{s:{r:u,c:m[0],cRel:m[1],rRel:m[2]},e:{r:f,c:i[0],cRel:i[1],rRel:i[2]}}}function XW(e){var t=gm(e),r=gm(e),s=e.read_shift(1),u=e.read_shift(1);return{s:{r:t[0],c:s,cRel:t[1],rRel:t[2]},e:{r:r[0],c:u,cRel:r[1],rRel:r[2]}}}function lve(e,t,r){if(r.biff<8)return XW(e);var s=e.read_shift(r.biff==12?4:2),u=e.read_shift(r.biff==12?4:2),f=gm(e),m=gm(e);return{s:{r:s,c:f[0],cRel:f[1],rRel:f[2]},e:{r:u,c:m[0],cRel:m[1],rRel:m[2]}}}function YW(e,t,r){if(r&&r.biff>=2&&r.biff<=5)return cve(e);var s=e.read_shift(r&&r.biff==12?4:2),u=gm(e);return{r:s,c:u[0],cRel:u[1],rRel:u[2]}}function cve(e){var t=gm(e),r=e.read_shift(1);return{r:t[0],c:r,cRel:t[1],rRel:t[2]}}function uve(e){var t=e.read_shift(2),r=e.read_shift(2);return{r:t,c:r&255,fQuoted:!!(r&16384),cRel:r>>15,rRel:r>>15}}function dve(e,t,r){var s=r&&r.biff?r.biff:8;if(s>=2&&s<=5)return hve(e);var u=e.read_shift(s>=12?4:2),f=e.read_shift(2),m=(f&16384)>>14,i=(f&32768)>>15;if(f&=16383,i==1)for(;u>524287;)u-=1048576;if(m==1)for(;f>8191;)f=f-16384;return{r:u,c:f,cRel:m,rRel:i}}function hve(e){var t=e.read_shift(2),r=e.read_shift(1),s=(t&32768)>>15,u=(t&16384)>>14;return t&=16383,s==1&&t>=8192&&(t=t-16384),u==1&&r>=128&&(r=r-256),{r:t,c:r,cRel:u,rRel:s}}function fve(e,t,r){var s=(e[e.l++]&96)>>5,u=ZW(e,r.biff>=2&&r.biff<=5?6:8,r);return[s,u]}function pve(e,t,r){var s=(e[e.l++]&96)>>5,u=e.read_shift(2,"i"),f=8;if(r)switch(r.biff){case 5:e.l+=12,f=6;break;case 12:f=12;break}var m=ZW(e,f,r);return[s,u,m]}function mve(e,t,r){var s=(e[e.l++]&96)>>5;return e.l+=r&&r.biff>8?12:r.biff<8?6:8,[s]}function gve(e,t,r){var s=(e[e.l++]&96)>>5,u=e.read_shift(2),f=8;if(r)switch(r.biff){case 5:e.l+=12,f=6;break;case 12:f=12;break}return e.l+=f,[s,u]}function _ve(e,t,r){var s=(e[e.l++]&96)>>5,u=lve(e,t-1,r);return[s,u]}function xve(e,t,r){var s=(e[e.l++]&96)>>5;return e.l+=r.biff==2?6:r.biff==12?14:7,[s]}function L5(e){var t=e[e.l+1]&1,r=1;return e.l+=4,[t,r]}function vve(e,t,r){e.l+=2;for(var s=e.read_shift(r&&r.biff==2?1:2),u=[],f=0;f<=s;++f)u.push(e.read_shift(r&&r.biff==2?1:2));return u}function yve(e,t,r){var s=e[e.l+1]&255?1:0;return e.l+=2,[s,e.read_shift(r&&r.biff==2?1:2)]}function wve(e,t,r){var s=e[e.l+1]&255?1:0;return e.l+=2,[s,e.read_shift(r&&r.biff==2?1:2)]}function bve(e){var t=e[e.l+1]&255?1:0;return e.l+=2,[t,e.read_shift(2)]}function Sve(e,t,r){var s=e[e.l+1]&255?1:0;return e.l+=r&&r.biff==2?3:4,[s]}function KW(e){var t=e.read_shift(1),r=e.read_shift(1);return[t,r]}function Tve(e){return e.read_shift(2),KW(e)}function Eve(e){return e.read_shift(2),KW(e)}function Cve(e,t,r){var s=(e[e.l]&96)>>5;e.l+=1;var u=YW(e,0,r);return[s,u]}function Ave(e,t,r){var s=(e[e.l]&96)>>5;e.l+=1;var u=dve(e,0,r);return[s,u]}function jve(e,t,r){var s=(e[e.l]&96)>>5;e.l+=1;var u=e.read_shift(2);r&&r.biff==5&&(e.l+=12);var f=YW(e,0,r);return[s,u,f]}function Ive(e,t,r){var s=(e[e.l]&96)>>5;e.l+=1;var u=e.read_shift(r&&r.biff<=3?1:2);return[Iye[u],eH[u],s]}function Nve(e,t,r){var s=e[e.l++],u=e.read_shift(1),f=r&&r.biff<=3?[s==88?-1:0,e.read_shift(1)]:kve(e);return[u,(f[0]===0?eH:jye)[f[1]]]}function kve(e){return[e[e.l+1]>>7,e.read_shift(2)&32767]}function Pve(e,t,r){e.l+=r&&r.biff==2?3:4}function Dve(e,t,r){if(e.l++,r&&r.biff==12)return[e.read_shift(4,"i"),0];var s=e.read_shift(2),u=e.read_shift(r&&r.biff==2?1:2);return[s,u]}function Rve(e){return e.l++,i2[e.read_shift(1)]}function Mve(e){return e.l++,e.read_shift(2)}function Ove(e){return e.l++,e.read_shift(1)!==0}function Fve(e){return e.l++,Kv(e)}function Lve(e,t,r){return e.l++,DW(e,t-1,r)}function zve(e,t){var r=[e.read_shift(1)];if(t==12)switch(r[0]){case 2:r[0]=4;break;case 4:r[0]=16;break;case 0:r[0]=1;break;case 1:r[0]=2;break}switch(r[0]){case 4:r[1]=j0e(e,1)?"TRUE":"FALSE",t!=12&&(e.l+=7);break;case 37:case 16:r[1]=i2[e[e.l]],e.l+=t==12?4:8;break;case 0:e.l+=8;break;case 1:r[1]=Kv(e);break;case 2:r[1]=P0e(e,0,{biff:t>0&&t<8?2:t});break;default:throw new Error("Bad SerAr: "+r[0])}return r}function Bve(e,t,r){for(var s=e.read_shift(r.biff==12?4:2),u=[],f=0;f!=s;++f)u.push((r.biff==12?M_:M0e)(e));return u}function Uve(e,t,r){var s=0,u=0;r.biff==12?(s=e.read_shift(4),u=e.read_shift(4)):(u=1+e.read_shift(1),s=1+e.read_shift(2)),r.biff>=2&&r.biff<8&&(--s,--u==0&&(u=256));for(var f=0,m=[];f!=s&&(m[f]=[]);++f)for(var i=0;i!=u;++i)m[f][i]=zve(e,r.biff);return m}function Vve(e,t,r){var s=e.read_shift(1)>>>5&3,u=!r||r.biff>=8?4:2,f=e.read_shift(u);switch(r.biff){case 2:e.l+=5;break;case 3:case 4:e.l+=8;break;case 5:e.l+=12;break}return[s,0,f]}function $ve(e,t,r){if(r.biff==5)return qve(e);var s=e.read_shift(1)>>>5&3,u=e.read_shift(2),f=e.read_shift(4);return[s,u,f]}function qve(e){var t=e.read_shift(1)>>>5&3,r=e.read_shift(2,"i");e.l+=8;var s=e.read_shift(2);return e.l+=12,[t,r,s]}function Gve(e,t,r){var s=e.read_shift(1)>>>5&3;e.l+=r&&r.biff==2?3:4;var u=e.read_shift(r&&r.biff==2?1:2);return[s,u]}function Wve(e,t,r){var s=e.read_shift(1)>>>5&3,u=e.read_shift(r&&r.biff==2?1:2);return[s,u]}function Hve(e,t,r){var s=e.read_shift(1)>>>5&3;return e.l+=4,r.biff<8&&e.l--,r.biff==12&&(e.l+=2),[s]}function Zve(e,t,r){var s=(e[e.l++]&96)>>5,u=e.read_shift(2),f=4;if(r)switch(r.biff){case 5:f=15;break;case 12:f=6;break}return e.l+=f,[s,u]}var Xve=_h,Yve=_h,Kve=_h;function s2(e,t,r){return e.l+=2,[uve(e)]}function DM(e){return e.l+=6,[]}var Jve=s2,Qve=DM,eye=DM,tye=s2;function JW(e){return e.l+=2,[kW(e),e.read_shift(2)&1]}var rye=s2,nye=JW,iye=DM,sye=s2,aye=s2,oye=["Data","All","Headers","??","?Data2","??","?DataHeaders","??","Totals","??","??","??","?DataTotals","??","??","??","?Current"];function lye(e){e.l+=2;var t=e.read_shift(2),r=e.read_shift(2),s=e.read_shift(4),u=e.read_shift(2),f=e.read_shift(2),m=oye[r>>2&31];return{ixti:t,coltype:r&3,rt:m,idx:s,c:u,C:f}}function cye(e){return e.l+=2,[e.read_shift(4)]}function uye(e,t,r){return e.l+=5,e.l+=2,e.l+=r.biff==2?1:4,["PTGSHEET"]}function dye(e,t,r){return e.l+=r.biff==2?4:5,["PTGENDSHEET"]}function hye(e){var t=e.read_shift(1)>>>5&3,r=e.read_shift(2);return[t,r]}function fye(e){var t=e.read_shift(1)>>>5&3,r=e.read_shift(2);return[t,r]}function pye(e){return e.l+=4,[0,0]}var z5={1:{n:"PtgExp",f:Dve},2:{n:"PtgTbl",f:Kve},3:{n:"PtgAdd",f:Eo},4:{n:"PtgSub",f:Eo},5:{n:"PtgMul",f:Eo},6:{n:"PtgDiv",f:Eo},7:{n:"PtgPower",f:Eo},8:{n:"PtgConcat",f:Eo},9:{n:"PtgLt",f:Eo},10:{n:"PtgLe",f:Eo},11:{n:"PtgEq",f:Eo},12:{n:"PtgGe",f:Eo},13:{n:"PtgGt",f:Eo},14:{n:"PtgNe",f:Eo},15:{n:"PtgIsect",f:Eo},16:{n:"PtgUnion",f:Eo},17:{n:"PtgRange",f:Eo},18:{n:"PtgUplus",f:Eo},19:{n:"PtgUminus",f:Eo},20:{n:"PtgPercent",f:Eo},21:{n:"PtgParen",f:Eo},22:{n:"PtgMissArg",f:Eo},23:{n:"PtgStr",f:Lve},26:{n:"PtgSheet",f:uye},27:{n:"PtgEndSheet",f:dye},28:{n:"PtgErr",f:Rve},29:{n:"PtgBool",f:Ove},30:{n:"PtgInt",f:Mve},31:{n:"PtgNum",f:Fve},32:{n:"PtgArray",f:xve},33:{n:"PtgFunc",f:Ive},34:{n:"PtgFuncVar",f:Nve},35:{n:"PtgName",f:Vve},36:{n:"PtgRef",f:Cve},37:{n:"PtgArea",f:fve},38:{n:"PtgMemArea",f:Gve},39:{n:"PtgMemErr",f:Xve},40:{n:"PtgMemNoMem",f:Yve},41:{n:"PtgMemFunc",f:Wve},42:{n:"PtgRefErr",f:Hve},43:{n:"PtgAreaErr",f:mve},44:{n:"PtgRefN",f:Ave},45:{n:"PtgAreaN",f:_ve},46:{n:"PtgMemAreaN",f:hye},47:{n:"PtgMemNoMemN",f:fye},57:{n:"PtgNameX",f:$ve},58:{n:"PtgRef3d",f:jve},59:{n:"PtgArea3d",f:pve},60:{n:"PtgRefErr3d",f:Zve},61:{n:"PtgAreaErr3d",f:gve},255:{}},mye={64:32,96:32,65:33,97:33,66:34,98:34,67:35,99:35,68:36,100:36,69:37,101:37,70:38,102:38,71:39,103:39,72:40,104:40,73:41,105:41,74:42,106:42,75:43,107:43,76:44,108:44,77:45,109:45,78:46,110:46,79:47,111:47,88:34,120:34,89:57,121:57,90:58,122:58,91:59,123:59,92:60,124:60,93:61,125:61},gye={1:{n:"PtgElfLel",f:JW},2:{n:"PtgElfRw",f:sye},3:{n:"PtgElfCol",f:Jve},6:{n:"PtgElfRwV",f:aye},7:{n:"PtgElfColV",f:tye},10:{n:"PtgElfRadical",f:rye},11:{n:"PtgElfRadicalS",f:iye},13:{n:"PtgElfColS",f:Qve},15:{n:"PtgElfColSV",f:eye},16:{n:"PtgElfRadicalLel",f:nye},25:{n:"PtgList",f:lye},29:{n:"PtgSxName",f:cye},255:{}},_ye={0:{n:"PtgAttrNoop",f:pye},1:{n:"PtgAttrSemi",f:Sve},2:{n:"PtgAttrIf",f:wve},4:{n:"PtgAttrChoose",f:vve},8:{n:"PtgAttrGoto",f:yve},16:{n:"PtgAttrSum",f:Pve},32:{n:"PtgAttrBaxcel",f:L5},33:{n:"PtgAttrBaxcel",f:L5},64:{n:"PtgAttrSpace",f:Tve},65:{n:"PtgAttrSpaceSemi",f:Eve},128:{n:"PtgAttrIfError",f:bve},255:{}};function xye(e,t,r,s){if(s.biff<8)return _h(e,t);for(var u=e.l+t,f=[],m=0;m!==r.length;++m)switch(r[m][0]){case"PtgArray":r[m][1]=Uve(e,0,s),f.push(r[m][1]);break;case"PtgMemArea":r[m][2]=Bve(e,r[m][1],s),f.push(r[m][2]);break;case"PtgExp":s&&s.biff==12&&(r[m][1][1]=e.read_shift(4),f.push(r[m][1]));break;case"PtgList":case"PtgElfRadicalS":case"PtgElfColS":case"PtgElfColSV":throw"Unsupported "+r[m][0]}return t=u-e.l,t!==0&&f.push(_h(e,t)),f}function vye(e,t,r){for(var s=e.l+t,u,f,m=[];s!=e.l;)t=s-e.l,f=e[e.l],u=z5[f]||z5[mye[f]],(f===24||f===25)&&(u=(f===24?gye:_ye)[e[e.l+1]]),!u||!u.f?_h(e,t):m.push([u.n,u.f(e,t,r)]);return m}function yye(e){for(var t=[],r=0;r<e.length;++r){for(var s=e[r],u=[],f=0;f<s.length;++f){var m=s[f];if(m)switch(m[0]){case 2:u.push('"'+m[1].replace(/"/g,'""')+'"');break;default:u.push(m[1])}else u.push("")}t.push(u.join(","))}return t.join(";")}var wye={PtgAdd:"+",PtgConcat:"&",PtgDiv:"/",PtgEq:"=",PtgGe:">=",PtgGt:">",PtgLe:"<=",PtgLt:"<",PtgMul:"*",PtgNe:"<>",PtgPower:"^",PtgSub:"-"};function bye(e,t){if(!e&&!(t&&t.biff<=5&&t.biff>=2))throw new Error("empty sheet name");return/[^\w\u4E00-\u9FFF\u3040-\u30FF]/.test(e)?"'"+e+"'":e}function QW(e,t,r){if(!e)return"SH33TJSERR0";if(r.biff>8&&(!e.XTI||!e.XTI[t]))return e.SheetNames[t];if(!e.XTI)return"SH33TJSERR6";var s=e.XTI[t];if(r.biff<8)return t>1e4&&(t-=65536),t<0&&(t=-t),t==0?"":e.XTI[t-1];if(!s)return"SH33TJSERR1";var u="";if(r.biff>8)switch(e[s[0]][0]){case 357:return u=s[1]==-1?"#REF":e.SheetNames[s[1]],s[1]==s[2]?u:u+":"+e.SheetNames[s[2]];case 358:return r.SID!=null?e.SheetNames[r.SID]:"SH33TJSSAME"+e[s[0]][0];case 355:default:return"SH33TJSSRC"+e[s[0]][0]}switch(e[s[0]][0][0]){case 1025:return u=s[1]==-1?"#REF":e.SheetNames[s[1]]||"SH33TJSERR3",s[1]==s[2]?u:u+":"+e.SheetNames[s[2]];case 14849:return e[s[0]].slice(1).map(function(f){return f.Name}).join(";;");default:return e[s[0]][0][3]?(u=s[1]==-1?"#REF":e[s[0]][0][3][s[1]]||"SH33TJSERR4",s[1]==s[2]?u:u+":"+e[s[0]][0][3][s[2]]):"SH33TJSERR2"}}function B5(e,t,r){var s=QW(e,t,r);return s=="#REF"?s:bye(s,r)}function Dv(e,t,r,s,u){var f=u&&u.biff||8,m={s:{c:0,r:0},e:{c:0,r:0}},i=[],S,E,I,D=0,M=0,R,H="";if(!e[0]||!e[0][0])return"";for(var F=-1,U="",Y=0,z=e[0].length;Y<z;++Y){var J=e[0][Y];switch(J[0]){case"PtgUminus":i.push("-"+i.pop());break;case"PtgUplus":i.push("+"+i.pop());break;case"PtgPercent":i.push(i.pop()+"%");break;case"PtgAdd":case"PtgConcat":case"PtgDiv":case"PtgEq":case"PtgGe":case"PtgGt":case"PtgLe":case"PtgLt":case"PtgMul":case"PtgNe":case"PtgPower":case"PtgSub":if(S=i.pop(),E=i.pop(),F>=0){switch(e[0][F][1][0]){case 0:U=fo(" ",e[0][F][1][1]);break;case 1:U=fo("\r",e[0][F][1][1]);break;default:if(U="",u.WTF)throw new Error("Unexpected PtgAttrSpaceType "+e[0][F][1][0])}E=E+U,F=-1}i.push(E+wye[J[0]]+S);break;case"PtgIsect":S=i.pop(),E=i.pop(),i.push(E+" "+S);break;case"PtgUnion":S=i.pop(),E=i.pop(),i.push(E+","+S);break;case"PtgRange":S=i.pop(),E=i.pop(),i.push(E+":"+S);break;case"PtgAttrChoose":break;case"PtgAttrGoto":break;case"PtgAttrIf":break;case"PtgAttrIfError":break;case"PtgRef":I=Uw(J[1][1],m,u),i.push(Vw(I,f));break;case"PtgRefN":I=r?Uw(J[1][1],r,u):J[1][1],i.push(Vw(I,f));break;case"PtgRef3d":D=J[1][1],I=Uw(J[1][2],m,u),H=B5(s,D,u),i.push(H+"!"+Vw(I,f));break;case"PtgFunc":case"PtgFuncVar":var ne=J[1][0],me=J[1][1];ne||(ne=0),ne&=127;var le=ne==0?[]:i.slice(-ne);i.length-=ne,me==="User"&&(me=le.shift()),i.push(me+"("+le.join(",")+")");break;case"PtgBool":i.push(J[1]?"TRUE":"FALSE");break;case"PtgInt":i.push(J[1]);break;case"PtgNum":i.push(String(J[1]));break;case"PtgStr":i.push('"'+J[1].replace(/"/g,'""')+'"');break;case"PtgErr":i.push(J[1]);break;case"PtgAreaN":R=T5(J[1][1],r?{s:r}:m,u),i.push(HN(R,u));break;case"PtgArea":R=T5(J[1][1],m,u),i.push(HN(R,u));break;case"PtgArea3d":D=J[1][1],R=J[1][2],H=B5(s,D,u),i.push(H+"!"+HN(R,u));break;case"PtgAttrSum":i.push("SUM("+i.pop()+")");break;case"PtgAttrBaxcel":case"PtgAttrSemi":break;case"PtgName":M=J[1][2];var ye=(s.names||[])[M-1]||(s[0]||[])[M],pe=ye?ye.Name:"SH33TJSNAME"+String(M);pe&&pe.slice(0,6)=="_xlfn."&&!u.xlfn&&(pe=pe.slice(6)),i.push(pe);break;case"PtgNameX":var be=J[1][1];M=J[1][2];var ke;if(u.biff<=5)be<0&&(be=-be),s[be]&&(ke=s[be][M]);else{var Oe="";if(((s[be]||[])[0]||[])[0]==14849||(((s[be]||[])[0]||[])[0]==1025?s[be][M]&&s[be][M].itab>0&&(Oe=s.SheetNames[s[be][M].itab-1]+"!"):Oe=s.SheetNames[M-1]+"!"),s[be]&&s[be][M])Oe+=s[be][M].Name;else if(s[0]&&s[0][M])Oe+=s[0][M].Name;else{var Ee=(QW(s,be,u)||"").split(";;");Ee[M-1]?Oe=Ee[M-1]:Oe+="SH33TJSERRX"}i.push(Oe);break}ke||(ke={Name:"SH33TJSERRY"}),i.push(ke.Name);break;case"PtgParen":var qe="(",Qe=")";if(F>=0){switch(U="",e[0][F][1][0]){case 2:qe=fo(" ",e[0][F][1][1])+qe;break;case 3:qe=fo("\r",e[0][F][1][1])+qe;break;case 4:Qe=fo(" ",e[0][F][1][1])+Qe;break;case 5:Qe=fo("\r",e[0][F][1][1])+Qe;break;default:if(u.WTF)throw new Error("Unexpected PtgAttrSpaceType "+e[0][F][1][0])}F=-1}i.push(qe+i.pop()+Qe);break;case"PtgRefErr":i.push("#REF!");break;case"PtgRefErr3d":i.push("#REF!");break;case"PtgExp":I={c:J[1][1],r:J[1][0]};var gt={c:r.c,r:r.r};if(s.sharedf[ya(I)]){var Xe=s.sharedf[ya(I)];i.push(Dv(Xe,m,gt,s,u))}else{var ct=!1;for(S=0;S!=s.arrayf.length;++S)if(E=s.arrayf[S],!(I.c<E[0].s.c||I.c>E[0].e.c)&&!(I.r<E[0].s.r||I.r>E[0].e.r)){i.push(Dv(E[1],m,gt,s,u)),ct=!0;break}ct||i.push(J[1])}break;case"PtgArray":i.push("{"+yye(J[1])+"}");break;case"PtgMemArea":break;case"PtgAttrSpace":case"PtgAttrSpaceSemi":F=Y;break;case"PtgTbl":break;case"PtgMemErr":break;case"PtgMissArg":i.push("");break;case"PtgAreaErr":i.push("#REF!");break;case"PtgAreaErr3d":i.push("#REF!");break;case"PtgList":i.push("Table"+J[1].idx+"[#"+J[1].rt+"]");break;case"PtgMemAreaN":case"PtgMemNoMemN":case"PtgAttrNoop":case"PtgSheet":case"PtgEndSheet":break;case"PtgMemFunc":break;case"PtgMemNoMem":break;case"PtgElfCol":case"PtgElfColS":case"PtgElfColSV":case"PtgElfColV":case"PtgElfLel":case"PtgElfRadical":case"PtgElfRadicalLel":case"PtgElfRadicalS":case"PtgElfRw":case"PtgElfRwV":throw new Error("Unsupported ELFs");case"PtgSxName":throw new Error("Unrecognized Formula Token: "+String(J));default:throw new Error("Unrecognized Formula Token: "+String(J))}var Me=["PtgAttrSpace","PtgAttrSpaceSemi","PtgAttrGoto"];if(u.biff!=3&&F>=0&&Me.indexOf(e[0][Y][0])==-1){J=e[0][F];var mt=!0;switch(J[1][0]){case 4:mt=!1;case 0:U=fo(" ",J[1][1]);break;case 5:mt=!1;case 1:U=fo("\r",J[1][1]);break;default:if(U="",u.WTF)throw new Error("Unexpected PtgAttrSpaceType "+J[1][0])}i.push((mt?U:"")+i.pop()+(mt?"":U)),F=-1}}if(i.length>1&&u.WTF)throw new Error("bad formula stack");return i[0]}function Sye(e){if(e==null){var t=vr(8);return t.write_shift(1,3),t.write_shift(1,0),t.write_shift(2,0),t.write_shift(2,0),t.write_shift(2,65535),t}else if(typeof e=="number")return E_(e);return E_(0)}function Tye(e,t,r,s,u){var f=C_(t,r,u),m=Sye(e.v),i=vr(6),S=33;i.write_shift(2,S),i.write_shift(4,0);for(var E=vr(e.bf.length),I=0;I<e.bf.length;++I)E[I]=e.bf[I];var D=ll([f,m,i,E]);return D}function AA(e,t,r){var s=e.read_shift(4),u=vye(e,s,r),f=e.read_shift(4),m=f>0?xye(e,f,u,r):null;return[u,m]}var Eye=AA,jA=AA,Cye=AA,Aye=AA,jye={0:"BEEP",1:"OPEN",2:"OPEN.LINKS",3:"CLOSE.ALL",4:"SAVE",5:"SAVE.AS",6:"FILE.DELETE",7:"PAGE.SETUP",8:"PRINT",9:"PRINTER.SETUP",10:"QUIT",11:"NEW.WINDOW",12:"ARRANGE.ALL",13:"WINDOW.SIZE",14:"WINDOW.MOVE",15:"FULL",16:"CLOSE",17:"RUN",22:"SET.PRINT.AREA",23:"SET.PRINT.TITLES",24:"SET.PAGE.BREAK",25:"REMOVE.PAGE.BREAK",26:"FONT",27:"DISPLAY",28:"PROTECT.DOCUMENT",29:"PRECISION",30:"A1.R1C1",31:"CALCULATE.NOW",32:"CALCULATION",34:"DATA.FIND",35:"EXTRACT",36:"DATA.DELETE",37:"SET.DATABASE",38:"SET.CRITERIA",39:"SORT",40:"DATA.SERIES",41:"TABLE",42:"FORMAT.NUMBER",43:"ALIGNMENT",44:"STYLE",45:"BORDER",46:"CELL.PROTECTION",47:"COLUMN.WIDTH",48:"UNDO",49:"CUT",50:"COPY",51:"PASTE",52:"CLEAR",53:"PASTE.SPECIAL",54:"EDIT.DELETE",55:"INSERT",56:"FILL.RIGHT",57:"FILL.DOWN",61:"DEFINE.NAME",62:"CREATE.NAMES",63:"FORMULA.GOTO",64:"FORMULA.FIND",65:"SELECT.LAST.CELL",66:"SHOW.ACTIVE.CELL",67:"GALLERY.AREA",68:"GALLERY.BAR",69:"GALLERY.COLUMN",70:"GALLERY.LINE",71:"GALLERY.PIE",72:"GALLERY.SCATTER",73:"COMBINATION",74:"PREFERRED",75:"ADD.OVERLAY",76:"GRIDLINES",77:"SET.PREFERRED",78:"AXES",79:"LEGEND",80:"ATTACH.TEXT",81:"ADD.ARROW",82:"SELECT.CHART",83:"SELECT.PLOT.AREA",84:"PATTERNS",85:"MAIN.CHART",86:"OVERLAY",87:"SCALE",88:"FORMAT.LEGEND",89:"FORMAT.TEXT",90:"EDIT.REPEAT",91:"PARSE",92:"JUSTIFY",93:"HIDE",94:"UNHIDE",95:"WORKSPACE",96:"FORMULA",97:"FORMULA.FILL",98:"FORMULA.ARRAY",99:"DATA.FIND.NEXT",100:"DATA.FIND.PREV",101:"FORMULA.FIND.NEXT",102:"FORMULA.FIND.PREV",103:"ACTIVATE",104:"ACTIVATE.NEXT",105:"ACTIVATE.PREV",106:"UNLOCKED.NEXT",107:"UNLOCKED.PREV",108:"COPY.PICTURE",109:"SELECT",110:"DELETE.NAME",111:"DELETE.FORMAT",112:"VLINE",113:"HLINE",114:"VPAGE",115:"HPAGE",116:"VSCROLL",117:"HSCROLL",118:"ALERT",119:"NEW",120:"CANCEL.COPY",121:"SHOW.CLIPBOARD",122:"MESSAGE",124:"PASTE.LINK",125:"APP.ACTIVATE",126:"DELETE.ARROW",127:"ROW.HEIGHT",128:"FORMAT.MOVE",129:"FORMAT.SIZE",130:"FORMULA.REPLACE",131:"SEND.KEYS",132:"SELECT.SPECIAL",133:"APPLY.NAMES",134:"REPLACE.FONT",135:"FREEZE.PANES",136:"SHOW.INFO",137:"SPLIT",138:"ON.WINDOW",139:"ON.DATA",140:"DISABLE.INPUT",142:"OUTLINE",143:"LIST.NAMES",144:"FILE.CLOSE",145:"SAVE.WORKBOOK",146:"DATA.FORM",147:"COPY.CHART",148:"ON.TIME",149:"WAIT",150:"FORMAT.FONT",151:"FILL.UP",152:"FILL.LEFT",153:"DELETE.OVERLAY",155:"SHORT.MENUS",159:"SET.UPDATE.STATUS",161:"COLOR.PALETTE",162:"DELETE.STYLE",163:"WINDOW.RESTORE",164:"WINDOW.MAXIMIZE",166:"CHANGE.LINK",167:"CALCULATE.DOCUMENT",168:"ON.KEY",169:"APP.RESTORE",170:"APP.MOVE",171:"APP.SIZE",172:"APP.MINIMIZE",173:"APP.MAXIMIZE",174:"BRING.TO.FRONT",175:"SEND.TO.BACK",185:"MAIN.CHART.TYPE",186:"OVERLAY.CHART.TYPE",187:"SELECT.END",188:"OPEN.MAIL",189:"SEND.MAIL",190:"STANDARD.FONT",191:"CONSOLIDATE",192:"SORT.SPECIAL",193:"GALLERY.3D.AREA",194:"GALLERY.3D.COLUMN",195:"GALLERY.3D.LINE",196:"GALLERY.3D.PIE",197:"VIEW.3D",198:"GOAL.SEEK",199:"WORKGROUP",200:"FILL.GROUP",201:"UPDATE.LINK",202:"PROMOTE",203:"DEMOTE",204:"SHOW.DETAIL",206:"UNGROUP",207:"OBJECT.PROPERTIES",208:"SAVE.NEW.OBJECT",209:"SHARE",210:"SHARE.NAME",211:"DUPLICATE",212:"APPLY.STYLE",213:"ASSIGN.TO.OBJECT",214:"OBJECT.PROTECTION",215:"HIDE.OBJECT",216:"SET.EXTRACT",217:"CREATE.PUBLISHER",218:"SUBSCRIBE.TO",219:"ATTRIBUTES",220:"SHOW.TOOLBAR",222:"PRINT.PREVIEW",223:"EDIT.COLOR",224:"SHOW.LEVELS",225:"FORMAT.MAIN",226:"FORMAT.OVERLAY",227:"ON.RECALC",228:"EDIT.SERIES",229:"DEFINE.STYLE",240:"LINE.PRINT",243:"ENTER.DATA",249:"GALLERY.RADAR",250:"MERGE.STYLES",251:"EDITION.OPTIONS",252:"PASTE.PICTURE",253:"PASTE.PICTURE.LINK",254:"SPELLING",256:"ZOOM",259:"INSERT.OBJECT",260:"WINDOW.MINIMIZE",265:"SOUND.NOTE",266:"SOUND.PLAY",267:"FORMAT.SHAPE",268:"EXTEND.POLYGON",269:"FORMAT.AUTO",272:"GALLERY.3D.BAR",273:"GALLERY.3D.SURFACE",274:"FILL.AUTO",276:"CUSTOMIZE.TOOLBAR",277:"ADD.TOOL",278:"EDIT.OBJECT",279:"ON.DOUBLECLICK",280:"ON.ENTRY",281:"WORKBOOK.ADD",282:"WORKBOOK.MOVE",283:"WORKBOOK.COPY",284:"WORKBOOK.OPTIONS",285:"SAVE.WORKSPACE",288:"CHART.WIZARD",289:"DELETE.TOOL",290:"MOVE.TOOL",291:"WORKBOOK.SELECT",292:"WORKBOOK.ACTIVATE",293:"ASSIGN.TO.TOOL",295:"COPY.TOOL",296:"RESET.TOOL",297:"CONSTRAIN.NUMERIC",298:"PASTE.TOOL",302:"WORKBOOK.NEW",305:"SCENARIO.CELLS",306:"SCENARIO.DELETE",307:"SCENARIO.ADD",308:"SCENARIO.EDIT",309:"SCENARIO.SHOW",310:"SCENARIO.SHOW.NEXT",311:"SCENARIO.SUMMARY",312:"PIVOT.TABLE.WIZARD",313:"PIVOT.FIELD.PROPERTIES",314:"PIVOT.FIELD",315:"PIVOT.ITEM",316:"PIVOT.ADD.FIELDS",318:"OPTIONS.CALCULATION",319:"OPTIONS.EDIT",320:"OPTIONS.VIEW",321:"ADDIN.MANAGER",322:"MENU.EDITOR",323:"ATTACH.TOOLBARS",324:"VBAActivate",325:"OPTIONS.CHART",328:"VBA.INSERT.FILE",330:"VBA.PROCEDURE.DEFINITION",336:"ROUTING.SLIP",338:"ROUTE.DOCUMENT",339:"MAIL.LOGON",342:"INSERT.PICTURE",343:"EDIT.TOOL",344:"GALLERY.DOUGHNUT",350:"CHART.TREND",352:"PIVOT.ITEM.PROPERTIES",354:"WORKBOOK.INSERT",355:"OPTIONS.TRANSITION",356:"OPTIONS.GENERAL",370:"FILTER.ADVANCED",373:"MAIL.ADD.MAILER",374:"MAIL.DELETE.MAILER",375:"MAIL.REPLY",376:"MAIL.REPLY.ALL",377:"MAIL.FORWARD",378:"MAIL.NEXT.LETTER",379:"DATA.LABEL",380:"INSERT.TITLE",381:"FONT.PROPERTIES",382:"MACRO.OPTIONS",383:"WORKBOOK.HIDE",384:"WORKBOOK.UNHIDE",385:"WORKBOOK.DELETE",386:"WORKBOOK.NAME",388:"GALLERY.CUSTOM",390:"ADD.CHART.AUTOFORMAT",391:"DELETE.CHART.AUTOFORMAT",392:"CHART.ADD.DATA",393:"AUTO.OUTLINE",394:"TAB.ORDER",395:"SHOW.DIALOG",396:"SELECT.ALL",397:"UNGROUP.SHEETS",398:"SUBTOTAL.CREATE",399:"SUBTOTAL.REMOVE",400:"RENAME.OBJECT",412:"WORKBOOK.SCROLL",413:"WORKBOOK.NEXT",414:"WORKBOOK.PREV",415:"WORKBOOK.TAB.SPLIT",416:"FULL.SCREEN",417:"WORKBOOK.PROTECT",420:"SCROLLBAR.PROPERTIES",421:"PIVOT.SHOW.PAGES",422:"TEXT.TO.COLUMNS",423:"FORMAT.CHARTTYPE",424:"LINK.FORMAT",425:"TRACER.DISPLAY",430:"TRACER.NAVIGATE",431:"TRACER.CLEAR",432:"TRACER.ERROR",433:"PIVOT.FIELD.GROUP",434:"PIVOT.FIELD.UNGROUP",435:"CHECKBOX.PROPERTIES",436:"LABEL.PROPERTIES",437:"LISTBOX.PROPERTIES",438:"EDITBOX.PROPERTIES",439:"PIVOT.REFRESH",440:"LINK.COMBO",441:"OPEN.TEXT",442:"HIDE.DIALOG",443:"SET.DIALOG.FOCUS",444:"ENABLE.OBJECT",445:"PUSHBUTTON.PROPERTIES",446:"SET.DIALOG.DEFAULT",447:"FILTER",448:"FILTER.SHOW.ALL",449:"CLEAR.OUTLINE",450:"FUNCTION.WIZARD",451:"ADD.LIST.ITEM",452:"SET.LIST.ITEM",453:"REMOVE.LIST.ITEM",454:"SELECT.LIST.ITEM",455:"SET.CONTROL.VALUE",456:"SAVE.COPY.AS",458:"OPTIONS.LISTS.ADD",459:"OPTIONS.LISTS.DELETE",460:"SERIES.AXES",461:"SERIES.X",462:"SERIES.Y",463:"ERRORBAR.X",464:"ERRORBAR.Y",465:"FORMAT.CHART",466:"SERIES.ORDER",467:"MAIL.LOGOFF",468:"CLEAR.ROUTING.SLIP",469:"APP.ACTIVATE.MICROSOFT",470:"MAIL.EDIT.MAILER",471:"ON.SHEET",472:"STANDARD.WIDTH",473:"SCENARIO.MERGE",474:"SUMMARY.INFO",475:"FIND.FILE",476:"ACTIVE.CELL.FONT",477:"ENABLE.TIPWIZARD",478:"VBA.MAKE.ADDIN",480:"INSERTDATATABLE",481:"WORKGROUP.OPTIONS",482:"MAIL.SEND.MAILER",485:"AUTOCORRECT",489:"POST.DOCUMENT",491:"PICKLIST",493:"VIEW.SHOW",494:"VIEW.DEFINE",495:"VIEW.DELETE",509:"SHEET.BACKGROUND",510:"INSERT.MAP.OBJECT",511:"OPTIONS.MENONO",517:"MSOCHECKS",518:"NORMAL",519:"LAYOUT",520:"RM.PRINT.AREA",521:"CLEAR.PRINT.AREA",522:"ADD.PRINT.AREA",523:"MOVE.BRK",545:"HIDECURR.NOTE",546:"HIDEALL.NOTES",547:"DELETE.NOTE",548:"TRAVERSE.NOTES",549:"ACTIVATE.NOTES",620:"PROTECT.REVISIONS",621:"UNPROTECT.REVISIONS",647:"OPTIONS.ME",653:"WEB.PUBLISH",667:"NEWWEBQUERY",673:"PIVOT.TABLE.CHART",753:"OPTIONS.SAVE",755:"OPTIONS.SPELL",808:"HIDEALL.INKANNOTS"},eH={0:"COUNT",1:"IF",2:"ISNA",3:"ISERROR",4:"SUM",5:"AVERAGE",6:"MIN",7:"MAX",8:"ROW",9:"COLUMN",10:"NA",11:"NPV",12:"STDEV",13:"DOLLAR",14:"FIXED",15:"SIN",16:"COS",17:"TAN",18:"ATAN",19:"PI",20:"SQRT",21:"EXP",22:"LN",23:"LOG10",24:"ABS",25:"INT",26:"SIGN",27:"ROUND",28:"LOOKUP",29:"INDEX",30:"REPT",31:"MID",32:"LEN",33:"VALUE",34:"TRUE",35:"FALSE",36:"AND",37:"OR",38:"NOT",39:"MOD",40:"DCOUNT",41:"DSUM",42:"DAVERAGE",43:"DMIN",44:"DMAX",45:"DSTDEV",46:"VAR",47:"DVAR",48:"TEXT",49:"LINEST",50:"TREND",51:"LOGEST",52:"GROWTH",53:"GOTO",54:"HALT",55:"RETURN",56:"PV",57:"FV",58:"NPER",59:"PMT",60:"RATE",61:"MIRR",62:"IRR",63:"RAND",64:"MATCH",65:"DATE",66:"TIME",67:"DAY",68:"MONTH",69:"YEAR",70:"WEEKDAY",71:"HOUR",72:"MINUTE",73:"SECOND",74:"NOW",75:"AREAS",76:"ROWS",77:"COLUMNS",78:"OFFSET",79:"ABSREF",80:"RELREF",81:"ARGUMENT",82:"SEARCH",83:"TRANSPOSE",84:"ERROR",85:"STEP",86:"TYPE",87:"ECHO",88:"SET.NAME",89:"CALLER",90:"DEREF",91:"WINDOWS",92:"SERIES",93:"DOCUMENTS",94:"ACTIVE.CELL",95:"SELECTION",96:"RESULT",97:"ATAN2",98:"ASIN",99:"ACOS",100:"CHOOSE",101:"HLOOKUP",102:"VLOOKUP",103:"LINKS",104:"INPUT",105:"ISREF",106:"GET.FORMULA",107:"GET.NAME",108:"SET.VALUE",109:"LOG",110:"EXEC",111:"CHAR",112:"LOWER",113:"UPPER",114:"PROPER",115:"LEFT",116:"RIGHT",117:"EXACT",118:"TRIM",119:"REPLACE",120:"SUBSTITUTE",121:"CODE",122:"NAMES",123:"DIRECTORY",124:"FIND",125:"CELL",126:"ISERR",127:"ISTEXT",128:"ISNUMBER",129:"ISBLANK",130:"T",131:"N",132:"FOPEN",133:"FCLOSE",134:"FSIZE",135:"FREADLN",136:"FREAD",137:"FWRITELN",138:"FWRITE",139:"FPOS",140:"DATEVALUE",141:"TIMEVALUE",142:"SLN",143:"SYD",144:"DDB",145:"GET.DEF",146:"REFTEXT",147:"TEXTREF",148:"INDIRECT",149:"REGISTER",150:"CALL",151:"ADD.BAR",152:"ADD.MENU",153:"ADD.COMMAND",154:"ENABLE.COMMAND",155:"CHECK.COMMAND",156:"RENAME.COMMAND",157:"SHOW.BAR",158:"DELETE.MENU",159:"DELETE.COMMAND",160:"GET.CHART.ITEM",161:"DIALOG.BOX",162:"CLEAN",163:"MDETERM",164:"MINVERSE",165:"MMULT",166:"FILES",167:"IPMT",168:"PPMT",169:"COUNTA",170:"CANCEL.KEY",171:"FOR",172:"WHILE",173:"BREAK",174:"NEXT",175:"INITIATE",176:"REQUEST",177:"POKE",178:"EXECUTE",179:"TERMINATE",180:"RESTART",181:"HELP",182:"GET.BAR",183:"PRODUCT",184:"FACT",185:"GET.CELL",186:"GET.WORKSPACE",187:"GET.WINDOW",188:"GET.DOCUMENT",189:"DPRODUCT",190:"ISNONTEXT",191:"GET.NOTE",192:"NOTE",193:"STDEVP",194:"VARP",195:"DSTDEVP",196:"DVARP",197:"TRUNC",198:"ISLOGICAL",199:"DCOUNTA",200:"DELETE.BAR",201:"UNREGISTER",204:"USDOLLAR",205:"FINDB",206:"SEARCHB",207:"REPLACEB",208:"LEFTB",209:"RIGHTB",210:"MIDB",211:"LENB",212:"ROUNDUP",213:"ROUNDDOWN",214:"ASC",215:"DBCS",216:"RANK",219:"ADDRESS",220:"DAYS360",221:"TODAY",222:"VDB",223:"ELSE",224:"ELSE.IF",225:"END.IF",226:"FOR.CELL",227:"MEDIAN",228:"SUMPRODUCT",229:"SINH",230:"COSH",231:"TANH",232:"ASINH",233:"ACOSH",234:"ATANH",235:"DGET",236:"CREATE.OBJECT",237:"VOLATILE",238:"LAST.ERROR",239:"CUSTOM.UNDO",240:"CUSTOM.REPEAT",241:"FORMULA.CONVERT",242:"GET.LINK.INFO",243:"TEXT.BOX",244:"INFO",245:"GROUP",246:"GET.OBJECT",247:"DB",248:"PAUSE",251:"RESUME",252:"FREQUENCY",253:"ADD.TOOLBAR",254:"DELETE.TOOLBAR",255:"User",256:"RESET.TOOLBAR",257:"EVALUATE",258:"GET.TOOLBAR",259:"GET.TOOL",260:"SPELLING.CHECK",261:"ERROR.TYPE",262:"APP.TITLE",263:"WINDOW.TITLE",264:"SAVE.TOOLBAR",265:"ENABLE.TOOL",266:"PRESS.TOOL",267:"REGISTER.ID",268:"GET.WORKBOOK",269:"AVEDEV",270:"BETADIST",271:"GAMMALN",272:"BETAINV",273:"BINOMDIST",274:"CHIDIST",275:"CHIINV",276:"COMBIN",277:"CONFIDENCE",278:"CRITBINOM",279:"EVEN",280:"EXPONDIST",281:"FDIST",282:"FINV",283:"FISHER",284:"FISHERINV",285:"FLOOR",286:"GAMMADIST",287:"GAMMAINV",288:"CEILING",289:"HYPGEOMDIST",290:"LOGNORMDIST",291:"LOGINV",292:"NEGBINOMDIST",293:"NORMDIST",294:"NORMSDIST",295:"NORMINV",296:"NORMSINV",297:"STANDARDIZE",298:"ODD",299:"PERMUT",300:"POISSON",301:"TDIST",302:"WEIBULL",303:"SUMXMY2",304:"SUMX2MY2",305:"SUMX2PY2",306:"CHITEST",307:"CORREL",308:"COVAR",309:"FORECAST",310:"FTEST",311:"INTERCEPT",312:"PEARSON",313:"RSQ",314:"STEYX",315:"SLOPE",316:"TTEST",317:"PROB",318:"DEVSQ",319:"GEOMEAN",320:"HARMEAN",321:"SUMSQ",322:"KURT",323:"SKEW",324:"ZTEST",325:"LARGE",326:"SMALL",327:"QUARTILE",328:"PERCENTILE",329:"PERCENTRANK",330:"MODE",331:"TRIMMEAN",332:"TINV",334:"MOVIE.COMMAND",335:"GET.MOVIE",336:"CONCATENATE",337:"POWER",338:"PIVOT.ADD.DATA",339:"GET.PIVOT.TABLE",340:"GET.PIVOT.FIELD",341:"GET.PIVOT.ITEM",342:"RADIANS",343:"DEGREES",344:"SUBTOTAL",345:"SUMIF",346:"COUNTIF",347:"COUNTBLANK",348:"SCENARIO.GET",349:"OPTIONS.LISTS.GET",350:"ISPMT",351:"DATEDIF",352:"DATESTRING",353:"NUMBERSTRING",354:"ROMAN",355:"OPEN.DIALOG",356:"SAVE.DIALOG",357:"VIEW.GET",358:"GETPIVOTDATA",359:"HYPERLINK",360:"PHONETIC",361:"AVERAGEA",362:"MAXA",363:"MINA",364:"STDEVPA",365:"VARPA",366:"STDEVA",367:"VARA",368:"BAHTTEXT",369:"THAIDAYOFWEEK",370:"THAIDIGIT",371:"THAIMONTHOFYEAR",372:"THAINUMSOUND",373:"THAINUMSTRING",374:"THAISTRINGLENGTH",375:"ISTHAIDIGIT",376:"ROUNDBAHTDOWN",377:"ROUNDBAHTUP",378:"THAIYEAR",379:"RTD",380:"CUBEVALUE",381:"CUBEMEMBER",382:"CUBEMEMBERPROPERTY",383:"CUBERANKEDMEMBER",384:"HEX2BIN",385:"HEX2DEC",386:"HEX2OCT",387:"DEC2BIN",388:"DEC2HEX",389:"DEC2OCT",390:"OCT2BIN",391:"OCT2HEX",392:"OCT2DEC",393:"BIN2DEC",394:"BIN2OCT",395:"BIN2HEX",396:"IMSUB",397:"IMDIV",398:"IMPOWER",399:"IMABS",400:"IMSQRT",401:"IMLN",402:"IMLOG2",403:"IMLOG10",404:"IMSIN",405:"IMCOS",406:"IMEXP",407:"IMARGUMENT",408:"IMCONJUGATE",409:"IMAGINARY",410:"IMREAL",411:"COMPLEX",412:"IMSUM",413:"IMPRODUCT",414:"SERIESSUM",415:"FACTDOUBLE",416:"SQRTPI",417:"QUOTIENT",418:"DELTA",419:"GESTEP",420:"ISEVEN",421:"ISODD",422:"MROUND",423:"ERF",424:"ERFC",425:"BESSELJ",426:"BESSELK",427:"BESSELY",428:"BESSELI",429:"XIRR",430:"XNPV",431:"PRICEMAT",432:"YIELDMAT",433:"INTRATE",434:"RECEIVED",435:"DISC",436:"PRICEDISC",437:"YIELDDISC",438:"TBILLEQ",439:"TBILLPRICE",440:"TBILLYIELD",441:"PRICE",442:"YIELD",443:"DOLLARDE",444:"DOLLARFR",445:"NOMINAL",446:"EFFECT",447:"CUMPRINC",448:"CUMIPMT",449:"EDATE",450:"EOMONTH",451:"YEARFRAC",452:"COUPDAYBS",453:"COUPDAYS",454:"COUPDAYSNC",455:"COUPNCD",456:"COUPNUM",457:"COUPPCD",458:"DURATION",459:"MDURATION",460:"ODDLPRICE",461:"ODDLYIELD",462:"ODDFPRICE",463:"ODDFYIELD",464:"RANDBETWEEN",465:"WEEKNUM",466:"AMORDEGRC",467:"AMORLINC",468:"CONVERT",724:"SHEETJS",469:"ACCRINT",470:"ACCRINTM",471:"WORKDAY",472:"NETWORKDAYS",473:"GCD",474:"MULTINOMIAL",475:"LCM",476:"FVSCHEDULE",477:"CUBEKPIMEMBER",478:"CUBESET",479:"CUBESETCOUNT",480:"IFERROR",481:"COUNTIFS",482:"SUMIFS",483:"AVERAGEIF",484:"AVERAGEIFS"},Iye={2:1,3:1,10:0,15:1,16:1,17:1,18:1,19:0,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:2,30:2,31:3,32:1,33:1,34:0,35:0,38:1,39:2,40:3,41:3,42:3,43:3,44:3,45:3,47:3,48:2,53:1,61:3,63:0,65:3,66:3,67:1,68:1,69:1,70:1,71:1,72:1,73:1,74:0,75:1,76:1,77:1,79:2,80:2,83:1,85:0,86:1,89:0,90:1,94:0,95:0,97:2,98:1,99:1,101:3,102:3,105:1,106:1,108:2,111:1,112:1,113:1,114:1,117:2,118:1,119:4,121:1,126:1,127:1,128:1,129:1,130:1,131:1,133:1,134:1,135:1,136:2,137:2,138:2,140:1,141:1,142:3,143:4,144:4,161:1,162:1,163:1,164:1,165:2,172:1,175:2,176:2,177:3,178:2,179:1,184:1,186:1,189:3,190:1,195:3,196:3,197:1,198:1,199:3,201:1,207:4,210:3,211:1,212:2,213:2,214:1,215:1,225:0,229:1,230:1,231:1,232:1,233:1,234:1,235:3,244:1,247:4,252:2,257:1,261:1,271:1,273:4,274:2,275:2,276:2,277:3,278:3,279:1,280:3,281:3,282:3,283:1,284:1,285:2,286:4,287:3,288:2,289:4,290:3,291:3,292:3,293:4,294:1,295:3,296:1,297:3,298:1,299:2,300:3,301:3,302:4,303:2,304:2,305:2,306:2,307:2,308:2,309:3,310:2,311:2,312:2,313:2,314:2,315:2,316:4,325:2,326:2,327:2,328:2,331:2,332:2,337:2,342:1,343:1,346:2,347:1,350:4,351:3,352:1,353:2,360:1,368:1,369:1,370:1,371:1,372:1,373:1,374:1,375:1,376:1,377:1,378:1,382:3,385:1,392:1,393:1,396:2,397:2,398:2,399:1,400:1,401:1,402:1,403:1,404:1,405:1,406:1,407:1,408:1,409:1,410:1,414:4,415:1,416:1,417:2,420:1,421:1,422:2,424:1,425:2,426:2,427:2,428:2,430:3,438:3,439:3,440:3,443:2,444:2,445:2,446:2,447:6,448:6,449:2,450:2,464:2,468:3,476:2,479:1,480:2,65535:0};function Nye(e){var t="of:="+e.replace(kM,"$1[.$2$3$4$5]").replace(/\]:\[/g,":");return t.replace(/;/g,"|").replace(/,/g,";")}function kye(e){return e.replace(/\./,"!")}var $w=typeof Map<"u";function RM(e,t,r){var s=0,u=e.length;if(r){if($w?r.has(t):Object.prototype.hasOwnProperty.call(r,t)){for(var f=$w?r.get(t):r[t];s<f.length;++s)if(e[f[s]].t===t)return e.Count++,f[s]}}else for(;s<u;++s)if(e[s].t===t)return e.Count++,s;return e[u]={t},e.Count++,e.Unique++,r&&($w?(r.has(t)||r.set(t,[]),r.get(t).push(u)):(Object.prototype.hasOwnProperty.call(r,t)||(r[t]=[]),r[t].push(u))),u}function IA(e,t){var r={min:e+1,max:e+1},s=-1;return t.MDW&&(df=t.MDW),t.width!=null?r.customWidth=1:t.wpx!=null?s=SC(t.wpx):t.wch!=null&&(s=t.wch),s>-1?(r.width=rD(s),r.customWidth=1):t.width!=null&&(r.width=t.width),t.hidden&&(r.hidden=!0),t.level!=null&&(r.outlineLevel=r.level=t.level),r}function tH(e,t){if(e){var r=[.7,.7,.75,.75,.3,.3];e.left==null&&(e.left=r[0]),e.right==null&&(e.right=r[1]),e.top==null&&(e.top=r[2]),e.bottom==null&&(e.bottom=r[3]),e.header==null&&(e.header=r[4]),e.footer==null&&(e.footer=r[5])}}function Nm(e,t,r){var s=r.revssf[t.z!=null?t.z:"General"],u=60,f=e.length;if(s==null&&r.ssf){for(;u<392;++u)if(r.ssf[u]==null){YG(t.z,u),r.ssf[u]=t.z,r.revssf[t.z]=s=u;break}}for(u=0;u!=f;++u)if(e[u].numFmtId===s)return u;return e[f]={numFmtId:s,fontId:0,fillId:0,borderId:0,xfId:0,applyNumberFormat:1},f}function Pye(e,t,r){if(e&&e["!ref"]){var s=Ba(e["!ref"]);if(s.e.c<s.s.c||s.e.r<s.s.r)throw new Error("Bad range ("+r+"): "+e["!ref"])}}function Dye(e){if(e.length===0)return"";for(var t='<mergeCells count="'+e.length+'">',r=0;r!=e.length;++r)t+='<mergeCell ref="'+Io(e[r])+'"/>';return t+"</mergeCells>"}function Rye(e,t,r,s,u){var f=!1,m={},i=null;if(s.bookType!=="xlsx"&&t.vbaraw){var S=t.SheetNames[r];try{t.Workbook&&(S=t.Workbook.Sheets[r].CodeName||S)}catch{}f=!0,m.codeName=Tb(xa(S))}if(e&&e["!outline"]){var E={summaryBelow:1,summaryRight:1};e["!outline"].above&&(E.summaryBelow=0),e["!outline"].left&&(E.summaryRight=0),i=(i||"")+pn("outlinePr",null,E)}!f&&!i||(u[u.length]=pn("sheetPr",i,m))}var Mye=["objects","scenarios","selectLockedCells","selectUnlockedCells"],Oye=["formatColumns","formatRows","formatCells","insertColumns","insertRows","insertHyperlinks","deleteColumns","deleteRows","sort","autoFilter","pivotTables"];function Fye(e){var t={sheet:1};return Mye.forEach(function(r){e[r]!=null&&e[r]&&(t[r]="1")}),Oye.forEach(function(r){e[r]!=null&&!e[r]&&(t[r]="0")}),e.password&&(t.password=LW(e.password).toString(16).toUpperCase()),pn("sheetProtection",null,t)}function Lye(e){return tH(e),pn("pageMargins",null,e)}function zye(e,t){for(var r=["<cols>"],s,u=0;u!=t.length;++u)(s=t[u])&&(r[r.length]=pn("col",null,IA(u,s)));return r[r.length]="</cols>",r.join("")}function Bye(e,t,r,s){var u=typeof e.ref=="string"?e.ref:Io(e.ref);r.Workbook||(r.Workbook={Sheets:[]}),r.Workbook.Names||(r.Workbook.Names=[]);var f=r.Workbook.Names,m=eu(u);m.s.r==m.e.r&&(m.e.r=eu(t["!ref"]).e.r,u=Io(m));for(var i=0;i<f.length;++i){var S=f[i];if(S.Name=="_xlnm._FilterDatabase"&&S.Sheet==s){S.Ref="'"+r.SheetNames[s]+"'!"+u;break}}return i==f.length&&f.push({Name:"_xlnm._FilterDatabase",Sheet:s,Ref:"'"+r.SheetNames[s]+"'!"+u}),pn("autoFilter",null,{ref:u})}function Uye(e,t,r,s){var u={workbookViewId:"0"};return(((s||{}).Workbook||{}).Views||[])[0]&&(u.rightToLeft=s.Workbook.Views[0].RTL?"1":"0"),pn("sheetViews",pn("sheetView",null,u),{})}function Vye(e,t,r,s){if(e.c&&r["!comments"].push([t,e.c]),e.v===void 0&&typeof e.f!="string"||e.t==="z"&&!e.f)return"";var u="",f=e.t,m=e.v;if(e.t!=="z")switch(e.t){case"b":u=e.v?"1":"0";break;case"n":u=""+e.v;break;case"e":u=i2[e.v];break;case"d":s&&s.cellDates?u=Ql(e.v,-1).toISOString():(e=Pc(e),e.t="n",u=""+(e.v=kc(Ql(e.v)))),typeof e.z>"u"&&(e.z=po[14]);break;default:u=e.v;break}var i=cl("v",xa(u)),S={r:t},E=Nm(s.cellXfs,e,s);switch(E!==0&&(S.s=E),e.t){case"n":break;case"d":S.t="d";break;case"b":S.t="b";break;case"e":S.t="e";break;case"z":break;default:if(e.v==null){delete e.t;break}if(e.v.length>32767)throw new Error("Text length must not exceed 32767 characters");if(s&&s.bookSST){i=cl("v",""+RM(s.Strings,e.v,s.revStrings)),S.t="s";break}S.t="str";break}if(e.t!=f&&(e.t=f,e.v=m),typeof e.f=="string"&&e.f){var I=e.F&&e.F.slice(0,t.length)==t?{t:"array",ref:e.F}:null;i=pn("f",xa(e.f),I)+(e.v!=null?i:"")}return e.l&&r["!links"].push([t,e.l]),e.D&&(S.cm=1),pn("c",i,S)}function $ye(e,t,r,s){var u=[],f=[],m=Ba(e["!ref"]),i="",S,E="",I=[],D=0,M=0,R=e["!rows"],H=Array.isArray(e),F={r:E},U,Y=-1;for(M=m.s.c;M<=m.e.c;++M)I[M]=El(M);for(D=m.s.r;D<=m.e.r;++D){for(f=[],E=dl(D),M=m.s.c;M<=m.e.c;++M){S=I[M]+E;var z=H?(e[D]||[])[M]:e[S];z!==void 0&&(i=Vye(z,S,e,t))!=null&&f.push(i)}(f.length>0||R&&R[D])&&(F={r:E},R&&R[D]&&(U=R[D],U.hidden&&(F.hidden=1),Y=-1,U.hpx?Y=TC(U.hpx):U.hpt&&(Y=U.hpt),Y>-1&&(F.ht=Y,F.customHeight=1),U.level&&(F.outlineLevel=U.level)),u[u.length]=pn("row",f.join(""),F))}if(R)for(;D<R.length;++D)R&&R[D]&&(F={r:D+1},U=R[D],U.hidden&&(F.hidden=1),Y=-1,U.hpx?Y=TC(U.hpx):U.hpt&&(Y=U.hpt),Y>-1&&(F.ht=Y,F.customHeight=1),U.level&&(F.outlineLevel=U.level),u[u.length]=pn("row","",F));return u.join("")}function rH(e,t,r,s){var u=[No,pn("worksheet",null,{xmlns:Zv[0],"xmlns:r":Ho.r})],f=r.SheetNames[e],m=0,i="",S=r.Sheets[f];S==null&&(S={});var E=S["!ref"]||"A1",I=Ba(E);if(I.e.c>16383||I.e.r>1048575){if(t.WTF)throw new Error("Range "+E+" exceeds format limit A1:XFD1048576");I.e.c=Math.min(I.e.c,16383),I.e.r=Math.min(I.e.c,1048575),E=Io(I)}s||(s={}),S["!comments"]=[];var D=[];Rye(S,r,e,t,u),u[u.length]=pn("dimension",null,{ref:E}),u[u.length]=Uye(S,t,e,r),t.sheetFormat&&(u[u.length]=pn("sheetFormatPr",null,{defaultRowHeight:t.sheetFormat.defaultRowHeight||"16",baseColWidth:t.sheetFormat.baseColWidth||"10",outlineLevelRow:t.sheetFormat.outlineLevelRow||"7"})),S["!cols"]!=null&&S["!cols"].length>0&&(u[u.length]=zye(S,S["!cols"])),u[m=u.length]="<sheetData/>",S["!links"]=[],S["!ref"]!=null&&(i=$ye(S,t),i.length>0&&(u[u.length]=i)),u.length>m+1&&(u[u.length]="</sheetData>",u[m]=u[m].replace("/>",">")),S["!protect"]&&(u[u.length]=Fye(S["!protect"])),S["!autofilter"]!=null&&(u[u.length]=Bye(S["!autofilter"],S,r,e)),S["!merges"]!=null&&S["!merges"].length>0&&(u[u.length]=Dye(S["!merges"]));var M=-1,R,H=-1;return S["!links"].length>0&&(u[u.length]="<hyperlinks>",S["!links"].forEach(function(F){F[1].Target&&(R={ref:F[0]},F[1].Target.charAt(0)!="#"&&(H=_a(s,-1,xa(F[1].Target).replace(/#.*$/,""),Qs.HLINK),R["r:id"]="rId"+H),(M=F[1].Target.indexOf("#"))>-1&&(R.location=xa(F[1].Target.slice(M+1))),F[1].Tooltip&&(R.tooltip=xa(F[1].Tooltip)),u[u.length]=pn("hyperlink",null,R))}),u[u.length]="</hyperlinks>"),delete S["!links"],S["!margins"]!=null&&(u[u.length]=Lye(S["!margins"])),(!t||t.ignoreEC||t.ignoreEC==null)&&(u[u.length]=cl("ignoredErrors",pn("ignoredError",null,{numberStoredAsText:1,sqref:E}))),D.length>0&&(H=_a(s,-1,"../drawings/drawing"+(e+1)+".xml",Qs.DRAW),u[u.length]=pn("drawing",null,{"r:id":"rId"+H}),S["!drawing"]=D),S["!comments"].length>0&&(H=_a(s,-1,"../drawings/vmlDrawing"+(e+1)+".vml",Qs.VML),u[u.length]=pn("legacyDrawing",null,{"r:id":"rId"+H}),S["!legacy"]=H),u.length>1&&(u[u.length]="</worksheet>",u[1]=u[1].replace("/>",">")),u.join("")}function qye(e,t){var r={},s=e.l+t;r.r=e.read_shift(4),e.l+=4;var u=e.read_shift(2);e.l+=1;var f=e.read_shift(1);return e.l=s,f&7&&(r.level=f&7),f&16&&(r.hidden=!0),f&32&&(r.hpt=u/20),r}function Gye(e,t,r){var s=vr(145),u=(r["!rows"]||[])[e]||{};s.write_shift(4,e),s.write_shift(4,0);var f=320;u.hpx?f=TC(u.hpx)*20:u.hpt&&(f=u.hpt*20),s.write_shift(2,f),s.write_shift(1,0);var m=0;u.level&&(m|=u.level),u.hidden&&(m|=16),(u.hpx||u.hpt)&&(m|=32),s.write_shift(1,m),s.write_shift(1,0);var i=0,S=s.l;s.l+=4;for(var E={r:e,c:0},I=0;I<16;++I)if(!(t.s.c>I+1<<10||t.e.c<I<<10)){for(var D=-1,M=-1,R=I<<10;R<I+1<<10;++R){E.c=R;var H=Array.isArray(r)?(r[E.r]||[])[E.c]:r[ya(E)];H&&(D<0&&(D=R),M=R)}D<0||(++i,s.write_shift(4,D),s.write_shift(4,M))}var F=s.l;return s.l=S,s.write_shift(4,i),s.l=F,s.length>s.l?s.slice(0,s.l):s}function Wye(e,t,r,s){var u=Gye(s,r,t);(u.length>17||(t["!rows"]||[])[s])&&Ur(e,0,u)}var Hye=M_,Zye=Yv;function Xye(){}function Yye(e,t){var r={},s=e[e.l];return++e.l,r.above=!(s&64),r.left=!(s&128),e.l+=18,r.name=a0e(e),r}function Kye(e,t,r){r==null&&(r=vr(84+4*e.length));var s=192;t&&(t.above&&(s&=-65),t.left&&(s&=-129)),r.write_shift(1,s);for(var u=1;u<3;++u)r.write_shift(1,0);return yC({auto:1},r),r.write_shift(-4,-1),r.write_shift(-4,-1),_W(e,r),r.slice(0,r.l)}function Jye(e){var t=Mu(e);return[t]}function Qye(e,t,r){return r==null&&(r=vr(8)),P_(t,r)}function e1e(e){var t=D_(e);return[t]}function t1e(e,t,r){return r==null&&(r=vr(4)),R_(t,r)}function r1e(e){var t=Mu(e),r=e.read_shift(1);return[t,r,"b"]}function n1e(e,t,r){return r==null&&(r=vr(9)),P_(t,r),r.write_shift(1,e.v?1:0),r}function i1e(e){var t=D_(e),r=e.read_shift(1);return[t,r,"b"]}function s1e(e,t,r){return r==null&&(r=vr(5)),R_(t,r),r.write_shift(1,e.v?1:0),r}function a1e(e){var t=Mu(e),r=e.read_shift(1);return[t,r,"e"]}function o1e(e,t,r){return r==null&&(r=vr(9)),P_(t,r),r.write_shift(1,e.v),r}function l1e(e){var t=D_(e),r=e.read_shift(1);return[t,r,"e"]}function c1e(e,t,r){return r==null&&(r=vr(8)),R_(t,r),r.write_shift(1,e.v),r.write_shift(2,0),r.write_shift(1,0),r}function u1e(e){var t=Mu(e),r=e.read_shift(4);return[t,r,"s"]}function d1e(e,t,r){return r==null&&(r=vr(12)),P_(t,r),r.write_shift(4,t.v),r}function h1e(e){var t=D_(e),r=e.read_shift(4);return[t,r,"s"]}function f1e(e,t,r){return r==null&&(r=vr(8)),R_(t,r),r.write_shift(4,t.v),r}function p1e(e){var t=Mu(e),r=Kv(e);return[t,r,"n"]}function m1e(e,t,r){return r==null&&(r=vr(16)),P_(t,r),E_(e.v,r),r}function g1e(e){var t=D_(e),r=Kv(e);return[t,r,"n"]}function _1e(e,t,r){return r==null&&(r=vr(12)),R_(t,r),E_(e.v,r),r}function x1e(e){var t=Mu(e),r=xW(e);return[t,r,"n"]}function v1e(e,t,r){return r==null&&(r=vr(12)),P_(t,r),vW(e.v,r),r}function y1e(e){var t=D_(e),r=xW(e);return[t,r,"n"]}function w1e(e,t,r){return r==null&&(r=vr(8)),R_(t,r),vW(e.v,r),r}function b1e(e){var t=Mu(e),r=CM(e);return[t,r,"is"]}function S1e(e){var t=Mu(e),r=Cl(e);return[t,r,"str"]}function T1e(e,t,r){return r==null&&(r=vr(12+4*e.v.length)),P_(t,r),Xo(e.v,r),r.length>r.l?r.slice(0,r.l):r}function E1e(e){var t=D_(e),r=Cl(e);return[t,r,"str"]}function C1e(e,t,r){return r==null&&(r=vr(8+4*e.v.length)),R_(t,r),Xo(e.v,r),r.length>r.l?r.slice(0,r.l):r}function A1e(e,t,r){var s=e.l+t,u=Mu(e);u.r=r["!row"];var f=e.read_shift(1),m=[u,f,"b"];if(r.cellFormula){e.l+=2;var i=jA(e,s-e.l,r);m[3]=Dv(i,null,u,r.supbooks,r)}else e.l=s;return m}function j1e(e,t,r){var s=e.l+t,u=Mu(e);u.r=r["!row"];var f=e.read_shift(1),m=[u,f,"e"];if(r.cellFormula){e.l+=2;var i=jA(e,s-e.l,r);m[3]=Dv(i,null,u,r.supbooks,r)}else e.l=s;return m}function I1e(e,t,r){var s=e.l+t,u=Mu(e);u.r=r["!row"];var f=Kv(e),m=[u,f,"n"];if(r.cellFormula){e.l+=2;var i=jA(e,s-e.l,r);m[3]=Dv(i,null,u,r.supbooks,r)}else e.l=s;return m}function N1e(e,t,r){var s=e.l+t,u=Mu(e);u.r=r["!row"];var f=Cl(e),m=[u,f,"str"];if(r.cellFormula){e.l+=2;var i=jA(e,s-e.l,r);m[3]=Dv(i,null,u,r.supbooks,r)}else e.l=s;return m}var k1e=M_,P1e=Yv;function D1e(e,t){return t==null&&(t=vr(4)),t.write_shift(4,e),t}function R1e(e,t){var r=e.l+t,s=M_(e),u=AM(e),f=Cl(e),m=Cl(e),i=Cl(e);e.l=r;var S={rfx:s,relId:u,loc:f,display:i};return m&&(S.Tooltip=m),S}function M1e(e,t){var r=vr(50+4*(e[1].Target.length+(e[1].Tooltip||"").length));Yv({s:Zo(e[0]),e:Zo(e[0])},r),jM("rId"+t,r);var s=e[1].Target.indexOf("#"),u=s==-1?"":e[1].Target.slice(s+1);return Xo(u||"",r),Xo(e[1].Tooltip||"",r),Xo("",r),r.slice(0,r.l)}function O1e(){}function F1e(e,t,r){var s=e.l+t,u=yW(e),f=e.read_shift(1),m=[u];if(m[2]=f,r.cellFormula){var i=Eye(e,s-e.l,r);m[1]=i}else e.l=s;return m}function L1e(e,t,r){var s=e.l+t,u=M_(e),f=[u];if(r.cellFormula){var m=Aye(e,s-e.l,r);f[1]=m,e.l=s}else e.l=s;return f}function z1e(e,t,r){r==null&&(r=vr(18));var s=IA(e,t);r.write_shift(-4,e),r.write_shift(-4,e),r.write_shift(4,(s.width||10)*256),r.write_shift(4,0);var u=0;return t.hidden&&(u|=1),typeof s.width=="number"&&(u|=2),t.level&&(u|=t.level<<8),r.write_shift(2,u),r}var nH=["left","right","top","bottom","header","footer"];function B1e(e){var t={};return nH.forEach(function(r){t[r]=Kv(e)}),t}function U1e(e,t){return t==null&&(t=vr(6*8)),tH(e),nH.forEach(function(r){E_(e[r],t)}),t}function V1e(e){var t=e.read_shift(2);return e.l+=28,{RTL:t&32}}function $1e(e,t,r){r==null&&(r=vr(30));var s=924;return(((t||{}).Views||[])[0]||{}).RTL&&(s|=32),r.write_shift(2,s),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(1,0),r.write_shift(1,0),r.write_shift(2,0),r.write_shift(2,100),r.write_shift(2,0),r.write_shift(2,0),r.write_shift(2,0),r.write_shift(4,0),r}function q1e(e){var t=vr(24);return t.write_shift(4,4),t.write_shift(4,1),Yv(e,t),t}function G1e(e,t){return t==null&&(t=vr(16*4+2)),t.write_shift(2,e.password?LW(e.password):0),t.write_shift(4,1),[["objects",!1],["scenarios",!1],["formatCells",!0],["formatColumns",!0],["formatRows",!0],["insertColumns",!0],["insertRows",!0],["insertHyperlinks",!0],["deleteColumns",!0],["deleteRows",!0],["selectLockedCells",!1],["sort",!0],["autoFilter",!0],["pivotTables",!0],["selectUnlockedCells",!1]].forEach(function(r){r[1]?t.write_shift(4,e[r[0]]!=null&&!e[r[0]]?1:0):t.write_shift(4,e[r[0]]!=null&&e[r[0]]?0:1)}),t}function W1e(){}function H1e(){}function Z1e(e,t,r,s,u,f,m){if(t.v===void 0)return!1;var i="";switch(t.t){case"b":i=t.v?"1":"0";break;case"d":t=Pc(t),t.z=t.z||po[14],t.v=kc(Ql(t.v)),t.t="n";break;case"n":case"e":i=""+t.v;break;default:i=t.v;break}var S={r,c:s};switch(S.s=Nm(u.cellXfs,t,u),t.l&&f["!links"].push([ya(S),t.l]),t.c&&f["!comments"].push([ya(S),t.c]),t.t){case"s":case"str":return u.bookSST?(i=RM(u.Strings,t.v,u.revStrings),S.t="s",S.v=i,m?Ur(e,18,f1e(t,S)):Ur(e,7,d1e(t,S))):(S.t="str",m?Ur(e,17,C1e(t,S)):Ur(e,6,T1e(t,S))),!0;case"n":return t.v==(t.v|0)&&t.v>-1e3&&t.v<1e3?m?Ur(e,13,w1e(t,S)):Ur(e,2,v1e(t,S)):m?Ur(e,16,_1e(t,S)):Ur(e,5,m1e(t,S)),!0;case"b":return S.t="b",m?Ur(e,15,s1e(t,S)):Ur(e,4,n1e(t,S)),!0;case"e":return S.t="e",m?Ur(e,14,c1e(t,S)):Ur(e,3,o1e(t,S)),!0}return m?Ur(e,12,t1e(t,S)):Ur(e,1,Qye(t,S)),!0}function X1e(e,t,r,s){var u=Ba(t["!ref"]||"A1"),f,m="",i=[];Ur(e,145);var S=Array.isArray(t),E=u.e.r;t["!rows"]&&(E=Math.max(u.e.r,t["!rows"].length-1));for(var I=u.s.r;I<=E;++I){m=dl(I),Wye(e,t,u,I);var D=!1;if(I<=u.e.r)for(var M=u.s.c;M<=u.e.c;++M){I===u.s.r&&(i[M]=El(M)),f=i[M]+m;var R=S?(t[I]||[])[M]:t[f];if(!R){D=!1;continue}D=Z1e(e,R,I,M,s,t,D)}}Ur(e,146)}function Y1e(e,t){!t||!t["!merges"]||(Ur(e,177,D1e(t["!merges"].length)),t["!merges"].forEach(function(r){Ur(e,176,P1e(r))}),Ur(e,178))}function K1e(e,t){!t||!t["!cols"]||(Ur(e,390),t["!cols"].forEach(function(r,s){r&&Ur(e,60,z1e(s,r))}),Ur(e,391))}function J1e(e,t){!t||!t["!ref"]||(Ur(e,648),Ur(e,649,q1e(Ba(t["!ref"]))),Ur(e,650))}function Q1e(e,t,r){t["!links"].forEach(function(s){if(s[1].Target){var u=_a(r,-1,s[1].Target.replace(/#.*$/,""),Qs.HLINK);Ur(e,494,M1e(s,u))}}),delete t["!links"]}function ewe(e,t,r,s){if(t["!comments"].length>0){var u=_a(s,-1,"../drawings/vmlDrawing"+(r+1)+".vml",Qs.VML);Ur(e,551,jM("rId"+u)),t["!legacy"]=u}}function twe(e,t,r,s){if(t["!autofilter"]){var u=t["!autofilter"],f=typeof u.ref=="string"?u.ref:Io(u.ref);r.Workbook||(r.Workbook={Sheets:[]}),r.Workbook.Names||(r.Workbook.Names=[]);var m=r.Workbook.Names,i=eu(f);i.s.r==i.e.r&&(i.e.r=eu(t["!ref"]).e.r,f=Io(i));for(var S=0;S<m.length;++S){var E=m[S];if(E.Name=="_xlnm._FilterDatabase"&&E.Sheet==s){E.Ref="'"+r.SheetNames[s]+"'!"+f;break}}S==m.length&&m.push({Name:"_xlnm._FilterDatabase",Sheet:s,Ref:"'"+r.SheetNames[s]+"'!"+f}),Ur(e,161,Yv(Ba(f))),Ur(e,162)}}function rwe(e,t,r){Ur(e,133),Ur(e,137,$1e(t,r)),Ur(e,138),Ur(e,134)}function nwe(e,t){t["!protect"]&&Ur(e,535,G1e(t["!protect"]))}function iwe(e,t,r,s){var u=Nc(),f=r.SheetNames[e],m=r.Sheets[f]||{},i=f;try{r&&r.Workbook&&(i=r.Workbook.Sheets[e].CodeName||i)}catch{}var S=Ba(m["!ref"]||"A1");if(S.e.c>16383||S.e.r>1048575){if(t.WTF)throw new Error("Range "+(m["!ref"]||"A1")+" exceeds format limit A1:XFD1048576");S.e.c=Math.min(S.e.c,16383),S.e.r=Math.min(S.e.c,1048575)}return m["!links"]=[],m["!comments"]=[],Ur(u,129),(r.vbaraw||m["!outline"])&&Ur(u,147,Kye(i,m["!outline"])),Ur(u,148,Zye(S)),rwe(u,m,r.Workbook),K1e(u,m),X1e(u,m,e,t),nwe(u,m),twe(u,m,r,e),Y1e(u,m),Q1e(u,m,s),m["!margins"]&&Ur(u,476,U1e(m["!margins"])),(!t||t.ignoreEC||t.ignoreEC==null)&&J1e(u,m),ewe(u,m,e,s),Ur(u,130),u.end()}function swe(e,t){e.l+=10;var r=Cl(e);return{name:r}}var awe=[["allowRefreshQuery",!1,"bool"],["autoCompressPictures",!0,"bool"],["backupFile",!1,"bool"],["checkCompatibility",!1,"bool"],["CodeName",""],["date1904",!1,"bool"],["defaultThemeVersion",0,"int"],["filterPrivacy",!1,"bool"],["hidePivotFieldList",!1,"bool"],["promptedSolutions",!1,"bool"],["publishItems",!1,"bool"],["refreshAllConnections",!1,"bool"],["saveExternalLinkValues",!0,"bool"],["showBorderUnselectedTables",!0,"bool"],["showInkAnnotation",!0,"bool"],["showObjects","all"],["showPivotChartFilter",!1,"bool"],["updateLinks","userSet"]];function owe(e){return!e.Workbook||!e.Workbook.WBProps?"false":L_e(e.Workbook.WBProps.date1904)?"true":"false"}var lwe="][*?/\\".split("");function iH(e,t){if(e.length>31)throw new Error("Sheet names cannot exceed 31 chars");var r=!0;return lwe.forEach(function(s){if(e.indexOf(s)!=-1)throw new Error("Sheet name cannot contain : \\ / ? * [ ]")}),r}function cwe(e,t,r){e.forEach(function(s,u){iH(s);for(var f=0;f<u;++f)if(s==e[f])throw new Error("Duplicate Sheet Name: "+s);if(r){var m=t&&t[u]&&t[u].CodeName||s;if(m.charCodeAt(0)==95&&m.length>22)throw new Error("Bad Code Name: Worksheet"+m)}})}function uwe(e){if(!e||!e.SheetNames||!e.Sheets)throw new Error("Invalid Workbook");if(!e.SheetNames.length)throw new Error("Workbook is empty");var t=e.Workbook&&e.Workbook.Sheets||[];cwe(e.SheetNames,t,!!e.vbaraw);for(var r=0;r<e.SheetNames.length;++r)Pye(e.Sheets[e.SheetNames[r]],e.SheetNames[r],r)}function sH(e){var t=[No];t[t.length]=pn("workbook",null,{xmlns:Zv[0],"xmlns:r":Ho.r});var r=e.Workbook&&(e.Workbook.Names||[]).length>0,s={codeName:"ThisWorkbook"};e.Workbook&&e.Workbook.WBProps&&(awe.forEach(function(i){e.Workbook.WBProps[i[0]]!=null&&e.Workbook.WBProps[i[0]]!=i[1]&&(s[i[0]]=e.Workbook.WBProps[i[0]])}),e.Workbook.WBProps.CodeName&&(s.codeName=e.Workbook.WBProps.CodeName,delete s.CodeName)),t[t.length]=pn("workbookPr",null,s);var u=e.Workbook&&e.Workbook.Sheets||[],f=0;if(u&&u[0]&&u[0].Hidden){for(t[t.length]="<bookViews>",f=0;f!=e.SheetNames.length&&!(!u[f]||!u[f].Hidden);++f);f==e.SheetNames.length&&(f=0),t[t.length]='<workbookView firstSheet="'+f+'" activeTab="'+f+'"/>',t[t.length]="</bookViews>"}for(t[t.length]="<sheets>",f=0;f!=e.SheetNames.length;++f){var m={name:xa(e.SheetNames[f].slice(0,31))};if(m.sheetId=""+(f+1),m["r:id"]="rId"+(f+1),u[f])switch(u[f].Hidden){case 1:m.state="hidden";break;case 2:m.state="veryHidden";break}t[t.length]=pn("sheet",null,m)}return t[t.length]="</sheets>",r&&(t[t.length]="<definedNames>",e.Workbook&&e.Workbook.Names&&e.Workbook.Names.forEach(function(i){var S={name:i.Name};i.Comment&&(S.comment=i.Comment),i.Sheet!=null&&(S.localSheetId=""+i.Sheet),i.Hidden&&(S.hidden="1"),i.Ref&&(t[t.length]=pn("definedName",xa(i.Ref),S))}),t[t.length]="</definedNames>"),t.length>2&&(t[t.length]="</workbook>",t[1]=t[1].replace("/>",">")),t.join("")}function dwe(e,t){var r={};return r.Hidden=e.read_shift(4),r.iTabID=e.read_shift(4),r.strRelID=tD(e),r.name=Cl(e),r}function hwe(e,t){return t||(t=vr(127)),t.write_shift(4,e.Hidden),t.write_shift(4,e.iTabID),jM(e.strRelID,t),Xo(e.name.slice(0,31),t),t.length>t.l?t.slice(0,t.l):t}function fwe(e,t){var r={},s=e.read_shift(4);r.defaultThemeVersion=e.read_shift(4);var u=t>8?Cl(e):"";return u.length>0&&(r.CodeName=u),r.autoCompressPictures=!!(s&65536),r.backupFile=!!(s&64),r.checkCompatibility=!!(s&4096),r.date1904=!!(s&1),r.filterPrivacy=!!(s&8),r.hidePivotFieldList=!!(s&1024),r.promptedSolutions=!!(s&16),r.publishItems=!!(s&2048),r.refreshAllConnections=!!(s&262144),r.saveExternalLinkValues=!!(s&128),r.showBorderUnselectedTables=!!(s&4),r.showInkAnnotation=!!(s&32),r.showObjects=["all","placeholders","none"][s>>13&3],r.showPivotChartFilter=!!(s&32768),r.updateLinks=["userSet","never","always"][s>>8&3],r}function pwe(e,t){t||(t=vr(72));var r=0;return e&&e.filterPrivacy&&(r|=8),t.write_shift(4,r),t.write_shift(4,0),_W(e&&e.CodeName||"ThisWorkbook",t),t.slice(0,t.l)}function mwe(e,t,r){var s=e.l+t;e.l+=4,e.l+=1;var u=e.read_shift(4),f=o0e(e),m=Cye(e,0,r),i=AM(e);e.l=s;var S={Name:f,Ptg:m};return u<268435455&&(S.Sheet=u),i&&(S.Comment=i),S}function gwe(e,t){Ur(e,143);for(var r=0;r!=t.SheetNames.length;++r){var s=t.Workbook&&t.Workbook.Sheets&&t.Workbook.Sheets[r]&&t.Workbook.Sheets[r].Hidden||0,u={Hidden:s,iTabID:r+1,strRelID:"rId"+(r+1),name:t.SheetNames[r]};Ur(e,156,hwe(u))}Ur(e,144)}function _we(e,t){t||(t=vr(127));for(var r=0;r!=4;++r)t.write_shift(4,0);return Xo("SheetJS",t),Xo(fC.version,t),Xo(fC.version,t),Xo("7262",t),t.length>t.l?t.slice(0,t.l):t}function xwe(e,t){t||(t=vr(29)),t.write_shift(-4,0),t.write_shift(-4,460),t.write_shift(4,28800),t.write_shift(4,17600),t.write_shift(4,500),t.write_shift(4,e),t.write_shift(4,e);var r=120;return t.write_shift(1,r),t.length>t.l?t.slice(0,t.l):t}function vwe(e,t){if(!(!t.Workbook||!t.Workbook.Sheets)){for(var r=t.Workbook.Sheets,s=0,u=-1,f=-1;s<r.length;++s)!r[s]||!r[s].Hidden&&u==-1?u=s:r[s].Hidden==1&&f==-1&&(f=s);f>u||(Ur(e,135),Ur(e,158,xwe(u)),Ur(e,136))}}function ywe(e,t){var r=Nc();return Ur(r,131),Ur(r,128,_we()),Ur(r,153,pwe(e.Workbook&&e.Workbook.WBProps||null)),vwe(r,e),gwe(r,e),Ur(r,132),r.end()}function wwe(e,t,r){return(t.slice(-4)===".bin"?ywe:sH)(e)}function bwe(e,t,r,s,u){return(t.slice(-4)===".bin"?iwe:rH)(e,r,s,u)}function Swe(e,t,r){return(t.slice(-4)===".bin"?Uxe:UW)(e,r)}function Twe(e,t,r){return(t.slice(-4)===".bin"?pxe:FW)(e,r)}function Ewe(e,t,r){return(t.slice(-4)===".bin"?nve:WW)(e)}function Cwe(e){return(e.slice(-4)===".bin"?Xxe:qW)()}function Awe(e,t){var r=[];return e.Props&&r.push(S0e(e.Props,t)),e.Custprops&&r.push(T0e(e.Props,e.Custprops)),r.join("")}function jwe(){return""}function Iwe(e,t){var r=['<Style ss:ID="Default" ss:Name="Normal"><NumberFormat/></Style>'];return t.cellXfs.forEach(function(s,u){var f=[];f.push(pn("NumberFormat",null,{"ss:Format":xa(po[s.numFmtId])}));var m={"ss:ID":"s"+(21+u)};r.push(pn("Style",f.join(""),m))}),pn("Styles",r.join(""))}function aH(e){return pn("NamedRange",null,{"ss:Name":e.Name,"ss:RefersTo":"="+PM(e.Ref,{r:0,c:0})})}function Nwe(e){if(!((e||{}).Workbook||{}).Names)return"";for(var t=e.Workbook.Names,r=[],s=0;s<t.length;++s){var u=t[s];u.Sheet==null&&(u.Name.match(/^_xlfn\./)||r.push(aH(u)))}return pn("Names",r.join(""))}function kwe(e,t,r,s){if(!e||!((s||{}).Workbook||{}).Names)return"";for(var u=s.Workbook.Names,f=[],m=0;m<u.length;++m){var i=u[m];i.Sheet==r&&(i.Name.match(/^_xlfn\./)||f.push(aH(i)))}return f.join("")}function Pwe(e,t,r,s){if(!e)return"";var u=[];if(e["!margins"]&&(u.push("<PageSetup>"),e["!margins"].header&&u.push(pn("Header",null,{"x:Margin":e["!margins"].header})),e["!margins"].footer&&u.push(pn("Footer",null,{"x:Margin":e["!margins"].footer})),u.push(pn("PageMargins",null,{"x:Bottom":e["!margins"].bottom||"0.75","x:Left":e["!margins"].left||"0.7","x:Right":e["!margins"].right||"0.7","x:Top":e["!margins"].top||"0.75"})),u.push("</PageSetup>")),s&&s.Workbook&&s.Workbook.Sheets&&s.Workbook.Sheets[r])if(s.Workbook.Sheets[r].Hidden)u.push(pn("Visible",s.Workbook.Sheets[r].Hidden==1?"SheetHidden":"SheetVeryHidden",{}));else{for(var f=0;f<r&&!(s.Workbook.Sheets[f]&&!s.Workbook.Sheets[f].Hidden);++f);f==r&&u.push("<Selected/>")}return((((s||{}).Workbook||{}).Views||[])[0]||{}).RTL&&u.push("<DisplayRightToLeft/>"),e["!protect"]&&(u.push(cl("ProtectContents","True")),e["!protect"].objects&&u.push(cl("ProtectObjects","True")),e["!protect"].scenarios&&u.push(cl("ProtectScenarios","True")),e["!protect"].selectLockedCells!=null&&!e["!protect"].selectLockedCells?u.push(cl("EnableSelection","NoSelection")):e["!protect"].selectUnlockedCells!=null&&!e["!protect"].selectUnlockedCells&&u.push(cl("EnableSelection","UnlockedCells")),[["formatCells","AllowFormatCells"],["formatColumns","AllowSizeCols"],["formatRows","AllowSizeRows"],["insertColumns","AllowInsertCols"],["insertRows","AllowInsertRows"],["insertHyperlinks","AllowInsertHyperlinks"],["deleteColumns","AllowDeleteCols"],["deleteRows","AllowDeleteRows"],["sort","AllowSort"],["autoFilter","AllowFilter"],["pivotTables","AllowUsePivotTables"]].forEach(function(m){e["!protect"][m[0]]&&u.push("<"+m[1]+"/>")})),u.length==0?"":pn("WorksheetOptions",u.join(""),{xmlns:qc.x})}function Dwe(e){return e.map(function(t){var r=F_e(t.t||""),s=pn("ss:Data",r,{xmlns:"http://www.w3.org/TR/REC-html40"});return pn("Comment",s,{"ss:Author":t.a})}).join("")}function Rwe(e,t,r,s,u,f,m){if(!e||e.v==null&&e.f==null)return"";var i={};if(e.f&&(i["ss:Formula"]="="+xa(PM(e.f,m))),e.F&&e.F.slice(0,t.length)==t){var S=Zo(e.F.slice(t.length+1));i["ss:ArrayRange"]="RC:R"+(S.r==m.r?"":"["+(S.r-m.r)+"]")+"C"+(S.c==m.c?"":"["+(S.c-m.c)+"]")}if(e.l&&e.l.Target&&(i["ss:HRef"]=xa(e.l.Target),e.l.Tooltip&&(i["x:HRefScreenTip"]=xa(e.l.Tooltip))),r["!merges"])for(var E=r["!merges"],I=0;I!=E.length;++I)E[I].s.c!=m.c||E[I].s.r!=m.r||(E[I].e.c>E[I].s.c&&(i["ss:MergeAcross"]=E[I].e.c-E[I].s.c),E[I].e.r>E[I].s.r&&(i["ss:MergeDown"]=E[I].e.r-E[I].s.r));var D="",M="";switch(e.t){case"z":if(!s.sheetStubs)return"";break;case"n":D="Number",M=String(e.v);break;case"b":D="Boolean",M=e.v?"1":"0";break;case"e":D="Error",M=i2[e.v];break;case"d":D="DateTime",M=new Date(e.v).toISOString(),e.z==null&&(e.z=e.z||po[14]);break;case"s":D="String",M=O_e(e.v||"");break}var R=Nm(s.cellXfs,e,s);i["ss:StyleID"]="s"+(21+R),i["ss:Index"]=m.c+1;var H=e.v!=null?M:"",F=e.t=="z"?"":'<Data ss:Type="'+D+'">'+H+"</Data>";return(e.c||[]).length>0&&(F+=Dwe(e.c)),pn("Cell",F,i)}function Mwe(e,t){var r='<Row ss:Index="'+(e+1)+'"';return t&&(t.hpt&&!t.hpx&&(t.hpx=BW(t.hpt)),t.hpx&&(r+=' ss:AutoFitHeight="0" ss:Height="'+t.hpx+'"'),t.hidden&&(r+=' ss:Hidden="1"')),r+">"}function Owe(e,t,r,s){if(!e["!ref"])return"";var u=Ba(e["!ref"]),f=e["!merges"]||[],m=0,i=[];e["!cols"]&&e["!cols"].forEach(function(U,Y){NM(U);var z=!!U.width,J=IA(Y,U),ne={"ss:Index":Y+1};z&&(ne["ss:Width"]=bC(J.width)),U.hidden&&(ne["ss:Hidden"]="1"),i.push(pn("Column",null,ne))});for(var S=Array.isArray(e),E=u.s.r;E<=u.e.r;++E){for(var I=[Mwe(E,(e["!rows"]||[])[E])],D=u.s.c;D<=u.e.c;++D){var M=!1;for(m=0;m!=f.length;++m)if(!(f[m].s.c>D)&&!(f[m].s.r>E)&&!(f[m].e.c<D)&&!(f[m].e.r<E)){(f[m].s.c!=D||f[m].s.r!=E)&&(M=!0);break}if(!M){var R={r:E,c:D},H=ya(R),F=S?(e[E]||[])[D]:e[H];I.push(Rwe(F,H,e,t,r,s,R))}}I.push("</Row>"),I.length>2&&i.push(I.join(""))}return i.join("")}function Fwe(e,t,r){var s=[],u=r.SheetNames[e],f=r.Sheets[u],m=f?kwe(f,t,e,r):"";return m.length>0&&s.push("<Names>"+m+"</Names>"),m=f?Owe(f,t,e,r):"",m.length>0&&s.push("<Table>"+m+"</Table>"),s.push(Pwe(f,t,e,r)),s.join("")}function Lwe(e,t){t||(t={}),e.SSF||(e.SSF=Pc(po)),e.SSF&&(TA(),SA(e.SSF),t.revssf=EA(e.SSF),t.revssf[e.SSF[65535]]=0,t.ssf=e.SSF,t.cellXfs=[],Nm(t.cellXfs,{},{revssf:{General:0}}));var r=[];r.push(Awe(e,t)),r.push(jwe()),r.push(""),r.push("");for(var s=0;s<e.SheetNames.length;++s)r.push(pn("Worksheet",Fwe(s,t,e),{"ss:Name":xa(e.SheetNames[s])}));return r[2]=Iwe(e,t),r[3]=Nwe(e),No+pn("Workbook",r.join(""),{xmlns:qc.ss,"xmlns:o":qc.o,"xmlns:x":qc.x,"xmlns:ss":qc.ss,"xmlns:dt":qc.dt,"xmlns:html":qc.html})}var YN={SI:"e0859ff2f94f6810ab9108002b27b3d9",DSI:"02d5cdd59c2e1b10939708002b2cf9ae",UDI:"05d5cdd59c2e1b10939708002b2cf9ae"};function zwe(e,t){var r=[],s=[],u=[],f=0,m,i=f5(C5,"n"),S=f5(A5,"n");if(e.Props)for(m=pl(e.Props),f=0;f<m.length;++f)(Object.prototype.hasOwnProperty.call(i,m[f])?r:Object.prototype.hasOwnProperty.call(S,m[f])?s:u).push([m[f],e.Props[m[f]]]);if(e.Custprops)for(m=pl(e.Custprops),f=0;f<m.length;++f)Object.prototype.hasOwnProperty.call(e.Props||{},m[f])||(Object.prototype.hasOwnProperty.call(i,m[f])?r:Object.prototype.hasOwnProperty.call(S,m[f])?s:u).push([m[f],e.Custprops[m[f]]]);var E=[];for(f=0;f<u.length;++f)NW.indexOf(u[f][0])>-1||AW.indexOf(u[f][0])>-1||u[f][1]!=null&&E.push(u[f]);s.length&&Ta.utils.cfb_add(t,"/SummaryInformation",P5(s,YN.SI,S,A5)),(r.length||E.length)&&Ta.utils.cfb_add(t,"/DocumentSummaryInformation",P5(r,YN.DSI,i,C5,E.length?E:null,YN.UDI))}function Bwe(e,t){var r=t||{},s=Ta.utils.cfb_new({root:"R"}),u="/Workbook";switch(r.bookType||"xls"){case"xls":r.bookType="biff8";case"xla":r.bookType||(r.bookType="xla");case"biff8":u="/Workbook",r.biff=8;break;case"biff5":u="/Book",r.biff=5;break;default:throw new Error("invalid type "+r.bookType+" for XLS CFB")}return Ta.utils.cfb_add(s,u,oH(e,r)),r.biff==8&&(e.Props||e.Custprops)&&zwe(e,s),r.biff==8&&e.vbaraw&&ive(s,Ta.read(e.vbaraw,{type:typeof e.vbaraw=="string"?"binary":"buffer"})),s}var Uwe={0:{f:qye},1:{f:Jye},2:{f:x1e},3:{f:a1e},4:{f:r1e},5:{f:p1e},6:{f:S1e},7:{f:u1e},8:{f:N1e},9:{f:I1e},10:{f:A1e},11:{f:j1e},12:{f:e1e},13:{f:y1e},14:{f:l1e},15:{f:i1e},16:{f:g1e},17:{f:E1e},18:{f:h1e},19:{f:CM},20:{},21:{},22:{},23:{},24:{},25:{},26:{},27:{},28:{},29:{},30:{},31:{},32:{},33:{},34:{},35:{T:1},36:{T:-1},37:{T:1},38:{T:-1},39:{f:mwe},40:{},42:{},43:{f:Sxe},44:{f:wxe},45:{f:Cxe},46:{f:jxe},47:{f:Axe},48:{},49:{f:e0e},50:{},51:{f:qxe},52:{T:1},53:{T:-1},54:{T:1},55:{T:-1},56:{T:1},57:{T:-1},58:{},59:{},60:{f:txe},62:{f:b1e},63:{f:Yxe},64:{f:W1e},65:{},66:{},67:{},68:{},69:{},70:{},128:{},129:{T:1},130:{T:-1},131:{T:1,f:_h,p:0},132:{T:-1},133:{T:1},134:{T:-1},135:{T:1},136:{T:-1},137:{T:1,f:V1e},138:{T:-1},139:{T:1},140:{T:-1},141:{T:1},142:{T:-1},143:{T:1},144:{T:-1},145:{T:1},146:{T:-1},147:{f:Yye},148:{f:Hye,p:16},151:{f:O1e},152:{},153:{f:fwe},154:{},155:{},156:{f:dwe},157:{},158:{},159:{T:1,f:dxe},160:{T:-1},161:{T:1,f:M_},162:{T:-1},163:{T:1},164:{T:-1},165:{T:1},166:{T:-1},167:{},168:{},169:{},170:{},171:{},172:{T:1},173:{T:-1},174:{},175:{},176:{f:k1e},177:{T:1},178:{T:-1},179:{T:1},180:{T:-1},181:{T:1},182:{T:-1},183:{T:1},184:{T:-1},185:{T:1},186:{T:-1},187:{T:1},188:{T:-1},189:{T:1},190:{T:-1},191:{T:1},192:{T:-1},193:{T:1},194:{T:-1},195:{T:1},196:{T:-1},197:{T:1},198:{T:-1},199:{T:1},200:{T:-1},201:{T:1},202:{T:-1},203:{T:1},204:{T:-1},205:{T:1},206:{T:-1},207:{T:1},208:{T:-1},209:{T:1},210:{T:-1},211:{T:1},212:{T:-1},213:{T:1},214:{T:-1},215:{T:1},216:{T:-1},217:{T:1},218:{T:-1},219:{T:1},220:{T:-1},221:{T:1},222:{T:-1},223:{T:1},224:{T:-1},225:{T:1},226:{T:-1},227:{T:1},228:{T:-1},229:{T:1},230:{T:-1},231:{T:1},232:{T:-1},233:{T:1},234:{T:-1},235:{T:1},236:{T:-1},237:{T:1},238:{T:-1},239:{T:1},240:{T:-1},241:{T:1},242:{T:-1},243:{T:1},244:{T:-1},245:{T:1},246:{T:-1},247:{T:1},248:{T:-1},249:{T:1},250:{T:-1},251:{T:1},252:{T:-1},253:{T:1},254:{T:-1},255:{T:1},256:{T:-1},257:{T:1},258:{T:-1},259:{T:1},260:{T:-1},261:{T:1},262:{T:-1},263:{T:1},264:{T:-1},265:{T:1},266:{T:-1},267:{T:1},268:{T:-1},269:{T:1},270:{T:-1},271:{T:1},272:{T:-1},273:{T:1},274:{T:-1},275:{T:1},276:{T:-1},277:{},278:{T:1},279:{T:-1},280:{T:1},281:{T:-1},282:{T:1},283:{T:1},284:{T:-1},285:{T:1},286:{T:-1},287:{T:1},288:{T:-1},289:{T:1},290:{T:-1},291:{T:1},292:{T:-1},293:{T:1},294:{T:-1},295:{T:1},296:{T:-1},297:{T:1},298:{T:-1},299:{T:1},300:{T:-1},301:{T:1},302:{T:-1},303:{T:1},304:{T:-1},305:{T:1},306:{T:-1},307:{T:1},308:{T:-1},309:{T:1},310:{T:-1},311:{T:1},312:{T:-1},313:{T:-1},314:{T:1},315:{T:-1},316:{T:1},317:{T:-1},318:{T:1},319:{T:-1},320:{T:1},321:{T:-1},322:{T:1},323:{T:-1},324:{T:1},325:{T:-1},326:{T:1},327:{T:-1},328:{T:1},329:{T:-1},330:{T:1},331:{T:-1},332:{T:1},333:{T:-1},334:{T:1},335:{f:Vxe},336:{T:-1},337:{f:Hxe,T:1},338:{T:-1},339:{T:1},340:{T:-1},341:{T:1},342:{T:-1},343:{T:1},344:{T:-1},345:{T:1},346:{T:-1},347:{T:1},348:{T:-1},349:{T:1},350:{T:-1},351:{},352:{},353:{T:1},354:{T:-1},355:{f:tD},357:{},358:{},359:{},360:{T:1},361:{},362:{f:X0e},363:{},364:{},366:{},367:{},368:{},369:{},370:{},371:{},372:{T:1},373:{T:-1},374:{T:1},375:{T:-1},376:{T:1},377:{T:-1},378:{T:1},379:{T:-1},380:{T:1},381:{T:-1},382:{T:1},383:{T:-1},384:{T:1},385:{T:-1},386:{T:1},387:{T:-1},388:{T:1},389:{T:-1},390:{T:1},391:{T:-1},392:{T:1},393:{T:-1},394:{T:1},395:{T:-1},396:{},397:{},398:{},399:{},400:{},401:{T:1},403:{},404:{},405:{},406:{},407:{},408:{},409:{},410:{},411:{},412:{},413:{},414:{},415:{},416:{},417:{},418:{},419:{},420:{},421:{},422:{T:1},423:{T:1},424:{T:-1},425:{T:-1},426:{f:F1e},427:{f:L1e},428:{},429:{T:1},430:{T:-1},431:{T:1},432:{T:-1},433:{T:1},434:{T:-1},435:{T:1},436:{T:-1},437:{T:1},438:{T:-1},439:{T:1},440:{T:-1},441:{T:1},442:{T:-1},443:{T:1},444:{T:-1},445:{T:1},446:{T:-1},447:{T:1},448:{T:-1},449:{T:1},450:{T:-1},451:{T:1},452:{T:-1},453:{T:1},454:{T:-1},455:{T:1},456:{T:-1},457:{T:1},458:{T:-1},459:{T:1},460:{T:-1},461:{T:1},462:{T:-1},463:{T:1},464:{T:-1},465:{T:1},466:{T:-1},467:{T:1},468:{T:-1},469:{T:1},470:{T:-1},471:{},472:{},473:{T:1},474:{T:-1},475:{},476:{f:B1e},477:{},478:{},479:{T:1},480:{T:-1},481:{T:1},482:{T:-1},483:{T:1},484:{T:-1},485:{f:Xye},486:{T:1},487:{T:-1},488:{T:1},489:{T:-1},490:{T:1},491:{T:-1},492:{T:1},493:{T:-1},494:{f:R1e},495:{T:1},496:{T:-1},497:{T:1},498:{T:-1},499:{},500:{T:1},501:{T:-1},502:{T:1},503:{T:-1},504:{},505:{T:1},506:{T:-1},507:{},508:{T:1},509:{T:-1},510:{T:1},511:{T:-1},512:{},513:{},514:{T:1},515:{T:-1},516:{T:1},517:{T:-1},518:{T:1},519:{T:-1},520:{T:1},521:{T:-1},522:{},523:{},524:{},525:{},526:{},527:{},528:{T:1},529:{T:-1},530:{T:1},531:{T:-1},532:{T:1},533:{T:-1},534:{},535:{},536:{},537:{},538:{T:1},539:{T:-1},540:{T:1},541:{T:-1},542:{T:1},548:{},549:{},550:{f:tD},551:{},552:{},553:{},554:{T:1},555:{T:-1},556:{T:1},557:{T:-1},558:{T:1},559:{T:-1},560:{T:1},561:{T:-1},562:{},564:{},565:{T:1},566:{T:-1},569:{T:1},570:{T:-1},572:{},573:{T:1},574:{T:-1},577:{},578:{},579:{},580:{},581:{},582:{},583:{},584:{},585:{},586:{},587:{},588:{T:-1},589:{},590:{T:1},591:{T:-1},592:{T:1},593:{T:-1},594:{T:1},595:{T:-1},596:{},597:{T:1},598:{T:-1},599:{T:1},600:{T:-1},601:{T:1},602:{T:-1},603:{T:1},604:{T:-1},605:{T:1},606:{T:-1},607:{},608:{T:1},609:{T:-1},610:{},611:{T:1},612:{T:-1},613:{T:1},614:{T:-1},615:{T:1},616:{T:-1},617:{T:1},618:{T:-1},619:{T:1},620:{T:-1},625:{},626:{T:1},627:{T:-1},628:{T:1},629:{T:-1},630:{T:1},631:{T:-1},632:{f:tve},633:{T:1},634:{T:-1},635:{T:1,f:Qxe},636:{T:-1},637:{f:i0e},638:{T:1},639:{},640:{T:-1},641:{T:1},642:{T:-1},643:{T:1},644:{},645:{T:-1},646:{T:1},648:{T:1},649:{},650:{T:-1},651:{f:swe},652:{},653:{T:1},654:{T:-1},655:{T:1},656:{T:-1},657:{T:1},658:{T:-1},659:{},660:{T:1},661:{},662:{T:-1},663:{},664:{T:1},665:{},666:{T:-1},667:{},668:{},669:{},671:{T:1},672:{T:-1},673:{T:1},674:{T:-1},675:{},676:{},677:{},678:{},679:{},680:{},681:{},1024:{},1025:{},1026:{T:1},1027:{T:-1},1028:{T:1},1029:{T:-1},1030:{},1031:{T:1},1032:{T:-1},1033:{T:1},1034:{T:-1},1035:{},1036:{},1037:{},1038:{T:1},1039:{T:-1},1040:{},1041:{T:1},1042:{T:-1},1043:{},1044:{},1045:{},1046:{T:1},1047:{T:-1},1048:{T:1},1049:{T:-1},1050:{},1051:{T:1},1052:{T:1},1053:{f:H1e},1054:{T:1},1055:{},1056:{T:1},1057:{T:-1},1058:{T:1},1059:{T:-1},1061:{},1062:{T:1},1063:{T:-1},1064:{T:1},1065:{T:-1},1066:{T:1},1067:{T:-1},1068:{T:1},1069:{T:-1},1070:{T:1},1071:{T:-1},1072:{T:1},1073:{T:-1},1075:{T:1},1076:{T:-1},1077:{T:1},1078:{T:-1},1079:{T:1},1080:{T:-1},1081:{T:1},1082:{T:-1},1083:{T:1},1084:{T:-1},1085:{},1086:{T:1},1087:{T:-1},1088:{T:1},1089:{T:-1},1090:{T:1},1091:{T:-1},1092:{T:1},1093:{T:-1},1094:{T:1},1095:{T:-1},1096:{},1097:{T:1},1098:{},1099:{T:-1},1100:{T:1},1101:{T:-1},1102:{},1103:{},1104:{},1105:{},1111:{},1112:{},1113:{T:1},1114:{T:-1},1115:{T:1},1116:{T:-1},1117:{},1118:{T:1},1119:{T:-1},1120:{T:1},1121:{T:-1},1122:{T:1},1123:{T:-1},1124:{T:1},1125:{T:-1},1126:{},1128:{T:1},1129:{T:-1},1130:{},1131:{T:1},1132:{T:-1},1133:{T:1},1134:{T:-1},1135:{T:1},1136:{T:-1},1137:{T:1},1138:{T:-1},1139:{T:1},1140:{T:-1},1141:{},1142:{T:1},1143:{T:-1},1144:{T:1},1145:{T:-1},1146:{},1147:{T:1},1148:{T:-1},1149:{T:1},1150:{T:-1},1152:{T:1},1153:{T:-1},1154:{T:-1},1155:{T:-1},1156:{T:-1},1157:{T:1},1158:{T:-1},1159:{T:1},1160:{T:-1},1161:{T:1},1162:{T:-1},1163:{T:1},1164:{T:-1},1165:{T:1},1166:{T:-1},1167:{T:1},1168:{T:-1},1169:{T:1},1170:{T:-1},1171:{},1172:{T:1},1173:{T:-1},1177:{},1178:{T:1},1180:{},1181:{},1182:{},2048:{T:1},2049:{T:-1},2050:{},2051:{T:1},2052:{T:-1},2053:{},2054:{},2055:{T:1},2056:{T:-1},2057:{T:1},2058:{T:-1},2060:{},2067:{},2068:{T:1},2069:{T:-1},2070:{},2071:{},2072:{T:1},2073:{T:-1},2075:{},2076:{},2077:{T:1},2078:{T:-1},2079:{},2080:{T:1},2081:{T:-1},2082:{},2083:{T:1},2084:{T:-1},2085:{T:1},2086:{T:-1},2087:{T:1},2088:{T:-1},2089:{T:1},2090:{T:-1},2091:{},2092:{},2093:{T:1},2094:{T:-1},2095:{},2096:{T:1},2097:{T:-1},2098:{T:1},2099:{T:-1},2100:{T:1},2101:{T:-1},2102:{},2103:{T:1},2104:{T:-1},2105:{},2106:{T:1},2107:{T:-1},2108:{},2109:{T:1},2110:{T:-1},2111:{T:1},2112:{T:-1},2113:{T:1},2114:{T:-1},2115:{},2116:{},2117:{},2118:{T:1},2119:{T:-1},2120:{},2121:{T:1},2122:{T:-1},2123:{T:1},2124:{T:-1},2125:{},2126:{T:1},2127:{T:-1},2128:{},2129:{T:1},2130:{T:-1},2131:{T:1},2132:{T:-1},2133:{T:1},2134:{},2135:{},2136:{},2137:{T:1},2138:{T:-1},2139:{T:1},2140:{T:-1},2141:{},3072:{},3073:{},4096:{T:1},4097:{T:-1},5002:{T:1},5003:{T:-1},5081:{T:1},5082:{T:-1},5083:{},5084:{T:1},5085:{T:-1},5086:{T:1},5087:{T:-1},5088:{},5089:{},5090:{},5092:{T:1},5093:{T:-1},5094:{},5095:{T:1},5096:{T:-1},5097:{},5099:{},65535:{n:""}};function mn(e,t,r,s){var u=t;if(!isNaN(u)){var f=s||(r||[]).length||0,m=e.next(4);m.write_shift(2,u),m.write_shift(2,f),f>0&&SM(r)&&e.push(r)}}function Vwe(e,t,r,s){var u=(r||[]).length||0;if(u<=8224)return mn(e,t,r,u);var f=t;if(!isNaN(f)){for(var m=r.parts||[],i=0,S=0,E=0;E+(m[i]||8224)<=8224;)E+=m[i]||8224,i++;var I=e.next(4);for(I.write_shift(2,f),I.write_shift(2,E),e.push(r.slice(S,S+E)),S+=E;S<u;){for(I=e.next(4),I.write_shift(2,60),E=0;E+(m[i]||8224)<=8224;)E+=m[i]||8224,i++;I.write_shift(2,E),e.push(r.slice(S,S+E)),S+=E}}}function a2(e,t,r){return e||(e=vr(7)),e.write_shift(2,t),e.write_shift(2,r),e.write_shift(2,0),e.write_shift(1,0),e}function $we(e,t,r,s){var u=vr(9);return a2(u,e,t),PW(r,s||"b",u),u}function qwe(e,t,r){var s=vr(8+2*r.length);return a2(s,e,t),s.write_shift(1,r.length),s.write_shift(r.length,r,"sbcs"),s.l<s.length?s.slice(0,s.l):s}function Gwe(e,t,r,s){if(t.v!=null)switch(t.t){case"d":case"n":var u=t.t=="d"?kc(Ql(t.v)):t.v;u==(u|0)&&u>=0&&u<65536?mn(e,2,sxe(r,s,u)):mn(e,3,ixe(r,s,u));return;case"b":case"e":mn(e,5,$we(r,s,t.v,t.t));return;case"s":case"str":mn(e,4,qwe(r,s,(t.v||"").slice(0,255)));return}mn(e,1,a2(null,r,s))}function Wwe(e,t,r,s){var u=Array.isArray(t),f=Ba(t["!ref"]||"A1"),m,i="",S=[];if(f.e.c>255||f.e.r>16383){if(s.WTF)throw new Error("Range "+(t["!ref"]||"A1")+" exceeds format limit A1:IV16384");f.e.c=Math.min(f.e.c,255),f.e.r=Math.min(f.e.c,16383),m=Io(f)}for(var E=f.s.r;E<=f.e.r;++E){i=dl(E);for(var I=f.s.c;I<=f.e.c;++I){E===f.s.r&&(S[I]=El(I)),m=S[I]+i;var D=u?(t[E]||[])[I]:t[m];D&&Gwe(e,D,E,I)}}}function Hwe(e,t){for(var r=t||{},s=Nc(),u=0,f=0;f<e.SheetNames.length;++f)e.SheetNames[f]==r.sheet&&(u=f);if(u==0&&r.sheet&&e.SheetNames[0]!=r.sheet)throw new Error("Sheet not found: "+r.sheet);return mn(s,r.biff==4?1033:r.biff==3?521:9,IM(e,16,r)),Wwe(s,e.Sheets[e.SheetNames[u]],u,r),mn(s,10),s.end()}function Zwe(e,t,r){mn(e,49,U0e({sz:12,color:{theme:1},name:"Arial",family:2,scheme:"minor"},r))}function Xwe(e,t,r){t&&[[5,8],[23,26],[41,44],[50,392]].forEach(function(s){for(var u=s[0];u<=s[1];++u)t[u]!=null&&mn(e,1054,q0e(u,t[u],r))})}function Ywe(e,t){var r=vr(19);r.write_shift(4,2151),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(2,3),r.write_shift(1,1),r.write_shift(4,0),mn(e,2151,r),r=vr(39),r.write_shift(4,2152),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(2,3),r.write_shift(1,0),r.write_shift(4,0),r.write_shift(2,1),r.write_shift(4,4),r.write_shift(2,0),MW(Ba(t["!ref"]||"A1"),r),r.write_shift(4,4),mn(e,2152,r)}function Kwe(e,t){for(var r=0;r<16;++r)mn(e,224,R5({numFmtId:0,style:!0},0,t));t.cellXfs.forEach(function(s){mn(e,224,R5(s,0,t))})}function Jwe(e,t){for(var r=0;r<t["!links"].length;++r){var s=t["!links"][r];mn(e,440,J0e(s)),s[1].Tooltip&&mn(e,2048,Q0e(s))}delete t["!links"]}function Qwe(e,t){if(t){var r=0;t.forEach(function(s,u){++r<=256&&s&&mn(e,125,rxe(IA(u,s),u))})}}function ebe(e,t,r,s,u){var f=16+Nm(u.cellXfs,t,u);if(t.v==null&&!t.bf){mn(e,513,C_(r,s,f));return}if(t.bf)mn(e,6,Tye(t,r,s,u,f));else switch(t.t){case"d":case"n":var m=t.t=="d"?kc(Ql(t.v)):t.v;mn(e,515,Z0e(r,s,m,f));break;case"b":case"e":mn(e,517,H0e(r,s,t.v,f,u,t.t));break;case"s":case"str":if(u.bookSST){var i=RM(u.Strings,t.v,u.revStrings);mn(e,253,V0e(r,s,i,f))}else mn(e,516,$0e(r,s,(t.v||"").slice(0,255),f,u));break;default:mn(e,513,C_(r,s,f))}}function tbe(e,t,r){var s=Nc(),u=r.SheetNames[e],f=r.Sheets[u]||{},m=(r||{}).Workbook||{},i=(m.Sheets||[])[e]||{},S=Array.isArray(f),E=t.biff==8,I,D="",M=[],R=Ba(f["!ref"]||"A1"),H=E?65536:16384;if(R.e.c>255||R.e.r>=H){if(t.WTF)throw new Error("Range "+(f["!ref"]||"A1")+" exceeds format limit A1:IV16384");R.e.c=Math.min(R.e.c,255),R.e.r=Math.min(R.e.c,H-1)}mn(s,2057,IM(r,16,t)),mn(s,13,_u(1)),mn(s,12,_u(100)),mn(s,15,Yl(!0)),mn(s,17,Yl(!1)),mn(s,16,E_(.001)),mn(s,95,Yl(!0)),mn(s,42,Yl(!1)),mn(s,43,Yl(!1)),mn(s,130,_u(1)),mn(s,128,W0e()),mn(s,131,Yl(!1)),mn(s,132,Yl(!1)),E&&Qwe(s,f["!cols"]),mn(s,512,G0e(R,t)),E&&(f["!links"]=[]);for(var F=R.s.r;F<=R.e.r;++F){D=dl(F);for(var U=R.s.c;U<=R.e.c;++U){F===R.s.r&&(M[U]=El(U)),I=M[U]+D;var Y=S?(f[F]||[])[U]:f[I];Y&&(ebe(s,Y,F,U,t),E&&Y.l&&f["!links"].push([I,Y.l]))}}var z=i.CodeName||i.name||u;return E&&mn(s,574,B0e((m.Views||[])[0])),E&&(f["!merges"]||[]).length&&mn(s,229,K0e(f["!merges"])),E&&Jwe(s,f),mn(s,442,RW(z)),E&&Ywe(s,f),mn(s,10),s.end()}function rbe(e,t,r){var s=Nc(),u=(e||{}).Workbook||{},f=u.Sheets||[],m=u.WBProps||{},i=r.biff==8,S=r.biff==5;if(mn(s,2057,IM(e,5,r)),r.bookType=="xla"&&mn(s,135),mn(s,225,i?_u(1200):null),mn(s,193,A0e(2)),S&&mn(s,191),S&&mn(s,192),mn(s,226),mn(s,92,O0e("SheetJS",r)),mn(s,66,_u(i?1200:1252)),i&&mn(s,353,_u(0)),i&&mn(s,448),mn(s,317,nxe(e.SheetNames.length)),i&&e.vbaraw&&mn(s,211),i&&e.vbaraw){var E=m.CodeName||"ThisWorkbook";mn(s,442,RW(E))}mn(s,156,_u(17)),mn(s,25,Yl(!1)),mn(s,18,Yl(!1)),mn(s,19,_u(0)),i&&mn(s,431,Yl(!1)),i&&mn(s,444,_u(0)),mn(s,61,z0e()),mn(s,64,Yl(!1)),mn(s,141,_u(0)),mn(s,34,Yl(owe(e)=="true")),mn(s,14,Yl(!0)),i&&mn(s,439,Yl(!1)),mn(s,218,_u(0)),Zwe(s,e,r),Xwe(s,e.SSF,r),Kwe(s,r),i&&mn(s,352,Yl(!1));var I=s.end(),D=Nc();i&&mn(D,140,exe()),i&&r.Strings&&Vwe(D,252,L0e(r.Strings)),mn(D,10);var M=D.end(),R=Nc(),H=0,F=0;for(F=0;F<e.SheetNames.length;++F)H+=(i?12:11)+(i?2:1)*e.SheetNames[F].length;var U=I.length+H+M.length;for(F=0;F<e.SheetNames.length;++F){var Y=f[F]||{};mn(R,133,F0e({pos:U,hs:Y.Hidden||0,dt:0,name:e.SheetNames[F]},r)),U+=t[F].length}var z=R.end();if(H!=z.length)throw new Error("BS8 "+H+" != "+z.length);var J=[];return I.length&&J.push(I),z.length&&J.push(z),M.length&&J.push(M),ll(J)}function nbe(e,t){var r=t||{},s=[];e&&!e.SSF&&(e.SSF=Pc(po)),e&&e.SSF&&(TA(),SA(e.SSF),r.revssf=EA(e.SSF),r.revssf[e.SSF[65535]]=0,r.ssf=e.SSF),r.Strings=[],r.Strings.Count=0,r.Strings.Unique=0,MM(r),r.cellXfs=[],Nm(r.cellXfs,{},{revssf:{General:0}}),e.Props||(e.Props={});for(var u=0;u<e.SheetNames.length;++u)s[s.length]=tbe(u,r,e);return s.unshift(rbe(e,s,r)),ll(s)}function oH(e,t){for(var r=0;r<=e.SheetNames.length;++r){var s=e.Sheets[e.SheetNames[r]];if(!(!s||!s["!ref"])){var u=eu(s["!ref"]);u.e.c>255&&typeof console<"u"&&console.error&&console.error("Worksheet '"+e.SheetNames[r]+"' extends beyond column IV (255).  Data may be lost.")}}var f=t||{};switch(f.biff||2){case 8:case 5:return nbe(e,t);case 4:case 3:case 2:return Hwe(e,t)}throw new Error("invalid type "+f.bookType+" for BIFF")}function ibe(e,t,r,s){for(var u=e["!merges"]||[],f=[],m=t.s.c;m<=t.e.c;++m){for(var i=0,S=0,E=0;E<u.length;++E)if(!(u[E].s.r>r||u[E].s.c>m)&&!(u[E].e.r<r||u[E].e.c<m)){if(u[E].s.r<r||u[E].s.c<m){i=-1;break}i=u[E].e.r-u[E].s.r+1,S=u[E].e.c-u[E].s.c+1;break}if(!(i<0)){var I=ya({r,c:m}),D=s.dense?(e[r]||[])[m]:e[I],M=D&&D.v!=null&&(D.h||M_e(D.w||(yf(D),D.w)||""))||"",R={};i>1&&(R.rowspan=i),S>1&&(R.colspan=S),s.editable?M='<span contenteditable="true">'+M+"</span>":D&&(R["data-t"]=D&&D.t||"z",D.v!=null&&(R["data-v"]=D.v),D.z!=null&&(R["data-z"]=D.z),D.l&&(D.l.Target||"#").charAt(0)!="#"&&(M='<a href="'+D.l.Target+'">'+M+"</a>")),R.id=(s.id||"sjs")+"-"+I,f.push(pn("td",M,R))}}var H="<tr>";return H+f.join("")+"</tr>"}var sbe='<html><head><meta charset="utf-8"/><title>SheetJS Table Export</title></head><body>',abe="</body></html>";function obe(e,t,r){var s=[];return s.join("")+"<table"+(r&&r.id?' id="'+r.id+'"':"")+">"}function lH(e,t){var r=t||{},s=r.header!=null?r.header:sbe,u=r.footer!=null?r.footer:abe,f=[s],m=eu(e["!ref"]);r.dense=Array.isArray(e),f.push(obe(e,m,r));for(var i=m.s.r;i<=m.e.r;++i)f.push(ibe(e,m,i,r));return f.push("</table>"+u),f.join("")}function cH(e,t,r){var s=r||{},u=0,f=0;if(s.origin!=null)if(typeof s.origin=="number")u=s.origin;else{var m=typeof s.origin=="string"?Zo(s.origin):s.origin;u=m.r,f=m.c}var i=t.getElementsByTagName("tr"),S=Math.min(s.sheetRows||1e7,i.length),E={s:{r:0,c:0},e:{r:u,c:f}};if(e["!ref"]){var I=eu(e["!ref"]);E.s.r=Math.min(E.s.r,I.s.r),E.s.c=Math.min(E.s.c,I.s.c),E.e.r=Math.max(E.e.r,I.e.r),E.e.c=Math.max(E.e.c,I.e.c),u==-1&&(E.e.r=u=I.e.r+1)}var D=[],M=0,R=e["!rows"]||(e["!rows"]=[]),H=0,F=0,U=0,Y=0,z=0,J=0;for(e["!cols"]||(e["!cols"]=[]);H<i.length&&F<S;++H){var ne=i[H];if(U5(ne)){if(s.display)continue;R[F]={hidden:!0}}var me=ne.children;for(U=Y=0;U<me.length;++U){var le=me[U];if(!(s.display&&U5(le))){var ye=le.hasAttribute("data-v")?le.getAttribute("data-v"):le.hasAttribute("v")?le.getAttribute("v"):z_e(le.innerHTML),pe=le.getAttribute("data-z")||le.getAttribute("z");for(M=0;M<D.length;++M){var be=D[M];be.s.c==Y+f&&be.s.r<F+u&&F+u<=be.e.r&&(Y=be.e.c+1-f,M=-1)}J=+le.getAttribute("colspan")||1,((z=+le.getAttribute("rowspan")||1)>1||J>1)&&D.push({s:{r:F+u,c:Y+f},e:{r:F+u+(z||1)-1,c:Y+f+(J||1)-1}});var ke={t:"s",v:ye},Oe=le.getAttribute("data-t")||le.getAttribute("t")||"";ye!=null&&(ye.length==0?ke.t=Oe||"z":s.raw||ye.trim().length==0||Oe=="s"||(ye==="TRUE"?ke={t:"b",v:!0}:ye==="FALSE"?ke={t:"b",v:!1}:isNaN(uf(ye))?isNaN(Sb(ye).getDate())||(ke={t:"d",v:Ql(ye)},s.cellDates||(ke={t:"n",v:kc(ke.v)}),ke.z=s.dateNF||po[14]):ke={t:"n",v:uf(ye)})),ke.z===void 0&&pe!=null&&(ke.z=pe);var Ee="",qe=le.getElementsByTagName("A");if(qe&&qe.length)for(var Qe=0;Qe<qe.length&&!(qe[Qe].hasAttribute("href")&&(Ee=qe[Qe].getAttribute("href"),Ee.charAt(0)!="#"));++Qe);Ee&&Ee.charAt(0)!="#"&&(ke.l={Target:Ee}),s.dense?(e[F+u]||(e[F+u]=[]),e[F+u][Y+f]=ke):e[ya({c:Y+f,r:F+u})]=ke,E.e.c<Y+f&&(E.e.c=Y+f),Y+=J}}++F}return D.length&&(e["!merges"]=(e["!merges"]||[]).concat(D)),E.e.r=Math.max(E.e.r,F-1+u),e["!ref"]=Io(E),F>=S&&(e["!fullref"]=Io((E.e.r=i.length-H+F-1+u,E))),e}function uH(e,t){var r=t||{},s=r.dense?[]:{};return cH(s,e,t)}function lbe(e,t){return k_(uH(e,t),t)}function U5(e){var t="",r=cbe(e);return r&&(t=r(e).getPropertyValue("display")),t||(t=e.style&&e.style.display),t==="none"}function cbe(e){return e.ownerDocument.defaultView&&typeof e.ownerDocument.defaultView.getComputedStyle=="function"?e.ownerDocument.defaultView.getComputedStyle:typeof getComputedStyle=="function"?getComputedStyle:null}var ube=function(){var e=["<office:master-styles>",'<style:master-page style:name="mp1" style:page-layout-name="mp1">',"<style:header/>",'<style:header-left style:display="false"/>',"<style:footer/>",'<style:footer-left style:display="false"/>',"</style:master-page>","</office:master-styles>"].join(""),t="<office:document-styles "+Eb({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","office:version":"1.2"})+">"+e+"</office:document-styles>";return function(){return No+t}}(),V5=function(){var e=function(f){return xa(f).replace(/  +/g,function(m){return'<text:s text:c="'+m.length+'"/>'}).replace(/\t/g,"<text:tab/>").replace(/\n/g,"</text:p><text:p>").replace(/^ /,"<text:s/>").replace(/ $/,"<text:s/>")},t=`          <table:table-cell />
`,r=`          <table:covered-table-cell/>
`,s=function(f,m,i){var S=[];S.push('      <table:table table:name="'+xa(m.SheetNames[i])+`" table:style-name="ta1">
`);var E=0,I=0,D=eu(f["!ref"]||"A1"),M=f["!merges"]||[],R=0,H=Array.isArray(f);if(f["!cols"])for(I=0;I<=D.e.c;++I)S.push("        <table:table-column"+(f["!cols"][I]?' table:style-name="co'+f["!cols"][I].ods+'"':"")+`></table:table-column>
`);var F="",U=f["!rows"]||[];for(E=0;E<D.s.r;++E)F=U[E]?' table:style-name="ro'+U[E].ods+'"':"",S.push("        <table:table-row"+F+`></table:table-row>
`);for(;E<=D.e.r;++E){for(F=U[E]?' table:style-name="ro'+U[E].ods+'"':"",S.push("        <table:table-row"+F+`>
`),I=0;I<D.s.c;++I)S.push(t);for(;I<=D.e.c;++I){var Y=!1,z={},J="";for(R=0;R!=M.length;++R)if(!(M[R].s.c>I)&&!(M[R].s.r>E)&&!(M[R].e.c<I)&&!(M[R].e.r<E)){(M[R].s.c!=I||M[R].s.r!=E)&&(Y=!0),z["table:number-columns-spanned"]=M[R].e.c-M[R].s.c+1,z["table:number-rows-spanned"]=M[R].e.r-M[R].s.r+1;break}if(Y){S.push(r);continue}var ne=ya({r:E,c:I}),me=H?(f[E]||[])[I]:f[ne];if(me&&me.f&&(z["table:formula"]=xa(Nye(me.f)),me.F&&me.F.slice(0,ne.length)==ne)){var le=eu(me.F);z["table:number-matrix-columns-spanned"]=le.e.c-le.s.c+1,z["table:number-matrix-rows-spanned"]=le.e.r-le.s.r+1}if(!me){S.push(t);continue}switch(me.t){case"b":J=me.v?"TRUE":"FALSE",z["office:value-type"]="boolean",z["office:boolean-value"]=me.v?"true":"false";break;case"n":J=me.w||String(me.v||0),z["office:value-type"]="float",z["office:value"]=me.v||0;break;case"s":case"str":J=me.v==null?"":me.v,z["office:value-type"]="string";break;case"d":J=me.w||Ql(me.v).toISOString(),z["office:value-type"]="date",z["office:date-value"]=Ql(me.v).toISOString(),z["table:style-name"]="ce1";break;default:S.push(t);continue}var ye=e(J);if(me.l&&me.l.Target){var pe=me.l.Target;pe=pe.charAt(0)=="#"?"#"+kye(pe.slice(1)):pe,pe.charAt(0)!="#"&&!pe.match(/^\w+:/)&&(pe="../"+pe),ye=pn("text:a",ye,{"xlink:href":pe.replace(/&/g,"&amp;")})}S.push("          "+pn("table:table-cell",pn("text:p",ye,{}),z)+`
`)}S.push(`        </table:table-row>
`)}return S.push(`      </table:table>
`),S.join("")},u=function(f,m){f.push(` <office:automatic-styles>
`),f.push(`  <number:date-style style:name="N37" number:automatic-order="true">
`),f.push(`   <number:month number:style="long"/>
`),f.push(`   <number:text>/</number:text>
`),f.push(`   <number:day number:style="long"/>
`),f.push(`   <number:text>/</number:text>
`),f.push(`   <number:year/>
`),f.push(`  </number:date-style>
`);var i=0;m.SheetNames.map(function(E){return m.Sheets[E]}).forEach(function(E){if(E&&E["!cols"]){for(var I=0;I<E["!cols"].length;++I)if(E["!cols"][I]){var D=E["!cols"][I];if(D.width==null&&D.wpx==null&&D.wch==null)continue;NM(D),D.ods=i;var M=E["!cols"][I].wpx+"px";f.push('  <style:style style:name="co'+i+`" style:family="table-column">
`),f.push('   <style:table-column-properties fo:break-before="auto" style:column-width="'+M+`"/>
`),f.push(`  </style:style>
`),++i}}});var S=0;m.SheetNames.map(function(E){return m.Sheets[E]}).forEach(function(E){if(E&&E["!rows"]){for(var I=0;I<E["!rows"].length;++I)if(E["!rows"][I]){E["!rows"][I].ods=S;var D=E["!rows"][I].hpx+"px";f.push('  <style:style style:name="ro'+S+`" style:family="table-row">
`),f.push('   <style:table-row-properties fo:break-before="auto" style:row-height="'+D+`"/>
`),f.push(`  </style:style>
`),++S}}}),f.push(`  <style:style style:name="ta1" style:family="table" style:master-page-name="mp1">
`),f.push(`   <style:table-properties table:display="true" style:writing-mode="lr-tb"/>
`),f.push(`  </style:style>
`),f.push(`  <style:style style:name="ce1" style:family="table-cell" style:parent-style-name="Default" style:data-style-name="N37"/>
`),f.push(` </office:automatic-styles>
`)};return function(m,i){var S=[No],E=Eb({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:meta":"urn:oasis:names:tc:opendocument:xmlns:meta:1.0","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:presentation":"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:chart":"urn:oasis:names:tc:opendocument:xmlns:chart:1.0","xmlns:dr3d":"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0","xmlns:math":"http://www.w3.org/1998/Math/MathML","xmlns:form":"urn:oasis:names:tc:opendocument:xmlns:form:1.0","xmlns:script":"urn:oasis:names:tc:opendocument:xmlns:script:1.0","xmlns:ooo":"http://openoffice.org/2004/office","xmlns:ooow":"http://openoffice.org/2004/writer","xmlns:oooc":"http://openoffice.org/2004/calc","xmlns:dom":"http://www.w3.org/2001/xml-events","xmlns:xforms":"http://www.w3.org/2002/xforms","xmlns:xsd":"http://www.w3.org/2001/XMLSchema","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xmlns:sheet":"urn:oasis:names:tc:opendocument:sh33tjs:1.0","xmlns:rpt":"http://openoffice.org/2005/report","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","xmlns:xhtml":"http://www.w3.org/1999/xhtml","xmlns:grddl":"http://www.w3.org/2003/g/data-view#","xmlns:tableooo":"http://openoffice.org/2009/table","xmlns:drawooo":"http://openoffice.org/2010/draw","xmlns:calcext":"urn:org:documentfoundation:names:experimental:calc:xmlns:calcext:1.0","xmlns:loext":"urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0","xmlns:field":"urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0","xmlns:formx":"urn:openoffice:names:experimental:ooxml-odf-interop:xmlns:form:1.0","xmlns:css3t":"http://www.w3.org/TR/css3-text/","office:version":"1.2"}),I=Eb({"xmlns:config":"urn:oasis:names:tc:opendocument:xmlns:config:1.0","office:mimetype":"application/vnd.oasis.opendocument.spreadsheet"});i.bookType=="fods"?(S.push("<office:document"+E+I+`>
`),S.push(EW().replace(/office:document-meta/g,"office:meta"))):S.push("<office:document-content"+E+`>
`),u(S,m),S.push(`  <office:body>
`),S.push(`    <office:spreadsheet>
`);for(var D=0;D!=m.SheetNames.length;++D)S.push(s(m.Sheets[m.SheetNames[D]],m,D));return S.push(`    </office:spreadsheet>
`),S.push(`  </office:body>
`),i.bookType=="fods"?S.push("</office:document>"):S.push("</office:document-content>"),S.join("")}}();function dH(e,t){if(t.bookType=="fods")return V5(e,t);var r=vM(),s="",u=[],f=[];return s="mimetype",hs(r,s,"application/vnd.oasis.opendocument.spreadsheet"),s="content.xml",hs(r,s,V5(e,t)),u.push([s,"text/xml"]),f.push([s,"ContentFile"]),s="styles.xml",hs(r,s,ube(e,t)),u.push([s,"text/xml"]),f.push([s,"StylesFile"]),s="meta.xml",hs(r,s,No+EW()),u.push([s,"text/xml"]),f.push([s,"MetadataFile"]),s="manifest.rdf",hs(r,s,b0e(f)),u.push([s,"application/rdf+xml"]),s="META-INF/manifest.xml",hs(r,s,y0e(u)),r}/*! sheetjs (C) 2013-present SheetJS -- http://sheetjs.com */function EC(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function dbe(e){return typeof TextEncoder<"u"?new TextEncoder().encode(e):md(Tb(e))}function hbe(e,t){e:for(var r=0;r<=e.length-t.length;++r){for(var s=0;s<t.length;++s)if(e[r+s]!=t[s])continue e;return!0}return!1}function _m(e){var t=e.reduce(function(u,f){return u+f.length},0),r=new Uint8Array(t),s=0;return e.forEach(function(u){r.set(u,s),s+=u.length}),r}function fbe(e,t,r){var s=Math.floor(r==0?0:Math.LOG10E*Math.log(Math.abs(r)))+6176-20,u=r/Math.pow(10,s-6176);e[t+15]|=s>>7,e[t+14]|=(s&127)<<1;for(var f=0;u>=1;++f,u/=256)e[t+f]=u&255;e[t+15]|=r>=0?0:128}function Cb(e,t){var r=t?t[0]:0,s=e[r]&127;e:if(e[r++]>=128&&(s|=(e[r]&127)<<7,e[r++]<128||(s|=(e[r]&127)<<14,e[r++]<128)||(s|=(e[r]&127)<<21,e[r++]<128)||(s+=(e[r]&127)*Math.pow(2,28),++r,e[r++]<128)||(s+=(e[r]&127)*Math.pow(2,35),++r,e[r++]<128)||(s+=(e[r]&127)*Math.pow(2,42),++r,e[r++]<128)))break e;return t&&(t[0]=r),s}function ma(e){var t=new Uint8Array(7);t[0]=e&127;var r=1;e:if(e>127){if(t[r-1]|=128,t[r]=e>>7&127,++r,e<=16383||(t[r-1]|=128,t[r]=e>>14&127,++r,e<=2097151)||(t[r-1]|=128,t[r]=e>>21&127,++r,e<=268435455)||(t[r-1]|=128,t[r]=e/256>>>21&127,++r,e<=34359738367)||(t[r-1]|=128,t[r]=e/65536>>>21&127,++r,e<=4398046511103))break e;t[r-1]|=128,t[r]=e/16777216>>>21&127,++r}return t.slice(0,r)}function tv(e){var t=0,r=e[t]&127;e:if(e[t++]>=128){if(r|=(e[t]&127)<<7,e[t++]<128||(r|=(e[t]&127)<<14,e[t++]<128)||(r|=(e[t]&127)<<21,e[t++]<128))break e;r|=(e[t]&127)<<28}return r}function Mo(e){for(var t=[],r=[0];r[0]<e.length;){var s=r[0],u=Cb(e,r),f=u&7;u=Math.floor(u/8);var m=0,i;if(u==0)break;switch(f){case 0:{for(var S=r[0];e[r[0]++]>=128;);i=e.slice(S,r[0])}break;case 5:m=4,i=e.slice(r[0],r[0]+m),r[0]+=m;break;case 1:m=8,i=e.slice(r[0],r[0]+m),r[0]+=m;break;case 2:m=Cb(e,r),i=e.slice(r[0],r[0]+m),r[0]+=m;break;case 3:case 4:default:throw new Error("PB Type ".concat(f," for Field ").concat(u," at offset ").concat(s))}var E={data:i,type:f};t[u]==null?t[u]=[E]:t[u].push(E)}return t}function il(e){var t=[];return e.forEach(function(r,s){r.forEach(function(u){u.data&&(t.push(ma(s*8+u.type)),u.type==2&&t.push(ma(u.data.length)),t.push(u.data))})}),_m(t)}function td(e){for(var t,r=[],s=[0];s[0]<e.length;){var u=Cb(e,s),f=Mo(e.slice(s[0],s[0]+u));s[0]+=u;var m={id:tv(f[1][0].data),messages:[]};f[2].forEach(function(i){var S=Mo(i.data),E=tv(S[3][0].data);m.messages.push({meta:S,data:e.slice(s[0],s[0]+E)}),s[0]+=E}),(t=f[3])!=null&&t[0]&&(m.merge=tv(f[3][0].data)>>>0>0),r.push(m)}return r}function yx(e){var t=[];return e.forEach(function(r){var s=[];s[1]=[{data:ma(r.id),type:0}],s[2]=[],r.merge!=null&&(s[3]=[{data:ma(+!!r.merge),type:0}]);var u=[];r.messages.forEach(function(m){u.push(m.data),m.meta[3]=[{type:0,data:ma(m.data.length)}],s[2].push({data:il(m.meta),type:2})});var f=il(s);t.push(ma(f.length)),t.push(f),u.forEach(function(m){return t.push(m)})}),_m(t)}function pbe(e,t){if(e!=0)throw new Error("Unexpected Snappy chunk type ".concat(e));for(var r=[0],s=Cb(t,r),u=[];r[0]<t.length;){var f=t[r[0]]&3;if(f==0){var m=t[r[0]++]>>2;if(m<60)++m;else{var i=m-59;m=t[r[0]],i>1&&(m|=t[r[0]+1]<<8),i>2&&(m|=t[r[0]+2]<<16),i>3&&(m|=t[r[0]+3]<<24),m>>>=0,m++,r[0]+=i}u.push(t.slice(r[0],r[0]+m)),r[0]+=m;continue}else{var S=0,E=0;if(f==1?(E=(t[r[0]]>>2&7)+4,S=(t[r[0]++]&224)<<3,S|=t[r[0]++]):(E=(t[r[0]++]>>2)+1,f==2?(S=t[r[0]]|t[r[0]+1]<<8,r[0]+=2):(S=(t[r[0]]|t[r[0]+1]<<8|t[r[0]+2]<<16|t[r[0]+3]<<24)>>>0,r[0]+=4)),u=[_m(u)],S==0)throw new Error("Invalid offset 0");if(S>u[0].length)throw new Error("Invalid offset beyond length");if(E>=S)for(u.push(u[0].slice(-S)),E-=S;E>=u[u.length-1].length;)u.push(u[u.length-1]),E-=u[u.length-1].length;u.push(u[0].slice(-S,-S+E))}}var I=_m(u);if(I.length!=s)throw new Error("Unexpected length: ".concat(I.length," != ").concat(s));return I}function rd(e){for(var t=[],r=0;r<e.length;){var s=e[r++],u=e[r]|e[r+1]<<8|e[r+2]<<16;r+=3,t.push(pbe(s,e.slice(r,r+u))),r+=u}if(r!==e.length)throw new Error("data is not a valid framed stream!");return _m(t)}function wx(e){for(var t=[],r=0;r<e.length;){var s=Math.min(e.length-r,268435455),u=new Uint8Array(4);t.push(u);var f=ma(s),m=f.length;t.push(f),s<=60?(m++,t.push(new Uint8Array([s-1<<2]))):s<=256?(m+=2,t.push(new Uint8Array([240,s-1&255]))):s<=65536?(m+=3,t.push(new Uint8Array([244,s-1&255,s-1>>8&255]))):s<=16777216?(m+=4,t.push(new Uint8Array([248,s-1&255,s-1>>8&255,s-1>>16&255]))):s<=4294967296&&(m+=5,t.push(new Uint8Array([252,s-1&255,s-1>>8&255,s-1>>16&255,s-1>>>24&255]))),t.push(e.slice(r,r+s)),m+=s,u[0]=0,u[1]=m&255,u[2]=m>>8&255,u[3]=m>>16&255,r+=s}return _m(t)}function KN(e,t){var r=new Uint8Array(32),s=EC(r),u=12,f=0;switch(r[0]=5,e.t){case"n":r[1]=2,fbe(r,u,e.v),f|=1,u+=16;break;case"b":r[1]=6,s.setFloat64(u,e.v?1:0,!0),f|=2,u+=8;break;case"s":if(t.indexOf(e.v)==-1)throw new Error("Value ".concat(e.v," missing from SST!"));r[1]=3,s.setUint32(u,t.indexOf(e.v),!0),f|=8,u+=4;break;default:throw"unsupported cell type "+e.t}return s.setUint32(8,f,!0),r.slice(0,u)}function JN(e,t){var r=new Uint8Array(32),s=EC(r),u=12,f=0;switch(r[0]=3,e.t){case"n":r[2]=2,s.setFloat64(u,e.v,!0),f|=32,u+=8;break;case"b":r[2]=6,s.setFloat64(u,e.v?1:0,!0),f|=32,u+=8;break;case"s":if(t.indexOf(e.v)==-1)throw new Error("Value ".concat(e.v," missing from SST!"));r[2]=3,s.setUint32(u,t.indexOf(e.v),!0),f|=16,u+=4;break;default:throw"unsupported cell type "+e.t}return s.setUint32(4,f,!0),r.slice(0,u)}function Tp(e){var t=Mo(e);return Cb(t[1][0].data)}function mbe(e,t,r){var s,u,f,m;if(!((s=e[6])!=null&&s[0])||!((u=e[7])!=null&&u[0]))throw"Mutation only works on post-BNC storages!";var i=((m=(f=e[8])==null?void 0:f[0])==null?void 0:m.data)&&tv(e[8][0].data)>0||!1;if(i)throw"Math only works with normal offsets";for(var S=0,E=EC(e[7][0].data),I=0,D=[],M=EC(e[4][0].data),R=0,H=[],F=0;F<t.length;++F){if(t[F]==null){E.setUint16(F*2,65535,!0),M.setUint16(F*2,65535);continue}E.setUint16(F*2,I,!0),M.setUint16(F*2,R,!0);var U,Y;switch(typeof t[F]){case"string":U=KN({t:"s",v:t[F]},r),Y=JN({t:"s",v:t[F]},r);break;case"number":U=KN({t:"n",v:t[F]},r),Y=JN({t:"n",v:t[F]},r);break;case"boolean":U=KN({t:"b",v:t[F]},r),Y=JN({t:"b",v:t[F]},r);break;default:throw new Error("Unsupported value "+t[F])}D.push(U),I+=U.length,H.push(Y),R+=Y.length,++S}for(e[2][0].data=ma(S);F<e[7][0].data.length/2;++F)E.setUint16(F*2,65535,!0),M.setUint16(F*2,65535,!0);return e[6][0].data=_m(D),e[3][0].data=_m(H),S}function gbe(e,t){if(!t||!t.numbers)throw new Error("Must pass a `numbers` option -- check the README");var r=e.Sheets[e.SheetNames[0]];e.SheetNames.length>1&&console.error("The Numbers writer currently writes only the first table");var s=eu(r["!ref"]);s.s.r=s.s.c=0;var u=!1;s.e.c>9&&(u=!0,s.e.c=9),s.e.r>49&&(u=!0,s.e.r=49),u&&console.error("The Numbers writer is currently limited to ".concat(Io(s)));var f=CC(r,{range:s,header:1}),m=["~Sh33tJ5~"];f.forEach(function(he){return he.forEach(function(Se){typeof Se=="string"&&m.push(Se)})});var i={},S=[],E=Ta.read(t.numbers,{type:"base64"});E.FileIndex.map(function(he,Se){return[he,E.FullPaths[Se]]}).forEach(function(he){var Se=he[0],Ue=he[1];if(Se.type==2&&Se.name.match(/\.iwa/)){var nt=Se.content,dt=rd(nt),Vt=td(dt);Vt.forEach(function(zt){S.push(zt.id),i[zt.id]={deps:[],location:Ue,type:tv(zt.messages[0].meta[1][0].data)}})}}),S.sort(function(he,Se){return he-Se});var I=S.filter(function(he){return he>1}).map(function(he){return[he,ma(he)]});E.FileIndex.map(function(he,Se){return[he,E.FullPaths[Se]]}).forEach(function(he){var Se=he[0];if(he[1],!!Se.name.match(/\.iwa/)){var Ue=td(rd(Se.content));Ue.forEach(function(nt){nt.messages.forEach(function(dt){I.forEach(function(Vt){nt.messages.some(function(zt){return tv(zt.meta[1][0].data)!=11006&&hbe(zt.data,Vt[1])})&&i[Vt[0]].deps.push(nt.id)})})})}});for(var D=Ta.find(E,i[1].location),M=td(rd(D.content)),R,H=0;H<M.length;++H){var F=M[H];F.id==1&&(R=F)}var U=Tp(Mo(R.messages[0].data)[1][0].data);for(D=Ta.find(E,i[U].location),M=td(rd(D.content)),H=0;H<M.length;++H)F=M[H],F.id==U&&(R=F);for(U=Tp(Mo(R.messages[0].data)[2][0].data),D=Ta.find(E,i[U].location),M=td(rd(D.content)),H=0;H<M.length;++H)F=M[H],F.id==U&&(R=F);for(U=Tp(Mo(R.messages[0].data)[2][0].data),D=Ta.find(E,i[U].location),M=td(rd(D.content)),H=0;H<M.length;++H)F=M[H],F.id==U&&(R=F);var Y=Mo(R.messages[0].data);{Y[6][0].data=ma(s.e.r+1),Y[7][0].data=ma(s.e.c+1);var z=Tp(Y[46][0].data),J=Ta.find(E,i[z].location),ne=td(rd(J.content));{for(var me=0;me<ne.length&&ne[me].id!=z;++me);if(ne[me].id!=z)throw"Bad ColumnRowUIDMapArchive";var le=Mo(ne[me].messages[0].data);le[1]=[],le[2]=[],le[3]=[];for(var ye=0;ye<=s.e.c;++ye){var pe=[];pe[1]=pe[2]=[{type:0,data:ma(ye+420690)}],le[1].push({type:2,data:il(pe)}),le[2].push({type:0,data:ma(ye)}),le[3].push({type:0,data:ma(ye)})}le[4]=[],le[5]=[],le[6]=[];for(var be=0;be<=s.e.r;++be)pe=[],pe[1]=pe[2]=[{type:0,data:ma(be+726270)}],le[4].push({type:2,data:il(pe)}),le[5].push({type:0,data:ma(be)}),le[6].push({type:0,data:ma(be)});ne[me].messages[0].data=il(le)}J.content=wx(yx(ne)),J.size=J.content.length,delete Y[46];var ke=Mo(Y[4][0].data);{ke[7][0].data=ma(s.e.r+1);var Oe=Mo(ke[1][0].data),Ee=Tp(Oe[2][0].data);J=Ta.find(E,i[Ee].location),ne=td(rd(J.content));{if(ne[0].id!=Ee)throw"Bad HeaderStorageBucket";var qe=Mo(ne[0].messages[0].data);for(be=0;be<f.length;++be){var Qe=Mo(qe[2][0].data);Qe[1][0].data=ma(be),Qe[4][0].data=ma(f[be].length),qe[2][be]={type:qe[2][0].type,data:il(Qe)}}ne[0].messages[0].data=il(qe)}J.content=wx(yx(ne)),J.size=J.content.length;var gt=Tp(ke[2][0].data);J=Ta.find(E,i[gt].location),ne=td(rd(J.content));{if(ne[0].id!=gt)throw"Bad HeaderStorageBucket";for(qe=Mo(ne[0].messages[0].data),ye=0;ye<=s.e.c;++ye)Qe=Mo(qe[2][0].data),Qe[1][0].data=ma(ye),Qe[4][0].data=ma(s.e.r+1),qe[2][ye]={type:qe[2][0].type,data:il(Qe)};ne[0].messages[0].data=il(qe)}J.content=wx(yx(ne)),J.size=J.content.length;var Xe=Tp(ke[4][0].data);(function(){for(var he=Ta.find(E,i[Xe].location),Se=td(rd(he.content)),Ue,nt=0;nt<Se.length;++nt){var dt=Se[nt];dt.id==Xe&&(Ue=dt)}var Vt=Mo(Ue.messages[0].data);{Vt[3]=[];var zt=[];m.forEach(function(Wr,nn){zt[1]=[{type:0,data:ma(nn)}],zt[2]=[{type:0,data:ma(1)}],zt[3]=[{type:2,data:dbe(Wr)}],Vt[3].push({type:2,data:il(zt)})})}Ue.messages[0].data=il(Vt);var Gt=yx(Se),jr=wx(Gt);he.content=jr,he.size=he.content.length})();var ct=Mo(ke[3][0].data);{var Me=ct[1][0];delete ct[2];var mt=Mo(Me.data);{var Kt=Tp(mt[2][0].data);(function(){for(var he=Ta.find(E,i[Kt].location),Se=td(rd(he.content)),Ue,nt=0;nt<Se.length;++nt){var dt=Se[nt];dt.id==Kt&&(Ue=dt)}var Vt=Mo(Ue.messages[0].data);{delete Vt[6],delete ct[7];var zt=new Uint8Array(Vt[5][0].data);Vt[5]=[];for(var Gt=0,jr=0;jr<=s.e.r;++jr){var Wr=Mo(zt);Gt+=mbe(Wr,f[jr],m),Wr[1][0].data=ma(jr),Vt[5].push({data:il(Wr),type:2})}Vt[1]=[{type:0,data:ma(s.e.c+1)}],Vt[2]=[{type:0,data:ma(s.e.r+1)}],Vt[3]=[{type:0,data:ma(Gt)}],Vt[4]=[{type:0,data:ma(s.e.r+1)}]}Ue.messages[0].data=il(Vt);var nn=yx(Se),xn=wx(nn);he.content=xn,he.size=he.content.length})()}Me.data=il(mt)}ke[3][0].data=il(ct)}Y[4][0].data=il(ke)}R.messages[0].data=il(Y);var it=yx(M),ee=wx(it);return D.content=ee,D.size=D.content.length,E}function _be(e){return function(r){for(var s=0;s!=e.length;++s){var u=e[s];r[u[0]]===void 0&&(r[u[0]]=u[1]),u[2]==="n"&&(r[u[0]]=Number(r[u[0]]))}}}function MM(e){_be([["cellDates",!1],["bookSST",!1],["bookType","xlsx"],["compression",!1],["WTF",!1]])(e)}function xbe(e,t){return t.bookType=="ods"?dH(e,t):t.bookType=="numbers"?gbe(e,t):t.bookType=="xlsb"?vbe(e,t):ybe(e,t)}function vbe(e,t){zx=1024,e&&!e.SSF&&(e.SSF=Pc(po)),e&&e.SSF&&(TA(),SA(e.SSF),t.revssf=EA(e.SSF),t.revssf[e.SSF[65535]]=0,t.ssf=e.SSF),t.rels={},t.wbrels={},t.Strings=[],t.Strings.Count=0,t.Strings.Unique=0,$w?t.revStrings=new Map:(t.revStrings={},t.revStrings.foo=[],delete t.revStrings.foo);var r=t.bookType=="xlsb"?"bin":"xml",s=HW.indexOf(t.bookType)>-1,u=bW();MM(t=t||{});var f=vM(),m="",i=0;if(t.cellXfs=[],Nm(t.cellXfs,{},{revssf:{General:0}}),e.Props||(e.Props={}),m="docProps/core.xml",hs(f,m,CW(e.Props,t)),u.coreprops.push(m),_a(t.rels,2,m,Qs.CORE_PROPS),m="docProps/app.xml",!(e.Props&&e.Props.SheetNames))if(!e.Workbook||!e.Workbook.Sheets)e.Props.SheetNames=e.SheetNames;else{for(var S=[],E=0;E<e.SheetNames.length;++E)(e.Workbook.Sheets[E]||{}).Hidden!=2&&S.push(e.SheetNames[E]);e.Props.SheetNames=S}for(e.Props.Worksheets=e.Props.SheetNames.length,hs(f,m,jW(e.Props)),u.extprops.push(m),_a(t.rels,3,m,Qs.EXT_PROPS),e.Custprops!==e.Props&&pl(e.Custprops||{}).length>0&&(m="docProps/custom.xml",hs(f,m,IW(e.Custprops)),u.custprops.push(m),_a(t.rels,4,m,Qs.CUST_PROPS)),i=1;i<=e.SheetNames.length;++i){var I={"!id":{}},D=e.Sheets[e.SheetNames[i-1]],M=(D||{})["!type"]||"sheet";switch(M){case"chart":default:m="xl/worksheets/sheet"+i+"."+r,hs(f,m,bwe(i-1,m,t,e,I)),u.sheets.push(m),_a(t.wbrels,-1,"worksheets/sheet"+i+"."+r,Qs.WS[0])}if(D){var R=D["!comments"],H=!1,F="";R&&R.length>0&&(F="xl/comments"+i+"."+r,hs(f,F,Ewe(R,F)),u.comments.push(F),_a(I,-1,"../comments"+i+"."+r,Qs.CMNT),H=!0),D["!legacy"]&&H&&hs(f,"xl/drawings/vmlDrawing"+i+".vml",GW(i,D["!comments"])),delete D["!comments"],delete D["!legacy"]}I["!id"].rId1&&hs(f,TW(m),Qx(I))}return t.Strings!=null&&t.Strings.length>0&&(m="xl/sharedStrings."+r,hs(f,m,Twe(t.Strings,m,t)),u.strs.push(m),_a(t.wbrels,-1,"sharedStrings."+r,Qs.SST)),m="xl/workbook."+r,hs(f,m,wwe(e,m)),u.workbooks.push(m),_a(t.rels,1,m,Qs.WB),m="xl/theme/theme1.xml",hs(f,m,$W(e.Themes,t)),u.themes.push(m),_a(t.wbrels,-1,"theme/theme1.xml",Qs.THEME),m="xl/styles."+r,hs(f,m,Swe(e,m,t)),u.styles.push(m),_a(t.wbrels,-1,"styles."+r,Qs.STY),e.vbaraw&&s&&(m="xl/vbaProject.bin",hs(f,m,e.vbaraw),u.vba.push(m),_a(t.wbrels,-1,"vbaProject.bin",Qs.VBA)),m="xl/metadata."+r,hs(f,m,Cwe(m)),u.metadata.push(m),_a(t.wbrels,-1,"metadata."+r,Qs.XLMETA),hs(f,"[Content_Types].xml",SW(u,t)),hs(f,"_rels/.rels",Qx(t.rels)),hs(f,"xl/_rels/workbook."+r+".rels",Qx(t.wbrels)),delete t.revssf,delete t.ssf,f}function ybe(e,t){zx=1024,e&&!e.SSF&&(e.SSF=Pc(po)),e&&e.SSF&&(TA(),SA(e.SSF),t.revssf=EA(e.SSF),t.revssf[e.SSF[65535]]=0,t.ssf=e.SSF),t.rels={},t.wbrels={},t.Strings=[],t.Strings.Count=0,t.Strings.Unique=0,$w?t.revStrings=new Map:(t.revStrings={},t.revStrings.foo=[],delete t.revStrings.foo);var r="xml",s=HW.indexOf(t.bookType)>-1,u=bW();MM(t=t||{});var f=vM(),m="",i=0;if(t.cellXfs=[],Nm(t.cellXfs,{},{revssf:{General:0}}),e.Props||(e.Props={}),m="docProps/core.xml",hs(f,m,CW(e.Props,t)),u.coreprops.push(m),_a(t.rels,2,m,Qs.CORE_PROPS),m="docProps/app.xml",!(e.Props&&e.Props.SheetNames))if(!e.Workbook||!e.Workbook.Sheets)e.Props.SheetNames=e.SheetNames;else{for(var S=[],E=0;E<e.SheetNames.length;++E)(e.Workbook.Sheets[E]||{}).Hidden!=2&&S.push(e.SheetNames[E]);e.Props.SheetNames=S}e.Props.Worksheets=e.Props.SheetNames.length,hs(f,m,jW(e.Props)),u.extprops.push(m),_a(t.rels,3,m,Qs.EXT_PROPS),e.Custprops!==e.Props&&pl(e.Custprops||{}).length>0&&(m="docProps/custom.xml",hs(f,m,IW(e.Custprops)),u.custprops.push(m),_a(t.rels,4,m,Qs.CUST_PROPS));var I=["SheetJ5"];for(t.tcid=0,i=1;i<=e.SheetNames.length;++i){var D={"!id":{}},M=e.Sheets[e.SheetNames[i-1]],R=(M||{})["!type"]||"sheet";switch(R){case"chart":default:m="xl/worksheets/sheet"+i+"."+r,hs(f,m,rH(i-1,t,e,D)),u.sheets.push(m),_a(t.wbrels,-1,"worksheets/sheet"+i+"."+r,Qs.WS[0])}if(M){var H=M["!comments"],F=!1,U="";if(H&&H.length>0){var Y=!1;H.forEach(function(z){z[1].forEach(function(J){J.T==!0&&(Y=!0)})}),Y&&(U="xl/threadedComments/threadedComment"+i+"."+r,hs(f,U,Kxe(H,I,t)),u.threadedcomments.push(U),_a(D,-1,"../threadedComments/threadedComment"+i+"."+r,Qs.TCMNT)),U="xl/comments"+i+"."+r,hs(f,U,WW(H)),u.comments.push(U),_a(D,-1,"../comments"+i+"."+r,Qs.CMNT),F=!0}M["!legacy"]&&F&&hs(f,"xl/drawings/vmlDrawing"+i+".vml",GW(i,M["!comments"])),delete M["!comments"],delete M["!legacy"]}D["!id"].rId1&&hs(f,TW(m),Qx(D))}return t.Strings!=null&&t.Strings.length>0&&(m="xl/sharedStrings."+r,hs(f,m,FW(t.Strings,t)),u.strs.push(m),_a(t.wbrels,-1,"sharedStrings."+r,Qs.SST)),m="xl/workbook."+r,hs(f,m,sH(e)),u.workbooks.push(m),_a(t.rels,1,m,Qs.WB),m="xl/theme/theme1.xml",hs(f,m,$W(e.Themes,t)),u.themes.push(m),_a(t.wbrels,-1,"theme/theme1.xml",Qs.THEME),m="xl/styles."+r,hs(f,m,UW(e,t)),u.styles.push(m),_a(t.wbrels,-1,"styles."+r,Qs.STY),e.vbaraw&&s&&(m="xl/vbaProject.bin",hs(f,m,e.vbaraw),u.vba.push(m),_a(t.wbrels,-1,"vbaProject.bin",Qs.VBA)),m="xl/metadata."+r,hs(f,m,qW()),u.metadata.push(m),_a(t.wbrels,-1,"metadata."+r,Qs.XLMETA),I.length>1&&(m="xl/persons/person.xml",hs(f,m,Jxe(I)),u.people.push(m),_a(t.wbrels,-1,"persons/person.xml",Qs.PEOPLE)),hs(f,"[Content_Types].xml",SW(u,t)),hs(f,"_rels/.rels",Qx(t.rels)),hs(f,"xl/_rels/workbook."+r+".rels",Qx(t.wbrels)),delete t.revssf,delete t.ssf,f}function wbe(e,t){var r="";switch((t||{}).type||"base64"){case"buffer":return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]];case"base64":r=vf(e.slice(0,12));break;case"binary":r=e;break;case"array":return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]];default:throw new Error("Unrecognized type "+(t&&t.type||"undefined"))}return[r.charCodeAt(0),r.charCodeAt(1),r.charCodeAt(2),r.charCodeAt(3),r.charCodeAt(4),r.charCodeAt(5),r.charCodeAt(6),r.charCodeAt(7)]}function hH(e,t){switch(t.type){case"base64":case"binary":break;case"buffer":case"array":t.type="";break;case"file":return r2(t.file,Ta.write(e,{type:sa?"buffer":""}));case"string":throw new Error("'string' output type invalid for '"+t.bookType+"' files");default:throw new Error("Unrecognized type "+t.type)}return Ta.write(e,t)}function bbe(e,t){var r=Pc(t||{}),s=xbe(e,r);return Sbe(s,r)}function Sbe(e,t){var r={},s=sa?"nodebuffer":typeof Uint8Array<"u"?"array":"string";if(t.compression&&(r.compression="DEFLATE"),t.password)r.type=s;else switch(t.type){case"base64":r.type="base64";break;case"binary":r.type="string";break;case"string":throw new Error("'string' output type invalid for '"+t.bookType+"' files");case"buffer":case"file":r.type=s;break;default:throw new Error("Unrecognized type "+t.type)}var u=e.FullPaths?Ta.write(e,{fileType:"zip",type:{nodebuffer:"buffer",string:"binary"}[r.type]||r.type,compression:!!t.compression}):e.generate(r);if(typeof Deno<"u"&&typeof u=="string"){if(t.type=="binary"||t.type=="base64")return u;u=new Uint8Array(bA(u))}return t.password&&typeof encrypt_agile<"u"?hH(encrypt_agile(u,t.password),t):t.type==="file"?r2(t.file,u):t.type=="string"?zw(u):u}function Tbe(e,t){var r=t||{},s=Bwe(e,r);return hH(s,r)}function Jd(e,t,r){r||(r="");var s=r+e;switch(t.type){case"base64":return bb(Tb(s));case"binary":return Tb(s);case"string":return e;case"file":return r2(t.file,s,"utf8");case"buffer":return sa?Cf(s,"utf8"):typeof TextEncoder<"u"?new TextEncoder().encode(s):Jd(s,{type:"binary"}).split("").map(function(u){return u.charCodeAt(0)})}throw new Error("Unrecognized type "+t.type)}function Ebe(e,t){switch(t.type){case"base64":return bb(e);case"binary":return e;case"string":return e;case"file":return r2(t.file,e,"binary");case"buffer":return sa?Cf(e,"binary"):e.split("").map(function(r){return r.charCodeAt(0)})}throw new Error("Unrecognized type "+t.type)}function VT(e,t){switch(t.type){case"string":case"base64":case"binary":for(var r="",s=0;s<e.length;++s)r+=String.fromCharCode(e[s]);return t.type=="base64"?bb(r):t.type=="string"?zw(r):r;case"file":return r2(t.file,e);case"buffer":return e;default:throw new Error("Unrecognized type "+t.type)}}function fH(e,t){Qge(),uwe(e);var r=Pc(t||{});if(r.cellStyles&&(r.cellNF=!0,r.sheetStubs=!0),r.type=="array"){r.type="binary";var s=fH(e,r);return r.type="array",bA(s)}var u=0;if(r.sheet&&(typeof r.sheet=="number"?u=r.sheet:u=e.SheetNames.indexOf(r.sheet),!e.SheetNames[u]))throw new Error("Sheet not found: "+r.sheet+" : "+typeof r.sheet);switch(r.bookType||"xlsb"){case"xml":case"xlml":return Jd(Lwe(e,r),r);case"slk":case"sylk":return Jd(oxe.from_sheet(e.Sheets[e.SheetNames[u]],r),r);case"htm":case"html":return Jd(lH(e.Sheets[e.SheetNames[u]],r),r);case"txt":return Ebe(pH(e.Sheets[e.SheetNames[u]],r),r);case"csv":return Jd(OM(e.Sheets[e.SheetNames[u]],r),r,"\uFEFF");case"dif":return Jd(lxe.from_sheet(e.Sheets[e.SheetNames[u]],r),r);case"dbf":return VT(axe.from_sheet(e.Sheets[e.SheetNames[u]],r),r);case"prn":return Jd(cxe.from_sheet(e.Sheets[e.SheetNames[u]],r),r);case"rtf":return Jd(gxe.from_sheet(e.Sheets[e.SheetNames[u]],r),r);case"eth":return Jd(OW.from_sheet(e.Sheets[e.SheetNames[u]],r),r);case"fods":return Jd(dH(e,r),r);case"wk1":return VT(M5.sheet_to_wk1(e.Sheets[e.SheetNames[u]],r),r);case"wk3":return VT(M5.book_to_wk3(e,r),r);case"biff2":r.biff||(r.biff=2);case"biff3":r.biff||(r.biff=3);case"biff4":return r.biff||(r.biff=4),VT(oH(e,r),r);case"biff5":r.biff||(r.biff=5);case"biff8":case"xla":case"xls":return r.biff||(r.biff=8),Tbe(e,r);case"xlsx":case"xlsm":case"xlam":case"xlsb":case"numbers":case"ods":return bbe(e,r);default:throw new Error("Unrecognized bookType |"+r.bookType+"|")}}function Cbe(e){if(!e.bookType){var t={xls:"biff8",htm:"html",slk:"sylk",socialcalc:"eth",Sh33tJS:"WTF"},r=e.file.slice(e.file.lastIndexOf(".")).toLowerCase();r.match(/^\.[a-z]+$/)&&(e.bookType=r.slice(1)),e.bookType=t[e.bookType]||e.bookType}}function rv(e,t,r){var s={};return s.type="file",s.file=t,Cbe(s),fH(e,s)}function Abe(e,t,r,s,u,f,m,i){var S=dl(r),E=i.defval,I=i.raw||!Object.prototype.hasOwnProperty.call(i,"raw"),D=!0,M=u===1?[]:{};if(u!==1)if(Object.defineProperty)try{Object.defineProperty(M,"__rowNum__",{value:r,enumerable:!1})}catch{M.__rowNum__=r}else M.__rowNum__=r;if(!m||e[r])for(var R=t.s.c;R<=t.e.c;++R){var H=m?e[r][R]:e[s[R]+S];if(H===void 0||H.t===void 0){if(E===void 0)continue;f[R]!=null&&(M[f[R]]=E);continue}var F=H.v;switch(H.t){case"z":if(F==null)break;continue;case"e":F=F==0?null:void 0;break;case"s":case"d":case"b":case"n":break;default:throw new Error("unrecognized type "+H.t)}if(f[R]!=null){if(F==null)if(H.t=="e"&&F===null)M[f[R]]=null;else if(E!==void 0)M[f[R]]=E;else if(I&&F===null)M[f[R]]=null;else continue;else M[f[R]]=I&&(H.t!=="n"||H.t==="n"&&i.rawNumbers!==!1)?F:yf(H,F,i);F!=null&&(D=!1)}}return{row:M,isempty:D}}function CC(e,t){if(e==null||e["!ref"]==null)return[];var r={t:"n",v:0},s=0,u=1,f=[],m=0,i="",S={s:{r:0,c:0},e:{r:0,c:0}},E=t||{},I=E.range!=null?E.range:e["!ref"];switch(E.header===1?s=1:E.header==="A"?s=2:Array.isArray(E.header)?s=3:E.header==null&&(s=0),typeof I){case"string":S=Ba(I);break;case"number":S=Ba(e["!ref"]),S.s.r=I;break;default:S=I}s>0&&(u=0);var D=dl(S.s.r),M=[],R=[],H=0,F=0,U=Array.isArray(e),Y=S.s.r,z=0,J={};U&&!e[Y]&&(e[Y]=[]);var ne=E.skipHidden&&e["!cols"]||[],me=E.skipHidden&&e["!rows"]||[];for(z=S.s.c;z<=S.e.c;++z)if(!(ne[z]||{}).hidden)switch(M[z]=El(z),r=U?e[Y][z]:e[M[z]+D],s){case 1:f[z]=z-S.s.c;break;case 2:f[z]=M[z];break;case 3:f[z]=E.header[z-S.s.c];break;default:if(r==null&&(r={w:"__EMPTY",t:"s"}),i=m=yf(r,null,E),F=J[m]||0,!F)J[m]=1;else{do i=m+"_"+F++;while(J[i]);J[m]=F,J[i]=1}f[z]=i}for(Y=S.s.r+u;Y<=S.e.r;++Y)if(!(me[Y]||{}).hidden){var le=Abe(e,S,Y,M,s,f,U,E);(le.isempty===!1||(s===1?E.blankrows!==!1:E.blankrows))&&(R[H++]=le.row)}return R.length=H,R}var $5=/"/g;function jbe(e,t,r,s,u,f,m,i){for(var S=!0,E=[],I="",D=dl(r),M=t.s.c;M<=t.e.c;++M)if(s[M]){var R=i.dense?(e[r]||[])[M]:e[s[M]+D];if(R==null)I="";else if(R.v!=null){S=!1,I=""+(i.rawNumbers&&R.t=="n"?R.v:yf(R,null,i));for(var H=0,F=0;H!==I.length;++H)if((F=I.charCodeAt(H))===u||F===f||F===34||i.forceQuotes){I='"'+I.replace($5,'""')+'"';break}I=="ID"&&(I='"ID"')}else R.f!=null&&!R.F?(S=!1,I="="+R.f,I.indexOf(",")>=0&&(I='"'+I.replace($5,'""')+'"')):I="";E.push(I)}return i.blankrows===!1&&S?null:E.join(m)}function OM(e,t){var r=[],s=t??{};if(e==null||e["!ref"]==null)return"";var u=Ba(e["!ref"]),f=s.FS!==void 0?s.FS:",",m=f.charCodeAt(0),i=s.RS!==void 0?s.RS:`
`,S=i.charCodeAt(0),E=new RegExp((f=="|"?"\\|":f)+"+$"),I="",D=[];s.dense=Array.isArray(e);for(var M=s.skipHidden&&e["!cols"]||[],R=s.skipHidden&&e["!rows"]||[],H=u.s.c;H<=u.e.c;++H)(M[H]||{}).hidden||(D[H]=El(H));for(var F=0,U=u.s.r;U<=u.e.r;++U)(R[U]||{}).hidden||(I=jbe(e,u,U,D,m,S,f,s),I!=null&&(s.strip&&(I=I.replace(E,"")),(I||s.blankrows!==!1)&&r.push((F++?i:"")+I)));return delete s.dense,r.join("")}function pH(e,t){t||(t={}),t.FS="	",t.RS=`
`;var r=OM(e,t);return r}function Ibe(e){var t="",r,s="";if(e==null||e["!ref"]==null)return[];var u=Ba(e["!ref"]),f="",m=[],i,S=[],E=Array.isArray(e);for(i=u.s.c;i<=u.e.c;++i)m[i]=El(i);for(var I=u.s.r;I<=u.e.r;++I)for(f=dl(I),i=u.s.c;i<=u.e.c;++i)if(t=m[i]+f,r=E?(e[I]||[])[i]:e[t],s="",r!==void 0){if(r.F!=null){if(t=r.F,!r.f)continue;s=r.f,t.indexOf(":")==-1&&(t=t+":"+t)}if(r.f!=null)s=r.f;else{if(r.t=="z")continue;if(r.t=="n"&&r.v!=null)s=""+r.v;else if(r.t=="b")s=r.v?"TRUE":"FALSE";else if(r.w!==void 0)s="'"+r.w;else{if(r.v===void 0)continue;r.t=="s"?s="'"+r.v:s=""+r.v}}S[S.length]=t+"="+s}return S}function mH(e,t,r){var s=r||{},u=+!s.skipHeader,f=e||{},m=0,i=0;if(f&&s.origin!=null)if(typeof s.origin=="number")m=s.origin;else{var S=typeof s.origin=="string"?Zo(s.origin):s.origin;m=S.r,i=S.c}var E,I={s:{c:0,r:0},e:{c:i,r:m+t.length-1+u}};if(f["!ref"]){var D=Ba(f["!ref"]);I.e.c=Math.max(I.e.c,D.e.c),I.e.r=Math.max(I.e.r,D.e.r),m==-1&&(m=D.e.r+1,I.e.r=m+t.length-1+u)}else m==-1&&(m=0,I.e.r=t.length-1+u);var M=s.header||[],R=0;t.forEach(function(F,U){pl(F).forEach(function(Y){(R=M.indexOf(Y))==-1&&(M[R=M.length]=Y);var z=F[Y],J="z",ne="",me=ya({c:i+R,r:m+U+u});E=Ab(f,me),z&&typeof z=="object"&&!(z instanceof Date)?f[me]=z:(typeof z=="number"?J="n":typeof z=="boolean"?J="b":typeof z=="string"?J="s":z instanceof Date?(J="d",s.cellDates||(J="n",z=kc(z)),ne=s.dateNF||po[14]):z===null&&s.nullError&&(J="e",z=0),E?(E.t=J,E.v=z,delete E.w,delete E.R,ne&&(E.z=ne)):f[me]=E={t:J,v:z},ne&&(E.z=ne))})}),I.e.c=Math.max(I.e.c,i+M.length-1);var H=dl(m);if(u)for(R=0;R<M.length;++R)f[El(R+i)+H]={t:"s",v:M[R]};return f["!ref"]=Io(I),f}function Nbe(e,t){return mH(null,e,t)}function Ab(e,t,r){if(typeof t=="string"){if(Array.isArray(e)){var s=Zo(t);return e[s.r]||(e[s.r]=[]),e[s.r][s.c]||(e[s.r][s.c]={t:"z"})}return e[t]||(e[t]={t:"z"})}return typeof t!="number"?Ab(e,ya(t)):Ab(e,ya({r:t,c:r||0}))}function kbe(e,t){if(typeof t=="number"){if(t>=0&&e.SheetNames.length>t)return t;throw new Error("Cannot find sheet # "+t)}else if(typeof t=="string"){var r=e.SheetNames.indexOf(t);if(r>-1)return r;throw new Error("Cannot find sheet name |"+t+"|")}else throw new Error("Cannot find sheet |"+t+"|")}function Pbe(){return{SheetNames:[],Sheets:{}}}function Dbe(e,t,r,s){var u=1;if(!r)for(;u<=65535&&e.SheetNames.indexOf(r="Sheet"+u)!=-1;++u,r=void 0);if(!r||e.SheetNames.length>=65535)throw new Error("Too many worksheets");if(s&&e.SheetNames.indexOf(r)>=0){var f=r.match(/(^.*?)(\d+)$/);u=f&&+f[2]||0;var m=f&&f[1]||r;for(++u;u<=65535&&e.SheetNames.indexOf(r=m+u)!=-1;++u);}if(iH(r),e.SheetNames.indexOf(r)>=0)throw new Error("Worksheet with name |"+r+"| already exists!");return e.SheetNames.push(r),e.Sheets[r]=t,r}function Rbe(e,t,r){e.Workbook||(e.Workbook={}),e.Workbook.Sheets||(e.Workbook.Sheets=[]);var s=kbe(e,t);switch(e.Workbook.Sheets[s]||(e.Workbook.Sheets[s]={}),r){case 0:case 1:case 2:break;default:throw new Error("Bad sheet visibility setting "+r)}e.Workbook.Sheets[s].Hidden=r}function Mbe(e,t){return e.z=t,e}function gH(e,t,r){return t?(e.l={Target:t},r&&(e.l.Tooltip=r)):delete e.l,e}function Obe(e,t,r){return gH(e,"#"+t,r)}function Fbe(e,t,r){e.c||(e.c=[]),e.c.push({t,a:r||"SheetJS"})}function Lbe(e,t,r,s){for(var u=typeof t!="string"?t:Ba(t),f=typeof t=="string"?t:Io(t),m=u.s.r;m<=u.e.r;++m)for(var i=u.s.c;i<=u.e.c;++i){var S=Ab(e,m,i);S.t="n",S.F=f,delete S.v,m==u.s.r&&i==u.s.c&&(S.f=r,s&&(S.D=!0))}return e}var Go={encode_col:El,encode_row:dl,encode_cell:ya,encode_range:Io,decode_col:EM,decode_row:TM,split_cell:Q_e,decode_cell:Zo,decode_range:eu,format_cell:yf,sheet_add_aoa:gW,sheet_add_json:mH,sheet_add_dom:cH,aoa_to_sheet:Xv,json_to_sheet:Nbe,table_to_sheet:uH,table_to_book:lbe,sheet_to_csv:OM,sheet_to_txt:pH,sheet_to_json:CC,sheet_to_html:lH,sheet_to_formulae:Ibe,sheet_to_row_object_array:CC,sheet_get_cell:Ab,book_new:Pbe,book_append_sheet:Dbe,book_set_sheet_visibility:Rbe,cell_set_number_format:Mbe,cell_set_hyperlink:gH,cell_set_internal_link:Obe,cell_add_comment:Fbe,sheet_set_array_formula:Lbe,consts:{SHEET_VISIBLE:0,SHEET_HIDDEN:1,SHEET_VERY_HIDDEN:2}};const In=e=>e?e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim():"",Vr={aguardando:"Aguardando confirmacao",confirmada:"Confirmada",aprovada:"Aprovada",lancada:"Lanada para pagamento",aprovadaPagamento:"Aprovada para pagamento",paga:"Paga",reprovada:"Reprovada",cancelada:"Cancelada"},qo={[Vr.aguardando]:"Aguardando confirmacao",[Vr.confirmada]:"Confirmada",[Vr.aprovada]:"Aprovada",[Vr.lancada]:"Lanada para pagamento",[Vr.aprovadaPagamento]:"Aprovada para pagamento",[Vr.paga]:"Paga",[Vr.reprovada]:"Reprovada",[Vr.cancelada]:"Cancelada"},_H={[Vr.aguardando]:"secondary",[Vr.confirmada]:"default",[Vr.aprovada]:"default",[Vr.lancada]:"default",[Vr.aprovadaPagamento]:"default",[Vr.paga]:"secondary",[Vr.reprovada]:"destructive",[Vr.cancelada]:"destructive"},xH={[In(Vr.aguardando)]:{label:"Confirmar diaria",nextStatus:Vr.confirmada,icon:"confirm"},[In(Vr.confirmada)]:{label:"Aprovar diaria",nextStatus:Vr.aprovada,icon:"advance"},[In(Vr.aprovada)]:{label:"Lanar para pagamento",nextStatus:Vr.lancada,icon:"advance"},[In(Vr.lancada)]:{label:"Aprovar para pagamento",nextStatus:Vr.aprovadaPagamento,icon:"advance"},[In(Vr.aprovadaPagamento)]:{label:"Paga",nextStatus:Vr.paga,icon:"advance"}},wc=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}),o_=e=>{if(!e)return"-";try{return Ii(rf(e),"dd/MM/yyyy",{locale:ia})}catch{return e}},AC=e=>{if(!e)return"-";try{return Ii(new Date(e),"dd/MM/yyyy HH:mm",{locale:ia})}catch{return e}},vH=e=>{if(!e)return null;try{return Ii(rf(e),"yyyy-MM")}catch{return null}},NA=Ii(new Date,"yyyy-MM"),yH=e=>{const[t,r]=e.split("-").map(Number),s=new Date(t,r-1,1);return{start:Ii(s,"yyyy-MM-dd"),end:Ii(_A(s),"yyyy-MM-dd")}},zbe=()=>{const e=new Date().toLocaleString("en-US",{timeZone:"America/Sao_Paulo"}),t=new Date(e);return Ii(t,"yyyy-MM-dd")};function wH(e){const t=zbe(),r=V.useMemo(()=>yH(e),[e]),{data:s=[],refetch:u}=aa({queryKey:["posto-dias-vagos",r.start,r.end],queryFn:async()=>{const{data:Y,error:z}=await tt.from("posto_dias_vagos").select(`
          id,
          data,
          motivo,
          posto_servico_id,
          posto:postos_servico (
            id,
            nome,
            valor_diaria,
            unidade:unidades (
              id,
              nome,
              contrato_id,
              contrato:contratos (
                id,
                negocio,
                cliente_id,
                clientes (
                  id,
                  razao_social,
                  nome_fantasia
                )
              )
            )
          )
        `).gte("data",r.start).lte("data",r.end).order("data",{ascending:!0});if(z)throw z;return Y}}),{data:f=[]}=aa({queryKey:["diaristas-ativos"],queryFn:async()=>{const{data:Y,error:z}=await tt.from("diaristas").select("*").order("nome_completo");if(z)throw z;return Y?Y.map(J=>({id:J.id,nome_completo:J.nome_completo,cpf:J.cpf??null,cargo:J.cargo??null,status:J.status??null,banco:J.banco??null,agencia:J.agencia??null,numero_conta:J.numero_conta??null,tipo_conta:J.tipo_conta??null,pix:J.pix??null})):[]}}),{data:m=[],isLoading:i,refetch:S}=aa({queryKey:["diarias"],queryFn:async()=>{const{data:Y,error:z}=await tt.from("diarias").select(`
          *,
          posto_dia_vago:posto_dia_vago_id (
            id,
            data,
            motivo,
            posto:postos_servico (
              id,
              nome,
              valor_diaria,
              unidade:unidades (
                id,
                nome
              )
            )
          )
        `).order("created_at",{ascending:!1});if(z)throw z;return Y}}),{data:E=[]}=aa({queryKey:["postos-ocupados"],queryFn:async()=>{const{data:Y,error:z}=await tt.from("colaboradores").select("id, nome_completo, posto_servico_id").not("posto_servico_id","is",null).eq("status_colaborador","ativo");if(z)throw z;return Y}}),I=V.useMemo(()=>{const Y=new Map;return s.forEach(z=>Y.set(z.id,z)),Y},[s]),D=V.useMemo(()=>{const Y=new Map;return f.forEach(z=>Y.set(z.id,z)),Y},[f]),M=V.useMemo(()=>{const Y=new Map;return E.forEach(z=>{z.posto_servico_id&&Y.set(z.posto_servico_id,{id:z.id,nome_completo:z.nome_completo})}),Y},[E]),R=V.useMemo(()=>new Set(m.map(Y=>Y.posto_dia_vago_id)),[m]),H=V.useMemo(()=>({start:rf(r.start),end:rf(r.end)}),[r]),F=V.useMemo(()=>m.filter(Y=>{const z=I.get(Y.posto_dia_vago_id)??Y.posto_dia_vago??void 0,J=z==null?void 0:z.data;return J?YP(rf(J),H):!0}),[m,H,I]),U=V.useMemo(()=>s.filter(Y=>R.has(Y.id)||Y.data<t?!1:YP(rf(Y.data),H)),[s,R,H,t]);return{postoDiasVagos:s,diaristas:f,diarias:m,filteredDiarias:F,postoDiaVagoMap:I,diaristaMap:D,postoOcupanteMap:M,availableDiasVagos:U,usedDiaVagoIds:R,refetchDiarias:S,refetchDiasVagos:u,loadingDiarias:i}}const km=[{statusKey:Vr.aguardando,title:"Dirias aguardando confirmao",description:"Confirme as dirias recm cadastradas antes de liberar para aprovao.",emptyMessage:"Nenhuma diria aguardando confirmao."},{statusKey:Vr.confirmada,title:"Dirias confirmadas",description:"Dirias prontas para aprovao financeira."},{statusKey:Vr.aprovada,title:"Dirias aprovadas",description:"Avance as dirias aprovadas para lanamento."},{statusKey:Vr.lancada,title:"Dirias lanadas para pagamento",description:"Dirias lanadas aguardando aprovao de pagamento."},{statusKey:Vr.aprovadaPagamento,title:"Dirias aprovadas para pagamento",description:"Acompanhe as dirias aprovadas que esto em fase final de pagamento."},{statusKey:Vr.reprovada,title:"Dirias reprovadas",description:"Histrico de dirias reprovadas com seus respectivos motivos.",emptyMessage:"Nenhuma diria reprovada."},{statusKey:Vr.cancelada,title:"Dirias canceladas",description:"Histrico de dirias canceladas.",emptyMessage:"Nenhuma diria cancelada."},{statusKey:Vr.paga,title:"Dirias pagas",description:"Dirias j pagas. Apenas alterao de status disponvel.",emptyMessage:"Nenhuma diria paga."}],Pm=({statusKey:e,title:t,description:r,emptyMessage:s})=>function(){var ha;const[f,m]=V.useState(NA),{filteredDiarias:i,postoDiaVagoMap:S,diaristaMap:E,loadingDiarias:I,refetchDiarias:D,diarias:M,postoOcupanteMap:R}=wH(f),[H,F]=V.useState(null),[U,Y]=V.useState({}),[z,J]=V.useState(!1),[ne,me]=V.useState(null),[le,ye]=V.useState({open:!1,diariaId:null,targetStatus:null}),[pe,be]=V.useState(""),[ke,Oe]=V.useState(null),[Ee,qe]=V.useState({diaristaId:"",motivo:"",clienteId:"",startDate:"",endDate:""}),[Qe,gt]=V.useState({diaristaId:"",startDate:"",endDate:""}),[Xe,ct]=V.useState({diaristaId:"",clienteId:"",startDate:"",endDate:""}),[Me,mt]=V.useState({clienteId:"",startDate:"",endDate:""}),[Kt,it]=V.useState(!1),ee="__all__",he=V.useMemo(()=>Object.values(Vr).filter(pt=>pt!==Vr.reprovada),[]),Se=In(e),Ue=In(Vr.cancelada),nt=In(Vr.reprovada),dt=Se===Ue,Vt=V.useMemo(()=>i.filter(pt=>In(pt.status)===Se),[i,Se]),zt=V.useMemo(()=>M.filter(pt=>In(pt.status)===Se),[M,Se]),Gt=pt=>{var Er,Jr,Ae;const lt=(Jr=(Er=pt==null?void 0:pt.posto)==null?void 0:Er.unidade)==null?void 0:Jr.contrato;return lt!=null&&lt.id||lt!=null&&lt.negocio?{id:lt.id,negocio:lt.negocio??null,clienteId:lt.cliente_id??null,clienteNome:((Ae=lt.clientes)==null?void 0:Ae.razao_social)??null}:null},jr=pt=>{const lt=Gt(pt);return lt!=null&&lt.clienteId&&lt.clienteNome?{id:lt.clienteId,nome:lt.clienteNome}:null},Wr=V.useMemo(()=>{const pt=new Map;return Vt.forEach(lt=>{const Er=E.get(lt.diarista_id)??lt.diarista??null;lt.diarista_id&&(Er!=null&&Er.nome_completo)&&pt.set(lt.diarista_id,Er.nome_completo)}),Array.from(pt.entries()).map(([lt,Er])=>({id:lt,nome:Er})).sort((lt,Er)=>lt.nome.localeCompare(Er.nome))},[Vt,E]),nn=V.useMemo(()=>{const pt=new Set;return Vt.forEach(lt=>{const Er=S.get(lt.posto_dia_vago_id)??lt.posto_dia_vago??null;Er!=null&&Er.motivo&&pt.add(Er.motivo)}),Array.from(pt).sort((lt,Er)=>lt.localeCompare(Er))},[Vt,S]),xn=V.useMemo(()=>{const pt=new Map;return Vt.forEach(lt=>{const Er=S.get(lt.posto_dia_vago_id)??lt.posto_dia_vago??null,Jr=jr(Er);Jr!=null&&Jr.id&&Jr.nome&&pt.set(Jr.id,Jr.nome)}),Array.from(pt.entries()).map(([lt,Er])=>({id:lt,nome:Er})).sort((lt,Er)=>lt.nome.localeCompare(Er.nome))},[Vt,S]),ei=V.useMemo(()=>Ee.startDate||Ee.endDate?zt:Vt,[Vt,zt,Ee.endDate,Ee.startDate]),Dn=V.useMemo(()=>ei.filter(pt=>{const lt=S.get(pt.posto_dia_vago_id)??pt.posto_dia_vago??null,Er=pt.diarista_id||"",Jr=(lt==null?void 0:lt.motivo)??"",Ae=jr(lt),ue=(lt==null?void 0:lt.data)??"";if(Ee.startDate){const Z=new Date(ue),K=new Date(Ee.startDate);if(Number.isNaN(Z.getTime())||Z<K)return!1}if(Ee.endDate){const Z=new Date(ue),K=new Date(Ee.endDate);if(K.setHours(23,59,59,999),Number.isNaN(Z.getTime())||Z>K)return!1}return!(Ee.diaristaId&&Ee.diaristaId!==Er||Ee.motivo&&Ee.motivo!==Jr||Ee.clienteId&&Ee.clienteId!==((Ae==null?void 0:Ae.id)||""))}),[ei,Ee,S]),Zr=pt=>{var K;const lt=S.get(pt.posto_dia_vago_id)??pt.posto_dia_vago??null,Er=lt==null?void 0:lt.posto,Jr=lt!=null&&lt.posto_servico_id?R.get(lt.posto_servico_id):null,Ae=E.get(pt.diarista_id)??pt.diarista??null,ue=jr(lt),Z=Gt(lt);return{Data:o_(lt==null?void 0:lt.data),Status:qo[pt.status]||pt.status,Posto:(Er==null?void 0:Er.nome)||"-",Unidade:((K=Er==null?void 0:Er.unidade)==null?void 0:K.nome)||"-","Motivo (dia vago)":(lt==null?void 0:lt.motivo)||"-","Ocupante do posto":(Jr==null?void 0:Jr.nome_completo)||"-","Valor (R$)":pt.valor||0,"Atualizado em":AC(pt.updated_at),"Motivo reprovao":pt.motivo_reprovacao||"","Motivo cancelamento":pt.motivo_cancelamento||"",Diarista:(Ae==null?void 0:Ae.nome_completo)||"-","Status diarista":(Ae==null?void 0:Ae.status)||"-","CPF diarista":(Ae==null?void 0:Ae.cpf)||"-",Banco:(Ae==null?void 0:Ae.banco)||"-",Agncia:(Ae==null?void 0:Ae.agencia)||"-","Nmero da conta":(Ae==null?void 0:Ae.numero_conta)||"-","Tipo de conta":(Ae==null?void 0:Ae.tipo_conta)||"-",Pix:(Ae==null?void 0:Ae.pix)||"-",Cliente:(ue==null?void 0:ue.nome)||"-",Contrato:(Z==null?void 0:Z.negocio)||"-"}},Nn=()=>{if(Dn.length===0){$t.info("Nenhuma diria para exportar.");return}const pt=Dn.map(Zr),lt=Go.json_to_sheet(pt),Er=Go.book_new();Go.book_append_sheet(Er,lt,"Diarias");const Jr=`diarias-${In(e)}-${Date.now()}.xlsx`;rv(Er,Jr),$t.success("Arquivo XLSX gerado.")},Pi=V.useMemo(()=>{const pt=new Map;return zt.forEach(lt=>{if(Xe.diaristaId&&lt.diarista_id!==Xe.diaristaId)return;const Er=S.get(lt.posto_dia_vago_id)??lt.posto_dia_vago??null,Jr=jr(Er);Jr!=null&&Jr.id&&Jr.nome&&pt.set(Jr.id,Jr.nome)}),Array.from(pt.entries()).map(([lt,Er])=>({id:lt,nome:Er})).sort((lt,Er)=>lt.nome.localeCompare(Er.nome))},[zt,S,Xe.diaristaId]);V.useEffect(()=>{ct(pt=>({...pt,clienteId:Pi.some(lt=>lt.id===pt.clienteId)?pt.clienteId:""}))},[Pi]);const ft=V.useMemo(()=>Object.values(Ee).some(Boolean),[Ee]),Rt=V.useMemo(()=>{if(!Qe.diaristaId||!Qe.startDate||!Qe.endDate)return null;const pt=new Date(Qe.startDate),lt=new Date(Qe.endDate);return Number.isNaN(pt.getTime())||Number.isNaN(lt.getTime())?null:(lt.setHours(23,59,59,999),pt>lt?0:zt.reduce((Er,Jr)=>{if((Jr.diarista_id||"")!==Qe.diaristaId)return Er;const ue=S.get(Jr.posto_dia_vago_id)??Jr.posto_dia_vago??null,Z=ue==null?void 0:ue.data;if(!Z)return Er;const K=new Date(Z);if(Number.isNaN(K.getTime())||K<pt||K>lt)return Er;const ie=typeof Jr.valor=="number"?Jr.valor:Number(Jr.valor)||0;return Er+ie},0))},[zt,S,Qe]),Wt=V.useMemo(()=>{if(!Xe.diaristaId||!Xe.clienteId||!Xe.startDate||!Xe.endDate)return null;const pt=new Date(Xe.startDate),lt=new Date(Xe.endDate);return Number.isNaN(pt.getTime())||Number.isNaN(lt.getTime())?null:(lt.setHours(23,59,59,999),pt>lt?0:zt.reduce((Er,Jr)=>{if((Jr.diarista_id||"")!==Xe.diaristaId)return Er;const ue=S.get(Jr.posto_dia_vago_id)??Jr.posto_dia_vago??null,Z=ue==null?void 0:ue.data;if(!Z)return Er;const K=new Date(Z);if(Number.isNaN(K.getTime())||K<pt||K>lt)return Er;const ie=jr(ue);if(!ie||ie.id!==Xe.clienteId)return Er;const ce=typeof Jr.valor=="number"?Jr.valor:Number(Jr.valor)||0;return Er+ce},0))},[zt,S,Xe]),Pr=V.useMemo(()=>{if(!Me.clienteId||!Me.startDate||!Me.endDate)return null;const pt=new Date(Me.startDate),lt=new Date(Me.endDate);return Number.isNaN(pt.getTime())||Number.isNaN(lt.getTime())?null:(lt.setHours(23,59,59,999),pt>lt?0:zt.reduce((Er,Jr)=>{const Ae=S.get(Jr.posto_dia_vago_id)??Jr.posto_dia_vago??null,ue=jr(Ae);if(!ue||ue.id!==Me.clienteId)return Er;const Z=Ae==null?void 0:Ae.data;if(!Z)return Er;const K=new Date(Z);if(Number.isNaN(K.getTime())||K<pt||K>lt)return Er;const ie=typeof Jr.valor=="number"?Jr.valor:Number(Jr.valor)||0;return Er+ie},0))},[zt,S,Me]),Sr=(pt,lt,Er)=>{const Jr=new Date(lt),Ae=new Date(Er);return Number.isNaN(Jr.getTime())||Number.isNaN(Ae.getTime())?[]:(Ae.setHours(23,59,59,999),zt.filter(ue=>{const Z=S.get(ue.posto_dia_vago_id)??ue.posto_dia_vago??null,K=jr(Z);if(!K||K.id!==pt)return!1;const ie=Z==null?void 0:Z.data;if(!ie)return!1;const ce=new Date(ie);return Number.isNaN(ce.getTime())?!1:ce>=Jr&&ce<=Ae}))},Nr=(pt,lt,Er,Jr)=>{const Ae=new Date(lt),ue=new Date(Er);return Number.isNaN(Ae.getTime())||Number.isNaN(ue.getTime())?[]:(ue.setHours(23,59,59,999),zt.filter(Z=>{if(Z.diarista_id!==pt)return!1;const K=S.get(Z.posto_dia_vago_id)??Z.posto_dia_vago??null,ie=K==null?void 0:K.data;if(!ie)return!1;const ce=new Date(ie);if(Number.isNaN(ce.getTime())||ce<Ae||ce>ue)return!1;if(Jr){const _e=Gt(K);if((_e==null?void 0:_e.clienteId)!==Jr)return!1}return!0}))},Kr=pt=>{const{diaristaId:lt,diaristaNome:Er,start:Jr,end:Ae,clienteId:ue,clienteNome:Z,total:K}=pt;if(!lt||!Jr||!Ae||K===null){$t.error("Preencha diarista e intervalo para exportar.");return}const ie=Nr(lt,Jr,Ae,ue);if(ie.length===0){$t.info("Nenhuma diria no intervalo para exportar.");return}const ce=new Set,_e=new Set,Ie=new Set,Re=new Set,Ce=new Set;ie.forEach(ur=>{var Zi;const Yr=S.get(ur.posto_dia_vago_id)??ur.posto_dia_vago??null,Xr=Yr==null?void 0:Yr.posto;Xr!=null&&Xr.nome&&ce.add(Xr.nome),(Zi=Xr==null?void 0:Xr.unidade)!=null&&Zi.nome&&_e.add(Xr.unidade.nome);const Rn=Gt(Yr);Rn!=null&&Rn.negocio&&Re.add(Rn.negocio),Rn!=null&&Rn.clienteNome&&Ie.add(Rn.clienteNome),Ce.add(qo[ur.status]||ur.status)});const ze=Z?`Valor a receber de ${Er} entre os dias ${Jr} e ${Ae} do cliente ${Z}`:`Valor a receber de ${Er} entre os dias ${Jr} e ${Ae}`,et=E.get(lt),ut=[{Titulo:ze,Diarista:Er||"-","CPF diarista":(et==null?void 0:et.cpf)||"-",Banco:(et==null?void 0:et.banco)||"-",Agencia:(et==null?void 0:et.agencia)||"-","Numero da conta":(et==null?void 0:et.numero_conta)||"-","Tipo de conta":(et==null?void 0:et.tipo_conta)||"-",Pix:(et==null?void 0:et.pix)||"-","Data inicial":Jr,"Data final":Ae,Status:Array.from(Ce).join(", ")||"-",Cliente:Z||Array.from(Ie).join(", ")||"-",Contrato:Array.from(Re).join(", ")||"-",Unidade:Array.from(_e).join(", ")||"-",Posto:Array.from(ce).join(", ")||"-","Valor total (R$)":K??0}],Ut=Go.json_to_sheet(ut),Xt=Go.book_new();Go.book_append_sheet(Xt,Ut,"Total");const Qt=Z?`total-diarista-cliente-${In(e)}-${Date.now()}.xlsx`:`total-diarista-${In(e)}-${Date.now()}.xlsx`;rv(Xt,Qt),$t.success("Planilha de total gerada.")},Zn=()=>{var Ie;const{clienteId:pt,startDate:lt,endDate:Er}=Me;if(!pt||!lt||!Er||Pr===null){$t.error("Preencha cliente e intervalo para exportar.");return}const Jr=Sr(pt,lt,Er);if(Jr.length===0){$t.info("Nenhuma diria no intervalo para exportar.");return}const Ae=((Ie=xn.find(Re=>Re.id===pt))==null?void 0:Ie.nome)||"",ue=new Set;Jr.forEach(Re=>{const Ce=E.get(Re.diarista_id)??Re.diarista??null;Ce!=null&&Ce.cpf&&ue.add(Ce.cpf)});const K=[{Titulo:`Valor a receber do cliente ${Ae||"(sem nome)"} entre ${lt} e ${Er}`,Cliente:Ae||"-","CPFs diaristas":Array.from(ue).join(", ")||"-","Data inicial":lt,"Data final":Er,"Valor total (R$)":Pr??0}],ie=Go.json_to_sheet(K),ce=Go.book_new();Go.book_append_sheet(ce,ie,"Total Cliente");const _e=`total-cliente-${In(e)}-${Date.now()}.xlsx`;rv(ce,_e),$t.success("Planilha do cliente gerada.")},Yn=()=>qe({diaristaId:"",motivo:"",clienteId:"",startDate:"",endDate:""}),Zt=V.useMemo(()=>{for(const pt of zt){const lt=S.get(pt.posto_dia_vago_id)??pt.posto_dia_vago??null,Er=vH(lt==null?void 0:lt.data);if(Er)return Er}return null},[zt,S]),en=Vt.length===0&&zt.length>0&&!!Zt,Sn=pt=>{const lt=In(pt);return lt===In(Vr.cancelada)||lt===In(Vr.reprovada)},fs=pt=>{const lt=In(pt);return lt===In(Vr.confirmada)?"Deseja confirmar esta diria?":lt===In(Vr.aprovada)?"Deseja aprovar esta diria?":lt===In(Vr.lancada)?"Deseja lanar esta diria para pagamento?":lt===In(Vr.aprovadaPagamento)?"Deseja aprovar esta diria para pagamento?":lt===In(Vr.reprovada)?"Deseja reprovar esta diria?":lt===In(Vr.cancelada)?"Deseja cancelar esta diria?":`Deseja alterar o status da diria para ${qo[pt]||pt}?`},ms=pt=>typeof window>"u"?!0:window.confirm(fs(pt)),hr=async pt=>{if(!(typeof window<"u"&&!window.confirm("Deseja excluir esta diria cancelada?"))){Oe(pt);try{const{error:lt}=await tt.from("diarias").delete().eq("id",pt);if(lt)throw lt;$t.success("Diria excluda."),await D()}catch(lt){$t.error(lt.message||"Erro ao excluir a diria.")}finally{Oe(null)}}},An=async(pt,lt,Er={})=>{F(pt);try{const{error:Jr}=await tt.from("diarias").update({status:lt,...Er}).eq("id",pt);if(Jr)throw Jr;$t.success(`Status atualizado para ${qo[lt]}.`),await D()}catch(Jr){$t.error(Jr.message||"Erro ao atualizar status da diria.")}finally{F(null)}},fi=(pt,lt)=>{ye({open:!0,diariaId:pt,targetStatus:lt}),be("")},Vi=()=>{ye({open:!1,diariaId:null,targetStatus:null}),be("")},$n=async()=>{if(!le.diariaId||!le.targetStatus)return;if(!pe.trim()){$t.error("Informe o motivo.");return}const pt=pe.trim(),Er=In(le.targetStatus)===In(Vr.reprovada)?{motivo_reprovacao:pt,motivo_cancelamento:null}:{motivo_cancelamento:pt,motivo_reprovacao:null};ms(le.targetStatus)&&(await An(le.diariaId,le.targetStatus,Er),Y(Jr=>({...Jr,[le.diariaId]:""})),Vi())},vi=(pt,lt)=>{if(Sn(lt))fi(pt,lt);else{if(!ms(lt))return;An(pt,lt)}},ii=(pt,lt)=>{const Er=xH[In(lt)];return Er?c.jsx(Nt,{size:"sm",variant:"outline",disabled:H===pt,onClick:Jr=>{Jr.stopPropagation(),vi(pt,Er.nextStatus)},children:Er.label}):null},Ds=async pt=>{const lt=U[pt];if(!lt){$t.error("Selecione um status para atualizar.");return}if(Sn(lt)){fi(pt,lt);return}ms(lt)&&(await An(pt,lt),Y(Er=>({...Er,[pt]:""})))},Ua=pt=>{me(pt),J(!0)},Us=()=>{J(!1),me(null)},Ot=ne?S.get(ne.posto_dia_vago_id)??ne.posto_dia_vago??null:null,Hr=Ot==null?void 0:Ot.posto,hn=Gt(Ot),vn=ne?ne.diarista??E.get(ne.diarista_id)??null:null,ai=Ot!=null&&Ot.posto_servico_id?R.get(Ot.posto_servico_id):null,At=((Ot==null?void 0:Ot.motivo)||"").toLowerCase().trim(),$i=!!At&&At!=="posto vago";return c.jsxs(Wa,{children:[c.jsxs("div",{className:"space-y-6 p-4 md:p-6",children:[c.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-sm text-muted-foreground uppercase tracking-wide",children:"Dirias"}),c.jsx("h1",{className:"text-3xl font-bold",children:t}),c.jsx("p",{className:"text-sm text-muted-foreground",children:r})]}),c.jsx(xr,{type:"month",value:f,onChange:pt=>m(pt.target.value),className:"w-auto"})]}),en&&Zt&&c.jsx($r,{className:"shadow-lg",children:c.jsxs(_n,{className:"flex items-center justify-between py-4",children:[c.jsx("p",{className:"text-sm text-muted-foreground",children:"Existem dirias neste status fora do ms selecionado."}),c.jsx(Nt,{variant:"outline",size:"sm",className:"bg-red-600 text-white hover:bg-red-700",onClick:()=>m(Zt),children:"Ver ms com registros"})]})}),c.jsxs($r,{className:"shadow-lg",children:[c.jsxs(Xn,{className:"flex flex-row items-center justify-between",children:[c.jsxs("div",{children:[c.jsx(ti,{className:"text-lg",children:qo[e]}),c.jsxs(Gs,{children:["Perodo selecionado: ",f]})]}),c.jsxs(Oi,{variant:_H[e]||"outline",children:[Vt.length," diria(s)"]})]}),c.jsxs(_n,{className:"space-y-4",children:[c.jsxs("div",{className:"flex flex-col gap-3",children:[c.jsxs("div",{className:"grid gap-3 sm:grid-cols-1 md:grid-cols-2 xl:grid-cols-4",children:[c.jsxs("div",{className:"space-y-1",children:[c.jsx(Dt,{htmlFor:`filtro-diarista-${e}`,children:"Diarista"}),c.jsxs(Lr,{value:Ee.diaristaId||ee,onValueChange:pt=>qe(lt=>({...lt,diaristaId:pt===ee?"":pt})),children:[c.jsx(Or,{id:`filtro-diarista-${e}`,children:c.jsx(zr,{placeholder:"Todos os diaristas"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:ee,children:"Todos os diaristas"}),Wr.map(pt=>c.jsx(yt,{value:pt.id,children:pt.nome},pt.id))]})]})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsx(Dt,{htmlFor:`filtro-motivo-${e}`,children:"Motivo"}),c.jsxs(Lr,{value:Ee.motivo||ee,onValueChange:pt=>qe(lt=>({...lt,motivo:pt===ee?"":pt})),children:[c.jsx(Or,{id:`filtro-motivo-${e}`,children:c.jsx(zr,{placeholder:"Todos os motivos"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:ee,children:"Todos os motivos"}),nn.map(pt=>c.jsx(yt,{value:pt,children:pt},pt))]})]})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsx(Dt,{htmlFor:`filtro-cliente-${e}`,children:"Cliente"}),c.jsxs(Lr,{value:Ee.clienteId||ee,onValueChange:pt=>qe(lt=>({...lt,clienteId:pt===ee?"":pt})),children:[c.jsx(Or,{id:`filtro-cliente-${e}`,children:c.jsx(zr,{placeholder:"Todos os clientes"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:ee,children:"Todos os clientes"}),xn.map(pt=>c.jsx(yt,{value:pt.id,children:pt.nome},pt.id))]})]})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsx(Dt,{htmlFor:`filtro-data-inicio-${e}`,children:"Data inicial"}),c.jsx(xr,{id:`filtro-data-inicio-${e}`,type:"date",value:Ee.startDate,onChange:pt=>qe(lt=>({...lt,startDate:pt.target.value}))})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsx(Dt,{htmlFor:`filtro-data-fim-${e}`,children:"Data final"}),c.jsx(xr,{id:`filtro-data-fim-${e}`,type:"date",value:Ee.endDate,onChange:pt=>qe(lt=>({...lt,endDate:pt.target.value}))})]})]}),ft&&c.jsx("div",{className:"flex justify-end",children:c.jsx(Nt,{variant:"ghost",size:"sm",onClick:Yn,children:"Limpar filtros"})})]}),c.jsxs("div",{className:"flex justify-end gap-2",children:[c.jsx(Nt,{variant:"outline",onClick:Nn,children:"Exportar XLSX"}),c.jsx(Nt,{variant:"outline",onClick:()=>it(!0),children:"Filtragem Avanada"})]}),c.jsx("div",{className:"overflow-x-auto",children:Dn.length===0?c.jsx("p",{className:"text-sm text-muted-foreground text-center py-6",children:ft?"Nenhuma diaria encontrada com os filtros selecionados.":s||"Nenhuma diaria encontrada para este status no periodo selecionado."}):c.jsxs(nu,{children:[c.jsx(iu,{children:c.jsxs(Ws,{children:[c.jsx(gn,{children:"Data"}),c.jsx(gn,{className:"hidden md:table-cell",children:"CPF diarista"}),c.jsx(gn,{className:"hidden md:table-cell",children:"Unidade"}),c.jsx(gn,{className:"hidden md:table-cell",children:"Motivo (dia vago)"}),c.jsx(gn,{children:"Diarista"}),c.jsx(gn,{className:"hidden md:table-cell",children:"Valor"}),c.jsx(gn,{className:"hidden md:table-cell",children:"Pix do diarista"}),c.jsx(gn,{className:"hidden md:table-cell text-right",children:"Acoes"})]})}),c.jsx(su,{children:Dn.map(pt=>{var ce;const lt=S.get(pt.posto_dia_vago_id)??pt.posto_dia_vago??null,Er=lt==null?void 0:lt.posto,Jr=E.get(pt.diarista_id),Ae=lt!=null&&lt.posto_servico_id?R.get(lt.posto_servico_id):null,ue=((lt==null?void 0:lt.motivo)||"").toLowerCase().trim(),Z=!!ue&&ue!=="posto vago",K=In(pt.status)===nt,ie=ii(pt.id,pt.status);return c.jsxs(Ws,{className:"cursor-pointer transition hover:bg-muted/90",onClick:()=>Ua(pt),children:[c.jsx(tn,{children:o_(lt==null?void 0:lt.data)}),c.jsx(tn,{className:"hidden md:table-cell",children:(Jr==null?void 0:Jr.cpf)||"-"}),c.jsx(tn,{className:"hidden md:table-cell",children:((ce=Er==null?void 0:Er.unidade)==null?void 0:ce.nome)||"-"}),c.jsx(tn,{className:"hidden md:table-cell",children:c.jsxs("div",{className:"flex flex-col",children:[c.jsx("span",{children:(lt==null?void 0:lt.motivo)||"-"}),Z&&Ae&&c.jsxs("span",{className:"text-xs text-muted-foreground",children:["Ocupado por: ",Ae.nome_completo]})]})}),c.jsx(tn,{children:c.jsxs("div",{className:"flex flex-col gap-2",children:[c.jsx("span",{children:(Jr==null?void 0:Jr.nome_completo)||"-"}),c.jsxs("span",{className:"text-xs text-muted-foreground md:hidden",children:["CPF: ",(Jr==null?void 0:Jr.cpf)||"-"]}),c.jsxs("div",{className:"md:hidden flex flex-col gap-2 pt-2",onClick:_e=>_e.stopPropagation(),children:[c.jsxs("div",{className:"flex flex-wrap gap-2",children:[e===Vr.confirmada&&c.jsx(Nt,{size:"sm",variant:"destructive",disabled:H===pt.id||K,onClick:()=>fi(pt.id,Vr.reprovada),children:"Reprovar"}),dt&&c.jsxs(Nt,{size:"icon",variant:"ghost",className:"text-destructive",disabled:ke===pt.id,onClick:()=>hr(pt.id),children:[c.jsx(zo,{className:"h-4 w-4"}),c.jsx("span",{className:"sr-only",children:"Excluir diaria"})]})]}),ie&&c.jsx("div",{children:ie}),c.jsxs("div",{className:"flex flex-col gap-2",children:[c.jsxs(Lr,{value:U[pt.id]||"",onValueChange:_e=>Y(Ie=>({...Ie,[pt.id]:_e})),children:[c.jsx(Or,{className:"w-full",children:c.jsx(zr,{placeholder:"Alterar status"})}),c.jsx(Fr,{children:he.map(_e=>c.jsx(yt,{value:_e,children:qo[_e]},_e))})]}),c.jsx(Nt,{size:"sm",variant:"secondary",disabled:H===pt.id||!U[pt.id]||U[pt.id]===pt.status,onClick:()=>Ds(pt.id),children:"Aplicar"})]})]})]})}),c.jsx(tn,{className:"hidden md:table-cell",children:wc.format(pt.valor||0)}),c.jsx(tn,{className:"hidden md:table-cell",children:(Jr==null?void 0:Jr.pix)||"-"}),c.jsx(tn,{className:"hidden md:table-cell",onClick:_e=>_e.stopPropagation(),children:c.jsxs("div",{className:"flex flex-col items-end gap-2",children:[c.jsxs("div",{className:"flex flex-wrap justify-end gap-2",children:[e===Vr.confirmada&&c.jsx(Nt,{size:"sm",variant:"destructive",disabled:H===pt.id||K,onClick:_e=>{_e.stopPropagation(),fi(pt.id,Vr.reprovada)},children:"Reprovar"}),dt&&c.jsxs(Nt,{size:"icon",variant:"ghost",className:"text-destructive",disabled:ke===pt.id,onClick:_e=>{_e.stopPropagation(),hr(pt.id)},children:[c.jsx(zo,{className:"h-4 w-4"}),c.jsx("span",{className:"sr-only",children:"Excluir di\\u00e1ria"})]})]}),ie&&c.jsx("div",{onClick:_e=>_e.stopPropagation(),children:ie}),c.jsxs("div",{className:"flex items-center gap-2",onClick:_e=>_e.stopPropagation(),children:[c.jsxs(Lr,{value:U[pt.id]||"",onValueChange:_e=>Y(Ie=>({...Ie,[pt.id]:_e})),children:[c.jsx(Or,{className:"w-[220px]",children:c.jsx(zr,{placeholder:"Alterar status"})}),c.jsx(Fr,{children:he.map(_e=>c.jsx(yt,{value:_e,children:qo[_e]},_e))})]}),c.jsx(Nt,{size:"sm",variant:"secondary",disabled:H===pt.id||!U[pt.id]||U[pt.id]===pt.status,onClick:_e=>{_e.stopPropagation(),Ds(pt.id)},children:"Aplicar"})]})]})})]},pt.id)})})]})})]})]}),I&&c.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Atualizando informaes..."})]}),c.jsx(Bs,{open:le.open,onOpenChange:pt=>pt?null:Vi(),children:c.jsxs(Is,{children:[c.jsxs(Ns,{children:[c.jsx(ks,{children:In(le.targetStatus||"")===nt?"Reprovar diria":"Cancelar diria"}),c.jsxs(La,{children:["Informe o motivo para ",In(le.targetStatus||"")===nt?"reprovar":"cancelar"," esta diria."]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"motivo-diaria",children:"Motivo"}),c.jsx(ec,{id:"motivo-diaria",value:pe,onChange:pt=>be(pt.target.value),placeholder:"Descreva o motivo",rows:4})]}),c.jsxs(_d,{children:[c.jsx(Nt,{type:"button",variant:"outline",onClick:Vi,children:"Fechar"}),c.jsx(Nt,{type:"button",onClick:$n,disabled:!pe.trim()||H===le.diariaId,children:H===le.diariaId?"Salvando...":"Confirmar"})]})]})}),c.jsx(Bs,{open:Kt,onOpenChange:it,children:c.jsxs(Is,{children:[c.jsxs(Ns,{children:[c.jsx(ks,{children:"Filtragem"}),c.jsx(La,{children:"Consulte totais das di\\u00e1rias neste status. A primeira sess\\u00e3o considera apenas diarista e datas; a segunda inclui o cliente vinculado ao posto de servi\\u00e7o."})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"space-y-2 rounded-md border bg-muted/30 p-4",children:[c.jsx("p",{className:"text-sm font-semibold text-muted-foreground",children:"Total por diarista"}),c.jsxs("div",{className:"grid gap-3 sm:grid-cols-1 md:grid-cols-3",children:[c.jsxs("div",{className:"space-y-1",children:[c.jsx(Dt,{htmlFor:`total-diarista-${e}`,children:"Diarista"}),c.jsxs(Lr,{value:Qe.diaristaId||ee,onValueChange:pt=>gt(lt=>({...lt,diaristaId:pt===ee?"":pt})),children:[c.jsx(Or,{id:`total-diarista-${e}`,children:c.jsx(zr,{placeholder:"Selecione o diarista"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:ee,children:"Selecione o diarista"}),Wr.map(pt=>c.jsx(yt,{value:pt.id,children:pt.nome},pt.id))]})]})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsx(Dt,{htmlFor:`total-inicio-${e}`,children:"Data inicial"}),c.jsx(xr,{id:`total-inicio-${e}`,type:"date",value:Qe.startDate,onChange:pt=>gt(lt=>({...lt,startDate:pt.target.value}))})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsx(Dt,{htmlFor:`total-fim-${e}`,children:"Data final"}),c.jsx(xr,{id:`total-fim-${e}`,type:"date",value:Qe.endDate,onChange:pt=>gt(lt=>({...lt,endDate:pt.target.value}))})]})]}),c.jsxs("div",{className:"rounded-md border bg-background/80 p-3",children:[c.jsx("p",{className:"text-sm text-muted-foreground",children:"Total no per\\u00edodo"}),c.jsx("p",{className:"text-2xl font-semibold",children:Rt!==null?wc.format(Rt):"--"}),c.jsx("div",{className:"pt-2",children:c.jsx(Nt,{variant:"outline",size:"sm",onClick:()=>{var pt;return Kr({diaristaId:Qe.diaristaId,diaristaNome:((pt=E.get(Qe.diaristaId||""))==null?void 0:pt.nome_completo)||"",start:Qe.startDate,end:Qe.endDate,total:Rt})},children:"Exportar total"})})]})]}),c.jsxs("div",{className:"space-y-2 rounded-md border bg-muted/30 p-4",children:[c.jsx("p",{className:"text-sm font-semibold text-muted-foreground",children:"Total por diarista e cliente"}),c.jsxs("div",{className:"grid gap-3 sm:grid-cols-1 md:grid-cols-4",children:[c.jsxs("div",{className:"space-y-1",children:[c.jsx(Dt,{htmlFor:`total-diarista-cliente-${e}`,children:"Diarista"}),c.jsxs(Lr,{value:Xe.diaristaId||ee,onValueChange:pt=>ct(lt=>({...lt,diaristaId:pt===ee?"":pt})),children:[c.jsx(Or,{id:`total-diarista-cliente-${e}`,children:c.jsx(zr,{placeholder:"Selecione o diarista"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:ee,children:"Selecione o diarista"}),Wr.map(pt=>c.jsx(yt,{value:pt.id,children:pt.nome},pt.id))]})]})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsx(Dt,{htmlFor:`total-inicio-cliente-${e}`,children:"Data inicial"}),c.jsx(xr,{id:`total-inicio-cliente-${e}`,type:"date",value:Xe.startDate,onChange:pt=>ct(lt=>({...lt,startDate:pt.target.value}))})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsx(Dt,{htmlFor:`total-fim-cliente-${e}`,children:"Data final"}),c.jsx(xr,{id:`total-fim-cliente-${e}`,type:"date",value:Xe.endDate,onChange:pt=>ct(lt=>({...lt,endDate:pt.target.value}))})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsx(Dt,{htmlFor:`total-cliente-${e}`,children:"Cliente (do posto)"}),c.jsxs(Lr,{value:Xe.clienteId||ee,onValueChange:pt=>ct(lt=>({...lt,clienteId:pt===ee?"":pt})),children:[c.jsx(Or,{id:`total-cliente-${e}`,children:c.jsx(zr,{placeholder:"Selecione o cliente"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:ee,children:"Selecione o cliente"}),Pi.map(pt=>c.jsx(yt,{value:pt.id,children:pt.nome},pt.id))]})]})]})]}),c.jsxs("div",{className:"rounded-md border bg-background/80 p-3",children:[c.jsx("p",{className:"text-sm text-muted-foreground",children:"Total no per\\u00edodo (com cliente)"}),c.jsx("p",{className:"text-2xl font-semibold",children:Wt!==null?wc.format(Wt):"--"}),c.jsx("div",{className:"pt-2",children:c.jsx(Nt,{variant:"outline",size:"sm",onClick:()=>{var pt,lt;return Kr({diaristaId:Xe.diaristaId,diaristaNome:((pt=E.get(Xe.diaristaId||""))==null?void 0:pt.nome_completo)||"",start:Xe.startDate,end:Xe.endDate,clienteId:Xe.clienteId,clienteNome:((lt=Pi.find(Er=>Er.id===Xe.clienteId))==null?void 0:lt.nome)||"",total:Wt})},children:"Exportar total"})})]})]}),c.jsxs("div",{className:"space-y-2 rounded-md border bg-muted/30 p-4",children:[c.jsx("p",{className:"text-sm font-semibold text-muted-foreground",children:"Total por cliente"}),c.jsxs("div",{className:"grid gap-3 sm:grid-cols-1 md:grid-cols-3",children:[c.jsxs("div",{className:"space-y-1",children:[c.jsx(Dt,{htmlFor:`total-cliente-only-${e}`,children:"Cliente"}),c.jsxs(Lr,{value:Me.clienteId||ee,onValueChange:pt=>mt(lt=>({...lt,clienteId:pt===ee?"":pt})),children:[c.jsx(Or,{id:`total-cliente-only-${e}`,children:c.jsx(zr,{placeholder:"Selecione o cliente"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:ee,children:"Selecione o cliente"}),xn.map(pt=>c.jsx(yt,{value:pt.id,children:pt.nome},pt.id))]})]})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsx(Dt,{htmlFor:`total-cliente-inicio-${e}`,children:"Data inicial"}),c.jsx(xr,{id:`total-cliente-inicio-${e}`,type:"date",value:Me.startDate,onChange:pt=>mt(lt=>({...lt,startDate:pt.target.value}))})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsx(Dt,{htmlFor:`total-cliente-fim-${e}`,children:"Data final"}),c.jsx(xr,{id:`total-cliente-fim-${e}`,type:"date",value:Me.endDate,onChange:pt=>mt(lt=>({...lt,endDate:pt.target.value}))})]})]}),c.jsxs("div",{className:"rounded-md border bg-background/80 p-3",children:[c.jsx("p",{className:"text-sm text-muted-foreground",children:"Total no per\\u00edodo (cliente)"}),c.jsx("p",{className:"text-2xl font-semibold",children:Pr!==null?wc.format(Pr):"--"}),c.jsx("div",{className:"pt-2",children:c.jsx(Nt,{variant:"outline",size:"sm",onClick:Zn,children:"Exportar total"})})]})]})]}),c.jsx(_d,{children:c.jsx(Nt,{type:"button",onClick:()=>it(!1),children:"Fechar"})})]})}),c.jsx(Bs,{open:z,onOpenChange:pt=>pt?null:Us(),children:c.jsxs(Is,{className:"max-w-2xl",children:[c.jsxs(Ns,{children:[c.jsx(ks,{children:"Detalhes da diria"}),c.jsx(La,{children:"Visualize as informaes completas da diria selecionada e os dados bancrios do diarista."})]}),ne&&c.jsxs("div",{className:"space-y-6 text-sm",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Informaes gerais"}),c.jsxs("div",{className:"mt-2 grid gap-3 md:grid-cols-2",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Data"}),c.jsx("p",{className:"font-medium",children:o_(Ot==null?void 0:Ot.data)})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Status"}),c.jsx("p",{className:"font-medium",children:qo[ne.status]||ne.status})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Posto"}),c.jsx("p",{className:"font-medium",children:(Hr==null?void 0:Hr.nome)||"-"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Unidade"}),c.jsx("p",{className:"font-medium",children:((ha=Hr==null?void 0:Hr.unidade)==null?void 0:ha.nome)||"-"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Motivo (dia vago)"}),c.jsx("p",{className:"font-medium",children:(Ot==null?void 0:Ot.motivo)||"-"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Contrato"}),c.jsx("p",{className:"font-medium",children:(hn==null?void 0:hn.negocio)||"-"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Cliente"}),c.jsx("p",{className:"font-medium",children:(hn==null?void 0:hn.clienteNome)||"-"})]}),$i&&ai&&c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Colaborador alocado"}),c.jsx("p",{className:"font-medium",children:ai.nome_completo})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Valor"}),c.jsx("p",{className:"font-medium",children:wc.format(ne.valor||0)})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Atualizado em"}),c.jsx("p",{className:"font-medium",children:AC(ne.updated_at)})]}),ne.motivo_reprovacao&&c.jsxs("div",{className:"sm:col-span-2",children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Motivo reprovao"}),c.jsx("p",{className:"font-medium whitespace-pre-line",children:ne.motivo_reprovacao})]}),ne.motivo_cancelamento&&c.jsxs("div",{className:"sm:col-span-2",children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Motivo cancelamento"}),c.jsx("p",{className:"font-medium whitespace-pre-line",children:ne.motivo_cancelamento})]})]})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Diarista"}),c.jsxs("div",{className:"mt-2 grid gap-3 md:grid-cols-2",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Nome"}),c.jsx("p",{className:"font-medium",children:(vn==null?void 0:vn.nome_completo)||"-"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"CPF"}),c.jsx("p",{className:"font-medium",children:(vn==null?void 0:vn.cpf)||"-"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Status"}),c.jsx("p",{className:"font-medium",children:(vn==null?void 0:vn.status)||"-"})]})]})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Dados bancrios"}),c.jsxs("div",{className:"mt-2 grid gap-3 md:grid-cols-2",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Banco"}),c.jsx("p",{className:"font-medium",children:(vn==null?void 0:vn.banco)||"-"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Agncia"}),c.jsx("p",{className:"font-medium",children:(vn==null?void 0:vn.agencia)||"-"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Nmero da conta"}),c.jsx("p",{className:"font-medium",children:(vn==null?void 0:vn.numero_conta)||"-"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Tipo de conta"}),c.jsx("p",{className:"font-medium",children:(vn==null?void 0:vn.tipo_conta)||"-"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Chave Pix"}),c.jsx("p",{className:"font-medium break-all",children:(vn==null?void 0:vn.pix)||"-"})]})]})]})]}),c.jsx(_d,{children:c.jsx(Nt,{type:"button",onClick:Us,children:"Fechar"})})]})})]})},Bbe=Pm(km[0]),Ube=Pm(km[1]),Vbe=Pm(km[2]),$be=Pm(km[3]),qbe=Pm(km[4]),Gbe=Pm(km[5]),Wbe=Pm(km[6]),Hbe=Pm(km[7]);function bH(e){const t=V.useMemo(()=>yH(e),[e]),{data:r=[]}=aa({queryKey:["clientes-temporarias"],queryFn:async()=>{const{data:Y,error:z}=await tt.from("clientes").select("id, razao_social, nome_fantasia").order("razao_social");if(z)throw z;return Y||[]}}),{data:s=[]}=aa({queryKey:["diaristas-temporarias"],queryFn:async()=>{const{data:Y,error:z}=await tt.from("diaristas").select("*").order("nome_completo");if(z)throw z;return Y?Y.map(J=>({id:J.id,nome_completo:J.nome_completo,cpf:J.cpf??null,cargo:J.cargo??null,status:J.status??null,banco:J.banco??null,agencia:J.agencia??null,numero_conta:J.numero_conta??null,tipo_conta:J.tipo_conta??null,pix:J.pix??null})):[]}}),{data:u=[]}=aa({queryKey:["colaboradores-alocados-temporarias"],queryFn:async()=>{const{data:Y,error:z}=await tt.from("colaboradores").select(`
          id,
          nome_completo,
          cargo,
          posto_servico_id,
          posto:postos_servico (
            id,
            nome,
            valor_diaria,
            unidade:unidades (
              id,
              nome,
              contrato_id,
              contrato:contratos (
                id,
                negocio,
                cliente_id,
                clientes (
                  id,
                  razao_social,
                  nome_fantasia
                )
              )
            )
          )
        `).not("posto_servico_id","is",null).order("nome_completo",{ascending:!0});if(z)throw z;return Y||[]}}),{data:f=[],isLoading:m,refetch:i}=aa({queryKey:["diarias-temporarias"],queryFn:async()=>{const{data:Y,error:z}=await tt.from("diarias_temporarias").select("*").order("created_at",{ascending:!1});if(z)throw z;return Y||[]}}),S=V.useMemo(()=>{const Y=new Set;return f.forEach(z=>{[z.criado_por,z.confirmada_por,z.aprovada_por,z.lancada_por,z.aprovado_para_pgto_por,z.paga_por,z.cancelada_por,z.reprovada_por].forEach(J=>{J&&Y.add(J)})}),Array.from(Y).sort()},[f]),{data:E=[]}=aa({queryKey:["profiles-temporarias",S],queryFn:async()=>{if(S.length===0)return[];const Y=await tt.rpc("get_profiles_names",{p_ids:S});if(!Y.error&&Y.data)return Y.data;const{data:z,error:J}=await tt.from("profiles").select("id, full_name").in("id",S);if(J)throw J;return z||[]},enabled:S.length>0}),I=V.useMemo(()=>({start:rf(t.start),end:rf(t.end)}),[t]),D=V.useMemo(()=>f.filter(Y=>{if(!Y.data_diaria)return!1;try{return YP(rf(Y.data_diaria),I)}catch{return!1}}),[f,I]),M=V.useMemo(()=>{const Y=new Map;return s.forEach(z=>Y.set(z.id,z)),Y},[s]),R=V.useMemo(()=>{const Y=new Map;return u.forEach(z=>Y.set(z.id,z)),Y},[u]),H=V.useMemo(()=>{const Y=new Map;return u.forEach(z=>{z.posto_servico_id&&z.posto&&Y.set(z.posto_servico_id,z.posto)}),Y},[u]),F=V.useMemo(()=>{const Y=new Map;return r.forEach(z=>{Y.set(z.id,z.nome_fantasia||z.razao_social)}),Y},[r]),U=V.useMemo(()=>{const Y=new Map;return E.forEach(z=>{z.id&&Y.set(z.id,z.full_name||"")}),Y},[E]);return{clientes:r,colaboradores:u,colaboradoresMap:R,diaristas:s,diaristaMap:M,diarias:f,filteredDiarias:D,postoMap:H,clienteMap:F,profileMap:U,refetchDiarias:i,loadingDiarias:m}}const Dm=[{statusKey:Vr.aguardando,title:"Diarias aguardando confirmacao",description:"Confirme as diarias cadastradas recentemente.",emptyMessage:"Nenhuma diaria aguardando confirmacao."},{statusKey:Vr.confirmada,title:"Diarias confirmadas",description:"Avance as diarias confirmadas para aprovacao."},{statusKey:Vr.aprovada,title:"Diarias aprovadas",description:"Prepare as diarias aprovadas para lancamento."},{statusKey:Vr.lancada,title:"Diarias lancadas",description:"Controle as diarias lancadas aguardando pagamento."},{statusKey:Vr.aprovadaPagamento,title:"Diarias aprovadas para pagamento",description:"Acompanhe diarias aprovadas em fase final de pagamento."},{statusKey:Vr.reprovada,title:"Diarias reprovadas",description:"Historico de diarias reprovadas e motivos.",emptyMessage:"Nenhuma diaria reprovada."},{statusKey:Vr.cancelada,title:"Diarias canceladas",description:"Historico de diarias canceladas.",emptyMessage:"Nenhuma diaria cancelada."},{statusKey:Vr.paga,title:"Diarias pagas",description:"Diarias pagas. Apenas alteracao de status disponivel.",emptyMessage:"Nenhuma diaria paga."}],Zbe="LICENA NOJO (FALECIMENTO)",Rm=({statusKey:e,title:t,description:r,emptyMessage:s})=>function(){var wa,ro,Ko,au;const[f,m]=V.useState(NA),{filteredDiarias:i,diarias:S,refetchDiarias:E,loadingDiarias:I,diaristaMap:D,colaboradoresMap:M,postoMap:R,clienteMap:H,profileMap:F}=bH(f),[U,Y]=V.useState(null),[z,J]=V.useState({}),[ne,me]=V.useState(!1),[le,ye]=V.useState(null),[pe,be]=V.useState({open:!1,diariaId:null,targetStatus:null}),[ke,Oe]=V.useState(""),[Ee,qe]=V.useState(null),[Qe,gt]=V.useState({diaristaId:"",motivo:"",clienteId:"",startDate:"",endDate:"",criadoPorId:"",statusResponsavelId:""}),[Xe,ct]=V.useState({diaristaId:"",startDate:"",endDate:""}),[Me,mt]=V.useState({diaristaId:"",clienteId:"",startDate:"",endDate:""}),[Kt,it]=V.useState({clienteId:"",startDate:"",endDate:""}),[ee,he]=V.useState(!1),Se="__all__",Ue=V.useMemo(()=>Object.values(Vr).filter(He=>He!==Vr.reprovada),[]),nt=In(e),dt=nt===In(Vr.aguardando),Vt=In(Vr.cancelada),zt=In(Vr.reprovada),Gt=nt===Vt,jr=nt===In(Vr.paga),Wr=V.useMemo(()=>new Map([[In(Vr.confirmada),"confirmada_por"],[In(Vr.aprovada),"aprovada_por"],[In(Vr.lancada),"lancada_por"],[In(Vr.aprovadaPagamento),"aprovado_para_pgto_por"],[In(Vr.paga),"paga_por"],[In(Vr.cancelada),"cancelada_por"],[In(Vr.reprovada),"reprovada_por"]]).get(nt)||null,[nt]),nn=V.useMemo(()=>new Map([[Vr.confirmada,"Confirmadas por"],[Vr.aprovada,"Aprovadas por"],[Vr.lancada,"Lancadas por"],[Vr.aprovadaPagamento,"Aprovadas para pagamento por"],[Vr.paga,"Pagas por"],[Vr.reprovada,"Reprovadas por"],[Vr.cancelada,"Canceladas por"]]).get(e)||"Responsavel",[e]),xn=He=>{if(He==null)return"-";const Et=Number(He);return Number.isNaN(Et)?"-":`${Et} min`},ei=He=>{if(!He)return"-";const[Et="",lr=""]=He.split(":");return!Et&&!lr?He:`${Et.padStart(2,"0")}:${lr.padStart(2,"0")}`},Dn=He=>{if(He==null)return"-";const Et=Number(He);return Number.isNaN(Et)?"-":`${Et.toFixed(2)} h`},Zr=He=>{switch(In(He.status)){case In(Vr.confirmada):return{id:He.confirmada_por||null,label:"Confirmacao"};case In(Vr.aprovada):return{id:He.aprovada_por||null,label:"Aprovacao"};case In(Vr.lancada):return{id:He.lancada_por||null,label:"Lancamento"};case In(Vr.aprovadaPagamento):return{id:He.aprovado_para_pgto_por||null,label:"Aprovacao pagamento"};case In(Vr.paga):return{id:He.paga_por||null,label:"Pagamento"};case In(Vr.cancelada):return{id:He.cancelada_por||null,label:"Cancelamento"};case In(Vr.reprovada):return{id:He.reprovada_por||null,label:"Reprovacao"};default:return{id:null,label:""}}},Nn=He=>He&&F.get(He)||"-",Pi=He=>He.map(Et=>{const lr={};return Object.entries(Et).forEach(([qr,oi])=>{lr[qr]=typeof oi=="string"?oi.toUpperCase():oi}),lr}),ft=He=>(He||"").toUpperCase().includes("VAGA EM ABERTO"),Rt=He=>(He||"").toUpperCase()===Zbe.toUpperCase(),Wt=V.useMemo(()=>S.filter(He=>In(He.status)===nt),[S,nt]),Pr=V.useMemo(()=>i.filter(He=>In(He.status)===nt),[i,nt]),Sr=Wt.length,Nr=Sr>0,Kr=(qo[e]||e).toLowerCase(),Zn=He=>{var lr,qr;const Et=(lr=He==null?void 0:He.unidade)==null?void 0:lr.contrato;return Et!=null&&Et.id||Et!=null&&Et.negocio?{id:Et.id,negocio:Et.negocio??null,clienteId:Et.cliente_id??null,clienteNome:((qr=Et.clientes)==null?void 0:qr.razao_social)??null}:null},Yn=He=>{const Et=Zn(He);return Et!=null&&Et.clienteId&&Et.clienteNome?{id:Et.clienteId,nome:Et.clienteNome}:null},Zt=(He,Et)=>{var oi;return typeof He.cliente_id=="number"&&H.get(He.cliente_id)||""||((oi=Yn(Et))==null?void 0:oi.nome)||""||""},en=(He,Et)=>{var qr,oi;return typeof He.cliente_id=="number"&&He.cliente_id.toString()||((qr=Yn(Et))!=null&&qr.id?String((oi=Yn(Et))==null?void 0:oi.id):"")},Sn=V.useMemo(()=>{if(!Me.diaristaId)return[];const He=new Map;return Wt.forEach(Et=>{if(Et.diarista_id!==Me.diaristaId)return;const lr=Et.posto||(Et.posto_servico_id?R.get(Et.posto_servico_id):null),qr=en(Et,lr),oi=Zt(Et,lr);qr&&oi&&He.set(qr,oi)}),Array.from(He.entries()).map(([Et,lr])=>({id:Et,nome:lr})).sort((Et,lr)=>Et.nome.localeCompare(lr.nome))},[Wt,R,Me.diaristaId]);V.useEffect(()=>{const He=Sn.some(Et=>Et.id===Me.clienteId)?Me.clienteId:"";He!==Me.clienteId&&mt(Et=>({...Et,clienteId:He}))},[Sn,Me.clienteId]);const fs=V.useMemo(()=>{const He=new Map;return Wt.forEach(Et=>{const lr=Et.diarista||D.get(Et.diarista_id||"");Et.diarista_id&&(lr!=null&&lr.nome_completo)&&He.set(Et.diarista_id,lr.nome_completo)}),Array.from(He.entries()).map(([Et,lr])=>({id:Et,nome:lr})).sort((Et,lr)=>Et.nome.localeCompare(lr.nome))},[Wt,D]),ms=V.useMemo(()=>{const He=new Set;return Pr.forEach(Et=>{Et.motivo_vago&&He.add(Et.motivo_vago)}),Array.from(He).sort((Et,lr)=>Et.localeCompare(lr))},[Pr]),hr=V.useMemo(()=>{const He=new Map;return Wt.forEach(Et=>{if(Et.criado_por){const lr=F.get(Et.criado_por)||"";He.set(Et.criado_por,lr)}}),Array.from(He.entries()).map(([Et,lr])=>({id:Et,nome:lr||"(sem nome)"})).sort((Et,lr)=>Et.nome.localeCompare(lr.nome))},[Wt,F]),An=V.useMemo(()=>{if(!Wr)return[];const He=new Map;return Wt.forEach(Et=>{const lr=Et[Wr];if(lr){const qr=F.get(lr)||"";He.set(lr,qr)}}),Array.from(He.entries()).map(([Et,lr])=>({id:Et,nome:lr||"(sem nome)"})).sort((Et,lr)=>Et.nome.localeCompare(lr.nome))},[Wt,F,Wr]),fi=V.useMemo(()=>{const He=new Map;return[...Pr,...Wt].forEach(lr=>{const qr=lr.posto||(lr.posto_servico_id?R.get(lr.posto_servico_id):null),oi=en(lr,qr),Ti=Zt(lr,qr);oi&&Ti&&He.set(oi,Ti)}),Array.from(He.entries()).map(([lr,qr])=>({id:lr,nome:qr})).sort((lr,qr)=>lr.nome.localeCompare(qr.nome))},[Pr,Wt,R]),Vi=V.useMemo(()=>Qe.startDate||Qe.endDate?Wt:Pr,[Pr,Wt,Qe.endDate,Qe.startDate]),$n=V.useMemo(()=>Vi.filter(He=>{const Et=He.diarista_id||"",lr=He.motivo_vago||"",qr=He.posto||(He.posto_servico_id?R.get(He.posto_servico_id):null),oi=en(He,qr),Ti=He.data_diaria||"";if(Qe.startDate){const qi=new Date(Ti),Ms=new Date(Qe.startDate);if(Number.isNaN(qi.getTime())||qi<Ms)return!1}if(Qe.endDate){const qi=new Date(Ti),Ms=new Date(Qe.endDate);if(Ms.setHours(23,59,59,999),Number.isNaN(qi.getTime())||qi>Ms)return!1}if(Qe.diaristaId&&Qe.diaristaId!==Et||Qe.motivo&&Qe.motivo!==lr||Qe.criadoPorId&&Qe.criadoPorId!==(He.criado_por||"")||Qe.clienteId&&Qe.clienteId!==oi)return!1;if(Qe.statusResponsavelId&&Wr){const qi=He[Wr]||"";if(Qe.statusResponsavelId!==qi)return!1}return!0}),[Vi,Qe,Wr]),vi=He=>{var kd,Qo,Af;const Et=He.posto||(He.posto_servico_id?R.get(He.posto_servico_id):null),lr=He.diarista||D.get(He.diarista_id||""),qr=He.colaborador||(He.colaborador_ausente?M.get(He.colaborador_ausente):null),oi=Zt(He,Et)||"-",Ti=Nn(He.criado_por),{id:qi}=Zr(He),Ms=qi?Nn(qi):"",ba=Nn(He.confirmada_por),Da=Nn(He.aprovada_por),Hs=Nn(He.lancada_por),no=Nn(He.aprovado_para_pgto_por),Ea=Nn(He.paga_por),Fi=He.colaborador_ausente_nome||(qr==null?void 0:qr.nome_completo)||"-",Va=((kd=He.colaborador_falecido)==null?void 0:kd.trim())||"",Jo=He.colaborador_demitido_nome||"",nc=He.licenca_nojo===!0,Es=He.novo_posto===!0,Sa=Rt(He.motivo_vago),Bo=((Qo=He.posto_servico)==null?void 0:Qo.trim())||(Et==null?void 0:Et.nome)||"-",ta={Data:o_(He.data_diaria),Status:qo[He.status]||He.status,"Horario inicio":ei(He.horario_inicio),"Horario fim":ei(He.horario_fim),"Jornada diaria (h)":Dn(He.jornada_diaria),"Intervalo (min)":xn(He.intervalo),"Motivo (dia vago)":He.motivo_vago||"-","CPF diarista":(lr==null?void 0:lr.cpf)||"-",Posto:Bo,Cliente:oi,Diarista:(lr==null?void 0:lr.nome_completo)||"-","Status diarista":(lr==null?void 0:lr.status)||"-","Valor (R$)":He.valor_diaria||0,"Atualizado em":AC(He.updated_at),"Motivo reprovacao":He.motivo_reprovacao||"","Motivo cancelamento":He.motivo_cancelamento||"",Banco:(lr==null?void 0:lr.banco)||"-",Agencia:(lr==null?void 0:lr.agencia)||"-","Numero da conta":(lr==null?void 0:lr.numero_conta)||"-","Tipo de conta":(lr==null?void 0:lr.tipo_conta)||"-",Pix:(lr==null?void 0:lr.pix)||"-",Observacao:((Af=He.observacao)==null?void 0:Af.trim())||"","Criado por":Ti};return ta["Novo posto?"]=Es?"Sim":"N?o",dt||(ta["Responsavel status"]=Ms||""),jr&&(ta["Confirmada por"]=ba,ta["Aprovada por"]=Da,ta["Lancada por"]=Hs,ta["Aprovada para pagamento por"]=no,ta["Paga por"]=Ea),ft(He.motivo_vago)?Jo?(ta["Colaborador demitido"]=Jo,ta["Novo posto?"]="N?o"):nc?(ta["Colaborador falecido"]=Va||"-",ta["Novo posto?"]="N?o"):ta["Novo posto?"]="Sim":Sa?(ta["Colaborador falecido"]=Va||"-",ta["Novo posto?"]="N?o"):(ta["Colaborador ausente"]=Fi,ta["Novo posto?"]="N?o"),ta},ii=()=>{if($n.length===0){$t.info("Nenhuma diaria para exportar.");return}const He=Pi($n.map(vi)),Et=Go.json_to_sheet(He),lr=Go.book_new();Go.book_append_sheet(lr,Et,"Diarias");const qr=`diarias-temp-${In(e)}-${Date.now()}.xlsx`;rv(lr,qr),$t.success("Arquivo XLSX gerado.")},Ds=V.useMemo(()=>Object.values(Qe).some(Boolean),[Qe]),Ua=V.useMemo(()=>{if(!Xe.diaristaId||!Xe.startDate||!Xe.endDate)return null;const He=new Date(Xe.startDate),Et=new Date(Xe.endDate);return Number.isNaN(He.getTime())||Number.isNaN(Et.getTime())?null:(Et.setHours(23,59,59,999),He>Et?0:Wt.reduce((lr,qr)=>{if((qr.diarista_id||"")!==Xe.diaristaId)return lr;const Ti=qr.data_diaria;if(!Ti)return lr;const qi=new Date(Ti);if(Number.isNaN(qi.getTime())||qi<He||qi>Et)return lr;const Ms=typeof qr.valor_diaria=="number"?qr.valor_diaria:Number(qr.valor_diaria)||0;return lr+Ms},0))},[Wt,Xe]),Us=V.useMemo(()=>{if(!Me.diaristaId||!Me.clienteId||!Me.startDate||!Me.endDate)return null;const He=new Date(Me.startDate),Et=new Date(Me.endDate);return Number.isNaN(He.getTime())||Number.isNaN(Et.getTime())?null:(Et.setHours(23,59,59,999),He>Et?0:Wt.reduce((lr,qr)=>{if((qr.diarista_id||"")!==Me.diaristaId)return lr;const Ti=qr.data_diaria;if(!Ti)return lr;const qi=new Date(Ti);if(Number.isNaN(qi.getTime())||qi<He||qi>Et)return lr;const Ms=qr.posto||(qr.posto_servico_id?R.get(qr.posto_servico_id):null),ba=en(qr,Ms);if(!ba||ba!==Me.clienteId)return lr;const Da=typeof qr.valor_diaria=="number"?qr.valor_diaria:Number(qr.valor_diaria)||0;return lr+Da},0))},[Wt,Me,R]),Ot=V.useMemo(()=>{if(!Kt.clienteId||!Kt.startDate||!Kt.endDate)return null;const He=new Date(Kt.startDate),Et=new Date(Kt.endDate);return Number.isNaN(He.getTime())||Number.isNaN(Et.getTime())?null:(Et.setHours(23,59,59,999),He>Et?0:Wt.reduce((lr,qr)=>{const oi=qr.posto||(qr.posto_servico_id?R.get(qr.posto_servico_id):null),Ti=en(qr,oi);if(!Ti||Ti!==Kt.clienteId)return lr;const qi=qr.data_diaria;if(!qi)return lr;const Ms=new Date(qi);if(Number.isNaN(Ms.getTime())||Ms<He||Ms>Et)return lr;const ba=typeof qr.valor_diaria=="number"?qr.valor_diaria:Number(qr.valor_diaria)||0;return lr+ba},0))},[Wt,R,Kt]),Hr=(He,Et,lr)=>{const qr=new Date(Et),oi=new Date(lr);return Number.isNaN(qr.getTime())||Number.isNaN(oi.getTime())?[]:(oi.setHours(23,59,59,999),Wt.filter(Ti=>{const qi=Ti.posto||(Ti.posto_servico_id?R.get(Ti.posto_servico_id):null),Ms=en(Ti,qi);if(!Ms||Ms!==He)return!1;const ba=Ti.data_diaria;if(!ba)return!1;const Da=new Date(ba);return Number.isNaN(Da.getTime())?!1:Da>=qr&&Da<=oi}))},hn=(He,Et,lr,qr)=>{const oi=new Date(Et),Ti=new Date(lr);return Number.isNaN(oi.getTime())||Number.isNaN(Ti.getTime())?[]:(Ti.setHours(23,59,59,999),Wt.filter(qi=>{if(qi.diarista_id!==He)return!1;const Ms=qi.data_diaria;if(!Ms)return!1;const ba=new Date(Ms);if(Number.isNaN(ba.getTime())||ba<oi||ba>Ti)return!1;if(qr){const Da=qi.posto||(qi.posto_servico_id?R.get(qi.posto_servico_id):null);if(en(qi,Da)!==qr)return!1}return!0}))},vn=He=>{const{diaristaId:Et,diaristaNome:lr,start:qr,end:oi,clienteId:Ti,clienteNome:qi,total:Ms}=He;if(!Et||!qr||!oi||Ms===null){$t.error("Preencha diarista e intervalo para exportar.");return}const ba=hn(Et,qr,oi,Ti);if(ba.length===0){$t.info("Nenhuma diaria no intervalo para exportar.");return}const Da=new Set,Hs=new Set,no=new Set;ba.forEach(Sa=>{const Bo=Sa.posto||(Sa.posto_servico_id?R.get(Sa.posto_servico_id):null);Sa.posto_servico&&Da.add(Sa.posto_servico),Bo!=null&&Bo.nome&&Da.add(Bo.nome);const ta=Zn(Bo),kd=typeof Sa.cliente_id=="number"&&H.get(Sa.cliente_id)||(ta==null?void 0:ta.clienteNome)||"";kd&&Hs.add(kd),ta!=null&&ta.clienteNome&&Hs.add(ta.clienteNome),no.add(qo[Sa.status]||Sa.status)});const Ea=qi?`Valor a receber de ${lr} entre os dias ${qr} e ${oi} do cliente ${qi}`:`Valor a receber de ${lr} entre os dias ${qr} e ${oi}`,Fi=D.get(Et||""),Va=Pi([{Titulo:Ea,Diarista:lr||"-","CPF diarista":(Fi==null?void 0:Fi.cpf)||"-",Banco:(Fi==null?void 0:Fi.banco)||"-",Agencia:(Fi==null?void 0:Fi.agencia)||"-","Numero da conta":(Fi==null?void 0:Fi.numero_conta)||"-","Tipo de conta":(Fi==null?void 0:Fi.tipo_conta)||"-",Pix:(Fi==null?void 0:Fi.pix)||"-","Data inicial":qr,"Data final":oi,Status:Array.from(no).join(", ")||"-",Cliente:qi||Array.from(Hs).join(", ")||"-",Posto:Array.from(Da).join(", ")||"-","Valor total (R$)":Ms??0}]),Jo=Go.json_to_sheet(Va),nc=Go.book_new();Go.book_append_sheet(nc,Jo,"Total");const Es=qi?`total-temp-diarista-cliente-${In(e)}-${Date.now()}.xlsx`:`total-temp-diarista-${In(e)}-${Date.now()}.xlsx`;rv(nc,Es),$t.success("Planilha de total gerada.")},ai=()=>{var Ea;const{clienteId:He,startDate:Et,endDate:lr}=Kt;if(!He||!Et||!lr||Ot===null){$t.error("Preencha cliente e intervalo para exportar.");return}const qr=Hr(He,Et,lr);if(qr.length===0){$t.info("Nenhuma diaria no intervalo para exportar.");return}const oi=new Set,Ti=new Set;qr.forEach(Fi=>{const Va=Fi.diarista||D.get(Fi.diarista_id||"");Va!=null&&Va.cpf&&oi.add(Va.cpf),Ti.add(qo[Fi.status]||Fi.status)});const qi=((Ea=fi.find(Fi=>Fi.id===He))==null?void 0:Ea.nome)||"",Ms=`Valor a receber do cliente ${qi||"(sem nome)"} entre ${Et} e ${lr}`,ba=Pi([{Titulo:Ms,Cliente:qi||"-","CPFs diaristas":Array.from(oi).join(", ")||"-","Status das diarias":Array.from(Ti).join(", ")||"-","Data inicial":Et,"Data final":lr,"Valor total (R$)":Ot??0}]),Da=Go.json_to_sheet(ba),Hs=Go.book_new();Go.book_append_sheet(Hs,Da,"Total Cliente");const no=`total-temp-cliente-${In(e)}-${Date.now()}.xlsx`;rv(Hs,no),$t.success("Planilha do cliente gerada.")},At=()=>gt({diaristaId:"",motivo:"",clienteId:"",startDate:"",endDate:"",criadoPorId:"",statusResponsavelId:""}),$i=V.useMemo(()=>{for(const He of Wt){const Et=vH(He.data_diaria);if(Et)return Et}return null},[Wt]),ha=Pr.length===0&&Wt.length>0&&!!$i,pt=He=>{const Et=In(He);return Et===In(Vr.cancelada)||Et===In(Vr.reprovada)},lt=He=>{const Et=In(He);return Et===In(Vr.confirmada)?"Deseja confirmar esta diaria?":Et===In(Vr.aprovada)?"Deseja aprovar esta diaria?":Et===In(Vr.lancada)?"Deseja lancar esta diaria para pagamento?":Et===In(Vr.aprovadaPagamento)?"Deseja aprovar esta diaria para pagamento?":Et===In(Vr.reprovada)?"Deseja reprovar esta diaria?":Et===In(Vr.cancelada)?"Deseja cancelar esta diaria?":`Deseja alterar o status para ${qo[He]||He}?`},Er=He=>typeof window>"u"?!0:window.confirm(lt(He)),Jr=async He=>{if(!(typeof window<"u"&&!window.confirm("Deseja excluir esta diaria cancelada?"))){qe(He);try{const{error:Et}=await tt.from("diarias_temporarias").delete().eq("id",He);if(Et)throw Et;$t.success("Diaria excluida."),await E()}catch(Et){$t.error(Et.message||"Erro ao excluir a diaria.")}finally{qe(null)}}},Ae=async(He,Et,lr={})=>{Y(He);try{const{error:qr}=await tt.from("diarias_temporarias").update({status:Et,...lr}).eq("id",He);if(qr)throw qr;$t.success(`Status atualizado para ${qo[Et]}.`),await E()}catch(qr){$t.error(qr.message||"Erro ao atualizar status da diaria.")}finally{Y(null)}},ue=(He,Et)=>{be({open:!0,diariaId:He,targetStatus:Et}),Oe("")},Z=()=>{be({open:!1,diariaId:null,targetStatus:null}),Oe("")},K=async()=>{if(!pe.diariaId||!pe.targetStatus)return;if(!ke.trim()){$t.error("Informe o motivo.");return}const He=ke.trim(),lr=In(pe.targetStatus)===In(Vr.reprovada)?{motivo_reprovacao:He,motivo_cancelamento:null}:{motivo_cancelamento:He,motivo_reprovacao:null};Er(pe.targetStatus)&&(await Ae(pe.diariaId,pe.targetStatus,lr),J(qr=>({...qr,[pe.diariaId]:""})),Z())},ie=(He,Et)=>{if(pt(Et))ue(He,Et);else{if(!Er(Et))return;Ae(He,Et)}},ce=(He,Et)=>{const lr=xH[In(Et)];return lr?c.jsx(Nt,{size:"sm",variant:"outline",disabled:U===He,onClick:qr=>{qr.stopPropagation(),ie(He,lr.nextStatus)},children:lr.label}):null},_e=async He=>{const Et=z[He];if(!Et){$t.error("Selecione um status para atualizar.");return}if(pt(Et)){ue(He,Et);return}Er(Et)&&(await Ae(He,Et),J(lr=>({...lr,[He]:""})))},Ie=He=>{ye(He),me(!0)},Re=()=>{me(!1),ye(null)},Ce=(le==null?void 0:le.colaborador)||(le!=null&&le.colaborador_ausente?M.get(le.colaborador_ausente):null),ze=(le==null?void 0:le.posto)||(le!=null&&le.posto_servico_id?R.get(le.posto_servico_id):null),et=(le==null?void 0:le.diarista)||D.get((le==null?void 0:le.diarista_id)||""),ut=Zn(ze),Ut=typeof(le==null?void 0:le.cliente_id)=="number"&&H.get(le.cliente_id)||(ut==null?void 0:ut.clienteNome)||"-",Xt=(le==null?void 0:le.colaborador_ausente_nome)||(Ce==null?void 0:Ce.nome_completo)||"-",Qt=((wa=le==null?void 0:le.colaborador_falecido)==null?void 0:wa.trim())||"-",ur=((ro=le==null?void 0:le.colaborador_demitido_nome)==null?void 0:ro.trim())||"",Yr=((Ko=le==null?void 0:le.posto_servico)==null?void 0:Ko.trim())||(ze==null?void 0:ze.nome)||"-",Xr=ft(le==null?void 0:le.motivo_vago),Rn=Rt(le==null?void 0:le.motivo_vago),Zi=(le==null?void 0:le.licenca_nojo)===!0,Rs=(le==null?void 0:le.novo_posto)===!0,gs=Nn(le==null?void 0:le.criado_por),is=Nn(le==null?void 0:le.confirmada_por),yi=Nn(le==null?void 0:le.aprovada_por),Un=Nn(le==null?void 0:le.lancada_por),ls=Nn(le==null?void 0:le.aprovado_para_pgto_por),Ts=Nn(le==null?void 0:le.paga_por),Di=le?Zr(le):{id:null,label:""},cs=Di.id?Nn(Di.id):"";return c.jsxs(Wa,{children:[c.jsxs("div",{className:"space-y-6 p-4 md:p-6",children:[c.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-sm text-muted-foreground uppercase tracking-wide",children:"Diarias temporarias"}),c.jsx("h1",{className:"text-3xl font-bold",children:t}),c.jsx("p",{className:"text-sm text-muted-foreground",children:r})]}),c.jsx(xr,{type:"month",value:f,onChange:He=>m(He.target.value),className:"w-auto"})]}),ha&&$i&&c.jsx($r,{className:"shadow-lg",children:c.jsxs(_n,{className:"flex items-center justify-between py-4",children:[c.jsx("p",{className:"text-sm text-muted-foreground",children:"Existem diarias neste status fora do mes selecionado."}),c.jsx(Nt,{variant:"outline",size:"sm",className:"bg-red-600 text-white hover:bg-red-700",onClick:()=>m($i),children:"Ver mes com registros"})]})}),c.jsxs($r,{className:"shadow-lg",children:[c.jsxs(Xn,{className:"flex flex-row items-center justify-between",children:[c.jsxs("div",{children:[c.jsx(ti,{className:"text-lg",children:qo[e]}),c.jsxs(Gs,{children:["Periodo selecionado: ",f]})]}),c.jsxs("div",{className:"flex items-center gap-3",children:[Nr&&c.jsxs("div",{className:"flex items-center gap-2 rounded-md border border-amber-200 bg-amber-50 px-3 py-1 text-amber-800",children:[c.jsx(kee,{className:"h-4 w-4"}),c.jsxs("span",{className:"text-sm font-medium",children:[Sr," ",Sr===1?"diaria":"diarias"," ",Kr]})]}),c.jsxs(Oi,{variant:_H[e]||"outline",children:[Wt.length," diaria(s)"]})]})]}),c.jsxs(_n,{className:"space-y-4",children:[c.jsxs("div",{className:"flex flex-col gap-3",children:[c.jsxs("div",{className:"grid gap-3 sm:grid-cols-1 md:grid-cols-2 xl:grid-cols-4",children:[c.jsxs("div",{className:"space-y-1",children:[c.jsx(Dt,{htmlFor:`filtro-temp-diarista-${e}`,children:"Diarista"}),c.jsxs(Lr,{value:Qe.diaristaId||Se,onValueChange:He=>gt(Et=>({...Et,diaristaId:He===Se?"":He})),children:[c.jsx(Or,{id:`filtro-temp-diarista-${e}`,children:c.jsx(zr,{placeholder:"Todos os diaristas"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:Se,children:"Todos os diaristas"}),fs.map(He=>c.jsx(yt,{value:He.id,children:He.nome},He.id))]})]})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsx(Dt,{htmlFor:`filtro-temp-motivo-${e}`,children:"Motivo"}),c.jsxs(Lr,{value:Qe.motivo||Se,onValueChange:He=>gt(Et=>({...Et,motivo:He===Se?"":He})),children:[c.jsx(Or,{id:`filtro-temp-motivo-${e}`,children:c.jsx(zr,{placeholder:"Todos os motivos"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:Se,children:"Todos os motivos"}),ms.map(He=>c.jsx(yt,{value:He,children:He},He))]})]})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsx(Dt,{htmlFor:`filtro-temp-cliente-${e}`,children:"Cliente"}),c.jsxs(Lr,{value:Qe.clienteId||Se,onValueChange:He=>gt(Et=>({...Et,clienteId:He===Se?"":He})),children:[c.jsx(Or,{id:`filtro-temp-cliente-${e}`,children:c.jsx(zr,{placeholder:"Todos os clientes"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:Se,children:"Todos os clientes"}),fi.map(He=>c.jsx(yt,{value:He.id,children:He.nome},He.id))]})]})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsx(Dt,{htmlFor:`filtro-temp-criado-por-${e}`,children:"Criado por"}),c.jsxs(Lr,{value:Qe.criadoPorId||Se,onValueChange:He=>gt(Et=>({...Et,criadoPorId:He===Se?"":He})),children:[c.jsx(Or,{id:`filtro-temp-criado-por-${e}`,children:c.jsx(zr,{placeholder:"Todos os criadores"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:Se,children:"Todos os criadores"}),hr.map(He=>c.jsx(yt,{value:He.id,children:He.nome},He.id))]})]})]}),Wr&&c.jsxs("div",{className:"space-y-1",children:[c.jsx(Dt,{htmlFor:`filtro-temp-responsavel-${e}`,children:nn}),c.jsxs(Lr,{value:Qe.statusResponsavelId||Se,onValueChange:He=>gt(Et=>({...Et,statusResponsavelId:He===Se?"":He})),children:[c.jsx(Or,{id:`filtro-temp-responsavel-${e}`,children:c.jsx(zr,{placeholder:`Todos os ${nn.toLowerCase()}`})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:Se,children:`Todos os ${nn.toLowerCase()}`}),An.map(He=>c.jsx(yt,{value:He.id,children:He.nome},He.id))]})]})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsx(Dt,{htmlFor:`filtro-temp-data-inicio-${e}`,children:"Data inicial"}),c.jsx(xr,{id:`filtro-temp-data-inicio-${e}`,type:"date",value:Qe.startDate,onChange:He=>gt(Et=>({...Et,startDate:He.target.value}))})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsx(Dt,{htmlFor:`filtro-temp-data-fim-${e}`,children:"Data final"}),c.jsx(xr,{id:`filtro-temp-data-fim-${e}`,type:"date",value:Qe.endDate,onChange:He=>gt(Et=>({...Et,endDate:He.target.value}))})]})]}),Ds&&c.jsx("div",{className:"flex justify-end",children:c.jsx(Nt,{variant:"ghost",size:"sm",onClick:At,children:"Limpar filtros"})})]}),c.jsxs("div",{className:"flex justify-end gap-2",children:[c.jsx(Nt,{variant:"outline",onClick:ii,children:"Exportar XLSX"}),c.jsx(Nt,{variant:"outline",onClick:()=>he(!0),children:"Filtragem Avanada"})]}),c.jsx("div",{className:"overflow-x-auto",children:$n.length===0?c.jsx("p",{className:"text-sm text-muted-foreground text-center py-6",children:Ds?"Nenhuma diaria encontrada com os filtros selecionados.":s||"Nenhuma diaria para este status no periodo selecionado."}):c.jsxs(nu,{children:[c.jsx(iu,{children:c.jsxs(Ws,{children:[c.jsx(gn,{children:"Data"}),c.jsx(gn,{className:"hidden md:table-cell",children:"Colaborador"}),c.jsx(gn,{className:"hidden md:table-cell",children:"Posto"}),c.jsx(gn,{className:"hidden md:table-cell",children:"Cliente"}),c.jsx(gn,{className:"hidden md:table-cell",children:"CPF diarista"}),c.jsx(gn,{children:"Diarista"}),c.jsx(gn,{className:"hidden md:table-cell",children:"Motivo"}),c.jsx(gn,{className:"hidden md:table-cell",children:"Valor"}),c.jsx(gn,{className:"hidden md:table-cell",children:"Pix do diarista"}),c.jsx(gn,{className:"hidden md:table-cell text-right",children:"Acoes"})]})}),c.jsx(su,{children:$n.map(He=>{var Va,Jo,nc;const Et=He.colaborador||(He.colaborador_ausente?M.get(He.colaborador_ausente):null),lr=He.posto||(He.posto_servico_id?R.get(He.posto_servico_id):null),qr=He.diarista||D.get(He.diarista_id||""),oi=He.colaborador_ausente_nome||(Et==null?void 0:Et.nome_completo)||"-",Ti=((Va=He.colaborador_falecido)==null?void 0:Va.trim())||"",qi=He.licenca_nojo===!0,Ms=He.novo_posto===!0,ba=ft(He.motivo_vago),Da=Rt(He.motivo_vago);let Hs=oi;ba?He.demissao?Hs=((Jo=He.colaborador_demitido_nome)==null?void 0:Jo.trim())||"":qi?Hs=Ti||"-":Hs=Ms?"Novo posto":"-":Da&&(Hs=Ti||"-");const no=((nc=He.posto_servico)==null?void 0:nc.trim())||(lr==null?void 0:lr.nome)||"-",Ea=Zt(He,lr)||"-",Fi=ce(He.id.toString(),He.status);return c.jsxs(Ws,{className:"cursor-pointer transition hover:bg-muted/90",onClick:()=>Ie(He),children:[c.jsx(tn,{children:o_(He.data_diaria)}),c.jsx(tn,{className:"hidden md:table-cell",children:Hs}),c.jsx(tn,{className:"hidden md:table-cell",children:no}),c.jsx(tn,{className:"hidden md:table-cell",children:Ea}),c.jsx(tn,{className:"hidden md:table-cell",children:(qr==null?void 0:qr.cpf)||"-"}),c.jsx(tn,{children:c.jsxs("div",{className:"flex flex-col gap-2",children:[c.jsx("span",{children:(qr==null?void 0:qr.nome_completo)||"-"}),c.jsxs("span",{className:"text-xs text-muted-foreground md:hidden",children:["CPF: ",(qr==null?void 0:qr.cpf)||"-"]}),c.jsxs("div",{className:"md:hidden flex flex-col gap-2 pt-2",onClick:Es=>Es.stopPropagation(),children:[c.jsxs("div",{className:"flex flex-wrap gap-2",children:[e===Vr.confirmada&&c.jsx(Nt,{size:"sm",variant:"destructive",disabled:U===He.id.toString(),onClick:()=>ue(He.id.toString(),Vr.reprovada),children:"Reprovar"}),Gt&&c.jsxs(Nt,{size:"icon",variant:"ghost",className:"text-destructive",disabled:Ee===He.id.toString(),onClick:()=>Jr(He.id.toString()),children:[c.jsx(zo,{className:"h-4 w-4"}),c.jsx("span",{className:"sr-only",children:"Excluir diaria"})]})]}),Fi&&c.jsx("div",{children:Fi}),c.jsxs("div",{className:"flex flex-col gap-2",children:[c.jsxs(Lr,{value:z[He.id.toString()]||"",onValueChange:Es=>J(Sa=>({...Sa,[He.id.toString()]:Es})),children:[c.jsx(Or,{className:"w-full",children:c.jsx(zr,{placeholder:"Alterar status"})}),c.jsx(Fr,{children:Ue.map(Es=>c.jsx(yt,{value:Es,children:qo[Es]},Es))})]}),c.jsx(Nt,{size:"sm",variant:"secondary",disabled:U===He.id.toString()||!z[He.id.toString()]||z[He.id.toString()]===He.status,onClick:()=>_e(He.id.toString()),children:"Aplicar"})]})]})]})}),c.jsx(tn,{className:"hidden md:table-cell",children:He.motivo_vago||"-"}),c.jsx(tn,{className:"hidden md:table-cell",children:wc.format(He.valor_diaria||0)}),c.jsx(tn,{className:"hidden md:table-cell",children:(qr==null?void 0:qr.pix)||"-"}),c.jsx(tn,{className:"hidden md:table-cell",onClick:Es=>Es.stopPropagation(),children:c.jsxs("div",{className:"flex flex-col items-end gap-2",children:[c.jsxs("div",{className:"flex flex-wrap justify-end gap-2",children:[e===Vr.confirmada&&c.jsx(Nt,{size:"sm",variant:"destructive",disabled:U===He.id.toString(),onClick:Es=>{Es.stopPropagation(),ue(He.id.toString(),Vr.reprovada)},children:"Reprovar"}),Gt&&c.jsxs(Nt,{size:"icon",variant:"ghost",className:"text-destructive",disabled:Ee===He.id.toString(),onClick:Es=>{Es.stopPropagation(),Jr(He.id.toString())},children:[c.jsx(zo,{className:"h-4 w-4"}),c.jsx("span",{className:"sr-only",children:"Excluir diaria"})]})]}),Fi&&c.jsx("div",{onClick:Es=>Es.stopPropagation(),children:Fi}),c.jsxs("div",{className:"flex items-center gap-2",onClick:Es=>Es.stopPropagation(),children:[c.jsxs(Lr,{value:z[He.id.toString()]||"",onValueChange:Es=>J(Sa=>({...Sa,[He.id.toString()]:Es})),children:[c.jsx(Or,{className:"w-[220px]",children:c.jsx(zr,{placeholder:"Alterar status"})}),c.jsx(Fr,{children:Ue.map(Es=>c.jsx(yt,{value:Es,children:qo[Es]},Es))})]}),c.jsx(Nt,{size:"sm",variant:"secondary",disabled:U===He.id.toString()||!z[He.id.toString()]||z[He.id.toString()]===He.status,onClick:Es=>{Es.stopPropagation(),_e(He.id.toString())},children:"Aplicar"})]})]})})]},He.id)})})]})})]})]}),I&&c.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Atualizando informacoes..."})]}),c.jsx(Bs,{open:pe.open,onOpenChange:He=>He?null:Z(),children:c.jsxs(Is,{children:[c.jsxs(Ns,{children:[c.jsx(ks,{children:In(pe.targetStatus||"")===zt?"Reprovar diaria":"Cancelar diaria"}),c.jsx(La,{children:"Informe o motivo para esta alteracao de status."})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{htmlFor:"motivo-diaria-temp",children:"Motivo"}),c.jsx(ec,{id:"motivo-diaria-temp",value:ke,onChange:He=>Oe(He.target.value),placeholder:"Descreva o motivo",rows:4})]}),c.jsxs(_d,{children:[c.jsx(Nt,{type:"button",variant:"outline",onClick:Z,children:"Fechar"}),c.jsx(Nt,{type:"button",onClick:K,disabled:!ke.trim()||U===pe.diariaId,children:U===pe.diariaId?"Salvando...":"Confirmar"})]})]})}),c.jsx(Bs,{open:ee,onOpenChange:he,children:c.jsxs(Is,{children:[c.jsxs(Ns,{children:[c.jsx(ks,{children:"Filtragem"}),c.jsx(La,{children:"Consulte totais das diarias neste status. A primeira sessao considera apenas diarista e datas; a segunda inclui o cliente vinculado ao posto de servico."})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"space-y-2 rounded-md border bg-muted/30 p-4",children:[c.jsx("p",{className:"text-sm font-semibold text-muted-foreground",children:"Total por diarista"}),c.jsxs("div",{className:"grid gap-3 sm:grid-cols-1 md:grid-cols-3",children:[c.jsxs("div",{className:"space-y-1",children:[c.jsx(Dt,{htmlFor:`total-diarista-${e}`,children:"Diarista"}),c.jsxs(Lr,{value:Xe.diaristaId||Se,onValueChange:He=>ct(Et=>({...Et,diaristaId:He===Se?"":He})),children:[c.jsx(Or,{id:`total-diarista-${e}`,children:c.jsx(zr,{placeholder:"Selecione o diarista"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:Se,children:"Selecione o diarista"}),fs.map(He=>c.jsx(yt,{value:He.id,children:He.nome},He.id))]})]})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsx(Dt,{htmlFor:`total-inicio-${e}`,children:"Data inicial"}),c.jsx(xr,{id:`total-inicio-${e}`,type:"date",value:Xe.startDate,onChange:He=>ct(Et=>({...Et,startDate:He.target.value}))})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsx(Dt,{htmlFor:`total-fim-${e}`,children:"Data final"}),c.jsx(xr,{id:`total-fim-${e}`,type:"date",value:Xe.endDate,onChange:He=>ct(Et=>({...Et,endDate:He.target.value}))})]})]}),c.jsxs("div",{className:"rounded-md border bg-background/80 p-3",children:[c.jsx("p",{className:"text-sm text-muted-foreground",children:"Total no periodo"}),c.jsx("p",{className:"text-2xl font-semibold",children:Ua!==null?wc.format(Ua):"--"}),c.jsx("div",{className:"pt-2",children:c.jsx(Nt,{variant:"outline",size:"sm",onClick:()=>{var He;return vn({diaristaId:Xe.diaristaId,diaristaNome:((He=D.get(Xe.diaristaId||""))==null?void 0:He.nome_completo)||"",start:Xe.startDate,end:Xe.endDate,total:Ua})},children:"Exportar total"})})]})]}),c.jsxs("div",{className:"space-y-2 rounded-md border bg-muted/30 p-4",children:[c.jsx("p",{className:"text-sm font-semibold text-muted-foreground",children:"Total por diarista e cliente"}),c.jsxs("div",{className:"grid gap-3 sm:grid-cols-1 md:grid-cols-4",children:[c.jsxs("div",{className:"space-y-1",children:[c.jsx(Dt,{htmlFor:`total-diarista-cliente-${e}`,children:"Diarista"}),c.jsxs(Lr,{value:Me.diaristaId||Se,onValueChange:He=>mt(Et=>({...Et,diaristaId:He===Se?"":He})),children:[c.jsx(Or,{id:`total-diarista-cliente-${e}`,children:c.jsx(zr,{placeholder:"Selecione o diarista"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:Se,children:"Selecione o diarista"}),fs.map(He=>c.jsx(yt,{value:He.id,children:He.nome},He.id))]})]})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsx(Dt,{htmlFor:`total-inicio-cliente-${e}`,children:"Data inicial"}),c.jsx(xr,{id:`total-inicio-cliente-${e}`,type:"date",value:Me.startDate,onChange:He=>mt(Et=>({...Et,startDate:He.target.value}))})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsx(Dt,{htmlFor:`total-fim-cliente-${e}`,children:"Data final"}),c.jsx(xr,{id:`total-fim-cliente-${e}`,type:"date",value:Me.endDate,onChange:He=>mt(Et=>({...Et,endDate:He.target.value}))})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsx(Dt,{htmlFor:`total-cliente-${e}`,children:"Cliente (do posto)"}),c.jsxs(Lr,{value:Me.clienteId||Se,onValueChange:He=>mt(Et=>({...Et,clienteId:He===Se?"":He})),children:[c.jsx(Or,{id:`total-cliente-${e}`,children:c.jsx(zr,{placeholder:"Selecione o cliente"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:Se,children:"Selecione o cliente"}),Sn.map(He=>c.jsx(yt,{value:He.id,children:He.nome},He.id))]})]})]})]}),c.jsxs("div",{className:"rounded-md border bg-background/80 p-3",children:[c.jsx("p",{className:"text-sm text-muted-foreground",children:"Total no periodo (com cliente)"}),c.jsx("p",{className:"text-2xl font-semibold",children:Us!==null?wc.format(Us):"--"}),c.jsx("div",{className:"pt-2",children:c.jsx(Nt,{variant:"outline",size:"sm",onClick:()=>{var He,Et;return vn({diaristaId:Me.diaristaId,diaristaNome:((He=D.get(Me.diaristaId||""))==null?void 0:He.nome_completo)||"",start:Me.startDate,end:Me.endDate,clienteId:Me.clienteId,clienteNome:((Et=Sn.find(lr=>lr.id===Me.clienteId))==null?void 0:Et.nome)||"",total:Us})},children:"Exportar total"})})]})]}),c.jsxs("div",{className:"space-y-2 rounded-md border bg-muted/30 p-4",children:[c.jsx("p",{className:"text-sm font-semibold text-muted-foreground",children:"Total por cliente"}),c.jsxs("div",{className:"grid gap-3 sm:grid-cols-1 md:grid-cols-3",children:[c.jsxs("div",{className:"space-y-1",children:[c.jsx(Dt,{htmlFor:`total-cliente-only-${e}`,children:"Cliente"}),c.jsxs(Lr,{value:Kt.clienteId||Se,onValueChange:He=>it(Et=>({...Et,clienteId:He===Se?"":He})),children:[c.jsx(Or,{id:`total-cliente-only-${e}`,children:c.jsx(zr,{placeholder:"Selecione o cliente"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:Se,children:"Selecione o cliente"}),fi.map(He=>c.jsx(yt,{value:He.id,children:He.nome},He.id))]})]})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsx(Dt,{htmlFor:`total-cliente-inicio-${e}`,children:"Data inicial"}),c.jsx(xr,{id:`total-cliente-inicio-${e}`,type:"date",value:Kt.startDate,onChange:He=>it(Et=>({...Et,startDate:He.target.value}))})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsx(Dt,{htmlFor:`total-cliente-fim-${e}`,children:"Data final"}),c.jsx(xr,{id:`total-cliente-fim-${e}`,type:"date",value:Kt.endDate,onChange:He=>it(Et=>({...Et,endDate:He.target.value}))})]})]}),c.jsxs("div",{className:"rounded-md border bg-background/80 p-3",children:[c.jsx("p",{className:"text-sm text-muted-foreground",children:"Total no periodo (cliente)"}),c.jsx("p",{className:"text-2xl font-semibold",children:Ot!==null?wc.format(Ot):"--"}),c.jsx("div",{className:"pt-2",children:c.jsx(Nt,{variant:"outline",size:"sm",onClick:ai,children:"Exportar total"})})]})]})]}),c.jsx(_d,{children:c.jsx(Nt,{type:"button",onClick:()=>he(!1),children:"Fechar"})})]})}),c.jsx(Bs,{open:ne,onOpenChange:He=>He?null:Re(),children:c.jsxs(Is,{className:"max-w-2xl",children:[c.jsxs(Ns,{children:[c.jsx(ks,{children:"Detalhes da diaria"}),c.jsx(La,{children:"Informacoes completas da diaria selecionada."})]}),le&&c.jsxs("div",{className:"space-y-6 text-sm",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Informacoes gerais"}),c.jsxs("div",{className:"mt-2 grid gap-3 md:grid-cols-2",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Data"}),c.jsx("p",{className:"font-medium",children:o_(le.data_diaria)})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Status"}),c.jsx("p",{className:"font-medium",children:qo[le.status]||le.status})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Motivo"}),c.jsx("p",{className:"font-medium",children:le.motivo_vago||"-"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Posto"}),c.jsx("p",{className:"font-medium",children:Yr})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Cliente"}),c.jsx("p",{className:"font-medium",children:Ut})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Valor"}),c.jsx("p",{className:"font-medium",children:wc.format(le.valor_diaria||0)})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Atualizado em"}),c.jsx("p",{className:"font-medium",children:AC(le.updated_at)})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Criado por"}),c.jsx("p",{className:"font-medium",children:gs||"-"})]}),jr&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Confirmada por"}),c.jsx("p",{className:"font-medium",children:is||"-"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Aprovada por"}),c.jsx("p",{className:"font-medium",children:yi||"-"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Lancada por"}),c.jsx("p",{className:"font-medium",children:Un||"-"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Aprovada para pagamento por"}),c.jsx("p",{className:"font-medium",children:ls||"-"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Paga por"}),c.jsx("p",{className:"font-medium",children:Ts||"-"})]})]}),!dt&&Di.id&&c.jsxs("div",{children:[c.jsxs("p",{className:"text-muted-foreground text-xs",children:["Responsavel (",Di.label.toLowerCase(),")"]}),c.jsx("p",{className:"font-medium",children:cs||"-"})]}),Xr&&(le==null?void 0:le.demissao)===!0&&c.jsxs("div",{className:"sm:col-span-2",children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Colaborador demitido"}),c.jsx("p",{className:"font-medium",children:ur||"-"})]}),Xr&&(le==null?void 0:le.demissao)===!1&&Zi&&c.jsxs("div",{className:"sm:col-span-2",children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Colaborador falecido"}),c.jsx("p",{className:"font-medium",children:Qt})]}),Xr&&(le==null?void 0:le.demissao)===!1&&!Zi&&c.jsxs("div",{className:"sm:col-span-2",children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Novo posto?"}),c.jsx("p",{className:"font-medium",children:Rs?"Sim":"No"})]}),le.motivo_reprovacao&&c.jsxs("div",{className:"sm:col-span-2",children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Motivo reprovacao"}),c.jsx("p",{className:"font-medium whitespace-pre-line",children:le.motivo_reprovacao})]}),le.motivo_cancelamento&&c.jsxs("div",{className:"sm:col-span-2",children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Motivo cancelamento"}),c.jsx("p",{className:"font-medium whitespace-pre-line",children:le.motivo_cancelamento})]}),((au=le.observacao)==null?void 0:au.trim())&&c.jsxs("div",{className:"sm:col-span-2",children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Observacao"}),c.jsx("p",{className:"font-medium whitespace-pre-line",children:le.observacao.trim()})]})]})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Horarios"}),c.jsxs("div",{className:"mt-2 grid gap-3 md:grid-cols-4",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Horario inicio"}),c.jsx("p",{className:"font-medium",children:ei(le.horario_inicio)})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Horario fim"}),c.jsx("p",{className:"font-medium",children:ei(le.horario_fim)})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Jornada diaria"}),c.jsx("p",{className:"font-medium",children:Dn(le.jornada_diaria)})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Intervalo"}),c.jsx("p",{className:"font-medium",children:xn(le.intervalo)})]})]})]}),!Xr&&!Rn&&c.jsxs("div",{children:[c.jsx("p",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Colaborador ausente"}),c.jsx("div",{className:"mt-2 grid gap-3 md:grid-cols-2",children:c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Nome"}),c.jsx("p",{className:"font-medium",children:Xt})]})})]}),Rn&&c.jsxs("div",{children:[c.jsx("p",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Colaborador falecido"}),c.jsx("div",{className:"mt-2 grid gap-3 md:grid-cols-2",children:c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Nome"}),c.jsx("p",{className:"font-medium",children:Qt})]})})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Diarista"}),c.jsxs("div",{className:"mt-2 grid gap-3 md:grid-cols-2",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Nome"}),c.jsx("p",{className:"font-medium",children:(et==null?void 0:et.nome_completo)||"-"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"CPF"}),c.jsx("p",{className:"font-medium",children:(et==null?void 0:et.cpf)||"-"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Status"}),c.jsx("p",{className:"font-medium",children:(et==null?void 0:et.status)||"-"})]})]})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Dados bancarios"}),c.jsxs("div",{className:"mt-2 grid gap-3 md:grid-cols-2",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Banco"}),c.jsx("p",{className:"font-medium",children:(et==null?void 0:et.banco)||"-"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Agencia"}),c.jsx("p",{className:"font-medium",children:(et==null?void 0:et.agencia)||"-"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Numero da conta"}),c.jsx("p",{className:"font-medium",children:(et==null?void 0:et.numero_conta)||"-"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Tipo de conta"}),c.jsx("p",{className:"font-medium",children:(et==null?void 0:et.tipo_conta)||"-"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground text-xs",children:"Chave Pix"}),c.jsx("p",{className:"font-medium break-all",children:(et==null?void 0:et.pix)||"-"})]})]})]})]}),c.jsx(_d,{children:c.jsx(Nt,{type:"button",onClick:Re,children:"Fechar"})})]})})]})},Xbe=Rm(Dm[0]),Ybe=Rm(Dm[1]),Kbe=Rm(Dm[2]),Jbe=Rm(Dm[3]),Qbe=Rm(Dm[4]),e2e=Rm(Dm[5]),t2e=Rm(Dm[6]),r2e=Rm(Dm[7]);function n2e(){Tm();const[e,t]=V.useState(NA),[r,s]=V.useState({postoDiaVagoId:"",diaristaId:"",valor:""});V.useState({diaVagoId:"",colaboradorId:""});const[u,f]=V.useState(!1);V.useState(!1);const[m,i]=V.useState([]),{availableDiasVagos:S,diaristas:E,filteredDiarias:I,refetchDiarias:D,refetchDiasVagos:M,loadingDiarias:R,postoDiaVagoMap:H}=wH(e),F=V.useMemo(()=>{const pe=E.filter(be=>be.status?be.status.toLowerCase()==="ativo":!0);return pe.length>0?pe:E},[E]),U=In(Vr.cancelada),Y=In(Vr.reprovada),z=In(Vr.paga),{clienteReceberTotals:J,clienteRecebidosTotals:ne}=V.useMemo(()=>{const pe=new Map,be=new Map;return I.forEach(ke=>{var mt,Kt,it,ee;const Oe=In(ke.status),Ee=H.get(ke.posto_dia_vago_id)??ke.posto_dia_vago??null,qe=(Kt=(mt=Ee==null?void 0:Ee.posto)==null?void 0:mt.unidade)==null?void 0:Kt.contrato,Qe=(qe==null?void 0:qe.cliente_id)??"",gt=((it=qe==null?void 0:qe.clientes)==null?void 0:it.nome_fantasia)||((ee=qe==null?void 0:qe.clientes)==null?void 0:ee.razao_social)||"Cliente no informado",Xe=Qe||gt,ct=typeof ke.valor=="number"?ke.valor:Number(ke.valor)||0;if(Oe===z){const he=be.get(Xe);be.set(Xe,{nome:gt,total:((he==null?void 0:he.total)||0)+ct});return}if(Oe===U||Oe===Y)return;const Me=pe.get(Xe);pe.set(Xe,{nome:gt,total:((Me==null?void 0:Me.total)||0)+ct})}),{clienteReceberTotals:Array.from(pe.values()).sort((ke,Oe)=>ke.nome.localeCompare(Oe.nome)),clienteRecebidosTotals:Array.from(be.values()).sort((ke,Oe)=>ke.nome.localeCompare(Oe.nome))}},[I,U,z,Y,H]),me=pe=>{var Oe;const be=S.find(Ee=>Ee.id===pe),ke=(Oe=be==null?void 0:be.posto)==null?void 0:Oe.valor_diaria;s(Ee=>({...Ee,postoDiaVagoId:pe,valor:ke!=null?ke.toString():""}))},le=async()=>{const{data:pe,error:be}=await tt.from("colaboradores").select("id, nome_completo, cargo").is("posto_servico_id",null).or("status_colaborador.eq.ativo,status.eq.ativo").order("nome_completo");if(be){$t.error("Erro ao carregar colaboradores de reserva.");return}i(pe||[])};V.useEffect(()=>{le()},[]);const ye=async pe=>{if(pe.preventDefault(),!r.postoDiaVagoId||!r.diaristaId||!r.valor){$t.error("Selecione o dia vago e diarista.");return}f(!0);try{const be=Number(r.valor);if(Number.isNaN(be)||be<=0){$t.error("Valor da diria invlido."),f(!1);return}const ke=H.get(r.postoDiaVagoId),Oe=ke==null?void 0:ke.data;if(Oe&&I.some(Qe=>{if(Qe.diarista_id!==r.diaristaId)return!1;const gt=H.get(Qe.posto_dia_vago_id);return(gt==null?void 0:gt.data)===Oe})){$t.error("O diarista j possui uma diria cadastrada para esta data."),f(!1);return}const{error:Ee}=await tt.from("diarias").insert({posto_dia_vago_id:r.postoDiaVagoId,diarista_id:r.diaristaId,valor:be});if(Ee)throw Ee;$t.success("Diria registrada com sucesso."),s({postoDiaVagoId:"",diaristaId:"",valor:""}),await Promise.all([D(),M()])}catch(be){const ke=typeof(be==null?void 0:be.message)=="string"?be.message:"";ke.includes("O diarista j possui uma diria cadastrada para esta data")?$t.error("O diarista j possui uma diria cadastrada para esta data."):$t.error(ke||"Erro ao registrar diria.")}finally{f(!1)}};return c.jsx(Wa,{children:c.jsxs("div",{className:"space-y-6 p-4 md:p-6",children:[c.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-sm text-muted-foreground uppercase tracking-wide",children:"Gesto de dirias"}),c.jsx("h1",{className:"text-3xl font-bold",children:"Dirias e pagamento"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Cadastre novas dirias e acesse rapidamente cada etapa do fluxo pelo menu lateral."}),c.jsxs("p",{className:"text-sm font-semibold text-destructive bg-destructive/10 border border-destructive/40 rounded-md px-3 py-2 inline-block",children:["Somente diarias canceladas podem ser deletadas. Filtre pelo ms do dia vago para cadastrar diria ","(boto de filtro no topo da pgina)"]})]}),c.jsx(xr,{type:"month",value:e,onChange:pe=>t(pe.target.value),className:"w-auto"})]}),c.jsxs($r,{className:"shadow-lg",children:[c.jsxs(Xn,{children:[c.jsx(ti,{children:"Registrar diria"}),c.jsx(Gs,{children:'Selecione um dia vago e vincule um diarista. O status inicial ser "Aguardando confirmao".'})]}),c.jsx(_n,{children:c.jsxs("form",{className:"grid gap-4 md:grid-cols-3",onSubmit:ye,children:[c.jsxs("div",{className:"space-y-2 md:col-span-2",children:[c.jsx(Dt,{children:"Dia vago"}),c.jsxs(Lr,{value:r.postoDiaVagoId,onValueChange:me,children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione o dia vago"})}),c.jsx(Fr,{className:"max-h-72 overflow-y-auto",children:S.length===0?c.jsx(yt,{value:"none",disabled:!0,children:"Nenhum dia vago disponvel no perodo"}):S.map(pe=>{var Oe,Ee,qe,Qe,gt,Xe,ct,Me,mt,Kt,it,ee,he,Se;const be=((Qe=(qe=(Ee=(Oe=pe.posto)==null?void 0:Oe.unidade)==null?void 0:Ee.contrato)==null?void 0:qe.clientes)==null?void 0:Qe.nome_fantasia)||((Me=(ct=(Xe=(gt=pe.posto)==null?void 0:gt.unidade)==null?void 0:Xe.contrato)==null?void 0:ct.clientes)==null?void 0:Me.razao_social)||"Cliente no informado",ke=((it=(Kt=(mt=pe.posto)==null?void 0:mt.unidade)==null?void 0:Kt.contrato)==null?void 0:it.negocio)||"Sem contrato";return c.jsxs(yt,{value:pe.id,children:[o_(pe.data)," - ",((ee=pe.posto)==null?void 0:ee.nome)||"Sem posto"," |"," ",((Se=(he=pe.posto)==null?void 0:he.unidade)==null?void 0:Se.nome)||"Sem unidade"," | ",ke," | ",be,pe.motivo?` - Motivo: ${pe.motivo}`:""]},pe.id)})})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Diarista"}),c.jsxs(Lr,{value:r.diaristaId,onValueChange:pe=>s(be=>({...be,diaristaId:pe})),children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione o diarista"})}),c.jsx(Fr,{className:"max-h-72 overflow-y-auto",children:F.length===0?c.jsx(yt,{value:"none",disabled:!0,children:"Nenhum diarista cadastrado"}):F.map(pe=>c.jsxs(yt,{value:pe.id,children:[pe.nome_completo,pe.status&&pe.status.toLowerCase()!=="ativo"?` (${pe.status})`:""]},pe.id))})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Valor"}),c.jsx(xr,{type:"number",min:"0",step:"0.01",placeholder:"0,00",value:r.valor,readOnly:!0}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Valor definido automaticamente conforme o posto selecionado."})]}),c.jsx("div",{className:"md:col-span-3 flex justify-end",children:c.jsx(Nt,{type:"submit",disabled:u||S.length===0,children:u?"Registrando...":"Cadastrar diria"})})]})})]}),c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{children:[c.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Total a receber por cliente"}),c.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 xl:grid-cols-3",children:J.length===0?c.jsx($r,{className:"shadow-lg border border-red-300 bg-red-200",children:c.jsx(_n,{className:"py-6",children:c.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum cliente com dirias a receber no perodo selecionado."})})}):J.map(pe=>c.jsxs($r,{className:"shadow-lg border border-red-300 bg-red-300",children:[c.jsxs(Xn,{className:"pb-3",children:[c.jsxs(ti,{className:"text-lg flex items-center justify-between",children:[c.jsx("span",{children:pe.nome}),c.jsx("span",{className:"text-sm font-normal text-muted-foreground",children:wc.format(pe.total)})]}),c.jsx(Gs,{children:"Soma de dirias no pagas, no canceladas e no reprovadas."})]}),c.jsx(_n,{className:"text-sm text-muted-foreground",children:"Somatrio das dirias do cliente no ms filtrado."})]},pe.nome))})]}),c.jsxs("div",{children:[c.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Valores recebidos (pagas)"}),c.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 xl:grid-cols-3",children:ne.length===0?c.jsx($r,{className:"shadow-lg border border-green-300 bg-green-500",children:c.jsx(_n,{className:"py-6",children:c.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum pagamento encontrado no perodo."})})}):ne.map(pe=>c.jsxs($r,{className:"shadow-lg border border-green-300 bg-green-300",children:[c.jsxs(Xn,{className:"pb-3",children:[c.jsxs(ti,{className:"text-lg flex items-center justify-between",children:[c.jsx("span",{children:pe.nome}),c.jsx("span",{className:"text-sm font-normal text-muted-foreground",children:wc.format(pe.total)})]}),c.jsx(Gs,{children:"Total de dirias com status paga."})]}),c.jsx(_n,{className:"text-sm text-muted-foreground",children:"Somatrio das dirias pagas do cliente no ms filtrado."})]},pe.nome))})]})]}),R&&c.jsx("p",{className:"text-center text-sm text-muted-foreground",children:"Carregando dirias cadastradas..."})]})})}const nD="VAGA EM ABERTO (COBERTURA SALRIO)",iD="LICENA NOJO (FALECIMENTO)",SH=[nD,"LICENA MATERNIDADE","LICENA PATERNIDADE","LICENA CASAMENTO",iD,"AFASTAMENTO INSS","FRIAS","SUSPENSO"],$T=e=>{const t=(e??"").trim();return t?t.toUpperCase():null},q5={dataDiaria:"",horarioInicio:"",horarioFim:"",intervalo:"",colaboradorNome:"",postoServico:"",clienteId:"",valorDiaria:"",diaristaId:"",motivoVago:SH[0],demissao:null,licencaNojo:null,colaboradorDemitidoNome:"",observacao:""},i2e=()=>{const[e,t]=V.useState(NA),[r,s]=V.useState(q5),[u,f]=V.useState(!1),{diaristas:m,clientes:i,clienteMap:S,filteredDiarias:E,refetchDiarias:I,loadingDiarias:D,postoMap:M,diarias:R}=bH(e),H=pe=>{var ke,Oe,Ee,qe,Qe;const be=(ke=pe==null?void 0:pe.unidade)==null?void 0:ke.contrato;return be!=null&&be.cliente_id||(Oe=be==null?void 0:be.clientes)!=null&&Oe.nome_fantasia||(Ee=be==null?void 0:be.clientes)!=null&&Ee.razao_social?{id:be.cliente_id??"",nome:((qe=be.clientes)==null?void 0:qe.nome_fantasia)||((Qe=be.clientes)==null?void 0:Qe.razao_social)||"Cliente nao informado"}:null},F=r.motivoVago.toUpperCase()===nD.toUpperCase(),U=r.motivoVago.toUpperCase()===iD.toUpperCase(),Y=In(Vr.cancelada),z=In(Vr.reprovada),J=In(Vr.paga),{clienteReceberTotals:ne,clienteRecebidosTotals:me}=V.useMemo(()=>{const pe=new Map,be=new Map;return E.forEach(ke=>{var Me;const Oe=In(ke.status),Ee=ke.posto||(ke.posto_servico_id?M.get(ke.posto_servico_id):null),qe=H(Ee),Qe=typeof ke.cliente_id=="number"&&S.get(ke.cliente_id)||(qe==null?void 0:qe.nome)||"";if(!Qe)return;const gt=typeof ke.valor_diaria=="number"?ke.valor_diaria:Number(ke.valor_diaria)||0,Xe=typeof ke.cliente_id=="number"&&ke.cliente_id.toString()||((Me=qe==null?void 0:qe.id)==null?void 0:Me.toString())||Qe;if(Oe===J){const mt=be.get(Xe);be.set(Xe,{nome:Qe,total:((mt==null?void 0:mt.total)||0)+gt});return}if(Oe===Y||Oe===z)return;const ct=pe.get(Xe);pe.set(Xe,{nome:Qe,total:((ct==null?void 0:ct.total)||0)+gt})}),{clienteReceberTotals:Array.from(pe.values()).sort((ke,Oe)=>ke.nome.localeCompare(Oe.nome)),clienteRecebidosTotals:Array.from(be.values()).sort((ke,Oe)=>ke.nome.localeCompare(Oe.nome))}},[E,Y,J,z,M,S]),le=pe=>{s(be=>({...be,colaboradorNome:pe}))},ye=async pe=>{var nt;if(pe.preventDefault(),!r.dataDiaria||!r.horarioInicio||!r.horarioFim){$t.error("Preencha data e horarios da diaria.");return}if(!r.postoServico||!r.valorDiaria||!r.diaristaId||!r.motivoVago){$t.error("Preencha posto, diarista, valor e motivo.");return}if(!r.clienteId){$t.error("Selecione o cliente.");return}const be=Number(r.clienteId);if(!Number.isFinite(be)){$t.error("Cliente invalido.");return}if(!F&&!U&&!r.colaboradorNome){$t.error("Informe o colaborador ausente.");return}if(U&&!r.colaboradorNome){$t.error("Informe o colaborador falecido.");return}if(F){if(r.demissao===null){$t.error("Informe se e demissao.");return}if(r.demissao===!0&&!r.colaboradorDemitidoNome){$t.error("Informe o colaborador demitido.");return}if(r.demissao===!1&&r.licencaNojo===null){$t.error("Informe se e licenca nojo.");return}if(r.demissao===!1&&r.licencaNojo===!0&&!r.colaboradorNome){$t.error("Informe o colaborador falecido.");return}}const ke=Number(r.valorDiaria);if(Number.isNaN(ke)||ke<=0){$t.error("Informe um valor valido para a diaria.");return}const Oe=r.intervalo===""?null:Number(r.intervalo);if(Oe!==null&&(Number.isNaN(Oe)||Oe<0)){$t.error("Informe um intervalo valido (minutos).");return}const Ee=null,qe=$T(r.colaboradorNome),Qe=$T(r.postoServico),gt=be,Xe=F?r.demissao:null,ct=F&&Xe===!1?r.licencaNojo===!0:!1,Me=F&&Xe===!1?r.licencaNojo!==!0:!1,mt=(U||F&&ct)&&qe?qe:null,Kt=F||U?null:qe,it=null,ee=F&&Xe===!0?$T(r.colaboradorDemitidoNome):null,he=$T(r.observacao),Se=(r.motivoVago||"").toUpperCase();if(R.some(dt=>dt.diarista_id===r.diaristaId&&dt.data_diaria===r.dataDiaria)){$t.error("O diarista escolhido ja tem diarias cadastradas para essa data");return}try{const{data:dt,error:Vt}=await tt.auth.getUser();if(Vt)throw Vt;const zt=(nt=dt==null?void 0:dt.user)==null?void 0:nt.id;if(!zt){$t.error("Nao foi possivel identificar o usuario logado.");return}f(!0);const{error:Gt}=await tt.from("diarias_temporarias").insert({data_diaria:r.dataDiaria,horario_inicio:r.horarioInicio,horario_fim:r.horarioFim,intervalo:Oe,colaborador_ausente:Ee,colaborador_ausente_nome:Kt,colaborador_falecido:mt,posto_servico_id:null,posto_servico:Qe,cliente_id:gt,valor_diaria:ke,diarista_id:r.diaristaId,motivo_vago:Se,demissao:Xe,licenca_nojo:ct,novo_posto:Me,colaborador_demitido:it,colaborador_demitido_nome:ee,observacao:he,criado_por:zt});if(Gt)throw Gt;$t.success("Diaria registrada com sucesso."),s(q5),await I()}catch(dt){$t.error(dt.message||"Nao foi possivel registrar a diaria.")}finally{f(!1)}};return c.jsx(Wa,{children:c.jsxs("div",{className:"space-y-6 p-4 md:p-6",children:[c.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-sm text-muted-foreground uppercase tracking-wide",children:"Gestao de diarias"}),c.jsx("h1",{className:"text-3xl font-bold",children:"Diarias (verso 1.0.0)"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Registre diarias em casos de ausencia utilizando colaboradores alocados."})]}),c.jsx(xr,{type:"month",value:e,onChange:pe=>t(pe.target.value),className:"w-auto"})]}),c.jsxs($r,{className:"shadow-lg",children:[c.jsxs(Xn,{children:[c.jsx(ti,{children:"Registrar diaria"}),c.jsx(Gs,{children:"Informe a data, o colaborador ausente, o posto e o diarista responsavel. O status inicial sera aguardando confirmacao."})]}),c.jsx(_n,{children:c.jsxs("form",{className:"grid gap-4 md:grid-cols-2",onSubmit:ye,children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Data da diaria"}),c.jsx(xr,{type:"date",required:!0,value:r.dataDiaria,onChange:pe=>s(be=>({...be,dataDiaria:pe.target.value}))})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Horario de inicio"}),c.jsx(xr,{type:"time",required:!0,value:r.horarioInicio,onChange:pe=>s(be=>({...be,horarioInicio:pe.target.value}))})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Horario de fim"}),c.jsx(xr,{type:"time",required:!0,value:r.horarioFim,onChange:pe=>s(be=>({...be,horarioFim:pe.target.value}))})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Intervalo (minutos)"}),c.jsx(xr,{type:"number",min:"0",step:"1",value:r.intervalo,onChange:pe=>s(be=>({...be,intervalo:pe.target.value})),placeholder:"Em minutos"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Motivo"}),c.jsxs(Lr,{required:!0,value:r.motivoVago,onValueChange:pe=>{const be=pe.toUpperCase()===nD,ke=pe.toUpperCase()===iD.toUpperCase();s(Oe=>({...Oe,motivoVago:pe,colaboradorNome:be||ke?"":Oe.colaboradorNome,demissao:null,licencaNojo:null,colaboradorDemitidoNome:""}))},children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione o motivo"})}),c.jsx(Fr,{className:"max-h-64 overflow-y-auto",children:SH.map(pe=>c.jsx(yt,{value:pe,children:pe},pe))})]})]}),!F&&!U&&c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Colaborador ausente"}),c.jsx(xr,{required:!0,value:r.colaboradorNome,onChange:pe=>le(pe.target.value),placeholder:"Nome do colaborador ausente"})]}),U&&c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Colaborador falecido"}),c.jsx(xr,{required:!0,value:r.colaboradorNome,onChange:pe=>le(pe.target.value),placeholder:"Nome do colaborador falecido"})]}),F&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"E demissao?"}),c.jsxs(Lr,{required:!0,value:r.demissao===null?"":r.demissao?"true":"false",onValueChange:pe=>s(be=>({...be,demissao:pe===""?null:pe==="true",licencaNojo:pe==="true"?null:be.licencaNojo,colaboradorDemitidoNome:pe==="true"?be.colaboradorDemitidoNome:"",colaboradorNome:pe==="true"?"":be.colaboradorNome})),children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione uma opcao"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"true",children:"Sim"}),c.jsx(yt,{value:"false",children:"Nao"})]})]})]}),r.demissao===!1&&c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"E licenca nojo?"}),c.jsxs(Lr,{required:!0,value:r.licencaNojo===null?"":r.licencaNojo?"true":"false",onValueChange:pe=>s(be=>({...be,licencaNojo:pe===""?null:pe==="true",colaboradorNome:pe==="true"?be.colaboradorNome:""})),children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione uma opcao"})}),c.jsxs(Fr,{children:[c.jsx(yt,{value:"true",children:"Sim"}),c.jsx(yt,{value:"false",children:"Nao"})]})]})]}),r.demissao===!1&&r.licencaNojo===!0&&c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Colaborador falecido"}),c.jsx(xr,{required:!0,value:r.colaboradorNome,onChange:pe=>le(pe.target.value),placeholder:"Nome do colaborador falecido"})]}),r.demissao===!0&&c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Colaborador demitido"}),c.jsx(xr,{required:!0,value:r.colaboradorDemitidoNome,onChange:pe=>s(be=>({...be,colaboradorDemitidoNome:pe.target.value})),placeholder:"Nome do colaborador demitido"})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Posto de servico"}),c.jsx(xr,{required:!0,value:r.postoServico,onChange:pe=>s(be=>({...be,postoServico:pe.target.value})),placeholder:"Nome do posto"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Cliente"}),c.jsxs(Lr,{required:!0,value:r.clienteId,onValueChange:pe=>s(be=>({...be,clienteId:pe})),children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione o cliente"})}),c.jsx(Fr,{className:"max-h-72 overflow-y-auto",children:i.map(pe=>c.jsx(yt,{value:pe.id.toString(),children:pe.nome_fantasia||pe.razao_social||pe.id},pe.id))})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Valor da diaria"}),c.jsx(xr,{type:"number",min:"0",step:"0.01",required:!0,value:r.valorDiaria,onChange:pe=>s(be=>({...be,valorDiaria:pe.target.value})),placeholder:"0,00"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Diarista responsavel"}),c.jsxs(Lr,{required:!0,value:r.diaristaId,onValueChange:pe=>s(be=>({...be,diaristaId:pe})),children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione o diarista"})}),c.jsxs(Fr,{className:"max-h-72 overflow-y-auto",children:[m.length===0&&c.jsx(yt,{value:"none",disabled:!0,children:"Nenhum diarista encontrado"}),m.map(pe=>c.jsx(yt,{value:pe.id,children:pe.nome_completo},pe.id))]})]})]}),c.jsxs("div",{className:"space-y-2 md:col-span-2",children:[c.jsx(Dt,{children:"Observacao"}),c.jsx(ec,{value:r.observacao,onChange:pe=>s(be=>({...be,observacao:pe.target.value})),placeholder:"Opcional"})]}),c.jsx("div",{className:"md:col-span-2 flex justify-end",children:c.jsx(Nt,{type:"submit",disabled:u,children:u?"Registrando...":"Cadastrar diaria"})})]})})]}),c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{children:[c.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Total a receber por cliente"}),c.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 xl:grid-cols-3",children:ne.length===0?c.jsx($r,{className:"shadow-lg border border-red-300 bg-red-300",children:c.jsx(_n,{className:"py-6",children:c.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum cliente com diarias a receber no periodo selecionado."})})}):ne.map(pe=>c.jsxs($r,{className:"shadow-lg border border-red-300 bg-red-300",children:[c.jsxs(Xn,{className:"pb-3",children:[c.jsxs(ti,{className:"text-lg flex items-center justify-between",children:[c.jsx("span",{children:pe.nome}),c.jsx("span",{className:"text-sm font-normal text-muted-foreground",children:wc.format(pe.total)})]}),c.jsx(Gs,{children:"Soma de diarias nao pagas, nao canceladas e nao reprovadas."})]}),c.jsx(_n,{className:"text-sm text-muted-foreground",children:"Somatorio das diarias do cliente no mes filtrado."})]},pe.nome))})]}),c.jsxs("div",{children:[c.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Valores recebidos (pagas)"}),c.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 xl:grid-cols-3",children:me.length===0?c.jsx($r,{className:"shadow-lg border border-green-300 bg-green-500",children:c.jsx(_n,{className:"py-6",children:c.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum pagamento encontrado no periodo."})})}):me.map(pe=>c.jsxs($r,{className:"shadow-lg border border-green-300 bg-green-300",children:[c.jsxs(Xn,{className:"pb-3",children:[c.jsxs(ti,{className:"text-lg flex items-center justify-between",children:[c.jsx("span",{children:pe.nome}),c.jsx("span",{className:"text-sm font-normal text-muted-foreground",children:wc.format(pe.total)})]}),c.jsx(Gs,{children:"Total de diarias com status paga."})]}),c.jsx(_n,{className:"text-sm text-muted-foreground",children:"Somatorio das diarias pagas do cliente no mes filtrado."})]},pe.nome))})]})]}),D&&c.jsx("p",{className:"text-center text-sm text-muted-foreground",children:"Carregando diarias temporarias..."})]})})},G5={unidade_id:"",posto_id:"",dia_inspecao:"",responsavel:"",checklistIds:[],checklistItemIds:[]},s2e=["supervisor","gestor_operacoes","admin"],a2e=()=>{const[e,t]=V.useState([]),[r,s]=V.useState([]),[u,f]=V.useState([]),[m,i]=V.useState([]),[S,E]=V.useState([]),[I,D]=V.useState([]),[M,R]=V.useState(G5),[H,F]=V.useState(null),[U,Y]=V.useState(!1),[z,J]=V.useState(!1),ne=V.useCallback((ee,he)=>{const Se=new Set(I.filter(Ue=>Ue.checklist_id!==null&&ee.includes(Ue.checklist_id)).map(Ue=>Ue.id));return he.filter(Ue=>Se.has(Ue))},[I]),me=V.useCallback(async()=>{const{data:ee,error:he}=await tt.from("inspecoes").select(`
        id,
        unidade_id,
        posto_id,
        responsavel,
        dia_inspecao,
        unidade:unidades ( nome ),
        posto:postos_servico ( nome ),
        responsavel_profile:profiles ( full_name ),
        rel_checklists:inspecoes_checklists (
          checklist_id,
          checklist:checklist (
            id,
            nome,
            periodicidade
          )
        ),
        rel_checklist_itens:inspecoes_checklist_itens (
          checklist_item_id,
          checklist_item:checklist_item (
            id,
            descricao,
            checklist_id
          )
        )
      `).order("dia_inspecao",{ascending:!1});if(he){console.error(he),$t.error("Nao foi possivel carregar as inspecoes");return}t(ee??[])},[]),le=V.useCallback(async()=>{const{data:ee,error:he}=await tt.from("unidades").select("id, nome").order("nome");if(he){$t.error("Nao foi possivel carregar as unidades");return}s(ee??[])},[]),ye=V.useCallback(async()=>{const{data:ee,error:he}=await tt.from("postos_servico").select("id, nome, unidade_id").order("nome");if(he){$t.error("Nao foi possivel carregar os postos");return}f(ee??[])},[]),pe=V.useCallback(async()=>{const{data:ee,error:he}=await tt.from("user_roles").select("user_id, role").in("role",s2e);if(he){$t.error("Nao foi possivel carregar os responsaveis");return}const Se=(ee==null?void 0:ee.map(dt=>dt.user_id))??[];if(Se.length===0){i([]);return}const{data:Ue,error:nt}=await tt.from("profiles").select("id, full_name, email").in("id",Se);if(nt){$t.error("Nao foi possivel carregar os perfis");return}i((Ue??[]).map(dt=>({id:dt.id,nome:dt.full_name||dt.email||"Usuario sem nome"})))},[]),be=V.useCallback(async()=>{const{data:ee,error:he}=await tt.from("checklist").select("id, nome, periodicidade").order("nome");if(he){$t.error("Nao foi possivel carregar os checklists");return}E(ee??[])},[]),ke=V.useCallback(async()=>{const{data:ee,error:he}=await tt.from("checklist_item").select("id, descricao, checklist_id, ordem").order("ordem",{ascending:!0});if(he){$t.error("Nao foi possivel carregar os itens de checklist");return}D(ee??[])},[]),Oe=V.useCallback(async()=>{Y(!0);try{await Promise.all([me(),le(),ye(),pe(),be(),ke()])}finally{Y(!1)}},[me,le,ye,pe,be,ke]);V.useEffect(()=>{Oe()},[Oe]);const Ee=V.useMemo(()=>M.unidade_id?u.filter(ee=>ee.unidade_id===M.unidade_id):u,[u,M.unidade_id]),qe=V.useMemo(()=>M.checklistIds.length?I.filter(ee=>ee.checklist_id&&M.checklistIds.includes(ee.checklist_id)):[],[I,M.checklistIds]),Qe=ee=>({diaria:"Diria",semanal:"Semanal",quinzenal:"Quinzenal",mensal:"Mensal",trimestral:"Trimestral",semestral:"Semestral",anual:"Anual"})[ee]??ee,gt=V.useCallback(async(ee,he,Se)=>{if(await tt.from("inspecoes_checklists").delete().eq("inspecao_id",ee),he.length){const Ue=he.map(dt=>({inspecao_id:ee,checklist_id:dt})),{error:nt}=await tt.from("inspecoes_checklists").insert(Ue);if(nt)throw nt}if(await tt.from("inspecoes_checklist_itens").delete().eq("inspecao_id",ee),Se.length){const Ue=Se.map(dt=>({inspecao_id:ee,checklist_item_id:dt})),{error:nt}=await tt.from("inspecoes_checklist_itens").insert(Ue);if(nt)throw nt}},[]),Xe=async ee=>{if(ee.preventDefault(),!M.unidade_id||!M.posto_id||!M.dia_inspecao||!M.responsavel||M.checklistIds.length===0){$t.warning("Preencha todos os campos obrigatorios e selecione ao menos um checklist");return}J(!0);const he={unidade_id:M.unidade_id,posto_id:M.posto_id,responsavel:M.responsavel,dia_inspecao:new Date(M.dia_inspecao).toISOString()},Se=ne(M.checklistIds,M.checklistItemIds);try{let Ue=H;if(H){const{error:nt}=await tt.from("inspecoes").update(he).eq("id",H);if(nt)throw nt}else{const{data:nt,error:dt}=await tt.from("inspecoes").insert(he).select("id").single();if(dt)throw dt;Ue=(nt==null?void 0:nt.id)??null}if(!Ue)throw new Error("Nao foi possivel identificar a inspecao criada/atualizada.");await gt(Ue,M.checklistIds,Se),$t.success("Inspecao salva com sucesso"),mt(),me()}catch(Ue){console.error(Ue),$t.error("Erro ao salvar inspecao")}finally{J(!1)}},ct=ee=>{const he=(ee.rel_checklists??[]).map(Ue=>Ue.checklist_id),Se=(ee.rel_checklist_itens??[]).map(Ue=>Ue.checklist_item_id);F(ee.id),R({unidade_id:ee.unidade_id,posto_id:ee.posto_id,responsavel:ee.responsavel,dia_inspecao:ee.dia_inspecao?new Date(ee.dia_inspecao).toISOString().slice(0,16):"",checklistIds:he,checklistItemIds:ne(he,Se)})},Me=async ee=>{if(!confirm("Deseja realmente excluir esta inspecao?"))return;const{error:he}=await tt.from("inspecoes").delete().eq("id",ee);if(he){$t.error("Erro ao excluir inspecao");return}$t.success("Inspecao excluida"),me()},mt=()=>{R(G5),F(null)},Kt=(ee,he)=>{R(Se=>{const Ue=he?Array.from(new Set([...Se.checklistIds,ee])):Se.checklistIds.filter(dt=>dt!==ee),nt=ne(Ue,Se.checklistItemIds);return{...Se,checklistIds:Ue,checklistItemIds:nt}})},it=(ee,he)=>{R(Se=>{const Ue=he?Array.from(new Set([...Se.checklistItemIds,ee])):Se.checklistItemIds.filter(nt=>nt!==ee);return{...Se,checklistItemIds:Ue}})};return c.jsx(Wa,{children:c.jsxs("div",{className:"p-6 space-y-6",children:[c.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold",children:"Inspecoes"}),c.jsx("p",{className:"text-muted-foreground",children:"Cadastre e acompanhe inspecoes realizadas em campo."})]}),c.jsxs(Nt,{variant:"outline",onClick:Oe,disabled:U,children:[c.jsx(ZC,{className:`h-4 w-4 mr-2 ${U?"animate-spin":""}`}),"Atualizar"]})]}),c.jsxs($r,{children:[c.jsx(Xn,{children:c.jsx(ti,{children:H?"Editar inspecao":"Nova inspecao"})}),c.jsx(_n,{children:c.jsxs("form",{onSubmit:Xe,className:"space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Unidade *"}),c.jsxs(Lr,{value:M.unidade_id,onValueChange:ee=>R(he=>({...he,unidade_id:ee,posto_id:""})),children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione"})}),c.jsxs(Fr,{children:[r.map(ee=>c.jsx(yt,{value:ee.id,children:ee.nome},ee.id)),r.length===0&&c.jsx(yt,{value:"__placeholder",disabled:!0,children:"Nenhuma unidade cadastrada"})]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Posto *"}),c.jsxs(Lr,{value:M.posto_id,onValueChange:ee=>R(he=>({...he,posto_id:ee})),disabled:!M.unidade_id,children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:M.unidade_id?"Selecione":"Escolha uma unidade primeiro"})}),c.jsxs(Fr,{children:[Ee.map(ee=>c.jsx(yt,{value:ee.id,children:ee.nome},ee.id)),Ee.length===0&&c.jsx(yt,{value:"__placeholder",disabled:!0,children:"Nenhum posto encontrado"})]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Responsavel *"}),c.jsxs(Lr,{value:M.responsavel,onValueChange:ee=>R(he=>({...he,responsavel:ee})),children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione"})}),c.jsxs(Fr,{children:[m.map(ee=>c.jsx(yt,{value:ee.id,children:ee.nome},ee.id)),m.length===0&&c.jsx(yt,{value:"__placeholder",disabled:!0,children:"Nenhum responsavel encontrado"})]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Data da inspecao *"}),c.jsx(xr,{type:"datetime-local",value:M.dia_inspecao,onChange:ee=>R(he=>({...he,dia_inspecao:ee.target.value}))})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Checklists vinculados *"}),S.length>0?c.jsx("div",{className:"grid gap-2 md:grid-cols-2",children:S.map(ee=>{const he=M.checklistIds.includes(ee.id);return c.jsxs("label",{className:`flex cursor-pointer items-center justify-between rounded-md border p-3 text-sm ${he?"border-primary bg-primary/5":"border-muted"}`,children:[c.jsxs("span",{className:"flex flex-col",children:[c.jsx("span",{className:"font-medium",children:ee.nome}),c.jsx("span",{className:"text-xs text-muted-foreground",children:Qe(ee.periodicidade)})]}),c.jsx("input",{type:"checkbox",className:"h-4 w-4",checked:he,onChange:Se=>Kt(ee.id,Se.target.checked)})]},ee.id)})}):c.jsx("p",{className:"text-sm text-muted-foreground",children:"Cadastre um checklist antes de criar uma inspecao."})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Itens de checklist (opcional)"}),M.checklistIds.length===0?c.jsx("p",{className:"text-sm text-muted-foreground",children:"Selecione um checklist para visualizar os itens disponiveis."}):c.jsxs("div",{className:"max-h-48 space-y-1 overflow-y-auto rounded-md border p-3",children:[qe.map(ee=>{const he=M.checklistItemIds.includes(ee.id);return c.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[c.jsx("input",{type:"checkbox",className:"h-4 w-4",checked:he,onChange:Se=>it(ee.id,Se.target.checked)}),c.jsx("span",{children:ee.descricao})]},ee.id)}),qe.length===0&&c.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum item cadastrado para os checklists selecionados."})]})]}),c.jsxs("div",{className:"flex gap-2 flex-wrap",children:[c.jsx(Nt,{type:"submit",disabled:z||S.length===0,children:z?"Salvando...":H?"Atualizar inspecao":"Cadastrar inspecao"}),H&&c.jsx(Nt,{type:"button",variant:"secondary",onClick:mt,children:"Cancelar"})]})]})})]}),c.jsxs($r,{children:[c.jsx(Xn,{children:c.jsx(ti,{children:"Historico de inspecoes"})}),c.jsx(_n,{children:c.jsxs(nu,{children:[c.jsx(iu,{children:c.jsxs(Ws,{children:[c.jsx(gn,{children:"ID"}),c.jsx(gn,{children:"Data"}),c.jsx(gn,{children:"Unidade"}),c.jsx(gn,{children:"Posto"}),c.jsx(gn,{children:"Responsavel"}),c.jsx(gn,{children:"Checklists"}),c.jsx(gn,{children:"Itens selecionados"}),c.jsx(gn,{children:"Acoes"})]})}),c.jsxs(su,{children:[e.map(ee=>{var he,Se,Ue,nt,dt;return c.jsxs(Ws,{children:[c.jsx(tn,{children:ee.id}),c.jsx(tn,{children:ee.dia_inspecao?Ii(new Date(ee.dia_inspecao),"dd/MM/yyyy HH:mm",{locale:ia}):"-"}),c.jsx(tn,{children:((he=ee.unidade)==null?void 0:he.nome)??"-"}),c.jsx(tn,{children:((Se=ee.posto)==null?void 0:Se.nome)??"-"}),c.jsx(tn,{children:((Ue=ee.responsavel_profile)==null?void 0:Ue.full_name)??"-"}),c.jsx(tn,{className:"max-w-xs",children:(nt=ee.rel_checklists)!=null&&nt.length?ee.rel_checklists.map(Vt=>{var zt;return(zt=Vt.checklist)==null?void 0:zt.nome}).filter(Boolean).join(", "):"-"}),c.jsx(tn,{children:(dt=ee.rel_checklist_itens)!=null&&dt.length?`${ee.rel_checklist_itens.length} item(ns)`:"-"}),c.jsx(tn,{children:c.jsxs("div",{className:"flex gap-2",children:[c.jsx(Nt,{size:"icon",variant:"ghost",onClick:()=>ct(ee),children:c.jsx(jd,{className:"h-4 w-4"})}),c.jsx(Nt,{size:"icon",variant:"ghost",onClick:()=>Me(ee.id),children:c.jsx(zo,{className:"h-4 w-4"})})]})})]},ee.id)}),!U&&e.length===0&&c.jsx(Ws,{children:c.jsx(tn,{colSpan:8,className:"text-center text-sm text-muted-foreground",children:"Nenhuma inspecao cadastrada"})})]})]})})]})]})})},W5=[{value:"diaria",label:"Diaria"},{value:"semanal",label:"Semanal"},{value:"quinzenal",label:"Quinzenal"},{value:"mensal",label:"Mensal"},{value:"trimestral",label:"Trimestral"},{value:"semestral",label:"Semestral"},{value:"anual",label:"Anual"}],H5={nome:"",periodicidade:"mensal"},o2e=()=>{const[e,t]=V.useState([]),[r,s]=V.useState(""),[u,f]=V.useState(!0),[m,i]=V.useState(!1),[S,E]=V.useState(null),[I,D]=V.useState(H5);V.useEffect(()=>{M()},[]);const M=async()=>{f(!0);try{await R()}catch(ne){console.error("Erro ao carregar dados do checklist:",ne),$t.error("No foi possvel carregar os checklists.")}finally{f(!1)}},R=async()=>{const{data:ne,error:me}=await tt.from("checklist").select(`
        id,
        nome,
        periodicidade,
        created_at,
        updated_at
      `).order("created_at",{ascending:!1});if(me)throw me;t(ne??[])},H=V.useMemo(()=>{const ne=r.trim().toLowerCase();return e.filter(me=>!ne||me.nome.toLowerCase().includes(ne))},[e,r]),F=()=>{D(H5),E(null)},U=async ne=>{if(ne.preventDefault(),!I.nome.trim()){$t.error("Informe o nome do checklist.");return}const me={nome:I.nome.trim(),periodicidade:I.periodicidade},le={nome:I.nome.trim(),periodicidade:I.periodicidade};try{if(i(!0),S){const{error:ye}=await tt.from("checklist").update(le).eq("id",S);if(ye)throw ye;$t.success("Checklist atualizado com sucesso.")}else{const{error:ye}=await tt.from("checklist").insert(me);if(ye)throw ye;$t.success("Checklist criado com sucesso.")}await R(),F()}catch(ye){console.error("Erro ao salvar checklist:",ye),$t.error("No foi possvel salvar o checklist.")}finally{i(!1)}},Y=ne=>{window.confirm(`Deseja editar o checklist "${ne.nome}"?`)&&(E(ne.id),D({nome:ne.nome,periodicidade:ne.periodicidade}))},z=async ne=>{if(window.confirm(`Confirma a excluso do checklist "${ne.nome}"?`))try{const{error:le}=await tt.from("checklist").delete().eq("id",ne.id);if(le)throw le;$t.success("Checklist removido com sucesso."),await R()}catch(le){console.error("Erro ao remover checklist:",le),$t.error("No foi possvel remover o checklist.")}},J=ne=>{var me;return((me=W5.find(le=>le.value===ne))==null?void 0:me.label)??ne};return u?c.jsx("div",{className:"flex min-h-screen items-center justify-center",children:c.jsx("div",{className:"h-10 w-10 animate-spin rounded-full border-b-2 border-primary"})}):c.jsx(Wa,{children:c.jsx("div",{className:"space-y-6 p-4 md:p-6",children:c.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-3",children:[c.jsxs($r,{className:"lg:col-span-1",children:[c.jsxs(Xn,{children:[c.jsx(ti,{children:S?"Editar checklist":"Novo checklist"}),c.jsx(Gs,{children:"Cadastre o checklist conforme o schema atualizado."})]}),c.jsx(_n,{children:c.jsxs("form",{className:"space-y-4",onSubmit:U,children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Nome"}),c.jsx(xr,{required:!0,value:I.nome,onChange:ne=>D(me=>({...me,nome:ne.target.value})),placeholder:"Inspecao semanal, checklist de limpeza..."})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Periodicidade"}),c.jsxs(Lr,{value:I.periodicidade,onValueChange:ne=>D(me=>({...me,periodicidade:ne})),children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione a periodicidade"})}),c.jsx(Fr,{className:"bg-popover",children:W5.map(ne=>c.jsx(yt,{value:ne.value,children:ne.label},ne.value))})]})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx(Nt,{type:"submit",disabled:m,children:m?"Salvando...":S?"Atualizar":"Cadastrar"}),S&&c.jsx(Nt,{type:"button",variant:"secondary",onClick:F,children:"Cancelar"})]})]})})]}),c.jsxs($r,{className:"lg:col-span-2",children:[c.jsxs(Xn,{children:[c.jsx(ti,{children:"Checklists cadastrados"}),c.jsx(Gs,{children:"Filtros rpidos por nome."})]}),c.jsxs(_n,{className:"space-y-4",children:[c.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[c.jsx(xr,{placeholder:"Buscar por nome",value:r,onChange:ne=>s(ne.target.value)}),c.jsxs("div",{className:"text-sm text-muted-foreground",children:[H.length," checklist(s) listado(s)"]})]}),c.jsxs(nu,{children:[c.jsx(iu,{children:c.jsxs(Ws,{children:[c.jsx(gn,{children:"Nome"}),c.jsx(gn,{children:"Periodicidade"}),c.jsx(gn,{children:"Criado em"}),c.jsx(gn,{className:"text-right",children:"Aes"})]})}),c.jsxs(su,{children:[H.map(ne=>c.jsxs(Ws,{children:[c.jsx(tn,{className:"font-medium",children:ne.nome}),c.jsx(tn,{children:c.jsx(Oi,{variant:"secondary",className:"capitalize",children:J(ne.periodicidade)})}),c.jsx(tn,{children:ne.created_at?Ii(new Date(ne.created_at),"dd/MM/yyyy",{locale:ia}):"-"}),c.jsx(tn,{className:"text-right",children:c.jsxs("div",{className:"flex justify-end gap-2",children:[c.jsx(Nt,{size:"icon",variant:"ghost",onClick:()=>Y(ne),children:c.jsx(jd,{className:"h-4 w-4"})}),c.jsx(Nt,{size:"icon",variant:"ghost",onClick:()=>z(ne),children:c.jsx(zo,{className:"h-4 w-4"})})]})})]},ne.id)),H.length===0&&c.jsx(Ws,{children:c.jsx(tn,{colSpan:4,className:"text-center text-muted-foreground",children:"Nenhum checklist cadastrado."})})]})]})]})]})]})})})},Z5=[{value:"diaria",label:"Diria"},{value:"semanal",label:"Semanal"},{value:"quinzenal",label:"Quinzenal"},{value:"mensal",label:"Mensal"},{value:"trimestral",label:"Trimestral"},{value:"semestral",label:"Semestral"},{value:"anual",label:"Anual"}],l2e=()=>{const[e,t]=V.useState([]),[r,s]=V.useState([]),[u,f]=V.useState([]),[m,i]=V.useState(null),[S,E]=V.useState(!1),[I,D]=V.useState(!0),[M,R]=V.useState(""),[H,F]=V.useState("all"),[U,Y]=V.useState({checklist_id:"",descricao:"",periodicidade:"mensal",ordem:0,ativo_id:""});V.useEffect(()=>{z()},[]);const z=async()=>{try{await Promise.all([me(),J(),ne()])}catch(Ee){console.error("Erro ao carregar itens de checklist:",Ee),$t.error("No foi possvel carregar os itens de checklist.")}finally{D(!1)}},J=async()=>{const{data:Ee}=await tt.from("checklist").select("id, nome, periodicidade");s(Ee??[])},ne=async()=>{const{data:Ee}=await tt.from("ativos").select("id, tag_patrimonio, modelo");f(Ee??[])},me=async()=>{const{data:Ee,error:qe}=await tt.from("checklist_item").select(`
        *,
        checklist:checklist ( id, nome, periodicidade ),
        ativo:ativos ( id, tag_patrimonio, modelo )
      `).order("checklist_id",{ascending:!0}).order("ordem",{ascending:!0});if(qe)throw qe;t(Ee??[])},le=()=>{Y({checklist_id:"",descricao:"",periodicidade:"mensal",ordem:0,ativo_id:""}),i(null)},ye=async Ee=>{if(Ee.preventDefault(),!U.checklist_id){$t.error("Selecione um checklist.");return}const qe={checklist_id:U.checklist_id,descricao:U.descricao,periodicidade:U.periodicidade,ordem:U.ordem??0,ativo_id:U.ativo_id||null};try{if(E(!0),m){const{error:Qe}=await tt.from("checklist_item").update(qe).eq("id",m);if(Qe)throw Qe;$t.success("Item atualizado.")}else{const{error:Qe}=await tt.from("checklist_item").insert(qe);if(Qe)throw Qe;$t.success("Item criado.")}await me(),le()}catch(Qe){console.error("Erro ao salvar item:",Qe),$t.error("No foi possvel salvar o item.")}finally{E(!1)}},pe=Ee=>{i(Ee.id),Y({checklist_id:Ee.checklist_id,descricao:Ee.descricao,periodicidade:Ee.periodicidade,ordem:Ee.ordem??0,ativo_id:Ee.ativo_id??""})},be=async Ee=>{try{const{error:qe}=await tt.from("checklist_item").delete().eq("id",Ee);if(qe)throw qe;$t.success("Item removido."),await me()}catch(qe){console.error("Erro ao remover item de checklist:",qe),$t.error("No foi possvel remover o item.")}},ke=V.useMemo(()=>e.filter(Ee=>{var gt,Xe;const qe=Ee.descricao.toLowerCase().includes(M.toLowerCase())||((Xe=(gt=Ee.checklist)==null?void 0:gt.nome)==null?void 0:Xe.toLowerCase().includes(M.toLowerCase())),Qe=H==="all"||Ee.checklist_id===H;return qe&&Qe}),[e,M,H]),Oe=Ee=>{var qe;return((qe=Z5.find(Qe=>Qe.value===Ee))==null?void 0:qe.label)??Ee};return I?c.jsx("div",{className:"min-h-screen flex items-center justify-center",children:c.jsx("div",{className:"h-10 w-10 animate-spin rounded-full border-b-2 border-primary"})}):c.jsx(Wa,{children:c.jsxs("div",{className:"space-y-6 p-4 md:p-6",children:[c.jsxs("div",{className:"flex flex-col gap-3 rounded-lg border bg-card p-4 md:flex-row md:items-center md:justify-between",children:[c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold",children:"Itens de checklist"}),c.jsx("p",{className:"text-muted-foreground",children:"Cadastre e organize os itens executveis de cada checklist."})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsxs(Nt,{variant:"outline",onClick:z,children:[c.jsx(ZC,{className:"h-4 w-4 mr-2"}),"Atualizar"]}),c.jsxs(Nt,{onClick:le,children:[c.jsx(Sc,{className:"h-4 w-4 mr-2"}),"Novo item"]})]})]}),c.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-3",children:[c.jsxs($r,{className:"lg:col-span-1",children:[c.jsxs(Xn,{children:[c.jsx(ti,{children:m?"Editar item":"Novo item"}),c.jsx(Gs,{children:"Descreva o item e vincule ao checklist correto."})]}),c.jsx(_n,{children:c.jsxs("form",{className:"space-y-4",onSubmit:ye,children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Checklist"}),c.jsxs(Lr,{value:U.checklist_id,onValueChange:Ee=>Y(qe=>({...qe,checklist_id:Ee})),children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione o checklist"})}),c.jsx(Fr,{className:"bg-popover",children:r.map(Ee=>c.jsx(yt,{value:Ee.id,children:Ee.nome},Ee.id))})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Descrio"}),c.jsx(xr,{required:!0,value:U.descricao,onChange:Ee=>Y(qe=>({...qe,descricao:Ee.target.value})),placeholder:"Ex.: Verificar iluminao, aferir temperatura..."})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Periodicidade especfica"}),c.jsxs(Lr,{value:U.periodicidade,onValueChange:Ee=>Y(qe=>({...qe,periodicidade:Ee})),children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Periodicidade"})}),c.jsx(Fr,{className:"bg-popover",children:Z5.map(Ee=>c.jsx(yt,{value:Ee.value,children:Ee.label},Ee.value))})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Ordem"}),c.jsx(xr,{type:"number",value:U.ordem,onChange:Ee=>Y(qe=>({...qe,ordem:Number(Ee.target.value)}))})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Ativo relacionado (opcional)"}),c.jsxs(Lr,{value:U.ativo_id,onValueChange:Ee=>Y(qe=>({...qe,ativo_id:Ee})),children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione um ativo"})}),c.jsxs(Fr,{className:"bg-popover",children:[c.jsx(yt,{value:"",children:"Nenhum"}),u.map(Ee=>c.jsxs(yt,{value:Ee.id,children:[Ee.tag_patrimonio," ",Ee.modelo?`- ${Ee.modelo}`:""]},Ee.id))]})]})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx(Nt,{type:"submit",disabled:S,children:S?"Salvando...":m?"Atualizar":"Cadastrar"}),m&&c.jsx(Nt,{type:"button",variant:"secondary",onClick:le,children:"Cancelar"})]})]})})]}),c.jsxs($r,{className:"lg:col-span-2",children:[c.jsxs(Xn,{children:[c.jsx(ti,{children:"Itens cadastrados"}),c.jsx(Gs,{children:"Visualize e filtre os itens por checklist."})]}),c.jsxs(_n,{className:"space-y-4",children:[c.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[c.jsx(xr,{placeholder:"Buscar por descrio ou checklist",value:M,onChange:Ee=>R(Ee.target.value),className:"md:w-1/2"}),c.jsxs(Lr,{value:H,onValueChange:F,children:[c.jsx(Or,{className:"w-[240px]",children:c.jsx(zr,{placeholder:"Filtrar checklist"})}),c.jsxs(Fr,{className:"bg-popover",children:[c.jsx(yt,{value:"all",children:"Todos"}),r.map(Ee=>c.jsx(yt,{value:Ee.id,children:Ee.nome},Ee.id))]})]})]}),c.jsxs(nu,{children:[c.jsx(iu,{children:c.jsxs(Ws,{children:[c.jsx(gn,{children:"Ordem"}),c.jsx(gn,{children:"Descrio"}),c.jsx(gn,{children:"Checklist"}),c.jsx(gn,{children:"Periodicidade"}),c.jsx(gn,{children:"Ativo"}),c.jsx(gn,{className:"text-right",children:"Aes"})]})}),c.jsxs(su,{children:[ke.map(Ee=>{var qe;return c.jsxs(Ws,{children:[c.jsx(tn,{children:Ee.ordem}),c.jsx(tn,{className:"font-medium",children:Ee.descricao}),c.jsx(tn,{children:((qe=Ee.checklist)==null?void 0:qe.nome)||"-"}),c.jsx(tn,{children:c.jsx(Oi,{variant:"outline",className:"capitalize",children:Oe(Ee.periodicidade)})}),c.jsx(tn,{children:Ee.ativo?c.jsxs("div",{className:"flex flex-col",children:[c.jsx("span",{children:Ee.ativo.tag_patrimonio}),c.jsx("span",{className:"text-xs text-muted-foreground",children:Ee.ativo.modelo})]}):c.jsx("span",{className:"text-muted-foreground",children:"-"})}),c.jsx(tn,{className:"text-right",children:c.jsxs("div",{className:"flex justify-end gap-2",children:[c.jsx(Nt,{size:"icon",variant:"ghost",onClick:()=>pe(Ee),children:c.jsx(jd,{className:"h-4 w-4"})}),c.jsx(Nt,{size:"icon",variant:"ghost",onClick:()=>be(Ee.id),children:c.jsx(zo,{className:"h-4 w-4"})})]})})]},Ee.id)}),ke.length===0&&c.jsx(Ws,{children:c.jsx(tn,{colSpan:6,className:"text-center text-muted-foreground",children:"Nenhum item cadastrado."})})]})]})]})]})]})]})})},c2e=3*60,u2e=e=>{const r=e.getTime()+e.getTimezoneOffset()*6e4-c2e*6e4;return new Date(r)},d2e=(e=new Date)=>u2e(e).toISOString(),h2e=e=>d2e(new Date(`${e}T00:00:00`)),bw={ativo:"Ativo",concluido:"Concluido",atrasado:"Atrasado",cancelado:"Cancelado"},X5=Object.entries(bw).filter(([e])=>e!=="concluido"),Y5={checklist_id:"none",data_prevista:"",supervisor_id:"none",status:"ativo",contrato_id:"none",unidade_id:"none"},f2e={ativo:"Deseja reabrir esta execuo como ativa?",concluido:"Deseja marcar esta execuo como concluda?",atrasado:"Deseja marcar esta execuo como atrasada?",cancelado:"Deseja cancelar esta execuo?"},p2e=()=>{const[e,t]=V.useState([]),[r,s]=V.useState([]),[u,f]=V.useState([]),[m,i]=V.useState([]),[S,E]=V.useState([]),[I,D]=V.useState(null),[M,R]=V.useState(!1),[H,F]=V.useState(null),[U,Y]=V.useState(!0),[z,J]=V.useState("all"),[ne,me]=V.useState(Y5);V.useEffect(()=>{le()},[]);const le=async()=>{try{await Promise.all([ye(),ke(),pe(),be(),Oe()])}catch(ee){console.error("Erro ao carregar execucoes:",ee),$t.error("No foi possvel carregar as execues de checklist.")}finally{Y(!1)}},ye=async()=>{const{data:ee,error:he}=await tt.from("checklist").select("id, nome, periodicidade").order("nome");if(he)throw he;s(ee??[])},pe=async()=>{const{data:ee,error:he}=await tt.from("contratos").select("id, negocio, conq_perd").order("negocio");if(he)throw he;i(ee??[])},be=async()=>{const{data:ee,error:he}=await tt.from("unidades").select("id, nome, contrato_id").order("nome");if(he)throw he;E(ee??[])},ke=async()=>{const{data:ee}=await tt.from("user_roles").select("user_id").eq("role","supervisor");let he=tt.from("profiles").select("id, full_name");ee&&ee.length>0&&(he=he.in("id",ee.map(nt=>nt.user_id)));const{data:Se,error:Ue}=await he;if(Ue)throw Ue;f(Se??[])},Oe=async()=>{const{data:ee,error:he}=await tt.from("execucao_checklist").select(`
          id,
          checklist_id,
        data_prevista,
        supervisor_id,
        status,
        contrato_id,
        unidade_id,
        finalizado_em,
        created_at,
        updated_at,
          checklist:checklist ( id, nome, periodicidade ),
          supervisor:profiles ( id, full_name ),
          contrato:contratos ( id, negocio, conq_perd ),
          unidade:unidades ( id, nome, contrato_id )
        `).order("data_prevista",{ascending:!1});if(he)throw he;t(ee??[])},Ee=async ee=>{const{data:he,error:Se}=await tt.from("checklist_item").select("id, checklist_id").eq("checklist_id",ee);if(Se)throw Se;return he??[]},qe=async(ee,he,Se,Ue,nt)=>{const dt=await Ee(he);if(dt.length===0)return;const Vt=dt.map(zt=>({execucao_checklist_id:ee,checklist_item_id:zt.id,data_prevista:Se,status:"ativo",contrato_id:Ue,unidade_id:nt}));await tt.from("execucao_checklist_item").insert(Vt)},Qe=()=>{me(Y5),D(null)},gt=async ee=>{if(ee.preventDefault(),ne.checklist_id==="none"||!ne.data_prevista){$t.error("Selecione um checklist e a data prevista.");return}const he=ne.contrato_id==="none"?null:ne.contrato_id,Se=ne.unidade_id==="none"?null:ne.unidade_id,Ue=h2e(ne.data_prevista),nt={checklist_id:ne.checklist_id,data_prevista:Ue,supervisor_id:ne.supervisor_id==="none"?null:ne.supervisor_id,status:ne.status,contrato_id:he,unidade_id:Se};try{if(R(!0),I){const{error:dt}=await tt.from("execucao_checklist").update(nt).eq("id",I);if(dt)throw dt;$t.success("Execuo atualizada.")}else{const{data:dt,error:Vt}=await tt.from("execucao_checklist").insert(nt).select("id, checklist_id, data_prevista, contrato_id, unidade_id").single();if(Vt)throw Vt;dt&&await qe(dt.id,dt.checklist_id,dt.data_prevista,dt.contrato_id??null,dt.unidade_id??null),$t.success("Execuo criada.")}await Oe(),Qe()}catch(dt){console.error("Erro ao salvar execuo:",dt),$t.error("No foi possvel salvar a execuo.")}finally{R(!1)}},Xe=ee=>{var Se;const he=((Se=ee.checklist)==null?void 0:Se.nome)||"esta execuo";window.confirm(`Deseja editar a execuo do checklist "${he}"?`)&&(D(ee.id),me({checklist_id:ee.checklist_id,data_prevista:m2e(ee.data_prevista),supervisor_id:ee.supervisor_id??"none",status:ee.status,contrato_id:ee.contrato_id??"none",unidade_id:ee.unidade_id??"none"}))},ct=async(ee,he)=>{const Se=f2e[he]??`Deseja alterar o status para ${bw[he]}?`;if(window.confirm(Se))try{const{error:Ue}=await tt.from("execucao_checklist").update({status:he}).eq("id",ee);if(Ue)throw Ue;$t.success("Status atualizado."),await Oe()}catch(Ue){console.error("Erro ao atualizar status:",Ue),$t.error("No foi possvel atualizar o status.")}},Me=async ee=>{var Se;const he=((Se=ee.checklist)==null?void 0:Se.nome)||ee.id;if(window.confirm(`Confirma a excluso da execuo "${he}"?`))try{F(ee.id);const{data:Ue}=await tt.from("execucao_checklist_item").select("id").eq("execucao_checklist_id",ee.id),nt=(Ue||[]).map(Gt=>Gt.id);if(nt.length>0){const{error:Gt}=await tt.from("resposta_execucao_checklist_item").delete().in("execucao_checklist_item_id",nt);if(Gt)throw Gt}const{error:dt}=await tt.from("resposta_execucao_checklist").delete().eq("execucao_checklist_id",ee.id);if(dt)throw dt;const{error:Vt}=await tt.from("execucao_checklist_item").delete().eq("execucao_checklist_id",ee.id);if(Vt)throw Vt;const{error:zt}=await tt.from("execucao_checklist").delete().eq("id",ee.id);if(zt)throw zt;$t.success("Execuo excluda."),await Oe()}catch(Ue){console.error("Erro ao excluir execuo:",Ue),$t.error("No foi possvel excluir a execuo.")}finally{F(null)}},mt=V.useMemo(()=>e.filter(ee=>z==="all"||ee.status===z),[e,z]),Kt=ee=>{switch(ee){case"concluido":return"default";case"atrasado":return"destructive";case"cancelado":return"secondary";default:return"outline"}},it=V.useMemo(()=>ne.contrato_id==="none"?S:S.filter(ee=>ee.contrato_id===ne.contrato_id),[ne.contrato_id,S]);return U?c.jsx("div",{className:"flex min-h-screen items-center justify-center",children:c.jsx("div",{className:"h-10 w-10 animate-spin rounded-full border-b-2 border-primary"})}):c.jsx(Wa,{children:c.jsx("div",{className:"space-y-6 p-4 md:p-6",children:c.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-3",children:[c.jsxs($r,{className:"lg:col-span-1",children:[c.jsxs(Xn,{children:[c.jsx(ti,{children:I?"Editar execuo":"Nova execuo"}),c.jsx(Gs,{children:"Checklist, contrato/unidade, data e supervisor."})]}),c.jsx(_n,{children:c.jsxs("form",{className:"space-y-4",onSubmit:gt,children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Checklist"}),c.jsxs(Lr,{value:ne.checklist_id,onValueChange:ee=>me(he=>({...he,checklist_id:ee})),children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione o checklist"})}),c.jsxs(Fr,{className:"bg-popover",children:[c.jsx(yt,{value:"none",children:"Selecione..."}),r.map(ee=>c.jsx(yt,{value:ee.id,children:ee.nome},ee.id))]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Contrato"}),c.jsxs(Lr,{value:ne.contrato_id,onValueChange:ee=>me(he=>({...he,contrato_id:ee,unidade_id:ee==="none"?"none":he.unidade_id})),children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione o contrato"})}),c.jsxs(Fr,{className:"bg-popover",children:[c.jsx(yt,{value:"none",children:"Sem contrato"}),m.map(ee=>c.jsxs(yt,{value:ee.id,children:[ee.negocio," (",ee.conq_perd,")"]},ee.id))]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Unidade"}),c.jsxs(Lr,{value:ne.unidade_id,onValueChange:ee=>me(he=>({...he,unidade_id:ee})),children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione a unidade"})}),c.jsxs(Fr,{className:"bg-popover",children:[c.jsx(yt,{value:"none",children:"Sem unidade"}),it.map(ee=>c.jsx(yt,{value:ee.id,children:ee.nome},ee.id))]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Data prevista"}),c.jsx(xr,{type:"date",value:ne.data_prevista,onChange:ee=>me(he=>({...he,data_prevista:ee.target.value}))})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Supervisor"}),c.jsxs(Lr,{value:ne.supervisor_id,onValueChange:ee=>me(he=>({...he,supervisor_id:ee})),children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione o supervisor"})}),c.jsxs(Fr,{className:"bg-popover",children:[c.jsx(yt,{value:"none",children:"Sem supervisor"}),u.map(ee=>c.jsx(yt,{value:ee.id,children:ee.full_name||ee.id},ee.id))]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Status"}),c.jsxs(Lr,{value:ne.status,onValueChange:ee=>{ee!=="concluido"&&me(he=>({...he,status:ee}))},disabled:ne.status==="concluido",children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Status"})}),c.jsx(Fr,{className:"bg-popover",children:(ne.status==="concluido"?[...X5,["concluido",bw.concluido]]:X5).map(([ee,he])=>c.jsx(yt,{value:ee,disabled:ee==="concluido",children:he},ee))})]})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx(Nt,{type:"submit",disabled:M,children:M?"Salvando...":I?"Atualizar":"Agendar"}),I&&c.jsx(Nt,{type:"button",variant:"secondary",onClick:Qe,children:"Cancelar"})]})]})})]}),c.jsxs($r,{className:"lg:col-span-2",children:[c.jsxs(Xn,{children:[c.jsx(ti,{children:"Execues cadastradas"}),c.jsx(Gs,{children:"Visualize status e vnculos de contrato/unidade."})]}),c.jsxs(_n,{className:"space-y-4",children:[c.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[c.jsxs(Lr,{value:z,onValueChange:ee=>J(ee),children:[c.jsx(Or,{className:"w-[220px]",children:c.jsx(zr,{placeholder:"Filtrar status"})}),c.jsxs(Fr,{className:"bg-popover",children:[c.jsx(yt,{value:"all",children:"Todos"}),Object.entries(bw).map(([ee,he])=>c.jsx(yt,{value:ee,children:he},ee))]})]}),c.jsxs("div",{className:"text-sm text-muted-foreground",children:[mt.length," execuo(es) encontrada(s)"]})]}),c.jsxs(nu,{children:[c.jsx(iu,{children:c.jsxs(Ws,{children:[c.jsx(gn,{children:"Checklist"}),c.jsx(gn,{children:"Contrato"}),c.jsx(gn,{children:"Unidade"}),c.jsx(gn,{children:"Data prevista"}),c.jsx(gn,{children:"Status"}),c.jsx(gn,{children:"Finalizado em"}),c.jsx(gn,{className:"text-right",children:"Aes"})]})}),c.jsxs(su,{children:[mt.map(ee=>{var he,Se,Ue;return c.jsxs(Ws,{children:[c.jsx(tn,{className:"font-medium",children:((he=ee.checklist)==null?void 0:he.nome)||"-"}),c.jsx(tn,{children:(Se=ee.contrato)!=null&&Se.negocio?c.jsxs("div",{className:"flex flex-col",children:[c.jsx("span",{children:ee.contrato.negocio}),c.jsxs("span",{className:"text-xs text-muted-foreground",children:["Ano: ",ee.contrato.conq_perd]})]}):c.jsx("span",{className:"text-muted-foreground",children:"Sem contrato"})}),c.jsx(tn,{children:(Ue=ee.unidade)!=null&&Ue.nome?c.jsx("div",{className:"flex flex-col",children:c.jsx("span",{children:ee.unidade.nome})}):c.jsx("span",{className:"text-muted-foreground",children:"Sem unidade"})}),c.jsx(tn,{children:ee.data_prevista?Ii(new Date(ee.data_prevista),"dd/MM/yyyy",{locale:ia}):"-"}),c.jsx(tn,{children:c.jsx(Oi,{variant:Kt(ee.status),className:"capitalize",children:bw[ee.status]})}),c.jsx(tn,{children:ee.finalizado_em?Ii(new Date(ee.finalizado_em),"dd/MM/yyyy HH:mm",{locale:ia}):"-"}),c.jsx(tn,{className:"text-right",children:c.jsxs("div",{className:"flex justify-end gap-2",children:[c.jsx(Nt,{size:"icon",variant:"ghost",onClick:()=>Xe(ee),children:c.jsx(s8,{className:"h-4 w-4"})}),c.jsx(Nt,{size:"icon",variant:"ghost",onClick:()=>ct(ee.id,"cancelado"),children:c.jsx(n8,{className:"h-4 w-4"})}),c.jsx(Nt,{size:"icon",variant:"ghost",onClick:()=>ct(ee.id,"atrasado"),children:c.jsx(Lv,{className:"h-4 w-4"})}),ee.status!=="concluido"&&c.jsx(Nt,{size:"icon",variant:"ghost",onClick:()=>Me(ee),disabled:H===ee.id,children:c.jsx(zo,{className:"h-4 w-4"})})]})})]},ee.id)}),mt.length===0&&c.jsx(Ws,{children:c.jsx(tn,{colSpan:7,className:"text-center text-muted-foreground",children:"Nenhuma execuo encontrada."})})]})]})]})]})]})})})},m2e=e=>e?e.includes("T")?e.split("T")[0]:e:"",K5={ativo:"Ativo",concluido:"Concludo",atrasado:"Atrasado",cancelado:"Cancelado"},J5=["ativo","atrasado"],g2e=()=>{var pe,be;const[e,t]=V.useState([]),[r,s]=V.useState(""),[u,f]=V.useState(null),[m,i]=V.useState([]),[S,E]=V.useState({}),[I,D]=V.useState({resposta:"",conforme:!0,observacoes:"",foto:""}),[M,R]=V.useState(!0),[H,F]=V.useState(!1),[U,Y]=V.useState("all");V.useState(null),V.useEffect(()=>{z()},[]),V.useEffect(()=>{r?J(r):(i([]),f(null))},[r]);const z=async()=>{try{const{data:ke,error:Oe}=await tt.from("execucao_checklist").select(`
          *,
          checklist:checklist ( id, nome ),
          supervisor:profiles ( id, full_name )
        `).order("data_prevista",{ascending:!1});if(Oe)throw Oe;t(ke??[])}catch(ke){console.error("Erro ao carregar execues:",ke),$t.error("No foi possvel carregar as execues.")}finally{R(!1)}},J=async ke=>{try{F(!0);const{data:Oe,error:Ee}=await tt.from("execucao_checklist_item").select(`
          *,
          checklist_item:checklist_item ( id, descricao, ordem )
        `).eq("execucao_checklist_id",ke).order("ordem",{foreignTable:"checklist_item",ascending:!0});if(Ee)throw Ee;const qe=(Oe??[]).map(Me=>Me.id);let Qe=[];if(qe.length>0){const{data:Me,error:mt}=await tt.from("resposta_execucao_checklist_item").select("*").in("execucao_checklist_item_id",qe);if(mt)throw mt;Qe=Me}const gt=new Map(Qe.map(Me=>[Me.execucao_checklist_item_id,Me]));i((Oe==null?void 0:Oe.map(Me=>({...Me,resposta:gt.get(Me.id)??null})))??[]),E(Me=>{const mt={...Me};return(Oe||[]).forEach(Kt=>{const it=gt.get(Kt.id);mt[Kt.id]={resposta:(it==null?void 0:it.resposta)??"",conforme:(it==null?void 0:it.conforme)??!0,observacoes:(it==null?void 0:it.observacoes)??"",foto:(it==null?void 0:it.foto)??""}}),mt});const{data:Xe,error:ct}=await tt.from("resposta_execucao_checklist").select("*").eq("execucao_checklist_id",ke).order("registrado_em",{ascending:!1}).limit(1);if(ct)throw ct;f((Xe==null?void 0:Xe[0])??null)}catch(Oe){console.error("Erro ao carregar detalhes da execuo:",Oe),$t.error("No foi possvel carregar os detalhes da execuo selecionada.")}finally{F(!1)}},ne=async ke=>{var qe;if(ke.preventDefault(),!r){$t.error("Selecione uma execuo.");return}if(!I.resposta){$t.error("Descreva a resposta da execuo.");return}const Oe=e.find(Qe=>Qe.id===r),Ee=((qe=Oe==null?void 0:Oe.checklist)==null?void 0:qe.nome)||(Oe==null?void 0:Oe.id)||"execuo selecionada";if(window.confirm(`Deseja registrar a resposta geral para "${Ee}"?`))try{const{error:Qe}=await tt.from("resposta_execucao_checklist").insert({execucao_checklist_id:r,resposta:I.resposta,conforme:I.conforme,observacoes:I.observacoes||null,foto:I.foto||null});if(Qe)throw Qe;$t.success("Resposta registrada."),await J(r)}catch(Qe){console.error("Erro ao registrar resposta:",Qe),$t.error("No foi possvel registrar a resposta.")}},me=V.useMemo(()=>e.filter(ke=>J5.includes(ke.status)).filter(ke=>U==="all"?!0:ke.status===U),[e,U]);V.useEffect(()=>{r&&!me.some(ke=>ke.id===r)&&s("")},[me,r]);const le=me.find(ke=>ke.id===r),ye=ke=>ke==="concluido"?"default":ke==="cancelado"?"secondary":ke==="atrasado"?"destructive":"outline";return M?c.jsx("div",{className:"min-h-screen flex items-center justify-center",children:c.jsx("div",{className:"h-10 w-10 animate-spin rounded-full border-b-2 border-primary"})}):c.jsx(Wa,{children:c.jsxs("div",{className:"space-y-6 p-4 md:p-6",children:[c.jsxs("div",{className:"flex flex-col gap-3 rounded-lg border bg-card p-4 md:flex-row md:items-center md:justify-between",children:[c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold",children:"Respostas de checklist"}),c.jsx("p",{className:"text-muted-foreground",children:"Registre respostas das execues e acompanhe o progresso item a item."})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsxs(Lr,{value:U,onValueChange:ke=>Y(ke),children:[c.jsx(Or,{className:"w-[220px]",children:c.jsx(zr,{placeholder:"Filtrar status"})}),c.jsxs(Fr,{className:"bg-popover",children:[c.jsx(yt,{value:"all",children:"Todas"}),J5.map(ke=>c.jsx(yt,{value:ke,children:K5[ke]},ke))]})]}),c.jsxs(Nt,{variant:"outline",onClick:z,children:[c.jsx(ZC,{className:"h-4 w-4 mr-2"}),"Atualizar"]})]})]}),c.jsxs($r,{children:[c.jsxs(Xn,{children:[c.jsx(ti,{children:"Selecione a execuo"}),c.jsx(Gs,{children:"Escolha uma execuo para responder e ver o progresso."})]}),c.jsxs(_n,{className:"space-y-4",children:[c.jsxs(Lr,{value:r,onValueChange:ke=>s(ke),children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Selecione a execuo"})}),c.jsx(Fr,{className:"bg-popover",children:me.map(ke=>{var Oe;return c.jsxs(yt,{value:ke.id,children:[((Oe=ke.checklist)==null?void 0:Oe.nome)||ke.id," -"," ",ke.data_prevista?Ii(new Date(ke.data_prevista),"dd/MM/yyyy",{locale:ia}):"Sem data"]},ke.id)})})]}),le&&c.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2",children:[c.jsxs($r,{children:[c.jsxs(Xn,{className:"space-y-1",children:[c.jsxs(ti,{className:"flex items-center gap-2",children:[c.jsx(HC,{className:"h-5 w-5"}),((pe=le.checklist)==null?void 0:pe.nome)||"Checklist"]}),c.jsx(Gs,{children:"Dados bsicos da execuo"})]}),c.jsxs(_n,{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"font-medium",children:"Status:"}),c.jsx(Oi,{variant:ye(le.status),className:"capitalize",children:K5[le.status]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"font-medium",children:"Data prevista:"}),c.jsx("span",{children:le.data_prevista?Ii(new Date(le.data_prevista),"dd/MM/yyyy",{locale:ia}):"-"})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"font-medium",children:"Finalizado em:"}),c.jsx("span",{children:le.finalizado_em?Ii(new Date(le.finalizado_em),"dd/MM/yyyy HH:mm",{locale:ia}):"-"})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"font-medium",children:"Supervisor:"}),c.jsx("span",{children:((be=le.supervisor)==null?void 0:be.full_name)||"-"})]}),u&&c.jsxs("div",{className:"rounded-md border bg-muted/30 p-3 space-y-1",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Oi,{variant:u.conforme?"default":"destructive",children:u.conforme?"Conforme":"No conforme"}),c.jsx("span",{className:"text-xs text-muted-foreground",children:u.registrado_em?Ii(new Date(u.registrado_em),"dd/MM/yyyy HH:mm",{locale:ia}):""})]}),c.jsx("p",{className:"text-sm",children:u.resposta}),u.observacoes&&c.jsx("p",{className:"text-xs text-muted-foreground",children:u.observacoes})]})]})]}),c.jsxs($r,{children:[c.jsxs(Xn,{children:[c.jsx(ti,{children:"Resposta da execuo"}),c.jsx(Gs,{children:"Registro geral (opcional) da execuo."})]}),c.jsx(_n,{children:c.jsxs("form",{className:"space-y-3",onSubmit:ne,children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Resposta"}),c.jsx(ec,{value:I.resposta,onChange:ke=>D(Oe=>({...Oe,resposta:ke.target.value})),placeholder:"Resumo da execuo, observaes gerais..."})]}),c.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Conformidade"}),c.jsxs(Lr,{value:I.conforme?"true":"false",onValueChange:ke=>D(Oe=>({...Oe,conforme:ke==="true"})),children:[c.jsx(Or,{children:c.jsx(zr,{})}),c.jsxs(Fr,{className:"bg-popover",children:[c.jsx(yt,{value:"true",children:"Conforme"}),c.jsx(yt,{value:"false",children:"No conforme"})]})]})]})}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Observaes"}),c.jsx(ec,{value:I.observacoes,onChange:ke=>D(Oe=>({...Oe,observacoes:ke.target.value}))})]}),c.jsxs(Nt,{type:"submit",disabled:H,children:[c.jsx(a8,{className:"h-4 w-4 mr-2"}),"Registrar resposta"]})]})})]})]})]})]})]})})},_2e={ativo:"Ativo",concluido:"Concludo",atrasado:"Atrasado",cancelado:"Cancelado"},x2e=()=>{const[e,t]=V.useState([]),[r,s]=V.useState([]),[u,f]=V.useState([]),[m,i]=V.useState("all"),[S,E]=V.useState("all"),[I,D]=V.useState(""),[M,R]=V.useState(""),[H,F]=V.useState(!0);V.useEffect(()=>{U()},[]);const U=async()=>{F(!0);try{await Promise.all([Y(),z(),J()])}catch(me){console.error("Erro ao carregar respostas:",me),$t.error("No foi possvel carregar as respostas das execues.")}finally{F(!1)}},Y=async()=>{const{data:me,error:le}=await tt.from("resposta_execucao_checklist").select(`
        id,
        resposta,
        conforme,
        observacoes,
        foto,
        registrado_em,
        execucao:execucao_checklist (
          id,
          checklist_id,
          supervisor_id,
          status,
          data_prevista,
          finalizado_em,
          checklist:checklist ( id, nome ),
          supervisor:profiles ( id, full_name )
        )
      `).order("registrado_em",{ascending:!1});if(le)throw le;t(me??[])},z=async()=>{const{data:me,error:le}=await tt.from("checklist").select("id, nome").order("nome");if(le)throw le;s(me??[])},J=async()=>{const{data:me,error:le}=await tt.from("profiles").select("id, full_name").order("full_name");if(le)throw le;f(me??[])},ne=V.useMemo(()=>{const me=I?new Date(I):null,le=M?new Date(M):null;return e.filter(ye=>{var Ee,qe;const pe=m==="all"||((Ee=ye.execucao)==null?void 0:Ee.supervisor_id)===m,be=S==="all"||((qe=ye.execucao)==null?void 0:qe.checklist_id)===S,ke=ye.registrado_em?new Date(ye.registrado_em):null,Oe=(!me||ke&&ke>=me)&&(!le||ke&&ke<=le);return pe&&be&&Oe})},[e,m,S,I,M]);return H?c.jsx("div",{className:"flex min-h-screen items-center justify-center",children:c.jsx("div",{className:"h-10 w-10 animate-spin rounded-full border-b-2 border-primary"})}):c.jsx(Wa,{children:c.jsxs("div",{className:"space-y-6 p-4 md:p-6",children:[c.jsxs("div",{className:"flex flex-col gap-3 rounded-lg border bg-card p-4 md:flex-row md:items-center md:justify-between",children:[c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold",children:"Respostas das execues"}),c.jsx("p",{className:"text-muted-foreground",children:"Histrico de respostas de execues de checklist com filtros por supervisor, checklist e data."})]}),c.jsxs(Nt,{variant:"outline",onClick:U,children:[c.jsx(ZC,{className:"mr-2 h-4 w-4"}),"Atualizar"]})]}),c.jsxs($r,{children:[c.jsxs(Xn,{children:[c.jsx(ti,{children:"Filtros"}),c.jsx(Gs,{children:"Refine a listagem de respostas."})]}),c.jsxs(_n,{className:"grid grid-cols-1 gap-4 md:grid-cols-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Supervisor"}),c.jsxs(Lr,{value:m,onValueChange:i,children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Supervisor"})}),c.jsxs(Fr,{className:"bg-popover",children:[c.jsx(yt,{value:"all",children:"Todos"}),u.map(me=>c.jsx(yt,{value:me.id,children:me.full_name||me.id},me.id))]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Checklist"}),c.jsxs(Lr,{value:S,onValueChange:E,children:[c.jsx(Or,{children:c.jsx(zr,{placeholder:"Checklist"})}),c.jsxs(Fr,{className:"bg-popover",children:[c.jsx(yt,{value:"all",children:"Todos"}),r.map(me=>c.jsx(yt,{value:me.id,children:me.nome},me.id))]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Data inicial"}),c.jsx(xr,{type:"date",value:I,onChange:me=>D(me.target.value)})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(Dt,{children:"Data final"}),c.jsx(xr,{type:"date",value:M,onChange:me=>R(me.target.value)})]})]})]}),c.jsxs($r,{children:[c.jsxs(Xn,{children:[c.jsx(ti,{children:"Respostas registradas"}),c.jsx(Gs,{children:"Listagem com supervisor, checklist e data."})]}),c.jsxs(_n,{className:"space-y-4",children:[c.jsxs("div",{className:"text-sm text-muted-foreground",children:[ne.length," resposta(s) encontrada(s)"]}),c.jsxs(nu,{children:[c.jsx(iu,{children:c.jsxs(Ws,{children:[c.jsx(gn,{children:"Checklist"}),c.jsx(gn,{children:"Supervisor"}),c.jsx(gn,{children:"Conformidade"}),c.jsx(gn,{children:"Resposta"}),c.jsx(gn,{children:"Registrado em"}),c.jsx(gn,{children:"Observaes"})]})}),c.jsxs(su,{children:[ne.map(me=>{var le,ye,pe,be,ke;return c.jsxs(Ws,{children:[c.jsx(tn,{className:"font-medium",children:((ye=(le=me.execucao)==null?void 0:le.checklist)==null?void 0:ye.nome)||"-"}),c.jsx(tn,{children:((be=(pe=me.execucao)==null?void 0:pe.supervisor)==null?void 0:be.full_name)||"-"}),c.jsxs(tn,{children:[c.jsx(Oi,{variant:me.conforme?"default":"destructive",children:me.conforme?"Conforme":"No conforme"}),c.jsx("div",{className:"text-xs text-muted-foreground",children:_2e[(ke=me.execucao)==null?void 0:ke.status]||"-"})]}),c.jsx(tn,{className:"max-w-xs whitespace-pre-wrap text-sm",children:me.resposta}),c.jsx(tn,{children:me.registrado_em?Ii(new Date(me.registrado_em),"dd/MM/yyyy HH:mm",{locale:ia}):"-"}),c.jsx(tn,{className:"max-w-xs whitespace-pre-wrap text-sm",children:me.observacoes||"-"})]},me.id)}),ne.length===0&&c.jsx(Ws,{children:c.jsx(tn,{colSpan:6,className:"text-center text-muted-foreground",children:"Nenhuma resposta encontrada."})})]})]})]})]})]})})},v2e=()=>{const e=Tf();return V.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",e.pathname)},[e.pathname]),c.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-100",children:c.jsxs("div",{className:"text-center",children:[c.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),c.jsx("p",{className:"mb-4 text-xl text-gray-600",children:"Oops! Page not found"}),c.jsx("a",{href:"/",className:"text-blue-500 underline hover:text-blue-700",children:"Return to Home"})]})})},y2e=new yie,w2e=()=>c.jsx(Eie,{client:y2e,children:c.jsxs(K8,{children:[c.jsx(zte,{}),c.jsx(_re,{}),c.jsx(Dse,{children:c.jsxs(Ese,{children:[c.jsx(ns,{path:"/",element:c.jsx(ole,{})}),c.jsx(ns,{path:"/auth",element:c.jsx(Wce,{})}),c.jsx(ns,{path:"/reset-password",element:c.jsx(NB,{})}),c.jsx(ns,{path:"/redefinir-senha",element:c.jsx(NB,{})}),c.jsx(ns,{path:"/dashboard",element:c.jsx(js,{children:c.jsx(Eue,{})})}),c.jsx(ns,{path:"/dashboard-24h",element:c.jsx(js,{children:c.jsx(jue,{})})}),c.jsx(ns,{path:"/users",element:c.jsx(js,{children:c.jsx(ade,{})})}),c.jsx(ns,{path:"/contratos",element:c.jsx(js,{children:c.jsx(hge,{})})}),c.jsx(ns,{path:"/mesa-operacoes",element:c.jsx(js,{children:c.jsx(gge,{})})}),c.jsx(ns,{path:"/chamados",element:c.jsx(js,{children:c.jsx(Lfe,{})})}),c.jsx(ns,{path:"/ordens-servico",element:c.jsx(js,{children:c.jsx(bge,{})})}),c.jsx(ns,{path:"/colaboradores",element:c.jsx(js,{children:c.jsx(zge,{})})}),c.jsx(ns,{path:"/escalas",element:c.jsx(js,{children:c.jsx(Uge,{})})}),c.jsx(ns,{path:"/ativos",element:c.jsx(js,{children:c.jsx($ge,{})})}),c.jsx(ns,{path:"/estoque",element:c.jsx(js,{children:c.jsx(Gge,{})})}),c.jsx(ns,{path:"/diaristas",element:c.jsx(js,{children:c.jsx(Yge,{})})}),c.jsx(ns,{path:"/diarias/aguardando",element:c.jsx(js,{children:c.jsx(Bbe,{})})}),c.jsx(ns,{path:"/diarias/confirmadas",element:c.jsx(js,{children:c.jsx(Ube,{})})}),c.jsx(ns,{path:"/diarias/aprovadas",element:c.jsx(js,{children:c.jsx(Vbe,{})})}),c.jsx(ns,{path:"/diarias/lancadas",element:c.jsx(js,{children:c.jsx($be,{})})}),c.jsx(ns,{path:"/diarias/reprovadas",element:c.jsx(js,{children:c.jsx(Gbe,{})})}),c.jsx(ns,{path:"/diarias/aprovadas-pagamento",element:c.jsx(js,{children:c.jsx(qbe,{})})}),c.jsx(ns,{path:"/diarias/pagas",element:c.jsx(js,{children:c.jsx(Hbe,{})})}),c.jsx(ns,{path:"/diarias/canceladas",element:c.jsx(js,{children:c.jsx(Wbe,{})})}),c.jsx(ns,{path:"/diarias",element:c.jsx(js,{children:c.jsx(n2e,{})})}),c.jsx(ns,{path:"/diarias2/aguardando",element:c.jsx(js,{children:c.jsx(Xbe,{})})}),c.jsx(ns,{path:"/diarias2/confirmadas",element:c.jsx(js,{children:c.jsx(Ybe,{})})}),c.jsx(ns,{path:"/diarias2/aprovadas",element:c.jsx(js,{children:c.jsx(Kbe,{})})}),c.jsx(ns,{path:"/diarias2/lancadas",element:c.jsx(js,{children:c.jsx(Jbe,{})})}),c.jsx(ns,{path:"/diarias2/aprovadas-pagamento",element:c.jsx(js,{children:c.jsx(Qbe,{})})}),c.jsx(ns,{path:"/diarias2/reprovadas",element:c.jsx(js,{children:c.jsx(e2e,{})})}),c.jsx(ns,{path:"/diarias2/canceladas",element:c.jsx(js,{children:c.jsx(t2e,{})})}),c.jsx(ns,{path:"/diarias2/pagas",element:c.jsx(js,{children:c.jsx(r2e,{})})}),c.jsx(ns,{path:"/diarias2",element:c.jsx(js,{children:c.jsx(i2e,{})})}),c.jsx(ns,{path:"/inspecao",element:c.jsx(js,{children:c.jsx(a2e,{})})}),c.jsx(ns,{path:"/checklists",element:c.jsx(js,{children:c.jsx(o2e,{})})}),c.jsx(ns,{path:"/checklist-itens",element:c.jsx(js,{children:c.jsx(l2e,{})})}),c.jsx(ns,{path:"/checklist-execucoes",element:c.jsx(js,{children:c.jsx(p2e,{})})}),c.jsx(ns,{path:"/checklist-respostas",element:c.jsx(js,{children:c.jsx(g2e,{})})}),c.jsx(ns,{path:"/checklist-respostas-lista",element:c.jsx(js,{children:c.jsx(x2e,{})})}),c.jsx(ns,{path:"*",element:c.jsx(v2e,{})})]})})]})});SV(document.getElementById("root")).render(c.jsx(w2e,{}));
