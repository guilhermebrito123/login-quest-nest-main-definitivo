var uO=e=>{throw TypeError(e)};var qC=(e,t,i)=>t.has(e)||uO("Cannot "+i);var lt=(e,t,i)=>(qC(e,t,"read from private field"),i?i.call(e):t.get(e)),Bn=(e,t,i)=>t.has(e)?uO("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,i),ln=(e,t,i,l)=>(qC(e,t,"write to private field"),l?l.call(e,i):t.set(e,i),i),ji=(e,t,i)=>(qC(e,t,"access private method"),i);var O1=(e,t,i,l)=>({set _(f){ln(e,t,f,i)},get _(){return lt(e,t,l)}});function WF(e,t){for(var i=0;i<t.length;i++){const l=t[i];if(typeof l!="string"&&!Array.isArray(l)){for(const f in l)if(f!=="default"&&!(f in e)){const _=Object.getOwnPropertyDescriptor(l,f);_&&Object.defineProperty(e,f,_.get?_:{enumerable:!0,get:()=>l[f]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))l(f);new MutationObserver(f=>{for(const _ of f)if(_.type==="childList")for(const x of _.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&l(x)}).observe(document,{childList:!0,subtree:!0});function i(f){const _={};return f.integrity&&(_.integrity=f.integrity),f.referrerPolicy&&(_.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?_.credentials="include":f.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function l(f){if(f.ep)return;f.ep=!0;const _=i(f);fetch(f.href,_)}})();var lW=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function rk(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function cW(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var i=function l(){return this instanceof l?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(e).forEach(function(l){var f=Object.getOwnPropertyDescriptor(e,l);Object.defineProperty(i,l,f.get?f:{enumerable:!0,get:function(){return e[l]}})}),i}var ZF={exports:{}},HT={},XF={exports:{}},$i={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wb=Symbol.for("react.element"),uW=Symbol.for("react.portal"),dW=Symbol.for("react.fragment"),hW=Symbol.for("react.strict_mode"),fW=Symbol.for("react.profiler"),pW=Symbol.for("react.provider"),mW=Symbol.for("react.context"),gW=Symbol.for("react.forward_ref"),_W=Symbol.for("react.suspense"),yW=Symbol.for("react.memo"),vW=Symbol.for("react.lazy"),dO=Symbol.iterator;function xW(e){return e===null||typeof e!="object"?null:(e=dO&&e[dO]||e["@@iterator"],typeof e=="function"?e:null)}var KF={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},YF=Object.assign,JF={};function Ly(e,t,i){this.props=e,this.context=t,this.refs=JF,this.updater=i||KF}Ly.prototype.isReactComponent={};Ly.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Ly.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function QF(){}QF.prototype=Ly.prototype;function nk(e,t,i){this.props=e,this.context=t,this.refs=JF,this.updater=i||KF}var ik=nk.prototype=new QF;ik.constructor=nk;YF(ik,Ly.prototype);ik.isPureReactComponent=!0;var hO=Array.isArray,e3=Object.prototype.hasOwnProperty,sk={current:null},t3={key:!0,ref:!0,__self:!0,__source:!0};function r3(e,t,i){var l,f={},_=null,x=null;if(t!=null)for(l in t.ref!==void 0&&(x=t.ref),t.key!==void 0&&(_=""+t.key),t)e3.call(t,l)&&!t3.hasOwnProperty(l)&&(f[l]=t[l]);var o=arguments.length-2;if(o===1)f.children=i;else if(1<o){for(var A=Array(o),I=0;I<o;I++)A[I]=arguments[I+2];f.children=A}if(e&&e.defaultProps)for(l in o=e.defaultProps,o)f[l]===void 0&&(f[l]=o[l]);return{$$typeof:wb,type:e,key:_,ref:x,props:f,_owner:sk.current}}function bW(e,t){return{$$typeof:wb,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function ok(e){return typeof e=="object"&&e!==null&&e.$$typeof===wb}function wW(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(i){return t[i]})}var fO=/\/+/g;function GC(e,t){return typeof e=="object"&&e!==null&&e.key!=null?wW(""+e.key):t.toString(36)}function SS(e,t,i,l,f){var _=typeof e;(_==="undefined"||_==="boolean")&&(e=null);var x=!1;if(e===null)x=!0;else switch(_){case"string":case"number":x=!0;break;case"object":switch(e.$$typeof){case wb:case uW:x=!0}}if(x)return x=e,f=f(x),e=l===""?"."+GC(x,0):l,hO(f)?(i="",e!=null&&(i=e.replace(fO,"$&/")+"/"),SS(f,t,i,"",function(I){return I})):f!=null&&(ok(f)&&(f=bW(f,i+(!f.key||x&&x.key===f.key?"":(""+f.key).replace(fO,"$&/")+"/")+e)),t.push(f)),1;if(x=0,l=l===""?".":l+":",hO(e))for(var o=0;o<e.length;o++){_=e[o];var A=l+GC(_,o);x+=SS(_,t,i,A,f)}else if(A=xW(e),typeof A=="function")for(e=A.call(e),o=0;!(_=e.next()).done;)_=_.value,A=l+GC(_,o++),x+=SS(_,t,i,A,f);else if(_==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return x}function L1(e,t,i){if(e==null)return e;var l=[],f=0;return SS(e,l,"","",function(_){return t.call(i,_,f++)}),l}function SW(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(i){(e._status===0||e._status===-1)&&(e._status=1,e._result=i)},function(i){(e._status===0||e._status===-1)&&(e._status=2,e._result=i)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var el={current:null},TS={transition:null},TW={ReactCurrentDispatcher:el,ReactCurrentBatchConfig:TS,ReactCurrentOwner:sk};function n3(){throw Error("act(...) is not supported in production builds of React.")}$i.Children={map:L1,forEach:function(e,t,i){L1(e,function(){t.apply(this,arguments)},i)},count:function(e){var t=0;return L1(e,function(){t++}),t},toArray:function(e){return L1(e,function(t){return t})||[]},only:function(e){if(!ok(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};$i.Component=Ly;$i.Fragment=dW;$i.Profiler=fW;$i.PureComponent=nk;$i.StrictMode=hW;$i.Suspense=_W;$i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=TW;$i.act=n3;$i.cloneElement=function(e,t,i){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var l=YF({},e.props),f=e.key,_=e.ref,x=e._owner;if(t!=null){if(t.ref!==void 0&&(_=t.ref,x=sk.current),t.key!==void 0&&(f=""+t.key),e.type&&e.type.defaultProps)var o=e.type.defaultProps;for(A in t)e3.call(t,A)&&!t3.hasOwnProperty(A)&&(l[A]=t[A]===void 0&&o!==void 0?o[A]:t[A])}var A=arguments.length-2;if(A===1)l.children=i;else if(1<A){o=Array(A);for(var I=0;I<A;I++)o[I]=arguments[I+2];l.children=o}return{$$typeof:wb,type:e.type,key:f,ref:_,props:l,_owner:x}};$i.createContext=function(e){return e={$$typeof:mW,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:pW,_context:e},e.Consumer=e};$i.createElement=r3;$i.createFactory=function(e){var t=r3.bind(null,e);return t.type=e,t};$i.createRef=function(){return{current:null}};$i.forwardRef=function(e){return{$$typeof:gW,render:e}};$i.isValidElement=ok;$i.lazy=function(e){return{$$typeof:vW,_payload:{_status:-1,_result:e},_init:SW}};$i.memo=function(e,t){return{$$typeof:yW,type:e,compare:t===void 0?null:t}};$i.startTransition=function(e){var t=TS.transition;TS.transition={};try{e()}finally{TS.transition=t}};$i.unstable_act=n3;$i.useCallback=function(e,t){return el.current.useCallback(e,t)};$i.useContext=function(e){return el.current.useContext(e)};$i.useDebugValue=function(){};$i.useDeferredValue=function(e){return el.current.useDeferredValue(e)};$i.useEffect=function(e,t){return el.current.useEffect(e,t)};$i.useId=function(){return el.current.useId()};$i.useImperativeHandle=function(e,t,i){return el.current.useImperativeHandle(e,t,i)};$i.useInsertionEffect=function(e,t){return el.current.useInsertionEffect(e,t)};$i.useLayoutEffect=function(e,t){return el.current.useLayoutEffect(e,t)};$i.useMemo=function(e,t){return el.current.useMemo(e,t)};$i.useReducer=function(e,t,i){return el.current.useReducer(e,t,i)};$i.useRef=function(e){return el.current.useRef(e)};$i.useState=function(e){return el.current.useState(e)};$i.useSyncExternalStore=function(e,t,i){return el.current.useSyncExternalStore(e,t,i)};$i.useTransition=function(){return el.current.useTransition()};$i.version="18.3.1";XF.exports=$i;var F=XF.exports;const ar=rk(F),ak=WF({__proto__:null,default:ar},[F]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var EW=F,CW=Symbol.for("react.element"),AW=Symbol.for("react.fragment"),jW=Object.prototype.hasOwnProperty,IW=EW.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,kW={key:!0,ref:!0,__self:!0,__source:!0};function i3(e,t,i){var l,f={},_=null,x=null;i!==void 0&&(_=""+i),t.key!==void 0&&(_=""+t.key),t.ref!==void 0&&(x=t.ref);for(l in t)jW.call(t,l)&&!kW.hasOwnProperty(l)&&(f[l]=t[l]);if(e&&e.defaultProps)for(l in t=e.defaultProps,t)f[l]===void 0&&(f[l]=t[l]);return{$$typeof:CW,type:e,key:_,ref:x,props:f,_owner:IW.current}}HT.Fragment=AW;HT.jsx=i3;HT.jsxs=i3;ZF.exports=HT;var d=ZF.exports,s3={exports:{}},Kl={},o3={exports:{}},a3={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(Ne,De){var Tt=Ne.length;Ne.push(De);e:for(;0<Tt;){var Pt=Tt-1>>>1,fe=Ne[Pt];if(0<f(fe,De))Ne[Pt]=De,Ne[Tt]=fe,Tt=Pt;else break e}}function i(Ne){return Ne.length===0?null:Ne[0]}function l(Ne){if(Ne.length===0)return null;var De=Ne[0],Tt=Ne.pop();if(Tt!==De){Ne[0]=Tt;e:for(var Pt=0,fe=Ne.length,Le=fe>>>1;Pt<Le;){var vt=2*(Pt+1)-1,Wt=Ne[vt],Ft=vt+1,Ut=Ne[Ft];if(0>f(Wt,Tt))Ft<fe&&0>f(Ut,Wt)?(Ne[Pt]=Ut,Ne[Ft]=Tt,Pt=Ft):(Ne[Pt]=Wt,Ne[vt]=Tt,Pt=vt);else if(Ft<fe&&0>f(Ut,Tt))Ne[Pt]=Ut,Ne[Ft]=Tt,Pt=Ft;else break e}}return De}function f(Ne,De){var Tt=Ne.sortIndex-De.sortIndex;return Tt!==0?Tt:Ne.id-De.id}if(typeof performance=="object"&&typeof performance.now=="function"){var _=performance;e.unstable_now=function(){return _.now()}}else{var x=Date,o=x.now();e.unstable_now=function(){return x.now()-o}}var A=[],I=[],N=1,U=null,$=3,V=!1,Y=!1,q=!1,Z=typeof setTimeout=="function"?setTimeout:null,Q=typeof clearTimeout=="function"?clearTimeout:null,H=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function K(Ne){for(var De=i(I);De!==null;){if(De.callback===null)l(I);else if(De.startTime<=Ne)l(I),De.sortIndex=De.expirationTime,t(A,De);else break;De=i(I)}}function ne(Ne){if(q=!1,K(Ne),!Y)if(i(A)!==null)Y=!0,Ke(le);else{var De=i(I);De!==null&&st(ne,De.startTime-Ne)}}function le(Ne,De){Y=!1,q&&(q=!1,Q(Ze),Ze=-1),V=!0;var Tt=$;try{for(K(De),U=i(A);U!==null&&(!(U.expirationTime>De)||Ne&&!Te());){var Pt=U.callback;if(typeof Pt=="function"){U.callback=null,$=U.priorityLevel;var fe=Pt(U.expirationTime<=De);De=e.unstable_now(),typeof fe=="function"?U.callback=fe:U===i(A)&&l(A),K(De)}else l(A);U=i(A)}if(U!==null)var Le=!0;else{var vt=i(I);vt!==null&&st(ne,vt.startTime-De),Le=!1}return Le}finally{U=null,$=Tt,V=!1}}var pe=!1,Ae=null,Ze=-1,Xe=5,Je=-1;function Te(){return!(e.unstable_now()-Je<Xe)}function xe(){if(Ae!==null){var Ne=e.unstable_now();Je=Ne;var De=!0;try{De=Ae(!0,Ne)}finally{De?Be():(pe=!1,Ae=null)}}else pe=!1}var Be;if(typeof H=="function")Be=function(){H(xe)};else if(typeof MessageChannel<"u"){var dt=new MessageChannel,qt=dt.port2;dt.port1.onmessage=xe,Be=function(){qt.postMessage(null)}}else Be=function(){Z(xe,0)};function Ke(Ne){Ae=Ne,pe||(pe=!0,Be())}function st(Ne,De){Ze=Z(function(){Ne(e.unstable_now())},De)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(Ne){Ne.callback=null},e.unstable_continueExecution=function(){Y||V||(Y=!0,Ke(le))},e.unstable_forceFrameRate=function(Ne){0>Ne||125<Ne?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Xe=0<Ne?Math.floor(1e3/Ne):5},e.unstable_getCurrentPriorityLevel=function(){return $},e.unstable_getFirstCallbackNode=function(){return i(A)},e.unstable_next=function(Ne){switch($){case 1:case 2:case 3:var De=3;break;default:De=$}var Tt=$;$=De;try{return Ne()}finally{$=Tt}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(Ne,De){switch(Ne){case 1:case 2:case 3:case 4:case 5:break;default:Ne=3}var Tt=$;$=Ne;try{return De()}finally{$=Tt}},e.unstable_scheduleCallback=function(Ne,De,Tt){var Pt=e.unstable_now();switch(typeof Tt=="object"&&Tt!==null?(Tt=Tt.delay,Tt=typeof Tt=="number"&&0<Tt?Pt+Tt:Pt):Tt=Pt,Ne){case 1:var fe=-1;break;case 2:fe=250;break;case 5:fe=1073741823;break;case 4:fe=1e4;break;default:fe=5e3}return fe=Tt+fe,Ne={id:N++,callback:De,priorityLevel:Ne,startTime:Tt,expirationTime:fe,sortIndex:-1},Tt>Pt?(Ne.sortIndex=Tt,t(I,Ne),i(A)===null&&Ne===i(I)&&(q?(Q(Ze),Ze=-1):q=!0,st(ne,Tt-Pt))):(Ne.sortIndex=fe,t(A,Ne),Y||V||(Y=!0,Ke(le))),Ne},e.unstable_shouldYield=Te,e.unstable_wrapCallback=function(Ne){var De=$;return function(){var Tt=$;$=De;try{return Ne.apply(this,arguments)}finally{$=Tt}}}})(a3);o3.exports=a3;var PW=o3.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var RW=F,Hl=PW;function Er(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var l3=new Set,V0={};function $m(e,t){yy(e,t),yy(e+"Capture",t)}function yy(e,t){for(V0[e]=t,e=0;e<t.length;e++)l3.add(t[e])}var Xd=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),rj=Object.prototype.hasOwnProperty,MW=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,pO={},mO={};function NW(e){return rj.call(mO,e)?!0:rj.call(pO,e)?!1:MW.test(e)?mO[e]=!0:(pO[e]=!0,!1)}function DW(e,t,i,l){if(i!==null&&i.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return l?!1:i!==null?!i.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function OW(e,t,i,l){if(t===null||typeof t>"u"||DW(e,t,i,l))return!0;if(l)return!1;if(i!==null)switch(i.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function tl(e,t,i,l,f,_,x){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=l,this.attributeNamespace=f,this.mustUseProperty=i,this.propertyName=e,this.type=t,this.sanitizeURL=_,this.removeEmptyString=x}var da={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){da[e]=new tl(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];da[t]=new tl(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){da[e]=new tl(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){da[e]=new tl(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){da[e]=new tl(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){da[e]=new tl(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){da[e]=new tl(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){da[e]=new tl(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){da[e]=new tl(e,5,!1,e.toLowerCase(),null,!1,!1)});var lk=/[\-:]([a-z])/g;function ck(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(lk,ck);da[t]=new tl(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(lk,ck);da[t]=new tl(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(lk,ck);da[t]=new tl(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){da[e]=new tl(e,1,!1,e.toLowerCase(),null,!1,!1)});da.xlinkHref=new tl("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){da[e]=new tl(e,1,!1,e.toLowerCase(),null,!0,!0)});function uk(e,t,i,l){var f=da.hasOwnProperty(t)?da[t]:null;(f!==null?f.type!==0:l||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(OW(t,i,f,l)&&(i=null),l||f===null?NW(t)&&(i===null?e.removeAttribute(t):e.setAttribute(t,""+i)):f.mustUseProperty?e[f.propertyName]=i===null?f.type===3?!1:"":i:(t=f.attributeName,l=f.attributeNamespace,i===null?e.removeAttribute(t):(f=f.type,i=f===3||f===4&&i===!0?"":""+i,l?e.setAttributeNS(l,t,i):e.setAttribute(t,i))))}var th=RW.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,z1=Symbol.for("react.element"),N_=Symbol.for("react.portal"),D_=Symbol.for("react.fragment"),dk=Symbol.for("react.strict_mode"),nj=Symbol.for("react.profiler"),c3=Symbol.for("react.provider"),u3=Symbol.for("react.context"),hk=Symbol.for("react.forward_ref"),ij=Symbol.for("react.suspense"),sj=Symbol.for("react.suspense_list"),fk=Symbol.for("react.memo"),rf=Symbol.for("react.lazy"),d3=Symbol.for("react.offscreen"),gO=Symbol.iterator;function n0(e){return e===null||typeof e!="object"?null:(e=gO&&e[gO]||e["@@iterator"],typeof e=="function"?e:null)}var uo=Object.assign,HC;function g0(e){if(HC===void 0)try{throw Error()}catch(i){var t=i.stack.trim().match(/\n( *(at )?)/);HC=t&&t[1]||""}return`
`+HC+e}var WC=!1;function ZC(e,t){if(!e||WC)return"";WC=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(I){var l=I}Reflect.construct(e,[],t)}else{try{t.call()}catch(I){l=I}e.call(t.prototype)}else{try{throw Error()}catch(I){l=I}e()}}catch(I){if(I&&l&&typeof I.stack=="string"){for(var f=I.stack.split(`
`),_=l.stack.split(`
`),x=f.length-1,o=_.length-1;1<=x&&0<=o&&f[x]!==_[o];)o--;for(;1<=x&&0<=o;x--,o--)if(f[x]!==_[o]){if(x!==1||o!==1)do if(x--,o--,0>o||f[x]!==_[o]){var A=`
`+f[x].replace(" at new "," at ");return e.displayName&&A.includes("<anonymous>")&&(A=A.replace("<anonymous>",e.displayName)),A}while(1<=x&&0<=o);break}}}finally{WC=!1,Error.prepareStackTrace=i}return(e=e?e.displayName||e.name:"")?g0(e):""}function LW(e){switch(e.tag){case 5:return g0(e.type);case 16:return g0("Lazy");case 13:return g0("Suspense");case 19:return g0("SuspenseList");case 0:case 2:case 15:return e=ZC(e.type,!1),e;case 11:return e=ZC(e.type.render,!1),e;case 1:return e=ZC(e.type,!0),e;default:return""}}function oj(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case D_:return"Fragment";case N_:return"Portal";case nj:return"Profiler";case dk:return"StrictMode";case ij:return"Suspense";case sj:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case u3:return(e.displayName||"Context")+".Consumer";case c3:return(e._context.displayName||"Context")+".Provider";case hk:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case fk:return t=e.displayName||null,t!==null?t:oj(e.type)||"Memo";case rf:t=e._payload,e=e._init;try{return oj(e(t))}catch{}}return null}function zW(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return oj(t);case 8:return t===dk?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Nf(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function h3(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function FW(e){var t=h3(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),l=""+e[t];if(!e.hasOwnProperty(t)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var f=i.get,_=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return f.call(this)},set:function(x){l=""+x,_.call(this,x)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return l},setValue:function(x){l=""+x},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function F1(e){e._valueTracker||(e._valueTracker=FW(e))}function f3(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),l="";return e&&(l=h3(e)?e.checked?"true":"false":e.value),e=l,e!==i?(t.setValue(e),!0):!1}function WS(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function aj(e,t){var i=t.checked;return uo({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:i??e._wrapperState.initialChecked})}function _O(e,t){var i=t.defaultValue==null?"":t.defaultValue,l=t.checked!=null?t.checked:t.defaultChecked;i=Nf(t.value!=null?t.value:i),e._wrapperState={initialChecked:l,initialValue:i,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function p3(e,t){t=t.checked,t!=null&&uk(e,"checked",t,!1)}function lj(e,t){p3(e,t);var i=Nf(t.value),l=t.type;if(i!=null)l==="number"?(i===0&&e.value===""||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if(l==="submit"||l==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?cj(e,t.type,i):t.hasOwnProperty("defaultValue")&&cj(e,t.type,Nf(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function yO(e,t,i){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var l=t.type;if(!(l!=="submit"&&l!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,i||t===e.value||(e.value=t),e.defaultValue=t}i=e.name,i!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,i!==""&&(e.name=i)}function cj(e,t,i){(t!=="number"||WS(e.ownerDocument)!==e)&&(i==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}var _0=Array.isArray;function Z_(e,t,i,l){if(e=e.options,t){t={};for(var f=0;f<i.length;f++)t["$"+i[f]]=!0;for(i=0;i<e.length;i++)f=t.hasOwnProperty("$"+e[i].value),e[i].selected!==f&&(e[i].selected=f),f&&l&&(e[i].defaultSelected=!0)}else{for(i=""+Nf(i),t=null,f=0;f<e.length;f++){if(e[f].value===i){e[f].selected=!0,l&&(e[f].defaultSelected=!0);return}t!==null||e[f].disabled||(t=e[f])}t!==null&&(t.selected=!0)}}function uj(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Er(91));return uo({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function vO(e,t){var i=t.value;if(i==null){if(i=t.children,t=t.defaultValue,i!=null){if(t!=null)throw Error(Er(92));if(_0(i)){if(1<i.length)throw Error(Er(93));i=i[0]}t=i}t==null&&(t=""),i=t}e._wrapperState={initialValue:Nf(i)}}function m3(e,t){var i=Nf(t.value),l=Nf(t.defaultValue);i!=null&&(i=""+i,i!==e.value&&(e.value=i),t.defaultValue==null&&e.defaultValue!==i&&(e.defaultValue=i)),l!=null&&(e.defaultValue=""+l)}function xO(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function g3(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function dj(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?g3(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var B1,_3=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,i,l,f){MSApp.execUnsafeLocalFunction(function(){return e(t,i,l,f)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(B1=B1||document.createElement("div"),B1.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=B1.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function U0(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&i.nodeType===3){i.nodeValue=t;return}}e.textContent=t}var E0={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},BW=["Webkit","ms","Moz","O"];Object.keys(E0).forEach(function(e){BW.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),E0[t]=E0[e]})});function y3(e,t,i){return t==null||typeof t=="boolean"||t===""?"":i||typeof t!="number"||t===0||E0.hasOwnProperty(e)&&E0[e]?(""+t).trim():t+"px"}function v3(e,t){e=e.style;for(var i in t)if(t.hasOwnProperty(i)){var l=i.indexOf("--")===0,f=y3(i,t[i],l);i==="float"&&(i="cssFloat"),l?e.setProperty(i,f):e[i]=f}}var VW=uo({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function hj(e,t){if(t){if(VW[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Er(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Er(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Er(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Er(62))}}function fj(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var pj=null;function pk(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var mj=null,X_=null,K_=null;function bO(e){if(e=Eb(e)){if(typeof mj!="function")throw Error(Er(280));var t=e.stateNode;t&&(t=YT(t),mj(e.stateNode,e.type,t))}}function x3(e){X_?K_?K_.push(e):K_=[e]:X_=e}function b3(){if(X_){var e=X_,t=K_;if(K_=X_=null,bO(e),t)for(e=0;e<t.length;e++)bO(t[e])}}function w3(e,t){return e(t)}function S3(){}var XC=!1;function T3(e,t,i){if(XC)return e(t,i);XC=!0;try{return w3(e,t,i)}finally{XC=!1,(X_!==null||K_!==null)&&(S3(),b3())}}function $0(e,t){var i=e.stateNode;if(i===null)return null;var l=YT(i);if(l===null)return null;i=l[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(l=!l.disabled)||(e=e.type,l=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!l;break e;default:e=!1}if(e)return null;if(i&&typeof i!="function")throw Error(Er(231,t,typeof i));return i}var gj=!1;if(Xd)try{var i0={};Object.defineProperty(i0,"passive",{get:function(){gj=!0}}),window.addEventListener("test",i0,i0),window.removeEventListener("test",i0,i0)}catch{gj=!1}function UW(e,t,i,l,f,_,x,o,A){var I=Array.prototype.slice.call(arguments,3);try{t.apply(i,I)}catch(N){this.onError(N)}}var C0=!1,ZS=null,XS=!1,_j=null,$W={onError:function(e){C0=!0,ZS=e}};function qW(e,t,i,l,f,_,x,o,A){C0=!1,ZS=null,UW.apply($W,arguments)}function GW(e,t,i,l,f,_,x,o,A){if(qW.apply(this,arguments),C0){if(C0){var I=ZS;C0=!1,ZS=null}else throw Error(Er(198));XS||(XS=!0,_j=I)}}function qm(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(i=t.return),e=t.return;while(e)}return t.tag===3?i:null}function E3(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function wO(e){if(qm(e)!==e)throw Error(Er(188))}function HW(e){var t=e.alternate;if(!t){if(t=qm(e),t===null)throw Error(Er(188));return t!==e?null:e}for(var i=e,l=t;;){var f=i.return;if(f===null)break;var _=f.alternate;if(_===null){if(l=f.return,l!==null){i=l;continue}break}if(f.child===_.child){for(_=f.child;_;){if(_===i)return wO(f),e;if(_===l)return wO(f),t;_=_.sibling}throw Error(Er(188))}if(i.return!==l.return)i=f,l=_;else{for(var x=!1,o=f.child;o;){if(o===i){x=!0,i=f,l=_;break}if(o===l){x=!0,l=f,i=_;break}o=o.sibling}if(!x){for(o=_.child;o;){if(o===i){x=!0,i=_,l=f;break}if(o===l){x=!0,l=_,i=f;break}o=o.sibling}if(!x)throw Error(Er(189))}}if(i.alternate!==l)throw Error(Er(190))}if(i.tag!==3)throw Error(Er(188));return i.stateNode.current===i?e:t}function C3(e){return e=HW(e),e!==null?A3(e):null}function A3(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=A3(e);if(t!==null)return t;e=e.sibling}return null}var j3=Hl.unstable_scheduleCallback,SO=Hl.unstable_cancelCallback,WW=Hl.unstable_shouldYield,ZW=Hl.unstable_requestPaint,Eo=Hl.unstable_now,XW=Hl.unstable_getCurrentPriorityLevel,mk=Hl.unstable_ImmediatePriority,I3=Hl.unstable_UserBlockingPriority,KS=Hl.unstable_NormalPriority,KW=Hl.unstable_LowPriority,k3=Hl.unstable_IdlePriority,WT=null,Ku=null;function YW(e){if(Ku&&typeof Ku.onCommitFiberRoot=="function")try{Ku.onCommitFiberRoot(WT,e,void 0,(e.current.flags&128)===128)}catch{}}var au=Math.clz32?Math.clz32:e9,JW=Math.log,QW=Math.LN2;function e9(e){return e>>>=0,e===0?32:31-(JW(e)/QW|0)|0}var V1=64,U1=4194304;function y0(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function YS(e,t){var i=e.pendingLanes;if(i===0)return 0;var l=0,f=e.suspendedLanes,_=e.pingedLanes,x=i&268435455;if(x!==0){var o=x&~f;o!==0?l=y0(o):(_&=x,_!==0&&(l=y0(_)))}else x=i&~f,x!==0?l=y0(x):_!==0&&(l=y0(_));if(l===0)return 0;if(t!==0&&t!==l&&!(t&f)&&(f=l&-l,_=t&-t,f>=_||f===16&&(_&4194240)!==0))return t;if(l&4&&(l|=i&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=l;0<t;)i=31-au(t),f=1<<i,l|=e[i],t&=~f;return l}function t9(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function r9(e,t){for(var i=e.suspendedLanes,l=e.pingedLanes,f=e.expirationTimes,_=e.pendingLanes;0<_;){var x=31-au(_),o=1<<x,A=f[x];A===-1?(!(o&i)||o&l)&&(f[x]=t9(o,t)):A<=t&&(e.expiredLanes|=o),_&=~o}}function yj(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function P3(){var e=V1;return V1<<=1,!(V1&4194240)&&(V1=64),e}function KC(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function Sb(e,t,i){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-au(t),e[t]=i}function n9(e,t){var i=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var l=e.eventTimes;for(e=e.expirationTimes;0<i;){var f=31-au(i),_=1<<f;t[f]=0,l[f]=-1,e[f]=-1,i&=~_}}function gk(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var l=31-au(i),f=1<<l;f&t|e[l]&t&&(e[l]|=t),i&=~f}}var Cs=0;function R3(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var M3,_k,N3,D3,O3,vj=!1,$1=[],wf=null,Sf=null,Tf=null,q0=new Map,G0=new Map,of=[],i9="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function TO(e,t){switch(e){case"focusin":case"focusout":wf=null;break;case"dragenter":case"dragleave":Sf=null;break;case"mouseover":case"mouseout":Tf=null;break;case"pointerover":case"pointerout":q0.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":G0.delete(t.pointerId)}}function s0(e,t,i,l,f,_){return e===null||e.nativeEvent!==_?(e={blockedOn:t,domEventName:i,eventSystemFlags:l,nativeEvent:_,targetContainers:[f]},t!==null&&(t=Eb(t),t!==null&&_k(t)),e):(e.eventSystemFlags|=l,t=e.targetContainers,f!==null&&t.indexOf(f)===-1&&t.push(f),e)}function s9(e,t,i,l,f){switch(t){case"focusin":return wf=s0(wf,e,t,i,l,f),!0;case"dragenter":return Sf=s0(Sf,e,t,i,l,f),!0;case"mouseover":return Tf=s0(Tf,e,t,i,l,f),!0;case"pointerover":var _=f.pointerId;return q0.set(_,s0(q0.get(_)||null,e,t,i,l,f)),!0;case"gotpointercapture":return _=f.pointerId,G0.set(_,s0(G0.get(_)||null,e,t,i,l,f)),!0}return!1}function L3(e){var t=um(e.target);if(t!==null){var i=qm(t);if(i!==null){if(t=i.tag,t===13){if(t=E3(i),t!==null){e.blockedOn=t,O3(e.priority,function(){N3(i)});return}}else if(t===3&&i.stateNode.current.memoizedState.isDehydrated){e.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}e.blockedOn=null}function ES(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var i=xj(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(i===null){i=e.nativeEvent;var l=new i.constructor(i.type,i);pj=l,i.target.dispatchEvent(l),pj=null}else return t=Eb(i),t!==null&&_k(t),e.blockedOn=i,!1;t.shift()}return!0}function EO(e,t,i){ES(e)&&i.delete(t)}function o9(){vj=!1,wf!==null&&ES(wf)&&(wf=null),Sf!==null&&ES(Sf)&&(Sf=null),Tf!==null&&ES(Tf)&&(Tf=null),q0.forEach(EO),G0.forEach(EO)}function o0(e,t){e.blockedOn===t&&(e.blockedOn=null,vj||(vj=!0,Hl.unstable_scheduleCallback(Hl.unstable_NormalPriority,o9)))}function H0(e){function t(f){return o0(f,e)}if(0<$1.length){o0($1[0],e);for(var i=1;i<$1.length;i++){var l=$1[i];l.blockedOn===e&&(l.blockedOn=null)}}for(wf!==null&&o0(wf,e),Sf!==null&&o0(Sf,e),Tf!==null&&o0(Tf,e),q0.forEach(t),G0.forEach(t),i=0;i<of.length;i++)l=of[i],l.blockedOn===e&&(l.blockedOn=null);for(;0<of.length&&(i=of[0],i.blockedOn===null);)L3(i),i.blockedOn===null&&of.shift()}var Y_=th.ReactCurrentBatchConfig,JS=!0;function a9(e,t,i,l){var f=Cs,_=Y_.transition;Y_.transition=null;try{Cs=1,yk(e,t,i,l)}finally{Cs=f,Y_.transition=_}}function l9(e,t,i,l){var f=Cs,_=Y_.transition;Y_.transition=null;try{Cs=4,yk(e,t,i,l)}finally{Cs=f,Y_.transition=_}}function yk(e,t,i,l){if(JS){var f=xj(e,t,i,l);if(f===null)oA(e,t,l,QS,i),TO(e,l);else if(s9(f,e,t,i,l))l.stopPropagation();else if(TO(e,l),t&4&&-1<i9.indexOf(e)){for(;f!==null;){var _=Eb(f);if(_!==null&&M3(_),_=xj(e,t,i,l),_===null&&oA(e,t,l,QS,i),_===f)break;f=_}f!==null&&l.stopPropagation()}else oA(e,t,l,null,i)}}var QS=null;function xj(e,t,i,l){if(QS=null,e=pk(l),e=um(e),e!==null)if(t=qm(e),t===null)e=null;else if(i=t.tag,i===13){if(e=E3(t),e!==null)return e;e=null}else if(i===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return QS=e,null}function z3(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(XW()){case mk:return 1;case I3:return 4;case KS:case KW:return 16;case k3:return 536870912;default:return 16}default:return 16}}var vf=null,vk=null,CS=null;function F3(){if(CS)return CS;var e,t=vk,i=t.length,l,f="value"in vf?vf.value:vf.textContent,_=f.length;for(e=0;e<i&&t[e]===f[e];e++);var x=i-e;for(l=1;l<=x&&t[i-l]===f[_-l];l++);return CS=f.slice(e,1<l?1-l:void 0)}function AS(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function q1(){return!0}function CO(){return!1}function Yl(e){function t(i,l,f,_,x){this._reactName=i,this._targetInst=f,this.type=l,this.nativeEvent=_,this.target=x,this.currentTarget=null;for(var o in e)e.hasOwnProperty(o)&&(i=e[o],this[o]=i?i(_):_[o]);return this.isDefaultPrevented=(_.defaultPrevented!=null?_.defaultPrevented:_.returnValue===!1)?q1:CO,this.isPropagationStopped=CO,this}return uo(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=q1)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=q1)},persist:function(){},isPersistent:q1}),t}var zy={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},xk=Yl(zy),Tb=uo({},zy,{view:0,detail:0}),c9=Yl(Tb),YC,JC,a0,ZT=uo({},Tb,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:bk,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==a0&&(a0&&e.type==="mousemove"?(YC=e.screenX-a0.screenX,JC=e.screenY-a0.screenY):JC=YC=0,a0=e),YC)},movementY:function(e){return"movementY"in e?e.movementY:JC}}),AO=Yl(ZT),u9=uo({},ZT,{dataTransfer:0}),d9=Yl(u9),h9=uo({},Tb,{relatedTarget:0}),QC=Yl(h9),f9=uo({},zy,{animationName:0,elapsedTime:0,pseudoElement:0}),p9=Yl(f9),m9=uo({},zy,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),g9=Yl(m9),_9=uo({},zy,{data:0}),jO=Yl(_9),y9={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},v9={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},x9={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function b9(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=x9[e])?!!t[e]:!1}function bk(){return b9}var w9=uo({},Tb,{key:function(e){if(e.key){var t=y9[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=AS(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?v9[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:bk,charCode:function(e){return e.type==="keypress"?AS(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?AS(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),S9=Yl(w9),T9=uo({},ZT,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),IO=Yl(T9),E9=uo({},Tb,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:bk}),C9=Yl(E9),A9=uo({},zy,{propertyName:0,elapsedTime:0,pseudoElement:0}),j9=Yl(A9),I9=uo({},ZT,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),k9=Yl(I9),P9=[9,13,27,32],wk=Xd&&"CompositionEvent"in window,A0=null;Xd&&"documentMode"in document&&(A0=document.documentMode);var R9=Xd&&"TextEvent"in window&&!A0,B3=Xd&&(!wk||A0&&8<A0&&11>=A0),kO=" ",PO=!1;function V3(e,t){switch(e){case"keyup":return P9.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function U3(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var O_=!1;function M9(e,t){switch(e){case"compositionend":return U3(t);case"keypress":return t.which!==32?null:(PO=!0,kO);case"textInput":return e=t.data,e===kO&&PO?null:e;default:return null}}function N9(e,t){if(O_)return e==="compositionend"||!wk&&V3(e,t)?(e=F3(),CS=vk=vf=null,O_=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return B3&&t.locale!=="ko"?null:t.data;default:return null}}var D9={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function RO(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!D9[e.type]:t==="textarea"}function $3(e,t,i,l){x3(l),t=eT(t,"onChange"),0<t.length&&(i=new xk("onChange","change",null,i,l),e.push({event:i,listeners:t}))}var j0=null,W0=null;function O9(e){eB(e,0)}function XT(e){var t=F_(e);if(f3(t))return e}function L9(e,t){if(e==="change")return t}var q3=!1;if(Xd){var eA;if(Xd){var tA="oninput"in document;if(!tA){var MO=document.createElement("div");MO.setAttribute("oninput","return;"),tA=typeof MO.oninput=="function"}eA=tA}else eA=!1;q3=eA&&(!document.documentMode||9<document.documentMode)}function NO(){j0&&(j0.detachEvent("onpropertychange",G3),W0=j0=null)}function G3(e){if(e.propertyName==="value"&&XT(W0)){var t=[];$3(t,W0,e,pk(e)),T3(O9,t)}}function z9(e,t,i){e==="focusin"?(NO(),j0=t,W0=i,j0.attachEvent("onpropertychange",G3)):e==="focusout"&&NO()}function F9(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return XT(W0)}function B9(e,t){if(e==="click")return XT(t)}function V9(e,t){if(e==="input"||e==="change")return XT(t)}function U9(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var cu=typeof Object.is=="function"?Object.is:U9;function Z0(e,t){if(cu(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var i=Object.keys(e),l=Object.keys(t);if(i.length!==l.length)return!1;for(l=0;l<i.length;l++){var f=i[l];if(!rj.call(t,f)||!cu(e[f],t[f]))return!1}return!0}function DO(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function OO(e,t){var i=DO(e);e=0;for(var l;i;){if(i.nodeType===3){if(l=e+i.textContent.length,e<=t&&l>=t)return{node:i,offset:t-e};e=l}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=DO(i)}}function H3(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?H3(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function W3(){for(var e=window,t=WS();t instanceof e.HTMLIFrameElement;){try{var i=typeof t.contentWindow.location.href=="string"}catch{i=!1}if(i)e=t.contentWindow;else break;t=WS(e.document)}return t}function Sk(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function $9(e){var t=W3(),i=e.focusedElem,l=e.selectionRange;if(t!==i&&i&&i.ownerDocument&&H3(i.ownerDocument.documentElement,i)){if(l!==null&&Sk(i)){if(t=l.start,e=l.end,e===void 0&&(e=t),"selectionStart"in i)i.selectionStart=t,i.selectionEnd=Math.min(e,i.value.length);else if(e=(t=i.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var f=i.textContent.length,_=Math.min(l.start,f);l=l.end===void 0?_:Math.min(l.end,f),!e.extend&&_>l&&(f=l,l=_,_=f),f=OO(i,_);var x=OO(i,l);f&&x&&(e.rangeCount!==1||e.anchorNode!==f.node||e.anchorOffset!==f.offset||e.focusNode!==x.node||e.focusOffset!==x.offset)&&(t=t.createRange(),t.setStart(f.node,f.offset),e.removeAllRanges(),_>l?(e.addRange(t),e.extend(x.node,x.offset)):(t.setEnd(x.node,x.offset),e.addRange(t)))}}for(t=[],e=i;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof i.focus=="function"&&i.focus(),i=0;i<t.length;i++)e=t[i],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var q9=Xd&&"documentMode"in document&&11>=document.documentMode,L_=null,bj=null,I0=null,wj=!1;function LO(e,t,i){var l=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;wj||L_==null||L_!==WS(l)||(l=L_,"selectionStart"in l&&Sk(l)?l={start:l.selectionStart,end:l.selectionEnd}:(l=(l.ownerDocument&&l.ownerDocument.defaultView||window).getSelection(),l={anchorNode:l.anchorNode,anchorOffset:l.anchorOffset,focusNode:l.focusNode,focusOffset:l.focusOffset}),I0&&Z0(I0,l)||(I0=l,l=eT(bj,"onSelect"),0<l.length&&(t=new xk("onSelect","select",null,t,i),e.push({event:t,listeners:l}),t.target=L_)))}function G1(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var z_={animationend:G1("Animation","AnimationEnd"),animationiteration:G1("Animation","AnimationIteration"),animationstart:G1("Animation","AnimationStart"),transitionend:G1("Transition","TransitionEnd")},rA={},Z3={};Xd&&(Z3=document.createElement("div").style,"AnimationEvent"in window||(delete z_.animationend.animation,delete z_.animationiteration.animation,delete z_.animationstart.animation),"TransitionEvent"in window||delete z_.transitionend.transition);function KT(e){if(rA[e])return rA[e];if(!z_[e])return e;var t=z_[e],i;for(i in t)if(t.hasOwnProperty(i)&&i in Z3)return rA[e]=t[i];return e}var X3=KT("animationend"),K3=KT("animationiteration"),Y3=KT("animationstart"),J3=KT("transitionend"),Q3=new Map,zO="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function $f(e,t){Q3.set(e,t),$m(t,[e])}for(var nA=0;nA<zO.length;nA++){var iA=zO[nA],G9=iA.toLowerCase(),H9=iA[0].toUpperCase()+iA.slice(1);$f(G9,"on"+H9)}$f(X3,"onAnimationEnd");$f(K3,"onAnimationIteration");$f(Y3,"onAnimationStart");$f("dblclick","onDoubleClick");$f("focusin","onFocus");$f("focusout","onBlur");$f(J3,"onTransitionEnd");yy("onMouseEnter",["mouseout","mouseover"]);yy("onMouseLeave",["mouseout","mouseover"]);yy("onPointerEnter",["pointerout","pointerover"]);yy("onPointerLeave",["pointerout","pointerover"]);$m("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));$m("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));$m("onBeforeInput",["compositionend","keypress","textInput","paste"]);$m("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));$m("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));$m("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var v0="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),W9=new Set("cancel close invalid load scroll toggle".split(" ").concat(v0));function FO(e,t,i){var l=e.type||"unknown-event";e.currentTarget=i,GW(l,t,void 0,e),e.currentTarget=null}function eB(e,t){t=(t&4)!==0;for(var i=0;i<e.length;i++){var l=e[i],f=l.event;l=l.listeners;e:{var _=void 0;if(t)for(var x=l.length-1;0<=x;x--){var o=l[x],A=o.instance,I=o.currentTarget;if(o=o.listener,A!==_&&f.isPropagationStopped())break e;FO(f,o,I),_=A}else for(x=0;x<l.length;x++){if(o=l[x],A=o.instance,I=o.currentTarget,o=o.listener,A!==_&&f.isPropagationStopped())break e;FO(f,o,I),_=A}}}if(XS)throw e=_j,XS=!1,_j=null,e}function Xs(e,t){var i=t[Aj];i===void 0&&(i=t[Aj]=new Set);var l=e+"__bubble";i.has(l)||(tB(t,e,2,!1),i.add(l))}function sA(e,t,i){var l=0;t&&(l|=4),tB(i,e,l,t)}var H1="_reactListening"+Math.random().toString(36).slice(2);function X0(e){if(!e[H1]){e[H1]=!0,l3.forEach(function(i){i!=="selectionchange"&&(W9.has(i)||sA(i,!1,e),sA(i,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[H1]||(t[H1]=!0,sA("selectionchange",!1,t))}}function tB(e,t,i,l){switch(z3(t)){case 1:var f=a9;break;case 4:f=l9;break;default:f=yk}i=f.bind(null,t,i,e),f=void 0,!gj||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(f=!0),l?f!==void 0?e.addEventListener(t,i,{capture:!0,passive:f}):e.addEventListener(t,i,!0):f!==void 0?e.addEventListener(t,i,{passive:f}):e.addEventListener(t,i,!1)}function oA(e,t,i,l,f){var _=l;if(!(t&1)&&!(t&2)&&l!==null)e:for(;;){if(l===null)return;var x=l.tag;if(x===3||x===4){var o=l.stateNode.containerInfo;if(o===f||o.nodeType===8&&o.parentNode===f)break;if(x===4)for(x=l.return;x!==null;){var A=x.tag;if((A===3||A===4)&&(A=x.stateNode.containerInfo,A===f||A.nodeType===8&&A.parentNode===f))return;x=x.return}for(;o!==null;){if(x=um(o),x===null)return;if(A=x.tag,A===5||A===6){l=_=x;continue e}o=o.parentNode}}l=l.return}T3(function(){var I=_,N=pk(i),U=[];e:{var $=Q3.get(e);if($!==void 0){var V=xk,Y=e;switch(e){case"keypress":if(AS(i)===0)break e;case"keydown":case"keyup":V=S9;break;case"focusin":Y="focus",V=QC;break;case"focusout":Y="blur",V=QC;break;case"beforeblur":case"afterblur":V=QC;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":V=AO;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":V=d9;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":V=C9;break;case X3:case K3:case Y3:V=p9;break;case J3:V=j9;break;case"scroll":V=c9;break;case"wheel":V=k9;break;case"copy":case"cut":case"paste":V=g9;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":V=IO}var q=(t&4)!==0,Z=!q&&e==="scroll",Q=q?$!==null?$+"Capture":null:$;q=[];for(var H=I,K;H!==null;){K=H;var ne=K.stateNode;if(K.tag===5&&ne!==null&&(K=ne,Q!==null&&(ne=$0(H,Q),ne!=null&&q.push(K0(H,ne,K)))),Z)break;H=H.return}0<q.length&&($=new V($,Y,null,i,N),U.push({event:$,listeners:q}))}}if(!(t&7)){e:{if($=e==="mouseover"||e==="pointerover",V=e==="mouseout"||e==="pointerout",$&&i!==pj&&(Y=i.relatedTarget||i.fromElement)&&(um(Y)||Y[Kd]))break e;if((V||$)&&($=N.window===N?N:($=N.ownerDocument)?$.defaultView||$.parentWindow:window,V?(Y=i.relatedTarget||i.toElement,V=I,Y=Y?um(Y):null,Y!==null&&(Z=qm(Y),Y!==Z||Y.tag!==5&&Y.tag!==6)&&(Y=null)):(V=null,Y=I),V!==Y)){if(q=AO,ne="onMouseLeave",Q="onMouseEnter",H="mouse",(e==="pointerout"||e==="pointerover")&&(q=IO,ne="onPointerLeave",Q="onPointerEnter",H="pointer"),Z=V==null?$:F_(V),K=Y==null?$:F_(Y),$=new q(ne,H+"leave",V,i,N),$.target=Z,$.relatedTarget=K,ne=null,um(N)===I&&(q=new q(Q,H+"enter",Y,i,N),q.target=K,q.relatedTarget=Z,ne=q),Z=ne,V&&Y)t:{for(q=V,Q=Y,H=0,K=q;K;K=x_(K))H++;for(K=0,ne=Q;ne;ne=x_(ne))K++;for(;0<H-K;)q=x_(q),H--;for(;0<K-H;)Q=x_(Q),K--;for(;H--;){if(q===Q||Q!==null&&q===Q.alternate)break t;q=x_(q),Q=x_(Q)}q=null}else q=null;V!==null&&BO(U,$,V,q,!1),Y!==null&&Z!==null&&BO(U,Z,Y,q,!0)}}e:{if($=I?F_(I):window,V=$.nodeName&&$.nodeName.toLowerCase(),V==="select"||V==="input"&&$.type==="file")var le=L9;else if(RO($))if(q3)le=V9;else{le=F9;var pe=z9}else(V=$.nodeName)&&V.toLowerCase()==="input"&&($.type==="checkbox"||$.type==="radio")&&(le=B9);if(le&&(le=le(e,I))){$3(U,le,i,N);break e}pe&&pe(e,$,I),e==="focusout"&&(pe=$._wrapperState)&&pe.controlled&&$.type==="number"&&cj($,"number",$.value)}switch(pe=I?F_(I):window,e){case"focusin":(RO(pe)||pe.contentEditable==="true")&&(L_=pe,bj=I,I0=null);break;case"focusout":I0=bj=L_=null;break;case"mousedown":wj=!0;break;case"contextmenu":case"mouseup":case"dragend":wj=!1,LO(U,i,N);break;case"selectionchange":if(q9)break;case"keydown":case"keyup":LO(U,i,N)}var Ae;if(wk)e:{switch(e){case"compositionstart":var Ze="onCompositionStart";break e;case"compositionend":Ze="onCompositionEnd";break e;case"compositionupdate":Ze="onCompositionUpdate";break e}Ze=void 0}else O_?V3(e,i)&&(Ze="onCompositionEnd"):e==="keydown"&&i.keyCode===229&&(Ze="onCompositionStart");Ze&&(B3&&i.locale!=="ko"&&(O_||Ze!=="onCompositionStart"?Ze==="onCompositionEnd"&&O_&&(Ae=F3()):(vf=N,vk="value"in vf?vf.value:vf.textContent,O_=!0)),pe=eT(I,Ze),0<pe.length&&(Ze=new jO(Ze,e,null,i,N),U.push({event:Ze,listeners:pe}),Ae?Ze.data=Ae:(Ae=U3(i),Ae!==null&&(Ze.data=Ae)))),(Ae=R9?M9(e,i):N9(e,i))&&(I=eT(I,"onBeforeInput"),0<I.length&&(N=new jO("onBeforeInput","beforeinput",null,i,N),U.push({event:N,listeners:I}),N.data=Ae))}eB(U,t)})}function K0(e,t,i){return{instance:e,listener:t,currentTarget:i}}function eT(e,t){for(var i=t+"Capture",l=[];e!==null;){var f=e,_=f.stateNode;f.tag===5&&_!==null&&(f=_,_=$0(e,i),_!=null&&l.unshift(K0(e,_,f)),_=$0(e,t),_!=null&&l.push(K0(e,_,f))),e=e.return}return l}function x_(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function BO(e,t,i,l,f){for(var _=t._reactName,x=[];i!==null&&i!==l;){var o=i,A=o.alternate,I=o.stateNode;if(A!==null&&A===l)break;o.tag===5&&I!==null&&(o=I,f?(A=$0(i,_),A!=null&&x.unshift(K0(i,A,o))):f||(A=$0(i,_),A!=null&&x.push(K0(i,A,o)))),i=i.return}x.length!==0&&e.push({event:t,listeners:x})}var Z9=/\r\n?/g,X9=/\u0000|\uFFFD/g;function VO(e){return(typeof e=="string"?e:""+e).replace(Z9,`
`).replace(X9,"")}function W1(e,t,i){if(t=VO(t),VO(e)!==t&&i)throw Error(Er(425))}function tT(){}var Sj=null,Tj=null;function Ej(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Cj=typeof setTimeout=="function"?setTimeout:void 0,K9=typeof clearTimeout=="function"?clearTimeout:void 0,UO=typeof Promise=="function"?Promise:void 0,Y9=typeof queueMicrotask=="function"?queueMicrotask:typeof UO<"u"?function(e){return UO.resolve(null).then(e).catch(J9)}:Cj;function J9(e){setTimeout(function(){throw e})}function aA(e,t){var i=t,l=0;do{var f=i.nextSibling;if(e.removeChild(i),f&&f.nodeType===8)if(i=f.data,i==="/$"){if(l===0){e.removeChild(f),H0(t);return}l--}else i!=="$"&&i!=="$?"&&i!=="$!"||l++;i=f}while(i);H0(t)}function Ef(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function $O(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="$"||i==="$!"||i==="$?"){if(t===0)return e;t--}else i==="/$"&&t++}e=e.previousSibling}return null}var Fy=Math.random().toString(36).slice(2),Uu="__reactFiber$"+Fy,Y0="__reactProps$"+Fy,Kd="__reactContainer$"+Fy,Aj="__reactEvents$"+Fy,Q9="__reactListeners$"+Fy,e7="__reactHandles$"+Fy;function um(e){var t=e[Uu];if(t)return t;for(var i=e.parentNode;i;){if(t=i[Kd]||i[Uu]){if(i=t.alternate,t.child!==null||i!==null&&i.child!==null)for(e=$O(e);e!==null;){if(i=e[Uu])return i;e=$O(e)}return t}e=i,i=e.parentNode}return null}function Eb(e){return e=e[Uu]||e[Kd],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function F_(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Er(33))}function YT(e){return e[Y0]||null}var jj=[],B_=-1;function qf(e){return{current:e}}function Ys(e){0>B_||(e.current=jj[B_],jj[B_]=null,B_--)}function Bs(e,t){B_++,jj[B_]=e.current,e.current=t}var Df={},Aa=qf(Df),Tl=qf(!1),jm=Df;function vy(e,t){var i=e.type.contextTypes;if(!i)return Df;var l=e.stateNode;if(l&&l.__reactInternalMemoizedUnmaskedChildContext===t)return l.__reactInternalMemoizedMaskedChildContext;var f={},_;for(_ in i)f[_]=t[_];return l&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=f),f}function El(e){return e=e.childContextTypes,e!=null}function rT(){Ys(Tl),Ys(Aa)}function qO(e,t,i){if(Aa.current!==Df)throw Error(Er(168));Bs(Aa,t),Bs(Tl,i)}function rB(e,t,i){var l=e.stateNode;if(t=t.childContextTypes,typeof l.getChildContext!="function")return i;l=l.getChildContext();for(var f in l)if(!(f in t))throw Error(Er(108,zW(e)||"Unknown",f));return uo({},i,l)}function nT(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Df,jm=Aa.current,Bs(Aa,e),Bs(Tl,Tl.current),!0}function GO(e,t,i){var l=e.stateNode;if(!l)throw Error(Er(169));i?(e=rB(e,t,jm),l.__reactInternalMemoizedMergedChildContext=e,Ys(Tl),Ys(Aa),Bs(Aa,e)):Ys(Tl),Bs(Tl,i)}var Dd=null,JT=!1,lA=!1;function nB(e){Dd===null?Dd=[e]:Dd.push(e)}function t7(e){JT=!0,nB(e)}function Gf(){if(!lA&&Dd!==null){lA=!0;var e=0,t=Cs;try{var i=Dd;for(Cs=1;e<i.length;e++){var l=i[e];do l=l(!0);while(l!==null)}Dd=null,JT=!1}catch(f){throw Dd!==null&&(Dd=Dd.slice(e+1)),j3(mk,Gf),f}finally{Cs=t,lA=!1}}return null}var V_=[],U_=0,iT=null,sT=0,hc=[],fc=0,Im=null,Fd=1,Bd="";function im(e,t){V_[U_++]=sT,V_[U_++]=iT,iT=e,sT=t}function iB(e,t,i){hc[fc++]=Fd,hc[fc++]=Bd,hc[fc++]=Im,Im=e;var l=Fd;e=Bd;var f=32-au(l)-1;l&=~(1<<f),i+=1;var _=32-au(t)+f;if(30<_){var x=f-f%5;_=(l&(1<<x)-1).toString(32),l>>=x,f-=x,Fd=1<<32-au(t)+f|i<<f|l,Bd=_+e}else Fd=1<<_|i<<f|l,Bd=e}function Tk(e){e.return!==null&&(im(e,1),iB(e,1,0))}function Ek(e){for(;e===iT;)iT=V_[--U_],V_[U_]=null,sT=V_[--U_],V_[U_]=null;for(;e===Im;)Im=hc[--fc],hc[fc]=null,Bd=hc[--fc],hc[fc]=null,Fd=hc[--fc],hc[fc]=null}var ql=null,$l=null,to=!1,nu=null;function sB(e,t){var i=mc(5,null,null,0);i.elementType="DELETED",i.stateNode=t,i.return=e,t=e.deletions,t===null?(e.deletions=[i],e.flags|=16):t.push(i)}function HO(e,t){switch(e.tag){case 5:var i=e.type;return t=t.nodeType!==1||i.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,ql=e,$l=Ef(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,ql=e,$l=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(i=Im!==null?{id:Fd,overflow:Bd}:null,e.memoizedState={dehydrated:t,treeContext:i,retryLane:1073741824},i=mc(18,null,null,0),i.stateNode=t,i.return=e,e.child=i,ql=e,$l=null,!0):!1;default:return!1}}function Ij(e){return(e.mode&1)!==0&&(e.flags&128)===0}function kj(e){if(to){var t=$l;if(t){var i=t;if(!HO(e,t)){if(Ij(e))throw Error(Er(418));t=Ef(i.nextSibling);var l=ql;t&&HO(e,t)?sB(l,i):(e.flags=e.flags&-4097|2,to=!1,ql=e)}}else{if(Ij(e))throw Error(Er(418));e.flags=e.flags&-4097|2,to=!1,ql=e}}}function WO(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;ql=e}function Z1(e){if(e!==ql)return!1;if(!to)return WO(e),to=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Ej(e.type,e.memoizedProps)),t&&(t=$l)){if(Ij(e))throw oB(),Error(Er(418));for(;t;)sB(e,t),t=Ef(t.nextSibling)}if(WO(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Er(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="/$"){if(t===0){$l=Ef(e.nextSibling);break e}t--}else i!=="$"&&i!=="$!"&&i!=="$?"||t++}e=e.nextSibling}$l=null}}else $l=ql?Ef(e.stateNode.nextSibling):null;return!0}function oB(){for(var e=$l;e;)e=Ef(e.nextSibling)}function xy(){$l=ql=null,to=!1}function Ck(e){nu===null?nu=[e]:nu.push(e)}var r7=th.ReactCurrentBatchConfig;function l0(e,t,i){if(e=i.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(i._owner){if(i=i._owner,i){if(i.tag!==1)throw Error(Er(309));var l=i.stateNode}if(!l)throw Error(Er(147,e));var f=l,_=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===_?t.ref:(t=function(x){var o=f.refs;x===null?delete o[_]:o[_]=x},t._stringRef=_,t)}if(typeof e!="string")throw Error(Er(284));if(!i._owner)throw Error(Er(290,e))}return e}function X1(e,t){throw e=Object.prototype.toString.call(t),Error(Er(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ZO(e){var t=e._init;return t(e._payload)}function aB(e){function t(Q,H){if(e){var K=Q.deletions;K===null?(Q.deletions=[H],Q.flags|=16):K.push(H)}}function i(Q,H){if(!e)return null;for(;H!==null;)t(Q,H),H=H.sibling;return null}function l(Q,H){for(Q=new Map;H!==null;)H.key!==null?Q.set(H.key,H):Q.set(H.index,H),H=H.sibling;return Q}function f(Q,H){return Q=If(Q,H),Q.index=0,Q.sibling=null,Q}function _(Q,H,K){return Q.index=K,e?(K=Q.alternate,K!==null?(K=K.index,K<H?(Q.flags|=2,H):K):(Q.flags|=2,H)):(Q.flags|=1048576,H)}function x(Q){return e&&Q.alternate===null&&(Q.flags|=2),Q}function o(Q,H,K,ne){return H===null||H.tag!==6?(H=mA(K,Q.mode,ne),H.return=Q,H):(H=f(H,K),H.return=Q,H)}function A(Q,H,K,ne){var le=K.type;return le===D_?N(Q,H,K.props.children,ne,K.key):H!==null&&(H.elementType===le||typeof le=="object"&&le!==null&&le.$$typeof===rf&&ZO(le)===H.type)?(ne=f(H,K.props),ne.ref=l0(Q,H,K),ne.return=Q,ne):(ne=NS(K.type,K.key,K.props,null,Q.mode,ne),ne.ref=l0(Q,H,K),ne.return=Q,ne)}function I(Q,H,K,ne){return H===null||H.tag!==4||H.stateNode.containerInfo!==K.containerInfo||H.stateNode.implementation!==K.implementation?(H=gA(K,Q.mode,ne),H.return=Q,H):(H=f(H,K.children||[]),H.return=Q,H)}function N(Q,H,K,ne,le){return H===null||H.tag!==7?(H=Em(K,Q.mode,ne,le),H.return=Q,H):(H=f(H,K),H.return=Q,H)}function U(Q,H,K){if(typeof H=="string"&&H!==""||typeof H=="number")return H=mA(""+H,Q.mode,K),H.return=Q,H;if(typeof H=="object"&&H!==null){switch(H.$$typeof){case z1:return K=NS(H.type,H.key,H.props,null,Q.mode,K),K.ref=l0(Q,null,H),K.return=Q,K;case N_:return H=gA(H,Q.mode,K),H.return=Q,H;case rf:var ne=H._init;return U(Q,ne(H._payload),K)}if(_0(H)||n0(H))return H=Em(H,Q.mode,K,null),H.return=Q,H;X1(Q,H)}return null}function $(Q,H,K,ne){var le=H!==null?H.key:null;if(typeof K=="string"&&K!==""||typeof K=="number")return le!==null?null:o(Q,H,""+K,ne);if(typeof K=="object"&&K!==null){switch(K.$$typeof){case z1:return K.key===le?A(Q,H,K,ne):null;case N_:return K.key===le?I(Q,H,K,ne):null;case rf:return le=K._init,$(Q,H,le(K._payload),ne)}if(_0(K)||n0(K))return le!==null?null:N(Q,H,K,ne,null);X1(Q,K)}return null}function V(Q,H,K,ne,le){if(typeof ne=="string"&&ne!==""||typeof ne=="number")return Q=Q.get(K)||null,o(H,Q,""+ne,le);if(typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case z1:return Q=Q.get(ne.key===null?K:ne.key)||null,A(H,Q,ne,le);case N_:return Q=Q.get(ne.key===null?K:ne.key)||null,I(H,Q,ne,le);case rf:var pe=ne._init;return V(Q,H,K,pe(ne._payload),le)}if(_0(ne)||n0(ne))return Q=Q.get(K)||null,N(H,Q,ne,le,null);X1(H,ne)}return null}function Y(Q,H,K,ne){for(var le=null,pe=null,Ae=H,Ze=H=0,Xe=null;Ae!==null&&Ze<K.length;Ze++){Ae.index>Ze?(Xe=Ae,Ae=null):Xe=Ae.sibling;var Je=$(Q,Ae,K[Ze],ne);if(Je===null){Ae===null&&(Ae=Xe);break}e&&Ae&&Je.alternate===null&&t(Q,Ae),H=_(Je,H,Ze),pe===null?le=Je:pe.sibling=Je,pe=Je,Ae=Xe}if(Ze===K.length)return i(Q,Ae),to&&im(Q,Ze),le;if(Ae===null){for(;Ze<K.length;Ze++)Ae=U(Q,K[Ze],ne),Ae!==null&&(H=_(Ae,H,Ze),pe===null?le=Ae:pe.sibling=Ae,pe=Ae);return to&&im(Q,Ze),le}for(Ae=l(Q,Ae);Ze<K.length;Ze++)Xe=V(Ae,Q,Ze,K[Ze],ne),Xe!==null&&(e&&Xe.alternate!==null&&Ae.delete(Xe.key===null?Ze:Xe.key),H=_(Xe,H,Ze),pe===null?le=Xe:pe.sibling=Xe,pe=Xe);return e&&Ae.forEach(function(Te){return t(Q,Te)}),to&&im(Q,Ze),le}function q(Q,H,K,ne){var le=n0(K);if(typeof le!="function")throw Error(Er(150));if(K=le.call(K),K==null)throw Error(Er(151));for(var pe=le=null,Ae=H,Ze=H=0,Xe=null,Je=K.next();Ae!==null&&!Je.done;Ze++,Je=K.next()){Ae.index>Ze?(Xe=Ae,Ae=null):Xe=Ae.sibling;var Te=$(Q,Ae,Je.value,ne);if(Te===null){Ae===null&&(Ae=Xe);break}e&&Ae&&Te.alternate===null&&t(Q,Ae),H=_(Te,H,Ze),pe===null?le=Te:pe.sibling=Te,pe=Te,Ae=Xe}if(Je.done)return i(Q,Ae),to&&im(Q,Ze),le;if(Ae===null){for(;!Je.done;Ze++,Je=K.next())Je=U(Q,Je.value,ne),Je!==null&&(H=_(Je,H,Ze),pe===null?le=Je:pe.sibling=Je,pe=Je);return to&&im(Q,Ze),le}for(Ae=l(Q,Ae);!Je.done;Ze++,Je=K.next())Je=V(Ae,Q,Ze,Je.value,ne),Je!==null&&(e&&Je.alternate!==null&&Ae.delete(Je.key===null?Ze:Je.key),H=_(Je,H,Ze),pe===null?le=Je:pe.sibling=Je,pe=Je);return e&&Ae.forEach(function(xe){return t(Q,xe)}),to&&im(Q,Ze),le}function Z(Q,H,K,ne){if(typeof K=="object"&&K!==null&&K.type===D_&&K.key===null&&(K=K.props.children),typeof K=="object"&&K!==null){switch(K.$$typeof){case z1:e:{for(var le=K.key,pe=H;pe!==null;){if(pe.key===le){if(le=K.type,le===D_){if(pe.tag===7){i(Q,pe.sibling),H=f(pe,K.props.children),H.return=Q,Q=H;break e}}else if(pe.elementType===le||typeof le=="object"&&le!==null&&le.$$typeof===rf&&ZO(le)===pe.type){i(Q,pe.sibling),H=f(pe,K.props),H.ref=l0(Q,pe,K),H.return=Q,Q=H;break e}i(Q,pe);break}else t(Q,pe);pe=pe.sibling}K.type===D_?(H=Em(K.props.children,Q.mode,ne,K.key),H.return=Q,Q=H):(ne=NS(K.type,K.key,K.props,null,Q.mode,ne),ne.ref=l0(Q,H,K),ne.return=Q,Q=ne)}return x(Q);case N_:e:{for(pe=K.key;H!==null;){if(H.key===pe)if(H.tag===4&&H.stateNode.containerInfo===K.containerInfo&&H.stateNode.implementation===K.implementation){i(Q,H.sibling),H=f(H,K.children||[]),H.return=Q,Q=H;break e}else{i(Q,H);break}else t(Q,H);H=H.sibling}H=gA(K,Q.mode,ne),H.return=Q,Q=H}return x(Q);case rf:return pe=K._init,Z(Q,H,pe(K._payload),ne)}if(_0(K))return Y(Q,H,K,ne);if(n0(K))return q(Q,H,K,ne);X1(Q,K)}return typeof K=="string"&&K!==""||typeof K=="number"?(K=""+K,H!==null&&H.tag===6?(i(Q,H.sibling),H=f(H,K),H.return=Q,Q=H):(i(Q,H),H=mA(K,Q.mode,ne),H.return=Q,Q=H),x(Q)):i(Q,H)}return Z}var by=aB(!0),lB=aB(!1),oT=qf(null),aT=null,$_=null,Ak=null;function jk(){Ak=$_=aT=null}function Ik(e){var t=oT.current;Ys(oT),e._currentValue=t}function Pj(e,t,i){for(;e!==null;){var l=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,l!==null&&(l.childLanes|=t)):l!==null&&(l.childLanes&t)!==t&&(l.childLanes|=t),e===i)break;e=e.return}}function J_(e,t){aT=e,Ak=$_=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(wl=!0),e.firstContext=null)}function _c(e){var t=e._currentValue;if(Ak!==e)if(e={context:e,memoizedValue:t,next:null},$_===null){if(aT===null)throw Error(Er(308));$_=e,aT.dependencies={lanes:0,firstContext:e}}else $_=$_.next=e;return t}var dm=null;function kk(e){dm===null?dm=[e]:dm.push(e)}function cB(e,t,i,l){var f=t.interleaved;return f===null?(i.next=i,kk(t)):(i.next=f.next,f.next=i),t.interleaved=i,Yd(e,l)}function Yd(e,t){e.lanes|=t;var i=e.alternate;for(i!==null&&(i.lanes|=t),i=e,e=e.return;e!==null;)e.childLanes|=t,i=e.alternate,i!==null&&(i.childLanes|=t),i=e,e=e.return;return i.tag===3?i.stateNode:null}var nf=!1;function Pk(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function uB(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Gd(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Cf(e,t,i){var l=e.updateQueue;if(l===null)return null;if(l=l.shared,os&2){var f=l.pending;return f===null?t.next=t:(t.next=f.next,f.next=t),l.pending=t,Yd(e,i)}return f=l.interleaved,f===null?(t.next=t,kk(l)):(t.next=f.next,f.next=t),l.interleaved=t,Yd(e,i)}function jS(e,t,i){if(t=t.updateQueue,t!==null&&(t=t.shared,(i&4194240)!==0)){var l=t.lanes;l&=e.pendingLanes,i|=l,t.lanes=i,gk(e,i)}}function XO(e,t){var i=e.updateQueue,l=e.alternate;if(l!==null&&(l=l.updateQueue,i===l)){var f=null,_=null;if(i=i.firstBaseUpdate,i!==null){do{var x={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};_===null?f=_=x:_=_.next=x,i=i.next}while(i!==null);_===null?f=_=t:_=_.next=t}else f=_=t;i={baseState:l.baseState,firstBaseUpdate:f,lastBaseUpdate:_,shared:l.shared,effects:l.effects},e.updateQueue=i;return}e=i.lastBaseUpdate,e===null?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}function lT(e,t,i,l){var f=e.updateQueue;nf=!1;var _=f.firstBaseUpdate,x=f.lastBaseUpdate,o=f.shared.pending;if(o!==null){f.shared.pending=null;var A=o,I=A.next;A.next=null,x===null?_=I:x.next=I,x=A;var N=e.alternate;N!==null&&(N=N.updateQueue,o=N.lastBaseUpdate,o!==x&&(o===null?N.firstBaseUpdate=I:o.next=I,N.lastBaseUpdate=A))}if(_!==null){var U=f.baseState;x=0,N=I=A=null,o=_;do{var $=o.lane,V=o.eventTime;if((l&$)===$){N!==null&&(N=N.next={eventTime:V,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var Y=e,q=o;switch($=t,V=i,q.tag){case 1:if(Y=q.payload,typeof Y=="function"){U=Y.call(V,U,$);break e}U=Y;break e;case 3:Y.flags=Y.flags&-65537|128;case 0:if(Y=q.payload,$=typeof Y=="function"?Y.call(V,U,$):Y,$==null)break e;U=uo({},U,$);break e;case 2:nf=!0}}o.callback!==null&&o.lane!==0&&(e.flags|=64,$=f.effects,$===null?f.effects=[o]:$.push(o))}else V={eventTime:V,lane:$,tag:o.tag,payload:o.payload,callback:o.callback,next:null},N===null?(I=N=V,A=U):N=N.next=V,x|=$;if(o=o.next,o===null){if(o=f.shared.pending,o===null)break;$=o,o=$.next,$.next=null,f.lastBaseUpdate=$,f.shared.pending=null}}while(!0);if(N===null&&(A=U),f.baseState=A,f.firstBaseUpdate=I,f.lastBaseUpdate=N,t=f.shared.interleaved,t!==null){f=t;do x|=f.lane,f=f.next;while(f!==t)}else _===null&&(f.shared.lanes=0);Pm|=x,e.lanes=x,e.memoizedState=U}}function KO(e,t,i){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var l=e[t],f=l.callback;if(f!==null){if(l.callback=null,l=i,typeof f!="function")throw Error(Er(191,f));f.call(l)}}}var Cb={},Yu=qf(Cb),J0=qf(Cb),Q0=qf(Cb);function hm(e){if(e===Cb)throw Error(Er(174));return e}function Rk(e,t){switch(Bs(Q0,t),Bs(J0,e),Bs(Yu,Cb),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:dj(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=dj(t,e)}Ys(Yu),Bs(Yu,t)}function wy(){Ys(Yu),Ys(J0),Ys(Q0)}function dB(e){hm(Q0.current);var t=hm(Yu.current),i=dj(t,e.type);t!==i&&(Bs(J0,e),Bs(Yu,i))}function Mk(e){J0.current===e&&(Ys(Yu),Ys(J0))}var ao=qf(0);function cT(e){for(var t=e;t!==null;){if(t.tag===13){var i=t.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||i.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var cA=[];function Nk(){for(var e=0;e<cA.length;e++)cA[e]._workInProgressVersionPrimary=null;cA.length=0}var IS=th.ReactCurrentDispatcher,uA=th.ReactCurrentBatchConfig,km=0,lo=null,Ho=null,ea=null,uT=!1,k0=!1,eb=0,n7=0;function xa(){throw Error(Er(321))}function Dk(e,t){if(t===null)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!cu(e[i],t[i]))return!1;return!0}function Ok(e,t,i,l,f,_){if(km=_,lo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,IS.current=e===null||e.memoizedState===null?a7:l7,e=i(l,f),k0){_=0;do{if(k0=!1,eb=0,25<=_)throw Error(Er(301));_+=1,ea=Ho=null,t.updateQueue=null,IS.current=c7,e=i(l,f)}while(k0)}if(IS.current=dT,t=Ho!==null&&Ho.next!==null,km=0,ea=Ho=lo=null,uT=!1,t)throw Error(Er(300));return e}function Lk(){var e=eb!==0;return eb=0,e}function zu(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ea===null?lo.memoizedState=ea=e:ea=ea.next=e,ea}function yc(){if(Ho===null){var e=lo.alternate;e=e!==null?e.memoizedState:null}else e=Ho.next;var t=ea===null?lo.memoizedState:ea.next;if(t!==null)ea=t,Ho=e;else{if(e===null)throw Error(Er(310));Ho=e,e={memoizedState:Ho.memoizedState,baseState:Ho.baseState,baseQueue:Ho.baseQueue,queue:Ho.queue,next:null},ea===null?lo.memoizedState=ea=e:ea=ea.next=e}return ea}function tb(e,t){return typeof t=="function"?t(e):t}function dA(e){var t=yc(),i=t.queue;if(i===null)throw Error(Er(311));i.lastRenderedReducer=e;var l=Ho,f=l.baseQueue,_=i.pending;if(_!==null){if(f!==null){var x=f.next;f.next=_.next,_.next=x}l.baseQueue=f=_,i.pending=null}if(f!==null){_=f.next,l=l.baseState;var o=x=null,A=null,I=_;do{var N=I.lane;if((km&N)===N)A!==null&&(A=A.next={lane:0,action:I.action,hasEagerState:I.hasEagerState,eagerState:I.eagerState,next:null}),l=I.hasEagerState?I.eagerState:e(l,I.action);else{var U={lane:N,action:I.action,hasEagerState:I.hasEagerState,eagerState:I.eagerState,next:null};A===null?(o=A=U,x=l):A=A.next=U,lo.lanes|=N,Pm|=N}I=I.next}while(I!==null&&I!==_);A===null?x=l:A.next=o,cu(l,t.memoizedState)||(wl=!0),t.memoizedState=l,t.baseState=x,t.baseQueue=A,i.lastRenderedState=l}if(e=i.interleaved,e!==null){f=e;do _=f.lane,lo.lanes|=_,Pm|=_,f=f.next;while(f!==e)}else f===null&&(i.lanes=0);return[t.memoizedState,i.dispatch]}function hA(e){var t=yc(),i=t.queue;if(i===null)throw Error(Er(311));i.lastRenderedReducer=e;var l=i.dispatch,f=i.pending,_=t.memoizedState;if(f!==null){i.pending=null;var x=f=f.next;do _=e(_,x.action),x=x.next;while(x!==f);cu(_,t.memoizedState)||(wl=!0),t.memoizedState=_,t.baseQueue===null&&(t.baseState=_),i.lastRenderedState=_}return[_,l]}function hB(){}function fB(e,t){var i=lo,l=yc(),f=t(),_=!cu(l.memoizedState,f);if(_&&(l.memoizedState=f,wl=!0),l=l.queue,zk(gB.bind(null,i,l,e),[e]),l.getSnapshot!==t||_||ea!==null&&ea.memoizedState.tag&1){if(i.flags|=2048,rb(9,mB.bind(null,i,l,f,t),void 0,null),ta===null)throw Error(Er(349));km&30||pB(i,t,f)}return f}function pB(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},t=lo.updateQueue,t===null?(t={lastEffect:null,stores:null},lo.updateQueue=t,t.stores=[e]):(i=t.stores,i===null?t.stores=[e]:i.push(e))}function mB(e,t,i,l){t.value=i,t.getSnapshot=l,_B(t)&&yB(e)}function gB(e,t,i){return i(function(){_B(t)&&yB(e)})}function _B(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!cu(e,i)}catch{return!0}}function yB(e){var t=Yd(e,1);t!==null&&lu(t,e,1,-1)}function YO(e){var t=zu();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:tb,lastRenderedState:e},t.queue=e,e=e.dispatch=o7.bind(null,lo,e),[t.memoizedState,e]}function rb(e,t,i,l){return e={tag:e,create:t,destroy:i,deps:l,next:null},t=lo.updateQueue,t===null?(t={lastEffect:null,stores:null},lo.updateQueue=t,t.lastEffect=e.next=e):(i=t.lastEffect,i===null?t.lastEffect=e.next=e:(l=i.next,i.next=e,e.next=l,t.lastEffect=e)),e}function vB(){return yc().memoizedState}function kS(e,t,i,l){var f=zu();lo.flags|=e,f.memoizedState=rb(1|t,i,void 0,l===void 0?null:l)}function QT(e,t,i,l){var f=yc();l=l===void 0?null:l;var _=void 0;if(Ho!==null){var x=Ho.memoizedState;if(_=x.destroy,l!==null&&Dk(l,x.deps)){f.memoizedState=rb(t,i,_,l);return}}lo.flags|=e,f.memoizedState=rb(1|t,i,_,l)}function JO(e,t){return kS(8390656,8,e,t)}function zk(e,t){return QT(2048,8,e,t)}function xB(e,t){return QT(4,2,e,t)}function bB(e,t){return QT(4,4,e,t)}function wB(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function SB(e,t,i){return i=i!=null?i.concat([e]):null,QT(4,4,wB.bind(null,t,e),i)}function Fk(){}function TB(e,t){var i=yc();t=t===void 0?null:t;var l=i.memoizedState;return l!==null&&t!==null&&Dk(t,l[1])?l[0]:(i.memoizedState=[e,t],e)}function EB(e,t){var i=yc();t=t===void 0?null:t;var l=i.memoizedState;return l!==null&&t!==null&&Dk(t,l[1])?l[0]:(e=e(),i.memoizedState=[e,t],e)}function CB(e,t,i){return km&21?(cu(i,t)||(i=P3(),lo.lanes|=i,Pm|=i,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,wl=!0),e.memoizedState=i)}function i7(e,t){var i=Cs;Cs=i!==0&&4>i?i:4,e(!0);var l=uA.transition;uA.transition={};try{e(!1),t()}finally{Cs=i,uA.transition=l}}function AB(){return yc().memoizedState}function s7(e,t,i){var l=jf(e);if(i={lane:l,action:i,hasEagerState:!1,eagerState:null,next:null},jB(e))IB(t,i);else if(i=cB(e,t,i,l),i!==null){var f=Ja();lu(i,e,l,f),kB(i,t,l)}}function o7(e,t,i){var l=jf(e),f={lane:l,action:i,hasEagerState:!1,eagerState:null,next:null};if(jB(e))IB(t,f);else{var _=e.alternate;if(e.lanes===0&&(_===null||_.lanes===0)&&(_=t.lastRenderedReducer,_!==null))try{var x=t.lastRenderedState,o=_(x,i);if(f.hasEagerState=!0,f.eagerState=o,cu(o,x)){var A=t.interleaved;A===null?(f.next=f,kk(t)):(f.next=A.next,A.next=f),t.interleaved=f;return}}catch{}finally{}i=cB(e,t,f,l),i!==null&&(f=Ja(),lu(i,e,l,f),kB(i,t,l))}}function jB(e){var t=e.alternate;return e===lo||t!==null&&t===lo}function IB(e,t){k0=uT=!0;var i=e.pending;i===null?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function kB(e,t,i){if(i&4194240){var l=t.lanes;l&=e.pendingLanes,i|=l,t.lanes=i,gk(e,i)}}var dT={readContext:_c,useCallback:xa,useContext:xa,useEffect:xa,useImperativeHandle:xa,useInsertionEffect:xa,useLayoutEffect:xa,useMemo:xa,useReducer:xa,useRef:xa,useState:xa,useDebugValue:xa,useDeferredValue:xa,useTransition:xa,useMutableSource:xa,useSyncExternalStore:xa,useId:xa,unstable_isNewReconciler:!1},a7={readContext:_c,useCallback:function(e,t){return zu().memoizedState=[e,t===void 0?null:t],e},useContext:_c,useEffect:JO,useImperativeHandle:function(e,t,i){return i=i!=null?i.concat([e]):null,kS(4194308,4,wB.bind(null,t,e),i)},useLayoutEffect:function(e,t){return kS(4194308,4,e,t)},useInsertionEffect:function(e,t){return kS(4,2,e,t)},useMemo:function(e,t){var i=zu();return t=t===void 0?null:t,e=e(),i.memoizedState=[e,t],e},useReducer:function(e,t,i){var l=zu();return t=i!==void 0?i(t):t,l.memoizedState=l.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},l.queue=e,e=e.dispatch=s7.bind(null,lo,e),[l.memoizedState,e]},useRef:function(e){var t=zu();return e={current:e},t.memoizedState=e},useState:YO,useDebugValue:Fk,useDeferredValue:function(e){return zu().memoizedState=e},useTransition:function(){var e=YO(!1),t=e[0];return e=i7.bind(null,e[1]),zu().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,i){var l=lo,f=zu();if(to){if(i===void 0)throw Error(Er(407));i=i()}else{if(i=t(),ta===null)throw Error(Er(349));km&30||pB(l,t,i)}f.memoizedState=i;var _={value:i,getSnapshot:t};return f.queue=_,JO(gB.bind(null,l,_,e),[e]),l.flags|=2048,rb(9,mB.bind(null,l,_,i,t),void 0,null),i},useId:function(){var e=zu(),t=ta.identifierPrefix;if(to){var i=Bd,l=Fd;i=(l&~(1<<32-au(l)-1)).toString(32)+i,t=":"+t+"R"+i,i=eb++,0<i&&(t+="H"+i.toString(32)),t+=":"}else i=n7++,t=":"+t+"r"+i.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},l7={readContext:_c,useCallback:TB,useContext:_c,useEffect:zk,useImperativeHandle:SB,useInsertionEffect:xB,useLayoutEffect:bB,useMemo:EB,useReducer:dA,useRef:vB,useState:function(){return dA(tb)},useDebugValue:Fk,useDeferredValue:function(e){var t=yc();return CB(t,Ho.memoizedState,e)},useTransition:function(){var e=dA(tb)[0],t=yc().memoizedState;return[e,t]},useMutableSource:hB,useSyncExternalStore:fB,useId:AB,unstable_isNewReconciler:!1},c7={readContext:_c,useCallback:TB,useContext:_c,useEffect:zk,useImperativeHandle:SB,useInsertionEffect:xB,useLayoutEffect:bB,useMemo:EB,useReducer:hA,useRef:vB,useState:function(){return hA(tb)},useDebugValue:Fk,useDeferredValue:function(e){var t=yc();return Ho===null?t.memoizedState=e:CB(t,Ho.memoizedState,e)},useTransition:function(){var e=hA(tb)[0],t=yc().memoizedState;return[e,t]},useMutableSource:hB,useSyncExternalStore:fB,useId:AB,unstable_isNewReconciler:!1};function Yc(e,t){if(e&&e.defaultProps){t=uo({},t),e=e.defaultProps;for(var i in e)t[i]===void 0&&(t[i]=e[i]);return t}return t}function Rj(e,t,i,l){t=e.memoizedState,i=i(l,t),i=i==null?t:uo({},t,i),e.memoizedState=i,e.lanes===0&&(e.updateQueue.baseState=i)}var e2={isMounted:function(e){return(e=e._reactInternals)?qm(e)===e:!1},enqueueSetState:function(e,t,i){e=e._reactInternals;var l=Ja(),f=jf(e),_=Gd(l,f);_.payload=t,i!=null&&(_.callback=i),t=Cf(e,_,f),t!==null&&(lu(t,e,f,l),jS(t,e,f))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var l=Ja(),f=jf(e),_=Gd(l,f);_.tag=1,_.payload=t,i!=null&&(_.callback=i),t=Cf(e,_,f),t!==null&&(lu(t,e,f,l),jS(t,e,f))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=Ja(),l=jf(e),f=Gd(i,l);f.tag=2,t!=null&&(f.callback=t),t=Cf(e,f,l),t!==null&&(lu(t,e,l,i),jS(t,e,l))}};function QO(e,t,i,l,f,_,x){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(l,_,x):t.prototype&&t.prototype.isPureReactComponent?!Z0(i,l)||!Z0(f,_):!0}function PB(e,t,i){var l=!1,f=Df,_=t.contextType;return typeof _=="object"&&_!==null?_=_c(_):(f=El(t)?jm:Aa.current,l=t.contextTypes,_=(l=l!=null)?vy(e,f):Df),t=new t(i,_),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=e2,e.stateNode=t,t._reactInternals=e,l&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=f,e.__reactInternalMemoizedMaskedChildContext=_),t}function eL(e,t,i,l){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(i,l),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(i,l),t.state!==e&&e2.enqueueReplaceState(t,t.state,null)}function Mj(e,t,i,l){var f=e.stateNode;f.props=i,f.state=e.memoizedState,f.refs={},Pk(e);var _=t.contextType;typeof _=="object"&&_!==null?f.context=_c(_):(_=El(t)?jm:Aa.current,f.context=vy(e,_)),f.state=e.memoizedState,_=t.getDerivedStateFromProps,typeof _=="function"&&(Rj(e,t,_,i),f.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof f.getSnapshotBeforeUpdate=="function"||typeof f.UNSAFE_componentWillMount!="function"&&typeof f.componentWillMount!="function"||(t=f.state,typeof f.componentWillMount=="function"&&f.componentWillMount(),typeof f.UNSAFE_componentWillMount=="function"&&f.UNSAFE_componentWillMount(),t!==f.state&&e2.enqueueReplaceState(f,f.state,null),lT(e,i,f,l),f.state=e.memoizedState),typeof f.componentDidMount=="function"&&(e.flags|=4194308)}function Sy(e,t){try{var i="",l=t;do i+=LW(l),l=l.return;while(l);var f=i}catch(_){f=`
Error generating stack: `+_.message+`
`+_.stack}return{value:e,source:t,stack:f,digest:null}}function fA(e,t,i){return{value:e,source:null,stack:i??null,digest:t??null}}function Nj(e,t){try{console.error(t.value)}catch(i){setTimeout(function(){throw i})}}var u7=typeof WeakMap=="function"?WeakMap:Map;function RB(e,t,i){i=Gd(-1,i),i.tag=3,i.payload={element:null};var l=t.value;return i.callback=function(){fT||(fT=!0,qj=l),Nj(e,t)},i}function MB(e,t,i){i=Gd(-1,i),i.tag=3;var l=e.type.getDerivedStateFromError;if(typeof l=="function"){var f=t.value;i.payload=function(){return l(f)},i.callback=function(){Nj(e,t)}}var _=e.stateNode;return _!==null&&typeof _.componentDidCatch=="function"&&(i.callback=function(){Nj(e,t),typeof l!="function"&&(Af===null?Af=new Set([this]):Af.add(this));var x=t.stack;this.componentDidCatch(t.value,{componentStack:x!==null?x:""})}),i}function tL(e,t,i){var l=e.pingCache;if(l===null){l=e.pingCache=new u7;var f=new Set;l.set(t,f)}else f=l.get(t),f===void 0&&(f=new Set,l.set(t,f));f.has(i)||(f.add(i),e=T7.bind(null,e,t,i),t.then(e,e))}function rL(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function nL(e,t,i,l,f){return e.mode&1?(e.flags|=65536,e.lanes=f,e):(e===t?e.flags|=65536:(e.flags|=128,i.flags|=131072,i.flags&=-52805,i.tag===1&&(i.alternate===null?i.tag=17:(t=Gd(-1,1),t.tag=2,Cf(i,t,1))),i.lanes|=1),e)}var d7=th.ReactCurrentOwner,wl=!1;function Wa(e,t,i,l){t.child=e===null?lB(t,null,i,l):by(t,e.child,i,l)}function iL(e,t,i,l,f){i=i.render;var _=t.ref;return J_(t,f),l=Ok(e,t,i,l,_,f),i=Lk(),e!==null&&!wl?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~f,Jd(e,t,f)):(to&&i&&Tk(t),t.flags|=1,Wa(e,t,l,f),t.child)}function sL(e,t,i,l,f){if(e===null){var _=i.type;return typeof _=="function"&&!Wk(_)&&_.defaultProps===void 0&&i.compare===null&&i.defaultProps===void 0?(t.tag=15,t.type=_,NB(e,t,_,l,f)):(e=NS(i.type,null,l,t,t.mode,f),e.ref=t.ref,e.return=t,t.child=e)}if(_=e.child,!(e.lanes&f)){var x=_.memoizedProps;if(i=i.compare,i=i!==null?i:Z0,i(x,l)&&e.ref===t.ref)return Jd(e,t,f)}return t.flags|=1,e=If(_,l),e.ref=t.ref,e.return=t,t.child=e}function NB(e,t,i,l,f){if(e!==null){var _=e.memoizedProps;if(Z0(_,l)&&e.ref===t.ref)if(wl=!1,t.pendingProps=l=_,(e.lanes&f)!==0)e.flags&131072&&(wl=!0);else return t.lanes=e.lanes,Jd(e,t,f)}return Dj(e,t,i,l,f)}function DB(e,t,i){var l=t.pendingProps,f=l.children,_=e!==null?e.memoizedState:null;if(l.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Bs(G_,zl),zl|=i;else{if(!(i&1073741824))return e=_!==null?_.baseLanes|i:i,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Bs(G_,zl),zl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},l=_!==null?_.baseLanes:i,Bs(G_,zl),zl|=l}else _!==null?(l=_.baseLanes|i,t.memoizedState=null):l=i,Bs(G_,zl),zl|=l;return Wa(e,t,f,i),t.child}function OB(e,t){var i=t.ref;(e===null&&i!==null||e!==null&&e.ref!==i)&&(t.flags|=512,t.flags|=2097152)}function Dj(e,t,i,l,f){var _=El(i)?jm:Aa.current;return _=vy(t,_),J_(t,f),i=Ok(e,t,i,l,_,f),l=Lk(),e!==null&&!wl?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~f,Jd(e,t,f)):(to&&l&&Tk(t),t.flags|=1,Wa(e,t,i,f),t.child)}function oL(e,t,i,l,f){if(El(i)){var _=!0;nT(t)}else _=!1;if(J_(t,f),t.stateNode===null)PS(e,t),PB(t,i,l),Mj(t,i,l,f),l=!0;else if(e===null){var x=t.stateNode,o=t.memoizedProps;x.props=o;var A=x.context,I=i.contextType;typeof I=="object"&&I!==null?I=_c(I):(I=El(i)?jm:Aa.current,I=vy(t,I));var N=i.getDerivedStateFromProps,U=typeof N=="function"||typeof x.getSnapshotBeforeUpdate=="function";U||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(o!==l||A!==I)&&eL(t,x,l,I),nf=!1;var $=t.memoizedState;x.state=$,lT(t,l,x,f),A=t.memoizedState,o!==l||$!==A||Tl.current||nf?(typeof N=="function"&&(Rj(t,i,N,l),A=t.memoizedState),(o=nf||QO(t,i,o,l,$,A,I))?(U||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount()),typeof x.componentDidMount=="function"&&(t.flags|=4194308)):(typeof x.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=l,t.memoizedState=A),x.props=l,x.state=A,x.context=I,l=o):(typeof x.componentDidMount=="function"&&(t.flags|=4194308),l=!1)}else{x=t.stateNode,uB(e,t),o=t.memoizedProps,I=t.type===t.elementType?o:Yc(t.type,o),x.props=I,U=t.pendingProps,$=x.context,A=i.contextType,typeof A=="object"&&A!==null?A=_c(A):(A=El(i)?jm:Aa.current,A=vy(t,A));var V=i.getDerivedStateFromProps;(N=typeof V=="function"||typeof x.getSnapshotBeforeUpdate=="function")||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(o!==U||$!==A)&&eL(t,x,l,A),nf=!1,$=t.memoizedState,x.state=$,lT(t,l,x,f);var Y=t.memoizedState;o!==U||$!==Y||Tl.current||nf?(typeof V=="function"&&(Rj(t,i,V,l),Y=t.memoizedState),(I=nf||QO(t,i,I,l,$,Y,A)||!1)?(N||typeof x.UNSAFE_componentWillUpdate!="function"&&typeof x.componentWillUpdate!="function"||(typeof x.componentWillUpdate=="function"&&x.componentWillUpdate(l,Y,A),typeof x.UNSAFE_componentWillUpdate=="function"&&x.UNSAFE_componentWillUpdate(l,Y,A)),typeof x.componentDidUpdate=="function"&&(t.flags|=4),typeof x.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof x.componentDidUpdate!="function"||o===e.memoizedProps&&$===e.memoizedState||(t.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&$===e.memoizedState||(t.flags|=1024),t.memoizedProps=l,t.memoizedState=Y),x.props=l,x.state=Y,x.context=A,l=I):(typeof x.componentDidUpdate!="function"||o===e.memoizedProps&&$===e.memoizedState||(t.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&$===e.memoizedState||(t.flags|=1024),l=!1)}return Oj(e,t,i,l,_,f)}function Oj(e,t,i,l,f,_){OB(e,t);var x=(t.flags&128)!==0;if(!l&&!x)return f&&GO(t,i,!1),Jd(e,t,_);l=t.stateNode,d7.current=t;var o=x&&typeof i.getDerivedStateFromError!="function"?null:l.render();return t.flags|=1,e!==null&&x?(t.child=by(t,e.child,null,_),t.child=by(t,null,o,_)):Wa(e,t,o,_),t.memoizedState=l.state,f&&GO(t,i,!0),t.child}function LB(e){var t=e.stateNode;t.pendingContext?qO(e,t.pendingContext,t.pendingContext!==t.context):t.context&&qO(e,t.context,!1),Rk(e,t.containerInfo)}function aL(e,t,i,l,f){return xy(),Ck(f),t.flags|=256,Wa(e,t,i,l),t.child}var Lj={dehydrated:null,treeContext:null,retryLane:0};function zj(e){return{baseLanes:e,cachePool:null,transitions:null}}function zB(e,t,i){var l=t.pendingProps,f=ao.current,_=!1,x=(t.flags&128)!==0,o;if((o=x)||(o=e!==null&&e.memoizedState===null?!1:(f&2)!==0),o?(_=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(f|=1),Bs(ao,f&1),e===null)return kj(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(x=l.children,e=l.fallback,_?(l=t.mode,_=t.child,x={mode:"hidden",children:x},!(l&1)&&_!==null?(_.childLanes=0,_.pendingProps=x):_=n2(x,l,0,null),e=Em(e,l,i,null),_.return=t,e.return=t,_.sibling=e,t.child=_,t.child.memoizedState=zj(i),t.memoizedState=Lj,e):Bk(t,x));if(f=e.memoizedState,f!==null&&(o=f.dehydrated,o!==null))return h7(e,t,x,l,o,f,i);if(_){_=l.fallback,x=t.mode,f=e.child,o=f.sibling;var A={mode:"hidden",children:l.children};return!(x&1)&&t.child!==f?(l=t.child,l.childLanes=0,l.pendingProps=A,t.deletions=null):(l=If(f,A),l.subtreeFlags=f.subtreeFlags&14680064),o!==null?_=If(o,_):(_=Em(_,x,i,null),_.flags|=2),_.return=t,l.return=t,l.sibling=_,t.child=l,l=_,_=t.child,x=e.child.memoizedState,x=x===null?zj(i):{baseLanes:x.baseLanes|i,cachePool:null,transitions:x.transitions},_.memoizedState=x,_.childLanes=e.childLanes&~i,t.memoizedState=Lj,l}return _=e.child,e=_.sibling,l=If(_,{mode:"visible",children:l.children}),!(t.mode&1)&&(l.lanes=i),l.return=t,l.sibling=null,e!==null&&(i=t.deletions,i===null?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=l,t.memoizedState=null,l}function Bk(e,t){return t=n2({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function K1(e,t,i,l){return l!==null&&Ck(l),by(t,e.child,null,i),e=Bk(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function h7(e,t,i,l,f,_,x){if(i)return t.flags&256?(t.flags&=-257,l=fA(Error(Er(422))),K1(e,t,x,l)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(_=l.fallback,f=t.mode,l=n2({mode:"visible",children:l.children},f,0,null),_=Em(_,f,x,null),_.flags|=2,l.return=t,_.return=t,l.sibling=_,t.child=l,t.mode&1&&by(t,e.child,null,x),t.child.memoizedState=zj(x),t.memoizedState=Lj,_);if(!(t.mode&1))return K1(e,t,x,null);if(f.data==="$!"){if(l=f.nextSibling&&f.nextSibling.dataset,l)var o=l.dgst;return l=o,_=Error(Er(419)),l=fA(_,l,void 0),K1(e,t,x,l)}if(o=(x&e.childLanes)!==0,wl||o){if(l=ta,l!==null){switch(x&-x){case 4:f=2;break;case 16:f=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:f=32;break;case 536870912:f=268435456;break;default:f=0}f=f&(l.suspendedLanes|x)?0:f,f!==0&&f!==_.retryLane&&(_.retryLane=f,Yd(e,f),lu(l,e,f,-1))}return Hk(),l=fA(Error(Er(421))),K1(e,t,x,l)}return f.data==="$?"?(t.flags|=128,t.child=e.child,t=E7.bind(null,e),f._reactRetry=t,null):(e=_.treeContext,$l=Ef(f.nextSibling),ql=t,to=!0,nu=null,e!==null&&(hc[fc++]=Fd,hc[fc++]=Bd,hc[fc++]=Im,Fd=e.id,Bd=e.overflow,Im=t),t=Bk(t,l.children),t.flags|=4096,t)}function lL(e,t,i){e.lanes|=t;var l=e.alternate;l!==null&&(l.lanes|=t),Pj(e.return,t,i)}function pA(e,t,i,l,f){var _=e.memoizedState;_===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:l,tail:i,tailMode:f}:(_.isBackwards=t,_.rendering=null,_.renderingStartTime=0,_.last=l,_.tail=i,_.tailMode=f)}function FB(e,t,i){var l=t.pendingProps,f=l.revealOrder,_=l.tail;if(Wa(e,t,l.children,i),l=ao.current,l&2)l=l&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&lL(e,i,t);else if(e.tag===19)lL(e,i,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}l&=1}if(Bs(ao,l),!(t.mode&1))t.memoizedState=null;else switch(f){case"forwards":for(i=t.child,f=null;i!==null;)e=i.alternate,e!==null&&cT(e)===null&&(f=i),i=i.sibling;i=f,i===null?(f=t.child,t.child=null):(f=i.sibling,i.sibling=null),pA(t,!1,f,i,_);break;case"backwards":for(i=null,f=t.child,t.child=null;f!==null;){if(e=f.alternate,e!==null&&cT(e)===null){t.child=f;break}e=f.sibling,f.sibling=i,i=f,f=e}pA(t,!0,i,null,_);break;case"together":pA(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function PS(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Jd(e,t,i){if(e!==null&&(t.dependencies=e.dependencies),Pm|=t.lanes,!(i&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Er(153));if(t.child!==null){for(e=t.child,i=If(e,e.pendingProps),t.child=i,i.return=t;e.sibling!==null;)e=e.sibling,i=i.sibling=If(e,e.pendingProps),i.return=t;i.sibling=null}return t.child}function f7(e,t,i){switch(t.tag){case 3:LB(t),xy();break;case 5:dB(t);break;case 1:El(t.type)&&nT(t);break;case 4:Rk(t,t.stateNode.containerInfo);break;case 10:var l=t.type._context,f=t.memoizedProps.value;Bs(oT,l._currentValue),l._currentValue=f;break;case 13:if(l=t.memoizedState,l!==null)return l.dehydrated!==null?(Bs(ao,ao.current&1),t.flags|=128,null):i&t.child.childLanes?zB(e,t,i):(Bs(ao,ao.current&1),e=Jd(e,t,i),e!==null?e.sibling:null);Bs(ao,ao.current&1);break;case 19:if(l=(i&t.childLanes)!==0,e.flags&128){if(l)return FB(e,t,i);t.flags|=128}if(f=t.memoizedState,f!==null&&(f.rendering=null,f.tail=null,f.lastEffect=null),Bs(ao,ao.current),l)break;return null;case 22:case 23:return t.lanes=0,DB(e,t,i)}return Jd(e,t,i)}var BB,Fj,VB,UB;BB=function(e,t){for(var i=t.child;i!==null;){if(i.tag===5||i.tag===6)e.appendChild(i.stateNode);else if(i.tag!==4&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};Fj=function(){};VB=function(e,t,i,l){var f=e.memoizedProps;if(f!==l){e=t.stateNode,hm(Yu.current);var _=null;switch(i){case"input":f=aj(e,f),l=aj(e,l),_=[];break;case"select":f=uo({},f,{value:void 0}),l=uo({},l,{value:void 0}),_=[];break;case"textarea":f=uj(e,f),l=uj(e,l),_=[];break;default:typeof f.onClick!="function"&&typeof l.onClick=="function"&&(e.onclick=tT)}hj(i,l);var x;i=null;for(I in f)if(!l.hasOwnProperty(I)&&f.hasOwnProperty(I)&&f[I]!=null)if(I==="style"){var o=f[I];for(x in o)o.hasOwnProperty(x)&&(i||(i={}),i[x]="")}else I!=="dangerouslySetInnerHTML"&&I!=="children"&&I!=="suppressContentEditableWarning"&&I!=="suppressHydrationWarning"&&I!=="autoFocus"&&(V0.hasOwnProperty(I)?_||(_=[]):(_=_||[]).push(I,null));for(I in l){var A=l[I];if(o=f!=null?f[I]:void 0,l.hasOwnProperty(I)&&A!==o&&(A!=null||o!=null))if(I==="style")if(o){for(x in o)!o.hasOwnProperty(x)||A&&A.hasOwnProperty(x)||(i||(i={}),i[x]="");for(x in A)A.hasOwnProperty(x)&&o[x]!==A[x]&&(i||(i={}),i[x]=A[x])}else i||(_||(_=[]),_.push(I,i)),i=A;else I==="dangerouslySetInnerHTML"?(A=A?A.__html:void 0,o=o?o.__html:void 0,A!=null&&o!==A&&(_=_||[]).push(I,A)):I==="children"?typeof A!="string"&&typeof A!="number"||(_=_||[]).push(I,""+A):I!=="suppressContentEditableWarning"&&I!=="suppressHydrationWarning"&&(V0.hasOwnProperty(I)?(A!=null&&I==="onScroll"&&Xs("scroll",e),_||o===A||(_=[])):(_=_||[]).push(I,A))}i&&(_=_||[]).push("style",i);var I=_;(t.updateQueue=I)&&(t.flags|=4)}};UB=function(e,t,i,l){i!==l&&(t.flags|=4)};function c0(e,t){if(!to)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var l=null;i!==null;)i.alternate!==null&&(l=i),i=i.sibling;l===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:l.sibling=null}}function ba(e){var t=e.alternate!==null&&e.alternate.child===e.child,i=0,l=0;if(t)for(var f=e.child;f!==null;)i|=f.lanes|f.childLanes,l|=f.subtreeFlags&14680064,l|=f.flags&14680064,f.return=e,f=f.sibling;else for(f=e.child;f!==null;)i|=f.lanes|f.childLanes,l|=f.subtreeFlags,l|=f.flags,f.return=e,f=f.sibling;return e.subtreeFlags|=l,e.childLanes=i,t}function p7(e,t,i){var l=t.pendingProps;switch(Ek(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ba(t),null;case 1:return El(t.type)&&rT(),ba(t),null;case 3:return l=t.stateNode,wy(),Ys(Tl),Ys(Aa),Nk(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(e===null||e.child===null)&&(Z1(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,nu!==null&&(Wj(nu),nu=null))),Fj(e,t),ba(t),null;case 5:Mk(t);var f=hm(Q0.current);if(i=t.type,e!==null&&t.stateNode!=null)VB(e,t,i,l,f),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!l){if(t.stateNode===null)throw Error(Er(166));return ba(t),null}if(e=hm(Yu.current),Z1(t)){l=t.stateNode,i=t.type;var _=t.memoizedProps;switch(l[Uu]=t,l[Y0]=_,e=(t.mode&1)!==0,i){case"dialog":Xs("cancel",l),Xs("close",l);break;case"iframe":case"object":case"embed":Xs("load",l);break;case"video":case"audio":for(f=0;f<v0.length;f++)Xs(v0[f],l);break;case"source":Xs("error",l);break;case"img":case"image":case"link":Xs("error",l),Xs("load",l);break;case"details":Xs("toggle",l);break;case"input":_O(l,_),Xs("invalid",l);break;case"select":l._wrapperState={wasMultiple:!!_.multiple},Xs("invalid",l);break;case"textarea":vO(l,_),Xs("invalid",l)}hj(i,_),f=null;for(var x in _)if(_.hasOwnProperty(x)){var o=_[x];x==="children"?typeof o=="string"?l.textContent!==o&&(_.suppressHydrationWarning!==!0&&W1(l.textContent,o,e),f=["children",o]):typeof o=="number"&&l.textContent!==""+o&&(_.suppressHydrationWarning!==!0&&W1(l.textContent,o,e),f=["children",""+o]):V0.hasOwnProperty(x)&&o!=null&&x==="onScroll"&&Xs("scroll",l)}switch(i){case"input":F1(l),yO(l,_,!0);break;case"textarea":F1(l),xO(l);break;case"select":case"option":break;default:typeof _.onClick=="function"&&(l.onclick=tT)}l=f,t.updateQueue=l,l!==null&&(t.flags|=4)}else{x=f.nodeType===9?f:f.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=g3(i)),e==="http://www.w3.org/1999/xhtml"?i==="script"?(e=x.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof l.is=="string"?e=x.createElement(i,{is:l.is}):(e=x.createElement(i),i==="select"&&(x=e,l.multiple?x.multiple=!0:l.size&&(x.size=l.size))):e=x.createElementNS(e,i),e[Uu]=t,e[Y0]=l,BB(e,t,!1,!1),t.stateNode=e;e:{switch(x=fj(i,l),i){case"dialog":Xs("cancel",e),Xs("close",e),f=l;break;case"iframe":case"object":case"embed":Xs("load",e),f=l;break;case"video":case"audio":for(f=0;f<v0.length;f++)Xs(v0[f],e);f=l;break;case"source":Xs("error",e),f=l;break;case"img":case"image":case"link":Xs("error",e),Xs("load",e),f=l;break;case"details":Xs("toggle",e),f=l;break;case"input":_O(e,l),f=aj(e,l),Xs("invalid",e);break;case"option":f=l;break;case"select":e._wrapperState={wasMultiple:!!l.multiple},f=uo({},l,{value:void 0}),Xs("invalid",e);break;case"textarea":vO(e,l),f=uj(e,l),Xs("invalid",e);break;default:f=l}hj(i,f),o=f;for(_ in o)if(o.hasOwnProperty(_)){var A=o[_];_==="style"?v3(e,A):_==="dangerouslySetInnerHTML"?(A=A?A.__html:void 0,A!=null&&_3(e,A)):_==="children"?typeof A=="string"?(i!=="textarea"||A!=="")&&U0(e,A):typeof A=="number"&&U0(e,""+A):_!=="suppressContentEditableWarning"&&_!=="suppressHydrationWarning"&&_!=="autoFocus"&&(V0.hasOwnProperty(_)?A!=null&&_==="onScroll"&&Xs("scroll",e):A!=null&&uk(e,_,A,x))}switch(i){case"input":F1(e),yO(e,l,!1);break;case"textarea":F1(e),xO(e);break;case"option":l.value!=null&&e.setAttribute("value",""+Nf(l.value));break;case"select":e.multiple=!!l.multiple,_=l.value,_!=null?Z_(e,!!l.multiple,_,!1):l.defaultValue!=null&&Z_(e,!!l.multiple,l.defaultValue,!0);break;default:typeof f.onClick=="function"&&(e.onclick=tT)}switch(i){case"button":case"input":case"select":case"textarea":l=!!l.autoFocus;break e;case"img":l=!0;break e;default:l=!1}}l&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return ba(t),null;case 6:if(e&&t.stateNode!=null)UB(e,t,e.memoizedProps,l);else{if(typeof l!="string"&&t.stateNode===null)throw Error(Er(166));if(i=hm(Q0.current),hm(Yu.current),Z1(t)){if(l=t.stateNode,i=t.memoizedProps,l[Uu]=t,(_=l.nodeValue!==i)&&(e=ql,e!==null))switch(e.tag){case 3:W1(l.nodeValue,i,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&W1(l.nodeValue,i,(e.mode&1)!==0)}_&&(t.flags|=4)}else l=(i.nodeType===9?i:i.ownerDocument).createTextNode(l),l[Uu]=t,t.stateNode=l}return ba(t),null;case 13:if(Ys(ao),l=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(to&&$l!==null&&t.mode&1&&!(t.flags&128))oB(),xy(),t.flags|=98560,_=!1;else if(_=Z1(t),l!==null&&l.dehydrated!==null){if(e===null){if(!_)throw Error(Er(318));if(_=t.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(Er(317));_[Uu]=t}else xy(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;ba(t),_=!1}else nu!==null&&(Wj(nu),nu=null),_=!0;if(!_)return t.flags&65536?t:null}return t.flags&128?(t.lanes=i,t):(l=l!==null,l!==(e!==null&&e.memoizedState!==null)&&l&&(t.child.flags|=8192,t.mode&1&&(e===null||ao.current&1?Zo===0&&(Zo=3):Hk())),t.updateQueue!==null&&(t.flags|=4),ba(t),null);case 4:return wy(),Fj(e,t),e===null&&X0(t.stateNode.containerInfo),ba(t),null;case 10:return Ik(t.type._context),ba(t),null;case 17:return El(t.type)&&rT(),ba(t),null;case 19:if(Ys(ao),_=t.memoizedState,_===null)return ba(t),null;if(l=(t.flags&128)!==0,x=_.rendering,x===null)if(l)c0(_,!1);else{if(Zo!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(x=cT(e),x!==null){for(t.flags|=128,c0(_,!1),l=x.updateQueue,l!==null&&(t.updateQueue=l,t.flags|=4),t.subtreeFlags=0,l=i,i=t.child;i!==null;)_=i,e=l,_.flags&=14680066,x=_.alternate,x===null?(_.childLanes=0,_.lanes=e,_.child=null,_.subtreeFlags=0,_.memoizedProps=null,_.memoizedState=null,_.updateQueue=null,_.dependencies=null,_.stateNode=null):(_.childLanes=x.childLanes,_.lanes=x.lanes,_.child=x.child,_.subtreeFlags=0,_.deletions=null,_.memoizedProps=x.memoizedProps,_.memoizedState=x.memoizedState,_.updateQueue=x.updateQueue,_.type=x.type,e=x.dependencies,_.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),i=i.sibling;return Bs(ao,ao.current&1|2),t.child}e=e.sibling}_.tail!==null&&Eo()>Ty&&(t.flags|=128,l=!0,c0(_,!1),t.lanes=4194304)}else{if(!l)if(e=cT(x),e!==null){if(t.flags|=128,l=!0,i=e.updateQueue,i!==null&&(t.updateQueue=i,t.flags|=4),c0(_,!0),_.tail===null&&_.tailMode==="hidden"&&!x.alternate&&!to)return ba(t),null}else 2*Eo()-_.renderingStartTime>Ty&&i!==1073741824&&(t.flags|=128,l=!0,c0(_,!1),t.lanes=4194304);_.isBackwards?(x.sibling=t.child,t.child=x):(i=_.last,i!==null?i.sibling=x:t.child=x,_.last=x)}return _.tail!==null?(t=_.tail,_.rendering=t,_.tail=t.sibling,_.renderingStartTime=Eo(),t.sibling=null,i=ao.current,Bs(ao,l?i&1|2:i&1),t):(ba(t),null);case 22:case 23:return Gk(),l=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==l&&(t.flags|=8192),l&&t.mode&1?zl&1073741824&&(ba(t),t.subtreeFlags&6&&(t.flags|=8192)):ba(t),null;case 24:return null;case 25:return null}throw Error(Er(156,t.tag))}function m7(e,t){switch(Ek(t),t.tag){case 1:return El(t.type)&&rT(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return wy(),Ys(Tl),Ys(Aa),Nk(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return Mk(t),null;case 13:if(Ys(ao),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Er(340));xy()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Ys(ao),null;case 4:return wy(),null;case 10:return Ik(t.type._context),null;case 22:case 23:return Gk(),null;case 24:return null;default:return null}}var Y1=!1,Ta=!1,g7=typeof WeakSet=="function"?WeakSet:Set,mn=null;function q_(e,t){var i=e.ref;if(i!==null)if(typeof i=="function")try{i(null)}catch(l){xo(e,t,l)}else i.current=null}function Bj(e,t,i){try{i()}catch(l){xo(e,t,l)}}var cL=!1;function _7(e,t){if(Sj=JS,e=W3(),Sk(e)){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{i=(i=e.ownerDocument)&&i.defaultView||window;var l=i.getSelection&&i.getSelection();if(l&&l.rangeCount!==0){i=l.anchorNode;var f=l.anchorOffset,_=l.focusNode;l=l.focusOffset;try{i.nodeType,_.nodeType}catch{i=null;break e}var x=0,o=-1,A=-1,I=0,N=0,U=e,$=null;t:for(;;){for(var V;U!==i||f!==0&&U.nodeType!==3||(o=x+f),U!==_||l!==0&&U.nodeType!==3||(A=x+l),U.nodeType===3&&(x+=U.nodeValue.length),(V=U.firstChild)!==null;)$=U,U=V;for(;;){if(U===e)break t;if($===i&&++I===f&&(o=x),$===_&&++N===l&&(A=x),(V=U.nextSibling)!==null)break;U=$,$=U.parentNode}U=V}i=o===-1||A===-1?null:{start:o,end:A}}else i=null}i=i||{start:0,end:0}}else i=null;for(Tj={focusedElem:e,selectionRange:i},JS=!1,mn=t;mn!==null;)if(t=mn,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,mn=e;else for(;mn!==null;){t=mn;try{var Y=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(Y!==null){var q=Y.memoizedProps,Z=Y.memoizedState,Q=t.stateNode,H=Q.getSnapshotBeforeUpdate(t.elementType===t.type?q:Yc(t.type,q),Z);Q.__reactInternalSnapshotBeforeUpdate=H}break;case 3:var K=t.stateNode.containerInfo;K.nodeType===1?K.textContent="":K.nodeType===9&&K.documentElement&&K.removeChild(K.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Er(163))}}catch(ne){xo(t,t.return,ne)}if(e=t.sibling,e!==null){e.return=t.return,mn=e;break}mn=t.return}return Y=cL,cL=!1,Y}function P0(e,t,i){var l=t.updateQueue;if(l=l!==null?l.lastEffect:null,l!==null){var f=l=l.next;do{if((f.tag&e)===e){var _=f.destroy;f.destroy=void 0,_!==void 0&&Bj(t,i,_)}f=f.next}while(f!==l)}}function t2(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var i=t=t.next;do{if((i.tag&e)===e){var l=i.create;i.destroy=l()}i=i.next}while(i!==t)}}function Vj(e){var t=e.ref;if(t!==null){var i=e.stateNode;switch(e.tag){case 5:e=i;break;default:e=i}typeof t=="function"?t(e):t.current=e}}function $B(e){var t=e.alternate;t!==null&&(e.alternate=null,$B(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Uu],delete t[Y0],delete t[Aj],delete t[Q9],delete t[e7])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function qB(e){return e.tag===5||e.tag===3||e.tag===4}function uL(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||qB(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Uj(e,t,i){var l=e.tag;if(l===5||l===6)e=e.stateNode,t?i.nodeType===8?i.parentNode.insertBefore(e,t):i.insertBefore(e,t):(i.nodeType===8?(t=i.parentNode,t.insertBefore(e,i)):(t=i,t.appendChild(e)),i=i._reactRootContainer,i!=null||t.onclick!==null||(t.onclick=tT));else if(l!==4&&(e=e.child,e!==null))for(Uj(e,t,i),e=e.sibling;e!==null;)Uj(e,t,i),e=e.sibling}function $j(e,t,i){var l=e.tag;if(l===5||l===6)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(l!==4&&(e=e.child,e!==null))for($j(e,t,i),e=e.sibling;e!==null;)$j(e,t,i),e=e.sibling}var la=null,tu=!1;function Xh(e,t,i){for(i=i.child;i!==null;)GB(e,t,i),i=i.sibling}function GB(e,t,i){if(Ku&&typeof Ku.onCommitFiberUnmount=="function")try{Ku.onCommitFiberUnmount(WT,i)}catch{}switch(i.tag){case 5:Ta||q_(i,t);case 6:var l=la,f=tu;la=null,Xh(e,t,i),la=l,tu=f,la!==null&&(tu?(e=la,i=i.stateNode,e.nodeType===8?e.parentNode.removeChild(i):e.removeChild(i)):la.removeChild(i.stateNode));break;case 18:la!==null&&(tu?(e=la,i=i.stateNode,e.nodeType===8?aA(e.parentNode,i):e.nodeType===1&&aA(e,i),H0(e)):aA(la,i.stateNode));break;case 4:l=la,f=tu,la=i.stateNode.containerInfo,tu=!0,Xh(e,t,i),la=l,tu=f;break;case 0:case 11:case 14:case 15:if(!Ta&&(l=i.updateQueue,l!==null&&(l=l.lastEffect,l!==null))){f=l=l.next;do{var _=f,x=_.destroy;_=_.tag,x!==void 0&&(_&2||_&4)&&Bj(i,t,x),f=f.next}while(f!==l)}Xh(e,t,i);break;case 1:if(!Ta&&(q_(i,t),l=i.stateNode,typeof l.componentWillUnmount=="function"))try{l.props=i.memoizedProps,l.state=i.memoizedState,l.componentWillUnmount()}catch(o){xo(i,t,o)}Xh(e,t,i);break;case 21:Xh(e,t,i);break;case 22:i.mode&1?(Ta=(l=Ta)||i.memoizedState!==null,Xh(e,t,i),Ta=l):Xh(e,t,i);break;default:Xh(e,t,i)}}function dL(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var i=e.stateNode;i===null&&(i=e.stateNode=new g7),t.forEach(function(l){var f=C7.bind(null,e,l);i.has(l)||(i.add(l),l.then(f,f))})}}function Hc(e,t){var i=t.deletions;if(i!==null)for(var l=0;l<i.length;l++){var f=i[l];try{var _=e,x=t,o=x;e:for(;o!==null;){switch(o.tag){case 5:la=o.stateNode,tu=!1;break e;case 3:la=o.stateNode.containerInfo,tu=!0;break e;case 4:la=o.stateNode.containerInfo,tu=!0;break e}o=o.return}if(la===null)throw Error(Er(160));GB(_,x,f),la=null,tu=!1;var A=f.alternate;A!==null&&(A.return=null),f.return=null}catch(I){xo(f,t,I)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)HB(t,e),t=t.sibling}function HB(e,t){var i=e.alternate,l=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Hc(t,e),Lu(e),l&4){try{P0(3,e,e.return),t2(3,e)}catch(q){xo(e,e.return,q)}try{P0(5,e,e.return)}catch(q){xo(e,e.return,q)}}break;case 1:Hc(t,e),Lu(e),l&512&&i!==null&&q_(i,i.return);break;case 5:if(Hc(t,e),Lu(e),l&512&&i!==null&&q_(i,i.return),e.flags&32){var f=e.stateNode;try{U0(f,"")}catch(q){xo(e,e.return,q)}}if(l&4&&(f=e.stateNode,f!=null)){var _=e.memoizedProps,x=i!==null?i.memoizedProps:_,o=e.type,A=e.updateQueue;if(e.updateQueue=null,A!==null)try{o==="input"&&_.type==="radio"&&_.name!=null&&p3(f,_),fj(o,x);var I=fj(o,_);for(x=0;x<A.length;x+=2){var N=A[x],U=A[x+1];N==="style"?v3(f,U):N==="dangerouslySetInnerHTML"?_3(f,U):N==="children"?U0(f,U):uk(f,N,U,I)}switch(o){case"input":lj(f,_);break;case"textarea":m3(f,_);break;case"select":var $=f._wrapperState.wasMultiple;f._wrapperState.wasMultiple=!!_.multiple;var V=_.value;V!=null?Z_(f,!!_.multiple,V,!1):$!==!!_.multiple&&(_.defaultValue!=null?Z_(f,!!_.multiple,_.defaultValue,!0):Z_(f,!!_.multiple,_.multiple?[]:"",!1))}f[Y0]=_}catch(q){xo(e,e.return,q)}}break;case 6:if(Hc(t,e),Lu(e),l&4){if(e.stateNode===null)throw Error(Er(162));f=e.stateNode,_=e.memoizedProps;try{f.nodeValue=_}catch(q){xo(e,e.return,q)}}break;case 3:if(Hc(t,e),Lu(e),l&4&&i!==null&&i.memoizedState.isDehydrated)try{H0(t.containerInfo)}catch(q){xo(e,e.return,q)}break;case 4:Hc(t,e),Lu(e);break;case 13:Hc(t,e),Lu(e),f=e.child,f.flags&8192&&(_=f.memoizedState!==null,f.stateNode.isHidden=_,!_||f.alternate!==null&&f.alternate.memoizedState!==null||($k=Eo())),l&4&&dL(e);break;case 22:if(N=i!==null&&i.memoizedState!==null,e.mode&1?(Ta=(I=Ta)||N,Hc(t,e),Ta=I):Hc(t,e),Lu(e),l&8192){if(I=e.memoizedState!==null,(e.stateNode.isHidden=I)&&!N&&e.mode&1)for(mn=e,N=e.child;N!==null;){for(U=mn=N;mn!==null;){switch($=mn,V=$.child,$.tag){case 0:case 11:case 14:case 15:P0(4,$,$.return);break;case 1:q_($,$.return);var Y=$.stateNode;if(typeof Y.componentWillUnmount=="function"){l=$,i=$.return;try{t=l,Y.props=t.memoizedProps,Y.state=t.memoizedState,Y.componentWillUnmount()}catch(q){xo(l,i,q)}}break;case 5:q_($,$.return);break;case 22:if($.memoizedState!==null){fL(U);continue}}V!==null?(V.return=$,mn=V):fL(U)}N=N.sibling}e:for(N=null,U=e;;){if(U.tag===5){if(N===null){N=U;try{f=U.stateNode,I?(_=f.style,typeof _.setProperty=="function"?_.setProperty("display","none","important"):_.display="none"):(o=U.stateNode,A=U.memoizedProps.style,x=A!=null&&A.hasOwnProperty("display")?A.display:null,o.style.display=y3("display",x))}catch(q){xo(e,e.return,q)}}}else if(U.tag===6){if(N===null)try{U.stateNode.nodeValue=I?"":U.memoizedProps}catch(q){xo(e,e.return,q)}}else if((U.tag!==22&&U.tag!==23||U.memoizedState===null||U===e)&&U.child!==null){U.child.return=U,U=U.child;continue}if(U===e)break e;for(;U.sibling===null;){if(U.return===null||U.return===e)break e;N===U&&(N=null),U=U.return}N===U&&(N=null),U.sibling.return=U.return,U=U.sibling}}break;case 19:Hc(t,e),Lu(e),l&4&&dL(e);break;case 21:break;default:Hc(t,e),Lu(e)}}function Lu(e){var t=e.flags;if(t&2){try{e:{for(var i=e.return;i!==null;){if(qB(i)){var l=i;break e}i=i.return}throw Error(Er(160))}switch(l.tag){case 5:var f=l.stateNode;l.flags&32&&(U0(f,""),l.flags&=-33);var _=uL(e);$j(e,_,f);break;case 3:case 4:var x=l.stateNode.containerInfo,o=uL(e);Uj(e,o,x);break;default:throw Error(Er(161))}}catch(A){xo(e,e.return,A)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function y7(e,t,i){mn=e,WB(e)}function WB(e,t,i){for(var l=(e.mode&1)!==0;mn!==null;){var f=mn,_=f.child;if(f.tag===22&&l){var x=f.memoizedState!==null||Y1;if(!x){var o=f.alternate,A=o!==null&&o.memoizedState!==null||Ta;o=Y1;var I=Ta;if(Y1=x,(Ta=A)&&!I)for(mn=f;mn!==null;)x=mn,A=x.child,x.tag===22&&x.memoizedState!==null?pL(f):A!==null?(A.return=x,mn=A):pL(f);for(;_!==null;)mn=_,WB(_),_=_.sibling;mn=f,Y1=o,Ta=I}hL(e)}else f.subtreeFlags&8772&&_!==null?(_.return=f,mn=_):hL(e)}}function hL(e){for(;mn!==null;){var t=mn;if(t.flags&8772){var i=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Ta||t2(5,t);break;case 1:var l=t.stateNode;if(t.flags&4&&!Ta)if(i===null)l.componentDidMount();else{var f=t.elementType===t.type?i.memoizedProps:Yc(t.type,i.memoizedProps);l.componentDidUpdate(f,i.memoizedState,l.__reactInternalSnapshotBeforeUpdate)}var _=t.updateQueue;_!==null&&KO(t,_,l);break;case 3:var x=t.updateQueue;if(x!==null){if(i=null,t.child!==null)switch(t.child.tag){case 5:i=t.child.stateNode;break;case 1:i=t.child.stateNode}KO(t,x,i)}break;case 5:var o=t.stateNode;if(i===null&&t.flags&4){i=o;var A=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":A.autoFocus&&i.focus();break;case"img":A.src&&(i.src=A.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var I=t.alternate;if(I!==null){var N=I.memoizedState;if(N!==null){var U=N.dehydrated;U!==null&&H0(U)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Er(163))}Ta||t.flags&512&&Vj(t)}catch($){xo(t,t.return,$)}}if(t===e){mn=null;break}if(i=t.sibling,i!==null){i.return=t.return,mn=i;break}mn=t.return}}function fL(e){for(;mn!==null;){var t=mn;if(t===e){mn=null;break}var i=t.sibling;if(i!==null){i.return=t.return,mn=i;break}mn=t.return}}function pL(e){for(;mn!==null;){var t=mn;try{switch(t.tag){case 0:case 11:case 15:var i=t.return;try{t2(4,t)}catch(A){xo(t,i,A)}break;case 1:var l=t.stateNode;if(typeof l.componentDidMount=="function"){var f=t.return;try{l.componentDidMount()}catch(A){xo(t,f,A)}}var _=t.return;try{Vj(t)}catch(A){xo(t,_,A)}break;case 5:var x=t.return;try{Vj(t)}catch(A){xo(t,x,A)}}}catch(A){xo(t,t.return,A)}if(t===e){mn=null;break}var o=t.sibling;if(o!==null){o.return=t.return,mn=o;break}mn=t.return}}var v7=Math.ceil,hT=th.ReactCurrentDispatcher,Vk=th.ReactCurrentOwner,gc=th.ReactCurrentBatchConfig,os=0,ta=null,Oo=null,ua=0,zl=0,G_=qf(0),Zo=0,nb=null,Pm=0,r2=0,Uk=0,R0=null,bl=null,$k=0,Ty=1/0,Md=null,fT=!1,qj=null,Af=null,J1=!1,xf=null,pT=0,M0=0,Gj=null,RS=-1,MS=0;function Ja(){return os&6?Eo():RS!==-1?RS:RS=Eo()}function jf(e){return e.mode&1?os&2&&ua!==0?ua&-ua:r7.transition!==null?(MS===0&&(MS=P3()),MS):(e=Cs,e!==0||(e=window.event,e=e===void 0?16:z3(e.type)),e):1}function lu(e,t,i,l){if(50<M0)throw M0=0,Gj=null,Error(Er(185));Sb(e,i,l),(!(os&2)||e!==ta)&&(e===ta&&(!(os&2)&&(r2|=i),Zo===4&&af(e,ua)),Cl(e,l),i===1&&os===0&&!(t.mode&1)&&(Ty=Eo()+500,JT&&Gf()))}function Cl(e,t){var i=e.callbackNode;r9(e,t);var l=YS(e,e===ta?ua:0);if(l===0)i!==null&&SO(i),e.callbackNode=null,e.callbackPriority=0;else if(t=l&-l,e.callbackPriority!==t){if(i!=null&&SO(i),t===1)e.tag===0?t7(mL.bind(null,e)):nB(mL.bind(null,e)),Y9(function(){!(os&6)&&Gf()}),i=null;else{switch(R3(l)){case 1:i=mk;break;case 4:i=I3;break;case 16:i=KS;break;case 536870912:i=k3;break;default:i=KS}i=t4(i,ZB.bind(null,e))}e.callbackPriority=t,e.callbackNode=i}}function ZB(e,t){if(RS=-1,MS=0,os&6)throw Error(Er(327));var i=e.callbackNode;if(Q_()&&e.callbackNode!==i)return null;var l=YS(e,e===ta?ua:0);if(l===0)return null;if(l&30||l&e.expiredLanes||t)t=mT(e,l);else{t=l;var f=os;os|=2;var _=KB();(ta!==e||ua!==t)&&(Md=null,Ty=Eo()+500,Tm(e,t));do try{w7();break}catch(o){XB(e,o)}while(!0);jk(),hT.current=_,os=f,Oo!==null?t=0:(ta=null,ua=0,t=Zo)}if(t!==0){if(t===2&&(f=yj(e),f!==0&&(l=f,t=Hj(e,f))),t===1)throw i=nb,Tm(e,0),af(e,l),Cl(e,Eo()),i;if(t===6)af(e,l);else{if(f=e.current.alternate,!(l&30)&&!x7(f)&&(t=mT(e,l),t===2&&(_=yj(e),_!==0&&(l=_,t=Hj(e,_))),t===1))throw i=nb,Tm(e,0),af(e,l),Cl(e,Eo()),i;switch(e.finishedWork=f,e.finishedLanes=l,t){case 0:case 1:throw Error(Er(345));case 2:sm(e,bl,Md);break;case 3:if(af(e,l),(l&130023424)===l&&(t=$k+500-Eo(),10<t)){if(YS(e,0)!==0)break;if(f=e.suspendedLanes,(f&l)!==l){Ja(),e.pingedLanes|=e.suspendedLanes&f;break}e.timeoutHandle=Cj(sm.bind(null,e,bl,Md),t);break}sm(e,bl,Md);break;case 4:if(af(e,l),(l&4194240)===l)break;for(t=e.eventTimes,f=-1;0<l;){var x=31-au(l);_=1<<x,x=t[x],x>f&&(f=x),l&=~_}if(l=f,l=Eo()-l,l=(120>l?120:480>l?480:1080>l?1080:1920>l?1920:3e3>l?3e3:4320>l?4320:1960*v7(l/1960))-l,10<l){e.timeoutHandle=Cj(sm.bind(null,e,bl,Md),l);break}sm(e,bl,Md);break;case 5:sm(e,bl,Md);break;default:throw Error(Er(329))}}}return Cl(e,Eo()),e.callbackNode===i?ZB.bind(null,e):null}function Hj(e,t){var i=R0;return e.current.memoizedState.isDehydrated&&(Tm(e,t).flags|=256),e=mT(e,t),e!==2&&(t=bl,bl=i,t!==null&&Wj(t)),e}function Wj(e){bl===null?bl=e:bl.push.apply(bl,e)}function x7(e){for(var t=e;;){if(t.flags&16384){var i=t.updateQueue;if(i!==null&&(i=i.stores,i!==null))for(var l=0;l<i.length;l++){var f=i[l],_=f.getSnapshot;f=f.value;try{if(!cu(_(),f))return!1}catch{return!1}}}if(i=t.child,t.subtreeFlags&16384&&i!==null)i.return=t,t=i;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function af(e,t){for(t&=~Uk,t&=~r2,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var i=31-au(t),l=1<<i;e[i]=-1,t&=~l}}function mL(e){if(os&6)throw Error(Er(327));Q_();var t=YS(e,0);if(!(t&1))return Cl(e,Eo()),null;var i=mT(e,t);if(e.tag!==0&&i===2){var l=yj(e);l!==0&&(t=l,i=Hj(e,l))}if(i===1)throw i=nb,Tm(e,0),af(e,t),Cl(e,Eo()),i;if(i===6)throw Error(Er(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,sm(e,bl,Md),Cl(e,Eo()),null}function qk(e,t){var i=os;os|=1;try{return e(t)}finally{os=i,os===0&&(Ty=Eo()+500,JT&&Gf())}}function Rm(e){xf!==null&&xf.tag===0&&!(os&6)&&Q_();var t=os;os|=1;var i=gc.transition,l=Cs;try{if(gc.transition=null,Cs=1,e)return e()}finally{Cs=l,gc.transition=i,os=t,!(os&6)&&Gf()}}function Gk(){zl=G_.current,Ys(G_)}function Tm(e,t){e.finishedWork=null,e.finishedLanes=0;var i=e.timeoutHandle;if(i!==-1&&(e.timeoutHandle=-1,K9(i)),Oo!==null)for(i=Oo.return;i!==null;){var l=i;switch(Ek(l),l.tag){case 1:l=l.type.childContextTypes,l!=null&&rT();break;case 3:wy(),Ys(Tl),Ys(Aa),Nk();break;case 5:Mk(l);break;case 4:wy();break;case 13:Ys(ao);break;case 19:Ys(ao);break;case 10:Ik(l.type._context);break;case 22:case 23:Gk()}i=i.return}if(ta=e,Oo=e=If(e.current,null),ua=zl=t,Zo=0,nb=null,Uk=r2=Pm=0,bl=R0=null,dm!==null){for(t=0;t<dm.length;t++)if(i=dm[t],l=i.interleaved,l!==null){i.interleaved=null;var f=l.next,_=i.pending;if(_!==null){var x=_.next;_.next=f,l.next=x}i.pending=l}dm=null}return e}function XB(e,t){do{var i=Oo;try{if(jk(),IS.current=dT,uT){for(var l=lo.memoizedState;l!==null;){var f=l.queue;f!==null&&(f.pending=null),l=l.next}uT=!1}if(km=0,ea=Ho=lo=null,k0=!1,eb=0,Vk.current=null,i===null||i.return===null){Zo=1,nb=t,Oo=null;break}e:{var _=e,x=i.return,o=i,A=t;if(t=ua,o.flags|=32768,A!==null&&typeof A=="object"&&typeof A.then=="function"){var I=A,N=o,U=N.tag;if(!(N.mode&1)&&(U===0||U===11||U===15)){var $=N.alternate;$?(N.updateQueue=$.updateQueue,N.memoizedState=$.memoizedState,N.lanes=$.lanes):(N.updateQueue=null,N.memoizedState=null)}var V=rL(x);if(V!==null){V.flags&=-257,nL(V,x,o,_,t),V.mode&1&&tL(_,I,t),t=V,A=I;var Y=t.updateQueue;if(Y===null){var q=new Set;q.add(A),t.updateQueue=q}else Y.add(A);break e}else{if(!(t&1)){tL(_,I,t),Hk();break e}A=Error(Er(426))}}else if(to&&o.mode&1){var Z=rL(x);if(Z!==null){!(Z.flags&65536)&&(Z.flags|=256),nL(Z,x,o,_,t),Ck(Sy(A,o));break e}}_=A=Sy(A,o),Zo!==4&&(Zo=2),R0===null?R0=[_]:R0.push(_),_=x;do{switch(_.tag){case 3:_.flags|=65536,t&=-t,_.lanes|=t;var Q=RB(_,A,t);XO(_,Q);break e;case 1:o=A;var H=_.type,K=_.stateNode;if(!(_.flags&128)&&(typeof H.getDerivedStateFromError=="function"||K!==null&&typeof K.componentDidCatch=="function"&&(Af===null||!Af.has(K)))){_.flags|=65536,t&=-t,_.lanes|=t;var ne=MB(_,o,t);XO(_,ne);break e}}_=_.return}while(_!==null)}JB(i)}catch(le){t=le,Oo===i&&i!==null&&(Oo=i=i.return);continue}break}while(!0)}function KB(){var e=hT.current;return hT.current=dT,e===null?dT:e}function Hk(){(Zo===0||Zo===3||Zo===2)&&(Zo=4),ta===null||!(Pm&268435455)&&!(r2&268435455)||af(ta,ua)}function mT(e,t){var i=os;os|=2;var l=KB();(ta!==e||ua!==t)&&(Md=null,Tm(e,t));do try{b7();break}catch(f){XB(e,f)}while(!0);if(jk(),os=i,hT.current=l,Oo!==null)throw Error(Er(261));return ta=null,ua=0,Zo}function b7(){for(;Oo!==null;)YB(Oo)}function w7(){for(;Oo!==null&&!WW();)YB(Oo)}function YB(e){var t=e4(e.alternate,e,zl);e.memoizedProps=e.pendingProps,t===null?JB(e):Oo=t,Vk.current=null}function JB(e){var t=e;do{var i=t.alternate;if(e=t.return,t.flags&32768){if(i=m7(i,t),i!==null){i.flags&=32767,Oo=i;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Zo=6,Oo=null;return}}else if(i=p7(i,t,zl),i!==null){Oo=i;return}if(t=t.sibling,t!==null){Oo=t;return}Oo=t=e}while(t!==null);Zo===0&&(Zo=5)}function sm(e,t,i){var l=Cs,f=gc.transition;try{gc.transition=null,Cs=1,S7(e,t,i,l)}finally{gc.transition=f,Cs=l}return null}function S7(e,t,i,l){do Q_();while(xf!==null);if(os&6)throw Error(Er(327));i=e.finishedWork;var f=e.finishedLanes;if(i===null)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(Er(177));e.callbackNode=null,e.callbackPriority=0;var _=i.lanes|i.childLanes;if(n9(e,_),e===ta&&(Oo=ta=null,ua=0),!(i.subtreeFlags&2064)&&!(i.flags&2064)||J1||(J1=!0,t4(KS,function(){return Q_(),null})),_=(i.flags&15990)!==0,i.subtreeFlags&15990||_){_=gc.transition,gc.transition=null;var x=Cs;Cs=1;var o=os;os|=4,Vk.current=null,_7(e,i),HB(i,e),$9(Tj),JS=!!Sj,Tj=Sj=null,e.current=i,y7(i),ZW(),os=o,Cs=x,gc.transition=_}else e.current=i;if(J1&&(J1=!1,xf=e,pT=f),_=e.pendingLanes,_===0&&(Af=null),YW(i.stateNode),Cl(e,Eo()),t!==null)for(l=e.onRecoverableError,i=0;i<t.length;i++)f=t[i],l(f.value,{componentStack:f.stack,digest:f.digest});if(fT)throw fT=!1,e=qj,qj=null,e;return pT&1&&e.tag!==0&&Q_(),_=e.pendingLanes,_&1?e===Gj?M0++:(M0=0,Gj=e):M0=0,Gf(),null}function Q_(){if(xf!==null){var e=R3(pT),t=gc.transition,i=Cs;try{if(gc.transition=null,Cs=16>e?16:e,xf===null)var l=!1;else{if(e=xf,xf=null,pT=0,os&6)throw Error(Er(331));var f=os;for(os|=4,mn=e.current;mn!==null;){var _=mn,x=_.child;if(mn.flags&16){var o=_.deletions;if(o!==null){for(var A=0;A<o.length;A++){var I=o[A];for(mn=I;mn!==null;){var N=mn;switch(N.tag){case 0:case 11:case 15:P0(8,N,_)}var U=N.child;if(U!==null)U.return=N,mn=U;else for(;mn!==null;){N=mn;var $=N.sibling,V=N.return;if($B(N),N===I){mn=null;break}if($!==null){$.return=V,mn=$;break}mn=V}}}var Y=_.alternate;if(Y!==null){var q=Y.child;if(q!==null){Y.child=null;do{var Z=q.sibling;q.sibling=null,q=Z}while(q!==null)}}mn=_}}if(_.subtreeFlags&2064&&x!==null)x.return=_,mn=x;else e:for(;mn!==null;){if(_=mn,_.flags&2048)switch(_.tag){case 0:case 11:case 15:P0(9,_,_.return)}var Q=_.sibling;if(Q!==null){Q.return=_.return,mn=Q;break e}mn=_.return}}var H=e.current;for(mn=H;mn!==null;){x=mn;var K=x.child;if(x.subtreeFlags&2064&&K!==null)K.return=x,mn=K;else e:for(x=H;mn!==null;){if(o=mn,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:t2(9,o)}}catch(le){xo(o,o.return,le)}if(o===x){mn=null;break e}var ne=o.sibling;if(ne!==null){ne.return=o.return,mn=ne;break e}mn=o.return}}if(os=f,Gf(),Ku&&typeof Ku.onPostCommitFiberRoot=="function")try{Ku.onPostCommitFiberRoot(WT,e)}catch{}l=!0}return l}finally{Cs=i,gc.transition=t}}return!1}function gL(e,t,i){t=Sy(i,t),t=RB(e,t,1),e=Cf(e,t,1),t=Ja(),e!==null&&(Sb(e,1,t),Cl(e,t))}function xo(e,t,i){if(e.tag===3)gL(e,e,i);else for(;t!==null;){if(t.tag===3){gL(t,e,i);break}else if(t.tag===1){var l=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof l.componentDidCatch=="function"&&(Af===null||!Af.has(l))){e=Sy(i,e),e=MB(t,e,1),t=Cf(t,e,1),e=Ja(),t!==null&&(Sb(t,1,e),Cl(t,e));break}}t=t.return}}function T7(e,t,i){var l=e.pingCache;l!==null&&l.delete(t),t=Ja(),e.pingedLanes|=e.suspendedLanes&i,ta===e&&(ua&i)===i&&(Zo===4||Zo===3&&(ua&130023424)===ua&&500>Eo()-$k?Tm(e,0):Uk|=i),Cl(e,t)}function QB(e,t){t===0&&(e.mode&1?(t=U1,U1<<=1,!(U1&130023424)&&(U1=4194304)):t=1);var i=Ja();e=Yd(e,t),e!==null&&(Sb(e,t,i),Cl(e,i))}function E7(e){var t=e.memoizedState,i=0;t!==null&&(i=t.retryLane),QB(e,i)}function C7(e,t){var i=0;switch(e.tag){case 13:var l=e.stateNode,f=e.memoizedState;f!==null&&(i=f.retryLane);break;case 19:l=e.stateNode;break;default:throw Error(Er(314))}l!==null&&l.delete(t),QB(e,i)}var e4;e4=function(e,t,i){if(e!==null)if(e.memoizedProps!==t.pendingProps||Tl.current)wl=!0;else{if(!(e.lanes&i)&&!(t.flags&128))return wl=!1,f7(e,t,i);wl=!!(e.flags&131072)}else wl=!1,to&&t.flags&1048576&&iB(t,sT,t.index);switch(t.lanes=0,t.tag){case 2:var l=t.type;PS(e,t),e=t.pendingProps;var f=vy(t,Aa.current);J_(t,i),f=Ok(null,t,l,e,f,i);var _=Lk();return t.flags|=1,typeof f=="object"&&f!==null&&typeof f.render=="function"&&f.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,El(l)?(_=!0,nT(t)):_=!1,t.memoizedState=f.state!==null&&f.state!==void 0?f.state:null,Pk(t),f.updater=e2,t.stateNode=f,f._reactInternals=t,Mj(t,l,e,i),t=Oj(null,t,l,!0,_,i)):(t.tag=0,to&&_&&Tk(t),Wa(null,t,f,i),t=t.child),t;case 16:l=t.elementType;e:{switch(PS(e,t),e=t.pendingProps,f=l._init,l=f(l._payload),t.type=l,f=t.tag=j7(l),e=Yc(l,e),f){case 0:t=Dj(null,t,l,e,i);break e;case 1:t=oL(null,t,l,e,i);break e;case 11:t=iL(null,t,l,e,i);break e;case 14:t=sL(null,t,l,Yc(l.type,e),i);break e}throw Error(Er(306,l,""))}return t;case 0:return l=t.type,f=t.pendingProps,f=t.elementType===l?f:Yc(l,f),Dj(e,t,l,f,i);case 1:return l=t.type,f=t.pendingProps,f=t.elementType===l?f:Yc(l,f),oL(e,t,l,f,i);case 3:e:{if(LB(t),e===null)throw Error(Er(387));l=t.pendingProps,_=t.memoizedState,f=_.element,uB(e,t),lT(t,l,null,i);var x=t.memoizedState;if(l=x.element,_.isDehydrated)if(_={element:l,isDehydrated:!1,cache:x.cache,pendingSuspenseBoundaries:x.pendingSuspenseBoundaries,transitions:x.transitions},t.updateQueue.baseState=_,t.memoizedState=_,t.flags&256){f=Sy(Error(Er(423)),t),t=aL(e,t,l,i,f);break e}else if(l!==f){f=Sy(Error(Er(424)),t),t=aL(e,t,l,i,f);break e}else for($l=Ef(t.stateNode.containerInfo.firstChild),ql=t,to=!0,nu=null,i=lB(t,null,l,i),t.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling;else{if(xy(),l===f){t=Jd(e,t,i);break e}Wa(e,t,l,i)}t=t.child}return t;case 5:return dB(t),e===null&&kj(t),l=t.type,f=t.pendingProps,_=e!==null?e.memoizedProps:null,x=f.children,Ej(l,f)?x=null:_!==null&&Ej(l,_)&&(t.flags|=32),OB(e,t),Wa(e,t,x,i),t.child;case 6:return e===null&&kj(t),null;case 13:return zB(e,t,i);case 4:return Rk(t,t.stateNode.containerInfo),l=t.pendingProps,e===null?t.child=by(t,null,l,i):Wa(e,t,l,i),t.child;case 11:return l=t.type,f=t.pendingProps,f=t.elementType===l?f:Yc(l,f),iL(e,t,l,f,i);case 7:return Wa(e,t,t.pendingProps,i),t.child;case 8:return Wa(e,t,t.pendingProps.children,i),t.child;case 12:return Wa(e,t,t.pendingProps.children,i),t.child;case 10:e:{if(l=t.type._context,f=t.pendingProps,_=t.memoizedProps,x=f.value,Bs(oT,l._currentValue),l._currentValue=x,_!==null)if(cu(_.value,x)){if(_.children===f.children&&!Tl.current){t=Jd(e,t,i);break e}}else for(_=t.child,_!==null&&(_.return=t);_!==null;){var o=_.dependencies;if(o!==null){x=_.child;for(var A=o.firstContext;A!==null;){if(A.context===l){if(_.tag===1){A=Gd(-1,i&-i),A.tag=2;var I=_.updateQueue;if(I!==null){I=I.shared;var N=I.pending;N===null?A.next=A:(A.next=N.next,N.next=A),I.pending=A}}_.lanes|=i,A=_.alternate,A!==null&&(A.lanes|=i),Pj(_.return,i,t),o.lanes|=i;break}A=A.next}}else if(_.tag===10)x=_.type===t.type?null:_.child;else if(_.tag===18){if(x=_.return,x===null)throw Error(Er(341));x.lanes|=i,o=x.alternate,o!==null&&(o.lanes|=i),Pj(x,i,t),x=_.sibling}else x=_.child;if(x!==null)x.return=_;else for(x=_;x!==null;){if(x===t){x=null;break}if(_=x.sibling,_!==null){_.return=x.return,x=_;break}x=x.return}_=x}Wa(e,t,f.children,i),t=t.child}return t;case 9:return f=t.type,l=t.pendingProps.children,J_(t,i),f=_c(f),l=l(f),t.flags|=1,Wa(e,t,l,i),t.child;case 14:return l=t.type,f=Yc(l,t.pendingProps),f=Yc(l.type,f),sL(e,t,l,f,i);case 15:return NB(e,t,t.type,t.pendingProps,i);case 17:return l=t.type,f=t.pendingProps,f=t.elementType===l?f:Yc(l,f),PS(e,t),t.tag=1,El(l)?(e=!0,nT(t)):e=!1,J_(t,i),PB(t,l,f),Mj(t,l,f,i),Oj(null,t,l,!0,e,i);case 19:return FB(e,t,i);case 22:return DB(e,t,i)}throw Error(Er(156,t.tag))};function t4(e,t){return j3(e,t)}function A7(e,t,i,l){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=l,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function mc(e,t,i,l){return new A7(e,t,i,l)}function Wk(e){return e=e.prototype,!(!e||!e.isReactComponent)}function j7(e){if(typeof e=="function")return Wk(e)?1:0;if(e!=null){if(e=e.$$typeof,e===hk)return 11;if(e===fk)return 14}return 2}function If(e,t){var i=e.alternate;return i===null?(i=mc(e.tag,t,e.key,e.mode),i.elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=e.flags&14680064,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function NS(e,t,i,l,f,_){var x=2;if(l=e,typeof e=="function")Wk(e)&&(x=1);else if(typeof e=="string")x=5;else e:switch(e){case D_:return Em(i.children,f,_,t);case dk:x=8,f|=8;break;case nj:return e=mc(12,i,t,f|2),e.elementType=nj,e.lanes=_,e;case ij:return e=mc(13,i,t,f),e.elementType=ij,e.lanes=_,e;case sj:return e=mc(19,i,t,f),e.elementType=sj,e.lanes=_,e;case d3:return n2(i,f,_,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case c3:x=10;break e;case u3:x=9;break e;case hk:x=11;break e;case fk:x=14;break e;case rf:x=16,l=null;break e}throw Error(Er(130,e==null?e:typeof e,""))}return t=mc(x,i,t,f),t.elementType=e,t.type=l,t.lanes=_,t}function Em(e,t,i,l){return e=mc(7,e,l,t),e.lanes=i,e}function n2(e,t,i,l){return e=mc(22,e,l,t),e.elementType=d3,e.lanes=i,e.stateNode={isHidden:!1},e}function mA(e,t,i){return e=mc(6,e,null,t),e.lanes=i,e}function gA(e,t,i){return t=mc(4,e.children!==null?e.children:[],e.key,t),t.lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function I7(e,t,i,l,f){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=KC(0),this.expirationTimes=KC(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=KC(0),this.identifierPrefix=l,this.onRecoverableError=f,this.mutableSourceEagerHydrationData=null}function Zk(e,t,i,l,f,_,x,o,A){return e=new I7(e,t,i,o,A),t===1?(t=1,_===!0&&(t|=8)):t=0,_=mc(3,null,null,t),e.current=_,_.stateNode=e,_.memoizedState={element:l,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},Pk(_),e}function k7(e,t,i){var l=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:N_,key:l==null?null:""+l,children:e,containerInfo:t,implementation:i}}function r4(e){if(!e)return Df;e=e._reactInternals;e:{if(qm(e)!==e||e.tag!==1)throw Error(Er(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(El(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Er(171))}if(e.tag===1){var i=e.type;if(El(i))return rB(e,i,t)}return t}function n4(e,t,i,l,f,_,x,o,A){return e=Zk(i,l,!0,e,f,_,x,o,A),e.context=r4(null),i=e.current,l=Ja(),f=jf(i),_=Gd(l,f),_.callback=t??null,Cf(i,_,f),e.current.lanes=f,Sb(e,f,l),Cl(e,l),e}function i2(e,t,i,l){var f=t.current,_=Ja(),x=jf(f);return i=r4(i),t.context===null?t.context=i:t.pendingContext=i,t=Gd(_,x),t.payload={element:e},l=l===void 0?null:l,l!==null&&(t.callback=l),e=Cf(f,t,x),e!==null&&(lu(e,f,x,_),jS(e,f,x)),x}function gT(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function _L(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var i=e.retryLane;e.retryLane=i!==0&&i<t?i:t}}function Xk(e,t){_L(e,t),(e=e.alternate)&&_L(e,t)}function P7(){return null}var i4=typeof reportError=="function"?reportError:function(e){console.error(e)};function Kk(e){this._internalRoot=e}s2.prototype.render=Kk.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Er(409));i2(e,t,null,null)};s2.prototype.unmount=Kk.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Rm(function(){i2(null,e,null,null)}),t[Kd]=null}};function s2(e){this._internalRoot=e}s2.prototype.unstable_scheduleHydration=function(e){if(e){var t=D3();e={blockedOn:null,target:e,priority:t};for(var i=0;i<of.length&&t!==0&&t<of[i].priority;i++);of.splice(i,0,e),i===0&&L3(e)}};function Yk(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function o2(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function yL(){}function R7(e,t,i,l,f){if(f){if(typeof l=="function"){var _=l;l=function(){var I=gT(x);_.call(I)}}var x=n4(t,l,e,0,null,!1,!1,"",yL);return e._reactRootContainer=x,e[Kd]=x.current,X0(e.nodeType===8?e.parentNode:e),Rm(),x}for(;f=e.lastChild;)e.removeChild(f);if(typeof l=="function"){var o=l;l=function(){var I=gT(A);o.call(I)}}var A=Zk(e,0,!1,null,null,!1,!1,"",yL);return e._reactRootContainer=A,e[Kd]=A.current,X0(e.nodeType===8?e.parentNode:e),Rm(function(){i2(t,A,i,l)}),A}function a2(e,t,i,l,f){var _=i._reactRootContainer;if(_){var x=_;if(typeof f=="function"){var o=f;f=function(){var A=gT(x);o.call(A)}}i2(t,x,e,f)}else x=R7(i,t,e,f,l);return gT(x)}M3=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var i=y0(t.pendingLanes);i!==0&&(gk(t,i|1),Cl(t,Eo()),!(os&6)&&(Ty=Eo()+500,Gf()))}break;case 13:Rm(function(){var l=Yd(e,1);if(l!==null){var f=Ja();lu(l,e,1,f)}}),Xk(e,1)}};_k=function(e){if(e.tag===13){var t=Yd(e,134217728);if(t!==null){var i=Ja();lu(t,e,134217728,i)}Xk(e,134217728)}};N3=function(e){if(e.tag===13){var t=jf(e),i=Yd(e,t);if(i!==null){var l=Ja();lu(i,e,t,l)}Xk(e,t)}};D3=function(){return Cs};O3=function(e,t){var i=Cs;try{return Cs=e,t()}finally{Cs=i}};mj=function(e,t,i){switch(t){case"input":if(lj(e,i),t=i.name,i.type==="radio"&&t!=null){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var l=i[t];if(l!==e&&l.form===e.form){var f=YT(l);if(!f)throw Error(Er(90));f3(l),lj(l,f)}}}break;case"textarea":m3(e,i);break;case"select":t=i.value,t!=null&&Z_(e,!!i.multiple,t,!1)}};w3=qk;S3=Rm;var M7={usingClientEntryPoint:!1,Events:[Eb,F_,YT,x3,b3,qk]},u0={findFiberByHostInstance:um,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},N7={bundleType:u0.bundleType,version:u0.version,rendererPackageName:u0.rendererPackageName,rendererConfig:u0.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:th.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=C3(e),e===null?null:e.stateNode},findFiberByHostInstance:u0.findFiberByHostInstance||P7,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Q1=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Q1.isDisabled&&Q1.supportsFiber)try{WT=Q1.inject(N7),Ku=Q1}catch{}}Kl.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=M7;Kl.createPortal=function(e,t){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Yk(t))throw Error(Er(200));return k7(e,t,null,i)};Kl.createRoot=function(e,t){if(!Yk(e))throw Error(Er(299));var i=!1,l="",f=i4;return t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(l=t.identifierPrefix),t.onRecoverableError!==void 0&&(f=t.onRecoverableError)),t=Zk(e,1,!1,null,null,i,!1,l,f),e[Kd]=t.current,X0(e.nodeType===8?e.parentNode:e),new Kk(t)};Kl.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Er(188)):(e=Object.keys(e).join(","),Error(Er(268,e)));return e=C3(t),e=e===null?null:e.stateNode,e};Kl.flushSync=function(e){return Rm(e)};Kl.hydrate=function(e,t,i){if(!o2(t))throw Error(Er(200));return a2(null,e,t,!0,i)};Kl.hydrateRoot=function(e,t,i){if(!Yk(e))throw Error(Er(405));var l=i!=null&&i.hydratedSources||null,f=!1,_="",x=i4;if(i!=null&&(i.unstable_strictMode===!0&&(f=!0),i.identifierPrefix!==void 0&&(_=i.identifierPrefix),i.onRecoverableError!==void 0&&(x=i.onRecoverableError)),t=n4(t,null,e,1,i??null,f,!1,_,x),e[Kd]=t.current,X0(e),l)for(e=0;e<l.length;e++)i=l[e],f=i._getVersion,f=f(i._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[i,f]:t.mutableSourceEagerHydrationData.push(i,f);return new s2(t)};Kl.render=function(e,t,i){if(!o2(t))throw Error(Er(200));return a2(null,e,t,!1,i)};Kl.unmountComponentAtNode=function(e){if(!o2(e))throw Error(Er(40));return e._reactRootContainer?(Rm(function(){a2(null,null,e,!1,function(){e._reactRootContainer=null,e[Kd]=null})}),!0):!1};Kl.unstable_batchedUpdates=qk;Kl.unstable_renderSubtreeIntoContainer=function(e,t,i,l){if(!o2(i))throw Error(Er(200));if(e==null||e._reactInternals===void 0)throw Error(Er(38));return a2(e,t,i,!1,l)};Kl.version="18.3.1-next-f1338f8080-20240426";function s4(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s4)}catch(e){console.error(e)}}s4(),s3.exports=Kl;var Gm=s3.exports;const o4=rk(Gm);var a4,vL=Gm;a4=vL.createRoot,vL.hydrateRoot;const D7=1,O7=1e6;let _A=0;function L7(){return _A=(_A+1)%Number.MAX_SAFE_INTEGER,_A.toString()}const yA=new Map,xL=e=>{if(yA.has(e))return;const t=setTimeout(()=>{yA.delete(e),N0({type:"REMOVE_TOAST",toastId:e})},O7);yA.set(e,t)},z7=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,D7)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(i=>i.id===t.toast.id?{...i,...t.toast}:i)};case"DISMISS_TOAST":{const{toastId:i}=t;return i?xL(i):e.toasts.forEach(l=>{xL(l.id)}),{...e,toasts:e.toasts.map(l=>l.id===i||i===void 0?{...l,open:!1}:l)}}case"REMOVE_TOAST":return t.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(i=>i.id!==t.toastId)}}},DS=[];let OS={toasts:[]};function N0(e){OS=z7(OS,e),DS.forEach(t=>{t(OS)})}function In({...e}){const t=L7(),i=f=>N0({type:"UPDATE_TOAST",toast:{...f,id:t}}),l=()=>N0({type:"DISMISS_TOAST",toastId:t});return N0({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:f=>{f||l()}}}),{id:t,dismiss:l,update:i}}function Hf(){const[e,t]=F.useState(OS);return F.useEffect(()=>(DS.push(t),()=>{const i=DS.indexOf(t);i>-1&&DS.splice(i,1)}),[e]),{...e,toast:In,dismiss:i=>N0({type:"DISMISS_TOAST",toastId:i})}}function Vn(e,t,{checkForDefaultPrevented:i=!0}={}){return function(f){if(e==null||e(f),i===!1||!f.defaultPrevented)return t==null?void 0:t(f)}}function bL(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function l4(...e){return t=>{let i=!1;const l=e.map(f=>{const _=bL(f,t);return!i&&typeof _=="function"&&(i=!0),_});if(i)return()=>{for(let f=0;f<l.length;f++){const _=l[f];typeof _=="function"?_():bL(e[f],null)}}}}function bs(...e){return F.useCallback(l4(...e),e)}function F7(e,t){const i=F.createContext(t),l=_=>{const{children:x,...o}=_,A=F.useMemo(()=>o,Object.values(o));return d.jsx(i.Provider,{value:A,children:x})};l.displayName=e+"Provider";function f(_){const x=F.useContext(i);if(x)return x;if(t!==void 0)return t;throw new Error(`\`${_}\` must be used within \`${e}\``)}return[l,f]}function rd(e,t=[]){let i=[];function l(_,x){const o=F.createContext(x),A=i.length;i=[...i,x];const I=U=>{var Q;const{scope:$,children:V,...Y}=U,q=((Q=$==null?void 0:$[e])==null?void 0:Q[A])||o,Z=F.useMemo(()=>Y,Object.values(Y));return d.jsx(q.Provider,{value:Z,children:V})};I.displayName=_+"Provider";function N(U,$){var q;const V=((q=$==null?void 0:$[e])==null?void 0:q[A])||o,Y=F.useContext(V);if(Y)return Y;if(x!==void 0)return x;throw new Error(`\`${U}\` must be used within \`${_}\``)}return[I,N]}const f=()=>{const _=i.map(x=>F.createContext(x));return function(o){const A=(o==null?void 0:o[e])||_;return F.useMemo(()=>({[`__scope${e}`]:{...o,[e]:A}}),[o,A])}};return f.scopeName=e,[l,B7(f,...t)]}function B7(...e){const t=e[0];if(e.length===1)return t;const i=()=>{const l=e.map(f=>({useScope:f(),scopeName:f.scopeName}));return function(_){const x=l.reduce((o,{useScope:A,scopeName:I})=>{const U=A(_)[`__scope${I}`];return{...o,...U}},{});return F.useMemo(()=>({[`__scope${t.scopeName}`]:x}),[x])}};return i.scopeName=t.scopeName,i}function Ey(e){const t=V7(e),i=F.forwardRef((l,f)=>{const{children:_,...x}=l,o=F.Children.toArray(_),A=o.find(U7);if(A){const I=A.props.children,N=o.map(U=>U===A?F.Children.count(I)>1?F.Children.only(null):F.isValidElement(I)?I.props.children:null:U);return d.jsx(t,{...x,ref:f,children:F.isValidElement(I)?F.cloneElement(I,void 0,N):null})}return d.jsx(t,{...x,ref:f,children:_})});return i.displayName=`${e}.Slot`,i}var Hm=Ey("Slot");function V7(e){const t=F.forwardRef((i,l)=>{const{children:f,..._}=i;if(F.isValidElement(f)){const x=q7(f),o=$7(_,f.props);return f.type!==F.Fragment&&(o.ref=l?l4(l,x):x),F.cloneElement(f,o)}return F.Children.count(f)>1?F.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var c4=Symbol("radix.slottable");function u4(e){const t=({children:i})=>d.jsx(d.Fragment,{children:i});return t.displayName=`${e}.Slottable`,t.__radixId=c4,t}function U7(e){return F.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===c4}function $7(e,t){const i={...t};for(const l in t){const f=e[l],_=t[l];/^on[A-Z]/.test(l)?f&&_?i[l]=(...o)=>{const A=_(...o);return f(...o),A}:f&&(i[l]=f):l==="style"?i[l]={...f,..._}:l==="className"&&(i[l]=[f,_].filter(Boolean).join(" "))}return{...e,...i}}function q7(e){var l,f;let t=(l=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:l.get,i=t&&"isReactWarning"in t&&t.isReactWarning;return i?e.ref:(t=(f=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:f.get,i=t&&"isReactWarning"in t&&t.isReactWarning,i?e.props.ref:e.props.ref||e.ref)}function Jk(e){const t=e+"CollectionProvider",[i,l]=rd(t),[f,_]=i(t,{collectionRef:{current:null},itemMap:new Map}),x=q=>{const{scope:Z,children:Q}=q,H=ar.useRef(null),K=ar.useRef(new Map).current;return d.jsx(f,{scope:Z,itemMap:K,collectionRef:H,children:Q})};x.displayName=t;const o=e+"CollectionSlot",A=Ey(o),I=ar.forwardRef((q,Z)=>{const{scope:Q,children:H}=q,K=_(o,Q),ne=bs(Z,K.collectionRef);return d.jsx(A,{ref:ne,children:H})});I.displayName=o;const N=e+"CollectionItemSlot",U="data-radix-collection-item",$=Ey(N),V=ar.forwardRef((q,Z)=>{const{scope:Q,children:H,...K}=q,ne=ar.useRef(null),le=bs(Z,ne),pe=_(N,Q);return ar.useEffect(()=>(pe.itemMap.set(ne,{ref:ne,...K}),()=>void pe.itemMap.delete(ne))),d.jsx($,{[U]:"",ref:le,children:H})});V.displayName=N;function Y(q){const Z=_(e+"CollectionConsumer",q);return ar.useCallback(()=>{const H=Z.collectionRef.current;if(!H)return[];const K=Array.from(H.querySelectorAll(`[${U}]`));return Array.from(Z.itemMap.values()).sort((pe,Ae)=>K.indexOf(pe.ref.current)-K.indexOf(Ae.ref.current))},[Z.collectionRef,Z.itemMap])}return[{Provider:x,Slot:I,ItemSlot:V},Y,l]}var G7=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],xi=G7.reduce((e,t)=>{const i=Ey(`Primitive.${t}`),l=F.forwardRef((f,_)=>{const{asChild:x,...o}=f,A=x?i:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),d.jsx(A,{...o,ref:_})});return l.displayName=`Primitive.${t}`,{...e,[t]:l}},{});function d4(e,t){e&&Gm.flushSync(()=>e.dispatchEvent(t))}function vc(e){const t=F.useRef(e);return F.useEffect(()=>{t.current=e}),F.useMemo(()=>(...i)=>{var l;return(l=t.current)==null?void 0:l.call(t,...i)},[])}function H7(e,t=globalThis==null?void 0:globalThis.document){const i=vc(e);F.useEffect(()=>{const l=f=>{f.key==="Escape"&&i(f)};return t.addEventListener("keydown",l,{capture:!0}),()=>t.removeEventListener("keydown",l,{capture:!0})},[i,t])}var W7="DismissableLayer",Zj="dismissableLayer.update",Z7="dismissableLayer.pointerDownOutside",X7="dismissableLayer.focusOutside",wL,h4=F.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Ab=F.forwardRef((e,t)=>{const{disableOutsidePointerEvents:i=!1,onEscapeKeyDown:l,onPointerDownOutside:f,onFocusOutside:_,onInteractOutside:x,onDismiss:o,...A}=e,I=F.useContext(h4),[N,U]=F.useState(null),$=(N==null?void 0:N.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,V]=F.useState({}),Y=bs(t,Ae=>U(Ae)),q=Array.from(I.layers),[Z]=[...I.layersWithOutsidePointerEventsDisabled].slice(-1),Q=q.indexOf(Z),H=N?q.indexOf(N):-1,K=I.layersWithOutsidePointerEventsDisabled.size>0,ne=H>=Q,le=Y7(Ae=>{const Ze=Ae.target,Xe=[...I.branches].some(Je=>Je.contains(Ze));!ne||Xe||(f==null||f(Ae),x==null||x(Ae),Ae.defaultPrevented||o==null||o())},$),pe=J7(Ae=>{const Ze=Ae.target;[...I.branches].some(Je=>Je.contains(Ze))||(_==null||_(Ae),x==null||x(Ae),Ae.defaultPrevented||o==null||o())},$);return H7(Ae=>{H===I.layers.size-1&&(l==null||l(Ae),!Ae.defaultPrevented&&o&&(Ae.preventDefault(),o()))},$),F.useEffect(()=>{if(N)return i&&(I.layersWithOutsidePointerEventsDisabled.size===0&&(wL=$.body.style.pointerEvents,$.body.style.pointerEvents="none"),I.layersWithOutsidePointerEventsDisabled.add(N)),I.layers.add(N),SL(),()=>{i&&I.layersWithOutsidePointerEventsDisabled.size===1&&($.body.style.pointerEvents=wL)}},[N,$,i,I]),F.useEffect(()=>()=>{N&&(I.layers.delete(N),I.layersWithOutsidePointerEventsDisabled.delete(N),SL())},[N,I]),F.useEffect(()=>{const Ae=()=>V({});return document.addEventListener(Zj,Ae),()=>document.removeEventListener(Zj,Ae)},[]),d.jsx(xi.div,{...A,ref:Y,style:{pointerEvents:K?ne?"auto":"none":void 0,...e.style},onFocusCapture:Vn(e.onFocusCapture,pe.onFocusCapture),onBlurCapture:Vn(e.onBlurCapture,pe.onBlurCapture),onPointerDownCapture:Vn(e.onPointerDownCapture,le.onPointerDownCapture)})});Ab.displayName=W7;var K7="DismissableLayerBranch",f4=F.forwardRef((e,t)=>{const i=F.useContext(h4),l=F.useRef(null),f=bs(t,l);return F.useEffect(()=>{const _=l.current;if(_)return i.branches.add(_),()=>{i.branches.delete(_)}},[i.branches]),d.jsx(xi.div,{...e,ref:f})});f4.displayName=K7;function Y7(e,t=globalThis==null?void 0:globalThis.document){const i=vc(e),l=F.useRef(!1),f=F.useRef(()=>{});return F.useEffect(()=>{const _=o=>{if(o.target&&!l.current){let A=function(){p4(Z7,i,I,{discrete:!0})};const I={originalEvent:o};o.pointerType==="touch"?(t.removeEventListener("click",f.current),f.current=A,t.addEventListener("click",f.current,{once:!0})):A()}else t.removeEventListener("click",f.current);l.current=!1},x=window.setTimeout(()=>{t.addEventListener("pointerdown",_)},0);return()=>{window.clearTimeout(x),t.removeEventListener("pointerdown",_),t.removeEventListener("click",f.current)}},[t,i]),{onPointerDownCapture:()=>l.current=!0}}function J7(e,t=globalThis==null?void 0:globalThis.document){const i=vc(e),l=F.useRef(!1);return F.useEffect(()=>{const f=_=>{_.target&&!l.current&&p4(X7,i,{originalEvent:_},{discrete:!1})};return t.addEventListener("focusin",f),()=>t.removeEventListener("focusin",f)},[t,i]),{onFocusCapture:()=>l.current=!0,onBlurCapture:()=>l.current=!1}}function SL(){const e=new CustomEvent(Zj);document.dispatchEvent(e)}function p4(e,t,i,{discrete:l}){const f=i.originalEvent.target,_=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:i});t&&f.addEventListener(e,t,{once:!0}),l?d4(f,_):f.dispatchEvent(_)}var Q7=Ab,eZ=f4,ha=globalThis!=null&&globalThis.document?F.useLayoutEffect:()=>{},tZ="Portal",l2=F.forwardRef((e,t)=>{var o;const{container:i,...l}=e,[f,_]=F.useState(!1);ha(()=>_(!0),[]);const x=i||f&&((o=globalThis==null?void 0:globalThis.document)==null?void 0:o.body);return x?o4.createPortal(d.jsx(xi.div,{...l,ref:t}),x):null});l2.displayName=tZ;function rZ(e,t){return F.useReducer((i,l)=>t[i][l]??i,e)}var Wf=e=>{const{present:t,children:i}=e,l=nZ(t),f=typeof i=="function"?i({present:l.isPresent}):F.Children.only(i),_=bs(l.ref,iZ(f));return typeof i=="function"||l.isPresent?F.cloneElement(f,{ref:_}):null};Wf.displayName="Presence";function nZ(e){const[t,i]=F.useState(),l=F.useRef(null),f=F.useRef(e),_=F.useRef("none"),x=e?"mounted":"unmounted",[o,A]=rZ(x,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return F.useEffect(()=>{const I=eS(l.current);_.current=o==="mounted"?I:"none"},[o]),ha(()=>{const I=l.current,N=f.current;if(N!==e){const $=_.current,V=eS(I);e?A("MOUNT"):V==="none"||(I==null?void 0:I.display)==="none"?A("UNMOUNT"):A(N&&$!==V?"ANIMATION_OUT":"UNMOUNT"),f.current=e}},[e,A]),ha(()=>{if(t){let I;const N=t.ownerDocument.defaultView??window,U=V=>{const q=eS(l.current).includes(V.animationName);if(V.target===t&&q&&(A("ANIMATION_END"),!f.current)){const Z=t.style.animationFillMode;t.style.animationFillMode="forwards",I=N.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=Z)})}},$=V=>{V.target===t&&(_.current=eS(l.current))};return t.addEventListener("animationstart",$),t.addEventListener("animationcancel",U),t.addEventListener("animationend",U),()=>{N.clearTimeout(I),t.removeEventListener("animationstart",$),t.removeEventListener("animationcancel",U),t.removeEventListener("animationend",U)}}else A("ANIMATION_END")},[t,A]),{isPresent:["mounted","unmountSuspended"].includes(o),ref:F.useCallback(I=>{l.current=I?getComputedStyle(I):null,i(I)},[])}}function eS(e){return(e==null?void 0:e.animationName)||"none"}function iZ(e){var l,f;let t=(l=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:l.get,i=t&&"isReactWarning"in t&&t.isReactWarning;return i?e.ref:(t=(f=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:f.get,i=t&&"isReactWarning"in t&&t.isReactWarning,i?e.props.ref:e.props.ref||e.ref)}var sZ=ak[" useInsertionEffect ".trim().toString()]||ha;function Of({prop:e,defaultProp:t,onChange:i=()=>{},caller:l}){const[f,_,x]=oZ({defaultProp:t,onChange:i}),o=e!==void 0,A=o?e:f;{const N=F.useRef(e!==void 0);F.useEffect(()=>{const U=N.current;U!==o&&console.warn(`${l} is changing from ${U?"controlled":"uncontrolled"} to ${o?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),N.current=o},[o,l])}const I=F.useCallback(N=>{var U;if(o){const $=aZ(N)?N(e):N;$!==e&&((U=x.current)==null||U.call(x,$))}else _(N)},[o,e,_,x]);return[A,I]}function oZ({defaultProp:e,onChange:t}){const[i,l]=F.useState(e),f=F.useRef(i),_=F.useRef(t);return sZ(()=>{_.current=t},[t]),F.useEffect(()=>{var x;f.current!==i&&((x=_.current)==null||x.call(_,i),f.current=i)},[i,f]),[i,l,_]}function aZ(e){return typeof e=="function"}var m4=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),lZ="VisuallyHidden",c2=F.forwardRef((e,t)=>d.jsx(xi.span,{...e,ref:t,style:{...m4,...e.style}}));c2.displayName=lZ;var cZ=c2,Qk="ToastProvider",[eP,uZ,dZ]=Jk("Toast"),[g4,_de]=rd("Toast",[dZ]),[hZ,u2]=g4(Qk),_4=e=>{const{__scopeToast:t,label:i="Notification",duration:l=5e3,swipeDirection:f="right",swipeThreshold:_=50,children:x}=e,[o,A]=F.useState(null),[I,N]=F.useState(0),U=F.useRef(!1),$=F.useRef(!1);return i.trim()||console.error(`Invalid prop \`label\` supplied to \`${Qk}\`. Expected non-empty \`string\`.`),d.jsx(eP.Provider,{scope:t,children:d.jsx(hZ,{scope:t,label:i,duration:l,swipeDirection:f,swipeThreshold:_,toastCount:I,viewport:o,onViewportChange:A,onToastAdd:F.useCallback(()=>N(V=>V+1),[]),onToastRemove:F.useCallback(()=>N(V=>V-1),[]),isFocusedToastEscapeKeyDownRef:U,isClosePausedRef:$,children:x})})};_4.displayName=Qk;var y4="ToastViewport",fZ=["F8"],Xj="toast.viewportPause",Kj="toast.viewportResume",v4=F.forwardRef((e,t)=>{const{__scopeToast:i,hotkey:l=fZ,label:f="Notifications ({hotkey})",..._}=e,x=u2(y4,i),o=uZ(i),A=F.useRef(null),I=F.useRef(null),N=F.useRef(null),U=F.useRef(null),$=bs(t,U,x.onViewportChange),V=l.join("+").replace(/Key/g,"").replace(/Digit/g,""),Y=x.toastCount>0;F.useEffect(()=>{const Z=Q=>{var K;l.length!==0&&l.every(ne=>Q[ne]||Q.code===ne)&&((K=U.current)==null||K.focus())};return document.addEventListener("keydown",Z),()=>document.removeEventListener("keydown",Z)},[l]),F.useEffect(()=>{const Z=A.current,Q=U.current;if(Y&&Z&&Q){const H=()=>{if(!x.isClosePausedRef.current){const pe=new CustomEvent(Xj);Q.dispatchEvent(pe),x.isClosePausedRef.current=!0}},K=()=>{if(x.isClosePausedRef.current){const pe=new CustomEvent(Kj);Q.dispatchEvent(pe),x.isClosePausedRef.current=!1}},ne=pe=>{!Z.contains(pe.relatedTarget)&&K()},le=()=>{Z.contains(document.activeElement)||K()};return Z.addEventListener("focusin",H),Z.addEventListener("focusout",ne),Z.addEventListener("pointermove",H),Z.addEventListener("pointerleave",le),window.addEventListener("blur",H),window.addEventListener("focus",K),()=>{Z.removeEventListener("focusin",H),Z.removeEventListener("focusout",ne),Z.removeEventListener("pointermove",H),Z.removeEventListener("pointerleave",le),window.removeEventListener("blur",H),window.removeEventListener("focus",K)}}},[Y,x.isClosePausedRef]);const q=F.useCallback(({tabbingDirection:Z})=>{const H=o().map(K=>{const ne=K.ref.current,le=[ne,...CZ(ne)];return Z==="forwards"?le:le.reverse()});return(Z==="forwards"?H.reverse():H).flat()},[o]);return F.useEffect(()=>{const Z=U.current;if(Z){const Q=H=>{var le,pe,Ae;const K=H.altKey||H.ctrlKey||H.metaKey;if(H.key==="Tab"&&!K){const Ze=document.activeElement,Xe=H.shiftKey;if(H.target===Z&&Xe){(le=I.current)==null||le.focus();return}const xe=q({tabbingDirection:Xe?"backwards":"forwards"}),Be=xe.findIndex(dt=>dt===Ze);vA(xe.slice(Be+1))?H.preventDefault():Xe?(pe=I.current)==null||pe.focus():(Ae=N.current)==null||Ae.focus()}};return Z.addEventListener("keydown",Q),()=>Z.removeEventListener("keydown",Q)}},[o,q]),d.jsxs(eZ,{ref:A,role:"region","aria-label":f.replace("{hotkey}",V),tabIndex:-1,style:{pointerEvents:Y?void 0:"none"},children:[Y&&d.jsx(Yj,{ref:I,onFocusFromOutsideViewport:()=>{const Z=q({tabbingDirection:"forwards"});vA(Z)}}),d.jsx(eP.Slot,{scope:i,children:d.jsx(xi.ol,{tabIndex:-1,..._,ref:$})}),Y&&d.jsx(Yj,{ref:N,onFocusFromOutsideViewport:()=>{const Z=q({tabbingDirection:"backwards"});vA(Z)}})]})});v4.displayName=y4;var x4="ToastFocusProxy",Yj=F.forwardRef((e,t)=>{const{__scopeToast:i,onFocusFromOutsideViewport:l,...f}=e,_=u2(x4,i);return d.jsx(c2,{"aria-hidden":!0,tabIndex:0,...f,ref:t,style:{position:"fixed"},onFocus:x=>{var I;const o=x.relatedTarget;!((I=_.viewport)!=null&&I.contains(o))&&l()}})});Yj.displayName=x4;var jb="Toast",pZ="toast.swipeStart",mZ="toast.swipeMove",gZ="toast.swipeCancel",_Z="toast.swipeEnd",b4=F.forwardRef((e,t)=>{const{forceMount:i,open:l,defaultOpen:f,onOpenChange:_,...x}=e,[o,A]=Of({prop:l,defaultProp:f??!0,onChange:_,caller:jb});return d.jsx(Wf,{present:i||o,children:d.jsx(xZ,{open:o,...x,ref:t,onClose:()=>A(!1),onPause:vc(e.onPause),onResume:vc(e.onResume),onSwipeStart:Vn(e.onSwipeStart,I=>{I.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Vn(e.onSwipeMove,I=>{const{x:N,y:U}=I.detail.delta;I.currentTarget.setAttribute("data-swipe","move"),I.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${N}px`),I.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${U}px`)}),onSwipeCancel:Vn(e.onSwipeCancel,I=>{I.currentTarget.setAttribute("data-swipe","cancel"),I.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),I.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),I.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),I.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Vn(e.onSwipeEnd,I=>{const{x:N,y:U}=I.detail.delta;I.currentTarget.setAttribute("data-swipe","end"),I.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),I.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),I.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${N}px`),I.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${U}px`),A(!1)})})})});b4.displayName=jb;var[yZ,vZ]=g4(jb,{onClose(){}}),xZ=F.forwardRef((e,t)=>{const{__scopeToast:i,type:l="foreground",duration:f,open:_,onClose:x,onEscapeKeyDown:o,onPause:A,onResume:I,onSwipeStart:N,onSwipeMove:U,onSwipeCancel:$,onSwipeEnd:V,...Y}=e,q=u2(jb,i),[Z,Q]=F.useState(null),H=bs(t,dt=>Q(dt)),K=F.useRef(null),ne=F.useRef(null),le=f||q.duration,pe=F.useRef(0),Ae=F.useRef(le),Ze=F.useRef(0),{onToastAdd:Xe,onToastRemove:Je}=q,Te=vc(()=>{var qt;(Z==null?void 0:Z.contains(document.activeElement))&&((qt=q.viewport)==null||qt.focus()),x()}),xe=F.useCallback(dt=>{!dt||dt===1/0||(window.clearTimeout(Ze.current),pe.current=new Date().getTime(),Ze.current=window.setTimeout(Te,dt))},[Te]);F.useEffect(()=>{const dt=q.viewport;if(dt){const qt=()=>{xe(Ae.current),I==null||I()},Ke=()=>{const st=new Date().getTime()-pe.current;Ae.current=Ae.current-st,window.clearTimeout(Ze.current),A==null||A()};return dt.addEventListener(Xj,Ke),dt.addEventListener(Kj,qt),()=>{dt.removeEventListener(Xj,Ke),dt.removeEventListener(Kj,qt)}}},[q.viewport,le,A,I,xe]),F.useEffect(()=>{_&&!q.isClosePausedRef.current&&xe(le)},[_,le,q.isClosePausedRef,xe]),F.useEffect(()=>(Xe(),()=>Je()),[Xe,Je]);const Be=F.useMemo(()=>Z?j4(Z):null,[Z]);return q.viewport?d.jsxs(d.Fragment,{children:[Be&&d.jsx(bZ,{__scopeToast:i,role:"status","aria-live":l==="foreground"?"assertive":"polite","aria-atomic":!0,children:Be}),d.jsx(yZ,{scope:i,onClose:Te,children:Gm.createPortal(d.jsx(eP.ItemSlot,{scope:i,children:d.jsx(Q7,{asChild:!0,onEscapeKeyDown:Vn(o,()=>{q.isFocusedToastEscapeKeyDownRef.current||Te(),q.isFocusedToastEscapeKeyDownRef.current=!1}),children:d.jsx(xi.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":_?"open":"closed","data-swipe-direction":q.swipeDirection,...Y,ref:H,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:Vn(e.onKeyDown,dt=>{dt.key==="Escape"&&(o==null||o(dt.nativeEvent),dt.nativeEvent.defaultPrevented||(q.isFocusedToastEscapeKeyDownRef.current=!0,Te()))}),onPointerDown:Vn(e.onPointerDown,dt=>{dt.button===0&&(K.current={x:dt.clientX,y:dt.clientY})}),onPointerMove:Vn(e.onPointerMove,dt=>{if(!K.current)return;const qt=dt.clientX-K.current.x,Ke=dt.clientY-K.current.y,st=!!ne.current,Ne=["left","right"].includes(q.swipeDirection),De=["left","up"].includes(q.swipeDirection)?Math.min:Math.max,Tt=Ne?De(0,qt):0,Pt=Ne?0:De(0,Ke),fe=dt.pointerType==="touch"?10:2,Le={x:Tt,y:Pt},vt={originalEvent:dt,delta:Le};st?(ne.current=Le,tS(mZ,U,vt,{discrete:!1})):TL(Le,q.swipeDirection,fe)?(ne.current=Le,tS(pZ,N,vt,{discrete:!1}),dt.target.setPointerCapture(dt.pointerId)):(Math.abs(qt)>fe||Math.abs(Ke)>fe)&&(K.current=null)}),onPointerUp:Vn(e.onPointerUp,dt=>{const qt=ne.current,Ke=dt.target;if(Ke.hasPointerCapture(dt.pointerId)&&Ke.releasePointerCapture(dt.pointerId),ne.current=null,K.current=null,qt){const st=dt.currentTarget,Ne={originalEvent:dt,delta:qt};TL(qt,q.swipeDirection,q.swipeThreshold)?tS(_Z,V,Ne,{discrete:!0}):tS(gZ,$,Ne,{discrete:!0}),st.addEventListener("click",De=>De.preventDefault(),{once:!0})}})})})}),q.viewport)})]}):null}),bZ=e=>{const{__scopeToast:t,children:i,...l}=e,f=u2(jb,t),[_,x]=F.useState(!1),[o,A]=F.useState(!1);return TZ(()=>x(!0)),F.useEffect(()=>{const I=window.setTimeout(()=>A(!0),1e3);return()=>window.clearTimeout(I)},[]),o?null:d.jsx(l2,{asChild:!0,children:d.jsx(c2,{...l,children:_&&d.jsxs(d.Fragment,{children:[f.label," ",i]})})})},wZ="ToastTitle",w4=F.forwardRef((e,t)=>{const{__scopeToast:i,...l}=e;return d.jsx(xi.div,{...l,ref:t})});w4.displayName=wZ;var SZ="ToastDescription",S4=F.forwardRef((e,t)=>{const{__scopeToast:i,...l}=e;return d.jsx(xi.div,{...l,ref:t})});S4.displayName=SZ;var T4="ToastAction",E4=F.forwardRef((e,t)=>{const{altText:i,...l}=e;return i.trim()?d.jsx(A4,{altText:i,asChild:!0,children:d.jsx(tP,{...l,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${T4}\`. Expected non-empty \`string\`.`),null)});E4.displayName=T4;var C4="ToastClose",tP=F.forwardRef((e,t)=>{const{__scopeToast:i,...l}=e,f=vZ(C4,i);return d.jsx(A4,{asChild:!0,children:d.jsx(xi.button,{type:"button",...l,ref:t,onClick:Vn(e.onClick,f.onClose)})})});tP.displayName=C4;var A4=F.forwardRef((e,t)=>{const{__scopeToast:i,altText:l,...f}=e;return d.jsx(xi.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":l||void 0,...f,ref:t})});function j4(e){const t=[];return Array.from(e.childNodes).forEach(l=>{if(l.nodeType===l.TEXT_NODE&&l.textContent&&t.push(l.textContent),EZ(l)){const f=l.ariaHidden||l.hidden||l.style.display==="none",_=l.dataset.radixToastAnnounceExclude==="";if(!f)if(_){const x=l.dataset.radixToastAnnounceAlt;x&&t.push(x)}else t.push(...j4(l))}}),t}function tS(e,t,i,{discrete:l}){const f=i.originalEvent.currentTarget,_=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:i});t&&f.addEventListener(e,t,{once:!0}),l?d4(f,_):f.dispatchEvent(_)}var TL=(e,t,i=0)=>{const l=Math.abs(e.x),f=Math.abs(e.y),_=l>f;return t==="left"||t==="right"?_&&l>i:!_&&f>i};function TZ(e=()=>{}){const t=vc(e);ha(()=>{let i=0,l=0;return i=window.requestAnimationFrame(()=>l=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(i),window.cancelAnimationFrame(l)}},[t])}function EZ(e){return e.nodeType===e.ELEMENT_NODE}function CZ(e){const t=[],i=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:l=>{const f=l.tagName==="INPUT"&&l.type==="hidden";return l.disabled||l.hidden||f?NodeFilter.FILTER_SKIP:l.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;i.nextNode();)t.push(i.currentNode);return t}function vA(e){const t=document.activeElement;return e.some(i=>i===t?!0:(i.focus(),document.activeElement!==t))}var AZ=_4,I4=v4,k4=b4,P4=w4,R4=S4,M4=E4,N4=tP;function D4(e){var t,i,l="";if(typeof e=="string"||typeof e=="number")l+=e;else if(typeof e=="object")if(Array.isArray(e)){var f=e.length;for(t=0;t<f;t++)e[t]&&(i=D4(e[t]))&&(l&&(l+=" "),l+=i)}else for(i in e)e[i]&&(l&&(l+=" "),l+=i);return l}function O4(){for(var e,t,i=0,l="",f=arguments.length;i<f;i++)(e=arguments[i])&&(t=D4(e))&&(l&&(l+=" "),l+=t);return l}const EL=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,CL=O4,By=(e,t)=>i=>{var l;if((t==null?void 0:t.variants)==null)return CL(e,i==null?void 0:i.class,i==null?void 0:i.className);const{variants:f,defaultVariants:_}=t,x=Object.keys(f).map(I=>{const N=i==null?void 0:i[I],U=_==null?void 0:_[I];if(N===null)return null;const $=EL(N)||EL(U);return f[I][$]}),o=i&&Object.entries(i).reduce((I,N)=>{let[U,$]=N;return $===void 0||(I[U]=$),I},{}),A=t==null||(l=t.compoundVariants)===null||l===void 0?void 0:l.reduce((I,N)=>{let{class:U,className:$,...V}=N;return Object.entries(V).every(Y=>{let[q,Z]=Y;return Array.isArray(Z)?Z.includes({..._,...o}[q]):{..._,...o}[q]===Z})?[...I,U,$]:I},[]);return CL(e,x,A,i==null?void 0:i.class,i==null?void 0:i.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jZ=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),L4=(...e)=>e.filter((t,i,l)=>!!t&&t.trim()!==""&&l.indexOf(t)===i).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var IZ={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kZ=F.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:i=2,absoluteStrokeWidth:l,className:f="",children:_,iconNode:x,...o},A)=>F.createElement("svg",{ref:A,...IZ,width:t,height:t,stroke:e,strokeWidth:l?Number(i)*24/Number(t):i,className:L4("lucide",f),...o},[...x.map(([I,N])=>F.createElement(I,N)),...Array.isArray(_)?_:[_]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _n=(e,t)=>{const i=F.forwardRef(({className:l,...f},_)=>F.createElement(kZ,{ref:_,iconNode:t,className:L4(`lucide-${jZ(e)}`,l),...f}));return i.displayName=`${e}`,i};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LS=_n("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AL=_n("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lf=_n("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PZ=_n("CalendarCheck",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RZ=_n("CalendarOff",[["path",{d:"M4.2 4.2A2 2 0 0 0 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 1.82-1.18",key:"16swn3"}],["path",{d:"M21 15.5V6a2 2 0 0 0-2-2H9.5",key:"yhw86o"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M3 10h7",key:"1wap6i"}],["path",{d:"M21 10h-5.5",key:"quycpq"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MZ=_n("CalendarPlus",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 13V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8",key:"3spt84"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M16 19h6",key:"xwg31i"}],["path",{d:"M19 16v6",key:"tddt3s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Al=_n("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jj=_n("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z4=_n("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F4=_n("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B4=_n("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V4=_n("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NZ=_n("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H_=_n("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ib=_n("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U4=_n("CircleUser",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $4=_n("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q4=_n("ClipboardCheck",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d2=_n("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vy=_n("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DZ=_n("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h2=_n("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zf=_n("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OZ=_n("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LZ=_n("Headphones",[["path",{d:"M3 14h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7a9 9 0 0 1 18 0v7a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3",key:"1xhozi"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G4=_n("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zZ=_n("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FZ=_n("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BZ=_n("KeyRound",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qj=_n("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VZ=_n("ListChecks",[["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jL=_n("ListOrdered",[["path",{d:"M10 12h11",key:"6m4ad9"}],["path",{d:"M10 18h11",key:"11hvi2"}],["path",{d:"M10 6h11",key:"c7qv1k"}],["path",{d:"M4 10h2",key:"16xx2s"}],["path",{d:"M4 6h1v4",key:"cnovpq"}],["path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1",key:"m9a95d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nd=_n("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UZ=_n("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $Z=_n("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qZ=_n("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zf=_n("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ib=_n("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vd=_n("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GZ=_n("PanelLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rP=_n("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HZ=_n("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WZ=_n("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZZ=_n("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ea=_n("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uy=_n("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ou=_n("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eI=_n("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XZ=_n("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nP=_n("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gu=_n("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KZ=_n("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jl=_n("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iP=_n("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cm=_n("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YZ=_n("Unlink",[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JZ=_n("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f2=_n("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QZ=_n("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eX=_n("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tI=_n("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sb=_n("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hd=_n("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sP=_n("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),oP="-",tX=e=>{const t=nX(e),{conflictingClassGroups:i,conflictingClassGroupModifiers:l}=e;return{getClassGroupId:x=>{const o=x.split(oP);return o[0]===""&&o.length!==1&&o.shift(),H4(o,t)||rX(x)},getConflictingClassGroupIds:(x,o)=>{const A=i[x]||[];return o&&l[x]?[...A,...l[x]]:A}}},H4=(e,t)=>{var x;if(e.length===0)return t.classGroupId;const i=e[0],l=t.nextPart.get(i),f=l?H4(e.slice(1),l):void 0;if(f)return f;if(t.validators.length===0)return;const _=e.join(oP);return(x=t.validators.find(({validator:o})=>o(_)))==null?void 0:x.classGroupId},IL=/^\[(.+)\]$/,rX=e=>{if(IL.test(e)){const t=IL.exec(e)[1],i=t==null?void 0:t.substring(0,t.indexOf(":"));if(i)return"arbitrary.."+i}},nX=e=>{const{theme:t,prefix:i}=e,l={nextPart:new Map,validators:[]};return sX(Object.entries(e.classGroups),i).forEach(([_,x])=>{rI(x,l,_,t)}),l},rI=(e,t,i,l)=>{e.forEach(f=>{if(typeof f=="string"){const _=f===""?t:kL(t,f);_.classGroupId=i;return}if(typeof f=="function"){if(iX(f)){rI(f(l),t,i,l);return}t.validators.push({validator:f,classGroupId:i});return}Object.entries(f).forEach(([_,x])=>{rI(x,kL(t,_),i,l)})})},kL=(e,t)=>{let i=e;return t.split(oP).forEach(l=>{i.nextPart.has(l)||i.nextPart.set(l,{nextPart:new Map,validators:[]}),i=i.nextPart.get(l)}),i},iX=e=>e.isThemeGetter,sX=(e,t)=>t?e.map(([i,l])=>{const f=l.map(_=>typeof _=="string"?t+_:typeof _=="object"?Object.fromEntries(Object.entries(_).map(([x,o])=>[t+x,o])):_);return[i,f]}):e,oX=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,i=new Map,l=new Map;const f=(_,x)=>{i.set(_,x),t++,t>e&&(t=0,l=i,i=new Map)};return{get(_){let x=i.get(_);if(x!==void 0)return x;if((x=l.get(_))!==void 0)return f(_,x),x},set(_,x){i.has(_)?i.set(_,x):f(_,x)}}},W4="!",aX=e=>{const{separator:t,experimentalParseClassName:i}=e,l=t.length===1,f=t[0],_=t.length,x=o=>{const A=[];let I=0,N=0,U;for(let Z=0;Z<o.length;Z++){let Q=o[Z];if(I===0){if(Q===f&&(l||o.slice(Z,Z+_)===t)){A.push(o.slice(N,Z)),N=Z+_;continue}if(Q==="/"){U=Z;continue}}Q==="["?I++:Q==="]"&&I--}const $=A.length===0?o:o.substring(N),V=$.startsWith(W4),Y=V?$.substring(1):$,q=U&&U>N?U-N:void 0;return{modifiers:A,hasImportantModifier:V,baseClassName:Y,maybePostfixModifierPosition:q}};return i?o=>i({className:o,parseClassName:x}):x},lX=e=>{if(e.length<=1)return e;const t=[];let i=[];return e.forEach(l=>{l[0]==="["?(t.push(...i.sort(),l),i=[]):i.push(l)}),t.push(...i.sort()),t},cX=e=>({cache:oX(e.cacheSize),parseClassName:aX(e),...tX(e)}),uX=/\s+/,dX=(e,t)=>{const{parseClassName:i,getClassGroupId:l,getConflictingClassGroupIds:f}=t,_=[],x=e.trim().split(uX);let o="";for(let A=x.length-1;A>=0;A-=1){const I=x[A],{modifiers:N,hasImportantModifier:U,baseClassName:$,maybePostfixModifierPosition:V}=i(I);let Y=!!V,q=l(Y?$.substring(0,V):$);if(!q){if(!Y){o=I+(o.length>0?" "+o:o);continue}if(q=l($),!q){o=I+(o.length>0?" "+o:o);continue}Y=!1}const Z=lX(N).join(":"),Q=U?Z+W4:Z,H=Q+q;if(_.includes(H))continue;_.push(H);const K=f(q,Y);for(let ne=0;ne<K.length;++ne){const le=K[ne];_.push(Q+le)}o=I+(o.length>0?" "+o:o)}return o};function hX(){let e=0,t,i,l="";for(;e<arguments.length;)(t=arguments[e++])&&(i=Z4(t))&&(l&&(l+=" "),l+=i);return l}const Z4=e=>{if(typeof e=="string")return e;let t,i="";for(let l=0;l<e.length;l++)e[l]&&(t=Z4(e[l]))&&(i&&(i+=" "),i+=t);return i};function fX(e,...t){let i,l,f,_=x;function x(A){const I=t.reduce((N,U)=>U(N),e());return i=cX(I),l=i.cache.get,f=i.cache.set,_=o,o(A)}function o(A){const I=l(A);if(I)return I;const N=dX(A,i);return f(A,N),N}return function(){return _(hX.apply(null,arguments))}}const Ws=e=>{const t=i=>i[e]||[];return t.isThemeGetter=!0,t},X4=/^\[(?:([a-z-]+):)?(.+)\]$/i,pX=/^\d+\/\d+$/,mX=new Set(["px","full","screen"]),gX=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,_X=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,yX=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,vX=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,xX=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Id=e=>ey(e)||mX.has(e)||pX.test(e),Kh=e=>$y(e,"length",jX),ey=e=>!!e&&!Number.isNaN(Number(e)),xA=e=>$y(e,"number",ey),d0=e=>!!e&&Number.isInteger(Number(e)),bX=e=>e.endsWith("%")&&ey(e.slice(0,-1)),Ci=e=>X4.test(e),Yh=e=>gX.test(e),wX=new Set(["length","size","percentage"]),SX=e=>$y(e,wX,K4),TX=e=>$y(e,"position",K4),EX=new Set(["image","url"]),CX=e=>$y(e,EX,kX),AX=e=>$y(e,"",IX),h0=()=>!0,$y=(e,t,i)=>{const l=X4.exec(e);return l?l[1]?typeof t=="string"?l[1]===t:t.has(l[1]):i(l[2]):!1},jX=e=>_X.test(e)&&!yX.test(e),K4=()=>!1,IX=e=>vX.test(e),kX=e=>xX.test(e),PX=()=>{const e=Ws("colors"),t=Ws("spacing"),i=Ws("blur"),l=Ws("brightness"),f=Ws("borderColor"),_=Ws("borderRadius"),x=Ws("borderSpacing"),o=Ws("borderWidth"),A=Ws("contrast"),I=Ws("grayscale"),N=Ws("hueRotate"),U=Ws("invert"),$=Ws("gap"),V=Ws("gradientColorStops"),Y=Ws("gradientColorStopPositions"),q=Ws("inset"),Z=Ws("margin"),Q=Ws("opacity"),H=Ws("padding"),K=Ws("saturate"),ne=Ws("scale"),le=Ws("sepia"),pe=Ws("skew"),Ae=Ws("space"),Ze=Ws("translate"),Xe=()=>["auto","contain","none"],Je=()=>["auto","hidden","clip","visible","scroll"],Te=()=>["auto",Ci,t],xe=()=>[Ci,t],Be=()=>["",Id,Kh],dt=()=>["auto",ey,Ci],qt=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Ke=()=>["solid","dashed","dotted","double","none"],st=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Ne=()=>["start","end","center","between","around","evenly","stretch"],De=()=>["","0",Ci],Tt=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Pt=()=>[ey,Ci];return{cacheSize:500,separator:":",theme:{colors:[h0],spacing:[Id,Kh],blur:["none","",Yh,Ci],brightness:Pt(),borderColor:[e],borderRadius:["none","","full",Yh,Ci],borderSpacing:xe(),borderWidth:Be(),contrast:Pt(),grayscale:De(),hueRotate:Pt(),invert:De(),gap:xe(),gradientColorStops:[e],gradientColorStopPositions:[bX,Kh],inset:Te(),margin:Te(),opacity:Pt(),padding:xe(),saturate:Pt(),scale:Pt(),sepia:De(),skew:Pt(),space:xe(),translate:xe()},classGroups:{aspect:[{aspect:["auto","square","video",Ci]}],container:["container"],columns:[{columns:[Yh]}],"break-after":[{"break-after":Tt()}],"break-before":[{"break-before":Tt()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...qt(),Ci]}],overflow:[{overflow:Je()}],"overflow-x":[{"overflow-x":Je()}],"overflow-y":[{"overflow-y":Je()}],overscroll:[{overscroll:Xe()}],"overscroll-x":[{"overscroll-x":Xe()}],"overscroll-y":[{"overscroll-y":Xe()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[q]}],"inset-x":[{"inset-x":[q]}],"inset-y":[{"inset-y":[q]}],start:[{start:[q]}],end:[{end:[q]}],top:[{top:[q]}],right:[{right:[q]}],bottom:[{bottom:[q]}],left:[{left:[q]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",d0,Ci]}],basis:[{basis:Te()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Ci]}],grow:[{grow:De()}],shrink:[{shrink:De()}],order:[{order:["first","last","none",d0,Ci]}],"grid-cols":[{"grid-cols":[h0]}],"col-start-end":[{col:["auto",{span:["full",d0,Ci]},Ci]}],"col-start":[{"col-start":dt()}],"col-end":[{"col-end":dt()}],"grid-rows":[{"grid-rows":[h0]}],"row-start-end":[{row:["auto",{span:[d0,Ci]},Ci]}],"row-start":[{"row-start":dt()}],"row-end":[{"row-end":dt()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Ci]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Ci]}],gap:[{gap:[$]}],"gap-x":[{"gap-x":[$]}],"gap-y":[{"gap-y":[$]}],"justify-content":[{justify:["normal",...Ne()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Ne(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Ne(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[H]}],px:[{px:[H]}],py:[{py:[H]}],ps:[{ps:[H]}],pe:[{pe:[H]}],pt:[{pt:[H]}],pr:[{pr:[H]}],pb:[{pb:[H]}],pl:[{pl:[H]}],m:[{m:[Z]}],mx:[{mx:[Z]}],my:[{my:[Z]}],ms:[{ms:[Z]}],me:[{me:[Z]}],mt:[{mt:[Z]}],mr:[{mr:[Z]}],mb:[{mb:[Z]}],ml:[{ml:[Z]}],"space-x":[{"space-x":[Ae]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[Ae]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Ci,t]}],"min-w":[{"min-w":[Ci,t,"min","max","fit"]}],"max-w":[{"max-w":[Ci,t,"none","full","min","max","fit","prose",{screen:[Yh]},Yh]}],h:[{h:[Ci,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Ci,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Ci,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Ci,t,"auto","min","max","fit"]}],"font-size":[{text:["base",Yh,Kh]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",xA]}],"font-family":[{font:[h0]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Ci]}],"line-clamp":[{"line-clamp":["none",ey,xA]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Id,Ci]}],"list-image":[{"list-image":["none",Ci]}],"list-style-type":[{list:["none","disc","decimal",Ci]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[Q]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[Q]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Ke(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Id,Kh]}],"underline-offset":[{"underline-offset":["auto",Id,Ci]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:xe()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Ci]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Ci]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[Q]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...qt(),TX]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",SX]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},CX]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[Y]}],"gradient-via-pos":[{via:[Y]}],"gradient-to-pos":[{to:[Y]}],"gradient-from":[{from:[V]}],"gradient-via":[{via:[V]}],"gradient-to":[{to:[V]}],rounded:[{rounded:[_]}],"rounded-s":[{"rounded-s":[_]}],"rounded-e":[{"rounded-e":[_]}],"rounded-t":[{"rounded-t":[_]}],"rounded-r":[{"rounded-r":[_]}],"rounded-b":[{"rounded-b":[_]}],"rounded-l":[{"rounded-l":[_]}],"rounded-ss":[{"rounded-ss":[_]}],"rounded-se":[{"rounded-se":[_]}],"rounded-ee":[{"rounded-ee":[_]}],"rounded-es":[{"rounded-es":[_]}],"rounded-tl":[{"rounded-tl":[_]}],"rounded-tr":[{"rounded-tr":[_]}],"rounded-br":[{"rounded-br":[_]}],"rounded-bl":[{"rounded-bl":[_]}],"border-w":[{border:[o]}],"border-w-x":[{"border-x":[o]}],"border-w-y":[{"border-y":[o]}],"border-w-s":[{"border-s":[o]}],"border-w-e":[{"border-e":[o]}],"border-w-t":[{"border-t":[o]}],"border-w-r":[{"border-r":[o]}],"border-w-b":[{"border-b":[o]}],"border-w-l":[{"border-l":[o]}],"border-opacity":[{"border-opacity":[Q]}],"border-style":[{border:[...Ke(),"hidden"]}],"divide-x":[{"divide-x":[o]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[o]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[Q]}],"divide-style":[{divide:Ke()}],"border-color":[{border:[f]}],"border-color-x":[{"border-x":[f]}],"border-color-y":[{"border-y":[f]}],"border-color-s":[{"border-s":[f]}],"border-color-e":[{"border-e":[f]}],"border-color-t":[{"border-t":[f]}],"border-color-r":[{"border-r":[f]}],"border-color-b":[{"border-b":[f]}],"border-color-l":[{"border-l":[f]}],"divide-color":[{divide:[f]}],"outline-style":[{outline:["",...Ke()]}],"outline-offset":[{"outline-offset":[Id,Ci]}],"outline-w":[{outline:[Id,Kh]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:Be()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[Q]}],"ring-offset-w":[{"ring-offset":[Id,Kh]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",Yh,AX]}],"shadow-color":[{shadow:[h0]}],opacity:[{opacity:[Q]}],"mix-blend":[{"mix-blend":[...st(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":st()}],filter:[{filter:["","none"]}],blur:[{blur:[i]}],brightness:[{brightness:[l]}],contrast:[{contrast:[A]}],"drop-shadow":[{"drop-shadow":["","none",Yh,Ci]}],grayscale:[{grayscale:[I]}],"hue-rotate":[{"hue-rotate":[N]}],invert:[{invert:[U]}],saturate:[{saturate:[K]}],sepia:[{sepia:[le]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[i]}],"backdrop-brightness":[{"backdrop-brightness":[l]}],"backdrop-contrast":[{"backdrop-contrast":[A]}],"backdrop-grayscale":[{"backdrop-grayscale":[I]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[N]}],"backdrop-invert":[{"backdrop-invert":[U]}],"backdrop-opacity":[{"backdrop-opacity":[Q]}],"backdrop-saturate":[{"backdrop-saturate":[K]}],"backdrop-sepia":[{"backdrop-sepia":[le]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[x]}],"border-spacing-x":[{"border-spacing-x":[x]}],"border-spacing-y":[{"border-spacing-y":[x]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Ci]}],duration:[{duration:Pt()}],ease:[{ease:["linear","in","out","in-out",Ci]}],delay:[{delay:Pt()}],animate:[{animate:["none","spin","ping","pulse","bounce",Ci]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[ne]}],"scale-x":[{"scale-x":[ne]}],"scale-y":[{"scale-y":[ne]}],rotate:[{rotate:[d0,Ci]}],"translate-x":[{"translate-x":[Ze]}],"translate-y":[{"translate-y":[Ze]}],"skew-x":[{"skew-x":[pe]}],"skew-y":[{"skew-y":[pe]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Ci]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Ci]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":xe()}],"scroll-mx":[{"scroll-mx":xe()}],"scroll-my":[{"scroll-my":xe()}],"scroll-ms":[{"scroll-ms":xe()}],"scroll-me":[{"scroll-me":xe()}],"scroll-mt":[{"scroll-mt":xe()}],"scroll-mr":[{"scroll-mr":xe()}],"scroll-mb":[{"scroll-mb":xe()}],"scroll-ml":[{"scroll-ml":xe()}],"scroll-p":[{"scroll-p":xe()}],"scroll-px":[{"scroll-px":xe()}],"scroll-py":[{"scroll-py":xe()}],"scroll-ps":[{"scroll-ps":xe()}],"scroll-pe":[{"scroll-pe":xe()}],"scroll-pt":[{"scroll-pt":xe()}],"scroll-pr":[{"scroll-pr":xe()}],"scroll-pb":[{"scroll-pb":xe()}],"scroll-pl":[{"scroll-pl":xe()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Ci]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[Id,Kh,xA]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},RX=fX(PX);function wr(...e){return RX(O4(e))}const MX=AZ,Y4=F.forwardRef(({className:e,...t},i)=>d.jsx(I4,{ref:i,className:wr("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t}));Y4.displayName=I4.displayName;const NX=By("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),J4=F.forwardRef(({className:e,variant:t,...i},l)=>d.jsx(k4,{ref:l,className:wr(NX({variant:t}),e),...i}));J4.displayName=k4.displayName;const DX=F.forwardRef(({className:e,...t},i)=>d.jsx(M4,{ref:i,className:wr("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",e),...t}));DX.displayName=M4.displayName;const Q4=F.forwardRef(({className:e,...t},i)=>d.jsx(N4,{ref:i,className:wr("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...t,children:d.jsx(sP,{className:"h-4 w-4"})}));Q4.displayName=N4.displayName;const e5=F.forwardRef(({className:e,...t},i)=>d.jsx(P4,{ref:i,className:wr("text-sm font-semibold",e),...t}));e5.displayName=P4.displayName;const t5=F.forwardRef(({className:e,...t},i)=>d.jsx(R4,{ref:i,className:wr("text-sm opacity-90",e),...t}));t5.displayName=R4.displayName;function OX(){const{toasts:e}=Hf();return d.jsxs(MX,{children:[e.map(function({id:t,title:i,description:l,action:f,..._}){return d.jsxs(J4,{..._,children:[d.jsxs("div",{className:"grid gap-1",children:[i&&d.jsx(e5,{children:i}),l&&d.jsx(t5,{children:l})]}),f,d.jsx(Q4,{})]},t)}),d.jsx(Y4,{})]})}var PL=["light","dark"],LX="(prefers-color-scheme: dark)",zX=F.createContext(void 0),FX={setTheme:e=>{},themes:[]},BX=()=>{var e;return(e=F.useContext(zX))!=null?e:FX};F.memo(({forcedTheme:e,storageKey:t,attribute:i,enableSystem:l,enableColorScheme:f,defaultTheme:_,value:x,attrs:o,nonce:A})=>{let I=_==="system",N=i==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${o.map(Y=>`'${Y}'`).join(",")})`};`:`var d=document.documentElement,n='${i}',s='setAttribute';`,U=f?PL.includes(_)&&_?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${_}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",$=(Y,q=!1,Z=!0)=>{let Q=x?x[Y]:Y,H=q?Y+"|| ''":`'${Q}'`,K="";return f&&Z&&!q&&PL.includes(Y)&&(K+=`d.style.colorScheme = '${Y}';`),i==="class"?q||Q?K+=`c.add(${H})`:K+="null":Q&&(K+=`d[s](n,${H})`),K},V=e?`!function(){${N}${$(e)}}()`:l?`!function(){try{${N}var e=localStorage.getItem('${t}');if('system'===e||(!e&&${I})){var t='${LX}',m=window.matchMedia(t);if(m.media!==t||m.matches){${$("dark")}}else{${$("light")}}}else if(e){${x?`var x=${JSON.stringify(x)};`:""}${$(x?"x[e]":"e",!0)}}${I?"":"else{"+$(_,!1,!1)+"}"}${U}}catch(e){}}()`:`!function(){try{${N}var e=localStorage.getItem('${t}');if(e){${x?`var x=${JSON.stringify(x)};`:""}${$(x?"x[e]":"e",!0)}}else{${$(_,!1,!1)};}${U}}catch(t){}}();`;return F.createElement("script",{nonce:A,dangerouslySetInnerHTML:{__html:V}})});var VX=e=>{switch(e){case"success":return qX;case"info":return HX;case"warning":return GX;case"error":return WX;default:return null}},UX=Array(12).fill(0),$X=({visible:e,className:t})=>ar.createElement("div",{className:["sonner-loading-wrapper",t].filter(Boolean).join(" "),"data-visible":e},ar.createElement("div",{className:"sonner-spinner"},UX.map((i,l)=>ar.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${l}`})))),qX=ar.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},ar.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),GX=ar.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},ar.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),HX=ar.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},ar.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),WX=ar.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},ar.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),ZX=ar.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},ar.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),ar.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),XX=()=>{let[e,t]=ar.useState(document.hidden);return ar.useEffect(()=>{let i=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",i),()=>window.removeEventListener("visibilitychange",i)},[]),e},nI=1,KX=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let t=this.subscribers.indexOf(e);this.subscribers.splice(t,1)}),this.publish=e=>{this.subscribers.forEach(t=>t(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var t;let{message:i,...l}=e,f=typeof(e==null?void 0:e.id)=="number"||((t=e.id)==null?void 0:t.length)>0?e.id:nI++,_=this.toasts.find(o=>o.id===f),x=e.dismissible===void 0?!0:e.dismissible;return this.dismissedToasts.has(f)&&this.dismissedToasts.delete(f),_?this.toasts=this.toasts.map(o=>o.id===f?(this.publish({...o,...e,id:f,title:i}),{...o,...e,id:f,dismissible:x,title:i}):o):this.addToast({title:i,...l,dismissible:x,id:f}),f},this.dismiss=e=>(this.dismissedToasts.add(e),e||this.toasts.forEach(t=>{this.subscribers.forEach(i=>i({id:t.id,dismiss:!0}))}),this.subscribers.forEach(t=>t({id:e,dismiss:!0})),e),this.message=(e,t)=>this.create({...t,message:e}),this.error=(e,t)=>this.create({...t,message:e,type:"error"}),this.success=(e,t)=>this.create({...t,type:"success",message:e}),this.info=(e,t)=>this.create({...t,type:"info",message:e}),this.warning=(e,t)=>this.create({...t,type:"warning",message:e}),this.loading=(e,t)=>this.create({...t,type:"loading",message:e}),this.promise=(e,t)=>{if(!t)return;let i;t.loading!==void 0&&(i=this.create({...t,promise:e,type:"loading",message:t.loading,description:typeof t.description!="function"?t.description:void 0}));let l=e instanceof Promise?e:e(),f=i!==void 0,_,x=l.then(async A=>{if(_=["resolve",A],ar.isValidElement(A))f=!1,this.create({id:i,type:"default",message:A});else if(JX(A)&&!A.ok){f=!1;let I=typeof t.error=="function"?await t.error(`HTTP error! status: ${A.status}`):t.error,N=typeof t.description=="function"?await t.description(`HTTP error! status: ${A.status}`):t.description;this.create({id:i,type:"error",message:I,description:N})}else if(t.success!==void 0){f=!1;let I=typeof t.success=="function"?await t.success(A):t.success,N=typeof t.description=="function"?await t.description(A):t.description;this.create({id:i,type:"success",message:I,description:N})}}).catch(async A=>{if(_=["reject",A],t.error!==void 0){f=!1;let I=typeof t.error=="function"?await t.error(A):t.error,N=typeof t.description=="function"?await t.description(A):t.description;this.create({id:i,type:"error",message:I,description:N})}}).finally(()=>{var A;f&&(this.dismiss(i),i=void 0),(A=t.finally)==null||A.call(t)}),o=()=>new Promise((A,I)=>x.then(()=>_[0]==="reject"?I(_[1]):A(_[1])).catch(I));return typeof i!="string"&&typeof i!="number"?{unwrap:o}:Object.assign(i,{unwrap:o})},this.custom=(e,t)=>{let i=(t==null?void 0:t.id)||nI++;return this.create({jsx:e(i),id:i,...t}),i},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},xl=new KX,YX=(e,t)=>{let i=(t==null?void 0:t.id)||nI++;return xl.addToast({title:e,...t,id:i}),i},JX=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",QX=YX,eK=()=>xl.toasts,tK=()=>xl.getActiveToasts(),Yt=Object.assign(QX,{success:xl.success,info:xl.info,warning:xl.warning,error:xl.error,custom:xl.custom,message:xl.message,promise:xl.promise,dismiss:xl.dismiss,loading:xl.loading},{getHistory:eK,getToasts:tK});function rK(e,{insertAt:t}={}){if(typeof document>"u")return;let i=document.head||document.getElementsByTagName("head")[0],l=document.createElement("style");l.type="text/css",t==="top"&&i.firstChild?i.insertBefore(l,i.firstChild):i.appendChild(l),l.styleSheet?l.styleSheet.cssText=e:l.appendChild(document.createTextNode(e))}rK(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function rS(e){return e.label!==void 0}var nK=3,iK="32px",sK="16px",RL=4e3,oK=356,aK=14,lK=20,cK=200;function Wc(...e){return e.filter(Boolean).join(" ")}function uK(e){let[t,i]=e.split("-"),l=[];return t&&l.push(t),i&&l.push(i),l}var dK=e=>{var t,i,l,f,_,x,o,A,I,N,U;let{invert:$,toast:V,unstyled:Y,interacting:q,setHeights:Z,visibleToasts:Q,heights:H,index:K,toasts:ne,expanded:le,removeToast:pe,defaultRichColors:Ae,closeButton:Ze,style:Xe,cancelButtonStyle:Je,actionButtonStyle:Te,className:xe="",descriptionClassName:Be="",duration:dt,position:qt,gap:Ke,loadingIcon:st,expandByDefault:Ne,classNames:De,icons:Tt,closeButtonAriaLabel:Pt="Close toast",pauseWhenPageIsHidden:fe}=e,[Le,vt]=ar.useState(null),[Wt,Ft]=ar.useState(null),[Ut,vr]=ar.useState(!1),[xr,zr]=ar.useState(!1),[Hr,jn]=ar.useState(!1),[hn,Ji]=ar.useState(!1),[Ii,Vi]=ar.useState(!1),[As,bi]=ar.useState(0),[Is,nt]=ar.useState(0),Ct=ar.useRef(V.duration||dt||RL),Kt=ar.useRef(null),jr=ar.useRef(null),yr=K===0,br=K+1<=Q,Fr=V.type,On=V.dismissible!==!1,pi=V.className||"",Ri=V.descriptionClassName||"",$s=ar.useMemo(()=>H.findIndex(Yn=>Yn.toastId===V.id)||0,[H,V.id]),ws=ar.useMemo(()=>{var Yn;return(Yn=V.closeButton)!=null?Yn:Ze},[V.closeButton,Ze]),Lo=ar.useMemo(()=>V.duration||dt||RL,[V.duration,dt]),ho=ar.useRef(0),rr=ar.useRef(0),yt=ar.useRef(0),Ar=ar.useRef(null),[Qr,Cn]=qt.split("-"),Mi=ar.useMemo(()=>H.reduce((Yn,qi,ps)=>ps>=$s?Yn:Yn+qi.height,0),[H,$s]),li=XX(),Os=V.invert||$,Il=Fr==="loading";rr.current=ar.useMemo(()=>$s*Ke+Mi,[$s,Mi]),ar.useEffect(()=>{Ct.current=Lo},[Lo]),ar.useEffect(()=>{vr(!0)},[]),ar.useEffect(()=>{let Yn=jr.current;if(Yn){let qi=Yn.getBoundingClientRect().height;return nt(qi),Z(ps=>[{toastId:V.id,height:qi,position:V.position},...ps]),()=>Z(ps=>ps.filter(Ao=>Ao.toastId!==V.id))}},[Z,V.id]),ar.useLayoutEffect(()=>{if(!Ut)return;let Yn=jr.current,qi=Yn.style.height;Yn.style.height="auto";let ps=Yn.getBoundingClientRect().height;Yn.style.height=qi,nt(ps),Z(Ao=>Ao.find(wt=>wt.toastId===V.id)?Ao.map(wt=>wt.toastId===V.id?{...wt,height:ps}:wt):[{toastId:V.id,height:ps,position:V.position},...Ao])},[Ut,V.title,V.description,Z,V.id]);let zo=ar.useCallback(()=>{zr(!0),bi(rr.current),Z(Yn=>Yn.filter(qi=>qi.toastId!==V.id)),setTimeout(()=>{pe(V)},cK)},[V,pe,Z,rr]);ar.useEffect(()=>{if(V.promise&&Fr==="loading"||V.duration===1/0||V.type==="loading")return;let Yn;return le||q||fe&&li?(()=>{if(yt.current<ho.current){let qi=new Date().getTime()-ho.current;Ct.current=Ct.current-qi}yt.current=new Date().getTime()})():Ct.current!==1/0&&(ho.current=new Date().getTime(),Yn=setTimeout(()=>{var qi;(qi=V.onAutoClose)==null||qi.call(V,V),zo()},Ct.current)),()=>clearTimeout(Yn)},[le,q,V,Fr,fe,li,zo]),ar.useEffect(()=>{V.delete&&zo()},[zo,V.delete]);function ra(){var Yn,qi,ps;return Tt!=null&&Tt.loading?ar.createElement("div",{className:Wc(De==null?void 0:De.loader,(Yn=V==null?void 0:V.classNames)==null?void 0:Yn.loader,"sonner-loader"),"data-visible":Fr==="loading"},Tt.loading):st?ar.createElement("div",{className:Wc(De==null?void 0:De.loader,(qi=V==null?void 0:V.classNames)==null?void 0:qi.loader,"sonner-loader"),"data-visible":Fr==="loading"},st):ar.createElement($X,{className:Wc(De==null?void 0:De.loader,(ps=V==null?void 0:V.classNames)==null?void 0:ps.loader),visible:Fr==="loading"})}return ar.createElement("li",{tabIndex:0,ref:jr,className:Wc(xe,pi,De==null?void 0:De.toast,(t=V==null?void 0:V.classNames)==null?void 0:t.toast,De==null?void 0:De.default,De==null?void 0:De[Fr],(i=V==null?void 0:V.classNames)==null?void 0:i[Fr]),"data-sonner-toast":"","data-rich-colors":(l=V.richColors)!=null?l:Ae,"data-styled":!(V.jsx||V.unstyled||Y),"data-mounted":Ut,"data-promise":!!V.promise,"data-swiped":Ii,"data-removed":xr,"data-visible":br,"data-y-position":Qr,"data-x-position":Cn,"data-index":K,"data-front":yr,"data-swiping":Hr,"data-dismissible":On,"data-type":Fr,"data-invert":Os,"data-swipe-out":hn,"data-swipe-direction":Wt,"data-expanded":!!(le||Ne&&Ut),style:{"--index":K,"--toasts-before":K,"--z-index":ne.length-K,"--offset":`${xr?As:rr.current}px`,"--initial-height":Ne?"auto":`${Is}px`,...Xe,...V.style},onDragEnd:()=>{jn(!1),vt(null),Ar.current=null},onPointerDown:Yn=>{Il||!On||(Kt.current=new Date,bi(rr.current),Yn.target.setPointerCapture(Yn.pointerId),Yn.target.tagName!=="BUTTON"&&(jn(!0),Ar.current={x:Yn.clientX,y:Yn.clientY}))},onPointerUp:()=>{var Yn,qi,ps,Ao;if(hn||!On)return;Ar.current=null;let wt=Number(((Yn=jr.current)==null?void 0:Yn.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),jo=Number(((qi=jr.current)==null?void 0:qi.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),ja=new Date().getTime()-((ps=Kt.current)==null?void 0:ps.getTime()),Fo=Le==="x"?wt:jo,gn=Math.abs(Fo)/ja;if(Math.abs(Fo)>=lK||gn>.11){bi(rr.current),(Ao=V.onDismiss)==null||Ao.call(V,V),Ft(Le==="x"?wt>0?"right":"left":jo>0?"down":"up"),zo(),Ji(!0),Vi(!1);return}jn(!1),vt(null)},onPointerMove:Yn=>{var qi,ps,Ao,wt;if(!Ar.current||!On||((qi=window.getSelection())==null?void 0:qi.toString().length)>0)return;let jo=Yn.clientY-Ar.current.y,ja=Yn.clientX-Ar.current.x,Fo=(ps=e.swipeDirections)!=null?ps:uK(qt);!Le&&(Math.abs(ja)>1||Math.abs(jo)>1)&&vt(Math.abs(ja)>Math.abs(jo)?"x":"y");let gn={x:0,y:0};Le==="y"?(Fo.includes("top")||Fo.includes("bottom"))&&(Fo.includes("top")&&jo<0||Fo.includes("bottom")&&jo>0)&&(gn.y=jo):Le==="x"&&(Fo.includes("left")||Fo.includes("right"))&&(Fo.includes("left")&&ja<0||Fo.includes("right")&&ja>0)&&(gn.x=ja),(Math.abs(gn.x)>0||Math.abs(gn.y)>0)&&Vi(!0),(Ao=jr.current)==null||Ao.style.setProperty("--swipe-amount-x",`${gn.x}px`),(wt=jr.current)==null||wt.style.setProperty("--swipe-amount-y",`${gn.y}px`)}},ws&&!V.jsx?ar.createElement("button",{"aria-label":Pt,"data-disabled":Il,"data-close-button":!0,onClick:Il||!On?()=>{}:()=>{var Yn;zo(),(Yn=V.onDismiss)==null||Yn.call(V,V)},className:Wc(De==null?void 0:De.closeButton,(f=V==null?void 0:V.classNames)==null?void 0:f.closeButton)},(_=Tt==null?void 0:Tt.close)!=null?_:ZX):null,V.jsx||F.isValidElement(V.title)?V.jsx?V.jsx:typeof V.title=="function"?V.title():V.title:ar.createElement(ar.Fragment,null,Fr||V.icon||V.promise?ar.createElement("div",{"data-icon":"",className:Wc(De==null?void 0:De.icon,(x=V==null?void 0:V.classNames)==null?void 0:x.icon)},V.promise||V.type==="loading"&&!V.icon?V.icon||ra():null,V.type!=="loading"?V.icon||(Tt==null?void 0:Tt[Fr])||VX(Fr):null):null,ar.createElement("div",{"data-content":"",className:Wc(De==null?void 0:De.content,(o=V==null?void 0:V.classNames)==null?void 0:o.content)},ar.createElement("div",{"data-title":"",className:Wc(De==null?void 0:De.title,(A=V==null?void 0:V.classNames)==null?void 0:A.title)},typeof V.title=="function"?V.title():V.title),V.description?ar.createElement("div",{"data-description":"",className:Wc(Be,Ri,De==null?void 0:De.description,(I=V==null?void 0:V.classNames)==null?void 0:I.description)},typeof V.description=="function"?V.description():V.description):null),F.isValidElement(V.cancel)?V.cancel:V.cancel&&rS(V.cancel)?ar.createElement("button",{"data-button":!0,"data-cancel":!0,style:V.cancelButtonStyle||Je,onClick:Yn=>{var qi,ps;rS(V.cancel)&&On&&((ps=(qi=V.cancel).onClick)==null||ps.call(qi,Yn),zo())},className:Wc(De==null?void 0:De.cancelButton,(N=V==null?void 0:V.classNames)==null?void 0:N.cancelButton)},V.cancel.label):null,F.isValidElement(V.action)?V.action:V.action&&rS(V.action)?ar.createElement("button",{"data-button":!0,"data-action":!0,style:V.actionButtonStyle||Te,onClick:Yn=>{var qi,ps;rS(V.action)&&((ps=(qi=V.action).onClick)==null||ps.call(qi,Yn),!Yn.defaultPrevented&&zo())},className:Wc(De==null?void 0:De.actionButton,(U=V==null?void 0:V.classNames)==null?void 0:U.actionButton)},V.action.label):null))};function ML(){if(typeof window>"u"||typeof document>"u")return"ltr";let e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}function hK(e,t){let i={};return[e,t].forEach((l,f)=>{let _=f===1,x=_?"--mobile-offset":"--offset",o=_?sK:iK;function A(I){["top","right","bottom","left"].forEach(N=>{i[`${x}-${N}`]=typeof I=="number"?`${I}px`:I})}typeof l=="number"||typeof l=="string"?A(l):typeof l=="object"?["top","right","bottom","left"].forEach(I=>{l[I]===void 0?i[`${x}-${I}`]=o:i[`${x}-${I}`]=typeof l[I]=="number"?`${l[I]}px`:l[I]}):A(o)}),i}var fK=F.forwardRef(function(e,t){let{invert:i,position:l="bottom-right",hotkey:f=["altKey","KeyT"],expand:_,closeButton:x,className:o,offset:A,mobileOffset:I,theme:N="light",richColors:U,duration:$,style:V,visibleToasts:Y=nK,toastOptions:q,dir:Z=ML(),gap:Q=aK,loadingIcon:H,icons:K,containerAriaLabel:ne="Notifications",pauseWhenPageIsHidden:le}=e,[pe,Ae]=ar.useState([]),Ze=ar.useMemo(()=>Array.from(new Set([l].concat(pe.filter(fe=>fe.position).map(fe=>fe.position)))),[pe,l]),[Xe,Je]=ar.useState([]),[Te,xe]=ar.useState(!1),[Be,dt]=ar.useState(!1),[qt,Ke]=ar.useState(N!=="system"?N:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),st=ar.useRef(null),Ne=f.join("+").replace(/Key/g,"").replace(/Digit/g,""),De=ar.useRef(null),Tt=ar.useRef(!1),Pt=ar.useCallback(fe=>{Ae(Le=>{var vt;return(vt=Le.find(Wt=>Wt.id===fe.id))!=null&&vt.delete||xl.dismiss(fe.id),Le.filter(({id:Wt})=>Wt!==fe.id)})},[]);return ar.useEffect(()=>xl.subscribe(fe=>{if(fe.dismiss){Ae(Le=>Le.map(vt=>vt.id===fe.id?{...vt,delete:!0}:vt));return}setTimeout(()=>{o4.flushSync(()=>{Ae(Le=>{let vt=Le.findIndex(Wt=>Wt.id===fe.id);return vt!==-1?[...Le.slice(0,vt),{...Le[vt],...fe},...Le.slice(vt+1)]:[fe,...Le]})})})}),[]),ar.useEffect(()=>{if(N!=="system"){Ke(N);return}if(N==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?Ke("dark"):Ke("light")),typeof window>"u")return;let fe=window.matchMedia("(prefers-color-scheme: dark)");try{fe.addEventListener("change",({matches:Le})=>{Ke(Le?"dark":"light")})}catch{fe.addListener(({matches:vt})=>{try{Ke(vt?"dark":"light")}catch(Wt){console.error(Wt)}})}},[N]),ar.useEffect(()=>{pe.length<=1&&xe(!1)},[pe]),ar.useEffect(()=>{let fe=Le=>{var vt,Wt;f.every(Ft=>Le[Ft]||Le.code===Ft)&&(xe(!0),(vt=st.current)==null||vt.focus()),Le.code==="Escape"&&(document.activeElement===st.current||(Wt=st.current)!=null&&Wt.contains(document.activeElement))&&xe(!1)};return document.addEventListener("keydown",fe),()=>document.removeEventListener("keydown",fe)},[f]),ar.useEffect(()=>{if(st.current)return()=>{De.current&&(De.current.focus({preventScroll:!0}),De.current=null,Tt.current=!1)}},[st.current]),ar.createElement("section",{ref:t,"aria-label":`${ne} ${Ne}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},Ze.map((fe,Le)=>{var vt;let[Wt,Ft]=fe.split("-");return pe.length?ar.createElement("ol",{key:fe,dir:Z==="auto"?ML():Z,tabIndex:-1,ref:st,className:o,"data-sonner-toaster":!0,"data-theme":qt,"data-y-position":Wt,"data-lifted":Te&&pe.length>1&&!_,"data-x-position":Ft,style:{"--front-toast-height":`${((vt=Xe[0])==null?void 0:vt.height)||0}px`,"--width":`${oK}px`,"--gap":`${Q}px`,...V,...hK(A,I)},onBlur:Ut=>{Tt.current&&!Ut.currentTarget.contains(Ut.relatedTarget)&&(Tt.current=!1,De.current&&(De.current.focus({preventScroll:!0}),De.current=null))},onFocus:Ut=>{Ut.target instanceof HTMLElement&&Ut.target.dataset.dismissible==="false"||Tt.current||(Tt.current=!0,De.current=Ut.relatedTarget)},onMouseEnter:()=>xe(!0),onMouseMove:()=>xe(!0),onMouseLeave:()=>{Be||xe(!1)},onDragEnd:()=>xe(!1),onPointerDown:Ut=>{Ut.target instanceof HTMLElement&&Ut.target.dataset.dismissible==="false"||dt(!0)},onPointerUp:()=>dt(!1)},pe.filter(Ut=>!Ut.position&&Le===0||Ut.position===fe).map((Ut,vr)=>{var xr,zr;return ar.createElement(dK,{key:Ut.id,icons:K,index:vr,toast:Ut,defaultRichColors:U,duration:(xr=q==null?void 0:q.duration)!=null?xr:$,className:q==null?void 0:q.className,descriptionClassName:q==null?void 0:q.descriptionClassName,invert:i,visibleToasts:Y,closeButton:(zr=q==null?void 0:q.closeButton)!=null?zr:x,interacting:Be,position:fe,style:q==null?void 0:q.style,unstyled:q==null?void 0:q.unstyled,classNames:q==null?void 0:q.classNames,cancelButtonStyle:q==null?void 0:q.cancelButtonStyle,actionButtonStyle:q==null?void 0:q.actionButtonStyle,removeToast:Pt,toasts:pe.filter(Hr=>Hr.position==Ut.position),heights:Xe.filter(Hr=>Hr.position==Ut.position),setHeights:Je,expandByDefault:_,gap:Q,loadingIcon:H,expanded:Te,pauseWhenPageIsHidden:le,swipeDirections:e.swipeDirections})})):null}))});const pK=({...e})=>{const{theme:t="system"}=BX();return d.jsx(fK,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e})};var mK=ak[" useId ".trim().toString()]||(()=>{}),gK=0;function Wd(e){const[t,i]=F.useState(mK());return ha(()=>{i(l=>l??String(gK++))},[e]),t?`radix-${t}`:""}const _K=["top","right","bottom","left"],Ff=Math.min,Bl=Math.max,_T=Math.round,nS=Math.floor,Ju=e=>({x:e,y:e}),yK={left:"right",right:"left",bottom:"top",top:"bottom"},vK={start:"end",end:"start"};function iI(e,t,i){return Bl(e,Ff(t,i))}function Qd(e,t){return typeof e=="function"?e(t):e}function eh(e){return e.split("-")[0]}function qy(e){return e.split("-")[1]}function aP(e){return e==="x"?"y":"x"}function lP(e){return e==="y"?"height":"width"}const xK=new Set(["top","bottom"]);function Hu(e){return xK.has(eh(e))?"y":"x"}function cP(e){return aP(Hu(e))}function bK(e,t,i){i===void 0&&(i=!1);const l=qy(e),f=cP(e),_=lP(f);let x=f==="x"?l===(i?"end":"start")?"right":"left":l==="start"?"bottom":"top";return t.reference[_]>t.floating[_]&&(x=yT(x)),[x,yT(x)]}function wK(e){const t=yT(e);return[sI(e),t,sI(t)]}function sI(e){return e.replace(/start|end/g,t=>vK[t])}const NL=["left","right"],DL=["right","left"],SK=["top","bottom"],TK=["bottom","top"];function EK(e,t,i){switch(e){case"top":case"bottom":return i?t?DL:NL:t?NL:DL;case"left":case"right":return t?SK:TK;default:return[]}}function CK(e,t,i,l){const f=qy(e);let _=EK(eh(e),i==="start",l);return f&&(_=_.map(x=>x+"-"+f),t&&(_=_.concat(_.map(sI)))),_}function yT(e){return e.replace(/left|right|bottom|top/g,t=>yK[t])}function AK(e){return{top:0,right:0,bottom:0,left:0,...e}}function r5(e){return typeof e!="number"?AK(e):{top:e,right:e,bottom:e,left:e}}function vT(e){const{x:t,y:i,width:l,height:f}=e;return{width:l,height:f,top:i,left:t,right:t+l,bottom:i+f,x:t,y:i}}function OL(e,t,i){let{reference:l,floating:f}=e;const _=Hu(t),x=cP(t),o=lP(x),A=eh(t),I=_==="y",N=l.x+l.width/2-f.width/2,U=l.y+l.height/2-f.height/2,$=l[o]/2-f[o]/2;let V;switch(A){case"top":V={x:N,y:l.y-f.height};break;case"bottom":V={x:N,y:l.y+l.height};break;case"right":V={x:l.x+l.width,y:U};break;case"left":V={x:l.x-f.width,y:U};break;default:V={x:l.x,y:l.y}}switch(qy(t)){case"start":V[x]-=$*(i&&I?-1:1);break;case"end":V[x]+=$*(i&&I?-1:1);break}return V}const jK=async(e,t,i)=>{const{placement:l="bottom",strategy:f="absolute",middleware:_=[],platform:x}=i,o=_.filter(Boolean),A=await(x.isRTL==null?void 0:x.isRTL(t));let I=await x.getElementRects({reference:e,floating:t,strategy:f}),{x:N,y:U}=OL(I,l,A),$=l,V={},Y=0;for(let q=0;q<o.length;q++){const{name:Z,fn:Q}=o[q],{x:H,y:K,data:ne,reset:le}=await Q({x:N,y:U,initialPlacement:l,placement:$,strategy:f,middlewareData:V,rects:I,platform:x,elements:{reference:e,floating:t}});N=H??N,U=K??U,V={...V,[Z]:{...V[Z],...ne}},le&&Y<=50&&(Y++,typeof le=="object"&&(le.placement&&($=le.placement),le.rects&&(I=le.rects===!0?await x.getElementRects({reference:e,floating:t,strategy:f}):le.rects),{x:N,y:U}=OL(I,$,A)),q=-1)}return{x:N,y:U,placement:$,strategy:f,middlewareData:V}};async function ob(e,t){var i;t===void 0&&(t={});const{x:l,y:f,platform:_,rects:x,elements:o,strategy:A}=e,{boundary:I="clippingAncestors",rootBoundary:N="viewport",elementContext:U="floating",altBoundary:$=!1,padding:V=0}=Qd(t,e),Y=r5(V),Z=o[$?U==="floating"?"reference":"floating":U],Q=vT(await _.getClippingRect({element:(i=await(_.isElement==null?void 0:_.isElement(Z)))==null||i?Z:Z.contextElement||await(_.getDocumentElement==null?void 0:_.getDocumentElement(o.floating)),boundary:I,rootBoundary:N,strategy:A})),H=U==="floating"?{x:l,y:f,width:x.floating.width,height:x.floating.height}:x.reference,K=await(_.getOffsetParent==null?void 0:_.getOffsetParent(o.floating)),ne=await(_.isElement==null?void 0:_.isElement(K))?await(_.getScale==null?void 0:_.getScale(K))||{x:1,y:1}:{x:1,y:1},le=vT(_.convertOffsetParentRelativeRectToViewportRelativeRect?await _.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:H,offsetParent:K,strategy:A}):H);return{top:(Q.top-le.top+Y.top)/ne.y,bottom:(le.bottom-Q.bottom+Y.bottom)/ne.y,left:(Q.left-le.left+Y.left)/ne.x,right:(le.right-Q.right+Y.right)/ne.x}}const IK=e=>({name:"arrow",options:e,async fn(t){const{x:i,y:l,placement:f,rects:_,platform:x,elements:o,middlewareData:A}=t,{element:I,padding:N=0}=Qd(e,t)||{};if(I==null)return{};const U=r5(N),$={x:i,y:l},V=cP(f),Y=lP(V),q=await x.getDimensions(I),Z=V==="y",Q=Z?"top":"left",H=Z?"bottom":"right",K=Z?"clientHeight":"clientWidth",ne=_.reference[Y]+_.reference[V]-$[V]-_.floating[Y],le=$[V]-_.reference[V],pe=await(x.getOffsetParent==null?void 0:x.getOffsetParent(I));let Ae=pe?pe[K]:0;(!Ae||!await(x.isElement==null?void 0:x.isElement(pe)))&&(Ae=o.floating[K]||_.floating[Y]);const Ze=ne/2-le/2,Xe=Ae/2-q[Y]/2-1,Je=Ff(U[Q],Xe),Te=Ff(U[H],Xe),xe=Je,Be=Ae-q[Y]-Te,dt=Ae/2-q[Y]/2+Ze,qt=iI(xe,dt,Be),Ke=!A.arrow&&qy(f)!=null&&dt!==qt&&_.reference[Y]/2-(dt<xe?Je:Te)-q[Y]/2<0,st=Ke?dt<xe?dt-xe:dt-Be:0;return{[V]:$[V]+st,data:{[V]:qt,centerOffset:dt-qt-st,...Ke&&{alignmentOffset:st}},reset:Ke}}}),kK=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var i,l;const{placement:f,middlewareData:_,rects:x,initialPlacement:o,platform:A,elements:I}=t,{mainAxis:N=!0,crossAxis:U=!0,fallbackPlacements:$,fallbackStrategy:V="bestFit",fallbackAxisSideDirection:Y="none",flipAlignment:q=!0,...Z}=Qd(e,t);if((i=_.arrow)!=null&&i.alignmentOffset)return{};const Q=eh(f),H=Hu(o),K=eh(o)===o,ne=await(A.isRTL==null?void 0:A.isRTL(I.floating)),le=$||(K||!q?[yT(o)]:wK(o)),pe=Y!=="none";!$&&pe&&le.push(...CK(o,q,Y,ne));const Ae=[o,...le],Ze=await ob(t,Z),Xe=[];let Je=((l=_.flip)==null?void 0:l.overflows)||[];if(N&&Xe.push(Ze[Q]),U){const dt=bK(f,x,ne);Xe.push(Ze[dt[0]],Ze[dt[1]])}if(Je=[...Je,{placement:f,overflows:Xe}],!Xe.every(dt=>dt<=0)){var Te,xe;const dt=(((Te=_.flip)==null?void 0:Te.index)||0)+1,qt=Ae[dt];if(qt&&(!(U==="alignment"?H!==Hu(qt):!1)||Je.every(Ne=>Ne.overflows[0]>0&&Hu(Ne.placement)===H)))return{data:{index:dt,overflows:Je},reset:{placement:qt}};let Ke=(xe=Je.filter(st=>st.overflows[0]<=0).sort((st,Ne)=>st.overflows[1]-Ne.overflows[1])[0])==null?void 0:xe.placement;if(!Ke)switch(V){case"bestFit":{var Be;const st=(Be=Je.filter(Ne=>{if(pe){const De=Hu(Ne.placement);return De===H||De==="y"}return!0}).map(Ne=>[Ne.placement,Ne.overflows.filter(De=>De>0).reduce((De,Tt)=>De+Tt,0)]).sort((Ne,De)=>Ne[1]-De[1])[0])==null?void 0:Be[0];st&&(Ke=st);break}case"initialPlacement":Ke=o;break}if(f!==Ke)return{reset:{placement:Ke}}}return{}}}};function LL(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function zL(e){return _K.some(t=>e[t]>=0)}const PK=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:i}=t,{strategy:l="referenceHidden",...f}=Qd(e,t);switch(l){case"referenceHidden":{const _=await ob(t,{...f,elementContext:"reference"}),x=LL(_,i.reference);return{data:{referenceHiddenOffsets:x,referenceHidden:zL(x)}}}case"escaped":{const _=await ob(t,{...f,altBoundary:!0}),x=LL(_,i.floating);return{data:{escapedOffsets:x,escaped:zL(x)}}}default:return{}}}}},n5=new Set(["left","top"]);async function RK(e,t){const{placement:i,platform:l,elements:f}=e,_=await(l.isRTL==null?void 0:l.isRTL(f.floating)),x=eh(i),o=qy(i),A=Hu(i)==="y",I=n5.has(x)?-1:1,N=_&&A?-1:1,U=Qd(t,e);let{mainAxis:$,crossAxis:V,alignmentAxis:Y}=typeof U=="number"?{mainAxis:U,crossAxis:0,alignmentAxis:null}:{mainAxis:U.mainAxis||0,crossAxis:U.crossAxis||0,alignmentAxis:U.alignmentAxis};return o&&typeof Y=="number"&&(V=o==="end"?Y*-1:Y),A?{x:V*N,y:$*I}:{x:$*I,y:V*N}}const MK=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var i,l;const{x:f,y:_,placement:x,middlewareData:o}=t,A=await RK(t,e);return x===((i=o.offset)==null?void 0:i.placement)&&(l=o.arrow)!=null&&l.alignmentOffset?{}:{x:f+A.x,y:_+A.y,data:{...A,placement:x}}}}},NK=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:i,y:l,placement:f}=t,{mainAxis:_=!0,crossAxis:x=!1,limiter:o={fn:Z=>{let{x:Q,y:H}=Z;return{x:Q,y:H}}},...A}=Qd(e,t),I={x:i,y:l},N=await ob(t,A),U=Hu(eh(f)),$=aP(U);let V=I[$],Y=I[U];if(_){const Z=$==="y"?"top":"left",Q=$==="y"?"bottom":"right",H=V+N[Z],K=V-N[Q];V=iI(H,V,K)}if(x){const Z=U==="y"?"top":"left",Q=U==="y"?"bottom":"right",H=Y+N[Z],K=Y-N[Q];Y=iI(H,Y,K)}const q=o.fn({...t,[$]:V,[U]:Y});return{...q,data:{x:q.x-i,y:q.y-l,enabled:{[$]:_,[U]:x}}}}}},DK=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:i,y:l,placement:f,rects:_,middlewareData:x}=t,{offset:o=0,mainAxis:A=!0,crossAxis:I=!0}=Qd(e,t),N={x:i,y:l},U=Hu(f),$=aP(U);let V=N[$],Y=N[U];const q=Qd(o,t),Z=typeof q=="number"?{mainAxis:q,crossAxis:0}:{mainAxis:0,crossAxis:0,...q};if(A){const K=$==="y"?"height":"width",ne=_.reference[$]-_.floating[K]+Z.mainAxis,le=_.reference[$]+_.reference[K]-Z.mainAxis;V<ne?V=ne:V>le&&(V=le)}if(I){var Q,H;const K=$==="y"?"width":"height",ne=n5.has(eh(f)),le=_.reference[U]-_.floating[K]+(ne&&((Q=x.offset)==null?void 0:Q[U])||0)+(ne?0:Z.crossAxis),pe=_.reference[U]+_.reference[K]+(ne?0:((H=x.offset)==null?void 0:H[U])||0)-(ne?Z.crossAxis:0);Y<le?Y=le:Y>pe&&(Y=pe)}return{[$]:V,[U]:Y}}}},OK=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var i,l;const{placement:f,rects:_,platform:x,elements:o}=t,{apply:A=()=>{},...I}=Qd(e,t),N=await ob(t,I),U=eh(f),$=qy(f),V=Hu(f)==="y",{width:Y,height:q}=_.floating;let Z,Q;U==="top"||U==="bottom"?(Z=U,Q=$===(await(x.isRTL==null?void 0:x.isRTL(o.floating))?"start":"end")?"left":"right"):(Q=U,Z=$==="end"?"top":"bottom");const H=q-N.top-N.bottom,K=Y-N.left-N.right,ne=Ff(q-N[Z],H),le=Ff(Y-N[Q],K),pe=!t.middlewareData.shift;let Ae=ne,Ze=le;if((i=t.middlewareData.shift)!=null&&i.enabled.x&&(Ze=K),(l=t.middlewareData.shift)!=null&&l.enabled.y&&(Ae=H),pe&&!$){const Je=Bl(N.left,0),Te=Bl(N.right,0),xe=Bl(N.top,0),Be=Bl(N.bottom,0);V?Ze=Y-2*(Je!==0||Te!==0?Je+Te:Bl(N.left,N.right)):Ae=q-2*(xe!==0||Be!==0?xe+Be:Bl(N.top,N.bottom))}await A({...t,availableWidth:Ze,availableHeight:Ae});const Xe=await x.getDimensions(o.floating);return Y!==Xe.width||q!==Xe.height?{reset:{rects:!0}}:{}}}};function p2(){return typeof window<"u"}function Gy(e){return i5(e)?(e.nodeName||"").toLowerCase():"#document"}function Gl(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function id(e){var t;return(t=(i5(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function i5(e){return p2()?e instanceof Node||e instanceof Gl(e).Node:!1}function uu(e){return p2()?e instanceof Element||e instanceof Gl(e).Element:!1}function ed(e){return p2()?e instanceof HTMLElement||e instanceof Gl(e).HTMLElement:!1}function FL(e){return!p2()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof Gl(e).ShadowRoot}const LK=new Set(["inline","contents"]);function kb(e){const{overflow:t,overflowX:i,overflowY:l,display:f}=du(e);return/auto|scroll|overlay|hidden|clip/.test(t+l+i)&&!LK.has(f)}const zK=new Set(["table","td","th"]);function FK(e){return zK.has(Gy(e))}const BK=[":popover-open",":modal"];function m2(e){return BK.some(t=>{try{return e.matches(t)}catch{return!1}})}const VK=["transform","translate","scale","rotate","perspective"],UK=["transform","translate","scale","rotate","perspective","filter"],$K=["paint","layout","strict","content"];function uP(e){const t=dP(),i=uu(e)?du(e):e;return VK.some(l=>i[l]?i[l]!=="none":!1)||(i.containerType?i.containerType!=="normal":!1)||!t&&(i.backdropFilter?i.backdropFilter!=="none":!1)||!t&&(i.filter?i.filter!=="none":!1)||UK.some(l=>(i.willChange||"").includes(l))||$K.some(l=>(i.contain||"").includes(l))}function qK(e){let t=Bf(e);for(;ed(t)&&!Cy(t);){if(uP(t))return t;if(m2(t))return null;t=Bf(t)}return null}function dP(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const GK=new Set(["html","body","#document"]);function Cy(e){return GK.has(Gy(e))}function du(e){return Gl(e).getComputedStyle(e)}function g2(e){return uu(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function Bf(e){if(Gy(e)==="html")return e;const t=e.assignedSlot||e.parentNode||FL(e)&&e.host||id(e);return FL(t)?t.host:t}function s5(e){const t=Bf(e);return Cy(t)?e.ownerDocument?e.ownerDocument.body:e.body:ed(t)&&kb(t)?t:s5(t)}function ab(e,t,i){var l;t===void 0&&(t=[]),i===void 0&&(i=!0);const f=s5(e),_=f===((l=e.ownerDocument)==null?void 0:l.body),x=Gl(f);if(_){const o=oI(x);return t.concat(x,x.visualViewport||[],kb(f)?f:[],o&&i?ab(o):[])}return t.concat(f,ab(f,[],i))}function oI(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function o5(e){const t=du(e);let i=parseFloat(t.width)||0,l=parseFloat(t.height)||0;const f=ed(e),_=f?e.offsetWidth:i,x=f?e.offsetHeight:l,o=_T(i)!==_||_T(l)!==x;return o&&(i=_,l=x),{width:i,height:l,$:o}}function hP(e){return uu(e)?e:e.contextElement}function ty(e){const t=hP(e);if(!ed(t))return Ju(1);const i=t.getBoundingClientRect(),{width:l,height:f,$:_}=o5(t);let x=(_?_T(i.width):i.width)/l,o=(_?_T(i.height):i.height)/f;return(!x||!Number.isFinite(x))&&(x=1),(!o||!Number.isFinite(o))&&(o=1),{x,y:o}}const HK=Ju(0);function a5(e){const t=Gl(e);return!dP()||!t.visualViewport?HK:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function WK(e,t,i){return t===void 0&&(t=!1),!i||t&&i!==Gl(e)?!1:t}function Mm(e,t,i,l){t===void 0&&(t=!1),i===void 0&&(i=!1);const f=e.getBoundingClientRect(),_=hP(e);let x=Ju(1);t&&(l?uu(l)&&(x=ty(l)):x=ty(e));const o=WK(_,i,l)?a5(_):Ju(0);let A=(f.left+o.x)/x.x,I=(f.top+o.y)/x.y,N=f.width/x.x,U=f.height/x.y;if(_){const $=Gl(_),V=l&&uu(l)?Gl(l):l;let Y=$,q=oI(Y);for(;q&&l&&V!==Y;){const Z=ty(q),Q=q.getBoundingClientRect(),H=du(q),K=Q.left+(q.clientLeft+parseFloat(H.paddingLeft))*Z.x,ne=Q.top+(q.clientTop+parseFloat(H.paddingTop))*Z.y;A*=Z.x,I*=Z.y,N*=Z.x,U*=Z.y,A+=K,I+=ne,Y=Gl(q),q=oI(Y)}}return vT({width:N,height:U,x:A,y:I})}function fP(e,t){const i=g2(e).scrollLeft;return t?t.left+i:Mm(id(e)).left+i}function l5(e,t,i){i===void 0&&(i=!1);const l=e.getBoundingClientRect(),f=l.left+t.scrollLeft-(i?0:fP(e,l)),_=l.top+t.scrollTop;return{x:f,y:_}}function ZK(e){let{elements:t,rect:i,offsetParent:l,strategy:f}=e;const _=f==="fixed",x=id(l),o=t?m2(t.floating):!1;if(l===x||o&&_)return i;let A={scrollLeft:0,scrollTop:0},I=Ju(1);const N=Ju(0),U=ed(l);if((U||!U&&!_)&&((Gy(l)!=="body"||kb(x))&&(A=g2(l)),ed(l))){const V=Mm(l);I=ty(l),N.x=V.x+l.clientLeft,N.y=V.y+l.clientTop}const $=x&&!U&&!_?l5(x,A,!0):Ju(0);return{width:i.width*I.x,height:i.height*I.y,x:i.x*I.x-A.scrollLeft*I.x+N.x+$.x,y:i.y*I.y-A.scrollTop*I.y+N.y+$.y}}function XK(e){return Array.from(e.getClientRects())}function KK(e){const t=id(e),i=g2(e),l=e.ownerDocument.body,f=Bl(t.scrollWidth,t.clientWidth,l.scrollWidth,l.clientWidth),_=Bl(t.scrollHeight,t.clientHeight,l.scrollHeight,l.clientHeight);let x=-i.scrollLeft+fP(e);const o=-i.scrollTop;return du(l).direction==="rtl"&&(x+=Bl(t.clientWidth,l.clientWidth)-f),{width:f,height:_,x,y:o}}function YK(e,t){const i=Gl(e),l=id(e),f=i.visualViewport;let _=l.clientWidth,x=l.clientHeight,o=0,A=0;if(f){_=f.width,x=f.height;const I=dP();(!I||I&&t==="fixed")&&(o=f.offsetLeft,A=f.offsetTop)}return{width:_,height:x,x:o,y:A}}const JK=new Set(["absolute","fixed"]);function QK(e,t){const i=Mm(e,!0,t==="fixed"),l=i.top+e.clientTop,f=i.left+e.clientLeft,_=ed(e)?ty(e):Ju(1),x=e.clientWidth*_.x,o=e.clientHeight*_.y,A=f*_.x,I=l*_.y;return{width:x,height:o,x:A,y:I}}function BL(e,t,i){let l;if(t==="viewport")l=YK(e,i);else if(t==="document")l=KK(id(e));else if(uu(t))l=QK(t,i);else{const f=a5(e);l={x:t.x-f.x,y:t.y-f.y,width:t.width,height:t.height}}return vT(l)}function c5(e,t){const i=Bf(e);return i===t||!uu(i)||Cy(i)?!1:du(i).position==="fixed"||c5(i,t)}function eY(e,t){const i=t.get(e);if(i)return i;let l=ab(e,[],!1).filter(o=>uu(o)&&Gy(o)!=="body"),f=null;const _=du(e).position==="fixed";let x=_?Bf(e):e;for(;uu(x)&&!Cy(x);){const o=du(x),A=uP(x);!A&&o.position==="fixed"&&(f=null),(_?!A&&!f:!A&&o.position==="static"&&!!f&&JK.has(f.position)||kb(x)&&!A&&c5(e,x))?l=l.filter(N=>N!==x):f=o,x=Bf(x)}return t.set(e,l),l}function tY(e){let{element:t,boundary:i,rootBoundary:l,strategy:f}=e;const x=[...i==="clippingAncestors"?m2(t)?[]:eY(t,this._c):[].concat(i),l],o=x[0],A=x.reduce((I,N)=>{const U=BL(t,N,f);return I.top=Bl(U.top,I.top),I.right=Ff(U.right,I.right),I.bottom=Ff(U.bottom,I.bottom),I.left=Bl(U.left,I.left),I},BL(t,o,f));return{width:A.right-A.left,height:A.bottom-A.top,x:A.left,y:A.top}}function rY(e){const{width:t,height:i}=o5(e);return{width:t,height:i}}function nY(e,t,i){const l=ed(t),f=id(t),_=i==="fixed",x=Mm(e,!0,_,t);let o={scrollLeft:0,scrollTop:0};const A=Ju(0);function I(){A.x=fP(f)}if(l||!l&&!_)if((Gy(t)!=="body"||kb(f))&&(o=g2(t)),l){const V=Mm(t,!0,_,t);A.x=V.x+t.clientLeft,A.y=V.y+t.clientTop}else f&&I();_&&!l&&f&&I();const N=f&&!l&&!_?l5(f,o):Ju(0),U=x.left+o.scrollLeft-A.x-N.x,$=x.top+o.scrollTop-A.y-N.y;return{x:U,y:$,width:x.width,height:x.height}}function bA(e){return du(e).position==="static"}function VL(e,t){if(!ed(e)||du(e).position==="fixed")return null;if(t)return t(e);let i=e.offsetParent;return id(e)===i&&(i=i.ownerDocument.body),i}function u5(e,t){const i=Gl(e);if(m2(e))return i;if(!ed(e)){let f=Bf(e);for(;f&&!Cy(f);){if(uu(f)&&!bA(f))return f;f=Bf(f)}return i}let l=VL(e,t);for(;l&&FK(l)&&bA(l);)l=VL(l,t);return l&&Cy(l)&&bA(l)&&!uP(l)?i:l||qK(e)||i}const iY=async function(e){const t=this.getOffsetParent||u5,i=this.getDimensions,l=await i(e.floating);return{reference:nY(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:l.width,height:l.height}}};function sY(e){return du(e).direction==="rtl"}const oY={convertOffsetParentRelativeRectToViewportRelativeRect:ZK,getDocumentElement:id,getClippingRect:tY,getOffsetParent:u5,getElementRects:iY,getClientRects:XK,getDimensions:rY,getScale:ty,isElement:uu,isRTL:sY};function d5(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function aY(e,t){let i=null,l;const f=id(e);function _(){var o;clearTimeout(l),(o=i)==null||o.disconnect(),i=null}function x(o,A){o===void 0&&(o=!1),A===void 0&&(A=1),_();const I=e.getBoundingClientRect(),{left:N,top:U,width:$,height:V}=I;if(o||t(),!$||!V)return;const Y=nS(U),q=nS(f.clientWidth-(N+$)),Z=nS(f.clientHeight-(U+V)),Q=nS(N),K={rootMargin:-Y+"px "+-q+"px "+-Z+"px "+-Q+"px",threshold:Bl(0,Ff(1,A))||1};let ne=!0;function le(pe){const Ae=pe[0].intersectionRatio;if(Ae!==A){if(!ne)return x();Ae?x(!1,Ae):l=setTimeout(()=>{x(!1,1e-7)},1e3)}Ae===1&&!d5(I,e.getBoundingClientRect())&&x(),ne=!1}try{i=new IntersectionObserver(le,{...K,root:f.ownerDocument})}catch{i=new IntersectionObserver(le,K)}i.observe(e)}return x(!0),_}function lY(e,t,i,l){l===void 0&&(l={});const{ancestorScroll:f=!0,ancestorResize:_=!0,elementResize:x=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:A=!1}=l,I=hP(e),N=f||_?[...I?ab(I):[],...ab(t)]:[];N.forEach(Q=>{f&&Q.addEventListener("scroll",i,{passive:!0}),_&&Q.addEventListener("resize",i)});const U=I&&o?aY(I,i):null;let $=-1,V=null;x&&(V=new ResizeObserver(Q=>{let[H]=Q;H&&H.target===I&&V&&(V.unobserve(t),cancelAnimationFrame($),$=requestAnimationFrame(()=>{var K;(K=V)==null||K.observe(t)})),i()}),I&&!A&&V.observe(I),V.observe(t));let Y,q=A?Mm(e):null;A&&Z();function Z(){const Q=Mm(e);q&&!d5(q,Q)&&i(),q=Q,Y=requestAnimationFrame(Z)}return i(),()=>{var Q;N.forEach(H=>{f&&H.removeEventListener("scroll",i),_&&H.removeEventListener("resize",i)}),U==null||U(),(Q=V)==null||Q.disconnect(),V=null,A&&cancelAnimationFrame(Y)}}const cY=MK,uY=NK,dY=kK,hY=OK,fY=PK,UL=IK,pY=DK,mY=(e,t,i)=>{const l=new Map,f={platform:oY,...i},_={...f.platform,_c:l};return jK(e,t,{...f,platform:_})};var gY=typeof document<"u",_Y=function(){},zS=gY?F.useLayoutEffect:_Y;function xT(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let i,l,f;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(i=e.length,i!==t.length)return!1;for(l=i;l--!==0;)if(!xT(e[l],t[l]))return!1;return!0}if(f=Object.keys(e),i=f.length,i!==Object.keys(t).length)return!1;for(l=i;l--!==0;)if(!{}.hasOwnProperty.call(t,f[l]))return!1;for(l=i;l--!==0;){const _=f[l];if(!(_==="_owner"&&e.$$typeof)&&!xT(e[_],t[_]))return!1}return!0}return e!==e&&t!==t}function h5(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function $L(e,t){const i=h5(e);return Math.round(t*i)/i}function wA(e){const t=F.useRef(e);return zS(()=>{t.current=e}),t}function yY(e){e===void 0&&(e={});const{placement:t="bottom",strategy:i="absolute",middleware:l=[],platform:f,elements:{reference:_,floating:x}={},transform:o=!0,whileElementsMounted:A,open:I}=e,[N,U]=F.useState({x:0,y:0,strategy:i,placement:t,middlewareData:{},isPositioned:!1}),[$,V]=F.useState(l);xT($,l)||V(l);const[Y,q]=F.useState(null),[Z,Q]=F.useState(null),H=F.useCallback(Ne=>{Ne!==pe.current&&(pe.current=Ne,q(Ne))},[]),K=F.useCallback(Ne=>{Ne!==Ae.current&&(Ae.current=Ne,Q(Ne))},[]),ne=_||Y,le=x||Z,pe=F.useRef(null),Ae=F.useRef(null),Ze=F.useRef(N),Xe=A!=null,Je=wA(A),Te=wA(f),xe=wA(I),Be=F.useCallback(()=>{if(!pe.current||!Ae.current)return;const Ne={placement:t,strategy:i,middleware:$};Te.current&&(Ne.platform=Te.current),mY(pe.current,Ae.current,Ne).then(De=>{const Tt={...De,isPositioned:xe.current!==!1};dt.current&&!xT(Ze.current,Tt)&&(Ze.current=Tt,Gm.flushSync(()=>{U(Tt)}))})},[$,t,i,Te,xe]);zS(()=>{I===!1&&Ze.current.isPositioned&&(Ze.current.isPositioned=!1,U(Ne=>({...Ne,isPositioned:!1})))},[I]);const dt=F.useRef(!1);zS(()=>(dt.current=!0,()=>{dt.current=!1}),[]),zS(()=>{if(ne&&(pe.current=ne),le&&(Ae.current=le),ne&&le){if(Je.current)return Je.current(ne,le,Be);Be()}},[ne,le,Be,Je,Xe]);const qt=F.useMemo(()=>({reference:pe,floating:Ae,setReference:H,setFloating:K}),[H,K]),Ke=F.useMemo(()=>({reference:ne,floating:le}),[ne,le]),st=F.useMemo(()=>{const Ne={position:i,left:0,top:0};if(!Ke.floating)return Ne;const De=$L(Ke.floating,N.x),Tt=$L(Ke.floating,N.y);return o?{...Ne,transform:"translate("+De+"px, "+Tt+"px)",...h5(Ke.floating)>=1.5&&{willChange:"transform"}}:{position:i,left:De,top:Tt}},[i,o,Ke.floating,N.x,N.y]);return F.useMemo(()=>({...N,update:Be,refs:qt,elements:Ke,floatingStyles:st}),[N,Be,qt,Ke,st])}const vY=e=>{function t(i){return{}.hasOwnProperty.call(i,"current")}return{name:"arrow",options:e,fn(i){const{element:l,padding:f}=typeof e=="function"?e(i):e;return l&&t(l)?l.current!=null?UL({element:l.current,padding:f}).fn(i):{}:l?UL({element:l,padding:f}).fn(i):{}}}},xY=(e,t)=>({...cY(e),options:[e,t]}),bY=(e,t)=>({...uY(e),options:[e,t]}),wY=(e,t)=>({...pY(e),options:[e,t]}),SY=(e,t)=>({...dY(e),options:[e,t]}),TY=(e,t)=>({...hY(e),options:[e,t]}),EY=(e,t)=>({...fY(e),options:[e,t]}),CY=(e,t)=>({...vY(e),options:[e,t]});var AY="Arrow",f5=F.forwardRef((e,t)=>{const{children:i,width:l=10,height:f=5,..._}=e;return d.jsx(xi.svg,{..._,ref:t,width:l,height:f,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?i:d.jsx("polygon",{points:"0,0 30,0 15,10"})})});f5.displayName=AY;var jY=f5;function p5(e){const[t,i]=F.useState(void 0);return ha(()=>{if(e){i({width:e.offsetWidth,height:e.offsetHeight});const l=new ResizeObserver(f=>{if(!Array.isArray(f)||!f.length)return;const _=f[0];let x,o;if("borderBoxSize"in _){const A=_.borderBoxSize,I=Array.isArray(A)?A[0]:A;x=I.inlineSize,o=I.blockSize}else x=e.offsetWidth,o=e.offsetHeight;i({width:x,height:o})});return l.observe(e,{box:"border-box"}),()=>l.unobserve(e)}else i(void 0)},[e]),t}var pP="Popper",[m5,_2]=rd(pP),[IY,g5]=m5(pP),_5=e=>{const{__scopePopper:t,children:i}=e,[l,f]=F.useState(null);return d.jsx(IY,{scope:t,anchor:l,onAnchorChange:f,children:i})};_5.displayName=pP;var y5="PopperAnchor",v5=F.forwardRef((e,t)=>{const{__scopePopper:i,virtualRef:l,...f}=e,_=g5(y5,i),x=F.useRef(null),o=bs(t,x);return F.useEffect(()=>{_.onAnchorChange((l==null?void 0:l.current)||x.current)}),l?null:d.jsx(xi.div,{...f,ref:o})});v5.displayName=y5;var mP="PopperContent",[kY,PY]=m5(mP),x5=F.forwardRef((e,t)=>{var Ut,vr,xr,zr,Hr,jn;const{__scopePopper:i,side:l="bottom",sideOffset:f=0,align:_="center",alignOffset:x=0,arrowPadding:o=0,avoidCollisions:A=!0,collisionBoundary:I=[],collisionPadding:N=0,sticky:U="partial",hideWhenDetached:$=!1,updatePositionStrategy:V="optimized",onPlaced:Y,...q}=e,Z=g5(mP,i),[Q,H]=F.useState(null),K=bs(t,hn=>H(hn)),[ne,le]=F.useState(null),pe=p5(ne),Ae=(pe==null?void 0:pe.width)??0,Ze=(pe==null?void 0:pe.height)??0,Xe=l+(_!=="center"?"-"+_:""),Je=typeof N=="number"?N:{top:0,right:0,bottom:0,left:0,...N},Te=Array.isArray(I)?I:[I],xe=Te.length>0,Be={padding:Je,boundary:Te.filter(MY),altBoundary:xe},{refs:dt,floatingStyles:qt,placement:Ke,isPositioned:st,middlewareData:Ne}=yY({strategy:"fixed",placement:Xe,whileElementsMounted:(...hn)=>lY(...hn,{animationFrame:V==="always"}),elements:{reference:Z.anchor},middleware:[xY({mainAxis:f+Ze,alignmentAxis:x}),A&&bY({mainAxis:!0,crossAxis:!1,limiter:U==="partial"?wY():void 0,...Be}),A&&SY({...Be}),TY({...Be,apply:({elements:hn,rects:Ji,availableWidth:Ii,availableHeight:Vi})=>{const{width:As,height:bi}=Ji.reference,Is=hn.floating.style;Is.setProperty("--radix-popper-available-width",`${Ii}px`),Is.setProperty("--radix-popper-available-height",`${Vi}px`),Is.setProperty("--radix-popper-anchor-width",`${As}px`),Is.setProperty("--radix-popper-anchor-height",`${bi}px`)}}),ne&&CY({element:ne,padding:o}),NY({arrowWidth:Ae,arrowHeight:Ze}),$&&EY({strategy:"referenceHidden",...Be})]}),[De,Tt]=S5(Ke),Pt=vc(Y);ha(()=>{st&&(Pt==null||Pt())},[st,Pt]);const fe=(Ut=Ne.arrow)==null?void 0:Ut.x,Le=(vr=Ne.arrow)==null?void 0:vr.y,vt=((xr=Ne.arrow)==null?void 0:xr.centerOffset)!==0,[Wt,Ft]=F.useState();return ha(()=>{Q&&Ft(window.getComputedStyle(Q).zIndex)},[Q]),d.jsx("div",{ref:dt.setFloating,"data-radix-popper-content-wrapper":"",style:{...qt,transform:st?qt.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Wt,"--radix-popper-transform-origin":[(zr=Ne.transformOrigin)==null?void 0:zr.x,(Hr=Ne.transformOrigin)==null?void 0:Hr.y].join(" "),...((jn=Ne.hide)==null?void 0:jn.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:d.jsx(kY,{scope:i,placedSide:De,onArrowChange:le,arrowX:fe,arrowY:Le,shouldHideArrow:vt,children:d.jsx(xi.div,{"data-side":De,"data-align":Tt,...q,ref:K,style:{...q.style,animation:st?void 0:"none"}})})})});x5.displayName=mP;var b5="PopperArrow",RY={top:"bottom",right:"left",bottom:"top",left:"right"},w5=F.forwardRef(function(t,i){const{__scopePopper:l,...f}=t,_=PY(b5,l),x=RY[_.placedSide];return d.jsx("span",{ref:_.onArrowChange,style:{position:"absolute",left:_.arrowX,top:_.arrowY,[x]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[_.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[_.placedSide],visibility:_.shouldHideArrow?"hidden":void 0},children:d.jsx(jY,{...f,ref:i,style:{...f.style,display:"block"}})})});w5.displayName=b5;function MY(e){return e!==null}var NY=e=>({name:"transformOrigin",options:e,fn(t){var Z,Q,H;const{placement:i,rects:l,middlewareData:f}=t,x=((Z=f.arrow)==null?void 0:Z.centerOffset)!==0,o=x?0:e.arrowWidth,A=x?0:e.arrowHeight,[I,N]=S5(i),U={start:"0%",center:"50%",end:"100%"}[N],$=(((Q=f.arrow)==null?void 0:Q.x)??0)+o/2,V=(((H=f.arrow)==null?void 0:H.y)??0)+A/2;let Y="",q="";return I==="bottom"?(Y=x?U:`${$}px`,q=`${-A}px`):I==="top"?(Y=x?U:`${$}px`,q=`${l.floating.height+A}px`):I==="right"?(Y=`${-A}px`,q=x?U:`${V}px`):I==="left"&&(Y=`${l.floating.width+A}px`,q=x?U:`${V}px`),{data:{x:Y,y:q}}}});function S5(e){const[t,i="center"]=e.split("-");return[t,i]}var T5=_5,E5=v5,C5=x5,A5=w5,[y2,yde]=rd("Tooltip",[_2]),v2=_2(),j5="TooltipProvider",DY=700,aI="tooltip.open",[OY,gP]=y2(j5),I5=e=>{const{__scopeTooltip:t,delayDuration:i=DY,skipDelayDuration:l=300,disableHoverableContent:f=!1,children:_}=e,x=F.useRef(!0),o=F.useRef(!1),A=F.useRef(0);return F.useEffect(()=>{const I=A.current;return()=>window.clearTimeout(I)},[]),d.jsx(OY,{scope:t,isOpenDelayedRef:x,delayDuration:i,onOpen:F.useCallback(()=>{window.clearTimeout(A.current),x.current=!1},[]),onClose:F.useCallback(()=>{window.clearTimeout(A.current),A.current=window.setTimeout(()=>x.current=!0,l)},[l]),isPointerInTransitRef:o,onPointerInTransitChange:F.useCallback(I=>{o.current=I},[]),disableHoverableContent:f,children:_})};I5.displayName=j5;var lb="Tooltip",[LY,x2]=y2(lb),k5=e=>{const{__scopeTooltip:t,children:i,open:l,defaultOpen:f,onOpenChange:_,disableHoverableContent:x,delayDuration:o}=e,A=gP(lb,e.__scopeTooltip),I=v2(t),[N,U]=F.useState(null),$=Wd(),V=F.useRef(0),Y=x??A.disableHoverableContent,q=o??A.delayDuration,Z=F.useRef(!1),[Q,H]=Of({prop:l,defaultProp:f??!1,onChange:Ae=>{Ae?(A.onOpen(),document.dispatchEvent(new CustomEvent(aI))):A.onClose(),_==null||_(Ae)},caller:lb}),K=F.useMemo(()=>Q?Z.current?"delayed-open":"instant-open":"closed",[Q]),ne=F.useCallback(()=>{window.clearTimeout(V.current),V.current=0,Z.current=!1,H(!0)},[H]),le=F.useCallback(()=>{window.clearTimeout(V.current),V.current=0,H(!1)},[H]),pe=F.useCallback(()=>{window.clearTimeout(V.current),V.current=window.setTimeout(()=>{Z.current=!0,H(!0),V.current=0},q)},[q,H]);return F.useEffect(()=>()=>{V.current&&(window.clearTimeout(V.current),V.current=0)},[]),d.jsx(T5,{...I,children:d.jsx(LY,{scope:t,contentId:$,open:Q,stateAttribute:K,trigger:N,onTriggerChange:U,onTriggerEnter:F.useCallback(()=>{A.isOpenDelayedRef.current?pe():ne()},[A.isOpenDelayedRef,pe,ne]),onTriggerLeave:F.useCallback(()=>{Y?le():(window.clearTimeout(V.current),V.current=0)},[le,Y]),onOpen:ne,onClose:le,disableHoverableContent:Y,children:i})})};k5.displayName=lb;var lI="TooltipTrigger",P5=F.forwardRef((e,t)=>{const{__scopeTooltip:i,...l}=e,f=x2(lI,i),_=gP(lI,i),x=v2(i),o=F.useRef(null),A=bs(t,o,f.onTriggerChange),I=F.useRef(!1),N=F.useRef(!1),U=F.useCallback(()=>I.current=!1,[]);return F.useEffect(()=>()=>document.removeEventListener("pointerup",U),[U]),d.jsx(E5,{asChild:!0,...x,children:d.jsx(xi.button,{"aria-describedby":f.open?f.contentId:void 0,"data-state":f.stateAttribute,...l,ref:A,onPointerMove:Vn(e.onPointerMove,$=>{$.pointerType!=="touch"&&!N.current&&!_.isPointerInTransitRef.current&&(f.onTriggerEnter(),N.current=!0)}),onPointerLeave:Vn(e.onPointerLeave,()=>{f.onTriggerLeave(),N.current=!1}),onPointerDown:Vn(e.onPointerDown,()=>{f.open&&f.onClose(),I.current=!0,document.addEventListener("pointerup",U,{once:!0})}),onFocus:Vn(e.onFocus,()=>{I.current||f.onOpen()}),onBlur:Vn(e.onBlur,f.onClose),onClick:Vn(e.onClick,f.onClose)})})});P5.displayName=lI;var zY="TooltipPortal",[vde,FY]=y2(zY,{forceMount:void 0}),Ay="TooltipContent",R5=F.forwardRef((e,t)=>{const i=FY(Ay,e.__scopeTooltip),{forceMount:l=i.forceMount,side:f="top",..._}=e,x=x2(Ay,e.__scopeTooltip);return d.jsx(Wf,{present:l||x.open,children:x.disableHoverableContent?d.jsx(M5,{side:f,..._,ref:t}):d.jsx(BY,{side:f,..._,ref:t})})}),BY=F.forwardRef((e,t)=>{const i=x2(Ay,e.__scopeTooltip),l=gP(Ay,e.__scopeTooltip),f=F.useRef(null),_=bs(t,f),[x,o]=F.useState(null),{trigger:A,onClose:I}=i,N=f.current,{onPointerInTransitChange:U}=l,$=F.useCallback(()=>{o(null),U(!1)},[U]),V=F.useCallback((Y,q)=>{const Z=Y.currentTarget,Q={x:Y.clientX,y:Y.clientY},H=GY(Q,Z.getBoundingClientRect()),K=HY(Q,H),ne=WY(q.getBoundingClientRect()),le=XY([...K,...ne]);o(le),U(!0)},[U]);return F.useEffect(()=>()=>$(),[$]),F.useEffect(()=>{if(A&&N){const Y=Z=>V(Z,N),q=Z=>V(Z,A);return A.addEventListener("pointerleave",Y),N.addEventListener("pointerleave",q),()=>{A.removeEventListener("pointerleave",Y),N.removeEventListener("pointerleave",q)}}},[A,N,V,$]),F.useEffect(()=>{if(x){const Y=q=>{const Z=q.target,Q={x:q.clientX,y:q.clientY},H=(A==null?void 0:A.contains(Z))||(N==null?void 0:N.contains(Z)),K=!ZY(Q,x);H?$():K&&($(),I())};return document.addEventListener("pointermove",Y),()=>document.removeEventListener("pointermove",Y)}},[A,N,x,I,$]),d.jsx(M5,{...e,ref:_})}),[VY,UY]=y2(lb,{isInside:!1}),$Y=u4("TooltipContent"),M5=F.forwardRef((e,t)=>{const{__scopeTooltip:i,children:l,"aria-label":f,onEscapeKeyDown:_,onPointerDownOutside:x,...o}=e,A=x2(Ay,i),I=v2(i),{onClose:N}=A;return F.useEffect(()=>(document.addEventListener(aI,N),()=>document.removeEventListener(aI,N)),[N]),F.useEffect(()=>{if(A.trigger){const U=$=>{const V=$.target;V!=null&&V.contains(A.trigger)&&N()};return window.addEventListener("scroll",U,{capture:!0}),()=>window.removeEventListener("scroll",U,{capture:!0})}},[A.trigger,N]),d.jsx(Ab,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:_,onPointerDownOutside:x,onFocusOutside:U=>U.preventDefault(),onDismiss:N,children:d.jsxs(C5,{"data-state":A.stateAttribute,...I,...o,ref:t,style:{...o.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[d.jsx($Y,{children:l}),d.jsx(VY,{scope:i,isInside:!0,children:d.jsx(cZ,{id:A.contentId,role:"tooltip",children:f||l})})]})})});R5.displayName=Ay;var N5="TooltipArrow",qY=F.forwardRef((e,t)=>{const{__scopeTooltip:i,...l}=e,f=v2(i);return UY(N5,i).isInside?null:d.jsx(A5,{...f,...l,ref:t})});qY.displayName=N5;function GY(e,t){const i=Math.abs(t.top-e.y),l=Math.abs(t.bottom-e.y),f=Math.abs(t.right-e.x),_=Math.abs(t.left-e.x);switch(Math.min(i,l,f,_)){case _:return"left";case f:return"right";case i:return"top";case l:return"bottom";default:throw new Error("unreachable")}}function HY(e,t,i=5){const l=[];switch(t){case"top":l.push({x:e.x-i,y:e.y+i},{x:e.x+i,y:e.y+i});break;case"bottom":l.push({x:e.x-i,y:e.y-i},{x:e.x+i,y:e.y-i});break;case"left":l.push({x:e.x+i,y:e.y-i},{x:e.x+i,y:e.y+i});break;case"right":l.push({x:e.x-i,y:e.y-i},{x:e.x-i,y:e.y+i});break}return l}function WY(e){const{top:t,right:i,bottom:l,left:f}=e;return[{x:f,y:t},{x:i,y:t},{x:i,y:l},{x:f,y:l}]}function ZY(e,t){const{x:i,y:l}=e;let f=!1;for(let _=0,x=t.length-1;_<t.length;x=_++){const o=t[_],A=t[x],I=o.x,N=o.y,U=A.x,$=A.y;N>l!=$>l&&i<(U-I)*(l-N)/($-N)+I&&(f=!f)}return f}function XY(e){const t=e.slice();return t.sort((i,l)=>i.x<l.x?-1:i.x>l.x?1:i.y<l.y?-1:i.y>l.y?1:0),KY(t)}function KY(e){if(e.length<=1)return e.slice();const t=[];for(let l=0;l<e.length;l++){const f=e[l];for(;t.length>=2;){const _=t[t.length-1],x=t[t.length-2];if((_.x-x.x)*(f.y-x.y)>=(_.y-x.y)*(f.x-x.x))t.pop();else break}t.push(f)}t.pop();const i=[];for(let l=e.length-1;l>=0;l--){const f=e[l];for(;i.length>=2;){const _=i[i.length-1],x=i[i.length-2];if((_.x-x.x)*(f.y-x.y)>=(_.y-x.y)*(f.x-x.x))i.pop();else break}i.push(f)}return i.pop(),t.length===1&&i.length===1&&t[0].x===i[0].x&&t[0].y===i[0].y?t:t.concat(i)}var YY=I5,JY=k5,QY=P5,D5=R5;const O5=YY,eJ=JY,tJ=QY,L5=F.forwardRef(({className:e,sideOffset:t=4,...i},l)=>d.jsx(D5,{ref:l,sideOffset:t,className:wr("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...i}));L5.displayName=D5.displayName;var Hy=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Nm=typeof window>"u"||"Deno"in globalThis;function Za(){}function rJ(e,t){return typeof e=="function"?e(t):e}function cI(e){return typeof e=="number"&&e>=0&&e!==1/0}function z5(e,t){return Math.max(e+(t||0)-Date.now(),0)}function kf(e,t){return typeof e=="function"?e(t):e}function dc(e,t){return typeof e=="function"?e(t):e}function qL(e,t){const{type:i="all",exact:l,fetchStatus:f,predicate:_,queryKey:x,stale:o}=e;if(x){if(l){if(t.queryHash!==_P(x,t.options))return!1}else if(!cb(t.queryKey,x))return!1}if(i!=="all"){const A=t.isActive();if(i==="active"&&!A||i==="inactive"&&A)return!1}return!(typeof o=="boolean"&&t.isStale()!==o||f&&f!==t.state.fetchStatus||_&&!_(t))}function GL(e,t){const{exact:i,status:l,predicate:f,mutationKey:_}=e;if(_){if(!t.options.mutationKey)return!1;if(i){if(Dm(t.options.mutationKey)!==Dm(_))return!1}else if(!cb(t.options.mutationKey,_))return!1}return!(l&&t.state.status!==l||f&&!f(t))}function _P(e,t){return((t==null?void 0:t.queryKeyHashFn)||Dm)(e)}function Dm(e){return JSON.stringify(e,(t,i)=>uI(i)?Object.keys(i).sort().reduce((l,f)=>(l[f]=i[f],l),{}):i)}function cb(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(i=>cb(e[i],t[i])):!1}function F5(e,t){if(e===t)return e;const i=HL(e)&&HL(t);if(i||uI(e)&&uI(t)){const l=i?e:Object.keys(e),f=l.length,_=i?t:Object.keys(t),x=_.length,o=i?[]:{},A=new Set(l);let I=0;for(let N=0;N<x;N++){const U=i?N:_[N];(!i&&A.has(U)||i)&&e[U]===void 0&&t[U]===void 0?(o[U]=void 0,I++):(o[U]=F5(e[U],t[U]),o[U]===e[U]&&e[U]!==void 0&&I++)}return f===x&&I===f?e:o}return t}function bT(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const i in e)if(e[i]!==t[i])return!1;return!0}function HL(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function uI(e){if(!WL(e))return!1;const t=e.constructor;if(t===void 0)return!0;const i=t.prototype;return!(!WL(i)||!i.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function WL(e){return Object.prototype.toString.call(e)==="[object Object]"}function nJ(e){return new Promise(t=>{setTimeout(t,e)})}function dI(e,t,i){return typeof i.structuralSharing=="function"?i.structuralSharing(e,t):i.structuralSharing!==!1?F5(e,t):t}function iJ(e,t,i=0){const l=[...e,t];return i&&l.length>i?l.slice(1):l}function sJ(e,t,i=0){const l=[t,...e];return i&&l.length>i?l.slice(0,-1):l}var yP=Symbol();function B5(e,t){return!e.queryFn&&(t!=null&&t.initialPromise)?()=>t.initialPromise:!e.queryFn||e.queryFn===yP?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}function V5(e,t){return typeof e=="function"?e(...t):!!e}var mm,cf,oy,LF,oJ=(LF=class extends Hy{constructor(){super();Bn(this,mm);Bn(this,cf);Bn(this,oy);ln(this,oy,t=>{if(!Nm&&window.addEventListener){const i=()=>t();return window.addEventListener("visibilitychange",i,!1),()=>{window.removeEventListener("visibilitychange",i)}}})}onSubscribe(){lt(this,cf)||this.setEventListener(lt(this,oy))}onUnsubscribe(){var t;this.hasListeners()||((t=lt(this,cf))==null||t.call(this),ln(this,cf,void 0))}setEventListener(t){var i;ln(this,oy,t),(i=lt(this,cf))==null||i.call(this),ln(this,cf,t(l=>{typeof l=="boolean"?this.setFocused(l):this.onFocus()}))}setFocused(t){lt(this,mm)!==t&&(ln(this,mm,t),this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(i=>{i(t)})}isFocused(){var t;return typeof lt(this,mm)=="boolean"?lt(this,mm):((t=globalThis.document)==null?void 0:t.visibilityState)!=="hidden"}},mm=new WeakMap,cf=new WeakMap,oy=new WeakMap,LF),vP=new oJ,ay,uf,ly,zF,aJ=(zF=class extends Hy{constructor(){super();Bn(this,ay,!0);Bn(this,uf);Bn(this,ly);ln(this,ly,t=>{if(!Nm&&window.addEventListener){const i=()=>t(!0),l=()=>t(!1);return window.addEventListener("online",i,!1),window.addEventListener("offline",l,!1),()=>{window.removeEventListener("online",i),window.removeEventListener("offline",l)}}})}onSubscribe(){lt(this,uf)||this.setEventListener(lt(this,ly))}onUnsubscribe(){var t;this.hasListeners()||((t=lt(this,uf))==null||t.call(this),ln(this,uf,void 0))}setEventListener(t){var i;ln(this,ly,t),(i=lt(this,uf))==null||i.call(this),ln(this,uf,t(this.setOnline.bind(this)))}setOnline(t){lt(this,ay)!==t&&(ln(this,ay,t),this.listeners.forEach(l=>{l(t)}))}isOnline(){return lt(this,ay)}},ay=new WeakMap,uf=new WeakMap,ly=new WeakMap,zF),wT=new aJ;function hI(){let e,t;const i=new Promise((f,_)=>{e=f,t=_});i.status="pending",i.catch(()=>{});function l(f){Object.assign(i,f),delete i.resolve,delete i.reject}return i.resolve=f=>{l({status:"fulfilled",value:f}),e(f)},i.reject=f=>{l({status:"rejected",reason:f}),t(f)},i}function lJ(e){return Math.min(1e3*2**e,3e4)}function U5(e){return(e??"online")==="online"?wT.isOnline():!0}var $5=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function SA(e){return e instanceof $5}function q5(e){let t=!1,i=0,l=!1,f;const _=hI(),x=q=>{var Z;l||($(new $5(q)),(Z=e.abort)==null||Z.call(e))},o=()=>{t=!0},A=()=>{t=!1},I=()=>vP.isFocused()&&(e.networkMode==="always"||wT.isOnline())&&e.canRun(),N=()=>U5(e.networkMode)&&e.canRun(),U=q=>{var Z;l||(l=!0,(Z=e.onSuccess)==null||Z.call(e,q),f==null||f(),_.resolve(q))},$=q=>{var Z;l||(l=!0,(Z=e.onError)==null||Z.call(e,q),f==null||f(),_.reject(q))},V=()=>new Promise(q=>{var Z;f=Q=>{(l||I())&&q(Q)},(Z=e.onPause)==null||Z.call(e)}).then(()=>{var q;f=void 0,l||(q=e.onContinue)==null||q.call(e)}),Y=()=>{if(l)return;let q;const Z=i===0?e.initialPromise:void 0;try{q=Z??e.fn()}catch(Q){q=Promise.reject(Q)}Promise.resolve(q).then(U).catch(Q=>{var pe;if(l)return;const H=e.retry??(Nm?0:3),K=e.retryDelay??lJ,ne=typeof K=="function"?K(i,Q):K,le=H===!0||typeof H=="number"&&i<H||typeof H=="function"&&H(i,Q);if(t||!le){$(Q);return}i++,(pe=e.onFail)==null||pe.call(e,i,Q),nJ(ne).then(()=>I()?void 0:V()).then(()=>{t?$(Q):Y()})})};return{promise:_,cancel:x,continue:()=>(f==null||f(),_),cancelRetry:o,continueRetry:A,canStart:N,start:()=>(N()?Y():V().then(Y),_)}}var cJ=e=>setTimeout(e,0);function uJ(){let e=[],t=0,i=o=>{o()},l=o=>{o()},f=cJ;const _=o=>{t?e.push(o):f(()=>{i(o)})},x=()=>{const o=e;e=[],o.length&&f(()=>{l(()=>{o.forEach(A=>{i(A)})})})};return{batch:o=>{let A;t++;try{A=o()}finally{t--,t||x()}return A},batchCalls:o=>(...A)=>{_(()=>{o(...A)})},schedule:_,setNotifyFunction:o=>{i=o},setBatchNotifyFunction:o=>{l=o},setScheduler:o=>{f=o}}}var Wo=uJ(),gm,FF,G5=(FF=class{constructor(){Bn(this,gm)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),cI(this.gcTime)&&ln(this,gm,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(Nm?1/0:5*60*1e3))}clearGcTimeout(){lt(this,gm)&&(clearTimeout(lt(this,gm)),ln(this,gm,void 0))}},gm=new WeakMap,FF),cy,_m,uc,ym,Sa,yb,vm,Qc,Rd,BF,dJ=(BF=class extends G5{constructor(t){super();Bn(this,Qc);Bn(this,cy);Bn(this,_m);Bn(this,uc);Bn(this,ym);Bn(this,Sa);Bn(this,yb);Bn(this,vm);ln(this,vm,!1),ln(this,yb,t.defaultOptions),this.setOptions(t.options),this.observers=[],ln(this,ym,t.client),ln(this,uc,lt(this,ym).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,ln(this,cy,hJ(this.options)),this.state=t.state??lt(this,cy),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=lt(this,Sa))==null?void 0:t.promise}setOptions(t){this.options={...lt(this,yb),...t},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&lt(this,uc).remove(this)}setData(t,i){const l=dI(this.state.data,t,this.options);return ji(this,Qc,Rd).call(this,{data:l,type:"success",dataUpdatedAt:i==null?void 0:i.updatedAt,manual:i==null?void 0:i.manual}),l}setState(t,i){ji(this,Qc,Rd).call(this,{type:"setState",state:t,setStateOptions:i})}cancel(t){var l,f;const i=(l=lt(this,Sa))==null?void 0:l.promise;return(f=lt(this,Sa))==null||f.cancel(t),i?i.then(Za).catch(Za):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(lt(this,cy))}isActive(){return this.observers.some(t=>dc(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===yP||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>kf(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!z5(this.state.dataUpdatedAt,t)}onFocus(){var i;const t=this.observers.find(l=>l.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(i=lt(this,Sa))==null||i.continue()}onOnline(){var i;const t=this.observers.find(l=>l.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(i=lt(this,Sa))==null||i.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),lt(this,uc).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(i=>i!==t),this.observers.length||(lt(this,Sa)&&(lt(this,vm)?lt(this,Sa).cancel({revert:!0}):lt(this,Sa).cancelRetry()),this.scheduleGc()),lt(this,uc).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||ji(this,Qc,Rd).call(this,{type:"invalidate"})}fetch(t,i){var I,N,U;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(i!=null&&i.cancelRefetch))this.cancel({silent:!0});else if(lt(this,Sa))return lt(this,Sa).continueRetry(),lt(this,Sa).promise}if(t&&this.setOptions(t),!this.options.queryFn){const $=this.observers.find(V=>V.options.queryFn);$&&this.setOptions($.options)}const l=new AbortController,f=$=>{Object.defineProperty($,"signal",{enumerable:!0,get:()=>(ln(this,vm,!0),l.signal)})},_=()=>{const $=B5(this.options,i),Y=(()=>{const q={client:lt(this,ym),queryKey:this.queryKey,meta:this.meta};return f(q),q})();return ln(this,vm,!1),this.options.persister?this.options.persister($,Y,this):$(Y)},o=(()=>{const $={fetchOptions:i,options:this.options,queryKey:this.queryKey,client:lt(this,ym),state:this.state,fetchFn:_};return f($),$})();(I=this.options.behavior)==null||I.onFetch(o,this),ln(this,_m,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((N=o.fetchOptions)==null?void 0:N.meta))&&ji(this,Qc,Rd).call(this,{type:"fetch",meta:(U=o.fetchOptions)==null?void 0:U.meta});const A=$=>{var V,Y,q,Z;SA($)&&$.silent||ji(this,Qc,Rd).call(this,{type:"error",error:$}),SA($)||((Y=(V=lt(this,uc).config).onError)==null||Y.call(V,$,this),(Z=(q=lt(this,uc).config).onSettled)==null||Z.call(q,this.state.data,$,this)),this.scheduleGc()};return ln(this,Sa,q5({initialPromise:i==null?void 0:i.initialPromise,fn:o.fetchFn,abort:l.abort.bind(l),onSuccess:$=>{var V,Y,q,Z;if($===void 0){A(new Error(`${this.queryHash} data is undefined`));return}try{this.setData($)}catch(Q){A(Q);return}(Y=(V=lt(this,uc).config).onSuccess)==null||Y.call(V,$,this),(Z=(q=lt(this,uc).config).onSettled)==null||Z.call(q,$,this.state.error,this),this.scheduleGc()},onError:A,onFail:($,V)=>{ji(this,Qc,Rd).call(this,{type:"failed",failureCount:$,error:V})},onPause:()=>{ji(this,Qc,Rd).call(this,{type:"pause"})},onContinue:()=>{ji(this,Qc,Rd).call(this,{type:"continue"})},retry:o.options.retry,retryDelay:o.options.retryDelay,networkMode:o.options.networkMode,canRun:()=>!0})),lt(this,Sa).start()}},cy=new WeakMap,_m=new WeakMap,uc=new WeakMap,ym=new WeakMap,Sa=new WeakMap,yb=new WeakMap,vm=new WeakMap,Qc=new WeakSet,Rd=function(t){const i=l=>{switch(t.type){case"failed":return{...l,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...l,fetchStatus:"paused"};case"continue":return{...l,fetchStatus:"fetching"};case"fetch":return{...l,...H5(l.data,this.options),fetchMeta:t.meta??null};case"success":return ln(this,_m,void 0),{...l,data:t.data,dataUpdateCount:l.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const f=t.error;return SA(f)&&f.revert&&lt(this,_m)?{...lt(this,_m),fetchStatus:"idle"}:{...l,error:f,errorUpdateCount:l.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:l.fetchFailureCount+1,fetchFailureReason:f,fetchStatus:"idle",status:"error"};case"invalidate":return{...l,isInvalidated:!0};case"setState":return{...l,...t.state}}};this.state=i(this.state),Wo.batch(()=>{this.observers.forEach(l=>{l.onQueryUpdate()}),lt(this,uc).notify({query:this,type:"updated",action:t})})},BF);function H5(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:U5(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function hJ(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,i=t!==void 0,l=i?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:i?l??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:i?"success":"pending",fetchStatus:"idle"}}var Fu,VF,fJ=(VF=class extends Hy{constructor(t={}){super();Bn(this,Fu);this.config=t,ln(this,Fu,new Map)}build(t,i,l){const f=i.queryKey,_=i.queryHash??_P(f,i);let x=this.get(_);return x||(x=new dJ({client:t,queryKey:f,queryHash:_,options:t.defaultQueryOptions(i),state:l,defaultOptions:t.getQueryDefaults(f)}),this.add(x)),x}add(t){lt(this,Fu).has(t.queryHash)||(lt(this,Fu).set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const i=lt(this,Fu).get(t.queryHash);i&&(t.destroy(),i===t&&lt(this,Fu).delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){Wo.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return lt(this,Fu).get(t)}getAll(){return[...lt(this,Fu).values()]}find(t){const i={exact:!0,...t};return this.getAll().find(l=>qL(i,l))}findAll(t={}){const i=this.getAll();return Object.keys(t).length>0?i.filter(l=>qL(t,l)):i}notify(t){Wo.batch(()=>{this.listeners.forEach(i=>{i(t)})})}onFocus(){Wo.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){Wo.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},Fu=new WeakMap,VF),Bu,Ga,xm,Vu,ef,UF,pJ=(UF=class extends G5{constructor(t){super();Bn(this,Vu);Bn(this,Bu);Bn(this,Ga);Bn(this,xm);this.mutationId=t.mutationId,ln(this,Ga,t.mutationCache),ln(this,Bu,[]),this.state=t.state||W5(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){lt(this,Bu).includes(t)||(lt(this,Bu).push(t),this.clearGcTimeout(),lt(this,Ga).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){ln(this,Bu,lt(this,Bu).filter(i=>i!==t)),this.scheduleGc(),lt(this,Ga).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){lt(this,Bu).length||(this.state.status==="pending"?this.scheduleGc():lt(this,Ga).remove(this))}continue(){var t;return((t=lt(this,xm))==null?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var _,x,o,A,I,N,U,$,V,Y,q,Z,Q,H,K,ne,le,pe,Ae,Ze;const i=()=>{ji(this,Vu,ef).call(this,{type:"continue"})};ln(this,xm,q5({fn:()=>this.options.mutationFn?this.options.mutationFn(t):Promise.reject(new Error("No mutationFn found")),onFail:(Xe,Je)=>{ji(this,Vu,ef).call(this,{type:"failed",failureCount:Xe,error:Je})},onPause:()=>{ji(this,Vu,ef).call(this,{type:"pause"})},onContinue:i,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>lt(this,Ga).canRun(this)}));const l=this.state.status==="pending",f=!lt(this,xm).canStart();try{if(l)i();else{ji(this,Vu,ef).call(this,{type:"pending",variables:t,isPaused:f}),await((x=(_=lt(this,Ga).config).onMutate)==null?void 0:x.call(_,t,this));const Je=await((A=(o=this.options).onMutate)==null?void 0:A.call(o,t));Je!==this.state.context&&ji(this,Vu,ef).call(this,{type:"pending",context:Je,variables:t,isPaused:f})}const Xe=await lt(this,xm).start();return await((N=(I=lt(this,Ga).config).onSuccess)==null?void 0:N.call(I,Xe,t,this.state.context,this)),await(($=(U=this.options).onSuccess)==null?void 0:$.call(U,Xe,t,this.state.context)),await((Y=(V=lt(this,Ga).config).onSettled)==null?void 0:Y.call(V,Xe,null,this.state.variables,this.state.context,this)),await((Z=(q=this.options).onSettled)==null?void 0:Z.call(q,Xe,null,t,this.state.context)),ji(this,Vu,ef).call(this,{type:"success",data:Xe}),Xe}catch(Xe){try{throw await((H=(Q=lt(this,Ga).config).onError)==null?void 0:H.call(Q,Xe,t,this.state.context,this)),await((ne=(K=this.options).onError)==null?void 0:ne.call(K,Xe,t,this.state.context)),await((pe=(le=lt(this,Ga).config).onSettled)==null?void 0:pe.call(le,void 0,Xe,this.state.variables,this.state.context,this)),await((Ze=(Ae=this.options).onSettled)==null?void 0:Ze.call(Ae,void 0,Xe,t,this.state.context)),Xe}finally{ji(this,Vu,ef).call(this,{type:"error",error:Xe})}}finally{lt(this,Ga).runNext(this)}}},Bu=new WeakMap,Ga=new WeakMap,xm=new WeakMap,Vu=new WeakSet,ef=function(t){const i=l=>{switch(t.type){case"failed":return{...l,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...l,isPaused:!0};case"continue":return{...l,isPaused:!1};case"pending":return{...l,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...l,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...l,data:void 0,error:t.error,failureCount:l.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=i(this.state),Wo.batch(()=>{lt(this,Bu).forEach(l=>{l.onMutationUpdate(t)}),lt(this,Ga).notify({mutation:this,type:"updated",action:t})})},UF);function W5(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Od,eu,vb,$F,mJ=($F=class extends Hy{constructor(t={}){super();Bn(this,Od);Bn(this,eu);Bn(this,vb);this.config=t,ln(this,Od,new Set),ln(this,eu,new Map),ln(this,vb,0)}build(t,i,l){const f=new pJ({mutationCache:this,mutationId:++O1(this,vb)._,options:t.defaultMutationOptions(i),state:l});return this.add(f),f}add(t){lt(this,Od).add(t);const i=iS(t);if(typeof i=="string"){const l=lt(this,eu).get(i);l?l.push(t):lt(this,eu).set(i,[t])}this.notify({type:"added",mutation:t})}remove(t){if(lt(this,Od).delete(t)){const i=iS(t);if(typeof i=="string"){const l=lt(this,eu).get(i);if(l)if(l.length>1){const f=l.indexOf(t);f!==-1&&l.splice(f,1)}else l[0]===t&&lt(this,eu).delete(i)}}this.notify({type:"removed",mutation:t})}canRun(t){const i=iS(t);if(typeof i=="string"){const l=lt(this,eu).get(i),f=l==null?void 0:l.find(_=>_.state.status==="pending");return!f||f===t}else return!0}runNext(t){var l;const i=iS(t);if(typeof i=="string"){const f=(l=lt(this,eu).get(i))==null?void 0:l.find(_=>_!==t&&_.state.isPaused);return(f==null?void 0:f.continue())??Promise.resolve()}else return Promise.resolve()}clear(){Wo.batch(()=>{lt(this,Od).forEach(t=>{this.notify({type:"removed",mutation:t})}),lt(this,Od).clear(),lt(this,eu).clear()})}getAll(){return Array.from(lt(this,Od))}find(t){const i={exact:!0,...t};return this.getAll().find(l=>GL(i,l))}findAll(t={}){return this.getAll().filter(i=>GL(t,i))}notify(t){Wo.batch(()=>{this.listeners.forEach(i=>{i(t)})})}resumePausedMutations(){const t=this.getAll().filter(i=>i.state.isPaused);return Wo.batch(()=>Promise.all(t.map(i=>i.continue().catch(Za))))}},Od=new WeakMap,eu=new WeakMap,vb=new WeakMap,$F);function iS(e){var t;return(t=e.options.scope)==null?void 0:t.id}function ZL(e){return{onFetch:(t,i)=>{var N,U,$,V,Y;const l=t.options,f=($=(U=(N=t.fetchOptions)==null?void 0:N.meta)==null?void 0:U.fetchMore)==null?void 0:$.direction,_=((V=t.state.data)==null?void 0:V.pages)||[],x=((Y=t.state.data)==null?void 0:Y.pageParams)||[];let o={pages:[],pageParams:[]},A=0;const I=async()=>{let q=!1;const Z=K=>{Object.defineProperty(K,"signal",{enumerable:!0,get:()=>(t.signal.aborted?q=!0:t.signal.addEventListener("abort",()=>{q=!0}),t.signal)})},Q=B5(t.options,t.fetchOptions),H=async(K,ne,le)=>{if(q)return Promise.reject();if(ne==null&&K.pages.length)return Promise.resolve(K);const Ae=(()=>{const Te={client:t.client,queryKey:t.queryKey,pageParam:ne,direction:le?"backward":"forward",meta:t.options.meta};return Z(Te),Te})(),Ze=await Q(Ae),{maxPages:Xe}=t.options,Je=le?sJ:iJ;return{pages:Je(K.pages,Ze,Xe),pageParams:Je(K.pageParams,ne,Xe)}};if(f&&_.length){const K=f==="backward",ne=K?gJ:XL,le={pages:_,pageParams:x},pe=ne(l,le);o=await H(le,pe,K)}else{const K=e??_.length;do{const ne=A===0?x[0]??l.initialPageParam:XL(l,o);if(A>0&&ne==null)break;o=await H(o,ne),A++}while(A<K)}return o};t.options.persister?t.fetchFn=()=>{var q,Z;return(Z=(q=t.options).persister)==null?void 0:Z.call(q,I,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},i)}:t.fetchFn=I}}}function XL(e,{pages:t,pageParams:i}){const l=t.length-1;return t.length>0?e.getNextPageParam(t[l],t,i[l],i):void 0}function gJ(e,{pages:t,pageParams:i}){var l;return t.length>0?(l=e.getPreviousPageParam)==null?void 0:l.call(e,t[0],t,i[0],i):void 0}var yo,df,hf,uy,dy,ff,hy,fy,qF,_J=(qF=class{constructor(e={}){Bn(this,yo);Bn(this,df);Bn(this,hf);Bn(this,uy);Bn(this,dy);Bn(this,ff);Bn(this,hy);Bn(this,fy);ln(this,yo,e.queryCache||new fJ),ln(this,df,e.mutationCache||new mJ),ln(this,hf,e.defaultOptions||{}),ln(this,uy,new Map),ln(this,dy,new Map),ln(this,ff,0)}mount(){O1(this,ff)._++,lt(this,ff)===1&&(ln(this,hy,vP.subscribe(async e=>{e&&(await this.resumePausedMutations(),lt(this,yo).onFocus())})),ln(this,fy,wT.subscribe(async e=>{e&&(await this.resumePausedMutations(),lt(this,yo).onOnline())})))}unmount(){var e,t;O1(this,ff)._--,lt(this,ff)===0&&((e=lt(this,hy))==null||e.call(this),ln(this,hy,void 0),(t=lt(this,fy))==null||t.call(this),ln(this,fy,void 0))}isFetching(e){return lt(this,yo).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return lt(this,df).findAll({...e,status:"pending"}).length}getQueryData(e){var i;const t=this.defaultQueryOptions({queryKey:e});return(i=lt(this,yo).get(t.queryHash))==null?void 0:i.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),i=lt(this,yo).build(this,t),l=i.state.data;return l===void 0?this.fetchQuery(e):(e.revalidateIfStale&&i.isStaleByTime(kf(t.staleTime,i))&&this.prefetchQuery(t),Promise.resolve(l))}getQueriesData(e){return lt(this,yo).findAll(e).map(({queryKey:t,state:i})=>{const l=i.data;return[t,l]})}setQueryData(e,t,i){const l=this.defaultQueryOptions({queryKey:e}),f=lt(this,yo).get(l.queryHash),_=f==null?void 0:f.state.data,x=rJ(t,_);if(x!==void 0)return lt(this,yo).build(this,l).setData(x,{...i,manual:!0})}setQueriesData(e,t,i){return Wo.batch(()=>lt(this,yo).findAll(e).map(({queryKey:l})=>[l,this.setQueryData(l,t,i)]))}getQueryState(e){var i;const t=this.defaultQueryOptions({queryKey:e});return(i=lt(this,yo).get(t.queryHash))==null?void 0:i.state}removeQueries(e){const t=lt(this,yo);Wo.batch(()=>{t.findAll(e).forEach(i=>{t.remove(i)})})}resetQueries(e,t){const i=lt(this,yo);return Wo.batch(()=>(i.findAll(e).forEach(l=>{l.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const i={revert:!0,...t},l=Wo.batch(()=>lt(this,yo).findAll(e).map(f=>f.cancel(i)));return Promise.all(l).then(Za).catch(Za)}invalidateQueries(e,t={}){return Wo.batch(()=>(lt(this,yo).findAll(e).forEach(i=>{i.invalidate()}),(e==null?void 0:e.refetchType)==="none"?Promise.resolve():this.refetchQueries({...e,type:(e==null?void 0:e.refetchType)??(e==null?void 0:e.type)??"active"},t)))}refetchQueries(e,t={}){const i={...t,cancelRefetch:t.cancelRefetch??!0},l=Wo.batch(()=>lt(this,yo).findAll(e).filter(f=>!f.isDisabled()&&!f.isStatic()).map(f=>{let _=f.fetch(void 0,i);return i.throwOnError||(_=_.catch(Za)),f.state.fetchStatus==="paused"?Promise.resolve():_}));return Promise.all(l).then(Za)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const i=lt(this,yo).build(this,t);return i.isStaleByTime(kf(t.staleTime,i))?i.fetch(t):Promise.resolve(i.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(Za).catch(Za)}fetchInfiniteQuery(e){return e.behavior=ZL(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(Za).catch(Za)}ensureInfiniteQueryData(e){return e.behavior=ZL(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return wT.isOnline()?lt(this,df).resumePausedMutations():Promise.resolve()}getQueryCache(){return lt(this,yo)}getMutationCache(){return lt(this,df)}getDefaultOptions(){return lt(this,hf)}setDefaultOptions(e){ln(this,hf,e)}setQueryDefaults(e,t){lt(this,uy).set(Dm(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...lt(this,uy).values()],i={};return t.forEach(l=>{cb(e,l.queryKey)&&Object.assign(i,l.defaultOptions)}),i}setMutationDefaults(e,t){lt(this,dy).set(Dm(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...lt(this,dy).values()],i={};return t.forEach(l=>{cb(e,l.mutationKey)&&Object.assign(i,l.defaultOptions)}),i}defaultQueryOptions(e){if(e._defaulted)return e;const t={...lt(this,hf).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=_P(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===yP&&(t.enabled=!1),t}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...lt(this,hf).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){lt(this,yo).clear(),lt(this,df).clear()}},yo=new WeakMap,df=new WeakMap,hf=new WeakMap,uy=new WeakMap,dy=new WeakMap,ff=new WeakMap,hy=new WeakMap,fy=new WeakMap,qF),_l,Ki,xb,Ha,bm,py,pf,mf,bb,my,gy,wm,Sm,gf,_y,xs,x0,fI,pI,mI,gI,_I,yI,vI,Z5,GF,yJ=(GF=class extends Hy{constructor(t,i){super();Bn(this,xs);Bn(this,_l);Bn(this,Ki);Bn(this,xb);Bn(this,Ha);Bn(this,bm);Bn(this,py);Bn(this,pf);Bn(this,mf);Bn(this,bb);Bn(this,my);Bn(this,gy);Bn(this,wm);Bn(this,Sm);Bn(this,gf);Bn(this,_y,new Set);this.options=i,ln(this,_l,t),ln(this,mf,null),ln(this,pf,hI()),this.options.experimental_prefetchInRender||lt(this,pf).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(i)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(lt(this,Ki).addObserver(this),KL(lt(this,Ki),this.options)?ji(this,xs,x0).call(this):this.updateResult(),ji(this,xs,gI).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return xI(lt(this,Ki),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return xI(lt(this,Ki),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,ji(this,xs,_I).call(this),ji(this,xs,yI).call(this),lt(this,Ki).removeObserver(this)}setOptions(t){const i=this.options,l=lt(this,Ki);if(this.options=lt(this,_l).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof dc(this.options.enabled,lt(this,Ki))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");ji(this,xs,vI).call(this),lt(this,Ki).setOptions(this.options),i._defaulted&&!bT(this.options,i)&&lt(this,_l).getQueryCache().notify({type:"observerOptionsUpdated",query:lt(this,Ki),observer:this});const f=this.hasListeners();f&&YL(lt(this,Ki),l,this.options,i)&&ji(this,xs,x0).call(this),this.updateResult(),f&&(lt(this,Ki)!==l||dc(this.options.enabled,lt(this,Ki))!==dc(i.enabled,lt(this,Ki))||kf(this.options.staleTime,lt(this,Ki))!==kf(i.staleTime,lt(this,Ki)))&&ji(this,xs,fI).call(this);const _=ji(this,xs,pI).call(this);f&&(lt(this,Ki)!==l||dc(this.options.enabled,lt(this,Ki))!==dc(i.enabled,lt(this,Ki))||_!==lt(this,gf))&&ji(this,xs,mI).call(this,_)}getOptimisticResult(t){const i=lt(this,_l).getQueryCache().build(lt(this,_l),t),l=this.createResult(i,t);return xJ(this,l)&&(ln(this,Ha,l),ln(this,py,this.options),ln(this,bm,lt(this,Ki).state)),l}getCurrentResult(){return lt(this,Ha)}trackResult(t,i){return new Proxy(t,{get:(l,f)=>(this.trackProp(f),i==null||i(f),Reflect.get(l,f))})}trackProp(t){lt(this,_y).add(t)}getCurrentQuery(){return lt(this,Ki)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const i=lt(this,_l).defaultQueryOptions(t),l=lt(this,_l).getQueryCache().build(lt(this,_l),i);return l.fetch().then(()=>this.createResult(l,i))}fetch(t){return ji(this,xs,x0).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),lt(this,Ha)))}createResult(t,i){var Xe;const l=lt(this,Ki),f=this.options,_=lt(this,Ha),x=lt(this,bm),o=lt(this,py),I=t!==l?t.state:lt(this,xb),{state:N}=t;let U={...N},$=!1,V;if(i._optimisticResults){const Je=this.hasListeners(),Te=!Je&&KL(t,i),xe=Je&&YL(t,l,i,f);(Te||xe)&&(U={...U,...H5(N.data,t.options)}),i._optimisticResults==="isRestoring"&&(U.fetchStatus="idle")}let{error:Y,errorUpdatedAt:q,status:Z}=U;V=U.data;let Q=!1;if(i.placeholderData!==void 0&&V===void 0&&Z==="pending"){let Je;_!=null&&_.isPlaceholderData&&i.placeholderData===(o==null?void 0:o.placeholderData)?(Je=_.data,Q=!0):Je=typeof i.placeholderData=="function"?i.placeholderData((Xe=lt(this,gy))==null?void 0:Xe.state.data,lt(this,gy)):i.placeholderData,Je!==void 0&&(Z="success",V=dI(_==null?void 0:_.data,Je,i),$=!0)}if(i.select&&V!==void 0&&!Q)if(_&&V===(x==null?void 0:x.data)&&i.select===lt(this,bb))V=lt(this,my);else try{ln(this,bb,i.select),V=i.select(V),V=dI(_==null?void 0:_.data,V,i),ln(this,my,V),ln(this,mf,null)}catch(Je){ln(this,mf,Je)}lt(this,mf)&&(Y=lt(this,mf),V=lt(this,my),q=Date.now(),Z="error");const H=U.fetchStatus==="fetching",K=Z==="pending",ne=Z==="error",le=K&&H,pe=V!==void 0,Ze={status:Z,fetchStatus:U.fetchStatus,isPending:K,isSuccess:Z==="success",isError:ne,isInitialLoading:le,isLoading:le,data:V,dataUpdatedAt:U.dataUpdatedAt,error:Y,errorUpdatedAt:q,failureCount:U.fetchFailureCount,failureReason:U.fetchFailureReason,errorUpdateCount:U.errorUpdateCount,isFetched:U.dataUpdateCount>0||U.errorUpdateCount>0,isFetchedAfterMount:U.dataUpdateCount>I.dataUpdateCount||U.errorUpdateCount>I.errorUpdateCount,isFetching:H,isRefetching:H&&!K,isLoadingError:ne&&!pe,isPaused:U.fetchStatus==="paused",isPlaceholderData:$,isRefetchError:ne&&pe,isStale:xP(t,i),refetch:this.refetch,promise:lt(this,pf),isEnabled:dc(i.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const Je=Be=>{Ze.status==="error"?Be.reject(Ze.error):Ze.data!==void 0&&Be.resolve(Ze.data)},Te=()=>{const Be=ln(this,pf,Ze.promise=hI());Je(Be)},xe=lt(this,pf);switch(xe.status){case"pending":t.queryHash===l.queryHash&&Je(xe);break;case"fulfilled":(Ze.status==="error"||Ze.data!==xe.value)&&Te();break;case"rejected":(Ze.status!=="error"||Ze.error!==xe.reason)&&Te();break}}return Ze}updateResult(){const t=lt(this,Ha),i=this.createResult(lt(this,Ki),this.options);if(ln(this,bm,lt(this,Ki).state),ln(this,py,this.options),lt(this,bm).data!==void 0&&ln(this,gy,lt(this,Ki)),bT(i,t))return;ln(this,Ha,i);const l=()=>{if(!t)return!0;const{notifyOnChangeProps:f}=this.options,_=typeof f=="function"?f():f;if(_==="all"||!_&&!lt(this,_y).size)return!0;const x=new Set(_??lt(this,_y));return this.options.throwOnError&&x.add("error"),Object.keys(lt(this,Ha)).some(o=>{const A=o;return lt(this,Ha)[A]!==t[A]&&x.has(A)})};ji(this,xs,Z5).call(this,{listeners:l()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&ji(this,xs,gI).call(this)}},_l=new WeakMap,Ki=new WeakMap,xb=new WeakMap,Ha=new WeakMap,bm=new WeakMap,py=new WeakMap,pf=new WeakMap,mf=new WeakMap,bb=new WeakMap,my=new WeakMap,gy=new WeakMap,wm=new WeakMap,Sm=new WeakMap,gf=new WeakMap,_y=new WeakMap,xs=new WeakSet,x0=function(t){ji(this,xs,vI).call(this);let i=lt(this,Ki).fetch(this.options,t);return t!=null&&t.throwOnError||(i=i.catch(Za)),i},fI=function(){ji(this,xs,_I).call(this);const t=kf(this.options.staleTime,lt(this,Ki));if(Nm||lt(this,Ha).isStale||!cI(t))return;const l=z5(lt(this,Ha).dataUpdatedAt,t)+1;ln(this,wm,setTimeout(()=>{lt(this,Ha).isStale||this.updateResult()},l))},pI=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(lt(this,Ki)):this.options.refetchInterval)??!1},mI=function(t){ji(this,xs,yI).call(this),ln(this,gf,t),!(Nm||dc(this.options.enabled,lt(this,Ki))===!1||!cI(lt(this,gf))||lt(this,gf)===0)&&ln(this,Sm,setInterval(()=>{(this.options.refetchIntervalInBackground||vP.isFocused())&&ji(this,xs,x0).call(this)},lt(this,gf)))},gI=function(){ji(this,xs,fI).call(this),ji(this,xs,mI).call(this,ji(this,xs,pI).call(this))},_I=function(){lt(this,wm)&&(clearTimeout(lt(this,wm)),ln(this,wm,void 0))},yI=function(){lt(this,Sm)&&(clearInterval(lt(this,Sm)),ln(this,Sm,void 0))},vI=function(){const t=lt(this,_l).getQueryCache().build(lt(this,_l),this.options);if(t===lt(this,Ki))return;const i=lt(this,Ki);ln(this,Ki,t),ln(this,xb,t.state),this.hasListeners()&&(i==null||i.removeObserver(this),t.addObserver(this))},Z5=function(t){Wo.batch(()=>{t.listeners&&this.listeners.forEach(i=>{i(lt(this,Ha))}),lt(this,_l).getQueryCache().notify({query:lt(this,Ki),type:"observerResultsUpdated"})})},GF);function vJ(e,t){return dc(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function KL(e,t){return vJ(e,t)||e.state.data!==void 0&&xI(e,t,t.refetchOnMount)}function xI(e,t,i){if(dc(t.enabled,e)!==!1&&kf(t.staleTime,e)!=="static"){const l=typeof i=="function"?i(e):i;return l==="always"||l!==!1&&xP(e,t)}return!1}function YL(e,t,i,l){return(e!==t||dc(l.enabled,e)===!1)&&(!i.suspense||e.state.status!=="error")&&xP(e,i)}function xP(e,t){return dc(t.enabled,e)!==!1&&e.isStaleByTime(kf(t.staleTime,e))}function xJ(e,t){return!bT(e.getCurrentResult(),t)}var _f,yf,yl,Ld,Zd,FS,bI,HF,bJ=(HF=class extends Hy{constructor(i,l){super();Bn(this,Zd);Bn(this,_f);Bn(this,yf);Bn(this,yl);Bn(this,Ld);ln(this,_f,i),this.setOptions(l),this.bindMethods(),ji(this,Zd,FS).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(i){var f;const l=this.options;this.options=lt(this,_f).defaultMutationOptions(i),bT(this.options,l)||lt(this,_f).getMutationCache().notify({type:"observerOptionsUpdated",mutation:lt(this,yl),observer:this}),l!=null&&l.mutationKey&&this.options.mutationKey&&Dm(l.mutationKey)!==Dm(this.options.mutationKey)?this.reset():((f=lt(this,yl))==null?void 0:f.state.status)==="pending"&&lt(this,yl).setOptions(this.options)}onUnsubscribe(){var i;this.hasListeners()||(i=lt(this,yl))==null||i.removeObserver(this)}onMutationUpdate(i){ji(this,Zd,FS).call(this),ji(this,Zd,bI).call(this,i)}getCurrentResult(){return lt(this,yf)}reset(){var i;(i=lt(this,yl))==null||i.removeObserver(this),ln(this,yl,void 0),ji(this,Zd,FS).call(this),ji(this,Zd,bI).call(this)}mutate(i,l){var f;return ln(this,Ld,l),(f=lt(this,yl))==null||f.removeObserver(this),ln(this,yl,lt(this,_f).getMutationCache().build(lt(this,_f),this.options)),lt(this,yl).addObserver(this),lt(this,yl).execute(i)}},_f=new WeakMap,yf=new WeakMap,yl=new WeakMap,Ld=new WeakMap,Zd=new WeakSet,FS=function(){var l;const i=((l=lt(this,yl))==null?void 0:l.state)??W5();ln(this,yf,{...i,isPending:i.status==="pending",isSuccess:i.status==="success",isError:i.status==="error",isIdle:i.status==="idle",mutate:this.mutate,reset:this.reset})},bI=function(i){Wo.batch(()=>{var l,f,_,x,o,A,I,N;if(lt(this,Ld)&&this.hasListeners()){const U=lt(this,yf).variables,$=lt(this,yf).context;(i==null?void 0:i.type)==="success"?((f=(l=lt(this,Ld)).onSuccess)==null||f.call(l,i.data,U,$),(x=(_=lt(this,Ld)).onSettled)==null||x.call(_,i.data,null,U,$)):(i==null?void 0:i.type)==="error"&&((A=(o=lt(this,Ld)).onError)==null||A.call(o,i.error,U,$),(N=(I=lt(this,Ld)).onSettled)==null||N.call(I,void 0,i.error,U,$))}this.listeners.forEach(U=>{U(lt(this,yf))})})},HF),X5=F.createContext(void 0),Xf=e=>{const t=F.useContext(X5);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},wJ=({client:e,children:t})=>(F.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),d.jsx(X5.Provider,{value:e,children:t})),K5=F.createContext(!1),SJ=()=>F.useContext(K5);K5.Provider;function TJ(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var EJ=F.createContext(TJ()),CJ=()=>F.useContext(EJ),AJ=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))},jJ=e=>{F.useEffect(()=>{e.clearReset()},[e])},IJ=({result:e,errorResetBoundary:t,throwOnError:i,query:l,suspense:f})=>e.isError&&!t.isReset()&&!e.isFetching&&l&&(f&&e.data===void 0||V5(i,[e.error,l])),kJ=e=>{if(e.suspense){const t=l=>l==="static"?l:Math.max(l??1e3,1e3),i=e.staleTime;e.staleTime=typeof i=="function"?(...l)=>t(i(...l)):t(i),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},PJ=(e,t)=>e.isLoading&&e.isFetching&&!t,RJ=(e,t)=>(e==null?void 0:e.suspense)&&t.isPending,JL=(e,t,i)=>t.fetchOptimistic(e).catch(()=>{i.clearReset()});function MJ(e,t,i){var U,$,V,Y,q;const l=SJ(),f=CJ(),_=Xf(),x=_.defaultQueryOptions(e);($=(U=_.getDefaultOptions().queries)==null?void 0:U._experimental_beforeQuery)==null||$.call(U,x),x._optimisticResults=l?"isRestoring":"optimistic",kJ(x),AJ(x,f),jJ(f);const o=!_.getQueryCache().get(x.queryHash),[A]=F.useState(()=>new t(_,x)),I=A.getOptimisticResult(x),N=!l&&e.subscribed!==!1;if(F.useSyncExternalStore(F.useCallback(Z=>{const Q=N?A.subscribe(Wo.batchCalls(Z)):Za;return A.updateResult(),Q},[A,N]),()=>A.getCurrentResult(),()=>A.getCurrentResult()),F.useEffect(()=>{A.setOptions(x)},[x,A]),RJ(x,I))throw JL(x,A,f);if(IJ({result:I,errorResetBoundary:f,throwOnError:x.throwOnError,query:_.getQueryCache().get(x.queryHash),suspense:x.suspense}))throw I.error;if((Y=(V=_.getDefaultOptions().queries)==null?void 0:V._experimental_afterQuery)==null||Y.call(V,x,I),x.experimental_prefetchInRender&&!Nm&&PJ(I,l)){const Z=o?JL(x,A,f):(q=_.getQueryCache().get(x.queryHash))==null?void 0:q.promise;Z==null||Z.catch(Za).finally(()=>{A.updateResult()})}return x.notifyOnChangeProps?I:A.trackResult(I)}function Ks(e,t){return MJ(e,yJ)}function sS(e,t){const i=Xf(),[l]=F.useState(()=>new bJ(i,e));F.useEffect(()=>{l.setOptions(e)},[l,e]);const f=F.useSyncExternalStore(F.useCallback(x=>l.subscribe(Wo.batchCalls(x)),[l]),()=>l.getCurrentResult(),()=>l.getCurrentResult()),_=F.useCallback((x,o)=>{l.mutate(x,o).catch(Za)},[l]);if(f.error&&V5(l.options.throwOnError,[f.error]))throw f.error;return{...f,mutate:_,mutateAsync:f.mutate}}/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ub(){return ub=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&(e[l]=i[l])}return e},ub.apply(this,arguments)}var bf;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(bf||(bf={}));const QL="popstate";function NJ(e){e===void 0&&(e={});function t(l,f){let{pathname:_,search:x,hash:o}=l.location;return wI("",{pathname:_,search:x,hash:o},f.state&&f.state.usr||null,f.state&&f.state.key||"default")}function i(l,f){return typeof f=="string"?f:ST(f)}return OJ(t,i,null,e)}function co(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function Y5(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function DJ(){return Math.random().toString(36).substr(2,8)}function ez(e,t){return{usr:e.state,key:e.key,idx:t}}function wI(e,t,i,l){return i===void 0&&(i=null),ub({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?Wy(t):t,{state:i,key:t&&t.key||l||DJ()})}function ST(e){let{pathname:t="/",search:i="",hash:l=""}=e;return i&&i!=="?"&&(t+=i.charAt(0)==="?"?i:"?"+i),l&&l!=="#"&&(t+=l.charAt(0)==="#"?l:"#"+l),t}function Wy(e){let t={};if(e){let i=e.indexOf("#");i>=0&&(t.hash=e.substr(i),e=e.substr(0,i));let l=e.indexOf("?");l>=0&&(t.search=e.substr(l),e=e.substr(0,l)),e&&(t.pathname=e)}return t}function OJ(e,t,i,l){l===void 0&&(l={});let{window:f=document.defaultView,v5Compat:_=!1}=l,x=f.history,o=bf.Pop,A=null,I=N();I==null&&(I=0,x.replaceState(ub({},x.state,{idx:I}),""));function N(){return(x.state||{idx:null}).idx}function U(){o=bf.Pop;let Z=N(),Q=Z==null?null:Z-I;I=Z,A&&A({action:o,location:q.location,delta:Q})}function $(Z,Q){o=bf.Push;let H=wI(q.location,Z,Q);I=N()+1;let K=ez(H,I),ne=q.createHref(H);try{x.pushState(K,"",ne)}catch(le){if(le instanceof DOMException&&le.name==="DataCloneError")throw le;f.location.assign(ne)}_&&A&&A({action:o,location:q.location,delta:1})}function V(Z,Q){o=bf.Replace;let H=wI(q.location,Z,Q);I=N();let K=ez(H,I),ne=q.createHref(H);x.replaceState(K,"",ne),_&&A&&A({action:o,location:q.location,delta:0})}function Y(Z){let Q=f.location.origin!=="null"?f.location.origin:f.location.href,H=typeof Z=="string"?Z:ST(Z);return H=H.replace(/ $/,"%20"),co(Q,"No window.location.(origin|href) available to create URL for href: "+H),new URL(H,Q)}let q={get action(){return o},get location(){return e(f,x)},listen(Z){if(A)throw new Error("A history only accepts one active listener");return f.addEventListener(QL,U),A=Z,()=>{f.removeEventListener(QL,U),A=null}},createHref(Z){return t(f,Z)},createURL:Y,encodeLocation(Z){let Q=Y(Z);return{pathname:Q.pathname,search:Q.search,hash:Q.hash}},push:$,replace:V,go(Z){return x.go(Z)}};return q}var tz;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(tz||(tz={}));function LJ(e,t,i){return i===void 0&&(i="/"),zJ(e,t,i,!1)}function zJ(e,t,i,l){let f=typeof t=="string"?Wy(t):t,_=jy(f.pathname||"/",i);if(_==null)return null;let x=J5(e);FJ(x);let o=null;for(let A=0;o==null&&A<x.length;++A){let I=KJ(_);o=ZJ(x[A],I,l)}return o}function J5(e,t,i,l){t===void 0&&(t=[]),i===void 0&&(i=[]),l===void 0&&(l="");let f=(_,x,o)=>{let A={relativePath:o===void 0?_.path||"":o,caseSensitive:_.caseSensitive===!0,childrenIndex:x,route:_};A.relativePath.startsWith("/")&&(co(A.relativePath.startsWith(l),'Absolute route path "'+A.relativePath+'" nested under path '+('"'+l+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),A.relativePath=A.relativePath.slice(l.length));let I=Pf([l,A.relativePath]),N=i.concat(A);_.children&&_.children.length>0&&(co(_.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+I+'".')),J5(_.children,t,N,I)),!(_.path==null&&!_.index)&&t.push({path:I,score:HJ(I,_.index),routesMeta:N})};return e.forEach((_,x)=>{var o;if(_.path===""||!((o=_.path)!=null&&o.includes("?")))f(_,x);else for(let A of Q5(_.path))f(_,x,A)}),t}function Q5(e){let t=e.split("/");if(t.length===0)return[];let[i,...l]=t,f=i.endsWith("?"),_=i.replace(/\?$/,"");if(l.length===0)return f?[_,""]:[_];let x=Q5(l.join("/")),o=[];return o.push(...x.map(A=>A===""?_:[_,A].join("/"))),f&&o.push(...x),o.map(A=>e.startsWith("/")&&A===""?"/":A)}function FJ(e){e.sort((t,i)=>t.score!==i.score?i.score-t.score:WJ(t.routesMeta.map(l=>l.childrenIndex),i.routesMeta.map(l=>l.childrenIndex)))}const BJ=/^:[\w-]+$/,VJ=3,UJ=2,$J=1,qJ=10,GJ=-2,rz=e=>e==="*";function HJ(e,t){let i=e.split("/"),l=i.length;return i.some(rz)&&(l+=GJ),t&&(l+=UJ),i.filter(f=>!rz(f)).reduce((f,_)=>f+(BJ.test(_)?VJ:_===""?$J:qJ),l)}function WJ(e,t){return e.length===t.length&&e.slice(0,-1).every((l,f)=>l===t[f])?e[e.length-1]-t[t.length-1]:0}function ZJ(e,t,i){let{routesMeta:l}=e,f={},_="/",x=[];for(let o=0;o<l.length;++o){let A=l[o],I=o===l.length-1,N=_==="/"?t:t.slice(_.length)||"/",U=TT({path:A.relativePath,caseSensitive:A.caseSensitive,end:I},N),$=A.route;if(!U&&I&&i&&!l[l.length-1].route.index&&(U=TT({path:A.relativePath,caseSensitive:A.caseSensitive,end:!1},N)),!U)return null;Object.assign(f,U.params),x.push({params:f,pathname:Pf([_,U.pathname]),pathnameBase:eQ(Pf([_,U.pathnameBase])),route:$}),U.pathnameBase!=="/"&&(_=Pf([_,U.pathnameBase]))}return x}function TT(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[i,l]=XJ(e.path,e.caseSensitive,e.end),f=t.match(i);if(!f)return null;let _=f[0],x=_.replace(/(.)\/+$/,"$1"),o=f.slice(1);return{params:l.reduce((I,N,U)=>{let{paramName:$,isOptional:V}=N;if($==="*"){let q=o[U]||"";x=_.slice(0,_.length-q.length).replace(/(.)\/+$/,"$1")}const Y=o[U];return V&&!Y?I[$]=void 0:I[$]=(Y||"").replace(/%2F/g,"/"),I},{}),pathname:_,pathnameBase:x,pattern:e}}function XJ(e,t,i){t===void 0&&(t=!1),i===void 0&&(i=!0),Y5(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let l=[],f="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(x,o,A)=>(l.push({paramName:o,isOptional:A!=null}),A?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(l.push({paramName:"*"}),f+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?f+="\\/*$":e!==""&&e!=="/"&&(f+="(?:(?=\\/|$))"),[new RegExp(f,t?void 0:"i"),l]}function KJ(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Y5(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function jy(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let i=t.endsWith("/")?t.length-1:t.length,l=e.charAt(i);return l&&l!=="/"?null:e.slice(i)||"/"}function YJ(e,t){t===void 0&&(t="/");let{pathname:i,search:l="",hash:f=""}=typeof e=="string"?Wy(e):e;return{pathname:i?i.startsWith("/")?i:JJ(i,t):t,search:tQ(l),hash:rQ(f)}}function JJ(e,t){let i=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(f=>{f===".."?i.length>1&&i.pop():f!=="."&&i.push(f)}),i.length>1?i.join("/"):"/"}function TA(e,t,i,l){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(l)+"].  Please separate it out to the ")+("`to."+i+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function QJ(e){return e.filter((t,i)=>i===0||t.route.path&&t.route.path.length>0)}function bP(e,t){let i=QJ(e);return t?i.map((l,f)=>f===i.length-1?l.pathname:l.pathnameBase):i.map(l=>l.pathnameBase)}function wP(e,t,i,l){l===void 0&&(l=!1);let f;typeof e=="string"?f=Wy(e):(f=ub({},e),co(!f.pathname||!f.pathname.includes("?"),TA("?","pathname","search",f)),co(!f.pathname||!f.pathname.includes("#"),TA("#","pathname","hash",f)),co(!f.search||!f.search.includes("#"),TA("#","search","hash",f)));let _=e===""||f.pathname==="",x=_?"/":f.pathname,o;if(x==null)o=i;else{let U=t.length-1;if(!l&&x.startsWith("..")){let $=x.split("/");for(;$[0]==="..";)$.shift(),U-=1;f.pathname=$.join("/")}o=U>=0?t[U]:"/"}let A=YJ(f,o),I=x&&x!=="/"&&x.endsWith("/"),N=(_||x===".")&&i.endsWith("/");return!A.pathname.endsWith("/")&&(I||N)&&(A.pathname+="/"),A}const Pf=e=>e.join("/").replace(/\/\/+/g,"/"),eQ=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),tQ=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,rQ=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function nQ(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const eV=["post","put","patch","delete"];new Set(eV);const iQ=["get",...eV];new Set(iQ);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function db(){return db=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&(e[l]=i[l])}return e},db.apply(this,arguments)}const b2=F.createContext(null),tV=F.createContext(null),rh=F.createContext(null),w2=F.createContext(null),Kf=F.createContext({outlet:null,matches:[],isDataRoute:!1}),rV=F.createContext(null);function sQ(e,t){let{relative:i}=t===void 0?{}:t;Zy()||co(!1);let{basename:l,navigator:f}=F.useContext(rh),{hash:_,pathname:x,search:o}=S2(e,{relative:i}),A=x;return l!=="/"&&(A=x==="/"?l:Pf([l,x])),f.createHref({pathname:A,search:o,hash:_})}function Zy(){return F.useContext(w2)!=null}function Yf(){return Zy()||co(!1),F.useContext(w2).location}function nV(e){F.useContext(rh).static||F.useLayoutEffect(e)}function _u(){let{isDataRoute:e}=F.useContext(Kf);return e?yQ():oQ()}function oQ(){Zy()||co(!1);let e=F.useContext(b2),{basename:t,future:i,navigator:l}=F.useContext(rh),{matches:f}=F.useContext(Kf),{pathname:_}=Yf(),x=JSON.stringify(bP(f,i.v7_relativeSplatPath)),o=F.useRef(!1);return nV(()=>{o.current=!0}),F.useCallback(function(I,N){if(N===void 0&&(N={}),!o.current)return;if(typeof I=="number"){l.go(I);return}let U=wP(I,JSON.parse(x),_,N.relative==="path");e==null&&t!=="/"&&(U.pathname=U.pathname==="/"?t:Pf([t,U.pathname])),(N.replace?l.replace:l.push)(U,N.state,N)},[t,l,x,_,e])}function S2(e,t){let{relative:i}=t===void 0?{}:t,{future:l}=F.useContext(rh),{matches:f}=F.useContext(Kf),{pathname:_}=Yf(),x=JSON.stringify(bP(f,l.v7_relativeSplatPath));return F.useMemo(()=>wP(e,JSON.parse(x),_,i==="path"),[e,x,_,i])}function aQ(e,t){return lQ(e,t)}function lQ(e,t,i,l){Zy()||co(!1);let{navigator:f}=F.useContext(rh),{matches:_}=F.useContext(Kf),x=_[_.length-1],o=x?x.params:{};x&&x.pathname;let A=x?x.pathnameBase:"/";x&&x.route;let I=Yf(),N;if(t){var U;let Z=typeof t=="string"?Wy(t):t;A==="/"||(U=Z.pathname)!=null&&U.startsWith(A)||co(!1),N=Z}else N=I;let $=N.pathname||"/",V=$;if(A!=="/"){let Z=A.replace(/^\//,"").split("/");V="/"+$.replace(/^\//,"").split("/").slice(Z.length).join("/")}let Y=LJ(e,{pathname:V}),q=fQ(Y&&Y.map(Z=>Object.assign({},Z,{params:Object.assign({},o,Z.params),pathname:Pf([A,f.encodeLocation?f.encodeLocation(Z.pathname).pathname:Z.pathname]),pathnameBase:Z.pathnameBase==="/"?A:Pf([A,f.encodeLocation?f.encodeLocation(Z.pathnameBase).pathname:Z.pathnameBase])})),_,i,l);return t&&q?F.createElement(w2.Provider,{value:{location:db({pathname:"/",search:"",hash:"",state:null,key:"default"},N),navigationType:bf.Pop}},q):q}function cQ(){let e=_Q(),t=nQ(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),i=e instanceof Error?e.stack:null,f={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return F.createElement(F.Fragment,null,F.createElement("h2",null,"Unexpected Application Error!"),F.createElement("h3",{style:{fontStyle:"italic"}},t),i?F.createElement("pre",{style:f},i):null,null)}const uQ=F.createElement(cQ,null);class dQ extends F.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,i){return i.location!==t.location||i.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:i.error,location:i.location,revalidation:t.revalidation||i.revalidation}}componentDidCatch(t,i){console.error("React Router caught the following error during render",t,i)}render(){return this.state.error!==void 0?F.createElement(Kf.Provider,{value:this.props.routeContext},F.createElement(rV.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function hQ(e){let{routeContext:t,match:i,children:l}=e,f=F.useContext(b2);return f&&f.static&&f.staticContext&&(i.route.errorElement||i.route.ErrorBoundary)&&(f.staticContext._deepestRenderedBoundaryId=i.route.id),F.createElement(Kf.Provider,{value:t},l)}function fQ(e,t,i,l){var f;if(t===void 0&&(t=[]),i===void 0&&(i=null),l===void 0&&(l=null),e==null){var _;if(!i)return null;if(i.errors)e=i.matches;else if((_=l)!=null&&_.v7_partialHydration&&t.length===0&&!i.initialized&&i.matches.length>0)e=i.matches;else return null}let x=e,o=(f=i)==null?void 0:f.errors;if(o!=null){let N=x.findIndex(U=>U.route.id&&(o==null?void 0:o[U.route.id])!==void 0);N>=0||co(!1),x=x.slice(0,Math.min(x.length,N+1))}let A=!1,I=-1;if(i&&l&&l.v7_partialHydration)for(let N=0;N<x.length;N++){let U=x[N];if((U.route.HydrateFallback||U.route.hydrateFallbackElement)&&(I=N),U.route.id){let{loaderData:$,errors:V}=i,Y=U.route.loader&&$[U.route.id]===void 0&&(!V||V[U.route.id]===void 0);if(U.route.lazy||Y){A=!0,I>=0?x=x.slice(0,I+1):x=[x[0]];break}}}return x.reduceRight((N,U,$)=>{let V,Y=!1,q=null,Z=null;i&&(V=o&&U.route.id?o[U.route.id]:void 0,q=U.route.errorElement||uQ,A&&(I<0&&$===0?(Y=!0,Z=null):I===$&&(Y=!0,Z=U.route.hydrateFallbackElement||null)));let Q=t.concat(x.slice(0,$+1)),H=()=>{let K;return V?K=q:Y?K=Z:U.route.Component?K=F.createElement(U.route.Component,null):U.route.element?K=U.route.element:K=N,F.createElement(hQ,{match:U,routeContext:{outlet:N,matches:Q,isDataRoute:i!=null},children:K})};return i&&(U.route.ErrorBoundary||U.route.errorElement||$===0)?F.createElement(dQ,{location:i.location,revalidation:i.revalidation,component:q,error:V,children:H(),routeContext:{outlet:null,matches:Q,isDataRoute:!0}}):H()},null)}var iV=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(iV||{}),ET=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(ET||{});function pQ(e){let t=F.useContext(b2);return t||co(!1),t}function mQ(e){let t=F.useContext(tV);return t||co(!1),t}function gQ(e){let t=F.useContext(Kf);return t||co(!1),t}function sV(e){let t=gQ(),i=t.matches[t.matches.length-1];return i.route.id||co(!1),i.route.id}function _Q(){var e;let t=F.useContext(rV),i=mQ(ET.UseRouteError),l=sV(ET.UseRouteError);return t!==void 0?t:(e=i.errors)==null?void 0:e[l]}function yQ(){let{router:e}=pQ(iV.UseNavigateStable),t=sV(ET.UseNavigateStable),i=F.useRef(!1);return nV(()=>{i.current=!0}),F.useCallback(function(f,_){_===void 0&&(_={}),i.current&&(typeof f=="number"?e.navigate(f):e.navigate(f,db({fromRouteId:t},_)))},[e,t])}function vQ(e,t){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function xQ(e){let{to:t,replace:i,state:l,relative:f}=e;Zy()||co(!1);let{future:_,static:x}=F.useContext(rh),{matches:o}=F.useContext(Kf),{pathname:A}=Yf(),I=_u(),N=wP(t,bP(o,_.v7_relativeSplatPath),A,f==="path"),U=JSON.stringify(N);return F.useEffect(()=>I(JSON.parse(U),{replace:i,state:l,relative:f}),[I,U,f,i,l]),null}function vs(e){co(!1)}function bQ(e){let{basename:t="/",children:i=null,location:l,navigationType:f=bf.Pop,navigator:_,static:x=!1,future:o}=e;Zy()&&co(!1);let A=t.replace(/^\/*/,"/"),I=F.useMemo(()=>({basename:A,navigator:_,static:x,future:db({v7_relativeSplatPath:!1},o)}),[A,o,_,x]);typeof l=="string"&&(l=Wy(l));let{pathname:N="/",search:U="",hash:$="",state:V=null,key:Y="default"}=l,q=F.useMemo(()=>{let Z=jy(N,A);return Z==null?null:{location:{pathname:Z,search:U,hash:$,state:V,key:Y},navigationType:f}},[A,N,U,$,V,Y,f]);return q==null?null:F.createElement(rh.Provider,{value:I},F.createElement(w2.Provider,{children:i,value:q}))}function wQ(e){let{children:t,location:i}=e;return aQ(SI(t),i)}new Promise(()=>{});function SI(e,t){t===void 0&&(t=[]);let i=[];return F.Children.forEach(e,(l,f)=>{if(!F.isValidElement(l))return;let _=[...t,f];if(l.type===F.Fragment){i.push.apply(i,SI(l.props.children,_));return}l.type!==vs&&co(!1),!l.props.index||!l.props.children||co(!1);let x={id:l.props.id||_.join("-"),caseSensitive:l.props.caseSensitive,element:l.props.element,Component:l.props.Component,index:l.props.index,path:l.props.path,loader:l.props.loader,action:l.props.action,errorElement:l.props.errorElement,ErrorBoundary:l.props.ErrorBoundary,hasErrorBoundary:l.props.ErrorBoundary!=null||l.props.errorElement!=null,shouldRevalidate:l.props.shouldRevalidate,handle:l.props.handle,lazy:l.props.lazy};l.props.children&&(x.children=SI(l.props.children,_)),i.push(x)}),i}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function CT(){return CT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&(e[l]=i[l])}return e},CT.apply(this,arguments)}function oV(e,t){if(e==null)return{};var i={},l=Object.keys(e),f,_;for(_=0;_<l.length;_++)f=l[_],!(t.indexOf(f)>=0)&&(i[f]=e[f]);return i}function SQ(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function TQ(e,t){return e.button===0&&(!t||t==="_self")&&!SQ(e)}const EQ=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],CQ=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],AQ="6";try{window.__reactRouterVersion=AQ}catch{}const jQ=F.createContext({isTransitioning:!1}),IQ="startTransition",nz=ak[IQ];function kQ(e){let{basename:t,children:i,future:l,window:f}=e,_=F.useRef();_.current==null&&(_.current=NJ({window:f,v5Compat:!0}));let x=_.current,[o,A]=F.useState({action:x.action,location:x.location}),{v7_startTransition:I}=l||{},N=F.useCallback(U=>{I&&nz?nz(()=>A(U)):A(U)},[A,I]);return F.useLayoutEffect(()=>x.listen(N),[x,N]),F.useEffect(()=>vQ(l),[l]),F.createElement(bQ,{basename:t,children:i,location:o.location,navigationType:o.action,navigator:x,future:l})}const PQ=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",RQ=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,aV=F.forwardRef(function(t,i){let{onClick:l,relative:f,reloadDocument:_,replace:x,state:o,target:A,to:I,preventScrollReset:N,viewTransition:U}=t,$=oV(t,EQ),{basename:V}=F.useContext(rh),Y,q=!1;if(typeof I=="string"&&RQ.test(I)&&(Y=I,PQ))try{let K=new URL(window.location.href),ne=I.startsWith("//")?new URL(K.protocol+I):new URL(I),le=jy(ne.pathname,V);ne.origin===K.origin&&le!=null?I=le+ne.search+ne.hash:q=!0}catch{}let Z=sQ(I,{relative:f}),Q=DQ(I,{replace:x,state:o,target:A,preventScrollReset:N,relative:f,viewTransition:U});function H(K){l&&l(K),K.defaultPrevented||Q(K)}return F.createElement("a",CT({},$,{href:Y||Z,onClick:q||_?l:H,ref:i,target:A}))}),MQ=F.forwardRef(function(t,i){let{"aria-current":l="page",caseSensitive:f=!1,className:_="",end:x=!1,style:o,to:A,viewTransition:I,children:N}=t,U=oV(t,CQ),$=S2(A,{relative:U.relative}),V=Yf(),Y=F.useContext(tV),{navigator:q,basename:Z}=F.useContext(rh),Q=Y!=null&&OQ($)&&I===!0,H=q.encodeLocation?q.encodeLocation($).pathname:$.pathname,K=V.pathname,ne=Y&&Y.navigation&&Y.navigation.location?Y.navigation.location.pathname:null;f||(K=K.toLowerCase(),ne=ne?ne.toLowerCase():null,H=H.toLowerCase()),ne&&Z&&(ne=jy(ne,Z)||ne);const le=H!=="/"&&H.endsWith("/")?H.length-1:H.length;let pe=K===H||!x&&K.startsWith(H)&&K.charAt(le)==="/",Ae=ne!=null&&(ne===H||!x&&ne.startsWith(H)&&ne.charAt(H.length)==="/"),Ze={isActive:pe,isPending:Ae,isTransitioning:Q},Xe=pe?l:void 0,Je;typeof _=="function"?Je=_(Ze):Je=[_,pe?"active":null,Ae?"pending":null,Q?"transitioning":null].filter(Boolean).join(" ");let Te=typeof o=="function"?o(Ze):o;return F.createElement(aV,CT({},U,{"aria-current":Xe,className:Je,ref:i,style:Te,to:A,viewTransition:I}),typeof N=="function"?N(Ze):N)});var TI;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(TI||(TI={}));var iz;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(iz||(iz={}));function NQ(e){let t=F.useContext(b2);return t||co(!1),t}function DQ(e,t){let{target:i,replace:l,state:f,preventScrollReset:_,relative:x,viewTransition:o}=t===void 0?{}:t,A=_u(),I=Yf(),N=S2(e,{relative:x});return F.useCallback(U=>{if(TQ(U,i)){U.preventDefault();let $=l!==void 0?l:ST(I)===ST(N);A(e,{replace:$,state:f,preventScrollReset:_,relative:x,viewTransition:o})}},[I,A,N,l,f,i,e,_,x,o])}function OQ(e,t){t===void 0&&(t={});let i=F.useContext(jQ);i==null&&co(!1);let{basename:l}=NQ(TI.useViewTransitionState),f=S2(e,{relative:t.relative});if(!i.isTransitioning)return!1;let _=jy(i.currentLocation.pathname,l)||i.currentLocation.pathname,x=jy(i.nextLocation.pathname,l)||i.nextLocation.pathname;return TT(f.pathname,x)!=null||TT(f.pathname,_)!=null}var EI=function(e,t){return EI=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,l){i.__proto__=l}||function(i,l){for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(i[f]=l[f])},EI(e,t)};function lV(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");EI(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}var pc=function(){return pc=Object.assign||function(t){for(var i,l=1,f=arguments.length;l<f;l++){i=arguments[l];for(var _ in i)Object.prototype.hasOwnProperty.call(i,_)&&(t[_]=i[_])}return t},pc.apply(this,arguments)};function Jf(e,t){var i={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&t.indexOf(l)<0&&(i[l]=e[l]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,l=Object.getOwnPropertySymbols(e);f<l.length;f++)t.indexOf(l[f])<0&&Object.prototype.propertyIsEnumerable.call(e,l[f])&&(i[l[f]]=e[l[f]]);return i}function cV(e,t,i,l){var f=arguments.length,_=f<3?t:l===null?l=Object.getOwnPropertyDescriptor(t,i):l,x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(e,t,i,l);else for(var o=e.length-1;o>=0;o--)(x=e[o])&&(_=(f<3?x(_):f>3?x(t,i,_):x(t,i))||_);return f>3&&_&&Object.defineProperty(t,i,_),_}function uV(e,t){return function(i,l){t(i,l,e)}}function dV(e,t,i,l,f,_){function x(Q){if(Q!==void 0&&typeof Q!="function")throw new TypeError("Function expected");return Q}for(var o=l.kind,A=o==="getter"?"get":o==="setter"?"set":"value",I=!t&&e?l.static?e:e.prototype:null,N=t||(I?Object.getOwnPropertyDescriptor(I,l.name):{}),U,$=!1,V=i.length-1;V>=0;V--){var Y={};for(var q in l)Y[q]=q==="access"?{}:l[q];for(var q in l.access)Y.access[q]=l.access[q];Y.addInitializer=function(Q){if($)throw new TypeError("Cannot add initializers after decoration has completed");_.push(x(Q||null))};var Z=(0,i[V])(o==="accessor"?{get:N.get,set:N.set}:N[A],Y);if(o==="accessor"){if(Z===void 0)continue;if(Z===null||typeof Z!="object")throw new TypeError("Object expected");(U=x(Z.get))&&(N.get=U),(U=x(Z.set))&&(N.set=U),(U=x(Z.init))&&f.unshift(U)}else(U=x(Z))&&(o==="field"?f.unshift(U):N[A]=U)}I&&Object.defineProperty(I,l.name,N),$=!0}function hV(e,t,i){for(var l=arguments.length>2,f=0;f<t.length;f++)i=l?t[f].call(e,i):t[f].call(e);return l?i:void 0}function fV(e){return typeof e=="symbol"?e:"".concat(e)}function pV(e,t,i){return typeof t=="symbol"&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:i?"".concat(i," ",t):t})}function mV(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)}function Tn(e,t,i,l){function f(_){return _ instanceof i?_:new i(function(x){x(_)})}return new(i||(i=Promise))(function(_,x){function o(N){try{I(l.next(N))}catch(U){x(U)}}function A(N){try{I(l.throw(N))}catch(U){x(U)}}function I(N){N.done?_(N.value):f(N.value).then(o,A)}I((l=l.apply(e,t||[])).next())})}function gV(e,t){var i={label:0,sent:function(){if(_[0]&1)throw _[1];return _[1]},trys:[],ops:[]},l,f,_,x=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return x.next=o(0),x.throw=o(1),x.return=o(2),typeof Symbol=="function"&&(x[Symbol.iterator]=function(){return this}),x;function o(I){return function(N){return A([I,N])}}function A(I){if(l)throw new TypeError("Generator is already executing.");for(;x&&(x=0,I[0]&&(i=0)),i;)try{if(l=1,f&&(_=I[0]&2?f.return:I[0]?f.throw||((_=f.return)&&_.call(f),0):f.next)&&!(_=_.call(f,I[1])).done)return _;switch(f=0,_&&(I=[I[0]&2,_.value]),I[0]){case 0:case 1:_=I;break;case 4:return i.label++,{value:I[1],done:!1};case 5:i.label++,f=I[1],I=[0];continue;case 7:I=i.ops.pop(),i.trys.pop();continue;default:if(_=i.trys,!(_=_.length>0&&_[_.length-1])&&(I[0]===6||I[0]===2)){i=0;continue}if(I[0]===3&&(!_||I[1]>_[0]&&I[1]<_[3])){i.label=I[1];break}if(I[0]===6&&i.label<_[1]){i.label=_[1],_=I;break}if(_&&i.label<_[2]){i.label=_[2],i.ops.push(I);break}_[2]&&i.ops.pop(),i.trys.pop();continue}I=t.call(e,i)}catch(N){I=[6,N],f=0}finally{l=_=0}if(I[0]&5)throw I[1];return{value:I[0]?I[1]:void 0,done:!0}}}var T2=Object.create?function(e,t,i,l){l===void 0&&(l=i);var f=Object.getOwnPropertyDescriptor(t,i);(!f||("get"in f?!t.__esModule:f.writable||f.configurable))&&(f={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,l,f)}:function(e,t,i,l){l===void 0&&(l=i),e[l]=t[i]};function _V(e,t){for(var i in e)i!=="default"&&!Object.prototype.hasOwnProperty.call(t,i)&&T2(t,e,i)}function AT(e){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&e[t],l=0;if(i)return i.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&l>=e.length&&(e=void 0),{value:e&&e[l++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function SP(e,t){var i=typeof Symbol=="function"&&e[Symbol.iterator];if(!i)return e;var l=i.call(e),f,_=[],x;try{for(;(t===void 0||t-- >0)&&!(f=l.next()).done;)_.push(f.value)}catch(o){x={error:o}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(x)throw x.error}}return _}function yV(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(SP(arguments[t]));return e}function vV(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;for(var l=Array(e),f=0,t=0;t<i;t++)for(var _=arguments[t],x=0,o=_.length;x<o;x++,f++)l[f]=_[x];return l}function TP(e,t,i){if(i||arguments.length===2)for(var l=0,f=t.length,_;l<f;l++)(_||!(l in t))&&(_||(_=Array.prototype.slice.call(t,0,l)),_[l]=t[l]);return e.concat(_||Array.prototype.slice.call(t))}function Iy(e){return this instanceof Iy?(this.v=e,this):new Iy(e)}function xV(e,t,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l=i.apply(e,t||[]),f,_=[];return f=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",x),f[Symbol.asyncIterator]=function(){return this},f;function x(V){return function(Y){return Promise.resolve(Y).then(V,U)}}function o(V,Y){l[V]&&(f[V]=function(q){return new Promise(function(Z,Q){_.push([V,q,Z,Q])>1||A(V,q)})},Y&&(f[V]=Y(f[V])))}function A(V,Y){try{I(l[V](Y))}catch(q){$(_[0][3],q)}}function I(V){V.value instanceof Iy?Promise.resolve(V.value.v).then(N,U):$(_[0][2],V)}function N(V){A("next",V)}function U(V){A("throw",V)}function $(V,Y){V(Y),_.shift(),_.length&&A(_[0][0],_[0][1])}}function bV(e){var t,i;return t={},l("next"),l("throw",function(f){throw f}),l("return"),t[Symbol.iterator]=function(){return this},t;function l(f,_){t[f]=e[f]?function(x){return(i=!i)?{value:Iy(e[f](x)),done:!1}:_?_(x):x}:_}}function wV(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],i;return t?t.call(e):(e=typeof AT=="function"?AT(e):e[Symbol.iterator](),i={},l("next"),l("throw"),l("return"),i[Symbol.asyncIterator]=function(){return this},i);function l(_){i[_]=e[_]&&function(x){return new Promise(function(o,A){x=e[_](x),f(o,A,x.done,x.value)})}}function f(_,x,o,A){Promise.resolve(A).then(function(I){_({value:I,done:o})},x)}}function SV(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var LQ=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},CI=function(e){return CI=Object.getOwnPropertyNames||function(t){var i=[];for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(i[i.length]=l);return i},CI(e)};function TV(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i=CI(e),l=0;l<i.length;l++)i[l]!=="default"&&T2(t,e,i[l]);return LQ(t,e),t}function EV(e){return e&&e.__esModule?e:{default:e}}function CV(e,t,i,l){if(i==="a"&&!l)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!l:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?l:i==="a"?l.call(e):l?l.value:t.get(e)}function AV(e,t,i,l,f){if(l==="m")throw new TypeError("Private method is not writable");if(l==="a"&&!f)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!f:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return l==="a"?f.call(e,i):f?f.value=i:t.set(e,i),i}function jV(e,t){if(t===null||typeof t!="object"&&typeof t!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof e=="function"?t===e:e.has(t)}function IV(e,t,i){if(t!=null){if(typeof t!="object"&&typeof t!="function")throw new TypeError("Object expected.");var l,f;if(i){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");l=t[Symbol.asyncDispose]}if(l===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");l=t[Symbol.dispose],i&&(f=l)}if(typeof l!="function")throw new TypeError("Object not disposable.");f&&(l=function(){try{f.call(this)}catch(_){return Promise.reject(_)}}),e.stack.push({value:t,dispose:l,async:i})}else i&&e.stack.push({async:!0});return t}var zQ=typeof SuppressedError=="function"?SuppressedError:function(e,t,i){var l=new Error(i);return l.name="SuppressedError",l.error=e,l.suppressed=t,l};function kV(e){function t(_){e.error=e.hasError?new zQ(_,e.error,"An error was suppressed during disposal."):_,e.hasError=!0}var i,l=0;function f(){for(;i=e.stack.pop();)try{if(!i.async&&l===1)return l=0,e.stack.push(i),Promise.resolve().then(f);if(i.dispose){var _=i.dispose.call(i.value);if(i.async)return l|=2,Promise.resolve(_).then(f,function(x){return t(x),f()})}else l|=1}catch(x){t(x)}if(l===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return f()}function PV(e,t){return typeof e=="string"&&/^\.\.?\//.test(e)?e.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(i,l,f,_,x){return l?t?".jsx":".js":f&&(!_||!x)?i:f+_+"."+x.toLowerCase()+"js"}):e}const FQ={__extends:lV,__assign:pc,__rest:Jf,__decorate:cV,__param:uV,__esDecorate:dV,__runInitializers:hV,__propKey:fV,__setFunctionName:pV,__metadata:mV,__awaiter:Tn,__generator:gV,__createBinding:T2,__exportStar:_V,__values:AT,__read:SP,__spread:yV,__spreadArrays:vV,__spreadArray:TP,__await:Iy,__asyncGenerator:xV,__asyncDelegator:bV,__asyncValues:wV,__makeTemplateObject:SV,__importStar:TV,__importDefault:EV,__classPrivateFieldGet:CV,__classPrivateFieldSet:AV,__classPrivateFieldIn:jV,__addDisposableResource:IV,__disposeResources:kV,__rewriteRelativeImportExtension:PV},BQ=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:IV,get __assign(){return pc},__asyncDelegator:bV,__asyncGenerator:xV,__asyncValues:wV,__await:Iy,__awaiter:Tn,__classPrivateFieldGet:CV,__classPrivateFieldIn:jV,__classPrivateFieldSet:AV,__createBinding:T2,__decorate:cV,__disposeResources:kV,__esDecorate:dV,__exportStar:_V,__extends:lV,__generator:gV,__importDefault:EV,__importStar:TV,__makeTemplateObject:SV,__metadata:mV,__param:uV,__propKey:fV,__read:SP,__rest:Jf,__rewriteRelativeImportExtension:PV,__runInitializers:hV,__setFunctionName:pV,__spread:yV,__spreadArray:TP,__spreadArrays:vV,__values:AT,default:FQ},Symbol.toStringTag,{value:"Module"})),VQ=e=>e?(...t)=>e(...t):(...t)=>fetch(...t);class EP extends Error{constructor(t,i="FunctionsError",l){super(t),this.name=i,this.context=l}}class sz extends EP{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class oz extends EP{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class az extends EP{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var AI;(function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"})(AI||(AI={}));class UQ{constructor(t,{headers:i={},customFetch:l,region:f=AI.Any}={}){this.url=t,this.headers=i,this.region=f,this.fetch=VQ(l)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return Tn(this,arguments,void 0,function*(i,l={}){var f;try{const{headers:_,method:x,body:o,signal:A}=l;let I={},{region:N}=l;N||(N=this.region);const U=new URL(`${this.url}/${i}`);N&&N!=="any"&&(I["x-region"]=N,U.searchParams.set("forceFunctionRegion",N));let $;o&&(_&&!Object.prototype.hasOwnProperty.call(_,"Content-Type")||!_)?typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(I["Content-Type"]="application/octet-stream",$=o):typeof o=="string"?(I["Content-Type"]="text/plain",$=o):typeof FormData<"u"&&o instanceof FormData?$=o:(I["Content-Type"]="application/json",$=JSON.stringify(o)):$=o;const V=yield this.fetch(U.toString(),{method:x||"POST",headers:Object.assign(Object.assign(Object.assign({},I),this.headers),_),body:$,signal:A}).catch(Q=>{throw Q.name==="AbortError"?Q:new sz(Q)}),Y=V.headers.get("x-relay-error");if(Y&&Y==="true")throw new oz(V);if(!V.ok)throw new az(V);let q=((f=V.headers.get("Content-Type"))!==null&&f!==void 0?f:"text/plain").split(";")[0].trim(),Z;return q==="application/json"?Z=yield V.json():q==="application/octet-stream"||q==="application/pdf"?Z=yield V.blob():q==="text/event-stream"?Z=V:q==="multipart/form-data"?Z=yield V.formData():Z=yield V.text(),{data:Z,error:null,response:V}}catch(_){return _ instanceof Error&&_.name==="AbortError"?{data:null,error:new sz(_)}:{data:null,error:_,response:_ instanceof az||_ instanceof oz?_.context:void 0}}})}}var Ya={};const Xy=cW(BQ);var oS={},aS={},lS={},cS={},uS={},dS={},lz;function RV(){if(lz)return dS;lz=1,Object.defineProperty(dS,"__esModule",{value:!0});class e extends Error{constructor(i){super(i.message),this.name="PostgrestError",this.details=i.details,this.hint=i.hint,this.code=i.code}}return dS.default=e,dS}var cz;function MV(){if(cz)return uS;cz=1,Object.defineProperty(uS,"__esModule",{value:!0});const t=Xy.__importDefault(RV());class i{constructor(f){var _,x;this.shouldThrowOnError=!1,this.method=f.method,this.url=f.url,this.headers=new Headers(f.headers),this.schema=f.schema,this.body=f.body,this.shouldThrowOnError=(_=f.shouldThrowOnError)!==null&&_!==void 0?_:!1,this.signal=f.signal,this.isMaybeSingle=(x=f.isMaybeSingle)!==null&&x!==void 0?x:!1,f.fetch?this.fetch=f.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(f,_){return this.headers=new Headers(this.headers),this.headers.set(f,_),this}then(f,_){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const x=this.fetch;let o=x(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async A=>{var I,N,U,$;let V=null,Y=null,q=null,Z=A.status,Q=A.statusText;if(A.ok){if(this.method!=="HEAD"){const le=await A.text();le===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((I=this.headers.get("Accept"))===null||I===void 0)&&I.includes("application/vnd.pgrst.plan+text"))?Y=le:Y=JSON.parse(le))}const K=(N=this.headers.get("Prefer"))===null||N===void 0?void 0:N.match(/count=(exact|planned|estimated)/),ne=(U=A.headers.get("content-range"))===null||U===void 0?void 0:U.split("/");K&&ne&&ne.length>1&&(q=parseInt(ne[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(Y)&&(Y.length>1?(V={code:"PGRST116",details:`Results contain ${Y.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},Y=null,q=null,Z=406,Q="Not Acceptable"):Y.length===1?Y=Y[0]:Y=null)}else{const K=await A.text();try{V=JSON.parse(K),Array.isArray(V)&&A.status===404&&(Y=[],V=null,Z=200,Q="OK")}catch{A.status===404&&K===""?(Z=204,Q="No Content"):V={message:K}}if(V&&this.isMaybeSingle&&(!(($=V==null?void 0:V.details)===null||$===void 0)&&$.includes("0 rows"))&&(V=null,Z=200,Q="OK"),V&&this.shouldThrowOnError)throw new t.default(V)}return{error:V,data:Y,count:q,status:Z,statusText:Q}});return this.shouldThrowOnError||(o=o.catch(A=>{var I,N,U;return{error:{message:`${(I=A==null?void 0:A.name)!==null&&I!==void 0?I:"FetchError"}: ${A==null?void 0:A.message}`,details:`${(N=A==null?void 0:A.stack)!==null&&N!==void 0?N:""}`,hint:"",code:`${(U=A==null?void 0:A.code)!==null&&U!==void 0?U:""}`},data:null,count:null,status:0,statusText:""}})),o.then(f,_)}returns(){return this}overrideTypes(){return this}}return uS.default=i,uS}var uz;function NV(){if(uz)return cS;uz=1,Object.defineProperty(cS,"__esModule",{value:!0});const t=Xy.__importDefault(MV());class i extends t.default{select(f){let _=!1;const x=(f??"*").split("").map(o=>/\s/.test(o)&&!_?"":(o==='"'&&(_=!_),o)).join("");return this.url.searchParams.set("select",x),this.headers.append("Prefer","return=representation"),this}order(f,{ascending:_=!0,nullsFirst:x,foreignTable:o,referencedTable:A=o}={}){const I=A?`${A}.order`:"order",N=this.url.searchParams.get(I);return this.url.searchParams.set(I,`${N?`${N},`:""}${f}.${_?"asc":"desc"}${x===void 0?"":x?".nullsfirst":".nullslast"}`),this}limit(f,{foreignTable:_,referencedTable:x=_}={}){const o=typeof x>"u"?"limit":`${x}.limit`;return this.url.searchParams.set(o,`${f}`),this}range(f,_,{foreignTable:x,referencedTable:o=x}={}){const A=typeof o>"u"?"offset":`${o}.offset`,I=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(A,`${f}`),this.url.searchParams.set(I,`${_-f+1}`),this}abortSignal(f){return this.signal=f,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:f=!1,verbose:_=!1,settings:x=!1,buffers:o=!1,wal:A=!1,format:I="text"}={}){var N;const U=[f?"analyze":null,_?"verbose":null,x?"settings":null,o?"buffers":null,A?"wal":null].filter(Boolean).join("|"),$=(N=this.headers.get("Accept"))!==null&&N!==void 0?N:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${I}; for="${$}"; options=${U};`),I==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(f){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${f}`),this}}return cS.default=i,cS}var dz;function CP(){if(dz)return lS;dz=1,Object.defineProperty(lS,"__esModule",{value:!0});const t=Xy.__importDefault(NV()),i=new RegExp("[,()]");class l extends t.default{eq(_,x){return this.url.searchParams.append(_,`eq.${x}`),this}neq(_,x){return this.url.searchParams.append(_,`neq.${x}`),this}gt(_,x){return this.url.searchParams.append(_,`gt.${x}`),this}gte(_,x){return this.url.searchParams.append(_,`gte.${x}`),this}lt(_,x){return this.url.searchParams.append(_,`lt.${x}`),this}lte(_,x){return this.url.searchParams.append(_,`lte.${x}`),this}like(_,x){return this.url.searchParams.append(_,`like.${x}`),this}likeAllOf(_,x){return this.url.searchParams.append(_,`like(all).{${x.join(",")}}`),this}likeAnyOf(_,x){return this.url.searchParams.append(_,`like(any).{${x.join(",")}}`),this}ilike(_,x){return this.url.searchParams.append(_,`ilike.${x}`),this}ilikeAllOf(_,x){return this.url.searchParams.append(_,`ilike(all).{${x.join(",")}}`),this}ilikeAnyOf(_,x){return this.url.searchParams.append(_,`ilike(any).{${x.join(",")}}`),this}is(_,x){return this.url.searchParams.append(_,`is.${x}`),this}in(_,x){const o=Array.from(new Set(x)).map(A=>typeof A=="string"&&i.test(A)?`"${A}"`:`${A}`).join(",");return this.url.searchParams.append(_,`in.(${o})`),this}contains(_,x){return typeof x=="string"?this.url.searchParams.append(_,`cs.${x}`):Array.isArray(x)?this.url.searchParams.append(_,`cs.{${x.join(",")}}`):this.url.searchParams.append(_,`cs.${JSON.stringify(x)}`),this}containedBy(_,x){return typeof x=="string"?this.url.searchParams.append(_,`cd.${x}`):Array.isArray(x)?this.url.searchParams.append(_,`cd.{${x.join(",")}}`):this.url.searchParams.append(_,`cd.${JSON.stringify(x)}`),this}rangeGt(_,x){return this.url.searchParams.append(_,`sr.${x}`),this}rangeGte(_,x){return this.url.searchParams.append(_,`nxl.${x}`),this}rangeLt(_,x){return this.url.searchParams.append(_,`sl.${x}`),this}rangeLte(_,x){return this.url.searchParams.append(_,`nxr.${x}`),this}rangeAdjacent(_,x){return this.url.searchParams.append(_,`adj.${x}`),this}overlaps(_,x){return typeof x=="string"?this.url.searchParams.append(_,`ov.${x}`):this.url.searchParams.append(_,`ov.{${x.join(",")}}`),this}textSearch(_,x,{config:o,type:A}={}){let I="";A==="plain"?I="pl":A==="phrase"?I="ph":A==="websearch"&&(I="w");const N=o===void 0?"":`(${o})`;return this.url.searchParams.append(_,`${I}fts${N}.${x}`),this}match(_){return Object.entries(_).forEach(([x,o])=>{this.url.searchParams.append(x,`eq.${o}`)}),this}not(_,x,o){return this.url.searchParams.append(_,`not.${x}.${o}`),this}or(_,{foreignTable:x,referencedTable:o=x}={}){const A=o?`${o}.or`:"or";return this.url.searchParams.append(A,`(${_})`),this}filter(_,x,o){return this.url.searchParams.append(_,`${x}.${o}`),this}}return lS.default=l,lS}var hz;function DV(){if(hz)return aS;hz=1,Object.defineProperty(aS,"__esModule",{value:!0});const t=Xy.__importDefault(CP());class i{constructor(f,{headers:_={},schema:x,fetch:o}){this.url=f,this.headers=new Headers(_),this.schema=x,this.fetch=o}select(f,_){const{head:x=!1,count:o}=_??{},A=x?"HEAD":"GET";let I=!1;const N=(f??"*").split("").map(U=>/\s/.test(U)&&!I?"":(U==='"'&&(I=!I),U)).join("");return this.url.searchParams.set("select",N),o&&this.headers.append("Prefer",`count=${o}`),new t.default({method:A,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(f,{count:_,defaultToNull:x=!0}={}){var o;const A="POST";if(_&&this.headers.append("Prefer",`count=${_}`),x||this.headers.append("Prefer","missing=default"),Array.isArray(f)){const I=f.reduce((N,U)=>N.concat(Object.keys(U)),[]);if(I.length>0){const N=[...new Set(I)].map(U=>`"${U}"`);this.url.searchParams.set("columns",N.join(","))}}return new t.default({method:A,url:this.url,headers:this.headers,schema:this.schema,body:f,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}upsert(f,{onConflict:_,ignoreDuplicates:x=!1,count:o,defaultToNull:A=!0}={}){var I;const N="POST";if(this.headers.append("Prefer",`resolution=${x?"ignore":"merge"}-duplicates`),_!==void 0&&this.url.searchParams.set("on_conflict",_),o&&this.headers.append("Prefer",`count=${o}`),A||this.headers.append("Prefer","missing=default"),Array.isArray(f)){const U=f.reduce(($,V)=>$.concat(Object.keys(V)),[]);if(U.length>0){const $=[...new Set(U)].map(V=>`"${V}"`);this.url.searchParams.set("columns",$.join(","))}}return new t.default({method:N,url:this.url,headers:this.headers,schema:this.schema,body:f,fetch:(I=this.fetch)!==null&&I!==void 0?I:fetch})}update(f,{count:_}={}){var x;const o="PATCH";return _&&this.headers.append("Prefer",`count=${_}`),new t.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:f,fetch:(x=this.fetch)!==null&&x!==void 0?x:fetch})}delete({count:f}={}){var _;const x="DELETE";return f&&this.headers.append("Prefer",`count=${f}`),new t.default({method:x,url:this.url,headers:this.headers,schema:this.schema,fetch:(_=this.fetch)!==null&&_!==void 0?_:fetch})}}return aS.default=i,aS}var fz;function $Q(){if(fz)return oS;fz=1,Object.defineProperty(oS,"__esModule",{value:!0});const e=Xy,t=e.__importDefault(DV()),i=e.__importDefault(CP());class l{constructor(_,{headers:x={},schema:o,fetch:A}={}){this.url=_,this.headers=new Headers(x),this.schemaName=o,this.fetch=A}from(_){const x=new URL(`${this.url}/${_}`);return new t.default(x,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(_){return new l(this.url,{headers:this.headers,schema:_,fetch:this.fetch})}rpc(_,x={},{head:o=!1,get:A=!1,count:I}={}){var N;let U;const $=new URL(`${this.url}/rpc/${_}`);let V;o||A?(U=o?"HEAD":"GET",Object.entries(x).filter(([q,Z])=>Z!==void 0).map(([q,Z])=>[q,Array.isArray(Z)?`{${Z.join(",")}}`:`${Z}`]).forEach(([q,Z])=>{$.searchParams.append(q,Z)})):(U="POST",V=x);const Y=new Headers(this.headers);return I&&Y.set("Prefer",`count=${I}`),new i.default({method:U,url:$,headers:Y,schema:this.schemaName,body:V,fetch:(N=this.fetch)!==null&&N!==void 0?N:fetch})}}return oS.default=l,oS}Object.defineProperty(Ya,"__esModule",{value:!0});var OV=Ya.PostgrestError=HV=Ya.PostgrestBuilder=qV=Ya.PostgrestTransformBuilder=UV=Ya.PostgrestFilterBuilder=BV=Ya.PostgrestQueryBuilder=zV=Ya.PostgrestClient=void 0;const Ky=Xy,LV=Ky.__importDefault($Q());var zV=Ya.PostgrestClient=LV.default;const FV=Ky.__importDefault(DV());var BV=Ya.PostgrestQueryBuilder=FV.default;const VV=Ky.__importDefault(CP());var UV=Ya.PostgrestFilterBuilder=VV.default;const $V=Ky.__importDefault(NV());var qV=Ya.PostgrestTransformBuilder=$V.default;const GV=Ky.__importDefault(MV());var HV=Ya.PostgrestBuilder=GV.default;const WV=Ky.__importDefault(RV());OV=Ya.PostgrestError=WV.default;var ZV=Ya.default={PostgrestClient:LV.default,PostgrestQueryBuilder:FV.default,PostgrestFilterBuilder:VV.default,PostgrestTransformBuilder:$V.default,PostgrestBuilder:GV.default,PostgrestError:WV.default};const qQ=WF({__proto__:null,get PostgrestBuilder(){return HV},get PostgrestClient(){return zV},get PostgrestError(){return OV},get PostgrestFilterBuilder(){return UV},get PostgrestQueryBuilder(){return BV},get PostgrestTransformBuilder(){return qV},default:ZV},[Ya]),{PostgrestClient:GQ,PostgrestQueryBuilder:bde,PostgrestFilterBuilder:wde,PostgrestTransformBuilder:Sde,PostgrestBuilder:Tde,PostgrestError:Ede}=ZV||qQ;class HQ{static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const i=process.versions;if(i&&i.node){const l=i.node,f=parseInt(l.replace(/^v/,"").split(".")[0]);return f>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${f} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${f} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let i=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(i+=`

Suggested solution: ${t.workaround}`),new Error(i)}static createWebSocket(t,i){const l=this.getWebSocketConstructor();return new l(t,i)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const WQ="2.80.0",ZQ=`realtime-js/${WQ}`,XQ="1.0.0",jI=1e4,KQ=1e3,YQ=100;var D0;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(D0||(D0={}));var qo;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(qo||(qo={}));var ru;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"})(ru||(ru={}));var II;(function(e){e.websocket="websocket"})(II||(II={}));var lm;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"})(lm||(lm={}));class JQ{constructor(){this.HEADER_LENGTH=1}decode(t,i){return t.constructor===ArrayBuffer?i(this._binaryDecode(t)):i(typeof t=="string"?JSON.parse(t):{})}_binaryDecode(t){const i=new DataView(t),l=new TextDecoder;return this._decodeBroadcast(t,i,l)}_decodeBroadcast(t,i,l){const f=i.getUint8(1),_=i.getUint8(2);let x=this.HEADER_LENGTH+2;const o=l.decode(t.slice(x,x+f));x=x+f;const A=l.decode(t.slice(x,x+_));x=x+_;const I=JSON.parse(l.decode(t.slice(x,t.byteLength)));return{ref:null,topic:o,event:A,payload:I}}}class XV{constructor(t,i){this.callback=t,this.timerCalc=i,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=i}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Fs;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(Fs||(Fs={}));const pz=(e,t,i={})=>{var l;const f=(l=i.skipTypes)!==null&&l!==void 0?l:[];return t?Object.keys(t).reduce((_,x)=>(_[x]=QQ(x,e,t,f),_),{}):{}},QQ=(e,t,i,l)=>{const f=t.find(o=>o.name===e),_=f==null?void 0:f.type,x=i[e];return _&&!l.includes(_)?KV(_,x):kI(x)},KV=(e,t)=>{if(e.charAt(0)==="_"){const i=e.slice(1,e.length);return nee(t,i)}switch(e){case Fs.bool:return eee(t);case Fs.float4:case Fs.float8:case Fs.int2:case Fs.int4:case Fs.int8:case Fs.numeric:case Fs.oid:return tee(t);case Fs.json:case Fs.jsonb:return ree(t);case Fs.timestamp:return iee(t);case Fs.abstime:case Fs.date:case Fs.daterange:case Fs.int4range:case Fs.int8range:case Fs.money:case Fs.reltime:case Fs.text:case Fs.time:case Fs.timestamptz:case Fs.timetz:case Fs.tsrange:case Fs.tstzrange:return kI(t);default:return kI(t)}},kI=e=>e,eee=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},tee=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},ree=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},nee=(e,t)=>{if(typeof e!="string")return e;const i=e.length-1,l=e[i];if(e[0]==="{"&&l==="}"){let _;const x=e.slice(1,i);try{_=JSON.parse("["+x+"]")}catch{_=x?x.split(","):[]}return _.map(o=>KV(t,o))}return e},iee=e=>typeof e=="string"?e.replace(" ","T"):e,YV=e=>{const t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class EA{constructor(t,i,l={},f=jI){this.channel=t,this.event=i,this.payload=l,this.timeout=f,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,i){var l;return this._hasReceived(t)&&i((l=this.receivedResp)===null||l===void 0?void 0:l.response),this.recHooks.push({status:t,callback:i}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=i=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=i,this._matchReceive(i)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,i){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:i})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:i}){this.recHooks.filter(l=>l.status===t).forEach(l=>l.callback(i))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var mz;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"})(mz||(mz={}));class O0{constructor(t,i){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const l=(i==null?void 0:i.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(l.state,{},f=>{const{onJoin:_,onLeave:x,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=O0.syncState(this.state,f,_,x),this.pendingDiffs.forEach(A=>{this.state=O0.syncDiff(this.state,A,_,x)}),this.pendingDiffs=[],o()}),this.channel._on(l.diff,{},f=>{const{onJoin:_,onLeave:x,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(f):(this.state=O0.syncDiff(this.state,f,_,x),o())}),this.onJoin((f,_,x)=>{this.channel._trigger("presence",{event:"join",key:f,currentPresences:_,newPresences:x})}),this.onLeave((f,_,x)=>{this.channel._trigger("presence",{event:"leave",key:f,currentPresences:_,leftPresences:x})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,i,l,f){const _=this.cloneDeep(t),x=this.transformState(i),o={},A={};return this.map(_,(I,N)=>{x[I]||(A[I]=N)}),this.map(x,(I,N)=>{const U=_[I];if(U){const $=N.map(Z=>Z.presence_ref),V=U.map(Z=>Z.presence_ref),Y=N.filter(Z=>V.indexOf(Z.presence_ref)<0),q=U.filter(Z=>$.indexOf(Z.presence_ref)<0);Y.length>0&&(o[I]=Y),q.length>0&&(A[I]=q)}else o[I]=N}),this.syncDiff(_,{joins:o,leaves:A},l,f)}static syncDiff(t,i,l,f){const{joins:_,leaves:x}={joins:this.transformState(i.joins),leaves:this.transformState(i.leaves)};return l||(l=()=>{}),f||(f=()=>{}),this.map(_,(o,A)=>{var I;const N=(I=t[o])!==null&&I!==void 0?I:[];if(t[o]=this.cloneDeep(A),N.length>0){const U=t[o].map(V=>V.presence_ref),$=N.filter(V=>U.indexOf(V.presence_ref)<0);t[o].unshift(...$)}l(o,N,A)}),this.map(x,(o,A)=>{let I=t[o];if(!I)return;const N=A.map(U=>U.presence_ref);I=I.filter(U=>N.indexOf(U.presence_ref)<0),t[o]=I,f(o,I,A),I.length===0&&delete t[o]}),t}static map(t,i){return Object.getOwnPropertyNames(t).map(l=>i(l,t[l]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((i,l)=>{const f=t[l];return"metas"in f?i[l]=f.metas.map(_=>(_.presence_ref=_.phx_ref,delete _.phx_ref,delete _.phx_ref_prev,_)):i[l]=f,i},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var gz;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(gz||(gz={}));var L0;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"})(L0||(L0={}));var Nd;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"})(Nd||(Nd={}));class AP{constructor(t,i={config:{}},l){var f,_;if(this.topic=t,this.params=i,this.socket=l,this.bindings={},this.state=qo.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},i.config),this.timeout=this.socket.timeout,this.joinPush=new EA(this,ru.join,this.params,this.timeout),this.rejoinTimer=new XV(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=qo.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(x=>x.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=qo.closed,this.socket._remove(this)}),this._onError(x=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,x),this.state=qo.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=qo.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",x=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,x),this.state=qo.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ru.reply,{},(x,o)=>{this._trigger(this._replyEventName(o),x)}),this.presence=new O0(this),this.broadcastEndpointURL=YV(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((_=(f=this.params.config)===null||f===void 0?void 0:f.broadcast)===null||_===void 0)&&_.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,i=this.timeout){var l,f,_;if(this.socket.isConnected()||this.socket.connect(),this.state==qo.closed){const{config:{broadcast:x,presence:o,private:A}}=this.params,I=(f=(l=this.bindings.postgres_changes)===null||l===void 0?void 0:l.map(V=>V.filter))!==null&&f!==void 0?f:[],N=!!this.bindings[L0.PRESENCE]&&this.bindings[L0.PRESENCE].length>0||((_=this.params.config.presence)===null||_===void 0?void 0:_.enabled)===!0,U={},$={broadcast:x,presence:Object.assign(Object.assign({},o),{enabled:N}),postgres_changes:I,private:A};this.socket.accessTokenValue&&(U.access_token=this.socket.accessTokenValue),this._onError(V=>t==null?void 0:t(Nd.CHANNEL_ERROR,V)),this._onClose(()=>t==null?void 0:t(Nd.CLOSED)),this.updateJoinPayload(Object.assign({config:$},U)),this.joinedOnce=!0,this._rejoin(i),this.joinPush.receive("ok",async({postgres_changes:V})=>{var Y;if(this.socket.setAuth(),V===void 0){t==null||t(Nd.SUBSCRIBED);return}else{const q=this.bindings.postgres_changes,Z=(Y=q==null?void 0:q.length)!==null&&Y!==void 0?Y:0,Q=[];for(let H=0;H<Z;H++){const K=q[H],{filter:{event:ne,schema:le,table:pe,filter:Ae}}=K,Ze=V&&V[H];if(Ze&&Ze.event===ne&&Ze.schema===le&&Ze.table===pe&&Ze.filter===Ae)Q.push(Object.assign(Object.assign({},K),{id:Ze.id}));else{this.unsubscribe(),this.state=qo.errored,t==null||t(Nd.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=Q,t&&t(Nd.SUBSCRIBED);return}}).receive("error",V=>{this.state=qo.errored,t==null||t(Nd.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(V).join(", ")||"error")))}).receive("timeout",()=>{t==null||t(Nd.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,i={}){return await this.send({type:"presence",event:"track",payload:t},i.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,i,l){return this.state===qo.joined&&t===L0.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(t,i,l)}async httpSend(t,i,l={}){var f;const _=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(i==null)return Promise.reject("Payload is required for httpSend()");const x={method:"POST",headers:{Authorization:_,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:i,private:this.private}]})},o=await this._fetchWithTimeout(this.broadcastEndpointURL,x,(f=l.timeout)!==null&&f!==void 0?f:this.timeout);if(o.status===202)return{success:!0};let A=o.statusText;try{const I=await o.json();A=I.error||I.message||A}catch{}return Promise.reject(new Error(A))}async send(t,i={}){var l,f;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:_,payload:x}=t,A={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:_,payload:x,private:this.private}]})};try{const I=await this._fetchWithTimeout(this.broadcastEndpointURL,A,(l=i.timeout)!==null&&l!==void 0?l:this.timeout);return await((f=I.body)===null||f===void 0?void 0:f.cancel()),I.ok?"ok":"error"}catch(I){return I.name==="AbortError"?"timed out":"error"}}else return new Promise(_=>{var x,o,A;const I=this._push(t.type,t,i.timeout||this.timeout);t.type==="broadcast"&&!(!((A=(o=(x=this.params)===null||x===void 0?void 0:x.config)===null||o===void 0?void 0:o.broadcast)===null||A===void 0)&&A.ack)&&_("ok"),I.receive("ok",()=>_("ok")),I.receive("error",()=>_("error")),I.receive("timeout",()=>_("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=qo.leaving;const i=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ru.close,"leave",this._joinRef())};this.joinPush.destroy();let l=null;return new Promise(f=>{l=new EA(this,ru.leave,{},t),l.receive("ok",()=>{i(),f("ok")}).receive("timeout",()=>{i(),f("timed out")}).receive("error",()=>{f("error")}),l.send(),this._canPush()||l.trigger("ok",{})}).finally(()=>{l==null||l.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=qo.closed,this.bindings={}}async _fetchWithTimeout(t,i,l){const f=new AbortController,_=setTimeout(()=>f.abort(),l),x=await this.socket.fetch(t,Object.assign(Object.assign({},i),{signal:f.signal}));return clearTimeout(_),x}_push(t,i,l=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let f=new EA(this,t,i,l);return this._canPush()?f.send():this._addToPushBuffer(f),f}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>YQ){const i=this.pushBuffer.shift();i&&(i.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${i.event}`,i.payload))}}_onMessage(t,i,l){return i}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,i,l){var f,_;const x=t.toLocaleLowerCase(),{close:o,error:A,leave:I,join:N}=ru;if(l&&[o,A,I,N].indexOf(x)>=0&&l!==this._joinRef())return;let $=this._onMessage(x,i,l);if(i&&!$)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(x)?(f=this.bindings.postgres_changes)===null||f===void 0||f.filter(V=>{var Y,q,Z;return((Y=V.filter)===null||Y===void 0?void 0:Y.event)==="*"||((Z=(q=V.filter)===null||q===void 0?void 0:q.event)===null||Z===void 0?void 0:Z.toLocaleLowerCase())===x}).map(V=>V.callback($,l)):(_=this.bindings[x])===null||_===void 0||_.filter(V=>{var Y,q,Z,Q,H,K;if(["broadcast","presence","postgres_changes"].includes(x))if("id"in V){const ne=V.id,le=(Y=V.filter)===null||Y===void 0?void 0:Y.event;return ne&&((q=i.ids)===null||q===void 0?void 0:q.includes(ne))&&(le==="*"||(le==null?void 0:le.toLocaleLowerCase())===((Z=i.data)===null||Z===void 0?void 0:Z.type.toLocaleLowerCase()))}else{const ne=(H=(Q=V==null?void 0:V.filter)===null||Q===void 0?void 0:Q.event)===null||H===void 0?void 0:H.toLocaleLowerCase();return ne==="*"||ne===((K=i==null?void 0:i.event)===null||K===void 0?void 0:K.toLocaleLowerCase())}else return V.type.toLocaleLowerCase()===x}).map(V=>{if(typeof $=="object"&&"ids"in $){const Y=$.data,{schema:q,table:Z,commit_timestamp:Q,type:H,errors:K}=Y;$=Object.assign(Object.assign({},{schema:q,table:Z,commit_timestamp:Q,eventType:H,new:{},old:{},errors:K}),this._getPayloadRecords(Y))}V.callback($,l)})}_isClosed(){return this.state===qo.closed}_isJoined(){return this.state===qo.joined}_isJoining(){return this.state===qo.joining}_isLeaving(){return this.state===qo.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,i,l){const f=t.toLocaleLowerCase(),_={type:f,filter:i,callback:l};return this.bindings[f]?this.bindings[f].push(_):this.bindings[f]=[_],this}_off(t,i){const l=t.toLocaleLowerCase();return this.bindings[l]&&(this.bindings[l]=this.bindings[l].filter(f=>{var _;return!(((_=f.type)===null||_===void 0?void 0:_.toLocaleLowerCase())===l&&AP.isEqual(f.filter,i))})),this}static isEqual(t,i){if(Object.keys(t).length!==Object.keys(i).length)return!1;for(const l in t)if(t[l]!==i[l])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(ru.close,{},t)}_onError(t){this._on(ru.error,{},i=>t(i))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=qo.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const i={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(i.new=pz(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(i.old=pz(t.columns,t.old_record)),i}}const CA=()=>{},hS={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},see=[1e3,2e3,5e3,1e4],oee=1e4,aee=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class lee{constructor(t,i){var l;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=jI,this.transport=null,this.heartbeatIntervalMs=hS.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=CA,this.ref=0,this.reconnectTimer=null,this.logger=CA,this.conn=null,this.sendBuffer=[],this.serializer=new JQ,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=f=>f?(..._)=>f(..._):(..._)=>fetch(..._),!(!((l=i==null?void 0:i.params)===null||l===void 0)&&l.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=i.params.apikey,this.endPoint=`${t}/${II.websocket}`,this.httpEndpoint=YV(t),this._initializeOptions(i),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(i==null?void 0:i.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=HQ.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const i=t.message;throw i.includes("Node.js")?new Error(`${i}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${i}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:XQ}))}disconnect(t,i){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const l=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(l),this._setConnectionState("disconnected")},t?this.conn.close(t,i??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const i=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),i}async removeAllChannels(){const t=await Promise.all(this.channels.map(i=>i.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,i,l){this.logger(t,i,l)}connectionState(){switch(this.conn&&this.conn.readyState){case D0.connecting:return lm.Connecting;case D0.open:return lm.Open;case D0.closing:return lm.Closing;default:return lm.Closed}}isConnected(){return this.connectionState()===lm.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,i={config:{}}){const l=`realtime:${t}`,f=this.getChannels().find(_=>_.topic===l);if(f)return f;{const _=new AP(`realtime:${t}`,i,this);return this.channels.push(_),_}}push(t){const{topic:i,event:l,payload:f,ref:_}=t,x=()=>{this.encode(t,o=>{var A;(A=this.conn)===null||A===void 0||A.send(o)})};this.log("push",`${i} ${l} (${_})`,f),this.isConnected()?x():this.sendBuffer.push(x)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(i){this.log("error","error in heartbeat callback",i)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(i){this.log("error","error in heartbeat callback",i)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(KQ,"heartbeat timeout"),setTimeout(()=>{var i;this.isConnected()||(i=this.reconnectTimer)===null||i===void 0||i.scheduleTimeout()},hS.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(i){this.log("error","error in heartbeat callback",i)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let i=this.channels.find(l=>l.topic===t&&(l._isJoined()||l._isJoining()));i&&(this.log("transport",`leaving duplicate topic "${t}"`),i.unsubscribe())}_remove(t){this.channels=this.channels.filter(i=>i.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,i=>{if(i.topic==="phoenix"&&i.event==="phx_reply")try{this.heartbeatCallback(i.payload.status==="ok"?"ok":"error")}catch(I){this.log("error","error in heartbeat callback",I)}i.ref&&i.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:l,event:f,payload:_,ref:x}=i,o=x?`(${x})`:"",A=_.status||"";this.log("receive",`${A} ${l} ${f} ${o}`.trim(),_),this.channels.filter(I=>I._isMember(l)).forEach(I=>I._trigger(f,_,x)),this._triggerStateCallbacks("message",i)})}_clearTimer(t){var i;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((i=this.reconnectTimer)===null||i===void 0||i.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=i=>{this.log("worker","worker error",i.message),this.workerRef.terminate()},this.workerRef.onmessage=i=>{i.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(t){var i;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(i=this.reconnectTimer)===null||i===void 0||i.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(ru.error))}_appendParams(t,i){if(Object.keys(i).length===0)return t;const l=t.match(/\?/)?"&":"?",f=new URLSearchParams(i);return`${t}${l}${f}`}_workerObjectUrl(t){let i;if(t)i=t;else{const l=new Blob([aee],{type:"application/javascript"});i=URL.createObjectURL(l)}return i}_setConnectionState(t,i=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=i)}async _performAuth(t=null){let i;t?i=t:this.accessToken?i=await this.accessToken():i=this.accessTokenValue,this.accessTokenValue!=i&&(this.accessTokenValue=i,this.channels.forEach(l=>{const f={access_token:i,version:ZQ};i&&l.updateJoinPayload(f),l.joinedOnce&&l._isJoined()&&l._push(ru.access_token,{access_token:i})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this.setAuth().catch(i=>{this.log("error",`error setting auth in ${t}`,i)})}_triggerStateCallbacks(t,i){try{this.stateChangeCallbacks[t].forEach(l=>{try{l(i)}catch(f){this.log("error",`error in ${t} callback`,f)}})}catch(l){this.log("error",`error triggering ${t} callbacks`,l)}}_setupReconnectionTimer(){this.reconnectTimer=new XV(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},hS.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var i,l,f,_,x,o,A,I,N;if(this.transport=(i=t==null?void 0:t.transport)!==null&&i!==void 0?i:null,this.timeout=(l=t==null?void 0:t.timeout)!==null&&l!==void 0?l:jI,this.heartbeatIntervalMs=(f=t==null?void 0:t.heartbeatIntervalMs)!==null&&f!==void 0?f:hS.HEARTBEAT_INTERVAL,this.worker=(_=t==null?void 0:t.worker)!==null&&_!==void 0?_:!1,this.accessToken=(x=t==null?void 0:t.accessToken)!==null&&x!==void 0?x:null,this.heartbeatCallback=(o=t==null?void 0:t.heartbeatCallback)!==null&&o!==void 0?o:CA,t!=null&&t.params&&(this.params=t.params),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(A=t==null?void 0:t.reconnectAfterMs)!==null&&A!==void 0?A:U=>see[U-1]||oee,this.encode=(I=t==null?void 0:t.encode)!==null&&I!==void 0?I:(U,$)=>$(JSON.stringify(U)),this.decode=(N=t==null?void 0:t.decode)!==null&&N!==void 0?N:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t==null?void 0:t.workerUrl}}}class jP extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function oo(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}class cee extends jP{constructor(t,i,l){super(t),this.name="StorageApiError",this.status=i,this.statusCode=l}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class PI extends jP{constructor(t,i){super(t),this.name="StorageUnknownError",this.originalError=i}}const IP=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),uee=()=>Response,RI=e=>{if(Array.isArray(e))return e.map(i=>RI(i));if(typeof e=="function"||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([i,l])=>{const f=i.replace(/([-_][a-z])/gi,_=>_.toUpperCase().replace(/[-_]/g,""));t[f]=RI(l)}),t},dee=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},AA=e=>{var t;return e.msg||e.message||e.error_description||(typeof e.error=="string"?e.error:(t=e.error)===null||t===void 0?void 0:t.message)||JSON.stringify(e)},hee=(e,t,i)=>Tn(void 0,void 0,void 0,function*(){const l=yield uee();e instanceof l&&!(i!=null&&i.noResolveJson)?e.json().then(f=>{const _=e.status||500,x=(f==null?void 0:f.statusCode)||_+"";t(new cee(AA(f),_,x))}).catch(f=>{t(new PI(AA(f),f))}):t(new PI(AA(e),e))}),fee=(e,t,i,l)=>{const f={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"||!l?f:(dee(l)?(f.headers=Object.assign({"Content-Type":"application/json"},t==null?void 0:t.headers),f.body=JSON.stringify(l)):f.body=l,t!=null&&t.duplex&&(f.duplex=t.duplex),Object.assign(Object.assign({},f),i))};function Pb(e,t,i,l,f,_){return Tn(this,void 0,void 0,function*(){return new Promise((x,o)=>{e(i,fee(t,l,f,_)).then(A=>{if(!A.ok)throw A;return l!=null&&l.noResolveJson?A:A.json()}).then(A=>x(A)).catch(A=>hee(A,o,l))})})}function hb(e,t,i,l){return Tn(this,void 0,void 0,function*(){return Pb(e,"GET",t,i,l)})}function Jc(e,t,i,l,f){return Tn(this,void 0,void 0,function*(){return Pb(e,"POST",t,l,f,i)})}function MI(e,t,i,l,f){return Tn(this,void 0,void 0,function*(){return Pb(e,"PUT",t,l,f,i)})}function pee(e,t,i,l){return Tn(this,void 0,void 0,function*(){return Pb(e,"HEAD",t,Object.assign(Object.assign({},i),{noResolveJson:!0}),l)})}function kP(e,t,i,l,f){return Tn(this,void 0,void 0,function*(){return Pb(e,"DELETE",t,l,f,i)})}class mee{constructor(t,i){this.downloadFn=t,this.shouldThrowOnError=i}then(t,i){return this.execute().then(t,i)}execute(){return Tn(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(oo(t))return{data:null,error:t};throw t}})}}var JV;class gee{constructor(t,i){this.downloadFn=t,this.shouldThrowOnError=i,this[JV]="BlobDownloadBuilder",this.promise=null}asStream(){return new mee(this.downloadFn,this.shouldThrowOnError)}then(t,i){return this.getPromise().then(t,i)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return Tn(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(oo(t))return{data:null,error:t};throw t}})}}JV=Symbol.toStringTag;const _ee={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},_z={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class yee{constructor(t,i={},l,f){this.shouldThrowOnError=!1,this.url=t,this.headers=i,this.bucketId=l,this.fetch=IP(f)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(t,i,l,f){return Tn(this,void 0,void 0,function*(){try{let _;const x=Object.assign(Object.assign({},_z),f);let o=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(x.upsert)});const A=x.metadata;typeof Blob<"u"&&l instanceof Blob?(_=new FormData,_.append("cacheControl",x.cacheControl),A&&_.append("metadata",this.encodeMetadata(A)),_.append("",l)):typeof FormData<"u"&&l instanceof FormData?(_=l,_.has("cacheControl")||_.append("cacheControl",x.cacheControl),A&&!_.has("metadata")&&_.append("metadata",this.encodeMetadata(A))):(_=l,o["cache-control"]=`max-age=${x.cacheControl}`,o["content-type"]=x.contentType,A&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(A))),(typeof ReadableStream<"u"&&_ instanceof ReadableStream||_&&typeof _=="object"&&"pipe"in _&&typeof _.pipe=="function")&&!x.duplex&&(x.duplex="half")),f!=null&&f.headers&&(o=Object.assign(Object.assign({},o),f.headers));const I=this._removeEmptyFolders(i),N=this._getFinalPath(I),U=yield(t=="PUT"?MI:Jc)(this.fetch,`${this.url}/object/${N}`,_,Object.assign({headers:o},x!=null&&x.duplex?{duplex:x.duplex}:{}));return{data:{path:I,id:U.Id,fullPath:U.Key},error:null}}catch(_){if(this.shouldThrowOnError)throw _;if(oo(_))return{data:null,error:_};throw _}})}upload(t,i,l){return Tn(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,i,l)})}uploadToSignedUrl(t,i,l,f){return Tn(this,void 0,void 0,function*(){const _=this._removeEmptyFolders(t),x=this._getFinalPath(_),o=new URL(this.url+`/object/upload/sign/${x}`);o.searchParams.set("token",i);try{let A;const I=Object.assign({upsert:_z.upsert},f),N=Object.assign(Object.assign({},this.headers),{"x-upsert":String(I.upsert)});typeof Blob<"u"&&l instanceof Blob?(A=new FormData,A.append("cacheControl",I.cacheControl),A.append("",l)):typeof FormData<"u"&&l instanceof FormData?(A=l,A.append("cacheControl",I.cacheControl)):(A=l,N["cache-control"]=`max-age=${I.cacheControl}`,N["content-type"]=I.contentType);const U=yield MI(this.fetch,o.toString(),A,{headers:N});return{data:{path:_,fullPath:U.Key},error:null}}catch(A){if(this.shouldThrowOnError)throw A;if(oo(A))return{data:null,error:A};throw A}})}createSignedUploadUrl(t,i){return Tn(this,void 0,void 0,function*(){try{let l=this._getFinalPath(t);const f=Object.assign({},this.headers);i!=null&&i.upsert&&(f["x-upsert"]="true");const _=yield Jc(this.fetch,`${this.url}/object/upload/sign/${l}`,{},{headers:f}),x=new URL(this.url+_.url),o=x.searchParams.get("token");if(!o)throw new jP("No token returned by API");return{data:{signedUrl:x.toString(),path:t,token:o},error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(oo(l))return{data:null,error:l};throw l}})}update(t,i,l){return Tn(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,i,l)})}move(t,i,l){return Tn(this,void 0,void 0,function*(){try{return{data:yield Jc(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:i,destinationBucket:l==null?void 0:l.destinationBucket},{headers:this.headers}),error:null}}catch(f){if(this.shouldThrowOnError)throw f;if(oo(f))return{data:null,error:f};throw f}})}copy(t,i,l){return Tn(this,void 0,void 0,function*(){try{return{data:{path:(yield Jc(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:i,destinationBucket:l==null?void 0:l.destinationBucket},{headers:this.headers})).Key},error:null}}catch(f){if(this.shouldThrowOnError)throw f;if(oo(f))return{data:null,error:f};throw f}})}createSignedUrl(t,i,l){return Tn(this,void 0,void 0,function*(){try{let f=this._getFinalPath(t),_=yield Jc(this.fetch,`${this.url}/object/sign/${f}`,Object.assign({expiresIn:i},l!=null&&l.transform?{transform:l.transform}:{}),{headers:this.headers});const x=l!=null&&l.download?`&download=${l.download===!0?"":l.download}`:"";return _={signedUrl:encodeURI(`${this.url}${_.signedURL}${x}`)},{data:_,error:null}}catch(f){if(this.shouldThrowOnError)throw f;if(oo(f))return{data:null,error:f};throw f}})}createSignedUrls(t,i,l){return Tn(this,void 0,void 0,function*(){try{const f=yield Jc(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:i,paths:t},{headers:this.headers}),_=l!=null&&l.download?`&download=${l.download===!0?"":l.download}`:"";return{data:f.map(x=>Object.assign(Object.assign({},x),{signedUrl:x.signedURL?encodeURI(`${this.url}${x.signedURL}${_}`):null})),error:null}}catch(f){if(this.shouldThrowOnError)throw f;if(oo(f))return{data:null,error:f};throw f}})}download(t,i){const f=typeof(i==null?void 0:i.transform)<"u"?"render/image/authenticated":"object",_=this.transformOptsToQueryString((i==null?void 0:i.transform)||{}),x=_?`?${_}`:"",o=this._getFinalPath(t),A=()=>hb(this.fetch,`${this.url}/${f}/${o}${x}`,{headers:this.headers,noResolveJson:!0});return new gee(A,this.shouldThrowOnError)}info(t){return Tn(this,void 0,void 0,function*(){const i=this._getFinalPath(t);try{const l=yield hb(this.fetch,`${this.url}/object/info/${i}`,{headers:this.headers});return{data:RI(l),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(oo(l))return{data:null,error:l};throw l}})}exists(t){return Tn(this,void 0,void 0,function*(){const i=this._getFinalPath(t);try{return yield pee(this.fetch,`${this.url}/object/${i}`,{headers:this.headers}),{data:!0,error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(oo(l)&&l instanceof PI){const f=l.originalError;if([400,404].includes(f==null?void 0:f.status))return{data:!1,error:l}}throw l}})}getPublicUrl(t,i){const l=this._getFinalPath(t),f=[],_=i!=null&&i.download?`download=${i.download===!0?"":i.download}`:"";_!==""&&f.push(_);const o=typeof(i==null?void 0:i.transform)<"u"?"render/image":"object",A=this.transformOptsToQueryString((i==null?void 0:i.transform)||{});A!==""&&f.push(A);let I=f.join("&");return I!==""&&(I=`?${I}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${l}${I}`)}}}remove(t){return Tn(this,void 0,void 0,function*(){try{return{data:yield kP(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(oo(i))return{data:null,error:i};throw i}})}list(t,i,l){return Tn(this,void 0,void 0,function*(){try{const f=Object.assign(Object.assign(Object.assign({},_ee),i),{prefix:t||""});return{data:yield Jc(this.fetch,`${this.url}/object/list/${this.bucketId}`,f,{headers:this.headers},l),error:null}}catch(f){if(this.shouldThrowOnError)throw f;if(oo(f))return{data:null,error:f};throw f}})}listV2(t,i){return Tn(this,void 0,void 0,function*(){try{const l=Object.assign({},t);return{data:yield Jc(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,l,{headers:this.headers},i),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(oo(l))return{data:null,error:l};throw l}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const i=[];return t.width&&i.push(`width=${t.width}`),t.height&&i.push(`height=${t.height}`),t.resize&&i.push(`resize=${t.resize}`),t.format&&i.push(`format=${t.format}`),t.quality&&i.push(`quality=${t.quality}`),i.join("&")}}const QV="2.80.0",eU={"X-Client-Info":`storage-js/${QV}`};class vee{constructor(t,i={},l,f){this.shouldThrowOnError=!1;const _=new URL(t);f!=null&&f.useNewHostname&&/supabase\.(co|in|red)$/.test(_.hostname)&&!_.hostname.includes("storage.supabase.")&&(_.hostname=_.hostname.replace("supabase.","storage.supabase.")),this.url=_.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},eU),i),this.fetch=IP(l)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(t){return Tn(this,void 0,void 0,function*(){try{const i=this.listBucketOptionsToQueryString(t);return{data:yield hb(this.fetch,`${this.url}/bucket${i}`,{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(oo(i))return{data:null,error:i};throw i}})}getBucket(t){return Tn(this,void 0,void 0,function*(){try{return{data:yield hb(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(oo(i))return{data:null,error:i};throw i}})}createBucket(t){return Tn(this,arguments,void 0,function*(i,l={public:!1}){try{return{data:yield Jc(this.fetch,`${this.url}/bucket`,{id:i,name:i,type:l.type,public:l.public,file_size_limit:l.fileSizeLimit,allowed_mime_types:l.allowedMimeTypes},{headers:this.headers}),error:null}}catch(f){if(this.shouldThrowOnError)throw f;if(oo(f))return{data:null,error:f};throw f}})}updateBucket(t,i){return Tn(this,void 0,void 0,function*(){try{return{data:yield MI(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:i.public,file_size_limit:i.fileSizeLimit,allowed_mime_types:i.allowedMimeTypes},{headers:this.headers}),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(oo(l))return{data:null,error:l};throw l}})}emptyBucket(t){return Tn(this,void 0,void 0,function*(){try{return{data:yield Jc(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(oo(i))return{data:null,error:i};throw i}})}deleteBucket(t){return Tn(this,void 0,void 0,function*(){try{return{data:yield kP(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(oo(i))return{data:null,error:i};throw i}})}listBucketOptionsToQueryString(t){const i={};return t&&("limit"in t&&(i.limit=String(t.limit)),"offset"in t&&(i.offset=String(t.offset)),t.search&&(i.search=t.search),t.sortColumn&&(i.sortColumn=t.sortColumn),t.sortOrder&&(i.sortOrder=t.sortOrder)),Object.keys(i).length>0?"?"+new URLSearchParams(i).toString():""}}class xee{constructor(t,i={},l){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},eU),i),this.fetch=IP(l)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(t){return Tn(this,void 0,void 0,function*(){try{return{data:yield Jc(this.fetch,`${this.url}/bucket`,{name:t},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(oo(i))return{data:null,error:i};throw i}})}listBuckets(t){return Tn(this,void 0,void 0,function*(){try{const i=new URLSearchParams;(t==null?void 0:t.limit)!==void 0&&i.set("limit",t.limit.toString()),(t==null?void 0:t.offset)!==void 0&&i.set("offset",t.offset.toString()),t!=null&&t.sortColumn&&i.set("sortColumn",t.sortColumn),t!=null&&t.sortOrder&&i.set("sortOrder",t.sortOrder),t!=null&&t.search&&i.set("search",t.search);const l=i.toString(),f=l?`${this.url}/bucket?${l}`:`${this.url}/bucket`;return{data:yield hb(this.fetch,f,{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(oo(i))return{data:null,error:i};throw i}})}deleteBucket(t){return Tn(this,void 0,void 0,function*(){try{return{data:yield kP(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(oo(i))return{data:null,error:i};throw i}})}}const PP={"X-Client-Info":`storage-js/${QV}`,"Content-Type":"application/json"};class tU extends Error{constructor(t){super(t),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function Vl(e){return typeof e=="object"&&e!==null&&"__isStorageVectorsError"in e}class jA extends tU{constructor(t,i,l){super(t),this.name="StorageVectorsApiError",this.status=i,this.statusCode=l}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class bee extends tU{constructor(t,i){super(t),this.name="StorageVectorsUnknownError",this.originalError=i}}var yz;(function(e){e.InternalError="InternalError",e.S3VectorConflictException="S3VectorConflictException",e.S3VectorNotFoundException="S3VectorNotFoundException",e.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",e.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",e.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(yz||(yz={}));const RP=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),wee=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},vz=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),See=(e,t,i)=>Tn(void 0,void 0,void 0,function*(){if(e&&typeof e=="object"&&"status"in e&&"ok"in e&&typeof e.status=="number"&&!(i!=null&&i.noResolveJson)){const f=e.status||500,_=e;if(typeof _.json=="function")_.json().then(x=>{const o=(x==null?void 0:x.statusCode)||(x==null?void 0:x.code)||f+"";t(new jA(vz(x),f,o))}).catch(()=>{const x=f+"",o=_.statusText||`HTTP ${f} error`;t(new jA(o,f,x))});else{const x=f+"",o=_.statusText||`HTTP ${f} error`;t(new jA(o,f,x))}}else t(new bee(vz(e),e))}),Tee=(e,t,i,l)=>{const f={method:e,headers:(t==null?void 0:t.headers)||{}};return l?(wee(l)?(f.headers=Object.assign({"Content-Type":"application/json"},t==null?void 0:t.headers),f.body=JSON.stringify(l)):f.body=l,Object.assign(Object.assign({},f),i)):f};function Eee(e,t,i,l,f,_){return Tn(this,void 0,void 0,function*(){return new Promise((x,o)=>{e(i,Tee(t,l,f,_)).then(A=>{if(!A.ok)throw A;if(l!=null&&l.noResolveJson)return A;const I=A.headers.get("content-type");return!I||!I.includes("application/json")?{}:A.json()}).then(A=>x(A)).catch(A=>See(A,o,l))})})}function Ul(e,t,i,l,f){return Tn(this,void 0,void 0,function*(){return Eee(e,"POST",t,l,f,i)})}class Cee{constructor(t,i={},l){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},PP),i),this.fetch=RP(l)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(t){return Tn(this,void 0,void 0,function*(){try{return{data:(yield Ul(this.fetch,`${this.url}/CreateIndex`,t,{headers:this.headers}))||{},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Vl(i))return{data:null,error:i};throw i}})}getIndex(t,i){return Tn(this,void 0,void 0,function*(){try{return{data:yield Ul(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:t,indexName:i},{headers:this.headers}),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(Vl(l))return{data:null,error:l};throw l}})}listIndexes(t){return Tn(this,void 0,void 0,function*(){try{return{data:yield Ul(this.fetch,`${this.url}/ListIndexes`,t,{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Vl(i))return{data:null,error:i};throw i}})}deleteIndex(t,i){return Tn(this,void 0,void 0,function*(){try{return{data:(yield Ul(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:t,indexName:i},{headers:this.headers}))||{},error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(Vl(l))return{data:null,error:l};throw l}})}}class Aee{constructor(t,i={},l){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},PP),i),this.fetch=RP(l)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(t){return Tn(this,void 0,void 0,function*(){try{if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield Ul(this.fetch,`${this.url}/PutVectors`,t,{headers:this.headers}))||{},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Vl(i))return{data:null,error:i};throw i}})}getVectors(t){return Tn(this,void 0,void 0,function*(){try{return{data:yield Ul(this.fetch,`${this.url}/GetVectors`,t,{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Vl(i))return{data:null,error:i};throw i}})}listVectors(t){return Tn(this,void 0,void 0,function*(){try{if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return{data:yield Ul(this.fetch,`${this.url}/ListVectors`,t,{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Vl(i))return{data:null,error:i};throw i}})}queryVectors(t){return Tn(this,void 0,void 0,function*(){try{return{data:yield Ul(this.fetch,`${this.url}/QueryVectors`,t,{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Vl(i))return{data:null,error:i};throw i}})}deleteVectors(t){return Tn(this,void 0,void 0,function*(){try{if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield Ul(this.fetch,`${this.url}/DeleteVectors`,t,{headers:this.headers}))||{},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Vl(i))return{data:null,error:i};throw i}})}}class jee{constructor(t,i={},l){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},PP),i),this.fetch=RP(l)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(t){return Tn(this,void 0,void 0,function*(){try{return{data:(yield Ul(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:this.headers}))||{},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Vl(i))return{data:null,error:i};throw i}})}getBucket(t){return Tn(this,void 0,void 0,function*(){try{return{data:yield Ul(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:t},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Vl(i))return{data:null,error:i};throw i}})}listBuckets(){return Tn(this,arguments,void 0,function*(t={}){try{return{data:yield Ul(this.fetch,`${this.url}/ListVectorBuckets`,t,{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Vl(i))return{data:null,error:i};throw i}})}deleteBucket(t){return Tn(this,void 0,void 0,function*(){try{return{data:(yield Ul(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:this.headers}))||{},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Vl(i))return{data:null,error:i};throw i}})}}class Iee extends jee{constructor(t,i={}){super(t,i.headers||{},i.fetch)}from(t){return new kee(this.url,this.headers,t,this.fetch)}}class kee extends Cee{constructor(t,i,l,f){super(t,i,f),this.vectorBucketName=l}createIndex(t){const i=Object.create(null,{createIndex:{get:()=>super.createIndex}});return Tn(this,void 0,void 0,function*(){return i.createIndex.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const t=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return Tn(this,arguments,void 0,function*(i={}){return t.listIndexes.call(this,Object.assign(Object.assign({},i),{vectorBucketName:this.vectorBucketName}))})}getIndex(t){const i=Object.create(null,{getIndex:{get:()=>super.getIndex}});return Tn(this,void 0,void 0,function*(){return i.getIndex.call(this,this.vectorBucketName,t)})}deleteIndex(t){const i=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return Tn(this,void 0,void 0,function*(){return i.deleteIndex.call(this,this.vectorBucketName,t)})}index(t){return new Pee(this.url,this.headers,this.vectorBucketName,t,this.fetch)}}class Pee extends Aee{constructor(t,i,l,f,_){super(t,i,_),this.vectorBucketName=l,this.indexName=f}putVectors(t){const i=Object.create(null,{putVectors:{get:()=>super.putVectors}});return Tn(this,void 0,void 0,function*(){return i.putVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(t){const i=Object.create(null,{getVectors:{get:()=>super.getVectors}});return Tn(this,void 0,void 0,function*(){return i.getVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const t=Object.create(null,{listVectors:{get:()=>super.listVectors}});return Tn(this,arguments,void 0,function*(i={}){return t.listVectors.call(this,Object.assign(Object.assign({},i),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(t){const i=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return Tn(this,void 0,void 0,function*(){return i.queryVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(t){const i=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return Tn(this,void 0,void 0,function*(){return i.deleteVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class Ree extends vee{constructor(t,i={},l,f){super(t,i,l,f)}from(t){return new yee(this.url,this.headers,t,this.fetch)}get vectors(){return new Iee(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new xee(this.url+"/iceberg",this.headers,this.fetch)}}const Mee="2.80.0";let b0="";typeof Deno<"u"?b0="deno":typeof document<"u"?b0="web":typeof navigator<"u"&&navigator.product==="ReactNative"?b0="react-native":b0="node";const Nee={"X-Client-Info":`supabase-js-${b0}/${Mee}`},Dee={headers:Nee},Oee={schema:"public"},Lee={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},zee={},Fee=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),Bee=()=>Headers,Vee=(e,t,i)=>{const l=Fee(i),f=Bee();return async(_,x)=>{var o;const A=(o=await t())!==null&&o!==void 0?o:e;let I=new f(x==null?void 0:x.headers);return I.has("apikey")||I.set("apikey",e),I.has("Authorization")||I.set("Authorization",`Bearer ${A}`),l(_,Object.assign(Object.assign({},x),{headers:I}))}};function Uee(e){return e.endsWith("/")?e:e+"/"}function $ee(e,t){var i,l;const{db:f,auth:_,realtime:x,global:o}=e,{db:A,auth:I,realtime:N,global:U}=t,$={db:Object.assign(Object.assign({},A),f),auth:Object.assign(Object.assign({},I),_),realtime:Object.assign(Object.assign({},N),x),storage:{},global:Object.assign(Object.assign(Object.assign({},U),o),{headers:Object.assign(Object.assign({},(i=U==null?void 0:U.headers)!==null&&i!==void 0?i:{}),(l=o==null?void 0:o.headers)!==null&&l!==void 0?l:{})}),accessToken:async()=>""};return e.accessToken?$.accessToken=e.accessToken:delete $.accessToken,$}function qee(e){const t=e==null?void 0:e.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(Uee(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const rU="2.80.0",P_=30*1e3,NI=3,IA=NI*P_,Gee="http://localhost:9999",Hee="supabase.auth.token",Wee={"X-Client-Info":`gotrue-js/${rU}`},DI="X-Supabase-Api-Version",nU={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Zee=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Xee=10*60*1e3;class fb extends Error{constructor(t,i,l){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=i,this.code=l}}function Rn(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class Kee extends fb{constructor(t,i,l){super(t,i,l),this.name="AuthApiError",this.status=i,this.code=l}}function Yee(e){return Rn(e)&&e.name==="AuthApiError"}class cm extends fb{constructor(t,i){super(t),this.name="AuthUnknownError",this.originalError=i}}class Qf extends fb{constructor(t,i,l,f){super(t,l,f),this.name=i,this.status=l}}class Zc extends Qf{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Jee(e){return Rn(e)&&e.name==="AuthSessionMissingError"}class b_ extends Qf{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class fS extends Qf{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class pS extends Qf{constructor(t,i=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=i}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Qee(e){return Rn(e)&&e.name==="AuthImplicitGrantRedirectError"}class xz extends Qf{constructor(t,i=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=i}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class OI extends Qf{constructor(t,i){super(t,"AuthRetryableFetchError",i,void 0)}}function kA(e){return Rn(e)&&e.name==="AuthRetryableFetchError"}class bz extends Qf{constructor(t,i,l){super(t,"AuthWeakPasswordError",i,"weak_password"),this.reasons=l}}class LI extends Qf{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const jT="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),wz=` 	
\r=`.split(""),ete=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<wz.length;t+=1)e[wz[t].charCodeAt(0)]=-2;for(let t=0;t<jT.length;t+=1)e[jT[t].charCodeAt(0)]=t;return e})();function Sz(e,t,i){if(e!==null)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const l=t.queue>>t.queuedBits-6&63;i(jT[l]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const l=t.queue>>t.queuedBits-6&63;i(jT[l]),t.queuedBits-=6}}function iU(e,t,i){const l=ete[e];if(l>-1)for(t.queue=t.queue<<6|l,t.queuedBits+=6;t.queuedBits>=8;)i(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(l===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}}function Tz(e){const t=[],i=x=>{t.push(String.fromCodePoint(x))},l={utf8seq:0,codepoint:0},f={queue:0,queuedBits:0},_=x=>{nte(x,l,i)};for(let x=0;x<e.length;x+=1)iU(e.charCodeAt(x),f,_);return t.join("")}function tte(e,t){if(e<=127){t(e);return}else if(e<=2047){t(192|e>>6),t(128|e&63);return}else if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|e&63);return}else if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|e&63);return}throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}function rte(e,t){for(let i=0;i<e.length;i+=1){let l=e.charCodeAt(i);if(l>55295&&l<=56319){const f=(l-55296)*1024&65535;l=(e.charCodeAt(i+1)-56320&65535|f)+65536,i+=1}tte(l,t)}}function nte(e,t,i){if(t.utf8seq===0){if(e<=127){i(e);return}for(let l=1;l<6;l+=1)if(!(e>>7-l&1)){t.utf8seq=l;break}if(t.utf8seq===2)t.codepoint=e&31;else if(t.utf8seq===3)t.codepoint=e&15;else if(t.utf8seq===4)t.codepoint=e&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|e&63,t.utf8seq-=1,t.utf8seq===0&&i(t.codepoint)}}function ry(e){const t=[],i={queue:0,queuedBits:0},l=f=>{t.push(f)};for(let f=0;f<e.length;f+=1)iU(e.charCodeAt(f),i,l);return new Uint8Array(t)}function ite(e){const t=[];return rte(e,i=>t.push(i)),new Uint8Array(t)}function fm(e){const t=[],i={queue:0,queuedBits:0},l=f=>{t.push(f)};return e.forEach(f=>Sz(f,i,l)),Sz(null,i,l),t.join("")}function ste(e){return Math.round(Date.now()/1e3)+e}function ote(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;return(e=="x"?t:t&3|8).toString(16)})}const wa=()=>typeof window<"u"&&typeof document<"u",tm={tested:!1,writable:!1},sU=()=>{if(!wa())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(tm.tested)return tm.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),tm.tested=!0,tm.writable=!0}catch{tm.tested=!0,tm.writable=!1}return tm.writable};function ate(e){const t={},i=new URL(e);if(i.hash&&i.hash[0]==="#")try{new URLSearchParams(i.hash.substring(1)).forEach((f,_)=>{t[_]=f})}catch{}return i.searchParams.forEach((l,f)=>{t[f]=l}),t}const oU=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),lte=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",R_=async(e,t,i)=>{await e.setItem(t,JSON.stringify(i))},rm=async(e,t)=>{const i=await e.getItem(t);if(!i)return null;try{return JSON.parse(i)}catch{return i}},Jh=async(e,t)=>{await e.removeItem(t)};class E2{constructor(){this.promise=new E2.promiseConstructor((t,i)=>{this.resolve=t,this.reject=i})}}E2.promiseConstructor=Promise;function PA(e){const t=e.split(".");if(t.length!==3)throw new LI("Invalid JWT structure");for(let l=0;l<t.length;l++)if(!Zee.test(t[l]))throw new LI("JWT not in base64url format");return{header:JSON.parse(Tz(t[0])),payload:JSON.parse(Tz(t[1])),signature:ry(t[2]),raw:{header:t[0],payload:t[1]}}}async function cte(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function ute(e,t){return new Promise((l,f)=>{(async()=>{for(let _=0;_<1/0;_++)try{const x=await e(_);if(!t(_,null,x)){l(x);return}}catch(x){if(!t(_,x)){f(x);return}}})()})}function dte(e){return("0"+e.toString(16)).substr(-2)}function hte(){const t=new Uint32Array(56);if(typeof crypto>"u"){const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",l=i.length;let f="";for(let _=0;_<56;_++)f+=i.charAt(Math.floor(Math.random()*l));return f}return crypto.getRandomValues(t),Array.from(t,dte).join("")}async function fte(e){const i=new TextEncoder().encode(e),l=await crypto.subtle.digest("SHA-256",i),f=new Uint8Array(l);return Array.from(f).map(_=>String.fromCharCode(_)).join("")}async function pte(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const i=await fte(e);return btoa(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function w_(e,t,i=!1){const l=hte();let f=l;i&&(f+="/PASSWORD_RECOVERY"),await R_(e,`${t}-code-verifier`,f);const _=await pte(l);return[_,l===_?"plain":"s256"]}const mte=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function gte(e){const t=e.headers.get(DI);if(!t||!t.match(mte))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function _te(e){if(!e)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(e<=t)throw new Error("JWT has expired")}function yte(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const vte=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function S_(e){if(!vte.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function RA(){const e={};return new Proxy(e,{get:(t,i)=>{if(i==="__isUserNotAvailableProxy")return!0;if(typeof i=="symbol"){const l=i.toString();if(l==="Symbol(Symbol.toPrimitive)"||l==="Symbol(Symbol.toStringTag)"||l==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${i}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,i)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${i}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,i)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${i}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function xte(e,t){return new Proxy(e,{get:(i,l,f)=>{if(l==="__isInsecureUserWarningProxy")return!0;if(typeof l=="symbol"){const _=l.toString();if(_==="Symbol(Symbol.toPrimitive)"||_==="Symbol(Symbol.toStringTag)"||_==="Symbol(util.inspect.custom)"||_==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(i,l,f)}return!t.value&&typeof l=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(i,l,f)}})}function Ez(e){return JSON.parse(JSON.stringify(e))}const om=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),bte=[502,503,504];async function Cz(e){var t;if(!lte(e))throw new OI(om(e),0);if(bte.includes(e.status))throw new OI(om(e),e.status);let i;try{i=await e.json()}catch(_){throw new cm(om(_),_)}let l;const f=gte(e);if(f&&f.getTime()>=nU["2024-01-01"].timestamp&&typeof i=="object"&&i&&typeof i.code=="string"?l=i.code:typeof i=="object"&&i&&typeof i.error_code=="string"&&(l=i.error_code),l){if(l==="weak_password")throw new bz(om(i),e.status,((t=i.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(l==="session_not_found")throw new Zc}else if(typeof i=="object"&&i&&typeof i.weak_password=="object"&&i.weak_password&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.reasons.reduce((_,x)=>_&&typeof x=="string",!0))throw new bz(om(i),e.status,i.weak_password.reasons);throw new Kee(om(i),e.status||500,l)}const wte=(e,t,i,l)=>{const f={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"?f:(f.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t==null?void 0:t.headers),f.body=JSON.stringify(l),Object.assign(Object.assign({},f),i))};async function ii(e,t,i,l){var f;const _=Object.assign({},l==null?void 0:l.headers);_[DI]||(_[DI]=nU["2024-01-01"].name),l!=null&&l.jwt&&(_.Authorization=`Bearer ${l.jwt}`);const x=(f=l==null?void 0:l.query)!==null&&f!==void 0?f:{};l!=null&&l.redirectTo&&(x.redirect_to=l.redirectTo);const o=Object.keys(x).length?"?"+new URLSearchParams(x).toString():"",A=await Ste(e,t,i+o,{headers:_,noResolveJson:l==null?void 0:l.noResolveJson},{},l==null?void 0:l.body);return l!=null&&l.xform?l==null?void 0:l.xform(A):{data:Object.assign({},A),error:null}}async function Ste(e,t,i,l,f,_){const x=wte(t,l,f,_);let o;try{o=await e(i,Object.assign({},x))}catch(A){throw console.error(A),new OI(om(A),0)}if(o.ok||await Cz(o),l!=null&&l.noResolveJson)return o;try{return await o.json()}catch(A){await Cz(A)}}function Xc(e){var t;let i=null;Cte(e)&&(i=Object.assign({},e),e.expires_at||(i.expires_at=ste(e.expires_in)));const l=(t=e.user)!==null&&t!==void 0?t:e;return{data:{session:i,user:l},error:null}}function Az(e){const t=Xc(e);return!t.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((i,l)=>i&&typeof l=="string",!0)&&(t.data.weak_password=e.weak_password),t}function lf(e){var t;return{data:{user:(t=e.user)!==null&&t!==void 0?t:e},error:null}}function Tte(e){return{data:e,error:null}}function Ete(e){const{action_link:t,email_otp:i,hashed_token:l,redirect_to:f,verification_type:_}=e,x=Jf(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:t,email_otp:i,hashed_token:l,redirect_to:f,verification_type:_},A=Object.assign({},x);return{data:{properties:o,user:A},error:null}}function jz(e){return e}function Cte(e){return e.access_token&&e.refresh_token&&e.expires_in}const MA=["global","local","others"];class Ate{constructor({url:t="",headers:i={},fetch:l}){this.url=t,this.headers=i,this.fetch=oU(l),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,i=MA[0]){if(MA.indexOf(i)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${MA.join(", ")}`);try{return await ii(this.fetch,"POST",`${this.url}/logout?scope=${i}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(l){if(Rn(l))return{data:null,error:l};throw l}}async inviteUserByEmail(t,i={}){try{return await ii(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:i.data},headers:this.headers,redirectTo:i.redirectTo,xform:lf})}catch(l){if(Rn(l))return{data:{user:null},error:l};throw l}}async generateLink(t){try{const{options:i}=t,l=Jf(t,["options"]),f=Object.assign(Object.assign({},l),i);return"newEmail"in l&&(f.new_email=l==null?void 0:l.newEmail,delete f.newEmail),await ii(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:f,headers:this.headers,xform:Ete,redirectTo:i==null?void 0:i.redirectTo})}catch(i){if(Rn(i))return{data:{properties:null,user:null},error:i};throw i}}async createUser(t){try{return await ii(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:lf})}catch(i){if(Rn(i))return{data:{user:null},error:i};throw i}}async listUsers(t){var i,l,f,_,x,o,A;try{const I={nextPage:null,lastPage:0,total:0},N=await ii(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(l=(i=t==null?void 0:t.page)===null||i===void 0?void 0:i.toString())!==null&&l!==void 0?l:"",per_page:(_=(f=t==null?void 0:t.perPage)===null||f===void 0?void 0:f.toString())!==null&&_!==void 0?_:""},xform:jz});if(N.error)throw N.error;const U=await N.json(),$=(x=N.headers.get("x-total-count"))!==null&&x!==void 0?x:0,V=(A=(o=N.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&A!==void 0?A:[];return V.length>0&&(V.forEach(Y=>{const q=parseInt(Y.split(";")[0].split("=")[1].substring(0,1)),Z=JSON.parse(Y.split(";")[1].split("=")[1]);I[`${Z}Page`]=q}),I.total=parseInt($)),{data:Object.assign(Object.assign({},U),I),error:null}}catch(I){if(Rn(I))return{data:{users:[]},error:I};throw I}}async getUserById(t){S_(t);try{return await ii(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:lf})}catch(i){if(Rn(i))return{data:{user:null},error:i};throw i}}async updateUserById(t,i){S_(t);try{return await ii(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:i,headers:this.headers,xform:lf})}catch(l){if(Rn(l))return{data:{user:null},error:l};throw l}}async deleteUser(t,i=!1){S_(t);try{return await ii(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:i},xform:lf})}catch(l){if(Rn(l))return{data:{user:null},error:l};throw l}}async _listFactors(t){S_(t.userId);try{const{data:i,error:l}=await ii(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:f=>({data:{factors:f},error:null})});return{data:i,error:l}}catch(i){if(Rn(i))return{data:null,error:i};throw i}}async _deleteFactor(t){S_(t.userId),S_(t.id);try{return{data:await ii(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(i){if(Rn(i))return{data:null,error:i};throw i}}async _listOAuthClients(t){var i,l,f,_,x,o,A;try{const I={nextPage:null,lastPage:0,total:0},N=await ii(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(l=(i=t==null?void 0:t.page)===null||i===void 0?void 0:i.toString())!==null&&l!==void 0?l:"",per_page:(_=(f=t==null?void 0:t.perPage)===null||f===void 0?void 0:f.toString())!==null&&_!==void 0?_:""},xform:jz});if(N.error)throw N.error;const U=await N.json(),$=(x=N.headers.get("x-total-count"))!==null&&x!==void 0?x:0,V=(A=(o=N.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&A!==void 0?A:[];return V.length>0&&(V.forEach(Y=>{const q=parseInt(Y.split(";")[0].split("=")[1].substring(0,1)),Z=JSON.parse(Y.split(";")[1].split("=")[1]);I[`${Z}Page`]=q}),I.total=parseInt($)),{data:Object.assign(Object.assign({},U),I),error:null}}catch(I){if(Rn(I))return{data:{clients:[]},error:I};throw I}}async _createOAuthClient(t){try{return await ii(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:i=>({data:i,error:null})})}catch(i){if(Rn(i))return{data:null,error:i};throw i}}async _getOAuthClient(t){try{return await ii(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:i=>({data:i,error:null})})}catch(i){if(Rn(i))return{data:null,error:i};throw i}}async _updateOAuthClient(t,i){try{return await ii(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:i,headers:this.headers,xform:l=>({data:l,error:null})})}catch(l){if(Rn(l))return{data:null,error:l};throw l}}async _deleteOAuthClient(t){try{return await ii(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(i){if(Rn(i))return{data:null,error:i};throw i}}async _regenerateOAuthClientSecret(t){try{return await ii(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:i=>({data:i,error:null})})}catch(i){if(Rn(i))return{data:null,error:i};throw i}}}function Iz(e={}){return{getItem:t=>e[t]||null,setItem:(t,i)=>{e[t]=i},removeItem:t=>{delete e[t]}}}const T_={debug:!!(globalThis&&sU()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class aU extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class jte extends aU{}async function Ite(e,t,i){T_.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const l=new globalThis.AbortController;return t>0&&setTimeout(()=>{l.abort(),T_.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:l.signal},async f=>{if(f){T_.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,f.name);try{return await i()}finally{T_.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,f.name)}}else{if(t===0)throw T_.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new jte(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(T_.debug)try{const _=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(_,null,"  "))}catch(_){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",_)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await i()}}))}function kte(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function lU(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function Pte(e){return parseInt(e,16)}function Rte(e){const t=new TextEncoder().encode(e);return"0x"+Array.from(t,l=>l.toString(16).padStart(2,"0")).join("")}function Mte(e){var t;const{chainId:i,domain:l,expirationTime:f,issuedAt:_=new Date,nonce:x,notBefore:o,requestId:A,resources:I,scheme:N,uri:U,version:$}=e;{if(!Number.isInteger(i))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${i}`);if(!l)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(x&&x.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${x}`);if(!U)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if($!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${$}`);if(!((t=e.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`)}const V=lU(e.address),Y=N?`${N}://${l}`:l,q=e.statement?`${e.statement}
`:"",Z=`${Y} wants you to sign in with your Ethereum account:
${V}

${q}`;let Q=`URI: ${U}
Version: ${$}
Chain ID: ${i}${x?`
Nonce: ${x}`:""}
Issued At: ${_.toISOString()}`;if(f&&(Q+=`
Expiration Time: ${f.toISOString()}`),o&&(Q+=`
Not Before: ${o.toISOString()}`),A&&(Q+=`
Request ID: ${A}`),I){let H=`
Resources:`;for(const K of I){if(!K||typeof K!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${K}`);H+=`
- ${K}`}Q+=H}return`${Z}
${Q}`}class Do extends Error{constructor({message:t,code:i,cause:l,name:f}){var _;super(t,{cause:l}),this.__isWebAuthnError=!0,this.name=(_=f??(l instanceof Error?l.name:void 0))!==null&&_!==void 0?_:"Unknown Error",this.code=i}}class IT extends Do{constructor(t,i){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:i,message:t}),this.name="WebAuthnUnknownError",this.originalError=i}}function Nte({error:e,options:t}){var i,l,f;const{publicKey:_}=t;if(!_)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Do({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(((i=_.authenticatorSelection)===null||i===void 0?void 0:i.requireResidentKey)===!0)return new Do({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(t.mediation==="conditional"&&((l=_.authenticatorSelection)===null||l===void 0?void 0:l.userVerification)==="required")return new Do({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if(((f=_.authenticatorSelection)===null||f===void 0?void 0:f.userVerification)==="required")return new Do({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new Do({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new Do({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return _.pubKeyCredParams.filter(o=>o.type==="public-key").length===0?new Do({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new Do({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const x=window.location.hostname;if(cU(x)){if(_.rp.id!==x)return new Do({message:`The RP ID "${_.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new Do({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(_.user.id.byteLength<1||_.user.id.byteLength>64)return new Do({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new Do({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Do({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function Dte({error:e,options:t}){const{publicKey:i}=t;if(!i)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Do({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if(e.name==="NotAllowedError")return new Do({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){const l=window.location.hostname;if(cU(l)){if(i.rpId!==l)return new Do({message:`The RP ID "${i.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new Do({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new Do({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Do({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}class Ote{createNewAbortSignal(){if(this.controller){const i=new Error("Cancelling existing WebAuthn API call for new one");i.name="AbortError",this.controller.abort(i)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const Lte=new Ote;function zte(e){if(!e)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:i,excludeCredentials:l}=e,f=Jf(e,["challenge","user","excludeCredentials"]),_=ry(t).buffer,x=Object.assign(Object.assign({},i),{id:ry(i.id).buffer}),o=Object.assign(Object.assign({},f),{challenge:_,user:x});if(l&&l.length>0){o.excludeCredentials=new Array(l.length);for(let A=0;A<l.length;A++){const I=l[A];o.excludeCredentials[A]=Object.assign(Object.assign({},I),{id:ry(I.id).buffer,type:I.type||"public-key",transports:I.transports})}}return o}function Fte(e){if(!e)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:i}=e,l=Jf(e,["challenge","allowCredentials"]),f=ry(t).buffer,_=Object.assign(Object.assign({},l),{challenge:f});if(i&&i.length>0){_.allowCredentials=new Array(i.length);for(let x=0;x<i.length;x++){const o=i[x];_.allowCredentials[x]=Object.assign(Object.assign({},o),{id:ry(o.id).buffer,type:o.type||"public-key",transports:o.transports})}}return _}function Bte(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const i=e;return{id:e.id,rawId:e.id,response:{attestationObject:fm(new Uint8Array(e.response.attestationObject)),clientDataJSON:fm(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:(t=i.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function Vte(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const i=e,l=e.getClientExtensionResults(),f=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:fm(new Uint8Array(f.authenticatorData)),clientDataJSON:fm(new Uint8Array(f.clientDataJSON)),signature:fm(new Uint8Array(f.signature)),userHandle:f.userHandle?fm(new Uint8Array(f.userHandle)):void 0},type:"public-key",clientExtensionResults:l,authenticatorAttachment:(t=i.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function cU(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function kz(){var e,t;return!!(wa()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.create)=="function"&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.get)=="function")}async function Ute(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new IT("Browser returned unexpected credential type",t)}:{data:null,error:new IT("Empty credential response",t)}}catch(t){return{data:null,error:Nte({error:t,options:e})}}}async function $te(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new IT("Browser returned unexpected credential type",t)}:{data:null,error:new IT("Empty credential response",t)}}catch(t){return{data:null,error:Dte({error:t,options:e})}}}const qte={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"none"},Gte={userVerification:"preferred",hints:["security-key"]};function kT(...e){const t=f=>f!==null&&typeof f=="object"&&!Array.isArray(f),i=f=>f instanceof ArrayBuffer||ArrayBuffer.isView(f),l={};for(const f of e)if(f)for(const _ in f){const x=f[_];if(x!==void 0)if(Array.isArray(x))l[_]=x;else if(i(x))l[_]=x;else if(t(x)){const o=l[_];t(o)?l[_]=kT(o,x):l[_]=kT(x)}else l[_]=x}return l}function Hte(e,t){return kT(qte,e,t||{})}function Wte(e,t){return kT(Gte,e,t||{})}class Zte{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:i,friendlyName:l,signal:f},_){try{const{data:x,error:o}=await this.client.mfa.challenge({factorId:t,webauthn:i});if(!x)return{data:null,error:o};const A=f??Lte.createNewAbortSignal();if(x.webauthn.type==="create"){const{user:I}=x.webauthn.credential_options.publicKey;I.name||(I.name=`${I.id}:${l}`),I.displayName||(I.displayName=I.name)}switch(x.webauthn.type){case"create":{const I=Hte(x.webauthn.credential_options.publicKey,_==null?void 0:_.create),{data:N,error:U}=await Ute({publicKey:I,signal:A});return N?{data:{factorId:t,challengeId:x.id,webauthn:{type:x.webauthn.type,credential_response:N}},error:null}:{data:null,error:U}}case"request":{const I=Wte(x.webauthn.credential_options.publicKey,_==null?void 0:_.request),{data:N,error:U}=await $te(Object.assign(Object.assign({},x.webauthn.credential_options),{publicKey:I,signal:A}));return N?{data:{factorId:t,challengeId:x.id,webauthn:{type:x.webauthn.type,credential_response:N}},error:null}:{data:null,error:U}}}}catch(x){return Rn(x)?{data:null,error:x}:{data:null,error:new cm("Unexpected error in challenge",x)}}}async _verify({challengeId:t,factorId:i,webauthn:l}){return this.client.mfa.verify({factorId:i,challengeId:t,webauthn:l})}async _authenticate({factorId:t,webauthn:{rpId:i=typeof window<"u"?window.location.hostname:void 0,rpOrigins:l=typeof window<"u"?[window.location.origin]:void 0,signal:f}},_){if(!i)return{data:null,error:new fb("rpId is required for WebAuthn authentication")};try{if(!kz())return{data:null,error:new cm("Browser does not support WebAuthn",null)};const{data:x,error:o}=await this.challenge({factorId:t,webauthn:{rpId:i,rpOrigins:l},signal:f},{request:_});if(!x)return{data:null,error:o};const{webauthn:A}=x;return this._verify({factorId:t,challengeId:x.challengeId,webauthn:{type:A.type,rpId:i,rpOrigins:l,credential_response:A.credential_response}})}catch(x){return Rn(x)?{data:null,error:x}:{data:null,error:new cm("Unexpected error in authenticate",x)}}}async _register({friendlyName:t,rpId:i=typeof window<"u"?window.location.hostname:void 0,rpOrigins:l=typeof window<"u"?[window.location.origin]:void 0,signal:f},_){if(!i)return{data:null,error:new fb("rpId is required for WebAuthn registration")};try{if(!kz())return{data:null,error:new cm("Browser does not support WebAuthn",null)};const{data:x,error:o}=await this._enroll({friendlyName:t});if(!x)return await this.client.mfa.listFactors().then(N=>{var U;return(U=N.data)===null||U===void 0?void 0:U.all.find($=>$.factor_type==="webauthn"&&$.friendly_name===t&&$.status!=="unverified")}).then(N=>N?this.client.mfa.unenroll({factorId:N==null?void 0:N.id}):void 0),{data:null,error:o};const{data:A,error:I}=await this._challenge({factorId:x.id,friendlyName:x.friendly_name,webauthn:{rpId:i,rpOrigins:l},signal:f},{create:_});return A?this._verify({factorId:x.id,challengeId:A.challengeId,webauthn:{rpId:i,rpOrigins:l,type:A.webauthn.type,credential_response:A.webauthn.credential_response}}):{data:null,error:I}}catch(x){return Rn(x)?{data:null,error:x}:{data:null,error:new cm("Unexpected error in register",x)}}}}kte();const Xte={url:Gee,storageKey:Hee,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Wee,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function Pz(e,t,i){return await i()}const E_={};class pb{get jwks(){var t,i;return(i=(t=E_[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&i!==void 0?i:{keys:[]}}set jwks(t){E_[this.storageKey]=Object.assign(Object.assign({},E_[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,i;return(i=(t=E_[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&i!==void 0?i:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){E_[this.storageKey]=Object.assign(Object.assign({},E_[this.storageKey]),{cachedAt:t})}constructor(t){var i,l,f;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const _=Object.assign(Object.assign({},Xte),t);if(this.storageKey=_.storageKey,this.instanceID=(i=pb.nextInstanceID[this.storageKey])!==null&&i!==void 0?i:0,pb.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!_.debug,typeof _.debug=="function"&&(this.logger=_.debug),this.instanceID>0&&wa()){const x=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(x),this.logDebugMessages&&console.trace(x)}if(this.persistSession=_.persistSession,this.autoRefreshToken=_.autoRefreshToken,this.admin=new Ate({url:_.url,headers:_.headers,fetch:_.fetch}),this.url=_.url,this.headers=_.headers,this.fetch=oU(_.fetch),this.lock=_.lock||Pz,this.detectSessionInUrl=_.detectSessionInUrl,this.flowType=_.flowType,this.hasCustomAuthorizationHeader=_.hasCustomAuthorizationHeader,this.throwOnError=_.throwOnError,_.lock?this.lock=_.lock:wa()&&(!((l=globalThis==null?void 0:globalThis.navigator)===null||l===void 0)&&l.locks)?this.lock=Ite:this.lock=Pz,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new Zte(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this)},this.persistSession?(_.storage?this.storage=_.storage:sU()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Iz(this.memoryStorage)),_.userStorage&&(this.userStorage=_.userStorage)):(this.memoryStorage={},this.storage=Iz(this.memoryStorage)),wa()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(x){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",x)}(f=this.broadcastChannel)===null||f===void 0||f.addEventListener("message",async x=>{this._debug("received broadcast notification from other tab or client",x),await this._notifyAllSubscribers(x.data.event,x.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${rU}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let i={},l="none";if(wa()&&(i=ate(window.location.href),this._isImplicitGrantCallback(i)?l="implicit":await this._isPKCECallback(i)&&(l="pkce")),wa()&&this.detectSessionInUrl&&l!=="none"){const{data:f,error:_}=await this._getSessionFromURL(i,l);if(_){if(this._debug("#_initialize()","error detecting session from URL",_),Qee(_)){const A=(t=_.details)===null||t===void 0?void 0:t.code;if(A==="identity_already_exists"||A==="identity_not_found"||A==="single_identity_not_deletable")return{error:_}}return await this._removeSession(),{error:_}}const{session:x,redirectType:o}=f;return this._debug("#_initialize()","detected session in URL",x,"redirect type",o),await this._saveSession(x),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",x):await this._notifyAllSubscribers("SIGNED_IN",x)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(i){return Rn(i)?this._returnResult({error:i}):this._returnResult({error:new cm("Unexpected error during initialization",i)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var i,l,f;try{const _=await ii(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(l=(i=t==null?void 0:t.options)===null||i===void 0?void 0:i.data)!==null&&l!==void 0?l:{},gotrue_meta_security:{captcha_token:(f=t==null?void 0:t.options)===null||f===void 0?void 0:f.captchaToken}},xform:Xc}),{data:x,error:o}=_;if(o||!x)return this._returnResult({data:{user:null,session:null},error:o});const A=x.session,I=x.user;return x.session&&(await this._saveSession(x.session),await this._notifyAllSubscribers("SIGNED_IN",A)),this._returnResult({data:{user:I,session:A},error:null})}catch(_){if(Rn(_))return this._returnResult({data:{user:null,session:null},error:_});throw _}}async signUp(t){var i,l,f;try{let _;if("email"in t){const{email:N,password:U,options:$}=t;let V=null,Y=null;this.flowType==="pkce"&&([V,Y]=await w_(this.storage,this.storageKey)),_=await ii(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:$==null?void 0:$.emailRedirectTo,body:{email:N,password:U,data:(i=$==null?void 0:$.data)!==null&&i!==void 0?i:{},gotrue_meta_security:{captcha_token:$==null?void 0:$.captchaToken},code_challenge:V,code_challenge_method:Y},xform:Xc})}else if("phone"in t){const{phone:N,password:U,options:$}=t;_=await ii(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:N,password:U,data:(l=$==null?void 0:$.data)!==null&&l!==void 0?l:{},channel:(f=$==null?void 0:$.channel)!==null&&f!==void 0?f:"sms",gotrue_meta_security:{captcha_token:$==null?void 0:$.captchaToken}},xform:Xc})}else throw new fS("You must provide either an email or phone number and a password");const{data:x,error:o}=_;if(o||!x)return this._returnResult({data:{user:null,session:null},error:o});const A=x.session,I=x.user;return x.session&&(await this._saveSession(x.session),await this._notifyAllSubscribers("SIGNED_IN",A)),this._returnResult({data:{user:I,session:A},error:null})}catch(_){if(Rn(_))return this._returnResult({data:{user:null,session:null},error:_});throw _}}async signInWithPassword(t){try{let i;if("email"in t){const{email:_,password:x,options:o}=t;i=await ii(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:_,password:x,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Az})}else if("phone"in t){const{phone:_,password:x,options:o}=t;i=await ii(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:_,password:x,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Az})}else throw new fS("You must provide either an email or phone number and a password");const{data:l,error:f}=i;if(f)return this._returnResult({data:{user:null,session:null},error:f});if(!l||!l.session||!l.user){const _=new b_;return this._returnResult({data:{user:null,session:null},error:_})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:Object.assign({user:l.user,session:l.session},l.weak_password?{weakPassword:l.weak_password}:null),error:f})}catch(i){if(Rn(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithOAuth(t){var i,l,f,_;return await this._handleProviderSignIn(t.provider,{redirectTo:(i=t.options)===null||i===void 0?void 0:i.redirectTo,scopes:(l=t.options)===null||l===void 0?void 0:l.scopes,queryParams:(f=t.options)===null||f===void 0?void 0:f.queryParams,skipBrowserRedirect:(_=t.options)===null||_===void 0?void 0:_.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:i}=t;switch(i){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${i}"`)}}async signInWithEthereum(t){var i,l,f,_,x,o,A,I,N,U,$;let V,Y;if("message"in t)V=t.message,Y=t.signature;else{const{chain:q,wallet:Z,statement:Q,options:H}=t;let K;if(wa())if(typeof Z=="object")K=Z;else{const Xe=window;if("ethereum"in Xe&&typeof Xe.ethereum=="object"&&"request"in Xe.ethereum&&typeof Xe.ethereum.request=="function")K=Xe.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof Z!="object"||!(H!=null&&H.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");K=Z}const ne=new URL((i=H==null?void 0:H.url)!==null&&i!==void 0?i:window.location.href),le=await K.request({method:"eth_requestAccounts"}).then(Xe=>Xe).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!le||le.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const pe=lU(le[0]);let Ae=(l=H==null?void 0:H.signInWithEthereum)===null||l===void 0?void 0:l.chainId;if(!Ae){const Xe=await K.request({method:"eth_chainId"});Ae=Pte(Xe)}const Ze={domain:ne.host,address:pe,statement:Q,uri:ne.href,version:"1",chainId:Ae,nonce:(f=H==null?void 0:H.signInWithEthereum)===null||f===void 0?void 0:f.nonce,issuedAt:(x=(_=H==null?void 0:H.signInWithEthereum)===null||_===void 0?void 0:_.issuedAt)!==null&&x!==void 0?x:new Date,expirationTime:(o=H==null?void 0:H.signInWithEthereum)===null||o===void 0?void 0:o.expirationTime,notBefore:(A=H==null?void 0:H.signInWithEthereum)===null||A===void 0?void 0:A.notBefore,requestId:(I=H==null?void 0:H.signInWithEthereum)===null||I===void 0?void 0:I.requestId,resources:(N=H==null?void 0:H.signInWithEthereum)===null||N===void 0?void 0:N.resources};V=Mte(Ze),Y=await K.request({method:"personal_sign",params:[Rte(V),pe]})}try{const{data:q,error:Z}=await ii(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:V,signature:Y},!((U=t.options)===null||U===void 0)&&U.captchaToken?{gotrue_meta_security:{captcha_token:($=t.options)===null||$===void 0?void 0:$.captchaToken}}:null),xform:Xc});if(Z)throw Z;if(!q||!q.session||!q.user){const Q=new b_;return this._returnResult({data:{user:null,session:null},error:Q})}return q.session&&(await this._saveSession(q.session),await this._notifyAllSubscribers("SIGNED_IN",q.session)),this._returnResult({data:Object.assign({},q),error:Z})}catch(q){if(Rn(q))return this._returnResult({data:{user:null,session:null},error:q});throw q}}async signInWithSolana(t){var i,l,f,_,x,o,A,I,N,U,$,V;let Y,q;if("message"in t)Y=t.message,q=t.signature;else{const{chain:Z,wallet:Q,statement:H,options:K}=t;let ne;if(wa())if(typeof Q=="object")ne=Q;else{const pe=window;if("solana"in pe&&typeof pe.solana=="object"&&("signIn"in pe.solana&&typeof pe.solana.signIn=="function"||"signMessage"in pe.solana&&typeof pe.solana.signMessage=="function"))ne=pe.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof Q!="object"||!(K!=null&&K.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");ne=Q}const le=new URL((i=K==null?void 0:K.url)!==null&&i!==void 0?i:window.location.href);if("signIn"in ne&&ne.signIn){const pe=await ne.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},K==null?void 0:K.signInWithSolana),{version:"1",domain:le.host,uri:le.href}),H?{statement:H}:null));let Ae;if(Array.isArray(pe)&&pe[0]&&typeof pe[0]=="object")Ae=pe[0];else if(pe&&typeof pe=="object"&&"signedMessage"in pe&&"signature"in pe)Ae=pe;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in Ae&&"signature"in Ae&&(typeof Ae.signedMessage=="string"||Ae.signedMessage instanceof Uint8Array)&&Ae.signature instanceof Uint8Array)Y=typeof Ae.signedMessage=="string"?Ae.signedMessage:new TextDecoder().decode(Ae.signedMessage),q=Ae.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in ne)||typeof ne.signMessage!="function"||!("publicKey"in ne)||typeof ne!="object"||!ne.publicKey||!("toBase58"in ne.publicKey)||typeof ne.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");Y=[`${le.host} wants you to sign in with your Solana account:`,ne.publicKey.toBase58(),...H?["",H,""]:[""],"Version: 1",`URI: ${le.href}`,`Issued At: ${(f=(l=K==null?void 0:K.signInWithSolana)===null||l===void 0?void 0:l.issuedAt)!==null&&f!==void 0?f:new Date().toISOString()}`,...!((_=K==null?void 0:K.signInWithSolana)===null||_===void 0)&&_.notBefore?[`Not Before: ${K.signInWithSolana.notBefore}`]:[],...!((x=K==null?void 0:K.signInWithSolana)===null||x===void 0)&&x.expirationTime?[`Expiration Time: ${K.signInWithSolana.expirationTime}`]:[],...!((o=K==null?void 0:K.signInWithSolana)===null||o===void 0)&&o.chainId?[`Chain ID: ${K.signInWithSolana.chainId}`]:[],...!((A=K==null?void 0:K.signInWithSolana)===null||A===void 0)&&A.nonce?[`Nonce: ${K.signInWithSolana.nonce}`]:[],...!((I=K==null?void 0:K.signInWithSolana)===null||I===void 0)&&I.requestId?[`Request ID: ${K.signInWithSolana.requestId}`]:[],...!((U=(N=K==null?void 0:K.signInWithSolana)===null||N===void 0?void 0:N.resources)===null||U===void 0)&&U.length?["Resources",...K.signInWithSolana.resources.map(Ae=>`- ${Ae}`)]:[]].join(`
`);const pe=await ne.signMessage(new TextEncoder().encode(Y),"utf8");if(!pe||!(pe instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");q=pe}}try{const{data:Z,error:Q}=await ii(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:Y,signature:fm(q)},!(($=t.options)===null||$===void 0)&&$.captchaToken?{gotrue_meta_security:{captcha_token:(V=t.options)===null||V===void 0?void 0:V.captchaToken}}:null),xform:Xc});if(Q)throw Q;if(!Z||!Z.session||!Z.user){const H=new b_;return this._returnResult({data:{user:null,session:null},error:H})}return Z.session&&(await this._saveSession(Z.session),await this._notifyAllSubscribers("SIGNED_IN",Z.session)),this._returnResult({data:Object.assign({},Z),error:Q})}catch(Z){if(Rn(Z))return this._returnResult({data:{user:null,session:null},error:Z});throw Z}}async _exchangeCodeForSession(t){const i=await rm(this.storage,`${this.storageKey}-code-verifier`),[l,f]=(i??"").split("/");try{const{data:_,error:x}=await ii(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:l},xform:Xc});if(await Jh(this.storage,`${this.storageKey}-code-verifier`),x)throw x;if(!_||!_.session||!_.user){const o=new b_;return this._returnResult({data:{user:null,session:null,redirectType:null},error:o})}return _.session&&(await this._saveSession(_.session),await this._notifyAllSubscribers("SIGNED_IN",_.session)),this._returnResult({data:Object.assign(Object.assign({},_),{redirectType:f??null}),error:x})}catch(_){if(Rn(_))return this._returnResult({data:{user:null,session:null,redirectType:null},error:_});throw _}}async signInWithIdToken(t){try{const{options:i,provider:l,token:f,access_token:_,nonce:x}=t,o=await ii(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:l,id_token:f,access_token:_,nonce:x,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},xform:Xc}),{data:A,error:I}=o;if(I)return this._returnResult({data:{user:null,session:null},error:I});if(!A||!A.session||!A.user){const N=new b_;return this._returnResult({data:{user:null,session:null},error:N})}return A.session&&(await this._saveSession(A.session),await this._notifyAllSubscribers("SIGNED_IN",A.session)),this._returnResult({data:A,error:I})}catch(i){if(Rn(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithOtp(t){var i,l,f,_,x;try{if("email"in t){const{email:o,options:A}=t;let I=null,N=null;this.flowType==="pkce"&&([I,N]=await w_(this.storage,this.storageKey));const{error:U}=await ii(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(i=A==null?void 0:A.data)!==null&&i!==void 0?i:{},create_user:(l=A==null?void 0:A.shouldCreateUser)!==null&&l!==void 0?l:!0,gotrue_meta_security:{captcha_token:A==null?void 0:A.captchaToken},code_challenge:I,code_challenge_method:N},redirectTo:A==null?void 0:A.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:U})}if("phone"in t){const{phone:o,options:A}=t,{data:I,error:N}=await ii(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(f=A==null?void 0:A.data)!==null&&f!==void 0?f:{},create_user:(_=A==null?void 0:A.shouldCreateUser)!==null&&_!==void 0?_:!0,gotrue_meta_security:{captcha_token:A==null?void 0:A.captchaToken},channel:(x=A==null?void 0:A.channel)!==null&&x!==void 0?x:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:I==null?void 0:I.message_id},error:N})}throw new fS("You must provide either an email or phone number.")}catch(o){if(Rn(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async verifyOtp(t){var i,l;try{let f,_;"options"in t&&(f=(i=t.options)===null||i===void 0?void 0:i.redirectTo,_=(l=t.options)===null||l===void 0?void 0:l.captchaToken);const{data:x,error:o}=await ii(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:_}}),redirectTo:f,xform:Xc});if(o)throw o;if(!x)throw new Error("An error occurred on token verification.");const A=x.session,I=x.user;return A!=null&&A.access_token&&(await this._saveSession(A),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",A)),this._returnResult({data:{user:I,session:A},error:null})}catch(f){if(Rn(f))return this._returnResult({data:{user:null,session:null},error:f});throw f}}async signInWithSSO(t){var i,l,f;try{let _=null,x=null;this.flowType==="pkce"&&([_,x]=await w_(this.storage,this.storageKey));const o=await ii(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(l=(i=t.options)===null||i===void 0?void 0:i.redirectTo)!==null&&l!==void 0?l:void 0}),!((f=t==null?void 0:t.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:_,code_challenge_method:x}),headers:this.headers,xform:Tte});return this._returnResult(o)}catch(_){if(Rn(_))return this._returnResult({data:null,error:_});throw _}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:i},error:l}=t;if(l)throw l;if(!i)throw new Zc;const{error:f}=await ii(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:i.access_token});return this._returnResult({data:{user:null,session:null},error:f})})}catch(t){if(Rn(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const i=`${this.url}/resend`;if("email"in t){const{email:l,type:f,options:_}=t,{error:x}=await ii(this.fetch,"POST",i,{headers:this.headers,body:{email:l,type:f,gotrue_meta_security:{captcha_token:_==null?void 0:_.captchaToken}},redirectTo:_==null?void 0:_.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:x})}else if("phone"in t){const{phone:l,type:f,options:_}=t,{data:x,error:o}=await ii(this.fetch,"POST",i,{headers:this.headers,body:{phone:l,type:f,gotrue_meta_security:{captcha_token:_==null?void 0:_.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:x==null?void 0:x.message_id},error:o})}throw new fS("You must provide either an email or phone number and a type")}catch(i){if(Rn(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async i=>i))}async _acquireLock(t,i){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const l=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),f=(async()=>(await l,await i()))();return this.pendingInLock.push((async()=>{try{await f}catch{}})()),f}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const l=i();for(this.pendingInLock.push((async()=>{try{await l}catch{}})()),await l;this.pendingInLock.length;){const f=[...this.pendingInLock];await Promise.all(f),this.pendingInLock.splice(0,f.length)}return await l}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const i=await this.__loadSession();return await t(i)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const i=await rm(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",i),i!==null&&(this._isValidSession(i)?t=i:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const l=t.expires_at?t.expires_at*1e3-Date.now()<IA:!1;if(this._debug("#__loadSession()",`session has${l?"":" not"} expired`,"expires_at",t.expires_at),!l){if(this.userStorage){const x=await rm(this.userStorage,this.storageKey+"-user");x!=null&&x.user?t.user=x.user:t.user=RA()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const x={value:this.suppressGetSessionWarning};t.user=xte(t.user,x),x.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:f,error:_}=await this._callRefreshToken(t.refresh_token);return _?this._returnResult({data:{session:null},error:_}):this._returnResult({data:{session:f},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){return t?await this._getUser(t):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(t){try{return t?await ii(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:lf}):await this._useSession(async i=>{var l,f,_;const{data:x,error:o}=i;if(o)throw o;return!(!((l=x.session)===null||l===void 0)&&l.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Zc}:await ii(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(_=(f=x.session)===null||f===void 0?void 0:f.access_token)!==null&&_!==void 0?_:void 0,xform:lf})})}catch(i){if(Rn(i))return Jee(i)&&(await this._removeSession(),await Jh(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:i});throw i}}async updateUser(t,i={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,i))}async _updateUser(t,i={}){try{return await this._useSession(async l=>{const{data:f,error:_}=l;if(_)throw _;if(!f.session)throw new Zc;const x=f.session;let o=null,A=null;this.flowType==="pkce"&&t.email!=null&&([o,A]=await w_(this.storage,this.storageKey));const{data:I,error:N}=await ii(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:i==null?void 0:i.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:o,code_challenge_method:A}),jwt:x.access_token,xform:lf});if(N)throw N;return x.user=I.user,await this._saveSession(x),await this._notifyAllSubscribers("USER_UPDATED",x),this._returnResult({data:{user:x.user},error:null})})}catch(l){if(Rn(l))return this._returnResult({data:{user:null},error:l});throw l}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new Zc;const i=Date.now()/1e3;let l=i,f=!0,_=null;const{payload:x}=PA(t.access_token);if(x.exp&&(l=x.exp,f=l<=i),f){const{data:o,error:A}=await this._callRefreshToken(t.refresh_token);if(A)return this._returnResult({data:{user:null,session:null},error:A});if(!o)return{data:{user:null,session:null},error:null};_=o}else{const{data:o,error:A}=await this._getUser(t.access_token);if(A)throw A;_={access_token:t.access_token,refresh_token:t.refresh_token,user:o.user,token_type:"bearer",expires_in:l-i,expires_at:l},await this._saveSession(_),await this._notifyAllSubscribers("SIGNED_IN",_)}return this._returnResult({data:{user:_.user,session:_},error:null})}catch(i){if(Rn(i))return this._returnResult({data:{session:null,user:null},error:i});throw i}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async i=>{var l;if(!t){const{data:x,error:o}=i;if(o)throw o;t=(l=x.session)!==null&&l!==void 0?l:void 0}if(!(t!=null&&t.refresh_token))throw new Zc;const{data:f,error:_}=await this._callRefreshToken(t.refresh_token);return _?this._returnResult({data:{user:null,session:null},error:_}):f?this._returnResult({data:{user:f.user,session:f},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(i){if(Rn(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async _getSessionFromURL(t,i){try{if(!wa())throw new pS("No browser detected.");if(t.error||t.error_description||t.error_code)throw new pS(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(i){case"implicit":if(this.flowType==="pkce")throw new xz("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new pS("Not a valid implicit grant flow url.");break;default:}if(i==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new xz("No code detected.");const{data:H,error:K}=await this._exchangeCodeForSession(t.code);if(K)throw K;const ne=new URL(window.location.href);return ne.searchParams.delete("code"),window.history.replaceState(window.history.state,"",ne.toString()),{data:{session:H.session,redirectType:null},error:null}}const{provider_token:l,provider_refresh_token:f,access_token:_,refresh_token:x,expires_in:o,expires_at:A,token_type:I}=t;if(!_||!o||!x||!I)throw new pS("No session defined in URL");const N=Math.round(Date.now()/1e3),U=parseInt(o);let $=N+U;A&&($=parseInt(A));const V=$-N;V*1e3<=P_&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${V}s, should have been closer to ${U}s`);const Y=$-U;N-Y>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",Y,$,N):N-Y<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",Y,$,N);const{data:q,error:Z}=await this._getUser(_);if(Z)throw Z;const Q={provider_token:l,provider_refresh_token:f,access_token:_,expires_in:U,expires_at:$,refresh_token:x,token_type:I,user:q.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:Q,redirectType:t.type},error:null})}catch(l){if(Rn(l))return this._returnResult({data:{session:null,redirectType:null},error:l});throw l}}_isImplicitGrantCallback(t){return!!(t.access_token||t.error_description)}async _isPKCECallback(t){const i=await rm(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&i)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async i=>{var l;const{data:f,error:_}=i;if(_)return this._returnResult({error:_});const x=(l=f.session)===null||l===void 0?void 0:l.access_token;if(x){const{error:o}=await this.admin.signOut(x,t);if(o&&!(Yee(o)&&(o.status===404||o.status===401||o.status===403)))return this._returnResult({error:o})}return t!=="others"&&(await this._removeSession(),await Jh(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const i=ote(),l={id:i,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",i),this.stateChangeEmitters.delete(i)}};return this._debug("#onAuthStateChange()","registered callback with id",i),this.stateChangeEmitters.set(i,l),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(i)})))(),{data:{subscription:l}}}async _emitInitialSession(t){return await this._useSession(async i=>{var l,f;try{const{data:{session:_},error:x}=i;if(x)throw x;await((l=this.stateChangeEmitters.get(t))===null||l===void 0?void 0:l.callback("INITIAL_SESSION",_)),this._debug("INITIAL_SESSION","callback id",t,"session",_)}catch(_){await((f=this.stateChangeEmitters.get(t))===null||f===void 0?void 0:f.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",_),console.error(_)}})}async resetPasswordForEmail(t,i={}){let l=null,f=null;this.flowType==="pkce"&&([l,f]=await w_(this.storage,this.storageKey,!0));try{return await ii(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:l,code_challenge_method:f,gotrue_meta_security:{captcha_token:i.captchaToken}},headers:this.headers,redirectTo:i.redirectTo})}catch(_){if(Rn(_))return this._returnResult({data:null,error:_});throw _}}async getUserIdentities(){var t;try{const{data:i,error:l}=await this.getUser();if(l)throw l;return this._returnResult({data:{identities:(t=i.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(i){if(Rn(i))return this._returnResult({data:null,error:i});throw i}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var i;try{const{data:l,error:f}=await this._useSession(async _=>{var x,o,A,I,N;const{data:U,error:$}=_;if($)throw $;const V=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(x=t.options)===null||x===void 0?void 0:x.redirectTo,scopes:(o=t.options)===null||o===void 0?void 0:o.scopes,queryParams:(A=t.options)===null||A===void 0?void 0:A.queryParams,skipBrowserRedirect:!0});return await ii(this.fetch,"GET",V,{headers:this.headers,jwt:(N=(I=U.session)===null||I===void 0?void 0:I.access_token)!==null&&N!==void 0?N:void 0})});if(f)throw f;return wa()&&!(!((i=t.options)===null||i===void 0)&&i.skipBrowserRedirect)&&window.location.assign(l==null?void 0:l.url),this._returnResult({data:{provider:t.provider,url:l==null?void 0:l.url},error:null})}catch(l){if(Rn(l))return this._returnResult({data:{provider:t.provider,url:null},error:l});throw l}}async linkIdentityIdToken(t){return await this._useSession(async i=>{var l;try{const{error:f,data:{session:_}}=i;if(f)throw f;const{options:x,provider:o,token:A,access_token:I,nonce:N}=t,U=await ii(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(l=_==null?void 0:_.access_token)!==null&&l!==void 0?l:void 0,body:{provider:o,id_token:A,access_token:I,nonce:N,link_identity:!0,gotrue_meta_security:{captcha_token:x==null?void 0:x.captchaToken}},xform:Xc}),{data:$,error:V}=U;return V?this._returnResult({data:{user:null,session:null},error:V}):!$||!$.session||!$.user?this._returnResult({data:{user:null,session:null},error:new b_}):($.session&&(await this._saveSession($.session),await this._notifyAllSubscribers("USER_UPDATED",$.session)),this._returnResult({data:$,error:V}))}catch(f){if(Rn(f))return this._returnResult({data:{user:null,session:null},error:f});throw f}})}async unlinkIdentity(t){try{return await this._useSession(async i=>{var l,f;const{data:_,error:x}=i;if(x)throw x;return await ii(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(f=(l=_.session)===null||l===void 0?void 0:l.access_token)!==null&&f!==void 0?f:void 0})})}catch(i){if(Rn(i))return this._returnResult({data:null,error:i});throw i}}async _refreshAccessToken(t){const i=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(i,"begin");try{const l=Date.now();return await ute(async f=>(f>0&&await cte(200*Math.pow(2,f-1)),this._debug(i,"refreshing attempt",f),await ii(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:Xc})),(f,_)=>{const x=200*Math.pow(2,f);return _&&kA(_)&&Date.now()+x-l<P_})}catch(l){if(this._debug(i,"error",l),Rn(l))return this._returnResult({data:{session:null,user:null},error:l});throw l}finally{this._debug(i,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,i){const l=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:i.redirectTo,scopes:i.scopes,queryParams:i.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",i,"url",l),wa()&&!i.skipBrowserRedirect&&window.location.assign(l),{data:{provider:t,url:l},error:null}}async _recoverAndRefresh(){var t,i;const l="#_recoverAndRefresh()";this._debug(l,"begin");try{const f=await rm(this.storage,this.storageKey);if(f&&this.userStorage){let x=await rm(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!x&&(x={user:f.user},await R_(this.userStorage,this.storageKey+"-user",x)),f.user=(t=x==null?void 0:x.user)!==null&&t!==void 0?t:RA()}else if(f&&!f.user&&!f.user){const x=await rm(this.storage,this.storageKey+"-user");x&&(x!=null&&x.user)?(f.user=x.user,await Jh(this.storage,this.storageKey+"-user"),await R_(this.storage,this.storageKey,f)):f.user=RA()}if(this._debug(l,"session from storage",f),!this._isValidSession(f)){this._debug(l,"session is not valid"),f!==null&&await this._removeSession();return}const _=((i=f.expires_at)!==null&&i!==void 0?i:1/0)*1e3-Date.now()<IA;if(this._debug(l,`session has${_?"":" not"} expired with margin of ${IA}s`),_){if(this.autoRefreshToken&&f.refresh_token){const{error:x}=await this._callRefreshToken(f.refresh_token);x&&(console.error(x),kA(x)||(this._debug(l,"refresh failed with a non-retryable error, removing the session",x),await this._removeSession()))}}else if(f.user&&f.user.__isUserNotAvailableProxy===!0)try{const{data:x,error:o}=await this._getUser(f.access_token);!o&&(x!=null&&x.user)?(f.user=x.user,await this._saveSession(f),await this._notifyAllSubscribers("SIGNED_IN",f)):this._debug(l,"could not get user data, skipping SIGNED_IN notification")}catch(x){console.error("Error getting user data:",x),this._debug(l,"error getting user data, skipping SIGNED_IN notification",x)}else await this._notifyAllSubscribers("SIGNED_IN",f)}catch(f){this._debug(l,"error",f),console.error(f);return}finally{this._debug(l,"end")}}async _callRefreshToken(t){var i,l;if(!t)throw new Zc;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const f=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(f,"begin");try{this.refreshingDeferred=new E2;const{data:_,error:x}=await this._refreshAccessToken(t);if(x)throw x;if(!_.session)throw new Zc;await this._saveSession(_.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",_.session);const o={data:_.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(_){if(this._debug(f,"error",_),Rn(_)){const x={data:null,error:_};return kA(_)||await this._removeSession(),(i=this.refreshingDeferred)===null||i===void 0||i.resolve(x),x}throw(l=this.refreshingDeferred)===null||l===void 0||l.reject(_),_}finally{this.refreshingDeferred=null,this._debug(f,"end")}}async _notifyAllSubscribers(t,i,l=!0){const f=`#_notifyAllSubscribers(${t})`;this._debug(f,"begin",i,`broadcast = ${l}`);try{this.broadcastChannel&&l&&this.broadcastChannel.postMessage({event:t,session:i});const _=[],x=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(t,i)}catch(A){_.push(A)}});if(await Promise.all(x),_.length>0){for(let o=0;o<_.length;o+=1)console.error(_[o]);throw _[0]}}finally{this._debug(f,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0;const i=Object.assign({},t),l=i.user&&i.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!l&&i.user&&await R_(this.userStorage,this.storageKey+"-user",{user:i.user});const f=Object.assign({},i);delete f.user;const _=Ez(f);await R_(this.storage,this.storageKey,_)}else{const f=Ez(i);await R_(this.storage,this.storageKey,f)}}async _removeSession(){this._debug("#_removeSession()"),await Jh(this.storage,this.storageKey),await Jh(this.storage,this.storageKey+"-code-verifier"),await Jh(this.storage,this.storageKey+"-user"),this.userStorage&&await Jh(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&wa()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(i){console.error("removing visibilitychange callback failed",i)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),P_);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async i=>{const{data:{session:l}}=i;if(!l||!l.refresh_token||!l.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const f=Math.floor((l.expires_at*1e3-t)/P_);this._debug("#_autoRefreshTokenTick()",`access token expires in ${f} ticks, a tick lasts ${P_}ms, refresh threshold is ${NI} ticks`),f<=NI&&await this._callRefreshToken(l.refresh_token)})}catch(i){console.error("Auto refresh tick failed with error. This is likely a transient error.",i)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof aU)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!wa()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const i=`#_onVisibilityChanged(${t})`;this._debug(i,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(i,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,i,l){const f=[`provider=${encodeURIComponent(i)}`];if(l!=null&&l.redirectTo&&f.push(`redirect_to=${encodeURIComponent(l.redirectTo)}`),l!=null&&l.scopes&&f.push(`scopes=${encodeURIComponent(l.scopes)}`),this.flowType==="pkce"){const[_,x]=await w_(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(_)}`,code_challenge_method:`${encodeURIComponent(x)}`});f.push(o.toString())}if(l!=null&&l.queryParams){const _=new URLSearchParams(l.queryParams);f.push(_.toString())}return l!=null&&l.skipBrowserRedirect&&f.push(`skip_http_redirect=${l.skipBrowserRedirect}`),`${t}?${f.join("&")}`}async _unenroll(t){try{return await this._useSession(async i=>{var l;const{data:f,error:_}=i;return _?this._returnResult({data:null,error:_}):await ii(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(l=f==null?void 0:f.session)===null||l===void 0?void 0:l.access_token})})}catch(i){if(Rn(i))return this._returnResult({data:null,error:i});throw i}}async _enroll(t){try{return await this._useSession(async i=>{var l,f;const{data:_,error:x}=i;if(x)return this._returnResult({data:null,error:x});const o=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:A,error:I}=await ii(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(l=_==null?void 0:_.session)===null||l===void 0?void 0:l.access_token});return I?this._returnResult({data:null,error:I}):(t.factorType==="totp"&&A.type==="totp"&&(!((f=A==null?void 0:A.totp)===null||f===void 0)&&f.qr_code)&&(A.totp.qr_code=`data:image/svg+xml;utf-8,${A.totp.qr_code}`),this._returnResult({data:A,error:null}))})}catch(i){if(Rn(i))return this._returnResult({data:null,error:i});throw i}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async i=>{var l;const{data:f,error:_}=i;if(_)return this._returnResult({data:null,error:_});const x=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?Bte(t.webauthn.credential_response):Vte(t.webauthn.credential_response)})}:{code:t.code}),{data:o,error:A}=await ii(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:x,headers:this.headers,jwt:(l=f==null?void 0:f.session)===null||l===void 0?void 0:l.access_token});return A?this._returnResult({data:null,error:A}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),this._returnResult({data:o,error:A}))})}catch(i){if(Rn(i))return this._returnResult({data:null,error:i});throw i}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async i=>{var l;const{data:f,error:_}=i;if(_)return this._returnResult({data:null,error:_});const x=await ii(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(l=f==null?void 0:f.session)===null||l===void 0?void 0:l.access_token});if(x.error)return x;const{data:o}=x;if(o.type!=="webauthn")return{data:o,error:null};switch(o.webauthn.type){case"create":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:zte(o.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:Fte(o.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(i){if(Rn(i))return this._returnResult({data:null,error:i});throw i}})}async _challengeAndVerify(t){const{data:i,error:l}=await this._challenge({factorId:t.factorId});return l?this._returnResult({data:null,error:l}):await this._verify({factorId:t.factorId,challengeId:i.id,code:t.code})}async _listFactors(){var t;const{data:{user:i},error:l}=await this.getUser();if(l)return{data:null,error:l};const f={all:[],phone:[],totp:[],webauthn:[]};for(const _ of(t=i==null?void 0:i.factors)!==null&&t!==void 0?t:[])f.all.push(_),_.status==="verified"&&f[_.factor_type].push(_);return{data:f,error:null}}async _getAuthenticatorAssuranceLevel(){var t,i;const{data:{session:l},error:f}=await this.getSession();if(f)return this._returnResult({data:null,error:f});if(!l)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:_}=PA(l.access_token);let x=null;_.aal&&(x=_.aal);let o=x;((i=(t=l.user.factors)===null||t===void 0?void 0:t.filter(N=>N.status==="verified"))!==null&&i!==void 0?i:[]).length>0&&(o="aal2");const I=_.amr||[];return{data:{currentLevel:x,nextLevel:o,currentAuthenticationMethods:I},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async i=>{const{data:{session:l},error:f}=i;return f?this._returnResult({data:null,error:f}):l?await ii(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:l.access_token,xform:_=>({data:_,error:null})}):this._returnResult({data:null,error:new Zc})})}catch(i){if(Rn(i))return this._returnResult({data:null,error:i});throw i}}async _approveAuthorization(t,i){try{return await this._useSession(async l=>{const{data:{session:f},error:_}=l;if(_)return this._returnResult({data:null,error:_});if(!f)return this._returnResult({data:null,error:new Zc});const x=await ii(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:f.access_token,body:{action:"approve"},xform:o=>({data:o,error:null})});return x.data&&x.data.redirect_url&&wa()&&!(i!=null&&i.skipBrowserRedirect)&&window.location.assign(x.data.redirect_url),x})}catch(l){if(Rn(l))return this._returnResult({data:null,error:l});throw l}}async _denyAuthorization(t,i){try{return await this._useSession(async l=>{const{data:{session:f},error:_}=l;if(_)return this._returnResult({data:null,error:_});if(!f)return this._returnResult({data:null,error:new Zc});const x=await ii(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:f.access_token,body:{action:"deny"},xform:o=>({data:o,error:null})});return x.data&&x.data.redirect_url&&wa()&&!(i!=null&&i.skipBrowserRedirect)&&window.location.assign(x.data.redirect_url),x})}catch(l){if(Rn(l))return this._returnResult({data:null,error:l});throw l}}async fetchJwk(t,i={keys:[]}){let l=i.keys.find(o=>o.kid===t);if(l)return l;const f=Date.now();if(l=this.jwks.keys.find(o=>o.kid===t),l&&this.jwks_cached_at+Xee>f)return l;const{data:_,error:x}=await ii(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(x)throw x;return!_.keys||_.keys.length===0||(this.jwks=_,this.jwks_cached_at=f,l=_.keys.find(o=>o.kid===t),!l)?null:l}async getClaims(t,i={}){try{let l=t;if(!l){const{data:V,error:Y}=await this.getSession();if(Y||!V.session)return this._returnResult({data:null,error:Y});l=V.session.access_token}const{header:f,payload:_,signature:x,raw:{header:o,payload:A}}=PA(l);i!=null&&i.allowExpired||_te(_.exp);const I=!f.alg||f.alg.startsWith("HS")||!f.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(f.kid,i!=null&&i.keys?{keys:i.keys}:i==null?void 0:i.jwks);if(!I){const{error:V}=await this.getUser(l);if(V)throw V;return{data:{claims:_,header:f,signature:x},error:null}}const N=yte(f.alg),U=await crypto.subtle.importKey("jwk",I,N,!0,["verify"]);if(!await crypto.subtle.verify(N,U,x,ite(`${o}.${A}`)))throw new LI("Invalid JWT signature");return{data:{claims:_,header:f,signature:x},error:null}}catch(l){if(Rn(l))return this._returnResult({data:null,error:l});throw l}}}pb.nextInstanceID={};const Kte=pb;class Yte extends Kte{constructor(t){super(t)}}class Jte{constructor(t,i,l){var f,_,x;this.supabaseUrl=t,this.supabaseKey=i;const o=qee(t);if(!i)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",o),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",o),this.storageUrl=new URL("storage/v1",o),this.functionsUrl=new URL("functions/v1",o);const A=`sb-${o.hostname.split(".")[0]}-auth-token`,I={db:Oee,realtime:zee,auth:Object.assign(Object.assign({},Lee),{storageKey:A}),global:Dee},N=$ee(l??{},I);this.storageKey=(f=N.auth.storageKey)!==null&&f!==void 0?f:"",this.headers=(_=N.global.headers)!==null&&_!==void 0?_:{},N.accessToken?(this.accessToken=N.accessToken,this.auth=new Proxy({},{get:(U,$)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String($)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((x=N.auth)!==null&&x!==void 0?x:{},this.headers,N.global.fetch),this.fetch=Vee(i,this._getAccessToken.bind(this),N.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},N.realtime)),this.rest=new GQ(new URL("rest/v1",o).href,{headers:this.headers,schema:N.db.schema,fetch:this.fetch}),this.storage=new Ree(this.storageUrl.href,this.headers,this.fetch,l==null?void 0:l.storage),N.accessToken||this._listenForAuthEvents()}get functions(){return new UQ(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,i={},l={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,i,l)}channel(t,i={config:{}}){return this.realtime.channel(t,i)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t,i;if(this.accessToken)return await this.accessToken();const{data:l}=await this.auth.getSession();return(i=(t=l.session)===null||t===void 0?void 0:t.access_token)!==null&&i!==void 0?i:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:i,detectSessionInUrl:l,storage:f,userStorage:_,storageKey:x,flowType:o,lock:A,debug:I,throwOnError:N},U,$){const V={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Yte({url:this.authUrl.href,headers:Object.assign(Object.assign({},V),U),storageKey:x,autoRefreshToken:t,persistSession:i,detectSessionInUrl:l,storage:f,userStorage:_,flowType:o,lock:A,debug:I,throwOnError:N,fetch:$,hasCustomAuthorizationHeader:Object.keys(this.headers).some(Y=>Y.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new lee(this.realtimeUrl.href,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((i,l)=>{this._handleTokenChanged(i,"CLIENT",l==null?void 0:l.access_token)})}_handleTokenChanged(t,i,l){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==l?(this.changedAccessToken=l,this.realtime.setAuth(l)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),i=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Qte=(e,t,i)=>new Jte(e,t,i);function ere(){if(typeof window<"u"||typeof process>"u")return!1;const e=process.version;if(e==null)return!1;const t=e.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}ere()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const tre="https://jcsmwkkytigomvibwsnb.supabase.co",rre="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Impjc213a2t5dGlnb212aWJ3c25iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI0MzU3NDUsImV4cCI6MjA3ODAxMTc0NX0.jkbRoq_Gd_WdqCQOx_KnbPuyDEuchdmbCgwj-ZRxdT0",Ge=Qte(tre,rre,{auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0}}),Zs=({children:e})=>{const[t,i]=F.useState(null),[l,f]=F.useState(!0);return F.useEffect(()=>{const{data:{subscription:_}}=Ge.auth.onAuthStateChange((x,o)=>{i(o),f(!1)});return Ge.auth.getSession().then(({data:{session:x}})=>{i(x),f(!1)}),()=>_.unsubscribe()},[]),l?d.jsx("div",{className:"flex items-center justify-center h-screen",children:d.jsx(nd,{className:"h-8 w-8 animate-spin text-primary"})}):t?d.jsx(d.Fragment,{children:e}):d.jsx(xQ,{to:"/auth",replace:!0})},mb=By("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Bt=F.forwardRef(({className:e,variant:t,size:i,asChild:l=!1,...f},_)=>{const x=l?Hm:"button";return d.jsx(x,{className:wr(mb({variant:t,size:i,className:e})),ref:_,...f})});Bt.displayName="Button";const nre=()=>{const e=_u(),[t,i]=F.useState(!0);if(F.useEffect(()=>{Ge.auth.getSession().then(({data:{session:_}})=>{_?e("/dashboard"):i(!1)});const{data:{subscription:f}}=Ge.auth.onAuthStateChange((_,x)=>{x&&e("/dashboard")});return()=>f.unsubscribe()},[e]),t)return null;const l=[{icon:LS,title:"Monitoramento 24/7",description:"Centro de controle operacional em tempo real"},{icon:Lf,title:"Gesto de Contratos",description:"Hierarquia Cliente  Contrato  Unidade  Posto"},{icon:Hd,title:"Gesto de Colaboradores",description:"Controle de escalas, presena e performance"},{icon:Zf,title:"Ordens de Servio",description:"Preventivas, corretivas e emergenciais"},{icon:Ib,title:"Checklists Inteligentes",description:"Inspees programadas e auditoria completa"},{icon:Jj,title:"Dashboard Executivo",description:"KPIs, SLA e NPS em tempo real"}];return d.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/5 via-background to-accent/5",children:[d.jsxs("div",{className:"container mx-auto px-4 py-16",children:[d.jsxs("div",{className:"text-center max-w-4xl mx-auto mb-16",children:[d.jsx("div",{className:"inline-flex p-4 bg-gradient-to-br from-primary to-accent rounded-2xl mb-6 shadow-lg",children:d.jsx(Lf,{className:"h-16 w-16 text-primary-foreground"})}),d.jsx("h1",{className:"text-5xl md:text-6xl font-bold mb-6 bg-gradient-to-r from-primary via-accent to-primary bg-clip-text text-transparent",children:"Facilities Center"}),d.jsx("p",{className:"text-xl text-muted-foreground mb-4",children:"Plataforma de gesto de operaes de servio que atua como ncleo de inteligncia operacional 24/7"}),d.jsx("p",{className:"text-lg text-muted-foreground mb-8",children:"Monitoramento contnuo e preditivo com preciso e inteligncia para garantir estabilidade operacional"}),d.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[d.jsx(Bt,{size:"lg",onClick:()=>e("/auth"),className:"text-lg px-8 shadow-lg hover:shadow-xl transition-shadow",children:"Acessar Plataforma"}),d.jsx(Bt,{size:"lg",variant:"outline",onClick:()=>e("/auth"),className:"text-lg px-8",children:"Criar Conta"})]})]}),d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-16",children:l.map((f,_)=>d.jsxs("div",{className:"bg-card p-6 rounded-xl shadow-md hover:shadow-lg transition-all duration-300 hover:-translate-y-1 border",children:[d.jsx("div",{className:"inline-flex p-3 bg-primary/10 rounded-lg mb-4",children:d.jsx(f.icon,{className:"h-6 w-6 text-primary"})}),d.jsx("h3",{className:"text-lg font-semibold mb-2",children:f.title}),d.jsx("p",{className:"text-sm text-muted-foreground",children:f.description})]},_))}),d.jsxs("div",{className:"bg-card rounded-2xl p-8 shadow-lg border max-w-4xl mx-auto",children:[d.jsx("h2",{className:"text-3xl font-bold mb-6 text-center",children:"Controle de Acesso por Perfil (RBAC)"}),d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[{role:"Administrador",description:"Acesso total ao sistema"},{role:"Gestor de Operaes",description:"Tudo exceto gesto de usurios"},{role:"Supervisor",description:"CRUD de OS, incidentes, checklists e presena"},{role:"Analista Centro Controle",description:"Leitura total + abertura de OS e incidentes"},{role:"Tcnico",description:"Visualizar OS atribudas e executar checklists"},{role:"Cliente View",description:"Somente leitura e comentrios"}].map((f,_)=>d.jsxs("div",{className:"flex items-start gap-3 p-4 bg-muted/50 rounded-lg",children:[d.jsx(nP,{className:"h-5 w-5 text-primary flex-shrink-0 mt-0.5"}),d.jsxs("div",{children:[d.jsx("p",{className:"font-semibold",children:f.role}),d.jsx("p",{className:"text-sm text-muted-foreground",children:f.description})]})]},_))})]})]}),d.jsx("footer",{className:"border-t bg-card/50 py-8",children:d.jsx("div",{className:"container mx-auto px-4 text-center text-muted-foreground",children:d.jsx("p",{children:" 2025 Facilities Center - Delta Facilities. Todos os direitos reservados."})})})]})};var cs;(function(e){e.assertEqual=f=>{};function t(f){}e.assertIs=t;function i(f){throw new Error}e.assertNever=i,e.arrayToEnum=f=>{const _={};for(const x of f)_[x]=x;return _},e.getValidEnumValues=f=>{const _=e.objectKeys(f).filter(o=>typeof f[f[o]]!="number"),x={};for(const o of _)x[o]=f[o];return e.objectValues(x)},e.objectValues=f=>e.objectKeys(f).map(function(_){return f[_]}),e.objectKeys=typeof Object.keys=="function"?f=>Object.keys(f):f=>{const _=[];for(const x in f)Object.prototype.hasOwnProperty.call(f,x)&&_.push(x);return _},e.find=(f,_)=>{for(const x of f)if(_(x))return x},e.isInteger=typeof Number.isInteger=="function"?f=>Number.isInteger(f):f=>typeof f=="number"&&Number.isFinite(f)&&Math.floor(f)===f;function l(f,_=" | "){return f.map(x=>typeof x=="string"?`'${x}'`:x).join(_)}e.joinValues=l,e.jsonStringifyReplacer=(f,_)=>typeof _=="bigint"?_.toString():_})(cs||(cs={}));var Rz;(function(e){e.mergeShapes=(t,i)=>({...t,...i})})(Rz||(Rz={}));const bn=cs.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),sf=e=>{switch(typeof e){case"undefined":return bn.undefined;case"string":return bn.string;case"number":return Number.isNaN(e)?bn.nan:bn.number;case"boolean":return bn.boolean;case"function":return bn.function;case"bigint":return bn.bigint;case"symbol":return bn.symbol;case"object":return Array.isArray(e)?bn.array:e===null?bn.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?bn.promise:typeof Map<"u"&&e instanceof Map?bn.map:typeof Set<"u"&&e instanceof Set?bn.set:typeof Date<"u"&&e instanceof Date?bn.date:bn.object;default:return bn.unknown}},Rr=cs.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class xc extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=l=>{this.issues=[...this.issues,l]},this.addIssues=(l=[])=>{this.issues=[...this.issues,...l]};const i=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,i):this.__proto__=i,this.name="ZodError",this.issues=t}format(t){const i=t||function(_){return _.message},l={_errors:[]},f=_=>{for(const x of _.issues)if(x.code==="invalid_union")x.unionErrors.map(f);else if(x.code==="invalid_return_type")f(x.returnTypeError);else if(x.code==="invalid_arguments")f(x.argumentsError);else if(x.path.length===0)l._errors.push(i(x));else{let o=l,A=0;for(;A<x.path.length;){const I=x.path[A];A===x.path.length-1?(o[I]=o[I]||{_errors:[]},o[I]._errors.push(i(x))):o[I]=o[I]||{_errors:[]},o=o[I],A++}}};return f(this),l}static assert(t){if(!(t instanceof xc))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,cs.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=i=>i.message){const i={},l=[];for(const f of this.issues)if(f.path.length>0){const _=f.path[0];i[_]=i[_]||[],i[_].push(t(f))}else l.push(t(f));return{formErrors:l,fieldErrors:i}}get formErrors(){return this.flatten()}}xc.create=e=>new xc(e);const zI=(e,t)=>{let i;switch(e.code){case Rr.invalid_type:e.received===bn.undefined?i="Required":i=`Expected ${e.expected}, received ${e.received}`;break;case Rr.invalid_literal:i=`Invalid literal value, expected ${JSON.stringify(e.expected,cs.jsonStringifyReplacer)}`;break;case Rr.unrecognized_keys:i=`Unrecognized key(s) in object: ${cs.joinValues(e.keys,", ")}`;break;case Rr.invalid_union:i="Invalid input";break;case Rr.invalid_union_discriminator:i=`Invalid discriminator value. Expected ${cs.joinValues(e.options)}`;break;case Rr.invalid_enum_value:i=`Invalid enum value. Expected ${cs.joinValues(e.options)}, received '${e.received}'`;break;case Rr.invalid_arguments:i="Invalid function arguments";break;case Rr.invalid_return_type:i="Invalid function return type";break;case Rr.invalid_date:i="Invalid date";break;case Rr.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(i=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(i=`${i} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?i=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?i=`Invalid input: must end with "${e.validation.endsWith}"`:cs.assertNever(e.validation):e.validation!=="regex"?i=`Invalid ${e.validation}`:i="Invalid";break;case Rr.too_small:e.type==="array"?i=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?i=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?i=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="bigint"?i=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?i=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:i="Invalid input";break;case Rr.too_big:e.type==="array"?i=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?i=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?i=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?i=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?i=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:i="Invalid input";break;case Rr.custom:i="Invalid input";break;case Rr.invalid_intersection_types:i="Intersection results could not be merged";break;case Rr.not_multiple_of:i=`Number must be a multiple of ${e.multipleOf}`;break;case Rr.not_finite:i="Number must be finite";break;default:i=t.defaultError,cs.assertNever(e)}return{message:i}};let ire=zI;function sre(){return ire}const ore=e=>{const{data:t,path:i,errorMaps:l,issueData:f}=e,_=[...i,...f.path||[]],x={...f,path:_};if(f.message!==void 0)return{...f,path:_,message:f.message};let o="";const A=l.filter(I=>!!I).slice().reverse();for(const I of A)o=I(x,{data:t,defaultError:o}).message;return{...f,path:_,message:o}};function cn(e,t){const i=sre(),l=ore({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,i,i===zI?void 0:zI].filter(f=>!!f)});e.common.issues.push(l)}class Wl{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,i){const l=[];for(const f of i){if(f.status==="aborted")return yi;f.status==="dirty"&&t.dirty(),l.push(f.value)}return{status:t.value,value:l}}static async mergeObjectAsync(t,i){const l=[];for(const f of i){const _=await f.key,x=await f.value;l.push({key:_,value:x})}return Wl.mergeObjectSync(t,l)}static mergeObjectSync(t,i){const l={};for(const f of i){const{key:_,value:x}=f;if(_.status==="aborted"||x.status==="aborted")return yi;_.status==="dirty"&&t.dirty(),x.status==="dirty"&&t.dirty(),_.value!=="__proto__"&&(typeof x.value<"u"||f.alwaysSet)&&(l[_.value]=x.value)}return{status:t.value,value:l}}}const yi=Object.freeze({status:"aborted"}),w0=e=>({status:"dirty",value:e}),Ac=e=>({status:"valid",value:e}),Mz=e=>e.status==="aborted",Nz=e=>e.status==="dirty",ky=e=>e.status==="valid",PT=e=>typeof Promise<"u"&&e instanceof Promise;var Sn;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(Sn||(Sn={}));class Vf{constructor(t,i,l,f){this._cachedPath=[],this.parent=t,this.data=i,this._path=l,this._key=f}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Dz=(e,t)=>{if(ky(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const i=new xc(e.common.issues);return this._error=i,this._error}}};function Bi(e){if(!e)return{};const{errorMap:t,invalid_type_error:i,required_error:l,description:f}=e;if(t&&(i||l))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:f}:{errorMap:(x,o)=>{const{message:A}=e;return x.code==="invalid_enum_value"?{message:A??o.defaultError}:typeof o.data>"u"?{message:A??l??o.defaultError}:x.code!=="invalid_type"?{message:o.defaultError}:{message:A??i??o.defaultError}},description:f}}class as{get description(){return this._def.description}_getType(t){return sf(t.data)}_getOrReturnCtx(t,i){return i||{common:t.parent.common,data:t.data,parsedType:sf(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new Wl,ctx:{common:t.parent.common,data:t.data,parsedType:sf(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const i=this._parse(t);if(PT(i))throw new Error("Synchronous parse encountered promise.");return i}_parseAsync(t){const i=this._parse(t);return Promise.resolve(i)}parse(t,i){const l=this.safeParse(t,i);if(l.success)return l.data;throw l.error}safeParse(t,i){const l={common:{issues:[],async:(i==null?void 0:i.async)??!1,contextualErrorMap:i==null?void 0:i.errorMap},path:(i==null?void 0:i.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:sf(t)},f=this._parseSync({data:t,path:l.path,parent:l});return Dz(l,f)}"~validate"(t){var l,f;const i={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:sf(t)};if(!this["~standard"].async)try{const _=this._parseSync({data:t,path:[],parent:i});return ky(_)?{value:_.value}:{issues:i.common.issues}}catch(_){(f=(l=_==null?void 0:_.message)==null?void 0:l.toLowerCase())!=null&&f.includes("encountered")&&(this["~standard"].async=!0),i.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:i}).then(_=>ky(_)?{value:_.value}:{issues:i.common.issues})}async parseAsync(t,i){const l=await this.safeParseAsync(t,i);if(l.success)return l.data;throw l.error}async safeParseAsync(t,i){const l={common:{issues:[],contextualErrorMap:i==null?void 0:i.errorMap,async:!0},path:(i==null?void 0:i.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:sf(t)},f=this._parse({data:t,path:l.path,parent:l}),_=await(PT(f)?f:Promise.resolve(f));return Dz(l,_)}refine(t,i){const l=f=>typeof i=="string"||typeof i>"u"?{message:i}:typeof i=="function"?i(f):i;return this._refinement((f,_)=>{const x=t(f),o=()=>_.addIssue({code:Rr.custom,...l(f)});return typeof Promise<"u"&&x instanceof Promise?x.then(A=>A?!0:(o(),!1)):x?!0:(o(),!1)})}refinement(t,i){return this._refinement((l,f)=>t(l)?!0:(f.addIssue(typeof i=="function"?i(l,f):i),!1))}_refinement(t){return new My({schema:this,typeName:vi.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:i=>this["~validate"](i)}}optional(){return Rf.create(this,this._def)}nullable(){return Ny.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Qu.create(this)}promise(){return DT.create(this,this._def)}or(t){return MT.create([this,t],this._def)}and(t){return NT.create(this,t,this._def)}transform(t){return new My({...Bi(this._def),schema:this,typeName:vi.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const i=typeof t=="function"?t:()=>t;return new BI({...Bi(this._def),innerType:this,defaultValue:i,typeName:vi.ZodDefault})}brand(){return new Ire({typeName:vi.ZodBranded,type:this,...Bi(this._def)})}catch(t){const i=typeof t=="function"?t:()=>t;return new VI({...Bi(this._def),innerType:this,catchValue:i,typeName:vi.ZodCatch})}describe(t){const i=this.constructor;return new i({...this._def,description:t})}pipe(t){return MP.create(this,t)}readonly(){return UI.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const are=/^c[^\s-]{8,}$/i,lre=/^[0-9a-z]+$/,cre=/^[0-9A-HJKMNP-TV-Z]{26}$/i,ure=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,dre=/^[a-z0-9_-]{21}$/i,hre=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,fre=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,pre=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,mre="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let NA;const gre=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,_re=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,yre=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,vre=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,xre=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,bre=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,uU="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",wre=new RegExp(`^${uU}$`);function dU(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`);const i=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${i}`}function Sre(e){return new RegExp(`^${dU(e)}$`)}function Tre(e){let t=`${uU}T${dU(e)}`;const i=[];return i.push(e.local?"Z?":"Z"),e.offset&&i.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${i.join("|")})`,new RegExp(`^${t}$`)}function Ere(e,t){return!!((t==="v4"||!t)&&gre.test(e)||(t==="v6"||!t)&&yre.test(e))}function Cre(e,t){if(!hre.test(e))return!1;try{const[i]=e.split(".");if(!i)return!1;const l=i.replace(/-/g,"+").replace(/_/g,"/").padEnd(i.length+(4-i.length%4)%4,"="),f=JSON.parse(atob(l));return!(typeof f!="object"||f===null||"typ"in f&&(f==null?void 0:f.typ)!=="JWT"||!f.alg||t&&f.alg!==t)}catch{return!1}}function Are(e,t){return!!((t==="v4"||!t)&&_re.test(e)||(t==="v6"||!t)&&vre.test(e))}class Ud extends as{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==bn.string){const _=this._getOrReturnCtx(t);return cn(_,{code:Rr.invalid_type,expected:bn.string,received:_.parsedType}),yi}const l=new Wl;let f;for(const _ of this._def.checks)if(_.kind==="min")t.data.length<_.value&&(f=this._getOrReturnCtx(t,f),cn(f,{code:Rr.too_small,minimum:_.value,type:"string",inclusive:!0,exact:!1,message:_.message}),l.dirty());else if(_.kind==="max")t.data.length>_.value&&(f=this._getOrReturnCtx(t,f),cn(f,{code:Rr.too_big,maximum:_.value,type:"string",inclusive:!0,exact:!1,message:_.message}),l.dirty());else if(_.kind==="length"){const x=t.data.length>_.value,o=t.data.length<_.value;(x||o)&&(f=this._getOrReturnCtx(t,f),x?cn(f,{code:Rr.too_big,maximum:_.value,type:"string",inclusive:!0,exact:!0,message:_.message}):o&&cn(f,{code:Rr.too_small,minimum:_.value,type:"string",inclusive:!0,exact:!0,message:_.message}),l.dirty())}else if(_.kind==="email")pre.test(t.data)||(f=this._getOrReturnCtx(t,f),cn(f,{validation:"email",code:Rr.invalid_string,message:_.message}),l.dirty());else if(_.kind==="emoji")NA||(NA=new RegExp(mre,"u")),NA.test(t.data)||(f=this._getOrReturnCtx(t,f),cn(f,{validation:"emoji",code:Rr.invalid_string,message:_.message}),l.dirty());else if(_.kind==="uuid")ure.test(t.data)||(f=this._getOrReturnCtx(t,f),cn(f,{validation:"uuid",code:Rr.invalid_string,message:_.message}),l.dirty());else if(_.kind==="nanoid")dre.test(t.data)||(f=this._getOrReturnCtx(t,f),cn(f,{validation:"nanoid",code:Rr.invalid_string,message:_.message}),l.dirty());else if(_.kind==="cuid")are.test(t.data)||(f=this._getOrReturnCtx(t,f),cn(f,{validation:"cuid",code:Rr.invalid_string,message:_.message}),l.dirty());else if(_.kind==="cuid2")lre.test(t.data)||(f=this._getOrReturnCtx(t,f),cn(f,{validation:"cuid2",code:Rr.invalid_string,message:_.message}),l.dirty());else if(_.kind==="ulid")cre.test(t.data)||(f=this._getOrReturnCtx(t,f),cn(f,{validation:"ulid",code:Rr.invalid_string,message:_.message}),l.dirty());else if(_.kind==="url")try{new URL(t.data)}catch{f=this._getOrReturnCtx(t,f),cn(f,{validation:"url",code:Rr.invalid_string,message:_.message}),l.dirty()}else _.kind==="regex"?(_.regex.lastIndex=0,_.regex.test(t.data)||(f=this._getOrReturnCtx(t,f),cn(f,{validation:"regex",code:Rr.invalid_string,message:_.message}),l.dirty())):_.kind==="trim"?t.data=t.data.trim():_.kind==="includes"?t.data.includes(_.value,_.position)||(f=this._getOrReturnCtx(t,f),cn(f,{code:Rr.invalid_string,validation:{includes:_.value,position:_.position},message:_.message}),l.dirty()):_.kind==="toLowerCase"?t.data=t.data.toLowerCase():_.kind==="toUpperCase"?t.data=t.data.toUpperCase():_.kind==="startsWith"?t.data.startsWith(_.value)||(f=this._getOrReturnCtx(t,f),cn(f,{code:Rr.invalid_string,validation:{startsWith:_.value},message:_.message}),l.dirty()):_.kind==="endsWith"?t.data.endsWith(_.value)||(f=this._getOrReturnCtx(t,f),cn(f,{code:Rr.invalid_string,validation:{endsWith:_.value},message:_.message}),l.dirty()):_.kind==="datetime"?Tre(_).test(t.data)||(f=this._getOrReturnCtx(t,f),cn(f,{code:Rr.invalid_string,validation:"datetime",message:_.message}),l.dirty()):_.kind==="date"?wre.test(t.data)||(f=this._getOrReturnCtx(t,f),cn(f,{code:Rr.invalid_string,validation:"date",message:_.message}),l.dirty()):_.kind==="time"?Sre(_).test(t.data)||(f=this._getOrReturnCtx(t,f),cn(f,{code:Rr.invalid_string,validation:"time",message:_.message}),l.dirty()):_.kind==="duration"?fre.test(t.data)||(f=this._getOrReturnCtx(t,f),cn(f,{validation:"duration",code:Rr.invalid_string,message:_.message}),l.dirty()):_.kind==="ip"?Ere(t.data,_.version)||(f=this._getOrReturnCtx(t,f),cn(f,{validation:"ip",code:Rr.invalid_string,message:_.message}),l.dirty()):_.kind==="jwt"?Cre(t.data,_.alg)||(f=this._getOrReturnCtx(t,f),cn(f,{validation:"jwt",code:Rr.invalid_string,message:_.message}),l.dirty()):_.kind==="cidr"?Are(t.data,_.version)||(f=this._getOrReturnCtx(t,f),cn(f,{validation:"cidr",code:Rr.invalid_string,message:_.message}),l.dirty()):_.kind==="base64"?xre.test(t.data)||(f=this._getOrReturnCtx(t,f),cn(f,{validation:"base64",code:Rr.invalid_string,message:_.message}),l.dirty()):_.kind==="base64url"?bre.test(t.data)||(f=this._getOrReturnCtx(t,f),cn(f,{validation:"base64url",code:Rr.invalid_string,message:_.message}),l.dirty()):cs.assertNever(_);return{status:l.value,value:t.data}}_regex(t,i,l){return this.refinement(f=>t.test(f),{validation:i,code:Rr.invalid_string,...Sn.errToObj(l)})}_addCheck(t){return new Ud({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...Sn.errToObj(t)})}url(t){return this._addCheck({kind:"url",...Sn.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...Sn.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...Sn.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...Sn.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...Sn.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...Sn.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...Sn.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...Sn.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",...Sn.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",...Sn.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...Sn.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",...Sn.errToObj(t)})}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(t==null?void 0:t.offset)??!1,local:(t==null?void 0:t.local)??!1,...Sn.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,...Sn.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",...Sn.errToObj(t)})}regex(t,i){return this._addCheck({kind:"regex",regex:t,...Sn.errToObj(i)})}includes(t,i){return this._addCheck({kind:"includes",value:t,position:i==null?void 0:i.position,...Sn.errToObj(i==null?void 0:i.message)})}startsWith(t,i){return this._addCheck({kind:"startsWith",value:t,...Sn.errToObj(i)})}endsWith(t,i){return this._addCheck({kind:"endsWith",value:t,...Sn.errToObj(i)})}min(t,i){return this._addCheck({kind:"min",value:t,...Sn.errToObj(i)})}max(t,i){return this._addCheck({kind:"max",value:t,...Sn.errToObj(i)})}length(t,i){return this._addCheck({kind:"length",value:t,...Sn.errToObj(i)})}nonempty(t){return this.min(1,Sn.errToObj(t))}trim(){return new Ud({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Ud({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Ud({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(const i of this._def.checks)i.kind==="min"&&(t===null||i.value>t)&&(t=i.value);return t}get maxLength(){let t=null;for(const i of this._def.checks)i.kind==="max"&&(t===null||i.value<t)&&(t=i.value);return t}}Ud.create=e=>new Ud({checks:[],typeName:vi.ZodString,coerce:(e==null?void 0:e.coerce)??!1,...Bi(e)});function jre(e,t){const i=(e.toString().split(".")[1]||"").length,l=(t.toString().split(".")[1]||"").length,f=i>l?i:l,_=Number.parseInt(e.toFixed(f).replace(".","")),x=Number.parseInt(t.toFixed(f).replace(".",""));return _%x/10**f}class Om extends as{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==bn.number){const _=this._getOrReturnCtx(t);return cn(_,{code:Rr.invalid_type,expected:bn.number,received:_.parsedType}),yi}let l;const f=new Wl;for(const _ of this._def.checks)_.kind==="int"?cs.isInteger(t.data)||(l=this._getOrReturnCtx(t,l),cn(l,{code:Rr.invalid_type,expected:"integer",received:"float",message:_.message}),f.dirty()):_.kind==="min"?(_.inclusive?t.data<_.value:t.data<=_.value)&&(l=this._getOrReturnCtx(t,l),cn(l,{code:Rr.too_small,minimum:_.value,type:"number",inclusive:_.inclusive,exact:!1,message:_.message}),f.dirty()):_.kind==="max"?(_.inclusive?t.data>_.value:t.data>=_.value)&&(l=this._getOrReturnCtx(t,l),cn(l,{code:Rr.too_big,maximum:_.value,type:"number",inclusive:_.inclusive,exact:!1,message:_.message}),f.dirty()):_.kind==="multipleOf"?jre(t.data,_.value)!==0&&(l=this._getOrReturnCtx(t,l),cn(l,{code:Rr.not_multiple_of,multipleOf:_.value,message:_.message}),f.dirty()):_.kind==="finite"?Number.isFinite(t.data)||(l=this._getOrReturnCtx(t,l),cn(l,{code:Rr.not_finite,message:_.message}),f.dirty()):cs.assertNever(_);return{status:f.value,value:t.data}}gte(t,i){return this.setLimit("min",t,!0,Sn.toString(i))}gt(t,i){return this.setLimit("min",t,!1,Sn.toString(i))}lte(t,i){return this.setLimit("max",t,!0,Sn.toString(i))}lt(t,i){return this.setLimit("max",t,!1,Sn.toString(i))}setLimit(t,i,l,f){return new Om({...this._def,checks:[...this._def.checks,{kind:t,value:i,inclusive:l,message:Sn.toString(f)}]})}_addCheck(t){return new Om({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:Sn.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Sn.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Sn.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Sn.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Sn.toString(t)})}multipleOf(t,i){return this._addCheck({kind:"multipleOf",value:t,message:Sn.toString(i)})}finite(t){return this._addCheck({kind:"finite",message:Sn.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Sn.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Sn.toString(t)})}get minValue(){let t=null;for(const i of this._def.checks)i.kind==="min"&&(t===null||i.value>t)&&(t=i.value);return t}get maxValue(){let t=null;for(const i of this._def.checks)i.kind==="max"&&(t===null||i.value<t)&&(t=i.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&cs.isInteger(t.value))}get isFinite(){let t=null,i=null;for(const l of this._def.checks){if(l.kind==="finite"||l.kind==="int"||l.kind==="multipleOf")return!0;l.kind==="min"?(i===null||l.value>i)&&(i=l.value):l.kind==="max"&&(t===null||l.value<t)&&(t=l.value)}return Number.isFinite(i)&&Number.isFinite(t)}}Om.create=e=>new Om({checks:[],typeName:vi.ZodNumber,coerce:(e==null?void 0:e.coerce)||!1,...Bi(e)});class Lm extends as{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==bn.bigint)return this._getInvalidInput(t);let l;const f=new Wl;for(const _ of this._def.checks)_.kind==="min"?(_.inclusive?t.data<_.value:t.data<=_.value)&&(l=this._getOrReturnCtx(t,l),cn(l,{code:Rr.too_small,type:"bigint",minimum:_.value,inclusive:_.inclusive,message:_.message}),f.dirty()):_.kind==="max"?(_.inclusive?t.data>_.value:t.data>=_.value)&&(l=this._getOrReturnCtx(t,l),cn(l,{code:Rr.too_big,type:"bigint",maximum:_.value,inclusive:_.inclusive,message:_.message}),f.dirty()):_.kind==="multipleOf"?t.data%_.value!==BigInt(0)&&(l=this._getOrReturnCtx(t,l),cn(l,{code:Rr.not_multiple_of,multipleOf:_.value,message:_.message}),f.dirty()):cs.assertNever(_);return{status:f.value,value:t.data}}_getInvalidInput(t){const i=this._getOrReturnCtx(t);return cn(i,{code:Rr.invalid_type,expected:bn.bigint,received:i.parsedType}),yi}gte(t,i){return this.setLimit("min",t,!0,Sn.toString(i))}gt(t,i){return this.setLimit("min",t,!1,Sn.toString(i))}lte(t,i){return this.setLimit("max",t,!0,Sn.toString(i))}lt(t,i){return this.setLimit("max",t,!1,Sn.toString(i))}setLimit(t,i,l,f){return new Lm({...this._def,checks:[...this._def.checks,{kind:t,value:i,inclusive:l,message:Sn.toString(f)}]})}_addCheck(t){return new Lm({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Sn.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Sn.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Sn.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Sn.toString(t)})}multipleOf(t,i){return this._addCheck({kind:"multipleOf",value:t,message:Sn.toString(i)})}get minValue(){let t=null;for(const i of this._def.checks)i.kind==="min"&&(t===null||i.value>t)&&(t=i.value);return t}get maxValue(){let t=null;for(const i of this._def.checks)i.kind==="max"&&(t===null||i.value<t)&&(t=i.value);return t}}Lm.create=e=>new Lm({checks:[],typeName:vi.ZodBigInt,coerce:(e==null?void 0:e.coerce)??!1,...Bi(e)});class RT extends as{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==bn.boolean){const l=this._getOrReturnCtx(t);return cn(l,{code:Rr.invalid_type,expected:bn.boolean,received:l.parsedType}),yi}return Ac(t.data)}}RT.create=e=>new RT({typeName:vi.ZodBoolean,coerce:(e==null?void 0:e.coerce)||!1,...Bi(e)});class Py extends as{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==bn.date){const _=this._getOrReturnCtx(t);return cn(_,{code:Rr.invalid_type,expected:bn.date,received:_.parsedType}),yi}if(Number.isNaN(t.data.getTime())){const _=this._getOrReturnCtx(t);return cn(_,{code:Rr.invalid_date}),yi}const l=new Wl;let f;for(const _ of this._def.checks)_.kind==="min"?t.data.getTime()<_.value&&(f=this._getOrReturnCtx(t,f),cn(f,{code:Rr.too_small,message:_.message,inclusive:!0,exact:!1,minimum:_.value,type:"date"}),l.dirty()):_.kind==="max"?t.data.getTime()>_.value&&(f=this._getOrReturnCtx(t,f),cn(f,{code:Rr.too_big,message:_.message,inclusive:!0,exact:!1,maximum:_.value,type:"date"}),l.dirty()):cs.assertNever(_);return{status:l.value,value:new Date(t.data.getTime())}}_addCheck(t){return new Py({...this._def,checks:[...this._def.checks,t]})}min(t,i){return this._addCheck({kind:"min",value:t.getTime(),message:Sn.toString(i)})}max(t,i){return this._addCheck({kind:"max",value:t.getTime(),message:Sn.toString(i)})}get minDate(){let t=null;for(const i of this._def.checks)i.kind==="min"&&(t===null||i.value>t)&&(t=i.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const i of this._def.checks)i.kind==="max"&&(t===null||i.value<t)&&(t=i.value);return t!=null?new Date(t):null}}Py.create=e=>new Py({checks:[],coerce:(e==null?void 0:e.coerce)||!1,typeName:vi.ZodDate,...Bi(e)});class Oz extends as{_parse(t){if(this._getType(t)!==bn.symbol){const l=this._getOrReturnCtx(t);return cn(l,{code:Rr.invalid_type,expected:bn.symbol,received:l.parsedType}),yi}return Ac(t.data)}}Oz.create=e=>new Oz({typeName:vi.ZodSymbol,...Bi(e)});class Lz extends as{_parse(t){if(this._getType(t)!==bn.undefined){const l=this._getOrReturnCtx(t);return cn(l,{code:Rr.invalid_type,expected:bn.undefined,received:l.parsedType}),yi}return Ac(t.data)}}Lz.create=e=>new Lz({typeName:vi.ZodUndefined,...Bi(e)});class zz extends as{_parse(t){if(this._getType(t)!==bn.null){const l=this._getOrReturnCtx(t);return cn(l,{code:Rr.invalid_type,expected:bn.null,received:l.parsedType}),yi}return Ac(t.data)}}zz.create=e=>new zz({typeName:vi.ZodNull,...Bi(e)});class Fz extends as{constructor(){super(...arguments),this._any=!0}_parse(t){return Ac(t.data)}}Fz.create=e=>new Fz({typeName:vi.ZodAny,...Bi(e)});class Bz extends as{constructor(){super(...arguments),this._unknown=!0}_parse(t){return Ac(t.data)}}Bz.create=e=>new Bz({typeName:vi.ZodUnknown,...Bi(e)});class Uf extends as{_parse(t){const i=this._getOrReturnCtx(t);return cn(i,{code:Rr.invalid_type,expected:bn.never,received:i.parsedType}),yi}}Uf.create=e=>new Uf({typeName:vi.ZodNever,...Bi(e)});class Vz extends as{_parse(t){if(this._getType(t)!==bn.undefined){const l=this._getOrReturnCtx(t);return cn(l,{code:Rr.invalid_type,expected:bn.void,received:l.parsedType}),yi}return Ac(t.data)}}Vz.create=e=>new Vz({typeName:vi.ZodVoid,...Bi(e)});class Qu extends as{_parse(t){const{ctx:i,status:l}=this._processInputParams(t),f=this._def;if(i.parsedType!==bn.array)return cn(i,{code:Rr.invalid_type,expected:bn.array,received:i.parsedType}),yi;if(f.exactLength!==null){const x=i.data.length>f.exactLength.value,o=i.data.length<f.exactLength.value;(x||o)&&(cn(i,{code:x?Rr.too_big:Rr.too_small,minimum:o?f.exactLength.value:void 0,maximum:x?f.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:f.exactLength.message}),l.dirty())}if(f.minLength!==null&&i.data.length<f.minLength.value&&(cn(i,{code:Rr.too_small,minimum:f.minLength.value,type:"array",inclusive:!0,exact:!1,message:f.minLength.message}),l.dirty()),f.maxLength!==null&&i.data.length>f.maxLength.value&&(cn(i,{code:Rr.too_big,maximum:f.maxLength.value,type:"array",inclusive:!0,exact:!1,message:f.maxLength.message}),l.dirty()),i.common.async)return Promise.all([...i.data].map((x,o)=>f.type._parseAsync(new Vf(i,x,i.path,o)))).then(x=>Wl.mergeArray(l,x));const _=[...i.data].map((x,o)=>f.type._parseSync(new Vf(i,x,i.path,o)));return Wl.mergeArray(l,_)}get element(){return this._def.type}min(t,i){return new Qu({...this._def,minLength:{value:t,message:Sn.toString(i)}})}max(t,i){return new Qu({...this._def,maxLength:{value:t,message:Sn.toString(i)}})}length(t,i){return new Qu({...this._def,exactLength:{value:t,message:Sn.toString(i)}})}nonempty(t){return this.min(1,t)}}Qu.create=(e,t)=>new Qu({type:e,minLength:null,maxLength:null,exactLength:null,typeName:vi.ZodArray,...Bi(t)});function M_(e){if(e instanceof vo){const t={};for(const i in e.shape){const l=e.shape[i];t[i]=Rf.create(M_(l))}return new vo({...e._def,shape:()=>t})}else return e instanceof Qu?new Qu({...e._def,type:M_(e.element)}):e instanceof Rf?Rf.create(M_(e.unwrap())):e instanceof Ny?Ny.create(M_(e.unwrap())):e instanceof zm?zm.create(e.items.map(t=>M_(t))):e}class vo extends as{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),i=cs.objectKeys(t);return this._cached={shape:t,keys:i},this._cached}_parse(t){if(this._getType(t)!==bn.object){const I=this._getOrReturnCtx(t);return cn(I,{code:Rr.invalid_type,expected:bn.object,received:I.parsedType}),yi}const{status:l,ctx:f}=this._processInputParams(t),{shape:_,keys:x}=this._getCached(),o=[];if(!(this._def.catchall instanceof Uf&&this._def.unknownKeys==="strip"))for(const I in f.data)x.includes(I)||o.push(I);const A=[];for(const I of x){const N=_[I],U=f.data[I];A.push({key:{status:"valid",value:I},value:N._parse(new Vf(f,U,f.path,I)),alwaysSet:I in f.data})}if(this._def.catchall instanceof Uf){const I=this._def.unknownKeys;if(I==="passthrough")for(const N of o)A.push({key:{status:"valid",value:N},value:{status:"valid",value:f.data[N]}});else if(I==="strict")o.length>0&&(cn(f,{code:Rr.unrecognized_keys,keys:o}),l.dirty());else if(I!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const I=this._def.catchall;for(const N of o){const U=f.data[N];A.push({key:{status:"valid",value:N},value:I._parse(new Vf(f,U,f.path,N)),alwaysSet:N in f.data})}}return f.common.async?Promise.resolve().then(async()=>{const I=[];for(const N of A){const U=await N.key,$=await N.value;I.push({key:U,value:$,alwaysSet:N.alwaysSet})}return I}).then(I=>Wl.mergeObjectSync(l,I)):Wl.mergeObjectSync(l,A)}get shape(){return this._def.shape()}strict(t){return Sn.errToObj,new vo({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(i,l)=>{var _,x;const f=((x=(_=this._def).errorMap)==null?void 0:x.call(_,i,l).message)??l.defaultError;return i.code==="unrecognized_keys"?{message:Sn.errToObj(t).message??f}:{message:f}}}:{}})}strip(){return new vo({...this._def,unknownKeys:"strip"})}passthrough(){return new vo({...this._def,unknownKeys:"passthrough"})}extend(t){return new vo({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new vo({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:vi.ZodObject})}setKey(t,i){return this.augment({[t]:i})}catchall(t){return new vo({...this._def,catchall:t})}pick(t){const i={};for(const l of cs.objectKeys(t))t[l]&&this.shape[l]&&(i[l]=this.shape[l]);return new vo({...this._def,shape:()=>i})}omit(t){const i={};for(const l of cs.objectKeys(this.shape))t[l]||(i[l]=this.shape[l]);return new vo({...this._def,shape:()=>i})}deepPartial(){return M_(this)}partial(t){const i={};for(const l of cs.objectKeys(this.shape)){const f=this.shape[l];t&&!t[l]?i[l]=f:i[l]=f.optional()}return new vo({...this._def,shape:()=>i})}required(t){const i={};for(const l of cs.objectKeys(this.shape))if(t&&!t[l])i[l]=this.shape[l];else{let _=this.shape[l];for(;_ instanceof Rf;)_=_._def.innerType;i[l]=_}return new vo({...this._def,shape:()=>i})}keyof(){return hU(cs.objectKeys(this.shape))}}vo.create=(e,t)=>new vo({shape:()=>e,unknownKeys:"strip",catchall:Uf.create(),typeName:vi.ZodObject,...Bi(t)});vo.strictCreate=(e,t)=>new vo({shape:()=>e,unknownKeys:"strict",catchall:Uf.create(),typeName:vi.ZodObject,...Bi(t)});vo.lazycreate=(e,t)=>new vo({shape:e,unknownKeys:"strip",catchall:Uf.create(),typeName:vi.ZodObject,...Bi(t)});class MT extends as{_parse(t){const{ctx:i}=this._processInputParams(t),l=this._def.options;function f(_){for(const o of _)if(o.result.status==="valid")return o.result;for(const o of _)if(o.result.status==="dirty")return i.common.issues.push(...o.ctx.common.issues),o.result;const x=_.map(o=>new xc(o.ctx.common.issues));return cn(i,{code:Rr.invalid_union,unionErrors:x}),yi}if(i.common.async)return Promise.all(l.map(async _=>{const x={...i,common:{...i.common,issues:[]},parent:null};return{result:await _._parseAsync({data:i.data,path:i.path,parent:x}),ctx:x}})).then(f);{let _;const x=[];for(const A of l){const I={...i,common:{...i.common,issues:[]},parent:null},N=A._parseSync({data:i.data,path:i.path,parent:I});if(N.status==="valid")return N;N.status==="dirty"&&!_&&(_={result:N,ctx:I}),I.common.issues.length&&x.push(I.common.issues)}if(_)return i.common.issues.push(..._.ctx.common.issues),_.result;const o=x.map(A=>new xc(A));return cn(i,{code:Rr.invalid_union,unionErrors:o}),yi}}get options(){return this._def.options}}MT.create=(e,t)=>new MT({options:e,typeName:vi.ZodUnion,...Bi(t)});function FI(e,t){const i=sf(e),l=sf(t);if(e===t)return{valid:!0,data:e};if(i===bn.object&&l===bn.object){const f=cs.objectKeys(t),_=cs.objectKeys(e).filter(o=>f.indexOf(o)!==-1),x={...e,...t};for(const o of _){const A=FI(e[o],t[o]);if(!A.valid)return{valid:!1};x[o]=A.data}return{valid:!0,data:x}}else if(i===bn.array&&l===bn.array){if(e.length!==t.length)return{valid:!1};const f=[];for(let _=0;_<e.length;_++){const x=e[_],o=t[_],A=FI(x,o);if(!A.valid)return{valid:!1};f.push(A.data)}return{valid:!0,data:f}}else return i===bn.date&&l===bn.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class NT extends as{_parse(t){const{status:i,ctx:l}=this._processInputParams(t),f=(_,x)=>{if(Mz(_)||Mz(x))return yi;const o=FI(_.value,x.value);return o.valid?((Nz(_)||Nz(x))&&i.dirty(),{status:i.value,value:o.data}):(cn(l,{code:Rr.invalid_intersection_types}),yi)};return l.common.async?Promise.all([this._def.left._parseAsync({data:l.data,path:l.path,parent:l}),this._def.right._parseAsync({data:l.data,path:l.path,parent:l})]).then(([_,x])=>f(_,x)):f(this._def.left._parseSync({data:l.data,path:l.path,parent:l}),this._def.right._parseSync({data:l.data,path:l.path,parent:l}))}}NT.create=(e,t,i)=>new NT({left:e,right:t,typeName:vi.ZodIntersection,...Bi(i)});class zm extends as{_parse(t){const{status:i,ctx:l}=this._processInputParams(t);if(l.parsedType!==bn.array)return cn(l,{code:Rr.invalid_type,expected:bn.array,received:l.parsedType}),yi;if(l.data.length<this._def.items.length)return cn(l,{code:Rr.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),yi;!this._def.rest&&l.data.length>this._def.items.length&&(cn(l,{code:Rr.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),i.dirty());const _=[...l.data].map((x,o)=>{const A=this._def.items[o]||this._def.rest;return A?A._parse(new Vf(l,x,l.path,o)):null}).filter(x=>!!x);return l.common.async?Promise.all(_).then(x=>Wl.mergeArray(i,x)):Wl.mergeArray(i,_)}get items(){return this._def.items}rest(t){return new zm({...this._def,rest:t})}}zm.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new zm({items:e,typeName:vi.ZodTuple,rest:null,...Bi(t)})};class Uz extends as{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:i,ctx:l}=this._processInputParams(t);if(l.parsedType!==bn.map)return cn(l,{code:Rr.invalid_type,expected:bn.map,received:l.parsedType}),yi;const f=this._def.keyType,_=this._def.valueType,x=[...l.data.entries()].map(([o,A],I)=>({key:f._parse(new Vf(l,o,l.path,[I,"key"])),value:_._parse(new Vf(l,A,l.path,[I,"value"]))}));if(l.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const A of x){const I=await A.key,N=await A.value;if(I.status==="aborted"||N.status==="aborted")return yi;(I.status==="dirty"||N.status==="dirty")&&i.dirty(),o.set(I.value,N.value)}return{status:i.value,value:o}})}else{const o=new Map;for(const A of x){const I=A.key,N=A.value;if(I.status==="aborted"||N.status==="aborted")return yi;(I.status==="dirty"||N.status==="dirty")&&i.dirty(),o.set(I.value,N.value)}return{status:i.value,value:o}}}}Uz.create=(e,t,i)=>new Uz({valueType:t,keyType:e,typeName:vi.ZodMap,...Bi(i)});class gb extends as{_parse(t){const{status:i,ctx:l}=this._processInputParams(t);if(l.parsedType!==bn.set)return cn(l,{code:Rr.invalid_type,expected:bn.set,received:l.parsedType}),yi;const f=this._def;f.minSize!==null&&l.data.size<f.minSize.value&&(cn(l,{code:Rr.too_small,minimum:f.minSize.value,type:"set",inclusive:!0,exact:!1,message:f.minSize.message}),i.dirty()),f.maxSize!==null&&l.data.size>f.maxSize.value&&(cn(l,{code:Rr.too_big,maximum:f.maxSize.value,type:"set",inclusive:!0,exact:!1,message:f.maxSize.message}),i.dirty());const _=this._def.valueType;function x(A){const I=new Set;for(const N of A){if(N.status==="aborted")return yi;N.status==="dirty"&&i.dirty(),I.add(N.value)}return{status:i.value,value:I}}const o=[...l.data.values()].map((A,I)=>_._parse(new Vf(l,A,l.path,I)));return l.common.async?Promise.all(o).then(A=>x(A)):x(o)}min(t,i){return new gb({...this._def,minSize:{value:t,message:Sn.toString(i)}})}max(t,i){return new gb({...this._def,maxSize:{value:t,message:Sn.toString(i)}})}size(t,i){return this.min(t,i).max(t,i)}nonempty(t){return this.min(1,t)}}gb.create=(e,t)=>new gb({valueType:e,minSize:null,maxSize:null,typeName:vi.ZodSet,...Bi(t)});class $z extends as{get schema(){return this._def.getter()}_parse(t){const{ctx:i}=this._processInputParams(t);return this._def.getter()._parse({data:i.data,path:i.path,parent:i})}}$z.create=(e,t)=>new $z({getter:e,typeName:vi.ZodLazy,...Bi(t)});class qz extends as{_parse(t){if(t.data!==this._def.value){const i=this._getOrReturnCtx(t);return cn(i,{received:i.data,code:Rr.invalid_literal,expected:this._def.value}),yi}return{status:"valid",value:t.data}}get value(){return this._def.value}}qz.create=(e,t)=>new qz({value:e,typeName:vi.ZodLiteral,...Bi(t)});function hU(e,t){return new Ry({values:e,typeName:vi.ZodEnum,...Bi(t)})}class Ry extends as{_parse(t){if(typeof t.data!="string"){const i=this._getOrReturnCtx(t),l=this._def.values;return cn(i,{expected:cs.joinValues(l),received:i.parsedType,code:Rr.invalid_type}),yi}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){const i=this._getOrReturnCtx(t),l=this._def.values;return cn(i,{received:i.data,code:Rr.invalid_enum_value,options:l}),yi}return Ac(t.data)}get options(){return this._def.values}get enum(){const t={};for(const i of this._def.values)t[i]=i;return t}get Values(){const t={};for(const i of this._def.values)t[i]=i;return t}get Enum(){const t={};for(const i of this._def.values)t[i]=i;return t}extract(t,i=this._def){return Ry.create(t,{...this._def,...i})}exclude(t,i=this._def){return Ry.create(this.options.filter(l=>!t.includes(l)),{...this._def,...i})}}Ry.create=hU;class Gz extends as{_parse(t){const i=cs.getValidEnumValues(this._def.values),l=this._getOrReturnCtx(t);if(l.parsedType!==bn.string&&l.parsedType!==bn.number){const f=cs.objectValues(i);return cn(l,{expected:cs.joinValues(f),received:l.parsedType,code:Rr.invalid_type}),yi}if(this._cache||(this._cache=new Set(cs.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){const f=cs.objectValues(i);return cn(l,{received:l.data,code:Rr.invalid_enum_value,options:f}),yi}return Ac(t.data)}get enum(){return this._def.values}}Gz.create=(e,t)=>new Gz({values:e,typeName:vi.ZodNativeEnum,...Bi(t)});class DT extends as{unwrap(){return this._def.type}_parse(t){const{ctx:i}=this._processInputParams(t);if(i.parsedType!==bn.promise&&i.common.async===!1)return cn(i,{code:Rr.invalid_type,expected:bn.promise,received:i.parsedType}),yi;const l=i.parsedType===bn.promise?i.data:Promise.resolve(i.data);return Ac(l.then(f=>this._def.type.parseAsync(f,{path:i.path,errorMap:i.common.contextualErrorMap})))}}DT.create=(e,t)=>new DT({type:e,typeName:vi.ZodPromise,...Bi(t)});class My extends as{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===vi.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:i,ctx:l}=this._processInputParams(t),f=this._def.effect||null,_={addIssue:x=>{cn(l,x),x.fatal?i.abort():i.dirty()},get path(){return l.path}};if(_.addIssue=_.addIssue.bind(_),f.type==="preprocess"){const x=f.transform(l.data,_);if(l.common.async)return Promise.resolve(x).then(async o=>{if(i.value==="aborted")return yi;const A=await this._def.schema._parseAsync({data:o,path:l.path,parent:l});return A.status==="aborted"?yi:A.status==="dirty"||i.value==="dirty"?w0(A.value):A});{if(i.value==="aborted")return yi;const o=this._def.schema._parseSync({data:x,path:l.path,parent:l});return o.status==="aborted"?yi:o.status==="dirty"||i.value==="dirty"?w0(o.value):o}}if(f.type==="refinement"){const x=o=>{const A=f.refinement(o,_);if(l.common.async)return Promise.resolve(A);if(A instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(l.common.async===!1){const o=this._def.schema._parseSync({data:l.data,path:l.path,parent:l});return o.status==="aborted"?yi:(o.status==="dirty"&&i.dirty(),x(o.value),{status:i.value,value:o.value})}else return this._def.schema._parseAsync({data:l.data,path:l.path,parent:l}).then(o=>o.status==="aborted"?yi:(o.status==="dirty"&&i.dirty(),x(o.value).then(()=>({status:i.value,value:o.value}))))}if(f.type==="transform")if(l.common.async===!1){const x=this._def.schema._parseSync({data:l.data,path:l.path,parent:l});if(!ky(x))return yi;const o=f.transform(x.value,_);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:i.value,value:o}}else return this._def.schema._parseAsync({data:l.data,path:l.path,parent:l}).then(x=>ky(x)?Promise.resolve(f.transform(x.value,_)).then(o=>({status:i.value,value:o})):yi);cs.assertNever(f)}}My.create=(e,t,i)=>new My({schema:e,typeName:vi.ZodEffects,effect:t,...Bi(i)});My.createWithPreprocess=(e,t,i)=>new My({schema:t,effect:{type:"preprocess",transform:e},typeName:vi.ZodEffects,...Bi(i)});class Rf extends as{_parse(t){return this._getType(t)===bn.undefined?Ac(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}Rf.create=(e,t)=>new Rf({innerType:e,typeName:vi.ZodOptional,...Bi(t)});class Ny extends as{_parse(t){return this._getType(t)===bn.null?Ac(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}Ny.create=(e,t)=>new Ny({innerType:e,typeName:vi.ZodNullable,...Bi(t)});class BI extends as{_parse(t){const{ctx:i}=this._processInputParams(t);let l=i.data;return i.parsedType===bn.undefined&&(l=this._def.defaultValue()),this._def.innerType._parse({data:l,path:i.path,parent:i})}removeDefault(){return this._def.innerType}}BI.create=(e,t)=>new BI({innerType:e,typeName:vi.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...Bi(t)});class VI extends as{_parse(t){const{ctx:i}=this._processInputParams(t),l={...i,common:{...i.common,issues:[]}},f=this._def.innerType._parse({data:l.data,path:l.path,parent:{...l}});return PT(f)?f.then(_=>({status:"valid",value:_.status==="valid"?_.value:this._def.catchValue({get error(){return new xc(l.common.issues)},input:l.data})})):{status:"valid",value:f.status==="valid"?f.value:this._def.catchValue({get error(){return new xc(l.common.issues)},input:l.data})}}removeCatch(){return this._def.innerType}}VI.create=(e,t)=>new VI({innerType:e,typeName:vi.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...Bi(t)});class Hz extends as{_parse(t){if(this._getType(t)!==bn.nan){const l=this._getOrReturnCtx(t);return cn(l,{code:Rr.invalid_type,expected:bn.nan,received:l.parsedType}),yi}return{status:"valid",value:t.data}}}Hz.create=e=>new Hz({typeName:vi.ZodNaN,...Bi(e)});class Ire extends as{_parse(t){const{ctx:i}=this._processInputParams(t),l=i.data;return this._def.type._parse({data:l,path:i.path,parent:i})}unwrap(){return this._def.type}}class MP extends as{_parse(t){const{status:i,ctx:l}=this._processInputParams(t);if(l.common.async)return(async()=>{const _=await this._def.in._parseAsync({data:l.data,path:l.path,parent:l});return _.status==="aborted"?yi:_.status==="dirty"?(i.dirty(),w0(_.value)):this._def.out._parseAsync({data:_.value,path:l.path,parent:l})})();{const f=this._def.in._parseSync({data:l.data,path:l.path,parent:l});return f.status==="aborted"?yi:f.status==="dirty"?(i.dirty(),{status:"dirty",value:f.value}):this._def.out._parseSync({data:f.value,path:l.path,parent:l})}}static create(t,i){return new MP({in:t,out:i,typeName:vi.ZodPipeline})}}class UI extends as{_parse(t){const i=this._def.innerType._parse(t),l=f=>(ky(f)&&(f.value=Object.freeze(f.value)),f);return PT(i)?i.then(f=>l(f)):l(i)}unwrap(){return this._def.innerType}}UI.create=(e,t)=>new UI({innerType:e,typeName:vi.ZodReadonly,...Bi(t)});vo.lazycreate;var vi;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(vi||(vi={}));const ca=Ud.create;Om.create;Lm.create;RT.create;Py.create;Uf.create;Qu.create;const Rb=vo.create;vo.strictCreate;MT.create;NT.create;zm.create;const mS=Ry.create;DT.create;Rf.create;Ny.create;const kre={string:e=>Ud.create({...e,coerce:!0}),number:e=>Om.create({...e,coerce:!0}),boolean:e=>RT.create({...e,coerce:!0}),bigint:e=>Lm.create({...e,coerce:!0}),date:e=>Py.create({...e,coerce:!0})},gr=F.forwardRef(({className:e,type:t,...i},l)=>d.jsx("input",{type:t,className:wr("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:l,...i}));gr.displayName="Input";var Pre="Label",fU=F.forwardRef((e,t)=>d.jsx(xi.label,{...e,ref:t,onMouseDown:i=>{var f;i.target.closest("button, input, select, textarea")||((f=e.onMouseDown)==null||f.call(e,i),!i.defaultPrevented&&i.detail>1&&i.preventDefault())}}));fU.displayName=Pre;var pU=fU;const Rre=By("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Gt=F.forwardRef(({className:e,...t},i)=>d.jsx(pU,{ref:i,className:wr(Rre(),e),...t}));Gt.displayName=pU.displayName;const Sr=F.forwardRef(({className:e,...t},i)=>d.jsx("div",{ref:i,className:wr("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));Sr.displayName="Card";const wn=F.forwardRef(({className:e,...t},i)=>d.jsx("div",{ref:i,className:wr("flex flex-col space-y-1.5 p-6",e),...t}));wn.displayName="CardHeader";const An=F.forwardRef(({className:e,...t},i)=>d.jsx("h3",{ref:i,className:wr("text-2xl font-semibold leading-none tracking-tight",e),...t}));An.displayName="CardTitle";const fs=F.forwardRef(({className:e,...t},i)=>d.jsx("p",{ref:i,className:wr("text-sm text-muted-foreground",e),...t}));fs.displayName="CardDescription";const tn=F.forwardRef(({className:e,...t},i)=>d.jsx("div",{ref:i,className:wr("p-6 pt-0",e),...t}));tn.displayName="CardContent";const Mre=F.forwardRef(({className:e,...t},i)=>d.jsx("div",{ref:i,className:wr("flex items-center p-6 pt-0",e),...t}));Mre.displayName="CardFooter";const Nre=async({to:e,subject:t,html:i,from:l})=>{try{const{data:f,error:_}=await Ge.functions.invoke("send-email",{body:{to:e,subject:t,html:i,from:l}});if(_)throw _;return{success:!0,data:f}}catch(f){return console.error("Error sending email:",f),{success:!1,error:f}}},Dre=async(e,t)=>{const i=`
    <!DOCTYPE html>
    <html>
      <head>
        <style>
          body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
          .container { max-width: 600px; margin: 0 auto; padding: 20px; }
          .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0; }
          .content { background: #f9fafb; padding: 30px; border-radius: 0 0 10px 10px; }
          .button { display: inline-block; background: #667eea; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px; margin: 20px 0; }
          .footer { text-align: center; margin-top: 20px; color: #6b7280; font-size: 14px; }
        </style>
      </head>
      <body>
        <div class="container">
          <div class="header">
            <h1>Bem-vindo ao Facilities Hub! </h1>
          </div>
          <div class="content">
            <h2>Ol, ${t}!</h2>
            <p>Estamos muito felizes em ter voc conosco no <strong>Facilities Hub</strong>, sua plataforma completa de gesto de facilities.</p>
            
            <p>Com o Facilities Hub voc poder:</p>
            <ul>
              <li>Gerenciar ordens de servio e manutenes</li>
              <li>Controlar ativos e equipamentos</li>
              <li>Acompanhar indicadores e relatrios</li>
              <li>Otimizar processos de facilities</li>
            </ul>
            
            <p>Sua conta foi criada com sucesso e voc j pode comear a explorar a plataforma.</p>
            
            <a href="${window.location.origin}/dashboard" class="button">Acessar Dashboard</a>
            
            <p>Se voc tiver alguma dvida ou precisar de ajuda, nossa equipe est sempre disponvel.</p>
            
            <p>Atenciosamente,<br><strong>Equipe Facilities Hub</strong></p>
          </div>
          <div class="footer">
            <p>Este  um email automtico, por favor no responda.</p>
          </div>
        </div>
      </body>
    </html>
  `;return Nre({to:e,subject:"Bem-vindo ao Facilities Hub!",html:i})};var DA="focusScope.autoFocusOnMount",OA="focusScope.autoFocusOnUnmount",Wz={bubbles:!1,cancelable:!0},Ore="FocusScope",NP=F.forwardRef((e,t)=>{const{loop:i=!1,trapped:l=!1,onMountAutoFocus:f,onUnmountAutoFocus:_,...x}=e,[o,A]=F.useState(null),I=vc(f),N=vc(_),U=F.useRef(null),$=bs(t,q=>A(q)),V=F.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;F.useEffect(()=>{if(l){let q=function(K){if(V.paused||!o)return;const ne=K.target;o.contains(ne)?U.current=ne:tf(U.current,{select:!0})},Z=function(K){if(V.paused||!o)return;const ne=K.relatedTarget;ne!==null&&(o.contains(ne)||tf(U.current,{select:!0}))},Q=function(K){if(document.activeElement===document.body)for(const le of K)le.removedNodes.length>0&&tf(o)};document.addEventListener("focusin",q),document.addEventListener("focusout",Z);const H=new MutationObserver(Q);return o&&H.observe(o,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",q),document.removeEventListener("focusout",Z),H.disconnect()}}},[l,o,V.paused]),F.useEffect(()=>{if(o){Xz.add(V);const q=document.activeElement;if(!o.contains(q)){const Q=new CustomEvent(DA,Wz);o.addEventListener(DA,I),o.dispatchEvent(Q),Q.defaultPrevented||(Lre(Ure(mU(o)),{select:!0}),document.activeElement===q&&tf(o))}return()=>{o.removeEventListener(DA,I),setTimeout(()=>{const Q=new CustomEvent(OA,Wz);o.addEventListener(OA,N),o.dispatchEvent(Q),Q.defaultPrevented||tf(q??document.body,{select:!0}),o.removeEventListener(OA,N),Xz.remove(V)},0)}}},[o,I,N,V]);const Y=F.useCallback(q=>{if(!i&&!l||V.paused)return;const Z=q.key==="Tab"&&!q.altKey&&!q.ctrlKey&&!q.metaKey,Q=document.activeElement;if(Z&&Q){const H=q.currentTarget,[K,ne]=zre(H);K&&ne?!q.shiftKey&&Q===ne?(q.preventDefault(),i&&tf(K,{select:!0})):q.shiftKey&&Q===K&&(q.preventDefault(),i&&tf(ne,{select:!0})):Q===H&&q.preventDefault()}},[i,l,V.paused]);return d.jsx(xi.div,{tabIndex:-1,...x,ref:$,onKeyDown:Y})});NP.displayName=Ore;function Lre(e,{select:t=!1}={}){const i=document.activeElement;for(const l of e)if(tf(l,{select:t}),document.activeElement!==i)return}function zre(e){const t=mU(e),i=Zz(t,e),l=Zz(t.reverse(),e);return[i,l]}function mU(e){const t=[],i=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:l=>{const f=l.tagName==="INPUT"&&l.type==="hidden";return l.disabled||l.hidden||f?NodeFilter.FILTER_SKIP:l.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;i.nextNode();)t.push(i.currentNode);return t}function Zz(e,t){for(const i of e)if(!Fre(i,{upTo:t}))return i}function Fre(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function Bre(e){return e instanceof HTMLInputElement&&"select"in e}function tf(e,{select:t=!1}={}){if(e&&e.focus){const i=document.activeElement;e.focus({preventScroll:!0}),e!==i&&Bre(e)&&t&&e.select()}}var Xz=Vre();function Vre(){let e=[];return{add(t){const i=e[0];t!==i&&(i==null||i.pause()),e=Kz(e,t),e.unshift(t)},remove(t){var i;e=Kz(e,t),(i=e[0])==null||i.resume()}}}function Kz(e,t){const i=[...e],l=i.indexOf(t);return l!==-1&&i.splice(l,1),i}function Ure(e){return e.filter(t=>t.tagName!=="A")}var LA=0;function gU(){F.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??Yz()),document.body.insertAdjacentElement("beforeend",e[1]??Yz()),LA++,()=>{LA===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),LA--}},[])}function Yz(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var BS="right-scroll-bar-position",VS="width-before-scroll-bar",$re="with-scroll-bars-hidden",qre="--removed-body-scroll-bar-size";function zA(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function Gre(e,t){var i=F.useState(function(){return{value:e,callback:t,facade:{get current(){return i.value},set current(l){var f=i.value;f!==l&&(i.value=l,i.callback(l,f))}}}})[0];return i.callback=t,i.facade}var Hre=typeof window<"u"?F.useLayoutEffect:F.useEffect,Jz=new WeakMap;function Wre(e,t){var i=Gre(null,function(l){return e.forEach(function(f){return zA(f,l)})});return Hre(function(){var l=Jz.get(i);if(l){var f=new Set(l),_=new Set(e),x=i.current;f.forEach(function(o){_.has(o)||zA(o,null)}),_.forEach(function(o){f.has(o)||zA(o,x)})}Jz.set(i,e)},[e]),i}function Zre(e){return e}function Xre(e,t){t===void 0&&(t=Zre);var i=[],l=!1,f={read:function(){if(l)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return i.length?i[i.length-1]:e},useMedium:function(_){var x=t(_,l);return i.push(x),function(){i=i.filter(function(o){return o!==x})}},assignSyncMedium:function(_){for(l=!0;i.length;){var x=i;i=[],x.forEach(_)}i={push:function(o){return _(o)},filter:function(){return i}}},assignMedium:function(_){l=!0;var x=[];if(i.length){var o=i;i=[],o.forEach(_),x=i}var A=function(){var N=x;x=[],N.forEach(_)},I=function(){return Promise.resolve().then(A)};I(),i={push:function(N){x.push(N),I()},filter:function(N){return x=x.filter(N),i}}}};return f}function Kre(e){e===void 0&&(e={});var t=Xre(null);return t.options=pc({async:!0,ssr:!1},e),t}var _U=function(e){var t=e.sideCar,i=Jf(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var l=t.read();if(!l)throw new Error("Sidecar medium not found");return F.createElement(l,pc({},i))};_U.isSideCarExport=!0;function Yre(e,t){return e.useMedium(t),_U}var yU=Kre(),FA=function(){},C2=F.forwardRef(function(e,t){var i=F.useRef(null),l=F.useState({onScrollCapture:FA,onWheelCapture:FA,onTouchMoveCapture:FA}),f=l[0],_=l[1],x=e.forwardProps,o=e.children,A=e.className,I=e.removeScrollBar,N=e.enabled,U=e.shards,$=e.sideCar,V=e.noRelative,Y=e.noIsolation,q=e.inert,Z=e.allowPinchZoom,Q=e.as,H=Q===void 0?"div":Q,K=e.gapMode,ne=Jf(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),le=$,pe=Wre([i,t]),Ae=pc(pc({},ne),f);return F.createElement(F.Fragment,null,N&&F.createElement(le,{sideCar:yU,removeScrollBar:I,shards:U,noRelative:V,noIsolation:Y,inert:q,setCallbacks:_,allowPinchZoom:!!Z,lockRef:i,gapMode:K}),x?F.cloneElement(F.Children.only(o),pc(pc({},Ae),{ref:pe})):F.createElement(H,pc({},Ae,{className:A,ref:pe}),o))});C2.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};C2.classNames={fullWidth:VS,zeroRight:BS};var Jre=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function Qre(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=Jre();return t&&e.setAttribute("nonce",t),e}function ene(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function tne(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var rne=function(){var e=0,t=null;return{add:function(i){e==0&&(t=Qre())&&(ene(t,i),tne(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},nne=function(){var e=rne();return function(t,i){F.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&i])}},vU=function(){var e=nne(),t=function(i){var l=i.styles,f=i.dynamic;return e(l,f),null};return t},ine={left:0,top:0,right:0,gap:0},BA=function(e){return parseInt(e||"",10)||0},sne=function(e){var t=window.getComputedStyle(document.body),i=t[e==="padding"?"paddingLeft":"marginLeft"],l=t[e==="padding"?"paddingTop":"marginTop"],f=t[e==="padding"?"paddingRight":"marginRight"];return[BA(i),BA(l),BA(f)]},one=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return ine;var t=sne(e),i=document.documentElement.clientWidth,l=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,l-i+t[2]-t[0])}},ane=vU(),ny="data-scroll-locked",lne=function(e,t,i,l){var f=e.left,_=e.top,x=e.right,o=e.gap;return i===void 0&&(i="margin"),`
  .`.concat($re,` {
   overflow: hidden `).concat(l,`;
   padding-right: `).concat(o,"px ").concat(l,`;
  }
  body[`).concat(ny,`] {
    overflow: hidden `).concat(l,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(l,";"),i==="margin"&&`
    padding-left: `.concat(f,`px;
    padding-top: `).concat(_,`px;
    padding-right: `).concat(x,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(o,"px ").concat(l,`;
    `),i==="padding"&&"padding-right: ".concat(o,"px ").concat(l,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(BS,` {
    right: `).concat(o,"px ").concat(l,`;
  }
  
  .`).concat(VS,` {
    margin-right: `).concat(o,"px ").concat(l,`;
  }
  
  .`).concat(BS," .").concat(BS,` {
    right: 0 `).concat(l,`;
  }
  
  .`).concat(VS," .").concat(VS,` {
    margin-right: 0 `).concat(l,`;
  }
  
  body[`).concat(ny,`] {
    `).concat(qre,": ").concat(o,`px;
  }
`)},Qz=function(){var e=parseInt(document.body.getAttribute(ny)||"0",10);return isFinite(e)?e:0},cne=function(){F.useEffect(function(){return document.body.setAttribute(ny,(Qz()+1).toString()),function(){var e=Qz()-1;e<=0?document.body.removeAttribute(ny):document.body.setAttribute(ny,e.toString())}},[])},une=function(e){var t=e.noRelative,i=e.noImportant,l=e.gapMode,f=l===void 0?"margin":l;cne();var _=F.useMemo(function(){return one(f)},[f]);return F.createElement(ane,{styles:lne(_,!t,f,i?"":"!important")})},$I=!1;if(typeof window<"u")try{var gS=Object.defineProperty({},"passive",{get:function(){return $I=!0,!0}});window.addEventListener("test",gS,gS),window.removeEventListener("test",gS,gS)}catch{$I=!1}var C_=$I?{passive:!1}:!1,dne=function(e){return e.tagName==="TEXTAREA"},xU=function(e,t){if(!(e instanceof Element))return!1;var i=window.getComputedStyle(e);return i[t]!=="hidden"&&!(i.overflowY===i.overflowX&&!dne(e)&&i[t]==="visible")},hne=function(e){return xU(e,"overflowY")},fne=function(e){return xU(e,"overflowX")},eF=function(e,t){var i=t.ownerDocument,l=t;do{typeof ShadowRoot<"u"&&l instanceof ShadowRoot&&(l=l.host);var f=bU(e,l);if(f){var _=wU(e,l),x=_[1],o=_[2];if(x>o)return!0}l=l.parentNode}while(l&&l!==i.body);return!1},pne=function(e){var t=e.scrollTop,i=e.scrollHeight,l=e.clientHeight;return[t,i,l]},mne=function(e){var t=e.scrollLeft,i=e.scrollWidth,l=e.clientWidth;return[t,i,l]},bU=function(e,t){return e==="v"?hne(t):fne(t)},wU=function(e,t){return e==="v"?pne(t):mne(t)},gne=function(e,t){return e==="h"&&t==="rtl"?-1:1},_ne=function(e,t,i,l,f){var _=gne(e,window.getComputedStyle(t).direction),x=_*l,o=i.target,A=t.contains(o),I=!1,N=x>0,U=0,$=0;do{if(!o)break;var V=wU(e,o),Y=V[0],q=V[1],Z=V[2],Q=q-Z-_*Y;(Y||Q)&&bU(e,o)&&(U+=Q,$+=Y);var H=o.parentNode;o=H&&H.nodeType===Node.DOCUMENT_FRAGMENT_NODE?H.host:H}while(!A&&o!==document.body||A&&(t.contains(o)||t===o));return(N&&(Math.abs(U)<1||!f)||!N&&(Math.abs($)<1||!f))&&(I=!0),I},_S=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},tF=function(e){return[e.deltaX,e.deltaY]},rF=function(e){return e&&"current"in e?e.current:e},yne=function(e,t){return e[0]===t[0]&&e[1]===t[1]},vne=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},xne=0,A_=[];function bne(e){var t=F.useRef([]),i=F.useRef([0,0]),l=F.useRef(),f=F.useState(xne++)[0],_=F.useState(vU)[0],x=F.useRef(e);F.useEffect(function(){x.current=e},[e]),F.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(f));var q=TP([e.lockRef.current],(e.shards||[]).map(rF),!0).filter(Boolean);return q.forEach(function(Z){return Z.classList.add("allow-interactivity-".concat(f))}),function(){document.body.classList.remove("block-interactivity-".concat(f)),q.forEach(function(Z){return Z.classList.remove("allow-interactivity-".concat(f))})}}},[e.inert,e.lockRef.current,e.shards]);var o=F.useCallback(function(q,Z){if("touches"in q&&q.touches.length===2||q.type==="wheel"&&q.ctrlKey)return!x.current.allowPinchZoom;var Q=_S(q),H=i.current,K="deltaX"in q?q.deltaX:H[0]-Q[0],ne="deltaY"in q?q.deltaY:H[1]-Q[1],le,pe=q.target,Ae=Math.abs(K)>Math.abs(ne)?"h":"v";if("touches"in q&&Ae==="h"&&pe.type==="range")return!1;var Ze=eF(Ae,pe);if(!Ze)return!0;if(Ze?le=Ae:(le=Ae==="v"?"h":"v",Ze=eF(Ae,pe)),!Ze)return!1;if(!l.current&&"changedTouches"in q&&(K||ne)&&(l.current=le),!le)return!0;var Xe=l.current||le;return _ne(Xe,Z,q,Xe==="h"?K:ne,!0)},[]),A=F.useCallback(function(q){var Z=q;if(!(!A_.length||A_[A_.length-1]!==_)){var Q="deltaY"in Z?tF(Z):_S(Z),H=t.current.filter(function(le){return le.name===Z.type&&(le.target===Z.target||Z.target===le.shadowParent)&&yne(le.delta,Q)})[0];if(H&&H.should){Z.cancelable&&Z.preventDefault();return}if(!H){var K=(x.current.shards||[]).map(rF).filter(Boolean).filter(function(le){return le.contains(Z.target)}),ne=K.length>0?o(Z,K[0]):!x.current.noIsolation;ne&&Z.cancelable&&Z.preventDefault()}}},[]),I=F.useCallback(function(q,Z,Q,H){var K={name:q,delta:Z,target:Q,should:H,shadowParent:wne(Q)};t.current.push(K),setTimeout(function(){t.current=t.current.filter(function(ne){return ne!==K})},1)},[]),N=F.useCallback(function(q){i.current=_S(q),l.current=void 0},[]),U=F.useCallback(function(q){I(q.type,tF(q),q.target,o(q,e.lockRef.current))},[]),$=F.useCallback(function(q){I(q.type,_S(q),q.target,o(q,e.lockRef.current))},[]);F.useEffect(function(){return A_.push(_),e.setCallbacks({onScrollCapture:U,onWheelCapture:U,onTouchMoveCapture:$}),document.addEventListener("wheel",A,C_),document.addEventListener("touchmove",A,C_),document.addEventListener("touchstart",N,C_),function(){A_=A_.filter(function(q){return q!==_}),document.removeEventListener("wheel",A,C_),document.removeEventListener("touchmove",A,C_),document.removeEventListener("touchstart",N,C_)}},[]);var V=e.removeScrollBar,Y=e.inert;return F.createElement(F.Fragment,null,Y?F.createElement(_,{styles:vne(f)}):null,V?F.createElement(une,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function wne(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const Sne=Yre(yU,bne);var DP=F.forwardRef(function(e,t){return F.createElement(C2,pc({},e,{ref:t,sideCar:Sne}))});DP.classNames=C2.classNames;var Tne=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},j_=new WeakMap,yS=new WeakMap,vS={},VA=0,SU=function(e){return e&&(e.host||SU(e.parentNode))},Ene=function(e,t){return t.map(function(i){if(e.contains(i))return i;var l=SU(i);return l&&e.contains(l)?l:(console.error("aria-hidden",i,"in not contained inside",e,". Doing nothing"),null)}).filter(function(i){return!!i})},Cne=function(e,t,i,l){var f=Ene(t,Array.isArray(e)?e:[e]);vS[i]||(vS[i]=new WeakMap);var _=vS[i],x=[],o=new Set,A=new Set(f),I=function(U){!U||o.has(U)||(o.add(U),I(U.parentNode))};f.forEach(I);var N=function(U){!U||A.has(U)||Array.prototype.forEach.call(U.children,function($){if(o.has($))N($);else try{var V=$.getAttribute(l),Y=V!==null&&V!=="false",q=(j_.get($)||0)+1,Z=(_.get($)||0)+1;j_.set($,q),_.set($,Z),x.push($),q===1&&Y&&yS.set($,!0),Z===1&&$.setAttribute(i,"true"),Y||$.setAttribute(l,"true")}catch(Q){console.error("aria-hidden: cannot operate on ",$,Q)}})};return N(t),o.clear(),VA++,function(){x.forEach(function(U){var $=j_.get(U)-1,V=_.get(U)-1;j_.set(U,$),_.set(U,V),$||(yS.has(U)||U.removeAttribute(l),yS.delete(U)),V||U.removeAttribute(i)}),VA--,VA||(j_=new WeakMap,j_=new WeakMap,yS=new WeakMap,vS={})}},TU=function(e,t,i){i===void 0&&(i="data-aria-hidden");var l=Array.from(Array.isArray(e)?e:[e]),f=Tne(e);return f?(l.push.apply(l,Array.from(f.querySelectorAll("[aria-live]"))),Cne(l,f,i,"aria-hidden")):function(){return null}},A2="Dialog",[EU,CU]=rd(A2),[Ane,yu]=EU(A2),AU=e=>{const{__scopeDialog:t,children:i,open:l,defaultOpen:f,onOpenChange:_,modal:x=!0}=e,o=F.useRef(null),A=F.useRef(null),[I,N]=Of({prop:l,defaultProp:f??!1,onChange:_,caller:A2});return d.jsx(Ane,{scope:t,triggerRef:o,contentRef:A,contentId:Wd(),titleId:Wd(),descriptionId:Wd(),open:I,onOpenChange:N,onOpenToggle:F.useCallback(()=>N(U=>!U),[N]),modal:x,children:i})};AU.displayName=A2;var jU="DialogTrigger",IU=F.forwardRef((e,t)=>{const{__scopeDialog:i,...l}=e,f=yu(jU,i),_=bs(t,f.triggerRef);return d.jsx(xi.button,{type:"button","aria-haspopup":"dialog","aria-expanded":f.open,"aria-controls":f.contentId,"data-state":zP(f.open),...l,ref:_,onClick:Vn(e.onClick,f.onOpenToggle)})});IU.displayName=jU;var OP="DialogPortal",[jne,kU]=EU(OP,{forceMount:void 0}),PU=e=>{const{__scopeDialog:t,forceMount:i,children:l,container:f}=e,_=yu(OP,t);return d.jsx(jne,{scope:t,forceMount:i,children:F.Children.map(l,x=>d.jsx(Wf,{present:i||_.open,children:d.jsx(l2,{asChild:!0,container:f,children:x})}))})};PU.displayName=OP;var OT="DialogOverlay",RU=F.forwardRef((e,t)=>{const i=kU(OT,e.__scopeDialog),{forceMount:l=i.forceMount,...f}=e,_=yu(OT,e.__scopeDialog);return _.modal?d.jsx(Wf,{present:l||_.open,children:d.jsx(kne,{...f,ref:t})}):null});RU.displayName=OT;var Ine=Ey("DialogOverlay.RemoveScroll"),kne=F.forwardRef((e,t)=>{const{__scopeDialog:i,...l}=e,f=yu(OT,i);return d.jsx(DP,{as:Ine,allowPinchZoom:!0,shards:[f.contentRef],children:d.jsx(xi.div,{"data-state":zP(f.open),...l,ref:t,style:{pointerEvents:"auto",...l.style}})})}),Fm="DialogContent",MU=F.forwardRef((e,t)=>{const i=kU(Fm,e.__scopeDialog),{forceMount:l=i.forceMount,...f}=e,_=yu(Fm,e.__scopeDialog);return d.jsx(Wf,{present:l||_.open,children:_.modal?d.jsx(Pne,{...f,ref:t}):d.jsx(Rne,{...f,ref:t})})});MU.displayName=Fm;var Pne=F.forwardRef((e,t)=>{const i=yu(Fm,e.__scopeDialog),l=F.useRef(null),f=bs(t,i.contentRef,l);return F.useEffect(()=>{const _=l.current;if(_)return TU(_)},[]),d.jsx(NU,{...e,ref:f,trapFocus:i.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Vn(e.onCloseAutoFocus,_=>{var x;_.preventDefault(),(x=i.triggerRef.current)==null||x.focus()}),onPointerDownOutside:Vn(e.onPointerDownOutside,_=>{const x=_.detail.originalEvent,o=x.button===0&&x.ctrlKey===!0;(x.button===2||o)&&_.preventDefault()}),onFocusOutside:Vn(e.onFocusOutside,_=>_.preventDefault())})}),Rne=F.forwardRef((e,t)=>{const i=yu(Fm,e.__scopeDialog),l=F.useRef(!1),f=F.useRef(!1);return d.jsx(NU,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:_=>{var x,o;(x=e.onCloseAutoFocus)==null||x.call(e,_),_.defaultPrevented||(l.current||(o=i.triggerRef.current)==null||o.focus(),_.preventDefault()),l.current=!1,f.current=!1},onInteractOutside:_=>{var A,I;(A=e.onInteractOutside)==null||A.call(e,_),_.defaultPrevented||(l.current=!0,_.detail.originalEvent.type==="pointerdown"&&(f.current=!0));const x=_.target;((I=i.triggerRef.current)==null?void 0:I.contains(x))&&_.preventDefault(),_.detail.originalEvent.type==="focusin"&&f.current&&_.preventDefault()}})}),NU=F.forwardRef((e,t)=>{const{__scopeDialog:i,trapFocus:l,onOpenAutoFocus:f,onCloseAutoFocus:_,...x}=e,o=yu(Fm,i),A=F.useRef(null),I=bs(t,A);return gU(),d.jsxs(d.Fragment,{children:[d.jsx(NP,{asChild:!0,loop:!0,trapped:l,onMountAutoFocus:f,onUnmountAutoFocus:_,children:d.jsx(Ab,{role:"dialog",id:o.contentId,"aria-describedby":o.descriptionId,"aria-labelledby":o.titleId,"data-state":zP(o.open),...x,ref:I,onDismiss:()=>o.onOpenChange(!1)})}),d.jsxs(d.Fragment,{children:[d.jsx(Nne,{titleId:o.titleId}),d.jsx(One,{contentRef:A,descriptionId:o.descriptionId})]})]})}),LP="DialogTitle",DU=F.forwardRef((e,t)=>{const{__scopeDialog:i,...l}=e,f=yu(LP,i);return d.jsx(xi.h2,{id:f.titleId,...l,ref:t})});DU.displayName=LP;var OU="DialogDescription",LU=F.forwardRef((e,t)=>{const{__scopeDialog:i,...l}=e,f=yu(OU,i);return d.jsx(xi.p,{id:f.descriptionId,...l,ref:t})});LU.displayName=OU;var zU="DialogClose",FU=F.forwardRef((e,t)=>{const{__scopeDialog:i,...l}=e,f=yu(zU,i);return d.jsx(xi.button,{type:"button",...l,ref:t,onClick:Vn(e.onClick,()=>f.onOpenChange(!1))})});FU.displayName=zU;function zP(e){return e?"open":"closed"}var BU="DialogTitleWarning",[Mne,VU]=F7(BU,{contentName:Fm,titleName:LP,docsSlug:"dialog"}),Nne=({titleId:e})=>{const t=VU(BU),i=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return F.useEffect(()=>{e&&(document.getElementById(e)||console.error(i))},[i,e]),null},Dne="DialogDescriptionWarning",One=({contentRef:e,descriptionId:t})=>{const l=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${VU(Dne).contentName}}.`;return F.useEffect(()=>{var _;const f=(_=e.current)==null?void 0:_.getAttribute("aria-describedby");t&&f&&(document.getElementById(t)||console.warn(l))},[l,e,t]),null},FP=AU,UU=IU,BP=PU,Mb=RU,Nb=MU,Db=DU,Ob=LU,j2=FU;const Vs=FP,$U=UU,Lne=BP,qU=F.forwardRef(({className:e,...t},i)=>d.jsx(Mb,{ref:i,className:wr("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));qU.displayName=Mb.displayName;const Ms=F.forwardRef(({className:e,children:t,...i},l)=>d.jsxs(Lne,{children:[d.jsx(qU,{}),d.jsxs(Nb,{ref:l,className:wr("fixed left-[50%] top-[50%] z-50 grid w-[70vw] max-h-[70vh] translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 overflow-auto data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...i,children:[t,d.jsxs(j2,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[d.jsx(sP,{className:"h-4 w-4"}),d.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Ms.displayName=Nb.displayName;const Ns=({className:e,...t})=>d.jsx("div",{className:wr("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});Ns.displayName="DialogHeader";const Ds=F.forwardRef(({className:e,...t},i)=>d.jsx(Db,{ref:i,className:wr("text-lg font-semibold leading-none tracking-tight",e),...t}));Ds.displayName=Db.displayName;const Qa=F.forwardRef(({className:e,...t},i)=>d.jsx(Ob,{ref:i,className:wr("text-sm text-muted-foreground",e),...t}));Qa.displayName=Ob.displayName;const zne=Rb({email:ca().trim().email({message:"Email invlido"}).max(255,{message:"Email deve ter no mximo 255 caracteres"})}),Fne=()=>{const[e,t]=F.useState(!1),[i,l]=F.useState(""),[f,_]=F.useState(!1),{toast:x}=Hf(),o=async A=>{A.preventDefault(),_(!0);try{const I=zne.parse({email:i}),{error:N}=await Ge.auth.resetPasswordForEmail(I.email,{redirectTo:`${window.location.origin}/reset-password`});if(N)throw N;x({title:"Email enviado!",description:"Se o email estiver cadastrado, voc receber as instrues para redefinir sua senha."}),l(""),t(!1)}catch(I){I instanceof xc?x({title:"Erro de validao",description:I.errors[0].message,variant:"destructive"}):x({title:"Erro",description:I.message||"No foi possvel enviar o email",variant:"destructive"})}finally{_(!1)}};return d.jsxs(Vs,{open:e,onOpenChange:t,children:[d.jsx($U,{asChild:!0,children:d.jsx("button",{type:"button",className:"text-sm text-primary hover:underline",children:"Esqueci minha senha"})}),d.jsxs(Ms,{className:"sm:max-w-md",children:[d.jsxs(Ns,{children:[d.jsx("div",{className:"flex justify-center mb-2",children:d.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:d.jsx(BZ,{className:"h-6 w-6 text-primary"})})}),d.jsx(Ds,{children:"Recuperar Senha"}),d.jsx(Qa,{children:"Digite seu email para receber as instrues de redefinio de senha."})]}),d.jsxs("form",{onSubmit:o,className:"space-y-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"reset-email",children:"Email"}),d.jsx(gr,{id:"reset-email",type:"email",placeholder:"seu@email.com",value:i,onChange:A=>l(A.target.value),required:!0,disabled:f,maxLength:255})]}),d.jsxs("div",{className:"flex gap-2 justify-end",children:[d.jsx(Bt,{type:"button",variant:"outline",onClick:()=>t(!1),disabled:f,children:"Cancelar"}),d.jsx(Bt,{type:"submit",disabled:f,children:f?d.jsxs(d.Fragment,{children:[d.jsx(nd,{className:"mr-2 h-4 w-4 animate-spin"}),"Enviando..."]}):"Enviar Email"})]})]})]})]})},Bne=Rb({email:ca().trim().email({message:"Email invlido"}).max(255,{message:"Email deve ter no mximo 255 caracteres"}),password:ca().min(6,{message:"Senha deve ter no mnimo 6 caracteres"}).max(72,{message:"Senha deve ter no mximo 72 caracteres"}),fullName:ca().trim().min(1,{message:"Nome completo  obrigatrio"}).max(100,{message:"Nome deve ter no mximo 100 caracteres"}),phone:ca().trim().max(20,{message:"Telefone deve ter no mximo 20 caracteres"}).optional()}),Vne=Rb({email:ca().trim().email({message:"Email invlido"}).max(255,{message:"Email deve ter no mximo 255 caracteres"}),password:ca().min(1,{message:"Senha  obrigatria"}).max(72,{message:"Senha deve ter no mximo 72 caracteres"})}),Une=()=>{const[e,t]=F.useState(!0),[i,l]=F.useState(""),[f,_]=F.useState(""),[x,o]=F.useState(""),[A,I]=F.useState(""),[N,U]=F.useState(!1),$=_u(),{toast:V}=Hf();F.useEffect(()=>{Ge.auth.getSession().then(({data:{session:Z}})=>{Z&&$("/dashboard")});const{data:{subscription:q}}=Ge.auth.onAuthStateChange((Z,Q)=>{Q&&$("/dashboard")});return()=>q.unsubscribe()},[$]);const Y=async q=>{q.preventDefault(),U(!0);try{if(e){const Z=Vne.parse({email:i,password:f}),{error:Q}=await Ge.auth.signInWithPassword({email:Z.email,password:Z.password});if(Q)throw Q;V({title:"Login realizado!",description:"Bem-vindo de volta ao Facilities Hub."}),$("/dashboard")}else{const Z=Bne.parse({email:i,password:f,fullName:x,phone:A||void 0}),{error:Q,data:H}=await Ge.auth.signUp({email:Z.email,password:Z.password,options:{emailRedirectTo:`${window.location.origin}/dashboard`,data:{full_name:Z.fullName,phone:Z.phone}}});if(Q)throw Q;H.user&&await Dre(Z.email,Z.fullName),V({title:"Cadastro realizado!",description:"Sua conta foi criada com sucesso. Email de boas-vindas enviado!"}),$("/dashboard")}}catch(Z){Z instanceof xc?V({title:"Erro de validao",description:Z.errors[0].message,variant:"destructive"}):V({title:"Erro",description:Z.message,variant:"destructive"})}finally{U(!1)}};return d.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-primary/5 via-background to-accent/5 p-4",children:d.jsxs(Sr,{className:"w-full max-w-md shadow-lg",children:[d.jsxs(wn,{className:"space-y-3 text-center",children:[d.jsx("div",{className:"flex justify-center mb-2",children:d.jsx("div",{className:"p-3 bg-gradient-to-br from-primary to-accent rounded-xl",children:d.jsx(Lf,{className:"h-8 w-8 text-primary-foreground"})})}),d.jsx(An,{className:"text-2xl font-bold bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent",children:"Facilities Hub"}),d.jsx(fs,{children:e?"Entre na sua conta":"Crie sua conta"})]}),d.jsxs(tn,{children:[d.jsxs("form",{onSubmit:Y,className:"space-y-4",children:[!e&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"fullName",children:"Nome Completo"}),d.jsx(gr,{id:"fullName",type:"text",placeholder:"Joo Silva",value:x,onChange:q=>o(q.target.value),required:!e,disabled:N,maxLength:100})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"phone",children:"Telefone"}),d.jsx(gr,{id:"phone",type:"tel",placeholder:"(11) 99999-9999",value:A,onChange:q=>I(q.target.value),disabled:N,maxLength:20})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"email",children:"Email"}),d.jsx(gr,{id:"email",type:"email",placeholder:"seu@email.com",value:i,onChange:q=>l(q.target.value),required:!0,disabled:N,maxLength:255})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"password",children:"Senha"}),d.jsx(gr,{id:"password",type:"password",placeholder:"",value:f,onChange:q=>_(q.target.value),required:!0,disabled:N,minLength:6,maxLength:72})]}),d.jsx(Bt,{type:"submit",className:"w-full",disabled:N,children:N?d.jsxs(d.Fragment,{children:[d.jsx(nd,{className:"mr-2 h-4 w-4 animate-spin"}),"Processando..."]}):e?"Entrar":"Cadastrar"})]}),d.jsx("div",{className:"mt-4 text-center",children:e&&d.jsx(Fne,{})}),d.jsx("div",{className:"mt-4 text-center text-sm",children:d.jsx("button",{type:"button",onClick:()=>t(!e),className:"text-primary hover:underline",disabled:N,children:e?"No tem uma conta? Cadastre-se":"J tem uma conta? Faa login"})})]})]})})},UA=768;function $ne(){const[e,t]=F.useState(void 0);return F.useEffect(()=>{const i=window.matchMedia(`(max-width: ${UA-1}px)`),l=()=>{t(window.innerWidth<UA)};return i.addEventListener("change",l),t(window.innerWidth<UA),()=>i.removeEventListener("change",l)},[]),!!e}var qne="Separator",nF="horizontal",Gne=["horizontal","vertical"],GU=F.forwardRef((e,t)=>{const{decorative:i,orientation:l=nF,...f}=e,_=Hne(l)?l:nF,o=i?{role:"none"}:{"aria-orientation":_==="vertical"?_:void 0,role:"separator"};return d.jsx(xi.div,{"data-orientation":_,...o,...f,ref:t})});GU.displayName=qne;function Hne(e){return Gne.includes(e)}var HU=GU;const Am=F.forwardRef(({className:e,orientation:t="horizontal",decorative:i=!0,...l},f)=>d.jsx(HU,{ref:f,decorative:i,orientation:t,className:wr("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...l}));Am.displayName=HU.displayName;const Wne=FP,Zne=BP,WU=F.forwardRef(({className:e,...t},i)=>d.jsx(Mb,{className:wr("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:i}));WU.displayName=Mb.displayName;const Xne=By("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),ZU=F.forwardRef(({side:e="right",className:t,children:i,...l},f)=>d.jsxs(Zne,{children:[d.jsx(WU,{}),d.jsxs(Nb,{ref:f,className:wr(Xne({side:e}),t),...l,children:[i,d.jsxs(j2,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-secondary hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[d.jsx(sP,{className:"h-4 w-4"}),d.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));ZU.displayName=Nb.displayName;const Kne=F.forwardRef(({className:e,...t},i)=>d.jsx(Db,{ref:i,className:wr("text-lg font-semibold text-foreground",e),...t}));Kne.displayName=Db.displayName;const Yne=F.forwardRef(({className:e,...t},i)=>d.jsx(Ob,{ref:i,className:wr("text-sm text-muted-foreground",e),...t}));Yne.displayName=Ob.displayName;function LT({className:e,...t}){return d.jsx("div",{className:wr("animate-pulse rounded-md bg-muted",e),...t})}const Jne="sidebar:state",Qne=60*60*24*7,eie="16rem",tie="18rem",rie="3rem",nie="b",XU=F.createContext(null);function Lb(){const e=F.useContext(XU);if(!e)throw new Error("useSidebar must be used within a SidebarProvider.");return e}const KU=F.forwardRef(({defaultOpen:e=!0,open:t,onOpenChange:i,className:l,style:f,children:_,...x},o)=>{const A=$ne(),[I,N]=F.useState(!1),[U,$]=F.useState(e),V=t??U,Y=F.useCallback(H=>{const K=typeof H=="function"?H(V):H;i?i(K):$(K),document.cookie=`${Jne}=${K}; path=/; max-age=${Qne}`},[i,V]),q=F.useCallback(()=>A?N(H=>!H):Y(H=>!H),[A,Y,N]);F.useEffect(()=>{const H=K=>{K.key===nie&&(K.metaKey||K.ctrlKey)&&(K.preventDefault(),q())};return window.addEventListener("keydown",H),()=>window.removeEventListener("keydown",H)},[q]);const Z=V?"expanded":"collapsed",Q=F.useMemo(()=>({state:Z,open:V,setOpen:Y,isMobile:A,openMobile:I,setOpenMobile:N,toggleSidebar:q}),[Z,V,Y,A,I,N,q]);return d.jsx(XU.Provider,{value:Q,children:d.jsx(O5,{delayDuration:0,children:d.jsx("div",{style:{"--sidebar-width":eie,"--sidebar-width-icon":rie,...f},className:wr("group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",l),ref:o,...x,children:_})})})});KU.displayName="SidebarProvider";const YU=F.forwardRef(({side:e="left",variant:t="sidebar",collapsible:i="offcanvas",className:l,children:f,..._},x)=>{const{isMobile:o,state:A,openMobile:I,setOpenMobile:N}=Lb();return i==="none"?d.jsx("div",{className:wr("flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",l),ref:x,..._,children:f}):o?d.jsx(Wne,{open:I,onOpenChange:N,..._,children:d.jsx(ZU,{"data-sidebar":"sidebar","data-mobile":"true",className:"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden",style:{"--sidebar-width":tie},side:e,children:d.jsx("div",{className:"flex h-full w-full flex-col",children:f})})}):d.jsxs("div",{ref:x,className:"group peer hidden text-sidebar-foreground md:block","data-state":A,"data-collapsible":A==="collapsed"?i:"","data-variant":t,"data-side":e,children:[d.jsx("div",{className:wr("relative h-svh w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180",t==="floating"||t==="inset"?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon]")}),d.jsx("div",{className:wr("fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex",e==="left"?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",t==="floating"||t==="inset"?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",l),..._,children:d.jsx("div",{"data-sidebar":"sidebar",className:"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow",children:f})})]})});YU.displayName="Sidebar";const JU=F.forwardRef(({className:e,onClick:t,...i},l)=>{const{toggleSidebar:f}=Lb();return d.jsxs(Bt,{ref:l,"data-sidebar":"trigger",variant:"ghost",size:"icon",className:wr("h-7 w-7",e),onClick:_=>{t==null||t(_),f()},...i,children:[d.jsx(GZ,{}),d.jsx("span",{className:"sr-only",children:"Toggle Sidebar"})]})});JU.displayName="SidebarTrigger";const iie=F.forwardRef(({className:e,...t},i)=>{const{toggleSidebar:l}=Lb();return d.jsx("button",{ref:i,"data-sidebar":"rail","aria-label":"Toggle Sidebar",tabIndex:-1,onClick:l,title:"Toggle Sidebar",className:wr("absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] group-data-[side=left]:-right-4 group-data-[side=right]:left-0 hover:after:bg-sidebar-border sm:flex","[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize","[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize","group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar","[[data-side=left][data-collapsible=offcanvas]_&]:-right-2","[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",e),...t})});iie.displayName="SidebarRail";const sie=F.forwardRef(({className:e,...t},i)=>d.jsx("main",{ref:i,className:wr("relative flex min-h-svh flex-1 flex-col bg-background","peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",e),...t}));sie.displayName="SidebarInset";const oie=F.forwardRef(({className:e,...t},i)=>d.jsx(gr,{ref:i,"data-sidebar":"input",className:wr("h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",e),...t}));oie.displayName="SidebarInput";const aie=F.forwardRef(({className:e,...t},i)=>d.jsx("div",{ref:i,"data-sidebar":"header",className:wr("flex flex-col gap-2 p-2",e),...t}));aie.displayName="SidebarHeader";const lie=F.forwardRef(({className:e,...t},i)=>d.jsx("div",{ref:i,"data-sidebar":"footer",className:wr("flex flex-col gap-2 p-2",e),...t}));lie.displayName="SidebarFooter";const cie=F.forwardRef(({className:e,...t},i)=>d.jsx(Am,{ref:i,"data-sidebar":"separator",className:wr("mx-2 w-auto bg-sidebar-border",e),...t}));cie.displayName="SidebarSeparator";const QU=F.forwardRef(({className:e,...t},i)=>d.jsx("div",{ref:i,"data-sidebar":"content",className:wr("flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",e),...t}));QU.displayName="SidebarContent";const e6=F.forwardRef(({className:e,...t},i)=>d.jsx("div",{ref:i,"data-sidebar":"group",className:wr("relative flex w-full min-w-0 flex-col p-2",e),...t}));e6.displayName="SidebarGroup";const t6=F.forwardRef(({className:e,asChild:t=!1,...i},l)=>{const f=t?Hm:"div";return d.jsx(f,{ref:l,"data-sidebar":"group-label",className:wr("flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",e),...i})});t6.displayName="SidebarGroupLabel";const uie=F.forwardRef(({className:e,asChild:t=!1,...i},l)=>{const f=t?Hm:"button";return d.jsx(f,{ref:l,"data-sidebar":"group-action",className:wr("absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","group-data-[collapsible=icon]:hidden",e),...i})});uie.displayName="SidebarGroupAction";const r6=F.forwardRef(({className:e,...t},i)=>d.jsx("div",{ref:i,"data-sidebar":"group-content",className:wr("w-full text-sm",e),...t}));r6.displayName="SidebarGroupContent";const n6=F.forwardRef(({className:e,...t},i)=>d.jsx("ul",{ref:i,"data-sidebar":"menu",className:wr("flex w-full min-w-0 flex-col gap-1",e),...t}));n6.displayName="SidebarMenu";const US=F.forwardRef(({className:e,...t},i)=>d.jsx("li",{ref:i,"data-sidebar":"menu-item",className:wr("group/menu-item relative",e),...t}));US.displayName="SidebarMenuItem";const die=By("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-sm",sm:"h-7 text-xs",lg:"h-12 text-sm group-data-[collapsible=icon]:!p-0"}},defaultVariants:{variant:"default",size:"default"}}),$S=F.forwardRef(({asChild:e=!1,isActive:t=!1,variant:i="default",size:l="default",tooltip:f,className:_,...x},o)=>{const A=e?Hm:"button",{isMobile:I,state:N}=Lb(),U=d.jsx(A,{ref:o,"data-sidebar":"menu-button","data-size":l,"data-active":t,className:wr(die({variant:i,size:l}),_),...x});return f?(typeof f=="string"&&(f={children:f}),d.jsxs(eJ,{children:[d.jsx(tJ,{asChild:!0,children:U}),d.jsx(L5,{side:"right",align:"center",hidden:N!=="collapsed"||I,...f})]})):U});$S.displayName="SidebarMenuButton";const hie=F.forwardRef(({className:e,asChild:t=!1,showOnHover:i=!1,...l},f)=>{const _=t?Hm:"button";return d.jsx(_,{ref:f,"data-sidebar":"menu-action",className:wr("absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform peer-hover/menu-button:text-sidebar-accent-foreground hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",i&&"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",e),...l})});hie.displayName="SidebarMenuAction";const fie=F.forwardRef(({className:e,...t},i)=>d.jsx("div",{ref:i,"data-sidebar":"menu-badge",className:wr("pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground","peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",e),...t}));fie.displayName="SidebarMenuBadge";const pie=F.forwardRef(({className:e,showIcon:t=!1,...i},l)=>{const f=F.useMemo(()=>`${Math.floor(Math.random()*40)+50}%`,[]);return d.jsxs("div",{ref:l,"data-sidebar":"menu-skeleton",className:wr("flex h-8 items-center gap-2 rounded-md px-2",e),...i,children:[t&&d.jsx(LT,{className:"size-4 rounded-md","data-sidebar":"menu-skeleton-icon"}),d.jsx(LT,{className:"h-4 max-w-[--skeleton-width] flex-1","data-sidebar":"menu-skeleton-text",style:{"--skeleton-width":f}})]})});pie.displayName="SidebarMenuSkeleton";const mie=F.forwardRef(({className:e,...t},i)=>d.jsx("ul",{ref:i,"data-sidebar":"menu-sub",className:wr("mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5","group-data-[collapsible=icon]:hidden",e),...t}));mie.displayName="SidebarMenuSub";const gie=F.forwardRef(({...e},t)=>d.jsx("li",{ref:t,...e}));gie.displayName="SidebarMenuSubItem";const _ie=F.forwardRef(({asChild:e=!1,size:t="md",isActive:i,className:l,...f},_)=>{const x=e?Hm:"a";return d.jsx(x,{ref:_,"data-sidebar":"menu-sub-button","data-size":t,"data-active":i,className:wr("flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring aria-disabled:pointer-events-none aria-disabled:opacity-50 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground","data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",t==="sm"&&"text-xs",t==="md"&&"text-sm","group-data-[collapsible=icon]:hidden",l),...f})});_ie.displayName="SidebarMenuSubButton";const qI=F.forwardRef(({className:e,activeClassName:t,pendingClassName:i,to:l,...f},_)=>d.jsx(MQ,{ref:_,to:l,className:({isActive:x,isPending:o})=>wr(e,x&&t,o&&i),...f}));qI.displayName="NavLink";const yie=[{title:"Aguardando confirmao",url:"/diarias/aguardando"},{title:"Confirmadas",url:"/diarias/confirmadas"},{title:"Aprovadas",url:"/diarias/aprovadas"},{title:"Lanadas",url:"/diarias/lancadas"},{title:"Aprovadas p/ pagamento",url:"/diarias/aprovadas-pagamento"},{title:"Canceladas",url:"/diarias/canceladas"}],vie=[{title:"Dashboard 24/7",url:"/dashboard-24h",icon:Qj},{title:"Dashboard",url:"/dashboard",icon:Qj},{title:"Contratos",url:"/contratos",icon:Zf},{title:"Mesa de Operaes",url:"/mesa-operacoes",icon:LZ},{title:"Chamados",url:"/chamados",icon:ib},{title:"Ordens de Servio",url:"/ordens-servico",icon:d2},{title:"Colaboradores",url:"/colaboradores",icon:f2},{title:"Diaristas",url:"/diaristas",icon:U4},{title:"Diarias",url:"/diarias",icon:Al,children:yie},{title:"Ativos",url:"/ativos",icon:Vd},{title:"Estoque",url:"/estoque",icon:Vd},{title:"Checklists",url:"/checklists",icon:q4},{title:"Execues de Checklist",url:"/checklist-execucoes",icon:jL},{title:"Responder Checklist",url:"/checklist-respostas",icon:jL},{title:"Respostas registradas",url:"/checklist-respostas-lista",icon:VZ}];function xie(){const{open:e}=Lb(),t=Yf(),i=_u(),l=t.pathname,f=(x,o=!0)=>o?l===x:l===x||l.startsWith(`${x}/`),_=async()=>{await Ge.auth.signOut(),Yt.success("Logout realizado com sucesso"),i("/auth")};return d.jsx(YU,{className:e?"w-64":"w-16",collapsible:"icon",children:d.jsx(QU,{children:d.jsxs(e6,{children:[d.jsx(t6,{className:e?"":"hidden",children:"Facilities Center"}),d.jsx(r6,{children:d.jsxs(n6,{children:[vie.map(x=>{const o=Array.isArray(x.children)&&x.children.length>0,A=o?f(x.url,!1):f(x.url);return d.jsxs(US,{children:[d.jsx($S,{asChild:!0,isActive:A,children:d.jsxs(qI,{to:x.url,end:!o,className:"flex items-center gap-3 hover:bg-accent",activeClassName:"bg-accent text-accent-foreground font-medium",children:[d.jsx(x.icon,{className:"h-5 w-5"}),e&&d.jsx("span",{children:x.title})]})}),o&&e&&A&&d.jsx("ul",{className:"ml-6 mt-1 space-y-1 border-l pl-3",children:x.children.map(I=>d.jsx(US,{children:d.jsx($S,{asChild:!0,isActive:f(I.url),children:d.jsx(qI,{to:I.url,end:!0,className:"flex items-center gap-2 text-sm hover:bg-accent",activeClassName:"bg-accent text-accent-foreground font-medium",children:I.title})})},I.title))})]},x.title)}),d.jsx(US,{children:d.jsxs($S,{onClick:_,children:[d.jsx($Z,{className:"h-5 w-5"}),e&&d.jsx("span",{children:"Sair"})]})})]})})]})})})}function bo({children:e}){return d.jsx(KU,{defaultOpen:!0,children:d.jsxs("div",{className:"min-h-screen flex w-full",children:[d.jsx(xie,{}),d.jsxs("div",{className:"flex-1 flex flex-col",children:[d.jsx("header",{className:"h-14 border-b flex items-center px-4 bg-background sticky top-0 z-10",children:d.jsx(JU,{})}),d.jsx("main",{className:"flex-1 overflow-auto",children:e})]})]})})}const bie=()=>{const[e,t]=F.useState(null),[i,l]=F.useState(null),[f,_]=F.useState(!0),x=_u(),{toast:o}=Hf();F.useEffect(()=>{A();const{data:{subscription:U}}=Ge.auth.onAuthStateChange(async($,V)=>{if($==="SIGNED_IN"&&V){t(V.user);const{data:Y}=await Ge.from("user_roles").select("role").eq("user_id",V.user.id).single();Y&&l(Y.role),_(!1)}else $==="SIGNED_OUT"&&x("/auth")});return()=>U.unsubscribe()},[]);const A=async()=>{try{const{data:{user:U}}=await Ge.auth.getUser();if(!U){x("/auth");return}t(U);const{data:$}=await Ge.from("user_roles").select("role").eq("user_id",U.id).single();$&&l($.role)}catch(U){console.error("Error checking user:",U)}finally{_(!1)}};if(f)return d.jsx("div",{className:"min-h-screen flex items-center justify-center",children:d.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})});const I={admin:"Administrador",gestor_operacoes:"Gestor de Operaes",supervisor:"Supervisor",analista_centro_controle:"Analista do Centro de Controle",tecnico:"Tcnico",cliente_view:"Cliente (Visualizao)"},N=[{title:"Dashboard 24/7",description:"Resumo executivo e alertas em tempo real",icon:Jj,color:"from-blue-500 to-cyan-500",action:()=>x("/dashboard-24h")},{title:"Gesto de Contratos",description:"Clientes, contratos, unidades e postos",icon:Lf,color:"from-purple-500 to-pink-500",action:()=>x("/contratos")},{title:"Mesa de Operaes",description:"Mapa operacional e monitoramento 24/7",icon:zf,color:"from-green-500 to-emerald-500",action:()=>x("/mesa-operacoes")},{title:"Chamados",description:"Sistema de abertura e acompanhamento",icon:ib,color:"from-orange-500 to-amber-500",action:()=>x("/chamados")},{title:"Ordens de Servio",description:"Preventivas, corretivas e emergenciais",icon:Zf,color:"from-indigo-500 to-purple-500",action:()=>x("/ordens-servico")},{title:"Incidentes",description:"Registro e investigao de incidentes",icon:Cm,color:"from-red-500 to-rose-500",action:()=>o({title:"Em desenvolvimento",description:"Mdulo em breve!"})},{title:"Checklists",description:"Checklists e auditorias",icon:Ib,color:"from-teal-500 to-cyan-500",action:()=>x("/checklists")},{title:"Recursos",description:"Materiais, equipamentos e veculos",icon:Vd,color:"from-violet-500 to-purple-500",action:()=>x("/estoque")},{title:"Colaboradores",description:"Gesto de pessoal e escalas",icon:Hd,color:"from-blue-500 to-indigo-500",action:()=>x("/colaboradores")},{title:"QSMMA",description:"Qualidade, Segurana, Meio Ambiente e Sade",icon:nP,color:"from-emerald-500 to-green-500",action:()=>o({title:"Em desenvolvimento",description:"Mdulo em breve!"})},{title:"Portal do Cliente",description:"rea restrita para clientes",icon:h2,color:"from-pink-500 to-rose-500",action:()=>o({title:"Em desenvolvimento",description:"Mdulo em breve!"})},{title:"Configuraes",description:"Configuraes do sistema",icon:XZ,color:"from-gray-500 to-slate-500",action:()=>o({title:"Em desenvolvimento",description:"Mdulo em breve!"})}];return d.jsx(bo,{children:d.jsxs("div",{className:"min-h-screen bg-background",children:[d.jsx("header",{className:"border-b bg-card shadow-sm",children:d.jsx("div",{className:"container mx-auto px-4 py-4",children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"p-2 bg-gradient-to-br from-primary to-accent rounded-lg",children:d.jsx(Lf,{className:"h-6 w-6 text-primary-foreground"})}),d.jsxs("div",{children:[d.jsx("h1",{className:"text-xl font-bold",children:"Facilities Center"}),d.jsx("p",{className:"text-sm text-muted-foreground",children:"Sistema de Gesto de Facilities"})]})]})})}),d.jsxs("main",{className:"container mx-auto px-4 py-8",children:[d.jsxs("div",{className:"mb-8",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[d.jsx(Qj,{className:"h-6 w-6 text-primary"}),d.jsx("h2",{className:"text-2xl font-bold",children:"Dashboard"})]}),d.jsxs("p",{className:"text-muted-foreground",children:["Bem-vindo, ",e==null?void 0:e.email,"  Perfil: ",I[i||""]||i]})]}),d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:N.map((U,$)=>d.jsx(Sr,{className:"cursor-pointer hover:shadow-lg transition-all duration-300 hover:-translate-y-1",onClick:U.action,children:d.jsxs(wn,{children:[d.jsx("div",{className:`w-12 h-12 rounded-lg bg-gradient-to-br ${U.color} flex items-center justify-center mb-4`,children:d.jsx(U.icon,{className:"h-6 w-6 text-white"})}),d.jsx(An,{className:"text-lg",children:U.title}),d.jsx(fs,{children:U.description})]})},$))}),d.jsxs("div",{className:"mt-8 grid grid-cols-1 md:grid-cols-4 gap-6",children:[d.jsx(Sr,{children:d.jsxs(wn,{children:[d.jsxs("div",{className:"flex items-center justify-between mb-2",children:[d.jsx(An,{className:"text-sm font-medium text-muted-foreground",children:"SLA do Dia"}),d.jsx(Jj,{className:"h-5 w-5 text-green-600"})]}),d.jsx("p",{className:"text-3xl font-bold text-green-600",children:"0%"})]})}),d.jsx(Sr,{children:d.jsxs(wn,{children:[d.jsxs("div",{className:"flex items-center justify-between mb-2",children:[d.jsx(An,{className:"text-sm font-medium text-muted-foreground",children:"Chamados Abertos"}),d.jsx(ib,{className:"h-5 w-5 text-primary"})]}),d.jsx("p",{className:"text-3xl font-bold",children:"0"})]})}),d.jsx(Sr,{children:d.jsxs(wn,{children:[d.jsxs("div",{className:"flex items-center justify-between mb-2",children:[d.jsx(An,{className:"text-sm font-medium text-muted-foreground",children:"Incidentes Crticos"}),d.jsx(Cm,{className:"h-5 w-5 text-red-600"})]}),d.jsx("p",{className:"text-3xl font-bold text-red-600",children:"0"})]})}),d.jsx(Sr,{children:d.jsxs(wn,{children:[d.jsxs("div",{className:"flex items-center justify-between mb-2",children:[d.jsx(An,{className:"text-sm font-medium text-muted-foreground",children:"Postos Cobertos"}),d.jsx(Hd,{className:"h-5 w-5 text-primary"})]}),d.jsx("p",{className:"text-3xl font-bold",children:"0/0"})]})})]})]})]})})},wie=By("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Gn({className:e,variant:t,...i}){return d.jsx("div",{className:wr(wie({variant:t}),e),...i})}var i6={exports:{}};(function(e,t){(function(i,l){e.exports=l()})(lW,function(){var i,l,f;function _(o,A){if(!i)i=A;else if(!l)l=A;else{var I="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+i+")(sharedChunk); ("+l+")(sharedChunk); self.onerror = null;",N={};i(N),f=A(N),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(f.workerUrl=window.URL.createObjectURL(new Blob([I],{type:"text/javascript"})))}}_(["exports"],function(o){var A=1e-6,I=typeof Float32Array<"u"?Float32Array:Array;function N(a,r){var s=r[0],u=r[1],h=r[2],g=r[3],y=s*g-h*u;return y?(a[0]=g*(y=1/y),a[1]=-u*y,a[2]=-h*y,a[3]=s*y,a):null}function U(){var a=new I(9);return I!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function $(a,r){var s=r[0],u=r[1],h=r[2],g=r[3],y=r[4],b=r[5],T=r[6],E=r[7],k=r[8];return a[0]=y*k-b*E,a[1]=h*E-u*k,a[2]=u*b-h*y,a[3]=b*T-g*k,a[4]=s*k-h*T,a[5]=h*g-s*b,a[6]=g*E-y*T,a[7]=u*T-s*E,a[8]=s*y-u*g,a}function V(a,r,s){var u=r[0],h=r[1],g=r[2],y=r[3],b=r[4],T=r[5],E=r[6],k=r[7],P=r[8],R=s[0],L=s[1],z=s[2],W=s[3],J=s[4],te=s[5],ae=s[6],ue=s[7],he=s[8];return a[0]=R*u+L*y+z*E,a[1]=R*h+L*b+z*k,a[2]=R*g+L*T+z*P,a[3]=W*u+J*y+te*E,a[4]=W*h+J*b+te*k,a[5]=W*g+J*T+te*P,a[6]=ae*u+ue*y+he*E,a[7]=ae*h+ue*b+he*k,a[8]=ae*g+ue*T+he*P,a}function Y(){var a=new I(16);return I!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a}function q(a){var r=new I(16);return r[0]=a[0],r[1]=a[1],r[2]=a[2],r[3]=a[3],r[4]=a[4],r[5]=a[5],r[6]=a[6],r[7]=a[7],r[8]=a[8],r[9]=a[9],r[10]=a[10],r[11]=a[11],r[12]=a[12],r[13]=a[13],r[14]=a[14],r[15]=a[15],r}function Z(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Q(a,r){var s=r[0],u=r[1],h=r[2],g=r[3],y=r[4],b=r[5],T=r[6],E=r[7],k=r[8],P=r[9],R=r[10],L=r[11],z=r[12],W=r[13],J=r[14],te=r[15],ae=s*b-u*y,ue=s*T-h*y,he=s*E-g*y,Ce=u*T-h*b,be=u*E-g*b,ke=h*E-g*T,Me=k*W-P*z,ze=k*J-R*z,ct=k*te-L*z,We=P*J-R*W,ut=P*te-L*W,gt=R*te-L*J,St=ae*gt-ue*ut+he*We+Ce*ct-be*ze+ke*Me;return St?(a[0]=(b*gt-T*ut+E*We)*(St=1/St),a[1]=(h*ut-u*gt-g*We)*St,a[2]=(W*ke-J*be+te*Ce)*St,a[3]=(R*be-P*ke-L*Ce)*St,a[4]=(T*ct-y*gt-E*ze)*St,a[5]=(s*gt-h*ct+g*ze)*St,a[6]=(J*he-z*ke-te*ue)*St,a[7]=(k*ke-R*he+L*ue)*St,a[8]=(y*ut-b*ct+E*Me)*St,a[9]=(u*ct-s*ut-g*Me)*St,a[10]=(z*be-W*he+te*ae)*St,a[11]=(P*he-k*be-L*ae)*St,a[12]=(b*ze-y*We-T*Me)*St,a[13]=(s*We-u*ze+h*Me)*St,a[14]=(W*ue-z*Ce-J*ae)*St,a[15]=(k*Ce-P*ue+R*ae)*St,a):null}function H(a,r,s){var u=r[0],h=r[1],g=r[2],y=r[3],b=r[4],T=r[5],E=r[6],k=r[7],P=r[8],R=r[9],L=r[10],z=r[11],W=r[12],J=r[13],te=r[14],ae=r[15],ue=s[0],he=s[1],Ce=s[2],be=s[3];return a[0]=ue*u+he*b+Ce*P+be*W,a[1]=ue*h+he*T+Ce*R+be*J,a[2]=ue*g+he*E+Ce*L+be*te,a[3]=ue*y+he*k+Ce*z+be*ae,a[4]=(ue=s[4])*u+(he=s[5])*b+(Ce=s[6])*P+(be=s[7])*W,a[5]=ue*h+he*T+Ce*R+be*J,a[6]=ue*g+he*E+Ce*L+be*te,a[7]=ue*y+he*k+Ce*z+be*ae,a[8]=(ue=s[8])*u+(he=s[9])*b+(Ce=s[10])*P+(be=s[11])*W,a[9]=ue*h+he*T+Ce*R+be*J,a[10]=ue*g+he*E+Ce*L+be*te,a[11]=ue*y+he*k+Ce*z+be*ae,a[12]=(ue=s[12])*u+(he=s[13])*b+(Ce=s[14])*P+(be=s[15])*W,a[13]=ue*h+he*T+Ce*R+be*J,a[14]=ue*g+he*E+Ce*L+be*te,a[15]=ue*y+he*k+Ce*z+be*ae,a}function K(a,r,s){var u,h,g,y,b,T,E,k,P,R,L,z,W=s[0],J=s[1],te=s[2];return r===a?(a[12]=r[0]*W+r[4]*J+r[8]*te+r[12],a[13]=r[1]*W+r[5]*J+r[9]*te+r[13],a[14]=r[2]*W+r[6]*J+r[10]*te+r[14],a[15]=r[3]*W+r[7]*J+r[11]*te+r[15]):(h=r[1],g=r[2],y=r[3],b=r[4],T=r[5],E=r[6],k=r[7],P=r[8],R=r[9],L=r[10],z=r[11],a[0]=u=r[0],a[1]=h,a[2]=g,a[3]=y,a[4]=b,a[5]=T,a[6]=E,a[7]=k,a[8]=P,a[9]=R,a[10]=L,a[11]=z,a[12]=u*W+b*J+P*te+r[12],a[13]=h*W+T*J+R*te+r[13],a[14]=g*W+E*J+L*te+r[14],a[15]=y*W+k*J+z*te+r[15]),a}function ne(a,r,s){var u=s[0],h=s[1],g=s[2];return a[0]=r[0]*u,a[1]=r[1]*u,a[2]=r[2]*u,a[3]=r[3]*u,a[4]=r[4]*h,a[5]=r[5]*h,a[6]=r[6]*h,a[7]=r[7]*h,a[8]=r[8]*g,a[9]=r[9]*g,a[10]=r[10]*g,a[11]=r[11]*g,a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15],a}function le(a,r,s){var u=Math.sin(s),h=Math.cos(s),g=r[4],y=r[5],b=r[6],T=r[7],E=r[8],k=r[9],P=r[10],R=r[11];return r!==a&&(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[4]=g*h+E*u,a[5]=y*h+k*u,a[6]=b*h+P*u,a[7]=T*h+R*u,a[8]=E*h-g*u,a[9]=k*h-y*u,a[10]=P*h-b*u,a[11]=R*h-T*u,a}function pe(a,r,s){var u=Math.sin(s),h=Math.cos(s),g=r[0],y=r[1],b=r[2],T=r[3],E=r[8],k=r[9],P=r[10],R=r[11];return r!==a&&(a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[0]=g*h-E*u,a[1]=y*h-k*u,a[2]=b*h-P*u,a[3]=T*h-R*u,a[8]=g*u+E*h,a[9]=y*u+k*h,a[10]=b*u+P*h,a[11]=T*u+R*h,a}function Ae(a,r,s){var u=Math.sin(s),h=Math.cos(s),g=r[0],y=r[1],b=r[2],T=r[3],E=r[4],k=r[5],P=r[6],R=r[7];return r!==a&&(a[8]=r[8],a[9]=r[9],a[10]=r[10],a[11]=r[11],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[0]=g*h+E*u,a[1]=y*h+k*u,a[2]=b*h+P*u,a[3]=T*h+R*u,a[4]=E*h-g*u,a[5]=k*h-y*u,a[6]=P*h-b*u,a[7]=R*h-T*u,a}function Ze(a,r){return a[0]=r[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=r[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=r[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Xe(a,r,s){var u,h,g,y=s[0],b=s[1],T=s[2],E=Math.sqrt(y*y+b*b+T*T);return E<A?null:(y*=E=1/E,b*=E,T*=E,u=Math.sin(r),h=Math.cos(r),a[0]=y*y*(g=1-h)+h,a[1]=b*y*g+T*u,a[2]=T*y*g-b*u,a[3]=0,a[4]=y*b*g-T*u,a[5]=b*b*g+h,a[6]=T*b*g+y*u,a[7]=0,a[8]=y*T*g+b*u,a[9]=b*T*g-y*u,a[10]=T*T*g+h,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)}function Je(a,r){var s=r[0],u=r[1],h=r[2],g=r[4],y=r[5],b=r[6],T=r[8],E=r[9],k=r[10];return a[0]=Math.sqrt(s*s+u*u+h*h),a[1]=Math.sqrt(g*g+y*y+b*b),a[2]=Math.sqrt(T*T+E*E+k*k),a}function Te(a,r){var s=r[0],u=r[1],h=r[2],g=r[3],y=s+s,b=u+u,T=h+h,E=s*y,k=u*y,P=u*b,R=h*y,L=h*b,z=h*T,W=g*y,J=g*b,te=g*T;return a[0]=1-P-z,a[1]=k+te,a[2]=R-J,a[3]=0,a[4]=k-te,a[5]=1-E-z,a[6]=L+W,a[7]=0,a[8]=R+J,a[9]=L-W,a[10]=1-E-P,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}var xe=H;function Be(){var a=new I(3);return I!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function dt(a){var r=new I(3);return r[0]=a[0],r[1]=a[1],r[2]=a[2],r}function qt(a){var r=a[0],s=a[1],u=a[2];return Math.sqrt(r*r+s*s+u*u)}function Ke(a,r,s){var u=new I(3);return u[0]=a,u[1]=r,u[2]=s,u}function st(a,r,s,u){return a[0]=r,a[1]=s,a[2]=u,a}function Ne(a,r,s){return a[0]=r[0]+s[0],a[1]=r[1]+s[1],a[2]=r[2]+s[2],a}function De(a,r,s){return a[0]=r[0]-s[0],a[1]=r[1]-s[1],a[2]=r[2]-s[2],a}function Tt(a,r,s){return a[0]=r[0]*s[0],a[1]=r[1]*s[1],a[2]=r[2]*s[2],a}function Pt(a,r,s){return a[0]=Math.min(r[0],s[0]),a[1]=Math.min(r[1],s[1]),a[2]=Math.min(r[2],s[2]),a}function fe(a,r,s){return a[0]=Math.max(r[0],s[0]),a[1]=Math.max(r[1],s[1]),a[2]=Math.max(r[2],s[2]),a}function Le(a,r,s){return a[0]=r[0]*s,a[1]=r[1]*s,a[2]=r[2]*s,a}function vt(a,r,s,u){return a[0]=r[0]+s[0]*u,a[1]=r[1]+s[1]*u,a[2]=r[2]+s[2]*u,a}function Wt(a,r){var s=r[0]-a[0],u=r[1]-a[1],h=r[2]-a[2];return Math.sqrt(s*s+u*u+h*h)}function Ft(a,r){var s=r[0]-a[0],u=r[1]-a[1],h=r[2]-a[2];return s*s+u*u+h*h}function Ut(a){var r=a[0],s=a[1],u=a[2];return r*r+s*s+u*u}function vr(a,r){return a[0]=-r[0],a[1]=-r[1],a[2]=-r[2],a}function xr(a,r){var s=r[0],u=r[1],h=r[2],g=s*s+u*u+h*h;return g>0&&(g=1/Math.sqrt(g)),a[0]=r[0]*g,a[1]=r[1]*g,a[2]=r[2]*g,a}function zr(a,r){return a[0]*r[0]+a[1]*r[1]+a[2]*r[2]}function Hr(a,r,s){var u=r[0],h=r[1],g=r[2],y=s[0],b=s[1],T=s[2];return a[0]=h*T-g*b,a[1]=g*y-u*T,a[2]=u*b-h*y,a}function jn(a,r,s,u){var h=r[0],g=r[1],y=r[2];return a[0]=h+u*(s[0]-h),a[1]=g+u*(s[1]-g),a[2]=y+u*(s[2]-y),a}function hn(a,r,s){var u=r[0],h=r[1],g=r[2],y=s[3]*u+s[7]*h+s[11]*g+s[15];return a[0]=(s[0]*u+s[4]*h+s[8]*g+s[12])/(y=y||1),a[1]=(s[1]*u+s[5]*h+s[9]*g+s[13])/y,a[2]=(s[2]*u+s[6]*h+s[10]*g+s[14])/y,a}function Ji(a,r,s){var u=r[0],h=r[1],g=r[2];return a[0]=u*s[0]+h*s[3]+g*s[6],a[1]=u*s[1]+h*s[4]+g*s[7],a[2]=u*s[2]+h*s[5]+g*s[8],a}function Ii(a,r,s){var u=s[0],h=s[1],g=s[2],y=s[3],b=r[0],T=r[1],E=r[2],k=h*E-g*T,P=g*b-u*E,R=u*T-h*b;return a[0]=b+y*(k+=k)+h*(R+=R)-g*(P+=P),a[1]=T+y*P+g*k-u*R,a[2]=E+y*R+u*P-h*k,a}function Vi(a){return a[0]=0,a[1]=0,a[2]=0,a}function As(a,r){return a[0]===r[0]&&a[1]===r[1]&&a[2]===r[2]}var bi=De,Is=Tt,nt=qt;function Ct(){var a=new I(4);return I!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0),a}function Kt(a,r,s){return a[0]=r[0]*s,a[1]=r[1]*s,a[2]=r[2]*s,a[3]=r[3]*s,a}function jr(a,r){var s=r[0],u=r[1],h=r[2],g=r[3],y=s*s+u*u+h*h+g*g;return y>0&&(y=1/Math.sqrt(y)),a[0]=s*y,a[1]=u*y,a[2]=h*y,a[3]=g*y,a}function yr(a,r,s){var u=r[0],h=r[1],g=r[2],y=r[3];return a[0]=s[0]*u+s[4]*h+s[8]*g+s[12]*y,a[1]=s[1]*u+s[5]*h+s[9]*g+s[13]*y,a[2]=s[2]*u+s[6]*h+s[10]*g+s[14]*y,a[3]=s[3]*u+s[7]*h+s[11]*g+s[15]*y,a}function br(){var a=new I(4);return I!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function Fr(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function On(a,r,s){s*=.5;var u=r[0],h=r[1],g=r[2],y=r[3],b=Math.sin(s),T=Math.cos(s);return a[0]=u*T+y*b,a[1]=h*T+g*b,a[2]=g*T-h*b,a[3]=y*T-u*b,a}function pi(a,r,s){s*=.5;var u=r[0],h=r[1],g=r[2],y=r[3],b=Math.sin(s),T=Math.cos(s);return a[0]=u*T-g*b,a[1]=h*T+y*b,a[2]=g*T+u*b,a[3]=y*T-h*b,a}Be(),Ct();var Ri,$s,ws,Lo=jr,ho=(Ri=Be(),$s=Ke(1,0,0),ws=Ke(0,1,0),function(a,r,s){var u=zr(r,s);return u<-.999999?(Hr(Ri,$s,r),nt(Ri)<1e-6&&Hr(Ri,ws,r),xr(Ri,Ri),function(h,g,y){y*=.5;var b=Math.sin(y);h[0]=b*g[0],h[1]=b*g[1],h[2]=b*g[2],h[3]=Math.cos(y)}(a,Ri,Math.PI),a):u>.999999?(a[0]=0,a[1]=0,a[2]=0,a[3]=1,a):(Hr(Ri,r,s),a[0]=Ri[0],a[1]=Ri[1],a[2]=Ri[2],a[3]=1+u,Lo(a,a))});function rr(){var a=new I(2);return I!=Float32Array&&(a[0]=0,a[1]=0),a}function yt(a,r){var s=new I(2);return s[0]=a,s[1]=r,s}function Ar(a,r,s){return a[0]=r,a[1]=s,a}function Qr(a,r,s){return a[0]=r[0]+s[0],a[1]=r[1]+s[1],a}function Cn(a,r,s){return a[0]=r[0]-s[0],a[1]=r[1]-s[1],a}function Mi(a,r,s){return a[0]=r[0]*s,a[1]=r[1]*s,a}function li(a){var r=a[0],s=a[1];return Math.sqrt(r*r+s*s)}function Os(a,r){var s=r[0],u=r[1],h=s*s+u*u;return h>0&&(h=1/Math.sqrt(h)),a[0]=r[0]*h,a[1]=r[1]*h,a}function Il(a,r){return a[0]*r[0]+a[1]*r[1]}br(),br(),U();var zo,ra,Yn=Cn;function qi(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}rr();var ps=function(){if(ra)return zo;function a(r,s,u,h){this.cx=3*r,this.bx=3*(u-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(h-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=s,this.p2x=u,this.p2y=h}return ra=1,zo=a,a.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,s){if(s===void 0&&(s=1e-6),r<0)return 0;if(r>1)return 1;for(var u=r,h=0;h<8;h++){var g=this.sampleCurveX(u)-r;if(Math.abs(g)<s)return u;var y=this.sampleCurveDerivativeX(u);if(Math.abs(y)<1e-6)break;u-=g/y}var b=0,T=1;for(u=r,h=0;h<20&&(g=this.sampleCurveX(u),!(Math.abs(g-r)<s));h++)r>g?b=u:T=u,u=.5*(T-b)+b;return u},solve:function(r,s){return this.sampleCurveY(this.solveCurveX(r,s))}},zo}(),Ao=qi(ps);function wt(a,r){this.x=a,this.y=r}function jo(a,r){if(Array.isArray(a)){if(!Array.isArray(r)||a.length!==r.length)return!1;for(let s=0;s<a.length;s++)if(!jo(a[s],r[s]))return!1;return!0}if(typeof a=="object"&&a!==null&&r!==null){if(typeof r!="object"||Object.keys(a).length!==Object.keys(r).length)return!1;for(const s in a)if(!jo(a[s],r[s]))return!1;return!0}return a===r}wt.prototype={clone(){return new wt(this.x,this.y)},add(a){return this.clone()._add(a)},sub(a){return this.clone()._sub(a)},multByPoint(a){return this.clone()._multByPoint(a)},divByPoint(a){return this.clone()._divByPoint(a)},mult(a){return this.clone()._mult(a)},div(a){return this.clone()._div(a)},rotate(a){return this.clone()._rotate(a)},rotateAround(a,r){return this.clone()._rotateAround(a,r)},matMult(a){return this.clone()._matMult(a)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(a){return this.x===a.x&&this.y===a.y},dist(a){return Math.sqrt(this.distSqr(a))},distSqr(a){const r=a.x-this.x,s=a.y-this.y;return r*r+s*s},angle(){return Math.atan2(this.y,this.x)},angleTo(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith(a){return this.angleWithSep(a.x,a.y)},angleWithSep(a,r){return Math.atan2(this.x*r-this.y*a,this.x*a+this.y*r)},_matMult(a){const r=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=r,this},_add(a){return this.x+=a.x,this.y+=a.y,this},_sub(a){return this.x-=a.x,this.y-=a.y,this},_mult(a){return this.x*=a,this.y*=a,this},_div(a){return this.x/=a,this.y/=a,this},_multByPoint(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint(a){return this.x/=a.x,this.y/=a.y,this},_unit(){return this._div(this.mag()),this},_perp(){const a=this.y;return this.y=this.x,this.x=-a,this},_rotate(a){const r=Math.cos(a),s=Math.sin(a),u=s*this.x+r*this.y;return this.x=r*this.x-s*this.y,this.y=u,this},_rotateAround(a,r){const s=Math.cos(a),u=Math.sin(a),h=r.y+u*(this.x-r.x)+s*(this.y-r.y);return this.x=r.x+s*(this.x-r.x)-u*(this.y-r.y),this.y=h,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:wt},wt.convert=function(a){if(a instanceof wt)return a;if(Array.isArray(a))return new wt(+a[0],+a[1]);if(a.x!==void 0&&a.y!==void 0)return new wt(+a.x,+a.y);throw new Error("Expected [x, y] or {x, y} point format")};const ja=Math.PI/180,Fo=180/Math.PI;function gn(a){return a*ja}function Bo(a){return a*Fo}const ev=[[0,0],[1,0],[1,1],[0,1]];function rp(a){if(a<=0)return 0;if(a>=1)return 1;const r=a*a,s=r*a;return 4*(a<.5?s:3*(a-r)+s-.75)}function qe(a,r,s,u){const h=new Ao(a,r,s,u);return function(g){return h.solve(g)}}const re=qe(.25,.1,.25,1);function se(a,r,s){return Math.min(s,Math.max(r,a))}function ye(a,r,s){return(s=se((s-a)/(r-a),0,1))*s*(3-2*s)}function Re(a,r,s){const u=s-r,h=((a-r)%u+u)%u+r;return h===r?s:h}function Pe(a,r,s){if(!a.length)return s(null,[]);let u=a.length;const h=new Array(a.length);let g=null;a.forEach((y,b)=>{r(y,(T,E)=>{T&&(g=T),h[b]=E,--u==0&&s(g,h)})})}let Ve=1;function it(){return Ve++}function Ue(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log2(a)))}function tt(a,r){a.forEach(s=>{r[s]&&(r[s]=r[s].bind(r))})}function Dt(a,r,s){const u={};for(const h in a)u[h]=r.call(this,a[h],h,a);return u}function jt(a,r,s){const u={};for(const h in a)r.call(this,a[h],h,a)&&(u[h]=a[h]);return u}function pr(a){return Array.isArray(a)?a.map(pr):typeof a=="object"&&a?Dt(a,pr):a}function Wr(a,r){for(let s=0;s<a.length;s++)if(r.indexOf(a[s])>=0)return!0;return!1}const $r={};function Cr(a){$r[a]||(typeof console<"u"&&console.warn(a),$r[a]=!0)}function fn(a,r,s){return(s.y-a.y)*(r.x-a.x)>(r.y-a.y)*(s.x-a.x)}function yn(a){let r=0;for(let s,u,h=0,g=a.length,y=g-1;h<g;y=h++)s=a[h],u=a[y],r+=(u.x-s.x)*(s.y+u.y);return r}function hi([a,r,s]){const u=gn(r+90),h=gn(s);return{x:a*Math.cos(u)*Math.sin(h),y:a*Math.sin(u)*Math.sin(h),z:a*Math.cos(h),azimuthal:r,polar:s}}function ns(a){return(typeof self<"u"||a!==void 0)&&typeof WorkerGlobalScope<"u"&&(a!==void 0?a:self)instanceof WorkerGlobalScope}function ks(a){const r={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,u,h,g)=>{const y=h||g;return r[u]=!y||y.toLowerCase(),""}),r["max-age"]){const s=parseInt(r["max-age"],10);isNaN(s)?delete r["max-age"]:r["max-age"]=s}return r}let ms=null;function us(a,r){return[a[4*r],a[4*r+1],a[4*r+2],a[4*r+3]]}function ci(a,r,s,u){for(;r<s;){const h=r+s>>1;a[h]<u?r=h+1:s=h}return r}function kn(a,r,s,u){for(;r<s;){const h=r+s>>1;a[h]<=u?r=h+1:s=h}return r}function Ni(a){return a>0?1/(1.001-a):1+a}function Qi(a){return a>0?1-1/(1.001-a):-a}function mi(a,r,s){return(a-r.min)*(s.max-s.min)/(r.max-r.min)+s.min}const Di={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Di.API_URL)return null;try{const a=new URL(Di.API_URL);return a.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":a.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function qs(a){return Di.API_URL_REGEX.test(a)}function Vo(a){return Di.API_SPRITE_REGEX.test(a)}let rl,sd,Js,nl,Xo,kl;function fa(){return rl==null&&(rl=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),rl}const pa={now:()=>nl!==void 0?nl:performance.now(),setNow(a){nl=a},restoreNow(){nl=void 0},frame(a){const r=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(r)}},getImageData(a,r=0){const{width:s,height:u}=a;Xo||(Xo=document.createElement("canvas"));const h=Xo.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(s>Xo.width||u>Xo.height)&&(Xo.width=s,Xo.height=u),h.clearRect(-r,-r,s+2*r,u+2*r),h.drawImage(a,0,0,s,u),h.getImageData(-r,-r,s+2*r,u+2*r)},resolveURL:a=>(sd||(sd=document.createElement("a")),sd.href=a,sd.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Js==null&&(Js=window.matchMedia("(prefers-reduced-motion: reduce)")),Js.matches)},hasCanvasFingerprintNoise(){if(kl!==void 0)return kl;if(!fa())return kl=!1,!1;const a=new OffscreenCanvas(85,1),r=a.getContext("2d",{willReadFrequently:!0});let s=0;for(let h=0;h<a.width;++h)r.fillStyle=`rgba(${s++},${s++},${s++}, 255)`,r.fillRect(h,0,1,1);const u=r.getImageData(0,0,a.width,a.height);s=0;for(let h=0;h<u.data.length;++h)if(h%4!=3&&s++!==u.data[h])return kl=!0,!0;return kl=!1,!1}};function Wm(a,r){const s=a.indexOf("?");if(s<0)return`${a}?${new URLSearchParams(r).toString()}`;const u=new URLSearchParams(a.slice(s));for(const h in r)u.set(h,r[h]);return`${a.slice(0,s)}?${u.toString()}`}function np(a,r={persistentParams:[]}){const s=a.indexOf("?");if(s<0)return a;const u=new URLSearchParams,h=new URLSearchParams(a.slice(s));for(const y of r.persistentParams){const b=h.get(y);b&&u.set(y,b)}const g=u.toString();return`${a.slice(0,s)}${g.length>0?`?${g}`:""}`}const ip="mapbox-tiles";let sp=500,na=50;const Pl=["language","worldview","jobid"];let Ko,Ia;function jc(){try{return caches}catch{}}function od(){const a=jc();a&&Ko==null&&(Ko=a.open(ip))}let Zm=1/0;const Xm={supported:!1,testSupport:function(a){!tv&&vu&&(Gb?rv(a):tc=a)}};let tc,vu,tv=!1,Gb=!1;const il=typeof self<"u"?self:{};function rv(a){const r=a.createTexture();a.bindTexture(a.TEXTURE_2D,r);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,vu),a.isContextLost())return;Xm.supported=!0}catch{}a.deleteTexture(r),tv=!0}il.document&&(vu=il.document.createElement("img"),vu.onload=function(){tc&&rv(tc),tc=null,Gb=!0},vu.onerror=function(){tv=!0,tc=null},vu.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ad={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(ad);class ld extends Error{constructor(r,s,u){s===401&&qs(u)&&(r+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(r),this.status=s,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const nv=ns()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,op=function(a,r){if(!(/^file:/.test(s=a.url)||/^file:/.test(nv())&&!/^\w+:/.test(s))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(u,h){const g=new AbortController,y=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:nv(),referrerPolicy:u.referrerPolicy,signal:g.signal});let b=!1,T=!1;const E=(k=y.url).indexOf("sku=")>0&&qs(k);var k;u.type==="json"&&y.headers.set("Accept","application/json");const P=(L,z,W)=>{if(T)return;if(L&&L.message!=="SecurityError"&&Cr(L.toString()),z&&W)return R(z);const J=Date.now();fetch(y).then(te=>{if(te.ok){const ae=E?te.clone():null;return R(te,ae,J)}return h(new ld(te.statusText,te.status,u.url))}).catch(te=>{te.name!=="AbortError"&&h(new Error(`${te.message} ${u.url}`))})},R=(L,z,W)=>{(u.type==="arrayBuffer"?L.arrayBuffer():u.type==="json"?L.json():L.text()).then(J=>{T||(z&&W&&function(te,ae,ue){if(od(),Ko==null)return;const he=ks(ae.headers.get("Cache-Control")||"");if(he["no-store"])return;const Ce={status:ae.status,statusText:ae.statusText,headers:new Headers};ae.headers.forEach((Me,ze)=>Ce.headers.set(ze,Me)),he["max-age"]&&Ce.headers.set("Expires",new Date(ue+1e3*he["max-age"]).toUTCString());const be=Ce.headers.get("Expires");if(!be||new Date(be).getTime()-ue<42e4)return;let ke=np(te.url,{persistentParams:Pl});if(ae.status===206){const Me=te.headers.get("Range");if(!Me)return;Ce.status=200,ke=Wm(ke,{range:Me})}(function(Me,ze){if(Ia===void 0)try{new Response(new ReadableStream),Ia=!0}catch{Ia=!1}Ia?ze(Me.body):Me.blob().then(ze).catch(ct=>Cr(ct.message))})(ae,Me=>{const ze=new Response((ct=ae.status)!==200&&ct!==404&&[101,103,204,205,304].includes(ct)?null:Me,Ce);var ct;od(),Ko!=null&&Ko.then(We=>We.put(ke,ze)).catch(We=>Cr(We.message))})}(y,z,W),b=!0,h(null,J,L.headers))}).catch(J=>{T||h(new Error(J.message))})};return E?function(L,z){if(od(),Ko==null)return z(null);Ko.then(W=>{let J=np(L.url,{persistentParams:Pl});const te=L.headers.get("Range");te&&(J=Wm(J,{range:te})),W.match(J).then(ae=>{const ue=function(he){if(!he)return!1;const Ce=new Date(he.headers.get("Expires")||0),be=ks(he.headers.get("Cache-Control")||"");return Number(Ce)>Date.now()&&!be["no-cache"]}(ae);W.delete(J).catch(z),ue&&W.put(J,ae.clone()).catch(z),z(null,ae,ue)}).catch(z)}).catch(z)}(y,P):P(null,null),{cancel:()=>{T=!0,b||g.abort()}}}(a,r);if(ns(self)&&self.worker.actor)return self.worker.actor.send("getResource",a,r,void 0,!0)}var s;return function(u,h){const g=new XMLHttpRequest;g.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(g.responseType="arraybuffer");for(const y in u.headers)g.setRequestHeader(y,u.headers[y]);return u.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=u.credentials==="include",g.onerror=()=>{h(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let y=g.response;if(u.type==="json")try{y=JSON.parse(g.response)}catch(T){return h(T)}const b=new Headers;g.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(T=>{const E=T.split(": "),k=E.shift(),P=E.join(": ");b.append(k,P)}),h(null,y,b)}else h(new ld(g.statusText,g.status,u.url))},g.send(u.body),{cancel:()=>g.abort()}}(a,r)},ih=function(a,r){return op(Object.assign(a,{type:"arrayBuffer"}),r)};function Jn(a){const r=document.createElement("a");return r.href=a,r.protocol===location.protocol&&r.host===location.host}const iv="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ap,lp;ap=[],lp=0;const sv=function(a,r){if(Xm.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),lp>=Di.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:a,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return ap.push(g),g}lp++;let s=!1;const u=()=>{if(!s)for(s=!0,lp--;ap.length&&lp<Di.MAX_PARALLEL_IMAGE_REQUESTS;){const g=ap.shift(),{requestParameters:y,callback:b,cancelled:T}=g;T||(g.cancel=sv(y,b).cancel)}},h=ih(a,(g,y,b)=>{u(),g?r(g):y&&(self.createImageBitmap?function(T,E){const k=new Blob([new Uint8Array(T)],{type:"image/png"});createImageBitmap(k).then(P=>{E(null,P)}).catch(P=>{E(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(T,E)=>r(T,E,b)):function(T,E){const k=new Image;k.onload=()=>{E(null,k),URL.revokeObjectURL(k.src),k.onload=null,requestAnimationFrame(()=>{k.src=iv})},k.onerror=()=>E(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const P=new Blob([new Uint8Array(T)],{type:"image/png"});k.src=T.byteLength?URL.createObjectURL(P):iv}(y,(T,E)=>r(T,E,b)))});return{cancel:()=>{h.cancel(),u()}}};var cp,up,dp,cd={exports:{}},Hb={exports:{}},Km={exports:{}},V2=function(){if(dp)return cd.exports;dp=1;var a=(cp||(cp=1,Hb.exports=function(s,u){var h,g,y,b,T,E,k,P;for(g=s.length-(h=3&s.length),y=u,T=3432918353,E=461845907,P=0;P<g;)k=255&s.charCodeAt(P)|(255&s.charCodeAt(++P))<<8|(255&s.charCodeAt(++P))<<16|(255&s.charCodeAt(++P))<<24,++P,y=27492+(65535&(b=5*(65535&(y=(y^=k=(65535&(k=(k=(65535&k)*T+(((k>>>16)*T&65535)<<16)&4294967295)<<15|k>>>17))*E+(((k>>>16)*E&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(k=0,h){case 3:k^=(255&s.charCodeAt(P+2))<<16;case 2:k^=(255&s.charCodeAt(P+1))<<8;case 1:y^=k=(65535&(k=(k=(65535&(k^=255&s.charCodeAt(P)))*T+(((k>>>16)*T&65535)<<16)&4294967295)<<15|k>>>17))*E+(((k>>>16)*E&65535)<<16)&4294967295}return y^=s.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0}),Hb.exports),r=(up||(up=1,Km.exports=function(s,u){for(var h,g=s.length,y=u^g,b=0;g>=4;)h=1540483477*(65535&(h=255&s.charCodeAt(b)|(255&s.charCodeAt(++b))<<8|(255&s.charCodeAt(++b))<<16|(255&s.charCodeAt(++b))<<24))+((1540483477*(h>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),g-=4,++b;switch(g){case 3:y^=(255&s.charCodeAt(b+2))<<16;case 2:y^=(255&s.charCodeAt(b+1))<<8;case 1:y=1540483477*(65535&(y^=255&s.charCodeAt(b)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0}),Km.exports);return cd.exports=a,cd.exports.murmur3=a,cd.exports.murmur2=r,cd.exports}(),hp=qi(V2);class ka{constructor(r,...s){Object.assign(this,s[0]||{}),this.type=r}}class fp extends ka{constructor(r,s={}){super("error",Object.assign({error:r},s))}}function sh(a,r,s){s[a]&&s[a].indexOf(r)!==-1||(s[a]=s[a]||[],s[a].push(r))}function pp(a,r,s){if(s&&s[a]){const u=s[a].indexOf(r);u!==-1&&s[a].splice(u,1)}}class Ic{on(r,s){return this._listeners=this._listeners||{},sh(r,s,this._listeners),this}off(r,s){return pp(r,s,this._listeners),pp(r,s,this._oneTimeListeners),this}once(r,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},sh(r,s,this._oneTimeListeners),this):new Promise(u=>{this.once(r,u)})}fire(r,s){const u=typeof r=="string"?new ka(r,s):r,h=u.type;if(this.listens(h)){u.target=this;const g=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const T of g)T.call(this,u);const y=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const T of y)pp(h,T,this._oneTimeListeners),T.call(this,u);const b=this._eventedParent;if(b){const T=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(u,T),b.fire(u)}}else u instanceof fp&&console.error(u.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,s){return this._eventedParent=r,this._eventedParentData=s,this}}class Gs{constructor(r){typeof r=="string"?this.name=r:(this.name=r.name,this.iconsetId=r.iconsetId)}static from(r){return new Gs(r)}static toString(r){return r.iconsetId?`${r.name}${r.iconsetId}`:r.name}static parse(r){const[s,u]=r.split("");return new Gs({name:s,iconsetId:u})}static isEqual(r,s){return r.name===s.name&&r.iconsetId===s.iconsetId}toString(){return Gs.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var ov,av={},lv=function(){if(ov)return av;ov=1;var a={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(g){return(g=Math.round(g))<0?0:g>255?255:g}function s(g){return r(g[g.length-1]==="%"?parseFloat(g)/100*255:parseInt(g))}function u(g){return(y=g[g.length-1]==="%"?parseFloat(g)/100:parseFloat(g))<0?0:y>1?1:y;var y}function h(g,y,b){return b<0?b+=1:b>1&&(b-=1),6*b<1?g+(y-g)*b*6:2*b<1?y:3*b<2?g+(y-g)*(2/3-b)*6:g}try{av.parseCSSColor=function(g){var y,b=g.replace(/ /g,"").toLowerCase();if(b in a)return a[b].slice();if(b[0]==="#")return b.length===4?(y=parseInt(b.substr(1),16))>=0&&y<=4095?[(3840&y)>>4|(3840&y)>>8,240&y|(240&y)>>4,15&y|(15&y)<<4,1]:null:b.length===7&&(y=parseInt(b.substr(1),16))>=0&&y<=16777215?[(16711680&y)>>16,(65280&y)>>8,255&y,1]:null;var T=b.indexOf("("),E=b.indexOf(")");if(T!==-1&&E+1===b.length){var k=b.substr(0,T),P=b.substr(T+1,E-(T+1)).split(","),R=1;switch(k){case"rgba":if(P.length!==4)return null;R=u(P.pop());case"rgb":return P.length!==3?null:[s(P[0]),s(P[1]),s(P[2]),R];case"hsla":if(P.length!==4)return null;R=u(P.pop());case"hsl":if(P.length!==3)return null;var L=(parseFloat(P[0])%360+360)%360/360,z=u(P[1]),W=u(P[2]),J=W<=.5?W*(z+1):W+z-W*z,te=2*W-J;return[r(255*h(te,J,L+1/3)),r(255*h(te,J,L)),r(255*h(te,J,L-1/3)),R];default:return null}}return null}}catch{}return av}();class ri{constructor(r,s,u,h=1){this.r=r,this.g=s,this.b=u,this.a=h}static parse(r){if(!r)return;if(r instanceof ri)return r;if(typeof r!="string")return;const s=lv.parseCSSColor(r);return s?new ri(s[0]/255,s[1]/255,s[2]/255,s[3]):void 0}toString(){const[r,s,u,h]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*r)},${Math.round(255*s)},${Math.round(255*u)},${h})`}toNonPremultipliedRenderColor(r){const{r:s,g:u,b:h,a:g}=this;return new Wb(r,s,u,h,g)}toPremultipliedRenderColor(r){const{r:s,g:u,b:h,a:g}=this;return new Zb(r,s*g,u*g,h*g,g)}clone(){return new ri(this.r,this.g,this.b,this.a)}}class cv{constructor(r,s,u,h,g,y=!1){if(this.premultiplied=!1,this.premultiplied=y,r){const b=r.image.height,T=b*b;this.premultiplied?(s=g===0?0:s/g*(b-1),u=g===0?0:u/g*(b-1),h=g===0?0:h/g*(b-1)):(s*=b-1,u*=b-1,h*=b-1);const E=Math.floor(s),k=Math.floor(u),P=Math.floor(h),R=Math.ceil(s),L=Math.ceil(u),z=Math.ceil(h),W=s-E,J=u-k,te=h-P,ae=r.image.data,ue=4*(E+k*T+P*b),he=4*(E+k*T+z*b),Ce=4*(E+L*T+P*b),be=4*(E+L*T+z*b),ke=4*(R+k*T+P*b),Me=4*(R+k*T+z*b),ze=4*(R+L*T+P*b),ct=4*(R+L*T+z*b);if(ue<0||ct>=ae.length)throw new Error("out of range");this.r=Br(Br(Br(ae[ue],ae[he],te),Br(ae[Ce],ae[be],te),J),Br(Br(ae[ke],ae[Me],te),Br(ae[ze],ae[ct],te),J),W)/255*(this.premultiplied?g:1),this.g=Br(Br(Br(ae[ue+1],ae[he+1],te),Br(ae[Ce+1],ae[be+1],te),J),Br(Br(ae[ke+1],ae[Me+1],te),Br(ae[ze+1],ae[ct+1],te),J),W)/255*(this.premultiplied?g:1),this.b=Br(Br(Br(ae[ue+2],ae[he+2],te),Br(ae[Ce+2],ae[be+2],te),J),Br(Br(ae[ke+2],ae[Me+2],te),Br(ae[ze+2],ae[ct+2],te),J),W)/255*(this.premultiplied?g:1),this.a=g}else this.r=s,this.g=u,this.b=h,this.a=g}toArray(){const{r,g:s,b:u,a:h}=this;return[255*r,255*s,255*u,h]}toHslaArray(){let{r,g:s,b:u,a:h}=this;if(this.premultiplied){if(h===0)return[0,0,0,0];const z=1/h;r*=z,s*=z,u*=z}const g=Math.min(Math.max(r,0),1),y=Math.min(Math.max(s,0),1),b=Math.min(Math.max(u,0),1),T=Math.min(g,y,b),E=Math.max(g,y,b),k=E-T,P=.5*(T+E);if(k===0)return[0,0,100*P,h];const R=P>.5?k/(2-E-T):k/(E+T);let L;switch(E){case g:L=60*((y-b)/k+(y<b?6:0));break;case y:L=60*((b-g)/k+2);break;default:L=60*((g-y)/k+4)}return[L,100*R,100*P,h]}toArray01(){const{r,g:s,b:u,a:h}=this;return[r,s,u,h]}toArray01Scaled(r){const{r:s,g:u,b:h}=this;return[s*r,u*r,h*r]}toArray01Linear(){const{r,g:s,b:u,a:h}=this;return[Math.pow(r,2.2),Math.pow(s,2.2),Math.pow(u,2.2),h]}}class Wb extends cv{constructor(r,s,u,h,g){super(r,s,u,h,g,!1)}}class Zb extends cv{constructor(r,s,u,h,g){super(r,s,u,h,g,!0)}}function Br(a,r,s){return a*(1-s)+r*s}function mp(a,r,s){return a.map((u,h)=>Br(u,r[h],s))}ri.black=new ri(0,0,0,1),ri.white=new ri(1,1,1,1),ri.transparent=new ri(0,0,0,0),ri.red=new ri(1,0,0,1),ri.blue=new ri(0,0,1,1);var kc=Object.freeze({__proto__:null,array:mp,color:function(a,r,s){return new ri(Br(a.r,r.r,s),Br(a.g,r.g,s),Br(a.b,r.b,s),Br(a.a,r.a,s))},number:Br});class sl extends Error{constructor(r,s){super(s),this.message=s,this.key=r}}class ol{constructor(r,s=[]){this.parent=r,this.bindings={};for(const[u,h]of s)this.bindings[u]=h}concat(r){return new ol(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const oh={kind:"null"},_r={kind:"number"},Un={kind:"string"},ei={kind:"boolean"},ma={kind:"color"},ah={kind:"object"},oi={kind:"value"},gp={kind:"collator"},ud={kind:"formatted"},_p={kind:"resolvedImage"};function fo(a,r){return{kind:"array",itemType:a,N:r}}function Ls(a){if(a.kind==="array"){const r=Ls(a.itemType);return typeof a.N=="number"?`array<${r}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${r}>`}return a.kind}const U2=[oh,_r,Un,ei,ma,ud,ah,fo(oi),_p];function yp(a,r){if(r.kind==="error")return null;if(a.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!yp(a.itemType,r.itemType))&&(typeof a.N!="number"||a.N===r.N))return null}else{if(a.kind===r.kind)return null;if(a.kind==="value"){for(const s of U2)if(!yp(s,r))return null}}return`Expected ${Ls(a)} but found ${Ls(r)} instead.`}function uv(a,r){return r.some(s=>s.kind===a.kind)}function vp(a,r){return r.some(s=>s==="null"?a===null:s==="array"?Array.isArray(a):s==="object"?a&&!Array.isArray(a)&&typeof a=="object":s===typeof a)}function Ym(a,r){return a.kind==="array"&&r.kind==="array"?a.N===r.N&&Ym(a.itemType,r.itemType):a.kind===r.kind}class dv{constructor(r,s,u){this.sensitivity=r?s?"variant":"case":s?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,s){return this.collator.compare(r,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class xp{constructor(r,s,u,h,g){this.text=r.normalize?r.normalize():r,this.image=s,this.scale=u,this.fontStack=h,this.textColor=g}}class ro{constructor(r){this.sections=r}static fromString(r){return new ro([new xp(r,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(r=>r.text.length!==0||!!r.image&&r.image.hasPrimary())}static factory(r){return r instanceof ro?r:ro.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const s of this.sections){if(s.image){const h=s.image.getPrimary().id.toString();r.push(["image",h]);continue}r.push(s.text);const u={};s.fontStack&&(u["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(u["font-scale"]=s.scale),s.textColor&&(u["text-color"]=["rgba"].concat(s.textColor.toNonPremultipliedRenderColor(null).toArray())),r.push(u)}return r}}class Pc{constructor(r,s={}){if(this.id=Gs.from(r),this.options=Object.assign({},s),s.transform){const{a:u,b:h,c:g,d:y,e:b,f:T}=s.transform;this.options.transform=new DOMMatrix([u,h,g,y,b,T])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:r,b:s,c:u,d:h,e:g,f:y}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:r,b:s,c:u,d:h,e:g,f:y}})}static parse(r){let s,u,h,g;try{({name:s,iconsetId:u,params:h,transform:g}=JSON.parse(r)||{})}catch{return null}if(!s)return null;const{a:y,b,c:T,d:E,e:k,f:P}=g||{};return new Pc({name:s,iconsetId:u},{params:h,transform:new DOMMatrix([y,b,T,E,k,P])})}scaleSelf(r,s){return this.options.transform.scaleSelf(r,s),this}}class ia{constructor(r,s,u,h,g=!1){this.primaryId=Gs.from(r),this.primaryOptions=s,u&&(this.secondaryId=Gs.from(u)),this.secondaryOptions=h,this.available=g}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Pc(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Pc(this.secondaryId,this.secondaryOptions):null}static from(r){return typeof r=="string"?ia.build({name:r}):r}static build(r,s,u,h){return!r||typeof r=="object"&&!("name"in r)?null:new ia(r,u,s,h)}}function Jm(a,r,s,u){return typeof a=="number"&&a>=0&&a<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof s=="number"&&s>=0&&s<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[a,r,s,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[a,r,s,u]:[a,r,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function lh(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof ri||a instanceof dv||a instanceof ro||a instanceof ia)return!0;if(Array.isArray(a)){for(const r of a)if(!lh(r))return!1;return!0}if(typeof a=="object"){for(const r in a)if(!lh(a[r]))return!1;return!0}return!1}function Qs(a){if(a===null)return oh;if(typeof a=="string")return Un;if(typeof a=="boolean")return ei;if(typeof a=="number")return _r;if(a instanceof ri)return ma;if(a instanceof dv)return gp;if(a instanceof ro)return ud;if(a instanceof ia)return _p;if(Array.isArray(a)){const r=a.length;let s;for(const u of a){const h=Qs(u);if(s){if(s===h)continue;s=oi;break}s=h}return fo(s||oi,r)}return ah}function rc(a){const r=typeof a;return a===null?"":r==="string"||r==="number"||r==="boolean"?String(a):a instanceof ro||a instanceof ia||a instanceof ri?a.toString():JSON.stringify(a)}class Rc{constructor(r,s){this.type=r,this.value=s}static parse(r,s){if(r.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!lh(r[1]))return s.error("invalid value");const u=r[1];let h=Qs(u);const g=s.expectedType;return h.kind!=="array"||h.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(h=g),new Rc(h,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ri?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof ro?this.value.serialize():this.value}}class gs{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const un={string:Un,number:_r,boolean:ei,object:ah};class hr{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");let u,h=1;const g=r[0];if(g==="array"){let b,T;if(r.length>2){const E=r[1];if(typeof E!="string"||!(E in un)||E==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);b=un[E],h++}else b=oi;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return s.error('The length argument to "array" must be a positive integer literal',2);T=r[2],h++}u=fo(b,T)}else u=un[g];const y=[];for(;h<r.length;h++){const b=s.parse(r[h],h,oi);if(!b)return null;y.push(b)}return new hr(u,y)}evaluate(r){for(let s=0;s<this.args.length;s++){const u=this.args[s].evaluate(r);if(!yp(this.type,Qs(u)))return u;if(s===this.args.length-1)throw new gs(`The expression ${JSON.stringify(this.args[s].serialize())} evaluated to ${Ls(Qs(u))} but was expected to be of type ${Ls(this.type)}.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,s=[r.kind];if(r.kind==="array"){const u=r.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){s.push(u.kind);const h=r.N;(typeof h=="number"||this.args.length>1)&&s.push(h)}}return s.concat(this.args.map(u=>u.serialize()))}}class dd{constructor(r){this.type=ud,this.sections=r}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");const u=r[1];if(!Array.isArray(u)&&typeof u=="object")return s.error("First argument must be an image or text section.");const h=[];let g=!1;for(let y=1;y<=r.length-1;++y){const b=r[y];if(g&&typeof b=="object"&&!Array.isArray(b)){g=!1;let T=null;if(b["font-scale"]&&(T=s.parseObjectValue(b["font-scale"],y,"font-scale",_r),!T))return null;let E=null;if(b["text-font"]&&(E=s.parseObjectValue(b["text-font"],y,"text-font",fo(Un)),!E))return null;let k=null;if(b["text-color"]&&(k=s.parseObjectValue(b["text-color"],y,"text-color",ma),!k))return null;const P=h[h.length-1];P.scale=T,P.font=E,P.textColor=k}else{const T=s.parse(r[y],y,oi);if(!T)return null;const E=T.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,h.push({content:T,scale:null,font:null,textColor:null})}}return new dd(h)}evaluate(r){return new ro(this.sections.map(s=>{const u=s.content.evaluate(r);return Ym(Qs(u),_p)?new xp("",u,null,null,null):new xp(rc(u),null,s.scale?s.scale.evaluate(r):null,s.font?s.font.evaluate(r).join(","):null,s.textColor?s.textColor.evaluate(r):null)}))}eachChild(r){for(const s of this.sections)r(s.content),s.scale&&r(s.scale),s.font&&r(s.font),s.textColor&&r(s.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const s of this.sections){r.push(s.content.serialize());const u={};s.scale&&(u["font-scale"]=s.scale.serialize()),s.font&&(u["text-font"]=s.font.serialize()),s.textColor&&(u["text-color"]=s.textColor.serialize()),r.push(u)}return r}}class Kr{constructor(r,s,u,h){this._imageWarnHistory={},this.type=_p,this.namePrimary=r,this.nameSecondary=s,u&&(this.paramsPrimary=u.params,this.iconsetIdPrimary=u.iconset?u.iconset.id:void 0),h&&(this.paramsSecondary=h.params,this.iconsetIdSecondary=h.iconset?h.iconset.id:void 0)}static parse(r,s){if(r.length<2)return s.error("Expected two or more arguments.");let u=1;const h=[];function g(){if(u<r.length){const b=s.parse(r[u],u++,Un);return b?(h.push({image:b,options:{}}),!0):(s.error(h.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function y(){if(u<r.length){const T=r[u];if((b=T)===null||typeof b!="object"||Array.isArray(b))return!0;const E=T.params,k=T.iconset,P=s.concat(u);if(!E&&!k)return u++,!0;if(E){if(typeof E!="object"||E.constructor!==Object)return P.error('Image options "params" should be an object'),!1;const R={},L=P.concat(void 0,"params");for(const z in E){if(!z)return L.error("Image parameter name should be non-empty"),!1;const W=L.concat(void 0,z).parse(E[z],void 0,ma,void 0,{typeAnnotation:"coerce"});if(!W)return!1;R[z]=W}h[h.length-1].options.params=R}if(k){if(typeof k!="object"||k.constructor!==Object)return P.error('Image options "iconset" should be an object'),!1;if(!k.id)return P.error('Image options "iconset" should have an "id" property'),!1;h[h.length-1].options.iconset=k}return u++,!0}var b;return!0}for(let b=0;b<2;b++)if(!g()||!y())return;return new Kr(h[0].image,h[1]?h[1].image:void 0,h[0].options,h[1]?h[1].options:void 0)}evaluateParams(r,s){const u={};if(s){for(const h in s)if(s[h])try{u[h]=s[h].evaluate(r)}catch{continue}if(Object.keys(u).length!==0)return{params:u}}}evaluate(r){const s={name:this.namePrimary.evaluate(r),iconsetId:this.iconsetIdPrimary},u=this.nameSecondary?{name:this.nameSecondary.evaluate(r),iconsetId:this.iconsetIdSecondary}:void 0,h=ia.build(s,u,this.paramsPrimary?this.evaluateParams(r,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(r,this.paramsSecondary):void 0);if(h&&r.availableImages){const g=h.getPrimary().id;if(h.available=r.availableImages.some(y=>Gs.isEqual(y,g)),h.available){const y=h.getSecondary()?h.getSecondary().id:null;y&&(h.available=r.availableImages.some(b=>Gs.isEqual(b,y)))}}return h}eachChild(r){if(r(this.namePrimary),this.paramsPrimary)for(const s in this.paramsPrimary)this.paramsPrimary[s]&&r(this.paramsPrimary[s]);if(this.nameSecondary&&(r(this.nameSecondary),this.paramsSecondary))for(const s in this.paramsSecondary)this.paramsSecondary[s]&&r(this.paramsSecondary[s])}outputDefined(){return!1}serializeOptions(r,s){const u={};if(s&&(u.iconset={id:s}),r){u.params={};for(const h in r)r[h]&&(u.params[h]=r[h].serialize())}return Object.keys(u).length>0?u:void 0}serialize(){const r=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const s=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);s&&r.push(s)}if(this.nameSecondary&&(r.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const s=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);s&&r.push(s)}return r}}function ch(a){return qr(a)?"string":bp(a)?"number":eg(a)?"boolean":Array.isArray(a)?"array":a===null?"null":Qm(a)?"object":typeof a}function Qm(a){return a!=null&&!Array.isArray(a)&&typeof a!="function"&&!(a instanceof String||a instanceof Number||a instanceof Boolean)&&typeof a=="object"}function qr(a){return typeof a=="string"||a instanceof String}function bp(a){return typeof a=="number"||a instanceof Number}function eg(a){return typeof a=="boolean"||a instanceof Boolean}const Xb={"to-boolean":ei,"to-color":ma,"to-number":_r,"to-string":Un};class nc{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");const u=r[0],h=[];let g=oh;if(u==="to-array"){if(!Array.isArray(r[1]))return null;const y=r[1].length;if(s.expectedType){if(s.expectedType.kind!=="array")return s.error(`Expected ${s.expectedType.kind} but found array.`);g=fo(s.expectedType.itemType,y)}else{if(!(y>0&&lh(r[1][0])))return null;g=fo(Qs(r[1][0]),y)}for(let b=0;b<y;b++){const T=r[1][b];let E;if(Array.isArray(T))E=s.parse(T,void 0,g.itemType);else{const k=ch(T);if(k!==g.itemType.kind)return s.error(`Expected ${g.itemType.kind} but found ${k}.`);E=s.registry.literal.parse(["literal",T===void 0?null:T],s)}if(!E)return null;h.push(E)}}else{if((u==="to-boolean"||u==="to-string")&&r.length!==2)return s.error("Expected one argument.");g=Xb[u];for(let y=1;y<r.length;y++){const b=s.parse(r[y],y,oi);if(!b)return null;h.push(b)}}return new nc(g,h)}evaluate(r){if(this.type.kind==="boolean")return!!this.args[0].evaluate(r);if(this.type.kind==="color"){let s,u;for(const h of this.args){if(s=h.evaluate(r),u=null,s instanceof ri)return s;if(typeof s=="string"){const g=r.parseColor(s);if(g)return g}else if(Array.isArray(s)&&(u=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Jm(s[0],s[1],s[2],s[3]),!u))return new ri(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new gs(u||`Could not parse color from value '${typeof s=="string"?s:String(JSON.stringify(s))}'`)}if(this.type.kind==="number"){let s=null;for(const u of this.args){if(s=u.evaluate(r),s===null)return 0;const h=Number(s);if(!isNaN(h))return h}throw new gs(`Could not convert ${JSON.stringify(s)} to number.`)}return this.type.kind==="formatted"?ro.fromString(rc(this.args[0].evaluate(r))):this.type.kind==="resolvedImage"?ia.build(rc(this.args[0].evaluate(r))):this.type.kind==="array"?this.args.map(s=>s.evaluate(r)):rc(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if(this.type.kind==="formatted")return new dd([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Kr(this.args[0]).serialize();const r=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(s=>{r.push(s.serialize())}),r}}const tg=["Unknown","Point","LineString","Polygon"];class po{constructor(r,s,u){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=r,this.options=s,this.iconImageUseTheme=u}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?tg[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(r){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const r=this.featureDistanceData.center,s=this.featureDistanceData.scale,{x:u,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*s-r[0])+this.featureDistanceData.bearing[1]*(h*s-r[1])}return 0}parseColor(r){let s=this._parseColorCache[r];return s||(s=this._parseColorCache[r]=ri.parse(r)),s}getConfig(r){return this.options?this.options.get(r):null}}class Uo{constructor(r,s,u,h,g){this.name=r,this.type=s,this._evaluate=u,this.args=h,this._overloadIndex=g}evaluate(r){if(!this._evaluate){const s=Uo.definitions[this.name];this._evaluate=Array.isArray(s)?s[2]:s.overloads[this._overloadIndex][1]}return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,s){const u=r[0],h=Uo.definitions[u];if(!h)return s.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(h)?h[0]:h.type,y=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,b=[];let T=null,E=-1;for(const[k,P]of y){if(Array.isArray(k)&&k.length!==r.length-1)continue;b.push(k),E++,T=new dg(s.registry,s.path,null,s.scope,void 0,s._scope,s.options,s.iconImageUseTheme);const R=[];let L=!1;for(let z=1;z<r.length;z++){const W=r[z],J=Array.isArray(k)?k[z-1]:k.type,te=T.parse(W,1+R.length,J);if(!te){L=!0;break}R.push(te)}if(!L)if(Array.isArray(k)&&k.length!==R.length)T.error(`Expected ${k.length} arguments, but found ${R.length} instead.`);else{for(let z=0;z<R.length;z++){const W=Array.isArray(k)?k[z]:k.type,J=R[z];T.concat(z+1).checkSubtype(W,J.type)}if(T.errors.length===0)return new Uo(u,g,P,R,E)}}if(b.length===1)s.errors.push(...T.errors);else{const k=(b.length?b:y.map(([R])=>R)).map(hd).join(" | "),P=[];for(let R=1;R<r.length;R++){const L=s.parse(r[R],1+P.length);if(!L)return null;P.push(Ls(L.type))}s.error(`Expected arguments of type ${k}, but found (${P.join(", ")}) instead.`)}return null}static register(r,s){Uo.definitions=s;for(const u in s)r[u]=Uo}}function hd(a){return Array.isArray(a)?`(${a.map(Ls).join(", ")})`:`(${Ls(a.type)}...)`}class uh{constructor(r,s,u){this.type=gp,this.locale=u,this.caseSensitive=r,this.diacriticSensitive=s}static parse(r,s){if(r.length!==2)return s.error("Expected one argument.");const u=r[1];if(typeof u!="object"||Array.isArray(u))return s.error("Collator options argument must be an object.");const h=u["case-sensitive"]===void 0?s.parse(!1,1,ei):s.parseObjectValue(u["case-sensitive"],1,"case-sensitive",ei);if(!h)return null;const g=u["diacritic-sensitive"]===void 0?s.parse(!1,1,ei):s.parseObjectValue(u["diacritic-sensitive"],1,"diacritic-sensitive",ei);if(!g)return null;let y=null;return u.locale&&(y=s.parseObjectValue(u.locale,1,"locale",Un),!y)?null:new uh(h,g,y)}evaluate(r){return new dv(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}function Mc(a,r,s=0,u=a.length-1,h=$2){for(;u>s;){if(u-s>600){const T=u-s+1,E=r-s+1,k=Math.log(T),P=.5*Math.exp(2*k/3),R=.5*Math.sqrt(k*P*(T-P)/T)*(E-T/2<0?-1:1);Mc(a,r,Math.max(s,Math.floor(r-E*P/T+R)),Math.min(u,Math.floor(r+(T-E)*P/T+R)),h)}const g=a[r];let y=s,b=u;for(mo(a,s,r),h(a[u],g)>0&&mo(a,s,u);y<b;){for(mo(a,y,b),y++,b--;h(a[y],g)<0;)y++;for(;h(a[b],g)>0;)b--}h(a[s],g)===0?mo(a,s,b):(b++,mo(a,b,u)),b<=r&&(s=b+1),r<=b&&(u=b-1)}}function mo(a,r,s){const u=a[r];a[r]=a[s],a[s]=u}function $2(a,r){return a<r?-1:a>r?1:0}function q2(a){let r=0;for(let s,u,h=0,g=a.length,y=g-1;h<g;y=h++)s=a[h],u=a[y],r+=(u.x-s.x)*(s.y+u.y);return r}function wp(a,r){a[0]=Math.min(a[0],r[0]),a[1]=Math.min(a[1],r[1]),a[2]=Math.max(a[2],r[0]),a[3]=Math.max(a[3],r[1])}function xu(a,r){return!(a[0]<=r[0]||a[2]>=r[2]||a[1]<=r[1]||a[3]>=r[3])}function Kb(a,r,s){const u=a[0]-r[0],h=a[1]-r[1],g=a[0]-s[0],y=a[1]-s[1];return u*y-g*h==0&&u*g<=0&&h*y<=0}function al(a,r,s=!1){let u=!1;for(let b=0,T=r.length;b<T;b++){const E=r[b];for(let k=0,P=E.length,R=P-1;k<P;R=k++){const L=E[R],z=E[k];if(Kb(a,L,z))return s;(g=L)[1]>(h=a)[1]!=(y=z)[1]>h[1]&&h[0]<(y[0]-g[0])*(h[1]-g[1])/(y[1]-g[1])+g[0]&&(u=!u)}}var h,g,y;return u}function Yb(a,r,s,u){const h=u[0]-s[0],g=u[1]-s[1],y=(a[0]-s[0])*g-h*(a[1]-s[1]),b=(r[0]-s[0])*g-h*(r[1]-s[1]);return y>0&&b<0||y<0&&b>0}function rg(a,r,s,u){return(h=[u[0]-s[0],u[1]-s[1]])[0]*(g=[r[0]-a[0],r[1]-a[1]])[1]-h[1]*g[0]!=0&&!(!Yb(a,r,s,u)||!Yb(s,u,a,r));var h,g}function Sp(a){const r=new wt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),s=new wt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const u of a[0])r.x>u.x&&(r.x=u.x),r.y>u.y&&(r.y=u.y),s.x<u.x&&(s.x=u.x),s.y<u.y&&(s.y=u.y);return{min:r,max:s}}const bu=8192;function G2(a,r){const s=(180+a[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,h=Math.pow(2,r.z);return[Math.round(s*h*bu),Math.round(u*h*bu)]}function Jb(a,r){for(let s=0;s<r.length;s++)if(al(a,r[s]))return!0;return!1}function H2(a,r,s){for(const u of s)for(let h=0,g=u.length,y=g-1;h<g;y=h++)if(rg(a,r,u[y],u[h]))return!0;return!1}function wu(a,r){for(let s=0;s<a.length;++s)if(!al(a[s],r))return!1;for(let s=0;s<a.length-1;++s)if(H2(a[s],a[s+1],r))return!1;return!0}function W2(a,r){for(let s=0;s<r.length;s++)if(wu(a,r[s]))return!0;return!1}function hv(a,r,s){const u=[];for(let h=0;h<a.length;h++){const g=[];for(let y=0;y<a[h].length;y++){const b=G2(a[h][y],s);wp(r,b),g.push(b)}u.push(g)}return u}function ng(a,r,s){const u=[];for(let h=0;h<a.length;h++){const g=hv(a[h],r,s);u.push(g)}return u}function fv(a,r,s,u){if(a[0]<s[0]||a[0]>s[2]){const h=.5*u;let g=a[0]-s[0]>h?-u:s[0]-a[0]>h?u:0;g===0&&(g=a[0]-s[2]>h?-u:s[2]-a[0]>h?u:0),a[0]+=g}wp(r,a)}function pv(a,r,s,u){const h=Math.pow(2,u.z)*bu,g=[u.x*bu,u.y*bu],y=[];if(!a)return y;for(const b of a)for(const T of b){const E=[T.x+g[0],T.y+g[1]];fv(E,r,s,h),y.push(E)}return y}function ll(a,r,s,u){const h=Math.pow(2,u.z)*bu,g=[u.x*bu,u.y*bu],y=[];if(!a)return y;for(const T of a){const E=[];for(const k of T){const P=[k.x+g[0],k.y+g[1]];wp(r,P),E.push(P)}y.push(E)}if(r[2]-r[0]<=h/2){(b=r)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const T of y)for(const E of T)fv(E,r,s,h)}var b;return y}class fd{constructor(r,s){this.type=ei,this.geojson=r,this.geometries=s}static parse(r,s){if(r.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(lh(r[1])){const u=r[1];if(u.type==="FeatureCollection")for(let h=0;h<u.features.length;++h){const g=u.features[h].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new fd(u,u.features[h].geometry)}else if(u.type==="Feature"){const h=u.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new fd(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new fd(u,u)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(s,u){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=s.canonicalID();if(!y)return!1;if(u.type==="Polygon"){const b=hv(u.coordinates,g,y),T=pv(s.geometry(),h,g,y);if(!xu(h,g))return!1;for(const E of T)if(!al(E,b))return!1}if(u.type==="MultiPolygon"){const b=ng(u.coordinates,g,y),T=pv(s.geometry(),h,g,y);if(!xu(h,g))return!1;for(const E of T)if(!Jb(E,b))return!1}return!0}(r,this.geometries);if(r.geometryType()==="LineString")return function(s,u){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=s.canonicalID();if(!y)return!1;if(u.type==="Polygon"){const b=hv(u.coordinates,g,y),T=ll(s.geometry(),h,g,y);if(!xu(h,g))return!1;for(const E of T)if(!wu(E,b))return!1}if(u.type==="MultiPolygon"){const b=ng(u.coordinates,g,y),T=ll(s.geometry(),h,g,y);if(!xu(h,g))return!1;for(const E of T)if(!W2(E,b))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Tp={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},mv=1/298.257223563,gv=mv*(2-mv),dh=Math.PI/180;class hh{static fromTile(r,s,u){const h=Math.PI*(1-2*(r+.5)/Math.pow(2,s)),g=Math.atan(.5*(Math.exp(h)-Math.exp(-h)))/dh;return new hh(g,u)}static get units(){return Tp}constructor(r,s){if(r===void 0)throw new Error("No latitude given.");if(s&&!Tp[s])throw new Error(`Unknown unit ${s}. Use one of: ${Object.keys(Tp).join(", ")}`);const u=6378.137*dh*(s?Tp[s]:1),h=Math.cos(r*dh),g=1/(1-gv*(1-h*h)),y=Math.sqrt(g);this.kx=u*y*h,this.ky=u*y*g*(1-gv)}distance(r,s){const u=Pa(r[0]-s[0])*this.kx,h=(r[1]-s[1])*this.ky;return Math.sqrt(u*u+h*h)}bearing(r,s){const u=Pa(s[0]-r[0])*this.kx;return Math.atan2(u,(s[1]-r[1])*this.ky)/dh}destination(r,s,u){const h=u*dh;return this.offset(r,Math.sin(h)*s,Math.cos(h)*s)}offset(r,s,u){return[r[0]+s/this.kx,r[1]+u/this.ky]}lineDistance(r){let s=0;for(let u=0;u<r.length-1;u++)s+=this.distance(r[u],r[u+1]);return s}area(r){let s=0;for(let u=0;u<r.length;u++){const h=r[u];for(let g=0,y=h.length,b=y-1;g<y;b=g++)s+=Pa(h[g][0]-h[b][0])*(h[g][1]+h[b][1])*(u?-1:1)}return Math.abs(s)/2*this.kx*this.ky}along(r,s){let u=0;if(s<=0)return r[0];for(let h=0;h<r.length-1;h++){const g=r[h],y=r[h+1],b=this.distance(g,y);if(u+=b,u>s)return ig(g,y,(s-(u-b))/b)}return r[r.length-1]}pointToSegmentDistance(r,s,u){let[h,g]=s,y=Pa(u[0]-h)*this.kx,b=(u[1]-g)*this.ky;if(y!==0||b!==0){const T=(Pa(r[0]-h)*this.kx*y+(r[1]-g)*this.ky*b)/(y*y+b*b);T>1?(h=u[0],g=u[1]):T>0&&(h+=y/this.kx*T,g+=b/this.ky*T)}return y=Pa(r[0]-h)*this.kx,b=(r[1]-g)*this.ky,Math.sqrt(y*y+b*b)}pointOnLine(r,s){let u=1/0,h=r[0][0],g=r[0][1],y=0,b=0;for(let T=0;T<r.length-1;T++){let E=r[T][0],k=r[T][1],P=Pa(r[T+1][0]-E)*this.kx,R=(r[T+1][1]-k)*this.ky,L=0;P===0&&R===0||(L=(Pa(s[0]-E)*this.kx*P+(s[1]-k)*this.ky*R)/(P*P+R*R),L>1?(E=r[T+1][0],k=r[T+1][1]):L>0&&(E+=P/this.kx*L,k+=R/this.ky*L)),P=Pa(s[0]-E)*this.kx,R=(s[1]-k)*this.ky;const z=P*P+R*R;z<u&&(u=z,h=E,g=k,y=T,b=L)}return{point:[h,g],index:y,t:Math.max(0,Math.min(1,b))}}lineSlice(r,s,u){let h=this.pointOnLine(u,r),g=this.pointOnLine(u,s);if(h.index>g.index||h.index===g.index&&h.t>g.t){const E=h;h=g,g=E}const y=[h.point],b=h.index+1,T=g.index;!_v(u[b],y[0])&&b<=T&&y.push(u[b]);for(let E=b+1;E<=T;E++)y.push(u[E]);return _v(u[T],g.point)||y.push(g.point),y}lineSliceAlong(r,s,u){let h=0;const g=[];for(let y=0;y<u.length-1;y++){const b=u[y],T=u[y+1],E=this.distance(b,T);if(h+=E,h>r&&g.length===0&&g.push(ig(b,T,(r-(h-E))/E)),h>=s)return g.push(ig(b,T,(s-(h-E))/E)),g;h>r&&g.push(T)}return g}bufferPoint(r,s){const u=s/this.ky,h=s/this.kx;return[r[0]-h,r[1]-u,r[0]+h,r[1]+u]}bufferBBox(r,s){const u=s/this.ky,h=s/this.kx;return[r[0]-h,r[1]-u,r[2]+h,r[3]+u]}insideBBox(r,s){return Pa(r[0]-s[0])>=0&&Pa(r[0]-s[2])<=0&&r[1]>=s[1]&&r[1]<=s[3]}}function _v(a,r){return a[0]===r[0]&&a[1]===r[1]}function ig(a,r,s){const u=Pa(r[0]-a[0]);return[a[0]+u*s,a[1]+(r[1]-a[1])*s]}function Pa(a){for(;a<-180;)a+=360;for(;a>180;)a-=360;return a}class sg{constructor(r=[],s=(u,h)=>u<h?-1:u>h?1:0){if(this.data=r,this.length=this.data.length,this.compare=s,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:s,compare:u}=this,h=s[r];for(;r>0;){const g=r-1>>1,y=s[g];if(u(h,y)>=0)break;s[r]=y,r=g}s[r]=h}_down(r){const{data:s,compare:u}=this,h=this.length>>1,g=s[r];for(;r<h;){let y=1+(r<<1);const b=y+1;if(b<this.length&&u(s[b],s[y])<0&&(y=b),u(s[y],g)>=0)break;s[r]=s[y],r=y}s[r]=g}}var Vt=8192;function yv(a,r){return r.dist-a.dist}const fh=100,ph=50;function Ep(a){const r=[1/0,1/0,-1/0,-1/0];if(r.length!==a.length)return!1;for(let s=0;s<r.length;s++)if(r[s]!==a[s])return!1;return!0}function Cp(a){return a[1]-a[0]+1}function ic(a,r){const s=a[1]>=a[0]&&a[1]<r;return s||console.warn("Distance Expression: Index is out of range"),s}function og(a,r){if(a[0]>a[1])return[null,null];const s=Cp(a);if(r){if(s===2)return[a,null];const u=Math.floor(s/2);return[[a[0],a[0]+u],[a[0]+u,a[1]]]}{if(s===1)return[a,null];const u=Math.floor(s/2)-1;return[[a[0],a[0]+u],[a[0]+u+1,a[1]]]}}function cl(a,r){const s=[1/0,1/0,-1/0,-1/0];if(!ic(r,a.length))return s;for(let u=r[0];u<=r[1];++u)wp(s,a[u]);return s}function En(a){const r=[1/0,1/0,-1/0,-1/0];for(let s=0;s<a.length;++s)for(let u=0;u<a[s].length;++u)wp(r,a[s][u]);return r}function mh(a,r,s){if(Ep(a)||Ep(r))return NaN;let u=0,h=0;return a[2]<r[0]&&(u=r[0]-a[2]),a[0]>r[2]&&(u=a[0]-r[2]),a[1]>r[3]&&(h=a[1]-r[3]),a[3]<r[1]&&(h=r[1]-a[3]),s.distance([0,0],[u,h])}function Z2(a){return 360*a-180}function X2(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function ag(a,r){const s=Math.pow(2,r.z),u=(a.y/Vt+r.y)/s;return[Z2((a.x/Vt+r.x)/s),X2(u)]}function K2(a,r){const s=[];for(let u=0;u<a.length;++u)s.push(ag(a[u],r));return s}function Wi(a,r,s){const u=s.pointOnLine(r,a).point;return s.distance(a,u)}function Qb(a,r,s,u,h){const g=s.slice(u[0],u[1]+1);let y=1/0;for(let b=r[0];b<=r[1];++b)if((y=Math.min(y,Wi(a[b],g,h)))===0)return 0;return y}function vv(a,r,s,u,h){const g=Math.min(h.pointToSegmentDistance(a,s,u),h.pointToSegmentDistance(r,s,u)),y=Math.min(h.pointToSegmentDistance(s,a,r),h.pointToSegmentDistance(u,a,r));return Math.min(g,y)}function Y2(a,r,s,u,h){if(!ic(r,a.length)||!ic(u,s.length))return NaN;let g=1/0;for(let y=r[0];y<r[1];++y)for(let b=u[0];b<u[1];++b){if(rg(a[y],a[y+1],s[b],s[b+1]))return 0;g=Math.min(g,vv(a[y],a[y+1],s[b],s[b+1],h))}return g}function J2(a,r,s,u,h){if(!ic(r,a.length)||!ic(u,s.length))return NaN;let g=1/0;for(let y=r[0];y<=r[1];++y)for(let b=u[0];b<=u[1];++b)if((g=Math.min(g,h.distance(a[y],s[b])))===0)return g;return g}function Q2(a,r,s){if(al(a,r,!0))return 0;let u=1/0;for(const h of r){const g=h.length;if(g<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[g-1]&&(u=Math.min(u,s.pointToSegmentDistance(a,h[g-1],h[0])))===0||(u=Math.min(u,Wi(a,h,s)))===0)return u}return u}function eE(a,r,s,u){if(!ic(r,a.length))return NaN;for(let g=r[0];g<=r[1];++g)if(al(a[g],s,!0))return 0;let h=1/0;for(let g=r[0];g<r[1];++g)for(const y of s)for(let b=0,T=y.length,E=T-1;b<T;E=b++){if(rg(a[g],a[g+1],y[E],y[b]))return 0;h=Math.min(h,vv(a[g],a[g+1],y[E],y[b],u))}return h}function ew(a,r){for(const s of a)for(let u=0;u<=s.length-1;++u)if(al(s[u],r,!0))return!0;return!1}function tE(a,r,s,u=1/0){const h=En(a),g=En(r);if(u!==1/0&&mh(h,g,s)>=u)return u;if(xu(h,g)){if(ew(a,r))return 0}else if(ew(r,a))return 0;let y=u;for(const b of a)for(let T=0,E=b.length,k=E-1;T<E;k=T++)for(const P of r)for(let R=0,L=P.length,z=L-1;R<L;z=R++){if(rg(b[k],b[T],P[z],P[R]))return 0;y=Math.min(y,vv(b[k],b[T],P[z],P[R],s))}return y}function lg(a,r,s,u,h,g,y){if(g===null||y===null)return;const b=mh(cl(u,g),cl(h,y),s);b<r&&a.push({dist:b,range1:g,range2:y})}function rE(a,r,s,u,h=1/0){let g=Math.min(u.distance(a[0],s[0][0]),h);if(g===0)return g;const y=new sg([{dist:0,range1:[0,a.length-1],range2:[0,0]}],yv),b=r?ph:fh,T=En(s);for(;y.length;){const E=y.pop();if(E.dist>=g)continue;const k=E.range1;if(Cp(k)<=b){if(!ic(k,a.length))return NaN;if(r){const P=eE(a,k,s,u);if((g=Math.min(g,P))===0)return g}else for(let P=k[0];P<=k[1];++P){const R=Q2(a[P],s,u);if((g=Math.min(g,R))===0)return g}}else{const P=og(k,r);if(P[0]!==null){const R=mh(cl(a,P[0]),T,u);R<g&&y.push({dist:R,range1:P[0],range2:[0,0]})}if(P[1]!==null){const R=mh(cl(a,P[1]),T,u);R<g&&y.push({dist:R,range1:P[1],range2:[0,0]})}}}return g}function tw(a,r,s,u,h,g=1/0){let y=Math.min(g,h.distance(a[0],s[0]));if(y===0)return y;const b=new sg([{dist:0,range1:[0,a.length-1],range2:[0,s.length-1]}],yv),T=r?ph:fh,E=u?ph:fh;for(;b.length;){const k=b.pop();if(k.dist>=y)continue;const P=k.range1,R=k.range2;if(Cp(P)<=T&&Cp(R)<=E){if(!ic(P,a.length)||!ic(R,s.length))return NaN;if(r&&u?y=Math.min(y,Y2(a,P,s,R,h)):r||u?r&&!u?y=Math.min(y,Qb(s,R,a,P,h)):!r&&u&&(y=Math.min(y,Qb(a,P,s,R,h))):y=Math.min(y,J2(a,P,s,R,h)),y===0)return y}else{const L=og(P,r),z=og(R,u);lg(b,y,h,a,s,L[0],z[0]),lg(b,y,h,a,s,L[0],z[1]),lg(b,y,h,a,s,L[1],z[0]),lg(b,y,h,a,s,L[1],z[1])}}return y}function xv(a,r,s,u,h=1/0){let g=h;const y=cl(a,[0,a.length-1]);for(const b of s)if(!(g!==1/0&&mh(y,cl(b,[0,b.length-1]),u)>=g)&&(g=Math.min(g,tw(a,r,b,!0,u,g)),g===0))return g;return g}function cg(a,r,s,u,h=1/0){let g=h;const y=cl(a,[0,a.length-1]);for(const b of s){if(g!==1/0&&mh(y,En(b),u)>=g)continue;const T=rE(a,r,b,u,g);if(isNaN(T))return T;if((g=Math.min(g,T))===0)return g}return g}function bv(a){return a==="Point"||a==="MultiPoint"||a==="LineString"||a==="MultiLineString"||a==="Polygon"||a==="MultiPolygon"}class pd{constructor(r,s){this.type=_r,this.geojson=r,this.geometries=s}static parse(r,s){if(r.length!==2)return s.error(`'distance' expression requires either one argument, but found ' ${r.length-1} instead.`);if(lh(r[1])){const u=r[1];if(u.type==="FeatureCollection"){for(let h=0;h<u.features.length;++h)if(bv(u.features[h].geometry.type))return new pd(u,u.features[h].geometry)}else if(u.type==="Feature"){if(bv(u.geometry.type))return new pd(u,u.geometry)}else if(bv(u.type))return new pd(u,u)}return s.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(r){const s=r.geometry(),u=r.canonicalID();if(s!=null&&u!=null){if(r.geometryType()==="Point")return function(h,g,y){const b=[];for(const E of h)for(const k of E)b.push(ag(k,g));const T=new hh(b[0][1],"meters");return y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString"?tw(b,!1,y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",T):y.type==="MultiLineString"?xv(b,!1,y.coordinates,T):y.type==="Polygon"||y.type==="MultiPolygon"?cg(b,!1,y.type==="Polygon"?[y.coordinates]:y.coordinates,T):null}(s,u,this.geometries);if(r.geometryType()==="LineString")return function(h,g,y){const b=[];for(const E of h){const k=[];for(const P of E)k.push(ag(P,g));b.push(k)}const T=new hh(b[0][0][1],"meters");if(y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString")return xv(y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",b,T);if(y.type==="MultiLineString"){let E=1/0;for(let k=0;k<y.coordinates.length;k++){const P=xv(y.coordinates[k],!0,b,T,E);if(isNaN(P))return P;if((E=Math.min(E,P))===0)return E}return E}if(y.type==="Polygon"||y.type==="MultiPolygon"){let E=1/0;for(let k=0;k<b.length;k++){const P=cg(b[k],!0,y.type==="Polygon"?[y.coordinates]:y.coordinates,T,E);if(isNaN(P))return P;if((E=Math.min(E,P))===0)return E}return E}return null}(s,u,this.geometries);if(r.geometryType()==="Polygon")return function(h,g,y){const b=[];for(const E of function(k,P){const R=k.length;if(R<=1)return[k];const L=[];let z,W;for(let J=0;J<R;J++){const te=q2(k[J]);te!==0&&(k[J].area=Math.abs(te),W===void 0&&(W=te<0),W===te<0?(z&&L.push(z),z=[k[J]]):z.push(k[J]))}return z&&L.push(z),L}(h)){const k=[];for(let P=0;P<E.length;++P)k.push(K2(E[P],g));b.push(k)}const T=new hh(b[0][0][0][1],"meters");if(y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString")return cg(y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",b,T);if(y.type==="MultiLineString"){let E=1/0;for(let k=0;k<y.coordinates.length;k++){const P=cg(y.coordinates[k],!0,b,T,E);if(isNaN(P))return P;if((E=Math.min(E,P))===0)return E}return E}return y.type==="Polygon"||y.type==="MultiPolygon"?function(E,k,P){let R=1/0;for(const L of E)for(const z of k){const W=tE(L,z,P,R);if(isNaN(W))return W;if((R=Math.min(R,W))===0)return R}return R}(y.type==="Polygon"?[y.coordinates]:y.coordinates,b,T):null}(s,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function gh(a){if(a instanceof Uo&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof fd||a instanceof pd)return!1;if(a instanceof yh)return a.featureConstant;let r=!0;return a.eachChild(s=>{r&&!gh(s)&&(r=!1)}),r}function Ap(a){if(a instanceof Uo&&a.name==="feature-state")return!1;let r=!0;return a.eachChild(s=>{r&&!Ap(s)&&(r=!1)}),r}function _h(a,r){if(a instanceof Uo&&r.indexOf(a.name)>=0)return!1;let s=!0;return a.eachChild(u=>{s&&!_h(u,r)&&(s=!1)}),s}function rw(a,r,s){return[a,r,s].filter(Boolean).join("")}function wv(a,r){switch(a){case"string":return rc(r);case"number":return+r;case"boolean":return!!r;case"color":return ri.parse(r);case"formatted":return ro.fromString(rc(r));case"resolvedImage":return ia.build(rc(r))}return r}function nw(a,r,s,u){return u!==void 0&&(a=u*Math.round(a/u)),r!==void 0&&a<r&&(a=r),s!==void 0&&a>s&&(a=s),a}class yh{constructor(r,s,u,h=!1){this.type=r,this.key=s,this.scope=u,this.featureConstant=h}static parse(r,s){let u=s.expectedType;if(u==null&&(u=oi),r.length<2||r.length>3)return s.error("Invalid number of arguments for 'config' expression.");const h=s.parse(r[1],1);if(!(h instanceof Rc))return s.error("Key name of 'config' expression must be a string literal.");let g,y=!0;const b=rc(h.value);if(r.length>=3){const T=s.parse(r[2],2);if(!(T instanceof Rc))return s.error("Scope of 'config' expression must be a string literal.");g=rc(T.value)}if(s.options){const T=rw(b,g,s._scope),E=s.options.get(T);E&&(y=gh(E.value||E.default))}return new yh(u,b,g,y)}evaluate(r){const s=rw(this.key,this.scope,r.scope),u=r.getConfig(s);if(!u)return null;const{type:h,value:g,values:y,minValue:b,maxValue:T,stepValue:E}=u,k=u.default.evaluate(r);let P=k;if(g){const R=r.scope;r.scope=(R||"").split("").slice(1).join(""),P=g.evaluate(r),r.scope=R}return h&&(P=wv(h,P)),P===void 0||b===void 0&&T===void 0&&E===void 0||(typeof P=="number"?P=nw(P,b,T,E):Array.isArray(P)&&(P=P.map(R=>typeof R=="number"?nw(R,b,T,E):R))),g!==void 0&&P!==void 0&&y&&!y.includes(P)&&(P=k,h&&(P=wv(h,P))),(h&&h!==this.type||P!==void 0&&!Ym(Qs(P),this.type))&&(P=wv(this.type.kind,P)),P}eachChild(){}outputDefined(){return!1}serialize(){const r=["config",this.key];return this.scope&&r.concat(this.scope),r}}class ug{constructor(r,s){this.type=s.type,this.name=r,this.boundExpression=s}static parse(r,s){if(r.length!==2||typeof r[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const u=r[1];return s.scope.has(u)?new ug(u,s.scope.get(u)):s.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class dg{constructor(r,s=[],u,h=new ol,g=[],y,b,T){this.registry=r,this.path=s,this.key=s.map(E=>typeof E=="string"?`['${E}']`:`[${E}]`).join(""),this.scope=h,this.errors=g,this.expectedType=u,this._scope=y,this.options=b,this.iconImageUseTheme=T}parse(r,s,u,h,g={}){return s||u?this.concat(s,null,u,h)._parse(r,g):this._parse(r,g)}parseObjectValue(r,s,u,h,g,y={}){return this.concat(s,u,h,g)._parse(r,y)}_parse(r,s){function u(h,g,y){return y==="assert"?new hr(g,[h]):y==="coerce"?new nc(g,[h]):h}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=typeof r[0]=="string"?this.registry[r[0]]:void 0;if(h){let g=h.parse(r,this);if(!g)return null;if(this.expectedType){const y=this.expectedType,b=g.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||b.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string"){if(this.checkSubtype(y,b))return null}else g=u(g,y,s.typeAnnotation||"coerce");else g=u(g,y,s.typeAnnotation||"assert")}if(!(g instanceof Rc)&&g.type.kind!=="resolvedImage"&&Sv(g)){const y=new po(this._scope,this.options,this.iconImageUseTheme);try{g=new Rc(g.type,g.evaluate(y))}catch(b){return this.error(b.message),null}}return g}return nc.parse(["to-array",r],this)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,s,u,h){let g=typeof r=="number"?this.path.concat(r):this.path;g=typeof s=="string"?g.concat(s):g;const y=h?this.scope.concat(h):this.scope;return new dg(this.registry,g,u||null,y,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(r,...s){const u=`${this.key}${s.map(h=>`[${h}]`).join("")}`;this.errors.push(new sl(u,r))}checkSubtype(r,s){const u=yp(r,s);return u&&this.error(u),u}}function Sv(a){if(a instanceof ug)return Sv(a.boundExpression);if(a instanceof Uo&&a.name==="error"||a instanceof uh||a instanceof fd||a instanceof pd||a instanceof yh)return!1;const r=a instanceof nc||a instanceof hr;let s=!0;return a.eachChild(u=>{s=r?s&&Sv(u):s&&u instanceof Rc}),!!s&&gh(a)&&_h(a,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function hg(a,r){const s=a.length-1;let u,h,g=0,y=s,b=0;for(;g<=y;)if(b=Math.floor((g+y)/2),u=a[b],h=a[b+1],u<=r){if(b===s||r<h)return b;g=b+1}else{if(!(u>r))throw new gs("Input is not a number.");y=b-1}return 0}class jp{constructor(r,s,u){this.type=r,this.input=s,this.labels=[],this.outputs=[];for(const[h,g]of u)this.labels.push(h),this.outputs.push(g)}static parse(r,s){if(r.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return s.error("Expected an even number of arguments.");const u=s.parse(r[1],1,_r);if(!u)return null;const h=[];let g=null;s.expectedType&&s.expectedType.kind!=="value"&&(g=s.expectedType);for(let y=1;y<r.length;y+=2){const b=y===1?-1/0:r[y],T=r[y+1],E=y,k=y+1;if(typeof b!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(h.length&&h[h.length-1][0]>=b)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const P=s.parse(T,k,g);if(!P)return null;g=g||P.type,h.push([b,P])}return new jp(g,u,h)}evaluate(r){const s=this.labels,u=this.outputs;if(s.length===1)return u[0].evaluate(r);const h=this.input.evaluate(r);if(h<=s[0])return u[0].evaluate(r);const g=s.length;return h>=s[g-1]?u[g-1].evaluate(r):u[hg(s,h)].evaluate(r)}eachChild(r){r(this.input);for(const s of this.outputs)r(s)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&r.push(this.labels[s]),r.push(this.outputs[s].serialize());return r}}const iw=.95047,sw=1.08883,ow=4/29,vh=6/29,fg=3*vh*vh,nE=vh*vh*vh,aw=Math.PI/180,iE=180/Math.PI;function Tv(a){return a>nE?Math.pow(a,1/3):a/fg+ow}function Ev(a){return a>vh?a*a*a:fg*(a-ow)}function pg(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function mg(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function md(a){const r=mg(a.r),s=mg(a.g),u=mg(a.b),h=Tv((.4124564*r+.3575761*s+.1804375*u)/iw),g=Tv((.2126729*r+.7151522*s+.072175*u)/1);return{l:116*g-16,a:500*(h-g),b:200*(g-Tv((.0193339*r+.119192*s+.9503041*u)/sw)),alpha:a.a}}function Cv(a){let r=(a.l+16)/116,s=isNaN(a.a)?r:r+a.a/500,u=isNaN(a.b)?r:r-a.b/200;return r=1*Ev(r),s=iw*Ev(s),u=sw*Ev(u),new ri(pg(3.2404542*s-1.5371385*r-.4985314*u),pg(-.969266*s+1.8760108*r+.041556*u),pg(.0556434*s-.2040259*r+1.0572252*u),a.alpha)}function lw(a,r,s){const u=r-a;return a+s*(u>180||u<-180?u-360*Math.round(u/360):u)}const Ip={forward:md,reverse:Cv,interpolate:function(a,r,s){return{l:Br(a.l,r.l,s),a:Br(a.a,r.a,s),b:Br(a.b,r.b,s),alpha:Br(a.alpha,r.alpha,s)}}},gd={forward:function(a){const{l:r,a:s,b:u}=md(a),h=Math.atan2(u,s)*iE;return{h:h<0?h+360:h,c:Math.sqrt(s*s+u*u),l:r,alpha:a.a}},reverse:function(a){const r=a.h*aw,s=a.c;return Cv({l:a.l,a:Math.cos(r)*s,b:Math.sin(r)*s,alpha:a.alpha})},interpolate:function(a,r,s){return{h:lw(a.h,r.h,s),c:Br(a.c,r.c,s),l:Br(a.l,r.l,s),alpha:Br(a.alpha,r.alpha,s)}}};var gg=Object.freeze({__proto__:null,hcl:gd,lab:Ip});class Ra{constructor(r,s,u,h,g){this.type=r,this.operator=s,this.interpolation=u,this.input=h,this.labels=[],this.outputs=[];for(const[y,b]of g)this.labels.push(y),this.outputs.push(b)}static interpolationFactor(r,s,u,h){let g=0;if(r.name==="exponential")g=Av(s,r.base,u,h);else if(r.name==="linear")g=Av(s,1,u,h);else if(r.name==="cubic-bezier"){const y=r.controlPoints;g=new Ao(y[0],y[1],y[2],y[3]).solve(Av(s,1,u,h))}return g}static parse(r,s){let[u,h,g,...y]=r;if(!Array.isArray(h)||h.length===0)return s.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const E=h[1];if(typeof E!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:E}}else{if(h[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const E=h.slice(1);if(E.length!==4||E.some(k=>typeof k!="number"||k<0||k>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:E}}}if(r.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length-1>3&&(r.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(g=s.parse(g,2,_r),!g)return null;const b=[];let T=null;u==="interpolate-hcl"||u==="interpolate-lab"?T=ma:s.expectedType&&s.expectedType.kind!=="value"&&(T=s.expectedType);for(let E=0;E<y.length;E+=2){const k=y[E],P=y[E+1],R=E+3,L=E+4;if(typeof k!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(b.length&&b[b.length-1][0]>=k)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',R);const z=s.parse(P,L,T);if(!z)return null;T=T||z.type,b.push([k,z])}return T.kind==="number"||T.kind==="color"||T.kind==="array"&&T.itemType.kind==="number"&&typeof T.N=="number"?new Ra(T,u,h,g,b):s.error(`Type ${Ls(T)} is not interpolatable.`)}evaluate(r){const s=this.labels,u=this.outputs;if(s.length===1)return u[0].evaluate(r);const h=this.input.evaluate(r);if(h<=s[0])return u[0].evaluate(r);const g=s.length;if(h>=s[g-1])return u[g-1].evaluate(r);const y=hg(s,h),b=Ra.interpolationFactor(this.interpolation,h,s[y],s[y+1]),T=u[y].evaluate(r),E=u[y+1].evaluate(r);return this.operator==="interpolate"?kc[this.type.kind.toLowerCase()](T,E,b):this.operator==="interpolate-hcl"?gd.reverse(gd.interpolate(gd.forward(T),gd.forward(E),b)):Ip.reverse(Ip.interpolate(Ip.forward(T),Ip.forward(E),b))}eachChild(r){r(this.input);for(const s of this.outputs)r(s)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;r=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const s=[this.operator,r,this.input.serialize()];for(let u=0;u<this.labels.length;u++)s.push(this.labels[u],this.outputs[u].serialize());return s}}function Av(a,r,s,u){const h=u-s,g=a-s;return h===0?0:r===1?g/h:(Math.pow(r,g)-1)/(Math.pow(r,h)-1)}class kp{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expectected at least one argument.");let u=null;const h=s.expectedType;h&&h.kind!=="value"&&(u=h);const g=[];for(const b of r.slice(1)){const T=s.parse(b,1+g.length,u,void 0,{typeAnnotation:"omit"});if(!T)return null;u=u||T.type,g.push(T)}const y=h&&g.some(b=>yp(h,b.type));return new kp(y?oi:u,g)}evaluate(r){let s,u=null,h=0;for(const g of this.args){if(h++,u=g.evaluate(r),u&&u instanceof ia&&!u.available&&(s||(s=u),u=null,h===this.args.length))return s;if(u!==null)break}return u}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(s=>{r.push(s.serialize())}),r}}class Pp{constructor(r,s){this.type=s.type,this.bindings=[].concat(r),this.result=s}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const s of this.bindings)r(s[1]);r(this.result)}static parse(r,s){if(r.length<4)return s.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const u=[];for(let g=1;g<r.length-1;g+=2){const y=r[g];if(typeof y!="string")return s.error(`Expected string, but found ${typeof y} instead.`,g);if(/[^a-zA-Z0-9_]/.test(y))return s.error("Variable names must contain only alphanumeric characters or '_'.",g);const b=s.parse(r[g+1],g+1);if(!b)return null;u.push([y,b])}const h=s.parse(r[r.length-1],r.length-1,s.expectedType,u);return h?new Pp(u,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[s,u]of this.bindings)r.push(s,u.serialize());return r.push(this.result.serialize()),r}}class jv{constructor(r,s,u){this.type=r,this.index=s,this.input=u}static parse(r,s){if(r.length!==3)return s.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=s.parse(r[1],1,_r),h=s.parse(r[2],2,fo(s.expectedType||oi));return u&&h?new jv(h.type.itemType,u,h):null}evaluate(r){const s=this.index.evaluate(r),u=this.input.evaluate(r);if(s<0)throw new gs("Array index out of bounds: negative index");if(s>=u.length)throw new gs("Array index out of bounds: index exceeds array size");if(s!==Math.floor(s))throw new gs("Array index must be an integer. Use at-interpolated for fractional indices");return u[s]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Iv{constructor(r,s,u){this.type=r,this.index=s,this.input=u}static parse(r,s){if(r.length!==3)return s.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=s.parse(r[1],1,_r),h=s.parse(r[2],2,fo(s.expectedType||oi));return u&&h?new Iv(h.type.itemType,u,h):null}evaluate(r){const s=this.index.evaluate(r),u=this.input.evaluate(r);if(s<0)throw new gs(`Array index out of bounds: ${s} < 0.`);if(s>u.length-1)throw new gs(`Array index out of bounds: ${s} > ${u.length-1}.`);if(s===Math.floor(s))return u[s];const h=Math.floor(s),g=Math.ceil(s),y=u[h],b=u[g];if(typeof y!="number"||typeof b!="number")throw new gs(`Cannot interpolate between non-number values at index ${s}.`);const T=s-h;return y*(1-T)+b*T}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class kv{constructor(r,s){this.type=ei,this.needle=r,this.haystack=s}static parse(r,s){if(r.length!==3)return s.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=s.parse(r[1],1,oi),h=s.parse(r[2],2,oi);return u&&h?uv(u.type,[ei,Un,_r,oh,oi])?new kv(u,h):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ls(u.type)} instead`):null}evaluate(r){const s=this.needle.evaluate(r),u=this.haystack.evaluate(r);if(u==null)return!1;if(!vp(s,["boolean","string","number","null"]))throw new gs(`Expected first argument to be of type boolean, string, number or null, but found ${Ls(Qs(s))} instead.`);if(!vp(u,["string","array"]))throw new gs(`Expected second argument to be of type array or string, but found ${Ls(Qs(u))} instead.`);return u.indexOf(s)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Rp{constructor(r,s,u){this.type=_r,this.needle=r,this.haystack=s,this.fromIndex=u}static parse(r,s){if(r.length<=2||r.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const u=s.parse(r[1],1,oi),h=s.parse(r[2],2,oi);if(!u||!h)return null;if(!uv(u.type,[ei,Un,_r,oh,oi]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ls(u.type)} instead`);if(r.length===4){const g=s.parse(r[3],3,_r);return g?new Rp(u,h,g):null}return new Rp(u,h)}evaluate(r){const s=this.needle.evaluate(r),u=this.haystack.evaluate(r);if(!vp(s,["boolean","string","number","null"]))throw new gs(`Expected first argument to be of type boolean, string, number or null, but found ${Ls(Qs(s))} instead.`);if(!vp(u,["string","array"]))throw new gs(`Expected second argument to be of type array or string, but found ${Ls(Qs(u))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(r);return u.indexOf(s,h)}return u.indexOf(s)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class _g{constructor(r,s,u,h,g,y){this.inputType=r,this.type=s,this.input=u,this.cases=h,this.outputs=g,this.otherwise=y}static parse(r,s){if(r.length<5)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return s.error("Expected an even number of arguments.");let u,h;s.expectedType&&s.expectedType.kind!=="value"&&(h=s.expectedType);const g={},y=[];for(let E=2;E<r.length-1;E+=2){let k=r[E];const P=r[E+1];Array.isArray(k)||(k=[k]);const R=s.concat(E);if(k.length===0)return R.error("Expected at least one branch label.");for(const z of k){if(typeof z!="number"&&typeof z!="string")return R.error("Branch labels must be numbers or strings.");if(typeof z=="number"&&Math.abs(z)>Number.MAX_SAFE_INTEGER)return R.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof z=="number"&&Math.floor(z)!==z)return R.error("Numeric branch labels must be integer values.");if(u){if(R.checkSubtype(u,Qs(z)))return null}else u=Qs(z);if(g[String(z)]!==void 0)return R.error("Branch labels must be unique.");g[String(z)]=y.length}const L=s.parse(P,E,h);if(!L)return null;h=h||L.type,y.push(L)}const b=s.parse(r[1],1,oi);if(!b)return null;const T=s.parse(r[r.length-1],r.length-1,h);return T?b.type.kind!=="value"&&s.concat(1).checkSubtype(u,b.type)?null:new _g(u,h,b,g,y,T):null}evaluate(r){const s=this.input.evaluate(r);return(Ym(Qs(s),this.inputType)&&this.outputs[this.cases[s]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),u=[],h={};for(const y of s){const b=h[this.cases[y]];b===void 0?(h[this.cases[y]]=u.length,u.push([this.cases[y],[y]])):u[b][1].push(y)}const g=y=>this.inputType.kind==="number"?Number(y):y;for(const[y,b]of u)r.push(b.length===1?g(b[0]):b.map(g)),r.push(this.outputs[y].serialize());return r.push(this.otherwise.serialize()),r}}class xh{constructor(r,s,u){this.type=r,this.branches=s,this.otherwise=u}static parse(r,s){if(r.length<4)return s.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return s.error("Expected an odd number of arguments.");let u;s.expectedType&&s.expectedType.kind!=="value"&&(u=s.expectedType);const h=[];for(let y=1;y<r.length-1;y+=2){const b=s.parse(r[y],y,ei);if(!b)return null;const T=s.parse(r[y+1],y+1,u);if(!T)return null;h.push([b,T]),u=u||T.type}const g=s.parse(r[r.length-1],r.length-1,u);return g?new xh(u,h,g):null}evaluate(r){for(const[s,u]of this.branches)if(s.evaluate(r))return u.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[s,u]of this.branches)r(s),r(u);r(this.otherwise)}outputDefined(){return this.branches.every(([r,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(s=>{r.push(s.serialize())}),r}}class yg{constructor(r,s,u,h){this.type=r,this.input=s,this.beginIndex=u,this.endIndex=h}static parse(r,s){if(r.length<=2||r.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const u=s.parse(r[1],1,oi),h=s.parse(r[2],2,_r);if(!u||!h)return null;if(!uv(u.type,[fo(oi),Un,oi]))return s.error(`Expected first argument to be of type array or string, but found ${Ls(u.type)} instead`);if(r.length===4){const g=s.parse(r[3],3,_r);return g?new yg(u.type,u,h,g):null}return new yg(u.type,u,h)}evaluate(r){const s=this.input.evaluate(r),u=this.beginIndex.evaluate(r);if(!vp(s,["string","array"]))throw new gs(`Expected first argument to be of type array or string, but found ${Ls(Qs(s))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(r);return s.slice(u,h)}return s.slice(u)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class vg{constructor(r,s){this.type=fo(Un),this.str=r,this.delimiter=s}static parse(r,s){if(r.length!==3)return s.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=s.parse(r[1],1,Un),h=s.parse(r[2],2,Un);return u&&h?new vg(u,h):void 0}evaluate(r){const s=this.str.evaluate(r),u=this.delimiter.evaluate(r);return s.split(u)}eachChild(r){r(this.str),r(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function cw(a,r){return a==="=="||a==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function uw(a,r,s,u){return u.compare(r,s)===0}function bh(a,r,s){const u=a!=="=="&&a!=="!=";return class s6{constructor(g,y,b){this.type=ei,this.lhs=g,this.rhs=y,this.collator=b,this.hasUntypedArgument=g.type.kind==="value"||y.type.kind==="value"}static parse(g,y){if(g.length!==3&&g.length!==4)return y.error("Expected two or three arguments.");const b=g[0];let T=y.parse(g[1],1,oi);if(!T)return null;if(!cw(b,T.type))return y.concat(1).error(`"${b}" comparisons are not supported for type '${Ls(T.type)}'.`);let E=y.parse(g[2],2,oi);if(!E)return null;if(!cw(b,E.type))return y.concat(2).error(`"${b}" comparisons are not supported for type '${Ls(E.type)}'.`);if(T.type.kind!==E.type.kind&&T.type.kind!=="value"&&E.type.kind!=="value")return y.error(`Cannot compare types '${Ls(T.type)}' and '${Ls(E.type)}'.`);u&&(T.type.kind==="value"&&E.type.kind!=="value"?T=new hr(E.type,[T]):T.type.kind!=="value"&&E.type.kind==="value"&&(E=new hr(T.type,[E])));let k=null;if(g.length===4){if(T.type.kind!=="string"&&E.type.kind!=="string"&&T.type.kind!=="value"&&E.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(k=y.parse(g[3],3,gp),!k)return null}return new s6(T,E,k)}evaluate(g){const y=this.lhs.evaluate(g),b=this.rhs.evaluate(g);if(u&&this.hasUntypedArgument){const T=Qs(y),E=Qs(b);if(T.kind!==E.kind||T.kind!=="string"&&T.kind!=="number")throw new gs(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${T.kind}, ${E.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const T=Qs(y),E=Qs(b);if(T.kind!=="string"||E.kind!=="string")return r(g,y,b)}return this.collator?s(g,y,b,this.collator.evaluate(g)):r(g,y,b)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){const g=[a];return this.eachChild(y=>{g.push(y.serialize())}),g}}}const dw=bh("==",function(a,r,s){return r===s},uw),hw=bh("!=",function(a,r,s){return r!==s},function(a,r,s,u){return!uw(0,r,s,u)}),sE=bh("<",function(a,r,s){return r<s},function(a,r,s,u){return u.compare(r,s)<0}),oE=bh(">",function(a,r,s){return r>s},function(a,r,s,u){return u.compare(r,s)>0}),aE=bh("<=",function(a,r,s){return r<=s},function(a,r,s,u){return u.compare(r,s)<=0}),xg=bh(">=",function(a,r,s){return r>=s},function(a,r,s,u){return u.compare(r,s)>=0});class Pv{constructor(r,s,u,h,g,y){this.type=Un,this.number=r,this.locale=s,this.currency=u,this.unit=h,this.minFractionDigits=g,this.maxFractionDigits=y}static parse(r,s){if(r.length!==3)return s.error("Expected two arguments.");const u=s.parse(r[1],1,_r);if(!u)return null;const h=r[2];if(typeof h!="object"||Array.isArray(h))return s.error("NumberFormat options argument must be an object.");let g=null;if(h.locale&&(g=s.parseObjectValue(h.locale,2,"locale",Un),!g))return null;let y=null;if(h.currency&&(y=s.parseObjectValue(h.currency,2,"currency",Un),!y))return null;let b=null;if(h.unit&&(b=s.parseObjectValue(h.unit,2,"unit",Un),!b))return null;let T=null;if(h["min-fraction-digits"]&&(T=s.parseObjectValue(h["min-fraction-digits"],2,"min-fraction-digits",_r),!T))return null;let E=null;return h["max-fraction-digits"]&&(E=s.parseObjectValue(h["max-fraction-digits"],2,"max-fraction-digits",_r),!E)?null:new Pv(u,g,y,b,T,E)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(r):void 0,unit:this.unit?this.unit.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.unit&&r(this.unit),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.unit&&(r.unit=this.unit.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class Rv{constructor(r){this.type=_r,this.input=r}static parse(r,s){if(r.length!==2)return s.error(`Expected 1 argument, but found ${r.length-1} instead.`);const u=s.parse(r[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${Ls(u.type)} instead.`):new Rv(u):null}evaluate(r){const s=this.input.evaluate(r);if(typeof s=="string"||Array.isArray(s))return s.length;throw new gs(`Expected value to be of type string or array, but found ${Ls(Qs(s))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(s=>{r.push(s.serialize())}),r}}function fw(a){return function(){a=1831565813+(a|=0)|0;let r=Math.imul(a^a>>>15,1|a);return r=r+Math.imul(r^r>>>7,61|r)^r,((r^r>>>14)>>>0)/4294967296}}const wh={"==":dw,"!=":hw,">":oE,"<":sE,">=":xg,"<=":aE,array:hr,at:jv,"at-interpolated":Iv,boolean:hr,case:xh,coalesce:kp,collator:uh,format:dd,image:Kr,in:kv,"index-of":Rp,interpolate:Ra,"interpolate-hcl":Ra,"interpolate-lab":Ra,length:Rv,let:Pp,literal:Rc,match:_g,number:hr,"number-format":Pv,object:hr,slice:yg,step:jp,string:hr,"to-boolean":nc,"to-color":nc,"to-number":nc,"to-string":nc,var:ug,within:fd,distance:pd,config:yh,split:vg};function Mv(a,[r,s,u,h]){r=r.evaluate(a),s=s.evaluate(a),u=u.evaluate(a);const g=h?h.evaluate(a):1,y=Jm(r,s,u,g);if(y)throw new gs(y);return new ri(r/255,s/255,u/255,g)}function pw(a,[r,s,u,h]){r=r.evaluate(a),s=s.evaluate(a),u=u.evaluate(a);const g=h?h.evaluate(a):1,y=function(E,k,P,R){return typeof E=="number"&&E>=0&&E<=360?typeof k=="number"&&k>=0&&k<=100&&typeof P=="number"&&P>=0&&P<=100?R===void 0||typeof R=="number"&&R>=0&&R<=1?null:`Invalid hsla value [${[E,k,P,R].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof R=="number"?[E,k,P,R]:[E,k,P]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof R=="number"?[E,k,P,R]:[E,k,P]).join(", ")}]: 'h' must be between 0 and 360.`}(r,s,u,g);if(y)throw new gs(y);const b=`hsla(${r}, ${s}%, ${u}%, ${g})`,T=ri.parse(b);if(!T)throw new gs(`Failed to parse HSLA color: ${b}`);return T}function mw(a,r){return a in r}function bg(a,r){const s=r[a];return s===void 0?null:s}function Nc(a){return{type:a}}function Mp(a){if(a instanceof yh)return new Set([a.key]);let r=new Set;return a.eachChild(s=>{r=new Set([...r,...Mp(s)])}),r}function wg(a){if(a instanceof Uo&&a.name==="is-active-floor")return!0;let r=!1;return a.eachChild(s=>{!r&&wg(s)&&(r=!0)}),r}function _d(a){return{result:"success",value:a}}function Su(a){return{result:"error",value:a}}function Nv(a,r){return!!a&&!!a.parameters&&a.parameters.indexOf(r)>-1}function Sg(a){return a["property-type"]==="data-driven"}function Dv(a){return Nv(a.expression,"measure-light")}function Ov(a){return Nv(a.expression,"zoom")}function Tg(a){return!!a.expression&&a.expression.interpolated}function Eg(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function Lv(a){return a}function Cg(a,r){const s=r.type==="color",u=a.stops&&typeof a.stops[0][0]=="object",h=u||!(u||a.property!==void 0),g=a.type||(Tg(r)?"exponential":"interval");if(s&&((a=Object.assign({},a)).stops&&(a.stops=a.stops.map(E=>[E[0],ri.parse(E[1])])),a.default=ri.parse(a.default?a.default:r.default)),a.colorSpace&&a.colorSpace!=="rgb"&&!gg[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let y,b,T;if(g==="exponential")y=gw;else if(g==="interval")y=Tu;else if(g==="categorical"){y=lE,b=Object.create(null);for(const E of a.stops)b[E[0]]=E[1];T=typeof a.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);y=cE}if(u){const E={},k=[];for(let L=0;L<a.stops.length;L++){const z=a.stops[L],W=z[0].zoom;E[W]===void 0&&(E[W]={zoom:W,type:a.type,property:a.property,default:a.default,stops:[]},k.push(W)),E[W].stops.push([z[0].value,z[1]])}const P=[];for(const L of k)P.push([E[L].zoom,Cg(E[L],r)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:Ra.interpolationFactor.bind(void 0,R),zoomStops:P.map(L=>L[0]),evaluate:({zoom:L},z)=>gw({stops:P,base:a.base},r,L).evaluate(L,z)}}if(h){const E=g==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:Ra.interpolationFactor.bind(void 0,E),zoomStops:a.stops.map(k=>k[0]),evaluate:({zoom:k})=>y(a,r,k,b,T)}}return{kind:"source",evaluate(E,k){const P=k&&k.properties?k.properties[a.property]:void 0;return P===void 0?Sh(a.default,r.default):y(a,r,P,b,T)}}}function Sh(a,r,s){return a!==void 0?a:r!==void 0?r:s!==void 0?s:void 0}function lE(a,r,s,u,h){return Sh(typeof s===h?u[s]:void 0,a.default,r.default)}function Tu(a,r,s){if(!bp(s))return Sh(a.default,r.default);const u=a.stops.length;if(u===1||s<=a.stops[0][0])return a.stops[0][1];if(s>=a.stops[u-1][0])return a.stops[u-1][1];const h=hg(a.stops.map(g=>g[0]),s);return a.stops[h][1]}function gw(a,r,s){const u=a.base!==void 0?a.base:1;if(!bp(s))return Sh(a.default,r.default);const h=a.stops.length;if(h===1||s<=a.stops[0][0])return a.stops[0][1];if(s>=a.stops[h-1][0])return a.stops[h-1][1];const g=hg(a.stops.map(k=>k[0]),s),y=function(k,P,R,L){const z=L-R,W=k-R;return z===0?0:P===1?W/z:(Math.pow(P,W)-1)/(Math.pow(P,z)-1)}(s,u,a.stops[g][0],a.stops[g+1][0]),b=a.stops[g][1],T=a.stops[g+1][1];let E=kc[r.type]||Lv;if(a.colorSpace&&a.colorSpace!=="rgb"){const k=gg[a.colorSpace];E=(P,R)=>k.reverse(k.interpolate(k.forward(P),k.forward(R),y))}return typeof b.evaluate=="function"?{evaluate(...k){const P=b.evaluate.apply(void 0,k),R=T.evaluate.apply(void 0,k);if(P!==void 0&&R!==void 0)return E(P,R,y)}}:E(b,T,y)}function cE(a,r,s){return r.type==="color"?s=ri.parse(s):r.type==="formatted"?s=ro.fromString(s.toString()):r.type==="resolvedImage"?s=ia.build(s.toString()):ch(s)===r.type||r.type==="enum"&&r.values[s]||(s=void 0),Sh(s,a.default,r.default)}Uo.register(wh,{error:[{kind:"error"},[Un],(a,[r])=>{throw new gs(r.evaluate(a))}],typeof:[Un,[oi],(a,[r])=>Ls(Qs(r.evaluate(a)))],"to-rgba":[fo(_r,4),[ma],(a,[r])=>r.evaluate(a).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[fo(_r,4),[ma],(a,[r])=>r.evaluate(a).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[ma,[_r,_r,_r],Mv],rgba:[ma,[_r,_r,_r,_r],Mv],hsl:[ma,[_r,_r,_r],pw],hsla:[ma,[_r,_r,_r,_r],pw],has:{type:ei,overloads:[[[Un],(a,[r])=>mw(r.evaluate(a),a.properties())],[[Un,ah],(a,[r,s])=>mw(r.evaluate(a),s.evaluate(a))]]},get:{type:oi,overloads:[[[Un],(a,[r])=>bg(r.evaluate(a),a.properties())],[[Un,ah],(a,[r,s])=>bg(r.evaluate(a),s.evaluate(a))]]},"feature-state":[oi,[Un],(a,[r])=>bg(r.evaluate(a),a.featureState||{})],properties:[ah,[],a=>a.properties()],"geometry-type":[Un,[],a=>a.geometryType()],worldview:[Un,[],a=>a.globals.worldview||""],"is-active-floor":[ei,Nc(Un),(a,r)=>{if(!(a.globals.activeFloors&&a.globals.activeFloors.size>0))return!1;const s=a.globals.activeFloors;return r.some(u=>{const h=u.evaluate(a);return s.has(h)})}],id:[oi,[],a=>a.id()],zoom:[_r,[],a=>a.globals.zoom],pitch:[_r,[],a=>a.globals.pitch||0],"distance-from-center":[_r,[],a=>a.distanceFromCenter()],"measure-light":[_r,[Un],(a,[r])=>a.measureLight(r.evaluate(a))],"heatmap-density":[_r,[],a=>a.globals.heatmapDensity||0],"line-progress":[_r,[],a=>a.globals.lineProgress||0],"raster-value":[_r,[],a=>a.globals.rasterValue||0],"raster-particle-speed":[_r,[],a=>a.globals.rasterParticleSpeed||0],"sky-radial-progress":[_r,[],a=>a.globals.skyRadialProgress||0],accumulated:[oi,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[_r,Nc(_r),(a,r)=>{let s=0;for(const u of r)s+=u.evaluate(a);return s}],"*":[_r,Nc(_r),(a,r)=>{let s=1;for(const u of r)s*=u.evaluate(a);return s}],"-":{type:_r,overloads:[[[_r,_r],(a,[r,s])=>r.evaluate(a)-s.evaluate(a)],[[_r],(a,[r])=>-r.evaluate(a)]]},"/":[_r,[_r,_r],(a,[r,s])=>r.evaluate(a)/s.evaluate(a)],"%":[_r,[_r,_r],(a,[r,s])=>r.evaluate(a)%s.evaluate(a)],ln2:[_r,[],()=>Math.LN2],pi:[_r,[],()=>Math.PI],e:[_r,[],()=>Math.E],"^":[_r,[_r,_r],(a,[r,s])=>Math.pow(r.evaluate(a),s.evaluate(a))],sqrt:[_r,[_r],(a,[r])=>Math.sqrt(r.evaluate(a))],log10:[_r,[_r],(a,[r])=>Math.log(r.evaluate(a))/Math.LN10],ln:[_r,[_r],(a,[r])=>Math.log(r.evaluate(a))],log2:[_r,[_r],(a,[r])=>Math.log2(r.evaluate(a))],sin:[_r,[_r],(a,[r])=>Math.sin(r.evaluate(a))],cos:[_r,[_r],(a,[r])=>Math.cos(r.evaluate(a))],tan:[_r,[_r],(a,[r])=>Math.tan(r.evaluate(a))],asin:[_r,[_r],(a,[r])=>Math.asin(r.evaluate(a))],acos:[_r,[_r],(a,[r])=>Math.acos(r.evaluate(a))],atan:[_r,[_r],(a,[r])=>Math.atan(r.evaluate(a))],min:[_r,Nc(_r),(a,r)=>Math.min(...r.map(s=>s.evaluate(a)))],max:[_r,Nc(_r),(a,r)=>Math.max(...r.map(s=>s.evaluate(a)))],abs:[_r,[_r],(a,[r])=>Math.abs(r.evaluate(a))],round:[_r,[_r],(a,[r])=>{const s=r.evaluate(a);return s<0?-Math.round(-s):Math.round(s)}],floor:[_r,[_r],(a,[r])=>Math.floor(r.evaluate(a))],ceil:[_r,[_r],(a,[r])=>Math.ceil(r.evaluate(a))],"filter-==":[ei,[Un,oi],(a,[r,s])=>a.properties()[r.value]===s.value],"filter-id-==":[ei,[oi],(a,[r])=>a.id()===r.value],"filter-type-==":[ei,[Un],(a,[r])=>a.geometryType()===r.value],"filter-<":[ei,[Un,oi],(a,[r,s])=>{const u=a.properties()[r.value],h=s.value;return typeof u==typeof h&&u<h}],"filter-id-<":[ei,[oi],(a,[r])=>{const s=a.id(),u=r.value;return typeof s==typeof u&&s<u}],"filter->":[ei,[Un,oi],(a,[r,s])=>{const u=a.properties()[r.value],h=s.value;return typeof u==typeof h&&u>h}],"filter-id->":[ei,[oi],(a,[r])=>{const s=a.id(),u=r.value;return typeof s==typeof u&&s>u}],"filter-<=":[ei,[Un,oi],(a,[r,s])=>{const u=a.properties()[r.value],h=s.value;return typeof u==typeof h&&u<=h}],"filter-id-<=":[ei,[oi],(a,[r])=>{const s=a.id(),u=r.value;return typeof s==typeof u&&s<=u}],"filter->=":[ei,[Un,oi],(a,[r,s])=>{const u=a.properties()[r.value],h=s.value;return typeof u==typeof h&&u>=h}],"filter-id->=":[ei,[oi],(a,[r])=>{const s=a.id(),u=r.value;return typeof s==typeof u&&s>=u}],"filter-has":[ei,[oi],(a,[r])=>r.value in a.properties()],"filter-has-id":[ei,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[ei,[fo(Un)],(a,[r])=>r.value.indexOf(a.geometryType())>=0],"filter-id-in":[ei,[fo(oi)],(a,[r])=>r.value.indexOf(a.id())>=0],"filter-in-small":[ei,[Un,fo(oi)],(a,[r,s])=>s.value.indexOf(a.properties()[r.value])>=0],"filter-in-large":[ei,[Un,fo(oi)],(a,[r,s])=>function(u,h,g,y){for(;g<=y;){const b=g+y>>1;if(h[b]===u)return!0;h[b]>u?y=b-1:g=b+1}return!1}(a.properties()[r.value],s.value,0,s.value.length-1)],all:{type:ei,overloads:[[[ei,ei],(a,[r,s])=>r.evaluate(a)&&s.evaluate(a)],[Nc(ei),(a,r)=>{for(const s of r)if(!s.evaluate(a))return!1;return!0}]]},any:{type:ei,overloads:[[[ei,ei],(a,[r,s])=>r.evaluate(a)||s.evaluate(a)],[Nc(ei),(a,r)=>{for(const s of r)if(s.evaluate(a))return!0;return!1}]]},"!":[ei,[ei],(a,[r])=>!r.evaluate(a)],"is-supported-script":[ei,[Un],(a,[r])=>{const s=a.globals&&a.globals.isSupportedScript;return!s||s(r.evaluate(a))}],upcase:[Un,[Un],(a,[r])=>r.evaluate(a).toUpperCase()],downcase:[Un,[Un],(a,[r])=>r.evaluate(a).toLowerCase()],concat:[Un,Nc(oi),(a,r)=>r.map(s=>rc(s.evaluate(a))).join("")],"resolved-locale":[Un,[gp],(a,[r])=>r.evaluate(a).resolvedLocale()],random:[_r,[_r,_r,oi],(a,r)=>{const[s,u,h]=r.map(y=>y.evaluate(a));if(s>u||s===u)return s;let g;if(typeof h=="string")g=function(y){let b=0;if(y.length===0)return b;for(let T=0;T<y.length;T++)b=(b<<5)-b+y.charCodeAt(T),b|=0;return b}(h);else{if(typeof h!="number")throw new gs(`Invalid seed input: ${h}`);g=h}return s+fw(g)()*(u-s)}]});class Ag{constructor(r,s,u,h,g){this.expression=r,this._warningHistory={},this._scope=u,this._options=h,this._iconImageUseTheme=g,this._evaluator=new po(u,h,g),this._defaultValue=s?function(y){return y.type==="color"&&(Eg(y.default)||Array.isArray(y.default))?new ri(0,0,0,0):y.type==="color"?ri.parse(y.default)||null:y.default===void 0?null:y.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null,this.configDependencies=Mp(r),this.isIndoorDependent=wg(r)}evaluateWithoutErrorHandling(r,s,u,h,g,y,b,T){return this._evaluator.globals=r,this._evaluator.feature=s,this._evaluator.featureState=u,this._evaluator.canonical=h||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(r,s,u,h,g,y,b,T,E){this._evaluator||(this._evaluator=new po(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=r,this._evaluator.feature=s||null,this._evaluator.featureState=u||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=T||null,this._evaluator.iconImageUseTheme=E||null;try{const k=this.expression.evaluate(this._evaluator);if(k==null||typeof k=="number"&&k!=k)return this._defaultValue;if(this._enumValues&&!(k in this._enumValues))throw new gs(`Expected value to be one of ${Object.keys(this._enumValues).map(P=>JSON.stringify(P)).join(", ")}, but found ${JSON.stringify(k)} instead.`);return k}catch(k){return this._warningHistory[k.message]||(this._warningHistory[k.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${k.message}`)),this._defaultValue}}}function jg(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in wh}function sc(a,r,s,u,h){const g=new dg(wh,[],r?function(b){const T={color:ma,string:Un,number:_r,enum:Un,boolean:ei,formatted:ud,resolvedImage:_p};return b.type==="array"?fo(T[b.value]||oi,b.length):T[b.type]}(r):void 0,void 0,void 0,s,u,h),y=g.parse(a,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return y?_d(new Ag(y,r,s,u,h)):Su(g.errors)}class Np{constructor(r,s,u,h){this.kind=r,this._styleExpression=s,this.isLightConstant=u,this.isLineProgressConstant=h,this.isStateDependent=r!=="constant"&&!Ap(s.expression),this.configDependencies=Mp(s.expression),this.isIndoorDependent=wg(s.expression)}evaluateWithoutErrorHandling(r,s,u,h,g,y){return this._styleExpression.evaluateWithoutErrorHandling(r,s,u,h,g,y)}evaluate(r,s,u,h,g,y,b){return this._styleExpression.evaluate(r,s,u,h,g,y,void 0,void 0,b)}}class Eu{constructor(r,s,u,h,g,y){this.kind=r,this.zoomStops=u,this._styleExpression=s,this.isStateDependent=r!=="camera"&&!Ap(s.expression),this.isIndoorDependent=wg(s.expression),this.isLightConstant=g,this.isLineProgressConstant=y,this.configDependencies=Mp(s.expression),this.interpolationType=h}evaluateWithoutErrorHandling(r,s,u,h,g,y){return this._styleExpression.evaluateWithoutErrorHandling(r,s,u,h,g,y)}evaluate(r,s,u,h,g,y){return this._styleExpression.evaluate(r,s,u,h,g,y)}interpolationFactor(r,s,u){return this.interpolationType?Ra.interpolationFactor(this.interpolationType,r,s,u):0}}function zv(a,r,s,u,h){if((a=sc(a,r,s,u,h)).result==="error")return a;const g=a.value.expression,y=gh(g);if(!y&&!Sg(r))return Su([new sl("","data expressions not supported")]);const b=_h(g,["zoom","pitch","distance-from-center"]);if(!b&&!Ov(r))return Su([new sl("","zoom expressions not supported")]);const T=_h(g,["measure-light"]);if(!T&&!Dv(r))return Su([new sl("","measure-light expression not supported")]);const E=_h(g,["line-progress"]);if(!E&&!function(R){return Nv(R.expression,"line-progress")}(r))return Su([new sl("","line-progress expression not supported")]);const k=r.expression&&r.expression.relaxZoomRestriction,P=kg(g);return P||b||k?P instanceof sl?Su([P]):P instanceof Ra&&!Tg(r)?Su([new sl("",'"interpolate" expressions cannot be used with this property')]):_d(P?new Eu(y&&E?"camera":"composite",a.value,P.labels,P instanceof Ra?P.interpolation:void 0,T,E):new Np(y&&E?"constant":"source",a.value,T,E)):Su([new sl("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Ig{constructor(r,s){this._parameters=r,this._specification=s,Object.assign(this,Cg(this._parameters,this._specification))}static deserialize(r){return new Ig(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function kg(a){let r=null;if(a instanceof Pp)r=kg(a.result);else if(a instanceof kp){for(const s of a.args)if(r=kg(s),r)break}else(a instanceof jp||a instanceof Ra)&&a.input instanceof Uo&&a.input.name==="zoom"&&(r=a);return r instanceof sl||a.eachChild(s=>{const u=kg(s);u instanceof sl?r=u:r&&u&&r!==u&&(r=new sl("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}var Dp,Pg,_w=function(){if(Pg)return Dp;Pg=1,Dp=r;var a=3;function r(s,u,h){var g=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var y=new Int32Array(this.arrayBuffer);s=y[0],this.d=(u=y[1])+2*(h=y[2]);for(var b=0;b<this.d*this.d;b++){var T=y[a+b],E=y[a+b+1];g.push(T===E?null:y.subarray(T,E))}var k=y[a+g.length+1];this.keys=y.subarray(y[a+g.length],k),this.bboxes=y.subarray(k),this.insert=this._insertReadonly}else{this.d=u+2*h;for(var P=0;P<this.d*this.d;P++)g.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=s,this.padding=h,this.scale=u/s,this.uid=0;var R=h/u*s;this.min=-R,this.max=s+R}return r.prototype.insert=function(s,u,h,g,y){this._forEachCell(u,h,g,y,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(u),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(y)},r.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},r.prototype._insertCell=function(s,u,h,g,y,b){this.cells[y].push(b)},r.prototype.query=function(s,u,h,g,y){var b=this.min,T=this.max;if(s<=b&&u<=b&&T<=h&&T<=g&&!y)return Array.prototype.slice.call(this.keys);var E=[];return this._forEachCell(s,u,h,g,this._queryCell,E,{},y),E},r.prototype._queryCell=function(s,u,h,g,y,b,T,E){var k=this.cells[y];if(k!==null)for(var P=this.keys,R=this.bboxes,L=0;L<k.length;L++){var z=k[L];if(T[z]===void 0){var W=4*z;(E?E(R[W+0],R[W+1],R[W+2],R[W+3]):s<=R[W+2]&&u<=R[W+3]&&h>=R[W+0]&&g>=R[W+1])?(T[z]=!0,b.push(P[z])):T[z]=!1}}},r.prototype._forEachCell=function(s,u,h,g,y,b,T,E){for(var k=this._convertToCellCoord(s),P=this._convertToCellCoord(u),R=this._convertToCellCoord(h),L=this._convertToCellCoord(g),z=k;z<=R;z++)for(var W=P;W<=L;W++){var J=this.d*W+z;if((!E||E(this._convertFromCellCoord(z),this._convertFromCellCoord(W),this._convertFromCellCoord(z+1),this._convertFromCellCoord(W+1)))&&y.call(this,s,u,h,g,J,b,T,E))return}},r.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},r.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},r.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,u=a+this.cells.length+1+1,h=0,g=0;g<this.cells.length;g++)h+=this.cells[g].length;var y=new Int32Array(u+h+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;for(var b=u,T=0;T<s.length;T++){var E=s[T];y[a+T]=b,y.set(E,b),b+=E.length}return y[a+s.length]=b,y.set(this.keys,b),y[a+s.length+1]=b+=this.keys.length,y.set(this.bboxes,b),b+=this.bboxes.length,y.buffer},Dp}(),yd=qi(_w);const Th={};function or(a,r,s={}){Object.defineProperty(a,"_classRegistryKey",{value:r,writable:!1}),Th[r]={klass:a,omit:s.omit||[]}}or(Object,"Object"),yd.serialize=function(a,r){const s=a.toArrayBuffer();return r&&r.add(s),{buffer:s}},yd.deserialize=function(a){return new yd(a.buffer)},Object.defineProperty(yd,"name",{value:"Grid"}),or(yd,"Grid"),delete wt.prototype.constructor,typeof DOMMatrix<"u"&&or(DOMMatrix,"DOMMatrix"),or(ri,"Color"),or(Error,"Error"),or(ro,"Formatted"),or(xp,"FormattedSection"),or(ld,"AJAXError"),or(ia,"ResolvedImage"),or(Ig,"StylePropertyFunction"),or(Ag,"StyleExpression",{omit:["_evaluator"]}),or(Gs,"ImageId"),or(Pc,"ImageVariant"),or(Eu,"ZoomDependentExpression"),or(Np,"ZoomConstantExpression"),or(Uo,"CompoundExpression",{omit:["_evaluate"]});for(const a in wh)Th[wh[a]._classRegistryKey]||or(wh[a],`Expression${a}`);function Fv(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function Dc(a){return self.ImageBitmap&&a instanceof ImageBitmap}function Cu(a,r){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(Fv(a)||Dc(a))return r&&r.add(a),a;if(ArrayBuffer.isView(a))return r&&r.add(a.buffer),a;if(a instanceof ImageData)return r&&r.add(a.data.buffer),a;if(Array.isArray(a)){const s=[];for(const u of a)s.push(Cu(u,r));return s}if(a instanceof Map){const s={$name:"Map",entries:[]};for(const[u,h]of a.entries())s.entries.push(Cu(u),Cu(h,r));return s}if(a instanceof Set){const s={$name:"Set"};let u=0;for(const h of a.values())s[++u]=Cu(h);return s}if(a instanceof DOMMatrix){const s={$name:"DOMMatrix"},u=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const h of u)s[h]=a[h];return s}if(typeof a=="bigint")return{$name:"BigInt",value:a.toString()};if(typeof a=="object"){const s=a.constructor,u=s._classRegistryKey;if(!u)throw new Error(`Can't serialize object of unregistered class "${s.name}".`);const h=s.serialize?s.serialize(a,r):{};if(!s.serialize){for(const g in a)a.hasOwnProperty(g)&&(Th[u].omit.indexOf(g)>=0||(h[g]=Cu(a[g],r)));a instanceof Error&&(h.message=a.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(h.$name=u),h}throw new Error("can't serialize object of type "+typeof a)}function Au(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||Fv(a)||Dc(a)||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(Au);if(typeof a=="object"){const r=a.$name||"Object";if(r==="Map"){const h=a.entries||[],g=new Map;for(let y=0;y<h.length;y+=2)g.set(Au(h[y]),Au(h[y+1]));return g}if(r==="Set"){const h=new Set;for(const g of Object.keys(a))g!=="$name"&&h.add(Au(a[g]));return h}if(r==="DOMMatrix"){let h;return h=a.is2D?[a.a,a.b,a.c,a.d,a.e,a.f]:[a.m11,a.m12,a.m13,a.m14,a.m21,a.m22,a.m23,a.m24,a.m31,a.m32,a.m33,a.m34,a.m41,a.m42,a.m43,a.m44],new DOMMatrix(h)}if(r==="BigInt")return BigInt(a.value);const{klass:s}=Th[r];if(!s)throw new Error(`Can't deserialize unregistered class "${r}".`);if(s.deserialize)return s.deserialize(a);const u=Object.create(s.prototype);for(const h of Object.keys(a))h!=="$name"&&(u[h]=Au(a[h]));return u}throw new Error("can't deserialize object of type "+typeof a)}const Ir={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519,Osage:a=>a>=66736&&a<=66815,"CJK Unified Ideographs Extension B":a=>a>=131072&&a<=173791};function Bv(a){for(const r of a)if(Mg(r.charCodeAt(0)))return!0;return!1}function yw(a){for(const r of a)if(!Rg(r.charCodeAt(0)))return!1;return!0}function Rg(a){return!(Ir.Arabic(a)||Ir["Arabic Supplement"](a)||Ir["Arabic Extended-A"](a)||Ir["Arabic Presentation Forms-A"](a)||Ir["Arabic Presentation Forms-B"](a))}function Mg(a){return!(a!==746&&a!==747&&(a<4352||!(Ir["Bopomofo Extended"](a)||Ir.Bopomofo(a)||Ir["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Ir["CJK Compatibility Ideographs"](a)||Ir["CJK Compatibility"](a)||Ir["CJK Radicals Supplement"](a)||Ir["CJK Strokes"](a)||!(!Ir["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Ir["CJK Unified Ideographs Extension A"](a)||Ir["CJK Unified Ideographs"](a)||Ir["Enclosed CJK Letters and Months"](a)||Ir["Hangul Compatibility Jamo"](a)||Ir["Hangul Jamo Extended-A"](a)||Ir["Hangul Jamo Extended-B"](a)||Ir["Hangul Jamo"](a)||Ir["Hangul Syllables"](a)||Ir.Hiragana(a)||Ir["Ideographic Description Characters"](a)||Ir.Kanbun(a)||Ir["Kangxi Radicals"](a)||Ir["Katakana Phonetic Extensions"](a)||Ir.Katakana(a)&&a!==12540||!(!Ir["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!Ir["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Ir["Unified Canadian Aboriginal Syllabics"](a)||Ir["Unified Canadian Aboriginal Syllabics Extended"](a)||Ir["Vertical Forms"](a)||Ir["Yijing Hexagram Symbols"](a)||Ir["Yi Syllables"](a)||Ir["Yi Radicals"](a))))}function Vv(a){return!(Mg(a)||function(r){return!!(Ir["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||Ir["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||Ir["Letterlike Symbols"](r)||Ir["Number Forms"](r)||Ir["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||Ir["Control Pictures"](r)&&r!==9251||Ir["Optical Character Recognition"](r)||Ir["Enclosed Alphanumerics"](r)||Ir["Geometric Shapes"](r)||Ir["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||Ir["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||Ir["CJK Symbols and Punctuation"](r)||Ir.Katakana(r)||Ir["Private Use Area"](r)||Ir["CJK Compatibility Forms"](r)||Ir["Small Form Variants"](r)||Ir["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)}(a))}function Uv(a){return Ir.Arabic(a)||Ir["Arabic Supplement"](a)||Ir["Arabic Extended-A"](a)||Ir["Arabic Presentation Forms-A"](a)||Ir["Arabic Presentation Forms-B"](a)}function vw(a){return a>=1424&&a<=2303||Ir["Arabic Presentation Forms-A"](a)||Ir["Arabic Presentation Forms-B"](a)}function uE(a,r){return!(!r&&vw(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Ir.Khmer(a))}function dE(a){for(const r of a)if(vw(r.charCodeAt(0)))return!0;return!1}const ga={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let $v=null,Yo=ga.unavailable,ju=null;const xw=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(Yo=ga.error),$v&&$v(a)};function qv(){Gv.fire(new ka("pluginStateChange",{pluginStatus:Yo,pluginURL:ju}))}const Gv=new Ic,Hv=function(){return Yo},Wv=function(){if(Yo!==ga.deferred||!ju)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Yo=ga.loading,qv(),ju&&ih({url:ju},a=>{a?xw(a):(Yo=ga.loaded,qv())})},_a={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Yo===ga.loaded||_a.applyArabicShaping!=null,isLoading:()=>Yo===ga.loading,setState(a){Yo=a.pluginStatus,ju=a.pluginURL},isParsing:()=>Yo===ga.parsing,isParsed:()=>Yo===ga.parsed,getPluginURL:()=>ju};class Ai{constructor(r,s){this.zoom=r,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.transition=s.transition,this.pitch=s.pitch,this.brightness=s.brightness,this.worldview=s.worldview,this.activeFloors=s.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(r){return function(s,u){for(const h of s)if(!uE(h.charCodeAt(0),u))return!1;return!0}(r,_a.isLoaded())}}class Op{constructor(r,s,u,h,g){this.property=r,this.value=s,this.expression=function(y,b,T,E,k){if(Eg(y))return new Ig(y,b);if(jg(y)||Array.isArray(y)&&y.length>0){const P=zv(y,b,T,E,k);if(P.result==="error")throw new Error(P.value.map(R=>`${R.key}: ${R.message}`).join(", "));return P.value}{let P=y;return typeof y=="string"&&b.type==="color"&&(P=ri.parse(y)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>P}}}(s===void 0?r.specification.default:s,r.specification,u,h,g)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,s,u,h){return this.property.possiblyEvaluate(this,r,s,u,h)}}class Eh{constructor(r,s,u,h){this.property=r,this.value=new Op(r,void 0,s,u,h)}transitioned(r,s){return new ww(this.property,this.value,s,Object.assign({},r.transition,this.transition),r.now)}untransitioned(){return new ww(this.property,this.value,null,{},0)}}class bw{constructor(r,s,u,h){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues),this._scope=s,this._options=u,this._iconImageUseTheme=h,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(r){return pr(this._values[r].value.value)}setValue(r,s){this._values.hasOwnProperty(r)||(this._values[r]=new Eh(this._values[r].property,this._scope,this._options,this._iconImageUseTheme)),this._values[r].value=new Op(this._values[r].property,s===null?void 0:pr(s),this._scope,this._options,this._iconImageUseTheme),this._values[r].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[r].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[r].value.isIndoorDependent())}setTransitionOrValue(r,s){s&&(this._options=s);const u=this._properties.properties;if(r)for(const h in r){const g=r[h];if(h.endsWith("-transition")){const y=h.slice(0,-11);u[y]&&this.setTransition(y,g)}else u.hasOwnProperty(h)&&this.setValue(h,g)}}getTransition(r){return pr(this._values[r].transition)}setTransition(r,s){this._values.hasOwnProperty(r)||(this._values[r]=new Eh(this._values[r].property)),this._values[r].transition=pr(s)||void 0}serialize(){const r={};for(const s of Object.keys(this._values)){const u=this.getValue(s);u!==void 0&&(r[s]=u);const h=this.getTransition(s);h!==void 0&&(r[`${s}-transition`]=h)}return r}transitioned(r,s){const u=new Oc(this._properties);for(const h of Object.keys(this._values))u._values[h]=this._values[h].transitioned(r,s._values[h]);return u}untransitioned(){const r=new Oc(this._properties);for(const s of Object.keys(this._values))r._values[s]=this._values[s].untransitioned();return r}isIndoorDependent(){return this._isIndoorDependent}}class ww{constructor(r,s,u,h,g){const y=h.delay||0,b=h.duration||0;g=g||0,this.property=r,this.value=s,this.begin=g+y,this.end=this.begin+b,r.specification.transition&&(h.delay||h.duration)&&(this.prior=u)}possiblyEvaluate(r,s,u){const h=r.now||0,g=this.value.possiblyEvaluate(r,s,u),y=this.prior;if(y){if(h>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(h<this.begin)return y.possiblyEvaluate(r,s,u);{const b=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(r,s,u),g,rp(b))}}return g}}class Oc{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,s,u){const h=new vd(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(r,s,u);return h}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class Zv{constructor(r,s,u,h){this._properties=r,this._values=Object.create(r.defaultPropertyValues),this._scope=s,this._options=u,this._iconImageUseTheme=h,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(r){return pr(this._values[r].value)}setValue(r,s){this._values[r]=new Op(this._values[r].property,s===null?void 0:pr(s),this._scope,this._options,this._iconImageUseTheme),this._values[r].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[r].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[r].isIndoorDependent())}serialize(){const r={};for(const s of Object.keys(this._values)){const u=this.getValue(s);u!==void 0&&(r[s]=u)}return r}possiblyEvaluate(r,s,u,h){const g=new vd(this._properties);for(const y of Object.keys(this._values))g._values[y]=this._values[y].possiblyEvaluate(r,s,u,h);return g}isIndoorDependent(){return this._isIndoorDependent}}class ul{constructor(r,s,u,h){this.property=r,this.value=s,this.parameters=u,this.iconImageUseTheme=h}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,s,u,h){return this.property.evaluate(this.value,this.parameters,r,s,u,h,this.iconImageUseTheme)}}class vd{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class Rt{constructor(r){this.specification=r}possiblyEvaluate(r,s){return r.expression.evaluate(s)}interpolate(r,s,u){const h=kc[this.specification.type];return h?h(r,s,u):r}}class Qt{constructor(r,s){this.specification=r,this.overrides=s}possiblyEvaluate(r,s,u,h,g){return r.expression.kind==="constant"||r.expression.kind==="camera"?new ul(this,{kind:"constant",value:r.expression.evaluate(s,null,{},u,h,void 0,g)},s):new ul(this,r.expression,s,g)}interpolate(r,s,u){if(r.value.kind!=="constant"||s.value.kind!=="constant")return r;if(r.value.value===void 0||s.value.value===void 0)return new ul(this,{kind:"constant",value:void 0},r.parameters);const h=kc[this.specification.type];return h?new ul(this,{kind:"constant",value:h(r.value.value,s.value.value,u)},r.parameters):r}evaluate(r,s,u,h,g,y,b){return r.kind==="constant"?r.value:r.evaluate(s,u,h,g,y,void 0,b)}}class Ch{constructor(r){this.specification=r}possiblyEvaluate(r,s,u,h){return!!r.expression.evaluate(s,null,{},u,h)}interpolate(){return!1}}class is{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const s=new Ai(0,{});for(const u in r){const h=r[u];h.specification.overridable&&this.overridableProperties.push(u);const g=this.defaultPropertyValues[u]=new Op(h,void 0),y=this.defaultTransitionablePropertyValues[u]=new Eh(h);this.defaultTransitioningPropertyValues[u]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=g.possiblyEvaluate(s)}}}or(Qt,"DataDrivenProperty"),or(Rt,"DataConstantProperty"),or(Ch,"ColorRampProperty");var He=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Xv(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Ah(a){if(Array.isArray(a))return a.map(Ah);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const r={};for(const s in a)r[s]=Ah(a[s]);return r}return Xv(a)}function jh(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const r of a.slice(1))if(!jh(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}function Ng(a,r="",s=null,u="fill"){if(a==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};jh(a)||(a=Ma(a));const h=a;let g=!0;try{g=function(k){if(!kh(k))return k;let P=Ah(k);return Ih(P),P=Dg(P),P}(h)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(h,null,2)}
        `)}let y=null,b=null;if(u!=="background"&&u!=="sky"&&u!=="slot"){b=He[`filter_${u}`];const k=sc(g,b,r,s);if(k.result==="error")throw new Error(k.value.map(P=>`${P.key}: ${P.message}`).join(", "));y=(P,R,L)=>k.value.evaluate(P,R,{},L)}let T=null,E=null;if(g!==h){const k=sc(h,b,r,s);if(k.result==="error")throw new Error(k.value.map(P=>`${P.key}: ${P.message}`).join(", "));T=(P,R,L,z,W)=>k.value.evaluate(P,R,{},L,void 0,void 0,z,W),E=!gh(k.value.expression)}return{filter:y,dynamicFilter:T||void 0,needGeometry:Tw(g),needFeature:!!E}}function Dg(a){if(!Array.isArray(a))return a;const r=function(s){if(hE.has(s[0])){for(let u=1;u<s.length;u++)if(kh(s[u]))return!0}return s}(a);return r===!0?r:r.map(s=>Dg(s))}function Ih(a){let r=!1;const s=[];if(a[0]==="case"){for(let u=1;u<a.length-1;u+=2)r=r||kh(a[u]),s.push(a[u+1]);s.push(a[a.length-1])}else if(a[0]==="match"){r=r||kh(a[1]);for(let u=2;u<a.length-1;u+=2)s.push(a[u+1]);s.push(a[a.length-1])}else if(a[0]==="step"){r=r||kh(a[1]);for(let u=1;u<a.length-1;u+=2)s.push(a[u+1])}r&&(a.length=0,a.push("any",...s));for(let u=1;u<a.length;u++)Ih(a[u])}function kh(a){if(!Array.isArray(a))return!1;if((r=a[0])==="pitch"||r==="distance-from-center")return!0;var r;for(let s=1;s<a.length;s++)if(kh(a[s]))return!0;return!1}const hE=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Sw(a,r){return a<r?-1:a>r?1:0}function Tw(a){if(!Array.isArray(a))return!1;if(a[0]==="within"||a[0]==="distance")return!0;for(let r=1;r<a.length;r++)if(Tw(a[r]))return!0;return!1}function Ma(a){if(!a)return!0;const r=a[0];return a.length<=1?r!=="any":r==="=="?Kv(a[1],a[2],"=="):r==="!="?Og(Kv(a[1],a[2],"==")):r==="<"||r===">"||r==="<="||r===">="?Kv(a[1],a[2],r):r==="any"?(s=a.slice(1),["any"].concat(s.map(Ma))):r==="all"?["all"].concat(a.slice(1).map(Ma)):r==="none"?["all"].concat(a.slice(1).map(Ma).map(Og)):r==="in"?Yv(a[1],a.slice(2)):r==="!in"?Og(Yv(a[1],a.slice(2))):r==="has"?Ew(a[1]):r!=="!has"||Og(Ew(a[1]));var s}function Kv(a,r,s){switch(a){case"$type":return[`filter-type-${s}`,r];case"$id":return[`filter-id-${s}`,r];default:return[`filter-${s}`,a,r]}}function Yv(a,r){if(r.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(s=>typeof s!=typeof r[0])?["filter-in-large",a,["literal",r.sort(Sw)]]:["filter-in-small",a,["literal",r]]}}function Ew(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Og(a){return["!",a]}const Lp="";function xd(a,r){return r?`${a}${Lp}${r}`:a}let Cw;const Aw=()=>Cw||(Cw=new is({"icon-size":new Qt(He.layout_symbol["icon-size"]),"icon-image":new Qt(He.layout_symbol["icon-image"]),"icon-rotate":new Qt(He.layout_symbol["icon-rotate"]),"icon-offset":new Qt(He.layout_symbol["icon-offset"])}));class fE{constructor(r,s,u,h,g,y){this.cachedIconPrimary=null;const b=sc(r,He.appearance.condition);if(b.result==="success"&&(this.condition=b.value),this.name=s,u){this.properties=new vd(Aw()),this.unevaluatedLayout=new Zv(Aw(),h,g,y);for(const T in u)this.unevaluatedLayout.setValue(T,u[T])}}hasCachedIconPrimary(){return this.cachedIconPrimary!==null}setCachedIconPrimary(r){this.cachedIconPrimary=r}getCachedIconPrimary(){return this.cachedIconPrimary}isActive(r){return!(this.condition||!r.isHidden||this.name!=="hidden")||this.condition.evaluate(r.globals,r.feature,r.featureState,r.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(r){return this.properties.get(r)}getUnevaluatedProperties(){return this.unevaluatedLayout}recalculate(r,s,u){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(r,void 0,s,u))}serialize(){const r={};return r.condition=this.condition.expression.serialize(),this.name&&(r.name=this.name),this.unevaluatedLayout&&(r.properties=this.unevaluatedLayout.serialize()),r}}const jw="-transition",pE=new Set(["fill","line","background","hillshade","raster"]);class $o extends Ic{constructor(r,s,u,h,g,y){if(super(),this.id=r.id,this.fqid=xd(this.id,u),this.type=r.type,this.scope=u,this.lut=h,this.options=g,this.iconImageUseTheme=y,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},r.type!=="custom"){if(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type&&r.type!=="background"&&r.type!=="sky"&&r.type!=="slot"){this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter;const b=sc(this.filter,He[`filter_${r.type}`]);b.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...b.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||b.value.isIndoorDependent)}if(r.slot&&(this.slot=r.slot),r.appearances&&this.setAppearances(r.appearances),s.layout&&(this._unevaluatedLayout=new Zv(s.layout,this.scope,g,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),s.paint){this._transitionablePaint=new bw(s.paint,this.scope,g);for(const b in r.paint)this.setPaintProperty(b,r.paint[b]);for(const b in r.layout)this.setLayoutProperty(b,r.layout[b]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new vd(s.paint)}}}onAdd(r){}onRemove(r){}isDraped(r){return!this.is3D(!0)&&pE.has(this.type)}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,s){if(this.type==="custom"&&r==="visibility")return void(this.visibility=s);const u=this._unevaluatedLayout;u._properties.properties[r]&&(u.setValue(r,s),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...u.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||u.isIndoorDependent(),r==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(r){this.appearances=[],r.forEach(s=>{this.appearances.push(new fE(s.condition,s.name,s.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(r){return r.endsWith(jw)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}isPaintProperty(r){return!!this._transitionablePaint._properties.properties[r]}setPaintProperty(r,s){const u=this._transitionablePaint,h=u._properties.properties;if(r.endsWith(jw)){const P=r.slice(0,-11);return h[P]&&u.setTransition(P,s||void 0),!1}if(!h[r])return!1;const g=u._values[r],y=g.value.isDataDriven(),b=g.value;u.setValue(r,s),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...u.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||u.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(r);const T=u._values[r].value,E=T.isDataDriven(),k=r.endsWith("pattern")||r==="line-dasharray";return E||y||k||this._handleOverridablePaintPropertyUpdate(r,b,T)}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getDefaultProgramParams(r,s,u){return null}_handleOverridablePaintPropertyUpdate(r,s,u){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,s){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,s,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,s)}serialize(){const r={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(r.appearances=this.appearances.map(s=>s.serialize())),jt(r,(s,u)=>!(s===void 0||u==="layout"&&!Object.keys(s).length||u==="paint"&&!Object.keys(s).length))}is3D(r){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const r in this.paint._values){const s=this.paint.get(r);if(s instanceof ul&&Sg(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}for(const r of this.appearances)if(!Ap(r.condition.expression))return!0;return!1}compileFilter(r){this._filterCompiled||(this._featureFilter=Ng(this.filter,this.scope,r),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(r){this._stats&&(r.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(r,s,u){return{}}queryRadius(r){}queryIntersectsFeature(r,s,u,h,g,y,b,T,E){}}const mE={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class zp{constructor(r,s){this._structArray=r,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Oi{constructor(){this.capacity=-1,this.resize(0)}static serialize(r,s){return r._trim(),s&&s.add(r.arrayBuffer),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const s=Object.create(this.prototype);return s.arrayBuffer=r.arrayBuffer,s.length=r.length,s.capacity=r.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...r){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...r){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function vn(a,r=1){let s=0,u=0;return{members:a.map(h=>{const g=mE[h.type].BYTES_PER_ELEMENT,y=s=Jv(s,Math.max(r,g)),b=h.components||1;return u=Math.max(u,g),s+=g*b,{name:h.name,type:h.type,components:b,offset:y}}),size:Jv(s,Math.max(u,r)),alignment:r}}function Jv(a,r){return Math.ceil(a/r)*r}class sa extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s){const u=this.length;return this.resize(u+1),this.emplace(u,r,s)}emplace(r,s,u){const h=2*r;return this.int16[h+0]=s,this.int16[h+1]=u,r}}sa.prototype.bytesPerElement=4,or(sa,"StructArrayLayout2i4");class bd extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,u){const h=this.length;return this.resize(h+1),this.emplace(h,r,s,u)}emplace(r,s,u,h){const g=3*r;return this.int16[g+0]=s,this.int16[g+1]=u,this.int16[g+2]=h,r}}bd.prototype.bytesPerElement=6,or(bd,"StructArrayLayout3i6");class Ph extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,u,h){const g=this.length;return this.resize(g+1),this.emplace(g,r,s,u,h)}emplace(r,s,u,h,g){const y=4*r;return this.int16[y+0]=s,this.int16[y+1]=u,this.int16[y+2]=h,this.int16[y+3]=g,r}}Ph.prototype.bytesPerElement=8,or(Ph,"StructArrayLayout4i8");class Lc extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.float32[1*r+0]=s,r}}Lc.prototype.bytesPerElement=4,or(Lc,"StructArrayLayout1f4");class Qv extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u){const h=this.length;return this.resize(h+1),this.emplace(h,r,s,u)}emplace(r,s,u,h){const g=4*r,y=2*r;return this.int16[g+0]=s,this.int16[g+1]=u,this.float32[y+1]=h,r}}Qv.prototype.bytesPerElement=8,or(Qv,"StructArrayLayout2i1f8");class ex extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,u){const h=this.length;return this.resize(h+1),this.emplace(h,r,s,u)}emplace(r,s,u,h){const g=4*r;return this.int16[g+0]=s,this.int16[g+1]=u,this.int16[g+2]=h,r}}ex.prototype.bytesPerElement=8,or(ex,"StructArrayLayout3i8");class Lg extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,u,h,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,s,u,h,g)}emplace(r,s,u,h,g,y){const b=5*r;return this.int16[b+0]=s,this.int16[b+1]=u,this.int16[b+2]=h,this.int16[b+3]=g,this.int16[b+4]=y,r}}Lg.prototype.bytesPerElement=10,or(Lg,"StructArrayLayout5i10");class zg extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,h,g,y,b){const T=this.length;return this.resize(T+1),this.emplace(T,r,s,u,h,g,y,b)}emplace(r,s,u,h,g,y,b,T){const E=6*r,k=12*r,P=3*r;return this.int16[E+0]=s,this.int16[E+1]=u,this.uint8[k+4]=h,this.uint8[k+5]=g,this.uint8[k+6]=y,this.uint8[k+7]=b,this.float32[P+2]=T,r}}zg.prototype.bytesPerElement=12,or(zg,"StructArrayLayout2i4ub1f12");class Na extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u){const h=this.length;return this.resize(h+1),this.emplace(h,r,s,u)}emplace(r,s,u,h){const g=3*r;return this.float32[g+0]=s,this.float32[g+1]=u,this.float32[g+2]=h,r}}Na.prototype.bytesPerElement=12,or(Na,"StructArrayLayout3f12");class Iu extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,h,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,s,u,h,g)}emplace(r,s,u,h,g,y){const b=6*r,T=3*r;return this.uint16[b+0]=s,this.uint16[b+1]=u,this.uint16[b+2]=h,this.uint16[b+3]=g,this.float32[T+2]=y,r}}Iu.prototype.bytesPerElement=12,or(Iu,"StructArrayLayout4ui1f12");class wd extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,u,h){const g=this.length;return this.resize(g+1),this.emplace(g,r,s,u,h)}emplace(r,s,u,h,g){const y=4*r;return this.uint16[y+0]=s,this.uint16[y+1]=u,this.uint16[y+2]=h,this.uint16[y+3]=g,r}}wd.prototype.bytesPerElement=8,or(wd,"StructArrayLayout4ui8");class Fg extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,u,h,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,r,s,u,h,g,y)}emplace(r,s,u,h,g,y,b){const T=6*r;return this.int16[T+0]=s,this.int16[T+1]=u,this.int16[T+2]=h,this.int16[T+3]=g,this.int16[T+4]=y,this.int16[T+5]=b,r}}Fg.prototype.bytesPerElement=12,or(Fg,"StructArrayLayout6i12");class Bg extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,u,h,g,y,b,T,E,k,P,R){const L=this.length;return this.resize(L+1),this.emplace(L,r,s,u,h,g,y,b,T,E,k,P,R)}emplace(r,s,u,h,g,y,b,T,E,k,P,R,L){const z=12*r;return this.int16[z+0]=s,this.int16[z+1]=u,this.int16[z+2]=h,this.int16[z+3]=g,this.uint16[z+4]=y,this.uint16[z+5]=b,this.uint16[z+6]=T,this.uint16[z+7]=E,this.int16[z+8]=k,this.int16[z+9]=P,this.int16[z+10]=R,this.int16[z+11]=L,r}}Bg.prototype.bytesPerElement=24,or(Bg,"StructArrayLayout4i4ui4i24");class Rh extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,h,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,r,s,u,h,g,y)}emplace(r,s,u,h,g,y,b){const T=10*r,E=5*r;return this.int16[T+0]=s,this.int16[T+1]=u,this.int16[T+2]=h,this.float32[E+2]=g,this.float32[E+3]=y,this.float32[E+4]=b,r}}Rh.prototype.bytesPerElement=20,or(Rh,"StructArrayLayout3i3f20");class ku extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,h){const g=this.length;return this.resize(g+1),this.emplace(g,r,s,u,h)}emplace(r,s,u,h,g){const y=4*r;return this.float32[y+0]=s,this.float32[y+1]=u,this.float32[y+2]=h,this.float32[y+3]=g,r}}ku.prototype.bytesPerElement=16,or(ku,"StructArrayLayout4f16");class tx extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.uint32[1*r+0]=s,r}}tx.prototype.bytesPerElement=4,or(tx,"StructArrayLayout1ul4");class dl extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s){const u=this.length;return this.resize(u+1),this.emplace(u,r,s)}emplace(r,s,u){const h=2*r;return this.uint16[h+0]=s,this.uint16[h+1]=u,r}}dl.prototype.bytesPerElement=4,or(dl,"StructArrayLayout2ui4");class rx extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,u,h,g,y,b,T,E,k,P,R,L){const z=this.length;return this.resize(z+1),this.emplace(z,r,s,u,h,g,y,b,T,E,k,P,R,L)}emplace(r,s,u,h,g,y,b,T,E,k,P,R,L,z){const W=20*r,J=10*r;return this.int16[W+0]=s,this.int16[W+1]=u,this.int16[W+2]=h,this.int16[W+3]=g,this.int16[W+4]=y,this.float32[J+3]=b,this.float32[J+4]=T,this.float32[J+5]=E,this.float32[J+6]=k,this.int16[W+14]=P,this.uint32[J+8]=R,this.uint16[W+18]=L,this.uint16[W+19]=z,r}}rx.prototype.bytesPerElement=40,or(rx,"StructArrayLayout5i4f1i1ul2ui40");class Vg extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,u,h,g,y,b){const T=this.length;return this.resize(T+1),this.emplace(T,r,s,u,h,g,y,b)}emplace(r,s,u,h,g,y,b,T){const E=8*r;return this.int16[E+0]=s,this.int16[E+1]=u,this.int16[E+2]=h,this.int16[E+4]=g,this.int16[E+5]=y,this.int16[E+6]=b,this.int16[E+7]=T,r}}Vg.prototype.bytesPerElement=16,or(Vg,"StructArrayLayout3i2i2i16");class Mh extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,u,h,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,s,u,h,g)}emplace(r,s,u,h,g,y){const b=4*r,T=8*r;return this.float32[b+0]=s,this.float32[b+1]=u,this.float32[b+2]=h,this.int16[T+6]=g,this.int16[T+7]=y,r}}Mh.prototype.bytesPerElement=16,or(Mh,"StructArrayLayout2f1f2i16");class Nh extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,h,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,r,s,u,h,g,y)}emplace(r,s,u,h,g,y,b){const T=20*r,E=5*r;return this.uint8[T+0]=s,this.uint8[T+1]=u,this.float32[E+1]=h,this.float32[E+2]=g,this.float32[E+3]=y,this.float32[E+4]=b,r}}Nh.prototype.bytesPerElement=20,or(Nh,"StructArrayLayout2ub4f20");class Ui extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,u){const h=this.length;return this.resize(h+1),this.emplace(h,r,s,u)}emplace(r,s,u,h){const g=3*r;return this.uint16[g+0]=s,this.uint16[g+1]=u,this.uint16[g+2]=h,r}}Ui.prototype.bytesPerElement=6,or(Ui,"StructArrayLayout3ui6");class Dh extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,s,u,h,g,y,b,T,E,k,P,R,L,z,W,J,te,ae,ue,he,Ce){const be=this.length;return this.resize(be+1),this.emplace(be,r,s,u,h,g,y,b,T,E,k,P,R,L,z,W,J,te,ae,ue,he,Ce)}emplace(r,s,u,h,g,y,b,T,E,k,P,R,L,z,W,J,te,ae,ue,he,Ce,be){const ke=30*r,Me=15*r,ze=60*r;return this.int16[ke+0]=s,this.int16[ke+1]=u,this.int16[ke+2]=h,this.float32[Me+2]=g,this.float32[Me+3]=y,this.uint16[ke+8]=b,this.uint16[ke+9]=T,this.uint32[Me+5]=E,this.uint32[Me+6]=k,this.uint32[Me+7]=P,this.uint16[ke+16]=R,this.uint16[ke+17]=L,this.uint16[ke+18]=z,this.float32[Me+10]=W,this.float32[Me+11]=J,this.uint8[ze+48]=te,this.uint8[ze+49]=ae,this.uint8[ze+50]=ue,this.uint32[Me+13]=he,this.int16[ke+28]=Ce,this.uint8[ze+58]=be,r}}Dh.prototype.bytesPerElement=60,or(Dh,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class nx extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,s,u,h,g,y,b,T,E,k,P,R,L,z,W,J,te,ae,ue,he,Ce,be,ke,Me,ze,ct,We,ut,gt,St,Lt,kt,_t){const It=this.length;return this.resize(It+1),this.emplace(It,r,s,u,h,g,y,b,T,E,k,P,R,L,z,W,J,te,ae,ue,he,Ce,be,ke,Me,ze,ct,We,ut,gt,St,Lt,kt,_t)}emplace(r,s,u,h,g,y,b,T,E,k,P,R,L,z,W,J,te,ae,ue,he,Ce,be,ke,Me,ze,ct,We,ut,gt,St,Lt,kt,_t,It){const ot=20*r,rt=40*r,At=80*r;return this.float32[ot+0]=s,this.float32[ot+1]=u,this.int16[rt+4]=h,this.int16[rt+5]=g,this.int16[rt+6]=y,this.int16[rt+7]=b,this.int16[rt+8]=T,this.int16[rt+9]=E,this.int16[rt+10]=k,this.int16[rt+11]=P,this.int16[rt+12]=R,this.uint16[rt+13]=L,this.uint16[rt+14]=z,this.uint16[rt+15]=W,this.uint16[rt+16]=J,this.uint16[rt+17]=te,this.uint16[rt+18]=ae,this.uint16[rt+19]=ue,this.uint16[rt+20]=he,this.uint16[rt+21]=Ce,this.uint16[rt+22]=be,this.uint16[rt+23]=ke,this.uint16[rt+24]=Me,this.uint16[rt+25]=ze,this.uint16[rt+26]=ct,this.uint16[rt+27]=We,this.uint32[ot+14]=ut,this.float32[ot+15]=gt,this.float32[ot+16]=St,this.float32[ot+17]=Lt,this.float32[ot+18]=kt,this.uint8[At+76]=_t,this.uint16[rt+39]=It,r}}nx.prototype.bytesPerElement=80,or(nx,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class ix extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,h,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,r,s,u,h,g,y)}emplace(r,s,u,h,g,y,b){const T=6*r;return this.float32[T+0]=s,this.float32[T+1]=u,this.float32[T+2]=h,this.float32[T+3]=g,this.float32[T+4]=y,this.float32[T+5]=b,r}}ix.prototype.bytesPerElement=24,or(ix,"StructArrayLayout6f24");class Sd extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,h,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,s,u,h,g)}emplace(r,s,u,h,g,y){const b=5*r;return this.float32[b+0]=s,this.float32[b+1]=u,this.float32[b+2]=h,this.float32[b+3]=g,this.float32[b+4]=y,r}}Sd.prototype.bytesPerElement=20,or(Sd,"StructArrayLayout5f20");class sx extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,h,g,y,b){const T=this.length;return this.resize(T+1),this.emplace(T,r,s,u,h,g,y,b)}emplace(r,s,u,h,g,y,b,T){const E=7*r;return this.float32[E+0]=s,this.float32[E+1]=u,this.float32[E+2]=h,this.float32[E+3]=g,this.float32[E+4]=y,this.float32[E+5]=b,this.float32[E+6]=T,r}}sx.prototype.bytesPerElement=28,or(sx,"StructArrayLayout7f28");class Fp extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,h,g,y,b,T,E,k,P){const R=this.length;return this.resize(R+1),this.emplace(R,r,s,u,h,g,y,b,T,E,k,P)}emplace(r,s,u,h,g,y,b,T,E,k,P,R){const L=11*r;return this.float32[L+0]=s,this.float32[L+1]=u,this.float32[L+2]=h,this.float32[L+3]=g,this.float32[L+4]=y,this.float32[L+5]=b,this.float32[L+6]=T,this.float32[L+7]=E,this.float32[L+8]=k,this.float32[L+9]=P,this.float32[L+10]=R,r}}Fp.prototype.bytesPerElement=44,or(Fp,"StructArrayLayout11f44");class ox extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,h,g,y,b,T,E){const k=this.length;return this.resize(k+1),this.emplace(k,r,s,u,h,g,y,b,T,E)}emplace(r,s,u,h,g,y,b,T,E,k){const P=9*r;return this.float32[P+0]=s,this.float32[P+1]=u,this.float32[P+2]=h,this.float32[P+3]=g,this.float32[P+4]=y,this.float32[P+5]=b,this.float32[P+6]=T,this.float32[P+7]=E,this.float32[P+8]=k,r}}ox.prototype.bytesPerElement=36,or(ox,"StructArrayLayout9f36");class Pu extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s){const u=this.length;return this.resize(u+1),this.emplace(u,r,s)}emplace(r,s,u){const h=2*r;return this.float32[h+0]=s,this.float32[h+1]=u,r}}Pu.prototype.bytesPerElement=8,or(Pu,"StructArrayLayout2f8");class ax extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,u,h){const g=this.length;return this.resize(g+1),this.emplace(g,r,s,u,h)}emplace(r,s,u,h,g){const y=6*r;return this.uint32[3*r+0]=s,this.uint16[y+2]=u,this.uint16[y+3]=h,this.uint16[y+4]=g,r}}ax.prototype.bytesPerElement=12,or(ax,"StructArrayLayout1ul3ui12");class Ug extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.uint16[1*r+0]=s,r}}Ug.prototype.bytesPerElement=2,or(Ug,"StructArrayLayout1ui2");class $g extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,h,g,y,b,T,E,k,P,R,L,z,W,J){const te=this.length;return this.resize(te+1),this.emplace(te,r,s,u,h,g,y,b,T,E,k,P,R,L,z,W,J)}emplace(r,s,u,h,g,y,b,T,E,k,P,R,L,z,W,J,te){const ae=16*r;return this.float32[ae+0]=s,this.float32[ae+1]=u,this.float32[ae+2]=h,this.float32[ae+3]=g,this.float32[ae+4]=y,this.float32[ae+5]=b,this.float32[ae+6]=T,this.float32[ae+7]=E,this.float32[ae+8]=k,this.float32[ae+9]=P,this.float32[ae+10]=R,this.float32[ae+11]=L,this.float32[ae+12]=z,this.float32[ae+13]=W,this.float32[ae+14]=J,this.float32[ae+15]=te,r}}$g.prototype.bytesPerElement=64,or($g,"StructArrayLayout16f64");class Oh extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,h,g,y,b){const T=this.length;return this.resize(T+1),this.emplace(T,r,s,u,h,g,y,b)}emplace(r,s,u,h,g,y,b,T){const E=10*r,k=5*r;return this.uint16[E+0]=s,this.uint16[E+1]=u,this.uint16[E+2]=h,this.uint16[E+3]=g,this.float32[k+2]=y,this.float32[k+3]=b,this.float32[k+4]=T,r}}Oh.prototype.bytesPerElement=20,or(Oh,"StructArrayLayout4ui3f20");class lx extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.int16[1*r+0]=s,r}}lx.prototype.bytesPerElement=2,or(lx,"StructArrayLayout1i2");class qg extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.uint8[1*r+0]=s,r}}qg.prototype.bytesPerElement=1,or(qg,"StructArrayLayout1ub1");class cx extends zp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}cx.prototype.size=40;class Iw extends rx{get(r){return new cx(this,r)}}or(Iw,"CollisionBoxArray");class Gg extends zp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}Gg.prototype.size=60;class Bp extends Dh{get(r){return new Gg(this,r)}}or(Bp,"PlacedSymbolArray");class ux extends zp{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(r){this._structArray.uint32[this._pos4+14]=r}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(r){this._structArray.float32[this._pos4+18]=r}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}ux.prototype.size=80;class kw extends nx{get(r){return new ux(this,r)}}or(kw,"SymbolInstanceArray");class dx extends Lc{getoffsetX(r){return this.float32[1*r+0]}}or(dx,"GlyphOffsetArray");class Pw extends sa{getx(r){return this.int16[2*r+0]}gety(r){return this.int16[2*r+1]}}or(Pw,"SymbolLineVertexArray");class Hg extends zp{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Hg.prototype.size=12;class Rw extends ax{get(r){return new Hg(this,r)}}or(Rw,"FeatureIndexArray");class Mw extends dl{geta_centroid_pos0(r){return this.uint16[2*r+0]}geta_centroid_pos1(r){return this.uint16[2*r+1]}}or(Mw,"FillExtrusionCentroidArray");class Nw extends zp{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Nw.prototype.size=6;class Dw extends bd{get(r){return new Nw(this,r)}}or(Dw,"FillExtrusionWallArray");const Ow=vn([{name:"a_pos",components:2,type:"Int16"}],4),gE=vn([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),_E=vn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Zi{constructor(r=[]){this.segments=r}_prepareSegment(r,s,u,h){let g=this.segments[this.segments.length-1];return r>Zi.MAX_VERTEX_ARRAY_LENGTH&&Cr(`Max vertices per segment is ${Zi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!g||g.vertexLength+r>Zi.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==h)&&(g={vertexOffset:s,primitiveOffset:u,vertexLength:0,primitiveLength:0},h!==void 0&&(g.sortKey=h),this.segments.push(g)),g}prepareSegment(r,s,u,h){return this._prepareSegment(r,s.length,u.length,h)}get(){return this.segments}destroy(){for(const r of this.segments)for(const s in r.vaos)r.vaos[s].destroy()}static simpleSegment(r,s,u,h){return new Zi([{vertexOffset:r,primitiveOffset:s,vertexLength:u,primitiveLength:h,vaos:{},sortKey:0}])}}function Lw(a,r){return 256*(a=se(Math.floor(a),0,255))+se(Math.floor(r),0,255)}Zi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,or(Zi,"SegmentVector");const yE=vn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),vE=vn([{name:"a_pattern_b",components:4,type:"Uint16"}]),xE=vn([{name:"a_dash",components:4,type:"Uint16"}]);class Vp{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(r,s,u,h){this.ids.push(Up(r)),this.positions.push(s,u,h)}eachPosition(r,s){const u=Up(r);let h=0,g=this.ids.length-1;for(;h<g;){const y=h+g>>1;this.ids[y]>=u?g=y:h=y+1}for(;this.ids[h]===u;)s(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(r,s){const u=new Float64Array(r.ids),h=new Uint32Array(r.positions);return hx(u,h,0,u.length-1),s&&(s.add(u.buffer),s.add(h.buffer)),{ids:u,positions:h}}static deserialize(r){const s=new Vp;let u;s.ids=r.ids,s.positions=r.positions;for(const h of s.ids)h!==u&&s.uniqueIds.push(h),u=h;return s.indexed=!0,s}}function Up(a){const r=+a;return Number.isSafeInteger(r)?r:hp(String(a))}function hx(a,r,s,u){for(;s<u;){const h=a[s+u>>1];let g=s-1,y=u+1;for(;;){do g++;while(a[g]<h);do y--;while(a[y]>h);if(g>=y)break;Wg(a,g,y),Wg(r,3*g,3*y),Wg(r,3*g+1,3*y+1),Wg(r,3*g+2,3*y+2)}y-s<u-y?(hx(a,r,s,y),s=y+1):(hx(a,r,y+1,u),u=y)}}function Wg(a,r,s){const u=a[r];a[r]=a[s],a[s]=u}or(Vp,"FeaturePositionMap");class hl{constructor(r){this.gl=r.gl,this.initialized=!1}fetchUniformLocation(r,s){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(r,s),this.initialized=!0),!!this.location}set(r,s,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Zg extends hl{constructor(r){super(r),this.current=0}set(r,s,u){this.fetchUniformLocation(r,s)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class Ss extends hl{constructor(r){super(r),this.current=0}set(r,s,u){this.fetchUniformLocation(r,s)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class oc extends hl{constructor(r){super(r),this.current=[0,0]}set(r,s,u){this.fetchUniformLocation(r,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class Lh extends hl{constructor(r){super(r),this.current=[0,0,0]}set(r,s,u){this.fetchUniformLocation(r,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class $p extends hl{constructor(r){super(r),this.current=[0,0,0,0]}set(r,s,u){this.fetchUniformLocation(r,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class fx extends hl{constructor(r){super(r),this.current=ri.transparent.toPremultipliedRenderColor(null)}set(r,s,u){this.fetchUniformLocation(r,s)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const zw=new Float32Array(16);class qp extends hl{constructor(r){super(r),this.current=zw}set(r,s,u){if(this.fetchUniformLocation(r,s)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let h=1;h<16;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}const bE=new Float32Array(9),Fw=new Float32Array(4);class px extends hl{constructor(r){super(r),this.current=Fw}set(r,s,u){if(this.fetchUniformLocation(r,s)){for(let h=0;h<4;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}}function mx(a){return[Lw(255*a.r,255*a.g),Lw(255*a.b,255*a.a)]}function Xg(a,r,s,u,h,g,y,b){return!!a&&(a.kind==="composite"||a.kind==="source"?a.evaluate(new Ai(0,{brightness:g,worldview:b}),r,s,h,u,y)==="none":a.value==="none")}class Kg{constructor(r,s,u,h){this.value=r,this.uniformNames=s.map(g=>`u_${g}`),this.type=u,this.context=h}setUniform(r,s,u,h,g){const y=h.constantOr(this.value);s.set(r,g,y instanceof ri?y.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):y)}getBinding(r,s){return this.type==="color"?new fx(r):new Ss(r)}}class Gp{constructor(r,s){this.uniformNames=s.map(u=>`u_${u}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(r,s){this.pixelRatio=r.pixelRatio||1,this.pattern=r.tl.concat(r.br),this.patternTransition=s?s.tl.concat(s.br):this.pattern}setUniform(r,s,u,h,g){let y=null;g!=="u_pattern"&&g!=="u_dash"||(y=this.pattern),g==="u_pattern_b"&&(y=this.patternTransition),g==="u_pixel_ratio"&&(y=this.pixelRatio),y&&s.set(r,g,y)}getBinding(r,s){return s==="u_pattern"||s==="u_pattern_b"||s==="u_dash"?new $p(r):new Ss(r)}}class zc{constructor(r,s,u,h){this.expression=r,this.type=u,this.maxValue=0,this.paintVertexAttributes=s.map(g=>({name:`a_${g}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(r,s,u,h,g,y,b,T){const E=this.paintVertexArray.length,k=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Ai(0,{brightness:y,worldview:T}),s,{},g,h,b):this.expression.kind==="constant"&&this.expression.value,P=Xg(this.lutExpression,s,{},h,g,y,b,T);this.paintVertexArray.resize(r),this._setPaintValue(E,r,k,P?null:this.context.lut)}updatePaintArray(r,s,u,h,g,y,b,T){const E=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:b,worldview:T},u,h,void 0,g):this.expression.kind==="constant"&&this.expression.value,k=Xg(this.lutExpression,u,h,g,void 0,b,void 0,T);this._setPaintValue(r,s,E,k?null:this.context.lut)}_setPaintValue(r,s,u,h){if(this.type==="color"){const g=mx(u.toPremultipliedRenderColor(h));for(let y=r;y<s;y++)this.paintVertexArray.emplace(y,g[0],g[1])}else{for(let g=r;g<s;g++)this.paintVertexArray.emplace(g,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Rl{constructor(r,s,u,h,g,y){this.expression=r,this.uniformNames=s.map(b=>`u_${b}_t`),this.type=u,this.useIntegerZoom=h,this.context=g,this.maxValue=0,this.paintVertexAttributes=s.map(b=>({name:`a_${b}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(r,s,u,h,g,y,b,T){const E=this.expression.evaluate(new Ai(this.context.zoom,{brightness:y,worldview:T}),s,{},g,h,b),k=this.expression.evaluate(new Ai(this.context.zoom+1,{brightness:y,worldview:T}),s,{},g,h,b),P=Xg(this.lutExpression,s,{},h,g,y,b,T),R=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(R,r,E,k,P?null:this.context.lut)}updatePaintArray(r,s,u,h,g,y,b,T){const E=this.expression.evaluate({zoom:this.context.zoom,brightness:b,worldview:T},u,h,void 0,g),k=this.expression.evaluate({zoom:this.context.zoom+1,brightness:b,worldview:T},u,h,void 0,g),P=Xg(this.lutExpression,u,h,g,void 0,b,void 0,T);this._setPaintValue(r,s,E,k,P?null:this.context.lut)}_setPaintValue(r,s,u,h,g){if(this.type==="color"){const y=mx(u.toPremultipliedRenderColor(g)),b=mx(u.toPremultipliedRenderColor(g));for(let T=r;T<s;T++)this.paintVertexArray.emplace(T,y[0],y[1],b[0],b[1])}else{for(let y=r;y<s;y++)this.paintVertexArray.emplace(y,u,h);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(h))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,s,u,h,g){const y=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,b=se(this.expression.interpolationFactor(y,this.context.zoom,this.context.zoom+1),0,1);s.set(r,g,b)}getBinding(r,s){return new Ss(r)}}class Io{constructor(r,s,u,h,g){this.expression=r,this.layerId=g,this.paintVertexAttributes=(u==="array"?xE:yE).members;for(let y=0;y<s.length;++y);this.paintVertexArray=new h,this.paintTransitionVertexArray=new wd}populatePaintArray(r,s,u,h){const g=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValues(g,r,s.patterns&&s.patterns[this.layerId],u)}updatePaintArray(r,s,u,h,g,y,b){this._setPaintValues(r,s,u.patterns&&u.patterns[this.layerId],y)}_setPaintValues(r,s,u,h){if(!h||!u)return;const g=h[u[0]],y=h[u[1]];if(g){if(g){const{tl:b,br:T,pixelRatio:E}=g;for(let k=r;k<s;k++)this.paintVertexArray.emplace(k,b[0],b[1],T[0],T[1],E)}if(y){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:b,br:T}=y;for(let E=r;E<s;E++)this.paintTransitionVertexArray.emplace(E,b[0],b[1],T[0],T[1])}}}upload(r){const s=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,s)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=r.createVertexBuffer(this.paintTransitionVertexArray,vE.members,s))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Fc{constructor(r,s,u=()=>!0){this.binders={},this._buffers=[],this.context=s;const h=[];for(const g in r.paint._values){const y=r.paint.get(g);if(g.endsWith("-use-theme")||!u(g)||!(y instanceof ul&&Sg(y.property.specification)))continue;const b=SE(g,r.type),T=y.value,E=y.property.specification.type,k=!!y.property.useIntegerZoom,P=g==="line-dasharray"||g.endsWith("pattern"),R=r.paint.get(`${g}-use-theme`),L=g==="line-dasharray"&&r.layout.get("line-cap").value.kind!=="constant"||R&&R.value.kind!=="constant";if(T.kind!=="constant"||L)if(T.kind==="source"||L||P){const z=gx(g,E,"source");this.binders[g]=P?new Io(T,b,E,z,r.id):new zc(T,b,E,z),h.push(`/a_${g}`)}else{const z=gx(g,E,"composite");this.binders[g]=new Rl(T,b,E,k,s,z),h.push(`/z_${g}`)}else this.binders[g]=P?new Gp(T.value,b):new Kg(T.value,b,E,s),h.push(`/u_${g}`);R&&(this.binders[g].lutExpression=R.value)}this.cacheKey=h.sort().join("")}getMaxValue(r){const s=this.binders[r];return s instanceof zc||s instanceof Rl?s.maxValue:0}populatePaintArrays(r,s,u,h,g,y,b,T){for(const E in this.binders){const k=this.binders[E];k.context=this.context,(k instanceof zc||k instanceof Rl||k instanceof Io)&&k.populatePaintArray(r,s,u,h,g,y,b,T)}}setConstantPatternPositions(r,s){for(const u in this.binders){const h=this.binders[u];h instanceof Gp&&h.setConstantPatternPositions(r,s)}}getPatternTransitionVertexBuffer(r){const s=this.binders[r];return s instanceof Io?s.paintTransitionVertexBuffer:null}updatePaintArrays(r,s,u,h,g,y,b,T,E,k){let P=!1;const R=Object.keys(r),L=R.length!==0&&!T,z=L?R:s.uniqueIds;this.context.lut=g.lut;for(const W in this.binders){const J=this.binders[W];if(J.context=this.context,(J instanceof zc||J instanceof Rl||J instanceof Io)&&J.expression&&J.expression.kind&&J.expression.kind!=="constant"&&(J.expression.isStateDependent===!0||J.expression.isLightConstant===!1)){const te=g.paint.get(W);J.expression=te.value;for(const ae of z){const ue=r[ae.toString()];s.eachPosition(ae,(he,Ce,be)=>{const ke=h.feature(he);J.updatePaintArray(Ce,be,ke,ue,y,b,E,k)})}if(!L)for(const ae of u.uniqueIds){const ue=r[ae.toString()];u.eachPosition(ae,(he,Ce,be)=>{const ke=h.feature(he);J.updatePaintArray(Ce,be,ke,ue,y,b,E,k)})}P=!0}}return P}defines(){const r=[];for(const s in this.binders){const u=this.binders[s];(u instanceof Kg||u instanceof Gp)&&r.push(...u.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r){const s=[];for(const u in this.binders){const h=this.binders[u];if(h instanceof Kg||h instanceof Gp||h instanceof Rl)for(const g of h.uniformNames)s.push({name:g,property:u,binding:h.getBinding(r,g)})}return s}setUniforms(r,s,u,h,g){for(const{name:y,property:b,binding:T}of u)this.binders[b].setUniform(r,T,g,h.get(b),y)}updatePaintBuffers(){this._buffers=[];for(const r in this.binders){const s=this.binders[r];(s instanceof zc||s instanceof Rl||s instanceof Io)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer),s instanceof Io&&s.paintTransitionVertexBuffer&&this._buffers.push(s.paintTransitionVertexBuffer)}}upload(r){for(const s in this.binders){const u=this.binders[s];(u instanceof zc||u instanceof Rl||u instanceof Io)&&u.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const s=this.binders[r];(s instanceof zc||s instanceof Rl||s instanceof Io)&&s.destroy()}}}class Ml{constructor(r,s,u=()=>!0){this.programConfigurations={};for(const h of r)this.programConfigurations[h.id]=new Fc(h,s,u);this.needsUpload=!1,this._featureMap=new Vp,this._featureMapWithoutIds=new Vp,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(r,s,u,h,g,y,b,T,E){for(const k in this.programConfigurations)this.programConfigurations[k].populatePaintArrays(r,s,h,g,y,b,T,E);s.id!==void 0?this._featureMap.add(s.id,u,this._bufferOffset,r):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,r),this._idlessCounter+=1),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,s,u,h,g,y,b,T){for(const E of u)this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(r,this._featureMap,this._featureMapWithoutIds,s,E,h,g,y,b||0,T)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const wE={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function SE(a,r){return wE[a]||[a.replace(`${r}-`,"").replace(/-/g,"_")]}const TE={"line-pattern":{source:Iu,composite:Iu},"fill-pattern":{source:Iu,composite:Iu},"fill-extrusion-pattern":{source:Iu,composite:Iu},"line-dasharray":{source:wd,composite:wd}},EE={color:{source:Pu,composite:ku},number:{source:Lc,composite:Pu}};function gx(a,r,s){const u=TE[a];return u&&u[s]||EE[r][s]}or(Kg,"ConstantBinder"),or(Gp,"PatternConstantBinder"),or(zc,"SourceExpressionBinder"),or(Io,"PatternCompositeBinder"),or(Rl,"CompositeExpressionBinder"),or(Fc,"ProgramConfiguration",{omit:["_buffers"]}),or(Ml,"ProgramConfigurationSet");const oa=Vt/Math.PI/2,p=5,n=6,c=16383,m=64,v=[m,32,16],w=-oa,S=oa;function C(a,r,s,u=oa){return s=gn(s),[a*Math.sin(s)*u,-r*u,a*Math.cos(s)*u]}function j(a,r,s){return C(Math.cos(gn(a)),Math.sin(gn(a)),r,s)}const M=63710088e-1,D=2*Math.PI*M;class B{constructor(r,s){if(isNaN(r)||isNaN(s))throw new Error(`Invalid LngLat object: (${r}, ${s})`);if(this.lng=+r,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new B(Re(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const s=Math.PI/180,u=this.lat*s,h=r.lat*s,g=Math.sin(u)*Math.sin(h)+Math.cos(u)*Math.cos(h)*Math.cos((r.lng-this.lng)*s);return M*Math.acos(Math.min(g,1))}toBounds(r=0){const s=360*r/40075017,u=s/Math.cos(Math.PI/180*this.lat);return new O({lng:this.lng-u,lat:this.lat-s},{lng:this.lng+u,lat:this.lat+s})}toEcef(r){return j(this.lat,this.lng,oa+r*oa/M)}static convert(r){if(r instanceof B)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new B(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new B(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class O{constructor(r,s){r&&(s?this.setSouthWest(r).setNorthEast(s):Array.isArray(r)&&r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof B?new B(r.lng,r.lat):B.convert(r),this}setSouthWest(r){return this._sw=r instanceof B?new B(r.lng,r.lat):B.convert(r),this}extend(r){const s=this._sw,u=this._ne;let h,g;if(r instanceof B)h=r,g=r;else{if(!(r instanceof O))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(O.convert(r)):this.extend(B.convert(r)):typeof r=="object"&&r!==null&&r.hasOwnProperty("lat")&&(r.hasOwnProperty("lon")||r.hasOwnProperty("lng"))?this.extend(B.convert(r)):this;if(h=r._sw,g=r._ne,!h||!g)return this}return s||u?(s.lng=Math.min(h.lng,s.lng),s.lat=Math.min(h.lat,s.lat),u.lng=Math.max(g.lng,u.lng),u.lat=Math.max(g.lat,u.lat)):(this._sw=new B(h.lng,h.lat),this._ne=new B(g.lng,g.lat)),this}getCenter(){return new B((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new B(this.getWest(),this.getNorth())}getSouthEast(){return new B(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:s,lat:u}=B.convert(r);let h=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&h}static convert(r){if(r)return r instanceof O?r:new O(r)}}const G=0,X=25.5;function ee(a){return D*Math.cos(a*Math.PI/180)}function oe(a){return(180+a)/360}function ie(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function ce(a,r){return a/ee(r)}function me(a){return 360*a-180}function de(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function Ee(a,r){return a*ee(de(r))}const ge=85.051129;function je(a){return Math.cos(gn(se(a,-ge,ge)))}function Se(a,r){const s=se(r,G,X),u=Math.pow(2,s);return je(a)*D/(512*u)}function ve(a){return 1/Math.cos(a*Math.PI/180)}function Ie(a,r=0){const s=Math.exp(Math.PI*(1-(a.y+r/Vt)/(1<<a.z)*2));return 80150034*s/(s*s+1)/Vt/(1<<a.z)}class $e{constructor(r,s,u=0){this.x=+r,this.y=+s,this.z=+u}static fromLngLat(r,s=0){const u=B.convert(r);return new $e(oe(u.lng),ie(u.lat),ce(s,u.lat))}toLngLat(){return new B(me(this.x),de(this.y))}toAltitude(){return Ee(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/D*ve(de(this.y))}}function Fe(a,r,s,u,h,g,y,b,T){const E=(r+u)/2,k=(s+h)/2,P=new wt(E,k);b(P),function(R,L,z,W,J,te){const ae=z-J,ue=W-te;return Math.abs((W-L)*ae-(z-R)*ue)/Math.hypot(ae,ue)}(P.x,P.y,g.x,g.y,y.x,y.y)>=T?(Fe(a,r,s,E,k,g,P,b,T),Fe(a,E,k,u,h,P,y,b,T)):a.push(y)}function at(a,r,s){let u=a[0],h=u.x,g=u.y;r(u);const y=[u];for(let b=1;b<a.length;b++){const T=a[b],{x:E,y:k}=T;r(T),Fe(y,h,g,E,k,u,T,r,s),h=E,g=k,u=T}return y}function Qe(a,r,s,u){if(u(r,s)){const h=r.add(s)._mult(.5);Qe(a,r,h,u),Qe(a,h,s,u)}else a.push(s)}function pt(a,r){let s=a[0];const u=[s];for(let h=1;h<a.length;h++){const g=a[h];Qe(u,s,g,r),s=g}return u}const Ot=Math.pow(2,14)-1,Ye=-Ot-1;function Oe(a,r){const s=Math.round(a.x*r),u=Math.round(a.y*r);return a.x=se(s,Ye,Ot),a.y=se(u,Ye,Ot),(s<a.x||s>a.x+1||u<a.y||u>a.y+1)&&Cr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function mt(a,r,s){const u=a.loadGeometry(),h=a.extent,g=Vt/h;if(r&&s&&s.projection.isReprojectedInTileSpace){const y=1<<r.z,{scale:b,x:T,y:E,projection:k}=s,P=R=>{const L=me((r.x+R.x/h)/y),z=de((r.y+R.y/h)/y),W=k.project(L,z);R.x=(W.x*b-T)*h,R.y=(W.y*b-E)*h};for(let R=0;R<u.length;R++)if(a.type!==1)u[R]=at(u[R],P,1);else{const L=[];for(const z of u[R])z.x<0||z.x>=h||z.y<0||z.y>=h||(P(z),L.push(z));u[R]=L}}for(const y of u)for(const b of y)Oe(b,g);return u}function et(a,r){return{type:a.type,id:a.id,properties:a.properties,geometry:r?mt(a):[]}}class Et{constructor(r,s,u,h,g){this.properties={},this.extent=u,this.type=0,this.id=void 0,this._pbf=r,this._geometry=-1,this._keys=h,this._values=g,r.readFields($t,this,s)}loadGeometry(){const r=this._pbf;r.pos=this._geometry;const s=r.readVarint()+r.pos,u=[];let h,g=1,y=0,b=0,T=0;for(;r.pos<s;){if(y<=0){const E=r.readVarint();g=7&E,y=E>>3}if(y--,g===1||g===2)b+=r.readSVarint(),T+=r.readSVarint(),g===1&&(h&&u.push(h),h=[]),h&&h.push(new wt(b,T));else{if(g!==7)throw new Error(`unknown command ${g}`);h&&h.push(h[0].clone())}}return h&&u.push(h),u}bbox(){const r=this._pbf;r.pos=this._geometry;const s=r.readVarint()+r.pos;let u=1,h=0,g=0,y=0,b=1/0,T=-1/0,E=1/0,k=-1/0;for(;r.pos<s;){if(h<=0){const P=r.readVarint();u=7&P,h=P>>3}if(h--,u===1||u===2)g+=r.readSVarint(),y+=r.readSVarint(),g<b&&(b=g),g>T&&(T=g),y<E&&(E=y),y>k&&(k=y);else if(u!==7)throw new Error(`unknown command ${u}`)}return[b,E,T,k]}toGeoJSON(r,s,u){const h=this.extent*Math.pow(2,u),g=this.extent*r,y=this.extent*s,b=this.loadGeometry();function T(R){return[360*(R.x+g)/h-180,360/Math.PI*Math.atan(Math.exp((1-2*(R.y+y)/h)*Math.PI))-90]}function E(R){return R.map(T)}let k;if(this.type===1){const R=[];for(const z of b)R.push(z[0]);const L=E(R);k=R.length===1?{type:"Point",coordinates:L[0]}:{type:"MultiPoint",coordinates:L}}else if(this.type===2){const R=b.map(E);k=R.length===1?{type:"LineString",coordinates:R[0]}:{type:"MultiLineString",coordinates:R}}else{if(this.type!==3)throw new Error("unknown feature type");{const R=function(z){const W=z.length;if(W<=1)return[z];const J=[];let te,ae;for(let ue=0;ue<W;ue++){const he=lr(z[ue]);he!==0&&(ae===void 0&&(ae=he<0),ae===he<0?(te&&J.push(te),te=[z[ue]]):te&&te.push(z[ue]))}return te&&J.push(te),J}(b),L=[];for(const z of R)L.push(z.map(E));k=L.length===1?{type:"Polygon",coordinates:L[0]}:{type:"MultiPolygon",coordinates:L}}}const P={type:"Feature",geometry:k,properties:this.properties};return this.id!=null&&(P.id=this.id),P}}function $t(a,r,s){a===1?r.id=s.readVarint():a===2?function(u,h){const g=u.readVarint()+u.pos;for(;u.pos<g;){const y=h._keys[u.readVarint()],b=h._values[u.readVarint()];h.properties[y]=b}}(s,r):a===3?r.type=s.readVarint():a===4&&(r._geometry=s.pos)}function lr(a){let r=0;for(let s,u,h=0,g=a.length,y=g-1;h<g;y=h++)s=a[h],u=a[y],r+=(u.x-s.x)*(s.y+u.y);return r}Et.types=["Unknown","Point","LineString","Polygon"];class Mt{constructor(r,s){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(zt,this,s),this.length=this._features.length}feature(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];const s=this._pbf.readVarint()+this._pbf.pos;return new Et(this._pbf,s,this.extent,this._keys,this._values)}}function zt(a,r,s){a===15?r.version=s.readVarint():a===1?r.name=s.readString():a===5?r.extent=s.readVarint():a===2?r._features.push(s.pos):a===3?r._keys.push(s.readString()):a===4&&r._values.push(function(u){let h=null;const g=u.readVarint()+u.pos;for(;u.pos<g;){const y=u.readVarint()>>3;h=y===1?u.readString():y===2?u.readFloat():y===3?u.readDouble():y===4?u.readVarint64():y===5?u.readVarint():y===6?u.readSVarint():y===7?u.readBoolean():null}if(h==null)throw new Error("unknown feature value");return h}(s))}class ur{constructor(r,s){this.layers=r.readFields(nr,{},s)}}function nr(a,r,s){if(a===3){const u=new Mt(s,s.readVarint()+s.pos);u.length&&(r[u.name]=u)}}const er="3d_elevation_id",ir="level";class kr{constructor(){this._valid=!1}reset(r){return this.feature=r,this._valid=!0,this._geometry=r.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(r,s){return this._valid&&r(s(this._geometry)),this}require(r,s,u){return this.get(r,!0,s,u)}optional(r,s,u){return this.get(r,!1,s,u)}success(){return this._valid}get(r,s,u,h){const g=this.feature.properties.hasOwnProperty(r)?+this.feature.properties[r]:void 0;return this._valid&&g!==void 0&&!Number.isNaN(g)?u(h?h(g):g):s&&(this._valid=!1),this}}class xn{constructor(r,s){this.featureFunc=r,this.vertexFunc=s}parseFeature(r,s,u){return this.featureFunc(r,s,u)}parseVertex(r,s,u){return this.vertexFunc(r,s,u)}}const Mn=new xn((a,r,s)=>a.reset(r).require(er,u=>{s.id=u}).optional("fixed_height_relative",u=>{s.constantHeight=u},Gr.decodeRelativeHeight).geometry(u=>{s.bounds=u},Sp).success(),(a,r,s)=>a.reset(r).require(er,u=>{s.id=u}).require("elevation_idx",u=>{s.idx=u}).require("extent",u=>{s.extent=u}).require("height_relative",u=>{s.height=u},Gr.decodeRelativeHeight).geometry(u=>{s.position=u},Gr.getPoint).success()),fi=new xn((a,r,s)=>a.reset(r).require(er,u=>{s.id=u}).optional("fixed_height",u=>{s.constantHeight=u},Gr.decodeMetricHeight).geometry(u=>{s.bounds=u},Sp).success(),(a,r,s)=>a.reset(r).require(er,u=>{s.id=u}).require("elevation_idx",u=>{s.idx=u}).require("extent",u=>{s.extent=u}).require("height",u=>{s.height=u},Gr.decodeMetricHeight).geometry(u=>{s.position=u},Gr.getPoint).success());class Gr{static getPoint(r){return yt(r[0][0].x,r[0][0].y)}static decodeRelativeHeight(r){return 1e-4*r*5}static decodeMetricHeight(r){return 1e-4*r}static getVersionSchema(r){return r?r==="1.0.1"?fi:void 0:Mn}static parse(r){const s=[],u=[],h=r.length,g=new kr;for(let y=0;y<h;y++){const b=r.feature(y),T=b.properties.version,E=Gr.getVersionSchema(T);if(E===void 0){Cr(`Unknown elevation feature version number ${T||"(unknown)"}`);continue}const k=b.properties.type;if(!k)continue;const P=Et.types[b.type];if(P==="Point"&&k==="curve_point"){const R={};E.parseVertex(g,b,R)&&s.push(R)}else if(P==="Polygon"&&k==="curve_meta"){const R={};E.parseFeature(g,b,R)&&u.push(R)}}return{vertices:s,features:u}}}class Pn{constructor(r,s){this.pos=r,this.dir=s}intersectsPlane(r,s,u){const h=Il(s,this.dir);if(Math.abs(h)<1e-6)return!1;const g=((r[0]-this.pos[0])*s[0]+(r[1]-this.pos[1])*s[1])/h;return u[0]=this.pos[0]+this.dir[0]*g,u[1]=this.pos[1]+this.dir[1]*g,!0}}class on{constructor(r,s){this.pos=r,this.dir=s}intersectsPlane(r,s,u){const h=zr(s,this.dir);if(Math.abs(h)<1e-6)return!1;const g=((r[0]-this.pos[0])*s[0]+(r[1]-this.pos[1])*s[1]+(r[2]-this.pos[2])*s[2])/h;return u[0]=this.pos[0]+this.dir[0]*g,u[1]=this.pos[1]+this.dir[1]*g,u[2]=this.pos[2]+this.dir[2]*g,!0}closestPointOnSphere(r,s,u){if(function(L,z){var W=L[0],J=L[1],te=L[2],ae=z[0],ue=z[1],he=z[2];return Math.abs(W-ae)<=A*Math.max(1,Math.abs(W),Math.abs(ae))&&Math.abs(J-ue)<=A*Math.max(1,Math.abs(J),Math.abs(ue))&&Math.abs(te-he)<=A*Math.max(1,Math.abs(te),Math.abs(he))}(this.pos,r)||s===0)return u[0]=u[1]=u[2]=0,!1;const[h,g,y]=this.dir,b=this.pos[0]-r[0],T=this.pos[1]-r[1],E=this.pos[2]-r[2],k=h*h+g*g+y*y,P=2*(b*h+T*g+E*y),R=P*P-4*k*(b*b+T*T+E*E-s*s);if(R<0){const L=Math.max(-P/2,0),z=b+h*L,W=T+g*L,J=E+y*L,te=Math.hypot(z,W,J);return u[0]=z*s/te,u[1]=W*s/te,u[2]=J*s/te,!1}{const L=(-P-Math.sqrt(R))/(2*k);if(L<0){const z=Math.hypot(b,T,E);return u[0]=b*s/z,u[1]=T*s/z,u[2]=E*s/z,!1}return u[0]=b+h*L,u[1]=T+g*L,u[2]=E+y*L,!0}}}class ai{constructor(r,s,u,h,g){this.TL=r,this.TR=s,this.BR=u,this.BL=h,this.horizon=g}static fromInvProjectionMatrix(r,s,u){const h=[-1,1,1],g=[1,1,1],y=[1,-1,1],b=[-1,-1,1],T=hn(h,h,r),E=hn(g,g,r),k=hn(y,y,r),P=hn(b,b,r);return new ai(T,E,k,P,s/u)}}function Nn(a,r,s){let u=1/0,h=-1/0;const g=[];for(const y of a){bi(g,y,r);const b=zr(g,s);u=Math.min(u,b),h=Math.max(h,b)}return[u,h]}function Si(a,r){let s=!0;for(let u=0;u<a.planes.length;u++){const h=a.planes[u];let g=0;for(let y=0;y<r.length;y++)g+=+(zr(h,r[y])+h[3]>=0);if(g===0)return 0;g!==r.length&&(s=!1)}return s?2:1}function $n(a,r){for(const s of a.projections){const u=Nn(r,a.points[0],s.axis);if(s.projection[1]<u[0]||s.projection[0]>u[1])return 0}return 1}function an(a,r){let s=0;const u=[0,0,0,0];for(let y=0;y<a.length;y++)u[0]=a[y][0],u[1]=a[y][1],u[2]=a[y][2],u[3]=1,(h=u)[0]*(g=r)[0]+h[1]*g[1]+h[2]*g[2]+h[3]*g[3]>=0&&s++;var h,g;return s}class Qn{constructor(r,s){this.points=r||new Array(8).fill([0,0,0]),this.planes=s||new Array(6).fill([0,0,0,0]),this.bounds=dn.fromPoints(this.points),this.projections=[],this.frustumEdges=[bi([],this.points[2],this.points[3]),bi([],this.points[0],this.points[3]),bi([],this.points[4],this.points[0]),bi([],this.points[5],this.points[1]),bi([],this.points[6],this.points[2]),bi([],this.points[7],this.points[3])];for(const u of this.frustumEdges){const h=[0,-u[2],u[1]],g=[u[2],0,-u[0]];this.projections.push({axis:h,projection:Nn(this.points,this.points[0],h)}),this.projections.push({axis:g,projection:Nn(this.points,this.points[0],g)})}}static fromInvProjectionMatrix(r,s,u,h){const g=Math.pow(2,u),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const k=yr([],E,r),P=1/k[3]/s*g;return(R=k)[0]=(L=k)[0]*(z=[P,P,h?1/k[3]:P,P])[0],R[1]=L[1]*z[1],R[2]=L[2]*z[2],R[3]=L[3]*z[3],R;var R,L,z}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const k=xr([],Hr([],bi([],y[E[0]],y[E[1]]),bi([],y[E[2]],y[E[1]]))),P=-zr(k,y[E[1]]);return k.concat(P)}),T=[];for(let E=0;E<y.length;E++)T.push([y[E][0],y[E][1],y[E][2]]);return new Qn(T,b)}intersectsPrecise(r,s,u){for(let h=0;h<s.length;h++)if(!an(r,s[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!an(r,this.planes[h]))return 0;for(const h of u)for(const g of this.frustumEdges){const y=Hr([],h,g),b=qt(y);if(b===0)continue;Le(y,y,1/b);const T=Nn(this.points,this.points[0],y),E=Nn(r,this.points[0],y);if(T[0]>E[1]||E[0]>T[1])return 0}return 1}containsPoint(r){for(const s of this.planes){const u=s[3];if(zr([s[0],s[1],s[2]],r)+u<0)return!1}return!0}}class dn{static fromPoints(r){const s=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const h of r)Pt(s,s,h),fe(u,u,h);return new dn(s,u)}static fromTileIdAndHeight(r,s,u){const h=1<<r.canonical.z,g=r.canonical.x,y=r.canonical.y;return new dn([g/h,y/h,s],[(g+1)/h,(y+1)/h,u])}static applyTransform(r,s){const u=r.getCorners();for(let h=0;h<u.length;++h)hn(u[h],u[h],s);return dn.fromPoints(u)}static applyTransformFast(r,s){const u=[s[12],s[13],s[14]],h=[...u];for(let g=0;g<3;g++)for(let y=0;y<3;y++){const b=s[4*y+g],T=b*r.min[y],E=b*r.max[y];u[g]+=Math.min(T,E),h[g]+=Math.max(T,E)}return new dn(u,h)}static projectAabbCorners(r,s){const u=r.getCorners();for(let h=0;h<u.length;++h)hn(u[h],u[h],s);return u}constructor(r,s){this.min=r,this.max=s,this.center=Le([],Ne([],this.min,this.max),.5)}quadrant(r){const s=[r%2==0,r<2],u=dt(this.min),h=dt(this.max);for(let g=0;g<s.length;g++)u[g]=s[g]?this.min[g]:this.center[g],h[g]=s[g]?this.center[g]:this.max[g];return h[2]=this.max[2],new dn(u,h)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,s=this.max;return[[r[0],r[1],r[2]],[s[0],r[1],r[2]],[s[0],s[1],r[2]],[r[0],s[1],r[2]],[r[0],r[1],s[2]],[s[0],r[1],s[2]],[s[0],s[1],s[2]],[r[0],s[1],s[2]]]}intersects(r){return this.intersectsAabb(r.bounds)?Si(r,this.getCorners()):0}intersectsFlat(r){return this.intersectsAabb(r.bounds)?Si(r,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(r,s){return s||this.intersects(r)?$n(r,this.getCorners()):0}intersectsPreciseFlat(r,s){return s||this.intersectsFlat(r)?$n(r,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(r){for(let s=0;s<3;++s)if(this.min[s]>r.max[s]||r.min[s]>this.max[s])return!1;return!0}intersectsAabbXY(r){return!(this.min[0]>r.max[0]||r.min[0]>this.max[0]||this.min[1]>r.max[1]||r.min[1]>this.max[1])}encapsulate(r){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],r.min[s]),this.max[s]=Math.max(this.max[s],r.max[s])}encapsulatePoint(r){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],r[s]),this.max[s]=Math.max(this.max[s],r[s])}closestPoint(r){return[Math.max(Math.min(this.max[0],r[0]),this.min[0]),Math.max(Math.min(this.max[1],r[1]),this.min[1]),Math.max(Math.min(this.max[2],r[2]),this.min[2])]}}or(dn,"Aabb");class ki{constructor(r,s){this.feature=r,this.metersToTile=s,this.index=0}get(){const r=this.feature.vertices[this.index],s=this.feature.vertexProps[this.index].dir,u=s[1],h=-s[0],g=(r.extent+1)*this.metersToTile;return[new wt(Math.trunc(r.position[0]+u*g),Math.trunc(r.position[1]+h*g)),new wt(Math.trunc(r.position[0]-u*g),Math.trunc(r.position[1]-h*g))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class ti{constructor(r,s,u,h,g,y){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[rr(),rr(),rr(),rr(),rr(),rr(),rr()],this.id=r,this.heightRange={min:u,max:u},this.safeArea=s,this.constantHeight=u,this.constantHeight==null&&(this.constantHeight!=null||h.length!==0)){this.vertices=h,this.edges=g,this.edges=this.edges.filter(b=>{return b.a<this.vertices.length&&b.b<this.vertices.length&&!((T=this.vertices[b.a].position)[0]===(E=this.vertices[b.b].position)[0]&&T[1]===E[1]);var T,E}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const b of this.vertices)this.vertexProps.push({dir:yt(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,b.height),this.heightRange.max=Math.max(this.heightRange.max,b.height);for(const b of this.edges){const T=this.vertices[b.a].position,E=this.vertices[b.b].position,k=Cn(rr(),E,T),P=li(k),R=Mi(rr(),k,1/P);this.edgeProps.push({vec:k,dir:R,len:P});const L=this.vertexProps[b.a].dir,z=this.vertexProps[b.b].dir;Qr(L,L,R),Qr(z,z,R)}for(const b of this.vertexProps)b.dir[0]===0&&b.dir[1]===0||Os(b.dir,b.dir);this.tessellate(y)}}pointElevation(r){if(this.constantHeight!=null)return this.constantHeight;const s=this.getClosestEdge(r);if(s==null)return 0;const[u,h]=s;return Br(this.vertices[this.edges[u].a].height,this.vertices[this.edges[u].b].height,h)}computeSlopeNormal(r,s){const u=this.getClosestEdge(r);if(!u)return Ke(0,0,1);const h=u[0],g=this.edges[h],y=this.edgeProps[h].vec,b=Ke(y[0],y[1],(this.vertices[g.b].height-this.vertices[g.a].height)*s),T=Ke(b[1],-b[0],0);Hr(T,T,b);const E=qt(T);return E>0?Le(T,T,1/E):st(T,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(r){if(this.edges.length===0)return;let s=0,u=Number.POSITIVE_INFINITY,h=0;const[g,y,b,T,E,k,P]=this._tmpVec2;Ar(P,r.x,r.y);const R=new Pn(P,null);for(let L=0;L<this.edges.length;L++){const z=this.edges[L],W=this.edgeProps[L].dir;R.dir=W;const J=this.vertices[z.a].position,te=this.vertices[z.b].position,ae=R.intersectsPlane(J,this.vertexProps[z.a].dir,g),ue=R.intersectsPlane(te,this.vertexProps[z.b].dir,y);if(!ae||!ue)continue;Cn(b,y,g),Cn(T,P,g);const he=Il(b,b),Ce=he>0?Il(T,b)/he:0,be=se(Ce,0,1),ke=Math.abs((Ce-be)*this.edgeProps[L].len);Cn(E,P,J),Ar(k,W[1],-W[0]);const Me=ke+Math.abs(Il(E,k));Me<u&&(s=L,u=Me,h=be)}return[s,h]}tessellate(r){const s=Be(),u=Be(),h=Be(),g=Be();for(let y=this.edges.length-1;y>=0;--y){const b=this.edges[y].a,T=this.edges[y].b,{position:E,height:k,extent:P}=this.vertices[b],{position:R,height:L,extent:z}=this.vertices[T],W=this.vertexProps[b].dir,J=this.vertexProps[T].dir;if(st(s,E[0]/r,E[1]/r,k),st(u,R[0]/r,R[1]/r,L),st(h,W[1],-W[0],0),Le(h,h,P),st(g,J[1],-J[0],0),Le(g,g,z),this.distSqLines(Ke(s[0]+.5*h[0],s[1]+.5*h[1],s[2]+.5*h[2]),Ke(u[0]-.5*g[0],u[1]-.5*g[1],u[2]-.5*g[2]),Ke(s[0]-.5*h[0],s[1]-.5*h[1],s[2]-.5*h[2]),Ke(u[0]+.5*g[0],u[1]+.5*g[1],u[2]+.5*g[2]))<=.0025000000000000005)continue;const te=this.vertices.length,ae=Qr(rr(),E,R);this.vertices.push({position:Mi(ae,ae,.5),height:.5*(k+L),extent:.5*(P+z)});const ue=Qr(rr(),W,J);this.vertexProps.push({dir:Os(ue,ue)}),this.edges.splice(y,1),this.edgeProps.splice(y,1),this.edges.push({a:b,b:te}),this.edges.push({a:te,b:T});const he=Cn(rr(),this.vertices[te].position,E),Ce=li(he),be={vec:he,dir:Mi(rr(),he,1/Ce),len:Ce};this.edgeProps.push(be),this.edgeProps.push(be)}}distSqLines(r,s,u,h){const g=De(Be(),s,r),y=De(Be(),h,u),b=De(Be(),r,u),T=zr(g,g),E=zr(g,y),k=zr(g,b),P=zr(y,y),R=zr(y,b),L=T*P-E*E;if(L===0)return Ft(jn(g,u,h,zr(b,y)/zr(y,y)),r);const z=(T*R-E*k)/L;return Ft(jn(g,r,s,(E*R-k*P)/L),jn(y,u,h,z))}}class Zr{static parseFrom(r,s){const u=Gr.parse(r);if(!u)return[];let{vertices:h,features:g}=u;const y=1/Ie(s);g.sort((k,P)=>k.id-P.id),h.sort((k,P)=>k.id-P.id||k.idx-P.idx),h=h.filter((k,P,R)=>P===R.findIndex(L=>L.id===k.id&&L.idx===k.idx));const b=new Array;let T=0;const E=h.length;for(const k of g){if(k.constantHeight){b.push(new ti(k.id,k.bounds,k.constantHeight));continue}for(;T!==E&&h[T].id<k.id;)T++;if(T===E||h[T].id!==k.id)continue;const P=new Array,R=new Array,L=T;for(;T!==E&&h[T].id===k.id;){const z=h[T];if(P.push({position:z.position,height:z.height,extent:z.extent}),T!==L&&h[T-1].idx===z.idx-1){const W=T-L;R.push({a:W-1,b:W})}T++}b.push(new ti(k.id,k.bounds,void 0,P,R,y))}return b}static getElevationFeature(r,s){if(!s)return;const u=+r.properties[er];return Number.isNaN(u)?void 0:s.find(h=>h.id===u)}}class Ln{constructor(r,s){this.zScale=1,this.xOffset=0,this.yOffset=0,r.equals(s)||(this.zScale=Math.pow(2,s.z-r.z),this.xOffset=(r.x*this.zScale-s.x)*Vt,this.yOffset=(r.y*this.zScale-s.y)*Vt)}constantElevation(r,s){if(r.constantHeight!=null)return this.computeBiasedHeight(r.constantHeight,s)}pointElevation(r,s,u){const h=this.constantElevation(s,u);return h??(r.x=r.x*this.zScale+this.xOffset,r.y=r.y*this.zScale+this.yOffset,this.computeBiasedHeight(s.pointElevation(r),u))}computeBiasedHeight(r,s){return s<=0?r:r+s*ye(0,s,r>=0?r:Math.abs(.5*r))}}or(ti,"ElevationFeature");class Gi{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new sa,this.indexArray=new Ui,this.segments=new Zi,this.programConfigurations=new Ml(r.layers,{zoom:r.zoom,lut:r.lut}),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Lc),this.worldview=r.worldview,this.hasAppearances=null}updateFootprints(r,s){}updateAppearances(r,s,u,h){}populate(r,s,u,h){const g=this.layers[0],y=[];let b=null;g.type==="circle"&&(b=g.layout.get("circle-sort-key"));for(const{feature:E,id:k,index:P,sourceLayerIndex:R}of r){const L=this.layers[0]._featureFilter.needGeometry,z=et(E,L);if(!this.layers[0]._featureFilter.filter(new Ai(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),z,u))continue;const W=b?b.evaluate(z,{},u):void 0,J={id:k,properties:E.properties,type:E.type,sourceLayerIndex:R,index:P,geometry:L?z.geometry:mt(E,u,h),patterns:{},sortKey:W};y.push(J)}b&&y.sort((E,k)=>E.sortKey-k.sortKey);let T=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new Fg,T=h.projection);for(const E of y){const{geometry:k,index:P,sourceLayerIndex:R}=E,L=r[P].feature;this.addFeature(E,k,P,s.availableImages,u,T,s.brightness,s.elevationFeatures),s.featureIndex.insert(L,k,P,R,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(r,s,u,h,g,y,b){this.programConfigurations.updatePaintArrays(r,s,g,u,h,y,b,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Ow.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,_E.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=r.createVertexBuffer(this.elevatedLayoutVertexArray,gE.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(r,s,u,h,g,y,b,T){let E;this.elevationMode!=="none"&&(E=Zr.getElevationFeature(r,T));for(const k of s)for(const P of k){const R=P.x,L=P.y;if(R<0||R>=Vt||L<0||L>=Vt)continue;if(y){const J=y.projectTilePoint(R,L,g),te=y.upVector(g,R,L);this.addGlobeExtVertex(J,te),this.addGlobeExtVertex(J,te),this.addGlobeExtVertex(J,te),this.addGlobeExtVertex(J,te)}const z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),W=z.vertexLength;if(this.addCircleVertex(R,L,-1,-1),this.addCircleVertex(R,L,1,-1),this.addCircleVertex(R,L,1,1),this.addCircleVertex(R,L,-1,1),this.elevationMode!=="none"){const J=E?E.pointElevation(new wt(R,L)):0;this.hasElevation=this.hasElevation||J!==0;for(let te=0;te<4;te++)this.elevatedLayoutVertexArray.emplaceBack(J)}this.indexArray.emplaceBack(W,W+1,W+2),this.indexArray.emplaceBack(W,W+2,W+3),z.vertexLength+=4,z.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,{},h,g,b,void 0,this.worldview)}addCircleVertex(r,s,u,h){this.layoutVertexArray.emplaceBack(2*r+(u+1)/2,2*s+(h+1)/2)}addGlobeExtVertex(r,s){this.globeExtVertexArray.emplaceBack(r.x,r.y,r.z,s[0]*16384,s[1]*16384,s[2]*16384)}}function ds(a,r){for(let s=0;s<a.length;s++)if(no(r,a[s]))return!0;for(let s=0;s<r.length;s++)if(no(a,r[s]))return!0;return!!Jo(a,r)}function Xi(a,r,s){return!!no(a,r)||!!So(r,a,s)}function ss(a,r){if(a.length===1)return fl(r,a[0]);for(let s=0;s<r.length;s++){const u=r[s];for(let h=0;h<u.length;h++)if(no(a,u[h]))return!0}for(let s=0;s<a.length;s++)if(fl(r,a[s]))return!0;for(let s=0;s<r.length;s++)if(Jo(a,r[s]))return!0;return!1}function aa(a,r,s){if(a.length>1){if(Jo(a,r))return!0;for(let u=0;u<r.length;u++)if(So(r[u],a,s))return!0}for(let u=0;u<a.length;u++)if(So(a[u],r,s))return!0;return!1}function Jo(a,r){if(a.length===0||r.length===0)return!1;for(let s=0;s<a.length-1;s++){const u=a[s],h=a[s+1];for(let g=0;g<r.length-1;g++)if(wo(u,h,r[g],r[g+1]))return!0}return!1}function wo(a,r,s,u){return fn(a,s,u)!==fn(r,s,u)&&fn(a,r,s)!==fn(a,r,u)}function ko(a,r,s){return(a.x-s.x)*(r.y-s.y)-(a.y-s.y)*(r.x-s.x)}function Da(a,r,s,u){const h=ko(a,r,u),g=ko(a,r,s);if(Math.sign(h)===Math.sign(g))return;const y=ko(s,u,a),b=y+g-h;return Math.sign(y)!==Math.sign(b)?[y/(y-b),g/(g-h)]:void 0}function So(a,r,s){const u=s*s;if(r.length===1)return a.distSqr(r[0])<u;for(let h=1;h<r.length;h++)if(Oa(a,r[h-1],r[h])<u)return!0;return!1}function Oa(a,r,s){const u=r.distSqr(s);if(u===0)return a.distSqr(r);const h=((a.x-r.x)*(s.x-r.x)+(a.y-r.y)*(s.y-r.y))/u;return a.distSqr(h<0?r:h>1?s:s.sub(r)._mult(h)._add(r))}function fl(a,r){let s,u,h,g=!1;for(let y=0;y<a.length;y++){s=a[y];for(let b=0,T=s.length-1;b<s.length;T=b++)u=s[b],h=s[T],u.y>r.y!=h.y>r.y&&r.x<(h.x-u.x)*(r.y-u.y)/(h.y-u.y)+u.x&&(g=!g)}return g}function no(a,r){let s=!1;for(let u=0,h=a.length-1;u<a.length;h=u++){const g=a[u],y=a[h];g.y>r.y!=y.y>r.y&&r.x<(y.x-g.x)*(r.y-g.y)/(y.y-g.y)+g.x&&(s=!s)}return s}function es(a,r,s,u,h){for(const y of a)if(r<=y.x&&s<=y.y&&u>=y.x&&h>=y.y)return!0;const g=[new wt(r,s),new wt(r,h),new wt(u,h),new wt(u,s)];if(a.length>2){for(const y of g)if(no(a,y))return!0}for(let y=0;y<a.length-1;y++)if(hs(a[y],a[y+1],g))return!0;return!1}function hs(a,r,s){const u=s[0],h=s[2];if(a.x<u.x&&r.x<u.x||a.x>h.x&&r.x>h.x||a.y<u.y&&r.y<u.y||a.y>h.y&&r.y>h.y)return!1;const g=fn(a,r,s[0]);return g!==fn(a,r,s[1])||g!==fn(a,r,s[2])||g!==fn(a,r,s[3])}function wi(a,r,s,u,h,g){let y=r.y-a.y,b=a.x-r.x;if(g=g||0){const T=y*y+b*b;if(T===0)return!0;const E=Math.sqrt(T);y/=E,b/=E}return!((s.x-a.x)*y+(s.y-a.y)*b-g<0||(u.x-a.x)*y+(u.y-a.y)*b-g<0||(h.x-a.x)*y+(h.y-a.y)*b-g<0)}function _s(a,r,s,u,h,g,y){return!(wi(a,r,u,h,g,y)||wi(r,s,u,h,g,y)||wi(s,a,u,h,g,y)||wi(u,h,a,r,s,y)||wi(h,g,a,r,s,y)||wi(g,u,a,r,s,y))}function io(a,r,s){const u=r.paint.get(a).value;return u.kind==="constant"?u.value:s.programConfigurations.get(r.id).getMaxValue(a)}function ts(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function La(a,r,s,u,h){if(!r[0]&&!r[1])return a;const g=wt.convert(r)._mult(h);s==="viewport"&&g._rotate(-u);const y=[];for(let b=0;b<a.length;b++)y.push(a[b].sub(g));return y}function zh(a,r,s,u){const h=wt.convert(a)._mult(u);return r==="viewport"&&h._rotate(-s),h}let Bc,Fh;function Bh(a,r,s){var u=2*Math.PI*6378137/256/Math.pow(2,s);return[a*u-2*Math.PI*6378137/2,r*u-2*Math.PI*6378137/2]}or(Gi,"CircleBucket",{omit:["layers"]});class za{constructor(r,s,u){this.z=r,this.x=s,this.y=u,this.key=Fa(0,r,r,s,u)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}isChildOf(r){const s=this.z-r.z;return r.z===0||r.z<this.z&&r.x===this.x>>s&&r.y===this.y>>s}url(r,s){const u=function(g,y,b){var T=Bh(256*g,256*(y=Math.pow(2,b)-y-1),b),E=Bh(256*(g+1),256*(y+1),b);return T[0]+","+T[1]+","+E[0]+","+E[1]}(this.x,this.y,this.z),h=function(g,y,b){let T,E="";for(let k=g;k>0;k--)T=1<<k-1,E+=(y&T?1:0)+(b&T?2:0);return E}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ac{constructor(r,s){this.wrap=r,this.canonical=s,this.key=Fa(r,s.z,s.z,s.x,s.y)}}class eo{constructor(r,s,u,h,g){this.overscaledZ=r,this.wrap=s,this.canonical=new za(u,+h,+g),this.key=s===0&&r===u?this.canonical.key:Fa(s,r,u,h,g)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const s=this.canonical.z-r;return r>this.canonical.z?new eo(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new eo(r,this.wrap,r,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(r,s=!0){if(this.overscaledZ===r&&s)return this.key;if(r>this.canonical.z)return Fa(this.wrap*+s,r,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-r;return Fa(this.wrap*+s,r,r,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const s=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.z<this.canonical.z&&r.canonical.x===this.canonical.x>>s&&r.canonical.y===this.canonical.y>>s}children(r){if(this.overscaledZ>=r)return[new eo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,u=2*this.canonical.x,h=2*this.canonical.y;return[new eo(s,this.wrap,s,u,h),new eo(s,this.wrap,s,u+1,h),new eo(s,this.wrap,s,u,h+1),new eo(s,this.wrap,s,u+1,h+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new eo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new eo(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ac(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Fa(a,r,s,u,h){const g=1<<Math.min(s,22);let y=g*(h%g)+u%g;return a&&s<22&&(y+=g*g*((a<0?-2*a-1:2*a)%(1<<2*(22-s)))),16*(32*y+s)+(r-s)}const Td=[a=>{let r=a.canonical.x-1,s=a.wrap;return r<0&&(r=(1<<a.canonical.z)-1,s--),new eo(a.overscaledZ,s,a.canonical.z,r,a.canonical.y)},a=>{let r=a.canonical.x+1,s=a.wrap;return r===1<<a.canonical.z&&(r=0,s++),new eo(a.overscaledZ,s,a.canonical.z,r,a.canonical.y)},a=>new eo(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,(a.canonical.y===0?1<<a.canonical.z:a.canonical.y)-1),a=>new eo(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y===(1<<a.canonical.z)-1?0:a.canonical.y+1)];or(za,"CanonicalTileID"),or(eo,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Bw=vn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Yg}=Bw,T8=vn([{name:"a_pos_3",components:3,type:"Int16"}]);var hR=vn([{name:"a_pos",type:"Int16",components:2}]);function Vw(a){return a*oa/M}const E8=[new dn([w,w,w],[S,S,S]),new dn([w,w,w],[0,0,S]),new dn([0,w,w],[S,0,S]),new dn([w,0,w],[0,S,S]),new dn([0,0,w],[S,S,S])];function fR(a,r,s,u=!0){const h=Le([],a._camera.position,a.worldSize),g=[r,s,1,1];yr(g,g,a.pixelMatrixInverse),Kt(g,g,1/g[3]);const y=xr([],bi([],g,h)),b=a.globeMatrix,T=[b[12],b[13],b[14]],E=bi([],T,h),k=qt(E),P=xr([],E),R=a.worldSize/(2*Math.PI),L=zr(P,y),z=Math.asin(R/k);if(z<Math.acos(L)){if(!u)return null;const ct=[],We=[];Le(ct,y,k/L),xr(We,bi(We,ct,E)),xr(y,Ne(y,E,Le(y,We,Math.tan(z)*k)))}const W=[];new on(h,y).closestPointOnSphere(T,R,W);const J=xr([],us(b,0)),te=xr([],us(b,1)),ae=xr([],us(b,2)),ue=zr(J,W),he=zr(te,W),Ce=zr(ae,W),be=Bo(Math.asin(-he/R));let ke=Bo(Math.atan2(ue,Ce));ke=a.center.lng+function(ct,We){const ut=(We-ct+180)%360-180;return ut<-180?ut+360:ut}(a.center.lng,ke);const Me=oe(ke),ze=se(ie(be),0,1);return new $e(Me,ze)}class C8{constructor(r,s,u){this.a=bi([],r,u),this.b=bi([],s,u),this.center=u;const h=xr([],this.a),g=xr([],this.b);this.angle=Math.acos(zr(h,g))}}function CE(a,r){if(a.angle===0)return null;let s;return s=a.a[r]===0?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[r]/a.a[r]/Math.sin(a.angle)-1/Math.tan(a.angle)),s<0||s>1?null:function(u,h,g,y){const b=Math.sin(g);return u*(Math.sin((1-y)*g)/b)+h*(Math.sin(y*g)/b)}(a.a[r],a.b[r],a.angle,se(s,0,1))+a.center[r]}function Ru(a){if(a.z<=1)return E8[a.z+2*a.y+a.x];const r=AE(Uw(a));return dn.fromPoints(r)}function Ed(a,r,s){return Le(a,a,1-s),vt(a,a,r,s)}function pR(a,r,s){for(const u of a)hn(u,u,r),Le(u,u,s)}function mR(a,r,s,u){const h=r/a.worldSize,g=a.globeMatrix;if(s.z<=1){const ze=Ru(s).getCorners();return pR(ze,g,h),dn.fromPoints(ze)}const y=Uw(s,u),b=AE(y,oa+Vw(a._tileCoverLift));pR(b,g,h);const T=Number.MAX_VALUE,E=[-T,-T,-T],k=[T,T,T];if(y.contains(a.center)){for(const We of b)Pt(k,k,We),fe(E,E,We);E[2]=0;const ze=a.point,ct=[ze.x*h,ze.y*h,0];return Pt(k,k,ct),fe(E,E,ct),new dn(k,E)}if(a._tileCoverLift>0){for(const ze of b)Pt(k,k,ze),fe(E,E,ze);return new dn(k,E)}const P=[g[12]*h,g[13]*h,g[14]*h],R=y.getCenter(),L=se(a.center.lat,-ge,ge),z=se(R.lat,-ge,ge),W=oe(a.center.lng),J=ie(L);let te=W-oe(R.lng);const ae=J-ie(z);te>.5?te-=1:te<-.5&&(te+=1);let ue=0;Math.abs(te)>Math.abs(ae)?ue=te>=0?1:3:(ue=ae>=0?0:2,vt(P,P,[g[4]*h,g[5]*h,g[6]*h],-Math.sin(gn(ae>=0?y.getSouth():y.getNorth()))*oa));const he=b[ue],Ce=b[(ue+1)%4],be=new C8(he,Ce,P),ke=[CE(be,0)||he[0],CE(be,1)||he[1],CE(be,2)||he[2]],Me=Vh(a.zoom);if(Me>0){const ze=function({x:We,y:ut,z:gt},St,Lt,kt,_t){const It=1/(1<<gt);let ot=We*It,rt=ot+It,At=ut*It,Nt=At+It,xt=0;const sr=(ot+rt)/2-kt;return sr>.5?xt=-1:sr<-.5&&(xt=1),ot=((ot+xt)*St-(kt*=St))*Lt+kt,rt=((rt+xt)*St-kt)*Lt+kt,At=(At*St-(_t*=St))*Lt+_t,Nt=(Nt*St-_t)*Lt+_t,[[ot,Nt,0],[rt,Nt,0],[rt,At,0],[ot,At,0]]}(s,r,a._pixelsPerMercatorPixel,W,J);for(let We=0;We<b.length;We++)Ed(b[We],ze[We],Me);const ct=Ne([],ze[ue],ze[(ue+1)%4]);Le(ct,ct,.5),Ed(ke,ct,Me)}for(const ze of b)Pt(k,k,ze),fe(E,E,ze);return k[2]=Math.min(he[2],Ce[2]),Pt(k,k,ke),fe(E,E,ke),new dn(k,E)}function Uw({x:a,y:r,z:s},u=!1){const h=1/(1<<s),g=new B(me(a*h),r===(1<<s)-1&&u?-90:de((r+1)*h)),y=new B(me((a+1)*h),r===0&&u?90:de(r*h));return new O(g,y)}function AE(a,r=oa){const s=gn(a.getNorth()),u=gn(a.getSouth()),h=Math.cos(s),g=Math.cos(u),y=Math.sin(s),b=Math.sin(u),T=a.getWest(),E=a.getEast();return[C(g,b,T,r),C(g,b,E,r),C(h,y,E,r),C(h,y,T,r)]}function _x(a,r,s,u){const h=1<<s.z,g=(a/Vt+s.x)/h;return j(de((r/Vt+s.y)/h),me(g),u)}function $w({min:a,max:r}){return c/Math.max(r[0]-a[0],r[1]-a[1],r[2]-a[2])}const gR=new Float64Array(16);function qw(a){const r=$w(a),s=Ze(gR,[r,r,r]);return K(s,s,vr([],a.min))}function jE(a){const r=(u=a.min,(s=gR)[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=u[0],s[13]=u[1],s[14]=u[2],s[15]=1,s);var s,u;const h=1/$w(a);return ne(r,r,[h,h,h])}function IE(a){const r=Vt/(2*Math.PI);return a/(2*Math.PI)/r}function _R(a,r){return Vt/(512*Math.pow(2,a))*$w(Ru(r))}function yR(a,r,s,u,h){const g=IE(s),y=[a,r,-s/(2*Math.PI)],b=Z(new Float64Array(16));return K(b,b,y),ne(b,b,[g,g,g]),le(b,b,gn(-h)),pe(b,b,gn(-u)),b}function Vh(a){return ye(p,n,a)}function vR(a,r){const s=j(r.lat,r.lng),u=function(z){const W=j(z._center.lat,z._center.lng);let J=Hr([],Ke(0,1,0),W);const te=Xe([],-z.angle,W);J=hn(J,J,te),Xe(te,-z._pitch,J);const ae=xr([],W);return Le(ae,ae,Vw(z.cameraToCenterDistance/z.pixelsPerMeter)),hn(ae,ae,te),Ne([],W,ae)}(a);return y=(h=De([],u,s))[0],b=h[1],T=h[2],E=(g=s)[0],k=g[1],P=g[2],L=(R=Math.sqrt((y*y+b*b+T*T)*(E*E+k*k+P*P)))&&zr(h,g)/R,Math.acos(Math.min(Math.max(L,-1),1));var h,g,y,b,T,E,k,P,R,L}function kE(a,r){return vR(a,r)>Math.PI/2*1.01}const xR=gn(85),A8=Math.cos(xR),j8=Math.sin(xR),I8=Y(),bR=a=>{const r=[];return a.paint.get("circle-pitch-alignment")==="map"&&r.push("PITCH_WITH_MAP"),a.paint.get("circle-pitch-scale")==="map"&&r.push("SCALE_WITH_MAP"),r};function wR(a,r,s,u,h,g,y,b,T){if(g&&a.queryGeometry.isAboveHorizon)return!1;g&&(T*=a.pixelToTileUnitsFactor);const E=a.tileID.canonical,k=s.projection.upVectorScale(E,s.center.lat,s.worldSize).metersToTile;for(const P of r)for(const R of P){const L=R.add(b),z=h&&s.elevation?s.elevation.exaggeration()*h.getElevationAt(L.x,L.y,!0):0,W=s.projection.projectTilePoint(L.x,L.y,E);if(z>0){const ue=s.projection.upVector(E,L.x,L.y);W.x+=ue[0]*k*z,W.y+=ue[1]*k*z,W.z+=ue[2]*k*z}const J=g?L:k8(W.x,W.y,W.z,u),te=g?a.tilespaceRays.map(ue=>R8(ue,z)):a.queryGeometry.screenGeometry,ae=yr([],[W.x,W.y,W.z,1],u);if(!y&&g?T*=ae[3]/s.cameraToCenterDistance:y&&!g&&(T*=s.cameraToCenterDistance/ae[3]),g){const ue=de((R.y/Vt+E.y)/(1<<E.z));T/=s.projection.pixelsPerMeter(ue,1)/ce(1,ue)}if(Xi(te,J,T))return!0}return!1}function k8(a,r,s,u){const h=yr([],[a,r,s,1],u);return new wt(h[0]/h[3],h[1]/h[3])}const SR=Ke(0,0,0),P8=Ke(0,0,1);function R8(a,r){const s=Be();return SR[2]=r,a.intersectsPlane(SR,P8,s),new wt(s[0],s[1])}class TR extends Gi{}let ER,CR,AR,jR;function IR(a,{width:r,height:s},u,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==r*s*u)throw new RangeError("mismatched image size")}else h=new Uint8Array(r*s*u);return a.width=r,a.height=s,a.data=h,a}function kR(a,r,s){const{width:u,height:h}=r;u===a.width&&h===a.height||(PE(a,r,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,u),height:Math.min(a.height,h)},s,null),a.width=u,a.height=h,a.data=r.data)}function PE(a,r,s,u,h,g,y,b){if(h.width===0||h.height===0)return r;if(h.width>a.width||h.height>a.height||s.x>a.width-h.width||s.y>a.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>r.width||h.height>r.height||u.x>r.width-h.width||u.y>r.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const T=a.data,E=r.data,k=g===4&&b;for(let P=0;P<h.height;P++){const R=((s.y+P)*a.width+s.x)*g,L=((u.y+P)*r.width+u.x)*g;if(k)for(let z=0;z<h.width;z++){const W=R+z*g+3,J=L+z*g;E[J+0]=255,E[J+1]=255,E[J+2]=255,E[J+3]=T[W]}else if(y)for(let z=0;z<h.width;z++){const W=R+z*g,J=L+z*g,te=new ri(T[W+0]/255,T[W+1]/255,T[W+2]/255,T[W+3]).toNonPremultipliedRenderColor(y).toArray();E[J+0]=te[0],E[J+1]=te[1],E[J+2]=te[2],E[J+3]=te[3]}else for(let z=0;z<h.width*g;z++)E[L+z]=T[R+z]}return r}or(TR,"HeatmapBucket",{omit:["layers"]});class Uh{constructor(r,s){IR(this,r,1,s)}resize(r){kR(this,new Uh(r),1)}clone(){return new Uh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,s,u,h,g){PE(r,s,u,h,g,1,null)}}class Po{constructor(r,s){IR(this,r,4,s)}resize(r){kR(this,new Po(r),4)}replace(r,s){s?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new Po({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,s,u,h,g,y,b){PE(r,s,u,h,g,4,y,b)}}class PR{constructor(r,s){this.width=r.width,this.height=r.height,this.data=s instanceof Uint8Array?new Float32Array(s.buffer):s}}function yx(a){const r={},s=a.resolution||256,u=a.clips?a.clips.length:1,h=a.image||new Po({width:s,height:u}),g=(y,b,T)=>{r[a.evaluationKey]=T;const E=a.expression.evaluate(r),k=E?E.toNonPremultipliedRenderColor(null):null;k&&(h.data[y+b+0]=Math.floor(255*k.r),h.data[y+b+1]=Math.floor(255*k.g),h.data[y+b+2]=Math.floor(255*k.b),h.data[y+b+3]=Math.floor(255*k.a))};if(a.clips)for(let y=0,b=0;y<u;++y,b+=4*s)for(let T=0,E=0;T<s;T++,E+=4){const k=T/(s-1),{start:P,end:R}=a.clips[y];g(b,E,P*(1-k)+R*k)}else for(let y=0,b=0;y<s;y++,b+=4)g(0,b,y/(s-1));return h}or(Uh,"AlphaImage"),or(Po,"RGBAImage");const M8=vn([{name:"a_pos",components:2,type:"Int16"}],4),N8=vn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),D8=vn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),O8=vn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Jg(a,r,s=2){const u=r&&r.length,h=u?r[0]*s:a.length;let g=RR(a,0,h,s,!0);const y=[];if(!g||g.next===g.prev)return y;let b,T,E;if(u&&(g=function(k,P,R,L){const z=[];for(let W=0,J=P.length;W<J;W++){const te=RR(k,P[W]*L,W<J-1?P[W+1]*L:k.length,L,!1);te===te.next&&(te.steiner=!0),z.push(q8(te))}z.sort(V8);for(let W=0;W<z.length;W++)R=U8(z[W],R);return R}(a,r,g,s)),a.length>80*s){b=a[0],T=a[1];let k=b,P=T;for(let R=s;R<h;R+=s){const L=a[R],z=a[R+1];L<b&&(b=L),z<T&&(T=z),L>k&&(k=L),z>P&&(P=z)}E=Math.max(k-b,P-T),E=E!==0?32767/E:0}return vx(g,y,s,b,T,E,0),y}function RR(a,r,s,u,h){let g;if(h===function(y,b,T,E){let k=0;for(let P=b,R=T-E;P<T;P+=E)k+=(y[R]-y[P])*(y[P+1]+y[R+1]),R=P;return k}(a,r,s,u)>0)for(let y=r;y<s;y+=u)g=OR(y/u|0,a[y],a[y+1],g);else for(let y=s-u;y>=r;y-=u)g=OR(y/u|0,a[y],a[y+1],g);return g&&Qg(g,g.next)&&(wx(g),g=g.next),g}function Hp(a,r){if(!a)return a;r||(r=a);let s,u=a;do if(s=!1,u.steiner||!Qg(u,u.next)&&so(u.prev,u,u.next)!==0)u=u.next;else{if(wx(u),u=r=u.prev,u===u.next)break;s=!0}while(s||u!==r);return r}function vx(a,r,s,u,h,g,y){if(!a)return;!y&&g&&function(T,E,k,P){let R=T;do R.z===0&&(R.z=RE(R.x,R.y,E,k,P)),R.prevZ=R.prev,R.nextZ=R.next,R=R.next;while(R!==T);R.prevZ.nextZ=null,R.prevZ=null,function(L){let z,W=1;do{let J,te=L;L=null;let ae=null;for(z=0;te;){z++;let ue=te,he=0;for(let be=0;be<W&&(he++,ue=ue.nextZ,ue);be++);let Ce=W;for(;he>0||Ce>0&&ue;)he!==0&&(Ce===0||!ue||te.z<=ue.z)?(J=te,te=te.nextZ,he--):(J=ue,ue=ue.nextZ,Ce--),ae?ae.nextZ=J:L=J,J.prevZ=ae,ae=J;te=ue}ae.nextZ=null,W*=2}while(z>1)}(R)}(a,u,h,g);let b=a;for(;a.prev!==a.next;){const T=a.prev,E=a.next;if(g?z8(a,u,h,g):L8(a))r.push(T.i,a.i,E.i),wx(a),a=E.next,b=E.next;else if((a=E)===b){y?y===1?vx(a=F8(Hp(a),r),r,s,u,h,g,2):y===2&&B8(a,r,s,u,h,g):vx(Hp(a),r,s,u,h,g,1);break}}}function L8(a){const r=a.prev,s=a,u=a.next;if(so(r,s,u)>=0)return!1;const h=r.x,g=s.x,y=u.x,b=r.y,T=s.y,E=u.y,k=Math.min(h,g,y),P=Math.min(b,T,E),R=Math.max(h,g,y),L=Math.max(b,T,E);let z=u.next;for(;z!==r;){if(z.x>=k&&z.x<=R&&z.y>=P&&z.y<=L&&xx(h,b,g,T,y,E,z.x,z.y)&&so(z.prev,z,z.next)>=0)return!1;z=z.next}return!0}function z8(a,r,s,u){const h=a.prev,g=a,y=a.next;if(so(h,g,y)>=0)return!1;const b=h.x,T=g.x,E=y.x,k=h.y,P=g.y,R=y.y,L=Math.min(b,T,E),z=Math.min(k,P,R),W=Math.max(b,T,E),J=Math.max(k,P,R),te=RE(L,z,r,s,u),ae=RE(W,J,r,s,u);let ue=a.prevZ,he=a.nextZ;for(;ue&&ue.z>=te&&he&&he.z<=ae;){if(ue.x>=L&&ue.x<=W&&ue.y>=z&&ue.y<=J&&ue!==h&&ue!==y&&xx(b,k,T,P,E,R,ue.x,ue.y)&&so(ue.prev,ue,ue.next)>=0||(ue=ue.prevZ,he.x>=L&&he.x<=W&&he.y>=z&&he.y<=J&&he!==h&&he!==y&&xx(b,k,T,P,E,R,he.x,he.y)&&so(he.prev,he,he.next)>=0))return!1;he=he.nextZ}for(;ue&&ue.z>=te;){if(ue.x>=L&&ue.x<=W&&ue.y>=z&&ue.y<=J&&ue!==h&&ue!==y&&xx(b,k,T,P,E,R,ue.x,ue.y)&&so(ue.prev,ue,ue.next)>=0)return!1;ue=ue.prevZ}for(;he&&he.z<=ae;){if(he.x>=L&&he.x<=W&&he.y>=z&&he.y<=J&&he!==h&&he!==y&&xx(b,k,T,P,E,R,he.x,he.y)&&so(he.prev,he,he.next)>=0)return!1;he=he.nextZ}return!0}function F8(a,r){let s=a;do{const u=s.prev,h=s.next.next;!Qg(u,h)&&NR(u,s,s.next,h)&&bx(u,h)&&bx(h,u)&&(r.push(u.i,s.i,h.i),wx(s),wx(s.next),s=a=h),s=s.next}while(s!==a);return Hp(s)}function B8(a,r,s,u,h,g){let y=a;do{let b=y.next.next;for(;b!==y.prev;){if(y.i!==b.i&&G8(y,b)){let T=DR(y,b);return y=Hp(y,y.next),T=Hp(T,T.next),vx(y,r,s,u,h,g,0),void vx(T,r,s,u,h,g,0)}b=b.next}y=y.next}while(y!==a)}function V8(a,r){let s=a.x-r.x;return s===0&&(s=a.y-r.y,s===0)&&(s=(a.next.y-a.y)/(a.next.x-a.x)-(r.next.y-r.y)/(r.next.x-r.x)),s}function U8(a,r){const s=function(h,g){let y=g;const b=h.x,T=h.y;let E,k=-1/0;if(Qg(h,y))return y;do{if(Qg(h,y.next))return y.next;if(T<=y.y&&T>=y.next.y&&y.next.y!==y.y){const W=y.x+(T-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(W<=b&&W>k&&(k=W,E=y.x<y.next.x?y:y.next,W===b))return E}y=y.next}while(y!==g);if(!E)return null;const P=E,R=E.x,L=E.y;let z=1/0;y=E;do{if(b>=y.x&&y.x>=R&&b!==y.x&&MR(T<L?b:k,T,R,L,T<L?k:b,T,y.x,y.y)){const W=Math.abs(T-y.y)/(b-y.x);bx(y,h)&&(W<z||W===z&&(y.x>E.x||y.x===E.x&&$8(E,y)))&&(E=y,z=W)}y=y.next}while(y!==P);return E}(a,r);if(!s)return r;const u=DR(s,a);return Hp(u,u.next),Hp(s,s.next)}function $8(a,r){return so(a.prev,a,r.prev)<0&&so(r.next,a,a.next)<0}function RE(a,r,s,u,h){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-s)*h|0)|a<<8))|a<<4))|a<<2))|a<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-u)*h|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function q8(a){let r=a,s=a;do(r.x<s.x||r.x===s.x&&r.y<s.y)&&(s=r),r=r.next;while(r!==a);return s}function MR(a,r,s,u,h,g,y,b){return(h-y)*(r-b)>=(a-y)*(g-b)&&(a-y)*(u-b)>=(s-y)*(r-b)&&(s-y)*(g-b)>=(h-y)*(u-b)}function xx(a,r,s,u,h,g,y,b){return!(a===y&&r===b)&&MR(a,r,s,u,h,g,y,b)}function G8(a,r){return a.next.i!==r.i&&a.prev.i!==r.i&&!function(s,u){let h=s;do{if(h.i!==s.i&&h.next.i!==s.i&&h.i!==u.i&&h.next.i!==u.i&&NR(h,h.next,s,u))return!0;h=h.next}while(h!==s);return!1}(a,r)&&(bx(a,r)&&bx(r,a)&&function(s,u){let h=s,g=!1;const y=(s.x+u.x)/2,b=(s.y+u.y)/2;do h.y>b!=h.next.y>b&&h.next.y!==h.y&&y<(h.next.x-h.x)*(b-h.y)/(h.next.y-h.y)+h.x&&(g=!g),h=h.next;while(h!==s);return g}(a,r)&&(so(a.prev,a,r.prev)||so(a,r.prev,r))||Qg(a,r)&&so(a.prev,a,a.next)>0&&so(r.prev,r,r.next)>0)}function so(a,r,s){return(r.y-a.y)*(s.x-r.x)-(r.x-a.x)*(s.y-r.y)}function Qg(a,r){return a.x===r.x&&a.y===r.y}function NR(a,r,s,u){const h=Hw(so(a,r,s)),g=Hw(so(a,r,u)),y=Hw(so(s,u,a)),b=Hw(so(s,u,r));return h!==g&&y!==b||!(h!==0||!Gw(a,s,r))||!(g!==0||!Gw(a,u,r))||!(y!==0||!Gw(s,a,u))||!(b!==0||!Gw(s,r,u))}function Gw(a,r,s){return r.x<=Math.max(a.x,s.x)&&r.x>=Math.min(a.x,s.x)&&r.y<=Math.max(a.y,s.y)&&r.y>=Math.min(a.y,s.y)}function Hw(a){return a>0?1:a<0?-1:0}function bx(a,r){return so(a.prev,a,a.next)<0?so(a,r,a.next)>=0&&so(a,a.prev,r)>=0:so(a,r,a.prev)<0||so(a,a.next,r)<0}function DR(a,r){const s=ME(a.i,a.x,a.y),u=ME(r.i,r.x,r.y),h=a.next,g=r.prev;return a.next=r,r.prev=a,s.next=h,h.prev=s,u.next=s,s.prev=u,g.next=u,u.prev=g,u}function OR(a,r,s,u){const h=ME(a,r,s);return u?(h.next=u.next,h.prev=u,u.next.prev=h,u.next=h):(h.prev=h,h.next=h),h}function wx(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function ME(a,r,s){return{i:a,x:r,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Sx(a,r){const s=a.length;if(s<=1)return[a];const u=[];let h,g;for(let y=0;y<s;y++){const b=yn(a[y]);b!==0&&(a[y].area=Math.abs(b),g===void 0&&(g=b<0),g===b<0?(h&&u.push(h),h=[a[y]]):h.push(a[y]))}if(h&&u.push(h),r>1)for(let y=0;y<u.length;y++)u[y].length<=r||(Mc(u[y],r,1,u[y].length-1,H8),u[y]=u[y].slice(0,r));return u}function H8(a,r){return r.area-a.area}function LR(a,r,s=1){if(!a)return null;const u=typeof a=="string"?ia.from(a).getPrimary():a.getPrimary(),h=typeof a=="string"?null:a.getSecondary();for(const g of[u,h]){if(!g)continue;const y=g.id.toString();r.has(y)||r.set(y,[]),g.scaleSelf(s),r.get(y).push(g)}return{primary:u.toString(),secondary:h?h.toString():null}}function NE(a,r,s,u){const h=u.patternDependencies;let g=!1;for(const y of r){const b=y.paint.get(`${a}-pattern`);b.isConstant()||(g=!0),LR(b.constantOr(null),h,s)&&(g=!0)}return g}function DE(a,r,s,u,h,g){const y=g.patternDependencies;for(const b of r){const T=b.paint.get(`${a}-pattern`).value;if(T.kind!=="constant"){let E=T.evaluate({zoom:u},s,{},g.availableImages);E=E&&E.name?E.name:E;const k=LR(E,y,h);if(!k)continue;const{primary:P,secondary:R}=k;P&&(s.patterns[b.id]=[P,R].filter(Boolean))}}return s}class zR{constructor(){this.polygons=new Map}add(r,...s){const u=this.polygons.get(r);u?u.push(...s):this.polygons.set(r,s)}merge(r){for(const[s,u]of r.polygons)this.add(s,...u)}}class Cd{constructor(){this.portals=[]}static isOnBorder(r,s){return r<=0&&s<=0||r>=Vt&&s>=Vt}static evaluate(r){if(r.length===0)return new Cd;let s=[];for(const T of r)s.push(...T.portals);if(s.length===0)return new Cd;for(const T of s){const E=T.va,k=T.vb;(Cd.isOnBorder(E.x,k.x)||Cd.isOnBorder(E.y,k.y))&&(T.type="border")}const u=s.filter(T=>T.type!=="unevaluated"),h=s.filter(T=>T.type==="unevaluated");if(h.length===0)return new Cd;h.sort((T,E)=>T.hash===E.hash?T.isTunnel===E.isTunnel?0:T.isTunnel?-1:1:T.hash<E.hash?1:-1),s=u.concat(h);let g=u.length,y=g,b=g;do if(y++,y===s.length||s[g].hash!==s[y].hash){if(y-g==2){b<g&&(s[b]=s[g],s[g]=null);const T=s[b],E=s[y-1];T.type=T.isTunnel!==E.isTunnel?"tunnel":"polygon",T.connection={a:T.connection.a,b:E.connection.a},b++}g=y}while(g!==s.length);return s.splice(b),s.sort((T,E)=>T.hash<E.hash?1:-1),{portals:s}}}or(Cd,"ElevationPortalGraph"),or(zR,"ElevationPolygons");class W8{constructor(r,s,u){this.outPositions=r,this.outNormals=s,this.outIndices=u,this.vertexLookup=new Map}addVertex(r,s,u){let h=r[2];u!=null&&(h*=u);const g=`${r[0]},${r[1]},${r[2]},${s[0]},${s[1]},${s[2]}`,y=this.vertexLookup.get(g);if(y!=null)return y;const b=this.outPositions.length;this.vertexLookup.set(g,b);const T=Math.trunc(16384*s[0]),E=Math.trunc(16384*s[1]),k=Math.trunc(16384*s[2]);return this.outPositions.emplaceBack(r[0],r[1],h),this.outNormals.emplaceBack(T,E,k),b}addTriangle(r,s,u){this.outIndices.emplaceBack(r,s,u)}addTriangles(r,s,u){if(r.length===0)return;const h=u.length===1,g=Be(),y=Be();for(let b=0;b<r.length;b+=3){const T=s[r[b+0]],E=s[r[b+1]],k=s[r[b+2]],P=h?u[0]:u[r[b+1]],R=h?u[0]:u[r[b+2]];st(g,T.x,T.y,h?u[0]:u[r[b+0]]);const L=this.addVertex(g,y);st(g,E.x,E.y,P);const z=this.addVertex(g,y);st(g,k.x,k.y,R);const W=this.addVertex(g,y);this.outIndices.emplaceBack(L,z,W)}}addQuad(r,s,u,h,g,y){const b=this.addVertex(r,g,y),T=this.addVertex(s,g,y),E=this.addVertex(u,g,y),k=this.addVertex(h,g,y);this.addTriangle(b,T,E),this.addTriangle(E,k,b)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class Ba{constructor(r,s,u,h){this.unevaluatedPortals=new Cd,this.portalPolygons=new zR,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Qv,this.vertexNormals=new ex,this.indexArray=new Ui,this.tileToMeters=Ie(r),this.bridgeProgramConfigurations=new Ml(s,{zoom:u,lut:h},g=>g!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new Ml(s,{zoom:u,lut:h},g=>g!=="fill-bridge-guard-rail-color")}addVertices(r,s){const u=this.unevalVertices.length;for(let h=0;h<r.length;h++)this.unevalVertices.push(r[h]),this.unevalHeights.push(s[h]);return u}addTriangles(r,s,u){const h=u?this.unevalTunnelTriangles:this.unevalTriangles;for(const g of r)h.push(g+s)}addRenderableRing(r,s,u,h,g,y){const b=[new wt(g.min.x,g.min.y),new wt(g.max.x,g.min.y),new wt(g.max.x,g.max.y),new wt(g.min.x,g.max.y)];for(let T=0;T<u-1;T++){const E=s+T,k=E+1,P=this.unevalVertices[E],R=this.unevalVertices[k];if(!(P.x>=g.min.x&&P.x<=g.max.x&&P.y>=g.min.y&&P.y<=g.max.y||R.x>=g.min.x&&R.x<=g.max.x&&R.y>=g.min.y&&R.y<=g.max.y||hs(P,R,b))||this.isOnBorder(P.x,R.x)||this.isOnBorder(P.y,R.y))continue;const L=Ba.computeEdgeHash(this.unevalVertices[E],this.unevalVertices[k]);let z,W=this.vertexHashLookup.get(Ba.computePosHash(P));W!=null?z=W.next:(W=this.vertexHashLookup.get(Ba.computePosHash(R)),z=W!=null?W.prev:L),this.unevalEdges.push({polygonIdx:r,a:E,b:k,hash:L,portalHash:z,isTunnel:h,type:"unevaluated",featureInfo:y})}}addPortalCandidates(r,s,u,h,g){if(s.length===0)return;this.portalPolygons.add(r,{geometry:s,zLevel:g});const y=s[0];this.vertexHashLookup.clear();let b=Ba.computeEdgeHash(y[y.length-2],y[y.length-1]);for(let T=0;T<y.length-1;T++){const E=y[T+0],k=y[T+1],P=yt(k.x-E.x,k.y-E.y),R=li(P);if(R===0)continue;let L="unevaluated";const z=h.pointElevation(E),W=h.pointElevation(k);Math.abs(z)<.01&&Math.abs(W)<.01?L="entrance":(this.isOnBorder(E.x,k.x)||this.isOnBorder(E.y,k.y))&&(L="border");const J=Ba.computeEdgeHash(E,k);this.unevaluatedPortals.portals.push({connection:{a:r,b:void 0},va:E,vb:k,vab:P,length:R,hash:J,isTunnel:u,type:L});const te=Ba.computePosHash(E);this.vertexHashLookup.set(te,{prev:b,next:J}),b=J}}construct(r){if(this.unevalVertices.length===0)return;const s=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),u=R=>{R.primitiveLength=this.indexArray.length-R.primitiveOffset},h=new W8(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(r.portals,this.unevalEdges);const g=s(),y=s(),b=s(),T=(R,L)=>{R.sort((W,J)=>W.type===L&&J.type!==L?-1:W.type!==L&&J.type===L?1:0);const z=R.findIndex(W=>W.type!==L);return z>=0?z:R.length};let E=0;this.unevalEdges.length>0&&(E=T(this.unevalEdges,"none"),this.constructBridgeStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:E},this.tileToMeters)),u(b);const k=s(),P=s();if(this.unevalEdges.length>0){const R=this.unevalEdges.splice(E),L=T(R,"tunnel")+E;this.unevalEdges.push(...R),this.constructTunnelStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:E},{min:E,max:L})}u(k),h.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),u(P),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),u(y),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),u(g),this.maskSegments=Zi.simpleSegment(0,P.primitiveOffset,0,P.primitiveLength),this.depthSegments=Zi.simpleSegment(0,y.primitiveOffset,0,y.primitiveLength),this.renderableBridgeSegments=Zi.simpleSegment(0,b.primitiveOffset,0,b.primitiveLength),this.renderableTunnelSegments=Zi.simpleSegment(0,k.primitiveOffset,0,k.primitiveLength),this.shadowCasterSegments=Zi.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength)}update(r,s,u,h,g,y,b,T){this.bridgeProgramConfigurations.updatePaintArrays(r,s,g,u,h,y,b,T),this.tunnelProgramConfigurations.updatePaintArrays(r,s,g,u,h,y,b,T)}upload(r){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=r.createVertexBuffer(this.vertexPositions,D8.members),this.vertexBufferNormal=r.createVertexBuffer(this.vertexNormals,O8.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(r),this.tunnelProgramConfigurations.upload(r))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(r,s,u,h,g){const y=(b,T)=>{for(let E=0;E<T.length-1;E++){const k=T[E].featureIndex,P=T[E+1].vertexStart,R=r.feature(k);b.populatePaintArrays(P,R,k,{},u,s,h,void 0,g)}};y(this.bridgeProgramConfigurations,this.bridgeFeatureSections),y(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(r,s,u,h,g){const y=new Map;for(let b=h;b<g;b++){const T=u[b],E=T.a,k=T.b,P=Ba.computePosHash(r[E]),R=Ba.computePosHash(r[k]);let L=y.get(P);L||(L={},y.set(P,L));let z=y.get(R);z||(z={},y.set(R,z)),s[E]<=0&&s[k]<=0||(L.to=k,z.from=E)}return y}isTerminalVertex(r,s){const u=Ba.computePosHash(this.unevalVertices[r]),h=s.get(u);return!h||!h.from||!h.to}constructBridgeStructures(r,s,u,h,g,y){r.clearVertexLookup();const b=this.computeVertexConnections(s,u,h,g.min,g.max),T=1/y,E=.5*T,k=(Lt,kt)=>st(Lt,s[kt].x,s[kt].y,u[kt]*T),P=Be(),R=Be(),L=Be(),z=Be(),W=Be(),J=(Lt,kt)=>{const _t=b.get(Ba.computePosHash(s[kt])),It=_t.from,ot=_t.to;if(!It||!ot)return;k(P,It),k(R,kt),k(L,ot),Vi(z),As(P,R)||(bi(W,R,P),xr(z,W)),As(L,R)||(bi(W,L,R),Ne(z,z,xr(W,W)));const rt=nt(z);return rt>0?Le(Lt,z,1/rt):void 0};let te=Number.POSITIVE_INFINITY;this.sortSubarray(h,g.min,g.max,(Lt,kt)=>Lt.featureInfo.featureIndex-kt.featureInfo.featureIndex);const ae=Be(),ue=Be(),he=Be(),Ce=Be(),be=Be(),ke=Be(),Me=Be(),ze=Be(),ct=Be(),We=[Be(),Be(),Be(),Be()],ut=[Be(),Be(),Be(),Be()],gt=[{coord:new wt(0,0),height:0},{coord:new wt(0,0),height:0}],St=(Lt,kt)=>Lt>kt;for(let Lt=g.min;Lt<g.max;Lt++){const kt=h[Lt];if(!kt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(gt,s,u,kt,St))continue;const[_t,It]=gt;if(st(ae,_t.coord.x,_t.coord.y,T*_t.height),st(ue,It.coord.x,It.coord.y,T*It.height),As(ae,ue))continue;bi(he,ue,ae),xr(he,he);const ot=J(ze,kt.a)||he,rt=J(ct,kt.b)||he;st(Ce,ot[1],-ot[0],0),xr(Ce,Ce),st(be,rt[1],-rt[0],0),xr(be,be),Hr(ze,Ce,ot),xr(ke,ze),Hr(ze,be,rt),xr(Me,ze),Ne(We[0],ae,Le(ze,bi(ze,Ce,ke),E)),Ne(We[1],ae,Le(ze,Ne(ze,Ce,ke),E)),Ne(We[2],ae,Le(ze,ke,E)),We[3]=ae,Ne(ut[0],ue,Le(ze,bi(ze,be,Me),E)),Ne(ut[1],ue,Le(ze,Ne(ze,be,Me),E)),Ne(ut[2],ue,Le(ze,Me,E)),ut[3]=ue,te=this.addFeatureSection(kt.featureInfo.featureIndex,te,this.bridgeFeatureSections,r);const At=r.addVertex(We[0],Ce,y),Nt=r.addVertex(We[1],Ce,y),xt=r.addVertex(ut[0],be,y),sr=r.addVertex(ut[1],be,y);r.addTriangle(At,Nt,xt),r.addTriangle(Nt,sr,xt);const cr=r.addVertex(We[1],ke,y),tr=r.addVertex(We[2],ke,y),Zt=r.addVertex(ut[1],Me,y),Xr=r.addVertex(ut[2],Me,y);r.addTriangle(cr,tr,Zt),r.addTriangle(tr,Xr,Zt),vr(Ce,Ce),vr(be,be);const Jt=r.addVertex(We[2],Ce,y),Tr=r.addVertex(We[3],Ce,y),Jr=r.addVertex(ut[2],be,y),pn=r.addVertex(ut[3],be,y);r.addTriangle(Jt,Tr,Jr),r.addTriangle(Tr,pn,Jr);const zn=this.isTerminalVertex(kt.a,b),rn=this.isTerminalVertex(kt.b,b);_t.height<.01&&zn&&r.addQuad(We[3],We[2],We[1],We[0],vr(ot,ot),y),It.height<.01&&rn&&r.addQuad(ut[0],ut[1],ut[2],ut[3],rt,y)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:r.getVertexCount()})}constructTunnelStructures(r,s,u,h,g,y){r.clearVertexLookup();let b=Number.POSITIVE_INFINITY;const T=(te,ae)=>te.featureInfo.featureIndex-ae.featureInfo.featureIndex;this.sortSubarray(h,g.min,g.max,T),this.sortSubarray(h,y.min,y.max,T);const E=te=>xr(te,te),k=[{coord:new wt(0,0),height:0},{coord:new wt(0,0),height:0}],P=(te,ae)=>te<ae,R=Be(),L=Be(),z=Be(),W=Be(),J=Be();for(let te=g.min;te<g.max;te++){if(!this.prepareEdgePoints(k,s,u,h[te],P))continue;const[ae,ue]=k,he=E(st(J,-(ue.coord.y-ae.coord.y),ue.coord.x-ae.coord.x,0));b=this.addFeatureSection(h[te].featureInfo.featureIndex,b,this.tunnelFeatureSections,r),r.addQuad(st(R,ae.coord.x,ae.coord.y,ae.height),st(L,ue.coord.x,ue.coord.y,ue.height),st(z,ue.coord.x,ue.coord.y,h[te].isTunnel?-.1:0),st(W,ae.coord.x,ae.coord.y,h[te].isTunnel?-.1:0),he)}for(let te=y.min;te<y.max;te++){const ae=h[te];ae.isTunnel&&([ae.a,ae.b]=[ae.b,ae.a]);const ue=s[ae.a],he=s[ae.b],Ce=E(st(J,-(he.y-ue.y),he.x-ue.x,0));b=this.addFeatureSection(ae.featureInfo.featureIndex,b,this.tunnelFeatureSections,r),r.addQuad(st(R,he.x,he.y,0),st(L,ue.x,ue.y,0),st(z,ue.x,ue.y,u[ae.a]+4),st(W,he.x,he.y,u[ae.b]+4),Ce),r.addQuad(st(R,ue.x,ue.y,0),st(L,he.x,he.y,0),st(z,he.x,he.y,u[ae.b]+4),st(W,ue.x,ue.y,u[ae.a]+4),Ce)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:r.getVertexCount()})}setElevatedPoint(r,s,u,h){r.coord.x=s,r.coord.y=u,r.height=h}prepareEdgePoints(r,s,u,h,g){let y=s[h.a].x,b=s[h.a].y,T=s[h.b].x,E=s[h.b].y,k=u[h.a],P=u[h.b];const R=g(k,0),L=g(P,0);if(R&&L)return this.setElevatedPoint(r[0],y,b,k),this.setElevatedPoint(r[1],T,E,P),!0;if(!R&&!L)return!1;if(R){if(!L){const z=P/(P-k);T=Br(T,y,z),E=Br(E,b,z),P=Br(P,k,z)}}else{const z=k/(k-P);y=Br(y,T,z),b=Br(b,E,z),k=Br(k,P,z)}return this.setElevatedPoint(r[0],y,b,k),this.setElevatedPoint(r[1],T,E,P),!0}prepareEdges(r,s){if(s.length===0)return;s.sort((b,T)=>b.hash===T.hash?T.polygonIdx-b.polygonIdx:T.hash>b.hash?1:-1);let u=0,h=0,g=0,y=s[u].polygonIdx;do h++,(h===s.length||s[u].hash!==s[h].hash)&&((h-u==1||s[h-1].polygonIdx!==y)&&(g<u&&(s[g]=s[u],s[u]=null),s[g].type="none",g++),u=h,u!==s.length&&(y=s[u].polygonIdx));while(u!==s.length);if(s.splice(g),s.length!==0&&r.length!==0){s.sort((E,k)=>E.portalHash<k.portalHash?1:-1);let b=0,T=0;for(;b!==s.length&&T!==r.length;){const E=s[b],k=r[T];E.portalHash>k.hash?b++:k.hash>E.portalHash?T++:(E.type=k.type,b++)}}}isOnBorder(r,s){return r<=0&&s<=0||r>=Vt&&s>=Vt}addFeatureSection(r,s,u,h){return r!==s&&(s=r,u.push({featureIndex:r,vertexStart:h.getVertexCount()}),h.clearVertexLookup()),s}sortSubarray(r,s,u,h){const g=r.slice(s,u);g.sort(h),r.splice(s,g.length,...g)}static computeEdgeHash(r,s){return(r.y===s.y&&r.x>s.x||r.y>s.y)&&([r,s]=[s,r]),BigInt(Ba.computePosHash(r))<<32n|BigInt(Ba.computePosHash(s))}static computePosHash(r){return((65535&r.x)<<16|65535&r.y)>>>0}}var FR,BR={exports:{}},VR=(FR||(FR=1,function(a,r){(function(s){function u(we,_e){return we>_e?1:we<_e?-1:0}var h=function(we,_e){we===void 0&&(we=u),_e===void 0&&(_e=!1),this._compare=we,this._root=null,this._size=0,this._noDuplicates=!!_e},g={size:{configurable:!0}};function y(we,_e,ht,Ht,ft){var Xt=ft-Ht;if(Xt>0){var mr=Ht+Math.floor(Xt/2),fr={key:_e[mr],data:ht[mr],parent:we};return fr.left=y(fr,_e,ht,Ht,mr),fr.right=y(fr,_e,ht,mr+1,ft),fr}return null}function b(we,_e,ht,Ht,ft){if(!(ht>=Ht)){for(var Xt=we[ht+Ht>>1],mr=ht-1,fr=Ht+1;;){do mr++;while(ft(we[mr],Xt)<0);do fr--;while(ft(we[fr],Xt)>0);if(mr>=fr)break;var nn=we[mr];we[mr]=we[fr],we[fr]=nn,nn=_e[mr],_e[mr]=_e[fr],_e[fr]=nn}b(we,_e,ht,fr,ft),b(we,_e,fr+1,Ht,ft)}}h.prototype.rotateLeft=function(we){var _e=we.right;_e&&(we.right=_e.left,_e.left&&(_e.left.parent=we),_e.parent=we.parent),we.parent?we===we.parent.left?we.parent.left=_e:we.parent.right=_e:this._root=_e,_e&&(_e.left=we),we.parent=_e},h.prototype.rotateRight=function(we){var _e=we.left;_e&&(we.left=_e.right,_e.right&&(_e.right.parent=we),_e.parent=we.parent),we.parent?we===we.parent.left?we.parent.left=_e:we.parent.right=_e:this._root=_e,_e&&(_e.right=we),we.parent=_e},h.prototype._splay=function(we){for(;we.parent;){var _e=we.parent;_e.parent?_e.left===we&&_e.parent.left===_e?(this.rotateRight(_e.parent),this.rotateRight(_e)):_e.right===we&&_e.parent.right===_e?(this.rotateLeft(_e.parent),this.rotateLeft(_e)):_e.left===we&&_e.parent.right===_e?(this.rotateRight(_e),this.rotateLeft(_e)):(this.rotateLeft(_e),this.rotateRight(_e)):_e.left===we?this.rotateRight(_e):this.rotateLeft(_e)}},h.prototype.splay=function(we){for(var _e,ht,Ht,ft,Xt;we.parent;)(ht=(_e=we.parent).parent)&&ht.parent?((Ht=ht.parent).left===ht?Ht.left=we:Ht.right=we,we.parent=Ht):(we.parent=null,this._root=we),ft=we.left,Xt=we.right,we===_e.left?(ht&&(ht.left===_e?(_e.right?(ht.left=_e.right,ht.left.parent=ht):ht.left=null,_e.right=ht,ht.parent=_e):(ft?(ht.right=ft,ft.parent=ht):ht.right=null,we.left=ht,ht.parent=we)),Xt?(_e.left=Xt,Xt.parent=_e):_e.left=null,we.right=_e,_e.parent=we):(ht&&(ht.right===_e?(_e.left?(ht.right=_e.left,ht.right.parent=ht):ht.right=null,_e.left=ht,ht.parent=_e):(Xt?(ht.left=Xt,Xt.parent=ht):ht.left=null,we.right=ht,ht.parent=we)),ft?(_e.right=ft,ft.parent=_e):_e.right=null,we.left=_e,_e.parent=we)},h.prototype.replace=function(we,_e){we.parent?we===we.parent.left?we.parent.left=_e:we.parent.right=_e:this._root=_e,_e&&(_e.parent=we.parent)},h.prototype.minNode=function(we){if(we===void 0&&(we=this._root),we)for(;we.left;)we=we.left;return we},h.prototype.maxNode=function(we){if(we===void 0&&(we=this._root),we)for(;we.right;)we=we.right;return we},h.prototype.insert=function(we,_e){var ht=this._root,Ht=null,ft=this._compare;if(this._noDuplicates)for(;ht;){if(Ht=ht,ft(ht.key,we)===0)return;ht=ft(ht.key,we)<0?ht.right:ht.left}else for(;ht;)Ht=ht,ht=ft(ht.key,we)<0?ht.right:ht.left;return ht={key:we,data:_e,left:null,right:null,parent:Ht},Ht?ft(Ht.key,ht.key)<0?Ht.right=ht:Ht.left=ht:this._root=ht,this.splay(ht),this._size++,ht},h.prototype.find=function(we){for(var _e=this._root,ht=this._compare;_e;){var Ht=ht(_e.key,we);if(Ht<0)_e=_e.right;else{if(!(Ht>0))return _e;_e=_e.left}}return null},h.prototype.contains=function(we){for(var _e=this._root,ht=this._compare;_e;){var Ht=ht(we,_e.key);if(Ht===0)return!0;_e=Ht<0?_e.left:_e.right}return!1},h.prototype.remove=function(we){var _e=this.find(we);if(!_e)return!1;if(this.splay(_e),_e.left)if(_e.right){var ht=this.minNode(_e.right);ht.parent!==_e&&(this.replace(ht,ht.right),ht.right=_e.right,ht.right.parent=ht),this.replace(_e,ht),ht.left=_e.left,ht.left.parent=ht}else this.replace(_e,_e.left);else this.replace(_e,_e.right);return this._size--,!0},h.prototype.removeNode=function(we){if(!we)return!1;if(this.splay(we),we.left)if(we.right){var _e=this.minNode(we.right);_e.parent!==we&&(this.replace(_e,_e.right),_e.right=we.right,_e.right.parent=_e),this.replace(we,_e),_e.left=we.left,_e.left.parent=_e}else this.replace(we,we.left);else this.replace(we,we.right);return this._size--,!0},h.prototype.erase=function(we){var _e=this.find(we);if(_e){this.splay(_e);var ht=_e.left,Ht=_e.right,ft=null;ht&&(ht.parent=null,ft=this.maxNode(ht),this.splay(ft),this._root=ft),Ht&&(ht?ft.right=Ht:this._root=Ht,Ht.parent=ft),this._size--}},h.prototype.pop=function(){var we=this._root,_e=null;if(we){for(;we.left;)we=we.left;_e={key:we.key,data:we.data},this.remove(we.key)}return _e},h.prototype.next=function(we){var _e=we;if(_e)if(_e.right)for(_e=_e.right;_e&&_e.left;)_e=_e.left;else for(_e=we.parent;_e&&_e.right===we;)we=_e,_e=_e.parent;return _e},h.prototype.prev=function(we){var _e=we;if(_e)if(_e.left)for(_e=_e.left;_e&&_e.right;)_e=_e.right;else for(_e=we.parent;_e&&_e.left===we;)we=_e,_e=_e.parent;return _e},h.prototype.forEach=function(we){for(var _e=this._root,ht=[],Ht=!1,ft=0;!Ht;)_e?(ht.push(_e),_e=_e.left):ht.length>0?(we(_e=ht.pop(),ft++),_e=_e.right):Ht=!0;return this},h.prototype.range=function(we,_e,ht,Ht){for(var ft=[],Xt=this._compare,mr=this._root;ft.length!==0||mr;)if(mr)ft.push(mr),mr=mr.left;else{if(Xt((mr=ft.pop()).key,_e)>0)break;if(Xt(mr.key,we)>=0&&ht.call(Ht,mr))return this;mr=mr.right}return this},h.prototype.keys=function(){for(var we=this._root,_e=[],ht=[],Ht=!1;!Ht;)we?(_e.push(we),we=we.left):_e.length>0?(we=_e.pop(),ht.push(we.key),we=we.right):Ht=!0;return ht},h.prototype.values=function(){for(var we=this._root,_e=[],ht=[],Ht=!1;!Ht;)we?(_e.push(we),we=we.left):_e.length>0?(we=_e.pop(),ht.push(we.data),we=we.right):Ht=!0;return ht},h.prototype.at=function(we){for(var _e=this._root,ht=[],Ht=!1,ft=0;!Ht;)if(_e)ht.push(_e),_e=_e.left;else if(ht.length>0){if(_e=ht.pop(),ft===we)return _e;ft++,_e=_e.right}else Ht=!0;return null},h.prototype.load=function(we,_e,ht){if(we===void 0&&(we=[]),_e===void 0&&(_e=[]),ht===void 0&&(ht=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Ht=we.length;return ht&&b(we,_e,0,Ht-1,this._compare),this._root=y(null,we,_e,0,Ht),this._size=Ht,this},h.prototype.min=function(){var we=this.minNode(this._root);return we?we.key:null},h.prototype.max=function(){var we=this.maxNode(this._root);return we?we.key:null},h.prototype.isEmpty=function(){return this._root===null},g.size.get=function(){return this._size},h.createTree=function(we,_e,ht,Ht,ft){return new h(ht,ft).load(we,_e,Ht)},Object.defineProperties(h.prototype,g);var T=0,E=1,k=2,P=3,R=0,L=1,z=2,W=3;function J(we,_e,ht){_e===null?(we.inOut=!1,we.otherInOut=!0):(we.isSubject===_e.isSubject?(we.inOut=!_e.inOut,we.otherInOut=_e.otherInOut):(we.inOut=!_e.otherInOut,we.otherInOut=_e.isVertical()?!_e.inOut:_e.inOut),_e&&(we.prevInResult=!te(_e,ht)||_e.isVertical()?_e.prevInResult:_e));var Ht=te(we,ht);we.resultTransition=Ht?function(ft,Xt){var mr,fr=!ft.inOut,nn=!ft.otherInOut;switch(Xt){case R:mr=fr&&nn;break;case L:mr=fr||nn;break;case W:mr=fr^nn;break;case z:mr=ft.isSubject?fr&&!nn:nn&&!fr}return mr?1:-1}(we,ht):0}function te(we,_e){switch(we.type){case T:switch(_e){case R:return!we.otherInOut;case L:return we.otherInOut;case z:return we.isSubject&&we.otherInOut||!we.isSubject&&!we.otherInOut;case W:return!0}break;case k:return _e===R||_e===L;case P:return _e===z;case E:return!1}return!1}var ae=function(we,_e,ht,Ht,ft){this.left=_e,this.point=we,this.otherEvent=ht,this.isSubject=Ht,this.type=ft||T,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},ue={inResult:{configurable:!0}};function he(we,_e){return we[0]===_e[0]&&we[1]===_e[1]}ae.prototype.isBelow=function(we){var _e=this.point,ht=this.otherEvent.point;return this.left?(_e[0]-we[0])*(ht[1]-we[1])-(ht[0]-we[0])*(_e[1]-we[1])>0:(ht[0]-we[0])*(_e[1]-we[1])-(_e[0]-we[0])*(ht[1]-we[1])>0},ae.prototype.isAbove=function(we){return!this.isBelow(we)},ae.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},ue.inResult.get=function(){return this.resultTransition!==0},ae.prototype.clone=function(){var we=new ae(this.point,this.left,this.otherEvent,this.isSubject,this.type);return we.contourId=this.contourId,we.resultTransition=this.resultTransition,we.prevInResult=this.prevInResult,we.isExteriorRing=this.isExteriorRing,we.inOut=this.inOut,we.otherInOut=this.otherInOut,we},Object.defineProperties(ae.prototype,ue);var Ce=11102230246251565e-32,be=134217729,ke=(3+8*Ce)*Ce;function Me(we,_e,ht,Ht,ft){var Xt,mr,fr,nn,Mr=_e[0],dr=Ht[0],qn=0,gi=0;dr>Mr==dr>-Mr?(Xt=Mr,Mr=_e[++qn]):(Xt=dr,dr=Ht[++gi]);var Dr=0;if(qn<we&&gi<ht)for(dr>Mr==dr>-Mr?(fr=Xt-((mr=Mr+Xt)-Mr),Mr=_e[++qn]):(fr=Xt-((mr=dr+Xt)-dr),dr=Ht[++gi]),Xt=mr,fr!==0&&(ft[Dr++]=fr);qn<we&&gi<ht;)dr>Mr==dr>-Mr?(fr=Xt-((mr=Xt+Mr)-(nn=mr-Xt))+(Mr-nn),Mr=_e[++qn]):(fr=Xt-((mr=Xt+dr)-(nn=mr-Xt))+(dr-nn),dr=Ht[++gi]),Xt=mr,fr!==0&&(ft[Dr++]=fr);for(;qn<we;)fr=Xt-((mr=Xt+Mr)-(nn=mr-Xt))+(Mr-nn),Mr=_e[++qn],Xt=mr,fr!==0&&(ft[Dr++]=fr);for(;gi<ht;)fr=Xt-((mr=Xt+dr)-(nn=mr-Xt))+(dr-nn),dr=Ht[++gi],Xt=mr,fr!==0&&(ft[Dr++]=fr);return Xt===0&&Dr!==0||(ft[Dr++]=Xt),Dr}function ze(we){return new Float64Array(we)}var ct=33306690738754716e-32,We=22204460492503146e-32,ut=11093356479670487e-47,gt=ze(4),St=ze(8),Lt=ze(12),kt=ze(16),_t=ze(4);function It(we,_e,ht){var Ht=function(ft,Xt,mr,fr,nn,Mr){var dr=(Xt-Mr)*(mr-nn),qn=(ft-nn)*(fr-Mr),gi=dr-qn;if(dr===0||qn===0||dr>0!=qn>0)return gi;var Dr=Math.abs(dr+qn);return Math.abs(gi)>=ct*Dr?gi:-function(Dn,_i,ni,rs,Li,Ti,ui){var Zn,sn,Xn,Ei,Nr,Fn,zi,ls,ys,zs,Fi,Ps,ya,Rs,Ua,Ro,Dl,va,$a=Dn-Li,Mo=ni-Li,qa=_i-Ti,Ol=rs-Ti;gt[0]=(Ua=(ls=$a-(zi=(Fn=be*$a)-(Fn-$a)))*(zs=Ol-(ys=(Fn=be*Ol)-(Fn-Ol)))-((Rs=$a*Ol)-zi*ys-ls*ys-zi*zs))-((Fi=Ua-(Dl=(ls=qa-(zi=(Fn=be*qa)-(Fn-qa)))*(zs=Mo-(ys=(Fn=be*Mo)-(Fn-Mo)))-((Ro=qa*Mo)-zi*ys-ls*ys-zi*zs)))+(Nr=Ua-Fi))+(Nr-Dl),gt[1]=(ya=Rs-((Ps=Rs+Fi)-(Nr=Ps-Rs))+(Fi-Nr))-((Fi=ya-Ro)+(Nr=ya-Fi))+(Nr-Ro),gt[2]=Ps-((va=Ps+Fi)-(Nr=va-Ps))+(Fi-Nr),gt[3]=va;var _o=function(Zh,Ou){for(var D1=Ou[0],y_=1;y_<4;y_++)D1+=Ou[y_];return D1}(0,gt),Qo=We*ui;if(_o>=Qo||-_o>=Qo||(Zn=Dn-($a+(Nr=Dn-$a))+(Nr-Li),Xn=ni-(Mo+(Nr=ni-Mo))+(Nr-Li),sn=_i-(qa+(Nr=_i-qa))+(Nr-Ti),Ei=rs-(Ol+(Nr=rs-Ol))+(Nr-Ti),Zn===0&&sn===0&&Xn===0&&Ei===0)||(Qo=ut*ui+ke*Math.abs(_o),(_o+=$a*Ei+Ol*Zn-(qa*Xn+Mo*sn))>=Qo||-_o>=Qo))return _o;_t[0]=(Ua=(ls=Zn-(zi=(Fn=be*Zn)-(Fn-Zn)))*(zs=Ol-(ys=(Fn=be*Ol)-(Fn-Ol)))-((Rs=Zn*Ol)-zi*ys-ls*ys-zi*zs))-((Fi=Ua-(Dl=(ls=sn-(zi=(Fn=be*sn)-(Fn-sn)))*(zs=Mo-(ys=(Fn=be*Mo)-(Fn-Mo)))-((Ro=sn*Mo)-zi*ys-ls*ys-zi*zs)))+(Nr=Ua-Fi))+(Nr-Dl),_t[1]=(ya=Rs-((Ps=Rs+Fi)-(Nr=Ps-Rs))+(Fi-Nr))-((Fi=ya-Ro)+(Nr=ya-Fi))+(Nr-Ro),_t[2]=Ps-((va=Ps+Fi)-(Nr=va-Ps))+(Fi-Nr),_t[3]=va;var Du=Me(4,gt,4,_t,St);_t[0]=(Ua=(ls=$a-(zi=(Fn=be*$a)-(Fn-$a)))*(zs=Ei-(ys=(Fn=be*Ei)-(Fn-Ei)))-((Rs=$a*Ei)-zi*ys-ls*ys-zi*zs))-((Fi=Ua-(Dl=(ls=qa-(zi=(Fn=be*qa)-(Fn-qa)))*(zs=Xn-(ys=(Fn=be*Xn)-(Fn-Xn)))-((Ro=qa*Xn)-zi*ys-ls*ys-zi*zs)))+(Nr=Ua-Fi))+(Nr-Dl),_t[1]=(ya=Rs-((Ps=Rs+Fi)-(Nr=Ps-Rs))+(Fi-Nr))-((Fi=ya-Ro)+(Nr=ya-Fi))+(Nr-Ro),_t[2]=Ps-((va=Ps+Fi)-(Nr=va-Ps))+(Fi-Nr),_t[3]=va;var Wh=Me(Du,St,4,_t,Lt);_t[0]=(Ua=(ls=Zn-(zi=(Fn=be*Zn)-(Fn-Zn)))*(zs=Ei-(ys=(Fn=be*Ei)-(Fn-Ei)))-((Rs=Zn*Ei)-zi*ys-ls*ys-zi*zs))-((Fi=Ua-(Dl=(ls=sn-(zi=(Fn=be*sn)-(Fn-sn)))*(zs=Xn-(ys=(Fn=be*Xn)-(Fn-Xn)))-((Ro=sn*Xn)-zi*ys-ls*ys-zi*zs)))+(Nr=Ua-Fi))+(Nr-Dl),_t[1]=(ya=Rs-((Ps=Rs+Fi)-(Nr=Ps-Rs))+(Fi-Nr))-((Fi=ya-Ro)+(Nr=ya-Fi))+(Nr-Ro),_t[2]=Ps-((va=Ps+Fi)-(Nr=va-Ps))+(Fi-Nr),_t[3]=va;var __=Me(Wh,Lt,4,_t,kt);return kt[__-1]}(ft,Xt,mr,fr,nn,Mr,Dr)}(we[0],we[1],_e[0],_e[1],ht[0],ht[1]);return Ht>0?-1:Ht<0?1:0}function ot(we,_e){var ht=we.point,Ht=_e.point;return ht[0]>Ht[0]?1:ht[0]<Ht[0]?-1:ht[1]!==Ht[1]?ht[1]>Ht[1]?1:-1:function(ft,Xt,mr,fr){return ft.left!==Xt.left?ft.left?1:-1:It(mr,ft.otherEvent.point,Xt.otherEvent.point)!==0?ft.isBelow(Xt.otherEvent.point)?-1:1:!ft.isSubject&&Xt.isSubject?1:-1}(we,_e,ht)}function rt(we,_e,ht){var Ht=new ae(_e,!1,we,we.isSubject),ft=new ae(_e,!0,we.otherEvent,we.isSubject);return he(we.point,we.otherEvent.point)&&console.warn("what is that, a collapsed segment?",we),Ht.contourId=ft.contourId=we.contourId,ot(ft,we.otherEvent)>0&&(we.otherEvent.left=!0,ft.left=!1),we.otherEvent.otherEvent=ft,we.otherEvent=Ht,ht.push(ft),ht.push(Ht),ht}function At(we,_e){return we[0]*_e[1]-we[1]*_e[0]}function Nt(we,_e){return we[0]*_e[0]+we[1]*_e[1]}function xt(we,_e,ht){var Ht=function(nn,Mr,dr,qn,gi){var Dr=[Mr[0]-nn[0],Mr[1]-nn[1]],Dn=[qn[0]-dr[0],qn[1]-dr[1]];function _i(Fn,zi,ls){return[Fn[0]+zi*ls[0],Fn[1]+zi*ls[1]]}var ni=[dr[0]-nn[0],dr[1]-nn[1]],rs=At(Dr,Dn),Li=rs*rs,Ti=Nt(Dr,Dr);if(Li>0){var ui=At(ni,Dn)/rs;if(ui<0||ui>1)return null;var Zn=At(ni,Dr)/rs;return Zn<0||Zn>1?null:ui===0||ui===1?[_i(nn,ui,Dr)]:Zn===0||Zn===1?[_i(dr,Zn,Dn)]:[_i(nn,ui,Dr)]}if((Li=(rs=At(ni,Dr))*rs)>0)return null;var sn=Nt(Dr,ni)/Ti,Xn=sn+Nt(Dr,Dn)/Ti,Ei=Math.min(sn,Xn),Nr=Math.max(sn,Xn);return Ei<=1&&Nr>=0?Ei===1?[_i(nn,Ei>0?Ei:0,Dr)]:Nr===0?[_i(nn,Nr<1?Nr:1,Dr)]:[_i(nn,Ei>0?Ei:0,Dr),_i(nn,Nr<1?Nr:1,Dr)]:null}(we.point,we.otherEvent.point,_e.point,_e.otherEvent.point),ft=Ht?Ht.length:0;if(ft===0||ft===1&&(he(we.point,_e.point)||he(we.otherEvent.point,_e.otherEvent.point))||ft===2&&we.isSubject===_e.isSubject)return 0;if(ft===1)return he(we.point,Ht[0])||he(we.otherEvent.point,Ht[0])||rt(we,Ht[0],ht),he(_e.point,Ht[0])||he(_e.otherEvent.point,Ht[0])||rt(_e,Ht[0],ht),1;var Xt=[],mr=!1,fr=!1;return he(we.point,_e.point)?mr=!0:ot(we,_e)===1?Xt.push(_e,we):Xt.push(we,_e),he(we.otherEvent.point,_e.otherEvent.point)?fr=!0:ot(we.otherEvent,_e.otherEvent)===1?Xt.push(_e.otherEvent,we.otherEvent):Xt.push(we.otherEvent,_e.otherEvent),mr&&fr||mr?(_e.type=E,we.type=_e.inOut===we.inOut?k:P,mr&&!fr&&rt(Xt[1].otherEvent,Xt[0].point,ht),2):fr?(rt(Xt[0],Xt[1].point,ht),3):Xt[0]!==Xt[3].otherEvent?(rt(Xt[0],Xt[1].point,ht),rt(Xt[1],Xt[2].point,ht),3):(rt(Xt[0],Xt[1].point,ht),rt(Xt[3].otherEvent,Xt[2].point,ht),3)}function sr(we,_e){if(we===_e)return 0;if(It(we.point,we.otherEvent.point,_e.point)!==0||It(we.point,we.otherEvent.point,_e.otherEvent.point)!==0)return he(we.point,_e.point)?we.isBelow(_e.otherEvent.point)?-1:1:we.point[0]===_e.point[0]?we.point[1]<_e.point[1]?-1:1:ot(we,_e)===1?_e.isAbove(we.point)?-1:1:we.isBelow(_e.point)?-1:1;if(we.isSubject!==_e.isSubject)return we.isSubject?-1:1;var ht=we.point,Ht=_e.point;return ht[0]===Ht[0]&&ht[1]===Ht[1]?(ht=we.otherEvent.point)[0]===(Ht=_e.otherEvent.point)[0]&&ht[1]===Ht[1]?0:we.contourId>_e.contourId?1:-1:ot(we,_e)===1?1:-1}var cr=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function tr(we,_e,ht,Ht){var ft,Xt=we+1,mr=_e[we].point,fr=_e.length;for(Xt<fr&&(ft=_e[Xt].point);Xt<fr&&ft[0]===mr[0]&&ft[1]===mr[1];){if(!ht[Xt])return Xt;++Xt<fr&&(ft=_e[Xt].point)}for(Xt=we-1;ht[Xt]&&Xt>Ht;)Xt--;return Xt}cr.prototype.isExterior=function(){return this.holeOf==null};var Zt=Jt,Xr=Jt;function Jt(we,_e){if(!(this instanceof Jt))return new Jt(we,_e);if(this.data=we||[],this.length=this.data.length,this.compare=_e||Tr,this.length>0)for(var ht=(this.length>>1)-1;ht>=0;ht--)this._down(ht)}function Tr(we,_e){return we<_e?-1:we>_e?1:0}Jt.prototype={push:function(we){this.data.push(we),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var we=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),we}},peek:function(){return this.data[0]},_up:function(we){for(var _e=this.data,ht=this.compare,Ht=_e[we];we>0;){var ft=we-1>>1,Xt=_e[ft];if(ht(Ht,Xt)>=0)break;_e[we]=Xt,we=ft}_e[we]=Ht},_down:function(we){for(var _e=this.data,ht=this.compare,Ht=this.length>>1,ft=_e[we];we<Ht;){var Xt=1+(we<<1),mr=Xt+1,fr=_e[Xt];if(mr<this.length&&ht(_e[mr],fr)<0&&(Xt=mr,fr=_e[mr]),ht(fr,ft)>=0)break;_e[we]=fr,we=Xt}_e[we]=ft}},Zt.default=Xr;var Jr=Math.max,pn=Math.min,zn=0;function rn(we,_e,ht,Ht,ft,Xt){var mr,fr,nn,Mr,dr,qn;for(mr=0,fr=we.length-1;mr<fr;mr++)if(Mr=we[mr+1],dr=new ae(nn=we[mr],!1,void 0,_e),qn=new ae(Mr,!1,dr,_e),dr.otherEvent=qn,nn[0]!==Mr[0]||nn[1]!==Mr[1]){dr.contourId=qn.contourId=ht,Xt||(dr.isExteriorRing=!1,qn.isExteriorRing=!1),ot(dr,qn)>0?qn.left=!0:dr.left=!0;var gi=nn[0],Dr=nn[1];ft[0]=pn(ft[0],gi),ft[1]=pn(ft[1],Dr),ft[2]=Jr(ft[2],gi),ft[3]=Jr(ft[3],Dr),Ht.push(dr),Ht.push(qn)}}var Hn=[];function Wn(we,_e,ht){typeof we[0][0][0]=="number"&&(we=[we]),typeof _e[0][0][0]=="number"&&(_e=[_e]);var Ht=function(Dr,Dn,_i){var ni=null;return Dr.length*Dn.length==0&&(_i===R?ni=Hn:_i===z?ni=Dr:_i!==L&&_i!==W||(ni=Dr.length===0?Dn:Dr)),ni}(we,_e,ht);if(Ht)return Ht===Hn?null:Ht;var ft=[1/0,1/0,-1/0,-1/0],Xt=[1/0,1/0,-1/0,-1/0],mr=function(Dr,Dn,_i,ni,rs){var Li,Ti,ui,Zn,sn,Xn,Ei=new Zt(null,ot);for(ui=0,Zn=Dr.length;ui<Zn;ui++)for(sn=0,Xn=(Li=Dr[ui]).length;sn<Xn;sn++)(Ti=sn===0)&&zn++,rn(Li[sn],!0,zn,Ei,_i,Ti);for(ui=0,Zn=Dn.length;ui<Zn;ui++)for(sn=0,Xn=(Li=Dn[ui]).length;sn<Xn;sn++)Ti=sn===0,rs===z&&(Ti=!1),Ti&&zn++,rn(Li[sn],!1,zn,Ei,ni,Ti);return Ei}(we,_e,ft,Xt,ht);if(Ht=function(Dr,Dn,_i,ni,rs){var Li=null;return(_i[0]>ni[2]||ni[0]>_i[2]||_i[1]>ni[3]||ni[1]>_i[3])&&(rs===R?Li=Hn:rs===z?Li=Dr:rs!==L&&rs!==W||(Li=Dr.concat(Dn))),Li}(we,_e,ft,Xt,ht))return Ht===Hn?null:Ht;for(var fr=function(Dr){var Dn,_i,ni=function(ui){var Zn,sn,Xn,Ei,Nr=[];for(sn=0,Xn=ui.length;sn<Xn;sn++)((Zn=ui[sn]).left&&Zn.inResult||!Zn.left&&Zn.otherEvent.inResult)&&Nr.push(Zn);for(var Fn=!1;!Fn;)for(Fn=!0,sn=0,Xn=Nr.length;sn<Xn;sn++)sn+1<Xn&&ot(Nr[sn],Nr[sn+1])===1&&(Ei=Nr[sn],Nr[sn]=Nr[sn+1],Nr[sn+1]=Ei,Fn=!1);for(sn=0,Xn=Nr.length;sn<Xn;sn++)(Zn=Nr[sn]).otherPos=sn;for(sn=0,Xn=Nr.length;sn<Xn;sn++)(Zn=Nr[sn]).left||(Ei=Zn.otherPos,Zn.otherPos=Zn.otherEvent.otherPos,Zn.otherEvent.otherPos=Ei);return Nr}(Dr),rs={},Li=[],Ti=function(){if(!rs[Dn]){var ui=Li.length,Zn=function(Nr,Fn,zi){var ls=new cr;if(Nr.prevInResult!=null){var ys=Nr.prevInResult,zs=ys.outputContourId;if(ys.resultTransition>0){var Fi=Fn[zs];if(Fi.holeOf!=null){var Ps=Fi.holeOf;Fn[Ps].holeIds.push(zi),ls.holeOf=Ps,ls.depth=Fn[zs].depth}else Fn[zs].holeIds.push(zi),ls.holeOf=zs,ls.depth=Fn[zs].depth+1}else ls.holeOf=null,ls.depth=Fn[zs].depth}else ls.holeOf=null,ls.depth=0;return ls}(ni[Dn],Li,ui),sn=function(Nr){rs[Nr]=!0,Nr<ni.length&&ni[Nr]&&(ni[Nr].outputContourId=ui)},Xn=Dn,Ei=Dn;for(Zn.points.push(ni[Dn].point);sn(Xn),sn(Xn=ni[Xn].otherPos),Zn.points.push(ni[Xn].point),!((Xn=tr(Xn,ni,rs,Ei))==Ei||Xn>=ni.length)&&ni[Xn];);Li.push(Zn)}};for(Dn=0,_i=ni.length;Dn<_i;Dn++)Ti();return Li}(function(Dr,Dn,_i,ni,rs,Li){for(var Ti,ui,Zn,sn=new h(sr),Xn=[],Ei=Math.min(ni[2],rs[2]);Dr.length!==0;){var Nr=Dr.pop();if(Xn.push(Nr),Li===R&&Nr.point[0]>Ei||Li===z&&Nr.point[0]>ni[2])break;if(Nr.left){ui=Ti=sn.insert(Nr),Ti=Ti!==(Zn=sn.minNode())?sn.prev(Ti):null,ui=sn.next(ui);var Fn=Ti?Ti.key:null;if(J(Nr,Fn,Li),ui&&xt(Nr,ui.key,Dr)===2&&(J(Nr,Fn,Li),J(ui.key,Nr,Li)),Ti&&xt(Ti.key,Nr,Dr)===2){var zi=Ti;J(Fn,(zi=zi!==Zn?sn.prev(zi):null)?zi.key:null,Li),J(Nr,Fn,Li)}}else ui=Ti=sn.find(Nr=Nr.otherEvent),Ti&&ui&&(Ti=Ti!==Zn?sn.prev(Ti):null,ui=sn.next(ui),sn.remove(Nr),ui&&Ti&&xt(Ti.key,ui.key,Dr))}return Xn}(mr,0,0,ft,Xt,ht)),nn=[],Mr=0;Mr<fr.length;Mr++){var dr=fr[Mr];if(dr.isExterior()){for(var qn=[dr.points],gi=0;gi<dr.holeIds.length;gi++)qn.push(fr[dr.holeIds[gi]].points);nn.push(qn)}}return nn}var Hi={UNION:L,DIFFERENCE:z,INTERSECTION:R,XOR:W};s.diff=function(we,_e){return Wn(we,_e,z)},s.intersection=function(we,_e){return Wn(we,_e,R)},s.operations=Hi,s.union=function(we,_e){return Wn(we,_e,L)},s.xor=function(we,_e){return Wn(we,_e,W)},Object.defineProperty(s,"__esModule",{value:!0})})(r)}(0,BR.exports)),BR.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function Ww(a,r,s,u){const h=[],g=u===0?(y,b,T,E,k,P)=>{y.push(new wt(P,T+(P-b)/(E-b)*(k-T)))}:(y,b,T,E,k,P)=>{y.push(new wt(b+(P-T)/(k-T)*(E-b),P))};for(const y of a){const b=[];for(const T of y){if(T.length<=2)continue;const E=[];for(let R=0;R<T.length-1;R++){const L=T[R].x,z=T[R].y,W=T[R+1].x,J=T[R+1].y,te=u===0?L:z,ae=u===0?W:J;te<r?ae>r&&g(E,L,z,W,J,r):te>s?ae<s&&g(E,L,z,W,J,s):E.push(T[R]),ae<r&&te>=r&&g(E,L,z,W,J,r),ae>s&&te<=s&&g(E,L,z,W,J,s)}let k=T[T.length-1];const P=u===0?k.x:k.y;P>=r&&P<=s&&E.push(k),E.length&&(k=E[E.length-1],E[0].x===k.x&&E[0].y===k.y||E.push(E[0]),b.push(E))}b.length&&h.push(b)}return h}function Z8(a,r){const s=OE(a),u=OE([r]),h=VR.intersection(s,u);return h==null?[]:UR(h)}function X8(a,r){let u=OE(a,65536);const h=[];for(;r.valid();r.next()){const[g,y]=r.get(),b=g.x*65536,T=g.y*65536,E=y.x*65536,k=y.y*65536,P=E-b,R=k-T,L=Math.hypot(P,R);if(L===0)continue;const z=Math.trunc(R/L*3),W=-Math.trunc(P/L*3);h.push([[[b,T],[E,k],[E+z,k+W],[b+z,T+W],[b,T]]])}return h.length>0&&(u=VR.diff(u,h)),UR(u,1/65536)}function OE(a,r=1){return[a.map(s=>s.map(u=>[u.x*r,u.y*r]))]}function UR(a,r=1){return a.map(s=>s.map((u,h)=>{const g=u.map(y=>new wt(y[0]*r,y[1]*r).round());return h>0&&g.reverse(),g}))}class LE{constructor(r,s){this.layoutVertexArray=new sa,this.indexArray=new Ui,this.lineIndexArray=new dl,this.triangleSegments=new Zi,this.lineSegments=new Zi,this.programConfigurations=new Ml(r.layers,{zoom:r.zoom,lut:r.lut}),this.uploaded=!1,s&&(this.elevatedLayoutVertexArray=new Lc)}update(r,s,u,h,g,y,b,T){this.programConfigurations.updatePaintArrays(r,s,g,u,h,y,b,T)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,M8.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.lineIndexBuffer=r.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=r.createVertexBuffer(this.elevatedLayoutVertexArray,N8.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(r,s,u,h,g,y,b){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,s,u,h,g,y,void 0,b)}}class zE{constructor(r){this.zoom=r.zoom,this.pixelRatio=r.pixelRatio,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=r.lut,this.bufferData=new LE(r,!1),this.elevationBufferData=new LE(r,!0),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=r.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=r.sourceLayerIndex,this.worldview=r.worldview,this.hasAppearances=null}updateFootprints(r,s){}updateAppearances(r,s,u,h){}populate(r,s,u,h){this.hasPattern=NE("fill",this.layers,this.pixelRatio,s);const g=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:b,id:T,index:E,sourceLayerIndex:k}of r){const P=this.layers[0]._featureFilter.needGeometry,R=et(b,P);if(!this.layers[0]._featureFilter.filter(new Ai(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),R,u))continue;const L=g?g.evaluate(R,{},u,s.availableImages):void 0,z={id:T,properties:b.properties,type:b.type,sourceLayerIndex:k,index:E,geometry:P?R.geometry:mt(b,u,h),patterns:{},sortKey:L};y.push(z)}g&&y.sort((b,T)=>b.sortKey-T.sortKey);for(const b of y){const{geometry:T,index:E,sourceLayerIndex:k}=b;if(this.hasPattern){const P=DE("fill",this.layers,b,this.zoom,this.pixelRatio,s);this.patternFeatures.push(P)}else this.addFeature(b,T,E,u,{},s.availableImages,s.brightness,s.elevationFeatures);s.featureIndex.insert(r[E].feature,T,E,k,this.index)}}update(r,s,u,h,g,y,b){this.bufferData.update(r,s,u,h,g,y,b,this.worldview),this.elevationBufferData.update(r,s,u,h,g,y,b,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(r,s,u,h,g,y,b,this.worldview)}addFeatures(r,s,u,h,g,y){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,s,u,h,y,r.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(r){this.bufferData.upload(r),this.elevationBufferData.upload(r),this.elevatedStructures&&this.elevatedStructures.upload(r)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(r,s,u,h,g,y=[],b,T){const E=Sx(s,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(r,E,h,u,T):this.addGeometry(E,this.bufferData),this.bufferData.populatePaintArrays(r,u,g,y,h,b,this.worldview),this.elevationBufferData.populatePaintArrays(r,u,g,y,h,b,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(r,s,u,h,g){this.elevatedStructures&&(this.elevatedStructures.construct(r),this.elevatedStructures.populatePaintArrays(s,u,h,g,this.worldview))}addElevatedRoadFeature(r,s,u,h,g){const y=new Array,b=Zr.getElevationFeature(r,g);if(!b)return void this.addGeometry(s,this.bufferData);{const E=this.clipPolygonsToTile(s,1);E.length>0&&y.push({polygons:E,elevationFeature:b,elevationTileID:u})}const T={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(r,{},u),featureIndex:h};for(const E of y)if(E.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Ba(E.elevationTileID,this.layers,this.zoom,this.lut));const P=E.elevationFeature.isTunnel();let R=0;r.properties.hasOwnProperty(ir)&&(R=+r.properties[ir]);for(const L of E.polygons)this.elevatedStructures.addPortalCandidates(E.elevationFeature.id,L,P,E.elevationFeature,R)}E.elevationFeature.constantHeight==null&&(E.polygons=this.prepareElevatedPolygons(E.polygons,E.elevationFeature,E.elevationTileID));const k=new Ln(u,E.elevationTileID);this.addElevatedGeometry(E.polygons,k,E.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,h,T)}}addElevatedGeometry(r,s,u,h,g,y){const b={elevation:u,elevationSampler:s,bias:h,index:g,featureInfo:y},[T,E]=this.addGeometry(r,this.elevationBufferData,b);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:T,max:E}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,T),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,E))}addGeometry(r,s,u){let h=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,y=null;u&&(y=u.elevationSampler.constantElevation(u.elevation,u.bias),y!=null&&(h=y,g=y));const b=(T,E,k)=>{if(u!=null)if(E.push(T),y!=null)s.elevatedLayoutVertexArray.emplaceBack(y),k.push(y);else{const P=u.elevationSampler.pointElevation(T,u.elevation,u.bias);s.elevatedLayoutVertexArray.emplaceBack(P),k.push(P),h=Math.min(h,P),g=Math.max(g,P)}};for(const T of r){let E=0;for(const ue of T)E+=ue.length;const k=s.triangleSegments.prepareSegment(E,s.layoutVertexArray,s.indexArray),P=k.vertexLength,R=[],L=[],z=[],W=[],J=[],te=s.layoutVertexArray.length;for(const ue of T){if(ue.length===0)continue;ue!==T[0]&&L.push(R.length/2);const he=s.lineSegments.prepareSegment(ue.length,s.layoutVertexArray,s.lineIndexArray),Ce=he.vertexLength;u&&J.push(s.layoutVertexArray.length-te),b(ue[0],z,W),s.layoutVertexArray.emplaceBack(ue[0].x,ue[0].y),s.lineIndexArray.emplaceBack(Ce+ue.length-1,Ce),R.push(ue[0].x),R.push(ue[0].y);for(let be=1;be<ue.length;be++)b(ue[be],z,W),s.layoutVertexArray.emplaceBack(ue[be].x,ue[be].y),s.lineIndexArray.emplaceBack(Ce+be-1,Ce+be),R.push(ue[be].x),R.push(ue[be].y);he.vertexLength+=ue.length,he.primitiveLength+=ue.length}const ae=Jg(R,L);for(let ue=0;ue<ae.length;ue+=3)s.indexArray.emplaceBack(P+ae[ue],P+ae[ue+1],P+ae[ue+2]);if(ae.length>0&&u&&this.elevationMode==="hd-road-base"){const ue=u.elevation.isTunnel(),he=u.elevation.safeArea,Ce=this.elevatedStructures.addVertices(z,W);this.elevatedStructures.addTriangles(ae,Ce,ue);const be=J.length;if(be>0){for(let ke=0;ke<be-1;ke++)this.elevatedStructures.addRenderableRing(u.index,J[ke]+Ce,J[ke+1]-J[ke],ue,he,u.featureInfo);this.elevatedStructures.addRenderableRing(u.index,J[be-1]+Ce,z.length-J[be-1],ue,he,u.featureInfo)}}k.vertexLength+=E,k.primitiveLength+=ae.length/3}return[h,g]}prepareElevatedPolygons(r,s,u){const h=1/Ie(u),g=[];for(const y of r){const b=X8(y,new ki(s,h));g.push(...b)}return g}clipPolygonsToTile(r,s){const u=-s,h=-s,g=Vt+s,y=Vt+s;let b=0;const T=[],E=[];for(;b<r.length;b++){const R=r[b],L=Sp(R);(L.min.x>=u&&L.max.x<=g&&L.min.y>=h&&L.max.y<=y?T:E).push(R)}if(T.length===r.length)return r;const k=[new wt(u,h),new wt(g,h),new wt(g,y),new wt(u,y),new wt(u,h)],P=T;for(const R of E)P.push(...Z8(R,k));return P}}let $R,qR,GR,HR;or(zE,"FillBucket",{omit:["layers","patternFeatures"]}),or(LE,"FillBufferData"),or(Ba,"ElevatedStructures");class Zw{constructor(r,s,u,h){if(this.triangleCount=s.length/3,this.min=new wt(0,0),this.max=new wt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||r.length===0)return;const[g,y]=[r[0].clone(),r[0].clone()];for(let P=1;P<r.length;++P){const R=r[P];g.x=Math.min(g.x,R.x),g.y=Math.min(g.y,R.y),y.x=Math.max(y.x,R.x),y.y=Math.max(y.y,R.y)}if(h){const P=Math.ceil(Math.max(y.x-g.x,y.y-g.y)/h);u=Math.max(u,P)}if(u===0)return;this.min=g,this.max=y;const b=this.max.sub(this.min);b.x=Math.max(b.x,1),b.y=Math.max(b.y,1);const T=Math.max(b.x,b.y)/u;this.cellsX=Math.max(1,Math.ceil(b.x/T)),this.cellsY=Math.max(1,Math.ceil(b.y/T)),this.xScale=1/T,this.yScale=1/T;const E=[];for(let P=0;P<this.triangleCount;P++){const R=r[s[3*P+0]].sub(this.min),L=r[s[3*P+1]].sub(this.min),z=r[s[3*P+2]].sub(this.min),W=Mu(Math.floor(Math.min(R.x,L.x,z.x)),this.xScale,this.cellsX),J=Mu(Math.floor(Math.max(R.x,L.x,z.x)),this.xScale,this.cellsX),te=Mu(Math.floor(Math.min(R.y,L.y,z.y)),this.yScale,this.cellsY),ae=Mu(Math.floor(Math.max(R.y,L.y,z.y)),this.yScale,this.cellsY),ue=new wt(0,0),he=new wt(0,0),Ce=new wt(0,0),be=new wt(0,0);for(let ke=te;ke<=ae;++ke){ue.y=he.y=ke*T,Ce.y=be.y=(ke+1)*T;for(let Me=W;Me<=J;++Me)ue.x=Ce.x=Me*T,he.x=be.x=(Me+1)*T,(_s(R,L,z,ue,he,be)||_s(R,L,z,ue,be,Ce))&&E.push({cellIdx:ke*this.cellsX+Me,triIdx:P})}}if(E.length===0)return;E.sort((P,R)=>P.cellIdx-R.cellIdx||P.triIdx-R.triIdx);let k=0;for(;k<E.length;){const P=E[k].cellIdx,R={start:this.payload.length,len:0};for(;k<E.length&&E[k].cellIdx===P;)++R.len,this.payload.push(E[k++].triIdx);this.cells[P]=R}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(r,s){if(this.triangleCount===0||this.cells.length===0||r.x>this.max.x||this.min.x>r.x||r.y>this.max.y||this.min.y>r.y)return;const u=Mu(r.x-this.min.x,this.xScale,this.cellsX),h=Mu(r.y-this.min.y,this.yScale,this.cellsY),g=this.cells[h*this.cellsX+u];if(g){this._lazyInitLookup();for(let y=0;y<g.len;y++){const b=this.payload[g.start+y],T=Math.floor(b/8),E=1<<b%8;if(!(this.lookup[T]&E)&&(this.lookup[T]|=E,s.push(b),s.length===this.triangleCount))return}}}query(r,s,u){if(this.triangleCount===0||this.cells.length===0||r.x>this.max.x||this.min.x>s.x||r.y>this.max.y||this.min.y>s.y)return;this._lazyInitLookup();const h=Mu(r.x-this.min.x,this.xScale,this.cellsX),g=Mu(s.x-this.min.x,this.xScale,this.cellsX),y=Mu(r.y-this.min.y,this.yScale,this.cellsY),b=Mu(s.y-this.min.y,this.yScale,this.cellsY);for(let T=y;T<=b;T++)for(let E=h;E<=g;E++){const k=this.cells[T*this.cellsX+E];if(k)for(let P=0;P<k.len;P++){const R=this.payload[k.start+P],L=Math.floor(R/8),z=1<<R%8;if(!(this.lookup[L]&z)&&(this.lookup[L]|=z,u.push(R),u.length===this.triangleCount))return}}}}function Mu(a,r,s){return Math.max(0,Math.min(s-1,Math.floor(a*r)))}or(Zw,"TriangleGridIndex");class WR{constructor(r){this.zoom=r.zoom,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=r.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.footprints=[],this.worldview=r.worldview,this.hasAppearances=null}updateFootprints(r,s){for(const u of this.footprints)s.push({footprint:u,id:r})}updateAppearances(r,s,u,h){}populate(r,s,u,h){const g=[];for(const{feature:y,id:b,index:T,sourceLayerIndex:E}of r){const k=this.layers[0]._featureFilter.needGeometry,P=et(y,k);if(!this.layers[0]._featureFilter.filter(new Ai(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),P,u))continue;const R={id:b,properties:y.properties,type:y.type,sourceLayerIndex:E,index:T,geometry:k?P.geometry:mt(y,u,h),patterns:{}};g.push(R)}for(const y of g){const{geometry:b,index:T,sourceLayerIndex:E}=y;this.addFeature(y,b,T,u,{},s.availableImages,s.brightness),s.featureIndex.insert(r[T].feature,b,T,E,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(r){}update(r,s,u,h,g,y,b){}destroy(){}addFeature(r,s,u,h,g,y=[],b){for(const T of Sx(s,2)){const E=[],k=[],P=[],R=new wt(1/0,1/0),L=new wt(-1/0,-1/0);for(const J of T)if(J.length!==0){J!==T[0]&&P.push(k.length/2);for(let te=0;te<J.length;te++)k.push(J[te].x),k.push(J[te].y),E.push(J[te]),R.x=Math.min(R.x,J[te].x),R.y=Math.min(R.y,J[te].y),L.x=Math.max(L.x,J[te].x),L.y=Math.max(L.y,J[te].y)}const z=Jg(k,P),W=new Zw(E,z,8,256);this.footprints.push({vertices:E,indices:z,grid:W,min:R,max:L})}}}or(WR,"ClipBucket",{omit:["layers"]});const K8=vn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Y8=vn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),J8=vn([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),Q8=vn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),eq=vn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),tq=vn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),rq=vn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:nq}=K8,Tx=Number.MAX_SAFE_INTEGER,ZR=Tx-1;function XR(a,r,s,u){return a.order<r||a.order===Tx||!(a.clipMask&s)||function(h,g){return g.length!==0&&g.find(y=>y===h)===void 0}(u,a.clipScope)}function Xw(a,r){return a.x-r.x||a.y-r.y}function KR(a,r){return Xw(a.min,r.min)===0&&Xw(a.max,r.max)===0}function FE(a,r){return!(a.min.x>r.max.x||a.max.x<r.min.x||a.min.y>r.max.y||a.max.y<r.min.y)}function Kw(a,r){if(a.length!==r.length)return!1;for(let s=0;s<a.length;s++)if(a[s].sourceId!==r[s].sourceId||!KR(a[s],r[s])||a[s].order!==r[s].order||a[s].clipMask!==r[s].clipMask||!jo(a[s].clipScope,r[s].clipScope))return!1;return!0}function YR(a,r,s){const u=1/Vt,h=1/(1<<s.canonical.z),g=(r.x*u+s.canonical.x)*h+s.wrap,y=(r.y*u+s.canonical.y)*h;return{min:new wt((a.x*u+s.canonical.x)*h+s.wrap,(a.y*u+s.canonical.y)*h),max:new wt(g,y)}}function iq(a,r,s){const u=1<<s.canonical.z,h=((r.x-s.wrap)*u-s.canonical.x)*Vt,g=(r.y*u-s.canonical.y)*Vt;return{min:new wt(((a.x-s.wrap)*u-s.canonical.x)*Vt,(a.y*u-s.canonical.y)*Vt),max:new wt(h,g)}}function BE(a,r,s,u,h,g,y){const b=a.indices,T=a.vertices,E=[];for(let k=u;k<u+h;k+=3){const P=r[s[k+0]+g],R=r[s[k+1]+g],L=r[s[k+2]+g],z=Math.min(P.x,R.x,L.x),W=Math.max(P.x,R.x,L.x),J=Math.min(P.y,R.y,L.y),te=Math.max(P.y,R.y,L.y);E.length=0,a.grid.query(new wt(z,J),new wt(W,te),E);for(let ae=0;ae<E.length;ae++){const ue=E[ae];if(_s(T[b[3*ue+0]],T[b[3*ue+1]],T[b[3*ue+2]],P,R,L,y))return!0}}return!1}function JR(a,r,s,u){if(!a||!s)return!1;let h=a.vertices;if(!r.canonical.equals(u.canonical)||r.wrap!==u.wrap){if(s.vertices.length<a.vertices.length)return JR(s,u,a,r);const g=r.canonical,y=u.canonical,b=Math.pow(2,y.z-g.z);h=a.vertices.map(T=>new wt((T.x+g.x*Vt)*b-y.x*Vt,(T.y+g.y*Vt)*b-y.y*Vt))}return BE(s,h,a.indices,0,a.indices.length,0,0)}function QR(a,r,s,u){const h=Math.pow(2,u.z-s.z);return new wt((a+s.x*Vt)*h-u.x*Vt,(r+s.y*Vt)*h-u.y*Vt)}function VE(a,r){const s=[];r.grid.queryPoint(a,s);const u=r.indices,h=r.vertices;for(let g=0;g<s.length;g++){const y=s[g];if(no([h[u[3*y+0]],h[u[3*y+1]],h[u[3*y+2]]],a))return!0}return!1}const UE=[new wt(0,0),new wt(Vt,0),new wt(Vt,Vt),new wt(0,Vt)];function eM(a,r){const s=[];let u=[];if(!r||a.length<2)return[a];if(a.length===2)return hs(a[0],a[1],UE)?[a]:[];for(let h=0;h<a.length+2;h++){const g=a[h%a.length],y=a[(h+1)%a.length],b=hs(h===0?a[a.length-1]:a[(h-1)%a.length],g,UE),T=hs(g,y,UE),E=b||T;E&&u.push(g),E&&T||u.length>0&&(u.length>1&&s.push(u),u=[])}return u.length>1&&s.push(u),s}const $E=Et.types,sq=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],oq=["fill-extrusion-flood-light-ground-radius"],aq=Math.pow(2,13),lq=Math.pow(2,15)-1,tM=new wt(0,1),$h=2147483648,rM=7,nM=450;function Ex(a,r,s,u,h,g,y,b){a.emplaceBack((r<<1)+y,(s<<1)+g,(Math.floor(u*aq)<<1)+h,Math.round(b))}function Cx(a,r,s){a.emplaceBack(r.x*Vt,r.y*Vt,s?1:0)}function Yw(a,r,s,u,h,g){a.emplaceBack(r.x,r.y,(s.x<<1)+u,(s.y<<1)+h,g)}function Ax(a,r,s){a.emplaceBack(r.x,r.y,r.z,s[0]*16384,s[1]*16384,s[2]*16384)}class iM{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class sM{constructor(){this.centroidXY=new wt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new wt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new wt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new wt(this.max.x-this.min.x,this.max.y-this.min.y)}}class oM{constructor(){this.acc=new wt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(r,s){r.min.x===Number.MAX_VALUE&&(r.min.x=r.max.x=s.x,r.min.y=r.max.y=s.y)}appendEdge(r,s,u){this.accCount++,this.acc._add(s);let h=!!this.borders;s.x<r.min.x?(r.min.x=s.x,h=!0):s.x>r.max.x&&(r.max.x=s.x,h=!0),s.y<r.min.y?(r.min.y=s.y,h=!0):s.y>r.max.y&&(r.max.y=s.y,h=!0),((s.x===0||s.x===Vt)&&s.x===u.x)!=((s.y===0||s.y===Vt)&&s.y===u.y)&&this.processBorderOverlap(s,u),h&&this.checkBorderIntersection(s,u)}checkBorderIntersection(r,s){s.x<0!=r.x<0&&this.addBorderIntersection(0,Br(s.y,r.y,(0-s.x)/(r.x-s.x))),s.x>Vt!=r.x>Vt&&this.addBorderIntersection(1,Br(s.y,r.y,(Vt-s.x)/(r.x-s.x))),s.y<0!=r.y<0&&this.addBorderIntersection(2,Br(s.x,r.x,(0-s.y)/(r.y-s.y))),s.y>Vt!=r.y>Vt&&this.addBorderIntersection(3,Br(s.x,r.x,(Vt-s.y)/(r.y-s.y)))}addBorderIntersection(r,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[r];s<u[0]&&(u[0]=s),s>u[1]&&(u[1]=s)}processBorderOverlap(r,s){if(r.x===s.x){if(r.y===s.y)return;const u=r.x===0?0:1;this.addBorderIntersection(u,s.y),this.addBorderIntersection(u,r.y)}else{const u=r.y===0?2:3;this.addBorderIntersection(u,s.x),this.addBorderIntersection(u,r.x)}}centroid(){return this.accCount===0?new wt(0,0):new wt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((r,s)=>r+ +(s[0]!==Number.MAX_VALUE),0):0}}function aM(a,r){const s=a.add(r)._unit(),u=se(a.x*s.x+a.y*s.y,-1,1);var h,g,y;return h=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(h)))/4*lq*((g=a).x*(y=r).y-g.y*y.x<0?-1:1)}const cq=[a=>a.x<0,a=>a.x>Vt,a=>a.y<0,a=>a.y>Vt];function uq(a,r,s,u){const h=[4];if(u===0)return h;s._mult(u);const g=a.sub(s),y=r.sub(s),b=[a,r,g,y];for(let T=0;T<4;T++)for(const E of b)if(cq[T](E)){h.push(T);break}return h}class qE{constructor(r){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new Lg,this.indexArray=new Ui,this.programConfigurations=new Ml(r.layers,{zoom:r.zoom,lut:r.lut},s=>oq.includes(s)),this._segments=new Zi,this.hiddenByLandmarkVertexArray=new qg,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Zi}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(r,s,u,h=!1){const g=r.length;if(g>2){let y=Math.max(0,this._segments.get().length-1);const b=this._segments._prepareSegment(4*g,this.vertexArray.length,2*this._segmentToGroundQuads[y].length);let T;y!==this._segments.get().length-1&&(y++,this._segmentToGroundQuads[y]=[],this._segmentToRegionTriCounts[y]=[0,0,0,0,0]);{const E=r[0],k=r[1];T=aM(E.sub(r[g-1])._perp()._unit(),k.sub(E)._perp()._unit())}for(let E=0;E<g;E++){const k=E===g-1?0:E+1,P=r[E],R=r[k],L=r[k===g-1?0:k+1],z=R.sub(P)._perp()._unit(),W=aM(z,L.sub(R)._perp()._unit()),J=T,te=W;if(GE(P,R,s)||h&&uM(P,s)&&uM(R,s)){T=W;continue}const ae=b.vertexLength;Yw(this.vertexArray,P,R,1,1,J),Yw(this.vertexArray,P,R,1,0,J),Yw(this.vertexArray,P,R,0,1,te),Yw(this.vertexArray,P,R,0,0,te),b.vertexLength+=4;const ue=uq(P,R,z,u);for(const he of ue)this._segmentToGroundQuads[y].push({id:ae,region:he}),this._segmentToRegionTriCounts[y][he]+=2,b.primitiveLength+=2;T=W}}}prepareBorderSegments(){if(!this.hasData())return;const r=this._segments.get(),s=r.length;for(let u=0;u<s;u++)this._segmentToGroundQuads[u].sort((h,g)=>h.region-g.region);for(let u=0;u<s;u++){const h=this._segmentToGroundQuads[u],g=r[u],y=this._segmentToRegionTriCounts[u];y.reduce((T,E)=>T+E,0);let b=0;for(let T=0;T<=4;T++){const E=y[T];if(E!==0){let k=this.regionSegments[T];k||(k=this.regionSegments[T]=new Zi);const P={vertexOffset:g.vertexOffset,primitiveOffset:g.primitiveOffset+b,vertexLength:g.vertexLength,primitiveLength:E};k.get().push(P)}b+=E}for(let T=0;T<h.length;T++){const E=h[T].id;this.indexArray.emplaceBack(E,E+1,E+3),this.indexArray.emplaceBack(E,E+3,E+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(r,s,u,h,g,y,b){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,r,s,u,h,g,y,void 0,b)}upload(r){this.hasData()&&(this.vertexBuffer=r.createVertexBuffer(this.vertexArray,Y8.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=r.createVertexBuffer(this.groundRadiusArray,J8.members)))}uploadPaintProperties(r){this.hasData()&&this.programConfigurations.upload(r)}update(r,s,u,h,g,y,b,T){this.hasData()&&this.programConfigurations.updatePaintArrays(r,s,u,h,g,y,b,T)}updateHiddenByLandmark(r){this.updateHiddenByLandmarkRange(r.groundVertexArrayOffset,r.groundVertexCount,!!(r.flags&$h))}updateHiddenByLandmarkRange(r,s,u){if(!this.hasData())return;const h=s+r;if(s!==0){for(let g=r;g<h;++g)this.hiddenByLandmarkVertexArray.emplace(g,u?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(r){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=r.createVertexBuffer(this.hiddenByLandmarkVertexArray,tq.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let r=0;r<=4;r++){const s=this.regionSegments[r];s&&s.destroy()}}}}class Jw{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaling=r.overscaling,this.layers=r.layers,this.pixelRatio=r.pixelRatio,this.layerIds=this.layers.map(s=>s.fqid),this.index=r.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=r.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Ui,this.footprintVertices=new sa,this.footprintSegments=[],this.layoutVertexArray=new Ph,this.centroidVertexArray=new Mw,this.wallVertexArray=new Dw,this.indexArray=new Ui,this.programConfigurations=new Ml(r.layers,{zoom:r.zoom,lut:r.lut},s=>sq.includes(s)),this.segments=new Zi,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.groundEffect=new qE(r),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=r.worldview,this.hasAppearances=null}updateFootprints(r,s){}updateAppearances(r,s,u,h){}populate(r,s,u,h){this.features=[],this.hasPattern=NE("fill-extrusion",this.layers,this.pixelRatio,s),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Ie(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:g,id:y,index:b,sourceLayerIndex:T}of r){const E=this.layers[0]._featureFilter.needGeometry,k=et(g,E);if(!this.layers[0]._featureFilter.filter(new Ai(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),k,u))continue;const P={id:y,sourceLayerIndex:T,index:b,geometry:E?k.geometry:mt(g,u,h),properties:g.properties,type:g.type,patterns:{}},R=this.layoutVertexArray.length,L=$E[P.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:g.id,feature:DE("fill-extrusion",this.layers,P,this.zoom,this.pixelRatio,s)});else if(this.wallMode)for(const z of P.geometry)for(const W of eM(z,L))this.addFeature(g.id,P,[W],b,u,{},s.availableImages,h,s.brightness);else this.addFeature(g.id,P,P.geometry,b,u,{},s.availableImages,h,s.brightness);s.featureIndex.insert(g,P.geometry,b,T,this.index,R)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(r,s,u,h,g,y){for(const{featureId:b,feature:T}of this.features){const E=$E[T.type]==="Polygon",{geometry:k}=T;if(this.wallMode)for(const P of k)for(const R of eM(P,E))this.addFeature(b,T,[R],T.index,s,u,h,g,y);else this.addFeature(b,T,k,T.index,s,u,h,g,y)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(r,s,u,h,g,y,b){this.programConfigurations.updatePaintArrays(r,s,g,u,h,y,b,this.worldview),this.groundEffect.update(r,s,g,u,h,y,b,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,nq),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.wallVertexBuffer=r.createVertexBuffer(this.wallVertexArray,eq.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=r.createVertexBuffer(this.layoutVertexExtArray,rq.members,!0)),this.groundEffect.upload(r)),this.groundEffect.uploadPaintProperties(r),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){this.groundEffect.uploadHiddenByLandmark(r),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,Q8.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,s,u,h,g,y,b,T,E){const k=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(s,{})/this.tileToMeter,P=[new wt(0,0),new wt(Vt,Vt)],R=T.projection,L=R.name==="globe",z=this.wallMode||$E[s.type]==="Polygon",W=new oM;W.centroidDataIndex=this.centroidData.length;const J=new sM;J.buildingId=r,s.properties&&s.properties.hasOwnProperty("building_id")&&(J.buildingId=s.properties.building_id);const te=this.layers[0].paint.get("fill-extrusion-base").evaluate(s,{},g)<=0,ae=this.layers[0].paint.get("fill-extrusion-height").evaluate(s,{},g);let ue;if(J.height=ae,J.vertexArrayOffset=this.layoutVertexArray.length,J.groundVertexArrayOffset=this.groundEffect.vertexArray.length,L&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Fg),this.wallMode){if(L)return void Cr("Non zero fill-extrusion-line-width is not yet supported on globe.");if(u.length!==1)return;ue=function(We){const ut=We[0].x===We[We.length-1].x&&We[0].y===We[We.length-1].y;(function(tr){let Zt=0;const Xr=tr.length;for(let Jt=0;Jt<Xr;Jt++)Zt+=(tr[(Jt+1)%Xr].x-tr[Jt].x)*(tr[(Jt+1)%Xr].y+tr[Jt].y);return Zt>=0})(We)||(We=We.reverse());const St={geometry:[],joinNormals:[],indices:[]},Lt=[],kt=[],_t=[];let It=We.length;for(;It>=2&&We[It-1].equals(We[It-2]);)It--;if(It<(ut?3:2))return St;let ot,rt,At,Nt,xt,sr=0;for(;sr<It-1&&We[sr].equals(We[sr+1]);)sr++;ut&&(ot=We[It-2],xt=We[sr].sub(ot)._unit()._perp());for(let tr=sr;tr<It;tr++){if(At=tr===It-1?ut?We[sr+1]:void 0:We[tr+1],At&&We[tr].equals(At))continue;xt&&(Nt=xt),ot&&(rt=ot),ot=We[tr],xt=At?At.sub(ot)._unit()._perp():Nt,Nt=Nt||xt;let Zt=Nt.add(xt);Zt.x===0&&Zt.y===0||Zt._unit();const Xr=Zt.x*xt.x+Zt.y*xt.y,Jt=Xr!==0?1/Xr:1/0,Tr=Nt.x*xt.y-Nt.y*xt.x>0;let Jr="miter";const pn=2;Jr==="miter"&&Jt>pn&&(Jr="bevel"),Jr==="bevel"&&(Jt>100&&(Jr="flipbevel"),Jt<pn&&(Jr="miter"));const zn=(rn,Hn,Wn,Hi)=>{const we=new wt(rn.x,rn.y),_e=new wt(rn.x,rn.y);we.x+=Hn.x*Hi,we.y+=Hn.y*Hi,_e.x-=Hn.x*Math.max(Wn,1),_e.y-=Hn.y*Math.max(Wn,1),_t.push(Hn),Lt.push(we),kt.push(_e)};if(Jr==="miter")Zt._mult(Jt),zn(ot,Zt,0,0);else if(Jr==="flipbevel")Zt=xt.mult(-1),zn(ot,Zt,0,0),zn(ot,Zt.mult(-1),0,0);else{const rn=-Math.sqrt(Jt*Jt-1),Hn=Tr?rn:0,Wn=Tr?0:rn;rt&&zn(ot,Nt,Hn,Wn),At&&zn(ot,xt,Hn,Wn)}}St.geometry=[...Lt,...kt.reverse(),Lt[0]],St.joinNormals=[..._t,..._t.reverse(),_t[_t.length-1]];const cr=St.geometry.length-1;for(let tr=0;tr<cr/2;tr++)if(tr+1<cr/2){let Zt=tr,Xr=tr+1,Jt=cr-1-tr,Tr=cr-2-tr;Zt=Zt===0?cr-1:Zt-1,Xr=Xr===0?cr-1:Xr-1,Jt=Jt===0?cr-1:Jt-1,Tr=Tr===0?cr-1:Tr-1,St.indices.push(Jt),St.indices.push(Xr),St.indices.push(Zt),St.indices.push(Jt),St.indices.push(Tr),St.indices.push(Xr)}return St}(u[0]),u=[ue.geometry]}const he=(We,ut)=>We<(ut.length-1)/2||We===ut.length-1,Ce=this.wallMode?[u]:Sx(u,500);for(let We=Ce.length-1;We>=0;We--){const ut=Ce[We];(ut.length===0||(be=ut[0]).every(gt=>gt.x<=0)||be.every(gt=>gt.x>=Vt)||be.every(gt=>gt.y<=0)||be.every(gt=>gt.y>=Vt))&&Ce.splice(We,1)}var be;let ke;if(L)ke=pM(Ce,P,g);else{ke=[];for(const We of Ce)ke.push({polygon:We,bounds:P})}const Me=z?this.edgeRadius:0,ze=Me>0&&this.zoom<17,ct=(We,ut)=>{if(We.length===0)return!1;const gt=We[We.length-1];return ut.x===gt.x&&ut.y===gt.y};for(const{polygon:We,bounds:ut}of ke){let gt=0,St=0;for(const It of We)z&&!It[0].equals(It[It.length-1])&&It.push(It[0]),St+=z?It.length-1:It.length;const Lt=this.segments.prepareSegment((z?5:4)*St,this.layoutVertexArray,this.indexArray);J.footprintSegIdx<0&&(J.footprintSegIdx=this.footprintSegments.length),J.polygonSegIdx<0&&(J.polygonSegIdx=this.polygonSegments.length);const kt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},_t=new iM;if(_t.vertexOffset=this.footprintVertices.length,_t.indexOffset=3*this.footprintIndices.length,_t.ringIndices=[],z){const It=[],ot=[];gt=Lt.vertexLength;for(let At=0;At<We.length;At++){const Nt=We[At];Nt.length&&At!==0&&ot.push(It.length/2);const xt=[];let sr,cr;sr=Nt[1].sub(Nt[0])._perp()._unit(),_t.ringIndices.push(Nt.length-1);for(let tr=1;tr<Nt.length;tr++){const Zt=Nt[tr],Xr=Nt[tr===Nt.length-1?1:tr+1],Jt=Zt.clone();if(Me){cr=Xr.sub(Zt)._perp()._unit();const Tr=sr.add(cr)._unit(),Jr=Me*Math.min(4,1/(sr.x*Tr.x+sr.y*Tr.y));Jt.x+=Jr*Tr.x,Jt.y+=Jr*Tr.y,Jt.x=Math.round(Jt.x),Jt.y=Math.round(Jt.y),sr=cr}if(!te||Me!==0&&!ze||ct(xt,Jt)||xt.push(Jt),Ex(this.layoutVertexArray,Jt.x,Jt.y,0,0,1,1,0),this.wallMode){const Tr=he(tr,Nt);Cx(this.wallVertexArray,ue.joinNormals[tr],!Tr)}Lt.vertexLength++,this.footprintVertices.emplaceBack(Zt.x,Zt.y),It.push(Zt.x,Zt.y),L&&Ax(this.layoutVertexExtArray,R.projectTilePoint(Jt.x,Jt.y,g),R.upVector(g,Jt.x,Jt.y))}te&&(Me===0||ze)&&(xt.length!==0&&ct(xt,xt[0])&&xt.pop(),this.groundEffect.addData(xt,ut,k))}const rt=this.wallMode?ue.indices:Jg(It,ot);for(let At=0;At<rt.length;At+=3)this.footprintIndices.emplaceBack(_t.vertexOffset+rt[At+0],_t.vertexOffset+rt[At+1],_t.vertexOffset+rt[At+2]),this.indexArray.emplaceBack(gt+rt[At],gt+rt[At+2],gt+rt[At+1]),Lt.primitiveLength++;_t.indexCount+=rt.length,_t.vertexCount+=this.footprintVertices.length-_t.vertexOffset}for(let It=0;It<We.length;It++){const ot=We[It];W.startRing(J,ot[0]);let rt=ot.length>4&&dM(ot[ot.length-2],ot[0],ot[1]),At=Me?dq(ot[ot.length-2],ot[0],ot[1],Me):0;const Nt=[];let xt,sr,cr;sr=ot[1].sub(ot[0])._perp()._unit();let tr=!0;for(let Zt=1,Xr=0;Zt<ot.length;Zt++){let Jt=ot[Zt-1],Tr=ot[Zt];const Jr=ot[Zt===ot.length-1?1:Zt+1];if(W.appendEdge(J,Tr,Jt),GE(Tr,Jt,ut)){Me&&(sr=Jr.sub(Tr)._perp()._unit(),tr=!tr);continue}const pn=Tr.sub(Jt)._perp(),zn=pn.x/(Math.abs(pn.x)+Math.abs(pn.y)),rn=pn.y>0?1:0,Hn=Jt.dist(Tr);if(Xr+Hn>32768&&(Xr=0),Me){cr=Jr.sub(Tr)._perp()._unit();let _e=cM(Jt,Tr,Jr,lM(sr,cr),Me);isNaN(_e)&&(_e=0);const ht=Tr.sub(Jt)._unit();Jt=Jt.add(ht.mult(At))._round(),Tr=Tr.add(ht.mult(-_e))._round(),At=_e,sr=cr,te&&this.zoom>=17&&(ct(Nt,Jt)||Nt.push(Jt),ct(Nt,Tr)||Nt.push(Tr))}const Wn=Lt.vertexLength,Hi=ot.length>4&&dM(Jt,Tr,Jr);let we=hM(Xr,rt,tr);if(Ex(this.layoutVertexArray,Jt.x,Jt.y,zn,rn,0,0,we),Ex(this.layoutVertexArray,Jt.x,Jt.y,zn,rn,0,1,we),this.wallMode){const _e=he(Zt-1,ot),ht=ue.joinNormals[Zt-1];Cx(this.wallVertexArray,ht,_e),Cx(this.wallVertexArray,ht,_e)}if(Xr+=Hn,we=hM(Xr,Hi,!tr),rt=Hi,Ex(this.layoutVertexArray,Tr.x,Tr.y,zn,rn,0,0,we),Ex(this.layoutVertexArray,Tr.x,Tr.y,zn,rn,0,1,we),this.wallMode){const _e=he(Zt,ot),ht=ue.joinNormals[Zt];Cx(this.wallVertexArray,ht,_e),Cx(this.wallVertexArray,ht,_e)}if(Lt.vertexLength+=4,this.indexArray.emplaceBack(Wn+0,Wn+1,Wn+2),this.indexArray.emplaceBack(Wn+1,Wn+3,Wn+2),Lt.primitiveLength+=2,Me){const _e=gt+(Zt===1?ot.length-2:Zt-2),ht=Zt===1?gt:_e+1;if(this.indexArray.emplaceBack(Wn+1,_e,Wn+3),this.indexArray.emplaceBack(_e,ht,Wn+3),Lt.primitiveLength+=2,xt===void 0&&(xt=Wn),!GE(Jr,ot[Zt],ut)){const Ht=Zt===ot.length-1?xt:Lt.vertexLength;this.indexArray.emplaceBack(Wn+2,Wn+3,Ht),this.indexArray.emplaceBack(Wn+3,Ht+1,Ht),this.indexArray.emplaceBack(Wn+3,ht,Ht+1),Lt.primitiveLength+=3}tr=!tr}if(L){const _e=this.layoutVertexExtArray,ht=R.projectTilePoint(Jt.x,Jt.y,g),Ht=R.projectTilePoint(Tr.x,Tr.y,g),ft=R.upVector(g,Jt.x,Jt.y),Xt=R.upVector(g,Tr.x,Tr.y);Ax(_e,ht,ft),Ax(_e,ht,ft),Ax(_e,Ht,Xt),Ax(_e,Ht,Xt)}}z&&(gt+=ot.length-1),te&&Me&&this.zoom>=17&&(Nt.length!==0&&ct(Nt,Nt[0])&&Nt.pop(),this.groundEffect.addData(Nt,ut,k,Me>0))}this.footprintSegments.push(_t),kt.triangleCount=this.indexArray.length-kt.triangleArrayOffset,this.polygonSegments.push(kt),++J.footprintSegLen,++J.polygonSegLen}if(J.vertexCount=this.layoutVertexArray.length-J.vertexArrayOffset,J.groundVertexCount=this.groundEffect.vertexArray.length-J.groundVertexArrayOffset,J.vertexCount!==0){if(J.centroidXY=W.borders?tM:this.encodeCentroid(W,J),this.centroidData.push(J),W.borders){this.featuresOnBorder.push(W);const We=this.featuresOnBorder.length-1;for(let ut=0;ut<W.borders.length;ut++)W.borders[ut][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[ut].push(We)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,h,y,b,g,E,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(s,h,y,b,g,E,this.worldview),this.maxHeight=Math.max(this.maxHeight,ae)}}sortBorders(){for(let r=0;r<this.borderFeatureIndices.length;r++)this.borderFeatureIndices[r].sort((s,u)=>this.featuresOnBorder[s].borders[r][0]-this.featuresOnBorder[u].borders[r][0])}splitToSubtiles(){const r=[];for(let b=0;b<this.centroidData.length;b++){const T=this.centroidData[b],E=+(T.min.y+T.max.y>Vt),k=2*E+(+(T.min.x+T.max.x>Vt)^E);for(let P=0;P<T.polygonSegLen;P++){const R=T.polygonSegIdx+P;r.push({centroidIdx:b,subtile:k,polygonSegmentIdx:R,triangleSegmentIdx:this.polygonSegments[R].triangleSegIdx})}}const s=new Ui;r.sort((b,T)=>b.triangleSegmentIdx===T.triangleSegmentIdx?b.subtile-T.subtile:b.triangleSegmentIdx-T.triangleSegmentIdx);let u=0,h=0,g=0;for(const b of r){if(b.triangleSegmentIdx!==u)break;g++}const y=r.length;for(;h!==r.length;){u=r[h].triangleSegmentIdx;let b=0,T=h,E=h;for(let k=T;k<g&&r[k].subtile===b;k++)E++;for(;T!==g;){const k=r[T];b=k.subtile;const P=this.centroidData[k.centroidIdx].min.clone(),R=this.centroidData[k.centroidIdx].max.clone(),L={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:s.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let z=T;z<E;z++){const W=r[z],J=this.polygonSegments[W.polygonSegmentIdx],te=this.centroidData[W.centroidIdx].min,ae=this.centroidData[W.centroidIdx].max,ue=this.indexArray.uint16;for(let he=J.triangleArrayOffset;he<J.triangleArrayOffset+J.triangleCount;he++)s.emplaceBack(ue[3*he],ue[3*he+1],ue[3*he+2]);L.primitiveLength+=J.triangleCount,P.x=Math.min(P.x,te.x),P.y=Math.min(P.y,te.y),R.x=Math.max(R.x,ae.x),R.y=Math.max(R.y,ae.y)}L.primitiveLength>0&&this.triangleSubSegments.push({segment:L,min:P,max:R}),T=E;for(let z=T;z<g&&r[z].subtile===r[T].subtile;z++)E++}h=g;for(let k=h;k<y&&r[k].triangleSegmentIdx===r[h].triangleSegmentIdx;k++)g++}s._trim(),this.indexArray=s}getVisibleSegments(r,s,u){const h=new Zi;if(this.wallMode){for(const W of this.triangleSubSegments)h.segments.push(W.segment);return h}let g=0,y=0;const b=1<<r.canonical.z;if(s){const W=s.getMinMaxForTile(r);W&&(g=W.min,y=W.max)}y+=this.maxHeight;const T=r.toUnwrapped();let E;const k=[T.canonical.x/b+T.wrap,T.canonical.y/b],P=[(T.canonical.x+1)/b+T.wrap,(T.canonical.y+1)/b],R=(W,J,te)=>[W[0]*(1-te[0])+J[0]*te[0],W[1]*(1-te[1])+J[1]*te[1]],L=[],z=[];for(const W of this.triangleSubSegments){L[0]=W.min.x/Vt,L[1]=W.min.y/Vt,z[0]=W.max.x/Vt,z[1]=W.max.y/Vt;const J=R(k,P,L),te=R(k,P,z);if(new dn([J[0],J[1],g],[te[0],te[1],y]).intersectsPrecise(u)===0){E&&(h.segments.push(E),E=void 0);continue}const ae=W.segment;E&&E.vertexOffset!==ae.vertexOffset&&(h.segments.push(E),E=void 0),E?(E.vertexLength+=ae.vertexLength,E.primitiveLength+=ae.primitiveLength):E={vertexOffset:ae.vertexOffset,primitiveLength:ae.primitiveLength,vertexLength:ae.vertexLength,primitiveOffset:ae.primitiveOffset,sortKey:void 0,vaos:{}}}return E&&h.segments.push(E),h}encodeCentroid(r,s){const u=r.centroid(),h=s.span(),g=Math.min(7,Math.round(h.x*this.tileToMeter/10)),y=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new wt(se(u.x,1,Vt-1)<<3|g,se(u.y,1,Vt-1)<<3|y)}encodeBorderCentroid(r){if(!r.borders)return new wt(0,0);const s=r.borders,u=Number.MAX_VALUE;if(s[0][0]!==u||s[1][0]!==u){const h=s[0][0]!==u?0:1;return new wt(6|(s[0][0]!==u?0:65528),(s[h][0]+s[h][1])/2<<3|6)}{const h=s[2][0]!==u?2:3;return new wt((s[h][0]+s[h][1])/2<<3|6,6|(s[2][0]!==u?0:65528))}}showCentroid(r){const s=this.centroidData[r.centroidDataIndex];s.flags&=2147483647,s.centroidXY.x=0,s.centroidXY.y=0,this.writeCentroidToBuffer(s)}writeCentroidToBuffer(r){this.groundEffect.updateHiddenByLandmark(r);const s=r.vertexArrayOffset,u=r.vertexCount+r.vertexArrayOffset,h=r.flags&$h?tM:r.centroidXY,g=this.centroidVertexArray.geta_centroid_pos0(s);if(this.centroidVertexArray.geta_centroid_pos1(s)!==h.y||g!==h.x){for(let y=s;y<u;++y)this.centroidVertexArray.emplace(y,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const r of this.centroidData)this.writeCentroidToBuffer(r)}updateReplacement(r,s,u){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const h=s.getReplacementRegionsForTile(r.toUnwrapped());if(Kw(this.activeReplacements,h))return;if(this.activeReplacements=h,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const y of this.centroidData)y.flags&=2147483647;const g=[];for(const y of this.activeReplacements){if(y.order<u)continue;const b=Math.max(1,Math.pow(2,y.footprintTileId.canonical.z-r.canonical.z));if(y.footprint.buildingId){const T=y.footprint.buildingId;for(const E of this.centroidData)E.buildingId===T&&(E.flags|=$h)}else for(const T of this.centroidData)if(!(T.flags&$h||y.min.x>T.max.x||T.min.x>y.max.x||y.min.y>T.max.y||T.min.y>y.max.y))for(let E=0;E<T.footprintSegLen;E++){const k=this.footprintSegments[T.footprintSegIdx+E];if(g.length=0,hq(this.footprintVertices,k.vertexOffset,k.vertexCount,y.footprintTileId.canonical,r.canonical,g),BE(y.footprint,g,this.footprintIndices.uint16,k.indexOffset,k.indexCount,-k.vertexOffset,-b)){T.flags|=$h;break}}}for(const y of this.centroidData)this.writeCentroidToBuffer(y);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(r,s,u){let h=!1;for(let g=0;g<u.footprintSegLen;g++){const y=this.footprintSegments[u.footprintSegIdx+g];let b=0;for(const T of y.ringIndices){for(let E=b,k=T+b-1;E<T+b;k=E++){const P=this.footprintVertices.int16[2*(E+y.vertexOffset)+0],R=this.footprintVertices.int16[2*(E+y.vertexOffset)+1],L=this.footprintVertices.int16[2*(k+y.vertexOffset)+1];R>s!=L>s&&r<(this.footprintVertices.int16[2*(k+y.vertexOffset)+0]-P)*(s-R)/(L-R)+P&&(h=!h)}b=T}}return h}getHeightAtTileCoord(r,s){let u=Number.NEGATIVE_INFINITY,h=!0;const g=4*(r+Vt)*Vt+(s+Vt);if(this.partLookup.hasOwnProperty(g)){const y=this.partLookup[g];return y?{height:y.height,hidden:!!(y.flags&$h)}:void 0}for(const y of this.centroidData)r>y.max.x||y.min.x>r||s>y.max.y||y.min.y>s||y.height<=u||this.footprintContainsPoint(r,s,y)&&(u=y.height,this.partLookup[g]=y,h=!!(y.flags&$h));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:h};this.partLookup[g]=void 0}}function lM(a,r){const s=a.add(r)._unit();return a.x*s.x+a.y*s.y}function dq(a,r,s,u){const h=r.sub(a)._perp()._unit(),g=s.sub(r)._perp()._unit();return cM(a,r,s,lM(h,g),u)}function cM(a,r,s,u,h){const g=Math.sqrt(1-u*u);return Math.min(a.dist(r)/3,r.dist(s)/3,h*g/u)}function GE(a,r,s){return a.x<s[0].x&&r.x<s[0].x||a.x>s[1].x&&r.x>s[1].x||a.y<s[0].y&&r.y<s[0].y||a.y>s[1].y&&r.y>s[1].y}function uM(a,r){return a.x<r[0].x||a.x>r[1].x||a.y<r[0].y||a.y>r[1].y}function dM(a,r,s){if(a.x<0||a.x>=Vt||r.x<0||r.x>=Vt||s.x<0||s.x>=Vt)return!1;const u=s.sub(r),h=u.perp(),g=a.sub(r);return(u.x*g.x+u.y*g.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(g.x*g.x+g.y*g.y))>-.866&&h.x*g.x+h.y*g.y<0}function hM(a,r,s){const u=r?2|a:-3&a;return s?1|u:-2&u}function fM(){const a=Math.PI/32,r=Math.tan(a),s=M;return s*Math.sqrt(1+2*r*r)-s}function pM(a,r,s){const u=1<<s.z,h=me(s.x/u),g=me((s.x+1)/u),y=de(s.y/u),b=de((s.y+1)/u);return function(T,E,k,P,R=0,L){const z=[];if(!T.length||!k||!P)return z;const W=(be,ke)=>{for(const Me of be)z.push({polygon:Me,bounds:ke})},J=Math.ceil(Math.log2(k)),te=Math.ceil(Math.log2(P)),ae=J-te,ue=[];for(let be=0;be<Math.abs(ae);be++)ue.push(ae>0?0:1);for(let be=0;be<Math.min(J,te);be++)ue.push(0),ue.push(1);let he=T;if(he=Ww(he,E[0].y-R,E[1].y+R,1),he=Ww(he,E[0].x-R,E[1].x+R,0),!he.length)return z;const Ce=[];for(ue.length?Ce.push({polygons:he,bounds:E,depth:0}):W(he,E);Ce.length;){const be=Ce.pop(),ke=be.depth,Me=ue[ke],ze=be.bounds[0],ct=be.bounds[1],We=Me===0?ze.x:ze.y,ut=Me===0?ct.x:ct.y,gt=L?L(Me,We,ut):.5*(We+ut),St=Ww(be.polygons,We-R,gt+R,Me),Lt=Ww(be.polygons,gt-R,ut+R,Me);if(St.length){const kt=[ze,new wt(Me===0?gt:ct.x,Me===1?gt:ct.y)];ue.length>ke+1?Ce.push({polygons:St,bounds:kt,depth:ke+1}):W(St,kt)}if(Lt.length){const kt=[new wt(Me===0?gt:ze.x,Me===1?gt:ze.y),ct];ue.length>ke+1?Ce.push({polygons:Lt,bounds:kt,depth:ke+1}):W(Lt,kt)}}return z}(a,r,Math.ceil((g-h)/11.25),Math.ceil((y-b)/11.25),1,(T,E,k)=>{if(T===0)return .5*(E+k);{const P=de((s.y+E/Vt)/u);return(ie(.5*(de((s.y+k/Vt)/u)+P))*u-s.y)*Vt}})}function hq(a,r,s,u,h,g){const y=Math.pow(2,u.z-h.z);for(let b=0;b<s;b++){let T=a.int16[2*(b+r)+0],E=a.int16[2*(b+r)+1];T=(T+h.x*Vt)*y-u.x*Vt,E=(E+h.y*Vt)*y-u.y*Vt,g.push(new wt(T,E))}}let mM,gM;or(Jw,"FillExtrusionBucket",{omit:["layers","features"]}),or(sM,"PartData"),or(iM,"FootprintSegment"),or(oM,"BorderCentroidData"),or(qE,"GroundEffect");class Wp extends wt{constructor(r,s,u){super(r,s),this.z=u}}class _M extends Wp{constructor(r,s,u,h){super(r,s,u),this.w=h}}function yM(a,r,s,u){const h=s==="x"?"y":"x",g=(u-a[s])/(r[s]-a[s]);a[h]=Math.round(a[h]+(r[h]-a[h])*g),a[s]=u,a.hasOwnProperty("z")&&(a.z=Br(a.z,r.z,g)),a.hasOwnProperty("w")&&(a.w=Br(a.w,r.w,g))}function vM(a,r,s,u){const h=s,g=u;for(const y of["x","y"]){let b=a,T=r;b[y]>=T[y]&&(b=r,T=a),b[y]<h&&T[y]>h&&yM(b,T,y,h),b[y]<g&&T[y]>g&&yM(T,b,y,g)}}function Qw(a,r,s,u,h,g){const y=[];for(let b=0;b<a.length;b++){const T=a[b];let E;const k=y.length;let P=0;for(let R=0;R<T.length-1;R++){let L=T[R],z=T[R+1],W=0;const J=P;let te,ae;g&&(W=Math.hypot(z.x-L.x,z.y-L.y),P+=W,te=L,ae=z),L.x<r&&z.x<r||(L.x<r?L=new wt(r,L.y+(r-L.x)/(z.x-L.x)*(z.y-L.y))._round():z.x<r&&(z=new wt(r,L.y+(r-L.x)/(z.x-L.x)*(z.y-L.y))._round()),L.y<s&&z.y<s||(L.y<s?L=new wt(L.x+(s-L.y)/(z.y-L.y)*(z.x-L.x),s)._round():z.y<s&&(z=new wt(L.x+(s-L.y)/(z.y-L.y)*(z.x-L.x),s)._round()),L.x>=u&&z.x>=u||(L.x>=u?L=new wt(u,L.y+(u-L.x)/(z.x-L.x)*(z.y-L.y))._round():z.x>=u&&(z=new wt(u,L.y+(u-L.x)/(z.x-L.x)*(z.y-L.y))._round()),L.y>=h&&z.y>=h||(L.y>=h?L=new wt(L.x+(h-L.y)/(z.y-L.y)*(z.x-L.x),h)._round():z.y>=h&&(z=new wt(L.x+(h-L.y)/(z.y-L.y)*(z.x-L.x),h)._round()),E&&L.equals(E[E.length-1])||(E=[L],y.push(E),g&&g.push({progress:{min:J+xM(te,ae,L)*W,max:1},parentIndex:b,prevPoint:te,nextPoint:ae})),E.push(z),g&&(g[g.length-1].progress.max=J+xM(te,ae,z)*W,g[g.length-1].nextPoint=ae)))))}if(g&&P>0)for(let R=k;R<y.length;R++)g[R].progress.min/=P,g[R].progress.max/=P}return y}function fq(a,r,s,u,h){if(a.length<2)return void u.push(a);const g=[];for(;r.valid();){const[E,k]=r.get();for(let P=0;P<a.length-1;P++){const R=a[P],L=a[P+1],z=Da(R,L,E,k);if(z){const[W]=z,J=new wt(Br(R.x,L.x,W),Br(R.y,L.y,W));g.push({t:P+W,distance:0,point:J})}}r.next()}if(g.length===0)return void u.push(a);g.sort((E,k)=>E.t-k.t);let y=0,b=0,T=[];for(u.push(T);y!==a.length;){if(b===g.length){for(;y!==a.length;)T.length!==0&&T[T.length-1].equals(a[y])||T.push(a[y]),y++;break}g[b].t<=y?(T.length!==0&&T[T.length-1].equals(g[b].point)||T.push(g[b].point),Math.trunc(g[b].t),b++):(T.length!==0&&T[T.length-1].equals(a[y])||T.push(a[y]),y++)}}function xM(a,r,s){return a.x!==r.x?(s.x-a.x)/(r.x-a.x):a.y!==r.y?(s.y-a.y)/(r.y-a.y):0}function jx(a,r){return a.x*r.x+a.y*r.y}function bM(a,r){if(a.length===1){let s=0;const u=r[s++];let h;for(;!h||u.equals(h);)if(h=r[s++],!h)return 1/0;for(;s<r.length;s++){const g=r[s],y=a[0],b=h.sub(u),T=g.sub(u),E=y.sub(u),k=jx(b,b),P=jx(b,T),R=jx(T,T),L=jx(E,b),z=jx(E,T),W=k*R-P*P,J=(R*L-P*z)/W,te=(k*z-P*L)/W,ae=u.z*(1-J-te)+h.z*J+g.z*te;if(isFinite(ae))return ae}return 1/0}{let s=1/0;for(const u of r)s=Math.min(s,u.z);return s}}function wM(a,r,s){let u=1/0;ss(s,r)&&(u=bM(s,r[0]));for(let h=0;h<r.length;h++){const g=r[h],y=a[h];for(let b=0;b<g.length-1;b++){const T=g[b],E=[T,g[b+1],y[b+1],y[b],T];ds(s,E)&&(u=Math.min(u,bM(s,E)))}}return u!==1/0&&u}function SM(a,r,s,u,h,g,y,b,T,E,k){return a.projection.name==="globe"?function(P,R,L,z,W,J,te,ae,ue,he,Ce){const be=[],ke=[],Me=P.projection.upVectorScale(Ce,P.center.lat,P.worldSize).metersToTile,ze=[0,0,0,1],ct=[0,0,0,1],We=(gt,St,Lt,kt)=>{gt[0]=St,gt[1]=Lt,gt[2]=kt,gt[3]=1},ut=fM();L>0&&(L+=ut),z+=ut;for(const gt of R){const St=[],Lt=[];for(const kt of gt){const _t=kt.x+W.x,It=kt.y+W.y,ot=P.projection.projectTilePoint(_t,It,Ce),rt=P.projection.upVector(Ce,kt.x,kt.y);let At=L,Nt=z;if(te){const xt=TM(_t,It,L,z,te,ae,ue,he);At+=xt.base,Nt+=xt.top}L!==0?We(ze,ot.x+rt[0]*Me*At,ot.y+rt[1]*Me*At,ot.z+rt[2]*Me*At):We(ze,ot.x,ot.y,ot.z),We(ct,ot.x+rt[0]*Me*Nt,ot.y+rt[1]*Me*Nt,ot.z+rt[2]*Me*Nt),hn(ze,ze,J),hn(ct,ct,J),St.push(new Wp(ze[0],ze[1],ze[2])),Lt.push(new Wp(ct[0],ct[1],ct[2]))}be.push(St),ke.push(Lt)}return[be,ke]}(a,r,s,u,h,g,y,b,T,E,k):y?function(P,R,L,z,W,J,te,ae,ue){const he=[],Ce=[],be=[0,0,0,1];for(const ke of P){const Me=[],ze=[];for(const ct of ke){const We=ct.x+z.x,ut=ct.y+z.y,gt=TM(We,ut,R,L,J,te,ae,ue);be[0]=We,be[1]=ut,be[2]=gt.base,be[3]=1,yr(be,be,W),be[3]=Math.max(be[3],1e-5);const St=new Wp(be[0]/be[3],be[1]/be[3],be[2]/be[3]);be[0]=We,be[1]=ut,be[2]=gt.top,be[3]=1,yr(be,be,W),be[3]=Math.max(be[3],1e-5);const Lt=new Wp(be[0]/be[3],be[1]/be[3],be[2]/be[3]);Me.push(St),ze.push(Lt)}he.push(Me),Ce.push(ze)}return[he,Ce]}(r,s,u,h,g,y,b,T,E):function(P,R,L,z,W){const J=[],te=[],ae=W[8]*R,ue=W[9]*R,he=W[10]*R,Ce=W[11]*R,be=W[8]*L,ke=W[9]*L,Me=W[10]*L,ze=W[11]*L;for(const ct of P){const We=[],ut=[];for(const gt of ct){const St=gt.x+z.x,Lt=gt.y+z.y,kt=W[0]*St+W[4]*Lt+W[12],_t=W[1]*St+W[5]*Lt+W[13],It=W[2]*St+W[6]*Lt+W[14],ot=W[3]*St+W[7]*Lt+W[15],rt=kt+ae,At=_t+ue,Nt=It+he,xt=Math.max(ot+Ce,1e-5),sr=kt+be,cr=_t+ke,tr=It+Me,Zt=Math.max(ot+ze,1e-5);We.push(new Wp(rt/xt,At/xt,Nt/xt)),ut.push(new Wp(sr/Zt,cr/Zt,tr/Zt))}J.push(We),te.push(ut)}return[J,te]}(r,s,u,h,g)}function TM(a,r,s,u,h,g,y,b){const T=y*h.getElevationAt(a,r,!0,!0),E=g[0]!==0,k=E?g[1]===0?y*(g[0]/rM-nM):y*function(P,R,L){const z=Math.floor(R[0]/8),W=Math.floor(R[1]/8),J=10*(R[0]-8*z),te=10*(R[1]-8*W),ae=P.getElevationAt(z,W,!0,!0),ue=P.getMeterToDEM(L),he=Math.floor(.5*(J*ue-1)),Ce=Math.floor(.5*(te*ue-1)),be=P.tileCoordToPixel(z,W),ke=2*he+1,Me=2*Ce+1,ze=function(Lt,kt,_t,It,ot){return[Lt.getElevationAtPixel(kt,_t,!0),Lt.getElevationAtPixel(kt+ot,_t,!0),Lt.getElevationAtPixel(kt,_t+ot,!0),Lt.getElevationAtPixel(kt+It,_t+ot,!0)]}(P,be.x-he,be.y-Ce,ke,Me),ct=Math.abs(ze[0]-ze[1]),We=Math.abs(ze[2]-ze[3]),ut=Math.abs(ze[0]-ze[2])+Math.abs(ze[1]-ze[3]),gt=Math.min(.25,.5*ue*(ct+We)/ke),St=Math.min(.25,.5*ue*ut/Me);return ae+Math.max(gt*J,St*te)}(h,g,b):T;return{base:T+(s===0?-1:s),top:E?Math.max(k+u,T+s+2):T+u}}class pq{constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class mq{constructor(){this.tasks={},this.taskQueue=[],tt(["process"],this),this.invoker=new pq(this.process),this.nextId=0}add(r,s){const u=this.nextId++,h=function({type:g,isSymbolTile:y,zoom:b}){return b=b||0,g==="message"?0:g!=="maybePrepare"||y?g!=="parseTile"||y?g==="parseTile"&&y?300-b:g==="maybePrepare"&&y?400-b:500:200-b:100-b}(s);if(h===0){try{r()}finally{}return null}return this.tasks[u]={fn:r,metadata:s,priority:h,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const r=this.pick();if(r===null)return;const s=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let r=null,s=1/0;for(let h=0;h<this.taskQueue.length;h++){const g=this.tasks[this.taskQueue[h]];g.priority<s&&(s=g.priority,r=h)}if(r===null)return null;const u=this.taskQueue[r];return this.taskQueue.splice(r,1),u}remove(){this.invoker.remove()}}class EM{constructor(r,s,u){this.target=r,this.parent=s,this.mapId=u,this.callbacks={},this.cancelCallbacks={},tt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new mq}send(r,s,u,h,g=!1,y){const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=y,this.callbacks[b]=u);const T=new Set;return this.target.postMessage({id:b,type:r,hasCallback:!!u,targetMapId:h,mustQueue:g,sourceMapId:this.mapId,data:Cu(s,T)},T),{cancel:()=>{u&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(r){const s=r.data;if(!s)return;const u=s.id;if(u&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){const h=this.cancelCallbacks[u];delete this.cancelCallbacks[u],h&&h.cancel()}else if(s.mustQueue||ns(self)){const h=this.callbacks[u],g=this.scheduler.add(()=>this.processTask(u,s),h&&h.metadata||{type:"message"});g&&(this.cancelCallbacks[u]=g)}else this.processTask(u,s)}processTask(r,s){if(delete this.cancelCallbacks[r],s.type==="<response>"){const u=this.callbacks[r];delete this.callbacks[r],u&&(s.error?u(Au(s.error)):u(null,Au(s.data)))}else{const u=new Set,h=s.hasCallback?(y,b)=>{this.target.postMessage({id:r,type:"<response>",sourceMapId:this.mapId,error:y?Cu(y):null,data:Cu(b,u)},u)}:()=>{},g=Au(s.data);if(this.parent[s.type])this.parent[s.type](s.sourceMapId,g,h);else if(this.parent.getWorkerSource){const y=s.type.split("."),{source:b,scope:T}=g;this.parent.getWorkerSource(s.sourceMapId,y[0],b,T)[y[1]](g,h)}else h(new Error(`Could not find function ${s.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Ix={workerUrl:"",workerClass:null,workerParams:void 0};const HE="mapboxgl_preloaded_worker_pool";class Zp{constructor(){this.active={}}acquire(r,s=Zp.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<s;)this.workers.push(Ix.workerClass!=null?new Ix.workerClass:new self.Worker(Ix.workerUrl,Ix.workerParams));return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.workers&&this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[HE]}numActive(){return Object.keys(this.active).length}}Zp.workerCount=2;class e_{constructor(r,s,u="Worker",h=Zp.workerCount){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=it();const g=this.workerPool.acquire(this.id,h);for(let y=0;y<g.length;y++){const b=new e_.Actor(g[y],s,this.id);b.name=`${u} ${y}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,s,u){Pe(this.actors,(h,g)=>{h.send(r,s,g)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}let kx,WE;function e1(){return kx||(kx=new Zp),kx}e_.Actor=EM;class gq{constructor(r){this.module=r}createIntArray(r){const s=new Int32Array(r),u=this.module.malloc(s.length*s.BYTES_PER_ELEMENT);return this.module.heap32.set(s,u/s.BYTES_PER_ELEMENT),u}createFloatArray(r){const s=new Float32Array(r),u=this.module.malloc(s.length*s.BYTES_PER_ELEMENT);return this.module.heapF32.set(s,u/s.BYTES_PER_ELEMENT),u}createStringBuffer(r){const s=this.module.malloc(r.length+1);for(let u=0;u<r.length;++u)this.module.heapU8[s+u]=r.charCodeAt(u);return this.module.heapU8[s+r.length]=0,s}readStringBuffer(r){let s="";for(;this.module.heapU8[r]!==0;)s+=String.fromCharCode(this.module.heapU8[r]),++r;return s}setStyle(r){const s=r.entranceColorRgb,u=r.facadeGlazingColorRgb,h=r.roofColorRgb,g=r.wallColorRgb,y=r.normalScale;this.module.setStyle(s[0],s[1],s[2],u[0],u[1],u[2],h[0],h[1],h[2],g[0],g[1],g[2],y[0],y[1],y[2],r.tileToMeters)}setAOOptions(r,s){this.module.setAOOptions(r?1:0,s)}setMetricOptions(r,s){this.module.setMetricOptions(r?1:0,s)}setStructuralOptions(r){this.module.setStructuralOptions(r?1:0)}setFacadeOptions(r,s){this.module.setFacadeOptions(r,s?1:0)}setFauxFacadeOptions(r,s,u){this.module.setFauxFacadeOptions(r?1:0,s?1:0,u)}setFacadeClassifierOptions(r){this.module.setFacadeClassifierOptions(r)}generateMesh(r,s){for(const b of r){const T=this.createStringBuffer(b.roofType),E=[0],k=[];for(const L of b.coordinates)if(Array.isArray(L)){for(const z of L)k.push(z.x),k.push(z.y);E.push(k.length)}const P=this.createIntArray(E),R=this.createFloatArray(k);this.module.addFeature(b.id,b.sourceId,b.minHeight,b.height,T,b.roofType.length,R,P,E.length-1),this.module.free(T),this.module.free(P),this.module.free(R)}for(const b of s){let T;T=b.entrances?JSON.parse(b.entrances):[];const E=this.createFloatArray(T),k=[];for(const R of b.coordinates)k.push(R.x),k.push(R.y);const P=this.createFloatArray(k);this.module.addFacade(b.sourceId,b.crossPerc,b.distanceToRoad,E,T.length,P,k.length),this.module.free(E),this.module.free(P)}if(!this.module.generateMesh()){const b=this.module.getLastError();return this.readStringBuffer(b)}const u=this.module.getMeshCount(),h=new Array(u);for(let b=0;b<u;b++){const T=this.module.getPositionsPtr(b),E=this.module.getPositionsLength(b),k=new Float32Array(this.module.heapF32.buffer,T,E),P=this.module.getNormalsPtr(b),R=this.module.getNormalsLength(b),L=new Float32Array(this.module.heapF32.buffer,P,R),z=this.module.getColorsPtr(b),W=this.module.getColorsLength(b),J=new Uint8Array(this.module.heapU8.buffer,z,W),te=this.module.getAOPtr(b),ae=this.module.getAOLength(b),ue=new Float32Array(this.module.heapF32.buffer,te,ae),he=this.module.getUVPtr(b),Ce=this.module.getUVLength(b),be=new Float32Array(this.module.heapF32.buffer,he,Ce),ke=this.module.getFauxFacadePtr(b),Me=this.module.getFauxFacadeLength(b),ze=new Uint8Array(this.module.heapU8.buffer,ke,Me),ct=this.module.getIndicesPtr(b),We=this.module.getIndicesLength(b),ut=new Int32Array(this.module.heap32.buffer,ct,We),gt=this.module.getBuildingPart(b),St=this.readStringBuffer(gt);h[b]={positions:k,normals:L,colors:J,ao:ue,uv:be,isFauxFacade:ze,indices:ut,buildingPart:St}}const g=this.module.getRingCount(),y=[];for(let b=0;b<g;b++){const T=this.module.getRingPtr(b),E=this.module.getRingLength(b),k=new Float32Array(this.module.heapF32.buffer,T,E);y.push(k)}return{meshes:h,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:y}}}let Px,ZE,Vc,t_,XE,r_=null,n_=null,CM=null,t1=null;function AM(){return ns(self)&&self.worker.dracoUrl?self.worker.dracoUrl:ZE||Di.DRACO_URL}function jM(){if(ns(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(t_)return t_;const a=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return t_=WebAssembly.validate(a)?Di.MESHOPT_SIMD_URL:Di.MESHOPT_URL,t_}function _q(){return t1}const r1={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},yq={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Rx={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function IM(a,r,s){const u=s.json.bufferViews.length,h=s.buffers.length;r.bufferView=u,s.json.bufferViews[u]={buffer:h,byteLength:a.byteLength},s.buffers[h]=a}const KE="KHR_draco_mesh_compression";function vq(a,r){const s=a.extensions&&a.extensions[KE];if(!s)return;const u=new Vc.Decoder,h=MM(r,s.bufferView),g=new Vc.Mesh;if(!u.DecodeArrayToMesh(h,h.byteLength,g))throw new Error("Failed to decode Draco mesh");const y=r.json.accessors[a.indices],b=r1[y.componentType],T=y.count*b.BYTES_PER_ELEMENT,E=Vc._malloc(T);b===Uint16Array?u.GetTrianglesUInt16Array(g,T,E):u.GetTrianglesUInt32Array(g,T,E),IM(Vc.memory.buffer.slice(E,E+T),y,r),Vc._free(E);for(const k of Object.keys(s.attributes)){const P=u.GetAttributeByUniqueId(g,s.attributes[k]),R=r.json.accessors[a.attributes[k]],L=yq[R.componentType],z=R.count*Rx[R.type]*r1[R.componentType].BYTES_PER_ELEMENT,W=Vc._malloc(z);u.GetAttributeDataArrayForAllPoints(g,P,Vc[L],z,W),IM(Vc.memory.buffer.slice(W,W+z),R,r),Vc._free(W)}u.destroy(),g.destroy(),delete a.extensions[KE]}const n1="EXT_meshopt_compression";function xq(a,r){if(!a.extensions||!a.extensions[n1])return;const s=a.extensions[n1],u=new Uint8Array(r.buffers[s.buffer],s.byteOffset||0,s.byteLength||0),h=new Uint8Array(s.count*s.byteStride);XE.decodeGltfBuffer(h,s.count,s.byteStride,u,s.mode,s.filter),a.buffer=r.buffers.length,a.byteOffset=0,r.buffers[a.buffer]=h.buffer,delete a.extensions[n1]}const kM=1179937895,PM=new TextDecoder("utf8");function RM(a,r){return new URL(a,r).href}function bq(a,r,s,u){return fetch(RM(a.uri,u)).then(h=>h.arrayBuffer()).then(h=>{r.buffers[s]=h})}function MM(a,r){const s=a.json.bufferViews[r];return new Uint8Array(a.buffers[s.buffer],s.byteOffset||0,s.byteLength)}function wq(a,r,s,u){if(a.uri){const h=RM(a.uri,u);return fetch(h).then(g=>g.blob()).then(g=>createImageBitmap(g)).then(g=>{r.images[s]=g})}if(a.bufferView!==void 0){const h=MM(r,a.bufferView),g=new Blob([h],{type:a.mimeType});return createImageBitmap(g).then(y=>{r.images[s]=y})}}function NM(a,r=0,s){const u={json:null,images:[],buffers:[]};if(new Uint32Array(a,r,1)[0]===kM){const k=new Uint32Array(a,r);let P=2;const R=(k[P++]>>2)-3,L=k[P++]>>2;if(P++,u.json=JSON.parse(PM.decode(k.subarray(P,P+L))),P+=L,P<R){const z=k[P++];P++;const W=r+(P<<2);u.buffers[0]=a.slice(W,W+z)}}else u.json=JSON.parse(PM.decode(new Uint8Array(a,r)));const{buffers:h,images:g,meshes:y,extensionsUsed:b,bufferViews:T}=u.json;let E=Promise.resolve();if(h){const k=[];for(let P=0;P<h.length;P++){const R=h[P];R.uri?k.push(bq(R,u,P,s)):u.buffers[P]||(u.buffers[P]=null)}E=Promise.all(k)}return E.then(()=>{const k=[],P=b&&b.includes(KE),R=b&&b.includes(n1);if(P&&k.push(function(){if(!Vc)return Px??(Px=function(L){let z,W=null;function J(){z=new Uint8Array(W.buffer)}function te(){throw new Error("Unexpected Draco error.")}const ae={a:{a:te,d:function(ue,he,Ce){return z.copyWithin(ue,he,he+Ce)},c:function(ue){const he=z.length,Ce=Math.max(ue>>>0,Math.ceil(1.2*he)),be=Math.ceil((Ce-he)/65536);try{return W.grow(be),J(),!0}catch{return!1}},b:te}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(L,ae):L.then(ue=>ue.arrayBuffer()).then(ue=>WebAssembly.instantiate(ue,ae))).then(ue=>{const{Rb:he,Qb:Ce,P:be,T:ke,X:Me,Ja:ze,La:ct,Qa:We,Va:ut,Wa:gt,eb:St,jb:Lt,f:kt,e:_t,yb:It,zb:ot,Ab:rt,Bb:At,Db:Nt,Gb:xt}=ue.instance.exports;W=_t;const sr=(()=>{let cr=0,tr=0,Zt=0,Xr=0;return Jt=>{Zt&&(he(Xr),he(cr),tr+=Zt,Zt=cr=0),cr||(tr+=128,cr=Ce(tr));const Tr=Jt.length+7&-8;let Jr=cr;Tr>=tr&&(Zt=Tr,Jr=Xr=Ce(Tr));for(let pn=0;pn<Jt.length;pn++)z[Jr+pn]=Jt[pn];return Jr}})();return J(),kt(),{memory:_t,_free:he,_malloc:Ce,Mesh:class{constructor(){this.ptr=be()}destroy(){ke(this.ptr)}},Decoder:class{constructor(){this.ptr=ze()}destroy(){Lt(this.ptr)}DecodeArrayToMesh(cr,tr,Zt){const Xr=sr(cr),Jt=ct(this.ptr,Xr,tr,Zt.ptr);return!!Me(Jt)}GetAttributeByUniqueId(cr,tr){return{ptr:We(this.ptr,cr.ptr,tr)}}GetTrianglesUInt16Array(cr,tr,Zt){ut(this.ptr,cr.ptr,tr,Zt)}GetTrianglesUInt32Array(cr,tr,Zt){gt(this.ptr,cr.ptr,tr,Zt)}GetAttributeDataArrayForAllPoints(cr,tr,Zt,Xr,Jt){St(this.ptr,cr.ptr,tr.ptr,Zt,Xr,Jt)}},DT_INT8:It(),DT_UINT8:ot(),DT_INT16:rt(),DT_UINT16:At(),DT_UINT32:Nt(),DT_FLOAT32:xt()}})}(fetch(AM())),Px.then(L=>{Vc=L,Px=void 0}))}()),R&&k.push(function(){if(XE)return;const L=function(z){let W;const J=WebAssembly.instantiateStreaming(z,{}).then(ue=>{W=ue.instance,W.exports.__wasm_call_ctors()}),te={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ae={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:J,supported:!0,decodeGltfBuffer(ue,he,Ce,be,ke,Me){(function(ze,ct,We,ut,gt,St,Lt){const kt=ze.exports.sbrk,_t=ut+3&-4,It=kt(_t*gt),ot=kt(St.length),rt=new Uint8Array(ze.exports.memory.buffer);rt.set(St,ot);const At=ct(It,ut,gt,ot,St.length);if(At===0&&Lt&&Lt(It,_t,gt),We.set(rt.subarray(It,It+ut*gt)),kt(It-kt(0)),At!==0)throw new Error(`Malformed buffer data: ${At}`)})(W,W.exports[ae[ke]],ue,he,Ce,be,W.exports[te[Me]])}}}(fetch(jM()));return L.ready.then(()=>{XE=L})}()),g)for(let L=0;L<g.length;L++)k.push(wq(g[L],u,L,s));return(k.length?Promise.all(k):Promise.resolve()).then(()=>{if(P&&y)for(const{primitives:L}of y)for(const z of L)vq(z,u);if(R&&y&&T)for(const L of T)xq(L,u);return u})})}function DM(a){return fetch(a).then(r=>r.arrayBuffer()).then(r=>NM(r,0,a))}function YE(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function JE(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class QE{constructor(r,s,u,h){this.context=r,this.format=u,this.useMipmap=h&&h.useMipmap,this.texture=r.gl.createTexture(),this.update(s,{premultiply:h&&h.premultiply})}update(r,s){const u=r&&r instanceof HTMLVideoElement&&r.width===0?r.videoWidth:r.width,h=r&&r instanceof HTMLVideoElement&&r.height===0?r.videoHeight:r.height,{context:g}=this,{gl:y}=g,{x:b,y:T}=s&&s.position?s.position:{x:0,y:0},E=b+u,k=T+h;!this.size||this.size[0]===E&&this.size[1]===k||(y.bindTexture(y.TEXTURE_2D,null),y.deleteTexture(this.texture),this.texture=y.createTexture(),this.size=null),y.bindTexture(y.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA8&&(!s||s.premultiply!==!1));const P=r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||ImageBitmap&&r instanceof ImageBitmap;if(!this.size&&E>0&&k>0){const R=this.useMipmap?Math.floor(Math.log2(Math.max(E,k)))+1:1;y.texStorage2D(y.TEXTURE_2D,R,this.format,E,k),this.size=[E,k]}this.size&&(P?y.texSubImage2D(y.TEXTURE_2D,0,b,T,YE(this.format),JE(this.format),r):"data"in r&&r.data&&y.texSubImage2D(y.TEXTURE_2D,0,b,T,u,h,YE(this.format),JE(this.format),r.data)),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(r,s,u=!1){const{context:h}=this,{gl:g}=h;g.bindTexture(g.TEXTURE_2D,this.texture),r!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,r),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,this.useMipmap&&!u?r===g.NEAREST?g.NEAREST_MIPMAP_NEAREST:g.LINEAR_MIPMAP_LINEAR:r),this.minFilter=r),s!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,s),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,s),this.wrapS=s)}bindExtraParam(r,s,u,h,g){const{context:y}=this,{gl:b}=y;b.bindTexture(b.TEXTURE_2D,this.texture),s!==this.magFilter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,s),this.magFilter=s),r!==this.minFilter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,this.useMipmap?r===b.NEAREST?b.NEAREST_MIPMAP_NEAREST:b.LINEAR_MIPMAP_LINEAR:r),this.minFilter=r),u!==this.wrapS&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,u),this.wrapS=u),h!==this.wrapT&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,h),this.wrapT=h),g!==this.compareMode&&(g?(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_COMPARE_MODE,b.COMPARE_REF_TO_TEXTURE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_COMPARE_FUNC,g)):b.texParameteri(b.TEXTURE_2D,b.TEXTURE_COMPARE_MODE,b.NONE),this.compareMode=g)}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class Mx{constructor(r,s){this.context=r,this.texture=s}bind(r,s){const{context:u}=this,{gl:h}=u;h.bindTexture(h.TEXTURE_2D,this.texture),r!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,r),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,r),this.minFilter=r),s!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,s),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,s),this.wrapS=s)}}const Sq=vn([{name:"a_pos_3f",components:3,type:"Float32"}]),Tq=vn([{name:"a_color_3f",components:3,type:"Float32"}]),Eq=vn([{name:"a_color_4f",components:4,type:"Float32"}]),Cq=vn([{name:"a_uv_2f",components:2,type:"Float32"}]),Aq=vn([{name:"a_normal_3f",components:3,type:"Float32"}]),jq=vn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),Iq=vn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function OM(a,r){const s=i1(a.projection,a.zoom,a.width,a.height),u=function(g,y,b,T,E){const k=new B(b.lng-180*qh,b.lat),P=new B(b.lng+180*qh,b.lat),R=g.project(k.lng,k.lat),L=g.project(P.lng,P.lat),z=-Math.atan2(L.y-R.y,L.x-R.x),W=$e.fromLngLat(b);W.y=se(W.y,-1+qh,1-qh);const J=W.toLngLat(),te=g.project(J.lng,J.lat),ae=$e.fromLngLat(J);ae.x+=qh;const ue=ae.toLngLat(),he=g.project(ue.lng,ue.lat),Ce=zM(he.x-te.x,he.y-te.y,z),be=$e.fromLngLat(J);be.y+=qh;const ke=be.toLngLat(),Me=g.project(ke.lng,ke.lat),ze=zM(Me.x-te.x,Me.y-te.y,z),ct=Math.abs(Ce.x)/Math.abs(ze.y),We=Z([]);Ae(We,We,-z*(1-(E?0:T)));const ut=Z([]);return ne(ut,ut,[1,1-(1-ct)*T,1]),ut[4]=-ze.x/ze.y*T,Ae(ut,ut,z),H(ut,We,ut),ut}(a.projection,0,a.center,s,r),h=LM(a);return ne(u,u,[h,h,1]),u}function LM(a){const r=a.projection,s=i1(a.projection,a.zoom,a.width,a.height),u=eC(r,a.center),h=eC(r,B.convert(r.center));return Math.pow(2,u*s+(1-s)*h)}function i1(a,r,s,u,h=1/0){const g=a.range;if(!g)return 0;const y=Math.min(h,Math.max(s,u)),b=Math.log2(y/1024);return ye(g[0]+b,g[1]+b,r)}const qh=1/4e4;function eC(a,r){const s=se(r.lat,-ge,ge),u=new B(r.lng-180*qh,s),h=new B(r.lng+180*qh,s),g=a.project(u.lng,s),y=a.project(h.lng,s),b=$e.fromLngLat(u),T=$e.fromLngLat(h),E=y.x-g.x,k=y.y-g.y,P=T.x-b.x,R=T.y-b.y,L=Math.sqrt((P*P+R*R)/(E*E+k*k));return Math.log2(L)}function zM(a,r,s){const u=Math.cos(s),h=Math.sin(s);return{x:a*u-r*h,y:a*h+r*u}}function FM(a,r,s){Z(a),Ae(a,a,gn(r[2])),le(a,a,gn(r[0])),pe(a,a,gn(r[1])),ne(a,a,s),H(a,a,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function s1(a,r,s,u,h,g,y,b){const T=[s[0]-r[0],s[1]-r[1],0],E=[u[0]-r[0],u[1]-r[1],0];if(qt(T)<1e-12||qt(E)<1e-12)return Fr(a);const k=Hr([],T,E);xr(k,k),De(E,u,r),T[2]=(g-h)*b,E[2]=(y-h)*b;const P=T;return Hr(P,T,E),xr(P,P),ho(a,k,P)}function o1(a,r,s=!1){const u=Vh(r.zoom),h=function(g,y,b){const T=y.worldSize,E=[g[12],g[13],g[14]],k=de(E[1]/T),P=me(E[0]/T),R=Z([]),L=ce(1,k)*T,z=ce(1,0)*T*Se(k,y.zoom),W=1/IE(T);let J=z*W;if(b){const he=i1(y.projection,y.zoom,y.width,y.height,1024);J=W*y.projection.pixelSpaceConversion(y.center.lat,T,he)}const te=j(k,P);Ne(te,te,Le([],xr([],te),L*J*E[2]));const ae=function(he){const Ce=[he[0],he[1],he[2]];let be=[0,1,0];const ke=Hr([],be,Ce);return Hr(be,Ce,ke),Ut(be)===0&&(be=[0,1,0],Hr(ke,Ce,be)),xr(ke,ke),xr(be,be),xr(Ce,Ce),[ke[0],ke[1],ke[2],0,be[0],be[1],be[2],0,Ce[0],Ce[1],Ce[2],0,he[0],he[1],he[2],1]}(te);ne(R,R,[J,J,J*L]),K(R,R,[-E[0],-E[1],-E[2]]);const ue=H([],y.globeMatrix,ae);return H(ue,ue,R),H(ue,ue,g),ue}(a,r,s);if(u>0){const g=function(y,b){const T=b.worldSize,E=ce(1,0)*T*Se(b.center.lat,b.zoom)/IE(T),k=ce(1,b.center.lat)*T,P=Z([]);pe(P,P,gn(b.center.lng)),le(P,P,gn(b.center.lat)),K(P,P,[0,0,oa]),ne(P,P,[E,E,E*k]);const R=b.point;return K(P,P,[-R.x,-R.y,0]),H(P,P,y),H(P,b.globeMatrix,P)}(a,r);return function(y,b,T){const E=(z,W,J)=>{const te=qt(z),ae=qt(W),ue=Ed(z,W,J);return Le(ue,ue,1/qt(ue)*Br(te,ae,J))},k=E([y[0],y[1],y[2]],[b[0],b[1],b[2]],T),P=E([y[4],y[5],y[6]],[b[4],b[5],b[6]],T),R=E([y[8],y[9],y[10]],[b[8],b[9],b[10]],T),L=Ed([y[12],y[13],y[14]],[b[12],b[13],b[14]],T);return[k[0],k[1],k[2],0,P[0],P[1],P[2],0,R[0],R[1],R[2],0,L[0],L[1],L[2],1]}(h,g,u)}return h}function tC(a,r,s,u){const h=dn.projectAabbCorners(u,s);let g=Number.MAX_VALUE;for(let b=0;b<h.length;++b){const T=h[b];T[0]=(.5*T[0]+.5)*r.width,T[1]=(.5-.5*T[1])*r.height,T[2]<g&&(g=T[2])}const y=function(b){const T=[];let E=0;for(let L=1;L<b.length;L++)(b[L][0]<b[E][0]||b[L][0]===b[E][0]&&b[L][1]<b[E][1])&&(E=L);let k,P=E;const R=new Uint8Array(b.length);do{if(R[P])break;T.push(new wt(b[P][0],b[P][1])),R[P]=1,k=(P+1)%b.length;for(let L=0;L<b.length;L++){if(b[L][0]===b[k][0]&&b[L][1]===b[k][1]||b[L][0]===b[P][0]&&b[L][1]===b[P][1])continue;const z=[b[L][0]-b[P][0],b[L][1]-b[P][1]],W=[b[k][0]-b[P][0],b[k][1]-b[P][1]],J=z[0]*W[1]-z[1]*W[0];(J>0||J===0&&z[0]*W[0]+z[1]*W[1]>=0&&z[0]*z[0]+z[1]*z[1]>W[0]*W[0]+W[1]*W[1])&&(k=L)}P=k}while(P!==E);return T.length>0&&T.push(T[0]),T}(h);if(ds(a,y))return g}const Xp=64,i_={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function a1(a,r,s,u,h,g,y,b,T,E=!1){const k=s.zoom,P=s.project(u),R=Se(u.lat,k),L=1/R;Z(a),K(a,a,[P.x+y[0]*L,P.y+y[1]*L,y[2]]);let z=1,W=1;const J=s.worldSize;if(E){if(s.projection.name==="mercator"){let he=0;s.elevation&&(he=s.elevation.getAtPointOrZero(new $e(P.x/J,P.y/J),0));const Ce=yr([],[P.x,P.y,he,1],s.projMatrix)[3]/s.cameraToCenterDistance;z=Ce,W=Ce*Se(s.center.lat,k)}else if(s.projection.name==="globe"){const he=o1(a,s),Ce=[0,0,0,1];yr(Ce,Ce,H([],s.projMatrix,he));const be=Ce[3]/s.cameraToCenterDistance,ke=Vh(k),Me=s.projection.pixelsPerMeter(u.lat,J)*Se(u.lat,k),ze=s.projection.pixelsPerMeter(s.center.lat,J)*Se(s.center.lat,k);z=be/Br(Me,je(s.center.lat),ke),W=be*R/Me,z*=ze,W*=ze}}else z=L;ne(a,a,[z,z,W]);const te=[...a],ae=r.orientation,ue=[];if(FM(ue,[ae[0]+(h?h[0]:0),ae[1]+(h?h[1]:0),ae[2]+(h?h[2]:0)],g),H(a,te,ue),b&&s.elevation){let he=0;const Ce=[];if(T&&s.elevation){he=function(ke,Me,ze,ct,We){const ut=Me.elevation;if(!ut)return 0;const gt=dn.projectAabbCorners(ze,ct),St=ce(1,We.lat)*Me.worldSize,Lt=function(tr,Zt){const Xr=[0,0,1],Jt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Tr of Jt){const Jr=tr[Tr.corners[0]],pn=tr[Tr.corners[1]],zn=tr[Tr.corners[2]],rn=[pn[0]-Jr[0],pn[1]-Jr[1],Zt*(pn[2]-Jr[2])],Hn=Hr(rn,rn,[zn[0]-Jr[0],zn[1]-Jr[1],Zt*(zn[2]-Jr[2])]);xr(Hn,Hn),Tr.dotProductWithUp=zr(Hn,Xr)}return Jt.sort((Tr,Jr)=>Tr.dotProductWithUp-Jr.dotProductWithUp),Jt[0].corners}(gt,St),kt=gt[Lt[0]],_t=gt[Lt[1]],It=gt[Lt[2]],ot=gt[Lt[3]],rt=ut.getAtPointOrZero(new $e(kt[0]/Me.worldSize,kt[1]/Me.worldSize),0),At=ut.getAtPointOrZero(new $e(_t[0]/Me.worldSize,_t[1]/Me.worldSize),0),Nt=ut.getAtPointOrZero(new $e(It[0]/Me.worldSize,It[1]/Me.worldSize),0),xt=ut.getAtPointOrZero(new $e(ot[0]/Me.worldSize,ot[1]/Me.worldSize),0),sr=(rt+xt)/2,cr=(At+Nt)/2;return sr>cr?At<Nt?s1(ke,_t,ot,kt,At,xt,rt,St):s1(ke,It,kt,ot,Nt,rt,xt,St):rt<xt?s1(ke,kt,_t,It,rt,At,Nt,St):s1(ke,ot,It,_t,xt,Nt,At,St),Math.max(sr,cr)}(Ce,s,r.aabb,a,u);const be=H([],Te([],Ce),ue);H(a,te,be)}else he=s.elevation.getAtPointOrZero(new $e(P.x/J,P.y/J),0);he!==0&&(a[14]+=he)}}class BM{constructor(r,s,u,h,g){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=r,this.uri=s,this.position=u!=null?new B(u[0],u[1]):new B(0,0),this.orientation=h??[0,0,0],this.nodes=g,this.uploaded=!1,this.aabb=new dn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(r,s){H(r.globalMatrix,s,r.localMatrix);const u=this.nodeOverrides.get(r.name);if(u!==void 0){const y=[];g=u.orientation,Z(h=y),pe(h,h,gn(g[1])),Ae(h,h,gn(g[2])),le(h,h,gn(g[0])),H(r.globalMatrix,r.globalMatrix,y)}var h,g;if(r.meshes)for(const y of r.meshes){const b=dn.applyTransformFast(y.aabb,r.globalMatrix);this.aabb.encapsulate(b)}if(r.children)for(const y of r.children)this._applyTransformations(y,r.globalMatrix)}computeBoundsAndApplyParent(){const r=Z([]);this.aabb=new dn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const s of this.nodes)this._applyTransformations(s,r)}computeModelMatrix(r,s,u,h,g,y,b=!1){a1(this.matrix,this,r.transform,this.position,s,u,h,g,y,b)}upload(r){if(!this.uploaded){for(const s of this.nodes)rC(s,r);for(const s of this.nodes)l1(s);this.uploaded=!0}}destroy(){for(const r of this.nodes)nC(r)}}function Nx(a,r,s=!1){a.uploaded||(a.gfxTexture=new QE(r,a.image,s?r.gl.R8:r.gl.RGBA8,{useMipmap:a.sampler.minFilter>=r.gl.NEAREST_MIPMAP_NEAREST}),a.uploaded=!0,a.image=null)}function kq(a,r,s){a.indexBuffer=r.createIndexBuffer(a.indexArray,!1,!0),a.vertexBuffer=r.createVertexBuffer(a.vertexArray,Sq.members,!1,!0),a.normalArray&&(a.normalBuffer=r.createVertexBuffer(a.normalArray,Aq.members,!1,!0)),a.texcoordArray&&(a.texcoordBuffer=r.createVertexBuffer(a.texcoordArray,Cq.members,!1,!0)),a.colorArray&&(a.colorBuffer=r.createVertexBuffer(a.colorArray,(a.colorArray.bytesPerElement===12?Tq:Eq).members,!1,!0)),a.featureArray&&(a.pbrBuffer=r.createVertexBuffer(a.featureArray,Iq.members,!0)),a.segments=Zi.simpleSegment(0,0,a.vertexArray.length,a.indexArray.length);const u=a.material;u.pbrMetallicRoughness.baseColorTexture&&Nx(u.pbrMetallicRoughness.baseColorTexture,r),u.pbrMetallicRoughness.metallicRoughnessTexture&&Nx(u.pbrMetallicRoughness.metallicRoughnessTexture,r),u.normalTexture&&Nx(u.normalTexture,r),u.occlusionTexture&&Nx(u.occlusionTexture,r,s),u.emissionTexture&&Nx(u.emissionTexture,r)}function rC(a,r,s){if(a.meshes)for(const u of a.meshes)kq(u,r,s);if(a.children)for(const u of a.children)rC(u,r,s)}function l1(a){if(a.meshes)for(const r of a.meshes)r.indexArray.destroy(),r.vertexArray.destroy(),r.colorArray&&r.colorArray.destroy(),r.normalArray&&r.normalArray.destroy(),r.texcoordArray&&r.texcoordArray.destroy(),r.featureArray&&r.featureArray.destroy();if(a.children)for(const r of a.children)l1(r)}function nC(a){if(a.meshes)for(const s of a.meshes)s.vertexBuffer&&(s.vertexBuffer.destroy(),s.indexBuffer.destroy(),s.normalBuffer&&s.normalBuffer.destroy(),s.texcoordBuffer&&s.texcoordBuffer.destroy(),s.colorBuffer&&s.colorBuffer.destroy(),s.pbrBuffer&&s.pbrBuffer.destroy(),s.segments.destroy(),s.material&&((r=s.material).pbrMetallicRoughness.baseColorTexture&&r.pbrMetallicRoughness.baseColorTexture.gfxTexture&&r.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),r.pbrMetallicRoughness.metallicRoughnessTexture&&r.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&r.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),r.normalTexture&&r.normalTexture.gfxTexture&&r.normalTexture.gfxTexture.destroy(),r.emissionTexture&&r.emissionTexture.gfxTexture&&r.emissionTexture.gfxTexture.destroy(),r.occlusionTexture&&r.occlusionTexture.gfxTexture&&r.occlusionTexture.gfxTexture.destroy()));var r;if(a.children)for(const s of a.children)nC(s)}function Kp(a,r){const s=a.json.bufferViews[r.bufferView],u=r1[r.componentType];return new u(a.buffers[s.buffer],(r.byteOffset||0)+(s.byteOffset||0),r.count*(s.byteStride&&s.byteStride!==Rx[r.type]*u.BYTES_PER_ELEMENT?s.byteStride/u.BYTES_PER_ELEMENT:Rx[r.type]))}function iC(a,r,s,u){const h=r1[r.componentType],g=function(k){switch(k){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(h),y=a.json.bufferViews[r.bufferView],b=y.byteStride?y.byteStride/h.BYTES_PER_ELEMENT:Rx[r.type],T=s.float32,E=T.length/s.capacity;for(let k=0,P=0;k<r.count*b;k+=b,P+=E)for(let R=0;R<E;R++)T[P+R]=u[k+R]*g;s._trim()}function Pq(a,r,s){const u=a.indices,h=a.attributes,g={};g.indexArray=new Ui;const y=r.json.accessors[u],b=y.count/3;g.indexArray.reserve(b);const T=Kp(r,y);for(let R=0;R<b;R++)g.indexArray.emplaceBack(T[3*R],T[3*R+1],T[3*R+2]);g.indexArray._trim(),g.vertexArray=new Na;const E=r.json.accessors[h.POSITION];g.vertexArray.reserve(E.count);const k=Kp(r,E);for(let R=0;R<E.count;R++)g.vertexArray.emplaceBack(k[3*R],k[3*R+1],k[3*R+2]);if(g.vertexArray._trim(),g.aabb=new dn(E.min,E.max),g.centroid=function(R,L){const z=[0,0,0],W=R.length;if(W>0){for(let J=0;J<W;J++){const te=3*R[J];z[0]+=L[te],z[1]+=L[te+1],z[2]+=L[te+2]}z[0]/=W,z[1]/=W,z[2]/=W}return z}(T,k),h.COLOR_0!==void 0){const R=r.json.accessors[h.COLOR_0],L=Rx[R.type],z=Kp(r,R);g.colorArray=L===3?new Na:new ku,g.colorArray.resize(R.count),iC(r,R,g.colorArray,z)}if(h.NORMAL!==void 0){g.normalArray=new Na;const R=r.json.accessors[h.NORMAL];g.normalArray.resize(R.count);const L=Kp(r,R);iC(r,R,g.normalArray,L)}if(h.TEXCOORD_0!==void 0&&s.length>0){g.texcoordArray=new Pu;const R=r.json.accessors[h.TEXCOORD_0];g.texcoordArray.resize(R.count);const L=Kp(r,R);iC(r,R,g.texcoordArray,L)}if(h._FEATURE_ID_RGBA4444!==void 0){const R=r.json.accessors[h._FEATURE_ID_RGBA4444];r.json.extensionsUsed&&r.json.extensionsUsed.includes("EXT_meshopt_compression")&&(g.featureData=Kp(r,R))}h._FEATURE_RGBA4444!==void 0&&(g.featureData=new Uint32Array(Kp(r,r.json.accessors[h._FEATURE_RGBA4444]).buffer));const P=a.material;return g.material=function(R,L){const{emissiveFactor:z=[0,0,0],alphaMode:W="OPAQUE",alphaCutoff:J=.5,normalTexture:te,occlusionTexture:ae,emissiveTexture:ue,doubleSided:he,name:Ce}=R,{baseColorFactor:be=[1,1,1,1],metallicFactor:ke=1,roughnessFactor:Me=1,baseColorTexture:ze,metallicRoughnessTexture:ct}=R.pbrMetallicRoughness||{},We=ae?L[ae.index]:void 0;if(ae&&ae.extensions&&ae.extensions.KHR_texture_transform&&We){const ut=ae.extensions.KHR_texture_transform;We.offsetScale=[ut.offset[0],ut.offset[1],ut.scale[0],ut.scale[1]]}return{name:Ce,pbrMetallicRoughness:{baseColorFactor:new ri(...be),metallicFactor:ke,roughnessFactor:Me,baseColorTexture:ze?L[ze.index]:void 0,metallicRoughnessTexture:ct?L[ct.index]:void 0},doubleSided:he,emissiveFactor:new ri(...z),alphaMode:W,alphaCutoff:J,normalTexture:te?L[te.index]:void 0,occlusionTexture:We,emissionTexture:ue?L[ue.index]:void 0,defined:R.defined===void 0}}(P!==void 0?r.json.materials[P]:{defined:!1},s),g}function VM(a,r,s){const{matrix:u,rotation:h,translation:g,scale:y,mesh:b,extras:T,children:E,name:k}=a,P={};if(P.name=k,P.localMatrix=u||function(R,L,z,W){var J=L[0],te=L[1],ae=L[2],ue=L[3],he=J+J,Ce=te+te,be=ae+ae,ke=J*he,Me=J*Ce,ze=J*be,ct=te*Ce,We=te*be,ut=ae*be,gt=ue*he,St=ue*Ce,Lt=ue*be,kt=W[0],_t=W[1],It=W[2];return R[0]=(1-(ct+ut))*kt,R[1]=(Me+Lt)*kt,R[2]=(ze-St)*kt,R[3]=0,R[4]=(Me-Lt)*_t,R[5]=(1-(ke+ut))*_t,R[6]=(We+gt)*_t,R[7]=0,R[8]=(ze+St)*It,R[9]=(We-gt)*It,R[10]=(1-(ke+ct))*It,R[11]=0,R[12]=z[0],R[13]=z[1],R[14]=z[2],R[15]=1,R}([],h||[0,0,0,1],g||[0,0,0],y||[1,1,1]),P.globalMatrix=q(P.localMatrix),b!==void 0){P.meshes=s[b];const R=P.anchor=[0,0];for(const L of P.meshes){const{min:z,max:W}=L.aabb;R[0]+=z[0]+W[0],R[1]+=z[1]+W[1]}R[0]=Math.floor(R[0]/P.meshes.length/2),R[1]=Math.floor(R[1]/P.meshes.length/2)}if(T&&(T.id&&(P.id=T.id),T.lights&&(P.lights=function(R){if(!R.length)return[];const L=function(ae){const ue=atob(ae),he=new Uint8Array(ue.length);for(let Ce=0;Ce<ue.length;Ce++)he[Ce]=ue.codePointAt(Ce);return he}(R),z=[],W=L.length/24,J=new Uint16Array(L.buffer),te=new Float32Array(L.buffer);for(let ae=0;ae<W;ae++){const ue=J[2*ae*6]/30,he=J[2*ae*6+1]/30,Ce=J[2*ae*6+10]/100,be=te[6*ae+1],ke=te[6*ae+2],Me=te[6*ae+3],ze=te[6*ae+4],ct=Me-be,We=ze-ke,ut=Math.hypot(ct,We);z.push({pos:[be+.5*ct,ke+.5*We,he],normal:[We/ut,-ct/ut,0],width:ut,height:ue,depth:Ce,points:[be,ke,Me,ze]})}return z}(T.lights)),T.MAPBOX_geometry_bloom&&(P.isGeometryBloom=T.MAPBOX_geometry_bloom)),E){const R=[];for(const L of E)R.push(VM(r.json.nodes[L],r,s));P.children=R}return P}function Rq(a){if(a.vertices.length===0||a.indices.length===0)return null;const r=new Zw(a.vertices,a.indices,8,256),[s,u]=[r.min.clone(),r.max.clone()];return{vertices:a.vertices,indices:a.indices,grid:r,min:s,max:u}}function Mq(a){if(!a.extras||!a.extras.ground)return null;const r=a.extras.ground;if(!r||!Array.isArray(r)||r.length===0)return null;const s=r[0];if(!s||!Array.isArray(s)||s.length===0)return null;const u=[];for(const y of s){if(!Array.isArray(y)||y.length!==2)continue;const b=y[0],T=y[1];typeof b=="number"&&typeof T=="number"&&u.push(new wt(b,T))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let h=0;for(let y=0;y<u.length;y++){const b=u[y],T=u[(y+1)%u.length],E=u[(y+2)%u.length];h+=(b.x-T.x)*(E.y-T.y)-(E.x-T.x)*(b.y-T.y)}h>0&&u.reverse();const g=Jg(u.flatMap(y=>[y.x,y.y]),[]);return g.length===0?null:{vertices:u,indices:g}}function Nq(a,r){const s=[],u=[];let h=0;const g=[];for(const y of a){h=s.length;const b=y.vertexArray.float32,T=y.indexArray.uint16;for(let E=0;E<y.vertexArray.length;E++)g[0]=b[3*E+0],g[1]=b[3*E+1],g[2]=b[3*E+2],hn(g,g,r),s.push(new wt(g[0],g[1]));for(let E=0;E<3*y.indexArray.length;E++)u.push(T[E]+h)}if(u.length%3!=0)return null;for(let y=0;y<u.length;y+=3){const b=s[u[y+0]],T=s[u[y+1]],E=s[u[y+2]];(b.x-T.x)*(E.y-T.y)-(E.x-T.x)*(b.y-T.y)>0&&([u[y+1],u[y+2]]=[u[y+2],u[y+1]])}return{vertices:s,indices:u}}function sC(a){const r=function(T,E){const k=[],P=WebGL2RenderingContext;if(T.json.textures)for(const R of T.json.textures){const L={magFilter:P.LINEAR,minFilter:P.NEAREST,wrapS:P.REPEAT,wrapT:P.REPEAT};R.sampler!==void 0&&Object.assign(L,T.json.samplers[R.sampler]),k.push({image:E[R.source],sampler:L,uploaded:!1})}return k}(a,a.images),s=function(T,E){const k=[];for(const P of T.json.meshes){const R=[];for(const L of P.primitives)R.push(Pq(L,T,E));k.push(R)}return k}(a,r),{scenes:u,scene:h,nodes:g}=a.json,y=u?u[h||0].nodes:[...g.keys()],b=[];for(const T of y)b.push(VM(g[T],a,s));return function(T,E,k){const P={},R=new Set;for(let L=0;L<T.length;L++){const z=k[E[L]];if(!z.extras)continue;const W=z.extras["mapbox:footprint:version"],J=z.extras["mapbox:footprint:id"];(W||J)&&R.add(L),W==="1.0.0"&&J&&(P[J]=L)}for(let L=0;L<T.length;L++){if(R.has(L))continue;const z=T[L],W=k[E[L]];if(!W.extras)continue;let J=null;z.id in P&&(J=Nq(T[P[z.id]].meshes,z.localMatrix)),J||(J=Mq(W)),J&&(z.footprint=Rq(J))}if(R.size>0){const L=Array.from(R.values()).sort((z,W)=>z-W);for(let z=L.length-1;z>=0;z--)T.splice(L[z],1)}}(b,y,a.json.nodes),b}function Dq(a){a.heightmap=new Float32Array(4096),a.heightmap.fill(-1);const r=a.vertexArray.float32,s=a.aabb.min[0]-1,u=a.aabb.min[1]-1,h=Xp/(a.aabb.max[0]-s+2),g=Xp/(a.aabb.max[1]-u+2);for(let y=0;y<r.length;y+=3){const b=r[y+2],T=(r[y+0]-s)*h|0,E=(r[y+1]-u)*g|0;b>a.heightmap[E*Xp+T]&&(a.heightmap[E*Xp+T]=b)}}function UM(a,r,s,u,h){s.reserve(s.length+4*a.length),u.reserve(u.length+10*a.length),h.reserve(h.length+10*a.length);let g=u.length;for(const y of a){const b=Math.min(10,Math.max(4,1.3*y.height))*r,T=[-y.normal[1],y.normal[0],0],E=Math.min(.29,.1*y.width/y.depth),k=y.width-2*y.depth*r*(E+.01),P=vt([],y.pos,T,k/2),R=vt([],y.pos,T,-k/2),L=[P[0],P[1],P[2]+y.height],z=[R[0],R[1],R[2]+y.height],W=vt([],y.normal,T,E);Le(W,W,b);const J=vt([],y.normal,T,-E);Le(J,J,b),Ne(W,P,W),Ne(J,R,J),P[2]+=.1,R[2]+=.1,u.emplaceBack(W[0],W[1],W[2]),u.emplaceBack(J[0],J[1],J[2]),u.emplaceBack(P[0],P[1],P[2]),u.emplaceBack(R[0],R[1],R[2]),u.emplaceBack(L[0],L[1],L[2]),u.emplaceBack(z[0],z[1],z[2]),u.emplaceBack(P[0],P[1],P[2]),u.emplaceBack(R[0],R[1],R[2]),u.emplaceBack(W[0],W[1],W[2]),u.emplaceBack(J[0],J[1],J[2]);const te=k/b/2;h.emplaceBack(-te-E,-1,te,.8),h.emplaceBack(te+E,-1,te,.8),h.emplaceBack(-te,0,te,1.3),h.emplaceBack(te,0,te,1.3),h.emplaceBack(te+E,-.8,te,.7),h.emplaceBack(te+E,-.8,te,.7),h.emplaceBack(0,0,te,1.3),h.emplaceBack(0,0,te,1.3),h.emplaceBack(te+E,-1.2,te,.8),h.emplaceBack(te+E,-1.2,te,.8),s.emplaceBack(6+g,4+g,8+g),s.emplaceBack(7+g,9+g,5+g),s.emplaceBack(0+g,1+g,2+g),s.emplaceBack(1+g,3+g,2+g),g+=10}}function Oq(a,r){const s={};s.indexArray=new Ui,s.vertexArray=new Na,s.colorArray=new ku,UM(a,r,s.indexArray,s.vertexArray,s.colorArray);const u={defined:!0};u.emissiveFactor=ri.black;const h={};return h.baseColorFactor=ri.white,u.pbrMetallicRoughness=h,s.material=u,s.aabb=new dn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),s}const $M=vn([{name:"a_pos_3f",components:3,type:"Float32"}]),Lq=vn([{name:"a_normal_3",components:3,type:"Int16"}]),zq=vn([{name:"a_centroid_3",components:3,type:"Int16"}]),qM=vn([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),Fq=vn([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),Bq=vn([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),Vq=vn([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),Uq=vn([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),$q=vn([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),GM=Et.types,c1=32767;function qq(a,r){const s=Vt+r;for(const u of a)for(const h of u)if(h.x<-r||h.x>s||h.y<-r||h.y>s)return!1;return!0}class HM{constructor(){this.layoutVertexArray=new Na,this.layoutAttenuationArray=new ku,this.layoutColorArray=new dl,this.indexArray=new Ui,this.indexArrayForConflation=new Ui,this.segmentsBucket=new Zi}}class oC{constructor(){this.layoutVertexArray=new Na,this.layoutNormalArray=new bd,this.layoutCentroidArray=new bd,this.layoutColorArray=new dl,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutFloodLightDataArray=new Ug,this.layoutAOArray=new Lc,this.indexArray=new Ui,this.indexArrayForConflation=new Ui,this.segmentsBucket=new Zi,this.entranceBloom=new HM}}class WM{constructor(r){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new oC,this.buildingWithFacade=new oC,this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.footprintLookup={},this.zoom=r.zoom,this.canonical=r.canonical,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=r.index,this.hasPattern=!1,this.worldview=r.worldview,this.lut=r.lut,this.buildingWithFacade.layoutFacadePaintArray=new dl,this.buildingWithFacade.layoutFacadeDataArray=new wd,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new dl,this.programConfigurations=new Ml(r.layers,{zoom:r.zoom,lut:r.lut}),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=r.projection,this.groundEffect=new qE(r),this.groundEffect.groundRadiusArray=new Lc,this.hasAppearances=null}updateFootprints(r,s){for(const u of this.footprints)s.push({footprint:u,id:r})}updateAppearances(r,s,u,h){}prepare(){return function(){if(t1!=null||CM!=null)return null;if(n_!=null)return n_;const r=fetch(Di.BUILDING_GEN_URL);return n_=function(s){let u,h,g,y;function b(){u=new Uint8Array(y.buffer),h=new Int32Array(y.buffer),g=new Float32Array(y.buffer)}function T(){throw new Error("Unexpected BuildingGen error.")}const E=()=>{},k={a:{a:T,f:function(P){const R=u.length,L=Math.max(P>>>0,Math.ceil(1.2*R)),z=Math.ceil((L-R)/65536);try{return y.grow(z),b(),!0}catch{return!1}},g:T,b:E,c:E,d:E,e:E}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(s,k):s.then(P=>P.arrayBuffer()).then(P=>WebAssembly.instantiate(P,k))).then(P=>{const R=P.instance.exports;return(0,R.g)(),y=R.f,b(),new gq({setStyle:R.h,setAOOptions:R.i,setMetricOptions:R.j,setStructuralOptions:R.k,setFacadeOptions:R.l,setFauxFacadeOptions:R.m,setFacadeClassifierOptions:R.n,addFeature:R.o,addFacade:R.p,generateMesh:R.q,getLastError:R.r,getOuterRingLength:R.s,getMeshCount:R.t,getPositionsPtr:R.u,getPositionsLength:R.v,getNormalsPtr:R.w,getNormalsLength:R.x,getColorsPtr:R.y,getColorsLength:R.z,getAOPtr:R.A,getAOLength:R.B,getUVPtr:R.C,getUVLength:R.D,getFauxFacadePtr:R.E,getFauxFacadeLength:R.F,getIndicesPtr:R.G,getIndicesLength:R.H,getBuildingPart:R.I,getRingCount:R.J,getRingPtr:R.K,getRingLength:R.L,free:R.M,malloc:R.N,heapU8:u,heap32:h,heapF32:g})})}(r).then(s=>(n_=null,t1=s,t1)).catch(s=>{Cr("Could not load building-gen"),n_=null,CM=s}),n_}()}populate(r,s,u,h){const g=_q();if(!g)return;const y=Ie(u);this.tileToMeter=y,this.brightness=s.brightness,g.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,y],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:y,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),g.setAOOptions(!1,.3),g.setMetricOptions(!1,16),g.setStructuralOptions(!0),g.setFacadeClassifierOptions(3);const b=new Map,T=new Map;for(const{feature:E}of r){if(GM[E.type]!=="LineString"){b.set(E.id,E.properties.source_id);continue}const k=this.layers[0]._featureFilter.needGeometry,P=et(E,k);if(!this.layers[0]._featureFilter.filter(new Ai(this.zoom),P,u))continue;const R=k?P.geometry:mt(E,u,h),L=[];for(const te of R)for(const ae of te)L.push({x:ae.x,y:ae.y});const z={coordinates:L,crossPerc:E.properties.cross_perc,distanceToRoad:E.properties.distance_to_road,entrances:E.properties.entrances,sourceId:0},W=E.properties.source_id;let J=T.get(W);J||(J=[],T.set(W,J)),J.push(z)}this.maxHeight=0;for(const{feature:E,id:k,index:P,sourceLayerIndex:R}of r){if(GM[E.type]==="LineString")continue;const L=this.layers[0]._featureFilter.needGeometry,z=et(E,L);if(!this.layers[0]._featureFilter.filter(new Ai(this.zoom),z,u))continue;const W=L?z.geometry:mt(E,u,h),J=Sx(W,500);if(!qq(W,163))continue;const te=this.layers[0],ae=te.layout.get("building-roof-shape").evaluate(E,{},u);if(ae==="flat")continue;const ue=te.layout.get("building-base").evaluate(E,{},u),he=te.layout.get("building-height").evaluate(E,{},u),Ce=te.layout.get("building-flood-light-ground-radius").evaluate(E,{},u),be=te.paint.get("building-ambient-occlusion-intensity"),ke=Ce/this.tileToMeter;let Me=te.layout.get("building-flood-light-wall-radius").evaluate(E,{},u);Me=se(Me,0,2048);const ze=Me/2048*c1,ct=b.get(k);let We;We=T.has(ct)?T.get(ct):[];const ut=We.length!==0&&te.layout.get("building-facade").evaluate(E,{},u);g.setFacadeOptions(4,!0),g.setFauxFacadeOptions(ut,!1,1);let gt=0,St=0,Lt=0,kt=0,_t=0,It=0;if(ut){let ft=Math.round(te.layout.get("building-facade-floors").evaluate(E,{},u));if(ue===0){ft=Math.max(1,ft-(We.length>0?1:0));let mr=4;if(he>100){const fr=[10,13,15];mr=fr[E.id?E.id%fr.length:0],g.setFacadeOptions(mr,!0)}_t=1.6803*mr/y}else _t=ue/y;It=he/y,_t=Math.min(_t,It),Lt=te.layout.get("building-facade-unit-width").evaluate(E,{},u)/y,kt=(It-_t)/ft,g.setFauxFacadeOptions(!0,!0,Lt);const Xt=te.layout.get("building-facade-window").evaluate(E,{},u);gt=Xt[0],St=Xt[1]}const ot=[],rt=new wt(1/0,1/0),At=new wt(-1/0,-1/0),Nt=new wt(0,0);let xt=0;for(const ft of J)if(ft.length>0){const Xt=[];for(const mr of ft){const fr=[];for(let nn=mr.length-1;nn>=0;nn--){const Mr=mr[nn];fr.push({x:Mr.x,y:Mr.y}),rt.x=Math.min(rt.x,Mr.x),rt.y=Math.min(rt.y,Mr.y),At.x=Math.max(At.x,Mr.x),At.y=Math.max(At.y,Mr.y),Nt.x+=Mr.x,Nt.y+=Mr.y,xt++}Xt.push(fr)}ot.push({id:E.id?E.id:0,height:he,minHeight:ue,sourceId:0,roofType:ae,coordinates:Xt})}Nt.x/=xt||1,Nt.y/=xt||1;const sr=g.generateMesh(ot,We);if(typeof sr=="string"){Cr(`Unable to generate building ${E.id}: ${sr}`);continue}if(sr.meshes.length===0||sr.modifiedPolygonRings.length===0)continue;let cr=0;for(const ft of sr.meshes)cr+=ft.positions.length/3;const tr=ut?this.buildingWithFacade:this.buildingWithoutFacade,Zt=tr.segmentsBucket.prepareSegment(cr,tr.layoutVertexArray,tr.indexArray),Xr=[];let Jt=null,Tr=0,Jr=-1;const pn=tr.layoutVertexArray.length,zn=tr.indexArray.length;let rn=0;for(const ft of sr.meshes){const Xt=tr.layoutVertexArray.length;if(ft.buildingPart==="entrance"){const dr=new Array;for(let Dn=0;Dn<ft.positions.length;Dn+=12){const _i=ft.positions[Dn+0],ni=ft.positions[Dn+1],rs=ft.positions[Dn+3],Li=ft.positions[Dn+4],Ti=ft.positions[Dn+2],ui=ft.positions[Dn+8]-Ti,Zn=1,sn=rs-_i,Xn=Li-ni,Ei=Math.hypot(sn,Xn);dr.push({pos:[_i+.5*sn,ni+.5*Xn,Ti],normal:[Xn/Ei,-sn/Ei,0],width:Ei,height:ui,depth:Zn,points:[_i,ni,rs,Li]})}const qn=tr.entranceBloom.segmentsBucket.prepareSegment(10*dr.length,tr.entranceBloom.layoutVertexArray,tr.entranceBloom.indexArray),gi=tr.entranceBloom.layoutVertexArray.length;Tr=tr.entranceBloom.indexArray.length,UM(dr,.5/this.tileToMeter,tr.entranceBloom.indexArray,tr.entranceBloom.layoutVertexArray,tr.entranceBloom.layoutAttenuationArray);const Dr=tr.entranceBloom.layoutVertexArray.length-gi;Jr=tr.entranceBloom.indexArray.length-Tr;for(let Dn=0;Dn<Dr;Dn++)tr.entranceBloom.layoutColorArray.emplaceBack(65535,65535);qn.vertexLength+=Dr,qn.primitiveLength+=Jr,Jt={part:ft.buildingPart,vertexOffset:gi,vertexLength:Dr}}for(let dr=0;dr<ft.positions.length;dr+=3)rn=Math.max(rn,ft.positions[dr+2]),tr.layoutVertexArray.emplaceBack(ft.positions[dr],ft.positions[dr+1],ft.positions[dr+2]);const mr=Math.floor(Nt.x),fr=Math.floor(Nt.y),nn=Math.floor(rn);for(let dr=0;dr<ft.positions.length;dr+=3)tr.layoutCentroidArray.emplaceBack(mr,fr,nn),tr.layoutFloodLightDataArray.emplaceBack(ft.buildingPart==="wall"?ze:0);for(let dr=0;dr<ft.normals.length;dr+=3)tr.layoutNormalArray.emplaceBack(ft.normals[dr+0]*c1,ft.normals[dr+1]*c1,ft.normals[dr+2]*c1);for(let dr=0;dr<ft.ao.length;dr++)tr.layoutAOArray.emplaceBack(ft.ao[dr]);for(let dr=0;dr<ft.colors.length;dr+=3){const qn=1+(ft.ao[dr/3]-1)*be;tr.layoutColorArray.emplaceBack(ft.colors[dr]*qn<<8|ft.colors[dr+1]*qn,ft.colors[dr+2]*qn<<8)}if(ut){for(let dr=0;dr<ft.positions.length;dr+=3)tr.layoutFacadePaintArray.emplaceBack(65535,255);for(let dr=0;dr<ft.isFauxFacade.length;dr++)if(ft.isFauxFacade[dr]){const qn=1|Math.min(65535,Math.floor(ft.uv[2*dr]*sr.outerRingLength)),gi=Math.floor(255*gt)<<8|Math.floor(255*St),Dr=Math.floor(65535*Math.min(1,Lt/Vt)),Dn=Math.floor(65535*Math.min(1,kt/Vt));tr.layoutFacadeDataArray.emplaceBack(qn,gi,Dr,Dn);const _i=Math.floor(65535*Math.min(1,_t/Vt)),ni=Math.floor(65535*Math.min(1,It/Vt));tr.layoutFacadeVerticalRangeArray.emplaceBack(_i,ni)}else tr.layoutFacadeDataArray.emplaceBack(0,0,0,0),tr.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}const Mr=Zt.vertexLength;for(let dr=0;dr<ft.indices.length;dr+=3)tr.indexArray.emplaceBack(Mr+ft.indices[dr],Mr+ft.indices[dr+1],Mr+ft.indices[dr+2]);Zt.vertexLength+=ft.positions.length/3,Zt.primitiveLength+=ft.indices.length/3,(ft.buildingPart==="roof"||ft.buildingPart==="wall"||ft.buildingPart==="facade_glazing"||ft.buildingPart==="entrance")&&Xr.push({part:ft.buildingPart,vertexOffset:Xt,vertexLength:ft.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,rn),this.buildingFeatures.push({promoteId:k,feature:z,hasFauxFacade:ut,segment:Zt,parts:Xr,buildingBloom:Jt});const Hn=tr.indexArray.length-zn,Wn=[],Hi=[],we=new wt(1/0,1/0),_e=new wt(-1/0,-1/0),ht=this.groundEffect.vertexArray.length;for(const ft of sr.modifiedPolygonRings){const Xt=[],mr=new wt(1/0,1/0),fr=new wt(-1/0,-1/0);for(let nn=0;nn<ft.length;nn+=2){const Mr=ft.length-nn-2;mr.x=Math.min(mr.x,ft[Mr]),mr.y=Math.min(mr.y,ft[Mr+1]),fr.x=Math.max(fr.x,ft[Mr]),fr.y=Math.max(fr.y,ft[Mr+1]);const dr=new wt(ft[Mr],ft[Mr+1]);Xt.push(dr),Wn.push(dr.x,dr.y),Hi.push(dr.clone())}we.x=Math.min(we.x,mr.x),we.y=Math.min(we.y,mr.y),_e.x=Math.max(_e.x,fr.x),_e.y=Math.max(_e.y,fr.y),this.groundEffect.addData(Xt,[mr,fr],ke)}const Ht=this.groundEffect.vertexArray.length-ht;for(let ft=0;ft<Ht;ft++)this.groundEffect.groundRadiusArray.emplaceBack(Ce);(rt.x<0||At.x>Vt||rt.y<0||At.y>Vt)&&this.featuresOnBorder.push({featureId:E.id,footprintIndex:this.footprints.length});{const ft=Jg(Wn,null,2),Xt=new Zw(Hi,ft,8,256);let mr=E.id;E.properties&&E.properties.hasOwnProperty("building_id")&&(mr=E.properties.building_id);const fr={vertices:Hi,indices:ft,grid:Xt,min:we,max:_e,buildingId:mr,hiddenFlags:0,indicesOffset:zn,indicesLength:Hn,bloomIndicesOffset:Tr,bloomIndicesLength:Jr,groundEffectVertexOffset:ht,groundEffectVertexLength:Ht,hasFauxFacade:ut,segment:Zt,height:rn};E.id!==void 0&&this.featureFootprintLookup.set(E.id,this.footprints.length),this.footprints.push(fr)}this.programConfigurations.populatePaintArrays(tr.layoutVertexArray.length,E,P,{},s.availableImages,u,s.brightness),this.groundEffect.addPaintPropertiesData(E,P,{},s.availableImages,u,s.brightness),s.featureIndex.insert(E,W,P,R,this.index,pn)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(r,s,u,h,g,y,b){this.programConfigurations.updatePaintArrays(r,s,g,u,h,y,b),this.groundEffect.update(r,s,g,u,h,y,b),this.evaluate(this.layers[0],r),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(r){const s=u=>{u.layoutVertexBuffer=r.createVertexBuffer(u.layoutVertexArray,$M.members),u.layoutNormalBuffer=r.createVertexBuffer(u.layoutNormalArray,Lq.members),u.layoutCentroidBuffer=r.createVertexBuffer(u.layoutCentroidArray,zq.members),u.layoutFloodLightDataBuffer=r.createVertexBuffer(u.layoutFloodLightDataArray,$q.members),u.layoutFacadeDataArray&&u.layoutFacadeDataArray.length&&(u.layoutFacadeDataBuffer=r.createVertexBuffer(u.layoutFacadeDataArray,Bq.members)),u.layoutFacadeVerticalRangeArray&&u.layoutFacadeVerticalRangeArray.length&&(u.layoutFacadeVerticalRangeBuffer=r.createVertexBuffer(u.layoutFacadeVerticalRangeArray,Vq.members)),u.entranceBloom.layoutVertexArray.length&&(u.entranceBloom.layoutVertexBuffer=r.createVertexBuffer(u.entranceBloom.layoutVertexArray,$M.members),u.entranceBloom.layoutAttenuationBuffer=r.createVertexBuffer(u.entranceBloom.layoutAttenuationArray,Uq.members)),this.uploadUpdatedColorBuffer(r),this.uploadUpdatedIndexBuffer(r)};this.uploaded||(s(this.buildingWithoutFacade),s(this.buildingWithFacade),this.groundEffect.upload(r)),this.groundEffect.uploadPaintProperties(r),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){const r=s=>{s.layoutVertexBuffer&&(s.layoutVertexBuffer.destroy(),s.layoutNormalBuffer.destroy(),s.layoutColorBuffer.destroy(),s.segmentsBucket.destroy(),s.indexBuffer&&s.indexBuffer.destroy(),s.entranceBloom.layoutVertexBuffer&&(s.entranceBloom.layoutVertexBuffer.destroy(),s.entranceBloom.layoutColorBuffer.destroy(),s.entranceBloom.layoutAttenuationBuffer.destroy(),s.entranceBloom.indexBuffer.destroy(),s.entranceBloom.segmentsBucket.destroy()))};r(this.buildingWithoutFacade),r(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(r,s,u=!0){let h=!1;const g=u?s:0,y=0|(u?-1:~s);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const b of r){const T=this.footprints[b],E=T.hiddenFlags&y|g;T.hiddenFlags!==E&&(T.hiddenFlags=E,h=!0,this.groundEffect.updateHiddenByLandmarkRange(T.groundEffectVertexOffset,T.groundEffectVertexLength,T.hiddenFlags!==0))}return h&&(this.indexArrayForConflationUploaded=!1),h}uploadUpdatedIndexBuffer(r){if(this.groundEffect.uploadHiddenByLandmark(r),this.indexArrayForConflationUploaded)return;const s=h=>{h.indexArray.length!==0&&(h.indexArrayForConflation.resize(h.indexArray.length),h.indexArrayForConflation.uint16.set(h.indexArray.uint16),h.entranceBloom.indexArrayForConflation.resize(h.entranceBloom.indexArray.length),h.entranceBloom.indexArrayForConflation.uint16.set(h.entranceBloom.indexArray.uint16))};s(this.buildingWithoutFacade),s(this.buildingWithFacade);for(const h of this.footprints){const g=h.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,y=h.indicesOffset+h.indicesLength;if(h.hiddenFlags!==0){for(let T=h.indicesOffset;T<y;T++)g.indexArrayForConflation.uint16[3*T+0]=0,g.indexArrayForConflation.uint16[3*T+1]=0,g.indexArrayForConflation.uint16[3*T+2]=0;const b=h.bloomIndicesOffset+h.bloomIndicesLength;for(let T=h.bloomIndicesOffset;T<b;T++)g.entranceBloom.indexArrayForConflation.uint16[3*T+0]=0,g.entranceBloom.indexArrayForConflation.uint16[3*T+1]=0,g.entranceBloom.indexArrayForConflation.uint16[3*T+2]=0}}const u=h=>{h.indexArray.length!==0&&(h.indexBuffer?h.indexBuffer.updateData(h.indexArrayForConflation):h.indexBuffer=r.createIndexBuffer(h.indexArrayForConflation,!0),h.entranceBloom.indexBuffer?h.entranceBloom.indexBuffer.updateData(h.entranceBloom.indexArrayForConflation):h.entranceBloom.indexBuffer=r.createIndexBuffer(h.entranceBloom.indexArrayForConflation,!0))};u(this.buildingWithoutFacade),u(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(r){const s=u=>{u.layoutColorBuffer?u.layoutColorBuffer.updateData(u.layoutColorArray):u.layoutColorBuffer=r.createVertexBuffer(u.layoutColorArray,qM.members,!0),u.layoutFacadePaintArray&&(u.layoutFacadePaintBuffer?u.layoutFacadePaintBuffer.updateData(u.layoutFacadePaintArray):u.layoutFacadePaintBuffer=r.createVertexBuffer(u.layoutFacadePaintArray,Fq.members,!0)),u.entranceBloom.layoutColorBuffer?u.entranceBloom.layoutColorBuffer.updateData(u.entranceBloom.layoutColorArray):u.entranceBloom.layoutColorBuffer=r.createVertexBuffer(u.entranceBloom.layoutColorArray,qM.members,!0)};s(this.buildingWithoutFacade),s(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(r,s){const u=r.paint.get("building-ambient-occlusion-intensity");for(const h of this.buildingFeatures){const g=s[h.promoteId],y=h.feature;y.properties["building-part"]="roof";const b=r.paint.get("building-color").evaluate(y,g,this.canonical).toPremultipliedRenderColor(this.lut),T=r.paint.get("building-emissive-strength").evaluate(y,g,this.canonical);y.properties["building-part"]="wall";const E=r.paint.get("building-color").evaluate(y,g,this.canonical).toPremultipliedRenderColor(this.lut),k=r.paint.get("building-emissive-strength").evaluate(y,g,this.canonical);y.properties["building-part"]="window";const P=r.paint.get("building-color").evaluate(y,g,this.canonical).toPremultipliedRenderColor(this.lut),R=r.paint.get("building-emissive-strength").evaluate(y,g,this.canonical);y.properties["building-part"]="door";const L=r.paint.get("building-color").evaluate(y,g,this.canonical).toPremultipliedRenderColor(this.lut),z=r.paint.get("building-emissive-strength").evaluate(y,g,this.canonical),W=h.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const te of h.parts){let ae,ue=b;te.part==="roof"?(ue=b,ae=T):te.part==="wall"?(ue=E,ae=k):te.part==="facade_glazing"?(ue=P,ae=R):te.part==="entrance"&&(ue=L,ae=z),ae=se(ae,0,1);for(let he=0;he<te.vertexLength;he++){const Ce=te.vertexOffset+he,be=1+(W.layoutAOArray.float32[Ce]-1)*u;W.layoutColorArray.emplace(Ce,ue.r*be*255<<8|ue.g*be*255,ue.b*be*255<<8|255*ae),h.hasFauxFacade&&W.layoutFacadePaintArray.emplace(Ce,255*P.r<<8|255*P.g,255*P.b<<8|255*R)}}const J=h.buildingBloom;if(J)for(let te=0;te<J.vertexLength;te++)W.entranceBloom.layoutColorArray.emplace(J.vertexOffset+te,255*L.r<<8|255*L.g,255*L.b<<8|51*z)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(r,s,u){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const h=s.getReplacementRegionsForTile(r.toUnwrapped());if(Kw(this.activeReplacements,h))return;this.activeReplacements=h;for(const y of this.footprints)y.hiddenFlags&=-2;const g=[];for(const y of this.activeReplacements){if(y.order<=ZR)continue;const b=Math.max(1,Math.pow(2,y.footprintTileId.canonical.z-r.canonical.z));for(const T of this.footprints)T.min.x>y.max.x||T.max.x<y.min.x||T.min.y>y.max.y||T.max.y<y.min.y||(g.length=0,Gq(T.vertices,0,T.vertices.length,y.footprintTileId.canonical,r.canonical,g),BE(y.footprint,g,T.indices,0,T.indices.length,0,-b)&&(T.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const y of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(y.groundEffectVertexOffset,y.groundEffectVertexLength,y.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(r){if(r.id!==void 0){const s=this.featureFootprintLookup.get(r.id);return this.footprints[s]}return null}getHeightAtTileCoord(r,s){let u=Number.NEGATIVE_INFINITY,h=!0;const g=4*(r+Vt)*Vt+(s+Vt);if(this.footprintLookup.hasOwnProperty(g)){const b=this.footprintLookup[g];return b?{height:b.height,hidden:b.hiddenFlags!==0}:void 0}const y=new wt(r,s);for(const b of this.footprints)r>b.max.x||b.min.x>r||s>b.max.y||b.min.y>s||b.height<=u||VE(y,b)&&(u=b.height,this.footprintLookup[g]=b,h=b.hiddenFlags!==0);if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:h};this.footprintLookup[g]=void 0}}function Gq(a,r,s,u,h,g){const y=Math.pow(2,u.z-h.z);for(let b=0;b<s;b++){let T=a[b+r].x,E=a[b+r].y;T=(T+h.x*Vt)*y-u.x*Vt,E=(E+h.y*Vt)*y-u.y*Vt,g.push(new wt(T,E))}}let ZM,XM;or(WM,"BuildingBucket",{omit:["layers"]}),or(oC,"BuildingGeometry"),or(HM,"BuildingBloomGeometry");const Hq=vn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Wq=vn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Zq}=Hq,Xq=vn([{name:"a_packed",components:3,type:"Float32"}]),{members:Kq}=Xq,Yq=vn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Jq}=Yq;class KM{constructor(r,s){this.width=r,this.height=s,this.nextRow=0,this.image=new Uh({width:r,height:s}),this.positions={},this.uploaded=!1}getDash(r,s){const u=this.getKey(r,s);return this.positions[u]}trim(){const r=this.width,s=this.height=Ue(this.nextRow);this.image.resize({width:r,height:s})}getKey(r,s){return r.join(",")+s}getDashRanges(r,s,u){const h=[];let g=r.length%2==1?-r[r.length-1]*u:0,y=r[0]*u,b=!0;h.push({left:g,right:y,isDash:b,zeroLength:r[0]===0});let T=r[0];for(let E=1;E<r.length;E++){b=!b;const k=r[E];g=T*u,T+=k,y=T*u,h.push({left:g,right:y,isDash:b,zeroLength:k===0})}return h}addRoundDash(r,s,u){const h=s/2;for(let g=-u;g<=u;g++){const y=this.width*(this.nextRow+u+g);let b=0,T=r[b];for(let E=0;E<this.width;E++){E/T.right>1&&(T=r[++b]);const k=Math.abs(E-T.left),P=Math.abs(E-T.right),R=Math.min(k,P);let L;const z=g/u*(h+1);if(T.isDash){const W=h-Math.abs(z);L=Math.sqrt(R*R+W*W)}else L=h-Math.sqrt(R*R+z*z);this.image.data[y+E]=Math.max(0,Math.min(255,L+128))}}}addRegularDash(r,s){for(let T=r.length-1;T>=0;--T){const E=r[T],k=r[T+1];E.zeroLength?r.splice(T,1):k&&k.isDash===E.isDash&&(k.left=E.left,r.splice(T,1))}const u=r[0],h=r[r.length-1];u.isDash===h.isDash&&(u.left=h.left-this.width,h.right=u.right+this.width);const g=this.width*this.nextRow;let y=0,b=r[y];for(let T=0;T<this.width;T++){T/b.right>1&&(b=r[++y]);const E=Math.abs(T-b.left),k=Math.abs(T-b.right),P=Math.min(E,k);this.image.data[g+T]=Math.max(0,Math.min(255,(b.isDash?P:-P)+s+128))}}addDash(r,s){const u=this.getKey(r,s);if(this.positions[u])return this.positions[u];const h=s==="round",g=h?7:0,y=2*g+1;if(this.nextRow+y>this.height)return Cr("LineAtlas out of space"),null;r.length===0&&r.push(1);let b=0;for(let k=0;k<r.length;k++)r[k]<0&&(Cr("Negative value is found in line dasharray, replacing values with 0"),r[k]=0),b+=r[k];if(b!==0){const k=this.width/b,P=this.getDashRanges(r,this.width,k);h?this.addRoundDash(P,k,g):this.addRegularDash(P,s==="square"?.5*k:0)}const T=this.nextRow+g;this.nextRow+=y;const E={tl:[T,g],br:[b,0]};return this.positions[u]=E,E}}or(KM,"LineAtlas");const Qq=Et.types,eG=Math.cos(Math.PI/180*37.5),tG=Math.cos(Math.PI/180*5);class aC{constructor(r){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=r.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=r.overscaling,this.pixelRatio=r.pixelRatio,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=r.index,this.projection=r.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new zg,this.layoutVertexArray2=new Na,this.patternVertexArray=new Na,this.indexArray=new Ui,this.programConfigurations=new Ml(r.layers,{zoom:r.zoom,lut:r.lut}),this.segments=new Zi,this.maxLineLength=0,this.zOffsetVertexArray=new Na,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.tessellationStep=r.tessellationStep?r.tessellationStep:Vt/64,this.worldview=r.worldview,this.hasAppearances=null}updateFootprints(r,s){}updateAppearances(r,s,u,h){}populate(r,s,u,h){this.hasPattern=NE("line",this.layers,this.pixelRatio,s);const g=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Ie(u);const y=this.layers[0].layout.get("line-elevation-reference");if(y==="hd-road-markup")this.elevationType="road";else{const R=this.layers[0].layout.get("line-z-offset"),L=R.isConstant()&&!R.constantOr(0);this.elevationType=y!=="sea"&&y!=="ground"&&L?"none":"offset",this.elevationType==="offset"&&y==="none"&&Cr(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const b=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&b!==void 0;const T=[];for(const{feature:R,id:L,index:z,sourceLayerIndex:W}of r){const J=this.layers[0]._featureFilter.needGeometry,te=et(R,J);if(!this.layers[0]._featureFilter.filter(new Ai(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),te,u))continue;const ae=g?g.evaluate(te,{},u):void 0,ue={id:L,properties:R.properties,type:R.type,sourceLayerIndex:W,index:z,geometry:J?te.geometry:mt(R,u,h),patterns:{},sortKey:ae};T.push(ue)}g&&T.sort((R,L)=>R.sortKey-L.sortKey);const{lineAtlas:E,featureIndex:k}=s,P=this.addConstantDashes(E);for(const R of T){const{geometry:L,index:z,sourceLayerIndex:W}=R;if(P&&this.addFeatureDashes(R,E),this.hasPattern){const J=DE("line",this.layers,R,this.zoom,this.pixelRatio,s);this.patternFeatures.push(J)}else this.addFeature(R,L,z,u,E.positions,s.availableImages,s.brightness,s.elevationFeatures);k.insert(r[z].feature,L,z,W,this.index)}}addConstantDashes(r){let s=!1;for(const u of this.layers){const h=u.paint.get("line-dasharray").value,g=u.layout.get("line-cap").value;if(h.kind!=="constant"||g.kind!=="constant")s=!0;else{const y=g.value,b=h.value;if(!b)continue;r.addDash(b,y)}}return s}addFeatureDashes(r,s){const u=this.zoom;for(const h of this.layers){const g=h.paint.get("line-dasharray").value,y=h.layout.get("line-cap").value;if(g.kind==="constant"&&y.kind==="constant")continue;let b,T;if(g.kind==="constant"){if(b=g.value,!b)continue}else b=g.evaluate({zoom:u},r);T=y.kind==="constant"?y.value:y.evaluate({zoom:u},r),s.addDash(b,T),r.patterns[h.id]=[s.getKey(b,T)]}}update(r,s,u,h,g,y,b,T){this.programConfigurations.updatePaintArrays(r,s,g,u,h,y,b,T)}addFeatures(r,s,u,h,g,y){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,s,u,h,y)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,Kq)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=r.createVertexBuffer(this.patternVertexArray,Jq)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=r.createVertexBuffer(this.zOffsetVertexArray,Wq.members,!0)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Zq),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r,s){let u,h;if(s&&s>0?(u=`mapbox_clip_start_${s}`,h=`mapbox_clip_end_${s}`):(u="mapbox_clip_start",h="mapbox_clip_end"),r.properties&&r.properties.hasOwnProperty(u)&&r.properties.hasOwnProperty(h))return{start:+r.properties[u],end:+r.properties[h]}}addFeature(r,s,u,h,g,y,b,T){const E=this.layers[0].layout,k=E.get("line-join").evaluate(r,{}),P=E.get("line-cap").evaluate(r,{}),R=E.get("line-miter-limit"),L=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(r),this.lineFeature=r;const z=!(!r.properties||!r.properties.hasOwnProperty("mapbox_line_metrics"))&&r.properties.mapbox_line_metrics;this.zOffsetValue=E.get("line-z-offset").value;const W=this.layers[0].paint.get("line-width").value;if(W.kind!=="constant"&&W.isLineProgressConstant===!1&&(this.variableWidthValue=W),this.elevationType==="road"){const J=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(r,s,h,T,k,P,R,L)){const[te,ae]=this.clipRuntimeLinesToTile(s,1);for(let ue=0;ue<te.length;ue++){const he=te[ue],Ce=ae[ue],be={progress:{min:Ce.progress.min,max:Ce.progress.max},nextDir:this.computeSegNextDir(Ce,he),prevDir:this.computeSegPrevDir(Ce,he)};this.addLine(he,r,h,k,P,R,L,be,z&&Ce.parentIndex>0?Ce.parentIndex:null)}this.fillNonElevatedRoadSegment(J)}}else for(let J=0;J<s.length;J++)this.addLine(s[J],r,h,k,P,R,L,void 0,z&&J>0?J:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,g,y,h,b,void 0,this.worldview)}computeSegNextDir(r,s){return r.nextPoint.sub(s.at(-2)).unit()}computeSegPrevDir(r,s){return s[1].sub(r.prevPoint).unit()}clipLinesToTile(r,s){return Qw(r,-s,-s,Vt+s,Vt+s)}clipRuntimeLinesToTile(r,s){const u=[];return[Qw(r,-s,-s,Vt+s,Vt+s,u),u]}addElevatedRoadFeature(r,s,u,h,g,y,b,T){const E=[],k=Zr.getElevationFeature(r,h);if(k){const P=this.clipLinesToTile(s,1),R=this.prepareElevatedLines(P,k,u);for(const L of R)E.push({geometry:L,elevation:k,elevationTileID:u,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(E.length===0)return!1;for(const P of E){const R=this.layoutVertexArray.length;this.addLine(P.geometry,r,u,g,y,b,T);const L=new Ln(u,P.elevationTileID);if(P.elevation)for(let z=R;z<this.layoutVertexArray.length;z++){const W=new wt(this.layoutVertexArray.int16[6*z]>>1,this.layoutVertexArray.int16[6*z+1]>>1),J=L.pointElevation(W,P.elevation,.05);this.updateHeightRange(J),this.zOffsetVertexArray.emplaceBack(J,0,0)}else this.fillNonElevatedRoadSegment(R)}return!0}prepareElevatedLines(r,s,u){if(s.constantHeight!=null)return r;const h=[],g=1/Ie(u);for(const y of r)fq(y,new ki(s,g),0,h);return h}fillNonElevatedRoadSegment(r){for(let s=r;s<this.layoutVertexArray.length;s++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(r){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,r),this.heightRange.max=Math.max(this.heightRange.max,r)):this.heightRange={min:r,max:r}}addLine(r,s,u,h,g,y,b,T,E){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=E?this.lineFeatureClips(s,E):this.lineClips;const k=h==="none";this.patternJoinNone=this.hasPattern&&k,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const P=T&&T.progress.min>0,R=T&&T.progress.max<1;if(this.lineClips){let ze={min:this.lineClips.start,max:this.lineClips.end},ct=1;if(T){const gt=this.lineClips.end-this.lineClips.start;ze=function(St,Lt,kt){return{min:mi(St.min,Lt,kt),max:mi(St.max,Lt,kt)}}(T.progress,{min:0,max:1},ze),gt>0&&(ct=(ze.max-ze.min)/gt)}const We=+s.properties.mapbox_clip_feature_len,ut=+s.properties.mapbox_clip_seg_len;if(Number.isNaN(We)||Number.isNaN(ut)){for(let St=0;St<r.length-1;St++)this.totalDistance+=r[St].dist(r[St+1]);const gt=this.totalDistance/(ze.max-ze.min);this.totalFeatureLength=Number.isFinite(gt)?gt:0,this.lineClips.start=ze.min,this.lineClips.end=ze.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=We,this.distance=ut*ct,this.lineClips.start=ze.min,this.lineClips.end=ze.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const L=Qq[s.type]==="Polygon";let z=r.length;for(;z>=2&&r[z-1].equals(r[z-2]);)z--;let W=0;for(;W<z-1&&r[W].equals(r[W+1]);)W++;if(z<(L?3:2))return;h==="bevel"&&(y=1.05);const J=this.segments.prepareSegment(10*z,this.layoutVertexArray,this.indexArray);let te,ae,ue,he,Ce,be,ke,Me;T&&T.prevDir&&(be=T.prevDir.perp()),T&&T.nextDir&&(ke=T.nextDir.perp()),this.e1=this.e2=-1,L&&(te=r[z-2],Ce=r[W].sub(te)._unit()._perp());for(let ze=W;ze<z;ze++){if(ue=ze===z-1?L?r[W+1]:void 0:r[ze+1],ue&&r[ze].equals(ue))continue;Ce&&(he=Ce),te&&(ae=te),te=r[ze],Me=this.evaluateLineProgressFeatures(ae?ae.dist(te):0),Ce=ue?ue.sub(te)._unit()._perp():he,he=he||Ce;const ct=ae&&ue;let We=ct?h:L||k?"butt":g;const ut=he.x*Ce.x+he.y*Ce.y;if(k){const rt=function(At){if(At.patternJoinNone){const Nt=At.segmentPoints.length/2,xt=At.lineSoFar-At.segmentStart;for(let sr=0;sr<Nt;++sr){const cr=At.segmentPoints[2*sr+1],tr=Math.round(At.segmentPoints[2*sr])+.5+.25*cr;At.patternVertexArray.emplaceBack(tr,xt,At.segmentStart),At.patternVertexArray.emplaceBack(tr,xt,At.segmentStart)}At.segmentPoints.length=0}At.e1=At.e2=-1};if(ct&&ut<tG){this.updateDistance(ae,te),this.addCurrentVertex(te,he,1,1,J,Me),rt(this),this.addCurrentVertex(te,Ce,-1,-1,J,Me);continue}if(ae){if(!ue){this.updateDistance(ae,te),this.addCurrentVertex(te,he,1,1,J,Me),rt(this);continue}We="miter"}}let gt=he.add(Ce);gt.x===0&&gt.y===0||gt._unit();const St=gt.x*Ce.x+gt.y*Ce.y,Lt=St!==0?1/St:1/0,kt=2*Math.sqrt(2-2*St),_t=St<eG&&ae&&ue,It=he.x*Ce.y-he.y*Ce.x>0,ot=this.overscaling<=16?15*Vt/(512*this.overscaling):0;if(ct&&We==="round"){if(Lt<b)We="miter";else if(Lt<=2){const rt=lC(te,-10,Vt+10);We=this.elevationType==="offset"&&(rt||this.hasCrossSlope)?"miter":"fakeround"}}if(We==="miter"&&Lt>y&&(We="bevel"),We==="bevel"&&(Lt>2&&(We="flipbevel"),Lt<y&&(We="miter")),ae&&!(We==="miter"&&_t)&&this.updateDistance(ae,te),We==="miter")if(_t){const rt=te.dist(ae);if(rt>2*ot){const Nt=te.sub(te.sub(ae)._mult(ot/rt)._round());this.updateDistance(ae,Nt),this.addCurrentVertex(Nt,he,0,0,J,Me),ae=Nt}this.updateDistance(ae,te),gt._mult(Lt),this.addCurrentVertex(te,gt,0,0,J,Me);const At=te.dist(ue);if(At>2*ot){const Nt=te.add(ue.sub(te)._mult(ot/At)._round());this.updateDistance(te,Nt),this.addCurrentVertex(Nt,Ce,0,0,J,Me),te=Nt}}else gt._mult(Lt),this.addCurrentVertex(te,gt,0,0,J,Me);else if(We==="flipbevel"){if(Lt>100)gt=Ce.mult(-1);else{const rt=Lt*he.add(Ce).mag()/he.sub(Ce).mag();gt._perp()._mult(rt*(It?-1:1))}this.addCurrentVertex(te,gt,0,0,J,Me),this.addCurrentVertex(te,gt.mult(-1),0,0,J,Me)}else if(We==="bevel"||We==="fakeround"){Me!=null&&ae&&this.addCurrentVertex(te,ke||he,-1,-1,J,Me);const rt=te.dist(ae)<=2*ot&&We!=="bevel",At=gt.mult(It?1:-1);At._mult(Lt);const Nt=Ce.mult(It?-1:1),xt=he.mult(It?-1:1),sr=this.evaluateLineProgressFeatures(this.distance);if(Me==null&&(this.addHalfVertex(te,At.x,At.y,!1,!It,0,J,sr),rt||this.addHalfVertex(te,At.x+2*xt.x,At.y+2*xt.y,!1,It,0,J,sr)),We==="fakeround"){const cr=Math.round(180*kt/Math.PI/20);this.addHalfVertex(te,xt.x,xt.y,!1,It,0,J,sr);for(let tr=0;tr<cr;tr++){let Zt=tr/cr;if(Zt!==.5){const Jt=Zt-.5;Zt+=Zt*Jt*(Zt-1)*((1.0904+ut*(ut*(3.55645-1.43519*ut)-3.2452))*Jt*Jt+(.848013+ut*(.215638*ut-1.06021)))}const Xr=Nt.sub(xt)._mult(Zt)._add(xt)._unit();this.addHalfVertex(te,Xr.x,Xr.y,!1,It,0,J,sr)}this.addHalfVertex(te,Nt.x,Nt.y,!1,It,0,J,sr)}rt||Me!=null||this.addHalfVertex(te,At.x+2*Nt.x,At.y+2*Nt.y,!1,It,0,J,sr),Me!=null&&ue&&this.addCurrentVertex(te,be||Ce,1,1,J,Me)}else if(We==="butt")this.addCurrentVertex(te,gt,0,0,J,Me);else if(We==="square"){if(!ae){const rt=P?0:-1;this.addCurrentVertex(te,gt,rt,rt,J,Me)}if(this.addCurrentVertex(te,gt,0,0,J,Me),ae){const rt=R?0:1;this.addCurrentVertex(te,gt,rt,rt,J,Me)}}else if(We==="round"){if(ae){const rt=!ct&&ke?ke:he;this.addCurrentVertex(te,rt,0,0,J,Me),!ct&&R||this.addCurrentVertex(te,rt,1,1,J,Me,!0)}if(ue){const rt=!ct&&be?be:Ce;!ct&&P||this.addCurrentVertex(te,rt,-1,-1,J,Me,!0),this.addCurrentVertex(te,rt,0,0,J,Me)}}}}addVerticesTo(r,s,u,h,g,y,b,T,E,k){const P=(s.w-r.w)/this.tessellationStep|0;let R=0;const L=this.scaledDistance;if(P>1){this.lineSoFar=r.w;const W=(s.x-r.x)/P,J=(s.y-r.y)/P,te=(s.z-r.z)/P,ae=(s.w-r.w)/P;for(let ue=1;ue<P;++ue){r.x+=W,r.y+=J,r.z+=te,this.lineSoFar+=ae,R+=ae;const he=this.evaluateLineProgressFeatures(this.prevDistance+R);this.scaledDistance=(this.prevDistance+R)/this.totalDistance,this.addHalfVertex(r,u,h,k,!1,b,E,he),this.addHalfVertex(r,g,y,k,!0,-T,E,he)}}this.lineSoFar=s.w,this.scaledDistance=L;const z=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(s,u,h,k,!1,b,E,z),this.addHalfVertex(s,g,y,k,!0,-T,E,z)}evaluateLineProgressFeatures(r){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+r)/this.totalFeatureLength):Cr(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let s=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(s=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:s}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:s}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:s}}addCurrentVertex(r,s,u,h,g,y,b=!1){const T=s.x+s.y*u,E=s.y-s.x*u,k=s.y*h-s.x,P=-s.y-s.x*h;if(y!=null){const R=this.elevationType==="offset",L=-10,z=Vt+10,W=y.zOffset,J=new _M(r.x,r.y,W,this.lineSoFar),te=!!R&&lC(r,L,z),ae=this.lineSoFar,ue=this.distance;if(this.currentVertex)if(te){const he=this.currentVertexIsOutside,Ce=this.currentVertex,be=new _M(r.x,r.y,W,this.lineSoFar);if(vM(Ce,be,L,z),!lC(be,L,z)){if(he){this.e1=this.e2=-1,this.distance-=Ce.dist(J),this.lineSoFar=Ce.w;const ke=this.evaluateLineProgressFeatures(Ce.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Ce,T,E,b,!1,u,g,ke),this.addHalfVertex(Ce,k,P,b,!0,-h,g,ke),this.prevDistance=this.distance}this.distance=this.prevDistance+Ce.dist(be),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Ce,be,T,E,k,P,u,h,g,b),this.distance=ue,this.scaledDistance=this.distance/this.totalDistance}}else{const he=this.currentVertex;if(this.currentVertexIsOutside){vM(he,J,L,z),this.e1=this.e2=-1,this.distance-=he.dist(J),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=he.w;const Ce=this.evaluateLineProgressFeatures(he.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(he,T,E,b,!1,u,g,Ce),this.addHalfVertex(he,k,P,b,!0,-h,g,Ce),this.prevDistance=this.distance,this.distance=ue,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(he,J,T,E,k,P,u,h,g,b)}else te||(this.addHalfVertex(r,T,E,b,!1,u,g,y),this.addHalfVertex(r,k,P,b,!0,-h,g,y));this.currentVertex=J,this.currentVertexIsOutside=te,this.lineSoFar=ae}else this.addHalfVertex(r,T,E,b,!1,u,g,y),this.addHalfVertex(r,k,P,b,!0,-h,g,y)}addHalfVertex({x:r,y:s},u,h,g,y,b,T,E){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),y||this.segmentPoints.push(this.lineSoFar-this.segmentStart,b)),this.layoutVertexArray.emplaceBack((r<<1)+(g?1:0),(s<<1)+(y?1:0),Math.round(63*u)+128,Math.round(63*h)+128,1+(b===0?0:b<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const P=Br(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,P)}const k=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,k),T.primitiveLength++),y?this.e2=k:this.e1=k,E!=null&&this.zOffsetVertexArray.emplaceBack(E.zOffset,E.variableWidth,E.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(r,s){this.prevDistance=this.distance,this.distance+=r.dist(s),this.updateScaledDistance()}}function lC(a,r,s){return a.x<r||a.x>s||a.y<r||a.y>s}let YM,JM;function QM(a,r,s){return r*(Vt/(a.tileSize*Math.pow(2,s-a.tileID.overscaledZ)))}or(aC,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const eN=(a,r,s)=>(1-s)*a+s*r;function tN(a,r){return 1/QM(a,1,r.tileZoom)}function rN(a,r,s,u){return a.translatePosMatrix(u||r.tileID.projMatrix,r,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const nN=a=>{const r=[];iN(a)&&r.push("RENDER_LINE_DASH"),a.paint.get("line-gradient")&&r.push("RENDER_LINE_GRADIENT");const s=a.paint.get("line-trim-offset");s[0]===0&&s[1]===0||r.push("RENDER_LINE_TRIM_OFFSET"),a.paint.get("line-border-width").constantOr(1)!==0&&r.push("RENDER_LINE_BORDER");const u=a.layout.get("line-join").constantOr("miter")==="none",h=!!a.paint.get("line-pattern").constantOr(1);return u&&h&&r.push("LINE_JOIN_NONE"),r};function iN(a){const r=a.paint.get("line-dasharray").value;return r.kind!=="constant"||r.value}let cC;const sN=()=>cC||(cC={layout:YM||(YM=new is({"line-cap":new Qt(He.layout_line["line-cap"]),"line-join":new Qt(He.layout_line["line-join"]),"line-miter-limit":new Rt(He.layout_line["line-miter-limit"]),"line-round-limit":new Rt(He.layout_line["line-round-limit"]),"line-sort-key":new Qt(He.layout_line["line-sort-key"]),"line-z-offset":new Qt(He.layout_line["line-z-offset"]),"line-elevation-reference":new Rt(He.layout_line["line-elevation-reference"]),"line-cross-slope":new Rt(He.layout_line["line-cross-slope"]),visibility:new Rt(He.layout_line.visibility),"line-width-unit":new Rt(He.layout_line["line-width-unit"])})),paint:JM||(JM=new is({"line-opacity":new Qt(He.paint_line["line-opacity"]),"line-color":new Qt(He.paint_line["line-color"]),"line-translate":new Rt(He.paint_line["line-translate"]),"line-translate-anchor":new Rt(He.paint_line["line-translate-anchor"]),"line-width":new Qt(He.paint_line["line-width"]),"line-gap-width":new Qt(He.paint_line["line-gap-width"]),"line-offset":new Qt(He.paint_line["line-offset"]),"line-blur":new Qt(He.paint_line["line-blur"]),"line-dasharray":new Qt(He.paint_line["line-dasharray"]),"line-pattern":new Qt(He.paint_line["line-pattern"]),"line-pattern-cross-fade":new Rt(He.paint_line["line-pattern-cross-fade"]),"line-gradient":new Ch(He.paint_line["line-gradient"]),"line-trim-offset":new Rt(He.paint_line["line-trim-offset"]),"line-trim-fade-range":new Rt(He.paint_line["line-trim-fade-range"]),"line-trim-color":new Rt(He.paint_line["line-trim-color"]),"line-emissive-strength":new Rt(He.paint_line["line-emissive-strength"]),"line-border-width":new Qt(He.paint_line["line-border-width"]),"line-border-color":new Qt(He.paint_line["line-border-color"]),"line-occlusion-opacity":new Rt(He.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},cC);class rG extends Qt{possiblyEvaluate(r,s){return s=new Ai(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,transition:s.transition,worldview:s.worldview}),super.possiblyEvaluate(r,s)}evaluate(r,s,u,h){return s=Object.assign({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(r,s,u,h)}}let Dx;function oN(a,r){return r>0?r+2*a:a}const nG=vn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),iG=vn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),sG=vn([{name:"a_projected_pos",components:4,type:"Float32"}],4);vn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const oG=vn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),aG=vn([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),lG=vn([{name:"a_texb",components:2,type:"Uint16"}]),cG=vn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),uG=vn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);vn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const aN=vn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),dG=vn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);vn([{name:"triangle",components:3,type:"Uint16"}]),vn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),vn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),vn([{type:"Float32",name:"offsetX"}]),vn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var go=24;function hG(a,r,s){return a.sections.forEach(u=>{u.text=function(h,g,y){const b=g.layout.get("text-transform").evaluate(y,{});return b==="uppercase"?h=h.toLocaleUpperCase():b==="lowercase"&&(h=h.toLocaleLowerCase()),_a.applyArabicShaping&&(h=_a.applyArabicShaping(h)),h}(u.text,r,s)}),a}const Ox={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function fG(a){return a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""}function pG(a){return a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""}const uC=4294967296,lN=1/uC,cN=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let u1=class{constructor(a=new Uint8Array(16)){this.buf=ArrayBuffer.isView(a)?a:new Uint8Array(a),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(a,r,s=this.length){for(;this.pos<s;){const u=this.readVarint(),h=u>>3,g=this.pos;this.type=7&u,a(h,r,this),this.pos===g&&this.skip(u)}return r}readMessage(a,r){return this.readFields(a,r,this.readVarint()+this.pos)}readFixed32(){const a=this.dataView.getUint32(this.pos,!0);return this.pos+=4,a}readSFixed32(){const a=this.dataView.getInt32(this.pos,!0);return this.pos+=4,a}readFixed64(){const a=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*uC;return this.pos+=8,a}readSFixed64(){const a=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*uC;return this.pos+=8,a}readFloat(){const a=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,a}readDouble(){const a=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,a}readVarint(a){const r=this.buf;let s,u;return u=r[this.pos++],s=127&u,u<128?s:(u=r[this.pos++],s|=(127&u)<<7,u<128?s:(u=r[this.pos++],s|=(127&u)<<14,u<128?s:(u=r[this.pos++],s|=(127&u)<<21,u<128?s:(u=r[this.pos],s|=(15&u)<<28,function(h,g,y){const b=y.buf;let T,E;if(E=b[y.pos++],T=(112&E)>>4,E<128||(E=b[y.pos++],T|=(127&E)<<3,E<128)||(E=b[y.pos++],T|=(127&E)<<10,E<128)||(E=b[y.pos++],T|=(127&E)<<17,E<128)||(E=b[y.pos++],T|=(127&E)<<24,E<128)||(E=b[y.pos++],T|=(1&E)<<31,E<128))return s_(h,T,g);throw new Error("Expected varint not more than 10 bytes")}(s,a,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const a=this.readVarint();return a%2==1?(a+1)/-2:a/2}readBoolean(){return!!this.readVarint()}readString(){const a=this.readVarint()+this.pos,r=this.pos;return this.pos=a,a-r>=12&&cN?cN.decode(this.buf.subarray(r,a)):function(s,u,h){let g="",y=u;for(;y<h;){const b=s[y];let T,E,k,P=null,R=b>239?4:b>223?3:b>191?2:1;if(y+R>h)break;R===1?b<128&&(P=b):R===2?(T=s[y+1],(192&T)==128&&(P=(31&b)<<6|63&T,P<=127&&(P=null))):R===3?(T=s[y+1],E=s[y+2],(192&T)==128&&(192&E)==128&&(P=(15&b)<<12|(63&T)<<6|63&E,(P<=2047||P>=55296&&P<=57343)&&(P=null))):R===4&&(T=s[y+1],E=s[y+2],k=s[y+3],(192&T)==128&&(192&E)==128&&(192&k)==128&&(P=(15&b)<<18|(63&T)<<12|(63&E)<<6|63&k,(P<=65535||P>=1114112)&&(P=null))),P===null?(P=65533,R=1):P>65535&&(P-=65536,g+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),g+=String.fromCharCode(P),y+=R}return g}(this.buf,r,a)}readBytes(){const a=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,a);return this.pos=a,r}readPackedVarint(a=[],r){const s=this.readPackedEnd();for(;this.pos<s;)a.push(this.readVarint(r));return a}readPackedSVarint(a=[]){const r=this.readPackedEnd();for(;this.pos<r;)a.push(this.readSVarint());return a}readPackedBoolean(a=[]){const r=this.readPackedEnd();for(;this.pos<r;)a.push(this.readBoolean());return a}readPackedFloat(a=[]){const r=this.readPackedEnd();for(;this.pos<r;)a.push(this.readFloat());return a}readPackedDouble(a=[]){const r=this.readPackedEnd();for(;this.pos<r;)a.push(this.readDouble());return a}readPackedFixed32(a=[]){const r=this.readPackedEnd();for(;this.pos<r;)a.push(this.readFixed32());return a}readPackedSFixed32(a=[]){const r=this.readPackedEnd();for(;this.pos<r;)a.push(this.readSFixed32());return a}readPackedFixed64(a=[]){const r=this.readPackedEnd();for(;this.pos<r;)a.push(this.readFixed64());return a}readPackedSFixed64(a=[]){const r=this.readPackedEnd();for(;this.pos<r;)a.push(this.readSFixed64());return a}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(a){const r=7&a;if(r===0)for(;this.buf[this.pos++]>127;);else if(r===2)this.pos=this.readVarint()+this.pos;else if(r===5)this.pos+=4;else{if(r!==1)throw new Error(`Unimplemented type: ${r}`);this.pos+=8}}writeTag(a,r){this.writeVarint(a<<3|r)}realloc(a){let r=this.length||16;for(;r<this.pos+a;)r*=2;if(r!==this.length){const s=new Uint8Array(r);s.set(this.buf),this.buf=s,this.dataView=new DataView(s.buffer),this.length=r}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeSFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*lN),!0),this.pos+=8}writeSFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*lN),!0),this.pos+=8}writeVarint(a){(a=+a||0)>268435455||a<0?function(r,s){let u,h;if(r>=0?(u=r%4294967296|0,h=r/4294967296|0):(u=~(-r%4294967296),h=~(-r/4294967296),4294967295^u?u=u+1|0:(u=0,h=h+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(g,y,b){b.buf[b.pos++]=127&g|128,g>>>=7,b.buf[b.pos++]=127&g|128,g>>>=7,b.buf[b.pos++]=127&g|128,g>>>=7,b.buf[b.pos++]=127&g|128,b.buf[b.pos]=127&(g>>>=7)}(u,0,s),function(g,y){const b=(7&g)<<4;y.buf[y.pos++]|=b|((g>>>=3)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g)))))}(h,s)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))}writeSVarint(a){this.writeVarint(a<0?2*-a-1:2*a)}writeBoolean(a){this.writeVarint(+a)}writeString(a){a=String(a),this.realloc(4*a.length),this.pos++;const r=this.pos;this.pos=function(u,h,g){for(let y,b,T=0;T<h.length;T++){if(y=h.charCodeAt(T),y>55295&&y<57344){if(!b){y>56319||T+1===h.length?(u[g++]=239,u[g++]=191,u[g++]=189):b=y;continue}if(y<56320){u[g++]=239,u[g++]=191,u[g++]=189,b=y;continue}y=b-55296<<10|y-56320|65536,b=null}else b&&(u[g++]=239,u[g++]=191,u[g++]=189,b=null);y<128?u[g++]=y:(y<2048?u[g++]=y>>6|192:(y<65536?u[g++]=y>>12|224:(u[g++]=y>>18|240,u[g++]=y>>12&63|128),u[g++]=y>>6&63|128),u[g++]=63&y|128)}return g}(this.buf,a,this.pos);const s=this.pos-r;s>=128&&uN(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s}writeFloat(a){this.realloc(4),this.dataView.setFloat32(this.pos,a,!0),this.pos+=4}writeDouble(a){this.realloc(8),this.dataView.setFloat64(this.pos,a,!0),this.pos+=8}writeBytes(a){const r=a.length;this.writeVarint(r),this.realloc(r);for(let s=0;s<r;s++)this.buf[this.pos++]=a[s]}writeRawMessage(a,r){this.pos++;const s=this.pos;a(r,this);const u=this.pos-s;u>=128&&uN(s,u,this),this.pos=s-1,this.writeVarint(u),this.pos+=u}writeMessage(a,r,s){this.writeTag(a,2),this.writeRawMessage(r,s)}writePackedVarint(a,r){r.length&&this.writeMessage(a,mG,r)}writePackedSVarint(a,r){r.length&&this.writeMessage(a,gG,r)}writePackedBoolean(a,r){r.length&&this.writeMessage(a,vG,r)}writePackedFloat(a,r){r.length&&this.writeMessage(a,_G,r)}writePackedDouble(a,r){r.length&&this.writeMessage(a,yG,r)}writePackedFixed32(a,r){r.length&&this.writeMessage(a,xG,r)}writePackedSFixed32(a,r){r.length&&this.writeMessage(a,bG,r)}writePackedFixed64(a,r){r.length&&this.writeMessage(a,wG,r)}writePackedSFixed64(a,r){r.length&&this.writeMessage(a,SG,r)}writeBytesField(a,r){this.writeTag(a,2),this.writeBytes(r)}writeFixed32Field(a,r){this.writeTag(a,5),this.writeFixed32(r)}writeSFixed32Field(a,r){this.writeTag(a,5),this.writeSFixed32(r)}writeFixed64Field(a,r){this.writeTag(a,1),this.writeFixed64(r)}writeSFixed64Field(a,r){this.writeTag(a,1),this.writeSFixed64(r)}writeVarintField(a,r){this.writeTag(a,0),this.writeVarint(r)}writeSVarintField(a,r){this.writeTag(a,0),this.writeSVarint(r)}writeStringField(a,r){this.writeTag(a,2),this.writeString(r)}writeFloatField(a,r){this.writeTag(a,5),this.writeFloat(r)}writeDoubleField(a,r){this.writeTag(a,1),this.writeDouble(r)}writeBooleanField(a,r){this.writeVarintField(a,+r)}};function s_(a,r,s){return s?4294967296*r+(a>>>0):4294967296*(r>>>0)+(a>>>0)}function uN(a,r,s){const u=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));s.realloc(u);for(let h=s.pos-1;h>=a;h--)s.buf[h+u]=s.buf[h]}function mG(a,r){for(let s=0;s<a.length;s++)r.writeVarint(a[s])}function gG(a,r){for(let s=0;s<a.length;s++)r.writeSVarint(a[s])}function _G(a,r){for(let s=0;s<a.length;s++)r.writeFloat(a[s])}function yG(a,r){for(let s=0;s<a.length;s++)r.writeDouble(a[s])}function vG(a,r){for(let s=0;s<a.length;s++)r.writeBoolean(a[s])}function xG(a,r){for(let s=0;s<a.length;s++)r.writeFixed32(a[s])}function bG(a,r){for(let s=0;s<a.length;s++)r.writeSFixed32(a[s])}function wG(a,r){for(let s=0;s<a.length;s++)r.writeFixed64(a[s])}function SG(a,r){for(let s=0;s<a.length;s++)r.writeSFixed64(a[s])}const dC=3;function TG(a,r,s){r.glyphs=[],a===1&&s.readMessage(EG,r)}function EG(a,r,s){if(a===3){const{id:u,bitmap:h,width:g,height:y,left:b,top:T,advance:E}=s.readMessage(CG,{});r.glyphs.push({id:u,bitmap:new Uh({width:g+2*dC,height:y+2*dC},h),metrics:{width:g,height:y,left:b,top:T,advance:E}})}else a===4?r.ascender=s.readSVarint():a===5&&(r.descender=s.readSVarint())}function CG(a,r,s){a===1?r.id=s.readVarint():a===2?r.bitmap=s.readBytes():a===3?r.width=s.readVarint():a===4?r.height=s.readVarint():a===5?r.left=s.readSVarint():a===6?r.top=s.readSVarint():a===7&&(r.advance=s.readVarint())}const dN=dC,Va={horizontal:1,vertical:2,horizontalOnly:3};class Lx{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(r,s){const u=new Lx;return u.scale=r||1,u.fontStack=s,u}static forImage(r){const s=new Lx;return s.image=r,s}}class o_{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,s,u){const h=new o_;for(let g=0;g<r.sections.length;g++){const y=r.sections[g];y.image?h.addImageSection(y,u):h.addTextSection(y,s)}return h}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCodePoint(r){return this.text.codePointAt(r)}verticalizePunctuation(r){this.text=function(s,u){let h="";for(let g=0;g<s.length;g++){const y=s.charCodeAt(g+1)||null,b=s.charCodeAt(g-1)||null;h+=!u&&(y&&Vv(y)&&!Ox[s[g+1]]||b&&Vv(b)&&!Ox[s[g-1]])||!Ox[s[g]]?s[g]:Ox[s[g]]}return h}(this.text,r)}trim(){let r=0;for(let u=0;u<this.text.length&&d1[this.text.charCodeAt(u)];u++)r++;let s=this.text.length;for(let u=this.text.length-1;u>=0&&u>=r&&d1[this.text.charCodeAt(u)];u--)s--;this.text=this.text.substring(r,s),this.sectionIndex=this.sectionIndex.slice(r,s)}substring(r,s){const u=new o_;return u.text=this.text.substring(r,s),u.sectionIndex=this.sectionIndex.slice(r,s),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,s)=>Math.max(r,this.sections[s].scale),0)}addTextSection(r,s){this.text+=r.text,this.sections.push(Lx.forText(r.scale,r.fontStack||s));const u=this.sections.length-1;for(let h=0;h<r.text.length;++h)this.sectionIndex.push(u)}addImageSection(r,s){const u=r.image?r.image.getPrimary():null;if(!u)return void Cr("Can't add FormattedSection with an empty image.");u.scaleSelf(s);const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCodePoint(h),this.sections.push(Lx.forImage(u)),this.sectionIndex.push(this.sections.length-1)):Cr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function hC(a,r,s,u,h,g,y,b,T,E,k,P,R,L,z,W=1){const J=o_.fromFeature(a,h,W);P===Va.vertical&&J.verticalizePunctuation(R);let te=[];const ae=function(ke,Me,ze,ct,We,ut){if(!ke)return[];const gt=[],St=function(It,ot,rt,At,Nt,xt){let sr=0;for(let cr=0;cr<It.length();cr++){const tr=It.getSection(cr);sr+=hN(It.getCodePoint(cr),tr,At,Nt,ot,xt)}return sr/Math.max(1,Math.ceil(sr/rt))}(ke,Me,ze,ct,We,ut),Lt=ke.text.indexOf("")>=0;let kt=0;for(let It=0;It<ke.length();It++){const ot=ke.getSection(It),rt=ke.getCodePoint(It);if(d1[rt]||(kt+=hN(rt,ot,ct,We,Me,ut)),It<ke.length()-1){const At=!((_t=rt)<11904||!(Ir["Bopomofo Extended"](_t)||Ir.Bopomofo(_t)||Ir["CJK Compatibility Forms"](_t)||Ir["CJK Compatibility Ideographs"](_t)||Ir["CJK Compatibility"](_t)||Ir["CJK Radicals Supplement"](_t)||Ir["CJK Strokes"](_t)||Ir["CJK Symbols and Punctuation"](_t)||Ir["CJK Unified Ideographs Extension A"](_t)||Ir["CJK Unified Ideographs"](_t)||Ir["Enclosed CJK Letters and Months"](_t)||Ir["Halfwidth and Fullwidth Forms"](_t)||Ir.Hiragana(_t)||Ir["Ideographic Description Characters"](_t)||Ir["Kangxi Radicals"](_t)||Ir["Katakana Phonetic Extensions"](_t)||Ir.Katakana(_t)||Ir["Vertical Forms"](_t)||Ir["Yi Radicals"](_t)||Ir["Yi Syllables"](_t)));(AG[rt]||At||ot.image)&&gt.push(pN(It+1,kt,St,gt,jG(rt,ke.getCodePoint(It+1),At&&Lt),!1))}}var _t;return mN(pN(ke.length(),kt,St,gt,0,!0))}(J,E,g,r,u,L),{processBidirectionalText:ue,processStyledBidirectionalText:he}=_a;if(ue&&J.sections.length===1){const ke=ue(J.toString(),ae);for(const Me of ke){const ze=new o_;ze.text=Me,ze.sections=J.sections;for(let ct=0;ct<Me.length;ct++)ze.sectionIndex.push(0);te.push(ze)}}else if(he){const ke=he(J.text,J.sectionIndex,ae);for(const Me of ke){const ze=new o_;ze.text=Me[0],ze.sectionIndex=Me[1],ze.sections=J.sections,te.push(ze)}}else te=function(ke,Me){const ze=[],ct=ke.text;let We=0;for(const ut of Me)ze.push(ke.substring(We,ut)),We=ut;return We<ct.length&&ze.push(ke.substring(We,ct.length)),ze}(J,ae);const Ce=[],be={positionedLines:Ce,text:J.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(ke,Me,ze,ct,We,ut,gt,St,Lt,kt,_t,It){let ot=0,rt=0,At=0;const Nt=St==="right"?1:St==="left"?0:.5;let xt=!1;for(const Jt of We){const Tr=Jt.getSections();for(const Jr of Tr){if(Jr.image)continue;const pn=Me[Jr.fontStack];if(pn&&(xt=pn.ascender!==void 0&&pn.descender!==void 0,!xt))break}if(!xt)break}let sr=0;for(const Jt of We){Jt.trim();const Tr=Jt.getMaxScale(),Jr=(Tr-1)*go,pn={positionedGlyphs:[],lineOffset:0};ke.positionedLines[sr]=pn;const zn=pn.positionedGlyphs;let rn=0;if(!Jt.length()){rt+=ut,++sr;continue}let Hn=0,Wn=0;for(let we=0;we<Jt.length();we++){const _e=Jt.getSection(we),ht=Jt.getSectionIndex(we),Ht=Jt.getCodePoint(we);let ft=_e.scale,Xt=null,mr=null,fr=null,nn=go,Mr=0,dr=Lt;dr===Va.vertical&&((cr=Ht)===12312||cr===12313||cr===12316||cr===12540||cr===12448)&&(dr=Va.horizontal);const qn=!(dr===Va.horizontal||!_t&&!Mg(Ht)||_t&&(d1[Ht]||Uv(Ht)));if(_e.image){const gi=ct.get(_e.image.toString());if(!gi)continue;fr=_e.image,ke.iconsInText=ke.iconsInText||!0,mr=gi.paddedRect;const Dr=gi.displaySize;ft=ft*go/It,Xt={width:Dr[0],height:Dr[1],left:0,top:-dN,advance:qn?Dr[1]:Dr[0],localGlyph:!1},Mr=xt?-Xt.height*ft:Tr*go-17-Dr[1]*ft,nn=Xt.advance;const Dn=(qn?Dr[0]:Dr[1])*ft-go*Tr;Dn>0&&Dn>rn&&(rn=Dn)}else{const gi=ze[_e.fontStack];if(!gi)continue;gi[Ht]&&(mr=gi[Ht]);const Dr=Me[_e.fontStack];if(!Dr)continue;const Dn=Dr.glyphs[Ht];if(!Dn)continue;if(Xt=Dn.metrics,nn=Ht!==8203?go:0,xt){const _i=Dr.ascender!==void 0?Math.abs(Dr.ascender):0,ni=Dr.descender!==void 0?Math.abs(Dr.descender):0,rs=(_i+ni)*ft;Hn<rs&&(Hn=rs,Wn=(_i-ni)/2*ft),Mr=-_i*ft}else Mr=(Tr-ft)*go-17}qn?(ke.verticalizable=!0,zn.push({glyph:Ht,image:fr,x:ot,y:rt+Mr,vertical:qn,scale:ft,localGlyph:Xt.localGlyph,fontStack:_e.fontStack,sectionIndex:ht,metrics:Xt,rect:mr}),ot+=nn*ft+kt):(zn.push({glyph:Ht,image:fr,x:ot,y:rt+Mr,vertical:qn,scale:ft,localGlyph:Xt.localGlyph,fontStack:_e.fontStack,sectionIndex:ht,metrics:Xt,rect:mr}),ot+=Xt.advance*ft+kt)}zn.length!==0&&(At=Math.max(ot-kt,At),xt?gN(zn,Nt,rn,Wn,ut*Tr/2):gN(zn,Nt,rn,0,ut/2)),ot=0;const Hi=ut*Tr+rn;pn.lineOffset=Math.max(rn,Jr),rt+=Hi,++sr}var cr;const tr=rt,{horizontalAlign:Zt,verticalAlign:Xr}=fC(gt);(function(Jt,Tr,Jr,pn,zn,rn){const Hn=(Tr-Jr)*zn,Wn=-rn*pn;for(const Hi of Jt)for(const we of Hi.positionedGlyphs)we.x+=Hn,we.y+=Wn})(ke.positionedLines,Nt,Zt,Xr,At,tr),ke.top+=-Xr*tr,ke.bottom=ke.top+tr,ke.left+=-Zt*At,ke.right=ke.left+At,ke.hasBaseline=xt}(be,r,s,u,te,y,b,T,P,E,R,z),!function(ke){for(const Me of ke)if(Me.positionedGlyphs.length!==0)return!1;return!0}(Ce))return be}const d1={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},AG={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function hN(a,r,s,u,h,g){if(r.image){const y=u.get(r.image.toString());return y?y.displaySize[0]*r.scale*go/g+h:0}{const y=s[r.fontStack],b=y&&y.glyphs[a];return b?b.metrics.advance*r.scale+h:0}}function fN(a,r,s,u){const h=Math.pow(a-r,2);return u?a<r?h/2:2*h:h+Math.abs(s)*s}function jG(a,r,s){let u=0;return a===10&&(u-=1e4),s&&(u+=150),a!==40&&a!==65288||(u+=50),r!==41&&r!==65289||(u+=50),u}function pN(a,r,s,u,h,g){let y=null,b=fN(r,s,h,g);for(const T of u){const E=fN(r-T.x,s,h,g)+T.badness;E<=b&&(y=T,b=E)}return{index:a,x:r,priorBreak:y,badness:b}}function mN(a){return a?mN(a.priorBreak).concat(a.index):[]}function fC(a){let r=.5,s=.5;switch(a){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:r,verticalAlign:s}}function gN(a,r,s,u,h){if(!(r||s||u||h))return;const g=a.length-1,y=a[g],b=(y.x+y.metrics.advance*y.scale)*r;for(let T=0;T<=g;T++)a[T].x-=b,a[T].y+=s+u+h}function _N(a){return a.imagePrimary!==void 0&&a.top!==void 0&&a.bottom!==void 0&&a.left!==void 0&&a.right!==void 0}function h1(a,r,s,u){const{horizontalAlign:h,verticalAlign:g}=fC(u),y=s[0]-a.displaySize[0]*h,b=s[1]-a.displaySize[1]*g;return{imagePrimary:a,imageSecondary:r,top:b,bottom:b+a.displaySize[1],left:y,right:y+a.displaySize[0]}}function pC(a,r,s,u,h,g){const y=a.imagePrimary;let b;if(y.content){const J=y.content,te=y.pixelRatio||1;b=[J[0]/te,J[1]/te,y.displaySize[0]-J[2]/te,y.displaySize[1]-J[3]/te]}const T=r.left*g,E=r.right*g;let k,P,R,L;s==="width"||s==="both"?(L=h[0]+T-u[3],P=h[0]+E+u[1]):(L=h[0]+(T+E-y.displaySize[0])/2,P=L+y.displaySize[0]);const z=r.top*g,W=r.bottom*g;return s==="height"||s==="both"?(k=h[1]+z-u[0],R=h[1]+W+u[2]):(k=h[1]+(z+W-y.displaySize[1])/2,R=k+y.displaySize[1]),{imagePrimary:y,imageSecondary:void 0,top:k,right:P,bottom:R,left:L,collisionPadding:b}}function yN(a){return!a.imagePrimary.stretchX}function vN(a){return!a.imagePrimary.stretchY}function xN(a){return{width:a.right-a.left,height:a.bottom-a.top}}const Uc=128;function a_(a,r,s){const{expression:u}=r;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Ai(a+1,{worldview:s}))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:g}=u;let y=0;for(;y<h.length&&h[y]<=a;)y++;y=Math.max(0,y-1);let b=y;for(;b<h.length&&h[b]<a+1;)b++;b=Math.min(h.length-1,b);const T=h[y],E=h[b];return u.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:E,interpolationType:g}:{kind:"camera",minZoom:T,maxZoom:E,minSize:u.evaluate(new Ai(T,{worldview:s})),maxSize:u.evaluate(new Ai(E,{worldview:s})),interpolationType:g}}}function mC(a,{uSize:r,uSizeT:s},{lowerSize:u,upperSize:h}){return a.kind==="source"?u/Uc:a.kind==="composite"?Br(u/Uc,h/Uc,s):r}function l_(a,r,s=1){let u=0,h=0;if(a.kind==="constant")h=a.layoutSize*s;else if(a.kind!=="source"){const{interpolationType:g,minZoom:y,maxZoom:b}=a,T=g?se(Ra.interpolationFactor(g,r,y,b),0,1):0;a.kind==="camera"?h=Br(a.minSize,a.maxSize,T)*s:u=T*s}return{uSizeT:u,uSize:h}}class Ad extends wt{constructor(r,s,u,h,g){super(r,s),this.angle=h,this.z=u,g!==void 0&&(this.segment=g)}clone(){return new Ad(this.x,this.y,this.z,this.angle,this.segment)}}function bN(a,r,s,u,h){if(r.segment===void 0)return!0;let g=r,y=r.segment+1,b=0;for(;b>-s/2;){if(y--,y<0)return!1;b-=a[y].dist(g),g=a[y]}b+=a[y].dist(a[y+1]),y++;const T=[];let E=0;for(;b<s/2;){const k=a[y],P=a[y+1];if(!P)return!1;let R=a[y-1].angleTo(k)-k.angleTo(P);for(R=Math.abs((R+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:b,angleDelta:R}),E+=R;b-T[0].distance>u;)E-=T.shift().angleDelta;if(E>h)return!1;y++,b+=k.dist(P)}return!0}function wN(a){let r=0;for(let s=0;s<a.length-1;s++)r+=a[s].dist(a[s+1]);return r}function SN(a,r,s){return a?.6*r*s:0}function TN(a,r){return Math.max(a?a.right-a.left:0,r?r.right-r.left:0)}function IG(a,r,s,u,h,g){const y=SN(s,h,g),b=TN(s,u)*g;let T=0;const E=wN(a)/2;for(let k=0;k<a.length-1;k++){const P=a[k],R=a[k+1],L=P.dist(R);if(T+L>E){const z=(E-T)/L,W=Br(P.x,R.x,z),J=Br(P.y,R.y,z),te=new Ad(W,J,0,R.angleTo(P),k);return!y||bN(a,te,b,y,r)?te:void 0}T+=L}}function kG(a,r,s,u,h,g,y,b,T){const E=SN(u,g,y),k=TN(u,h),P=k*y,R=a[0].x===0||a[0].x===T||a[0].y===0||a[0].y===T;return r-P<r/4&&(r=P+r/4),EN(a,R?r/2*b%r:(k/2+2*g)*y*b%r,r,E,s,P,R,!1,T)}function EN(a,r,s,u,h,g,y,b,T){const E=g/2,k=wN(a);let P=0,R=r-s,L=[];for(let z=0;z<a.length-1;z++){const W=a[z],J=a[z+1],te=W.dist(J),ae=J.angleTo(W);for(;R+s<P+te;){R+=s;const ue=(R-P)/te,he=Br(W.x,J.x,ue),Ce=Br(W.y,J.y,ue);if(he>=0&&he<T&&Ce>=0&&Ce<T&&R-E>=0&&R+E<=k){const be=new Ad(he,Ce,0,ae,z);u&&!bN(a,be,g,u,h)||L.push(be)}}P+=te}return b||L.length||y||(L=EN(a,P/2,s,u,h,g,y,!0,T)),L}function CN(a){let r=0,s=0;for(const y of a)r+=y.w*y.h,s=Math.max(s,y.w);a.sort((y,b)=>b.h-y.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),s),h:1/0}];let h=0,g=0;for(const y of a)for(let b=u.length-1;b>=0;b--){const T=u[b];if(!(y.w>T.w||y.h>T.h)){if(y.x=T.x,y.y=T.y,g=Math.max(g,y.y+y.h),h=Math.max(h,y.x+y.w),y.w===T.w&&y.h===T.h){const E=u.pop();E&&b<u.length&&(u[b]=E)}else y.h===T.h?(T.x+=y.w,T.w-=y.w):y.w===T.w?(T.y+=y.h,T.h-=y.h):(u.push({x:T.x+y.w,y:T.y,w:T.w-y.w,h:y.h}),T.y+=y.h,T.h-=y.h);break}}return{w:h,h:g,fill:r/(h*g)||0}}or(Ad,"Anchor");const Yp=1;class zx{static getImagePositionScale(r,s,u){if(s&&r&&r.options&&r.options.transform){const h=r.options.transform;return{x:h.a,y:h.d}}return{x:u,y:u}}constructor(r,s,u,h){this.paddedRect=r;const{pixelRatio:g,version:y,stretchX:b,stretchY:T,content:E,sdf:k,usvg:P}=s;this.pixelRatio=g,this.stretchX=b,this.stretchY=T,this.content=E,this.version=y,this.padding=u,this.sdf=k,this.usvg=P,this.scale=zx.getImagePositionScale(h,P,g)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function gC(a,r,s){const u=Pc.parse(a),h=function(g,y,b=[1,1]){return{x:0,y:0,w:(g.data?g.data.width:g.width*b[0])+2*y,h:(g.data?g.data.height:g.height*b[1])+2*y}}(r,s,[u.options.transform.a,u.options.transform.d]);return{bin:h,imagePosition:new zx(h,r,s,u),imageVariant:u}}class AN{constructor(r,s,u){const h=new Map,g=new Map;this.haveRenderCallbacks=[];const y=[];this.addImages(r,h,Yp,y),this.addImages(s,g,2,y);const{w:b,h:T}=CN(y),E=new Po({width:b||1,height:T||1});for(const[k,P]of r.entries()){const R=h.get(k).paddedRect;Po.copy(P.data,E,{x:0,y:0},{x:R.x+Yp,y:R.y+Yp},P.data,null,P.sdf)}for(const[k,P]of s.entries()){const R=g.get(k),L=R.paddedRect;let z=R.padding;const W=L.x+z,J=L.y+z,te=P.data.width,ae=P.data.height;z=z>1?z-1:z,Po.copy(P.data,E,{x:0,y:0},{x:W,y:J},P.data,u),Po.copy(P.data,E,{x:0,y:ae-z},{x:W,y:J-z},{width:te,height:z},u),Po.copy(P.data,E,{x:0,y:0},{x:W,y:J+ae},{width:te,height:z},u),Po.copy(P.data,E,{x:te-z,y:0},{x:W-z,y:J},{width:z,height:ae},u),Po.copy(P.data,E,{x:0,y:0},{x:W+te,y:J},{width:z,height:ae},u),Po.copy(P.data,E,{x:te-z,y:ae-z},{x:W-z,y:J-z},{width:z,height:z},u),Po.copy(P.data,E,{x:0,y:ae-z},{x:W+te,y:J-z},{width:z,height:z},u),Po.copy(P.data,E,{x:0,y:0},{x:W+te,y:J+ae},{width:z,height:z},u),Po.copy(P.data,E,{x:te-z,y:0},{x:W-z,y:J+ae},{width:z,height:z},u)}this.lut=u,this.image=E,this.iconPositions=h,this.patternPositions=g}addImages(r,s,u,h){for(const[g,y]of r.entries()){const{bin:b,imagePosition:T,imageVariant:E}=gC(g,y,u);s.set(g,T),h.push(b),y.hasRenderCallback&&this.haveRenderCallbacks.push(E.id)}}patchUpdatedImages(r,s,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>r.hasImage(h,u)),r.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(const h of r.getUpdatedImages(u)){for(const g of this.iconPositions.keys()){const y=Pc.parse(g);if(Gs.isEqual(y.id,h)){const b=r.getImage(h,u);this.patchUpdatedImage(this.iconPositions.get(g),b,s,null)}}for(const g of this.patternPositions.keys()){const y=Pc.parse(g);if(Gs.isEqual(y.id,h)){const b=r.getImage(h,u);this.patchUpdatedImage(this.patternPositions.get(g),b,s,this.lut)}}}}patchUpdatedImage(r,s,u,h=null){if(!r||!s||r.version===s.version)return;r.version=s.version;const[g,y]=r.tl,b=r.sdf;if(this.lut||b){const T={width:s.data.width,height:s.data.height},E=new Po(T);Po.copy(s.data,E,{x:0,y:0},{x:0,y:0},T,h,b),u.update(E,{position:{x:g,y}})}else u.update(s.data,{position:{x:g,y}})}}or(zx,"ImagePosition"),or(AN,"ImageAtlas");const Fx=1e20;function jN(a,r,s,u,h,g,y,b,T){for(let E=r;E<r+u;E++)IN(a,s*g+E,g,h,y,b,T);for(let E=s;E<s+h;E++)IN(a,E*g+r,1,u,y,b,T)}function IN(a,r,s,u,h,g,y){g[0]=0,y[0]=-Fx,y[1]=Fx,h[0]=a[r];for(let b=1,T=0,E=0;b<u;b++){h[b]=a[r+b*s];const k=b*b;do{const P=g[T];E=(h[b]-h[P]+k-P*P)/(b-P)/2}while(E<=y[T]&&--T>-1);T++,g[T]=b,y[T]=E,y[T+1]=Fx}for(let b=0,T=0;b<u;b++){for(;y[T+1]<b;)T++;const E=g[T],k=b-E;a[r+b*s]=h[E]+k*k}}const $c=2,_C={none:0,ideographs:1,all:2};class c_{constructor(r,s,u){this.requestManager=r,this.localGlyphMode=s,this.localFontFamily=u,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r){this.url=r}getGlyphs(r,s){const u=[],h=this.url||Di.GLYPHS_URL;for(const g in r)for(const y of r[g])u.push({stack:g,id:y});Pe(u,({stack:g,id:y},b)=>{let T=this.entries[g];T||(T=this.entries[g]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=T.glyphs[y];if(E!==void 0)return void b(null,{stack:g,id:y,glyph:E});if(E=this._tinySDF(T,g,y),E)return T.glyphs[y]=E,void b(null,{stack:g,id:y,glyph:E});const k=Math.floor(y/256);if(256*k>65535)return Cr("glyphs > 65535 not supported"),void b(null,{stack:g,id:y,glyph:E});if(T.ranges[k])return void b(null,{stack:g,id:y,glyph:E});let P=T.requests[k];P||(P=T.requests[k]=[],c_.loadGlyphRange(g,k,h,this.requestManager,(R,L)=>{if(L){T.ascender=L.ascender,T.descender=L.descender;for(const z in L.glyphs)this._doesCharSupportLocalGlyph(+z)||(T.glyphs[+z]=L.glyphs[+z]);T.ranges[k]=!0}for(const z of P)z(R,L);delete T.requests[k]})),P.push((R,L)=>{R?b(R):L&&b(null,{stack:g,id:y,glyph:L.glyphs[y]||null})})},(g,y)=>{if(g)s(g);else if(y){const b={};for(const{stack:T,id:E,glyph:k}of y)b[T]===void 0&&(b[T]={}),b[T].glyphs===void 0&&(b[T].glyphs={}),b[T].glyphs[E]=k&&{id:k.id,bitmap:k.bitmap.clone(),metrics:k.metrics},b[T].ascender=this.entries[T].ascender,b[T].descender=this.entries[T].descender;s(null,b)}})}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==_C.none&&(this.localGlyphMode===_C.all?!!this.localFontFamily:!!this.localFontFamily&&(Ir["CJK Unified Ideographs"](r)||Ir["Hangul Syllables"](r)||Ir.Hiragana(r)||Ir.Katakana(r)||Ir["CJK Symbols and Punctuation"](r)||Ir["CJK Unified Ideographs Extension A"](r)||Ir["CJK Unified Ideographs Extension B"](r)||Ir.Osage(r)))}_tinySDF(r,s,u){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(u))return;let g=r.tinySDF;if(!g){let W="400";/bold/i.test(s)?W="900":/medium/i.test(s)?W="500":/light/i.test(s)&&(W="200"),g=r.tinySDF=new c_.TinySDF({fontFamily:h,fontWeight:W,fontSize:24*$c,buffer:3*$c,radius:8*$c}),g.fontWeight=W}if(this.localGlyphs[g.fontWeight][u])return this.localGlyphs[g.fontWeight][u];const y=String.fromCodePoint(u),{data:b,width:T,height:E,glyphWidth:k,glyphHeight:P,glyphLeft:R,glyphTop:L,glyphAdvance:z}=g.draw(y);return this.localGlyphs[g.fontWeight][u]={id:u,bitmap:new Uh({width:T,height:E},b),metrics:{width:k/$c,height:P/$c,left:R/$c,top:L/$c-27,advance:z/$c,localGlyph:!0}}}}c_.loadGlyphRange=function(a,r,s,u,h){const g=256*r,y=g+255,b=u.transformRequest(u.normalizeGlyphsURL(s).replace("{fontstack}",a).replace("{range}",`${g}-${y}`),ad.Glyphs);ih(b,(T,E)=>{if(T)h(T);else if(E){const k={},P=function(R){return new u1(R).readFields(TG,{})}(E);for(const R of P.glyphs)k[R.id]=R;h(null,{glyphs:k,ascender:P.ascender,descender:P.descender})}})},c_.TinySDF=class{constructor({fontSize:a=24,buffer:r=3,radius:s=8,cutoff:u=.25,fontFamily:h="sans-serif",fontWeight:g="normal",fontStyle:y="normal",lang:b=null}={}){this.buffer=r,this.cutoff=u,this.radius=s,this.lang=b;const T=this.size=a+4*r,E=this._createCanvas(T),k=this.ctx=E.getContext("2d",{willReadFrequently:!0});k.font=`${y} ${g} ${a}px ${h}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(a){const r=document.createElement("canvas");return r.width=r.height=a,r}draw(a){const{width:r,actualBoundingBoxAscent:s,actualBoundingBoxDescent:u,actualBoundingBoxLeft:h,actualBoundingBoxRight:g}=this.ctx.measureText(a),y=Math.ceil(s),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-h))),T=Math.min(this.size-this.buffer,y+Math.ceil(u)),E=b+2*this.buffer,k=T+2*this.buffer,P=Math.max(E*k,0),R=new Uint8ClampedArray(P),L={data:R,width:E,height:k,glyphWidth:b,glyphHeight:T,glyphTop:y,glyphLeft:0,glyphAdvance:r};if(b===0||T===0)return L;const{ctx:z,buffer:W,gridInner:J,gridOuter:te}=this;this.lang&&(z.lang=this.lang),z.clearRect(W,W,b,T),z.fillText(a,W,W+y);const ae=z.getImageData(W,W,b,T);te.fill(Fx,0,P),J.fill(0,0,P);for(let ue=0;ue<T;ue++)for(let he=0;he<b;he++){const Ce=ae.data[4*(ue*b+he)+3]/255;if(Ce===0)continue;const be=(ue+W)*E+he+W;if(Ce===1)te[be]=0,J[be]=Fx;else{const ke=.5-Ce;te[be]=ke>0?ke*ke:0,J[be]=ke<0?ke*ke:0}}jN(te,0,0,E,k,E,this.f,this.v,this.z),jN(J,W,W,b,T,E,this.f,this.v,this.z);for(let ue=0;ue<P;ue++){const he=Math.sqrt(te[ue])-Math.sqrt(J[ue]);R[ue]=Math.round(255-255*(he/this.radius+this.cutoff))}return L}};const Nu=Yp;function kN(a,r){return a+r[1]-r[0]}function yC(a,r,s,u,h=1){const g=[],y=a.imagePrimary,b=y.pixelRatio,T=y.paddedRect.w-2*Nu,E=y.paddedRect.h-2*Nu,k=(a.right-a.left)*h,P=(a.bottom-a.top)*h,R=y.stretchX||[[0,T]],L=y.stretchY||[[0,E]],z=R.reduce(kN,0),W=L.reduce(kN,0),J=T-z,te=E-W;let ae=0,ue=z,he=0,Ce=W,be=0,ke=J,Me=0,ze=te;if(y.content&&u){const We=y.content;ae=f1(R,0,We[0]),he=f1(L,0,We[1]),ue=f1(R,We[0],We[2]),Ce=f1(L,We[1],We[3]),be=We[0]-ae,Me=We[1]-he,ke=We[2]-We[0]-ue,ze=We[3]-We[1]-Ce}const ct=(We,ut,gt,St)=>{const Lt=p1(We.stretch-ae,ue,k,a.left*h),kt=m1(We.fixed-be,ke,We.stretch,z),_t=p1(ut.stretch-he,Ce,P,a.top*h),It=m1(ut.fixed-Me,ze,ut.stretch,W),ot=p1(gt.stretch-ae,ue,k,a.left*h),rt=m1(gt.fixed-be,ke,gt.stretch,z),At=p1(St.stretch-he,Ce,P,a.top*h),Nt=m1(St.fixed-Me,ze,St.stretch,W),xt=new wt(Lt,_t),sr=new wt(ot,_t),cr=new wt(ot,At),tr=new wt(Lt,At),Zt=new wt(kt/b,It/b),Xr=new wt(rt/b,Nt/b),Jt=r*Math.PI/180;if(Jt){const Hn=Math.sin(Jt),Wn=Math.cos(Jt),Hi=[Wn,-Hn,Hn,Wn];xt._matMult(Hi),sr._matMult(Hi),tr._matMult(Hi),cr._matMult(Hi)}const Tr=We.stretch+We.fixed,Jr=gt.stretch+gt.fixed,pn=ut.stretch+ut.fixed,zn=St.stretch+St.fixed,rn=a.imageSecondary;return{tl:xt,tr:sr,bl:tr,br:cr,texPrimary:{x:y.paddedRect.x+Nu+Tr,y:y.paddedRect.y+Nu+pn,w:Jr-Tr,h:zn-pn},texSecondary:rn?{x:rn.paddedRect.x+Nu+Tr,y:rn.paddedRect.y+Nu+pn,w:Jr-Tr,h:zn-pn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Zt,pixelOffsetBR:Xr,minFontScaleX:ke/b/k,minFontScaleY:ze/b/P,isSDF:s}};if(u&&(y.stretchX||y.stretchY)){const We=PN(R,J,z),ut=PN(L,te,W);for(let gt=0;gt<We.length-1;gt++){const St=We[gt],Lt=We[gt+1];for(let kt=0;kt<ut.length-1;kt++)g.push(ct(St,ut[kt],Lt,ut[kt+1]))}}else g.push(ct({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:E+1}));return g}function PG(a,r){const s=a.stretchY||[[0,a.paddedRect.h-2*Nu]];return r&&(a.stretchX||a.stretchY)?RN(a.stretchX||[[0,a.paddedRect.w-2*Nu]])*RN(s):1}function f1(a,r,s){let u=0;for(const h of a)u+=Math.max(r,Math.min(s,h[1]))-Math.max(r,Math.min(s,h[0]));return u}function PN(a,r,s){const u=[{fixed:-Nu,stretch:0}];for(const[h,g]of a){const y=u[u.length-1];u.push({fixed:h-y.stretch,stretch:y.stretch}),u.push({fixed:h-y.stretch,stretch:y.stretch+(g-h)})}return u.push({fixed:r+Nu,stretch:s}),u}function RN(a){return 2*a.length+1}function p1(a,r,s,u){return a/r*s+u}function m1(a,r,s,u){return a-r*s/u}function RG(a,r,s,u){const h=r+a.positionedLines[u].lineOffset;return u===0?s+h/2:s+(h+(r+a.positionedLines[u-1].lineOffset))/2}function MG(a,r=1,s=!1){let u=1/0,h=1/0,g=-1/0,y=-1/0;const b=a[0];for(let L=0;L<b.length;L++){const z=b[L];(!L||z.x<u)&&(u=z.x),(!L||z.y<h)&&(h=z.y),(!L||z.x>g)&&(g=z.x),(!L||z.y>y)&&(y=z.y)}const T=Math.min(g-u,y-h);let E=T/2;const k=new sg([],NG);if(T===0)return new wt(u,h);for(let L=u;L<g;L+=T)for(let z=h;z<y;z+=T)k.push(new u_(L+E,z+E,E,a));let P=function(L){let z=0,W=0,J=0;const te=L[0];for(let ae=0,ue=te.length,he=ue-1;ae<ue;he=ae++){const Ce=te[ae],be=te[he],ke=Ce.x*be.y-be.x*Ce.y;W+=(Ce.x+be.x)*ke,J+=(Ce.y+be.y)*ke,z+=3*ke}return new u_(W/z,J/z,0,L)}(a),R=k.length;for(;k.length;){const L=k.pop();(L.d>P.d||!P.d)&&(P=L,s&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,R)),L.max-P.d<=r||(E=L.h/2,k.push(new u_(L.p.x-E,L.p.y-E,E,a)),k.push(new u_(L.p.x+E,L.p.y-E,E,a)),k.push(new u_(L.p.x-E,L.p.y+E,E,a)),k.push(new u_(L.p.x+E,L.p.y+E,E,a)),R+=4)}return s&&(console.log(`num probes: ${R}`),console.log(`best distance: ${P.d}`)),P.p}function NG(a,r){return r.max-a.max}class u_{constructor(r,s,u,h){this.p=new wt(r,s),this.h=u,this.d=function(g,y){let b=!1,T=1/0;for(let E=0;E<y.length;E++){const k=y[E];for(let P=0,R=k.length,L=R-1;P<R;L=P++){const z=k[P],W=k[L];z.y>g.y!=W.y>g.y&&g.x<(W.x-z.x)*(g.y-z.y)/(W.y-z.y)+z.x&&(b=!b),T=Math.min(T,Oa(g,z,W))}}return(b?1:-1)*Math.sqrt(T)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const DG=Object.keys,vC=Number.POSITIVE_INFINITY,OG=Math.sqrt(2);function g1(a,r,s,u){const h=a.collisionPadding||[0,0,0,0],g={top:a.top-h[1],bottom:a.bottom+h[3],left:a.left-h[0],right:a.right+h[2],scaled:!1};return u!==void 0&&function(y,b){y.top*=b,y.bottom*=b,y.left*=b,y.right*=b,y.scaled=!0}(g,u),s&&function(y,b){if(!b)return;const T=gn(b),E=new wt(y.left,y.top),k=new wt(y.right,y.top),P=new wt(y.left,y.bottom),R=new wt(y.right,y.bottom);E._rotateAround(T,new wt(0,0)),k._rotateAround(T,new wt(0,0)),P._rotateAround(T,new wt(0,0)),R._rotateAround(T,new wt(0,0)),y.left=Math.min(E.x,k.x,P.x,R.x),y.right=Math.max(E.x,k.x,P.x,R.x),y.top=Math.min(E.y,k.y,P.y,R.y),y.bottom=Math.max(E.y,k.y,P.y,R.y)}(g,s),r?{top:Math.min(r.top,g.top),bottom:Math.max(r.bottom,g.bottom),left:Math.min(r.left,g.left),right:Math.max(r.right,g.right),scaled:r.scaled||g.scaled}:g}function MN(a,[r,s]){let u=0,h=0;if(s===vC){r<0&&(r=0);const g=r/OG;switch(a){case"top-right":case"top-left":h=g-7;break;case"bottom-right":case"bottom-left":h=7-g;break;case"bottom":h=7-r;break;case"top":h=r-7}switch(a){case"top-right":case"bottom-right":u=-g;break;case"top-left":case"bottom-left":u=g;break;case"left":u=r;break;case"right":u=-r}}else{switch(r=Math.abs(r),s=Math.abs(s),a){case"top-right":case"top-left":case"top":h=s-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-s}switch(a){case"top-right":case"bottom-right":case"right":u=-r;break;case"top-left":case"bottom-left":case"left":u=r}}return[u,h]}function LG(a,r,s,u,h,g,y,b,T,E,k){const P=a.layers[0],R=P.appearances;if(R.length===0)return{iconBBox:null,iconVerticalBBox:null};let L=null,z=null;const W=u.get("icon-rotate").evaluate(h,{},g);r&&(L=g1(r,L,W,y),s)&&(z=g1(s,z,W+90,y));const[J,te]=u.get("icon-size-scale-range"),ae=se(1,J,te);for(const ue of R){const he=ue.getUnevaluatedProperties(),Ce=he._values["icon-image"].value!==void 0,be=he._values["icon-size"].value!==void 0,ke=he._values["icon-offset"].value!==void 0,Me=he._values["icon-rotate"].value!==void 0;if(Ce||be||ke||Me){const ze=ke?P.getAppearanceValueAndResolveTokens(ue,"icon-offset",h,g,[]):null,ct=ze&&Array.isArray(ze)?ze:b,We=Me?P.getAppearanceValueAndResolveTokens(ue,"icon-rotate",h,g,[]):null,ut=typeof We=="number"?We:W,gt=be?P.getAppearanceValueAndResolveTokens(ue,"icon-size",h,g,[]):null,St=typeof gt=="number"?gt*T.iconScaleFactor:y;let Lt=null,kt=null,_t=null;if(Ce){const It=P.getAppearanceValueAndResolveTokens(ue,"icon-image",h,g,[]);if(It){const ot=a.getResolvedImageFromTokens(It),rt=he._values["icon-size"],At=Bx(ot,a_(a.zoom,rt,a.worldview),rt,g,a.zoom,h,a.pixelRatio,ae,a.worldview);_t=E.get(At.iconPrimary.toString())}}else r&&(_t=r.imagePrimary);_t&&(Lt=h1(_t,null,ct,k),a.allowVerticalPlacement&&(kt=h1(_t,null,ct,k))),Lt&&(L=g1(Lt,L,ut,St)),kt&&(z=g1(kt,z,ut+90,St))}}return{iconBBox:L,iconVerticalBBox:z}}function _1(a,r,s,u,h,g,y,b,T){if(!r||!r.usvg)return;const E=xN(u),k=xN(h),P=g!=="both"&&g!=="width"||!yN(u)?1:k.width/E.width,R=g!=="both"&&g!=="height"||!vN(u)?1:k.height/E.height;s.scaleSelf(P,R);const L=s.toString();y.set(L,s),b.set(L,r);const{imagePosition:z}=gC(L,r,Yp);T.set(L,z)}function NN(a,r,s,u,h,g,y,b,T){if(!a)return;const E=function(k,P,R,L,z,W){if(k.kind==="camera")return k.maxSize;if(k.kind==="composite"){const J=P.possiblyEvaluate(new Ai(k.maxZoom,{worldview:W}),R).evaluate(z,{},R),te=P.possiblyEvaluate(new Ai(k.minZoom,{worldview:W}),R).evaluate(z,{},R);return Math.max(J,te)}return P.possiblyEvaluate(new Ai(L,{worldview:W})).evaluate(z,{},R)}(r,s,u,h,g,T);return a.scaleSelf(E*b*y)}function Bx(a,r,s,u,h,g,y,b,T){return{iconPrimary:NN(a.getPrimary(),r,s,u,h,g,y,b,T),iconSecondary:NN(a.getSecondary(),r,s,u,h,g,y,b,T)}}function zG(a,r,s){if(!r)return;const u=s.get(a.toString()),h=s.get(r.toString());u&&h&&(u.paddedRect.w===h.paddedRect.w&&u.paddedRect.h===h.paddedRect.h||Cr(`Mismatch in icon variant sizes: ${a.toString()} and ${r.toString()}`),u.usvg!==h.usvg&&Cr(`Mismatch in icon variant image types: ${a.id} and ${r.id}`))}function DN(a,r,s,u){if(!a)return;const h=r.get(s.toString());if(a.imagePrimary=h,u){const g=r.get(u.toString());a.imageSecondary=g}}function FG(a,r){for(const s in a.horizontal)ON(a.horizontal[s],r);ON(a.vertical,r)}function ON(a,r){if(a){for(const s of a.positionedLines)for(const u of s.positionedGlyphs)if(u.image!==null){const h=u.image.toString();u.rect=r.get(h).paddedRect}}}function xC(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function BG(a,r,s,u,h,g,y,b,T){const E=bC(g.horizontal)||g.vertical,k=s.get("icon-text-fit-padding").evaluate(u,{},h);let P,R=r;return r&&T!=="none"&&(a.allowVerticalPlacement&&g.vertical&&(P=pC(r,g.vertical,T,k,b,y)),E&&(R=pC(r,E,T,k,b,y))),{defaultShapedIcon:R,verticallyShapedIcon:P}}function VG(a,r,s,u,h,g,y,b,T,E,k,P,R,L,z,W,J,te,ae,ue,he,Ce){let be=y.textMaxSize.evaluate(r,{},R);be===void 0?be=b*y.textScaleFactor:be*=y.textScaleFactor;const ke=a.layers[0].layout,Me=go,ze=b*y.textScaleFactor/Me,ct=bC(s.horizontal)||s.vertical;if(J!=="none"&&a.appearanceFeatureData&&r.index<a.appearanceFeatureData.length){const xt=a.appearanceFeatureData[r.index];xt&&(xt.textShaping=ct,xt.iconTextFitPadding=ke.get("icon-text-fit-padding").evaluate(r,{},R),xt.fontScale=ze)}const We=L.name==="globe",ut=a.tilePixelRatio*be/Me,gt=(ot=a.overscaling,a.zoom>18&&ot>2&&(ot>>=1),Math.max(Vt/(512*ot),1)*ke.get("symbol-spacing")),St=ke.get("text-padding")*a.tilePixelRatio,Lt=ke.get("icon-padding")*a.tilePixelRatio,kt=gn(ke.get("text-max-angle")),_t=ke.get("icon-rotation-alignment")==="map"&&ue!=="point",It=gt/2;var ot;a.hasAnyIconTextFit===!1&&J!=="none"&&(a.hasAnyIconTextFit=!0);const rt=r.properties?+r.properties[er]:null,At=rt&&a.elevationFeatureIdToIndex?a.elevationFeatureIdToIndex.get(rt):65535,Nt=(xt,sr,cr)=>{if(sr.x<0||sr.x>=Vt||sr.y<0||sr.y>=Vt)return;let tr=null;if(We){const{x:Zt,y:Xr,z:Jt}=L.projectTilePoint(sr.x,sr.y,cr);tr={anchor:new Ad(Zt,Xr,Jt,0,void 0),up:L.upVector(cr,sr.x,sr.y)}}(function(Zt,Xr,Jt,Tr,Jr,pn,zn,rn,Hn,Wn,Hi,we,_e,ht,Ht,ft,Xt,mr,fr,nn,Mr,dr,qn,gi,Dr,Dn,_i,ni,rs,Li,Ti){const ui=Zt.addToLineVertexArray(Xr,Tr);let Zn,sn,Xn,Ei,Nr,Fn,zi,ls=0,ys=0,zs=0,Fi=0,Ps=-1,ya=-1;const Rs={};let Ua=hp("");const Ro=Jt?Jt.anchor:Xr,Dl=ni!=="none";let va=0,$a=0;if(Hn._unevaluatedLayout.getValue("text-radial-offset")===void 0){const _o=Hn.layout.get("text-offset").evaluate(Mr,{},Dr);va=_o[0]*go,$a=_o[1]*go}else va=Hn.layout.get("text-radial-offset").evaluate(Mr,{},Dr)*go,$a=vC;if(Zt.allowVerticalPlacement&&Jr.vertical){const _o=Jr.vertical;if(Ht)Fn=wC(_o),rn&&(zi=wC(rn));else{const Qo=Hn.layout.get("text-rotate").evaluate(Mr,{},Dr)+90;Xn=y1(Wn,Ro,Xr,Hi,we,_e,_o,ht,Qo,ft),rn&&(Ei=y1(Wn,Ro,Xr,Hi,we,_e,rn,mr,Qo,null,Ti))}}if(pn){const _o=Zt.iconSizeData,Qo=Hn.layout.get("icon-rotate").evaluate(Mr,{},Dr),Du=yC(pn,Qo,qn,Dl,dr.iconScaleFactor),Wh=rn?yC(rn,Qo,qn,Dl,dr.iconScaleFactor):void 0;sn=y1(Wn,Ro,Xr,Hi,we,_e,pn,mr,Qo,null,Li);const __=function(Ou,D1,y_,eW,tO,rO,tW,rW){const nO=Ou.layers[0],iO=nO.appearances;let v_=D1.length;if(y_&&(v_=Math.max(v_,y_.length)),iO.length===0)return v_;const[nW,iW]=eW.get("icon-size-scale-range"),sW=se(1,nW,iW);for(const sO of iO){const oO=sO.getUnevaluatedProperties();if(oO._values["icon-image"].value!==void 0){const aO=nO.getAppearanceValueAndResolveTokens(sO,"icon-image",tO,rO,[]);if(aO){const lO=Ou.getResolvedImageFromTokens(aO);if(lO){const cO=oO._values["icon-size"],oW=Bx(lO,a_(Ou.zoom,cO,Ou.worldview),cO,rO,Ou.zoom,tO,Ou.pixelRatio,sW,Ou.worldview),aW=tW.get(oW.iconPrimary.toString());v_=Math.max(v_,PG(aW,rW))}}}}return v_}(Zt,Du,Wh,Hn.layout,Mr,Dr,Zt.iconAtlasPositions,Dl);ls=4*__;let Zh=null;_o.kind==="source"?(Zh=[Uc*Hn.layout.get("icon-size").evaluate(Mr,{},Dr)*dr.iconScaleFactor],Zh[0]>jd&&Cr(`${Zt.layerIds[0]}: Value for "icon-size" is >= ${Vx}. Reduce your "icon-size".`)):_o.kind==="composite"&&(Zh=[Uc*dr.compositeIconSizes[0].evaluate(Mr,{},Dr)*dr.iconScaleFactor,Uc*dr.compositeIconSizes[1].evaluate(Mr,{},Dr)*dr.iconScaleFactor],(Zh[0]>jd||Zh[1]>jd)&&Cr(`${Zt.layerIds[0]}: Value for "icon-size" is >= ${Vx}. Reduce your "icon-size".`)),Zt.addSymbols(Zt.icon,Du,Zh,nn,fr,Mr,void 0,Jt,Xr,ui.lineStartIndex,ui.lineLength,-1,gi,Dr,Dn,_i,Zt.symbolInstances.length,__),Ps=Zt.icon.placedSymbolArray.length-1,Wh&&(ys=4*__,Zt.addSymbols(Zt.icon,Wh,Zh,nn,fr,Mr,Va.vertical,Jt,Xr,ui.lineStartIndex,ui.lineLength,-1,gi,Dr,Dn,_i,Zt.symbolInstances.length,__),ya=Zt.icon.placedSymbolArray.length-1)}for(const _o in Jr.horizontal){const Qo=_o,Du=Jr.horizontal[Qo];Zn||(Ua=hp(Du.text),Ht?Nr=wC(Du):Zn=y1(Wn,Ro,Xr,Hi,we,_e,Du,ht,Hn.layout.get("text-rotate").evaluate(Mr,{},Dr),ft));const Wh=Du.positionedLines.length===1;if(zs+=LN(Zt,Jt,Xr,Du,zn,Hn,Ht,Mr,ft,ui,Jr.vertical?Va.horizontal:Va.horizontalOnly,Wh?DG(Jr.horizontal):[Qo],Rs,Ps,dr,gi,Dr,Zt.symbolInstances.length,Dn),Wh)break}Jr.vertical&&(Fi+=LN(Zt,Jt,Xr,Jr.vertical,zn,Hn,Ht,Mr,ft,ui,Va.vertical,["vertical"],Rs,ya,dr,gi,Dr,Zt.symbolInstances.length,Dn));let Mo=-1;const qa=(_o,Qo)=>_o?Math.max(_o,Qo):Qo;Mo=qa(Nr,Mo),Mo=qa(Fn,Mo),Mo=qa(zi,Mo);const Ol=Mo>-1?1:0;Zt.glyphOffsetArray.length>=65535&&Cr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Mr.sortKey!==void 0&&Zt.addToSortKeyRanges(Zt.symbolInstances.length,Mr.sortKey),Zt.symbolInstances.emplaceBack(Xr.x,Xr.y,Ro.x,Ro.y,Ro.z,Rs.right>=0?Rs.right:-1,Rs.center>=0?Rs.center:-1,Rs.left>=0?Rs.left:-1,Rs.vertical>=0?Rs.vertical:-1,Ps,ya,Ua,Zn!==void 0?Zn:Zt.collisionBoxArray.length,Zn!==void 0?Zn+1:Zt.collisionBoxArray.length,Xn!==void 0?Xn:Zt.collisionBoxArray.length,Xn!==void 0?Xn+1:Zt.collisionBoxArray.length,sn!==void 0?sn:Zt.collisionBoxArray.length,sn!==void 0?sn+1:Zt.collisionBoxArray.length,Ei||Zt.collisionBoxArray.length,Ei?Ei+1:Zt.collisionBoxArray.length,Hi,zs,Fi,ls,ys,Ol,0,va,$a,Mo,0,Dl?1:0,rs)})(a,sr,tr,xt,s,u,g,h,a.layers[0],a.collisionBoxArray,r.index,r.sourceLayerIndex,a.index,St,ae,E,0,Lt,_t,te,r,y,k,P,R,z,W,J,At,he,Ce)};if(ue==="line")for(const xt of Qw(r.geometry,0,0,Vt,Vt)){const sr=kG(xt,gt,kt,s.vertical||ct,u,Me,ut,a.overscaling,Vt);for(const cr of sr)ct&&UG(a,ct.text,It,cr)||Nt(xt,cr,R)}else if(ue==="line-center"){for(const xt of r.geometry)if(xt.length>1){const sr=IG(xt,kt,s.vertical||ct,u,Me,ut);sr&&Nt(xt,sr,R)}}else if(r.type==="Polygon")for(const xt of Sx(r.geometry,0)){const sr=MG(xt,16);Nt(xt[0],new Ad(sr.x,sr.y,0,0,void 0),R)}else if(r.type==="LineString")for(const xt of r.geometry)Nt(xt,new Ad(xt[0].x,xt[0].y,0,0,void 0),R);else if(r.type==="Point")for(const xt of r.geometry)for(const sr of xt)Nt([sr],new Ad(sr.x,sr.y,0,0,void 0),R)}const Vx=255,jd=Vx*Uc;function LN(a,r,s,u,h,g,y,b,T,E,k,P,R,L,z,W,J,te,ae){const ue=function(be,ke,Me,ze,ct,We,ut,gt){const St=[];if(ke.positionedLines.length===0)return St;const Lt=ze.layout.get("text-rotate").evaluate(We,{})*Math.PI/180,kt=function(At){const Nt=At[0],xt=At[1],sr=Nt*xt;return sr>0?[Nt,-xt]:sr<0?[-Nt,xt]:Nt===0?[xt,Nt]:[xt,-Nt]}(Me);let _t=Math.abs(ke.top-ke.bottom);for(const At of ke.positionedLines)_t-=At.lineOffset;const It=ke.positionedLines.length,ot=_t/It;let rt=ke.top-Me[1];for(let At=0;At<It;++At){const Nt=ke.positionedLines[At];rt=RG(ke,ot,rt,At);for(const xt of Nt.positionedGlyphs){if(!xt.rect)continue;const sr=xt.rect||{};let cr=dN+1,tr=!0,Zt=1,Xr=0;if(xt.image){const fr=ut.get(xt.image.toString());if(!fr)continue;if(fr.sdf){Cr("SDF images are not supported in formatted text and will be ignored.");continue}tr=!1,Zt=fr.pixelRatio,cr=Yp/Zt}const Jt=(ct||gt)&&xt.vertical,Tr=xt.metrics.advance*xt.scale/2,Jr=xt.metrics,pn=xt.rect;if(pn===null)continue;gt&&ke.verticalizable&&(Xr=xt.image?Tr-xt.metrics.width*xt.scale/2:0);const zn=ct?[xt.x+Tr,xt.y]:[0,0];let rn=[0,0],Hn=[0,0],Wn=!1;ct||(Jt?(Hn=[xt.x+Tr+kt[0],xt.y+kt[1]-Xr],Wn=!0):rn=[xt.x+Tr+Me[0],xt.y+Me[1]-Xr]);const Hi=pn.w*xt.scale/(Zt*(xt.localGlyph?$c:1)),we=pn.h*xt.scale/(Zt*(xt.localGlyph?$c:1));let _e,ht,Ht,ft;if(Jt){const fr=xt.y-rt,nn=new wt(-Tr,Tr-fr),Mr=-Math.PI/2,dr=new wt(...Hn);_e=new wt(-Tr+rn[0],rn[1]),_e._rotateAround(Mr,nn)._add(dr),_e.x+=-fr+Tr,_e.y-=(Jr.left-cr)*xt.scale;const qn=xt.image?Jr.advance*xt.scale:go*xt.scale,gi=String.fromCodePoint(xt.glyph);fG(gi)?_e.x+=(1-cr)*xt.scale:pG(gi)?_e.x+=qn-Jr.height*xt.scale+(-cr-1)*xt.scale:_e.x+=xt.image||Jr.width+2*cr===pn.w&&Jr.height+2*cr===pn.h?(qn-we)/2:(qn-(Jr.height+2*cr)*xt.scale)/2,ht=new wt(_e.x,_e.y-Hi),Ht=new wt(_e.x+we,_e.y),ft=new wt(_e.x+we,_e.y-Hi)}else{const fr=(Jr.left-cr)*xt.scale-Tr+rn[0],nn=(-Jr.top-cr)*xt.scale+rn[1],Mr=fr+Hi,dr=nn+we;_e=new wt(fr,nn),ht=new wt(Mr,nn),Ht=new wt(fr,dr),ft=new wt(Mr,dr)}if(Lt){let fr;fr=ct?new wt(0,0):Wn?new wt(kt[0],kt[1]):new wt(Me[0],Me[1]),_e._rotateAround(Lt,fr),ht._rotateAround(Lt,fr),Ht._rotateAround(Lt,fr),ft._rotateAround(Lt,fr)}const Xt=new wt(0,0),mr=new wt(0,0);St.push({tl:_e,tr:ht,bl:Ht,br:ft,texPrimary:sr,texSecondary:void 0,writingMode:ke.writingMode,glyphOffset:zn,sectionIndex:xt.sectionIndex,isSDF:tr,pixelOffsetTL:Xt,pixelOffsetBR:mr,minFontScaleX:0,minFontScaleY:0})}}return St}(0,u,T,g,y,b,h,a.allowVerticalPlacement),he=a.textSizeData;let Ce=null;he.kind==="source"?(Ce=[Uc*g.layout.get("text-size").evaluate(b,{},J)*z.textScaleFactor],Ce[0]>jd&&Cr(`${a.layerIds[0]}: Value for "text-size" is >= ${Vx}. Reduce your "text-size".`)):he.kind==="composite"&&(Ce=[Uc*z.compositeTextSizes[0].evaluate(b,{},J)*z.textScaleFactor,Uc*z.compositeTextSizes[1].evaluate(b,{},J)*z.textScaleFactor],(Ce[0]>jd||Ce[1]>jd)&&Cr(`${a.layerIds[0]}: Value for "text-size" is >= ${Vx}. Reduce your "text-size".`)),a.addSymbols(a.text,ue,Ce,T,y,b,k,r,s,E.lineStartIndex,E.lineLength,L,W,J,ae,!1,te,ue.length);for(const be of P)R[be]=a.text.placedSymbolArray.length-1;return 4*ue.length}function bC(a){for(const r in a)return a[r];return null}function y1(a,r,s,u,h,g,y,b,T,E,k){let P,R,L,z;if(P=k?k.top:y.top,R=k?k.bottom:y.bottom,L=k?k.left:y.left,z=k?k.right:y.right,_N(y)&&y.collisionPadding){const W=y.collisionPadding;L-=W[0],P-=W[1],z+=W[2],R+=W[3]}if(T){const W=new wt(L,P),J=new wt(z,P),te=new wt(L,R),ae=new wt(z,R),ue=gn(T);let he=new wt(0,0);E&&(he=new wt(E[0],E[1])),W._rotateAround(ue,he),J._rotateAround(ue,he),te._rotateAround(ue,he),ae._rotateAround(ue,he),L=Math.min(W.x,J.x,te.x,ae.x),z=Math.max(W.x,J.x,te.x,ae.x),P=Math.min(W.y,J.y,te.y,ae.y),R=Math.max(W.y,J.y,te.y,ae.y)}return a.emplaceBack(r.x,r.y,r.z,s.x,s.y,L,P,z,R,b,u,h,g),a.length-1}function wC(a){_N(a)&&a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const r=a.bottom-a.top;return r>0?Math.max(10,r):null}function UG(a,r,s,u){const h=a.compareText;if(r in h){const g=h[r];for(let y=g.length-1;y>=0;y--)if(u.dist(g[y])<s)return!0}else h[r]=[];return h[r].push(u),!1}function zN(a,r){const s=a.fovAboveCenter,u=a.elevation?a.elevation.getMinElevationBelowMSL()*r:0,h=(a._camera.position[2]*a.worldSize-u)/Math.cos(a._pitch),g=Math.sin(s)*h/Math.sin(Math.max(Math.PI/2-a._pitch-s,.01));let y=Math.sin(a._pitch)*g+h;const b=h*(1/a._horizonShift);if(!a.elevation||a.elevation.exaggeration()===0){let T=Math.max(a.zoom-17,0);a.isOrthographic&&(T/=10),y*=1+T}return Math.min(1.01*y,b)}function Ux(a,r){if(!r.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:r};const s=Math.pow(2,-a.z),u=a.x*s,h=(a.x+1)*s,g=a.y*s,y=(a.y+1)*s,b=me(u),T=me(h),E=de(g),k=de(y),P=r.project(b,E),R=r.project(T,E),L=r.project(T,k),z=r.project(b,k);let W=Math.min(P.x,R.x,L.x,z.x),J=Math.min(P.y,R.y,L.y,z.y),te=Math.max(P.x,R.x,L.x,z.x),ae=Math.max(P.y,R.y,L.y,z.y);const ue=s/16;function he(be,ke,Me,ze,ct,We){const ut=(Me+ct)/2,gt=(ze+We)/2,St=r.project(me(ut),de(gt)),Lt=Math.max(0,W-St.x,J-St.y,St.x-te,St.y-ae);W=Math.min(W,St.x),te=Math.max(te,St.x),J=Math.min(J,St.y),ae=Math.max(ae,St.y),Lt>ue&&(he(be,St,Me,ze,ut,gt),he(St,ke,ut,gt,ct,We))}he(P,R,u,g,h,g),he(R,L,h,g,h,y),he(L,z,h,y,u,y),he(z,P,u,y,u,g),W-=ue,J-=ue,te+=ue,ae+=ue;const Ce=1/Math.max(te-W,ae-J);return{scale:Ce,x:W*Ce,y:J*Ce,x2:te*Ce,y2:ae*Ce,projection:r}}function FN(a,{x:r,y:s},u=0){return new wt(((r-u)*a.scale-a.x)*Vt,(s*a.scale-a.y)*Vt)}const $G=Z(new Float32Array(16));class Gh{constructor(r){this.spec=r,this.name=r.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(r,s){return{x:0,y:0,z:0}}unproject(r,s){return new B(0,0)}projectTilePoint(r,s,u){return{x:r,y:s,z:0}}locationPoint(r,s,u,h=!0){return r._coordinatePoint(r.locationCoordinate(s,u),h)}pixelsPerMeter(r,s){return ce(1,r)*s}pixelSpaceConversion(r,s,u){return 1}farthestPixelDistance(r){return zN(r,r.pixelsPerMeter)}pointCoordinate(r,s,u,h){const g=r.horizonLineFromTop(!1),y=new wt(s,Math.max(g,u));return r.rayIntersectionCoordinate(r.pointRayIntersection(y,h))}pointCoordinate3D(r,s,u){const h=new wt(s,u);if(r.elevation)return r.elevation.pointCoordinate(h);{const g=this.pointCoordinate(r,h.x,h.y,0);return[g.x,g.y,g.z]}}isPointAboveHorizon(r,s){if(r.elevation&&r.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(r,s.x,s.y);const u=r.horizonLineFromTop();return s.y<u}createInversionMatrix(r,s){return $G}createTileMatrix(r,s,u){let h,g,y;const b=u.canonical,T=Z(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=Ux(b,this);h=1,g=E.x+u.wrap*E.scale,y=E.y,ne(T,T,[h/E.scale,h/E.scale,r.pixelsPerMeter/s])}else h=s/r.zoomScale(b.z),g=(b.x+Math.pow(2,b.z)*u.wrap)*h,y=b.y*h;return K(T,T,[g,y,0]),ne(T,T,[h/Vt,h/Vt,1]),T}upVector(r,s,u){return[0,0,1]}upVectorScale(r,s,u){return{metersToTile:1}}}class qG extends Gh{constructor(r){super(r),this.range=[4,7],this.center=r.center||[-96,37.5];const[s,u]=this.parallels=r.parallels||[29.5,45.5],h=Math.sin(gn(s));this.n=(h+Math.sin(gn(u)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(r,s){const{n:u,c:h,r0:g}=this,y=gn(r-this.center[0]),b=gn(s),T=Math.sqrt(h-2*u*Math.sin(b))/u;return{x:T*Math.sin(y*u),y:T*Math.cos(y*u)-g,z:0}}unproject(r,s){const{n:u,c:h,r0:g}=this,y=g+s;let b=Math.atan2(r,Math.abs(y))*Math.sign(y);y*u<0&&(b-=Math.PI*Math.sign(r)*Math.sign(y));const T=gn(this.center[0])*u;b=Re(b,-Math.PI-T,Math.PI-T);const E=se(Bo(b/u)+this.center[0],-180,180),k=Math.asin(se((h-(r*r+y*y)*u*u)/(2*u),-1,1)),P=se(Bo(k),-ge,ge);return new B(E,P)}}const $x=1.340264,qx=-.081106,Gx=893e-6,Hx=.003796,v1=Math.sqrt(3)/2;class GG extends Gh{project(r,s){s=s/180*Math.PI,r=r/180*Math.PI;const u=Math.asin(v1*Math.sin(s)),h=u*u,g=h*h*h;return{x:.5*(r*Math.cos(u)/(v1*($x+3*qx*h+g*(7*Gx+9*Hx*h)))/Math.PI+.5),y:1-.5*(u*($x+qx*h+g*(Gx+Hx*h))/Math.PI+1),z:0}}unproject(r,s){r=(2*r-.5)*Math.PI;let u=s=(2*(1-s)-1)*Math.PI,h=u*u,g=h*h*h;for(let k,P,R,L=0;L<12&&(P=u*($x+qx*h+g*(Gx+Hx*h))-s,R=$x+3*qx*h+g*(7*Gx+9*Hx*h),k=P/R,u=se(u-k,-Math.PI/3,Math.PI/3),h=u*u,g=h*h*h,!(Math.abs(k)<1e-12));++L);const y=v1*r*($x+3*qx*h+g*(7*Gx+9*Hx*h))/Math.cos(u),b=Math.asin(Math.sin(u)/v1),T=se(180*y/Math.PI,-180,180),E=se(180*b/Math.PI,-ge,ge);return new B(T,E)}}class HG extends Gh{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0}project(r,s){return{x:.5+r/360,y:.5-s/360,z:0}}unproject(r,s){const u=360*(r-.5),h=se(360*(.5-s),-ge,ge);return new B(u,h)}}const d_=Math.PI/2;function x1(a){return Math.tan((d_+a)/2)}class WG extends Gh{constructor(r){super(r),this.center=r.center||[0,30];const[s,u]=this.parallels=r.parallels||[30,30];let h=gn(s),g=gn(u);this.southernCenter=h+g<0,this.southernCenter&&(h=-h,g=-g);const y=Math.cos(h),b=x1(h);this.n=h===g?Math.sin(h):Math.log(y/Math.cos(g))/Math.log(x1(g)/b),this.f=y*Math.pow(x1(h),this.n)/this.n}project(r,s){s=gn(s),this.southernCenter&&(s=-s),r=gn(r-this.center[0]);const u=1e-6,{n:h,f:g}=this;g>0?s<-d_+u&&(s=-d_+u):s>d_-u&&(s=d_-u);const y=g/Math.pow(x1(s),h);let b=y*Math.sin(h*r),T=g-y*Math.cos(h*r);return b=.5*(b/Math.PI+.5),T=.5*(T/Math.PI+.5),{x:b,y:this.southernCenter?T:1-T,z:0}}unproject(r,s){r=(2*r-.5)*Math.PI,this.southernCenter&&(s=1-s),s=(2*(1-s)-.5)*Math.PI;const{n:u,f:h}=this,g=h-s,y=Math.sign(g),b=Math.sign(u)*Math.sqrt(r*r+g*g);let T=Math.atan2(r,Math.abs(g))*y;g*u<0&&(T-=Math.PI*Math.sign(r)*y);const E=se(Bo(T/u)+this.center[0],-180,180),k=se(Bo(2*Math.atan(Math.pow(h/b,1/u))-d_),-ge,ge);return new B(E,this.southernCenter?-k:k)}}class BN extends Gh{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(r,s){return{x:oe(r),y:ie(s),z:0}}unproject(r,s){const u=me(r),h=de(s);return new B(u,h)}}const VN=gn(ge);class ZG extends Gh{project(r,s){const u=(s=gn(s))*s,h=u*u;return{x:.5*((r=gn(r))*(.8707-.131979*u+h*(h*(.003971*u-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(s*(1.007226+u*(.015085+h*(.028874*u-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(r,s){r=(2*r-.5)*Math.PI;let u=s=(2*(1-s)-1)*Math.PI,h=25,g=0,y=u*u;do{y=u*u;const E=y*y;g=(u*(1.007226+y*(.015085+E*(.028874*y-.044475-.005916*E)))-s)/(1.007226+y*(.045255+E*(.259866*y-.311325-.005916*11*E))),u=se(u-g,-VN,VN)}while(Math.abs(g)>1e-6&&--h>0);y=u*u;const b=se(Bo(r/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),T=Bo(u);return new B(b,T)}}const UN=gn(ge);class XG extends Gh{project(r,s){s=gn(s),r=gn(r);const u=Math.cos(s),h=2/Math.PI,g=Math.acos(u*Math.cos(r/2)),y=Math.sin(g)/g,b=.5*(r*h+2*u*Math.sin(r/2)/y)||0,T=.5*(s+Math.sin(s)/y)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(r,s){let u=r=(2*r-.5)*Math.PI,h=s=(2*(1-s)-1)*Math.PI,g=25;const y=1e-6;let b=0,T=0;do{const E=Math.cos(h),k=Math.sin(h),P=2*k*E,R=k*k,L=E*E,z=Math.cos(u/2),W=Math.sin(u/2),J=2*z*W,te=W*W,ae=1-L*z*z,ue=ae?1/ae:0,he=ae?Math.acos(E*z)*Math.sqrt(1/ae):0,Ce=.5*(2*he*E*W+2*u/Math.PI)-r,be=.5*(he*k+h)-s,ke=.5*ue*(L*te+he*E*z*R)+1/Math.PI,Me=ue*(J*P/4-he*k*W),ze=.125*ue*(P*W-he*k*L*J),ct=.5*ue*(R*z+he*te*E)+.5,We=Me*ze-ct*ke;b=(be*Me-Ce*ct)/We,T=(Ce*ze-be*ke)/We,u=se(u-b,-Math.PI,Math.PI),h=se(h-T,-UN,UN)}while((Math.abs(b)>y||Math.abs(T)>y)&&--g>0);return new B(Bo(u),Bo(h))}}class $N extends Gh{constructor(r){super(r),this.center=r.center||[0,0],this.parallels=r.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(gn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(r,s){const{scale:u,cosPhi:h}=this;return{x:gn(r)*h*u+.5,y:-Math.sin(gn(s))/h*u+.5,z:0}}unproject(r,s){const{scale:u,cosPhi:h}=this,g=-(s-.5)/u,y=se(Bo((r-.5)/u)/h,-180,180),b=Math.asin(se(g*h,-1,1)),T=se(Bo(b),-ge,ge);return new B(y,T)}}class KG extends BN{constructor(r){super(r),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(r,s,u){const h=_x(r,s,u);return hn(h,h,qw(Ru(u))),{x:h[0],y:h[1],z:h[2]}}locationPoint(r,s,u){const h=j(s.lat,s.lng),g=xr([],h),y=u?r._centerAltitude+u:r.elevation?r.elevation.getAtPointOrZero(r.locationCoordinate(s),r._centerAltitude):r._centerAltitude;vt(h,h,g,ce(1,0)*Vt*y);const b=Z(new Float64Array(16));return H(b,r.pixelMatrix,r.globeMatrix),hn(h,h,b),new wt(h[0],h[1])}pixelsPerMeter(r,s){return ce(1,0)*s}pixelSpaceConversion(r,s,u){const h=ce(1,r)*s,g=Br(ce(1,45)*s,h,u);return this.pixelsPerMeter(r,s)/g}createTileMatrix(r,s,u){const h=jE(Ru(u.canonical));return H(new Float64Array(16),r.globeMatrix,h)}createInversionMatrix(r,s){const{center:u}=r,h=qw(Ru(s));return pe(h,h,gn(u.lng)),le(h,h,gn(u.lat)),ne(h,h,[r._pixelsPerMercatorPixel,r._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(r,s,u,h){return fR(r,s,u,!0)||new $e(0,0)}pointCoordinate3D(r,s,u){const h=this.pointCoordinate(r,s,u,0);return[h.x,h.y,h.z]}isPointAboveHorizon(r,s){return!fR(r,s.x,s.y,!1)}farthestPixelDistance(r){const s=function(h,g){const y=h.cameraToCenterDistance,b=h._centerAltitude*g,T=h._camera,E=h._camera.forward(),k=Ne([],Le([],E,-y),[0,0,b]),P=h.worldSize/(2*Math.PI),R=[0,0,-P],L=h.width/h.height,z=Math.tan(h.fovAboveCenter),W=Le([],T.up(),z),J=Le([],T.right(),z*L),te=xr([],Ne([],Ne([],E,W),J)),ae=[];let ue;if(new on(k,te).closestPointOnSphere(R,P,ae)){const he=Ne([],ae,R),Ce=bi([],he,k);ue=Math.cos(h.fovAboveCenter)*qt(Ce)}else{const he=bi([],k,R),Ce=bi([],R,k);xr(Ce,Ce);const be=qt(he)-P;ue=Math.sqrt(be*(be+2*P));const ke=Math.acos(ue/(P+be))-Math.acos(zr(E,Ce));ue*=Math.cos(ke)}return 1.01*ue}(r,this.pixelsPerMeter(r.center.lat,r.worldSize)),u=Vh(r.zoom);if(u>0){const h=zN(r,ce(1,r.center.lat)*r.worldSize),g=r.worldSize/(2*Math.PI),y=Math.max(r.width,r.height)/r.worldSize*Math.PI;return Br(s,h+g*(1-Math.cos(y)),Math.pow(u,10))}return s}upVector(r,s,u){return _x(s,u,r,1)}upVectorScale(r){return{metersToTile:Vw($w(Ru(r)))}}}function qN(a){const r=a.parallels,s=!!r&&Math.abs(r[0]+r[1])<.01;switch(a.name){case"mercator":return new BN(a);case"equirectangular":return new HG(a);case"naturalEarth":return new ZG(a);case"equalEarth":return new GG(a);case"winkelTripel":return new XG(a);case"albers":return s?new $N(a):new qG(a);case"lambertConformalConic":return s?new $N(a):new WG(a);case"globe":return new KG(a)}throw new Error(`Invalid projection name: ${a.name}`)}const YG=Et.types,JG=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Wx(a,r,s,u,h,g,y,b,T,E,k,P,R){const L=b?Math.min(jd,Math.round(b[0])):0,z=b?Math.min(jd,Math.round(b[1])):0;a.emplaceBack(r,s,Math.round(32*u),Math.round(32*h),g,y,(L<<1)+(T?1:0),0+(z<<1),16*E,16*k,256*P,256*R)}function Zx(a,r,s){a.emplaceBack(r,s)}function Xx(a,r,s,u,h,g,y){a.emplaceBack(r,s,u,h,g,y)}const b1=(a,r,s,u)=>{for(let h=0;h<r;h++)a.emplaceBack(s[0],s[1],s[2],u[0],u[1],u[2])};function h_(a,r,s,u,h){a.emplaceBack(r,s,u,h),a.emplaceBack(r,s,u,h),a.emplaceBack(r,s,u,h),a.emplaceBack(r,s,u,h)}function QG(a){for(const r of a.sections)if(dE(r.text))return!0;return!1}class SC{constructor(r){this.layoutVertexArray=new Bg,this.indexArray=new Ui,this.programConfigurations=r,this.segments=new Zi,this.dynamicLayoutVertexArray=new ku,this.opacityVertexArray=new tx,this.placedSymbolArray=new Bp,this.iconTransitioningVertexArray=new dl,this.globeExtVertexArray=new Rh,this.zOffsetVertexArray=new Lc,this.orientationVertexArray=new ix,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(r,s){const u=[],h=this.layoutVertexArray.uint16;for(let g=0;g<s;++g){const y=12*(r+g);u.push(...h.slice(y,y+12))}return u}updateIconVertexData(r,s,u,h,g,y,b,T,E,k,P,R,L){const z=this.layoutVertexArray.uint16,W=12*r;z[W]=s,z[W+1]=u,z[W+2]=h,z[W+3]=g,z[W+4]=y,z[W+5]=b,z[W+6]=T,z[W+7]=E,z[W+8]=k,z[W+9]=P,z[W+10]=R,z[W+11]=L}upload(r,s,u,h,g,y){this.isEmpty()||(u&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,nG.members,!!y),this.indexBuffer=r.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,sG.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,JG,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=r.createVertexBuffer(this.iconTransitioningVertexArray,lG.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,iG.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||g)&&(this.zOffsetVertexBuffer=r.createVertexBuffer(this.zOffsetVertexArray,oG.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=r.createVertexBuffer(this.orientationVertexArray,aG.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||h)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}or(SC,"SymbolBuffers");class TC{constructor(r,s,u){this.layoutVertexArray=new r,this.layoutAttributes=s,this.indexArray=new u,this.segments=new Zi,this.collisionVertexArray=new Nh,this.collisionVertexArrayExt=new ku}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,cG.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,uG.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}or(TC,"CollisionBuffers");class w1{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(y=>y.fqid),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Z([]),this.placementViewportMatrix=Z([]);const s=this.layers[0]._unevaluatedLayout._values;this.worldview=r.worldview,this.textSizeData=a_(this.zoom,s["text-size"],this.worldview),this.iconSizeData=a_(this.zoom,s["icon-size"],this.worldview);const u=this.layers[0].layout,h=u.get("symbol-sort-key"),g=u.get("symbol-z-order");this.lut=r.lut,this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(y=>Va[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=r.sourceID,this.projection=r.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null}hasAnyAppearanceProperty(r){const s=this.layers[0].getAppearances();return!(!s||s.length===0)&&s.some(u=>u.getProperty(r)!=null)}createArrays(){this.text=new SC(new Ml(this.layers,{zoom:this.zoom,lut:this.lut},r=>r.startsWith("text")||r.startsWith("symbol"))),this.icon=new SC(new Ml(this.layers,{zoom:this.zoom,lut:this.lut},r=>r.startsWith("icon")||r.startsWith("symbol"))),this.glyphOffsetArray=new dx,this.lineVertexArray=new Pw,this.symbolInstances=new kw}calculateGlyphDependencies(r,s,u,h,g){for(const y of r){const b=y.codePointAt(0);if(b===void 0)break;if(s[b]=!0,h&&g&&b<=65535){const T=Ox[y];T&&(s[T.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(r,s,u,h,g,y){let b=1;const T=r.getUnevaluatedProperties()._values["icon-size"],E=a_(this.zoom,T,this.worldview),k=l_(E,s);if(E.kind!=="constant"&&E.kind!=="camera"||(b=k.uSize),E.kind==="composite"){const{minZoom:P,maxZoom:R}=E,L=T.possiblyEvaluate(new Ai(P,{worldview:this.worldview}),h),z=T.possiblyEvaluate(new Ai(R,{worldview:this.worldview}),h),W=L.evaluate(u,{},h,g);b=W+(z.evaluate(u,{},h,g)-W)*k.uSizeT}return E.kind==="source"&&(b=T.possiblyEvaluate(new Ai(this.zoom,{worldview:this.worldview}),h).evaluate(u,{},h,g)),b*y}updateFootprints(r,s){}updateReplacement(r,s){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;const u=s.getReplacementRegionsForTile(r.toUnwrapped(),!0);return!Kw(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}getResolvedImageFromTokens(r){return typeof r=="string"?ia.build(r):r}populate(r,s,u,h){const g=this.layers[0],y=g.layout,b=this.projection.name==="globe",T=y.get("text-font"),E=y.get("text-field"),k=y.get("icon-image"),[P,R]=y.get("icon-size-scale-range"),L=se(s.scaleFactor||1,P,R),z=(E.value.kind!=="constant"||E.value.value instanceof ro&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),W=k.value.kind!=="constant"||!!k.value.value||Object.keys(k.parameters).length>0,J=this.hasAnyAppearanceProperty("icon-image"),te=y.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!z&&!W&&!J)return;const ae=s.iconDependencies,ue=s.glyphDependencies,he=s.availableImages,Ce=new Ai(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),be=ke=>{const Me=ke.id.toString();ae.has(Me)?ae.get(Me).push(ke):ae.set(Me,[ke])};for(const ke of r){const{feature:Me,id:ze,index:ct,sourceLayerIndex:We}=ke,ut=g._featureFilter.needGeometry,gt=et(Me,ut);if(!g._featureFilter.filter(Ce,gt,u))continue;if(ut||(gt.geometry=mt(Me,u,h)),b&&Me.type!==1&&u.z<=5){const At=gt.geometry,Nt=.98078528056,xt=(sr,cr)=>zr(_x(sr.x,sr.y,u,1),_x(cr.x,cr.y,u,1))<Nt;for(let sr=0;sr<At.length;sr++)At[sr]=pt(At[sr],xt)}let St,Lt;if(z){const At=g.getValueAndResolveTokens("text-field",gt,u,he),Nt=ro.factory(At);QG(Nt)&&(this.hasRTLText=!0),(!this.hasRTLText||Hv()==="unavailable"||this.hasRTLText&&_a.isParsed())&&(St=hG(Nt,g,gt))}if(W){const At=g.getValueAndResolveTokens("icon-image",gt,u,he);Lt=this.getResolvedImageFromTokens(At)}const kt=this.layers[0];let _t=!1;if(!Lt&&J){const At=kt.getAppearances();for(const Nt of At)if(Nt.getProperty("icon-image")){const xt=kt.getAppearanceValueAndResolveTokens(Nt,"icon-image",gt,u,he);if(xt){Lt=this.getResolvedImageFromTokens(xt),_t=!0;break}}}if(!St&&!Lt)continue;const It=this.sortFeaturesByKey?te.evaluate(gt,{},u):void 0,ot={id:ze,text:St,icon:Lt,index:ct,sourceLayerIndex:We,geometry:gt.geometry,properties:Me.properties,type:YG[Me.type],sortKey:It};if(this.features.push(ot),this.appearanceFeatureData.push({id:ze,properties:Me.properties,usesAppearanceIconAsPlaceholder:_t,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),Lt){const At=kt._unevaluatedLayout._values,{iconPrimary:Nt,iconSecondary:xt}=Bx(Lt,this.iconSizeData,At["icon-size"],u,this.zoom,ot,this.pixelRatio,L,this.worldview);be(Nt),xt&&(this.hasAnySecondaryIcon=!0,be(xt))}const rt=kt.getAppearances();if(rt.length!==0&&rt.forEach(At=>{if(!At.getProperty("icon-image"))return;const Nt=this.getCombinedIconPrimary(At,kt,gt,u,he,ot,L);Nt&&be(Nt)}),St){const At=T.evaluate(gt,{},u).join(","),Nt=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Va.vertical)>=0;for(const xt of St.sections)if(xt.image){const sr=xt.image.getPrimary().scaleSelf(this.pixelRatio),cr=sr.id.toString(),tr=ae.get(cr)||[];tr.push(sr),ae.set(cr,tr)}else{const sr=Bv(St.toString()),cr=xt.fontStack||At,tr=ue[cr]=ue[cr]||{};this.calculateGlyphDependencies(xt.text,tr,Nt,this.allowVerticalPlacement,sr)}}}if(y.get("symbol-placement")==="line"&&(this.features=function(ke){const Me={},ze={},ct=[];let We=0;function ut(kt){ct.push(ke[kt]),We++}function gt(kt,_t,It){const ot=ze[kt];return delete ze[kt],ze[_t]=ot,ct[ot].geometry[0].pop(),ct[ot].geometry[0]=ct[ot].geometry[0].concat(It[0]),ot}function St(kt,_t,It){const ot=Me[_t];return delete Me[_t],Me[kt]=ot,ct[ot].geometry[0].shift(),ct[ot].geometry[0]=It[0].concat(ct[ot].geometry[0]),ot}function Lt(kt,_t,It){const ot=It?_t[0][_t[0].length-1]:_t[0][0];return`${kt}:${ot.x}:${ot.y}`}for(let kt=0;kt<ke.length;kt++){const _t=ke[kt],It=_t.geometry,ot=_t.text?_t.text.toString():null;if(!ot){ut(kt);continue}const rt=Lt(ot,It),At=Lt(ot,It,!0);if(rt in ze&&At in Me&&ze[rt]!==Me[At]){const Nt=St(rt,At,It),xt=gt(rt,At,ct[Nt].geometry);delete Me[rt],delete ze[At],ze[Lt(ot,ct[xt].geometry,!0)]=xt,ct[Nt].geometry=null}else rt in ze?gt(rt,At,It):At in Me?St(rt,At,It):(ut(kt),Me[rt]=We-1,ze[At]=We-1)}return ct.filter(kt=>kt.geometry)}(this.features)),y.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",s.elevationFeatures){!this.elevationFeatures&&s.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const ke of s.elevationFeatures)this.elevationFeatureIdToIndex.set(ke.id,this.elevationFeatures.length),this.elevationFeatures.push(ke)}}else y.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((ke,Me)=>ke.sortKey-Me.sortKey)}getCombinedIconPrimary(r,s,u,h,g,y,b){let T,E;const k=r.getUnevaluatedProperties();if(k._values["icon-image"].value!==void 0){const P=s.getAppearanceValueAndResolveTokens(r,"icon-image",u,h,g);T=this.getResolvedImageFromTokens(P)}else{const P=s.getValueAndResolveTokens("icon-image",u,h,g);T=this.getResolvedImageFromTokens(P)}if(T){const P=k._values["icon-size"]||s._unevaluatedLayout._values["icon-size"];E=Bx(T,a_(this.zoom,P,this.worldview),P,h,this.zoom,y,this.pixelRatio,b,this.worldview).iconPrimary}return E}updateAppearanceBasedIconTextures(r,s,u,h){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const g=this.layers[0];let y=!1,b=0;const T=g.layout,[E,k]=T.get("icon-size-scale-range"),P=se(1,E,k);for(let R=0;R<this.symbolInstances.length;R++){const L=this.symbolInstances.get(R),z=this.appearanceFeatureData[L.featureIndex];if(z&&L.placedIconSymbolIndex>=0){const W=z.id,J=s&&W!==void 0?s[String(W)]:void 0,te={type:"Point",id:z.id,properties:z.properties,geometry:[]},ae=this.layers[0].appearances&&this.layers[0].appearances.find(ue=>ue.isActive({globals:h,feature:te,canonical:r,featureState:J}));if(z.activeAppearance===ae)continue;if(ae){z.activeAppearance=ae;const ue={sortKey:void 0,text:void 0,icon:null,index:L.featureIndex,sourceLayerIndex:L.featureIndex,geometry:[],properties:z.properties,type:"Point",id:z.id};if(!ae.hasCachedIconPrimary()){const ke=this.getCombinedIconPrimary(ae,g,te,r,u,ue,P);ae.setCachedIconPrimary(ke)}const he=ae.getCachedIconPrimary();if(!he)continue;const Ce=he.toString(),be=this.iconAtlasPositions&&this.iconAtlasPositions.get(Ce);if(be){const ke=g.getAppearanceValueAndResolveTokens(ae,"icon-offset",te,r,u),Me=ke&&Array.isArray(ke)?ke:[0,0];let ze=h1(be,void 0,Me,g.layout.get("icon-anchor").evaluate(te,{},r));const ct=g.getAppearanceValueAndResolveTokens(ae,"icon-rotate",te,r,u),We=typeof ct=="number"?ct:0,ut=be.sdf,gt=g.layout.get("icon-text-fit").constantOr("none");gt!=="none"&&z.textShaping&&z.iconTextFitPadding&&z.fontScale&&(ze=pC(ze,z.textShaping,gt,z.iconTextFitPadding,Me,z.fontScale));const St=this.calculateEffectiveAppearanceIconSize(ae,h.zoom,te,r,u,P),Lt=0,kt=1+(Math.min(jd,Math.round(St*Uc))<<1),_t=yC(ze,We,ut,gt!=="none",P);z.isUsingAppearanceVertexData||(z.isUsingAppearanceVertexData=!0,z.layoutBasedVertexData=this.icon.getIconVertexData(b,L.numIconVertices));for(let ot=0;ot<_t.length;++ot){const rt=_t[ot],At=z.layoutBasedVertexData[0]||L.tileAnchorX,Nt=z.layoutBasedVertexData[1]||L.tileAnchorY,xt=16*rt.pixelOffsetTL.x,sr=16*rt.pixelOffsetTL.y,cr=16*rt.pixelOffsetBR.x,tr=16*rt.pixelOffsetBR.y,Zt=16*rt.minFontScaleX,Xr=16*rt.minFontScaleY;this.icon.updateIconVertexData(b,At,Nt,Math.round(32*rt.tl.x),Math.round(32*rt.tl.y),rt.texPrimary.x,rt.texPrimary.y,Lt,kt,xt,sr,Zt,Xr),this.icon.updateIconVertexData(b+1,At,Nt,Math.round(32*rt.tr.x),Math.round(32*rt.tr.y),rt.texPrimary.x+rt.texPrimary.w,rt.texPrimary.y,Lt,kt,cr,sr,Zt,Xr),this.icon.updateIconVertexData(b+2,At,Nt,Math.round(32*rt.bl.x),Math.round(32*rt.bl.y),rt.texPrimary.x,rt.texPrimary.y+rt.texPrimary.h,Lt,kt,xt,tr,Zt,Xr),this.icon.updateIconVertexData(b+3,At,Nt,Math.round(32*rt.br.x),Math.round(32*rt.br.y),rt.texPrimary.x+rt.texPrimary.w,rt.texPrimary.y+rt.texPrimary.h,Lt,kt,cr,tr,Zt,Xr),b+=4}const It=L.numIconVertices-4*_t.length;for(let ot=0;ot<It;++ot)this.icon.updateIconVertexData(b+ot,0,0,0,0,0,0,0,0,0,0,0,0);y=!0}else b+=L.numIconVertices}else if(z.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(b,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(b+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(b+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(b+3,0,0,0,0,0,0,0,0,0,0,0,0),y=!0),b+=L.numIconVertices,z.activeAppearance=null;else if(z.isUsingAppearanceVertexData){const he=z.layoutBasedVertexData.length/12;for(let Ce=0;Ce<he;++Ce){const be=Ce*12;this.icon.updateIconVertexData(b+Ce,z.layoutBasedVertexData[be+0],z.layoutBasedVertexData[be+1],z.layoutBasedVertexData[be+2],z.layoutBasedVertexData[be+3],z.layoutBasedVertexData[be+4],z.layoutBasedVertexData[be+5],z.layoutBasedVertexData[be+6],z.layoutBasedVertexData[be+7],z.layoutBasedVertexData[be+8],z.layoutBasedVertexData[be+9],z.layoutBasedVertexData[be+10],z.layoutBasedVertexData[be+11])}b+=he,z.isUsingAppearanceVertexData=!1,z.activeAppearance=null,y=!0}else b+=L.numIconVertices,z.activeAppearance=null}}return y}update(r,s,u,h,g,y,b){this.text.programConfigurations.updatePaintArrays(r,s,g,u,h,y,b,this.worldview),this.icon.programConfigurations.updatePaintArrays(r,s,g,u,h,y,b,this.worldview)}updateRoadElevation(r){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let s=!1;const u=Ie(r),h=1/u;let g=!1,y=!1;for(let b=0;b<this.symbolInstances.length;b++){const T=this.symbolInstances.get(b),E=Ke(1,0,0),k=Ke(0,1,0),{numHorizontalGlyphVertices:P,numVerticalGlyphVertices:R,numIconVertices:L,numVerticalIconVertices:z}=T,W=P>0||R>0,J=L>0,te=this.elevationFeatures[T.elevationFeatureIndex];if(te){const ae=new wt(T.tileAnchorX,T.tileAnchorY),ue=.075+te.pointElevation(ae);T.zOffset!==ue&&(s=!0,T.zOffset=ue),ue!==0&&(this.hasAnyZOffset=!0);const he=te.computeSlopeNormal(ae,h),Ce=ho(br(),Ke(0,0,1),he);Ii(E,E,Ce),Ii(k,k,Ce),E[2]*=u,k[2]*=u,E[0]===1&&E[1]===0&&E[2]===0&&k[0]===0&&k[1]===1&&k[2]===0||(g=g||W,y=y||J)}if(W&&(b1(this.text.orientationVertexArray,P,E,k),b1(this.text.orientationVertexArray,R,E,k)),J){const{placedIconSymbolIndex:ae,verticalPlacedIconSymbolIndex:ue}=T;ae>=0&&b1(this.icon.orientationVertexArray,L,E,k),ue>=0&&b1(this.icon.orientationVertexArray,z,E,k)}}g||(this.text.orientationVertexArray=void 0),y||(this.icon.orientationVertexArray=void 0),s&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const r=(g,y,b)=>{u+=y,u>g.length&&g.resize(u);for(let T=-y;T<0;T++)g.emplace(T+u,b)},s=(g,y,b)=>{h+=y,h>g.length&&g.resize(h);for(let T=-y;T<0;T++)g.emplace(T+h,b)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,h=0;for(let g=0;g<this.symbolInstances.length;g++){const y=this.symbolInstances.get(g),{numHorizontalGlyphVertices:b,numVerticalGlyphVertices:T,numIconVertices:E}=y,k=y.zOffset,P=E>0;if((b>0||T>0)&&(r(this.text.zOffsetVertexArray,b,k),r(this.text.zOffsetVertexArray,T,k)),P){const{placedIconSymbolIndex:R,verticalPlacedIconSymbolIndex:L}=y;R>=0&&s(this.icon.zOffsetVertexArray,E,k),L>=0&&s(this.icon.zOffsetVertexArray,y.numVerticalIconVertices,k)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r,s,u,h,g){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(y=>y.appearances&&y.appearances.length>0)),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(r,s,u,h){return!!(r&&s&&u)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(r,s,u,h)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=qN(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,s){const u=this.lineVertexArray.length;if(r.segment!==void 0)for(const{x:h,y:g}of s)this.lineVertexArray.emplaceBack(h,g);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(r,s,u,h,g,y,b,T,E,k,P,R,L,z,W,J,te,ae){const ue=r.indexArray,he=r.layoutVertexArray,Ce=r.globeExtVertexArray,be=r.segments.prepareSegment(4*ae,he,ue,this.canOverlap?y.sortKey:void 0),ke=this.glyphOffsetArray.length,Me=be.vertexLength,ze=this.allowVerticalPlacement&&b===Va.vertical?Math.PI/2:0,ct=y.text&&y.text.sections;for(let gt=0;gt<s.length;gt++){const{tl:St,tr:Lt,bl:kt,br:_t,texPrimary:It,texSecondary:ot,pixelOffsetTL:rt,pixelOffsetBR:At,minFontScaleX:Nt,minFontScaleY:xt,glyphOffset:sr,isSDF:cr,sectionIndex:tr}=s[gt],Zt=be.vertexLength,Xr=sr[1];if(Wx(he,E.x,E.y,St.x,Xr+St.y,It.x,It.y,u,cr,rt.x,rt.y,Nt,xt),Wx(he,E.x,E.y,Lt.x,Xr+Lt.y,It.x+It.w,It.y,u,cr,At.x,rt.y,Nt,xt),Wx(he,E.x,E.y,kt.x,Xr+kt.y,It.x,It.y+It.h,u,cr,rt.x,At.y,Nt,xt),Wx(he,E.x,E.y,_t.x,Xr+_t.y,It.x+It.w,It.y+It.h,u,cr,At.x,At.y,Nt,xt),T){const{x:Jt,y:Tr,z:Jr}=T.anchor,[pn,zn,rn]=T.up;Xx(Ce,Jt,Tr,Jr,pn,zn,rn),Xx(Ce,Jt,Tr,Jr,pn,zn,rn),Xx(Ce,Jt,Tr,Jr,pn,zn,rn),Xx(Ce,Jt,Tr,Jr,pn,zn,rn),h_(r.dynamicLayoutVertexArray,Jt,Tr,Jr,ze)}else h_(r.dynamicLayoutVertexArray,E.x,E.y,E.z,ze);if(J){const Jt=ot||It;Zx(r.iconTransitioningVertexArray,Jt.x,Jt.y),Zx(r.iconTransitioningVertexArray,Jt.x+Jt.w,Jt.y),Zx(r.iconTransitioningVertexArray,Jt.x,Jt.y+Jt.h),Zx(r.iconTransitioningVertexArray,Jt.x+Jt.w,Jt.y+Jt.h)}ue.emplaceBack(Zt,Zt+1,Zt+2),ue.emplaceBack(Zt+1,Zt+2,Zt+3),be.vertexLength+=4,be.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(sr[0]),gt!==s.length-1&&tr===s[gt+1].sectionIndex||r.programConfigurations.populatePaintArrays(he.length,y,y.index,{},L,z,W,ct&&ct[tr],this.worldview)}const We=ae-s.length;We!==0&&this._addNullVertices(We,he,u,T,Ce,r,J,be,ue);const ut=T?T.anchor:E;r.placedSymbolArray.emplaceBack(ut.x,ut.y,ut.z,E.x,E.y,ke,this.glyphOffsetArray.length-ke,Me,k,P,E.segment,u?u[0]:0,u?u[1]:0,h[0],h[1],b,0,0,0,R,0),r.symbolInstanceIndices.push(te)}_addNullVertices(r,s,u,h,g,y,b,T,E){for(let k=0;k<r;k++){for(let R=0;R<4;R++)Wx(s,0,0,0,0,0,0,u,!1,0,0,0,0),h&&Xx(g,0,0,0,0,0,0),h_(y.dynamicLayoutVertexArray,0,0,0,0),b&&Zx(y.iconTransitioningVertexArray,0,0);const P=T.vertexLength;E.emplaceBack(P,P+1,P+2),E.emplaceBack(P+1,P+2,P+3),T.vertexLength+=4,T.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(r,s,u,h,g,y,b){r.emplaceBack(s,u,h,g,y,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(r,s,u,h,g,y,b){const T=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),E=T.vertexLength,k=b.tileAnchorX,P=b.tileAnchorY;for(let L=0;L<4;L++)u.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,s,r.padding,b.zOffset),this._commitLayoutVertex(u.layoutVertexArray,h,g,y,k,P,new wt(r.x1,r.y1)),this._commitLayoutVertex(u.layoutVertexArray,h,g,y,k,P,new wt(r.x2,r.y1)),this._commitLayoutVertex(u.layoutVertexArray,h,g,y,k,P,new wt(r.x2,r.y2)),this._commitLayoutVertex(u.layoutVertexArray,h,g,y,k,P,new wt(r.x1,r.y2)),T.vertexLength+=4;const R=u.indexArray;R.emplaceBack(E,E+1),R.emplaceBack(E+1,E+2),R.emplaceBack(E+2,E+3),R.emplaceBack(E+3,E),T.primitiveLength+=4}_addTextDebugCollisionBoxes(r,s,u,h,g,y){for(let b=h;b<g;b++){const T=u.get(b),E=this.getSymbolInstanceTextSize(r,y,s,b);this._addCollisionDebugVertices(T,E,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(r,s,u,h,g,y){for(let b=h;b<g;b++){const T=u.get(b),E=this.getSymbolInstanceIconSize(r,s,y.placedIconSymbolIndex);this._addCollisionDebugVertices(T,E,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,y)}}generateCollisionDebugBuffers(r,s,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new TC(Vg,aN.members,dl),this.iconCollisionBox=new TC(Vg,aN.members,dl);const h=l_(this.iconSizeData,r),g=l_(this.textSizeData,r,u);for(let y=0;y<this.symbolInstances.length;y++){const b=this.symbolInstances.get(y);this._addTextDebugCollisionBoxes(g,r,s,b.textBoxStartIndex,b.textBoxEndIndex,b),this._addTextDebugCollisionBoxes(g,r,s,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._addIconDebugCollisionBoxes(h,r,s,b.iconBoxStartIndex,b.iconBoxEndIndex,b),this._addIconDebugCollisionBoxes(h,r,s,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b)}}getSymbolInstanceTextSize(r,s,u,h){const g=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:h),y=mC(this.textSizeData,r,g)/go;return this.tilePixelRatio*y}getSymbolInstanceIconSize(r,s,u){const h=this.icon.placedSymbolArray.get(u),g=mC(this.iconSizeData,r,h);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(r,s,u,h){r.emplaceBack(s,-u,-u,h),r.emplaceBack(s,u,-u,h),r.emplaceBack(s,u,u,h),r.emplaceBack(s,-u,u,h)}_updateTextDebugCollisionBoxes(r,s,u,h,g,y,b){for(let T=h;T<g;T++){const E=u.get(T),k=this.getSymbolInstanceTextSize(r,y,s,T);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,k,E.padding,y.zOffset)}}_updateIconDebugCollisionBoxes(r,s,u,h,g,y,b){for(let T=h;T<g;T++){const E=u.get(T),k=this.getSymbolInstanceIconSize(r,s,y.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,k,E.padding,y.zOffset)}}updateCollisionDebugBuffers(r,s,u,h){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const g=l_(this.iconSizeData,r,h),y=l_(this.textSizeData,r,u);for(let b=0;b<this.symbolInstances.length;b++){const T=this.symbolInstances.get(b);this._updateTextDebugCollisionBoxes(y,r,s,T.textBoxStartIndex,T.textBoxEndIndex,T,u),this._updateTextDebugCollisionBoxes(y,r,s,T.verticalTextBoxStartIndex,T.verticalTextBoxEndIndex,T,u),this._updateIconDebugCollisionBoxes(g,r,s,T.iconBoxStartIndex,T.iconBoxEndIndex,T,h),this._updateIconDebugCollisionBoxes(g,r,s,T.verticalIconBoxStartIndex,T.verticalIconBoxEndIndex,T,h)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,s,u,h,g,y,b,T,E){const k={};if(s<u){const{x1:P,y1:R,x2:L,y2:z,padding:W,projectedAnchorX:J,projectedAnchorY:te,projectedAnchorZ:ae,tileAnchorX:ue,tileAnchorY:he,featureIndex:Ce}=r.get(s);k.textBox={x1:P,y1:R,x2:L,y2:z,padding:W,projectedAnchorX:J,projectedAnchorY:te,projectedAnchorZ:ae,tileAnchorX:ue,tileAnchorY:he},k.textFeatureIndex=Ce}if(h<g){const{x1:P,y1:R,x2:L,y2:z,padding:W,projectedAnchorX:J,projectedAnchorY:te,projectedAnchorZ:ae,tileAnchorX:ue,tileAnchorY:he,featureIndex:Ce}=r.get(h);k.verticalTextBox={x1:P,y1:R,x2:L,y2:z,padding:W,projectedAnchorX:J,projectedAnchorY:te,projectedAnchorZ:ae,tileAnchorX:ue,tileAnchorY:he},k.verticalTextFeatureIndex=Ce}if(y<b){const{x1:P,y1:R,x2:L,y2:z,padding:W,projectedAnchorX:J,projectedAnchorY:te,projectedAnchorZ:ae,tileAnchorX:ue,tileAnchorY:he,featureIndex:Ce}=r.get(y);k.iconBox={x1:P,y1:R,x2:L,y2:z,padding:W,projectedAnchorX:J,projectedAnchorY:te,projectedAnchorZ:ae,tileAnchorX:ue,tileAnchorY:he},k.iconFeatureIndex=Ce}if(T<E){const{x1:P,y1:R,x2:L,y2:z,padding:W,projectedAnchorX:J,projectedAnchorY:te,projectedAnchorZ:ae,tileAnchorX:ue,tileAnchorY:he,featureIndex:Ce}=r.get(T);k.verticalIconBox={x1:P,y1:R,x2:L,y2:z,padding:W,projectedAnchorX:J,projectedAnchorY:te,projectedAnchorZ:ae,tileAnchorX:ue,tileAnchorY:he},k.verticalIconFeatureIndex=Ce}return k}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const u=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(r,s){const u=r.placedSymbolArray.get(s),h=u.vertexStartIndex+4*u.numGlyphs;for(let g=u.vertexStartIndex;g<h;g+=4)r.indexArray.emplaceBack(g,g+1,g+2),r.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(r),u=Math.cos(r),h=[],g=[],y=[];for(let b=0;b<this.symbolInstances.length;++b){y.push(b);const T=this.symbolInstances.get(b);h.push(0|Math.round(s*T.tileAnchorX+u*T.tileAnchorY)),g.push(T.featureIndex)}return y.sort((b,T)=>h[b]-h[T]||g[T]-g[b]),y}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let r=0;r<this.symbolInstances.length;++r)this.symbolInstanceIndexesSortedZOffset.push(r)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((r,s)=>this.symbolInstances.get(s).zOffset-this.symbolInstances.get(r).zOffset)}addToSortKeyRanges(r,s){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===s?u.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const u=this.symbolInstances.get(s);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:g,leftJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:b,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:E}=u;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),g>=0&&g!==h&&this.addIndicesForPlacedSymbol(this.text,g),y>=0&&y!==g&&y!==h&&this.addIndicesForPlacedSymbol(this.text,y),b>=0&&this.addIndicesForPlacedSymbol(this.text,b),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(r){const s=this.symbolInstances.get(this.text.symbolInstanceIndices[r]).elevationFeatureIndex;let u;return this.elevationFeatures&&s<this.elevationFeatures.length&&(u=this.elevationFeatures[s]),u}}function GN(a,r){return r.replace(/{([^{}]+)}/g,(s,u)=>u in a?String(a[u]):"")}let HN,WN,EC;or(w1,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),w1.addDynamicAttributes=h_;class ZN{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:oh,this.defaultValue=r}evaluate(r){if(r.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(r.formattedSection))return s.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}or(ZN,"FormatSectionOverride",{omit:["defaultValue"]});const CC=()=>EC||(EC={layout:HN||(HN=new is({"symbol-placement":new Rt(He.layout_symbol["symbol-placement"]),"symbol-spacing":new Rt(He.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Rt(He.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Qt(He.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Rt(He.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Rt(He.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Rt(He.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Rt(He.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Rt(He.layout_symbol["icon-ignore-placement"]),"icon-optional":new Rt(He.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Rt(He.layout_symbol["icon-rotation-alignment"]),"icon-size":new Qt(He.layout_symbol["icon-size"]),"icon-size-scale-range":new Rt(He.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Qt(He.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Qt(He.layout_symbol["icon-text-fit-padding"]),"icon-image":new Qt(He.layout_symbol["icon-image"]),"icon-image-use-theme":new Rt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Qt(He.layout_symbol["icon-rotate"]),"icon-padding":new Rt(He.layout_symbol["icon-padding"]),"icon-keep-upright":new Rt(He.layout_symbol["icon-keep-upright"]),"icon-offset":new Qt(He.layout_symbol["icon-offset"]),"icon-anchor":new Qt(He.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Rt(He.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Rt(He.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Rt(He.layout_symbol["text-rotation-alignment"]),"text-field":new Qt(He.layout_symbol["text-field"]),"text-font":new Qt(He.layout_symbol["text-font"]),"text-size":new Qt(He.layout_symbol["text-size"]),"text-size-scale-range":new Rt(He.layout_symbol["text-size-scale-range"]),"text-max-width":new Qt(He.layout_symbol["text-max-width"]),"text-line-height":new Qt(He.layout_symbol["text-line-height"]),"text-letter-spacing":new Qt(He.layout_symbol["text-letter-spacing"]),"text-justify":new Qt(He.layout_symbol["text-justify"]),"text-radial-offset":new Qt(He.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Rt(He.layout_symbol["text-variable-anchor"]),"text-anchor":new Qt(He.layout_symbol["text-anchor"]),"text-max-angle":new Rt(He.layout_symbol["text-max-angle"]),"text-writing-mode":new Rt(He.layout_symbol["text-writing-mode"]),"text-rotate":new Qt(He.layout_symbol["text-rotate"]),"text-padding":new Rt(He.layout_symbol["text-padding"]),"text-keep-upright":new Rt(He.layout_symbol["text-keep-upright"]),"text-transform":new Qt(He.layout_symbol["text-transform"]),"text-offset":new Qt(He.layout_symbol["text-offset"]),"text-allow-overlap":new Rt(He.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Rt(He.layout_symbol["text-ignore-placement"]),"text-optional":new Rt(He.layout_symbol["text-optional"]),visibility:new Rt(He.layout_symbol.visibility)})),paint:WN||(WN=new is({"icon-opacity":new Qt(He.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Qt(He.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Qt(He.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Qt(He.paint_symbol["text-emissive-strength"]),"icon-color":new Qt(He.paint_symbol["icon-color"]),"icon-halo-color":new Qt(He.paint_symbol["icon-halo-color"]),"icon-halo-width":new Qt(He.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Qt(He.paint_symbol["icon-halo-blur"]),"icon-translate":new Rt(He.paint_symbol["icon-translate"]),"icon-translate-anchor":new Rt(He.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Rt(He.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Qt(He.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Qt(He.paint_symbol["text-occlusion-opacity"]),"text-color":new Qt(He.paint_symbol["text-color"],{runtimeType:ma,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new Qt(He.paint_symbol["text-halo-color"]),"text-halo-width":new Qt(He.paint_symbol["text-halo-width"]),"text-halo-blur":new Qt(He.paint_symbol["text-halo-blur"]),"text-translate":new Rt(He.paint_symbol["text-translate"]),"text-translate-anchor":new Rt(He.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Rt(He.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Rt(He.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Rt(He.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Rt(He.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Qt(He.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},EC);class S1 extends $o{constructor(r,s,u,h){super(r,CC(),s,u,h,r.layout?r.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=Z([]),this.hasOcclusionOpacityProperties=r.paint!==void 0&&("icon-occlusion-opacity"in r.paint||"text-occlusion-opacity"in r.paint)}_handleSpecialPaintPropertyUpdate(r){r!=="icon-occlusion-opacity"&&r!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(r,s){super.recalculate(r,s),this.appearances&&this.appearances.forEach(h=>{h.recalculate(r,s,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const h=[];for(const g of u)h.indexOf(g)<0&&h.push(g);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(r,s,u,h){return this._saturation===r&&this._contrast===s&&this._brightnessMin===u&&this._brightnessMax===h||(this._colorAdjustmentMatrix=function(g,y,b,T){g=Qi(g),y=Ni(y);const E=Y(),k=g/3,P=1-2*k,R=[P,k,k,0,k,P,k,0,k,k,P,0,0,0,0,1],L=.5-.5*y,z=T-b;return H(E,[z,0,0,0,0,z,0,0,0,0,z,0,b,b,b,1],[y,0,0,0,0,y,0,0,0,0,y,0,L,L,L,1]),H(E,E,R),E}(r,s,u,h),this._saturation=r,this._contrast=s,this._brightnessMin=u,this._brightnessMax=h),this._colorAdjustmentMatrix}getValueAndResolveTokens(r,s,u,h){const g=this.layout.get(r).evaluate(s,{},u,h),y=this._unevaluatedLayout._values[r];return y.isDataDriven()||jg(y.value)||!g?g:GN(s.properties,g)}getAppearanceValueAndResolveTokens(r,s,u,h,g){const y=r.getProperty(s);if(!y)return;const b=y.evaluate(u,{},h,g),T=r.getUnevaluatedProperties()._values[s];return T.isDataDriven()||jg(T.value)||!b||typeof b!="string"?b:GN(u.properties,b)}createBucket(r){return new w1(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of CC().paint.overridableProperties){if(!S1.hasPaintOverride(this.layout,r))continue;const s=this.paint.get(r),u=new ZN(s),h=new Ag(u,s.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let g=null;g=s.value.kind==="constant"||s.value.kind==="source"?new Np("source",h):new Eu("composite",h,s.value.zoomStops,s.value.interpolationType),this.paint._values[r]=new ul(s.property,g,s.parameters)}}_handleOverridablePaintPropertyUpdate(r,s,u){return!(!this.layout||s.isDataDriven()||u.isDataDriven())&&S1.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,s){const u=r.get("text-field"),h=CC().paint.properties[s];let g=!1;const y=b=>{for(const T of b)if(h.overrides&&h.overrides.hasOverride(T))return void(g=!0)};if(u.value.kind==="constant"&&u.value.value instanceof ro)y(u.value.value.sections);else if(u.value.kind==="source"){const b=E=>{g||(E instanceof Rc&&Qs(E.value)===ud?y(E.value.sections):E instanceof dd?y(E.sections):E.eachChild(b))},T=u.value;T._styleExpression&&b(T._styleExpression.expression)}return g}getProgramIds(){return["symbol"]}getDefaultProgramParams(r,s,u){return{config:new Fc(this,{zoom:s,lut:u}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let XN,KN,YN,JN;var AC=vn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function T1(a,r,s,u,h,g,y,b){const T=[a,r,1,s,u,1,h,g,1],E=[y,b,1],k=$([],T),[P,R,L]=Ji(E,E,k);return V(T,T,[P,0,0,0,R,0,0,0,L])}function QN(a,r,s,u,h,g,y,b){const T=function(E,k,P,R,L,z,W,J){const te=T1(0,0,1,0,1,1,0,1),ae=T1(E,k,P,R,L,z,W,J);return V(ae,ae,$([],te))}(a,r,s,u,h,g,y,b);return[T[2]/T[8]/Vt,T[5]/T[8]/Vt]}function E1(a){return[a[0],Math.min(Math.max(a[1],-ge),ge)]}class eD extends Ic{constructor(r,s,u,h){super(),this.id=r,this.dispatcher=u,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=s,this._dirty=!1}load(r,s){if(this._loaded=s||!1,this.fire(new ka("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return r&&(this.coordinates=r),this._loaded=!0,void this._finishLoading();this._imageRequest=sv(this.map._requestManager.transformRequest(this.url,ad.Image),(u,h)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new fp(u)):h&&(this.image=h instanceof HTMLImageElement?pa.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading())})}loaded(){return this._loaded}updateImage(r){return r.url?(this._imageRequest&&r.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}setTexture(r){if(!(r.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Mx(this.map.painter.context,r.handle),this.width=r.dimensions[0],this.height=r.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new ka("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(r){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Mx||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(r){if(this.coordinates=r,this._boundsArray=void 0,this._unsupportedCoords=!1,!r.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let s=r[0][1],u=r[0][1];for(const g of r)g[1]>u&&(u=g[1]),g[1]<s&&(s=g[1]);const h=(u+s)/2;if(h>ge?this.onNorthPole=!0:h<-ge&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const g=r.map($e.fromLngLat);this.tileID=function(y){let b=1/0,T=1/0,E=-1/0,k=-1/0;for(const W of y)b=Math.min(b,W.x),T=Math.min(T,W.y),E=Math.max(E,W.x),k=Math.max(k,W.y);const P=Math.max(E-b,k-T),R=Math.max(0,Math.floor(-Math.log2(P))),L=Math.pow(2,R);let z=Math.floor((b+E)/2*L);return z>1&&(z-=1),new za(R,z,Math.floor((T+k)/2*L))}(g),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new ka("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof Mx||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(r){for(const te in this.tiles){const ae=this.tiles[te];ae.state!=="loaded"&&(ae.state="loaded",ae.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const s=Ux(new za(0,0,0),this.map.transform.projection),u=[s.projection.project(this.coordinates[0][0],this.coordinates[0][1]),s.projection.project(this.coordinates[1][0],this.coordinates[1][1]),s.projection.project(this.coordinates[2][0],this.coordinates[2][1]),s.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(te){const ae=te[1].x-te[0].x,ue=te[1].y-te[0].y,he=te[2].x-te[1].x,Ce=te[2].y-te[1].y,be=te[3].x-te[2].x,ke=te[3].y-te[2].y,Me=te[0].x-te[3].x,ze=te[0].y-te[3].y,ct=ae*Ce-he*ue,We=he*ke-be*Ce,ut=be*ze-Me*ke,gt=Me*ue-ae*ze;return ct>0&&We>0&&ut>0&&gt>0||ct<0&&We<0&&ut<0&&gt<0}(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const h=Ux(this.tileID,this.map.transform.projection),[g,y,b,T]=this.coordinates.map(te=>{const ae=h.projection.project(te[0],te[1]);return FN(h,ae)._round()});this.perspectiveTransform=QN(g.x,g.y,y.x,y.y,b.x,b.y,T.x,T.y);const E=this._boundsArray=new Ph;E.emplaceBack(g.x,g.y,0,0),E.emplaceBack(y.x,y.y,Vt,0),E.emplaceBack(T.x,T.y,0,Vt),E.emplaceBack(b.x,b.y,Vt,Vt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=r.createVertexBuffer(E,AC.members),this.boundsSegments=Zi.simpleSegment(0,0,4,2);const k=[],P=[E1((R=this.coordinates)[0]),E1(R[1]),E1(R[2]),E1(R[3])];var R;const[L,z,W,J]=function(te){let ae=te[0][0],ue=ae,he=te[0][1],Ce=he;for(let be=1;be<te.length;be++)te[be][0]<ae?ae=te[be][0]:te[be][0]>ue&&(ue=te[be][0]),te[be][1]<he?he=te[be][1]:te[be][1]>Ce&&(Ce=te[be][1]);return[ae,he,ue-ae,Ce-he]}(P);{const te=new Ph,[ae,ue,he,Ce]=function(_t){let It=_t[0].x,ot=It,rt=_t[0].y,At=rt;for(let Nt=1;Nt<_t.length;Nt++)_t[Nt].x<It?It=_t[Nt].x:_t[Nt].x>ot&&(ot=_t[Nt].x),_t[Nt].y<rt?rt=_t[Nt].y:_t[Nt].y>At&&(At=_t[Nt].y);return[It,rt,ot-It,At-rt]}(u),be=_t=>[(_t.x-ae)/he,(_t.y-ue)/Ce],[ke,Me,ze,ct]=u.map(be),We=function(_t,It,ot,rt,At,Nt,xt,sr){const cr=T1(0,0,1,0,1,1,0,1);return V(cr,cr,$([],T1(_t,It,ot,rt,At,Nt,xt,sr)))}(ke[0],ke[1],Me[0],Me[1],ze[0],ze[1],ct[0],ct[1]);this.elevatedGlobePerspectiveTransform=QN(ke[0],ke[1],Me[0],Me[1],ze[0],ze[1],ct[0],ct[1]);const ut=(_t,It)=>{k.push(_t.lng);const ot=Math.round((_t.lng-L)/W*Vt),rt=Math.round((_t.lat-z)/J*Vt),At=be(It),Nt=Ji([],[At[0],At[1],1],We),xt=Math.round(Nt[0]/Nt[2]*Vt),sr=Math.round(Nt[1]/Nt[2]*Vt);te.emplaceBack(ot,rt,xt,sr)},gt=u[3].x-u[0].x,St=u[3].y-u[0].y,Lt=u[2].x-u[1].x,kt=u[2].y-u[1].y;for(let _t=0;_t<65;_t++){const It=_t/64,ot=[u[0].x+It*gt,u[0].y+It*St],rt=[u[1].x+It*Lt,u[1].y+It*kt],At=rt[0]-ot[0],Nt=rt[1]-ot[1];for(let xt=0;xt<65;xt++){const sr=xt/64,cr={x:ot[0]+At*sr,y:ot[1]+Nt*sr};ut(s.projection.unproject(cr.x,cr.y),cr)}}this.elevatedGlobeVertexBuffer=r.createVertexBuffer(te,AC.members)}{this.maxLongitudeTriangleSize=0;let te=[],ae=new Ui;const ue=(he,Ce,be)=>{ae.emplaceBack(he,Ce,be);const ke=k[he],Me=k[Ce],ze=k[be],ct=Math.min(Math.min(ke,Me),ze),We=Math.max(Math.max(ke,Me),ze)-ct;We>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=We),te.push(ct+We/2)};for(let he=0;he<64;he++)for(let Ce=0;Ce<64;Ce++){const be=65*he+Ce,ke=be+1,Me=be+65,ze=Me+1;ue(be,Me,ke),ue(ke,Me,ze)}[te,ae]=function(he,Ce){const be=Array.from({length:he.length},(ze,ct)=>ct);be.sort((ze,ct)=>he[ze]-he[ct]);const ke=[],Me=new Ui;for(let ze=0;ze<be.length;ze++){const ct=be[ze];ke.push(he[ct]);const We=3*ct,ut=We+1;Me.emplaceBack(Ce.uint16[We],Ce.uint16[ut],Ce.uint16[ut+1])}return[ke,Me]}(te,ae),this.elevatedGlobeTrianglesCenterLongitudes=te,this.elevatedGlobeIndexBuffer=r.createIndexBuffer(ae)}this.elevatedGlobeSegments=Zi.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,W/Vt,0,J/Vt,0,0,z,L,0])}prepare(){const r=Object.keys(this.tiles).length!==0;if(this.tileID&&!r)return;const s=this.map.painter.context,u=s.gl;!this._dirty||this.texture instanceof Mx||(this.texture?this.texture.update(this.image):(this.texture=new QE(s,this.image,u.RGBA8),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),r&&this._prepareData(s)}loadTile(r,s){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},s(null)):(r.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(r){const s=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!s)return null;const u=this.elevatedGlobeTrianglesCenterLongitudes;let h=(g=r+180)+360*Math.round((u[0]-g)/360);var g;const y=new Zi,b=(P,R)=>{y.segments.push({vertexOffset:0,primitiveOffset:P,vertexLength:s.segments[0].vertexLength,primitiveLength:R,sortKey:void 0,vaos:{}})},T=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-h)<=T){const P=kn(u,0,u.length,h+T);return P===u.length||b(P,ci(u,P+1,u.length,h+360-T)-P),y}h<u[0]&&(h+=360);const E=ci(u,0,u.length,h-T);if(E===u.length)return b(0,u.length),y;b(0,E-0);const k=kn(u,E+1,u.length,h+T);return k!==u.length&&b(k,u.length-k),y}}const eH=(Math.pow(256,2)-1)/16907520;class tD extends $o{constructor(r,s,u,h){super(r,{layout:YN||(YN=new is({visibility:new Rt(He.layout_raster.visibility)})),paint:JN||(JN=new is({"raster-opacity":new Rt(He.paint_raster["raster-opacity"]),"raster-color":new Ch(He.paint_raster["raster-color"]),"raster-color-mix":new Rt(He.paint_raster["raster-color-mix"]),"raster-color-range":new Rt(He.paint_raster["raster-color-range"]),"raster-hue-rotate":new Rt(He.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Rt(He.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Rt(He.paint_raster["raster-brightness-max"]),"raster-saturation":new Rt(He.paint_raster["raster-saturation"]),"raster-contrast":new Rt(He.paint_raster["raster-contrast"]),"raster-resampling":new Rt(He.paint_raster["raster-resampling"]),"raster-fade-duration":new Rt(He.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Rt(He.paint_raster["raster-emissive-strength"]),"raster-array-band":new Rt(He.paint_raster["raster-array-band"]),"raster-elevation":new Rt(He.paint_raster["raster-elevation"]),"raster-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},s,u,h),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(r){return!(r&&r._source instanceof eD&&(r._source.onNorthPole||r._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(r){r!=="raster-color"&&r!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(r){if(!this.hasColorMap()||!this._curRampRange)return;const s=this._transitionablePaint._values["raster-color"].value.expression,[u,h]=r||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(h)||u===this._curRampRange[0]&&h===this._curRampRange[1]||(this.colorRamp=yx({expression:s,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:h}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,h])}}let rD,nD,iD,sD,oD;class aD extends $o{constructor(r,s,u,h){super(r,{layout:rD||(rD=new is({visibility:new Rt(He["layout_raster-particle"].visibility)})),paint:nD||(nD=new is({"raster-particle-array-band":new Rt(He["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Rt(He["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Ch(He["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Rt(He["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Rt(He["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Rt(He["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Rt(He["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Rt(He["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},s,u,h),this._updateColorRamp(),this.lastInvalidatedAt=pa.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(r){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(r){return!1}_handleSpecialPaintPropertyUpdate(r){r!=="raster-particle-color"&&r!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),r==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const r=this._transitionablePaint._values["raster-particle-color"].value.expression,s=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=yx({expression:r,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:s}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=pa.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class tH extends $o{constructor(r,s){super(r,{},s,null),this.implementation=r,r.slot&&(this.slot=r.slot)}is3D(r){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(r){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}function jC(a,r,s){const u=[0,0,1],h=Fr([]);return pi(h,h,s?-gn(a)+Math.PI:gn(a)),On(h,h,-gn(r)),Ii(u,u,h),xr(u,u)}const lD={None:0,Model:1,Symbol:2,FillExtrusion:4};class C1{constructor(r,s,u,h){this.message=(r?`${r}: `:"")+u,h&&(this.identifier=h),s!=null&&s.__line__&&(this.line=s.__line__)}}function IC(a,r){const s=a.indexOf("://")===-1;try{return new URL(a,s&&r?"http://example.com":void 0),!0}catch{return!1}}class cD{constructor(r,s){this.feature=r,this.instancedDataOffset=s,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class uD{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new $g,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(r){const s=16*r,u=this.instancedDataArray.float32;let h=Math.floor(u[s+2]);const g=1.05*(u[s+2]-h);return h/=100,[u[s]%1*1.05,u[s+1]%1*1.05,g,h]}tileCoordinatesForInstance(r){const s=16*r,u=this.instancedDataArray.float32;let h=u[s+0];return h=h>Vt?h-Vt:h,new wt(Math.trunc(h),Math.trunc(u[s+1]))}translationForInstance(r){const s=16*r,u=this.instancedDataArray.float32;return[u[s+4],u[s+5],u[s+6]]}rotationScaleForInstance(r){const s=16*r,u=this.instancedDataArray.float32;return[u[s+7],u[s+8],u[s+9],u[s+10],u[s+11],u[s+12],u[s+13],u[s+14],u[s+15]]}transformForInstance(r){const s=16*r,u=this.instancedDataArray.float32;return[u[s+7],u[s+8],u[s+9],u[s+4],u[s+10],u[s+11],u[s+12],u[s+5],u[s+13],u[s+14],u[s+15],u[s+6],0,0,0,1]}}class kC{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaledZ=this.canonical.z+Math.log2(r.overscaling),this.layers=r.layers,this.layerIds=this.layers.map(s=>s.fqid),this.projection=r.projection,this.index=r.index,this.worldview=r.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=r.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(r,s){}updateAppearances(r,s,u,h){}populate(r,s,u,h){this.tileToMeter=Ie(u);const g=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:y,id:b,index:T,sourceLayerIndex:E}of r){const k=b??(y.properties&&y.properties.hasOwnProperty("id")?y.properties.id:void 0),P=et(y,g);if(!this.layers[0]._featureFilter.filter(new Ai(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),P,u))continue;const R={id:k,sourceLayerIndex:E,index:T,geometry:g?P.geometry:mt(y,u,h),properties:y.properties,type:y.type,patterns:{}},L=this.addFeature(R,R.geometry,P);L&&s.featureIndex.insert(y,R.geometry,T,E,this.index,this.instancesPerModel[L].instancedDataArray.length,Vt/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const r=this.layers[0].modelManager,s=this.layers[0].scope;let u=0;for(const h of this.modelUris){const g=r.getModel(h,s);if(!g)continue;const y=this.instancesPerModel[h];if(y){const b=.5*Wt(g.aabb.max,g.aabb.min)*y.maxScale+y.maxXYTranslationDistance,T=Math.min(Vt,Math.max(b/this.tileToMeter,Vt/32));u=Math.max(T,u)}}return u}update(r,s,u,h){for(const g in this.instancesPerModel){const y=this.instancesPerModel[g];for(const b in r)y.idToFeaturesIndex.hasOwnProperty(b)&&(this.evaluate(y.features[y.idToFeaturesIndex[b]],r[b],y,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let r=!1;for(const s in this.instancesPerModel){const u=this.instancesPerModel[s];for(const h of u.features){const g=this.layers[0],y=h.feature,b=this.canonical,T=g.paint.get("model-rotation").evaluate(y,{},b),E=g.paint.get("model-scale").evaluate(y,{},b),k=g.paint.get("model-translation").evaluate(y,{},b);As(h.rotation,T)&&As(h.scale,E)&&As(h.translation,k)||(this.evaluate(h,h.featureStates,u,!0),r=!0)}}return r}updateReplacement(r,s,u,h){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;const g=s.getReplacementRegionsForTile(r.toUnwrapped(),!0);if(Kw(this.activeReplacements,g))return!1;this.activeReplacements=g;let y=!1;for(const b in this.instancesPerModel){const T=this.instancesPerModel[b],E=T.instancedDataArray;for(const k of T.features){const P=k.instancedDataOffset,R=k.instancedDataCount;for(let L=0;L<R;L++){const z=16*(L+P);let W=E.float32[z+0];const J=W>Vt;W=J?W-Vt:W;const te=Math.floor(W),ae=Math.floor(E.float32[z+1]);let ue=!1;for(const he of this.activeReplacements)if(!XR(he,u,lD.Model,h)&&!(he.min.x>te||te>he.max.x||he.min.y>ae||ae>he.max.y)&&(ue=VE(QR(te,ae,r.canonical,he.footprintTileId.canonical),he.footprint),ue))break;E.float32[z]=ue?W+Vt:W,y=y||ue!==J}}}return y}isEmpty(){for(const r in this.instancesPerModel)if(this.instancesPerModel[r].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(r){if(!this.uploaded)for(const s in this.instancesPerModel){const u=this.instancesPerModel[s];u.instancedDataArray.length<0||u.instancedDataArray.length===0||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=r.createVertexBuffer(u.instancedDataArray,jq.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const s in this.instancesPerModel){const u=this.instancesPerModel[s];u.instancedDataArray.length!==0&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}const r=this.layers[0].modelManager;if(r&&this.modelUris&&this.modelsRequested)for(const s of this.modelUris)r.removeModel(s,"",!0)}addFeature(r,s,u){const h=this.layers[0],g=h.layout.get("model-id").evaluate(u,{},this.canonical);if(!g)return Cr(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),g;(IC(g,!1)||this.styleDefinedModelURLs[g]!==void 0)&&(this.modelUris.includes(g)||this.modelUris.push(g)),this.instancesPerModel[g]||(this.instancesPerModel[g]=new uD);const y=this.instancesPerModel[g],b=y.instancedDataArray,T=new cD(u,b.length);for(const E of s)for(const k of E){if(k.x<0||k.x>=Vt||k.y<0||k.y>=Vt)continue;if(this.lookupDim!==0){const R=(this.lookupDim-1)/Vt,L=this.lookupDim*(k.y*R|0)+k.x*R|0;if(this.lookup){if(this.lookup[L]!==0)continue;this.lookup[L]=1}}this.instanceCount++;const P=b.length;b.resize(P+1),y.instancesEvaluatedElevation.push(0),b.float32[16*P]=k.x,b.float32[16*P+1]=k.y}return T.instancedDataCount=y.instancedDataArray.length-T.instancedDataOffset,T.instancedDataCount>0&&(r.id&&(y.idToFeaturesIndex[r.id]=y.features.length),y.features.push(T),this.evaluate(T,{},y,!1)),g}getModelUris(){return this.modelUris}evaluate(r,s,u,h){const g=this.layers[0],y=r.feature,b=this.canonical,T=r.rotation=g.paint.get("model-rotation").evaluate(y,s,b),E=r.scale=g.paint.get("model-scale").evaluate(y,s,b),k=r.translation=g.paint.get("model-translation").evaluate(y,s,b),P=Object.assign({},g.paint.get("model-color").evaluate(y,s,b));P.a=g.paint.get("model-color-mix-intensity").evaluate(y,s,b);const R=[];this.maxVerticalOffset<k[2]&&(this.maxVerticalOffset=k[2]);const L=k[0]*k[0]+k[1]*k[1],z=L>0?Math.sqrt(L):0;u.maxScale=Math.max(Math.max(u.maxScale,E[0]),Math.max(E[1],E[2])),u.maxXYTranslationDistance=Math.max(u.maxXYTranslationDistance,z),this.maxScale=Math.max(Math.max(this.maxScale,E[0]),Math.max(E[1],E[2])),FM(R,T,E);const W=Math.round(100*P.a)+P.b/1.05;for(let J=0;J<r.instancedDataCount;++J){const te=r.instancedDataOffset+J,ae=16*te,ue=u.instancedDataArray.float32;let he=0;h&&(he=ue[ae+6]-u.instancesEvaluatedElevation[te]);const Ce=0|ue[ae+1];ue[ae]=(0|ue[ae])+P.r/1.05,ue[ae+1]=Ce+P.g/1.05,ue[ae+2]=W,ue[ae+3]=1/(b.z>10?this.tileToMeter:Ie(b,Ce)),ue[ae+4]=k[0],ue[ae+5]=k[1],ue[ae+6]=k[2]+he,ue[ae+7]=R[0],ue[ae+8]=R[1],ue[ae+9]=R[2],ue[ae+10]=R[4],ue[ae+11]=R[5],ue[ae+12]=R[6],ue[ae+13]=R[8],ue[ae+14]=R[9],ue[ae+15]=R[10],u.instancesEvaluatedElevation[te]=k[2]}}}let dD,hD;or(kC,"ModelBucket",{omit:["layers"]}),or(uD,"PerModelAttributes"),or(cD,"ModelFeature");class f_{constructor(r,s,u){this._demTile=r,this._dem=this._demTile.dem,this._scale=s,this._offset=u}static create(r,s,u){const h=u||r.findDEMTileFor(s);if(!h||!h.dem)return;const g=h.dem,y=h.tileID,b=1<<s.canonical.z-y.canonical.z;return new f_(h,g.dim/Vt/b,[(s.canonical.x/b-y.canonical.x)*g.dim,(s.canonical.y/b-y.canonical.y)*g.dim])}tileCoordToPixel(r,s){const u=s*this._scale+this._offset[1];return new wt(Math.floor(r*this._scale+this._offset[0]),Math.floor(u))}getElevationAt(r,s,u,h){const g=r*this._scale+this._offset[0],y=s*this._scale+this._offset[1],b=Math.floor(g),T=Math.floor(y),E=this._dem;return h=!!h,u?Br(Br(E.get(b,T,h),E.get(b,T+1,h),y-T),Br(E.get(b+1,T,h),E.get(b+1,T+1,h),y-T),g-b):E.get(b,T,h)}getElevationAtPixel(r,s,u){return this._dem.get(r,s,!!u)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*ce(1,r)*this._dem.stride}}const PC=new Float32Array(262144),Jp=new Uint8Array(262144);function fD(a){let r=0;if(a.meshes)for(const s of a.meshes)r=Math.max(r,s.aabb.max[2]);if(a.children)for(const s of a.children)r=Math.max(r,fD(s));return r}function pD(a,r,s){if(a.meshes)for(const u of a.meshes){if(u.aabb.min[0]===1/0)continue;const h=dn.applyTransform(u.aabb,a.globalMatrix);s.insert(r,h.min[0],h.min[1],h.max[0],h.max[1])}if(a.children)for(const u of a.children)pD(u,r,s)}const mD=["","wall","door","roof","window","lamp","logo"];class gD{constructor(r){this.node=r,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:r.id,geometry:[],properties:{height:fD(r)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new dn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let r=0;const s=new dn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const u of this.node.meshes)this.node.lightMeshIndex!==r&&(u.transformedAabb=dn.applyTransformFast(u.aabb,this.node.globalMatrix),s.encapsulate(u.transformedAabb)),r++;this.aabb=s}return this.aabb}}class A1{constructor(r,s,u,h,g,y,b,T){this.id=u,this.layers=r,this.layerIds=this.layers.map(E=>E.fqid),this.stateDependentLayerIds=this.layers.filter(E=>E.isStateDependent()).map(E=>E.id),this.modelTraits|=i_.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,h&&(this.modelTraits|=i_.HasMapboxMeshFeatures),g&&(this.modelTraits|=i_.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=y,this.worldview=T,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const E of s)this.nodesInfo.push(new gD(E)),pD(E,b.featureIndexArray.length,b.grid),b.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,b.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(r,s){for(const u of this.getNodesInfo()){const h=u.node;h.footprint&&s.push({footprint:h.footprint,id:r})}}updateAppearances(r,s,u,h){}update(r){const s=Object.keys(r).length!==0;if(s&&!this.stateDependentLayers.length)return;const u=s?this.stateDependentLayers:this.layers;if(!jo(r,this.states))for(const h of u)this.evaluate(h,r);this.states=structuredClone(r)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(r){if(!this.needsUpload)return;const s=this.getNodesInfo();for(const u of s){const h=u.node;this.uploaded?this.updatePbrBuffer(h):rC(h,r,!0)}for(const u of s)l1(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(r){let s=!1;if(!r.meshes)return s;for(const u of r.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),s=!0);return s}needsReEvaluation(r,s,u){const h=r.transform.projectionOptions,g=r.style.getBrightness(),y=this.brightness!==g;if(!this.uploaded||this.dirty||h.name!==this.projection.name||Kx(u.paint.get("model-color").value,y)||Kx(u.paint.get("model-color-mix-intensity").value,y)||Kx(u.paint.get("model-roughness").value,y)||Kx(u.paint.get("model-emissive-strength").value,y)||Kx(u.paint.get("model-height-based-emissive-strength-multiplier").value,y)){this.projection=h,this.brightness=g;const b=this.getNodesInfo();for(const T of b)T.state=null;return!0}return!1}evaluateTransform(r,s){if(r.transform.zoom===this.zoom)return;this.zoom=r.transform.zoom;const u=this.getNodesInfo(),h=this.id.canonical;for(const g of u){const y=g.feature;g.evaluatedTranslation=s.paint.get("model-translation").evaluate(y,{},h),g.evaluatedScale=s.paint.get("model-scale").evaluate(y,{},h)}}evaluate(r,s){const u=this.getNodesInfo();for(const h of u){if(!h.node.meshes)continue;const g=h.feature,y=s&&s[g.id];if(jo(y,h.state))continue;h.state=structuredClone(y);const b=h.node.meshes&&h.node.meshes[0].featureData,T=h.evaluatedColor[2],E=h.evaluatedRMEA[2],k=this.id.canonical;if(h.hasTranslucentParts=!1,b){for(let P=0;P<mD.length;P++){const R=mD[P];R.length&&(g.properties.part=R);const L=r.paint.get("model-color").evaluate(g,y,k).toPremultipliedRenderColor(null),z=r.paint.get("model-color-mix-intensity").evaluate(g,y,k);h.evaluatedColor[P]=[L.r,L.g,L.b,z],h.evaluatedRMEA[P][0]=r.paint.get("model-roughness").evaluate(g,y,k),h.evaluatedRMEA[P][2]=r.paint.get("model-emissive-strength").evaluate(g,y,k),h.evaluatedRMEA[P][3]=L.a,h.emissionHeightBasedParams[P]=r.paint.get("model-height-based-emissive-strength-multiplier").evaluate(g,y,k),!h.hasTranslucentParts&&L.a<1&&(h.hasTranslucentParts=!0)}delete g.properties.part,nH(h,T!==h.evaluatedColor[2]||E!==h.evaluatedRMEA[2],this.modelTraits)}else h.evaluatedRMEA[0][2]=r.paint.get("model-emissive-strength").evaluate(g,y,k);h.evaluatedTranslation=r.paint.get("model-translation").evaluate(g,y,k),h.evaluatedScale=r.paint.get("model-scale").evaluate(g,y,k),this.updatePbrBuffer(h.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(r,s,u,h){const g=r.findDEMTileFor(u);if(g&&(g.tileID.canonical!==this.terrainTile||s!==this.terrainExaggeration)){if(g.dem&&g.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=g.tileID.overscaledZ;const y=f_.create(r,u,g);if(!y)return;this.modelTraits&i_.HasMapboxMeshFeatures&&this.updateDEM(r,y,u,h);for(const b of this.getNodesInfo()){const T=b.node;if(!T.footprint||!T.footprint.vertices||!T.footprint.vertices.length)continue;const E=T.footprint.vertices;let k=y.getElevationAt(E[0].x,E[0].y,!0,!0);for(let P=1;P<E.length;P++)k=Math.min(k,y.getElevationAt(E[P].x,E[P].y,!0,!0));T.elevation=k}}this.terrainTile=g.tileID.canonical,this.terrainExaggeration=s}}updateDEM(r,s,u,h){let g=s._dem._modifiedForSources[h];if(g===void 0&&(s._dem._modifiedForSources[h]=[],g=s._dem._modifiedForSources[h]),g.includes(u.canonical))return;const y=s._dem.dim;g.push(u.canonical);let b=!1;for(const T of this.getNodesInfo()){const E=T.node;if(!E.footprint||!E.footprint.grid)continue;const k=E.footprint.grid,P=s.tileCoordToPixel(k.min.x,k.min.y),R=s.tileCoordToPixel(k.max.x,k.max.y),L=Math.min(Math.min(y-R.y,P.x),Math.min(P.y,y-R.x));if(L<0)continue;const z=se(L,2,5);let W=Math.max(0,P.x-z),J=Math.max(0,P.y-z),te=Math.min(R.x+z,y-1),ae=Math.min(R.y+z,y-1);for(let be=J;be<=ae;++be)for(let ke=W;ke<=te;++ke)Jp[be*y+ke]=255;let ue=0,he=0;for(let be=0;be<k.cellsY;++be)for(let ke=0;ke<k.cellsX;++ke){if(!k.cells[be*k.cellsX+ke])continue;const Me=s.tileCoordToPixel(k.min.x+ke/k.xScale,k.min.y+be/k.yScale),ze=s.tileCoordToPixel(k.min.x+(ke+1)/k.xScale,k.min.y+(be+1)/k.yScale);for(let ct=Me.y;ct<=Math.min(ze.y+1,y-1);++ct)for(let We=Me.x;We<=Math.min(ze.x+1,y-1);++We)Jp[ct*y+We]===255&&(Jp[ct*y+We]=0,ue+=s.getElevationAtPixel(We,ct),he++)}const Ce=ue/he;W=Math.max(1,P.x-z),J=Math.max(1,P.y-z),te=Math.min(R.x+z,y-2),ae=Math.min(R.y+z,y-2),b=!0;for(let be=J;be<=ae;++be)for(let ke=W;ke<=te;++ke)Jp[be*y+ke]===0&&(PC[be*y+ke]=s._dem.set(ke,be,Ce));for(let be=1;be<z;++be){W=Math.max(1,P.x-be),J=Math.max(1,P.y-be),te=Math.min(R.x+be,y-2),ae=Math.min(R.y+be,y-2);for(let ke=J;ke<=ae;++ke)for(let Me=W;Me<=te;++Me){const ze=ke*y+Me;if(Jp[ze]===255){let ct=0,We=0,ut=-1,gt=-1;for(let St=-1;St<=1;++St)for(let Lt=-1;Lt<=1;++Lt){const kt=(ke+St)*y+Me+Lt;if(Jp[kt]>=be)continue;const _t=PC[kt],It=Math.abs(_t);It>We&&(ct=_t,We=It,ut=Lt,gt=St)}if(We>.1){const St=1-(be+.5*Math.abs(ut*gt))/z;let Lt=s._dem.get(Me,ke)+ct*St;const kt=s._dem.get(Me+ut,ke+gt),_t=s._dem.get(Me-ut,ke-gt,!0);(Lt-kt)*(Lt-_t)>0&&(Lt=(kt+_t)/2),PC[ze]=s._dem.set(Me,ke,Lt),Jp[ze]=be}}}}}b&&(s._demTile.needsDEMTextureUpload=!0,s._dem._timestamp=pa.now())}setFilter(r){this.filter=r?Ng(r):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(r=>this.filter.filter(new Ai(this.id.overscaledZ,{worldview:this.worldview}),r.feature,this.id.canonical)):this.nodesInfo}destroy(){const r=this.getNodesInfo();for(const s of r)l1(s.node),nC(s.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(r,s){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const u=s.getReplacementRegionsForTile(r.toUnwrapped());for(const h of this.getNodesInfo()){const g=h.node.footprint;h.hiddenByReplacement=!!g&&!u.find(y=>y.footprint===g)}}getHeightAtTileCoord(r,s){const u=[],h=[0,0,0],g=Z([]);for(const y of this.getNodesInfo()){const b=y.node.meshes[0],T=b.transformedAabb;if(r<T.min[0]||s<T.min[1]||r>T.max[0]||s>T.max[1])continue;if(y.node.hidden===!0)return{height:1/0,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};Q(g,y.node.globalMatrix),h[0]=r,h[1]=s,hn(h,h,g);const E=(h[0]-b.aabb.min[0])/(b.aabb.max[0]-b.aabb.min[0])*Xp|0,k=Math.min(63,(h[1]-b.aabb.min[1])/(b.aabb.max[1]-b.aabb.min[1])*Xp|0)*Xp+Math.min(63,E),P=b.heightmap[k];if(!(P<0&&y.node.footprint))return y.hiddenByReplacement?void 0:{height:P,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};if(y.node.footprint.grid.query(new wt(r,s),new wt(r,s),u),u.length>0)return{height:void 0,maxHeight:y.feature.properties.height,hidden:y.hiddenByReplacement,verticalScale:y.evaluatedScale[2]}}}}function Kx(a,r){return a instanceof Np&&!a.isLightConstant&&r}function rH(a,r,s,u,h,g,y,b){let T=(61440&r|(61440&r)>>4)>>8,E=(3840&r|(3840&r)>>4)>>4,k=240&r|(240&r)>>4;s[3]>0&&(T=Br(T,255*s[0],s[3]),E=Br(E,255*s[1],s[3]),k=Br(k,255*s[2],s[3]));const P=T<<8|E,R=k<<8|Math.floor(255*u[3]),L=function(be){const ke=se(be,0,2);return Math.min(Math.round(.5*ke*255),255)}(u[2])<<8|15*u[0]<<4|15*u[1],z=se(h[0],0,1),W=se(h[1],0,1),J=se(h[2],0,1),te=se(h[3],0,1);let ae,ue,he,Ce;if(z!==W&&y!==g&&W!==z){const be=y-g;ue=1/(be*(W-z)),he=-(g+be*z)/(be*(W-z));const ke=se(h[4],-1,1);Ce=Math.pow(10,ke),ae=255*J<<8|255*te}else ae=65535,ue=0,he=1,Ce=1;if(a.emplaceBack(P,R,L,ae,ue,he,Ce),b){const be=b.length;b.clear();for(let ke=0;ke<be;ke++)b.emplaceBack(P,R,L,ae,ue,he,Ce)}}function nH(a,r,s){const u=a.node;let h=0;const g=s&i_.HasMeshoptCompression;for(const y of u.meshes){if(u.lights&&u.lightMeshIndex===h||!y.featureData)continue;y.featureArray=new Oh,y.featureArray.reserve(y.featureData.length);let b=r;for(const T of y.featureData){const E=g?65535&T:T>>16&65535,k=g?T>>16&65535:65535&T,P=(15&k)<8?15&k:0,R=a.evaluatedRMEA[P],L=a.evaluatedColor[P],z=a.emissionHeightBasedParams[P];let W;if(b&&P===2&&u.lights&&(W=new Oh,W.resize(10*u.lights.length)),rH(y.featureArray,E,L,R,z,y.aabb.min[2],y.aabb.max[2],W),W&&b){b=!1;const J=u.meshes[u.lightMeshIndex];J.featureArray=W,J.featureArray._trim()}}y.featureArray._trim(),h++}}or(A1,"Tiled3dModelBucket",{omit:["layers"]}),or(gD,"Tiled3dModelFeature");const iH=["id","tile","layer","source","sourceLayer","state"];class Qp{constructor(r,s,u,h,g){this.type="Feature",this._vectorTileFeature=r,this._z=s,this._x=u,this._y=h,this.properties=r?r.properties:{},this.id=g}clone(){const r=new Qp(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(r.state=Object.assign({},this.state)),this.layer&&(r.layer=Object.assign({},this.layer)),this.source&&(r.source=this.source),this.sourceLayer&&(r.sourceLayer=this.sourceLayer),r}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const s of iH)this[s]!==void 0&&(r[s]=this[s]);return r}}class em extends Ic{constructor(r,s,u,h){super(),this.id=r,this.type="model",this.models=[],this._loaded=!1,this._options=s,this._modelsInfo=new Map}load(){const r=[];for(const s in this._options.models){const u=this._options.models[s],h=this._modelsInfo.get(s);if(h){const g=h.model;g.position=u.position!=null?new B(u.position[0],u.position[1]):new B(0,0),g.orientation=u.orientation!=null?u.orientation:[0,0,0],h.modelSpec=u,em.applyModelSpecification(g,u),g.computeBoundsAndApplyParent(),this.models.push(g)}else{const g=DM(this.map._requestManager.transformRequest(u.uri,ad.Model).url).then(y=>{if(!y)return;const b=sC(y),T=new BM(s,u.uri,u.position,u.orientation,b);em.applyModelSpecification(T,u),T.computeBoundsAndApplyParent(),this.models.push(T),this._modelsInfo.set(s,{modelSpec:u,model:T})}).catch(y=>{this.fire(new fp(new Error(`Could not load model ${s} from ${u.uri}: ${y.message}`)))});r.push(g)}}Promise.allSettled(r).then(()=>{this._loaded=!0,this.fire(new ka("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(s=>{this._loaded=!0,this.fire(new fp(new Error(`Could not load models: ${s.message}`)))})}static applyModelSpecification(r,s){s.nodeOverrides&&em.convertNodeOverrides(r,s.nodeOverrides),s.materialOverrides&&em.convertMaterialOverrides(r,s.materialOverrides),s.nodeOverrideNames&&(r.nodeOverrideNames=[...s.nodeOverrideNames]),s.materialOverrideNames&&(r.materialOverrideNames=[...s.materialOverrideNames]),s.featureProperties&&(r.featureProperties=s.featureProperties)}static convertNodeOverrides(r,s){if(Array.isArray(s)&&s.every(u=>typeof u=="string")){r.nodeOverrideNames=[];for(const u of s)r.nodeOverrideNames.push(u)}else Object.entries(s).forEach(([u,h])=>{const g={orientation:[0,0,0]};if(h.hasOwnProperty("orientation")){const y=h.orientation;y&&(g.orientation=y)}r.nodeOverrides.set(u,g)})}static convertMaterialOverrides(r,s){if(Array.isArray(s)&&s.every(u=>typeof u=="string")){r.materialOverrideNames=[];for(const u of s)r.materialOverrideNames.push(u)}else Object.entries(s).forEach(([u,h])=>{const g={color:new ri(1,1,1),colorMix:0,emissionStrength:0,opacity:1},y=h["model-color"];y!==void 0&&(g.color.r=y[0],g.color.g=y[1],g.color.b=y[2]);const b=h["model-color-mix-intensity"];b!==void 0&&(g.colorMix=b);const T=h["model-emissive-strength"];T!==void 0&&(g.emissionStrength=T);const E=h["model-opacity"];E!==void 0&&(g.opacity=E),r.materialOverrides.set(u,g)})}onAdd(r){this.map=r,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(r,s){}serialize(){return this._options}setProperty(r,s){return!1}reload(){const r=xd(this.id,this.scope);this.map.style.clearSource(r),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(r){this.models=[];const s=new Map;for(const u in r){const h=r[u];if(this._modelsInfo.has(u)){const g=this._modelsInfo.get(u);g&&g.modelSpec.uri===h.uri&&s.set(u,g)}}this._modelsInfo=s,this._options.models=r,this._loaded=!1,this.load()}}function RC(a,r,s,u){const h=1<<a.z;r.lat=de((u/Vt+a.y)/h),r.lng=me((s/Vt+a.x)/h)}function sH(a,r,s,u){const h=a.getNodesInfo()[r];if(!h||h.hiddenByReplacement||!h.node.meshes)return;let g=Number.MAX_VALUE;const y=h.node,b=s.tile,T=u.calculatePosMatrix(b.tileID.toUnwrapped(),u.worldSize),E=h.evaluatedScale;let k=0;u.elevation&&y.elevation&&(k=y.elevation*u.elevation.exaggeration()),K(T,T,[(y.anchor?y.anchor[0]:0)*(E[0]-1),(y.anchor?y.anchor[1]:0)*(E[1]-1),k]),ne(T,T,E);const P=s.queryGeometry,R=P.isPointQuery()?P.screenBounds:P.screenGeometry,L=function(W){const J=H([],T,W.globalMatrix);H(J,u.expandedFarZProjMatrix,J);for(let te=0;te<W.meshes.length;++te){const ae=W.meshes[te];if(te===W.lightMeshIndex)continue;const ue=tC(R,u,J,ae.aabb);ue!=null&&(g=Math.min(ue,g))}if(W.children)for(const te of W.children)L(te)};if(L(y),g===Number.MAX_VALUE)return;const z=new B(0,0);return RC(b.tileID.canonical,z,h.node.anchor[0],h.node.anchor[1]),{intersectionZ:g,position:z,feature:h.feature}}const oH={circle:class extends $o{constructor(a,r,s,u){super(a,{layout:Bc||(Bc=new is({"circle-sort-key":new Qt(He.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Rt(He.layout_circle["circle-elevation-reference"]),visibility:new Rt(He.layout_circle.visibility)})),paint:Fh||(Fh=new is({"circle-radius":new Qt(He.paint_circle["circle-radius"]),"circle-color":new Qt(He.paint_circle["circle-color"]),"circle-blur":new Qt(He.paint_circle["circle-blur"]),"circle-opacity":new Qt(He.paint_circle["circle-opacity"]),"circle-translate":new Rt(He.paint_circle["circle-translate"]),"circle-translate-anchor":new Rt(He.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Rt(He.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Rt(He.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Qt(He.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Qt(He.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Qt(He.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Rt(He.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},r,s,u)}createBucket(a){return new Gi(a)}queryRadius(a){const r=a;return io("circle-radius",this,r)+io("circle-stroke-width",this,r)+ts(this.paint.get("circle-translate"))}queryIntersectsFeature(a,r,s,u,h,g,y,b){const T=zh(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(r,s)+this.paint.get("circle-stroke-width").evaluate(r,s);return wR(a,u,g,y,b,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",T,E)}getProgramIds(){return["circle"]}getDefaultProgramParams(a,r,s){const u=bR(this);return{config:new Fc(this,{zoom:r,lut:s}),defines:u,overrideFog:!1}}is3D(a){return!a&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends $o{createBucket(a){return new TR(a)}constructor(a,r,s,u){super(a,{layout:ER||(ER=new is({visibility:new Rt(He.layout_heatmap.visibility)})),paint:CR||(CR=new is({"heatmap-radius":new Qt(He.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Qt(He.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Rt(He.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ch(He.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Rt(He.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},r,s,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=yx({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(a){return io("heatmap-radius",this,a)}queryIntersectsFeature(a,r,s,u,h,g,y,b){const T=this.paint.get("heatmap-radius").evaluate(r,s);return wR(a,u,g,y,b,!0,!0,new wt(0,0),T)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(a,r,s){return a==="heatmap"?{config:new Fc(this,{zoom:r,lut:s}),overrideFog:!1}:{}}},hillshade:class extends $o{constructor(a,r,s,u){super(a,{layout:AR||(AR=new is({visibility:new Rt(He.layout_hillshade.visibility)})),paint:jR||(jR=new is({"hillshade-illumination-direction":new Rt(He.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Rt(He.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Rt(He.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Rt(He.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Rt(He.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Rt(He.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Rt(He.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},r,s,u)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(a,r,s){return{overrideFog:!1}}},fill:class extends $o{constructor(a,r,s,u){super(a,{layout:$R||($R=new is({"fill-sort-key":new Qt(He.layout_fill["fill-sort-key"]),visibility:new Rt(He.layout_fill.visibility),"fill-elevation-reference":new Rt(He.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Qt(He.layout_fill["fill-construct-bridge-guard-rail"])})),paint:qR||(qR=new is({"fill-antialias":new Rt(He.paint_fill["fill-antialias"]),"fill-opacity":new Qt(He.paint_fill["fill-opacity"]),"fill-color":new Qt(He.paint_fill["fill-color"]),"fill-outline-color":new Qt(He.paint_fill["fill-outline-color"]),"fill-translate":new Rt(He.paint_fill["fill-translate"]),"fill-translate-anchor":new Rt(He.paint_fill["fill-translate-anchor"]),"fill-pattern":new Qt(He.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Rt(He.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Rt(He.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Qt(He.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Qt(He.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Qt(He.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},r,s,u)}getProgramIds(){const a=this.paint.get("fill-pattern"),r=a&&a.constantOr(1),s=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getDefaultProgramParams(a,r,s){return{config:new Fc(this,{zoom:r,lut:s}),overrideFog:!1}}recalculate(a,r){super.recalculate(a,r);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new zE(a)}queryRadius(){return ts(this.paint.get("fill-translate"))}queryIntersectsFeature(a,r,s,u,h,g){return!a.queryGeometry.isAboveHorizon&&ss(La(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),u)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(a){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const r=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return a!=null?r&&!a:r}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends $o{constructor(a,r,s,u){super(a,{layout:mM||(mM=new is({visibility:new Rt(He["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Rt(He["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:gM||(gM=new is({"fill-extrusion-opacity":new Rt(He["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Qt(He["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Rt(He["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Rt(He["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Qt(He["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Rt(He["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Qt(He["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Qt(He["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Rt(He["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Rt(He["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Rt(He["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Rt(He["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Rt(He["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Rt(He["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Rt(He["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Rt(He["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Rt(He["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Rt(He["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Qt(He["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Qt(He["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Rt(He["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Rt(He["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Rt(He["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Rt(He["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Qt(He["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Qt(He["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Rt(He["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},r,s,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new Jw(a)}queryRadius(){return ts(this.paint.get("fill-extrusion-translate"))}is3D(a){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(a,r,s,u,h,g,y,b,T){const E=zh(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),k=this.paint.get("fill-extrusion-height").evaluate(r,s),P=this.paint.get("fill-extrusion-base").evaluate(r,s),R=[0,0],L=b&&g.elevation,z=g.elevation?g.elevation.exaggeration():1,W=a.tile.getBucket(this);if(L&&W instanceof Jw){const he=W.centroidVertexArray,Ce=T+1;Ce<he.length&&(R[0]=he.geta_centroid_pos0(Ce),R[1]=he.geta_centroid_pos1(Ce))}if(R[0]===0&&R[1]===1)return!1;g.projection.name==="globe"&&(u=pM([u],[new wt(0,0),new wt(Vt,Vt)],a.tileID.canonical).map(he=>he.polygon).flat());const J=L?b:null,[te,ae]=SM(g,u,P,k,E,y,J,R,z,g.center.lat,a.tileID.canonical),ue=a.queryGeometry;return wM(te,ae,ue.isPointQuery()?ue.screenBounds:ue.screenGeometry)}},building:class extends $o{constructor(a,r,s,u){super(a,{layout:ZM||(ZM=new is({visibility:new Rt(He.layout_building.visibility),"building-facade":new Qt(He.layout_building["building-facade"]),"building-facade-floors":new Qt(He.layout_building["building-facade-floors"]),"building-facade-unit-width":new Qt(He.layout_building["building-facade-unit-width"]),"building-facade-window":new Qt(He.layout_building["building-facade-window"]),"building-roof-shape":new Qt(He.layout_building["building-roof-shape"]),"building-height":new Qt(He.layout_building["building-height"]),"building-base":new Qt(He.layout_building["building-base"]),"building-flood-light-wall-radius":new Qt(He.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Qt(He.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Qt(He.layout_building["building-flip-roof-orientation"])})),paint:XM||(XM=new is({"building-opacity":new Rt(He.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Rt(He.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Rt(He.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Rt(He.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Rt(He.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Rt(He.paint_building["building-vertical-scale"]),"building-cast-shadows":new Rt(He.paint_building["building-cast-shadows"]),"building-color":new Qt(He.paint_building["building-color"]),"building-emissive-strength":new Qt(He.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Rt(He.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Rt(He.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new Rt(He.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new Rt(He.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new Rt(He.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},r,s,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new WM(a)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(a){return!0}queryRadius(a){return 0}queryIntersectsFeature(a,r,s,u,h,g,y,b,T){let E=this.layout.get("building-height").evaluate(r,s);const k=this.layout.get("building-base").evaluate(r,s),P=a.tile.getBucket(this).getFootprint(r);if(P){if(P.hiddenFlags!==0)return!1;E=P.height}const[R,L]=SM(g,u,k,E,new wt(0,0),y,null,[0,0],1,g.center.lat,a.tileID.canonical),z=a.queryGeometry;return wM(R,L,z.isPointQuery()?z.screenBounds:z.screenGeometry)}},line:class extends $o{constructor(a,r,s,u){const h=sN();super(a,h,r,s,u),h.layout&&(this.layout=new vd(h.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof jp,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(a,r){super.recalculate(a,r),this.paint._values["line-floorwidth"]=(()=>{if(Dx)return Dx;const s=sN();return Dx=new rG(s.paint.properties["line-width"].specification),Dx.useIntegerZoom=!0,Dx})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new aC(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(a,r,s){const u=nN(this);return{config:new Fc(this,{zoom:r,lut:s}),defines:u,overrideFog:!1}}queryRadius(a){const r=a,s=oN(io("line-width",this,r),io("line-gap-width",this,r)),u=io("line-offset",this,r);return s/2+Math.abs(u)+ts(this.paint.get("line-translate"))}queryIntersectsFeature(a,r,s,u,h,g){if(a.queryGeometry.isAboveHorizon)return!1;const y=La(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),b=a.pixelToTileUnitsFactor/2*oN(this.paint.get("line-width").evaluate(r,s),this.paint.get("line-gap-width").evaluate(r,s)),T=this.paint.get("line-offset").evaluate(r,s);return T&&(u=function(E,k){const P=[],R=new wt(0,0);for(let L=0;L<E.length;L++){const z=E[L],W=[];for(let J=0;J<z.length;J++){const te=z[J],ae=z[J+1],ue=J===0?R:te.sub(z[J-1])._unit()._perp(),he=J===z.length-1?R:ae.sub(te)._unit()._perp(),Ce=ue._add(he)._unit();Ce._mult(1/(Ce.x*he.x+Ce.y*he.y)),W.push(Ce._mult(k)._add(te))}P.push(W)}return P}(u,T*a.pixelToTileUnitsFactor)),function(E,k,P){for(let R=0;R<k.length;R++){const L=k[R];if(E.length>=3){for(let z=0;z<L.length;z++)if(no(E,L[z]))return!0}if(aa(E,L,P))return!0}return!1}(y,u,b)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(a){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:S1,background:class extends $o{constructor(a,r,s,u){super(a,{layout:XN||(XN=new is({visibility:new Rt(He.layout_background.visibility)})),paint:KN||(KN=new is({"background-pitch-alignment":new Rt(He.paint_background["background-pitch-alignment"]),"background-color":new Rt(He.paint_background["background-color"]),"background-pattern":new Rt(He.paint_background["background-pattern"]),"background-opacity":new Rt(He.paint_background["background-opacity"]),"background-emissive-strength":new Rt(He.paint_background["background-emissive-strength"]),"background-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},r,s,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(a,r,s){return{overrideFog:!1}}is3D(a){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:tD,"raster-particle":aD,sky:class extends $o{constructor(a,r,s,u){super(a,{layout:iD||(iD=new is({visibility:new Rt(He.layout_sky.visibility)})),paint:sD||(sD=new is({"sky-type":new Rt(He.paint_sky["sky-type"]),"sky-atmosphere-sun":new Rt(He.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Rt(He.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Rt(He.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Rt(He.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ch(He.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Rt(He.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Rt(He.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Rt(He.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},r,s,u),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(a){a==="sky-gradient"?this._updateColorRamp():a!=="sky-atmosphere-sun"&&a!=="sky-atmosphere-halo-color"&&a!=="sky-atmosphere-color"&&a!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=yx({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}return!1}getCenter(a,r){if(this.paint.get("sky-type")==="atmosphere"){const u=this.paint.get("sky-atmosphere-sun"),h=!u,g=a.style.light,y=g.properties.get("position");return h&&g.properties.get("anchor")==="viewport"&&Cr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?jC(y.azimuthal,90-y.polar,r):jC(u[0],90-u[1],r)}const s=this.paint.get("sky-gradient-center");return jC(s[0],90-s[1],r)}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return a==="atmosphere"?["skyboxCapture","skybox"]:a==="gradient"?["skyboxGradient"]:null}},slot:class extends $o{constructor(a,r,s,u){super(a,{paint:oD||(oD=new is({}))},r,null)}},model:class extends $o{constructor(a,r,s,u){super(a,{layout:dD||(dD=new is({visibility:new Rt(He.layout_model.visibility),"model-id":new Qt(He.layout_model["model-id"])})),paint:hD||(hD=new is({"model-opacity":new Qt(He.paint_model["model-opacity"]),"model-rotation":new Qt(He.paint_model["model-rotation"]),"model-scale":new Qt(He.paint_model["model-scale"]),"model-translation":new Qt(He.paint_model["model-translation"]),"model-color":new Qt(He.paint_model["model-color"]),"model-color-mix-intensity":new Qt(He.paint_model["model-color-mix-intensity"]),"model-type":new Rt(He.paint_model["model-type"]),"model-cast-shadows":new Rt(He.paint_model["model-cast-shadows"]),"model-receive-shadows":new Rt(He.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Rt(He.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Qt(He.paint_model["model-emissive-strength"]),"model-roughness":new Qt(He.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Qt(He.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Rt(He.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Rt(He.paint_model["model-front-cutoff"]),"model-elevation-reference":new Rt(He.paint_model["model-elevation-reference"]),"model-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},r,s,u),this.layer=a,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new kC(a)}getProgramIds(){return["model"]}is3D(a){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(a){return a instanceof A1?Vt-1:0}queryRenderedFeatures(a,r,s){const u=r.getSource();if(!(u&&u instanceof em))return{};const h=u,g={};g[this.id]=[];const y=g[this.id];let b=0;for(const T of h.models){const E=r.getFeatureState(this.sourceLayer,T.id),k={type:"Unknown",id:T.id,properties:T.featureProperties},P=this.paint.get("model-rotation").evaluate(k,E),R=this.paint.get("model-scale").evaluate(k,E),L=this.paint.get("model-translation").evaluate(k,E),z=this.paint.get("model-elevation-reference");let W=[];a1(W,T,s,T.position,P,R,L,z==="ground",z==="ground",!1),s.projection.name==="globe"&&(W=o1(W,s));const J=H([],s.projMatrix,W),te=tC(a.isPointQuery()?a.screenBounds:a.screenGeometry,s,J,T.aabb);if(te!=null){const ae=new Qp(void 0,0,0,0,T.id);ae.layer=this.layer,ae.properties=structuredClone(T.featureProperties),ae.properties.layer=this.id,ae.properties.uri=T.uri,ae.properties.orientation=T.orientation,ae.sourceLayer=this.sourceLayer,ae.geometry={type:"Point",coordinates:[T.position.lng,T.position.lat]},ae.state=E,ae.source=this.source,y.push({featureIndex:b,feature:ae,intersectionZ:te})}++b}return g}queryIntersectsFeature(a,r,s,u,h,g){if(!this.modelManager)return!1;const y=this.modelManager,b=a.tile.getBucket(this);if(!(b&&b instanceof kC))return!1;for(const T in b.instancesPerModel){const E=b.instancesPerModel[T],k=r.id!==void 0?r.id:r.properties&&r.properties.hasOwnProperty("id")?r.properties.id:void 0;if(E.idToFeaturesIndex.hasOwnProperty(k)){const P=E.features[E.idToFeaturesIndex[k]],R=y.getModel(T,this.scope);if(!R)return!1;let L=[];const z=new B(0,0),W=b.canonical;let J=Number.MAX_VALUE;for(let te=0;te<P.instancedDataCount;++te){const ae=16*(P.instancedDataOffset+te),ue=E.instancedDataArray.float32,he=[ue[ae+4],ue[ae+5],ue[ae+6]];RC(W,z,Math.floor(ue[ae]),Math.floor(ue[ae+1])),a1(L,R,g,z,P.rotation,P.scale,he,!1,!1,!1),g.projection.name==="globe"&&(L=o1(L,g));const Ce=H([],g.projMatrix,L),be=a.queryGeometry,ke=tC(be.isPointQuery()?be.screenBounds:be.screenGeometry,g,Ce,R.aabb);ke!=null&&(J=Math.min(ke,J))}return J!==Number.MAX_VALUE&&J}}return!1}_handleOverridablePaintPropertyUpdate(a,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven()||a!=="model-color"&&a!=="model-color-mix-intensity"&&a!=="model-rotation"&&a!=="model-scale"&&a!=="model-translation"&&a!=="model-emissive-strength")}_isPropertyZoomDependent(a){const r=this._transitionablePaint._values[a];return r!=null&&r.value!=null&&r.value.expression!=null&&r.value.expression instanceof Eu}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends $o{constructor(a,r,s,u){super(a,{layout:GR||(GR=new is({"clip-layer-types":new Rt(He.layout_clip["clip-layer-types"]),"clip-layer-scope":new Rt(He.layout_clip["clip-layer-scope"])})),paint:HR||(HR=new is({}))},r,s,u)}recalculate(a,r){super.recalculate(a,r)}createBucket(a){return new WR(a)}is3D(a){return!0}}},MC=new ri(0,0,0),NC={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},DC={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},j1={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},aH={PAINT_ORDER_FILL_AND_STROKE:1},Yx={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},_D={MASK_TYPE_LUMINANCE:1};function lH(a,r,s){a===1&&r.icons.push(function(u,h){return function(g){if(g.usvg_tree.height||(g.usvg_tree.height=g.usvg_tree.width),!g.metadata)return g;const{metadata:y}=g;if(y.content_area){const{content_area:b}=y;b.left==null&&(b.left=0),b.top==null&&(b.top=b.left),b.width==null&&(b.width=g.usvg_tree.width),b.height==null&&(b.height=b.width)}if(y.text_placeholder){const{text_placeholder:b}=y;b.top==null&&(b.top=b.left),b.height==null&&(b.height=b.width)}return y.stretch_x&&y.stretch_x.length&&yD(y,"x"),y.stretch_y&&y.stretch_y.length&&yD(y,"y"),g}(u.readFields(cH,{name:void 0},h))}(s,s.readVarint()+s.pos))}function yD(a,r){const s=[],u=a[`stretch_${r}`];let h=null;for(let g=0;g<u.length;g++)h===null?h=s.length===0?u[0]:s[s.length-1][1]+u[g]:(s.push([h,h+u[g]]),h=null);a[`stretch_${r}_areas`]=s}function cH(a,r,s){a===1?r.name=s.readString():a===2?r.metadata=function(u,h){return u.readFields(uH,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},h)}(s,s.readVarint()+s.pos):a===3&&(r.usvg_tree=function(u,h){return u.readFields(fH,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},h)}(s,s.readVarint()+s.pos),r.data="usvg_tree")}function uH(a,r,s){a===1?r.stretch_x=s.readPackedVarint():a===2?r.stretch_y=s.readPackedVarint():a===3?r.content_area=vD(s,s.readVarint()+s.pos):a===4?r.variables.push(function(u,h){return u.readFields(hH,{name:void 0},h)}(s,s.readVarint()+s.pos)):a===5&&(r.text_placeholder=vD(s,s.readVarint()+s.pos))}function vD(a,r){return a.readFields(dH,{},r)}function dH(a,r,s){a===1?r.left=s.readVarint():a===2?r.width=s.readVarint():a===3?r.top=s.readVarint():a===4&&(r.height=s.readVarint())}function hH(a,r,s){a===1?r.name=s.readString():a===2&&(r.rgb_color=P1(s.readVarint()),r.value="rgb_color")}function fH(a,r,s){a===1?r.width=r.height=s.readVarint():a===2?r.height=s.readVarint():a===3?r.children.push(I1(s,s.readVarint()+s.pos)):a===4?r.linear_gradients.push(function(u,h){return u.readFields(xH,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},h)}(s,s.readVarint()+s.pos)):a===5?r.radial_gradients.push(function(u,h){return u.readFields(wH,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},h)}(s,s.readVarint()+s.pos)):a===7?r.clip_paths.push(function(u,h){return u.readFields(SH,{children:[]},h)}(s,s.readVarint()+s.pos)):a===8&&r.masks.push(function(u,h){const g=u.readFields(TH,{left:0,width:20,mask_type:_D.MASK_TYPE_LUMINANCE,children:[]},h);return g.height==null&&(g.height=g.width),g.top==null&&(g.top=g.left),g}(s,s.readVarint()+s.pos))}function I1(a,r){return a.readFields(pH,{},r)}function pH(a,r,s){a===1?(r.group=function(u,h){return u.readFields(mH,{opacity:255,children:[]},h)}(s,s.readVarint()+s.pos),r.node="group"):a===2&&(r.path=function(u,h){return u.readFields(_H,{paint_order:1,commands:[],step:1,diffs:[],rule:NC.PATH_RULE_NON_ZERO},h)}(s,s.readVarint()+s.pos),r.node="path")}function mH(a,r,s){a===1?r.transform=k1(s,s.readVarint()+s.pos):a===2?r.opacity=s.readVarint():a===5?r.clip_path_idx=s.readVarint():a===6?r.mask_idx=s.readVarint():a===7&&r.children.push(I1(s,s.readVarint()+s.pos))}function k1(a,r){return a.readFields(gH,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},r)}function gH(a,r,s){a===1?r.sx=s.readFloat():a===2?r.ky=s.readFloat():a===3?r.kx=s.readFloat():a===4?r.sy=s.readFloat():a===5?r.tx=s.readFloat():a===6&&(r.ty=s.readFloat())}function _H(a,r,s){a===1?r.fill=function(u,h){return u.readFields(yH,{rgb_color:MC,paint:"rgb_color",opacity:255},h)}(s,s.readVarint()+s.pos):a===2?r.stroke=function(u,h){return u.readFields(vH,{rgb_color:MC,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},h)}(s,s.readVarint()+s.pos):a===3?r.paint_order=s.readVarint():a===5?s.readPackedVarint(r.commands):a===6?r.step=s.readFloat():a===7?s.readPackedSVarint(r.diffs):a===8&&(r.rule=s.readVarint())}function yH(a,r,s){a===1?(r.rgb_color=P1(s.readVarint()),r.paint="rgb_color"):a===2?(r.linear_gradient_idx=s.readVarint(),r.paint="linear_gradient_idx"):a===3?(r.radial_gradient_idx=s.readVarint(),r.paint="radial_gradient_idx"):a===5&&(r.opacity=s.readVarint())}function P1(a){return new ri((a>>16&255)/255,(a>>8&255)/255,(255&a)/255,1)}function vH(a,r,s){a===1?(r.rgb_color=P1(s.readVarint()),r.paint="rgb_color"):a===2?(r.linear_gradient_idx=s.readVarint(),r.paint="linear_gradient_idx"):a===3?(r.radial_gradient_idx=s.readVarint(),r.paint="radial_gradient_idx"):a===5?s.readPackedFloat(r.dasharray):a===6?r.dashoffset=s.readFloat():a===7?r.miterlimit=s.readFloat():a===8?r.opacity=s.readVarint():a===9?r.width=s.readFloat():a===10?r.linecap=s.readVarint():a===11&&(r.linejoin=s.readVarint())}function xH(a,r,s){a===1?r.transform=k1(s,s.readVarint()+s.pos):a===2?r.spread_method=s.readVarint():a===3?r.stops.push(xD(s,s.readVarint()+s.pos)):a===4?r.x1=s.readFloat():a===5?r.y1=s.readFloat():a===6?r.x2=s.readFloat():a===7&&(r.y2=s.readFloat())}function xD(a,r){return a.readFields(bH,{offset:0,opacity:255,rgb_color:MC},r)}function bH(a,r,s){a===1?r.offset=s.readFloat():a===2?r.opacity=s.readVarint():a===3&&(r.rgb_color=P1(s.readVarint()))}function wH(a,r,s){a===1?r.transform=k1(s,s.readVarint()+s.pos):a===2?r.spread_method=s.readVarint():a===3?r.stops.push(xD(s,s.readVarint()+s.pos)):a===4?r.cx=s.readFloat():a===5?r.cy=s.readFloat():a===6?r.r=s.readFloat():a===7?r.fx=s.readFloat():a===8?r.fy=s.readFloat():a===9&&(r.fr=s.readFloat())}function SH(a,r,s){a===1?r.transform=k1(s,s.readVarint()+s.pos):a===2?r.clip_path_idx=s.readVarint():a===3&&r.children.push(I1(s,s.readVarint()+s.pos))}function TH(a,r,s){a===1?r.left=r.top=s.readFloat():a===2?r.width=r.height=s.readFloat():a===3?r.top=s.readFloat():a===4?r.height=s.readFloat():a===5?r.mask_type=s.readVarint():a===6?r.mask_idx=s.readVarint():a===7&&r.children.push(I1(s,s.readVarint()+s.pos))}class EH{static calculate(r={},s=[]){const u=new Map,h=new Map;if(Object.keys(r).length===0)return u;s.forEach(g=>{h.set(g.name,g.rgb_color||new ri(0,0,0))});for(const[g,y]of Object.entries(r))h.has(g)?u.set(h.get(g).toString(),y):console.warn(`Ignoring unknown image variable "${g}"`);return u}}function p_(a,r=255,s){const u=r/255,h=a.toString(),g=s.has(h)?s.get(h).clone():a.clone();return g.a*=u,g.toString()}function Jx(a,r){if(!fa()){const s=document.createElement("canvas");return s.width=a,s.height=r,s}return new OffscreenCanvas(a,r)}function CH(a,r){const s=EH.calculate(r.params,a.metadata?a.metadata.variables:[]),u=a.usvg_tree,h=u.width,g=u.height,y=r.transform?r.transform:new DOMMatrix,b=Math.max(1,Math.round(h*y.a)),T=Math.max(1,Math.round(g*y.d)),E=new DOMMatrix([b/h,0,0,T/g,0,0]),k=Jx(b,T).getContext("2d");return OC(k,E,u,u,s),k.getImageData(0,0,b,T)}function OC(a,r,s,u,h){for(const g of u.children)bD(a,r,s,g,h)}function bD(a,r,s,u,h){u.group?(a.save(),function(g,y,b,T,E){const k=T.mask_idx!=null?b.masks[T.mask_idx]:null,P=T.clip_path_idx!=null?b.clip_paths[T.clip_path_idx]:null;if(T.transform&&(y=m_(T.transform).preMultiplySelf(y)),!function(z,W,J){return z.opacity!==255||W||J}(T,P!=null,k!=null))return void OC(g,y,b,T,E);const R=Jx(g.canvas.width,g.canvas.height),L=R.getContext("2d");OC(L,y,b,T,E),P&&jD(L,y,b,P),k&&ID(L,y,b,k,E),g.globalAlpha=T.opacity/255,g.drawImage(R,0,0)}(a,r,s,u.group,h),a.restore()):u.path&&(a.save(),function(g,y,b,T,E){g.setTransform(y),T.paint_order===aH.PAINT_ORDER_FILL_AND_STROKE?(wD(g,b,T,E),TD(g,b,T,E)):(TD(g,b,T,E),wD(g,b,T,E))}(a,r,s,u.path,h),a.restore())}function wD(a,r,s,u){const h=s.fill;if(!h)return;const g=h.opacity/255;switch(a.save(),a.beginPath(),kD(s,a),h.paint){case"rgb_color":a.fillStyle=p_(h.rgb_color,h.opacity,u);break;case"linear_gradient_idx":{const y=r.linear_gradients[h.linear_gradient_idx];y.transform&&a.setTransform(m_(y.transform).preMultiplySelf(a.getTransform())),a.fillStyle=ED(a,y,g,u);break}case"radial_gradient_idx":{const y=r.radial_gradients[h.radial_gradient_idx];y.transform&&a.setTransform(m_(y.transform).preMultiplySelf(a.getTransform())),a.fillStyle=CD(a,y,g,u)}}a.fill(SD(s)),a.restore()}function SD(a){return a.rule===NC.PATH_RULE_NON_ZERO?"nonzero":a.rule===NC.PATH_RULE_EVEN_ODD?"evenodd":void 0}function TD(a,r,s,u){const h=s.stroke;if(!h)return;const g=PD(s);a.lineWidth=h.width,a.miterLimit=h.miterlimit,a.setLineDash(h.dasharray),a.lineDashOffset=h.dashoffset;const y=h.opacity/255;switch(h.paint){case"rgb_color":a.strokeStyle=p_(h.rgb_color,h.opacity,u);break;case"linear_gradient_idx":a.strokeStyle=ED(a,r.linear_gradients[h.linear_gradient_idx],y,u,!0);break;case"radial_gradient_idx":a.strokeStyle=CD(a,r.radial_gradients[h.radial_gradient_idx],y,u,!0)}switch(h.linejoin){case j1.LINE_JOIN_MITER_CLIP:case j1.LINE_JOIN_MITER:a.lineJoin="miter";break;case j1.LINE_JOIN_ROUND:a.lineJoin="round";break;case j1.LINE_JOIN_BEVEL:a.lineJoin="bevel"}switch(h.linecap){case DC.LINE_CAP_BUTT:a.lineCap="butt";break;case DC.LINE_CAP_ROUND:a.lineCap="round";break;case DC.LINE_CAP_SQUARE:a.lineCap="square"}a.stroke(g)}function ED(a,r,s,u,h=!1){if(r.stops.length===1){const R=r.stops[0];return p_(R.rgb_color,R.opacity*s,u)}const{x1:g,y1:y,x2:b,y2:T}=r;let E=new DOMPoint(g,y),k=new DOMPoint(b,T);if(h){const R=m_(r.transform);E=R.transformPoint(E),k=R.transformPoint(k)}const P=a.createLinearGradient(E.x,E.y,k.x,k.y);for(const R of r.stops)P.addColorStop(R.offset,p_(R.rgb_color,R.opacity*s,u));return P}function CD(a,r,s,u,h=!1){if(r.stops.length===1){const te=r.stops[0];return p_(te.rgb_color,te.opacity*s,u)}const g=m_(r.transform),{fx:y,fy:b,fr:T,cx:E,cy:k,r:P}=r;let R=new DOMPoint(y,b),L=new DOMPoint(E,k),z=T,W=P;if(h){R=g.transformPoint(R),L=g.transformPoint(L);const te=(g.a+g.d)/2;z=T*te,W=r.r*te}const J=a.createRadialGradient(R.x,R.y,z,L.x,L.y,W);for(const te of r.stops)J.addColorStop(te.offset,p_(te.rgb_color,te.opacity*s,u));return J}function AD(a,r,s,u){const h=u.transform?m_(u.transform).preMultiplySelf(r):r,g=Jx(a.canvas.width,a.canvas.height),y=g.getContext("2d");for(const T of u.children)if(T.group)AD(y,h,s,T.group);else if(T.path){const E=T.path,k=new Path2D;k.addPath(PD(E),h),y.fill(k,SD(E))}const b=u.clip_path_idx!=null?s.clip_paths[u.clip_path_idx]:null;b&&jD(y,h,s,b),a.globalCompositeOperation="source-over",a.drawImage(g,0,0)}function jD(a,r,s,u){const h=Jx(a.canvas.width,a.canvas.height);AD(h.getContext("2d"),r,s,u),a.globalCompositeOperation="destination-in",a.drawImage(h,0,0)}function ID(a,r,s,u,h){if(u.children.length===0)return;const g=u.mask_idx!=null?s.masks[u.mask_idx]:null;g&&ID(a,r,s,g,h);const y=a.canvas.width,b=a.canvas.height,T=Jx(y,b),E=T.getContext("2d"),k=u.width,P=u.height,R=u.left,L=u.top,z=new Path2D,W=new Path2D;W.rect(R,L,k,P),z.addPath(W,r),E.clip(z);for(const ae of u.children)bD(E,r,s,ae,h);const J=E.getImageData(0,0,y,b),te=J.data;if(u.mask_type===_D.MASK_TYPE_LUMINANCE)for(let ae=0;ae<te.length;ae+=4)te[ae+3]=te[ae+3]/255*(.2126*te[ae]+.7152*te[ae+1]+.0722*te[ae+2]);E.putImageData(J,0,0),a.globalCompositeOperation="destination-in",a.drawImage(T,0,0)}function m_(a){return a?new DOMMatrix([a.sx,a.ky,a.kx,a.sy,a.tx,a.ty]):new DOMMatrix}function kD(a,r){const s=a.step;let u=a.diffs[0]*s,h=a.diffs[1]*s;r.moveTo(u,h);for(let g=0,y=2;g<a.commands.length;g++)switch(a.commands[g]){case Yx.PATH_COMMAND_MOVE:u+=a.diffs[y++]*s,h+=a.diffs[y++]*s,r.moveTo(u,h);break;case Yx.PATH_COMMAND_LINE:u+=a.diffs[y++]*s,h+=a.diffs[y++]*s,r.lineTo(u,h);break;case Yx.PATH_COMMAND_QUAD:{const b=u+a.diffs[y++]*s,T=h+a.diffs[y++]*s;u=b+a.diffs[y++]*s,h=T+a.diffs[y++]*s,r.quadraticCurveTo(b,T,u,h);break}case Yx.PATH_COMMAND_CUBIC:{const b=u+a.diffs[y++]*s,T=h+a.diffs[y++]*s,E=b+a.diffs[y++]*s,k=T+a.diffs[y++]*s;u=E+a.diffs[y++]*s,h=k+a.diffs[y++]*s,r.bezierCurveTo(b,T,E,k,u,h);break}case Yx.PATH_COMMAND_CLOSE:r.closePath()}return r}function PD(a){return kD(a,new Path2D)}class R1{constructor(r){this.capacity=r,this.cache=new Map}get(r){if(!this.cache.has(r))return;const s=this.cache.get(r);return this.cache.delete(r),this.cache.set(r,s),s}put(r,s){this.cache.has(r)?this.cache.delete(r):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(r,s)}delete(r){this.cache.delete(r)}}or(R1,"LRUCache");class LC{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(r){return new Po(r,r.data)}getFromCache(r,s,u){return this.cacheMap.has(u)||this.cacheMap.set(u,new R1(150)),this.cacheMap.get(u).get(xd(r.toString(),s))}setInCache(r,s,u,h){this.cacheDependenciesMap.has(h)||this.cacheDependenciesMap.set(h,new Map),this.cacheMap.has(h)||this.cacheMap.set(h,new R1(150));const g=this.cacheDependenciesMap.get(h),y=xd(r.id.toString(),u);g.get(y)||g.set(y,new Set);const b=this.cacheMap.get(h),T=r.toString();g.get(y).add(T),b.put(xd(r.toString(),u),s)}removeImagesFromCacheByIds(r,s,u=0){if(!this.cacheMap.has(u)||!this.cacheDependenciesMap.has(u))return;const h=this.cacheMap.get(u),g=this.cacheDependenciesMap.get(u);for(const y of r){const b=xd(y.toString(),s);if(g.has(b)){for(const T of g.get(b))h.delete(T);g.delete(b)}}}rasterize(r,s,u,h,g=CH){const y=this.getFromCache(r,u,h);if(y)return y.clone();const b=g(s.icon,r.options),T=LC._getImage(b);return this.setInCache(r,T,u,h),T.clone()}}class RD{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,s){const u=this.toIdx(r,s);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(r,s){return this.leaves[this.toIdx(r,s)]}toIdx(r,s){return s*this.size+r}}function MD(a,r,s,u){let h=0,g=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(u[y])<1e-15){if(s[y]<a[y]||s[y]>r[y])return null}else{const b=1/u[y];let T=(a[y]-s[y])*b,E=(r[y]-s[y])*b;if(T>E){const k=T;T=E,E=k}if(T>h&&(h=T),E<g&&(g=E),h>g)return null}return h}function ND(a,r,s,u,h,g,y,b,T,E,k){const P=u-a,R=h-r,L=g-s,z=y-a,W=b-r,J=T-s,te=k[1]*J-k[2]*W,ae=k[2]*z-k[0]*J,ue=k[0]*W-k[1]*z,he=P*te+R*ae+L*ue;if(Math.abs(he)<1e-15)return null;const Ce=1/he,be=E[0]-a,ke=E[1]-r,Me=E[2]-s,ze=(be*te+ke*ae+Me*ue)*Ce;if(ze<0||ze>1)return null;const ct=ke*L-Me*R,We=Me*P-be*L,ut=be*R-ke*P,gt=(k[0]*ct+k[1]*We+k[2]*ut)*Ce;return gt<0||ze+gt>1?null:(z*ct+W*We+J*ut)*Ce}function DD(a,r,s){return(a-r)/(s-r)}function OD(a,r,s,u,h,g,y,b,T){const E=1<<s,k=g-u,P=y-h,R=(a+1)/E*k+u,L=(r+0)/E*P+h,z=(r+1)/E*P+h;b[0]=(a+0)/E*k+u,b[1]=L,T[0]=R,T[1]=z}class LD{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(g){const y=Math.ceil(Math.log2(g.dim/8)),b=[];let T=Math.ceil(Math.pow(2,y));const E=1/T,k=(L,z,W,J,te)=>{const ae=J?1:0,ue=(L+1)*W-ae,he=z*W,Ce=(z+1)*W-ae;te[0]=L*W,te[1]=he,te[2]=ue,te[3]=Ce};let P=new RD(T);const R=[];for(let L=0;L<T*T;L++){k(L%T,Math.floor(L/T),E,!1,R);const z=Hh(R[0],R[1],g),W=Hh(R[2],R[1],g),J=Hh(R[2],R[3],g),te=Hh(R[0],R[3],g);P.minimums.push(Math.min(z,W,J,te)),P.maximums.push(Math.max(z,W,J,te)),P.leaves.push(1)}for(b.push(P),T/=2;T>=1;T/=2){const L=b[b.length-1];P=new RD(T);for(let z=0;z<T*T;z++){k(z%T,Math.floor(z/T),2,!0,R);const W=L.getElevation(R[0],R[1]),J=L.getElevation(R[2],R[1]),te=L.getElevation(R[2],R[3]),ae=L.getElevation(R[0],R[3]),ue=L.isLeaf(R[0],R[1]),he=L.isLeaf(R[2],R[1]),Ce=L.isLeaf(R[2],R[3]),be=L.isLeaf(R[0],R[3]),ke=Math.min(W.min,J.min,te.min,ae.min),Me=Math.max(W.max,J.max,te.max,ae.max),ze=ue&&he&&Ce&&be;P.maximums.push(Me),P.minimums.push(ke),P.leaves.push(Me-ke<=5&&ze?1:0)}b.push(P)}return b}(this.dem),u=s.length-1,h=s[u];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(s,0,0,u,0)}raycastRoot(r,s,u,h,g,y,b=1){return MD([r,s,-100],[u,h,this.maximums[0]*b],g,y)}raycast(r,s,u,h,g,y,b=1){if(!this.nodeCount)return null;const T=this.raycastRoot(r,s,u,h,g,y,b);if(T==null)return null;const E=[],k=[],P=[],R=[],L=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;L.length>0;){const{idx:z,t:W,nodex:J,nodey:te,depth:ae}=L.pop();if(this.leaves[z]){OD(J,te,ae,r,s,u,h,P,R);const he=1<<ae,Ce=(J+0)/he,be=(J+1)/he,ke=(te+0)/he,Me=(te+1)/he,ze=Hh(Ce,ke,this.dem)*b,ct=Hh(be,ke,this.dem)*b,We=Hh(be,Me,this.dem)*b,ut=Hh(Ce,Me,this.dem)*b,gt=ND(P[0],P[1],ze,R[0],P[1],ct,R[0],R[1],We,g,y),St=ND(R[0],R[1],We,P[0],R[1],ut,P[0],P[1],ze,g,y),Lt=Math.min(gt!==null?gt:Number.MAX_VALUE,St!==null?St:Number.MAX_VALUE);if(Lt!==Number.MAX_VALUE)return Lt;{const kt=vt([],g,y,W);if(zD(ze,ct,ut,We,DD(kt[0],P[0],R[0]),DD(kt[1],P[1],R[1]))>=kt[2])return W}continue}let ue=0;for(let he=0;he<this._siblingOffset.length;he++){OD((J<<1)+this._siblingOffset[he][0],(te<<1)+this._siblingOffset[he][1],ae+1,r,s,u,h,P,R),P[2]=-100,R[2]=this.maximums[this.childOffsets[z]+he]*b;const Ce=MD(P,R,g,y);if(Ce!=null){const be=Ce;E[he]=be;let ke=!1;for(let Me=0;Me<ue&&!ke;Me++)be>=E[k[Me]]&&(k.splice(Me,0,he),ke=!0);ke||(k[ue]=he),ue++}}for(let he=0;he<ue;he++){const Ce=k[he];L.push({idx:this.childOffsets[z]+Ce,t:E[Ce],nodex:(J<<1)+this._siblingOffset[Ce][0],nodey:(te<<1)+this._siblingOffset[Ce][1],depth:ae+1})}}return null}_addNode(r,s,u){return this.minimums.push(r),this.maximums.push(s),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(r,s,u,h,g){if(r[h].isLeaf(s,u)===1)return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);const y=h-1,b=r[y];let T=0,E=0;for(let k=0;k<this._siblingOffset.length;k++){const P=2*s+this._siblingOffset[k][0],R=2*u+this._siblingOffset[k][1],L=b.getElevation(P,R),z=b.isLeaf(P,R),W=this._addNode(L.min,L.max,z);z&&(T|=1<<k),E||(E=W)}for(let k=0;k<this._siblingOffset.length;k++)T&1<<k||this._construct(r,2*s+this._siblingOffset[k][0],2*u+this._siblingOffset[k][1],y,E+k)}}function zD(a,r,s,u,h,g){return Br(Br(a,s,g),Br(r,u,g),h)}function Hh(a,r,s){const u=s.dim,h=se(a*u-.5,0,u-1),g=se(r*u-.5,0,u-1),y=Math.floor(h),b=Math.floor(g),T=Math.min(y+1,u-1),E=Math.min(b+1,u-1);return zD(s.get(y,b),s.get(T,b),s.get(y,E),s.get(T,E),h-y,g-b)}const AH={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function jH(a,r,s){return(256*a*256+256*r+s)/10-1e4}function IH(a,r,s){return 256*a+r+s/256-32768}class M1{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,s,u,h=!1){if(this.uid=r,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return void Cr(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const g=this.dim=s.height-2,y=new Uint32Array(s.data.buffer);if(this.pixels=new Uint8Array(s.data.buffer),this.floatView=new Float32Array(s.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let T=0;T<g;T++)y[this._idx(-1,T)]=y[this._idx(0,T)],y[this._idx(g,T)]=y[this._idx(g-1,T)],y[this._idx(T,-1)]=y[this._idx(T,0)],y[this._idx(T,g)]=y[this._idx(T,g-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(g,-1)]=y[this._idx(g-1,0)],y[this._idx(-1,g)]=y[this._idx(0,g-1)],y[this._idx(g,g)]=y[this._idx(g-1,g-1)]}const b=u==="terrarium"?IH:jH;for(let T=0;T<y.length;++T){const E=4*T;this.floatView[T]=b(this.pixels[E],this.pixels[E+1],this.pixels[E+2])}this._timestamp=pa.now()}_buildQuadTree(){this._tree=new LD(this)}get(r,s,u=!1){u&&(r=se(r,-1,this.dim),s=se(s,-1,this.dim));const h=this._idx(r,s);return this.floatView[h]}set(r,s,u){const h=this._idx(r,s),g=this.floatView[h];return this.floatView[h]=u,u-g}static getUnpackVector(r){return AH[r]}_idx(r,s){if(r<-1||r>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(r+1)}static pack(r,s){const u=[0,0,0,0],h=M1.getUnpackVector(s);let g=Math.floor((r+h[3])/h[2]);return u[2]=g%256,g=Math.floor(g/256),u[1]=g%256,g=Math.floor(g/256),u[0]=g,u}getPixels(){return new PR({width:this.stride,height:this.stride},this.pixels)}backfillBorder(r,s,u){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let h=s*this.dim,g=s*this.dim+this.dim,y=u*this.dim,b=u*this.dim+this.dim;switch(s){case-1:h=g-1;break;case 1:g=h+1}switch(u){case-1:y=b-1;break;case 1:b=y+1}const T=-s*this.dim,E=-u*this.dim;for(let k=y;k<b;k++)for(let P=h;P<g;P++){const R=4*this._idx(P,k),L=4*this._idx(P+T,k+E);this.pixels[R+0]=r.pixels[L+0],this.pixels[R+1]=r.pixels[L+1],this.pixels[R+2]=r.pixels[L+2],this.pixels[R+3]=r.pixels[L+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function kH(a,r,s){a===1?r.headerLength=s.readFixed32():a===2?r.x=s.readVarint():a===3?r.y=s.readVarint():a===4?r.z=s.readVarint():a===5&&r.layers.push(function(u,h){return u.readFields(DH,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},h)}(s,s.readVarint()+s.pos))}function PH(a,r,s){a===1?(r.delta_filter=function(u,h){return u.readFields(RH,{blockSize:0},h)}(s,s.readVarint()+s.pos),r.filter="delta_filter"):a===2?(s.readVarint(),r.filter="zigzag_filter"):a===3?(s.readVarint(),r.filter="bitshuffle_filter"):a===4&&(s.readVarint(),r.filter="byteshuffle_filter")}function RH(a,r,s){a===1&&(r.blockSize=s.readVarint())}function MH(a,r,s){a===1?(s.readVarint(),r.codec="gzip_data"):a===2?(s.readVarint(),r.codec="jpeg_image"):a===3?(s.readVarint(),r.codec="webp_image"):a===4&&(s.readVarint(),r.codec="png_image")}function NH(a,r,s){let u=0,h=0;a===1?r.firstByte=s.readFixed64():a===2?r.lastByte=s.readFixed64():a===3?r.filters.push(function(g,y){return g.readFields(PH,{},y)}(s,s.readVarint()+s.pos)):a===4?r.codec=function(g,y){return g.readFields(MH,{},y)}(s,s.readVarint()+s.pos):a===5?h=s.readFloat():a===6?u=s.readFloat():a===7?r.bands.push(s.readString()):a===8?r.offset=s.readDouble():a===9&&(r.scale=s.readDouble()),r.offset===0&&(r.offset=h),r.scale===0&&(r.scale=u)}function DH(a,r,s){a===1?r.version=s.readVarint():a===2?r.name=s.readString():a===3?r.units=s.readString():a===4?r.tileSize=s.readVarint():a===5?r.buffer=s.readVarint():a===6?r.pixelFormat=s.readVarint():a===7&&r.dataIndex.push(function(u,h){return u.readFields(NH,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},h)}(s,s.readVarint()+s.pos))}function OH(a,r,s){if(a===2)(function(u,h,g){u.readFields(LH,g,h)})(s,s.readVarint()+s.pos,r);else if(a===3)throw new Error("Not implemented")}function LH(a,r,s){if(a===1){let u=0;const h=s.readVarint()+s.pos;for(;s.pos<h;)r[u++]=s.readVarint()}}function zH(a,r){if(r.length!==4)throw new Error(`Expected data of dimension 4 but got ${r.length}.`);let s=r[3];for(let u=2;u>=1;u--){const h=u===1?1:0,g=u===2?1:0;for(let y=0;y<r[0];y++){const b=r[1]*y;for(let T=h;T<r[1];T++){const E=r[2]*(T+b);for(let k=g;k<r[2];k++){const P=r[3]*(k+E);for(let R=0;R<r[3];R++){const L=P+R;a[L]+=a[L-s]}}}}s*=r[u]}return a}function FH(a){for(let r=0,s=a.length;r<s;r++)a[r]=a[r]>>>1^-(1&a[r]);return a}function BH(a,r){switch(r){case"uint32":return a;case"uint16":for(let s=0;s<a.length;s+=2){const u=a[s],h=a[s+1];a[s]=(240&u)>>4|(61440&u)>>8|(240&h)<<4|61440&h,a[s+1]=15&u|(3840&u)>>4|(15&h)<<8|(3840&h)<<4}return a;case"uint8":for(let s=0;s<a.length;s+=4){const u=a[s],h=a[s+1],g=a[s+2],y=a[s+3];a[s+0]=(192&u)>>6|(192&h)>>4|(192&g)>>2|192&y,a[s+1]=(48&u)>>4|(48&h)>>2|48&g|(48&y)<<2,a[s+2]=(12&u)>>2|12&h|(12&g)<<2|(12&y)<<4,a[s+3]=3&u|(3&h)<<2|(3&g)<<4|(3&y)<<6}return a;default:throw new Error(`Invalid pixel format, "${r}"`)}}or(M1,"DEMData"),or(LD,"DemMinMaxQuadTree",{omit:["dem"]});var Nl=Uint8Array,Qx=Uint16Array,VH=Int32Array,FD=new Nl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),BD=new Nl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),UH=new Nl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),VD=function(a,r){for(var s=new Qx(31),u=0;u<31;++u)s[u]=r+=1<<a[u-1];var h=new VH(s[30]);for(u=1;u<30;++u)for(var g=s[u];g<s[u+1];++g)h[g]=g-s[u]<<5|u;return{b:s,r:h}},UD=VD(FD,2),$D=UD.b,$H=UD.r;$D[28]=258,$H[258]=28;for(var qH=VD(BD,0).b,qD=new Qx(32768),Hs=0;Hs<32768;++Hs){var g_=(43690&Hs)>>1|(21845&Hs)<<1;qD[Hs]=((65280&(g_=(61680&(g_=(52428&g_)>>2|(13107&g_)<<2))>>4|(3855&g_)<<4))>>8|(255&g_)<<8)>>1}var e0=function(a,r,s){for(var u=a.length,h=0,g=new Qx(r);h<u;++h)a[h]&&++g[a[h]-1];var y,b=new Qx(r);for(h=1;h<r;++h)b[h]=b[h-1]+g[h-1]<<1;y=new Qx(1<<r);var T=15-r;for(h=0;h<u;++h)if(a[h])for(var E=h<<4|a[h],k=r-a[h],P=b[a[h]-1]++<<k,R=P|(1<<k)-1;P<=R;++P)y[qD[P]>>T]=E;return y},t0=new Nl(288);for(Hs=0;Hs<144;++Hs)t0[Hs]=8;for(Hs=144;Hs<256;++Hs)t0[Hs]=9;for(Hs=256;Hs<280;++Hs)t0[Hs]=7;for(Hs=280;Hs<288;++Hs)t0[Hs]=8;var GD=new Nl(32);for(Hs=0;Hs<32;++Hs)GD[Hs]=5;var GH=e0(t0,9),HH=e0(GD,5),zC=function(a){for(var r=a[0],s=1;s<a.length;++s)a[s]>r&&(r=a[s]);return r},qc=function(a,r,s){var u=r/8|0;return(a[u]|a[u+1]<<8)>>(7&r)&s},FC=function(a,r){var s=r/8|0;return(a[s]|a[s+1]<<8|a[s+2]<<16)>>(7&r)},WH=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Gc=function(a,r,s){var u=new Error(r||WH[a]);if(u.code=a,Error.captureStackTrace&&Error.captureStackTrace(u,Gc),!s)throw u;return u},ZH=new Nl(0),XH=typeof TextDecoder<"u"&&new TextDecoder;try{XH.decode(ZH,{stream:!0})}catch{}const KH={gzip_data:"gzip"};class lc extends Error{constructor(r){super(r),this.name="MRTError"}}const YH={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},HD={uint32:1,uint16:2,uint8:4},JH={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let BC;class N1{constructor(r=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=r}getLayer(r){const s=this.layers[r];if(!s)throw new lc(`Layer '${r}' not found`);return s}getHeaderLength(r){const s=new Uint8Array(r),u=new DataView(r);if(s[0]!==13)throw new lc("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(r){const s=new Uint8Array(r),u=this.getHeaderLength(r);if(s.length<u)throw new lc(`Expected header with length >= ${u} but got buffer of length ${s.length}`);const h=new BC(s.subarray(0,u)).readFields(kH,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==h.x||this.y!==h.y||this.z!==h.z))throw new lc(`Invalid attempt to parse header ${h.z}/${h.x}/${h.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=h.x,this.y=h.y,this.z=h.z;for(const g of h.layers)this.layers[g.name]=new WD(g,{cacheSize:this._cacheSize});return this}createDecodingTask(r){const s=[],u=this.getLayer(r.layerName);for(let h of r.blockIndices){const g=u.dataIndex[h],y=g.firstByte-r.firstByte,b=g.lastByte-r.firstByte;if(u._blocksInProgress.has(h))continue;const T={layerName:u.name,firstByte:y,lastByte:b,pixelFormat:u.pixelFormat,blockIndex:h,blockShape:[g.bands.length].concat(u.bandShape),buffer:u.buffer,codec:g.codec.codec,filters:g.filters.map(E=>E.filter)};u._blocksInProgress.add(h),s.push(T)}return new ZD(s,()=>{s.forEach(h=>u._blocksInProgress.delete(h.blockIndex))},(h,g)=>{if(s.forEach(y=>u._blocksInProgress.delete(y.blockIndex)),h)throw h;g.forEach(y=>{this.getLayer(y.layerName).processDecodedData(y)})})}}class WD{constructor({version:r,name:s,units:u,tileSize:h,pixelFormat:g,buffer:y,dataIndex:b},T){if(this.version=r,this.version!==1)throw new lc(`Cannot parse raster layer encoded with MRT version ${r}`);this.name=s,this.units=u,this.tileSize=h,this.buffer=y,this.pixelFormat=YH[g],this.dataIndex=b,this.bandShape=[h+2*y,h+2*y,HD[this.pixelFormat]],this._decodedBlocks=new R1(T?T.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return HD[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:r})=>r).flat()}processDecodedData(r){const s=r.blockIndex.toString();this._decodedBlocks.get(s)||this._decodedBlocks.put(s,r.data)}getBlockForBand(r){let s=0;switch(typeof r){case"string":for(const[u,h]of this.dataIndex.entries()){for(const[g,y]of h.bands.entries())if(y===r)return{bandIndex:s+g,blockIndex:u,blockBandIndex:g};s+=h.bands.length}break;case"number":for(const[u,h]of this.dataIndex.entries()){if(r>=s&&r<s+h.bands.length)return{bandIndex:r,blockIndex:u,blockBandIndex:r-s};s+=h.bands.length}break;default:throw new lc(`Invalid band \`${JSON.stringify(r)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(r){let s=1/0,u=-1/0;const h=[],g=new Set;for(const y of r){const{blockIndex:b}=this.getBlockForBand(y);if(b<0)throw new lc(`Invalid band: ${JSON.stringify(y)}`);const T=this.dataIndex[b];h.includes(b)||h.push(b),g.add(b),s=Math.min(s,T.firstByte),u=Math.max(u,T.lastByte)}if(g.size>this.cacheSize)throw new lc(`Number of blocks to decode (${g.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:s,lastByte:u,blockIndices:h}}hasBand(r){const{blockIndex:s}=this.getBlockForBand(r);return s>=0}hasDataForBand(r){const{blockIndex:s}=this.getBlockForBand(r);return s>=0&&!!this._decodedBlocks.get(s.toString())}getBandView(r){const{blockIndex:s,blockBandIndex:u}=this.getBlockForBand(r);if(s<0)throw new lc(`Band not found: ${JSON.stringify(r)}`);const h=this._decodedBlocks.get(s.toString());if(!h)throw new lc(`Data for band ${JSON.stringify(r)} of layer "${this.name}" not decoded.`);const g=this.dataIndex[s],y=this.bandShape.reduce((E,k)=>E*k,1),b=u*y,T=h.subarray(b,b+y);return{data:T,bytes:new Uint8Array(T.buffer).subarray(T.byteOffset,T.byteOffset+T.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:g.offset,scale:g.scale}}}N1.setPbf=function(a){BC=a};class ZD{constructor(r,s,u){this.tasks=r,this._onCancel=s,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(r,s){this._finalized||(this._onComplete(r,s),this._finalized=!0)}}N1.performDecoding=function(a,r){const s=new Uint8Array(a);return Promise.all(r.tasks.map(u=>{const{layerName:h,firstByte:g,lastByte:y,pixelFormat:b,blockShape:T,blockIndex:E,filters:k,codec:P}=u,R=s.subarray(g,y+1),L=new Uint32Array(T[0]*T[1]*T[2]);let z;if(P!=="gzip_data")throw new lc(`Unhandled codec: ${P}`);return z=function(W,J){if(!globalThis.DecompressionStream&&J==="gzip_data")return Promise.resolve(((he=function(ke){ke[0]==31&&ke[1]==139&&ke[2]==8||Gc(6,"invalid gzip data");var Me=ke[3],ze=10;4&Me&&(ze+=2+(ke[10]|ke[11]<<8));for(var ct=(Me>>3&1)+(Me>>4&1);ct>0;ct-=!ke[ze++]);return ze+(2&Me)}(ue=W))+8>ue.length&&Gc(6,"invalid gzip data"),function(ke,Me,ze,ct){var We=ke.length;if(!We||Me.f&&!Me.l)return ze||new Nl(0);var ut=!ze,gt=ut||Me.i!=2,St=Me.i;ut&&(ze=new Nl(3*We));var Lt,kt,_t=function(rs){var Li=ze.length;if(rs>Li){var Ti=new Nl(Math.max(2*Li,rs));Ti.set(ze),ze=Ti}},It=Me.f||0,ot=Me.p||0,rt=Me.b||0,At=Me.l,Nt=Me.d,xt=Me.m,sr=Me.n,cr=8*We;do{if(!At){It=qc(ke,ot,1);var tr=qc(ke,ot+1,3);if(ot+=3,!tr){var Zt=ke[(we=4+((ot+7)/8|0))-4]|ke[we-3]<<8,Xr=we+Zt;if(Xr>We){St&&Gc(0);break}gt&&_t(rt+Zt),ze.set(ke.subarray(we,Xr),rt),Me.b=rt+=Zt,Me.p=ot=8*Xr,Me.f=It;continue}if(tr==1)At=GH,Nt=HH,xt=9,sr=5;else if(tr==2){var Jt=qc(ke,ot,31)+257,Tr=qc(ke,ot+10,15)+4,Jr=Jt+qc(ke,ot+5,31)+1;ot+=14;for(var pn=new Nl(Jr),zn=new Nl(19),rn=0;rn<Tr;++rn)zn[UH[rn]]=qc(ke,ot+3*rn,7);ot+=3*Tr;var Hn=zC(zn),Wn=(1<<Hn)-1,Hi=e0(zn,Hn);for(rn=0;rn<Jr;){var we,_e=Hi[qc(ke,ot,Wn)];if(ot+=15&_e,(we=_e>>4)<16)pn[rn++]=we;else{var ht=0,Ht=0;for(we==16?(Ht=3+qc(ke,ot,3),ot+=2,ht=pn[rn-1]):we==17?(Ht=3+qc(ke,ot,7),ot+=3):we==18&&(Ht=11+qc(ke,ot,127),ot+=7);Ht--;)pn[rn++]=ht}}var ft=pn.subarray(0,Jt),Xt=pn.subarray(Jt);xt=zC(ft),sr=zC(Xt),At=e0(ft,xt),Nt=e0(Xt,sr)}else Gc(1);if(ot>cr){St&&Gc(0);break}}gt&&_t(rt+131072);for(var mr=(1<<xt)-1,fr=(1<<sr)-1,nn=ot;;nn=ot){var Mr=(ht=At[FC(ke,ot)&mr])>>4;if((ot+=15&ht)>cr){St&&Gc(0);break}if(ht||Gc(2),Mr<256)ze[rt++]=Mr;else{if(Mr==256){nn=ot,At=null;break}var dr=Mr-254;Mr>264&&(dr=qc(ke,ot,(1<<(Dr=FD[rn=Mr-257]))-1)+$D[rn],ot+=Dr);var qn=Nt[FC(ke,ot)&fr],gi=qn>>4;if(qn||Gc(3),ot+=15&qn,Xt=qH[gi],gi>3){var Dr=BD[gi];Xt+=FC(ke,ot)&(1<<Dr)-1,ot+=Dr}if(ot>cr){St&&Gc(0);break}gt&&_t(rt+131072);var Dn=rt+dr;if(rt<Xt){var _i=0-Xt,ni=Math.min(Xt,Dn);for(_i+rt<0&&Gc(3);rt<ni;++rt)ze[rt]=(void 0)[_i+rt]}for(;rt<Dn;++rt)ze[rt]=ze[rt-Xt]}}Me.l=At,Me.p=nn,Me.b=rt,Me.f=It,At&&(It=1,Me.m=xt,Me.d=Nt,Me.n=sr)}while(!It);return rt!=ze.length&&ut?(Lt=ze,((kt=rt)==null||kt>Lt.length)&&(kt=Lt.length),new Nl(Lt.subarray(0,kt))):ze.subarray(0,rt)}(ue.subarray(he,-8),{i:2},new Nl(((te=ue)[(ae=te.length)-4]|te[ae-3]<<8|te[ae-2]<<16|te[ae-1]<<24)>>>0))));var te,ae,ue,he;const Ce=KH[J];if(!Ce)throw new Error(`Unhandled codec: ${J}`);const be=new globalThis.DecompressionStream(Ce);return new Response(new Blob([W]).stream().pipeThrough(be)).arrayBuffer().then(ke=>new Uint8Array(ke))}(R,P).then(W=>(function(J,te){J.readFields(OH,te)}(new BC(W),L),new JH[b](L.buffer))),z.then(W=>{for(let J=k.length-1;J>=0;J--)switch(k[J]){case"delta_filter":zH(W,T);break;case"zigzag_filter":FH(W);break;case"bitshuffle_filter":BH(W,b);break;default:throw new lc(`Unhandled filter "${k[J]}"`)}return{layerName:h,blockIndex:E,data:W}}).catch(W=>{throw W})}))},or(ZD,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),or(N1,"MapboxRasterTile"),or(WD,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class XD{constructor(r){this._stringToNumber={},this._numberToString=[];for(let s=0;s<r.length;s++){const u=r[s];this._stringToNumber[u]=s,this._numberToString[s]=u}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}class KD{constructor(r,s){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new yd(Vt,16,0),this.featureIndexArray=new Rw,this.promoteId=s,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(r,s,u,h,g,y=0,b=0){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,h,g,y);const E=this.grid;for(let k=0;k<s.length;k++){const P=s[k],R=[1/0,1/0,-1/0,-1/0];for(let L=0;L<P.length;L++){const z=P[L];R[0]=Math.min(R[0],z.x),R[1]=Math.min(R[1],z.y),R[2]=Math.max(R[2],z.x),R[3]=Math.max(R[3],z.y)}b!==0&&(R[0]-=b,R[1]-=b,R[2]+=b,R[3]+=b),R[0]<Vt&&R[1]<Vt&&R[2]>=0&&R[3]>=0&&E.insert(T,R[0],R[1],R[2],R[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new ur(new u1(this.rawTileData)).layers,this.sourceLayerCoder=new XD(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,s){const{tilespaceGeometry:u,transform:h,tileTransform:g,pixelPosMatrix:y,availableImages:b,worldview:T}=s;this.loadVTLayers(),this.serializedLayersCache.clear();const E=s.queryRadius?s.queryRadius:0,k=u.bufferedTilespaceBounds,P=this.grid.query(k.min.x,k.min.y,k.max.x,k.max.y,(W,J,te,ae)=>es(u.bufferedTilespaceGeometry,W-E,J-E,te+E,ae+E));P.sort(QH);let R=null;h.elevation&&P.length>0&&(R=f_.create(h.elevation,this.tileID));const L={};let z;for(let W=0;W<P.length;W++){const J=P[W];if(J===z)continue;z=J;const te=this.featureIndexArray.get(J);let ae=null;this.is3DTile?this.loadMatchingModelFeature(L,te,r,u,h,T):this.loadMatchingFeature(L,te,r,b,T,(ue,he,Ce,be=0)=>(ae||(ae=mt(ue,this.tileID.canonical,g)),he.queryIntersectsFeature(u,ue,Ce,ae,this.z,h,y,R,be)))}return L}loadMatchingFeature(r,s,u,h,g,y){const{featureIndex:b,bucketIndex:T,sourceLayerIndex:E,layoutVertexArrayOffset:k}=s,P=this.bucketLayerIDs[T],R=u.layers,L=Object.keys(R);if(L.length&&!Wr(L,P))return;const z=u.sourceCache,W=this.sourceLayerCoder.decode(E),J=this.vtLayers[W].feature(b),te=this.getId(J,W);for(let ae=0;ae<P.length;ae++){const ue=P[ae];if(!R[ue])continue;const{styleLayer:he,targets:Ce}=R[ue];let be={};te!==void 0&&(be=z.getFeatureState(he.sourceLayer,te));const ke=!y||y(J,he,be,k);if(!ke)continue;const Me=new Qp(J,this.z,this.x,this.y,te);Me.tile=this.tileID.canonical,Me.state=be;let ze=this.serializedLayersCache.get(ue);ze||(ze=he.serialize(),ze.id=ue,this.serializedLayersCache.set(ue,ze)),Me.source=ze.source,Me.sourceLayer=ze["source-layer"],Me.layer=Object.assign({},ze),Me.layer.paint=YD(ze.paint,he.paint,J,be,h),Me.layer.layout=YD(ze.layout,he.layout,J,be,h);let ct=!1;for(const We of Ce){this.updateFeatureProperties(Me,We);const{filter:ut}=We;if(ut){if(J.properties=Me.properties,ut.needGeometry){const gt=et(J,!0);if(!ut.filter(new Ai(this.tileID.overscaledZ,{worldview:g}),gt,this.tileID.canonical))continue}else if(!ut.filter(new Ai(this.tileID.overscaledZ,{worldview:g}),J))continue}ct=!0,We.targetId&&this.addFeatureVariant(Me,We)}ct&&this.appendToResult(r,ue,b,Me,ke)}}loadMatchingModelFeature(r,s,u,h,g,y){const{featureIndex:b,bucketIndex:T}=s,E=this.bucketLayerIDs[T],k=u.layers,P=Object.keys(k);if(!P.length||Wr(P,E))for(let R=0;R<E.length;R++){const L=E[R],{styleLayer:z,targets:W}=k[L];if(z.type!=="model")continue;const J=h.tile,te=J.getBucket(z);if(!(te&&te instanceof A1))continue;const ae=sH(te,b,h,g);if(!ae)continue;const{z:ue,x:he,y:Ce}=J.tileID.canonical,{feature:be,intersectionZ:ke,position:Me}=ae;let ze={};be.id!==void 0&&(ze=u.sourceCache.getFeatureState(z.sourceLayer,be.id));const ct=new Qp({},ue,he,Ce,be.id);ct.tile=this.tileID.canonical,ct.state=ze,ct.properties=be.properties,ct.geometry={type:"Point",coordinates:[Me.lng,Me.lat]};let We=this.serializedLayersCache.get(L);We||(We=z.serialize(),We.id=L,this.serializedLayersCache.set(L,We)),ct.source=We.source,ct.sourceLayer=We["source-layer"],ct.layer=Object.assign({},We);let ut=!1;for(const gt of W){this.updateFeatureProperties(ct,gt);const{filter:St}=gt;if(St){if(be.properties=ct.properties,St.needGeometry){if(!St.filter(new Ai(this.tileID.overscaledZ,{worldview:y}),be,this.tileID.canonical))continue}else if(!St.filter(new Ai(this.tileID.overscaledZ,{worldview:y}),be))continue}ut=!0,gt.targetId&&this.addFeatureVariant(ct,gt)}ut&&this.appendToResult(r,L,b,ct,ke)}}updateFeatureProperties(r,s,u){if(s.properties){const h={};for(const g in s.properties){const y=s.properties[g].evaluate({zoom:this.z},r._vectorTileFeature,r.state,r.tile,u);y!=null&&(h[g]=y)}r.properties=h}}addFeatureVariant(r,s,u){const h={target:s.target,namespace:s.namespace,uniqueFeatureID:s.uniqueFeatureID};s.properties&&(h.properties=r.properties),r.variants=r.variants||{},r.variants[s.targetId]=r.variants[s.targetId]||[],r.variants[s.targetId].push(h)}appendToResult(r,s,u,h,g){let y=r[s];y===void 0&&(y=r[s]=[]),y.push({featureIndex:u,feature:h,intersectionZ:g})}lookupSymbolFeatures(r,s,u,h,g,y){const b={};this.loadVTLayers();for(const T of r)this.loadMatchingFeature(b,{bucketIndex:s,sourceLayerIndex:u,featureIndex:T,layoutVertexArrayOffset:0},h,g,y);return b}loadFeature(r){const{featureIndex:s,sourceLayerIndex:u}=r;this.loadVTLayers();const h=this.sourceLayerCoder.decode(u),g=this.vtFeatures[h];if(g[s])return g[s];const y=this.vtLayers[h].feature(s);return g[s]=y,y}hasLayer(r){for(const s of this.bucketLayerIDs)for(const u of s)if(r===u)return!0;return!1}getId(r,s){let u=r.id;if(this.promoteId){const h=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[s];if(h!=null)if(Array.isArray(h)){if(!this.promoteIdExpression){const g=sc(h);if(g.result!=="success"){const y=g.value.map(b=>`${b.key}: ${b.message}`).join(", ");return void Cr(`Failed to create expression for promoteId: ${y}`)}this.promoteIdExpression=g.value}u=this.promoteIdExpression.evaluate({zoom:0},r)}else u=r.properties[h];typeof u=="boolean"&&(u=Number(u))}return u}}function YD(a,r,s,u,h){return Dt(a,(g,y)=>{const b=r instanceof vd?r.get(y):null;return b&&b.evaluate?b.evaluate(s,u,void 0,h):b})}function QH(a,r){return r-a}or(KD,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const JD=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class VC{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,u]=new Uint8Array(r,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=u>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const g=JD[15&u];if(!g)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(r,2,1),[b]=new Uint32Array(r,4,1);return new VC(b,y,g,r)}constructor(r,s=64,u=Float64Array,h){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=u,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const g=JD.indexOf(this.ArrayType),y=2*r*this.ArrayType.BYTES_PER_ELEMENT,b=r*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-b%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${u}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+b+T,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+y+b+T),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+b+T,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=r)}add(r,s){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=r,this.coords[this._pos++]=s,u}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return UC(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,s,u,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:y,nodeSize:b}=this,T=[0,g.length-1,0],E=[];for(;T.length;){const k=T.pop()||0,P=T.pop()||0,R=T.pop()||0;if(P-R<=b){for(let J=R;J<=P;J++){const te=y[2*J],ae=y[2*J+1];te>=r&&te<=u&&ae>=s&&ae<=h&&E.push(g[J])}continue}const L=R+P>>1,z=y[2*L],W=y[2*L+1];z>=r&&z<=u&&W>=s&&W<=h&&E.push(g[L]),(k===0?r<=z:s<=W)&&(T.push(R),T.push(L-1),T.push(1-k)),(k===0?u>=z:h>=W)&&(T.push(L+1),T.push(P),T.push(1-k))}return E}within(r,s,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:g,nodeSize:y}=this,b=[0,h.length-1,0],T=[],E=u*u;for(;b.length;){const k=b.pop()||0,P=b.pop()||0,R=b.pop()||0;if(P-R<=y){for(let J=R;J<=P;J++)eO(g[2*J],g[2*J+1],r,s)<=E&&T.push(h[J]);continue}const L=R+P>>1,z=g[2*L],W=g[2*L+1];eO(z,W,r,s)<=E&&T.push(h[L]),(k===0?r-u<=z:s-u<=W)&&(b.push(R),b.push(L-1),b.push(1-k)),(k===0?r+u>=z:s+u>=W)&&(b.push(L+1),b.push(P),b.push(1-k))}return T}}function UC(a,r,s,u,h,g){if(h-u<=s)return;const y=u+h>>1;QD(a,r,y,u,h,g),UC(a,r,s,u,y-1,1-g),UC(a,r,s,y+1,h,1-g)}function QD(a,r,s,u,h,g){for(;h>u;){if(h-u>600){const E=h-u+1,k=s-u+1,P=Math.log(E),R=.5*Math.exp(2*P/3),L=.5*Math.sqrt(P*R*(E-R)/E)*(k-E/2<0?-1:1);QD(a,r,s,Math.max(u,Math.floor(s-k*R/E+L)),Math.min(h,Math.floor(s+(E-k)*R/E+L)),g)}const y=r[2*s+g];let b=u,T=h;for(r0(a,r,u,s),r[2*h+g]>y&&r0(a,r,u,h);b<T;){for(r0(a,r,b,T),b++,T--;r[2*b+g]<y;)b++;for(;r[2*T+g]>y;)T--}r[2*u+g]===y?r0(a,r,u,T):(T++,r0(a,r,T,h)),T<=s&&(u=T+1),s<=T&&(h=T-1)}}function r0(a,r,s,u){$C(a,s,u),$C(r,2*s,2*u),$C(r,2*s+1,2*u+1)}function $C(a,r,s){const u=a[r];a[r]=a[s],a[s]=u}function eO(a,r,s,u){const h=a-s,g=r-u;return h*h+g*g}o.$=eg,o.A=Pc,o.B=xd,o.C=2,o.D=e_,o.E=Ic,o.F=zx,o.G=CN,o.H=Qm,o.I=Gs,o.J=Xv,o.K=ch,o.L=bp,o.M=Tg,o.N=Sg,o.O=Ov,o.P=wt,o.Q=jg,o.R=ad,o.S=Ah,o.T=QE,o.U=sc,o.V=C1,o.W=zv,o.X=_h,o.Y=gh,o.Z=Ap,o._=Uo,o.a=function(a){return Di.API_CDN_URL_REGEX.test(a)},o.a$=Ph,o.a0=qr,o.a1=lv,o.a2=jh,o.a3=class extends C1{},o.a4=Eg,o.a5=Dv,o.a6=He,o.a7=function(a){const r=a.value;return r?qr(r)?IC(r,!0)?[]:[new C1(a.key,r,`invalid url "${r}"`)]:[new C1(a.key,r,`string expected, "${ch(r)}" found`)]:[]},o.a8=bw,o.a9=is,o.aA=se,o.aB=H,o.aC=yr,o.aD=oa,o.aE=no,o.aF=oe,o.aG=at,o.aH=function(a,r){const s={};for(let u=0;u<r.length;u++){const h=r[u];h in a&&(s[h]=a[h])}return s},o.aI=O,o.aJ=ie,o.aK=class{constructor(a){this.entries={},this.scheduler=a}request(a,r,s,u){const h=this.entries[a]=this.entries[a]||{callbacks:[]};if(h.result){const[g,y]=h.result;return this.scheduler?this.scheduler.add(()=>{u(g,y)},r):u(g,y),()=>{}}return h.callbacks.push(u),h.cancel||(h.cancel=s((g,y)=>{h.result=[g,y];for(const b of h.callbacks)this.scheduler?this.scheduler.add(()=>{b(g,y)},r):b(g,y);setTimeout(()=>delete this.entries[a],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(g=>g!==u),h.callbacks.length||(h.cancel(),delete this.entries[a]))}}},o.aL=function(a,r,s){const u=JSON.stringify(a.request);return a.data&&(this.deduped.entries[u]={result:[null,a.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},h=>{const g=ih(a.request,(y,b,T)=>{y?h(y):b&&h(null,{vectorTile:s?void 0:new ur(new u1(b)),rawData:b,responseHeaders:new Map(T.entries())})});return()=>{g.cancel(),h()}},r)},o.aM=function(a){return a?{cacheControl:a.get("Cache-Control"),expires:a.get("Expires")}:{cacheControl:void 0,expires:void 0}},o.aN=function(a){Zm++,Zm>na&&(a.getActor().send("enforceCacheSizeLimit",sp),Zm=0)},o.aO=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log2(a)))},o.aP=eo,o.aQ=tD,o.aR=aD,o.aS=B,o.aT=eD,o.aU=function(a,r){const s=document.createElement("video");s.muted=!0,s.onloadstart=function(){r(null,s)};for(let u=0;u<a.length;u++){const h=document.createElement("source");Jn(a[u])||(s.crossOrigin="Anonymous"),h.src=a[u],s.appendChild(h)}return{cancel:()=>{}}},o.aV=Mx,o.aW=em,o.aX=tt,o.aY=Ux,o.aZ=me,o.a_=de,o.aa=Rt,o.ab=class{constructor(a){this.specification=a}possiblyEvaluate(a,r){return hi(a.expression.evaluate(r))}interpolate(a,r,s){return{x:Br(a.x,r.x,s),y:Br(a.y,r.y,s),z:Br(a.z,r.z,s),azimuthal:Br(a.azimuthal,r.azimuthal,s),polar:Br(a.polar,r.polar,s)}}},o.ac=Ai,o.ad=Eu,o.ae=$e,o.af=hn,o.ag=qt,o.ah=ye,o.ai=vd,o.aj=Vh,o.ak=Br,o.al=Vt,o.am=mp,o.an=gn,o.ao=ri,o.ap=class{constructor(a){this.specification=a}possiblyEvaluate(a,r){return function([s,u]){const h=hi([1,s,u]);return{x:h.x,y:h.y,z:h.z}}(a.expression.evaluate(r))}interpolate(a,r,s){return{x:Br(a.x,r.x,s),y:Br(a.y,r.y,s),z:Br(a.z,r.z,s)}}},o.aq=function(a,r,s=0,u=!0){const h=new wt(s,s),g=a.sub(h),y=r.add(h),b=[g,new wt(y.x,g.y),y,new wt(g.x,y.y)];return u&&b.push(g.clone()),b},o.ar=function(a,r){const s=[];for(let u=0;u<a.length;u++){const h=Re(u-1,-1,a.length-1),g=Re(u+1,-1,a.length-1),y=a[u],b=a[g],T=a[h].sub(y).unit(),E=b.sub(y).unit(),k=E.angleWithSep(T.x,T.y),P=T.add(E).unit().mult(-1*r/Math.sin(k/2));s.push(y.add(P))}return s},o.as=FN,o.at=es,o.au=function(a,r,s=0){return Ke(((r.x-s)*a.scale-a.x)*Vt,(r.y*a.scale-a.y)*Vt,Ee(r.z,r.y))},o.av=bi,o.aw=xr,o.ax=on,o.ay=QM,o.az=function(a){let r=1/0,s=1/0,u=-1/0,h=-1/0;for(const g of a)r=Math.min(r,g.x),s=Math.min(s,g.y),u=Math.max(u,g.x),h=Math.max(h,g.y);return{min:new wt(r,s),max:new wt(u,h)}},o.b=function(a){return Di.API_FONTS_REGEX.test(a)},o.b$=VE,o.b0=Ui,o.b1=it,o.b2=Iw,o.b3=w1,o.b4=function(){_a.isLoading()||_a.isLoaded()||Hv()!=="deferred"||Wv()},o.b5=Ng,o.b6=et,o.b7=Qp,o.b8=ks,o.b9=aC,o.bA=Ae,o.bB=Y,o.bC=function(a,r){const{x:s,y:u}=a.point,h=yR(s,u,a.worldSize/a._pixelsPerMercatorPixel,0,0);return H(h,h,jE(Ru(r)))},o.bD=N,o.bE=Vi,o.bF=Wt,o.bG=vt,o.bH=Hr,o.bI=zr,o.bJ=l_,o.bK=Va,o.bL=mC,o.bM=function(a,r,s,u,h){const g=5*r+2;a.float32[g+0]=s,a.float32[g+1]=u,a.float32[g+2]=h},o.bN=h_,o.bO=yt,o.bP=Mi,o.bQ=Qr,o.bR=Yn,o.bS=Re,o.bT=function(a,r,s,u){var h=new I(4);return h[0]=a,h[1]=r,h[2]=s,h[3]=u,h},o.bU=class{isDataAvailableAtPoint(a){const r=this._source();if(this.isUsingMockSource()||!r||a.y<0||a.y>1)return!1;const s=r.getSource().maxzoom,u=1<<s,h=Math.floor(a.x),g=Math.floor((a.x-h)*u),y=Math.floor(a.y*u),b=this.findDEMTileFor(new eo(s,h,s,g,y));return!(!b||!b.dem)}getAtPointOrZero(a,r=0){return this.getAtPoint(a,r)||0}getAtPoint(a,r,s=!0){if(this.isUsingMockSource())return null;r==null&&(r=null);const u=this._source();if(!u||a.y<0||a.y>1)return r;const h=u.getSource().maxzoom,g=1<<h,y=Math.floor(a.x),b=a.x-y,T=new eo(h,y,h,Math.floor(b*g),Math.floor(a.y*g)),E=this.findDEMTileFor(T);if(!E||!E.dem)return r;const k=E.dem,P=1<<E.tileID.canonical.z,R=(b*P-E.tileID.canonical.x)*k.dim,L=(a.y*P-E.tileID.canonical.y)*k.dim,z=Math.floor(R),W=Math.floor(L);return(s?this.exaggeration():1)*Br(Br(k.get(z,W),k.get(z,W+1),L-W),Br(k.get(z+1,W),k.get(z+1,W+1),L-W),R-z)}static getAtTileOffset(a,r,s,u){const h=1<<a.canonical.z;return u?u.pointElevation(r):s?s.getAtPointOrZero(new $e(a.wrap+(a.canonical.x+r.x/Vt)/h,(a.canonical.y+r.y/Vt)/h)):0}static getAtTileOffsetFunc(a,r,s,u){return(h,g,y)=>{const b=this.getAtTileOffset(a,h,g,y),T=u.upVector(a.canonical,h.x,h.y);return Le(T,T,b*u.upVectorScale(a.canonical,r,s).metersToTile),T}}getForTilePoints(a,r,s,u){if(this.isUsingMockSource())return!1;const h=f_.create(this,a,u);return!!h&&(r.forEach(g=>{g[2]=this.exaggeration()*h.getElevationAt(g[0],g[1],s)}),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;const r=this.findDEMTileFor(a);if(!r||!r.dem)return null;const s=r.dem.tree,u=r.tileID,h=1<<a.canonical.z-u.canonical.z;let g=a.canonical.x/h-u.canonical.x,y=a.canonical.y/h-u.canonical.y,b=0;for(let T=0;T<a.canonical.z-u.canonical.z&&!s.leaves[b];T++){g*=2,y*=2;const E=2*Math.floor(y)+Math.floor(g);b=s.childOffsets[b]+E,g%=1,y%=1}return{min:this.exaggeration()*s.minimums[b],max:this.exaggeration()*s.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,r,s){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const a=this.visibleDemTiles;if(a.length===0)return null;let r=!1,s=Number.MAX_VALUE,u=Number.MIN_VALUE;for(const h of a){const g=this.getMinMaxForTile(h.tileID);g&&(s=Math.min(s,g.min),u=Math.max(u,g.max),r=!0)}return r?{min:s,max:u}:null}},o.bV=Qw,o.bW=ds,o.bX=go,o.bY=XR,o.bZ=lD,o.b_=QR,o.ba=zE,o.bb=mt,o.bc=sa,o.bd=Ug,o.be=hR,o.bf=Zi,o.bg=Jg,o.bh=AC,o.bi=function(a,r){const s=Vh(r.zoom);if(s===0)return Ru(a);const u=Uw(a),h=AE(u),g=oe(u.getWest())*r.worldSize,y=oe(u.getEast())*r.worldSize,b=ie(u.getNorth())*r.worldSize,T=ie(u.getSouth())*r.worldSize,E=[g,b,0],k=[y,b,0],P=[g,T,0],R=[y,T,0],L=Q([],r.globeMatrix);return hn(E,E,L),hn(k,k,L),hn(P,P,L),hn(R,R,L),h[0]=Ed(h[0],P,s),h[1]=Ed(h[1],R,s),h[2]=Ed(h[2],k,s),h[3]=Ed(h[3],E,s),dn.fromPoints(h)},o.bj=qw,o.bk=Q,o.bl=_x,o.bm=Ed,o.bn=bd,o.bo=T8,o.bp=Ze,o.bq=K,o.br=N1,o.bs=u1,o.bt=ih,o.bu=function(a,r){const s=[];for(const u in a)u in r||s.push(u);return s},o.bv=Pe,o.bw=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.bx=jo,o.by=q,o.bz=Z,o.c=Vo,o.c$=function(a){return a*a*a*a*a},o.c0=fC,o.c1=MN,o.c2=xC,o.c3=VC,o.c4=Le,o.c5=nt,o.c6=Fr,o.c7=function(a,r,s){s*=.5;var u=r[0],h=r[1],g=r[2],y=r[3],b=Math.sin(s),T=Math.cos(s);return a[0]=u*T+h*b,a[1]=h*T-u*b,a[2]=g*T+y*b,a[3]=y*T-g*b,a},o.c8=On,o.c9=us,o.cA=Qn,o.cB=LM,o.cC=za,o.cD=mR,o.cE=function(a,r,s,u,h,g,y,b,T){if(T.name==="globe")return mR(a,r,new za(s,u,h),!1);const E=Ux({z:s,x:u,y:h},T);return new dn([(g+E.x/E.scale)*r,r*(E.y/E.scale),y],[(g+E.x2/E.scale)*r,r*(E.y2/E.scale),b])},o.cF=function(a,r,s){return a[0]=Math.min(r[0],s[0]),a[1]=Math.min(r[1],s[1]),a[2]=Math.min(r[2],s[2]),a[3]=Math.min(r[3],s[3]),a},o.cG=function(a,r,s){return a[0]=Math.max(r[0],s[0]),a[1]=Math.max(r[1],s[1]),a[2]=Math.max(r[2],s[2]),a[3]=Math.max(r[3],s[3]),a},o.cH=function(a){const r=Math.round((a+45+360)%360/90)%4;return ev[r]},o.cI=ge,o.cJ=Kt,o.cK=n,o.cL=function(a){const r=Z(new Float64Array(16));H(r,a.pixelMatrix,a.globeMatrix);const s=[0,w,0],u=[0,S,0];return hn(s,s,r),hn(u,u,r),[s[0]>0&&s[0]<=a.width&&s[1]>0&&s[1]<=a.height&&!kE(a,new B(a.center.lat,90)),u[0]>0&&u[0]<=a.width&&u[1]>0&&u[1]<=a.height&&!kE(a,new B(a.center.lat,-90))]},o.cM=function(a,r){const{scale:s}=a.tileTransform,u=s*Vt/(a.tileSize*Math.pow(2,r.zoom-a.tileID.overscaledZ+a.tileID.canonical.z));return function(h,g,y){var b=g[1],T=g[2],E=g[3],k=y[0],P=y[1];return h[0]=g[0]*k,h[1]=b*k,h[2]=T*P,h[3]=E*P,h}(new Float32Array(4),r.inverseAdjustmentMatrix,[u,u])},o.cN=i1,o.cO=xe,o.cP=OM,o.cQ=function(a){const r=OM(a,!0);return N([],[r[0],r[1],r[4],r[5]])},o.cR=ne,o.cS=ai,o.cT=le,o.cU=function(a){const{x:r,y:s}=a.point,{lng:u,lat:h}=a._center;return yR(r,s,a.worldSize,u,h)},o.cV=Tt,o.cW=Bo,o.cX=Fa,o.cY=hs,o.cZ=p,o.c_=function(a,r,s){let u=0;for(let h=0;h<2;++h)a[h]>0&&(u+=(a[h]-0)*(a[h]-0)),r[h]<0&&(u+=(0-r[h])*(0-r[h]));return u},o.ca=function(a,r){return a[0]=-r[0],a[1]=-r[1],a[2]=-r[2],a[3]=r[3],a},o.cb=Te,o.cc=function(a,r,s,u,h){var g=1/Math.tan(r/2);if(a[0]=g/s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=g,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,h!=null&&h!==1/0){var y=1/(u-h);a[10]=(h+u)*y,a[14]=2*h*u*y}else a[10]=-1,a[14]=-2*u;return a},o.cd=function(a,r,s,u,h,g,y){var b=1/(r-s),T=1/(u-h),E=1/(g-y);return a[0]=-2*b,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*T,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*E,a[11]=0,a[12]=(r+s)*b,a[13]=(h+u)*T,a[14]=(y+g)*E,a[15]=1,a},o.ce=ce,o.cf=function(a,r,s){a[4*r+0]=s[0],a[4*r+1]=s[1],a[4*r+2]=s[2],a[4*r+3]=s[3]},o.cg=Zg,o.ch=Lh,o.ci=Ss,o.cj=oc,o.ck=qp,o.cl=qN,o.cm=function(){var a=new I(4);return I!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},o.cn=function(a,r,s){var u=r[0],h=r[1],g=r[2],y=r[3],b=Math.sin(s),T=Math.cos(s);return a[0]=u*T+g*b,a[1]=h*T+y*b,a[2]=u*-b+g*T,a[3]=h*-b+y*T,a},o.co=function(a,r){return a[0]===r[0]&&a[1]===r[1]&&a[2]===r[2]&&a[3]===r[3]},o.cp=As,o.cq=function(a){var r=a[0],s=a[1],u=a[2],h=a[3];return Math.sqrt(r*r+s*s+u*u+h*h)},o.cr=Lo,o.cs=Ii,o.ct=ac,o.cu=3,o.cv=2,o.cw=7,o.cx=6,o.cy=jn,o.cz=Be,o.d=function(a){return Di.API_TILEJSON_REGEX.test(a)},o.d$=bR,o.d0=ee,o.d1=45,o.d2=$p,o.d3=function(a,r,s){const u=Math.sqrt(a*a+r*r+s*s),h=u>0?Math.acos(s/u)*Fo:0;let g=a!==0||r!==0?Math.atan2(-r,-a)*Fo+90:0;return g<0&&(g+=360),[u,g,h]},o.d4=Ke,o.d5=hi,o.d6=Ie,o.d7=Ne,o.d8=dn,o.d9=De,o.dA=fx,o.dB=class extends hl{constructor(a){super(a),this.current=bE}set(a,r,s){if(this.fetchUniformLocation(a,r)){for(let u=0;u<9;u++)if(s[u]!==this.current[u]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}}},o.dC=rp,o.dD=function(a,r,s){const u=Vh(s.zoom),h=a.style.map._antialias,g=a.terrain&&a.terrain.exaggeration()>0;return u===0&&!h&&!g},o.dE=function(a){const r=a.pixelsPerMeter,s=r/ce(1,a.center.lat),u=Z(new Float64Array(16));return K(u,u,[a.point.x,a.point.y,0]),ne(u,u,[s,s,r]),Float32Array.from(u)},o.dF=Uw,o.dG=function(a){const r=ge-5;a=se(a,-r,r)/r*90;const s=Math.pow(Math.abs(Math.sin(gn(a))),3);return Math.round(s*(v.length-1))},o.dH=function(a,r,s,u){const h=r.getNorth(),g=r.getSouth(),y=r.getWest(),b=r.getEast(),T=1<<a.z,E=b-y,k=h-g,P=E/m,R=-k/v[s],L=[0,P,0,R,0,0,h,y,0];if(a.z>0){const z=180/u;V(L,L,[z/E+1,0,0,0,z/k+1,0,-.5*z/P,.5*z/R,1])}return L[2]=T,L[5]=a.x,L[8]=a.y,L},o.dI=Ru,o.dJ=function(a,r,s){const u=Z(new Float64Array(16)),h=(r/(1<<a)-.5)*Math.PI*2;return pe(u,s.globeMatrix,h),Float32Array.from(u)},o.dK=PR,o.dL=Vw,o.dM=function(a,r){return[Math.pow(a[0],2.2)*r,Math.pow(a[1],2.2)*r,Math.pow(a[2],2.2)*r]},o.dN=U,o.dO=function(a,r){var s=Math.sin(r),u=Math.cos(r);return a[0]=u,a[1]=s,a[2]=0,a[3]=-s,a[4]=u,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},o.dP=Ji,o.dQ=_R,o.dR=Ni,o.dS=Qi,o.dT=256,o.dU=function(a,r){const s=[0,0,0];return hn(s,s,qw(Ru(r.canonical))),hn(s,s,a),s},o.dV=a=>({u_matrix:new qp(a),u_texsize:new oc(a),u_pixels_to_tile_units:new px(a),u_device_pixel_ratio:new Ss(a),u_width_scale:new Ss(a),u_floor_width_scale:new Ss(a),u_image:new Zg(a),u_units_to_pixels:new oc(a),u_tile_units_to_pixels:new Ss(a),u_alpha_discard_threshold:new Ss(a),u_trim_offset:new oc(a),u_trim_fade_range:new oc(a),u_trim_color:new $p(a),u_emissive_strength:new Ss(a),u_zbias_factor:new Ss(a),u_tile_to_meter:new Ss(a),u_ground_shadow_factor:new Lh(a),u_pattern_transition:new Ss(a)}),o.dW=a=>({u_matrix:new qp(a),u_pixels_to_tile_units:new px(a),u_device_pixel_ratio:new Ss(a),u_width_scale:new Ss(a),u_floor_width_scale:new Ss(a),u_units_to_pixels:new oc(a),u_dash_image:new Zg(a),u_gradient_image:new Zg(a),u_image_height:new Ss(a),u_texsize:new oc(a),u_tile_units_to_pixels:new Ss(a),u_alpha_discard_threshold:new Ss(a),u_trim_offset:new oc(a),u_trim_fade_range:new oc(a),u_trim_color:new $p(a),u_emissive_strength:new Ss(a),u_zbias_factor:new Ss(a),u_tile_to_meter:new Ss(a),u_ground_shadow_factor:new Lh(a)}),o.dX=a=>({u_camera_to_center_distance:new Ss(a),u_extrude_scale:new px(a),u_device_pixel_ratio:new Ss(a),u_matrix:new qp(a),u_inv_rot_matrix:new qp(a),u_merc_center:new oc(a),u_tile_id:new Lh(a),u_zoom_transition:new Ss(a),u_up_dir:new Lh(a),u_emissive_strength:new Ss(a)}),o.dY=Mh,o.dZ=dG,o.d_=class{constructor(a,r,s,u){this.context=a,this.format=u,this.size=s,this.texture=a.gl.createTexture();const[h,g,y]=this.size,{gl:b}=a;b.bindTexture(b.TEXTURE_3D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in r&&r.data&&b.texImage3D(b.TEXTURE_3D,0,this.format,h,g,y,0,YE(this.format),JE(this.format),r.data)}bind(a,r){const{context:s}=this,{gl:u}=s;u.bindTexture(u.TEXTURE_3D,this.texture),a!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,a),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,a),this.minFilter=a),r!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,r),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,r),this.wrapS=r)}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}},o.da=function(a){return[Math.pow(a[0],1/2.2),Math.pow(a[1],1/2.2),Math.pow(a[2],1/2.2)]},o.db=DM,o.dc=sC,o.dd=BM,o.de=IC,o.df=function(a,r){return a.readFields(lH,{icons:[]},r)},o.dg=e1,o.dh=c_,o.di=_C,o.dj=nv,o.dk=xw,o.dl=np,o.dm=hp,o.dn=pr,o.dp=function(a){const r=a.indexOf(Lp);return r>=0?a.slice(0,r):a},o.dq=function(a){return a.indexOf(Lp)>=0},o.dr=function(a){const r=a.lastIndexOf(Lp);return r>=0?a.slice(r+1):""},o.ds=function(a){const r=[],s=a.id;return s===void 0&&r.push({message:`layers.${s}: missing required property "id"`}),a.render===void 0&&r.push({message:`layers.${s}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&r.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),r},o.dt=function(a,r,s,u){return a.type==="custom"?new tH(a,r):new oH[a.type](a,r,s,u)},o.du=jt,o.dv=function(a){const r=a.indexOf(Lp);return r>=0?a.slice(r+1):""},o.dw=class extends Qp{constructor(a,r){super(a._vectorTileFeature,a._z,a._x,a._y,a.id),a.state&&(this.state=Object.assign({},a.state)),this.target=r.target,this.namespace=r.namespace,r.properties&&(this.properties=r.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=a.source,this.sourceLayer=a.sourceLayer,this.layer=a.layer)}toJSON(){const a=super.toJSON();return a.target=this.target,a.namespace=this.namespace,a}},o.dx=Gv,o.dy=op,o.dz=function(a){return a({pluginStatus:Yo,pluginURL:ju}),Gv.on("pluginStateChange",a),a},o.e=Di,o.e$=function([a,r,s]){const u=Math.hypot(a,r,s),h=Math.atan2(a,s),g=.5*Math.PI-Math.acos(-r/u);return new B(Bo(h),Bo(g))},o.e0=(a,r,s,u,h,g)=>{const y=a.transform,b=y.projection.name==="globe";let T;if(g.paint.get("circle-pitch-alignment")==="map")if(b){const k=_R(y.zoom,r.canonical)*y._pixelsPerMercatorPixel;T=Float32Array.from([k,0,0,k])}else T=y.calculatePixelsToTileUnitsMatrix(s);else T=new Float32Array([y.pixelsToGLUnits[0],0,0,y.pixelsToGLUnits[1]]);const E={u_camera_to_center_distance:a.transform.getCameraToCenterDistance(y.projection),u_matrix:a.translatePosMatrix(r.projMatrix,s,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_device_pixel_ratio:pa.devicePixelRatio,u_extrude_scale:T,u_inv_rot_matrix:I8,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:g.paint.get("circle-emissive-strength")};if(b){E.u_inv_rot_matrix=u,E.u_merc_center=h,E.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],E.u_zoom_transition=Vh(y.zoom);const k=h[0]*Vt,P=h[1]*Vt;E.u_up_dir=y.projection.upVector(new za(0,0,0),k,P)}return E},o.e1=nN,o.e2=ia,o.e3=(a,r,s,u,h,g,y,b,T,E)=>{const k=a.transform,P=k.pitch<15?eN(.07,.7,se((14-k.zoom)/5,0,1)):.07,R=s.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:rN(a,r,s,u),u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:k.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:h,u_width_scale:g,u_floor_width_scale:y,u_image:0,u_tile_units_to_pixels:tN(r,k),u_units_to_pixels:[1/k.pixelsToGLUnits[0],1/k.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:b,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toPremultipliedRenderColor(R?null:s.lut).toArray01(),u_emissive_strength:s.paint.get("line-emissive-strength"),u_zbias_factor:P,u_tile_to_meter:Ie(r.tileID.canonical,0),u_ground_shadow_factor:T,u_pattern_transition:E}},o.e4=(a,r,s,u,h,g,y,b,T,E)=>{const k=a.transform,P=k.calculatePixelsToTileUnitsMatrix(r),R=s.paint.get("line-trim-color-use-theme").constantOr("default")==="none",L=k.pitch<15?eN(.07,.7,se((14-k.zoom)/5,0,1)):.07;return{u_matrix:rN(a,r,s,u),u_pixels_to_tile_units:P,u_device_pixel_ratio:g,u_width_scale:y,u_floor_width_scale:b,u_units_to_pixels:[1/k.pixelsToGLUnits[0],1/k.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:iN(s)&&r.lineAtlasTexture?r.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:tN(r,a.transform),u_alpha_discard_threshold:0,u_trim_offset:T,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toPremultipliedRenderColor(R?null:s.lut).toArray01(),u_emissive_strength:s.paint.get("line-emissive-strength"),u_zbias_factor:L,u_tile_to_meter:Ie(r.tileID.canonical,0),u_ground_shadow_factor:E}},o.e5=Ue,o.e6=yx,o.e7=Ee,o.e8=Td,o.e9=Jw,o.eA=RC,o.eB=a1,o.eC=o1,o.eD=[1,1,1],o.eE=f_,o.eF=Ct,o.eG=function(a,r,s,u){var h=r[0],g=r[1],y=r[2],b=r[3];return a[0]=h+u*(s[0]-h),a[1]=g+u*(s[1]-g),a[2]=y+u*(s[2]-y),a[3]=b+u*(s[3]-b),a},o.eH=i_,o.eI=dl,o.eJ=Pu,o.eK=function(a,r,s,u,h,g,y,b,T,E,k,P,R,L,z,W){var J=new I(16);return J[0]=a,J[1]=r,J[2]=s,J[3]=u,J[4]=h,J[5]=g,J[6]=y,J[7]=b,J[8]=T,J[9]=E,J[10]=k,J[11]=P,J[12]=R,J[13]=L,J[14]=z,J[15]=W,J},o.eL=M,o.eM=ox,o.eN=Fp,o.eO=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new wt(1/0,1/0),max:new wt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(a,r=!1){const s=YR(new wt(0,0),new wt(Vt,Vt),a),u=[];if(r&&!FE(s,this._globalClipBounds))return u;for(const h of this._activeRegions){if(h.hiddenByOverlap||!FE(s,h))continue;const g=iq(h.min,h.max,a);u.push({min:g.min,max:g.max,sourceId:this._sourceIds[h.priority],footprint:h.footprint,footprintTileId:h.tileId,order:h.order,clipMask:h.clipMask,clipScope:h.clipScope})}return u}setSources(a){this._setSources(a.map(r=>({getSourceId:()=>r.cache.id,getFootprints:()=>{const s=[];for(const u of r.cache.getVisibleCoordinates()){const h=r.cache.getTile(u).buckets[r.layer];h&&h.updateFootprints(u.toUnwrapped(),s)}return s},getOrder:()=>r.order,getClipMask:()=>r.clipMask,getClipScope:()=>r.clipScope})))}_addSource(a){const r=a.getFootprints();if(r.length===0)return;const s=a.getOrder(),u=a.getClipMask(),h=a.getClipScope();for(const g of r){if(!g.footprint)continue;const y=YR(g.footprint.min,g.footprint.max,g.id);this._activeRegions.push({min:y.min,max:y.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:g.id,footprint:g.footprint,order:s,clipMask:u,clipScope:h})}this._sourceIds.push(a.getSourceId())}_computeReplacement(){this._activeRegions.sort((r,s)=>r.priority-s.priority||Xw(r.min,s.min)||Xw(r.max,s.max)||r.order-s.order||r.clipMask-s.clipMask||function(u,h){const g=(y,b)=>y+b;return u.length-h.length||u.reduce(g,"").localeCompare(h.reduce(g,""))}(r.clipScope,s.clipScope));let a=this._activeRegions.length!==this._prevRegions.length;if(!a){let r=0;for(;!a&&r!==this._activeRegions.length;){const s=this._activeRegions[r],u=this._prevRegions[r];a=s.priority!==u.priority||!KR(s,u)||s.order!==u.order||s.clipMask!==u.clipMask||!jo(s.clipScope,u.clipScope),this._activeRegions[r].hiddenByOverlap=u.hiddenByOverlap,++r}}if(a){++this._updateTime;for(const s of this._activeRegions)s.order!==Tx&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,s.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,s.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,s.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,s.max.y));const r=s=>{const u=this._activeRegions;if(s>=u.length)return s;const h=u[s].priority;for(;s<u.length&&u[s].priority===h;)++s;return s};if(this._sourceIds.length>1){let s=0,u=r(s);for(;s!==u;){let h=s;const g=s;for(;h!==u;){const y=this._activeRegions[h];y.hiddenByOverlap=!1;for(let b=0;b<g;b++){const T=this._activeRegions[b];if(!T.hiddenByOverlap&&y.order===Tx&&FE(y,T)&&(y.hiddenByOverlap=JR(y.footprint,y.tileId,T.footprint,T.tileId),y.hiddenByOverlap))break}++h}s=u,u=r(s)}}}}_setSources(a){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let r=a.length-1;r>=0;r--)this._addSource(a[r]);this._computeReplacement()}},o.eP=Tx,o.eQ=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();for(const a of this._gridSegments)a.withSkirts.destroy(),a.withoutSkirts.destroy()}_fillGridMeshWithLods(a,r){const s=new sa,u=new Ui,h=[],g=a+1+2,y=r[0]+1,b=r[0]+1+(1+r.length),T=(E,k,P)=>{let R=E===g-1?E-2:E===0?E:E-1;return R+=P?24575:0,[R,k]};for(let E=0;E<g;++E)s.emplaceBack(...T(E,0,!0));for(let E=0;E<y;++E)for(let k=0;k<g;++k)s.emplaceBack(...T(k,E,(k===0||k===g-1)&&!0));for(let E=0;E<r.length;++E){const k=r[E];for(let P=0;P<g;++P)s.emplaceBack(...T(P,k,!0))}for(let E=0;E<r.length;++E){const k=u.length,P=r[E]+1+2,R=new Ui;for(let W=0;W<P-1;W++){const J=W===P-2,te=J?g*(b-r.length+E-W):g;for(let ae=0;ae<g-1;ae++){const ue=W*g+ae;W===0||J||ae===0||ae===g-2?(R.emplaceBack(ue+1,ue,ue+te),R.emplaceBack(ue+te,ue+te+1,ue+1)):(u.emplaceBack(ue+1,ue,ue+te),u.emplaceBack(ue+te,ue+te+1,ue+1))}}const L=Zi.simpleSegment(0,k,s.length,u.length-k);for(let W=0;W<R.uint16.length;W+=3)u.emplaceBack(R.uint16[W],R.uint16[W+1],R.uint16[W+2]);const z=Zi.simpleSegment(0,k,s.length,u.length-k);h.push({withoutSkirts:L,withSkirts:z})}return{vertices:s,indices:u,segments:h}}_createGrid(a){const r=this._fillGridMeshWithLods(m,v);this._gridSegments=r.segments,this._gridBuffer=a.createVertexBuffer(r.vertices,hR.members),this._gridIndexBuffer=a.createIndexBuffer(r.indices,!0)}_createPoles(a){const r=new Ui;for(let y=0;y<=m;y++)r.emplaceBack(0,y+1,y+2);this._poleIndexBuffer=a.createIndexBuffer(r,!0);const s=new Sd,u=new Sd,h=new Sd,g=new Sd;this._poleSegments=[];for(let y=0,b=0;y<p;y++){const T=360/(1<<y);s.emplaceBack(0,-oa,0,.5,0),u.emplaceBack(0,-oa,0,.5,1),h.emplaceBack(0,-oa,0,.5,.5),g.emplaceBack(0,-oa,0,.5,.5);for(let E=0;E<=m;E++){let k=E/m,P=0;const R=Br(0,T,k),[L,z,W]=C(A8,j8,R,oa);s.emplaceBack(L,z,W,k,P),u.emplaceBack(L,z,W,k,1-P);const J=gn(R);k=.5+.5*Math.sin(J),P=.5+.5*Math.cos(J),h.emplaceBack(L,z,W,k,P),g.emplaceBack(L,z,W,k,1-P)}this._poleSegments.push(Zi.simpleSegment(b,0,66,64)),b+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(s,Yg,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(u,Yg,!1),this._texturedPoleNorthVertexBuffer=a.createVertexBuffer(h,Yg,!1),this._texturedPoleSouthVertexBuffer=a.createVertexBuffer(g,Yg,!1)}getGridBuffers(a,r){return[this._gridBuffer,this._gridIndexBuffer,r?this._gridSegments[a].withSkirts:this._gridSegments[a].withoutSkirts]}getPoleBuffers(a,r){return[r?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,r?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}},o.eR=ZR,o.eS=qe,o.eT=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.eU=re,o.eV=ve,o.eW=function(a,r,s){return a[0]=r[0]/s[0],a[1]=r[1]/s[1],a[2]=r[2]/s[2],a},o.eX=Is,o.eY=j,o.eZ=Ut,o.e_=st,o.ea=fM,o.eb=$h,o.ec=nM,o.ed=rM,o.ee=Se,o.ef=function(a,r){if(a===r){var s=r[1],u=r[2],h=r[3],g=r[6],y=r[7],b=r[11];a[1]=r[4],a[2]=r[8],a[3]=r[12],a[4]=s,a[6]=r[9],a[7]=r[13],a[8]=u,a[9]=g,a[11]=r[14],a[12]=h,a[13]=y,a[14]=b}else a[0]=r[0],a[1]=r[4],a[2]=r[8],a[3]=r[12],a[4]=r[1],a[5]=r[5],a[6]=r[9],a[7]=r[13],a[8]=r[2],a[9]=r[6],a[10]=r[10],a[11]=r[14],a[12]=r[3],a[13]=r[7],a[14]=r[11],a[15]=r[15];return a},o.eg=eH,o.eh=vn,o.ei=lx,o.ej=256,o.ek=jE,o.el=Na,o.em=pe,o.en=function(a,r){return a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[4],a[4]=r[5],a[5]=r[6],a[6]=r[8],a[7]=r[9],a[8]=r[10],a},o.eo=Sd,o.ep=sx,o.eq=fw,o.er=function(a,r,s,u,h){return se((a-r)/(s-r)*(h-u)+u,u,h)},o.es=pi,o.et=function(a,r){var s=r[0],u=r[1],h=r[2],g=r[3],y=r[4],b=r[5],T=r[6],E=r[7],k=r[8],P=k*y-b*E,R=-k*g+b*T,L=E*g-y*T,z=s*P+u*R+h*L;return z?(a[0]=P*(z=1/z),a[1]=(-k*u+h*E)*z,a[2]=(b*u-h*y)*z,a[3]=R*z,a[4]=(k*s-h*T)*z,a[5]=(-b*s+h*g)*z,a[6]=L*z,a[7]=(-E*s+u*T)*z,a[8]=(y*s-u*g)*z,a):null},o.eu=2,o.ev=vr,o.ew=br,o.ex=Je,o.ey=function(a,r){var s=new I(3);Je(s,r);var u=1/s[0],h=1/s[1],g=1/s[2],y=r[0]*u,b=r[1]*h,T=r[2]*g,E=r[4]*u,k=r[5]*h,P=r[6]*g,R=r[8]*u,L=r[9]*h,z=r[10]*g,W=y+k+z,J=0;return W>0?(J=2*Math.sqrt(W+1),a[3]=.25*J,a[0]=(P-L)/J,a[1]=(R-T)/J,a[2]=(b-E)/J):y>k&&y>z?(J=2*Math.sqrt(1+y-k-z),a[3]=(P-L)/J,a[0]=.25*J,a[1]=(b+E)/J,a[2]=(R+T)/J):k>z?(J=2*Math.sqrt(1+k-y-z),a[3]=(R-T)/J,a[0]=(b+E)/J,a[1]=.25*J,a[2]=(P+L)/J):(J=2*Math.sqrt(1+z-y-k),a[3]=(b-E)/J,a[0]=(R+T)/J,a[1]=(P+L)/J,a[2]=.25*J),a},o.ez=function(a,r){var s=2*Math.acos(r[3]),u=Math.sin(s/2);return u>A?(a[0]=r[0]/u,a[1]=r[1]/u,a[2]=r[2]/u):(a[0]=1,a[1]=0,a[2]=0),s},o.f=function(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,(r,s)=>String.fromCharCode(+("0x"+s))))},o.f0=jr,o.f1=eC,o.f2=function(a){const r=a.navigator?a.navigator.userAgent:null;return!!function(s){if(ms==null){const u=s.navigator?s.navigator.userAgent:null;ms=!!s.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return ms}(a)&&!(!r||!(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},o.f3=function(a,r){sp=a,na=r},o.f4=kE,o.f5=vR,o.f6=function(a){const r=[0,0,0],s=Z(new Float64Array(16));return H(s,a.pixelMatrix,a.globeMatrix),hn(r,r,s),new wt(r[0],r[1])},o.f7=function(){const a=kx;a&&(a.isPreloaded()&&a.numActive()===1?(a.release(HE),kx=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.f8=function(){e1().acquire(HE)},o.f9=Hv,o.fA=Et,o.fB=function(a){let r=0;if(new Uint32Array(a,0,1)[0]!==kM){const s=new Uint32Array(a,0,7),[,,u,h,g,y]=s;r=s.byteLength+h+g+y+g,(u!==a.byteLength||r>=a.byteLength)&&Cr("Invalid b3dm header information.")}return NM(a,r)},o.fC=function(a,r){const s=sC(a);for(const u of s){for(const h of u.meshes)Dq(h);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(Oq(u.lights,r)))}return s},o.fD=A1,o.fE=ns,o.fF=EM,o.fG=_a,o.fH=ga,o.fI=function(a){od(),Ko!=null&&Ko.then(r=>{r.keys().then(s=>{for(let u=0;u<s.length-a;u++)r.delete(s[u]).catch(h=>Cr(h.message))}).catch(s=>Cr(s.message))}).catch(r=>Cr(r.message))},o.fa=function(a,r,s=!1){if(Yo===ga.deferred||Yo===ga.loading||Yo===ga.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");ju=pa.resolveURL(a),Yo=ga.deferred,$v=r,qv(),s||Wv()},o.fb=function(a){t_=pa.resolveURL(a),r_||(r_=new e_(e1(),new Ic)),r_.broadcast("setMeshoptUrl",t_)},o.fc=jM,o.fd=function(a){ZE=pa.resolveURL(a),r_||(r_=new e_(e1(),new Ic)),r_.broadcast("setDracoUrl",ZE)},o.fe=AM,o.ff=Ix,o.fg=function(a){const r=jc();if(!r)return;const s=r.delete(ip);a&&s.then(()=>a()).catch(a)},o.fh=Zp,o.fi=or,o.fj=Uh,o.fk=$c,o.fl=XD,o.fm=KD,o.fn=KM,o.fo=er,o.fp="hd_road_elevation",o.fq=Zr,o.fr=Dt,o.fs=Cd,o.ft=gC,o.fu=Yp,o.fv=function(a,r,s,u,h,g,y,b=1,T,E,k){a.createArrays(),a.tilePixelRatio=Vt/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const P=a.layers[0].layout,R=a.layers[0]._unevaluatedLayout._values,L={};L.scaleFactor=b,L.textSizeScaleRange=P.get("text-size-scale-range"),L.iconSizeScaleRange=P.get("icon-size-scale-range");const[z,W]=L.textSizeScaleRange,[J,te]=L.iconSizeScaleRange;L.textScaleFactor=se(L.scaleFactor,z,W),L.iconScaleFactor=se(L.scaleFactor,J,te);const ae=R["text-size"],ue=R["icon-size"];if(a.textSizeData.kind==="composite"){const{minZoom:ze,maxZoom:ct}=a.textSizeData;L.compositeTextSizes=[ae.possiblyEvaluate(new Ai(ze,{worldview:k}),g),ae.possiblyEvaluate(new Ai(ct,{worldview:k}),g)]}if(a.iconSizeData.kind==="composite"){const{minZoom:ze,maxZoom:ct}=a.iconSizeData;L.compositeIconSizes=[ue.possiblyEvaluate(new Ai(ze,{worldview:k}),g),ue.possiblyEvaluate(new Ai(ct,{worldview:k}),g)]}L.layoutTextSize=ae.possiblyEvaluate(new Ai(y+1,{worldview:k}),g),L.layoutIconSize=ue.possiblyEvaluate(new Ai(y+1,{worldview:k}),g),L.textMaxSize=ae.possiblyEvaluate(new Ai(18,{worldview:k}),g);const he=P.get("symbol-placement"),Ce=P.get("text-rotation-alignment")==="map"&&he!=="point",be=P.get("text-size");let ke=!1;const Me=[];for(const ze of a.features){const ct=P.get("text-font").evaluate(ze,{},g).join(","),We=be.evaluate(ze,{},g)*L.textScaleFactor,ut=L.layoutTextSize.evaluate(ze,{},g)*L.textScaleFactor,gt=L.layoutIconSize.evaluate(ze,{},g)*L.iconScaleFactor,St={horizontal:{},vertical:void 0},Lt=ze.text;let kt,_t=[0,0];if(Lt){const pn=Lt.toString(),zn=P.get("text-letter-spacing").evaluate(ze,{},g)*go,rn=P.get("text-line-height").evaluate(ze,{},g)*go,Hn=yw(pn)?zn:0,Wn=P.get("text-anchor").evaluate(ze,{},g),Hi=P.get("text-variable-anchor");if(!Hi){const ft=P.get("text-radial-offset").evaluate(ze,{},g);if(ft)_t=MN(Wn,[ft*go,vC]);else{const Xt=P.get("text-offset").evaluate(ze,{},g);_t=[Xt[0]*go,Xt[1]*go]}}let we=Ce?"center":P.get("text-justify").evaluate(ze,{},g);const _e=he==="point",ht=_e?P.get("text-max-width").evaluate(ze,{},g)*go:1/0,Ht=ft=>{a.allowVerticalPlacement&&Bv(pn)&&(St.vertical=hC(Lt,r,s,h,ct,ht,rn,Wn,ft,Hn,_t,Va.vertical,!0,ut,We,T))};if(!Ce&&Hi){const ft=we==="auto"?Hi.map(mr=>xC(mr)):[we];let Xt=!1;for(let mr=0;mr<ft.length;mr++){const fr=ft[mr];if(!St.horizontal[fr])if(Xt)St.horizontal[fr]=St.horizontal[0];else{const nn=hC(Lt,r,s,h,ct,ht,rn,"center",fr,Hn,_t,Va.horizontal,!1,ut,We,T);nn&&(St.horizontal[fr]=nn,Xt=nn.positionedLines.length===1)}}Ht("left")}else{if(we==="auto"&&(we=xC(Wn)),_e||P.get("text-writing-mode").indexOf("horizontal")>=0||!Bv(pn)){const ft=hC(Lt,r,s,h,ct,ht,rn,Wn,we,Hn,_t,Va.horizontal,!1,ut,We,T);ft&&(St.horizontal[we]=ft)}Ht(_e?"left":we)}}let It,ot,rt,At,Nt,xt,sr=!1;const cr=P.get("icon-text-fit").evaluate(ze,{},g);if(ze.icon&&ze.icon.hasPrimary()){const pn=Bx(ze.icon,a.iconSizeData,R["icon-size"],g,a.zoom,ze,T,L.iconScaleFactor,k);It=pn.iconPrimary,rt=pn.iconSecondary;const zn=It.toString();if(ot=u.get(zn),ot&&(Nt=P.get("icon-offset").evaluate(ze,{},g),xt=P.get("icon-anchor").evaluate(ze,{},g),kt=h1(h.get(zn),rt?h.get(rt.toString()):void 0,Nt,xt),sr=ot.sdf,a.sdfIcons===void 0?a.sdfIcons=ot.sdf:a.sdfIcons!==ot.sdf&&Cr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ot.pixelRatio!==a.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0)),rt){const rn=rt.toString();At=u.get(rn)}}ke=ke||!(!ze.icon||!ze.icon.hasSecondary());const tr=bC(St.horizontal)||St.vertical;a.iconsInText||(a.iconsInText=!!tr&&tr.iconsInText);const Zt=ut*L.textScaleFactor/go,{defaultShapedIcon:Xr,verticallyShapedIcon:Jt}=BG(a,kt,P,ze,g,St,Zt,Nt,cr);cr!=="none"&&kt&&(yN(kt)||vN(kt))&&(_1(0,ot,It,kt,Xr,cr,E,u,h),_1(0,At,rt,kt,Xr,cr,E,u,h),Jt&&(_1(0,ot,It,kt,Jt,cr,E,u,h),_1(0,At,rt,kt,Jt,cr,E,u,h))),kt=Xr;const{iconBBox:Tr,iconVerticalBBox:Jr}=LG(a,kt,Jt,P,ze,g,gt,Nt,L,h,xt);Me.push({feature:ze,shapedTextOrientations:St,shapedText:tr,shapedIcon:kt,iconPrimary:It,iconSecondary:rt,iconOffset:Nt,iconAnchor:xt,verticallyShapedIcon:Jt,layoutTextSize:ut,layoutIconSize:gt,textOffset:_t,isSDFIcon:sr,iconTextFit:cr,iconCollisionBounds:Tr,iconVerticalCollisionBounds:Jr})}return{featureData:Me,sizes:L,hasAnySecondaryIcon:ke,textAlongLine:Ce,symbolPlacement:he}},o.fw=AN,o.fx=function(a,r,s,u,h,g,y,b,T,E){a.iconAtlasPositions=E.iconPositions;const{featureData:k,hasAnySecondaryIcon:P,sizes:R,textAlongLine:L,symbolPlacement:z}=r;for(const W of k){const{shapedIcon:J,verticallyShapedIcon:te,feature:ae,shapedTextOrientations:ue,shapedText:he,layoutTextSize:Ce,textOffset:be,isSDFIcon:ke,iconPrimary:Me,iconSecondary:ze,iconTextFit:ct,iconOffset:We,iconCollisionBounds:ut,iconVerticalCollisionBounds:gt}=W;DN(J,E.iconPositions,Me,ze),DN(te,E.iconPositions,Me,ze),FG(ue,E.iconPositions),zG(Me,ze,E.iconPositions),(he||J)&&VG(a,ae,ue,J,te,T,R,Ce,0,be,ke,u,h,y,b,P,ct,We,L,z,ut,gt)}s&&a.generateCollisionDebugBuffers(g,a.collisionBoxArray,R.textScaleFactor)},o.fy=ur,o.fz=M1,o.g=function(a,r){return op(Object.assign(a,{method:"GET"}),r)},o.h=function(a){return a.indexOf("mapbox:")===0},o.i=function(a){return Di.API_STYLE_REGEX.test(a)&&!Vo(a)},o.j=qs,o.k=Xm,o.l=function(a){return decodeURIComponent(atob(a).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join(""))},o.m=function(a,r){return op(Object.assign(a,{type:"json"}),r)},o.n=sv,o.o=pa,o.p=function(a,r){return op(Object.assign(a,{method:"POST"}),r)},o.q=Po,o.r=fa,o.s=function(a){try{const r=self[a];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch{return!1}},o.t=function(){return WE||(WE=new Zp),WE},o.u=function(){return function a(r){return r?(r^Math.random()*(16>>r/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()},o.v=function(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)},o.w=Cr,o.x=LC,o.y=fp,o.z=ka}),_(["./shared"],function(o){function A(qe){const re=qe?qe.url.toString():void 0;return re?performance.getEntriesByName(re):[]}function I(qe){if(typeof qe=="number"||typeof qe=="boolean"||typeof qe=="string"||qe==null)return JSON.stringify(qe);if(Array.isArray(qe)){let se="[";for(const ye of qe)se+=`${I(ye)},`;return`${se}]`}let re="{";for(const se of Object.keys(qe).sort())re+=`${se}:${I(qe[se])},`;return`${re}}`}function N(qe){let re="";for(const se of o.bw)re+=`/${I(qe[se])}`;return re}class U{constructor(re){this.keyCache={},this._layers={},this._layerConfigs={},re&&this.replace(re)}replace(re,se){this._layerConfigs={},this._layers={},this.update(re,[],se)}update(re,se,ye){this._options=ye;for(const Pe of re)this._layerConfigs[Pe.id]=Pe,(this._layers[Pe.id]=o.dt(Pe,this.scope,null,this._options)).compileFilter(ye),this.keyCache[Pe.id]&&delete this.keyCache[Pe.id];for(const Pe of se)delete this.keyCache[Pe],delete this._layerConfigs[Pe],delete this._layers[Pe];this.familiesBySource={};const Re=function(Pe,Ve){const it={};for(let tt=0;tt<Pe.length;tt++){const Dt=Pe[tt];let jt=Ve&&Ve[Dt.id];jt||(Dt.type==="symbol"?jt=Dt.id:(jt=N(Dt),Dt.type==="line"&&Dt.paint&&function Wr($r){return typeof $r=="string"&&$r==="line-progress"||(Array.isArray($r)?$r.some(Wr):!(!$r||typeof $r!="object")&&Object.values($r).some(Wr))}(Dt.paint["line-width"])&&(jt+=`/${I(Dt.paint["line-width"])}`))),Ve&&(Ve[Dt.id]=jt);let pr=it[jt];pr||(pr=it[jt]=[]),pr.push(Dt)}const Ue=[];for(const tt in it)Ue.push(it[tt]);return Ue}(Object.values(this._layerConfigs),this.keyCache);for(const Pe of Re){const Ve=Pe.map(pr=>this._layers[pr.id]),it=Ve[0];if(it.visibility==="none")continue;const Ue=it.source||"";let tt=this.familiesBySource[Ue];tt||(tt=this.familiesBySource[Ue]={});const Dt=it.sourceLayer||"_geojsonTileLayer";let jt=tt[Dt];jt||(jt=tt[Dt]=[]),jt.push(Ve)}}}const $=1*o.fk;class V{constructor(re){const se={},ye=[];for(const it in re){const Ue=re[it],tt=se[it]={};for(const Dt in Ue.glyphs){const jt=Ue.glyphs[+Dt];if(!jt||jt.bitmap.width===0||jt.bitmap.height===0)continue;const pr=jt.metrics.localGlyph?$:1,Wr={x:0,y:0,w:jt.bitmap.width+2*pr,h:jt.bitmap.height+2*pr};ye.push(Wr),tt[Dt]=Wr}}const{w:Re,h:Pe}=o.G(ye),Ve=new o.fj({width:Re||1,height:Pe||1});for(const it in re){const Ue=re[it];for(const tt in Ue.glyphs){const Dt=Ue.glyphs[+tt];if(!Dt||Dt.bitmap.width===0||Dt.bitmap.height===0)continue;const jt=se[it][tt],pr=Dt.metrics.localGlyph?$:1;o.fj.copy(Dt.bitmap,Ve,{x:0,y:0},{x:jt.x+pr,y:jt.y+pr},Dt.bitmap)}}this.image=Ve,this.positions=se}}function Y(qe,re,se){qe[re]?se&&(qe[re].center=se):qe[re]={floorIds:new Set,center:se||[0,0],floors:{}}}function q(qe,re,se,ye){for(const Re of re)Y(qe,Re),qe[Re].floors[se]=ye,qe[Re].floorIds.add(se)}function Z(qe){return{id:qe.properties.id.toString(),center:qe.properties.center.toString().split(";").map(Number)}}function Q(qe){return{id:qe.properties.id.toString(),isDefault:!!qe.properties.is_default&&qe.properties.is_default,connections:qe.properties.connected_floor_ids?new Set(qe.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:qe.properties.conflicted_floor_ids?new Set(qe.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:qe.properties.building_ids?new Set(qe.properties.building_ids.toString().split(";")):new Set,name:qe.properties.name.toString(),zIndex:qe.properties.z_index}}function H(qe,re){return re.every(se=>qe.properties&&qe.properties[se]!=null)}function K(qe){return H(qe,["type","id","name"])&&qe.properties.type==="building"}function ne(qe){return H(qe,["type","id","name","z_index"])&&qe.properties.type==="floor"}o.fi(V,"GlyphAtlas");class le{constructor(re){this.tileID=new o.aP(re.tileID.overscaledZ,re.tileID.wrap,re.tileID.canonical.z,re.tileID.canonical.x,re.tileID.canonical.y),this.tileZoom=re.tileZoom,this.uid=re.uid,this.zoom=re.zoom,this.lut=re.lut,this.canonical=re.tileID.canonical,this.pixelRatio=re.pixelRatio,this.tileSize=re.tileSize,this.source=re.source,this.scope=re.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=re.showCollisionBoxes,this.collectResourceTiming=!!re.request&&re.request.collectResourceTiming,this.promoteId=re.promoteId,this.isSymbolTile=re.isSymbolTile,this.tileTransform=o.aY(re.tileID.canonical,re.projection),this.projection=re.projection,this.worldview=re.worldview,this.localizableLayerIds=re.localizableLayerIds,this.brightness=re.brightness,this.extraShadowCaster=!!re.extraShadowCaster,this.tessellationStep=re.tessellationStep,this.scaleFactor=re.scaleFactor,this.worldview=re.worldview,this.indoor=re.indoor}parse(re,se,ye,Re,Pe,Ve){this.status="parsing",this.data=re,this.collisionBoxArray=new o.b2;const it=new o.fl(Object.keys(re.layers).sort()),Ue=new o.fm(this.tileID,this.promoteId);Ue.bucketLayerIDs=[];const tt={},Dt=new o.fn(256,256),jt={featureIndex:Ue,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Dt,availableImages:ye,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const Cr=this.indoor.indoorState.activeFloorsVisible,fn=function(yn,hi,ns){const ks=function(ci,kn){if(!ci)return o.w("No source layers defined in indoor specification"),kn;if(ci.size===0)return kn;const Ni=ci.difference(kn);for(const Qi of Ni)o.w(`Missing source layer required in indoor specification: ${Qi}`);return kn.intersection(kn)}(hi.sourceLayers,new Set(Object.keys(yn.layers))),ms=hi.indoorState,us=function(ci,kn,Ni,Qi){const mi=new Set,Di=new Set,qs=new Set,Vo=new Map,rl={},sd=Js=>{const nl=Vo.get(Js)||new Set;for(const Xo of mi)if((Vo.get(Xo)||new Set).has(Js)||nl.has(Xo))return!0;return!1};for(const Js of kn){const nl=ci.layers[Js];if(nl)for(let Xo=0;Xo<nl.length;Xo++){const kl=nl.feature(Xo);if(K(kl)){const{id:fa,center:pa}=Z(kl);Y(rl,fa,pa),mi.add(fa)}else if(ne(kl)){const{id:fa,isDefault:pa,connections:Wm,conflicts:np,buildings:ip,name:sp,zIndex:na}=Q(kl);q(rl,ip,fa,{name:sp,zIndex:na}),Vo.set(fa,np),(fa===Qi||Wm.has(Qi))&&mi.add(fa),Di.add(fa),pa&&qs.add(fa)}}else o.w(`indoor source layer not found: ${Js}`)}if(Ni)for(const Js of Ni)Di.has(Js)&&(sd(Js)||mi.add(Js));for(const Js of qs)mi.has(Js)||sd(Js)||mi.add(Js);return{buildings:rl,activeFloors:mi}}(yn,ks,ms.lastActiveFloors,ms.selectedFloorId);return ns.send("setIndoorData",us),us}(re,this.indoor,Pe);jt.activeFloors=Cr?fn.activeFloors:void 0}const pr=[],Wr=se.familiesBySource[this.source];for(const Cr in Wr){const fn=re.layers[Cr];if(!fn)continue;let yn=!1,hi=!1,ns=!1;for(const ci of Wr[Cr])ci[0].type==="symbol"?yn=!0:hi=!0,ci[0].is3D()&&ci[0].type!=="model"&&(ns=!0);if(this.extraShadowCaster&&!ns||this.isSymbolTile===!0&&!yn||this.isSymbolTile===!1&&!hi)continue;fn.version===1&&o.w(`Vector tile source "${this.source}" layer "${Cr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ks=it.encode(Cr),ms=[];let us=!1;for(let ci=0,kn=0;ci<fn.length;ci++){const Ni=fn.feature(ci),Qi=Ue.getId(Ni,Cr);if(this.localizableLayerIds&&this.localizableLayerIds.has(Cr)){const mi=Ni.properties?Ni.properties.worldview:null;if(this.worldview&&typeof mi=="string")if(mi==="all")Ni.properties.$localized=!0;else{if(!mi.split(",").includes(this.worldview))continue;Ni.properties.$localized=!0,Ni.properties.worldview=this.worldview}}!us&&Ni.properties&&Ni.properties.hasOwnProperty(o.fo)&&(us=!0),ms.push({feature:Ni,id:Qi,index:kn,sourceLayerIndex:ks}),kn++}us&&!jt.elevationFeatures&&re.layers.hasOwnProperty(o.fp)&&(jt.elevationFeatures=o.fq.parseFrom(re.layers[o.fp],this.canonical));for(const ci of Wr[Cr]){const kn=ci[0];if(this.extraShadowCaster&&(!kn.is3D()||kn.type==="model")||this.isSymbolTile!==void 0&&kn.type==="symbol"!==this.isSymbolTile||kn.minzoom&&this.zoom<Math.floor(kn.minzoom)||kn.maxzoom&&this.zoom>=kn.maxzoom||kn.visibility==="none")continue;pe(ci,this.zoom,jt.brightness,ye,this.worldview);const Ni=tt[kn.id]=kn.createBucket({index:Ue.bucketLayerIDs.length,layers:ci,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ks,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Re,worldview:this.worldview});Ue.bucketLayerIDs.push(ci.map(mi=>o.B(mi.id,mi.scope)));let Qi=Ni.prepare?Ni.prepare():null;Qi!=null?(Qi=Qi.then(()=>Ni.populate(ms,jt,this.tileID.canonical,this.tileTransform)),pr.push(Qi)):Ni.populate(ms,jt,this.tileID.canonical,this.tileTransform)}}const $r=()=>{let Cr,fn,yn,hi,ns,ks;Dt.trim();const ms={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},us=()=>{if(Cr)return this.status="done",Ve(Cr);if(this.extraShadowCaster)this.status="done",Ve(null,{buckets:Object.values(tt).filter(kn=>!kn.isEmpty()),featureIndex:Ue,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:jt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(fn&&yn&&hi){const kn=new V(fn),Ni=new Map;for(const[Di,qs]of yn.entries()){const{imagePosition:Vo}=o.ft(Di,qs,o.fu);Ni.set(Di,Vo)}const Qi={};for(const Di in tt){const qs=tt[Di];qs instanceof o.b3&&(pe(qs.layers,this.zoom,jt.brightness,ye,this.worldview),Qi[Di]=o.fv(qs,fn,kn.positions,yn,Ni,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,ns,this.worldview))}const mi={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Pe,yn,ns,()=>{mi.iconsPending=!1,ci(Qi,kn,mi)}),this.rasterizeIfNeeded(Pe,hi,ks,()=>{mi.patternsPending=!1,ci(Qi,kn,mi)})}},ci=(kn,Ni,Qi,mi)=>{if(Qi.iconsPending||Qi.patternsPending)return;const Di=new o.fw(yn,hi,this.lut);for(const qs in tt){const Vo=tt[qs];if(qs in kn)o.fx(Vo,kn[qs],this.showCollisionBoxes,ye,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,yn,Di);else if(Vo.hasPattern&&(Vo instanceof o.b9||Vo instanceof o.ba||Vo instanceof o.e9)){pe(Vo.layers,this.zoom,jt.brightness,ye,this.worldview);const rl=Object.fromEntries(Di.patternPositions);Vo.addFeatures(jt,this.tileID.canonical,rl,ye,this.tileTransform,this.brightness)}}this.status="done",Ve(null,{buckets:Object.values(tt).filter(qs=>!qs.isEmpty()),featureIndex:Ue,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ni.image,lineAtlas:Dt,imageAtlas:Di,brightness:jt.brightness})};if(!this.extraShadowCaster){const kn=o.fr(jt.glyphDependencies,mi=>Object.keys(mi).map(Number));Object.keys(kn).length?Pe.send("getGlyphs",{uid:this.uid,stacks:kn},(mi,Di)=>{Cr||(Cr=mi,fn=Di,us())},void 0,!1,ms):fn={};const Ni=Array.from(jt.iconDependencies.keys()).map(mi=>o.I.parse(mi));Ni.length?Pe.send("getImages",{images:Ni,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(mi,Di)=>{Cr||(Cr=mi,yn=new Map,ns=this.updateImageMapAndGetImageTaskQueue(yn,Di,jt.iconDependencies),us())},void 0,!1,ms):(yn=new Map,ns=new Map);const Qi=Array.from(jt.patternDependencies.keys()).map(mi=>o.I.parse(mi));Qi.length?Pe.send("getImages",{images:Qi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(mi,Di)=>{Cr||(Cr=mi,hi=new Map,ks=this.updateImageMapAndGetImageTaskQueue(hi,Di,jt.patternDependencies),us())},void 0,!1,ms):(hi=new Map,ks=new Map)}if(jt.elevationFeatures&&jt.elevationFeatures.length>0){const kn=[];for(const Qi of Object.values(tt))if(Qi instanceof o.ba){const mi=Qi.getUnevaluatedPortalGraph();mi&&kn.push(mi)}const Ni=o.fs.evaluate(kn);for(const Qi of Object.values(tt))if(Qi instanceof o.ba){const mi=re.layers[it.decode(Qi.sourceLayerIndex)];Qi.setEvaluatedPortalGraph(Ni,mi,this.tileID.canonical,jt.availableImages,jt.brightness)}}us()};pr.length>0?Promise.allSettled(pr).then($r).catch(Ve):$r()}updateParameters(re){this.scaleFactor=re.scaleFactor,this.showCollisionBoxes=re.showCollisionBoxes,this.projection=re.projection,this.brightness=re.brightness,this.tileTransform=o.aY(re.tileID.canonical,re.projection),this.extraShadowCaster=re.extraShadowCaster,this.lut=re.lut,this.worldview=re.worldview,this.indoor=re.indoor}rasterizeIfNeeded(re,se,ye,Re){Array.from(se.values()).some(Pe=>Pe.usvg)?this.rasterize(re,se,ye,Re):Re()}updateImageMapAndGetImageTaskQueue(re,se,ye){const Re=new Map;for(const Pe of se.keys()){const Ve=ye.get(Pe)||[];for(const it of Ve){const Ue=it.toString(),tt=se.get(it.id.toString());tt.usvg?Re.has(Ue)||(Re.set(Ue,it),re.set(Ue,Object.assign({},tt))):re.set(Ue,tt)}}return Re}rasterize(re,se,ye,Re){this.rasterizeTask=re.send("rasterizeImages",{scope:this.scope,tasks:ye},(Pe,Ve)=>{if(!Pe)for(const[it,Ue]of Ve.entries()){const tt=Object.assign(se.get(it),{data:Ue});se.set(it,tt)}Re()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function pe(qe,re,se,ye,Re){const Pe=new o.ac(re,{brightness:se,worldview:Re});for(const Ve of qe)Ve.recalculate(Pe,ye)}class Ae extends o.E{constructor(re,se,ye,Re,Pe,Ve,it){super(),this.actor=re,this.layerIndex=se,this.availableImages=ye,this.availableModels=Re,this.loadVectorData=Ve||o.aL,this.loading={},this.loaded={},this.deduped=new o.aK(re.scheduler),this.isSpriteLoaded=Pe,this.scheduler=re.scheduler,this.brightness=it}loadTile(re,se){const ye=re.uid,Re=re&&re.request,Pe=Re&&Re.collectResourceTiming,Ve=this.loading[ye]=new le(re);Ve.abort=this.loadVectorData(re,(it,Ue)=>{const tt=!this.loading[ye];if(delete this.loading[ye],Ve.cancelRasterize(),tt||it||!Ue)return Ve.status="done",tt||(this.loaded[ye]=Ve),se(it);const Dt=Ue.rawData,jt={},pr=o.aM(Ue.responseHeaders);pr&&pr.expires&&(jt.expires=pr.expires),pr&&pr.cacheControl&&(jt.cacheControl=pr.cacheControl),Ve.vectorTile=Ue.vectorTile||new o.fy(new o.bs(Dt));const Wr=()=>{Ve.parse(Ve.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,($r,Cr)=>{if($r||!Cr)return se($r);const fn={};if(Pe){const yn=A(Re);yn.length>0&&(fn.resourceTiming=JSON.parse(JSON.stringify(yn)))}se(null,Object.assign({rawTileData:Dt.slice(0),responseHeaders:Ue.responseHeaders},Cr,jt,fn))})};this.isSpriteLoaded?Wr():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Wr,{type:"parseTile",isSymbolTile:re.isSymbolTile,zoom:re.tileZoom}):Wr()}),this.loaded=this.loaded||{},this.loaded[ye]=Ve})}reloadTile(re,se){const ye=this.loaded,Re=re.uid;if(ye&&ye[Re]){const Pe=ye[Re];Pe.updateParameters(re);const Ve=(it,Ue)=>{const tt=Pe.reloadCallback;tt&&(delete Pe.reloadCallback,Pe.parse(Pe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,tt)),se(it,Ue)};Pe.status==="parsing"?Pe.reloadCallback=Ve:Pe.status==="done"&&(Pe.vectorTile?Pe.parse(Pe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ve):Ve())}else se(null,void 0)}abortTile(re,se){const ye=re.uid,Re=this.loading[ye];Re&&(Re.abort&&Re.abort(),delete this.loading[ye]),se()}removeTile(re,se){const ye=this.loaded,Re=re.uid;ye&&ye[Re]&&delete ye[Re],se()}}class Ze{loadTile(re,se){const{uid:ye,encoding:Re,rawImageData:Pe,padding:Ve}=re,it=ImageBitmap&&Pe instanceof ImageBitmap?this.getImageData(Pe,Ve):Pe;se(null,new o.fz(ye,it,Re,Ve<1))}reloadTile(re,se){se(null,null)}abortTile(re,se){se()}removeTile(re,se){se()}getImageData(re,se){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(re.width,re.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=re.width,this.offscreenCanvas.height=re.height,this.offscreenCanvasContext.drawImage(re,0,0,re.width,re.height);const ye=this.offscreenCanvasContext.getImageData(-se,-se,re.width+2*se,re.height+2*se);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ye}}o.br.setPbf(o.bs);class Xe{constructor(re){this._mrt=new o.br(re.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=re.uid,this.tileID=re.tileID,this.source=re.source}parse(re,se){const ye=this._mrt;this.status="parsing",this._entireBuffer=re;try{ye.parseHeader(re),this._isHeaderLoaded=!0;const Re=[];for(const Pe in ye.layers){const Ve=ye.getLayer(Pe),it=Ve.getDataRange(Ve.getBandList()),Ue=ye.createDecodingTask(it),tt=re.slice(it.firstByte,it.lastByte+1),Dt=o.br.performDecoding(tt,Ue).then(jt=>Ue.complete(null,jt)).catch(jt=>Ue.complete(jt,null));Re.push(Dt)}Promise.allSettled(Re).then(()=>se(null,ye)).catch(Pe=>se(Pe))}catch(Re){se(Re)}}}class Je{constructor(re){this.actor=re,this.loading={},this.loaded={}}loadTile(re,se){const ye=re.uid,Re=re.request,Pe=this.loading[ye]=new Xe(re),{cancel:Ve}=o.bt(Re,(it,Ue,tt)=>{const Dt=!this.loading[ye];if(delete this.loading[ye],Dt||it||!Ue)return Pe.status="done",Dt||(this.loaded[ye]=Pe),se(it);Pe.parse(Ue,(jt,pr)=>{if(jt||!pr)return se(jt);se(null,pr,tt)}),this.loaded[ye]=Pe});Pe.abort=Ve}reloadTile(re,se){se(null,void 0)}abortTile(re,se){const ye=re.uid,Re=this.loading[ye];Re&&(Re.abort&&Re.abort(),delete this.loading[ye]),se()}removeTile(re,se){const ye=re.uid;this.loaded[ye]&&delete this.loaded[ye],se()}decodeRasterArray(re,se){o.br.performDecoding(re.buffer,re.task).then(ye=>se(null,ye)).catch(ye=>se(ye))}}const Te=o.fA.prototype.toGeoJSON;class xe{constructor(re){this._feature=re,this.extent=o.al,this.type=re.type,this.properties=re.tags,"id"in re&&!isNaN(re.id)&&(this.id=parseInt(re.id,10))}loadGeometry(){if(this._feature.type===1){const re=[];for(const se of this._feature.geometry)re.push([new o.P(se[0],se[1])]);return re}{const re=[];for(const se of this._feature.geometry){const ye=[];for(const Re of se)ye.push(new o.P(Re[0],Re[1]));re.push(ye)}return re}}toGeoJSON(re,se,ye){return Te.call(this,re,se,ye)}}class Be{constructor(re,se){this.name=re,this.extent=o.al,this.length=se.length,this._jsonFeatures=se}feature(re){return new xe(this._jsonFeatures[re])}}class dt{constructor(re){this.layers={},this.extent=o.al;for(const se of Object.keys(re))this.layers[se]=new Be(se,re[se])}}const qt=64/4096,Ke=128;class st{constructor(){this.features=new Map}clear(){this.features.clear()}load(re=[],se){for(const ye of re){const Re=ye.id;if(Re==null)continue;let Pe=this.features.get(Re);Pe&&this.updateCache(Pe,se),ye.geometry?(Pe=De(ye),this.updateCache(Pe,se),this.features.set(Re,Pe)):this.features.delete(Re),this.updateCache(Pe,se)}}updateCache(re,se){for(const{canonical:ye,uid:Re}of Object.values(se)){const{z:Pe,x:Ve,y:it}=ye;Ne(re,Math.pow(2,Pe),Ve,it)&&delete se[Re]}}getTile(re,se,ye){const Re=Math.pow(2,re),Pe=[];for(const Ve of this.features.values())Ne(Ve,Re,se,ye)&&Pe.push(Le(Ve,Re,se,ye));return{features:Pe}}getFeatures(){return[...this.features.values()]}}function Ne({minX:qe,minY:re,maxX:se,maxY:ye},Re,Pe,Ve){return qe<(Pe+1+qt)/Re&&re<(Ve+1+qt)/Re&&se>(Pe-qt)/Re&&ye>(Ve-qt)/Re}function De(qe){const{id:re,geometry:se,properties:ye}=qe;if(!se)return;if(se.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Re,coordinates:Pe}=se,Ve={id:re,type:1,geometry:[],tags:ye,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},it=Ve.geometry;if(Re==="Point")Tt(Pe,it,Ve);else if(Re==="MultiPoint")for(const Ue of Pe)Tt(Ue,it,Ve);else if(Re==="LineString")Ve.type=2,Pt(Pe,it,Ve);else if(Re==="MultiLineString")Ve.type=2,fe(Pe,it,Ve);else if(Re==="Polygon")Ve.type=3,fe(Pe,it,Ve,!0);else{if(Re!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ve.type=3;for(const Ue of Pe)fe(Ue,it,Ve,!0)}return Ve}function Tt([qe,re],se,ye){const Re=o.aF(qe);let Pe=o.aJ(re);Pe=Pe<0?0:Pe>1?1:Pe,se.push(Re,Pe),ye.minX=Math.min(ye.minX,Re),ye.minY=Math.min(ye.minY,Pe),ye.maxX=Math.max(ye.maxX,Re),ye.maxY=Math.max(ye.maxY,Pe)}function Pt(qe,re,se,ye=!1,Re=!1){const Pe=[];for(const Ve of qe)Tt(Ve,Pe,se);re.push(Pe),ye&&function(Ve,it){let Ue=0;for(let tt=0,Dt=Ve.length,jt=Dt-2;tt<Dt;jt=tt,tt+=2)Ue+=(Ve[tt]-Ve[jt])*(Ve[tt+1]+Ve[jt+1]);if(Ue>0===it)for(let tt=0,Dt=Ve.length;tt<Dt/2;tt+=2){const jt=Ve[tt],pr=Ve[tt+1];Ve[tt]=Ve[Dt-2-tt],Ve[tt+1]=Ve[Dt-1-tt],Ve[Dt-2-tt]=jt,Ve[Dt-1-tt]=pr}}(Pe,Re)}function fe(qe,re,se,ye=!1){for(let Re=0;Re<qe.length;Re++)Pt(qe[Re],re,se,ye,Re===0)}function Le(qe,re,se,ye){const{id:Re,type:Pe,geometry:Ve,tags:it}=qe,Ue=[];if(Pe===1)(function(tt,Dt,jt,pr,Wr){for(let $r=0;$r<tt.length;$r+=2){const Cr=Math.round(o.al*(tt[$r+0]*Dt-jt)),fn=Math.round(o.al*(tt[$r+1]*Dt-pr));Wr.push([Cr,fn])}})(Ve,re,se,ye,Ue);else for(const tt of Ve)vt(tt,re,se,ye,Ue);return{id:Re,type:Pe,geometry:Ue,tags:it}}function vt(qe,re,se,ye,Re){const Pe=-Ke,Ve=o.al+Ke;let it;for(let Ue=0;Ue<qe.length-2;Ue+=2){let tt=Math.round(o.al*(qe[Ue+0]*re-se)),Dt=Math.round(o.al*(qe[Ue+1]*re-ye)),jt=Math.round(o.al*(qe[Ue+2]*re-se)),pr=Math.round(o.al*(qe[Ue+3]*re-ye));const Wr=jt-tt,$r=pr-Dt;tt<Pe&&jt<Pe||(tt<Pe?(Dt+=Math.round($r*((Pe-tt)/Wr)),tt=Pe):jt<Pe&&(pr=Dt+Math.round($r*((Pe-tt)/Wr)),jt=Pe),Dt<Pe&&pr<Pe||(Dt<Pe?(tt+=Math.round(Wr*((Pe-Dt)/$r)),Dt=Pe):pr<Pe&&(jt=tt+Math.round(Wr*((Pe-Dt)/$r)),pr=Pe),tt>=Ve&&jt>=Ve||(tt>=Ve?(Dt+=Math.round($r*((Ve-tt)/Wr)),tt=Ve):jt>=Ve&&(pr=Dt+Math.round($r*((Ve-tt)/Wr)),jt=Ve),Dt>=Ve&&pr>=Ve||(Dt>=Ve?(tt+=Math.round(Wr*((Ve-Dt)/$r)),Dt=Ve):pr>=Ve&&(jt=tt+Math.round(Wr*((Ve-Dt)/$r)),pr=Ve),it&&tt===it[it.length-1][0]&&Dt===it[it.length-1][1]||(it=[[tt,Dt]],Re.push(it)),it.push([jt,pr])))))}}function Wt({name:qe,features:re},se){se.writeStringField(1,qe),se.writeVarintField(5,o.al);const ye=new Map,Re=new Map,Pe={keys:ye,values:Re,feature:null};for(const Ve of re)Pe.feature=Ve,se.writeMessage(2,Ft,Pe);for(const Ve of ye.keys())se.writeStringField(3,Ve);for(const Ve of Re.keys())se.writeMessage(4,Hr,Ve)}function Ft(qe,re){const se=qe.feature;se.id!==void 0&&Number.isSafeInteger(+se.id)&&re.writeVarintField(1,+se.id),se.tags&&re.writeMessage(2,Ut,qe),re.writeVarintField(3,se.type),re.writeMessage(4,zr,se)}function Ut({keys:qe,values:re,feature:se},ye){for(const Re of Object.keys(se.tags)){let Pe=se.tags[Re];if(Pe===null)continue;let Ve=qe.get(Re);Ve===void 0&&(Ve=qe.size,qe.set(Re,Ve)),ye.writeVarint(Ve);const it=typeof Pe;it!=="string"&&it!=="boolean"&&it!=="number"&&(Pe=JSON.stringify(Pe));let Ue=re.get(Pe);Ue===void 0&&(Ue=re.size,re.set(Pe,Ue)),ye.writeVarint(Ue)}}function vr(qe,re){return(re<<3)+(7&qe)}function xr(qe){return qe<<1^qe>>31}function zr(qe,re){const{geometry:se,type:ye}=qe;let Re=0,Pe=0;if(ye===1){re.writeVarint(vr(1,se.length));for(const Ve of se){const it=Ve[0]-Re,Ue=Ve[1]-Pe;re.writeVarint(xr(it)),re.writeVarint(xr(Ue)),Re+=it,Pe+=Ue}}else for(const Ve of se){re.writeVarint(vr(1,1));const it=Ve.length-(ye===3?1:0);for(let Ue=0;Ue<it;Ue++){Ue===1&&re.writeVarint(vr(2,it-1));const tt=Ve[Ue][0]-Re,Dt=Ve[Ue][1]-Pe;re.writeVarint(xr(tt)),re.writeVarint(xr(Dt)),Re+=tt,Pe+=Dt}ye===3&&re.writeVarint(vr(7,1))}}function Hr(qe,re){const se=typeof qe;se==="string"?re.writeStringField(1,qe):se==="boolean"?re.writeBooleanField(7,qe):se==="number"&&(qe%1!=0?re.writeDoubleField(3,qe):qe<0?re.writeSVarintField(6,qe):re.writeVarintField(5,qe))}const jn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:qe=>qe},hn=Math.fround||(Ji=new Float32Array(1),qe=>(Ji[0]=+qe,Ji[0]));var Ji;const Ii=3,Vi=5,As=6;class bi{constructor(re){this.options=Object.assign(Object.create(jn),re),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(re){const{log:se,minZoom:ye,maxZoom:Re}=this.options;se&&console.time("total time");const Pe=`prepare ${re.length} points`;se&&console.time(Pe),this.points=re;const Ve=[];for(let Ue=0;Ue<re.length;Ue++){const tt=re[Ue];if(!tt.geometry)continue;const[Dt,jt]=tt.geometry.coordinates,pr=hn(Ct(Dt)),Wr=hn(Kt(jt));Ve.push(pr,Wr,1/0,Ue,-1,1),this.options.reduce&&Ve.push(0)}let it=this.trees[Re+1]=this._createTree(Ve);se&&console.timeEnd(Pe);for(let Ue=Re;Ue>=ye;Ue--){const tt=+Date.now();it=this.trees[Ue]=this._createTree(this._cluster(it,Ue)),se&&console.log("z%d: %d clusters in %dms",Ue,it.numItems,+Date.now()-tt)}return se&&console.timeEnd("total time"),this}getClusters(re,se){let ye=((re[0]+180)%360+360)%360-180;const Re=Math.max(-90,Math.min(90,re[1]));let Pe=re[2]===180?180:((re[2]+180)%360+360)%360-180;const Ve=Math.max(-90,Math.min(90,re[3]));if(re[2]-re[0]>=360)ye=-180,Pe=180;else if(ye>Pe){const jt=this.getClusters([ye,Re,180,Ve],se),pr=this.getClusters([-180,Re,Pe,Ve],se);return jt.concat(pr)}const it=this.trees[this._limitZoom(se)],Ue=it.range(Ct(ye),Kt(Ve),Ct(Pe),Kt(Re)),tt=it.data,Dt=[];for(const jt of Ue){const pr=this.stride*jt;Dt.push(tt[pr+Vi]>1?Is(tt,pr,this.clusterProps):this.points[tt[pr+Ii]])}return Dt}getChildren(re){const se=this._getOriginId(re),ye=this._getOriginZoom(re),Re="No cluster with the specified id.",Pe=this.trees[ye];if(!Pe)throw new Error(Re);const Ve=Pe.data;if(se*this.stride>=Ve.length)throw new Error(Re);const it=this.options.radius/(this.options.extent*Math.pow(2,ye-1)),Ue=Pe.within(Ve[se*this.stride],Ve[se*this.stride+1],it),tt=[];for(const Dt of Ue){const jt=Dt*this.stride;Ve[jt+4]===re&&tt.push(Ve[jt+Vi]>1?Is(Ve,jt,this.clusterProps):this.points[Ve[jt+Ii]])}if(tt.length===0)throw new Error(Re);return tt}getLeaves(re,se,ye){const Re=[];return this._appendLeaves(Re,re,se=se||10,ye=ye||0,0),Re}getTile(re,se,ye){const Re=this.trees[this._limitZoom(re)],Pe=Math.pow(2,re),{extent:Ve,radius:it}=this.options,Ue=it/Ve,tt=(ye-Ue)/Pe,Dt=(ye+1+Ue)/Pe,jt={features:[]};return this._addTileFeatures(Re.range((se-Ue)/Pe,tt,(se+1+Ue)/Pe,Dt),Re.data,se,ye,Pe,jt),se===0&&this._addTileFeatures(Re.range(1-Ue/Pe,tt,1,Dt),Re.data,Pe,ye,Pe,jt),se===Pe-1&&this._addTileFeatures(Re.range(0,tt,Ue/Pe,Dt),Re.data,-1,ye,Pe,jt),jt.features.length?jt:null}getClusterExpansionZoom(re){let se=this._getOriginZoom(re)-1;for(;se<=this.options.maxZoom;){const ye=this.getChildren(re);if(se++,ye.length!==1)break;re=ye[0].properties.cluster_id}return se}_appendLeaves(re,se,ye,Re,Pe){const Ve=this.getChildren(se);for(const it of Ve){const Ue=it.properties;if(Ue&&Ue.cluster?Pe+Ue.point_count<=Re?Pe+=Ue.point_count:Pe=this._appendLeaves(re,Ue.cluster_id,ye,Re,Pe):Pe<Re?Pe++:re.push(it),re.length===ye)break}return Pe}_createTree(re){const se=new o.c3(re.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ye=0;ye<re.length;ye+=this.stride)se.add(re[ye],re[ye+1]);return se.finish(),se.data=re,se}_addTileFeatures(re,se,ye,Re,Pe,Ve){for(const it of re){const Ue=it*this.stride,tt=se[Ue+Vi]>1;let Dt,jt,pr;if(tt)Dt=nt(se,Ue,this.clusterProps),jt=se[Ue],pr=se[Ue+1];else{const Cr=this.points[se[Ue+Ii]];Dt=Cr.properties;const[fn,yn]=Cr.geometry.coordinates;jt=Ct(fn),pr=Kt(yn)}const Wr={type:1,geometry:[[Math.round(this.options.extent*(jt*Pe-ye)),Math.round(this.options.extent*(pr*Pe-Re))]],tags:Dt};let $r;$r=tt||this.options.generateId?se[Ue+Ii]:this.points[se[Ue+Ii]].id,$r!==void 0&&(Wr.id=$r),Ve.features.push(Wr)}}_limitZoom(re){return Math.max(this.options.minZoom,Math.min(Math.floor(+re),this.options.maxZoom+1))}_cluster(re,se){const{radius:ye,extent:Re,reduce:Pe,minPoints:Ve}=this.options,it=ye/(Re*Math.pow(2,se)),Ue=re.data,tt=[],Dt=this.stride;for(let jt=0;jt<Ue.length;jt+=Dt){if(Ue[jt+2]<=se)continue;Ue[jt+2]=se;const pr=Ue[jt],Wr=Ue[jt+1],$r=re.within(Ue[jt],Ue[jt+1],it),Cr=Ue[jt+Vi];let fn=Cr;for(const yn of $r){const hi=yn*Dt;Ue[hi+2]>se&&(fn+=Ue[hi+Vi])}if(fn>Cr&&fn>=Ve){let yn,hi=pr*Cr,ns=Wr*Cr,ks=-1;const ms=(jt/Dt<<5)+(se+1)+this.points.length;for(const us of $r){const ci=us*Dt;if(Ue[ci+2]<=se)continue;Ue[ci+2]=se;const kn=Ue[ci+Vi];hi+=Ue[ci]*kn,ns+=Ue[ci+1]*kn,Ue[ci+4]=ms,Pe&&(yn||(yn=this._map(Ue,jt,!0),ks=this.clusterProps.length,this.clusterProps.push(yn)),Pe(yn,this._map(Ue,ci)))}Ue[jt+4]=ms,tt.push(hi/fn,ns/fn,1/0,ms,-1,fn),Pe&&tt.push(ks)}else{for(let yn=0;yn<Dt;yn++)tt.push(Ue[jt+yn]);if(fn>1)for(const yn of $r){const hi=yn*Dt;if(!(Ue[hi+2]<=se)){Ue[hi+2]=se;for(let ns=0;ns<Dt;ns++)tt.push(Ue[hi+ns])}}}}return tt}_getOriginId(re){return re-this.points.length>>5}_getOriginZoom(re){return(re-this.points.length)%32}_map(re,se,ye){if(re[se+Vi]>1){const Ve=this.clusterProps[re[se+As]];return ye?Object.assign({},Ve):Ve}const Re=this.points[re[se+Ii]].properties,Pe=this.options.map(Re);return ye&&Pe===Re?Object.assign({},Pe):Pe}}function Is(qe,re,se){return{type:"Feature",id:qe[re+Ii],properties:nt(qe,re,se),geometry:{type:"Point",coordinates:[(ye=qe[re],360*(ye-.5)),jr(qe[re+1])]}};var ye}function nt(qe,re,se){const ye=qe[re+Vi],Re=ye>=1e4?`${Math.round(ye/1e3)}k`:ye>=1e3?Math.round(ye/100)/10+"k":ye,Pe=qe[re+As],Ve=Pe===-1?{}:Object.assign({},se[Pe]);return Object.assign(Ve,{cluster:!0,cluster_id:qe[re+Ii],point_count:ye,point_count_abbreviated:Re})}function Ct(qe){return qe/360+.5}function Kt(qe){const re=Math.sin(qe*Math.PI/180),se=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return se<0?0:se>1?1:se}function jr(qe){const re=(180-360*qe)*Math.PI/180;return 360*Math.atan(Math.exp(re))/Math.PI-90}function yr(qe,re,se,ye){let Re=ye;const Pe=re+(se-re>>1);let Ve,it=se-re;const Ue=qe[re],tt=qe[re+1],Dt=qe[se],jt=qe[se+1];for(let pr=re+3;pr<se;pr+=3){const Wr=br(qe[pr],qe[pr+1],Ue,tt,Dt,jt);if(Wr>Re)Ve=pr,Re=Wr;else if(Wr===Re){const $r=Math.abs(pr-Pe);$r<it&&(Ve=pr,it=$r)}}Re>ye&&(Ve-re>3&&yr(qe,re,Ve,ye),qe[Ve+2]=Re,se-Ve>3&&yr(qe,Ve,se,ye))}function br(qe,re,se,ye,Re,Pe){let Ve=Re-se,it=Pe-ye;if(Ve!==0||it!==0){const Ue=((qe-se)*Ve+(re-ye)*it)/(Ve*Ve+it*it);Ue>1?(se=Re,ye=Pe):Ue>0&&(se+=Ve*Ue,ye+=it*Ue)}return Ve=qe-se,it=re-ye,Ve*Ve+it*it}function Fr(qe,re,se,ye){const Re={id:qe??null,type:re,geometry:se,tags:ye,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(re==="Point"||re==="MultiPoint"||re==="LineString")On(Re,se);else if(re==="Polygon")On(Re,se[0]);else if(re==="MultiLineString")for(const Pe of se)On(Re,Pe);else if(re==="MultiPolygon")for(const Pe of se)On(Re,Pe[0]);return Re}function On(qe,re){for(let se=0;se<re.length;se+=3)qe.minX=Math.min(qe.minX,re[se]),qe.minY=Math.min(qe.minY,re[se+1]),qe.maxX=Math.max(qe.maxX,re[se]),qe.maxY=Math.max(qe.maxY,re[se+1])}function pi(qe,re,se,ye){if(!re.geometry)return;const Re=re.geometry.coordinates;if(Re&&Re.length===0)return;const Pe=re.geometry.type,Ve=Math.pow(se.tolerance/((1<<se.maxZoom)*se.extent),2);let it=[],Ue=re.id;if(se.promoteId?Ue=re.properties[se.promoteId]:se.generateId&&(Ue=ye||0),Pe==="Point")Ri(Re,it);else if(Pe==="MultiPoint")for(const tt of Re)Ri(tt,it);else if(Pe==="LineString")$s(Re,it,Ve,!1);else if(Pe==="MultiLineString"){if(se.lineMetrics){for(const tt of Re)it=[],$s(tt,it,Ve,!1),qe.push(Fr(Ue,"LineString",it,re.properties));return}ws(Re,it,Ve,!1)}else if(Pe==="Polygon")ws(Re,it,Ve,!0);else{if(Pe!=="MultiPolygon"){if(Pe==="GeometryCollection"){for(const tt of re.geometry.geometries)pi(qe,{id:Ue,geometry:tt,properties:re.properties},se,ye);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const tt of Re){const Dt=[];ws(tt,Dt,Ve,!0),it.push(Dt)}}qe.push(Fr(Ue,Pe,it,re.properties))}function Ri(qe,re){re.push(Lo(qe[0]),ho(qe[1]),0)}function $s(qe,re,se,ye){let Re,Pe,Ve=0;for(let Ue=0;Ue<qe.length;Ue++){const tt=Lo(qe[Ue][0]),Dt=ho(qe[Ue][1]);re.push(tt,Dt,0),Ue>0&&(Ve+=ye?(Re*Dt-tt*Pe)/2:Math.sqrt(Math.pow(tt-Re,2)+Math.pow(Dt-Pe,2))),Re=tt,Pe=Dt}const it=re.length-3;re[2]=1,yr(re,0,it,se),re[it+2]=1,re.size=Math.abs(Ve),re.start=0,re.end=re.size}function ws(qe,re,se,ye){for(let Re=0;Re<qe.length;Re++){const Pe=[];$s(qe[Re],Pe,se,ye),re.push(Pe)}}function Lo(qe){return qe/360+.5}function ho(qe){const re=Math.sin(qe*Math.PI/180),se=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return se<0?0:se>1?1:se}function rr(qe,re,se,ye,Re,Pe,Ve,it){if(ye/=re,Pe>=(se/=re)&&Ve<ye)return qe;if(Ve<se||Pe>=ye)return null;const Ue=[];for(const tt of qe){const Dt=tt.geometry;let jt=tt.type;const pr=Re===0?tt.minX:tt.minY,Wr=Re===0?tt.maxX:tt.maxY;if(pr>=se&&Wr<ye){Ue.push(tt);continue}if(Wr<se||pr>=ye)continue;let $r=[];if(jt==="Point"||jt==="MultiPoint")yt(Dt,$r,se,ye,Re);else if(jt==="LineString")Ar(Dt,$r,se,ye,Re,!1,it.lineMetrics);else if(jt==="MultiLineString")Cn(Dt,$r,se,ye,Re,!1);else if(jt==="Polygon")Cn(Dt,$r,se,ye,Re,!0);else if(jt==="MultiPolygon")for(const Cr of Dt){const fn=[];Cn(Cr,fn,se,ye,Re,!0),fn.length&&$r.push(fn)}if($r.length){if(it.lineMetrics&&jt==="LineString"){for(const Cr of $r)Ue.push(Fr(tt.id,jt,Cr,tt.tags));continue}jt!=="LineString"&&jt!=="MultiLineString"||($r.length===1?(jt="LineString",$r=$r[0]):jt="MultiLineString"),jt!=="Point"&&jt!=="MultiPoint"||(jt=$r.length===3?"Point":"MultiPoint"),Ue.push(Fr(tt.id,jt,$r,tt.tags))}}return Ue.length?Ue:null}function yt(qe,re,se,ye,Re){for(let Pe=0;Pe<qe.length;Pe+=3){const Ve=qe[Pe+Re];Ve>=se&&Ve<=ye&&Mi(re,qe[Pe],qe[Pe+1],qe[Pe+2])}}function Ar(qe,re,se,ye,Re,Pe,Ve){let it=Qr(qe);const Ue=Re===0?li:Os;let tt,Dt,jt=qe.start;for(let fn=0;fn<qe.length-3;fn+=3){const yn=qe[fn],hi=qe[fn+1],ns=qe[fn+2],ks=qe[fn+3],ms=qe[fn+4],us=Re===0?yn:hi,ci=Re===0?ks:ms;let kn=!1;Ve&&(tt=Math.sqrt(Math.pow(yn-ks,2)+Math.pow(hi-ms,2))),us<se?ci>se&&(Dt=Ue(it,yn,hi,ks,ms,se),Ve&&(it.start=jt+tt*Dt)):us>ye?ci<ye&&(Dt=Ue(it,yn,hi,ks,ms,ye),Ve&&(it.start=jt+tt*Dt)):Mi(it,yn,hi,ns),ci<se&&us>=se&&(Dt=Ue(it,yn,hi,ks,ms,se),kn=!0),ci>ye&&us<=ye&&(Dt=Ue(it,yn,hi,ks,ms,ye),kn=!0),!Pe&&kn&&(Ve&&(it.end=jt+tt*Dt),re.push(it),it=Qr(qe)),Ve&&(jt+=tt)}let pr=qe.length-3;const Wr=qe[pr],$r=qe[pr+1],Cr=Re===0?Wr:$r;Cr>=se&&Cr<=ye&&Mi(it,Wr,$r,qe[pr+2]),pr=it.length-3,Pe&&pr>=3&&(it[pr]!==it[0]||it[pr+1]!==it[1])&&Mi(it,it[0],it[1],it[2]),it.length&&re.push(it)}function Qr(qe){const re=[];return re.size=qe.size,re.start=qe.start,re.end=qe.end,re}function Cn(qe,re,se,ye,Re,Pe){for(const Ve of qe)Ar(Ve,re,se,ye,Re,Pe,!1)}function Mi(qe,re,se,ye){qe.push(re,se,ye)}function li(qe,re,se,ye,Re,Pe){const Ve=(Pe-re)/(ye-re);return Mi(qe,Pe,se+(Re-se)*Ve,1),Ve}function Os(qe,re,se,ye,Re,Pe){const Ve=(Pe-se)/(Re-se);return Mi(qe,re+(ye-re)*Ve,Pe,1),Ve}function Il(qe,re){const se=[];for(let ye=0;ye<qe.length;ye++){const Re=qe[ye],Pe=Re.type;let Ve;if(Pe==="Point"||Pe==="MultiPoint"||Pe==="LineString")Ve=zo(Re.geometry,re);else if(Pe==="MultiLineString"||Pe==="Polygon"){Ve=[];for(const it of Re.geometry)Ve.push(zo(it,re))}else if(Pe==="MultiPolygon"){Ve=[];for(const it of Re.geometry){const Ue=[];for(const tt of it)Ue.push(zo(tt,re));Ve.push(Ue)}}se.push(Fr(Re.id,Pe,Ve,Re.tags))}return se}function zo(qe,re){const se=[];se.size=qe.size,qe.start!==void 0&&(se.start=qe.start,se.end=qe.end);for(let ye=0;ye<qe.length;ye+=3)se.push(qe[ye]+re,qe[ye+1],qe[ye+2]);return se}function ra(qe,re){if(qe.transformed)return qe;const se=1<<qe.z,ye=qe.x,Re=qe.y;for(const Pe of qe.features){const Ve=Pe.geometry,it=Pe.type;if(Pe.geometry=[],it===1)for(let Ue=0;Ue<Ve.length;Ue+=2)Pe.geometry.push(Yn(Ve[Ue],Ve[Ue+1],re,se,ye,Re));else for(let Ue=0;Ue<Ve.length;Ue++){const tt=[];for(let Dt=0;Dt<Ve[Ue].length;Dt+=2)tt.push(Yn(Ve[Ue][Dt],Ve[Ue][Dt+1],re,se,ye,Re));Pe.geometry.push(tt)}}return qe.transformed=!0,qe}function Yn(qe,re,se,ye,Re,Pe){return[Math.round(se*(qe*ye-Re)),Math.round(se*(re*ye-Pe))]}function qi(qe,re,se,ye,Re){const Pe=re===Re.maxZoom?0:Re.tolerance/((1<<re)*Re.extent),Ve={features:[],numPoints:0,numSimplified:0,numFeatures:qe.length,source:null,x:se,y:ye,z:re,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const it of qe)ps(Ve,it,Pe,Re);return Ve}function ps(qe,re,se,ye){const Re=re.geometry,Pe=re.type,Ve=[];if(qe.minX=Math.min(qe.minX,re.minX),qe.minY=Math.min(qe.minY,re.minY),qe.maxX=Math.max(qe.maxX,re.maxX),qe.maxY=Math.max(qe.maxY,re.maxY),Pe==="Point"||Pe==="MultiPoint")for(let it=0;it<Re.length;it+=3)Ve.push(Re[it],Re[it+1]),qe.numPoints++,qe.numSimplified++;else if(Pe==="LineString")Ao(Ve,Re,qe,se,!1,!1);else if(Pe==="MultiLineString"||Pe==="Polygon")for(let it=0;it<Re.length;it++)Ao(Ve,Re[it],qe,se,Pe==="Polygon",it===0);else if(Pe==="MultiPolygon")for(let it=0;it<Re.length;it++){const Ue=Re[it];for(let tt=0;tt<Ue.length;tt++)Ao(Ve,Ue[tt],qe,se,!0,tt===0)}if(Ve.length){let it=re.tags||null;if(Pe==="LineString"&&ye.lineMetrics){it={};for(const tt in re.tags)it[tt]=re.tags[tt];it.mapbox_clip_start=Re.start/Re.size,it.mapbox_clip_end=Re.end/Re.size}const Ue={geometry:Ve,type:Pe==="Polygon"||Pe==="MultiPolygon"?3:Pe==="LineString"||Pe==="MultiLineString"?2:1,tags:it};re.id!==null&&(Ue.id=re.id),qe.features.push(Ue)}}function Ao(qe,re,se,ye,Re,Pe){const Ve=ye*ye;if(ye>0&&re.size<(Re?Ve:ye))return void(se.numPoints+=re.length/3);const it=[];for(let Ue=0;Ue<re.length;Ue+=3)(ye===0||re[Ue+2]>Ve)&&(se.numSimplified++,it.push(re[Ue],re[Ue+1])),se.numPoints++;Re&&function(Ue,tt){let Dt=0;for(let jt=0,pr=Ue.length,Wr=pr-2;jt<pr;Wr=jt,jt+=2)Dt+=(Ue[jt]-Ue[Wr])*(Ue[jt+1]+Ue[Wr+1]);if(Dt>0===tt)for(let jt=0,pr=Ue.length;jt<pr/2;jt+=2){const Wr=Ue[jt],$r=Ue[jt+1];Ue[jt]=Ue[pr-2-jt],Ue[jt+1]=Ue[pr-1-jt],Ue[pr-2-jt]=Wr,Ue[pr-1-jt]=$r}}(it,Pe),qe.push(it)}const wt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class jo{constructor(re,se){const ye=(se=this.options=function(Pe,Ve){for(const it in Ve)Pe[it]=Ve[it];return Pe}(Object.create(wt),se)).debug;if(ye&&console.time("preprocess data"),se.maxZoom<0||se.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(se.promoteId&&se.generateId)throw new Error("promoteId and generateId cannot be used together.");let Re=function(Pe,Ve){const it=[];if(Pe.type==="FeatureCollection")for(let Ue=0;Ue<Pe.features.length;Ue++)pi(it,Pe.features[Ue],Ve,Ue);else pi(it,Pe.type==="Feature"?Pe:{geometry:Pe},Ve);return it}(re,se);this.tiles={},this.tileCoords=[],ye&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",se.indexMaxZoom,se.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Re=function(Pe,Ve){const it=Ve.buffer/Ve.extent;let Ue=Pe;const tt=rr(Pe,1,-1-it,it,0,-1,2,Ve),Dt=rr(Pe,1,1-it,2+it,0,-1,2,Ve);return(tt||Dt)&&(Ue=rr(Pe,1,-it,1+it,0,-1,2,Ve)||[],tt&&(Ue=Il(tt,1).concat(Ue)),Dt&&(Ue=Ue.concat(Il(Dt,-1)))),Ue}(Re,se),Re.length&&this.splitTile(Re,0,0,0),ye&&(Re.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(re,se,ye,Re,Pe,Ve,it){const Ue=[re,se,ye,Re],tt=this.options,Dt=tt.debug;for(;Ue.length;){Re=Ue.pop(),ye=Ue.pop(),se=Ue.pop(),re=Ue.pop();const jt=1<<se,pr=ja(se,ye,Re);let Wr=this.tiles[pr];if(!Wr&&(Dt>1&&console.time("creation"),Wr=this.tiles[pr]=qi(re,se,ye,Re,tt),this.tileCoords.push({z:se,x:ye,y:Re}),Dt)){Dt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",se,ye,Re,Wr.numFeatures,Wr.numPoints,Wr.numSimplified),console.timeEnd("creation"));const kn=`z${se}`;this.stats[kn]=(this.stats[kn]||0)+1,this.total++}if(Wr.source=re,Pe==null){if(se===tt.indexMaxZoom||Wr.numPoints<=tt.indexMaxPoints)continue}else{if(se===tt.maxZoom||se===Pe)continue;if(Pe!=null){const kn=Pe-se;if(ye!==Ve>>kn||Re!==it>>kn)continue}}if(Wr.source=null,re.length===0)continue;Dt>1&&console.time("clipping");const $r=.5*tt.buffer/tt.extent,Cr=.5-$r,fn=.5+$r,yn=1+$r;let hi=null,ns=null,ks=null,ms=null,us=rr(re,jt,ye-$r,ye+fn,0,Wr.minX,Wr.maxX,tt),ci=rr(re,jt,ye+Cr,ye+yn,0,Wr.minX,Wr.maxX,tt);re=null,us&&(hi=rr(us,jt,Re-$r,Re+fn,1,Wr.minY,Wr.maxY,tt),ns=rr(us,jt,Re+Cr,Re+yn,1,Wr.minY,Wr.maxY,tt),us=null),ci&&(ks=rr(ci,jt,Re-$r,Re+fn,1,Wr.minY,Wr.maxY,tt),ms=rr(ci,jt,Re+Cr,Re+yn,1,Wr.minY,Wr.maxY,tt),ci=null),Dt>1&&console.timeEnd("clipping"),Ue.push(hi||[],se+1,2*ye,2*Re),Ue.push(ns||[],se+1,2*ye,2*Re+1),Ue.push(ks||[],se+1,2*ye+1,2*Re),Ue.push(ms||[],se+1,2*ye+1,2*Re+1)}}getTile(re,se,ye){re=+re,se=+se,ye=+ye;const Re=this.options,{extent:Pe,debug:Ve}=Re;if(re<0||re>24)return null;const it=1<<re,Ue=ja(re,se=se+it&it-1,ye);if(this.tiles[Ue])return ra(this.tiles[Ue],Pe);Ve>1&&console.log("drilling down to z%d-%d-%d",re,se,ye);let tt,Dt=re,jt=se,pr=ye;for(;!tt&&Dt>0;)Dt--,jt>>=1,pr>>=1,tt=this.tiles[ja(Dt,jt,pr)];return tt&&tt.source?(Ve>1&&(console.log("found parent tile z%d-%d-%d",Dt,jt,pr),console.time("drilling down")),this.splitTile(tt.source,Dt,jt,pr,re,se,ye),Ve>1&&console.timeEnd("drilling down"),this.tiles[Ue]?ra(this.tiles[Ue],Pe):null):null}}function ja(qe,re,se){return 32*((1<<qe)*se+re)+qe}function Fo(qe,re){const se=qe.tileID.canonical;if(!this._geoJSONIndex)return void re(null,null);const ye=this._geoJSONIndex.getTile(se.z,se.x,se.y);if(!ye)return void re(null,null);const Re=tt=>tt.tags&&"3d_elevation_id"in tt.tags&&"source"in tt.tags&&tt.tags.source==="elevation",Pe=ye.features.filter(tt=>Re(tt));let Ve={_geojsonTileLayer:ye.features};Pe.length>0&&(Ve={_geojsonTileLayer:ye.features.filter(tt=>!Re(tt)),hd_road_elevation:Pe});const it=new dt(Ve),Ue=function(tt){const Dt=new o.bs;for(const jt of Object.keys(tt))Dt.writeMessage(3,Wt,{name:jt,features:tt[jt]});return Dt.finish()}(Ve).buffer;re(null,{vectorTile:it,rawData:Ue})}class gn extends Ae{constructor(re,se,ye,Re,Pe,Ve,it){super(re,se,ye,Re,Pe,Fo,it),Ve&&(this.loadGeoJSON=Ve),this._dynamicIndex=new st}loadData(re,se){const ye=re&&re.request,Re=ye&&ye.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(re,(Pe,Ve)=>{if(Pe||!Ve)return se(Pe);if(typeof Ve!="object")return se(new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`));{try{if(re.filter){const Ue=o.U(re.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ue.result==="error")throw new Error(Ue.value.map(tt=>`${tt.key}: ${tt.message}`).join(", "));Ve.features=Ve.features.filter(tt=>Ue.value.evaluate({zoom:0},tt))}re.dynamic?(Ve.type==="Feature"&&(Ve={type:"FeatureCollection",features:[Ve]}),re.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ve.features,this.loaded),re.cluster&&(Ve.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=re.cluster?new bi(function({superclusterOptions:Ue,clusterProperties:tt}){if(!tt||!Ue)return Ue;const Dt={},jt={},pr={accumulated:null,zoom:0},Wr={properties:null},$r=Object.keys(tt);for(const Cr of $r){const[fn,yn]=tt[Cr],hi=o.U(yn),ns=o.U(typeof fn=="string"?[fn,["accumulated"],["get",Cr]]:fn);Dt[Cr]=hi.value,jt[Cr]=ns.value}return Ue.map=Cr=>{Wr.properties=Cr;const fn={};for(const yn of $r)fn[yn]=Dt[yn].evaluate(pr,Wr);return fn},Ue.reduce=(Cr,fn)=>{Wr.properties=fn;for(const yn of $r)pr.accumulated=Cr[yn],Cr[yn]=jt[yn].evaluate(pr,Wr)},Ue}(re)).load(Ve.features):re.dynamic?this._dynamicIndex:function(Ue,tt){return new jo(Ue,tt)}(Ve,re.geojsonVtOptions)}catch(Ue){return se(Ue)}const it={};if(Re){const Ue=A(ye);Ue&&(it.resourceTiming={},it.resourceTiming[re.source]=JSON.parse(JSON.stringify(Ue)))}se(null,it)}})}reloadTile(re,se){const ye=this.loaded;return ye&&ye[re.uid]?re.partial?se(null,void 0):super.reloadTile(re,se):this.loadTile(re,se)}loadGeoJSON(re,se){if(re.request)o.m(re.request,se);else{if(typeof re.data!="string")return se(new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return se(null,JSON.parse(re.data))}catch{return se(new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(re,se){try{se(null,this._geoJSONIndex.getClusterExpansionZoom(re.clusterId))}catch(ye){se(ye)}}getClusterChildren(re,se){try{se(null,this._geoJSONIndex.getChildren(re.clusterId))}catch(ye){se(ye)}}getClusterLeaves(re,se){try{se(null,this._geoJSONIndex.getLeaves(re.clusterId,re.limit,re.offset))}catch(ye){se(ye)}}}class Bo{constructor(re,se,ye){this.tileID=new o.aP(re.tileID.overscaledZ,re.tileID.wrap,re.tileID.canonical.z,re.tileID.canonical.x,re.tileID.canonical.y),this.tileZoom=re.tileZoom,this.uid=re.uid,this.zoom=re.zoom,this.canonical=re.tileID.canonical,this.pixelRatio=re.pixelRatio,this.tileSize=re.tileSize,this.source=re.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=re.projection,this.brightness=se,this.worldview=ye}parse(re,se,ye,Re){this.status="parsing";const Pe=new o.aP(ye.tileID.overscaledZ,ye.tileID.wrap,ye.tileID.canonical.z,ye.tileID.canonical.x,ye.tileID.canonical.y),Ve=[],it=se.familiesBySource[ye.source],Ue=new o.fm(Pe,ye.promoteId);Ue.bucketLayerIDs=[],Ue.is3DTile=!0,o.fB(re).then(tt=>{if(!tt)return Re(new Error("Could not parse tile"));const Dt=tt.json.extensionsUsed&&tt.json.extensionsUsed.includes("MAPBOX_mesh_features")||tt.json.asset.extras&&tt.json.asset.extras.MAPBOX_mesh_features,jt=tt.json.extensionsUsed&&tt.json.extensionsUsed.includes("EXT_meshopt_compression"),pr=new o.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Wr in it)for(const $r of it[Wr]){const Cr=$r[0];Ue.bucketLayerIDs.push($r.map(hi=>o.B(hi.id,hi.scope))),Cr.recalculate(pr,[]);const fn=o.fC(tt,1/o.d6(ye.tileID.canonical)),yn=new o.fD($r,fn,Pe,Dt,jt,this.brightness,Ue,this.worldview);Dt||(yn.needsUpload=!0),Ve.push(yn),yn.evaluate(Cr)}this.status="done",Re(null,{buckets:Ve,featureIndex:Ue,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(tt=>Re(new Error(tt.message)))}}class ev{constructor(re,se,ye,Re,Pe,Ve,it,Ue){this.actor=re,this.layerIndex=se,this.availableImages=ye,this.availableModels=Re,this.brightness=it,this.loading={},this.loaded={},this.worldview=Ue}loadTile(re,se){const ye=re.uid,Re=this.loading[ye]=new Bo(re,this.brightness,this.worldview);o.bt(re.request,(Pe,Ve)=>{const it=!this.loading[ye];return delete this.loading[ye],it||Pe?(Re.status="done",it||(this.loaded[ye]=Re),se(Pe)):Ve&&Ve.byteLength!==0?void Re.parse(Ve,this.layerIndex,re,(Ue,tt)=>{Re.status="done",this.loaded=this.loaded||{},this.loaded[ye]=Re,Ue||!tt?se(Ue):se(null,tt)}):(Re.status="done",this.loaded[ye]=Re,se())})}reloadTile(re,se){const ye=this.loaded,Re=re.uid;if(ye&&ye[Re]){const Pe=ye[Re];Pe.projection=re.projection,Pe.brightness=re.brightness;const Ve=(it,Ue)=>{Pe.reloadCallback&&(delete Pe.reloadCallback,this.loadTile(re,se)),se(it,Ue)};Pe.status==="parsing"?Pe.reloadCallback=Ve:Pe.status==="done"&&this.loadTile(re,se)}}abortTile(re,se){const ye=re.uid;this.loading[ye]&&delete this.loading[ye],se()}removeTile(re,se){const ye=this.loaded,Re=re.uid;ye&&ye[Re]&&delete ye[Re],se()}}class rp{constructor(re){this.self=re,this.actor=new o.fF(re,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new o.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=o.cl({name:"mercator"}),this.workerSourceTypes={vector:Ae,geojson:gn,"raster-dem":Ze,"raster-array":Je,"batched-model":ev},this.workerSources={},this.self.registerWorkerSource=(se,ye)=>{if(this.workerSourceTypes[se])throw new Error(`Worker source with name "${se}" already registered.`);this.workerSourceTypes[se]=ye},this.self.registerRTLTextPlugin=se=>{if(o.fG.isParsed())throw new Error("RTL text plugin already registered.");o.fG.setState({pluginStatus:o.fH.parsed,pluginURL:o.fG.getPluginURL()}),o.fG.applyArabicShaping=se.applyArabicShaping,o.fG.processBidirectionalText=se.processBidirectionalText,o.fG.processStyledBidirectionalText=se.processStyledBidirectionalText;for(const ye of this.rtlPluginParsingListeners)ye(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(re,se,ye){delete this.layerIndexes[re],delete this.availableImages[re],delete this.availableModels[re],delete this.workerSources[re],ye()}checkIfReady(re,se,ye){ye()}setReferrer(re,se){this.referrer=se}spriteLoaded(re,se){this.isSpriteLoaded[re]||(this.isSpriteLoaded[re]={});const{scope:ye,isLoaded:Re}=se;if(this.isSpriteLoaded[re][ye]=Re,this.workerSources[re]&&this.workerSources[re][ye])for(const Pe in this.workerSources[re][ye]){const Ve=this.workerSources[re][ye][Pe];for(const it in Ve){const Ue=Ve[it];Ue instanceof Ae&&(Ue.isSpriteLoaded=Re,Ue.fire(new o.z("isSpriteLoaded")))}}}setImages(re,se,ye){this.availableImages[re]||(this.availableImages[re]={});const{scope:Re,images:Pe}=se;if(this.availableImages[re][Re]=Pe,this.workerSources[re]&&this.workerSources[re][Re]){for(const Ve in this.workerSources[re][Re]){const it=this.workerSources[re][Re][Ve];for(const Ue in it)it[Ue].availableImages=Pe}ye()}else ye()}setModels(re,{scope:se,models:ye},Re){if(this.availableModels[re]||(this.availableModels[re]={}),this.availableModels[re][se]=ye,this.workerSources[re]&&this.workerSources[re][se]){for(const Pe in this.workerSources[re][se]){const Ve=this.workerSources[re][se][Pe];for(const it in Ve)Ve[it].availableModels=ye}Re()}else Re()}setProjection(re,se){this.projections[re]=o.cl(se)}setBrightness(re,se,ye){this.brightness=se,ye()}setWorldview(re,se,ye){this.worldview=se,ye()}setLayers(re,se,ye){this.getLayerIndex(re,se.scope).replace(se.layers,se.options),ye()}updateLayers(re,se,ye){this.getLayerIndex(re,se.scope).update(se.layers,se.removedIds,se.options),ye()}loadTile(re,se,ye){se.projection=this.projections[re]||this.defaultProjection,this.getWorkerSource(re,se.type,se.source,se.scope).loadTile(se,ye)}decodeRasterArray(re,se,ye){this.getWorkerSource(re,se.type,se.source,se.scope).decodeRasterArray(se,ye)}reloadTile(re,se,ye){se.projection=this.projections[re]||this.defaultProjection,this.getWorkerSource(re,se.type,se.source,se.scope).reloadTile(se,ye)}abortTile(re,se,ye){this.getWorkerSource(re,se.type,se.source,se.scope).abortTile(se,ye)}removeTile(re,se,ye){this.getWorkerSource(re,se.type,se.source,se.scope).removeTile(se,ye)}removeSource(re,se,ye){if(!(this.workerSources[re]&&this.workerSources[re][se.scope]&&this.workerSources[re][se.scope][se.type]&&this.workerSources[re][se.scope][se.type][se.source]))return;const Re=this.workerSources[re][se.scope][se.type][se.source];delete this.workerSources[re][se.scope][se.type][se.source],Re.removeSource!==void 0?Re.removeSource(se,ye):ye()}loadWorkerSource(re,se,ye){try{this.self.importScripts(se.url),ye()}catch(Re){ye(Re.toString())}}syncRTLPluginState(re,se,ye){if(o.fG.isParsed())ye(null,!0);else if(o.fG.isParsing())this.rtlPluginParsingListeners.push(ye);else try{o.fG.setState(se);const Re=o.fG.getPluginURL();!o.fG.isLoaded()||o.fG.isParsed()||o.fG.isParsing()||Re==null||(o.fG.setState({pluginStatus:o.fH.parsing,pluginURL:o.fG.getPluginURL()}),this.self.importScripts(Re),o.fG.isParsed()?ye(null,!0):this.rtlPluginParsingListeners.push(ye))}catch(Re){ye(Re.toString())}}setDracoUrl(re,se){this.dracoUrl=se}getAvailableImages(re,se){this.availableImages[re]||(this.availableImages[re]={});let ye=this.availableImages[re][se];return ye||(ye=[]),ye}getAvailableModels(re,se){this.availableModels[re]||(this.availableModels[re]={});let ye=this.availableModels[re][se];return ye||(ye={}),ye}getLayerIndex(re,se){this.layerIndexes[re]||(this.layerIndexes[re]={});let ye=this.layerIndexes[re][se];return ye||(ye=this.layerIndexes[re][se]=new U,ye.scope=se),ye}getWorkerSource(re,se,ye,Re){const Pe=this.workerSources;return Pe[re]||(Pe[re]={}),Pe[re][Re]||(Pe[re][Re]={}),Pe[re][Re][se]||(Pe[re][Re][se]={}),this.isSpriteLoaded[re]||(this.isSpriteLoaded[re]={}),Pe[re][Re][se][ye]||(Pe[re][Re][se][ye]=new this.workerSourceTypes[se]({send:(Ve,it,Ue,tt,Dt,jt)=>this.actor.send(Ve,it,Ue,re,Dt,jt),scheduler:this.actor.scheduler},this.getLayerIndex(re,Re),this.getAvailableImages(re,Re),this.getAvailableModels(re,Re),this.isSpriteLoaded[re][Re],void 0,this.brightness,this.worldview)),Pe[re][Re][se][ye]}rasterizeImagesWorker(re,se,ye){const Re=new Map;for(const[Pe,{image:Ve,imageVariant:it}]of se.tasks.entries()){const Ue=this.imageRasterizer.rasterize(it,Ve,se.scope,re);Re.set(Pe,Ue)}ye(void 0,Re)}removeRasterizedImages(re,se,ye){this.imageRasterizer.removeImagesFromCacheByIds(se.imageIds,se.scope,re),ye()}enforceCacheSizeLimit(re,se){o.fI(se)}getWorkerPerformanceMetrics(re,se,ye){ye(void 0,void 0)}}return o.fE(self)&&(self.worker=new rp(self)),rp}),_(["./shared"],function(o){var A="3.16.0";const I={create:"create",load:"load",fullLoad:"fullLoad"},N={mark(p){performance.mark(p)},measure(p,n,c){performance.measure(p,n,c)}};function U(p){const n=p.name.split("?")[0];return o.a(n)&&n.includes("mapbox-gl.js")?"javascript":o.a(n)&&n.includes("mapbox-gl.css")?"css":o.b(n)?"fontRange":o.c(n)?"sprite":o.i(n)?"style":o.d(n)?"tilejson":"other"}var $,V={},Y=function(){if($)return V;function p(m){return!n(m)}function n(m){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var w,S,C=new Blob([""],{type:"text/javascript"}),j=URL.createObjectURL(C);try{S=new Worker(j),w=!0}catch{w=!1}return S&&S.terminate(),URL.revokeObjectURL(j),w}()?function(){var w=document.createElement("canvas");w.width=w.height=1;var S=w.getContext("2d");if(!S)return!1;var C=S.getImageData(0,0,1,1);return C&&C.width===w.width}()?(c[v=m&&m.failIfMajorPerformanceCaveat]===void 0&&(c[v]=function(w){var S,C=function(j){var M=document.createElement("canvas"),D=Object.create(p.webGLContextAttributes);return D.failIfMajorPerformanceCaveat=j,M.getContext("webgl2",D)}(w);if(!C)return!1;try{S=C.createShader(C.VERTEX_SHADER)}catch{return!1}return!(!S||C.isContextLost())&&(C.shaderSource(S,"void main() {}"),C.compileShader(S),C.getShaderParameter(S,C.COMPILE_STATUS)===!0)}(v)),c[v]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var v}$=1,V.supported=p,V.notSupportedReason=n;var c={};return p.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},V}();function q(p,n,c){const m=document.createElement(p);return n!=null&&(m.className=n),c&&c.appendChild(m),m}function Z(p,n,c){const m=document.createElementNS("http://www.w3.org/2000/svg",p);for(const v of Object.keys(n))m.setAttributeNS(null,v,String(n[v]));return c&&c.appendChild(m),m}const Q=typeof document<"u"?document.documentElement&&document.documentElement.style:null,H=Q&&Q.userSelect!==void 0?"userSelect":"WebkitUserSelect";let K;function ne(){Q&&H&&(K=Q[H],Q[H]="none")}function le(){Q&&H&&(Q[H]=K)}function pe(p){p.preventDefault(),p.stopPropagation(),window.removeEventListener("click",pe,!0)}function Ae(){window.addEventListener("click",pe,!0),window.setTimeout(()=>{window.removeEventListener("click",pe,!0)},0)}function Ze(p,n){const c=p.getBoundingClientRect();return Te(p,c,n)}function Xe(p,n){const c=p.getBoundingClientRect(),m=[];for(let v=0;v<n.length;v++)m.push(Te(p,c,n[v]));return m}function Je(p){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&p.button===2&&p.ctrlKey?0:p.button}function Te(p,n,c){const m=p.offsetWidth===n.width?1:p.offsetWidth/n.width;return new o.P((c.clientX-n.left)*m,(c.clientY-n.top)*m)}const xe="01",Be="NO_ACCESS_TOKEN";class dt{constructor(n,c,m){this._transformRequestFn=n,this._customAccessToken=c,this._silenceAuthErrors=!!m,this._createSkuToken()}_createSkuToken(){const n=function(){let c="";for(let m=0;m<10;m++)c+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",xe,c].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,c){return this._transformRequestFn&&this._transformRequestFn(n,c)||{url:n}}normalizeStyleURL(n,c){if(!o.h(n))return n;const m=Ke(n);return m.params.push(`sdk=js-${A}`),m.path=`/styles/v1${m.path}`,this._makeAPIURL(m,this._customAccessToken||c)}normalizeGlyphsURL(n,c){if(!o.h(n))return n;const m=Ke(n);return m.path=`/fonts/v1${m.path}`,this._makeAPIURL(m,this._customAccessToken||c)}normalizeModelURL(n,c){if(!o.h(n))return n;const m=Ke(n);return m.path=`/models/v1${m.path}`,this._makeAPIURL(m,this._customAccessToken||c)}normalizeSourceURL(n,c,m,v){if(!o.h(n))return n;const w=Ke(n);return w.path=`/v4/${w.authority}.json`,w.params.push("secure"),m&&w.params.push(`language=${m}`),v&&w.params.push(`worldview=${v}`),this._makeAPIURL(w,this._customAccessToken||c)}normalizeIconsetURL(n,c){const m=Ke(n);return o.h(n)?(m.path=`/styles/v1${m.path}/iconset.pbf`,this._makeAPIURL(m,this._customAccessToken||c)):st(m)}normalizeSpriteURL(n,c,m,v){const w=Ke(n);return o.h(n)?(w.path=`/styles/v1${w.path}/sprite${c}${m}`,this._makeAPIURL(w,this._customAccessToken||v)):(w.path+=`${c}${m}`,st(w))}normalizeTileURL(n,c,m){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!o.h(n))return n;const v=Ke(n);v.path=v.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${c||m&&v.authority!=="raster"&&m===512?"@2x":""}${o.k.supported?".webp":"$1"}`),v.authority==="raster"?v.path=`/${o.e.RASTER_URL_PREFIX}${v.path}`:v.authority==="rasterarrays"?v.path=`/${o.e.RASTERARRAYS_URL_PREFIX}${v.path}`:v.authority==="3dtiles"?v.path=`/${o.e.TILES3D_URL_PREFIX}${v.path}`:(v.path=v.path.replace(/^.+\/v4\//,"/"),v.path=`/${o.e.TILE_URL_VERSION}${v.path}`);const w=this._customAccessToken||function(S){for(const C of S){const j=C.match(/^access_token=(.*)$/);if(j)return j[1]}return null}(v.params)||o.e.ACCESS_TOKEN;return o.e.REQUIRE_ACCESS_TOKEN&&w&&this._skuToken&&v.params.push(`sku=${this._skuToken}`),this._makeAPIURL(v,w)}canonicalizeTileURL(n,c){const m=Ke(n);if(!m.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!m.path.match(/\.[\w]+$/))return n;let v="mapbox://";m.path.match(/^\/raster\/v1\//)?v+=`raster/${m.path.replace(`/${o.e.RASTER_URL_PREFIX}/`,"")}`:m.path.match(/^\/rasterarrays\/v1\//)?v+=`rasterarrays/${m.path.replace(`/${o.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:v+=`tiles/${m.path.replace(`/${o.e.TILE_URL_VERSION}/`,"")}`;let w=m.params;return c&&(w=w.filter(S=>!S.match(/^access_token=/))),w.length&&(v+=`?${w.join("&")}`),v}canonicalizeTileset(n,c){const m=!!c&&o.h(c),v=[];for(const w of n.tiles||[])o.j(w)?v.push(this.canonicalizeTileURL(w,m)):v.push(w);return v}_makeAPIURL(n,c){const m="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",v=Ke(o.e.API_URL);if(n.protocol=v.protocol,n.authority=v.authority,n.protocol==="http"){const w=n.params.indexOf("secure");w>=0&&n.params.splice(w,1)}if(v.path!=="/"&&(n.path=`${v.path}${n.path}`),!o.e.REQUIRE_ACCESS_TOKEN)return st(n);if(c=c||o.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!c)throw new Error(`An API access token is required to use Mapbox GL. ${m}`);if(c[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${m}`)}return n.params=n.params.filter(w=>w.indexOf("access_token")===-1),n.params.push(`access_token=${c||""}`),st(n)}}const qt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ke(p){const n=p.match(qt);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function st(p){const n=p.params.length?`?${p.params.join("&")}`:"";return`${p.protocol}://${p.authority}${p.path}${n}`}const Ne="mapbox.eventData";function De(p){if(!p)return null;const n=p.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(o.l(n[1]))}catch{return null}}class Tt{constructor(n){this.type=n,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){const c=De(o.e.ACCESS_TOKEN);let m="";return m=c&&c.u?o.f(c.u):o.e.ACCESS_TOKEN||"",n?`${Ne}.${n}:${m}`:`${Ne}:${m}`}fetchEventData(){const n=o.s("localStorage"),c=this.getStorageKey(),m=this.getStorageKey("uuid"),v=this.getStorageKey("uuidTimestamp");if(n)try{const w=localStorage.getItem(c);w&&(this.eventData=JSON.parse(w));const S=localStorage.getItem(m);S&&(this.anonId=S);const C=localStorage.getItem(v);C&&(this.anonIdTimestamp=Number(C));const j=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<j)&&this.refreshUUID()}catch{o.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=o.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const n=o.s("localStorage"),c=this.getStorageKey(),m=this.getStorageKey("uuid"),v=this.getStorageKey("uuidTimestamp"),w=this.anonId,S=this.anonIdTimestamp;if(n&&w)try{localStorage.setItem(m,w),Object.keys(this.eventData).length>=1&&localStorage.setItem(c,JSON.stringify(this.eventData)),S&&localStorage.setItem(v,S.toString())}catch{o.w("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,c,m,v){if(!o.e.EVENTS_URL)return;const w=Ke(o.e.EVENTS_URL);w.params.push(`access_token=${v||o.e.ACCESS_TOKEN||""}`);const S={event:this.type,created:new Date(n).toISOString()},C=c?Object.assign(S,c):S,j={url:st(w),headers:{"Content-Type":"text/plain"},body:JSON.stringify([C])};this.pendingRequest=o.p(j,M=>{this.pendingRequest=null,m(M),this.saveEventData(),this.processRequests(v)})}queueRequest(n,c){this.queue.push(n),this.processRequests(c)}}const Pt=new class extends Tt{constructor(p){super("appUserTurnstile"),this._customAccessToken=p}postTurnstileEvent(p,n){o.e.EVENTS_URL&&o.e.ACCESS_TOKEN&&Array.isArray(p)&&p.some(c=>o.h(c)||o.j(c))&&this.queueRequest(Date.now(),n)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=De(o.e.ACCESS_TOKEN),c=n?n.u:o.e.ACCESS_TOKEN;let m=c!==this.eventData.tokenU;o.v(this.anonId)||(this.refreshUUID(),m=!0);const v=this.queue.shift();if(this.eventData.lastSuccess){const w=new Date(this.eventData.lastSuccess),S=new Date(v),C=(v-this.eventData.lastSuccess)/864e5;m=m||C>=1||C<-1||w.getDate()!==S.getDate()}else m=!0;m?this.postEvent(v,{sdkIdentifier:"mapbox-gl-js",sdkVersion:A,skuId:xe,"enabled.telemetry":!1,userId:this.anonId},w=>{w||(this.eventData.lastSuccess=v,this.eventData.tokenU=c)},p):this.processRequests()}},fe=Pt.postTurnstileEvent.bind(Pt),Le=new class extends Tt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(p,n,c,m){this.skuToken=n,this.errorCb=m,o.e.EVENTS_URL&&(c||o.e.ACCESS_TOKEN?this.queueRequest({id:p,timestamp:Date.now()},c):this.errorCb(new Error(Be)))}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:c}=this.queue.shift();n&&this.success[n]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),o.v(this.anonId)||this.refreshUUID(),this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:A,skuId:xe,skuToken:this.skuToken,userId:this.anonId},m=>{m?this.errorCb(m):n&&(this.success[n]=!0)},p))}remove(){this.errorCb=null}},vt=Le.postMapLoadEvent.bind(Le),Wt=new class extends Tt{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(p){let n=this.mapInstanceIdMap.get(p);return n||(n=o.u(),this.mapInstanceIdMap.set(p,n)),n}getEventId(p){const n=this.eventIdPerMapInstanceMap.get(p)||0;return this.eventIdPerMapInstanceMap.set(p,n+1),n}postStyleLoadEvent(p,n){const{map:c,style:m,importedStyles:v}=n;if(!o.e.EVENTS_URL||!p&&!o.e.ACCESS_TOKEN)return;const w=this.getMapInstanceId(c),S={mapInstanceId:w,eventId:this.getEventId(w),style:m};v.length&&(S.importedStyles=v),this.queueRequest({timestamp:Date.now(),payload:S},p)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,payload:c}=this.queue.shift();this.postEvent(n,c,()=>{},p)}},Ft=Wt.postStyleLoadEvent.bind(Wt),Ut=new class extends Tt{constructor(p){super("metrics"),p&&(this.data=p)}postMetricsEvent(p){if(!o.e.EVENTS_URL||!p&&!o.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),o.v(this.anonId)||this.refreshUUID();const n=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:n},p)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,payload:c}=this.queue.shift();this.postEvent(n,c,()=>{},p)}}({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),vr=Ut.postMetricsEvent.bind(Ut),xr=new class extends Tt{constructor(){super("gljs.performance")}postPerformanceEvent(p,n){o.e.EVENTS_URL&&(p||o.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},p)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,performanceData:c}=this.queue.shift(),m=function(v){const w=performance.getEntriesByType("resource"),S=performance.getEntriesByType("mark"),C=function(G){const X={};if(G){for(const ee in G)if(ee!=="other")for(const oe of G[ee]){const ie=`${ee}ResolveRangeMin`,ce=`${ee}ResolveRangeMax`,me=`${ee}RequestCount`,de=`${ee}RequestCachedCount`;X[ie]=Math.min(X[ie]||1/0,oe.startTime),X[ce]=Math.max(X[ce]||-1/0,oe.responseEnd);const Ee=ge=>{X[ge]===void 0&&(X[ge]=0),++X[ge]};oe.transferSize!==void 0&&oe.transferSize===0&&Ee(de),Ee(me)}}return X}(function(G,X){const ee={};if(G)for(const oe of G){const ie=X(oe);ee[ie]===void 0&&(ee[ie]=[]),ee[ie].push(oe)}return ee}(w,U)),j=window.devicePixelRatio,M=navigator.connection||navigator.mozConnection||navigator.webkitConnection,D=M?M.effectiveType:void 0,B={counters:[],metadata:[],attributes:[]},O=(G,X,ee)=>{ee!=null&&G.push({name:X,value:ee.toString()})};for(const G in C)O(B.counters,G,C[G]);if(v.interactionRange[0]!==1/0&&v.interactionRange[1]!==-1/0&&(O(B.counters,"interactionRangeMin",v.interactionRange[0]),O(B.counters,"interactionRangeMax",v.interactionRange[1])),S)for(const G of Object.values(I)){const X=S.find(ee=>ee.name===G);X&&O(B.counters,G,X.startTime)}return O(B.counters,"visibilityHidden",v.visibilityHidden),O(B.attributes,"style",function(G){if(G)for(const X of G){const ee=X.name.split("?")[0];if(o.i(ee)){const oe=ee.split("/").slice(-2);if(oe.length===2)return`mapbox://styles/${oe[0]}/${oe[1]}`}}}(w)),O(B.attributes,"terrainEnabled",v.terrainEnabled?"true":"false"),O(B.attributes,"fogEnabled",v.fogEnabled?"true":"false"),O(B.attributes,"projection",v.projection),O(B.attributes,"zoom",v.zoom),O(B.metadata,"devicePixelRatio",j),O(B.metadata,"connectionEffectiveType",D),O(B.metadata,"navigatorUserAgent",navigator.userAgent),O(B.metadata,"screenWidth",window.screen.width),O(B.metadata,"screenHeight",window.screen.height),O(B.metadata,"windowWidth",window.innerWidth),O(B.metadata,"windowHeight",window.innerHeight),O(B.metadata,"mapWidth",v.width/j),O(B.metadata,"mapHeight",v.height/j),O(B.metadata,"webglRenderer",v.renderer),O(B.metadata,"webglVendor",v.vendor),O(B.metadata,"sdkVersion",A),O(B.metadata,"sdkIdentifier","mapbox-gl-js"),B}(c);for(const v of m.metadata);for(const v of m.counters);for(const v of m.attributes);this.postEvent(n,m,()=>{},p)}},zr=xr.postPerformanceEvent.bind(xr),Hr=new class extends Tt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(p,n,c,m){if(!o.e.API_URL||!o.e.SESSION_PATH)return;const v=Ke(o.e.API_URL+o.e.SESSION_PATH);v.params.push(`sku=${n||""}`),v.params.push(`access_token=${m||o.e.ACCESS_TOKEN||""}`);const w={url:st(v),headers:{"Content-Type":"text/plain"}};this.pendingRequest=o.g(w,S=>{this.pendingRequest=null,c(S),this.saveEventData(),this.processRequests(m)})}getSessionAPI(p,n,c,m){this.skuToken=n,this.errorCb=m,o.e.SESSION_PATH&&o.e.API_URL&&(c||o.e.ACCESS_TOKEN?this.queueRequest({id:p,timestamp:Date.now()},c):this.errorCb(new Error(Be)))}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:c}=this.queue.shift();n&&this.success[n]||this.getSession(c,this.skuToken,m=>{m?this.errorCb(m):n&&(this.success[n]=!0)},p)}remove(){this.errorCb=null}},jn=Hr.getSessionAPI.bind(Hr),hn=new Set;function Ji(p,n){n?hn.add(p):hn.delete(p)}class Ii{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(n,c){this._updatedSourceCaches[n]=c,this.setDirty()}discardSourceCacheUpdate(n){delete this._updatedSourceCaches[n]}updateLayer(n){const c=n.scope;this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._updatedLayers[c].add(n.id),this.setDirty()}removeLayer(n){const c=n.scope;this._removedLayers[c]=this._removedLayers[c]||{},this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._removedLayers[c][n.id]=n,this._updatedLayers[c].delete(n.id),this._updatedPaintProps.delete(n.fqid),this.setDirty()}getRemovedLayer(n){return this._removedLayers[n.scope]?this._removedLayers[n.scope][n.id]:null}discardLayerRemoval(n){this._removedLayers[n.scope]&&delete this._removedLayers[n.scope][n.id]}getLayerUpdatesByScope(){const n={};for(const c in this._updatedLayers)n[c]=n[c]||{},n[c].updatedIds=Array.from(this._updatedLayers[c].values());for(const c in this._removedLayers)n[c]=n[c]||{},n[c].removedIds=Object.keys(this._removedLayers[c]);return n}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(n){this._updatedPaintProps.add(n.fqid),this.setDirty()}getUpdatedImages(n){return this._updatedImages[n]?Array.from(this._updatedImages[n].values()):[]}updateImage(n,c){this._updatedImages[c]=this._updatedImages[c]||new Set,this._updatedImages[c].add(o.I.toString(n)),this.setDirty()}resetUpdatedImages(n){this._updatedImages[n]&&this._updatedImages[n].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Vi(p){const{userImage:n}=p;return!!(n&&n.render&&n.render())&&(p.data.replace(new Uint8Array(n.data.buffer)),!0)}class As extends o.E{constructor(n){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=n,n!=="raster"&&o.r()&&(this.imageRasterizerDispatcher=new o.D(o.t(),this,"Image Rasterizer Worker",1))}addScope(n){this.loaded.set(n,!1),this.imageProviders.set(n,new Map),this.images.set(n,new Map),this.updatedImages.set(n,new Set),this.callbackDispatchedThisFrame.set(n,new Set),this.patterns.set(n,new Map),this.atlasImage.set(n,new o.q({width:1,height:1}))}removeScope(n){this.loaded.delete(n),this.imageProviders.delete(n),this.images.delete(n),this.updatedImages.delete(n),this.callbackDispatchedThisFrame.delete(n),this.patterns.delete(n),this.atlasImage.delete(n);const c=this.atlasTexture.get(n);c&&(c.destroy(),this.atlasTexture.delete(n))}addImageProvider(n,c){this.imageProviders.has(c)||this.imageProviders.set(c,new Map),this.imageProviders.get(c).set(n.id,n)}removeImageProvider(n,c){this.imageProviders.has(c)&&this.imageProviders.get(c).delete(n)}getPendingImageProviders(){const n=[];for(const c of this.imageProviders.values())for(const m of c.values())m.hasPendingRequests()&&n.push(m);return n}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new o.x),this._imageRasterizer}isLoaded(){for(const n of this.loaded.keys())if(!this.loaded.get(n))return!1;return!0}setLoaded(n,c){if(this.loaded.get(c)!==n&&(this.loaded.set(c,n),n)){for(const{ids:m,callback:v}of this.requestors)this._notify(m,c,v);this.requestors=[]}}hasImage(n,c){return!!this.getImage(n,c)}getImage(n,c){return this.images.get(c).get(n.toString())}addImage(n,c,m){this._validate(n,m)&&this.images.get(c).set(n.toString(),m)}_validate(n,c){let m=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new o.y(new Error(`Image "${n.name}" has invalid "stretchX" value`))),m=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new o.y(new Error(`Image "${n.name}" has invalid "stretchY" value`))),m=!1),this._validateContent(c.content,c)||(this.fire(new o.y(new Error(`Image "${n.name}" has invalid "content" value`))),m=!1),m}_validateStretch(n,c){if(!n)return!0;let m=0;for(const v of n){if(v[0]<m||v[1]<v[0]||c<v[1])return!1;m=v[1]}return!0}_validateContent(n,c){return n?n.length!==4||!c.usvg&&(n[0]<0||c.data.width<n[0]||n[1]<0||c.data.height<n[1]||n[2]<0||c.data.width<n[2]||n[3]<0||c.data.height<n[3])?!1:!(n[2]<n[0]||n[3]<n[1]):!0}updateImage(n,c,m){const v=this.images.get(c).get(n.toString());m.version=v.version+1,this.images.get(c).set(n.toString(),m),this.updatedImages.get(c).add(n),this.removeFromImageRasterizerCache(n,c)}clearUpdatedImages(n){this.updatedImages.get(n).clear()}removeFromImageRasterizerCache(n,c){this.spriteFormat!=="raster"&&(o.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[n],scope:c}):this.imageRasterizer.removeImagesFromCacheByIds([n],c))}removeImage(n,c){const m=this.images.get(c),v=m.get(n.toString());m.delete(n.toString()),this.patterns.get(c).delete(n.toString()),this.removeFromImageRasterizerCache(n,c),v.userImage&&v.userImage.onRemove&&v.userImage.onRemove()}listImages(n){return Array.from(this.images.get(n).keys()).map(c=>o.I.from(c))}getImages(n,c,m){const v=[],w=[],S=this.imageProviders.get(c);for(const D of n){if(!D.iconsetId){v.push(D);continue}const B=S.get(D.iconsetId);B&&(this.getImage(D,c)?w.push(D):B.addPendingRequest(D))}if(v.length===0)return void this._notify(w,c,m);let C=!0;const j=!!this.loaded.get(c),M=this.images.get(c);if(!j)for(const D of v)M.has(D.toString())||(C=!1);j||C?this._notify(v,c,m):this.requestors.push({ids:v,scope:c,callback:m})}rasterizeImages(n,c){const m=new Map,{tasks:v,scope:w}=n;for(const[S,C]of v.entries()){const j=this.getImage(C.id,w);j&&m.set(S,{image:j,imageVariant:C})}this._rasterizeImages(w,m,c)}_rasterizeImages(n,c,m){if(o.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:c,scope:n},m);else{const v=new Map;for(const[w,{image:S,imageVariant:C}]of c.entries())v.set(w,this.imageRasterizer.rasterize(C,S,n,0));m(void 0,v)}}getUpdatedImages(n){return this.updatedImages.get(n)||new Set}_notify(n,c,m){const v=this.images.get(c),w=new Map;for(const S of n){if(!v.get(S.toString())){if(S.iconsetId)continue;this.fire(new o.z("styleimagemissing",{id:S.name}))}const C=v.get(S.toString());if(!C){o.w(`Image "${S.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const j={data:C.usvg?null:C.data.clone(),pixelRatio:C.pixelRatio,sdf:C.sdf,usvg:C.usvg,version:C.version,stretchX:C.stretchX,stretchY:C.stretchY,content:C.content,hasRenderCallback:!!(C.userImage&&C.userImage.render)};C.usvg&&Object.assign(j,{width:C.icon.usvg_tree.width,height:C.icon.usvg_tree.height}),w.set(o.I.toString(S),j)}m(null,w)}getPixelSize(n){const{width:c,height:m}=this.atlasImage.get(n);return{width:c,height:m}}getPattern(n,c,m){const v=n.toString(),w=this.patterns.get(c),S=w.get(v),C=this.getImage(n,c);if(!C)return null;if(S){if(S.position.version===C.version)return S.position;S.position.version=C.version}else{if(C.usvg&&!C.data){const j=this.getPatternInFlightId(v,c);if(this.patternsInFlight.has(j))return null;this.patternsInFlight.add(j);const M=new o.A(n).scaleSelf(o.o.devicePixelRatio),D=new Map([[M.toString(),{image:C,imageVariant:M}]]);return this._rasterizeImages(c,D,(B,O)=>this.storePatternImage(M,c,C,m,O)),null}this.storePattern(n,c,C)}return this._updatePatternAtlas(c,m),w.get(v).position}getPatternInFlightId(n,c){return o.B(n,c)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(n,c,m,v,w){const S=n.toString(),C=w?w.get(S):void 0;C&&(m.data=C,this.storePattern(n.id,c,m),this._updatePatternAtlas(c,v),this.patternsInFlight.delete(this.getPatternInFlightId(n.id.toString(),c)))}storePattern(n,c,m){const v={w:m.data.width+2*o.C,h:m.data.height+2*o.C,x:0,y:0},w=new o.F(v,m,o.C);this.patterns.get(c).set(n.toString(),{bin:v,position:w})}destroyAtlasTextures(){for(const n of this.atlasTexture.values())n&&n.destroy();this.atlasTexture.clear()}bind(n,c){const m=n.gl;let v=this.atlasTexture.get(c);v?this.dirty&&(v.update(this.atlasImage.get(c)),this.dirty=!1):(v=new o.T(n,this.atlasImage.get(c),m.RGBA8),this.atlasTexture.set(c,v)),v.bind(m.LINEAR,m.CLAMP_TO_EDGE)}_updatePatternAtlas(n,c){const m=this.patterns.get(n),v=Array.from(m.values()).map(({bin:M})=>M),{w,h:S}=o.G(v),C=this.atlasImage.get(n);C.resize({width:w||1,height:S||1});const j=this.images.get(n);for(const[M,{bin:D,position:B}]of m.entries()){let O=B.padding;const G=D.x+O,X=D.y+O,ee=j.get(M).data,oe=ee.width,ie=ee.height;O=O>1?O-1:O,o.q.copy(ee,C,{x:0,y:0},{x:G,y:X},{width:oe,height:ie},c),o.q.copy(ee,C,{x:0,y:ie-O},{x:G,y:X-O},{width:oe,height:O},c),o.q.copy(ee,C,{x:0,y:0},{x:G,y:X+ie},{width:oe,height:O},c),o.q.copy(ee,C,{x:oe-O,y:0},{x:G-O,y:X},{width:O,height:ie},c),o.q.copy(ee,C,{x:0,y:0},{x:G+oe,y:X},{width:O,height:ie},c),o.q.copy(ee,C,{x:oe-O,y:ie-O},{x:G-O,y:X-O},{width:O,height:O},c),o.q.copy(ee,C,{x:0,y:ie-O},{x:G+oe,y:X-O},{width:O,height:O},c),o.q.copy(ee,C,{x:0,y:0},{x:G+oe,y:X+ie},{width:O,height:O},c),o.q.copy(ee,C,{x:oe-O,y:0},{x:G-O,y:X+ie},{width:O,height:O},c)}this.dirty=!0}beginFrame(){for(const n of this.images.keys())this.callbackDispatchedThisFrame.set(n,new Set)}dispatchRenderCallbacks(n,c){const m=this.images.get(c);for(const v of n){if(this.callbackDispatchedThisFrame.get(c).has(v.toString()))continue;this.callbackDispatchedThisFrame.get(c).add(v.toString());const w=m.get(v.toString());Vi(w)&&this.updateImage(v,c,w)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function bi(p){const n=p.value,c=p.valueSpec,m=p.style,v=p.styleSpec,w=p.key,S=p.arrayElementValidator||li;if(!Array.isArray(n))return[new o.V(w,n,`array expected, ${o.K(n)} found`)];if(c.length&&n.length!==c.length)return[new o.V(w,n,`array length ${c.length} expected, length ${n.length} found`)];if(c["min-length"]&&n.length<c["min-length"])return[new o.V(w,n,`array length at least ${c["min-length"]} expected, length ${n.length} found`)];let C={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum,function:void 0};v.$version<7&&(C.function=c.function),o.H(c.value)&&(C=c.value);let j=[];for(let M=0;M<n.length;M++)j=j.concat(S({array:n,arrayIndex:M,value:n[M],valueSpec:C,style:m,styleSpec:v,key:`${w}[${M}]`},!0));return j}function Is(p){const n=p.key,c=p.value,m=p.valueSpec;if(!o.L(c))return[new o.V(n,c,`number expected, ${o.K(c)} found`)];if(c!=c)return[new o.V(n,c,"number expected, NaN found")];if("minimum"in m){let v=m.minimum;if(Array.isArray(m.minimum)&&(v=m.minimum[p.arrayIndex]),c<v)return[new o.V(n,c,`${c} is less than the minimum value ${v}`)]}if("maximum"in m){let v=m.maximum;if(Array.isArray(m.maximum)&&(v=m.maximum[p.arrayIndex]),c>v)return[new o.V(n,c,`${c} is greater than the maximum value ${v}`)]}return[]}function nt(p){const n=p.key,c=p.value;if(!o.H(c))return[new o.V(n,c,`object expected, ${o.K(c)} found`)];const m=p.valueSpec,v=o.J(c.type);let w,S,C,j={};const M=v!=="categorical"&&c.property===void 0,D=!M,B=function(ee){const oe=ee.stops;return Array.isArray(oe)&&Array.isArray(oe[0])&&o.H(oe[0][0])}(c),O=Os({key:p.key,value:p.value,valueSpec:p.styleSpec.function,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{stops:function(ee){if(v==="identity")return[new o.V(ee.key,ee.value,'identity function may not have a "stops" property')];let oe=[];const ie=ee.value;return oe=oe.concat(bi({key:ee.key,value:ie,valueSpec:ee.valueSpec,style:ee.style,styleSpec:ee.styleSpec,arrayElementValidator:G})),Array.isArray(ie)&&ie.length===0&&oe.push(new o.V(ee.key,ie,"array must have at least one stop")),oe},default:function(ee){return li({key:ee.key,value:ee.value,valueSpec:m,style:ee.style,styleSpec:ee.styleSpec})}}});return v==="identity"&&M&&O.push(new o.V(p.key,p.value,'missing required property "property"')),v==="identity"||c.stops||O.push(new o.V(p.key,p.value,'missing required property "stops"')),v==="exponential"&&m.expression&&!o.M(m)&&O.push(new o.V(p.key,p.value,"exponential functions not supported")),p.styleSpec.$version>=8&&(D&&!o.N(m)?O.push(new o.V(p.key,p.value,"property functions not supported")):M&&!o.O(m)&&O.push(new o.V(p.key,p.value,"zoom functions not supported"))),v!=="categorical"&&!B||c.property!==void 0||O.push(new o.V(p.key,p.value,'"property" property is required')),O;function G(ee){let oe=[];const ie=ee.value,ce=ee.key;if(!Array.isArray(ie))return[new o.V(ce,ie,`array expected, ${o.K(ie)} found`)];if(ie.length!==2)return[new o.V(ce,ie,`array length 2 expected, length ${ie.length} found`)];if(B){if(!o.H(ie[0]))return[new o.V(ce,ie,`object expected, ${o.K(ie[0])} found`)];const me=ie[0];if(me.zoom===void 0)return[new o.V(ce,ie,"object stop key must have zoom")];if(me.value===void 0)return[new o.V(ce,ie,"object stop key must have value")];const de=o.J(me.zoom);if(typeof de!="number")return[new o.V(ce,me.zoom,"stop zoom values must be numbers")];if(C&&C>de)return[new o.V(ce,me.zoom,"stop zoom values must appear in ascending order")];de!==C&&(C=de,S=void 0,j={}),oe=oe.concat(Os({key:`${ce}[0]`,value:ie[0],valueSpec:{zoom:{}},style:ee.style,styleSpec:ee.styleSpec,objectElementValidators:{zoom:Is,value:X}}))}else oe=oe.concat(X({key:`${ce}[0]`,value:ie[0],style:ee.style,styleSpec:ee.styleSpec},ie));return o.Q(o.S(ie[1]))?oe.concat([new o.V(`${ce}[1]`,ie[1],"expressions are not allowed in function stops.")]):oe.concat(li({key:`${ce}[1]`,value:ie[1],valueSpec:m,style:ee.style,styleSpec:ee.styleSpec}))}function X(ee,oe){const ie=o.K(ee.value),ce=o.J(ee.value),me=ee.value!==null?ee.value:oe;if(w){if(ie!==w)return[new o.V(ee.key,me,`${ie} stop domain type must match previous stop domain type ${w}`)]}else w=ie;if(ie!=="number"&&ie!=="string"&&ie!=="boolean"&&typeof ce!="number"&&typeof ce!="string"&&typeof ce!="boolean")return[new o.V(ee.key,me,"stop domain value must be a number, string, or boolean")];if(ie!=="number"&&v!=="categorical"){let de=`number expected, ${ie} found`;return o.N(m)&&v===void 0&&(de+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new o.V(ee.key,me,de)]}return v!=="categorical"||ie!=="number"||typeof ce=="number"&&isFinite(ce)&&Math.floor(ce)===ce?v!=="categorical"&&ie==="number"&&typeof ce=="number"&&typeof S=="number"&&S!==void 0&&ce<S?[new o.V(ee.key,me,"stop domain values must appear in ascending order")]:(S=ce,v==="categorical"&&ce in j?[new o.V(ee.key,me,"stop domain values must be unique")]:(j[ce]=!0,[])):[new o.V(ee.key,me,`integer expected, found ${String(ce)}`)]}}function Ct(p){const n=(p.expressionContext==="property"?o.W:o.U)(o.S(p.value),p.valueSpec);if(n.result==="error")return n.value.map(m=>new o.V(`${p.key}${m.key}`,p.value,m.message));const c=n.value.expression||n.value._styleExpression.expression;if(p.expressionContext==="property"&&p.propertyKey==="text-font"&&!c.outputDefined())return[new o.V(p.key,p.value,`Invalid data expression for "${p.propertyKey}". Output values must be contained as literals within the expression.`)];if(p.expressionContext==="property"&&p.propertyType==="layout"&&!o.Z(c))return[new o.V(p.key,p.value,'"feature-state" data expressions are not supported with layout properties.')];if(p.expressionContext==="filter")return Kt(c,p);if(p.expressionContext==="appearance")return jr(c,p);if(p.expressionContext&&p.expressionContext.indexOf("cluster")===0){if(!o.X(c,["zoom","feature-state"]))return[new o.V(p.key,p.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(p.expressionContext==="cluster-initial"&&!o.Y(c))return[new o.V(p.key,p.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Kt(p,n){const c=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const v of n.valueSpec.expression.parameters)c.delete(v);if(c.size===0)return[];const m=[];return p instanceof o._&&c.has(p.name)?[new o.V(n.key,n.value,`["${p.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(p.eachChild(v=>{m.push(...Kt(v,n))}),m)}function jr(p,n){const c=new Set;if(n.valueSpec&&n.valueSpec.expression)for(const v of n.valueSpec.expression.parameters)c.add(v);if(c.size===0)return[];const m=[];return p instanceof o._&&!c.has(p.name)?[new o.V(n.key,n.value,`["${p.name}"] is not an allowed parameter`)]:(p.eachChild(v=>{m.push(...jr(v,n))}),m)}function yr(p){const n=p.key,c=p.value,m=p.valueSpec,v=[];return Array.isArray(m.values)?m.values.indexOf(o.J(c))===-1&&v.push(new o.V(n,c,`expected one of [${m.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(m.values).indexOf(o.J(c))===-1&&v.push(new o.V(n,c,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(c)} found`)),v}function br(p){return o.a2(o.S(p.value))?Ct(Object.assign({},p,{expressionContext:"filter",valueSpec:p.styleSpec[`filter_${p.layerType||"fill"}`]})):Fr(p)}function Fr(p){const n=p.value,c=p.key;if(!Array.isArray(n))return[new o.V(c,n,`array expected, ${o.K(n)} found`)];if(n.length<1)return[new o.V(c,n,"filter array must have at least 1 element")];const m=p.styleSpec;let v=yr({key:`${c}[0]`,value:n[0],valueSpec:m.filter_operator});switch(o.J(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&o.J(n[1])==="$type"&&v.push(new o.V(c,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&v.push(new o.V(c,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(o.a0(n[1])||v.push(new o.V(`${c}[1]`,n[1],`string expected, ${o.K(n[1])} found`)));for(let w=2;w<n.length;w++)o.J(n[1])==="$type"?v=v.concat(yr({key:`${c}[${w}]`,value:n[w],valueSpec:m.geometry_type})):o.a0(n[w])||o.L(n[w])||o.$(n[w])||v.push(new o.V(`${c}[${w}]`,n[w],`string, number, or boolean expected, ${o.K(n[w])} found.`));break;case"any":case"all":case"none":for(let w=1;w<n.length;w++)v=v.concat(Fr({key:`${c}[${w}]`,value:n[w],style:p.style,styleSpec:p.styleSpec}));break;case"has":case"!has":n.length!==2?v.push(new o.V(c,n,`filter array for "${n[0]}" operator must have 2 elements`)):o.a0(n[1])||v.push(new o.V(`${c}[1]`,n[1],`string expected, ${o.K(n[1])} found`))}return v}function On(p,n){const c=p.key,m=p.style,v=p.layer,w=p.styleSpec,S=p.value,C=p.objectKey,j=w[`${n}_${p.layerType}`];if(!j)return[];const M=C.match(/^(.*)-use-theme$/);if(M&&j[M[1]])return o.Q(o.S(S))?[].concat(li({key:c,value:S,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:m,styleSpec:w,expressionContext:"property",propertyType:n,propertyKey:C})):li({key:c,value:S,valueSpec:{type:"string"},style:m,styleSpec:w});const D=C.match(/^(.*)-transition$/);if(n==="paint"&&D&&j[D[1]]&&j[D[1]].transition)return li({key:c,value:S,valueSpec:w.transition,style:m,styleSpec:w});const B=p.valueSpec||j[C];if(!B)return[new o.a3(c,S,`unknown property "${C}"`)];let O;if(o.a0(S)&&o.N(B)&&!B.tokens&&(O=/^{([^}]+)}$/.exec(S))){const X=`\`{ "type": "identity", "property": ${O?JSON.stringify(O[1]):'"_"'} }\``;return[new o.V(c,S,`"${C}" does not support interpolation syntax
Use an identity property function instead: ${X}.`)]}const G=[];if(p.layerType==="symbol")C!=="text-field"||!m||m.glyphs||m.imports||G.push(new o.V(c,S,'use of "text-field" requires a style "glyphs" property')),C==="text-font"&&o.a4(o.S(S))&&o.J(S.type)==="identity"&&G.push(new o.V(c,S,'"text-font" does not support identity functions'));else if(p.layerType==="model"&&n==="paint"&&v&&v.layout&&v.layout.hasOwnProperty("model-id")&&o.N(B)&&(o.a5(B)||o.O(B))){const X=o.W(o.S(S),B).value,ee="expression"in X&&X.expression||"_styleExpression"in X&&X._styleExpression&&X._styleExpression.expression;ee&&!o.X(ee,["measure-light"])&&(C==="model-emissive-strength"&&o.Y(ee)&&o.Z(ee)||G.push(new o.V(c,S,`${C} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return G.concat(li({key:p.key,value:S,valueSpec:B,style:m,styleSpec:w,expressionContext:"property",propertyType:n,propertyKey:C}))}function pi(p){return On(p,"paint")}function Ri(p){return On(p,"layout")}function $s(p){let n=[];const c=p.value,m=p.key,v=p.style,w=p.styleSpec;if(!o.H(c))return[new o.V(m,c,"object expected")];c.type||c.ref||n.push(new o.V(m,c,'either "type" or "ref" is required'));let S=o.J(c.type);const C=o.J(c.ref);if(c.id){const j=o.J(c.id);for(let M=0;M<p.arrayIndex;M++){const D=v.layers[M];o.J(D.id)===j&&n.push(new o.V(m,c.id,`duplicate layer id "${j}", previously used at line ${D.id.__line__}`))}}if("ref"in c){let j;["type","source","source-layer","filter","layout"].forEach(M=>{M in c&&n.push(new o.V(m,c[M],`"${M}" is prohibited for ref layers`))}),v.layers.forEach(M=>{o.J(M.id)===C&&(j=M)}),j?j.ref?n.push(new o.V(m,c.ref,"ref cannot reference another ref layer")):S=o.J(j.type):typeof C=="string"&&n.push(new o.V(m,c.ref,`ref layer "${C}" not found`))}else if(S!=="background"&&S!=="sky"&&S!=="slot")if(c.source)if(o.a0(c.source)){const j=v.sources&&v.sources[c.source],M=j&&o.J(j.type);j?M==="vector"&&S==="raster"?n.push(new o.V(m,c.source,`layer "${c.id}" requires a raster source`)):M==="raster"&&S!=="raster"?n.push(new o.V(m,c.source,`layer "${c.id}" requires a vector source`)):M!=="vector"||c["source-layer"]?M==="raster-dem"&&S!=="hillshade"?n.push(new o.V(m,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="raster-array"||["raster","raster-particle"].includes(S)?S==="line"&&c.paint&&(c.paint["line-gradient"]||c.paint["line-trim-offset"])&&M==="geojson"&&!j.lineMetrics?n.push(new o.V(m,c,`layer "${c.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):S==="raster-particle"&&M!=="raster-array"&&n.push(new o.V(m,c.source,`layer "${c.id}" requires a 'raster-array' source.`)):n.push(new o.V(m,c.source,"raster-array source can only be used with layer type 'raster'.")):n.push(new o.V(m,c,`layer "${c.id}" must specify a "source-layer"`)):n.push(new o.V(m,c.source,`source "${c.source}" not found`))}else n.push(new o.V(`${m}.source`,c.source,'"source" must be a string'));else n.push(new o.V(m,c,'missing required property "source"'));return n=n.concat(Os({key:m,value:c,valueSpec:w.layer,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{"*":()=>[],type:()=>li({key:`${m}.type`,value:c.type,valueSpec:w.layer.type,style:p.style,styleSpec:p.styleSpec,object:c,objectKey:"type"}),filter:j=>br(Object.assign({layerType:S},j)),layout:j=>Os({layer:c,key:j.key,value:j.value,valueSpec:{},style:j.style,styleSpec:j.styleSpec,objectElementValidators:{"*":M=>Ri(Object.assign({layerType:S},M))}}),paint:j=>Os({layer:c,key:j.key,value:j.value,valueSpec:{},style:j.style,styleSpec:j.styleSpec,objectElementValidators:{"*":M=>pi(Object.assign({layerType:S,layer:c},M))}}),appearances(j){const M=bi({key:j.key,value:j.value,valueSpec:j.valueSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:O=>function(G){const{key:X,layer:ee,layerType:oe}=G,ie=o.J(G.value),ce=o.J(ie.name),me=o.J(ie.condition),de=Os({key:X,value:ie,valueSpec:G.styleSpec.appearance,style:G.style,styleSpec:G.styleSpec,objectElementValidators:{condition:Ee=>function(ge){const je=[];return je.push(...Ct({key:ge.key,value:ge.object.condition,valueSpec:o.a6.appearance.condition,expressionContext:"appearance"})),je}(Object.assign({layer:ee,layerType:oe},Ee)),properties:Ee=>function(ge){const je=[],{styleSpec:Se,layer:ve,layerType:Ie}=ge,$e=Se[`paint_${Ie}`],Fe=Se[`layout_${Ie}`],at=ge.object[ge.objectKey];for(const Qe in at){const pt=Qe in $e?"paint":Qe in Fe?"layout":void 0;if(!pt){je.push(new o.V(ge.key,Qe,`unknown property "${Qe}" for layer type "${Ie}"`));continue}const Ot=Object.assign({},ge,{key:`${ge.key}.${Qe}`,object:at,objectKey:Qe,layer:ve,layerType:Ie,value:at[Qe],valueSpec:pt==="paint"?$e[Qe]:Fe[Qe]});je.push(...On(Ot,pt))}return je}(Object.assign({layer:ee,layerType:oe},Ee))}});return ce!=="hidden"&&me===void 0&&de.push(new o.V(G.key,"name",'Appearance with name different than "hidden" must have a condition')),de}(Object.assign({layerType:S,layer:c},O))}),D=Array.isArray(j.value)?j.value:[],B=new Set;return D.forEach((O,G)=>{const X=o.J(O.name);if(X)if(B.has(X)){const ee=o.J(c.id);M.push(new o.V(j.key,X,`Duplicated appearance name "${X}" for layer "${ee}"`))}else B.add(X)}),M}}})),n}function ws({key:p,value:n}){return o.a0(n)?[]:[new o.V(p,n,`string expected, ${o.K(n)} found`)]}const Lo={promoteId:function p({key:n,value:c}){if(o.a0(c))return ws({key:n,value:c});if(Array.isArray(c)){const v=[],w=o.S(c),S=o.U(w);return S.result==="error"&&S.value.forEach(C=>{v.push(new o.V(`${n}${C.key}`,null,`${C.message}`))}),o.X(S.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||v.push(new o.V(`${n}`,null,"promoteId expression should be only feature dependent")),v}if(!o.H(c))return[new o.V(n,c,`string, expression or object expected, "${o.K(c)}" found`)];const m=[];for(const v in c)m.push(...p({key:`${n}.${v}`,value:c[v]}));return m}};function ho(p){const n=p.value,c=p.key,m=p.styleSpec,v=p.style;if(!o.H(n))return[new o.V(c,n,`object expected, ${o.K(n)} found`)];if(!("type"in n))return[new o.V(c,n,'"type" is required')];const w=o.J(n.type);let S=[];switch(["vector","raster","raster-dem","raster-array"].includes(w)&&("url"in n||"tiles"in n||S.push(new o.a3(c,n,'Either "url" or "tiles" is required.'))),w){case"vector":case"raster":case"raster-dem":case"raster-array":return S=S.concat(Os({key:c,value:n,valueSpec:m[`source_${w.replace("-","_")}`],style:p.style,styleSpec:m,objectElementValidators:Lo})),S;case"geojson":if(S=Os({key:c,value:n,valueSpec:m.source_geojson,style:v,styleSpec:m,objectElementValidators:Lo}),"cluster"in n&&"clusterProperties"in n){if(!o.H(n.clusterProperties))return[new o.V(`${c}.clusterProperties`,n,`object expected, ${o.K(n)} found`)];for(const C in n.clusterProperties){const j=n.clusterProperties[C];if(!Array.isArray(j))return[new o.V(`${c}.clusterProperties.${C}`,j,"array expected")];const[M,D]=j,B=typeof M=="string"?[M,["accumulated"],["get",C]]:M;S.push(...Ct({key:`${c}.${C}.map`,value:D,expressionContext:"cluster-map"})),S.push(...Ct({key:`${c}.${C}.reduce`,value:B,expressionContext:"cluster-reduce"}))}}return S;case"video":return Os({key:c,value:n,valueSpec:m.source_video,style:v,styleSpec:m});case"image":return Os({key:c,value:n,valueSpec:m.source_image,style:v,styleSpec:m});case"canvas":return[new o.V(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return yr({key:`${c}.type`,value:n.type,valueSpec:{values:rr(m)}})}}function rr(p){return p.source.reduce((n,c)=>{const m=p[c];return m.type.type==="enum"&&(n=n.concat(Object.keys(m.type.values||{}))),n},[])}function yt(p){const n=p.value,c=p.styleSpec,m=c.light,v=p.style;if(n===void 0)return[];if(!o.H(n))return[new o.V("light",n,`object expected, ${o.K(n)} found`)];let w=[];for(const S in n){const C=S.match(/^(.*)-transition$/),j=S.match(/^(.*)-use-theme$/);w=w.concat(j&&m[j[1]]?li({key:S,value:n[S],valueSpec:{type:"string"},style:v,styleSpec:c}):C&&m[C[1]]&&m[C[1]].transition?li({key:S,value:n[S],valueSpec:c.transition,style:v,styleSpec:c}):m[S]?li({key:S,value:n[S],valueSpec:m[S],style:v,styleSpec:c}):[new o.V(S,n[S],`unknown property "${S}"`)])}return w}function Ar(p){const n=p.value;if(!n)return[];const c=p.key;if(!o.H(n))return[new o.V(c,n,`object expected, ${o.K(n)} found`)];let m=[];const v=p.styleSpec,w=v["light-3d"],S=p.style,C=p.style.lights;for(const D of["type","id"])if(!(D in n))return m=m.concat([new o.V(c,n,`missing property "${D}"`)]),m;if(!o.a0(n.type))return m=m.concat([new o.V(`${c}.type`,n.type,"string expected")]),m;if(C)for(let D=0;D<p.arrayIndex;D++){const B=o.J(n.type),O=C[D];o.J(O.type)===B&&m.push(new o.V(c,n.id,`duplicate light type "${n.type}", previously defined at line ${O.id.__line__}`))}const j=`properties_light_${n.type}`;if(!(j in v))return m=m.concat([new o.V(`${c}.type`,n,`Invalid light type ${n.type}`)]),m;const M=v[j];for(const D in n)if(D==="properties"){const B=n[D];if(!o.H(B))return m=m.concat([new o.V("properties",B,`object expected, ${o.K(B)} found`)]),m;for(const O in B){const G=O.match(/^(.*)-transition$/),X=O.match(/^(.*)-use-theme$/);m=m.concat(X&&M[X[1]]?li({key:D,value:B[O],valueSpec:{type:"string"},style:S,styleSpec:v}):G&&M[G[1]]&&M[G[1]].transition?li({key:D,value:n[D],valueSpec:v.transition,style:S,styleSpec:v}):M[O]?li({key:O,value:B[O],valueSpec:M[O],style:S,styleSpec:v}):[new o.a3(p.key,B[O],`unknown property "${O}"`)])}}else m=m.concat(w[D]?li({key:D,value:n[D],valueSpec:w[D],style:S,styleSpec:v}):[new o.a3(D,n[D],`unknown property "${D}"`)]);return m}function Qr(p){const n=p.value,c=p.key,m=p.style,v=p.styleSpec,w=v.terrain;if(n==null)return[];if(!o.H(n))return[new o.V("terrain",n,`object expected, ${o.K(n)} found`)];let S=[];for(const C in n){const j=C.match(/^(.*)-transition$/),M=C.match(/^(.*)-use-theme$/);S=S.concat(M&&w[M[1]]?li({key:C,value:n[C],valueSpec:{type:"string"},style:m,styleSpec:v}):j&&w[j[1]]&&w[j[1]].transition?li({key:C,value:n[C],valueSpec:v.transition,style:m,styleSpec:v}):w[C]?li({key:C,value:n[C],valueSpec:w[C],style:m,styleSpec:v}):[new o.a3(C,n[C],`unknown property "${C}"`)])}if(n.source)if(o.a0(n.source)){const C=m.sources&&m.sources[n.source],j=C&&o.J(C.type);C?j!=="raster-dem"&&S.push(new o.V(`${c}.source`,n.source,`terrain cannot be used with a source of type ${j}, it only be used with a "raster-dem" source type`)):S.push(new o.V(`${c}.source`,n.source,`source "${n.source}" not found`))}else S.push(new o.V(`${c}.source`,n.source,"source must be a string"));else S.push(new o.V(c,n,'terrain is missing required property "source"'));return S}function Cn(p){const n=p.value,c=p.style,m=p.styleSpec,v=m.fog;if(n===void 0)return[];if(!o.H(n))return[new o.V("fog",n,`object expected, ${o.K(n)} found`)];let w=[];for(const S in n){const C=S.match(/^(.*)-transition$/),j=S.match(/^(.*)-use-theme$/);w=w.concat(j&&v[j[1]]?li({key:S,value:n[S],valueSpec:{type:"string"},style:c,styleSpec:m}):C&&v[C[1]]&&v[C[1]].transition?li({key:S,value:n[S],valueSpec:m.transition,style:c,styleSpec:m}):v[S]?li({key:S,value:n[S],valueSpec:v[S],style:c,styleSpec:m}):[new o.a3(S,n[S],`unknown property "${S}"`)])}return w}const Mi={"*":()=>[],array:bi,boolean:function(p){const n=p.value,c=p.key;return o.$(n)?[]:[new o.V(c,n,`boolean expected, ${o.K(n)} found`)]},number:Is,color:function({key:p,value:n}){return o.a0(n)?o.a1.parseCSSColor(n)===null?[new o.V(p,n,`color expected, "${n}" found`)]:[]:[new o.V(p,n,`color expected, ${o.K(n)} found`)]},enum:yr,filter:br,function:nt,layer:$s,object:Os,source:ho,model:o.a7,light:yt,"light-3d":Ar,terrain:Qr,fog:Cn,string:ws,formatted:function(p){return ws(p).length===0?[]:Ct(p)},resolvedImage:function(p){return ws(p).length===0?[]:Ct(p)},projection:function(p){const n=p.value,c=p.styleSpec,m=c.projection,v=p.style;if(o.H(n)){let w=[];for(const S in n)w=w.concat(li({key:S,value:n[S],valueSpec:m[S],style:v,styleSpec:c}));return w}return o.a0(n)?[]:[new o.V("projection",n,`object or string expected, ${o.K(n)} found`)]},import:function(p){const n=p.key,{value:c,styleSpec:m}=p;if(!o.H(c))return[new o.V(n,c,"import must be an object")];const{data:v,...w}=c;Object.defineProperty(w,"__line__",{value:c.__line__,enumerable:!1});let S=Os(Object.assign({},p,{value:w,valueSpec:m.import}));return o.J(w.id)===""&&S.push(new o.V(`${p.key}.id`,w,"import id can't be an empty string")),v&&(S=S.concat(zo(v,m,{key:`${p.key}.data`}))),S},iconset:function(p){const n=p.value,c=p.key,m=p.styleSpec,v=p.style;if(!o.H(n))return[new o.V(c,n,"object expected")];if(!n.type)return[new o.V(c,n,'"type" is required')];const w=o.J(n.type);let S=[];if(S=S.concat(Os({key:c,value:n,valueSpec:m[`iconset_${w}`],style:v,styleSpec:m})),function(C,j){return!(C!=="source"||!j.source)}(w,n)){const C=v.sources&&v.sources[n.source],j=C&&o.J(C.type);C?j!=="raster-array"&&S.push(new o.V(c,n.source,`iconset cannot be used with a source of type ${String(j)}, it only be used with a "raster-array" source type`)):S.push(new o.V(c,n.source,`source "${n.source}" not found`))}return S}};function li(p,n=!1){const c=p.value,m=p.valueSpec,v=p.styleSpec;if(m.expression){if(o.a4(o.J(c)))return nt(p);if(o.Q(o.S(c)))return Ct(p)}if(m.type&&Mi[m.type]){const w=Mi[m.type](p);return n===!0&&w.length>0&&Array.isArray(p.value)?Ct(p):w}return Os(Object.assign({},p,{valueSpec:m.type?v[m.type]:m}))}function Os(p){const n=p.key,c=p.value,m=p.valueSpec||{},v=p.objectElementValidators||{},w=p.style,S=p.styleSpec;if(!o.H(c))return[new o.V(n,c,`object expected, ${o.K(c)} found`)];let C=[];for(const j in c){const M=j.split(".")[0];let D;v[M]?D=v[M]:m[M]?D=li:v["*"]?D=v["*"]:m["*"]&&(D=li),D?C=C.concat(D({key:(n&&`${n}.`)+j,value:c[j],valueSpec:m[M]||m["*"],style:w,styleSpec:S,object:c,objectKey:j},c)):C.push(new o.a3(n,c[j],`unknown property "${j}"`))}for(const j in m){if(v[j])continue;const M=m[j];M.required&&M.default===void 0&&c[j]===void 0&&C.push(new o.V(n,c,`missing required property "${j}"`))}return C}function Il({key:p,value:n}){const c=ws({key:p,value:n});if(c.length)return c;const m=n;return m.indexOf("{fontstack}")===-1&&c.push(new o.V(p,n,'"glyphs" url must include a "{fontstack}" token')),m.indexOf("{range}")===-1&&c.push(new o.V(p,n,'"glyphs" url must include a "{range}" token')),c}function zo(p,n=o.a6,c={}){return Os({key:c.key||"",value:p,valueSpec:Object.assign(n.$root,{"*":{type:"*"}}),styleSpec:n,style:p,objectElementValidators:{glyphs:Il}})}function ra(p,n=o.a6){return qe(zo(p,n))}const Yn=p=>qe(ho(p)),qi=p=>qe(yt(p)),ps=p=>qe(Ar(p)),Ao=p=>qe(Qr(p)),wt=p=>qe(Cn(p)),jo=p=>qe(function(n){const c=n.value,m=n.style,v=n.styleSpec,w=v.snow;if(c===void 0)return[];if(!o.H(c))return[new o.V("snow",c,`object expected, ${o.K(c)} found`)];let S=[];for(const C in c){const j=C.match(/^(.*)-transition$/);S=S.concat(j&&w[j[1]]&&w[j[1]].transition?li({key:C,value:c[C],valueSpec:v.transition,style:m,styleSpec:v}):w[C]?li({key:C,value:c[C],valueSpec:w[C],style:m,styleSpec:v}):[new o.a3(C,c[C],`unknown property "${C}"`)])}return S}(p)),ja=p=>qe(function(n){const c=n.value,m=n.style,v=n.styleSpec,w=v.rain;if(c===void 0)return[];if(!o.H(c))return[new o.V("rain",c,`object expected, ${o.K(c)} found`)];let S=[];for(const C in c){const j=C.match(/^(.*)-transition$/);S=S.concat(j&&w[j[1]]&&w[j[1]].transition?li({key:C,value:c[C],valueSpec:v.transition,style:m,styleSpec:v}):w[C]?li({key:C,value:c[C],valueSpec:w[C],style:m,styleSpec:v}):[new o.a3(C,c[C],`unknown property "${C}"`)])}return S}(p)),Fo=p=>qe($s(p)),gn=p=>qe(br(p)),Bo=p=>qe(pi(p)),ev=p=>qe(Ri(p)),rp=p=>qe(o.a7(p));function qe(p){return p.slice().sort((n,c)=>n.line&&c.line?n.line-c.line:0)}function re(p,n){let c=!1;if(n&&n.length)for(const m of n)m instanceof o.a3?o.w(m.message):(p.fire(new o.y(new Error(m.message))),c=!0);return c}const se=o.a6.light;let ye;class Re extends o.E{constructor(n,c="flat"){super(),this._transitionable=new o.a8(ye||(ye=new o.a9({anchor:new o.aa(se.anchor),position:new o.ab(se.position),color:new o.aa(se.color),intensity:new o.aa(se.intensity)}))),this.setLight(n,c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,c,m={}){this._validate(qi,n,m)||(this._transitionable.setTransitionOrValue(n),this.id=c)}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,c,m){return(!m||m.validate!==!1)&&re(this,n.call(ra,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}}const Pe=o.a6.terrain;let Ve=class extends o.E{constructor(p,n,c,m,v){super(),this.scope=c,this._transitionable=new o.a8(new o.a9({source:new o.aa(Pe.source),exaggeration:new o.aa(Pe.exaggeration)}),c,m),this._transitionable.setTransitionOrValue(p,m),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n,this.worldview=v}get(){return this._transitionable.serialize()}set(p,n){this._transitionable.setTransitionOrValue(p,n)}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}getExaggeration(p){return this._transitioning.possiblyEvaluate(new o.ac(p,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const p=this._transitionable._values.exaggeration;if(!p)return null;const n=p.value.expression;if(!n)return null;let c=-1,m=-1,v=1;for(const w of n.zoomStops)v=n.evaluate(new o.ac(w,{worldview:this.worldview})),v>.01?(c=w,m=-1):m=w;return v<.01&&c>0&&m>c?[c,m]:null}isZoomDependent(){const p=this._transitionable._values.exaggeration;return p!=null&&p.value!=null&&p.value.expression!=null&&p.value.expression instanceof o.ad}};const it=45,Ue=65,tt=.05;function Dt(p,n,c,m){const v=o.ah(it,Ue,c),[w,S]=jt(p,m);let C=1-Math.min(1,Math.exp((n-w)/(S-w)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*v*p.alpha}function jt(p,n){const c=.5/Math.tan(.5*n);return[p.range[0]+c,p.range[1]+c]}function pr(p,n,c,m,v){const w=o.af([],[n,c,m],v.mercatorFogMatrix);return Dt(p,o.ag(w),v.pitch,v._fov)}function Wr(p,n,c,m,v,w,S){const C=[[c,m,0],[v,m,0],[v,w,0],[c,w,0]];let j=Number.MAX_VALUE,M=-Number.MAX_VALUE;for(const D of C){const B=o.af([],D,n),O=o.ag(B);j=Math.min(j,O),M=Math.max(M,O)}return[Dt(p,j,S.pitch,S._fov),Dt(p,M,S.pitch,S._fov)]}const $r=o.a6.fog;class Cr extends o.E{constructor(n,c,m,v){super();const w=new o.a9({range:new o.aa($r.range),color:new o.aa($r.color),"color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new o.aa($r["high-color"]),"high-color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new o.aa($r["space-color"]),"space-color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new o.aa($r["horizon-blend"]),"star-intensity":new o.aa($r["star-intensity"]),"vertical-range":new o.aa($r["vertical-range"])});this._transitionable=new o.a8(w,m,new Map(v)),this.set(n,v),this._transitioning=this._transitionable.untransitioned(),this._transform=c,this.properties=new o.ai(w),this.scope=m}get state(){const n=this._transform,c=n.projection.name==="globe",m=o.aj(n.zoom),v=this.properties.get("range"),w=[.5,3];return{range:c?[o.ak(w[0],v[0],m),o.ak(w[1],v[1],m)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,c,m={}){if(this._validate(wt,n,m))return;const v=Object.assign({},n);for(const w of Object.keys($r))v[w]===void 0&&(v[w]=$r[w].default);this._options=v,this._transitionable.setTransitionOrValue(this._options,c)}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.ah(it,Ue,n))*c.a}getOpacityAtLatLng(n,c){return this._transform.projection.supportsFog?function(m,v,w){const S=o.ae.fromLngLat(v),C=w.elevation?w.elevation.getAtPointOrZero(S):0;return pr(m,S.x,S.y,C,w)}(this.state,n,c):0}getOpacityForTile(n){if(!this._transform.projection.supportsFog)return[1,1];const c=this._transform.calculateFogTileMatrix(n.toUnwrapped());return Wr(this.state,c,0,0,o.al,o.al,this._transform)}getOpacityForBounds(n,c,m,v,w){return this._transform.projection.supportsFog?Wr(this.state,n,c,m,v,w,this._transform):[1,1]}getFovAdjustedRange(n){return this._transform.projection.supportsFog?jt(this.state,n):[0,1]}isVisibleOnFrustum(n){if(!this._transform.projection.supportsFog)return!1;const c=[4,5,6,7];for(const m of c){const v=n.points[m];let w;if(v[2]>=0)w=v;else{const S=n.points[m-4];w=o.am(S,v,S[2]/(S[2]-v[2]))}if(pr(this.state,w[0],w[1],0,this._transform)>=tt)return!0}return!1}updateConfig(n){this._transitionable.setTransitionOrValue(this._options,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,c,m){return(!m||m.validate!==!1)&&re(this,n.call(ra,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}}let fn,yn,hi,ns,ks=class extends o.E{constructor(p,n,c,m){super();const v=fn||(fn=new o.a9({density:new o.aa(o.a6.snow.density),intensity:new o.aa(o.a6.snow.intensity),color:new o.aa(o.a6.snow.color),opacity:new o.aa(o.a6.snow.opacity),vignette:new o.aa(o.a6.snow.vignette),"vignette-color":new o.aa(o.a6.snow["vignette-color"]),"center-thinning":new o.aa(o.a6.snow["center-thinning"]),direction:new o.aa(o.a6.snow.direction),"flake-size":new o.aa(o.a6.snow["flake-size"])}));this._transitionable=new o.a8(v,c,new Map(m)),this.set(p,m),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ai(v),this.scope=c}get state(){const p=this.properties.get("opacity"),n=this.properties.get("color"),c=this.properties.get("direction"),m=o.an(c[0]),v=-Math.max(o.an(c[1]),.01),w=[Math.cos(m)*Math.cos(v),Math.sin(m)*Math.cos(v),Math.sin(v)],S=this.properties.get("vignette"),C=this.properties.get("vignette-color");return C.a=S,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.ao(n.r,n.g,n.b,n.a*p),direction:w,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:C}}get(){return this._transitionable.serialize()}set(p,n,c={}){if(this._validate(jo,p,c))return;const m=Object.assign({},p),v=o.a6.snow;for(const w of Object.keys(v))m[w]===void 0&&(m[w]=v[w].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(p){this._transitionable.setTransitionOrValue(this._options,new Map(p))}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}_validate(p,n,c){return(!c||c.validate!==!1)&&re(this,p.call(ra,Object.assign({value:n,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}},ms=class extends o.E{constructor(p,n,c,m){super();const v=yn||(yn=new o.a9({density:new o.aa(o.a6.rain.density),intensity:new o.aa(o.a6.rain.intensity),color:new o.aa(o.a6.rain.color),opacity:new o.aa(o.a6.rain.opacity),vignette:new o.aa(o.a6.rain.vignette),"vignette-color":new o.aa(o.a6.rain["vignette-color"]),"center-thinning":new o.aa(o.a6.rain["center-thinning"]),direction:new o.aa(o.a6.rain.direction),"droplet-size":new o.aa(o.a6.rain["droplet-size"]),"distortion-strength":new o.aa(o.a6.rain["distortion-strength"])}));this._transitionable=new o.a8(v,c,new Map(m)),this.set(p,m),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ai(v),this.scope=c}get state(){const p=this.properties.get("opacity"),n=this.properties.get("color"),c=this.properties.get("direction"),m=o.an(c[0]),v=-Math.max(o.an(c[1]),.01),w=[Math.cos(m)*Math.cos(v),Math.sin(m)*Math.cos(v),Math.sin(v)],S=this.properties.get("vignette-color");return S.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.ao(n.r,n.g,n.b,n.a*p),direction:w,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:S}}get(){return this._transitionable.serialize()}set(p,n,c={}){if(this._validate(ja,p,c))return;const m=Object.assign({},p),v=o.a6.rain;for(const w of Object.keys(v))m[w]===void 0&&(m[w]=v[w].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(p){this._transitionable.setTransitionOrValue(this._options,new Map(p))}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}_validate(p,n,c){return(!c||c.validate!==!1)&&re(this,p.call(ra,Object.assign({value:n,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}};class us extends o.E{constructor(n,c,m,v){super(),this.scope=m,this._options=n,this.properties=new o.ai(c),this._transitionable=new o.a8(c,m,new Map(v)),this._transitionable.setTransitionOrValue(n.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(n){this._transitionable.setTransitionOrValue(this._options.properties,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(n,c){this._options=n,this._transitionable.setTransitionOrValue(n.properties,c)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class ci{constructor(n,c,m){this.screenBounds=n,this.cameraPoint=m.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=c,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,m)}static createFromScreenPoints(n,c){let m,v;if(n instanceof o.P||typeof n[0]=="number"){const w=o.P.convert(n);m=[w],v=c.isPointAboveHorizon(w)}else{const w=o.P.convert(n[0]),S=o.P.convert(n[1]),C=w.add(S)._div(2);m=[w,S],v=o.aq(w,S).every(j=>c.isPointAboveHorizon(j))&&c.isPointAboveHorizon(C)}return new ci(m,v,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return o.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const c=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],v=o.aq(c,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<m.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?v[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(v[3]=this.cameraPoint)),o.ar(v,n)}bufferedCameraGeometryGlobe(n){const c=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],v=o.aq(c,m,n),w=this.cameraPoint.clone();switch(3*((w.y>c.y)+(w.y>m.y))+((w.x>c.x)+(w.x>m.x))){case 0:v[0]=w,v[4]=w.clone();break;case 1:v.splice(1,0,w);break;case 2:v[1]=w;break;case 3:v.splice(4,0,w);break;case 5:v.splice(2,0,w);break;case 6:v[3]=w;break;case 7:v.splice(3,0,w);break;case 8:v[2]=w}return v}containsTile(n,c,m,v=0){const w=Math.max(n.queryPadding,n.evaluateQueryRenderedFeaturePadding())/c._pixelsPerMercatorPixel+1,S=m?this._bufferedCameraMercator(w,c):this._bufferedScreenMercator(w,c);let C=n.tileID.wrap+(S.unwrapped?v:0);const j=S.polygon.map(oe=>o.as(n.tileTransform,oe,C));if(!o.at(j,0,0,o.al,o.al))return;C=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);const M=this.screenGeometryMercator.polygon.map(oe=>o.au(n.tileTransform,oe,C)),D=M.map(oe=>new o.P(oe[0],oe[1])),B=c.getFreeCameraOptions().position||new o.ae(0,0,0),O=o.au(n.tileTransform,B,C),G=M.map(oe=>{const ie=o.av(oe,oe,O);return o.aw(ie,ie),new o.ax(O,ie)}),X=o.ay(n,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:D,tilespaceRays:G,bufferedTilespaceGeometry:j,bufferedTilespaceBounds:(ee=o.az(j),ee.min.x=o.aA(ee.min.x,0,o.al),ee.min.y=o.aA(ee.min.y,0,o.al),ee.max.x=o.aA(ee.max.x,0,o.al),ee.max.y=o.aA(ee.max.y,0,o.al),ee),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:X};var ee}_bufferedScreenMercator(n,c){const m=Qi(n);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let v;return v=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),c):{polygon:this.bufferedScreenGeometry(n).map(w=>c.pointCoordinate3D(w)),unwrapped:!0},this._screenRaycastCache[m]=v,v}}_bufferedCameraMercator(n,c){const m=Qi(n);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let v;return v=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),c):{polygon:this.bufferedCameraGeometry(n).map(w=>c.pointCoordinate3D(w)),unwrapped:!0},this._cameraRaycastCache[m]=v,v}}_projectAndResample(n,c){const m=function(w,S){const C=o.aB([],S.pixelMatrix,S.globeMatrix),j=[0,-o.aD,0,1],M=[0,o.aD,0,1],D=[0,0,0,1];o.aC(j,j,C),o.aC(M,M,C),o.aC(D,D,C);const B=new o.P(j[0]/j[3],j[1]/j[3]),O=new o.P(M[0]/M[3],M[1]/M[3]),G=o.aE(w,B)&&j[3]<D[3],X=o.aE(w,O)&&M[3]<D[3];if(!G&&!X)return null;const ee=function(je,Se,ve){for(let Ie=1;Ie<je.length;Ie++){const $e=Ni(Se.pointCoordinate3D(je[Ie-1]).x),Fe=Ni(Se.pointCoordinate3D(je[Ie]).x);if(ve<0){if($e<Fe)return{idx:Ie,t:-$e/(Fe-1-$e)}}else if(Fe<$e)return{idx:Ie,t:(1-$e)/(Fe+1-$e)}}return null}(w,S,G?-1:1);if(!ee)return null;const{idx:oe,t:ie}=ee;let ce=oe>1?kn(w.slice(0,oe),S):[],me=oe<w.length?kn(w.slice(oe),S):[];ce=ce.map(je=>new o.P(Ni(je.x),je.y)),me=me.map(je=>new o.P(Ni(je.x),je.y));const de=[...ce];de.length===0&&de.push(me[me.length-1]);const Ee=o.ak(de[de.length-1].y,(me.length===0?ce[0]:me[0]).y,ie);let ge;return ge=G?[new o.P(0,Ee),new o.P(0,0),new o.P(1,0),new o.P(1,Ee)]:[new o.P(1,Ee),new o.P(1,1),new o.P(0,1),new o.P(0,Ee)],de.push(...ge),me.length===0?de.push(ce[0]):de.push(...me),{polygon:de.map(je=>new o.ae(je.x,je.y)),unwrapped:!1}}(n,c);if(m)return m;const v=function(w,S){let C=!1,j=-1/0,M=0;for(let B=0;B<w.length-1;B++)w[B].x>j&&(j=w[B].x,M=B);for(let B=0;B<w.length-1;B++){const O=(M+B)%(w.length-1),G=w[O],X=w[O+1];Math.abs(G.x-X.x)>.5&&(G.x<X.x?(G.x+=1,O===0&&(w[w.length-1].x+=1)):(X.x+=1,O+1===w.length-1&&(w[0].x+=1)),C=!0)}const D=o.aF(S.center.lng);return C&&D<Math.abs(D-1)&&w.forEach(B=>{B.x-=1}),{polygon:w,unwrapped:C}}(kn(n,c).map(w=>new o.P(Ni(w.x),w.y)),c);return{polygon:v.polygon.map(w=>new o.ae(w.x,w.y)),unwrapped:v.unwrapped}}}function kn(p,n){return o.aG(p,c=>{const m=n.pointCoordinate3D(c);c.x=m.x,c.y=m.y},1/256)}function Ni(p){return p<0?1+p%1:p%1}function Qi(p){return 100*p|0}function mi(p,n,c,m,v){const w=function(C,j){if(C)return v(C);if(j){if(p.url&&j.tiles&&p.tiles&&delete p.tiles,j.variants){if(!Array.isArray(j.variants))return v(new Error("variants must be an array"));for(const D of j.variants){if(D==null||typeof D!="object"||D.constructor!==Object)return v(new Error("variant must be an object"));if(!Array.isArray(D.capabilities))return v(new Error("capabilities must be an array"));if(D.capabilities.length===1&&D.capabilities[0]==="meshopt"){j=Object.assign(j,D);break}}}const M=o.aH(Object.assign({},j,p),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);M.tiles=n.canonicalizeTileset(M,p.url),v(null,M)}},S=function(C,j,M){if(!C)return null;if(!j&&!M)return C;M=M||C.worldview_default;const D=Object.values(C.language||{});if(D.length===0)return null;const B=Object.values(C.worldview||{});if(B.length===0)return null;const O=D.every(X=>X===j),G=B.every(X=>X===M);return O&&G?C:j in(C.language_options||{})||M in(C.worldview_options||{})?null:C.language_options&&C.worldview_options?C:null}(p.data,c,m);return S?o.o.frame(()=>w(null,S)):p.url?o.m(n.transformRequest(n.normalizeSourceURL(p.url,null,c,m),o.R.Source),w):o.o.frame(()=>{const{data:C,...j}=p;w(null,j)})}function Di(p,n){const c=Math.pow(2,n.z),m=Math.floor(o.aF(p.getWest())*c),v=Math.floor(o.aJ(p.getNorth())*c),w=Math.ceil(o.aF(p.getEast())*c),S=Math.ceil(o.aJ(p.getSouth())*c);return n.x>=m&&n.x<w&&n.y>=v&&n.y<S}class qs{constructor(n,c,m){this.bounds=n?o.aI.convert(this.validateBounds(n)):null,this.minzoom=c||0,this.maxzoom=m||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}addExtraBounds(n){if(n){this.extraBounds||(this.extraBounds=[]);for(const c of n)this.extraBounds.push(o.aI.convert(this.validateBounds(c)))}}contains(n){if(n.z>this.maxzoom||n.z<this.minzoom||this.bounds&&!Di(this.bounds,n))return!1;if(!this.extraBounds)return!0;for(const c of this.extraBounds)if(Di(c,n))return!0;return!1}static fromTileJSON(n){if(!n.bounds&&!n.extra_bounds)return null;const c=new qs(n.bounds,n.minzoom,n.maxzoom);return c.addExtraBounds(n.extra_bounds),c}}class Vo extends o.E{constructor(n,c,m,v){if(super(),this.id=n,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,o.aH(c,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},c),this._collectResourceTiming=!!c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new o.aK}load(n){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,m=this.map.getWorldview();this._tileJSONRequest=mi(this._options,this.map._requestManager,c,m,(v,w)=>{if(this._tileJSONRequest=null,this._loaded=!0,v)c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),m&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${m}`),this.fire(new o.y(v));else if(w){if(Object.assign(this,w),this.hasWorldviews=!!w.worldview_options,w.worldview_default&&(this.worldviewDefault=w.worldview_default),w.vector_layers){this.vectorLayers=w.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const S of w.vector_layers)this.vectorLayerIds.push(S.id),w.worldview&&w.worldview[S.source]&&this.localizableLayerIds.add(S.id)}this.tileBounds=qs.fromTileJSON(w),fe(w.tiles,this.map._requestManager._customAccessToken),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}n&&n(v)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=o.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(n,c){const m=n.tileID.canonical.url(this.tiles,this.scheme),v=this.map._requestManager.normalizeTileURL(m),w=this.map._requestManager.transformRequest(v,o.R.Tile),S=this.map.style?this.map.style.getLut(this.scope):null,C=S?{image:S.image.clone()}:null,j={request:w,data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,lut:C,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:n.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&o.h(m)&&(j.localizableLayerIds=this.localizableLayerIds),j.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=c:n.request=n.actor.send("reloadTile",j,M.bind(this));else if(n.actor=this._tileWorkers[v]=this._tileWorkers[v]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",j,M.bind(this),void 0,!0);else{const D=o.aL.call({deduped:this._deduped},j,(B,O)=>{if(B||!O)M.call(this,B);else{const G=o.aM(O.responseHeaders);j.data={cacheControl:G.cacheControl,expires:G.expires,rawData:O.rawData.slice(0)},n.actor&&n.actor.send("loadTile",j,M.bind(this),void 0,!0)}},!0);n.request={cancel:D}}function M(D,B){return delete n.request,n.aborted?c(null):D&&D.status!==404?c(D):(B&&B.resourceTiming&&(n.resourceTiming=B.resourceTiming),this.map._refreshExpiredTiles&&B&&n.setExpiryData(B),n.loadVectorData(B,this.map.painter),o.aN(this.dispatcher),c(null,B),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,c){n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope}),n.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class rl extends o.E{constructor(n,c,m,v){super(),this.id=n,this.dispatcher=m,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},c),Object.assign(this,o.aH(c,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const c=this.map.getWorldview();this._tileJSONRequest=mi(this._options,this.map._requestManager,null,c,(m,v)=>{this._tileJSONRequest=null,this._loaded=!0,m?this.fire(new o.y(m)):v&&(Object.assign(this,v),v.raster_layers&&(this.rasterLayers=v.raster_layers,this.rasterLayerIds=this.rasterLayers.map(w=>w.id)),this.tileBounds=qs.fromTileJSON(v),fe(v.tiles),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))),n&&n(m)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=o.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,c){const m=o.o.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);n.request=o.n(this.map._requestManager.transformRequest(v,o.R.Tile),(w,S,C)=>{if(delete n.request,n.aborted)return n.state="unloaded",c(null);if(w)return n.state="errored",c(w);if(!S)return c(null);const j=o.aM(C);this.map._refreshExpiredTiles&&n.setExpiryData(j),n.setTexture(S,this.map.painter),n.state="loaded",o.aN(this.dispatcher),c(null)})}abortTile(n,c){n.request&&(n.request.cancel(),delete n.request),c&&c()}unloadTile(n,c){n.texture&&n.texture instanceof o.T?(n.destroy(!0),n.texture&&n.texture instanceof o.T&&this.map.painter.saveTileTexture(n.texture)):n.destroy(),c&&c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function sd([p,n],c,m,{scaled:v=!0}={}){const{tileSize:w,buffer:S}=m,{x:C,y:j,z:M}=c;if(!isFinite(C)||!isFinite(j)||!isFinite(M))throw new Error("Invalid MRT header");const D=2**M,B=D*o.aF(p),O=D*o.aJ(n);return function([G,X],ee,{scaled:oe=!0}={}){if(!ee)throw new Error("bandView is undefined");const{data:ie,tileSize:ce,buffer:me,offset:de,scale:Ee,dimension:ge}=ee;if(G<-me||G>ce+me||X<-me||X>ce+me)throw new Error(`Point (${G}, ${X}) out of bounds for tileSize=${ce}, buffer=${me}`);const je=(X+me)*(ce+2*me)+(G+me);if(new Uint32Array(ie.buffer)[je]===4294967295)return null;let Se=[];Se=oe?[]:new ee.data.constructor(ge);for(let ve=0;ve<ge;ve++)Se[ve]=Math.round(1e12*(ie[ge*je+ve]*Ee+de))/1e12;return Se}([Math.min(Math.max(-S,Math.floor((B-C)*w)),w-1+S),Math.min(Math.max(-S,Math.floor((O-j)*w)),w-1+S)],m,{scaled:v})}class Js extends rl{constructor(n,c,m,v){super(n,c,m,v),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},c)}triggerRepaint(n){const c=this.map.painter._terrain,m=this.map.style.getSourceCache(this.id);c&&c.enabled&&m&&c._clearRenderCacheForTile(m.id,n.tileID),this.map.triggerRepaint()}loadTile(n,c){const m=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),v=this.map._requestManager.transformRequest(m,o.R.Tile),w={request:v,uid:n.uid,tileID:n.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};n.source=this.id,n.scope=this.scope,n.requestParams=v,n.actor||(n.actor=this.dispatcher.getActor());const S=(C,j,M)=>{if(delete n.request,n.aborted)return n.state="unloaded",c(null);if(C)return C.name==="AbortError"?void 0:(n.state="errored",c(C));if(this.map._refreshExpiredTiles&&j){const D=o.aM(M);n.setExpiryData(D)}if(this.partial&&n.state!=="expired")n.state="empty";else if(!this.partial){if(!j)return c(null);n.state="loaded",n._isHeaderLoaded=!0,n._mrt=j}c(null)};n.request=this.partial?n.fetchHeader(void 0,S.bind(this)):n.actor.send("loadTile",w,S.bind(this),void 0,!0)}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,c){const m=n.texturePerLayer;if(n.flushAllQueues(),m.size){n.destroy(!0);for(const v of m.values())this.map.painter.saveTileTexture(v)}else n.destroy()}prepareTile(n,c,m,v){n._isHeaderLoaded&&(n.state!=="empty"&&(n.state="reloading"),n.fetchBandForRender(c,m,v,(w,S)=>{if(w)return n.state="errored",this.fire(new o.y(w)),void this.triggerRepaint(n);S&&(n._isHeaderLoaded=!0,n.setTexturePerLayer(m,S,this.map.painter),n.state="loaded",this.triggerRepaint(n))}))}getInitialBand(n){if(!this.rasterLayers)return 0;const c=this.rasterLayers.find(({id:w})=>w===n),m=c&&c.fields,v=m&&m.bands&&m.bands;return v?v[0]:0}getTextureDescriptor(n,c,m){if(!n)return;const v=c.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!v)return;let w=null;c instanceof o.aQ?w=c.paint.get("raster-array-band"):c instanceof o.aR&&(w=c.paint.get("raster-particle-array-band"));const S=w||this.getInitialBand(v);if(S==null)return;if(!n.textureDescriptorPerLayer.get(c.id))return void this.prepareTile(n,v,c.id,S);if(n.updateNeeded(c.id,S)&&!m)return;const C=n.textureDescriptorPerLayer.get(c.id);return Object.assign({},C,{texture:n.texturePerLayer.get(c.id)})}getImages(n,c){const m=new Map;for(const v of n)for(const w of c){const[S,C]=w.split("/"),j=v.getLayer(S);if(!j||!j.hasBand(C)||!j.hasDataForBand(C))continue;const{bytes:M,tileSize:D,buffer:B}=j.getBandView(C),O=D+2*B,G={data:new o.q({width:O,height:O},M),pixelRatio:2,sdf:!1,usvg:!1,version:0};m.set(w,G)}return m}queryRasterArrayValueByBandId(n,c,m){const v=c._mrt;return new Promise(w=>{const S={},C=new Set;for(const[j,M]of Object.entries(v.layers)){if(m.layerName&&j!==m.layerName)continue;const D={};S[j]=D;for(const{bands:B}of M.dataIndex)for(const O of B)m.bands&&!m.bands.includes(O)||(C.add(o.B(j,O)),c.fetchBand(j,null,O,G=>{o.o.frame(()=>{D[O]=G?null:sd([n.lng,n.lat],v,M.getBandView(O)),C.delete(o.B(j,O)),C.size===0&&w(S)})},!1))}C.size===0&&w(S)})}_loadTileForQuery(n,c){if(this._loadTileLoaded[n.uid])return void c(null,n._mrt);if(this._loadTilePending[n.uid])return void this._loadTilePending[n.uid].push(c);this._loadTilePending[n.uid]=[c];const m=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),v=this.map._requestManager.transformRequest(m,o.R.Tile);n.actor.send("loadTile",{request:v,uid:n.uid,tileID:n.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(w,S,C)=>{if(w)return this._loadTilePending[n.uid].forEach(j=>j(w,null)),void delete this._loadTilePending[n.uid];if(!S)return this._loadTilePending[n.uid].forEach(j=>j(null,null)),void delete this._loadTilePending[n.uid];if(this.map._refreshExpiredTiles&&S){const j=o.aM(C);n.setExpiryData(j)}n._mrt=S,n._isHeaderLoaded=!0,n.state="loaded",this._loadTilePending[n.uid].forEach(j=>j(null,S)),this._loadTileLoaded[n.uid]=!0,delete this._loadTilePending[n.uid]},void 0,!0)}queryRasterArrayValueByAllBands(n,c,m){return new Promise((v,w)=>{this._loadTileForQuery(c,(S,C)=>{S?w(S):v(C?this.queryRasterArrayValueByBandId(n,c,m):null)})})}queryRasterArrayValue(n,c){const m=o.aS.convert(n),v=this.findLoadedParent(m);return v&&v._mrt?c.bands||!this.partial?this.queryRasterArrayValueByBandId(m,v,c):this.queryRasterArrayValueByAllBands(m,v,c):Promise.resolve(null)}findLoadedParent(n){const c=o.ae.fromLngLat(n,this.map.transform.tileSize),m=this.maxzoom+1,v=1<<m,w=Math.floor(c.x),S=Math.floor((c.x-w)*v),C=Math.floor(c.y*v),j=this.map.style.getSourceCache(this.id),M=new o.aP(m,w,m,S,C);return j.findLoadedParent(M,this.minzoom)}}const nl={vector:Vo,raster:rl,"raster-dem":class extends rl{constructor(p,n,c,m){super(p,n,c,m),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(p,n){const c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(v,w){v&&(p.state="errored",n(v)),w&&(p.dem=w,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",n(null))}p.request=o.n(this.map._requestManager.transformRequest(c,o.R.Tile),(function(v,w,S){if(delete p.request,p.aborted)p.state="unloaded",n(null);else if(v)p.state="errored",n(v);else if(w){const C=o.aM(S);this.map._refreshExpiredTiles&&p.setExpiryData(C);const j=ImageBitmap&&w instanceof ImageBitmap&&o.r(),M=1-(w.width-o.aO(w.width))/2;M<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const D=j?w:o.o.getImageData(w,M),B={uid:p.uid,tileID:p.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:D,encoding:this.encoding,padding:M};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadTile",B,m.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(p){const n=p.canonical,c=Math.pow(2,n.z),m=(n.x-1+c)%c,v=n.x===0?p.wrap-1:p.wrap,w=(n.x+1+c)%c,S=n.x+1===c?p.wrap+1:p.wrap,C={};return C[new o.aP(p.overscaledZ,v,n.z,m,n.y).key]={backfilled:!1},C[new o.aP(p.overscaledZ,S,n.z,w,n.y).key]={backfilled:!1},n.y>0&&(C[new o.aP(p.overscaledZ,v,n.z,m,n.y-1).key]={backfilled:!1},C[new o.aP(p.overscaledZ,p.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},C[new o.aP(p.overscaledZ,S,n.z,w,n.y-1).key]={backfilled:!1}),n.y+1<c&&(C[new o.aP(p.overscaledZ,v,n.z,m,n.y+1).key]={backfilled:!1},C[new o.aP(p.overscaledZ,p.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},C[new o.aP(p.overscaledZ,S,n.z,w,n.y+1).key]={backfilled:!1}),C}},"raster-array":Js,geojson:class extends o.E{constructor(p,n,c,m){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(m),this._data=n.data,this._options=Object.assign({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.minzoom!==void 0&&(this.minzoom=n.minzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const v=o.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*v,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*v,extent:o.al,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:o.al,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*v,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter,dynamic:n.dynamic},n.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}updateData(p){if(!this._options.dynamic)return this.fire(new o.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof p!="string"&&(p.type==="Feature"&&(p={type:"FeatureCollection",features:[p]}),p.type!=="FeatureCollection"))return this.fire(new o.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof p!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const n=new Map;for(const c of this._data.features)n.set(c.id,c);for(const c of p.features)n.set(c.id,c);this._data.features=[...n.values()]}else this._data=p;return this._updateWorkerData(!0),this}getClusterExpansionZoom(p,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id,scope:this.scope},n),this}getClusterChildren(p,n){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id,scope:this.scope},n),this}getClusterLeaves(p,n,c,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:p,limit:n,offset:c},m),this}_updateWorkerData(p=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.z("dataloading",{dataType:"source"})),this._loaded=!1;const n=Object.assign({append:p},this.workerOptions);n.scope=this.scope;const c=this._data;typeof c=="string"?(n.request=this.map._requestManager.transformRequest(o.o.resolveURL(c),o.R.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,n,(m,v)=>{if(this._loaded=!0,this._pendingLoad=null,m)this.fire(new o.y(m));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(w.resourceTiming=v.resourceTiming[this.id]),p&&(this._partialReload=!0),this.fire(new o.z("data",w)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(p),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const p=o.B(this.id,this.scope);this.map.style.clearSource(p),this._updateWorkerData()}loadTile(p,n){const c=p.actor?"reloadTile":"loadTile";p.actor=this.actor;const m=this.map.style?this.map.style.getLut(this.scope):null,v=m?{image:m.image.clone()}:null,w=this._partialReload,S={type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:v,scope:this.scope,pixelRatio:o.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:p.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:w,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};p.request=this.actor.send(c,S,(C,j)=>w&&!j?(p.state="loaded",n(null)):(delete p.request,p.destroy(),p.aborted?n(null):C?n(C):(p.loadVectorData(j,this.map.painter,c==="reloadTile"),n(null))),void 0,c==="loadTile")}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p,n){this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id,scope:this.scope}),p.destroy()}onRemove(p){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.aT{constructor(p,n,c,m){super(p,n,c,m),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const n of p.urls)this.urls.push(this.map._requestManager.transformRequest(n,o.R.Source).url);o.aU(this.urls,(n,c)=>{this._loaded=!0,n?this.fire(new o.y(n)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const n=this.video.seekable;p<n.start(0)||p>n.end(0)?this.fire(new o.y(new o.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const p=this.map.painter.context,n=p.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(p,this.video,n.RGBA8),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.aT,model:o.aW,"batched-model":class extends o.E{constructor(p,n,c,m){super(),this.type="batched-model",this.id=p,this.tileSize=512,this._options=n,this.tiles=this._options.tiles,this.maxzoom=n.maxzoom||19,this.minzoom=n.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=c,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(m)}onAdd(p){this.map=p,this.load()}reload(){this.cancelTileJSONRequest();const p=o.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(p))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(p){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=mi(this._options,this.map._requestManager,n,c,(m,v)=>{this._tileJSONRequest=null,this._loaded=!0,m?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),c&&c.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new o.y(m))):v&&(Object.assign(this,v),v.bounds&&(this.tileBounds=new qs(v.bounds,this.minzoom,this.maxzoom)),fe(v.tiles,this.map._requestManager._customAccessToken),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))),p&&p(m)})}hasTransition(){return!1}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}loaded(){return this._loaded}loadTile(p,n){const c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(c,o.R.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:p.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:o.o.devicePixelRatio,promoteId:this.promoteId};if(p.actor&&p.state!=="expired")if(p.state==="loading")p.reloadCallback=n;else{if(p.buckets){const w=Object.values(p.buckets);for(const S of w)S.dirty=!0;return void(p.state="loaded")}p.request=p.actor.send("reloadTile",m,v.bind(this))}else p.actor=this.dispatcher.getActor(),p.request=p.actor.send("loadTile",m,v.bind(this),void 0,!0);function v(w,S){return p.aborted?n(null):w&&w.status!==404?n(w):(this.map._refreshExpiredTiles&&S&&p.setExpiryData(S),p.loadModelData(S,this.map.painter),p.state="loaded",void n(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends o.aT{constructor(p,n,c,m){super(p,n,c,m),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(w=>typeof w!="number"))||this.fire(new o.y(new o.V(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.y(new o.V(`sources.${p}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new o.y(new o.V(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new o.y(new o.V(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.y(new o.V(`sources.${p}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(p){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?!p&&!this._playing||this.texture instanceof o.aV||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(n,this.canvas,n.gl.RGBA8,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends o.E{constructor(p,n,c,m){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=n,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new qs(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,o.aH(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this.map=p,this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){const{x:n,y:c,z:m}=p.canonical;return this._implementation.hasTile({x:n,y:c,z:m})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,n){const{x:c,y:m,z:v}=p.tileID.canonical,w=new AbortController;p.request=Promise.resolve(this._implementation.loadTile({x:c,y:m,z:v},{signal:w.signal})).then((function(S){return delete p.request,p.aborted?(p.state="unloaded",n(null)):S===void 0?(p.state="errored",n(null)):S===null?(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",n(null)):function(C){return C instanceof ImageData||C instanceof HTMLCanvasElement||C instanceof ImageBitmap||C instanceof HTMLImageElement}(S)?(this.loadTileData(p,S),p.state="loaded",void n(null)):(p.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(S=>{S.name!=="AbortError"&&(p.state="errored",n(S))}),p.request.cancel=()=>w.abort()}loadTileData(p,n){p.setTexture(n,this.map.painter)}unloadTile(p,n){if(p.texture&&p.texture instanceof o.T?(p.destroy(!0),p.texture&&p.texture instanceof o.T&&this.map.painter.saveTileTexture(p.texture)):p.destroy(),this._implementation.unloadTile){const{x:c,y:m,z:v}=p.tileID.canonical;this._implementation.unloadTile({x:c,y:m,z:v})}n&&n()}abortTile(p,n){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),n&&n()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_clearTiles(){const p=o.B(this.id,this.scope);this.map.style.clearSource(p)}_update(){this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}}},Xo=function(p,n,c,m){const v=new nl[n.type](p,n,c,m);if(v.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${v.id}`);return o.aX(["load","abort","unload","serialize","prepare"],v),v};function kl(p,n,c=""){return`${c}:${n.id||""}:${n.layer.id}:${function(m){if("layerId"in m)return`layer:${m.layerId}`;{const{featuresetId:v,importId:w}=m;return`featureset:${v}${w?`:import:${w}`:""}`}}(p.target)}`}function fa(p,n,c,m=""){if(p.uniqueFeatureID){const v=kl(p,n,m);if(c.has(v))return!0;c.add(v)}return!1}function pa(p,n,c,m,v=!1){const w=n.sourceCache.transform,S=n.sourceCache.tilesIn(p,n.has3DLayers,v);S.sort(ip);const C=[];for(const j of S){const M=j.tile.queryRenderedFeatures(n,j,c,m,w,v);Object.keys(M).length&&C.push({wrappedTileID:j.tile.tileID.wrapped().key,queryResults:M})}for(const j in n.layers){const M=n.layers[j];if(M.styleLayer){const D=M.styleLayer.queryRenderedFeatures(p,n.sourceCache,m);Object.keys(D).length&&C.push({wrappedTileID:0,queryResults:D})}}return C.length===0?{}:function(j){const M={},D={};for(const B of j){const O=B.queryResults,G=B.wrappedTileID,X=D[G]=D[G]||{};for(const ee in O){const oe=O[ee],ie=X[ee]=X[ee]||{},ce=M[ee]=M[ee]||[];for(const me of oe)ie[me.featureIndex]||(ie[me.featureIndex]=!0,ce.push(me))}}return M}(C)}function Wm(p,n,c,m,v,w){const S={},C=m.queryRenderedSymbols(p),j=[];for(const M of Object.keys(C).map(Number))j.push(v[M]);j.sort(ip);for(const M of j){const D=M.featureIndex.lookupSymbolFeatures(C[M.bucketInstanceId],M.bucketIndex,M.sourceLayerIndex,n,c,w);for(const B in D){const O=S[B]=S[B]||[],G=D[B];G.sort((X,ee)=>{const oe=M.featureSortOrder;if(oe){const ie=oe.indexOf(X.featureIndex);return oe.indexOf(ee.featureIndex)-ie}return ee.featureIndex-X.featureIndex});for(const X of G)O.push(X)}}return S}function np(p,n){const c=p.getRenderableIds().map(w=>p.getTileByID(w)),m=[],v={};for(let w=0;w<c.length;w++){const S=c[w],C=S.tileID.canonical.key;v[C]||(v[C]=!0,S.querySourceFeatures(m,n))}return m}function ip(p,n){const c=p.tileID,m=n.tileID;return c.overscaledZ-m.overscaledZ||c.canonical.y-m.canonical.y||c.wrap-m.wrap||c.canonical.x-m.canonical.x}function sp(p,n){const c={};if(!n)return c;for(const m of p){const v=m.layerIds.map(w=>n.getLayer(w)).filter(Boolean);if(v.length!==0){m.layers=v,m.stateDependentLayerIds&&(m.stateDependentLayers=m.stateDependentLayerIds.map(w=>v.filter(S=>S.id===w)[0]));for(const w of v)c[w.fqid]=m}}return c}const na=32,Pl=33,Ko=new Uint16Array(8184);for(let p=0;p<2046;p++){let n=p+2,c=0,m=0,v=0,w=0,S=0,C=0;for(1&n?v=w=S=na:c=m=C=na;(n>>=1)>1;){const M=c+v>>1,D=m+w>>1;1&n?(v=c,w=m,c=S,m=C):(c=v,m=w,v=S,w=C),S=M,C=D}const j=4*p;Ko[j+0]=c,Ko[j+1]=m,Ko[j+2]=v,Ko[j+3]=w}const Ia=new Uint16Array(2178),jc=new Uint8Array(1089),od=new Uint16Array(1089);function Zm(p){return p===0?-.03125:p===32?.03125:0}const Xm={type:2,extent:o.al,loadGeometry:()=>[[new o.P(0,0),new o.P(o.al+1,0),new o.P(o.al+1,o.al+1),new o.P(0,o.al+1),new o.P(0,0)]]};class tc{constructor(n,c,m,v,w,S){this.tileID=n,this.uid=o.b1(),this.uses=0,this.tileSize=c,this.tileZoom=m,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=w,v&&v.style&&(this._lastUpdatedBrightness=v.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",v&&v.transform&&(this.projection=v.transform.projection),this.worldview=S,this._hasAppearances=null}registerFadeDuration(n){const c=n+this.timeAdded;c<o.o.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=o.aY(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,c,m){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=sp(n.buckets,c.style),this.hasSymbolBuckets=!1;for(const v in this.buckets){const w=this.buckets[v];if(w instanceof o.b3){if(this.hasSymbolBuckets=!0,!m)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const v in this.buckets){const w=this.buckets[v];if(w instanceof o.b3&&w.hasRTLText){this.hasRTLText=!0,o.b4();break}}this.queryPadding=0;for(const v in this.buckets){const w=this.buckets[v],S=c.style.getOwnLayer(v);if(!S)continue;const C=S.queryRadius(w);this.queryPadding=Math.max(this.queryPadding,C)}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas),this._lastUpdatedBrightness=n.brightness}else this.collisionBoxArray=new o.b2}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(n,c,m){n&&(n.resourceTiming&&(this.resourceTiming=n.resourceTiming),this.buckets=Object.assign({},this.buckets,sp(n.buckets,c.style)),n.featureIndex&&(this.latestFeatureIndex=n.featureIndex))}getBucket(n){return this.buckets[n.fqid]}upload(n,c){for(const w in this.buckets){const S=this.buckets[w];if(S.uploadPending()){let C={},j=[],M={zoom:0,pitch:0,brightness:0,worldview:""};if(c){if(c.style){j=c.style.listImages();const D=S.layers[0],B=D.sourceLayer||"_geojsonTileLayer",O=c.style.getLayerSourceCache(D);O&&(C=O._state.getState(B,void 0))}M={zoom:c.transform.zoom||0,pitch:c.transform.pitch||0,brightness:c.style.getBrightness()||0,worldview:c.worldview||""}}S.upload(n,this.tileID.canonical,C,j,M)}}const m=n.gl,v=this.imageAtlas;v&&!v.uploaded&&(this.imageAtlasTexture=new o.T(n,v.image,m.RGBA8,{useMipmap:!!v.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(n,this.glyphAtlasImage,m.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new o.T(n,this.lineAtlas.image,m.R8),this.lineAtlas.uploaded=!0)}prepare(n,c,m){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture,m),!c||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const v=c.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(c)),(this._lastUpdatedBrightness||v||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&v&&Math.abs(this._lastUpdatedBrightness-v)<.001||(this.updateBuckets(c,this._lastUpdatedBrightness!==v),this._lastUpdatedBrightness=v))}evaluateQueryRenderedFeaturePadding(){let n=0;for(const c in this.buckets){const m=this.buckets[c];m.evaluateQueryRenderedFeaturePadding&&(n=Math.max(n,m.evaluateQueryRenderedFeaturePadding()))}return n}queryRenderedFeatures(n,c,m,v,w,S){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const C=this.evaluateQueryRenderedFeaturePadding(),j=function(M,D){const B=o.bp([],[.5*M.width,.5*-M.height,1]);return o.bq(B,B,[1,-1,0]),o.aB(B,B,M.calculateProjMatrix(D.toUnwrapped())),Float32Array.from(B)}(w,this.tileID);return this.latestFeatureIndex.query(n,{tilespaceGeometry:c,pixelPosMatrix:j,transform:v,availableImages:m,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:C})}querySourceFeatures(n,c){const m=this.latestFeatureIndex;if(!m||!m.rawTileData)return;const v=m.loadVTLayers(),w=c?c.sourceLayer:"",S=v._geojsonTileLayer||v[w];if(!S)return;const C=o.b5(c&&c.filter),{z:j,x:M,y:D}=this.tileID.canonical,B={z:j,x:M,y:D};for(let O=0;O<S.length;O++){const G=S.feature(O);if(C.needGeometry){const oe=o.b6(G,!0);if(!C.filter(new o.ac(this.tileID.overscaledZ,{worldview:this.worldview}),oe,this.tileID.canonical))continue}else if(!C.filter(new o.ac(this.tileID.overscaledZ,{worldview:this.worldview}),G))continue;const X=m.getId(G,w),ee=new o.b7(G,j,M,D,X);ee.tile=B,n.push(ee)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(n){const c=this.expirationTime;if(n.cacheControl){const m=o.b8(n.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const m=Date.now();let v=!1;if(this.expirationTime>m)v=!1;else if(c)if(this.expirationTime<c)v=!0;else{const w=this.expirationTime-c;w?this.expirationTime=m+Math.max(w,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(n){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&n&&this.updateBuckets(n)}hasAppearances(n){for(const c in this.buckets)if(n.style.hasLayer(c)&&this.buckets[c].layers.some(m=>m.appearances&&m.appearances.length>0))return!0;return!1}updateBuckets(n,c){if(!this.latestFeatureIndex||!n.style)return;const m=this.latestFeatureIndex.loadVTLayers(),v=n.style.listImages(),w=n.style.getBrightness();for(const S in this.buckets){if(!n.style.hasLayer(S))continue;const C=this.buckets[S],j=C.layers[0],M=j.sourceLayer||"_geojsonTileLayer",D=m[M],B=n.style.getLayerSourceCache(j);let O={};B&&(O=B._state.getState(M,void 0));const G=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},X=Object.keys(O).length>0&&!c;if(C.hasAppearances=C.layers.some(oe=>oe.appearances&&oe.appearances.length>0),(X&&C.stateDependentLayers.length!==0||c)&&C.update(O,D,v,G,X?C.stateDependentLayers:C.layers,c,w),X&&C.stateDependentLayers.length!==0||c||C.hasAppearances){const oe={zoom:n.transform.zoom,pitch:n.transform.pitch,brightness:n.style.getBrightness()||0,worldview:n.worldview};C.updateAppearances(this.tileID.canonical,O,v,oe)}(C instanceof o.b9||C instanceof o.ba)&&n._terrain&&n._terrain.enabled&&B&&C.uploadPending()&&n._terrain._clearRenderCacheForTile(B.id,this.tileID);const ee=n&&n.style&&n.style.getOwnLayer(S);ee&&(this.queryPadding=Math.max(this.queryPadding,ee.queryRadius(C)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=o.o.now()+n}setTexture(n,c){const m=c.context,v=m.gl;this.texture=this.texture||c.getTileTexture(n.width),this.texture&&this.texture instanceof o.T?this.texture.update(n):(this.texture=new o.T(m,n,v.RGBA8,{useMipmap:!0}),this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE))}setDependencies(n,c){const m={};for(const v of c)m[v]=!0;this.dependencies[n]=m}hasDependency(n,c){for(const m of n){const v=this.dependencies[m];if(v){for(const w of c)if(v[w])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,c){if(!c||c.name==="mercator"||this._tileDebugBuffer)return;const m=o.bb(Xm,this.tileID.canonical,this.tileTransform)[0],v=new o.bc,w=new o.bd;for(let S=0;S<m.length;S++){const{x:C,y:j}=m[S];v.emplaceBack(C,j),w.emplaceBack(S)}w.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(w),this._tileDebugBuffer=n.createVertexBuffer(v,o.be.members),this._tileDebugSegments=o.bf.simpleSegment(0,0,v.length,w.length)}_makeTileBoundsBuffers(n,c){if(this._tileBoundsBuffer||!c||c.name==="mercator")return;const m=o.bb(Xm,this.tileID.canonical,this.tileTransform)[0];let v,w;if(this.isRaster){const S=function(C,j){const M=o.aY(C,j),D=Math.pow(2,C.z);for(let oe=0;oe<Pl;oe++)for(let ie=0;ie<Pl;ie++){const ce=o.aZ((C.x+(ie+Zm(ie))/na)/D),me=o.a_((C.y+(oe+Zm(oe))/na)/D),de=j.project(ce,me),Ee=oe*Pl+ie;Ia[2*Ee+0]=Math.round((de.x*M.scale-M.x)*o.al),Ia[2*Ee+1]=Math.round((de.y*M.scale-M.y)*o.al)}jc.fill(0),od.fill(0);for(let oe=2045;oe>=0;oe--){const ie=4*oe,ce=Ko[ie+0],me=Ko[ie+1],de=Ko[ie+2],Ee=Ko[ie+3],ge=ce+de>>1,je=me+Ee>>1,Se=ge+je-me,ve=je+ce-ge,Ie=me*Pl+ce,$e=Ee*Pl+de,Fe=je*Pl+ge,at=Math.hypot((Ia[2*Ie+0]+Ia[2*$e+0])/2-Ia[2*Fe+0],(Ia[2*Ie+1]+Ia[2*$e+1])/2-Ia[2*Fe+1])>=16;jc[Fe]=jc[Fe]||(at?1:0),oe<1022&&(jc[Fe]=jc[Fe]||jc[(me+ve>>1)*Pl+(ce+Se>>1)]||jc[(Ee+ve>>1)*Pl+(de+Se>>1)])}const B=new o.a$,O=new o.b0;let G=0;function X(oe,ie){const ce=ie*Pl+oe;return od[ce]===0&&(B.emplaceBack(Ia[2*ce+0],Ia[2*ce+1],oe*o.al/na,ie*o.al/na),od[ce]=++G),od[ce]-1}function ee(oe,ie,ce,me,de,Ee){const ge=oe+ce>>1,je=ie+me>>1;if(Math.abs(oe-de)+Math.abs(ie-Ee)>1&&jc[je*Pl+ge])ee(de,Ee,oe,ie,ge,je),ee(ce,me,de,Ee,ge,je);else{const Se=X(oe,ie),ve=X(ce,me),Ie=X(de,Ee);O.emplaceBack(Se,ve,Ie)}}return ee(0,0,na,na,na,0),ee(na,na,0,0,0,na),{vertices:B,indices:O}}(this.tileID.canonical,c);v=S.vertices,w=S.indices}else{v=new o.a$,w=new o.b0;for(const{x:C,y:j}of m)v.emplaceBack(C,j,0,0);const S=o.bg(v.int16.subarray(0,4*v.length),void 0,4);for(let C=0;C<S.length;C+=3)w.emplaceBack(S[C],S[C+1],S[C+2])}this._tileBoundsBuffer=n.createVertexBuffer(v,o.bh.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(w),this._tileBoundsSegments=o.bf.simpleSegment(0,0,v.length,w.length)}_makeGlobeTileDebugBuffers(n,c){const m=c.projection;if(!m||m.name!=="globe"||c.freezeTileCoverage)return;const v=this.tileID.canonical,w=o.bi(v,c),S=o.bj(w),C=o.aj(c.zoom);let j;C>0&&(j=o.bk(new Float64Array(16),c.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,v,c,S,j,C),this._makeGlobeTileDebugTextBuffer(n,v,c,S,j,C)}_globePoint(n,c,m,v,w,S,C){let j=o.bl(n,c,m);if(S){const M=1<<m.z,D=o.aF(v.center.lng),B=o.aJ(v.center.lat),O=(m.x+.5)/M-D;let G=0;O>.5?G=-1:O<-.5&&(G=1);let X=(n/o.al+m.x)/M+G,ee=(c/o.al+m.y)/M;X=(X-D)*v._pixelsPerMercatorPixel+D,ee=(ee-B)*v._pixelsPerMercatorPixel+B;const oe=[X*v.worldSize,ee*v.worldSize,0];o.af(oe,oe,S),j=o.bm(j,oe,C)}return o.af(j,j,w)}_makeGlobeTileDebugBorderBuffer(n,c,m,v,w,S){const C=new o.bc,j=new o.bd,M=new o.bn,D=(O,G,X,ee,oe)=>{const ie=(X-O)/(oe-1),ce=(ee-G)/(oe-1),me=C.length;for(let de=0;de<oe;de++){const Ee=O+de*ie,ge=G+de*ce;C.emplaceBack(Ee,ge);const je=this._globePoint(Ee,ge,c,m,v,w,S);M.emplaceBack(je[0],je[1],je[2]),j.emplaceBack(me+de)}},B=o.al;D(0,0,B,0,16),D(B,0,B,B,16),D(B,B,0,B,16),D(0,B,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(j),this._tileDebugBuffer=n.createVertexBuffer(C,o.be.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(M,o.bo.members),this._tileDebugSegments=o.bf.simpleSegment(0,0,C.length,j.length)}_makeGlobeTileDebugTextBuffer(n,c,m,v,w,S){const C=o.al/4,j=new o.bc,M=new o.b0,D=new o.bn,B=25;M.reserve(32),j.reserve(B),D.reserve(B);const O=(G,X)=>B*G+X;for(let G=0;G<B;G++){const X=G*C;for(let ee=0;ee<B;ee++){const oe=ee*C;j.emplaceBack(oe,X);const ie=this._globePoint(oe,X,c,m,v,w,S);D.emplaceBack(ie[0],ie[1],ie[2])}}for(let G=0;G<4;G++)for(let X=0;X<4;X++){const ee=O(G,X),oe=O(G,X+1),ie=O(G+1,X),ce=O(G+1,X+1);M.emplaceBack(ee,oe,ie),M.emplaceBack(ie,oe,ce)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(M),this._tileDebugTextBuffer=n.createVertexBuffer(j,o.be.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(D,o.bo.members),this._tileDebugTextSegments=o.bf.simpleSegment(0,0,B,32)}destroy(n=!1){for(const c in this.buckets)this.buckets[c].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!n&&this.texture&&this.texture instanceof o.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}o.br.setPbf(o.bs);class vu extends tc{constructor(n,c,m,v,w){super(n,c,m,v,w),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(n){return this._mrt&&this._mrt.getLayer(n)}setTexturePerLayer(n,c,m){const v=m.context,w=v.gl;let S=this.texturePerLayer.get(n)||m.getTileTexture(c.width);S&&S instanceof o.T?S.update(c,{premultiply:!1}):S=new o.T(v,c,w.RGBA8,{premultiply:!1}),this.texturePerLayer.has(n)||this.texturePerLayer.set(n,S)}flushQueues(n){const c=this._workQueuePerLayer.get(n)||[],m=this._fetchQueuePerLayer.get(n)||[];for(;c.length;)c.pop()();for(;m.length;)m.pop()()}flushAllQueues(){for(const n of this._workQueuePerLayer.keys()){const c=this._workQueuePerLayer.get(n)||[];for(;c.length;)c.pop()()}for(const n of this._fetchQueuePerLayer.keys()){const c=this._fetchQueuePerLayer.get(n)||[];for(;c.length;)c.pop()()}}fetchHeader(n=16384,c){const m=this._mrt=new o.br(30),v=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(n-1)}});return this.entireBuffer=null,this.request=o.bt(v,(w,S,C)=>{if(w)c(w);else try{const j=m.getHeaderLength(S);if(j>n)return void(this.request=this.fetchHeader(j,c));m.parseHeader(S),this._isHeaderLoaded=!0;let M=0;for(const D of Object.values(m.layers))M=Math.max(M,D.dataIndex[D.dataIndex.length-1].lastByte);S.byteLength>=M&&(this.entireBuffer=S),c(null,this.entireBuffer||S,C)}catch(j){c(j)}}),this.request}fetchBandForRender(n,c,m,v){this.fetchBand(n,c,m,w=>{if(w)return void v(w);this.updateTextureDescriptor(n,c,m);const S=this.textureDescriptorPerLayer.get(c);v(null,S?S.img:null)})}fetchBand(n,c,m,v,w=!0){const S=this._mrt;if(!this._isHeaderLoaded||!S)return void v(new Error("Tile header is not ready"));const C=this.actor;if(!C)return void v(new Error("Can't fetch tile band without an actor"));let j;const M=o.B(String(m),o.B(this.tileID.key,n));let D=this._taskQueue.get(M);D?D.add(v):(D=new Set,D.add(v),this._taskQueue.set(M,D));const B=(ee,oe)=>{j.complete(ee,oe),ee?v(ee):(D.values().forEach(ie=>ie(null,oe)),this._taskQueue.delete(M))},O=(ee,oe)=>{if(ee)return v(ee);const ie=C.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:oe,task:j},B,void 0,!0);if(c!==null){const ce=this._workQueuePerLayer.get(c)||[];ce.push(()=>{ie&&ie.cancel(),j.cancel()}),this._workQueuePerLayer.has(c)||this._workQueuePerLayer.set(c,ce)}};let G;try{G=S.getLayer(n)}catch(ee){if(this.state==="reloading")return;throw ee}if(!G)return void v(new Error(`Unknown sourceLayer "${n}"`));if(G.hasDataForBand(m))return D.values().forEach(ee=>ee(null,null)),void this._taskQueue.delete(M);const X=G.getDataRange([m]);if(j=S.createDecodingTask(X),!j||j.tasks.length)if(c!==null&&this.flushQueues(c),this.entireBuffer)O(null,this.entireBuffer.slice(X.firstByte,X.lastByte+1));else{const ee=Object.assign({},this.requestParams,{headers:{Range:`bytes=${X.firstByte}-${X.lastByte}`}}),oe=o.bt(ee,O);if(c!==null){const ie=this._fetchQueuePerLayer.get(c)||[];ie.push(()=>{oe.cancel(),j.cancel()}),this._fetchQueuePerLayer.has(c)||this._fetchQueuePerLayer.set(c,ie)}}}updateNeeded(n,c){return(!this.textureDescriptorPerLayer.get(n)||this.textureDescriptorPerLayer.get(n).band!==c||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(n,c,m){if(!this._mrt)return;const v=this._mrt.getLayer(n);if(!v||!v.hasBand(m)||!v.hasDataForBand(m))return;const{bytes:w,tileSize:S,buffer:C,offset:j,scale:M}=v.getBandView(m),D=S+2*C,B=new o.q({width:D,height:D},w),O=this.texturePerLayer.get(c);O&&O instanceof o.T&&O.update(B,{premultiply:!1}),this.textureDescriptorPerLayer.set(c,{layer:n,band:m,img:B,buffer:C,offset:j,tileSize:S,format:v.pixelFormat,mix:[M,256*M,65536*M,16777216*M]})}destroy(n=!1){if(super.destroy(n),delete this._mrt,!n)for(const c of this.texturePerLayer.values())c&&c instanceof o.T&&c.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class tv{constructor(n,c){this.max=n,this.onRemove=c,this.reset()}reset(){for(const n in this.data)for(const c of this.data[n])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(n,c,m){const v=n.wrapped().key;this.data[v]===void 0&&(this.data[v]=[]);const w={value:c,timeout:void 0};if(m!==void 0&&(w.timeout=setTimeout(()=>{this.remove(n,w)},m)),this.data[v].push(w),this.order.push(v),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const c=this.data[n].shift();return c.timeout&&clearTimeout(c.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),c.value}getByKey(n){const c=this.data[n];return c?c[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,c){if(!this.has(n))return this;const m=n.wrapped().key,v=c===void 0?0:this.data[m].indexOf(c),w=this.data[m][v];return this.data[m].splice(v,1),w.timeout&&clearTimeout(w.timeout),this.data[m].length===0&&delete this.data[m],this.onRemove(w.value),this.order.splice(this.order.indexOf(m),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(n){const c=[];for(const m in this.data)for(const v of this.data[m])n(v.value)||c.push(v);for(const m of c)this.remove(m.value.tileID,m)}}class Gb{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,c,m){const v=String(c);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][v]=this.stateChanges[n][v]||{},Object.assign(this.stateChanges[n][v],m),this.deletedStates[n]===null){this.deletedStates[n]={};for(const w in this.state[n])w!==v&&(this.deletedStates[n][w]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][v]===null){this.deletedStates[n][v]={};for(const w in this.state[n][v])m[w]||(this.deletedStates[n][v][w]=null)}else for(const w in m)this.deletedStates[n]&&this.deletedStates[n][v]&&this.deletedStates[n][v][w]===null&&delete this.deletedStates[n][v][w]}removeFeatureState(n,c,m){if(this.deletedStates[n]===null)return;const v=String(c);if(this.deletedStates[n]=this.deletedStates[n]||{},m&&c!==void 0)this.deletedStates[n][v]!==null&&(this.deletedStates[n][v]=this.deletedStates[n][v]||{},this.deletedStates[n][v][m]=null);else if(c!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][v])for(m in this.deletedStates[n][v]={},this.stateChanges[n][v])this.deletedStates[n][v][m]=null;else this.deletedStates[n][v]=null;else this.deletedStates[n]=null}getState(n,c){const m=this.state[n]||{},v=this.stateChanges[n]||{},w=this.deletedStates[n];if(w===null)return{};if(c!==void 0){const C=String(c),j=Object.assign({},m[C],v[C]);if(w){const M=w[c];if(M===null)return{};for(const D in M)delete j[D]}return j}const S=Object.assign({},m,v);if(w)for(const C in w)delete S[C];return S}initializeTileState(n,c){n.refreshFeatureState(c)}coalesceChanges(n,c){const m={};for(const v in this.stateChanges){this.state[v]=this.state[v]||{};const w={};for(const S in this.stateChanges[v])this.state[v][S]||(this.state[v][S]={}),Object.assign(this.state[v][S],this.stateChanges[v][S]),w[S]=this.state[v][S];m[v]=w}for(const v in this.deletedStates){this.state[v]=this.state[v]||{};const w={};if(this.deletedStates[v]===null)for(const S in this.state[v])w[S]={},this.state[v][S]={};else for(const S in this.deletedStates[v]){if(this.deletedStates[v][S]===null)this.state[v][S]={};else if(this.state[v][S])for(const C of Object.keys(this.deletedStates[v][S]))delete this.state[v][S][C];w[S]=this.state[v][S]}m[v]=m[v]||{},Object.assign(m[v],w)}if(this.stateChanges={},this.deletedStates={},Object.keys(m).length!==0)for(const v in n)n[v].refreshFeatureState(c)}}class il extends o.E{constructor(n,c,m){super(),this.id=n,this._onlySymbols=m,c.on("data",v=>{v.dataType==="source"&&v.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&v.dataType==="source"&&v.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),c.on("error",()=>{this._sourceErrored=!0}),this._source=c,this._tiles={},this._cache=new tv(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Gb,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles)if(!this._tiles[n].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,c){return n.isSymbolTile=this._onlySymbols,n.isExtraShadowCaster=this._shadowCasterTiles[n.tileID.key],this._source.loadTile(n,c)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n)}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n)}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const m=this._tiles[c];m.upload(n,this.map?this.map.painter:void 0),m.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(n=>n.tileID).sort(rv).map(n=>n.key)}getRenderableIds(n,c){const m=[];for(const v in this._tiles)this._isIdRenderable(+v,n,c)&&m.push(this._tiles[v]);return n?m.sort((v,w)=>{const S=v.tileID,C=w.tileID,j=new o.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle),M=new o.P(C.canonical.x,C.canonical.y)._rotate(this.transform.angle);return S.overscaledZ-C.overscaledZ||M.y-j.y||M.x-j.x}).map(v=>v.tileID.key):m.map(v=>v.tileID).sort(rv).map(v=>v.key)}hasRenderableParent(n){const c=this.findLoadedParent(n,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(n,c,m){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(c||!this._tiles[n].holdingForFade())&&(m||!this._shadowCasterTiles[n])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,c){const m=this._tiles[n];m&&(m.state!=="loading"&&(m.state=c),this._loadTile(m,this._tileLoaded.bind(this,m,n,c)))}_tileLoaded(n,c,m,v,w){if(v){if(n.state="errored",v.status!==404)this._source.fire(new o.y(v,{tile:n}));else{if(this._source.fire(new o.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:n})),!(n.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const C=this.map.painter.terrain;this.update(this.transform,C.getScaledDemTileSize(),!0),C.resetTileLookupCache(this.id)}else this.update(this.transform)}return}n.timeAdded=o.o.now(),m==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(c,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null);let S=new Map;w&&w.responseHeaders&&(S=w.responseHeaders),this._source.fire(new o.z("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id,responseHeaders:S}))}_backfillDEM(n){const c=this.getRenderableIds();for(let v=0;v<c.length;v++){const w=c[v];if(n.neighboringTiles&&n.neighboringTiles[w]){const S=this.getTileByID(w);m(n,S),m(S,n)}}function m(v,w){if(!v.dem||v.dem.borderReady)return;v.needsHillshadePrepare=!0,v.needsDEMTextureUpload=!0;let S=w.tileID.canonical.x-v.tileID.canonical.x;const C=w.tileID.canonical.y-v.tileID.canonical.y,j=Math.pow(2,v.tileID.canonical.z),M=w.tileID.key;S===0&&C===0||Math.abs(C)>1||(Math.abs(S)>1&&(Math.abs(S+j)===1?S+=j:Math.abs(S-j)===1&&(S-=j)),w.dem&&v.dem&&(v.dem.backfillBorder(w.dem,S,C),v.neighboringTiles&&v.neighboringTiles[M]&&(v.neighboringTiles[M].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,c,m,v){for(const w in this._tiles){let S=this._tiles[w];if(v[w]||!S.hasData()||S.tileID.overscaledZ<=c||S.tileID.overscaledZ>m)continue;let C=S.tileID;for(;S&&S.tileID.overscaledZ>c+1;){const M=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[M.key],S&&S.hasData()&&(C=M)}let j=C;for(;j.overscaledZ>c;)if(j=j.scaledTo(j.overscaledZ-1),n[j.key]){v[C.key]=C;break}}}findLoadedParent(n,c){if(n.key in this._loadedParentTiles){const m=this._loadedParentTiles[n.key];return m&&m.tileID.overscaledZ>=c?m:null}for(let m=n.overscaledZ-1;m>=c;m--){const v=n.scaledTo(m),w=this._getLoadedTile(v);if(w)return w}}_getLoadedTile(n){const c=this._tiles[n.key];return c&&c.hasData()?c:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,c){c=c||this._source.tileSize;const m=Math.ceil(n.width/c)+1,v=Math.ceil(n.height/c)+1,w=Math.floor(m*v*5),S=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,w):w,C=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,S):S;this._cache.setMaxSize(C)}handleWrapJump(n){const c=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,c){const m={};for(const v in this._tiles){const w=this._tiles[v];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+c),m[w.tileID.key]=w}this._tiles=m;for(const v in this._timers)clearTimeout(this._timers[v]),delete this._timers[v];for(const v in this._tiles)this._setTileReloadTimer(+v,this._tiles[v])}}update(n,c,m,v,w){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!m)return;this.updateCacheSize(n,c),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const S=this._source.type==="batched-model";let C,j=this._source.maxzoom;const M=this.map&&this.map.painter?this.map.painter._terrain:null;if(M&&M.sourceCache===this&&M.attenuationRange()){const O=M.attenuationRange()[0],G=Math.floor(O)-Math.log2(M.getDemUpscale());j>G&&(j=G)}if(this.used||this.usedForTerrain){if(this._source.tileID)C=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(O=>new o.aP(O.canonical.z,O.wrap,O.canonical.z,O.canonical.x,O.canonical.y));else if(this.tileCoverLift!==0){const O=n.clone();O.tileCoverLift=this.tileCoverLift,C=O.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:j,roundZoom:this._source.roundZoom&&!m,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:S}),this._source.minzoom<=1&&n.projection.name==="globe"&&(C.push(new o.aP(1,0,1,0,0)),C.push(new o.aP(1,0,1,1,0)),C.push(new o.aP(1,0,1,0,1)),C.push(new o.aP(1,0,1,1,1)))}else if(C=n.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:j,roundZoom:this._source.roundZoom&&!m,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:S}),this._source.hasTile){const O=this._source.hasTile.bind(this._source);C=C.filter(G=>O(G))}}else C=[];if(C.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!ad(this._source.type)){const O=n.coveringZoomLevel({tileSize:c||this._source.tileSize,roundZoom:this._source.roundZoom&&!m}),G=Math.min(O,this._source.maxzoom);if(S){const X=n.extendTileCover(C,G);for(const ee of X)C.push(ee)}else if(w){const X=n.extendTileCoverToNearPlane(C,this.transform.getFrustum(G),G);for(const ee of X)C.push(ee)}else if(this.castsShadows&&v){const X=n.extendTileCover(C,G,v);for(const ee of X)this._shadowCasterTiles[ee.key]=!0,C.push(ee)}}const D=this._updateRetainedTiles(C);if(ad(this._source.type)&&C.length!==0){const O={},G={},X=Object.keys(D);for(const oe of X){const ie=D[oe],ce=this._tiles[oe];if(!ce||ce.fadeEndTime&&ce.fadeEndTime<=o.o.now())continue;const me=this.findLoadedParent(ie,Math.max(ie.overscaledZ-il.maxOverzooming,this._source.minzoom));me&&(this._addTile(me.tileID),O[me.tileID.key]=me.tileID),G[oe]=ie}const ee=C[C.length-1].overscaledZ;for(const oe in this._tiles){const ie=this._tiles[oe];if(D[oe]||!ie.hasData())continue;let ce=ie.tileID;for(;ce.overscaledZ>ee;){ce=ce.scaledTo(ce.overscaledZ-1);const me=this._tiles[ce.key];if(me&&me.hasData()&&G[ce.key]){D[oe]=ie.tileID;break}}}for(const oe in O)D[oe]||(this._coveredTiles[oe]=!0,D[oe]=O[oe])}for(const O in D)this._tiles[O].clearFadeHold();const B=o.bu(this._tiles,D);for(const O of B){const G=this._tiles[O];G.hasSymbolBuckets&&!G.holdingForFade()?G.setHoldDuration(this.map._fadeDuration):G.hasSymbolBuckets&&!G.symbolFadeFinished()||this._removeTile(+O)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const c={};if(n.length===0)return c;const m={},v=n.reduce((M,D)=>Math.min(M,D.overscaledZ),1/0),w=n[0].overscaledZ,S=Math.max(w-il.maxOverzooming,this._source.minzoom),C=Math.max(w+il.maxUnderzooming,this._source.minzoom),j={};for(const M of n){const D=this._addTile(M);c[M.key]=M,D.hasData()||v<this._source.maxzoom&&(j[M.key]=M)}this._retainLoadedChildren(j,v,C,c);for(const M of n){let D=this._tiles[M.key];if(D.hasData())continue;if(M.canonical.z>=this._source.maxzoom){const O=M.children(this._source.maxzoom)[0],G=this.getTile(O);if(G&&G.hasData()){c[O.key]=O;continue}}else{const O=M.children(this._source.maxzoom);if(c[O[0].key]&&c[O[1].key]&&c[O[2].key]&&c[O[3].key])continue}let B=D.wasRequested();for(let O=M.overscaledZ-1;O>=S;--O){const G=M.scaledTo(O);if(m[G.key]||(m[G.key]=!0,D=this.getTile(G),!D&&B&&(D=this._addTile(G)),D&&(c[G.key]=G,B=D.wasRequested(),D.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const c=[];let m,v=this._tiles[n].tileID;for(;v.overscaledZ>0;){if(v.key in this._loadedParentTiles){m=this._loadedParentTiles[v.key];break}c.push(v.key);const w=v.scaledTo(v.overscaledZ-1);if(m=this._getLoadedTile(w),m)break;v=w}for(const w of c)this._loadedParentTiles[w]=m}}_addTile(n){let c=this._tiles[n.key];if(c)return c.isExtraShadowCaster!==!0||this._shadowCasterTiles[n.key]||this._reloadTile(n.key,"reloading"),c;c=this._cache.getAndRemove(n),c&&(this._setTileReloadTimer(n.key,c),c.tileID=n,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,c)));const m=!!c;if(!m){const v=this.map?this.map.painter:null,w=this._source.tileSize*n.overscaleFactor();c=this._source.type==="raster-array"?new vu(n,w,this.transform.tileZoom,v,this._isRaster):new tc(n,w,this.transform.tileZoom,v,this._isRaster,this._source.worldview),this._loadTile(c,this._tileLoaded.bind(this,c,n.key,c.state))}return c.uses++,this._tiles[n.key]=c,m||this._source.fire(new o.z("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c}_setTileReloadTimer(n,c){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const m=c.getExpiryTimeout();m&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},m))}_removeTile(n){const c=this._tiles[n];c&&(c.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),c.uses>0||(c.hasData()&&c.state!=="reloading"||c.state==="empty"?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,c,m){const v=[],w=this.transform;if(!w)return v;const S=w.projection.name==="globe",C=o.aF(w.center.lng);for(const j in this._tiles){const M=this._tiles[j];if(m&&M.clearQueryDebugViz(),M.holdingForFade())continue;let D;if(S){const B=M.tileID.canonical;if(B.z===0){const O=[Math.abs(o.aA(C,...ld(B,-1))-C),Math.abs(o.aA(C,...ld(B,1))-C)];D=[0,2*O.indexOf(Math.min(...O))-1]}else{const O=[Math.abs(o.aA(C,...ld(B,-1))-C),Math.abs(o.aA(C,...ld(B,0))-C),Math.abs(o.aA(C,...ld(B,1))-C)];D=[O.indexOf(Math.min(...O))-1]}}else D=[0];for(const B of D){const O=n.containsTile(M,w,c,B);O&&v.push(O)}}return v}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(n){return this._getRenderableCoordinates(n)}_getRenderableCoordinates(n,c){const m=this.getRenderableIds(n,c).map(w=>this._tiles[w].tileID),v=this.transform.projection.name==="globe";for(const w of m)w.projMatrix=this.transform.calculateProjMatrix(w.toUnwrapped()),w.expandedProjMatrix=v?this.transform.calculateProjMatrix(w.toUnwrapped(),!1,!0):w.projMatrix;return m}sortCoordinatesByDistance(n){const c=n.slice(),m=this.transform._camera.position,v=this.transform._camera.forward(),w={};for(const S of c){const C=1/(1<<S.canonical.z);w[S.key]=((S.canonical.x+.5)*C+S.wrap-m[0])*v[0]+((S.canonical.y+.5)*C-m[1])*v[1]-m[2]*v[2]}return c.sort((S,C)=>w[S.key]-w[C.key]),c}hasTransition(){if(this._source.hasTransition())return!0;if(ad(this._source.type))for(const n in this._tiles){const c=this._tiles[n];if(c.fadeEndTime!==void 0&&c.fadeEndTime>=o.o.now())return!0}return!1}setFeatureState(n,c,m){this._state.updateState(n=n||"_geojsonTileLayer",c,m)}removeFeatureState(n,c,m){this._state.removeFeatureState(n=n||"_geojsonTileLayer",c,m)}getFeatureState(n,c){return this._state.getState(n=n||"_geojsonTileLayer",c)}setDependencies(n,c,m){const v=this._tiles[n];v&&v.setDependencies(c,m)}reloadTilesForDependencies(n,c){for(const m in this._tiles)this._tiles[m].hasDependency(n,c)&&this._reloadTile(+m,"reloading");this._cache.filter(m=>!m.hasDependency(n,c))}_preloadTiles(n,c){if(!this._sourceLoaded){const j=()=>{this._sourceLoaded&&(this._source.off("data",j),this._preloadTiles(n,c))};return void this._source.on("data",j)}const m=new Map,v=Array.isArray(n)?n:[n],w=this.map.painter.terrain,S=this.usedForTerrain&&w?w.getScaledDemTileSize():this._source.tileSize;for(const j of v){const M=j.coveringTiles({tileSize:S,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const D of M)m.set(D.key,D);this.usedForTerrain&&j.updateElevation(!1)}const C=Array.from(m.values());o.bv(C,(j,M)=>{const D=new tc(j,this._source.tileSize*j.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(D,B=>{this._source.type==="raster-dem"&&D.dem&&this._backfillDEM(D),M(B,D)})},c)}}function rv(p,n){const c=Math.abs(2*p.wrap)-+(p.wrap<0),m=Math.abs(2*n.wrap)-+(n.wrap<0);return p.overscaledZ-n.overscaledZ||m-c||n.canonical.y-p.canonical.y||n.canonical.x-p.canonical.x}function ad(p){return p==="raster"||p==="image"||p==="video"||p==="custom"}function ld(p,n){const c=1<<p.z;return[p.x/c+n,(p.x+1)/c+n]}il.maxOverzooming=10,il.maxUnderzooming=3;class nv{constructor(n){this.style=n,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const n=!1,c=!1;for(const m in this.style._mergedLayers){const v=this.style._mergedLayers[m];if(v.type==="fill-extrusion"||v.type==="building")this.layers.push({layer:v,visible:n,visibilityChanged:c});else if(v.type==="model"){const w=this.style.getLayerSource(v);w&&w.type==="batched-model"&&this.layers.push({layer:v,visible:n,visibilityChanged:c})}}}onNewFrame(n){this.layersGotHidden=!1;for(const c of this.layers){const m=c.layer;let v=!1;m.type==="fill-extrusion"?v=!m.isHidden(n)&&m.paint.get("fill-extrusion-opacity")>0:m.type==="building"?v=!m.isHidden(n)&&m.paint.get("building-opacity")>0:m.type==="model"&&(v=!m.isHidden(n)&&m.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!v&&c.visible,c.visible=v}}updateZOffset(n,c){this.currentBuildingBuckets=[];for(const v of this.layers){const w=v.layer,S=this.style.getLayerSourceCache(w);let C=1;w.type==="fill-extrusion"?C=v.visible?w.paint.get("fill-extrusion-vertical-scale"):0:w.type==="building"&&(C=v.visible?w.paint.get("building-vertical-scale"):0);let j=S?S.getTile(c):null;if(!j&&S)for(const M in S._tiles){const D=S._tiles[M];if(c.canonical.isChildOf(D.tileID.canonical)){j=D;break}}this.currentBuildingBuckets.push({bucket:j?j.getBucket(w):null,tileID:j?j.tileID:c,verticalScale:C})}n.hasAnyZOffset=!1;let m=!1;for(let v=0;v<n.symbolInstances.length;v++){const w=n.symbolInstances.get(v),S=w.zOffset,C=this._getHeightAtTileOffset(c,w.tileAnchorX,w.tileAnchorY);w.zOffset=C!==Number.NEGATIVE_INFINITY?C:S,m||S===w.zOffset||(m=!0),n.hasAnyZOffset||w.zOffset===0||(n.hasAnyZOffset=!0)}m&&(n.zOffsetBuffersNeedUpload=!0,n.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(n,c,m,v){let w=c,S=m;if(n.canonical.z!==v.canonical.z){const C=v.canonical,j=1/(1<<n.canonical.z-C.z);w=(c+n.canonical.x*o.al)*j-C.x*o.al|0,S=(m+n.canonical.y*o.al)*j-C.y*o.al|0}return{tileX:w,tileY:S}}_getHeightAtTileOffset(n,c,m){let v,w;for(let S=0;S<this.layers.length;++S){const C=this.layers[S].layer;if(C.type!=="fill-extrusion"&&C.type!=="building")continue;const{bucket:j,tileID:M,verticalScale:D}=this.currentBuildingBuckets[S];if(!j)continue;const{tileX:B,tileY:O}=this._mapCoordToOverlappingTile(n,c,m,M),G=j.getHeightAtTileCoord(B,O);G&&G.height!==void 0&&(G.hidden?v=G.height:w=Math.max(G.height*D,w||0))}if(w!==void 0)return w;for(let S=0;S<this.layers.length;++S){const C=this.layers[S];if(C.layer.type!=="model"||!C.visible)continue;const{bucket:j,tileID:M}=this.currentBuildingBuckets[S];if(!j)continue;const{tileX:D,tileY:B}=this._mapCoordToOverlappingTile(n,c,m,M),O=j.getHeightAtTileCoord(D,B);if(O&&!O.hidden)return O.height===void 0&&v!==void 0?Math.min(O.maxHeight,v)*O.verticalScale:O.height?O.height*O.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function op(p,n){const c={};for(const m in p)m!=="ref"&&(c[m]=p[m]);return o.bw.forEach(m=>{m in n&&(c[m]=n[m])}),c}function ih(p){p=p.slice();const n=Object.create(null);for(let c=0;c<p.length;c++)n[p[c].id]=p[c];for(let c=0;c<p.length;c++)"ref"in p[c]&&(p[c]=op(p[c],n[p[c].ref]));return p}const Jn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function iv(p,n,c){c.push({command:Jn.addSource,args:[p,n[p]]})}function ap(p,n,c){n.push({command:Jn.removeSource,args:[p]}),c[p]=!0}function lp(p,n,c,m){ap(p,c,m),iv(p,n,c)}function sv(p,n,c){let m;for(m in p[c])if(p[c].hasOwnProperty(m)&&m!=="data"&&!o.bx(p[c][m],n[c][m]))return!1;for(m in n[c])if(n[c].hasOwnProperty(m)&&m!=="data"&&!o.bx(p[c][m],n[c][m]))return!1;return!0}function cp(p,n,c,m,v,w){let S;for(S in n=n||{},p=p||{})p.hasOwnProperty(S)&&(o.bx(p[S],n[S])||c.push({command:w,args:[m,S,n[S],v]}));for(S in n)n.hasOwnProperty(S)&&!p.hasOwnProperty(S)&&(o.bx(p[S],n[S])||c.push({command:w,args:[m,S,n[S],v]}))}function up(p){return p.id}function dp(p,n){return p[n.id]=n,p}function cd(p,n,c){const m=n.createTileMatrix(p,p.worldSize,c.toUnwrapped());return o.aB(new Float32Array(16),p.projMatrix,m)}function Hb(p,n,c){if(n.projection.name===c.projection.name)return p.projMatrix;const m=c.clone();return m.setProjection(n.projection),cd(m,n.getProjection(),p)}function Km(p,n,c){return n.name===c.projection.name?p.projMatrix:cd(c,n,p)}class V2{constructor(n,c){this.reset(n,c)}reset(n,c){this.points=n||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=o.aA(n,0,1);let c=1,m=this._distances[c];const v=n*this.paddedLength+this.padding;for(;m<v&&c<this._distances.length;)m=this._distances[++c];const w=c-1,S=this._distances[w],C=m-S,j=C>0?(v-S)/C:0;return this.points[w].mult(1-j).add(this.points[c].mult(j))}}class hp{constructor(n,c,m){const v=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(n/m),this.yCellCount=Math.ceil(c/m);for(let S=0;S<this.xCellCount*this.yCellCount;S++)v.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=c,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,c,m,v,w){this._forEachCell(c,m,v,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(v),this.bboxes.push(w)}insertCircle(n,c,m,v){this._forEachCell(c-v,m-v,c+v,m+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(c),this.circles.push(m),this.circles.push(v)}_insertBoxCell(n,c,m,v,w,S){this.boxCells[w].push(S)}_insertCircleCell(n,c,m,v,w,S){this.circleCells[w].push(S)}_query(n,c,m,v,w,S){if(m<0||n>this.width||v<0||c>this.height)return!w&&[];const C=[];if(n<=0&&c<=0&&this.width<=m&&this.height<=v){if(w)return!0;for(let j=0;j<this.boxKeys.length;j++)C.push({key:this.boxKeys[j],x1:this.bboxes[4*j],y1:this.bboxes[4*j+1],x2:this.bboxes[4*j+2],y2:this.bboxes[4*j+3]});for(let j=0;j<this.circleKeys.length;j++){const M=this.circles[3*j],D=this.circles[3*j+1],B=this.circles[3*j+2];C.push({key:this.circleKeys[j],x1:M-B,y1:D-B,x2:M+B,y2:D+B})}return S?C.filter(S):C}return this._forEachCell(n,c,m,v,this._queryCell,C,{hitTest:w,seenUids:{box:{},circle:{}}},S),w?C.length>0:C}_queryCircle(n,c,m,v,w){const S=n-m,C=n+m,j=c-m,M=c+m;if(C<0||S>this.width||M<0||j>this.height)return!v&&[];const D=[];return this._forEachCell(S,j,C,M,this._queryCellCircle,D,{hitTest:v,circle:{x:n,y:c,radius:m},seenUids:{box:{},circle:{}}},w),v?D.length>0:D}query(n,c,m,v,w){return this._query(n,c,m,v,!1,w)}hitTest(n,c,m,v,w){return this._query(n,c,m,v,!0,w)}hitTestCircle(n,c,m,v){return this._queryCircle(n,c,m,!0,v)}_queryCell(n,c,m,v,w,S,C,j){const M=C.seenUids,D=this.boxCells[w];if(D!==null){const O=this.bboxes;for(const G of D)if(!M.box[G]){M.box[G]=!0;const X=4*G;if(n<=O[X+2]&&c<=O[X+3]&&m>=O[X+0]&&v>=O[X+1]&&(!j||j(this.boxKeys[G]))){if(C.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[G],x1:O[X],y1:O[X+1],x2:O[X+2],y2:O[X+3]})}}}const B=this.circleCells[w];if(B!==null){const O=this.circles;for(const G of B)if(!M.circle[G]){M.circle[G]=!0;const X=3*G;if(this._circleAndRectCollide(O[X],O[X+1],O[X+2],n,c,m,v)&&(!j||j(this.circleKeys[G]))){if(C.hitTest)return S.push(!0),!0;{const ee=O[X],oe=O[X+1],ie=O[X+2];S.push({key:this.circleKeys[G],x1:ee-ie,y1:oe-ie,x2:ee+ie,y2:oe+ie})}}}}}_queryCellCircle(n,c,m,v,w,S,C,j){const M=C.circle,D=C.seenUids,B=this.boxCells[w];if(B!==null){const G=this.bboxes;for(const X of B)if(!D.box[X]){D.box[X]=!0;const ee=4*X;if(this._circleAndRectCollide(M.x,M.y,M.radius,G[ee+0],G[ee+1],G[ee+2],G[ee+3])&&(!j||j(this.boxKeys[X])))return S.push(!0),!0}}const O=this.circleCells[w];if(O!==null){const G=this.circles;for(const X of O)if(!D.circle[X]){D.circle[X]=!0;const ee=3*X;if(this._circlesCollide(G[ee],G[ee+1],G[ee+2],M.x,M.y,M.radius)&&(!j||j(this.circleKeys[X])))return S.push(!0),!0}}}_forEachCell(n,c,m,v,w,S,C,j){const M=this._convertToXCellCoord(n),D=this._convertToYCellCoord(c),B=this._convertToXCellCoord(m),O=this._convertToYCellCoord(v);for(let G=M;G<=B;G++)for(let X=D;X<=O;X++)if(w.call(this,n,c,m,v,this.xCellCount*X+G,S,C,j))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,c,m,v,w,S){const C=v-n,j=w-c,M=m+S;return M*M>C*C+j*j}_circleAndRectCollide(n,c,m,v,w,S,C){const j=(S-v)/2,M=Math.abs(n-(v+j));if(M>j+m)return!1;const D=(C-w)/2,B=Math.abs(c-(w+D));if(B>D+m)return!1;if(M<=j||B<=D)return!0;const O=M-j,G=B-D;return O*O+G*G<=m*m}}const ka={unknown:0,flipRequired:1,flipNotRequired:2},fp=Math.tan(85*Math.PI/180);function sh(p,n,c,m,v,w,S){const C=o.bB();if(c)if(w.name==="globe"){const j=o.bC(v,n);o.aB(C,C,j)}else{const j=o.bD([],S);C[0]=j[0],C[1]=j[1],C[4]=j[2],C[5]=j[3],m||o.bA(C,C,v.angle)}else o.aB(C,v.labelPlaneMatrix,p);return C}function pp(p,n,c,m,v,w,S){const C=sh(p,n,c,m,v,w,S);return w.name==="globe"&&c||(C[2]=C[6]=C[10]=C[14]=0),C}function Ic(p,n,c,m,v,w,S){if(c){if(w.name==="globe"){const C=sh(p,n,c,m,v,w,S);return o.bk(C,C),o.aB(C,p,C),C}{const C=o.by(p),j=o.bz([]);return j[0]=S[0],j[1]=S[1],j[4]=S[2],j[5]=S[3],o.aB(C,C,j),m||o.bA(C,C,-v.angle),C}}return v.glCoordMatrix}function Gs(p,n,c,m){const v=[p,n,c,1];c?o.aC(v,v,m):sl(v,v,m);const w=v[3];return v[0]/=w,v[1]/=w,v[2]/=w,v}function ov(p,n){return Math.min(.5+p/n*.5,1.5)}function av(p,n){const c=p[0]/p[3],m=p[1]/p[3];return c>=-n[0]&&c<=n[0]&&m>=-n[1]&&m<=n[1]}function lv(p,n,c,m,v,w,S,C,j,M,D=1){const B=c.transform,O=m?p.textSizeData:p.iconSizeData,G=o.bJ(O,c.transform.zoom,D),X=B.projection.name==="globe",ee=[256/c.width*2+1,256/c.height*2+1],oe=m?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;oe.clear();let ie=null;X&&(ie=m?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);const ce=p.lineVertexArray,me=m?p.text.placedSymbolArray:p.icon.placedSymbolArray,de=c.transform.width/c.transform.height;let Ee,ge=!1;for(let je=0;je<me.length;je++){const Se=me.get(je),{numGlyphs:ve,writingMode:Ie}=Se;if(Ie!==o.bK.vertical||ge||Ee===o.bK.horizontal||(ge=!0),Ee=Ie,(Se.hidden||Ie===o.bK.vertical)&&!ge){kc(ve,oe);continue}ge=!1;const $e=new o.P(Se.tileAnchorX,Se.tileAnchorY),Fe=p.elevationType==="road",at=!!B.elevation||Fe;let{x:Qe,y:pt,z:Ot}=B.projection.projectTilePoint($e.x,$e.y,M.canonical),Ye=null;if(at){const ir=Fe?p.getElevationFeatureForText(je):null;Ye={getElevation:j,elevation:B.elevation,elevationFeature:ir};const[kr,xn,Mn]=j($e,B.elevation,ir);Qe+=kr,pt+=xn,Ot+=Mn}const Oe=[Qe,pt,Ot,1];if(o.aC(Oe,Oe,n),!av(Oe,ee)){kc(ve,oe);continue}const mt=Oe[3],et=ov(c.transform.getCameraToCenterDistance(B.projection),mt),Et=o.bL(O,G,Se),$t=S?Et/et:Et*et,lr=Gs(Qe,pt,Ot,v);if(lr[3]<=0){kc(ve,oe);continue}let Mt={};const zt=o.an(p.layers[0].layout.get("text-max-angle")),ur=Math.cos(zt),nr=S?null:Ye,er=Wb(Se,$t,!1,C,n,v,w,p.glyphOffsetArray,ce,oe,ie,lr,$e,Mt,de,nr,B.projection,M,S,ur);ge=er.useVertical,nr&&er.needsFlipping&&(Mt={}),(er.notEnoughRoom||ge||er.needsFlipping&&Wb(Se,$t,!0,C,n,v,w,p.glyphOffsetArray,ce,oe,ie,lr,$e,Mt,de,nr,B.projection,M,S,ur).notEnoughRoom)&&kc(ve,oe)}m?(p.text.dynamicLayoutVertexBuffer.updateData(oe),ie&&p.text.globeExtVertexBuffer&&p.text.globeExtVertexBuffer.updateData(ie)):(p.icon.dynamicLayoutVertexBuffer.updateData(oe),ie&&p.icon.globeExtVertexBuffer&&p.icon.globeExtVertexBuffer.updateData(ie))}function ri(p,n,c,m,v,w,S,C,j,M,D,B,O,G,X,ee,oe){const{lineStartIndex:ie,glyphStartIndex:ce,segment:me}=C,de=ce+C.numGlyphs,Ee=ie+C.lineLength,ge=n.getoffsetX(ce),je=n.getoffsetX(de-1),Se=mp(p*ge,c,m,v,w,S,me,ie,Ee,j,M,D,B,O,!0,G,X,ee,oe);if(!Se)return null;const ve=mp(p*je,c,m,v,w,S,me,ie,Ee,j,M,D,B,O,!0,G,X,ee,oe);return ve?{first:Se,last:ve}:null}function cv(p,n,c,m){return p===o.bK.horizontal&&Math.abs(m)>Math.abs(c)?{useVertical:!0}:p===o.bK.vertical?m>0?{needsFlipping:!0}:null:n!==ka.unknown&&function(v,w){return v===0||Math.abs(w/v)>fp}(c,m)?n===ka.flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function Wb(p,n,c,m,v,w,S,C,j,M,D,B,O,G,X,ee,oe,ie,ce,me){const de=n/24,Ee=p.lineOffsetX*de,ge=p.lineOffsetY*de,{lineStartIndex:je,glyphStartIndex:Se,numGlyphs:ve,segment:Ie,writingMode:$e,flipState:Fe}=p,at=je+p.lineLength,Qe=pt=>{if(D){const[mt,et,Et]=pt.up,$t=M.length;o.bM(D,$t+0,mt,et,Et),o.bM(D,$t+1,mt,et,Et),o.bM(D,$t+2,mt,et,Et),o.bM(D,$t+3,mt,et,Et)}const[Ot,Ye,Oe]=pt.point;o.bN(M,Ot,Ye,Oe,pt.angle)};if(ve>1){const pt=ri(de,C,Ee,ge,c,B,O,p,j,w,G,ee,!1,oe,ie,ce,me);if(!pt)return{notEnoughRoom:!0};if(m&&!c){let[Ot,Ye,Oe]=pt.first.point,[mt,et,Et]=pt.last.point;[Ot,Ye]=Gs(Ot,Ye,Oe,S),[mt,et]=Gs(mt,et,Et,S);const $t=cv($e,Fe,(mt-Ot)*X,et-Ye);if(p.flipState=$t&&$t.needsFlipping?ka.flipRequired:ka.flipNotRequired,$t)return $t}Qe(pt.first);for(let Ot=Se+1;Ot<Se+ve-1;Ot++){const Ye=mp(de*C.getoffsetX(Ot),Ee,ge,c,B,O,Ie,je,at,j,w,G,ee,!1,!1,oe,ie,ce,me);if(!Ye)return M.length-=4*(Ot-Se),{notEnoughRoom:!0};Qe(Ye)}Qe(pt.last)}else{if(m&&!c){const Ot=Gs(O.x,O.y,0,v),Ye=je+Ie+1,Oe=new o.P(j.getx(Ye),j.gety(Ye)),mt=Gs(Oe.x,Oe.y,0,v),et=mt[3]>0?mt:Br(O,Oe,Ot,1,v,void 0,oe,ie.canonical),Et=cv($e,Fe,(et[0]-Ot[0])*X,et[1]-Ot[1]);if(p.flipState=Et&&Et.needsFlipping?ka.flipRequired:ka.flipNotRequired,Et)return Et}const pt=mp(de*C.getoffsetX(Se),Ee,ge,c,B,O,Ie,je,at,j,w,G,ee,!1,!1,oe,ie,ce,me);if(!pt)return{notEnoughRoom:!0};Qe(pt)}return{}}function Zb(p,n,c,m,v){const{x:w,y:S,z:C}=m.projectTilePoint(p.x,p.y,n);if(!v)return Gs(w,S,C,c);const[j,M,D]=v.getElevation(p,v.elevation,v.elevationFeature);return Gs(w+j,S+M,C+D,c)}function Br(p,n,c,m,v,w,S,C){const j=Zb(p.sub(n)._unit()._add(p),C,v,S,w);return o.av(j,c,j),o.aw(j,j),o.bG(j,c,j,m)}function mp(p,n,c,m,v,w,S,C,j,M,D,B,O,G,X,ee,oe,ie,ce){const me=m?p-n:p+n;let de=me>0?1:-1,Ee=0;m&&(de*=-1,Ee=Math.PI),de<0&&(Ee+=Math.PI);let ge=C+S+(de>0?0:1)|0,je=v,Se=v,ve=0,Ie=0;const $e=Math.abs(me),Fe=[],at=[];let Qe=w,pt=Qe,Ot=o.bE([]);const Ye=()=>Br(pt,Qe,Se,$e-ve+1,D,O,ee,oe.canonical);for(;ve+Ie<=$e;){if(ge+=de,ge<C||ge>=j)return null;if(Se=je,pt=Qe,Fe.push(Se),G&&at.push(pt),Qe=new o.P(M.getx(ge),M.gety(ge)),je=B[ge],!je){const nr=Zb(Qe,oe.canonical,D,ee,O);je=nr[3]>0?B[ge]=nr:Ye()}ve+=Ie;const zt=o.av([],je,Se),ur=o.bF(Se,je);if(c&&ur>0&&Ie>0&&o.bI(Ot,zt)/(Ie*ur)<ce)return null;Ie=ur,Ot=zt}X&&O&&(B[ge]&&(je=Ye(),Ie=o.bF(Se,je),Ot=o.av([],je,Se)),B[ge]=je);const Oe=($e-ve)/Ie,mt=Qe.sub(pt)._mult(Oe)._add(pt),et=o.bG([],Se,Ot,Oe);let Et=[0,0,1],$t=Ot[0],lr=Ot[1];if(ie&&(Et=ee.upVector(oe.canonical,mt.x,mt.y),Et[0]!==0||Et[1]!==0||Et[2]!==1)){const zt=[Et[2],0,-Et[0]],ur=o.bH([],Et,zt);o.aw(zt,zt),o.aw(ur,ur),$t=o.bI(Ot,zt),lr=o.bI(Ot,ur)}if(c){const zt=o.bH([],Et,Ot);o.aw(zt,zt),o.bG(et,et,zt,c*de)}const Mt=Ee+Math.atan2(lr,$t);return Fe.push(et),G&&at.push(mt),{point:et,angle:Mt,path:Fe,tilePath:at,up:Et}}function kc(p,n){const c=n.length,m=c+4*p;n.resize(m),n.float32.fill(-1/0,4*c,4*m)}function sl(p,n,c){const m=n[0],v=n[1];return p[0]=c[0]*m+c[4]*v+c[12],p[1]=c[1]*m+c[5]*v+c[13],p[3]=c[3]*m+c[7]*v+c[15],p}const ol=100;class oh{constructor(n,c,m=new hp(n.width+200,n.height+200,25),v=new hp(n.width+200,n.height+200,25)){this.transform=n,this.grid=m,this.ignoredGrid=v,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+ol,this.screenBottomBoundary=n.height+ol,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=c}placeCollisionBox(n,c,m,v,w,S,C,j,M,D,B){let O=m.projectedAnchorX,G=m.projectedAnchorY,X=m.projectedAnchorZ;const ee=m.tileAnchorX,oe=m.tileAnchorY,ie=m.elevation,ce=m.tileID,me=n.getProjection();if(ie&&ce){const[at,Qe,pt]=me.upVector(ce.canonical,m.tileAnchorX,m.tileAnchorY),Ot=me.upVectorScale(ce.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;O+=at*ie*Ot,G+=Qe*ie*Ot,X+=pt*ie*Ot}const de=n.projection.name==="globe",Ee=n.projection.name==="globe"?o.aj(this.transform.zoom):0;if(ce&&de&&Ee<1&&!S){const at=1<<ce.canonical.z,Qe=o.bO(ee,oe);o.bP(Qe,Qe,1/o.al),o.bQ(Qe,Qe,o.bO(ce.canonical.x,ce.canonical.y)),o.bP(Qe,Qe,1/at),o.bR(Qe,Qe,o.bO(v[0],v[1])),Qe[0]=o.bS(Qe[0],-.5,.5),o.bP(Qe,Qe,o.al);const pt=o.bT(Qe[0],Qe[1],o.al/(2*Math.PI),1);o.aC(pt,pt,w),O=o.ak(O,pt[0],Ee),G=o.ak(G,pt[1],Ee),X=o.ak(X,pt[2],Ee)}const ge=this.projectAndGetPerspectiveRatio(D,O,G,X,m.tileID,me.name==="globe"||!!ie||this.transform.pitch>0,me),je=M*ge.perspectiveRatio,Se=(m.x1*c+C.x-m.padding)*je+ge.point.x,ve=(m.y1*c+C.y-m.padding)*je+ge.point.y,Ie=(m.x2*c+C.x+m.padding)*je+ge.point.x,$e=(m.y2*c+C.y+m.padding)*je+ge.point.y,Fe=ge.perspectiveRatio<=.55||ge.occluded;return!this.isInsideGrid(Se,ve,Ie,$e)||!j&&this.grid.hitTest(Se,ve,Ie,$e,B)||Fe?{box:[],offscreen:!1,occluded:ge.occluded}:{box:[Se,ve,Ie,$e],offscreen:this.isOffscreen(Se,ve,Ie,$e),occluded:!1}}placeCollisionCircles(n,c,m,v,w,S,C,j,M,D,B,O,G,X,ee,oe){const ie=[],ce=this.transform.elevation,me=n.getProjection(),de=n.elevationType==="road",Ee=!!ce||de,ge=o.bU.getAtTileOffsetFunc(oe,this.transform.center.lat,this.transform.worldSize,me),je=new o.P(m.tileAnchorX,m.tileAnchorY),Se=new o.P(m.tileAnchorX,m.tileAnchorY);let{x:ve,y:Ie,z:$e}=me.projectTilePoint(Se.x,Se.y,oe.canonical),Fe=null;if(Ee){const ur=de?n.getElevationFeatureForText(v):null;Fe={getElevation:ge,elevation:ce,elevationFeature:ur};const[nr,er,ir]=ge(je,ce,ur);ve+=nr,Ie+=er,$e+=ir}const at=me.name==="globe",Qe=this.projectAndGetPerspectiveRatio(j,ve,Ie,$e,oe,at||!!ce||this.transform.pitch>0,me),{perspectiveRatio:pt}=Qe,Ot=(O?C/pt:C*pt)/o.bX,Ye=Gs(ve,Ie,$e,M),Oe=m.lineOffsetX*Ot,mt=m.lineOffsetY*Ot,et=o.an(n.layers[0].layout.get("text-max-angle")),Et=Math.cos(et),$t=Qe.signedDistanceFromCamera>0?ri(Ot,S,Oe,mt,de&&m.flipState===1,Ye,Se,m,w,M,{},Ee&&!O?Fe:null,O&&Ee,me,oe,O,Et):null;let lr=!1,Mt=!1,zt=!0;if($t&&!Qe.occluded){const ur=.5*X*pt+ee,nr=new o.P(-100,-100),er=new o.P(this.screenRightBoundary,this.screenBottomBoundary),ir=new V2,{first:kr,last:xn}=$t,Mn=kr.path.length;let fi=[];for(let on=Mn-1;on>=1;on--)fi.push(kr.path[on]);for(let on=1;on<xn.path.length;on++)fi.push(xn.path[on]);const Gr=2.5*ur;D&&(fi=fi.map(([on,ai,Nn],Si)=>(Ee&&!at&&(Nn=ge(Si<Mn-1?kr.tilePath[Mn-1-Si]:xn.tilePath[Si-Mn+2],ce,Fe.elevationFeature)[2]),Gs(on,ai,Nn,D))),fi.some(on=>on[3]<=0)&&(fi=[]));let Pn=[];if(fi.length>0){let on=1/0,ai=-1/0,Nn=1/0,Si=-1/0;for(const $n of fi)on=Math.min(on,$n[0]),Nn=Math.min(Nn,$n[1]),ai=Math.max(ai,$n[0]),Si=Math.max(Si,$n[1]);ai>=nr.x&&on<=er.x&&Si>=nr.y&&Nn<=er.y&&(Pn=[fi.map($n=>new o.P($n[0],$n[1]))],(on<nr.x||ai>er.x||Nn<nr.y||Si>er.y)&&(Pn=o.bV(Pn,nr.x,nr.y,er.x,er.y)))}for(const on of Pn){ir.reset(on,.25*ur);let ai=0;ai=ir.length<=.5*ur?1:Math.ceil(ir.paddedLength/Gr)+1;for(let Nn=0;Nn<ai;Nn++){const Si=Nn/Math.max(ai-1,1),$n=ir.lerp(Si),an=$n.x+ol,Qn=$n.y+ol;ie.push(an,Qn,ur,0);const dn=an-ur,ki=Qn-ur,ti=an+ur,Zr=Qn+ur;if(zt=zt&&this.isOffscreen(dn,ki,ti,Zr),Mt=Mt||this.isInsideGrid(dn,ki,ti,Zr),!c&&this.grid.hitTestCircle(an,Qn,ur,G)&&(lr=!0,!B))return{circles:[],offscreen:!1,collisionDetected:lr,occluded:!1}}}}return{circles:!B&&lr||!Mt?[]:ie,offscreen:zt,collisionDetected:lr,occluded:Qe.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let m=1/0,v=1/0,w=-1/0,S=-1/0;for(const D of n){const B=new o.P(D.x+ol,D.y+ol);m=Math.min(m,B.x),v=Math.min(v,B.y),w=Math.max(w,B.x),S=Math.max(S,B.y),c.push(B)}const C=this.grid.query(m,v,w,S).concat(this.ignoredGrid.query(m,v,w,S)),j={},M={};for(const D of C){const B=D.key;if(j[B.bucketInstanceId]===void 0&&(j[B.bucketInstanceId]={}),j[B.bucketInstanceId][B.featureIndex])continue;const O=[new o.P(D.x1,D.y1),new o.P(D.x2,D.y1),new o.P(D.x2,D.y2),new o.P(D.x1,D.y2)];o.bW(c,O)&&(j[B.bucketInstanceId][B.featureIndex]=!0,M[B.bucketInstanceId]===void 0&&(M[B.bucketInstanceId]=[]),M[B.bucketInstanceId].push(B.featureIndex))}return M}insertCollisionBox(n,c,m,v,w){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:v,collisionGroupID:w},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,c,m,v,w){const S=c?this.ignoredGrid:this.grid,C={bucketInstanceId:m,featureIndex:v,collisionGroupID:w};for(let j=0;j<n.length;j+=4)S.insertCircle(C,n[j],n[j+1],n[j+2])}projectAndGetPerspectiveRatio(n,c,m,v,w,S,C){const j=[c,m,v,1];let M=!1;v||this.transform.pitch>0?(o.aC(j,j,n),this.fogState&&w&&C.name!=="globe"&&(M=function(O,G,X,ee,oe,ie){const ce=ie.calculateFogTileMatrix(oe),me=[G,X,ee];return o.af(me,me,ce),Dt(O,o.ag(me),ie.pitch,ie._fov)}(this.fogState,c,m,v,w.toUnwrapped(),this.transform)>.9)):sl(j,j,n);const D=j[3];return{point:new o.P((j[0]/D+1)/2*this.transform.width+ol,(-j[1]/D+1)/2*this.transform.height+ol),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(C)/D*.5,1.5),signedDistanceFromCamera:D,occluded:S&&j[2]>D||M}}isOffscreen(n,c,m,v){return m<ol||n>=this.screenRightBoundary||v<ol||c>this.screenBottomBoundary}isInsideGrid(n,c,m,v){return m>=0&&n<this.gridRightBoundary&&v>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const n=o.bz([]);return o.bq(n,n,[-100,-100,0]),n}}class _r{constructor(n,c,m,v){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?c:-c))):v&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class Un{constructor(n,c,m,v,w,S=!1){this.text=new _r(n?n.text:null,c,m,w),this.icon=new _r(n?n.icon:null,c,v,w),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ei{constructor(n,c,m,v=!1){this.text=n,this.icon=c,this.skipFade=m,this.clipped=v}}class ma{constructor(){this.invProjMatrix=o.bB(),this.viewportMatrix=o.bB(),this.circles=[]}}class ah{constructor(n,c,m,v,w){this.bucketInstanceId=n,this.featureIndex=c,this.sourceLayerIndex=m,this.bucketIndex=v,this.tileID=w}}class oi{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const c=++this.maxGroupID;this.collisionGroups[n]={ID:c,predicate:m=>m.collisionGroupID===c}}return this.collisionGroups[n]}}function gp(p,n,c,m,v){const{horizontalAlign:w,verticalAlign:S}=o.c0(p),C=-(w-.5)*n,j=-(S-.5)*c,M=o.c1(p,m);return new o.P(C+M[0]*v,j+M[1]*v)}function ud(p,n,c,m,v){const w=new o.P(p,n);return c&&w._rotate(m?v:-v),w}class _p{constructor(n,c,m,v,w,S){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new oh(this.transform,w),this.buildingIndex=S,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new oi(m),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,c,m,v,w=1){const S=m.getBucket(c),C=m.latestFeatureIndex;if(!S||!C||c.fqid!==S.layerIds[0])return;const j=S.layers[0].layout,M=S.layers[0].paint,D=m.collisionBoxArray,B=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),O=m.tileSize/o.al,G=m.tileID.toUnwrapped();this.transform.setProjection(S.projection);const X=(ee=m.tileID,oe=S.getProjection(),ie=this.transform,oe.name===this.projection?ie.calculateProjMatrix(ee.toUnwrapped()):cd(ie,oe,ee));var ee,oe,ie;const ce=j.get("text-pitch-alignment")==="map",me=j.get("text-rotation-alignment")==="map";c.compileFilter(c.options);const de=c.dynamicFilter(),Ee=c.dynamicFilterNeedsFeature(),ge=this.transform.calculatePixelsToTileUnitsMatrix(m),je=pp(X,m.tileID.canonical,ce,me,this.transform,S.getProjection(),ge);let Se=null;const ve=S.getProjection().createInversionMatrix(this.transform,m.tileID.canonical);if(ce){const Oe=Ic(X,m.tileID.canonical,ce,me,this.transform,S.getProjection(),ge);Se=o.aB([],this.transform.labelPlaneMatrix,Oe)}let Ie=null;de&&m.latestFeatureIndex&&(Ie={unwrappedTileID:G,dynamicFilter:de,dynamicFilterNeedsFeature:Ee}),this.retainedQueryData[S.bucketInstanceId]=new ah(S.bucketInstanceId,C,S.sourceLayerIndex,S.index,m.tileID);const[$e,Fe]=S.layers[0].layout.get("text-size-scale-range"),at=o.aA(w,$e,Fe),[Qe,pt]=j.get("icon-size-scale-range"),Ot=o.aA(w,Qe,pt),Ye={bucket:S,layout:j,paint:M,posMatrix:X,invMatrix:ve,mercatorCenter:[o.aF(this.transform.center.lng),o.aJ(this.transform.center.lat)],textLabelPlaneMatrix:je,labelToScreenMatrix:Se,clippingData:Ie,scale:B,textPixelRatio:O,holdingForFade:m.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:o.bJ(S.textSizeData,this.transform.zoom,at),partiallyEvaluatedIconSize:o.bJ(S.iconSizeData,this.transform.zoom,Ot),collisionGroup:this.collisionGroups.get(S.sourceID),latestFeatureIndex:m.latestFeatureIndex};if(v)for(const Oe of S.sortKeyRanges){const{sortKey:mt,symbolInstanceStart:et,symbolInstanceEnd:Et}=Oe;n.push({sortKey:mt,symbolInstanceStart:et,symbolInstanceEnd:Et,parameters:Ye})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:Ye})}attemptAnchorPlacement(n,c,m,v,w,S,C,j,M,D,B,O,G,X,ee,oe,ie,ce,me,de,Ee){const{textOffset0:ge,textOffset1:je,crossTileID:Se}=ee,ve=[ge,je],Ie=gp(n,S,C,ve,j),$e=this.collisionIndex.placeCollisionBox(ie,j,c,m,v,w,ud(Ie.x,Ie.y,M,D,this.transform.angle),X,B,O,G.predicate);if(me){const Fe=ie.getSymbolInstanceIconSize(Ee,this.transform.zoom,ee.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ie,Fe,me,m,v,w,ud(Ie.x,Ie.y,M,D,this.transform.angle),X,B,O,G.predicate).box.length===0)return}if($e.box.length>0){let Fe;return this.prevPlacement&&this.prevPlacement.variableOffsets[Se]&&this.prevPlacement.placements[Se]&&this.prevPlacement.placements[Se].text&&(Fe=this.prevPlacement.variableOffsets[Se].anchor),this.variableOffsets[Se]={textOffset:ve,width:S,height:C,anchor:n,textScale:j,prevAnchor:Fe},this.markUsedJustification(ie,n,ee,ce),ie.allowVerticalPlacement&&(this.markUsedOrientation(ie,ce,ee),this.placedOrientations[Se]=ce),{shift:Ie,placedGlyphBoxes:$e}}}placeLayerBucketPart(n,c,m,v,w=1){const{bucket:S,layout:C,paint:j,posMatrix:M,textLabelPlaneMatrix:D,labelToScreenMatrix:B,clippingData:O,textPixelRatio:G,mercatorCenter:X,invMatrix:ee,holdingForFade:oe,collisionBoxArray:ie,partiallyEvaluatedTextSize:ce,partiallyEvaluatedIconSize:me,collisionGroup:de,latestFeatureIndex:Ee}=n.parameters,ge=C.get("text-optional"),je=C.get("icon-optional"),Se=C.get("text-allow-overlap"),ve=C.get("icon-allow-overlap"),Ie=C.get("text-rotation-alignment")==="map",$e=C.get("icon-rotation-alignment")==="map",Fe=C.get("text-pitch-alignment")==="map",at=j.get("symbol-z-offset"),Qe=C.get("symbol-elevation-reference")==="sea",pt=C.get("symbol-placement"),[Ot,Ye]=C.get("text-size-scale-range"),[Oe,mt]=C.get("icon-size-scale-range"),et=o.aA(w,Ot,Ye),Et=o.aA(w,Oe,mt),$t=C.get("text-variable-anchor"),lr=Ie&&pt!=="point",Mt=$e&&pt!=="point",zt=$t&&S.hasTextData(),ur=S.hasIconTextFit()&&zt&&S.hasIconData();this.transform.setProjection(S.projection);const nr=zt||lr,er=Mt||ur;let ir=Se&&(ve||!S.hasIconData()||je),kr=ve&&(Se||!S.hasTextData()||ge);const xn=!at.isConstant();!S.collisionArrays&&ie&&S.deserializeCollisionBoxes(ie),m&&v&&S.updateCollisionDebugBuffers(this.transform.zoom,ie,et,Et);const Mn=(Gr,Pn,on)=>{const{crossTileID:ai,numVerticalGlyphVertices:Nn}=Gr;let Si=null;if(O&&O.dynamicFilterNeedsFeature||xn){const es=this.retainedQueryData[S.bucketInstanceId];Si=Ee.loadFeature({featureIndex:Gr.featureIndex,bucketIndex:es.bucketIndex,sourceLayerIndex:es.sourceLayerIndex,layoutVertexArrayOffset:0})}if(O&&!(0,O.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:S.worldview},Si,this.retainedQueryData[S.bucketInstanceId].tileID.canonical,new o.P(Gr.tileAnchorX,Gr.tileAnchorY),this.transform.calculateDistanceTileData(O.unwrappedTileID)))return this.placements[ai]=new ei(!1,!1,!1,!0),void c.add(ai);const $n=at.evaluate(Si,{});if(c.has(ai))return;if(oe)return void(this.placements[ai]=new ei(!1,!1,!1));let an=!1,Qn=!1,dn=!0,ki=!1,ti=!1,Zr=null,Ln={box:null,offscreen:null,occluded:null},Gi={box:null},ds=null,Xi=null,ss=null,aa=0,Jo=0,wo=0;on.textFeatureIndex?aa=on.textFeatureIndex:Gr.useRuntimeCollisionCircles&&(aa=Gr.featureIndex),on.verticalTextFeatureIndex&&(Jo=on.verticalTextFeatureIndex);const ko=S.elevationFeatures?S.elevationFeatures[Gr.elevationFeatureIndex]:void 0,Da=es=>{es.tileID=this.retainedQueryData[S.bucketInstanceId].tileID;const hs=this.transform.elevation;es.elevation=Qe?$n:$n+o.bU.getAtTileOffset(es.tileID,new o.P(es.tileAnchorX,es.tileAnchorY),hs,ko),es.elevation+=Gr.zOffset},So=on.textBox;if(So){Da(So);const es=wi=>{let _s=o.bK.horizontal;if(S.allowVerticalPlacement&&!wi&&this.prevPlacement){const io=this.prevPlacement.placedOrientations[ai];io&&(this.placedOrientations[ai]=io,_s=io,this.markUsedOrientation(S,_s,Gr))}return _s},hs=(wi,_s)=>{if(S.allowVerticalPlacement&&Nn>0&&on.verticalTextBox){for(const io of S.writingModes)if(io===o.bK.vertical?(Ln=_s(),Gi=Ln):Ln=wi(),Ln&&Ln.box&&Ln.box.length)break}else Ln=wi()};if($t){let wi=$t;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ai]){const ts=this.prevPlacement.variableOffsets[ai];wi.indexOf(ts.anchor)>0&&(wi=wi.filter(La=>La!==ts.anchor),wi.unshift(ts.anchor))}const _s=(ts,La,zh)=>{const Bc=S.getSymbolInstanceTextSize(ce,Gr,this.transform.zoom,Pn),Fh=(ts.x2-ts.x1)*Bc+2*ts.padding,Bh=(ts.y2-ts.y1)*Bc+2*ts.padding,za=Gr.hasIconTextFit&&!ve?La:null;za&&Da(za);let ac={box:[],offscreen:!1,occluded:!1};const eo=Se?2*wi.length:wi.length;for(let Fa=0;Fa<eo;++Fa){const Td=this.attemptAnchorPlacement(wi[Fa%wi.length],ts,X,ee,nr,Fh,Bh,Bc,Ie,Fe,G,M,de,Fa>=wi.length,Gr,Pn,S,zh,za,ce,me);if(Td&&(ac=Td.placedGlyphBoxes,ac&&ac.box&&ac.box.length)){an=!0,Zr=Td.shift;break}}return ac};hs(()=>_s(So,on.iconBox,o.bK.horizontal),()=>{const ts=on.verticalTextBox;return ts&&Da(ts),S.allowVerticalPlacement&&!(Ln&&Ln.box&&Ln.box.length)&&Nn>0&&ts?_s(ts,on.verticalIconBox,o.bK.vertical):{box:null,offscreen:null,occluded:null}}),Ln&&(an=Ln.box,dn=Ln.offscreen,ki=Ln.occluded);const io=es(!(!Ln||!Ln.box));if(!an&&this.prevPlacement){const ts=this.prevPlacement.variableOffsets[ai];ts&&(this.variableOffsets[ai]=ts,this.markUsedJustification(S,ts.anchor,Gr,io))}}else{const wi=(_s,io)=>{const ts=S.getSymbolInstanceTextSize(ce,Gr,this.transform.zoom,Pn),La=this.collisionIndex.placeCollisionBox(S,ts,_s,X,ee,nr,new o.P(0,0),Se,G,M,de.predicate);return La&&La.box&&La.box.length&&(this.markUsedOrientation(S,io,Gr),this.placedOrientations[ai]=io),La};hs(()=>wi(So,o.bK.horizontal),()=>{const _s=on.verticalTextBox;return S.allowVerticalPlacement&&Nn>0&&_s?(Da(_s),wi(_s,o.bK.vertical)):{box:null,offscreen:null,occluded:null}}),es(!!(Ln&&Ln.box&&Ln.box.length))}}if(ds=Ln,an=ds&&ds.box&&ds.box.length>0,dn=ds&&ds.offscreen,ki=ds&&ds.occluded,Gr.useRuntimeCollisionCircles){const es=Gr.centerJustifiedTextSymbolIndex>=0?Gr.centerJustifiedTextSymbolIndex:Gr.verticalPlacedTextSymbolIndex,hs=S.text.placedSymbolArray.get(es),wi=o.bL(S.textSizeData,ce,hs),_s=C.get("text-padding");Xi=this.collisionIndex.placeCollisionCircles(S,Se,hs,es,S.lineVertexArray,S.glyphOffsetArray,wi,M,D,B,m,Fe,de.predicate,Gr.collisionCircleDiameter*wi/o.bX,_s,this.retainedQueryData[S.bucketInstanceId].tileID),an=Se||Xi.circles.length>0&&!Xi.collisionDetected,dn=dn&&Xi.offscreen,ki=Xi.occluded}if(on.iconFeatureIndex&&(wo=on.iconFeatureIndex),on.iconBox){const es=hs=>{Da(hs);const wi=Gr.hasIconTextFit&&Zr?ud(Zr.x,Zr.y,Ie,Fe,this.transform.angle):new o.P(0,0),_s=S.getSymbolInstanceIconSize(me,this.transform.zoom,Gr.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(S,_s,hs,X,ee,er,wi,ve,G,M,de.predicate)};Gi&&Gi.box&&Gi.box.length&&on.verticalIconBox?(ss=es(on.verticalIconBox),Qn=ss.box.length>0):(ss=es(on.iconBox),Qn=ss.box.length>0),dn=dn&&ss.offscreen,ti=ss.occluded}const Oa=ge||Gr.numHorizontalGlyphVertices===0&&Nn===0,fl=je||Gr.numIconVertices===0;if(Oa||fl?fl?Oa||(Qn=Qn&&an):an=Qn&&an:Qn=an=Qn&&an,an&&ds&&ds.box&&this.collisionIndex.insertCollisionBox(ds.box,C.get("text-ignore-placement"),S.bucketInstanceId,Gi&&Gi.box&&Jo?Jo:aa,de.ID),Qn&&ss&&this.collisionIndex.insertCollisionBox(ss.box,C.get("icon-ignore-placement"),S.bucketInstanceId,wo,de.ID),Xi&&(an&&this.collisionIndex.insertCollisionCircles(Xi.circles,C.get("text-ignore-placement"),S.bucketInstanceId,aa,de.ID),m)){const es=S.bucketInstanceId;let hs=this.collisionCircleArrays[es];hs===void 0&&(hs=this.collisionCircleArrays[es]=new ma);for(let wi=0;wi<Xi.circles.length;wi+=4)hs.circles.push(Xi.circles[wi+0]),hs.circles.push(Xi.circles[wi+1]),hs.circles.push(Xi.circles[wi+2]),hs.circles.push(Xi.collisionDetected?1:0)}const no=S.projection.name!=="globe";ir=ir&&(no||!ki),kr=kr&&(no||!ti),this.placements[ai]=new ei(an||ir,Qn||kr,dn||S.justReloaded),c.add(ai)},fi=this.retainedQueryData[S.bucketInstanceId].tileID;if(S.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(S,fi),S.elevationType==="road"&&S.updateRoadElevation(fi.canonical),S.updateZOffset(),S.sortFeaturesByY){const Gr=S.getSortedSymbolIndexes(this.transform.angle);for(let Pn=Gr.length-1;Pn>=0;--Pn){const on=Gr[Pn];Mn(S.symbolInstances.get(on),on,S.collisionArrays[on])}S.hasAnyZOffset&&o.w(`${S.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(S.hasAnyZOffset){const Gr=S.getSortedIndexesByZOffset();for(let Pn=0;Pn<Gr.length;++Pn){const on=Gr[Pn];Mn(S.symbolInstances.get(on),on,S.collisionArrays[on])}}else for(let Gr=n.symbolInstanceStart;Gr<n.symbolInstanceEnd;Gr++)Mn(S.symbolInstances.get(Gr),Gr,S.collisionArrays[Gr]);if(m&&S.bucketInstanceId in this.collisionCircleArrays){const Gr=this.collisionCircleArrays[S.bucketInstanceId];o.bk(Gr.invProjMatrix,M),Gr.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1}markUsedJustification(n,c,m,v){const{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:j,crossTileID:M}=m,D=o.c2(c),B=v===o.bK.vertical?j:D==="left"?w:D==="center"?S:D==="right"?C:-1;w>=0&&(n.text.placedSymbolArray.get(w).crossTileID=B>=0&&w!==B?0:M),S>=0&&(n.text.placedSymbolArray.get(S).crossTileID=B>=0&&S!==B?0:M),C>=0&&(n.text.placedSymbolArray.get(C).crossTileID=B>=0&&C!==B?0:M),j>=0&&(n.text.placedSymbolArray.get(j).crossTileID=B>=0&&j!==B?0:M)}markUsedOrientation(n,c,m){const v=c===o.bK.horizontal||c===o.bK.horizontalOnly?c:0,w=c===o.bK.vertical?c:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:j,verticalPlacedTextSymbolIndex:M}=m,D=n.text.placedSymbolArray;S>=0&&(D.get(S).placedOrientation=v),C>=0&&(D.get(C).placedOrientation=v),j>=0&&(D.get(j).placedOrientation=v),M>=0&&(D.get(M).placedOrientation=w)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let m=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const v=c?c.symbolFadeChange(n):1,w=c?c.opacities:{},S=c?c.variableOffsets:{},C=c?c.placedOrientations:{};for(const j in this.placements){const M=this.placements[j],D=w[j];D?(this.opacities[j]=new Un(D,v,M.text,M.icon,null,M.clipped),m=m||M.text!==D.text.placed||M.icon!==D.icon.placed):(this.opacities[j]=new Un(null,v,M.text,M.icon,M.skipFade,M.clipped),m=m||M.text||M.icon)}for(const j in w){const M=w[j];if(!this.opacities[j]){const D=new Un(M,v,!1,!1);D.isHidden()||(this.opacities[j]=D,m=m||M.text.placed||M.icon.placed)}}for(const j in S)this.variableOffsets[j]||!this.opacities[j]||this.opacities[j].isHidden()||(this.variableOffsets[j]=S[j]);for(const j in C)this.placedOrientations[j]||!this.opacities[j]||this.opacities[j].isHidden()||(this.placedOrientations[j]=C[j]);m?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:n)}updateLayerOpacities(n,c,m,v){const w=new Set;for(const S of c){const C=S.getBucket(n);C&&S.latestFeatureIndex&&n.fqid===C.layerIds[0]&&(this.updateBucketOpacities(C,w,S,S.collisionBoxArray,m,v,S.tileID,n.scope),C.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(C,S.tileID),C.elevationType==="road"&&C.updateRoadElevation(S.tileID.canonical),C.updateZOffset())}}updateBucketOpacities(n,c,m,v,w,S,C,j){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const M=n.layers[0].layout,D=n.layers[0].paint,B=!!n.layers[0].dynamicFilter(),O=new Un(null,0,!1,!1,!0),G=M.get("text-allow-overlap"),X=M.get("icon-allow-overlap"),ee=M.get("text-variable-anchor"),oe=M.get("text-rotation-alignment")==="map",ie=M.get("text-pitch-alignment")==="map",ce=D.get("symbol-z-offset"),me=M.get("symbol-elevation-reference")==="sea",de=!ce.isConstant(),Ee=new Un(null,0,G&&(X||!n.hasIconData()||M.get("icon-optional")),X&&(G||!n.hasTextData()||M.get("text-optional")),!0);!n.collisionArrays&&v&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(v);const ge=(Se,ve,Ie)=>{for(let $e=0;$e<ve/4;$e++)Se.opacityVertexArray.emplaceBack(Ie)};let je=0;S&&n.updateReplacement(C,S);for(let Se=0;Se<n.symbolInstances.length;Se++){const ve=n.symbolInstances.get(Se),{numHorizontalGlyphVertices:Ie,numVerticalGlyphVertices:$e,crossTileID:Fe,numIconVertices:at,tileAnchorX:Qe,tileAnchorY:pt}=ve;let Ot=null;const Ye=this.retainedQueryData[n.bucketInstanceId];de&&ve&&Ye&&(Ot=m.latestFeatureIndex.loadFeature({featureIndex:ve.featureIndex,bucketIndex:Ye.bucketIndex,sourceLayerIndex:Ye.sourceLayerIndex,layoutVertexArrayOffset:0}));const Oe=ce.evaluate(Ot,{}),mt=c.has(Fe);let et=this.opacities[Fe];mt?et=O:et||(et=Ee,this.opacities[Fe]=et),c.add(Fe);const Et=Ie>0||$e>0,$t=at>0,lr=this.placedOrientations[Fe],Mt=lr===o.bK.vertical,zt=lr===o.bK.horizontal||lr===o.bK.horizontalOnly;!Et&&!$t||et.isHidden()||je++;let ur=!1;if((Et||$t)&&S)for(const nr of n.activeReplacements){if(o.bY(nr,w,o.bZ.Symbol,j)||nr.min.x>Qe||Qe>nr.max.x||nr.min.y>pt||pt>nr.max.y)continue;const er=o.b_(Qe,pt,C.canonical,nr.footprintTileId.canonical);if(ur=o.b$(er,nr.footprint),ur)break}if(Et){const nr=ur?ro:xp(et.text);ge(n.text,Ie,Mt?ro:nr),ge(n.text,$e,zt?ro:nr);const er=et.text.isHidden(),{leftJustifiedTextSymbolIndex:ir,centerJustifiedTextSymbolIndex:kr,rightJustifiedTextSymbolIndex:xn,verticalPlacedTextSymbolIndex:Mn}=ve,fi=n.text.placedSymbolArray,Gr=er||Mt?1:0;ir>=0&&(fi.get(ir).hidden=Gr),kr>=0&&(fi.get(kr).hidden=Gr),xn>=0&&(fi.get(xn).hidden=Gr),Mn>=0&&(fi.get(Mn).hidden=er||zt?1:0);const Pn=this.variableOffsets[Fe];Pn&&this.markUsedJustification(n,Pn.anchor,ve,lr);const on=this.placedOrientations[Fe];on&&(this.markUsedJustification(n,"left",ve,on),this.markUsedOrientation(n,on,ve))}if($t){const nr=ur?ro:xp(et.icon),{placedIconSymbolIndex:er,verticalPlacedIconSymbolIndex:ir}=ve,kr=n.icon.placedSymbolArray,xn=et.icon.isHidden()?1:0;er>=0&&(ge(n.icon,at,Mt?ro:nr),kr.get(er).hidden=xn),ir>=0&&(ge(n.icon,ve.numVerticalIconVertices,zt?ro:nr),kr.get(ir).hidden=xn)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const nr=n.collisionArrays[Se];if(nr){let er=new o.P(0,0),ir=!0;if(nr.textBox||nr.verticalTextBox){if(ee){const xn=this.variableOffsets[Fe];xn?(er=gp(xn.anchor,xn.width,xn.height,xn.textOffset,xn.textScale),oe&&er._rotate(ie?this.transform.angle:-this.transform.angle)):ir=!1}B&&(ir=!et.clipped),nr.textBox&&fo(n.textCollisionBox.collisionVertexArray,et.text.placed,!ir||Mt,Oe,me,er.x,er.y),nr.verticalTextBox&&fo(n.textCollisionBox.collisionVertexArray,et.text.placed,!ir||zt,Oe,me,er.x,er.y)}const kr=ir&&!!(!zt&&nr.verticalIconBox);nr.iconBox&&fo(n.iconCollisionBox.collisionVertexArray,et.icon.placed,kr,Oe,me,ve.hasIconTextFit?er.x:0,ve.hasIconTextFit?er.y:0),nr.verticalIconBox&&fo(n.iconCollisionBox.collisionVertexArray,et.icon.placed,!kr,Oe,me,ve.hasIconTextFit?er.x:0,ve.hasIconTextFit?er.y:0)}}}if(n.fullyClipped=je===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const Se=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=Se.invProjMatrix,n.placementViewportMatrix=Se.viewportMatrix,n.collisionCircleArray=Se.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,c){const m=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*m>n}setStale(){this.stale=!0}}function fo(p,n,c,m,v,w,S){p.emplaceBack(n?1:0,c?1:0,w||0,S||0,m,v?1:0),p.emplaceBack(n?1:0,c?1:0,w||0,S||0,m,v?1:0),p.emplaceBack(n?1:0,c?1:0,w||0,S||0,m,v?1:0),p.emplaceBack(n?1:0,c?1:0,w||0,S||0,m,v?1:0)}const Ls=Math.pow(2,25),U2=Math.pow(2,24),yp=Math.pow(2,17),uv=Math.pow(2,16),vp=Math.pow(2,9),Ym=Math.pow(2,8),dv=Math.pow(2,1);function xp(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const n=p.placed?1:0,c=Math.floor(127*p.opacity);return c*Ls+n*U2+c*yp+n*uv+c*vp+n*Ym+c*dv+n}const ro=0;class Pc{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,c,m,v,w,S){const C=this._bucketParts;for(;this._currentTileIndex<n.length;)if(c.getBucketParts(C,v,n[this._currentTileIndex],this._sortAcrossTiles,S),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((j,M)=>j.sortKey-M.sortKey));this._currentPartIndex<C.length;){const j=C[this._currentPartIndex];if(c.placeLayerBucketPart(j,this._seenCrossTileIDs,m,j.symbolInstanceStart===0,S),this._currentPartIndex++,w())return!0}return!1}}class ia{constructor(n,c,m,v,w,S,C,j,M){this.placement=new _p(n,w,S,C,j,M),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(n,c,m,v,w){const S=o.o.now(),C=()=>{const j=o.o.now()-S;return!this._forceFullPlacement&&j>2};for(;this._currentPlacementIndex>=0;){const j=c[n[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(j.type==="symbol"&&(!j.minzoom||j.minzoom<=M)&&(!j.maxzoom||j.maxzoom>M)){const D=j,B=D.layout.get("symbol-z-elevate"),O=D.layout.get("symbol-sort-key").constantOr(1)!==void 0,G=D.layout.get("symbol-z-order"),X=G==="viewport-y"||G==="auto"&&!(G!=="viewport-y"&&O),ee=D.layout.get("text-allow-overlap")||D.layout.get("icon-allow-overlap")||D.layout.get("text-ignore-placement")||D.layout.get("icon-ignore-placement"),oe=X&&ee,ie=this._inProgressLayer=this._inProgressLayer||new Pc(D),ce=o.B(j.source,j.scope);if(ie.continuePlacement(B||oe?v[ce]:m[ce],this.placement,this._showCollisionBoxes,j,C,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const Jm=512/o.al/2;class lh{constructor(n,c,m){this.tileID=n,this.bucketInstanceId=m,this.index=new o.c3(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const v=n.canonical.x*o.al,w=n.canonical.y*o.al;for(let S=0;S<c.length;S++){const{key:C,crossTileID:j,tileAnchorX:M,tileAnchorY:D}=c.get(S),B=Math.floor((v+M)*Jm),O=Math.floor((w+D)*Jm);this.index.add(B,O),this.keys.push(C),this.crossTileIDs.push(j)}this.index.finish()}findMatches(n,c,m){const v=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),w=Jm/Math.pow(2,c.canonical.z-this.tileID.canonical.z),S=c.canonical.x*o.al,C=c.canonical.y*o.al;for(let j=0;j<n.length;j++){const M=n.get(j);if(M.crossTileID)continue;const{key:D,tileAnchorX:B,tileAnchorY:O}=M,G=Math.floor((S+B)*w),X=Math.floor((C+O)*w),ee=this.index.range(G-v,X-v,G+v,X+v).sort((oe,ie)=>oe-ie);for(const oe of ee){const ie=this.crossTileIDs[oe];if(this.keys[oe]===D&&!m.has(ie)){m.add(ie),M.crossTileID=ie;break}}}}}class Qs{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class rc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const c=Math.round((n-this.lng)/360);if(c!==0)for(const m in this.indexes){const v=this.indexes[m],w={};for(const S in v){const C=v[S];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+c),w[C.tileID.key]=C}this.indexes[m]=w}this.lng=n}addBucket(n,c,m){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let w=0;w<c.symbolInstances.length;w++)c.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const v=this.usedCrossTileIDs[n.overscaledZ];for(const w in this.indexes){const S=this.indexes[w];if(Number(w)>n.overscaledZ)for(const C in S){const j=S[C];j.tileID.isChildOf(n)&&j.findMatches(c.symbolInstances,n,v)}else{const C=S[n.scaledTo(Number(w)).key];C&&C.findMatches(c.symbolInstances,n,v)}}for(let w=0;w<c.symbolInstances.length;w++){const S=c.symbolInstances.get(w);S.crossTileID||(S.crossTileID=m.generate(),v.add(S.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new lh(n,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(n,c){for(const m of c.crossTileIDs)this.usedCrossTileIDs[n].delete(m)}removeStaleBuckets(n){let c=!1;for(const m in this.indexes){const v=this.indexes[m];for(const w in v)n[v[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,v[w]),delete v[w],c=!0)}return c}}class Rc{constructor(){this.layerIndexes={},this.crossTileIDs=new Qs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,c,m,v){let w=this.layerIndexes[n.fqid];w===void 0&&(w=this.layerIndexes[n.fqid]=new rc);let S=!1;const C={};v.name!=="globe"&&w.handleWrapJump(m);for(const j of c){const M=j.getBucket(n);M&&n.fqid===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(j.tileID,M,this.crossTileIDs)&&(S=!0),C[M.bucketInstanceId]=!0)}return w.removeStaleBuckets(C)&&(S=!0),S}pruneUnusedLayers(n){const c={};n.forEach(m=>{c[m]=!0});for(const m in this.layerIndexes)c[m]||delete this.layerIndexes[m]}}const gs=771;class un{constructor(n,c,m,v){this.blendFunction=n,this.blendColor=c.toNonPremultipliedRenderColor(null),this.mask=m,this.blendEquation=v}}un.Replace=[1,0,1,0],un.disabled=new un(un.Replace,o.ao.transparent,[!1,!1,!1,!1]),un.unblended=new un(un.Replace,o.ao.transparent,[!0,!0,!0,!0]),un.alphaBlended=new un([1,gs,1,gs],o.ao.transparent,[!0,!0,!0,!0]),un.alphaBlendedNonPremultiplied=new un([770,gs,770,gs],o.ao.transparent,[!0,!0,!0,!0]),un.multiply=new un([774,0,774,0],o.ao.transparent,[!0,!0,!0,!0]),un.additive=new un([1,1,1,1],o.ao.transparent,[!0,!0,!0,!0]);class hr{constructor(n,c,m){this.func=n,this.mask=c,this.range=m}}hr.ReadOnly=!1,hr.ReadWrite=!0,hr.disabled=new hr(519,hr.ReadOnly,[0,1]);const dd=7680;class Kr{constructor(n,c,m,v,w,S){this.test=n,this.ref=c,this.mask=m,this.fail=v,this.depthFail=w,this.pass=S}}Kr.disabled=new Kr({func:519,mask:0},0,0,dd,dd,dd);const ch=1029,Qm=2305;class qr{constructor(n,c,m){this.enable=n,this.mode=c,this.frontFace=m}}function bp(p,n){const c=o.c9(p,3);o.cb(p,n),o.cf(p,3,c)}function eg(p,n){const c=o.c6([]);return o.c7(c,c,-n),o.c8(c,c,-p),c}function Xb(p,n){const c=[p[0],p[1],0],m=[n[0],n[1],0];if(o.ag(c)>=1e-15){const S=o.aw([],c);o.c4(m,S,o.bI(m,S)),n[0]=m[0],n[1]=m[1]}const v=o.bH([],n,p);if(o.c5(v)<1e-15)return null;const w=Math.atan2(-v[1],v[0]);return eg(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),w)}qr.disabled=new qr(!1,ch,Qm),qr.backCCW=new qr(!0,ch,Qm),qr.backCW=new qr(!0,ch,2304),qr.frontCW=new qr(!0,1028,2304),qr.frontCCW=new qr(!0,1028,Qm);class nc{constructor(n,c){this.position=n,this.orientation=c}get position(){return this._position}set position(n){if(n){const c=n instanceof o.ae?n:new o.ae(n[0],n[1],n[2]);this._renderWorldCopies&&(c.x=o.bS(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(n,c,m){if(this.orientation=null,!this.position)return;const v=this.position,w=m||(this._elevation?this._elevation.getAtPointOrZero(o.ae.fromLngLat(n)):0),S=o.ae.fromLngLat(n,w),C=[S.x-v.x,S.y-v.y,S.z-v.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=Xb(C,c)}setPitchBearing(n,c){this.orientation=eg(o.an(n),o.an(-c))}}class tg{constructor(n,c){this._transform=o.bz([]),this.orientation=c,this.position=n}get mercatorPosition(){const n=this.position;return new o.ae(n[0],n[1],n[2])}get position(){const n=o.c9(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var c;n&&o.cf(this._transform,3,[(c=n)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||o.c6([]),n&&bp(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,c){this._orientation=eg(n,c),bp(this._transform,this._orientation)}forward(){const n=o.c9(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=o.c9(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=o.c9(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,c){const m=new Float64Array(16);return o.bk(m,this.getWorldToCamera(n,c)),m}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(n,c,m){const v=this.position;o.c4(v,v,-n);const w=new Float64Array(16);return o.bp(w,[m,m,m]),o.bq(w,w,v),w[10]*=c,w}getWorldToCamera(n,c){const m=new Float64Array(16),v=new Float64Array(4),w=this.position;return o.ca(v,this._orientation),o.c4(w,w,-n),o.cb(m,v),o.bq(m,m,w),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=c,m[9]*=c,m[10]*=c,m[11]*=c,m}getCameraToClipPerspective(n,c,m,v){const w=new Float64Array(16);return o.cc(w,n,c,m,v),w}getCameraToClipOrthographic(n,c,m,v,w,S){const C=new Float64Array(16);return o.cd(C,n,c,m,v,w,S),C}getDistanceToElevation(n,c=!1){const m=n===0?0:o.ce(n,c?o.a_(this.position[1]):this.position[1]),v=this.forward();return(m-this.position[2])/v[2]}clone(){return new tg([...this.position],[...this.orientation])}}const po={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Uo{constructor(n=0,c=0,m=0,v=0){if(isNaN(n)||n<0||isNaN(c)||c<0||isNaN(m)||m<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=c,this.left=m,this.right=v}interpolate(n,c,m){return c.top!=null&&n.top!=null&&(this.top=o.ak(n.top,c.top,m)),c.bottom!=null&&n.bottom!=null&&(this.bottom=o.ak(n.bottom,c.bottom,m)),c.left!=null&&n.left!=null&&(this.left=o.ak(n.left,c.left,m)),c.right!=null&&n.right!=null&&(this.right=o.ak(n.right,c.right,m)),this}getCenter(n,c){const m=o.aA((this.left+n-this.right)/2,0,n),v=o.aA((this.top+c-this.bottom)/2,0,c);return new o.P(m,v)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new Uo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const hd=15;class uh{constructor(n,c,m,v,w,S,C){this.tileSize=512,this._renderWorldCopies=w===void 0||w,this._minZoom=n||0,this._maxZoom=c||22,this._minPitch=m??0,this._maxPitch=v??60,this.setProjection(S),this.setMaxBounds(C),this.width=0,this.height=0,this._center=new o.aS(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Uo,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new tg,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const n=new uh(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n._allowWorldUnderZoom=this._allowWorldUnderZoom,n}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<hd}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(n,c=!1){const m=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||m)&&this._updateCameraOnTerrain(),(n||m)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return o.aH(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=o.cl(this.projectionOptions);const m=this.getProjection(),v=!o.bx(c,m);return v&&this._calcMatrices(),this.mercatorFromTransition=!1,v}setOrthographicProjectionAtLowPitch(n){return this._orthographicProjectionAtLowPitch!==n&&(this._orthographicProjectionAtLowPitch=n,this._calcMatrices(),!0)}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.cl({name:"mercator"});const c=n!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.bS(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const c=-n*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=o.cm(),o.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const c=o.aA(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=o.an(n),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const c=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(n){this._tileCoverLift!==n&&(this._tileCoverLift=n)}_updateCameraOnTerrain(){const n=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,c=this.elevation&&n===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||n===Number.NEGATIVE_INFINITY&&(!c||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const m=this._elevation;c||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&m.exaggeration()&&this._centerAltitudeValidForExaggeration!==m.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*m.exaggeration(),this._centerAltitudeValidForExaggeration=m.exaggeration()):(this._centerAltitude=n||0,this._centerAltitudeValidForExaggeration=m.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const n=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(n)}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let v=0,w=0;for(let S=0;S<c.length;S++){const C=new o.P(c[S][0]*this.width,m+c[S][1]*(this.height-m)),j=n.pointCoordinate(C);if(!j)continue;const M=1/Math.hypot(j[0]-this._camera.position[0],j[1]-this._camera.position[1]);v+=j[3]*M,w+=M}return w===0?NaN:v/w}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*c,v=this._mercatorZfromZoom(n),w=this._mercatorZfromZoom(this._maxZoom),S=Math.max(v-m,w);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let m;m=n.z<this._camera.position[2]?[c.x,c.y,c.z]:[n.x,n.y,n.z];const v=o.ag(o.av([],this._camera.position,m));return o.aA(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let c=!1;if(n.orientation&&!o.co(n.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(n.orientation)),n.position){const m=[n.position.x,n.position.y,n.position.z];o.cp(m,this._camera.position)||(this._setCameraPosition(m),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,c=new nc;return c.position=new o.ae(n[0],n[1],n[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(n){if(!o.cq(n))return!1;o.cr(n,n);const c=o.cs([],[0,0,-1],n),m=o.cs([],[0,-1,0],n);if(m[2]<0)return!1;const v=Xb(c,m);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(n){const c=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;n[2]=o.aA(n[2],v/m,v/c),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,c,m){this._unmodified=!1,this._edgeInsets.interpolate(n,c,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const c=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(n){const c=[new o.ct(0,n)];if(this.renderWorldCopies){const m=this.pointCoordinate(new o.P(0,0)),v=this.pointCoordinate(new o.P(this.width,0)),w=this.pointCoordinate(new o.P(this.width,this.height)),S=this.pointCoordinate(new o.P(0,this.height)),C=Math.floor(Math.min(m.x,v.x,w.x,S.x)),j=Math.floor(Math.max(m.x,v.x,w.x,S.x)),M=1;for(let D=C-M;D<=j+M;D++)D!==0&&c.push(new o.ct(D,n))}return c}isLODDisabled(n){return(!n||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(n,c,m){let v=[];const w=m!=null,S=!w;if(S&&this.zoom<c||w&&m[0]===0&&m[1]===0)return v;const C=new Set,j=(D,B,O,G,X)=>{const ee=o.cX(B,D,O,G,X);C.has(ee)||(v.push(new o.aP(D,B,O,G,X)),C.add(ee))};for(let D=0;D<n.length;D++){const B=n[D];if(S&&B.canonical.z!==c)continue;const O=B.canonical,G=B.overscaledZ,X=B.wrap,ee=1<<O.z,oe=O.x+1<ee,ie=O.x>0,ce=O.y+1<ee,me=O.y>0,de=B.wrap-(ie?0:1),Ee=B.wrap+(oe?0:1),ge=ie?O.x-1:ee-1,je=oe?O.x+1:0;if(w)m[0]<0?(j(G,Ee,O.z,je,O.y),m[1]<0&&ce&&(j(G,X,O.z,O.x,O.y+1),j(G,Ee,O.z,je,O.y+1)),m[1]>0&&me&&(j(G,X,O.z,O.x,O.y-1),j(G,Ee,O.z,je,O.y-1))):m[0]>0?(j(G,de,O.z,ge,O.y),m[1]<0&&ce&&(j(G,X,O.z,O.x,O.y+1),j(G,de,O.z,ge,O.y+1)),m[1]>0&&me&&(j(G,X,O.z,O.x,O.y-1),j(G,de,O.z,ge,O.y-1))):m[1]<0&&ce?j(G,X,O.z,O.x,O.y+1):me&&j(G,X,O.z,O.x,O.y-1);else{const Se=B.visibleQuadrants;1&Se&&(j(G,de,O.z,ge,O.y),me&&(j(G,X,O.z,O.x,O.y-1),j(G,de,O.z,ge,O.y-1))),2&Se&&(j(G,Ee,O.z,je,O.y),me&&(j(G,X,O.z,O.x,O.y-1),j(G,Ee,O.z,je,O.y-1))),4&Se&&(j(G,de,O.z,ge,O.y),ce&&(j(G,X,O.z,O.x,O.y+1),j(G,de,O.z,ge,O.y+1))),8&Se&&(j(G,Ee,O.z,je,O.y),ce&&(j(G,X,O.z,O.x,O.y+1),j(G,Ee,O.z,je,O.y+1)))}}const M=[];for(const D of v)v.some(B=>D.isChildOf(B))||M.push(D);if(v=M.filter(D=>!n.some(B=>!!(D.overscaledZ<c&&B.isChildOf(D))||D.equals(B)||D.isChildOf(B))),S){const D=1<<c,B=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),O=[D*B.x,D*B.y],G=4,X=G*G;v=v.filter(ee=>{const oe=ee.canonical.x+.5-O[0],ie=ee.canonical.y+.5-O[1];return oe*oe+ie*ie<X})}return v}extendTileCoverToNearPlane(n,c,m){const v=[],w=new Set;for(const ce of n)w.add(ce.key);const S=(ce,me,de,Ee,ge)=>{const je=o.cX(me,ce,de,Ee,ge);w.has(je)||(v.push(new o.aP(ce,me,de,Ee,ge)),w.add(je))},C=n.reduce((ce,me)=>Math.max(ce,me.overscaledZ),m),j=1<<m,M=[new o.P(0,0),new o.P(o.al,0),new o.P(o.al,o.al),new o.P(0,o.al)],D=new o.P(0,0),B=new o.P(0,0),O=(ce,me)=>{const de=Math.floor(ce[0]),Ee=Math.floor(ce[1]),ge=(ce[0]-de)*o.al,je=(ce[1]-Ee)*o.al,Se=Math.floor(me[0]),ve=Math.floor(me[1]),Ie=(me[0]-Se)*o.al,$e=(me[1]-ve)*o.al;for(let Fe=-1;Fe<=1;Fe++){const at=de+Fe;if(!(at<0||at>=j)){D.x=ge-Fe*o.al,B.x=Ie-(at-Se)*o.al;for(let Qe=-1;Qe<=1;Qe++){const pt=Ee+Qe;D.y=je-Qe*o.al,B.y=$e-(pt-ve)*o.al,o.cY(D,B,M)&&S(C,0,m,at,pt)}}}},G=c.points,X=G[o.cu],ee=G[o.cv],oe=this._projectToGround(X,G[o.cw]),ie=this._projectToGround(ee,G[o.cx]);return O(X,oe),O(ee,ie),v}_projectToGround(n,c){return o.cy(o.cz(),n,c,n[2]/(n[2]-c[2]))}coveringTiles(n){let c=this.coveringZoomLevel(n);const m=c,v=this.elevation&&this.elevation.exaggeration(),w=v&&!n.isTerrainDEM,S=this.projection.name==="mercator";if(n.minzoom!==void 0&&c<n.minzoom)return[];n.maxzoom!==void 0&&c>n.maxzoom&&(c=n.maxzoom);const C=this.locationCoordinate(this.center),j=this.center.lat,M=1<<c,D=[M*C.x,M*C.y,0],B=this.projection.name==="globe",O=!B,G=o.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,O),X=B?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ee=M*o.ce(1,this.center.lat),oe=this._camera.position[2]/o.ce(1,this.center.lat),ie=[M*X.x,M*X.y,oe*(O?1:ee)],ce=B||v,me=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),de=this.isLODDisabled(!0)?c:0;let Ee;if(this._elevation&&n.isTerrainDEM)Ee=1e4*this._elevation.exaggeration();else if(this._elevation){const Oe=this._elevation.getMinMaxForVisibleTiles();Ee=Oe?Oe.max:this._centerAltitude}else Ee=this._centerAltitude;const ge=n.isTerrainDEM?-Ee:this._elevation?this._elevation.getMinElevationBelowMSL():0,je=this.projection.isReprojectedInTileSpace?o.cB(this):1,Se=Oe=>{const et=new o.ae(Oe.x+25e-6,Oe.y,Oe.z),Et=new o.ae(Oe.x,Oe.y+25e-6,Oe.z),$t=Oe.toLngLat(),lr=et.toLngLat(),Mt=Et.toLngLat(),zt=this.locationCoordinate($t),ur=this.locationCoordinate(lr),nr=this.locationCoordinate(Mt),er=Math.hypot(ur.x-zt.x,ur.y-zt.y),ir=Math.hypot(nr.x-zt.x,nr.y-zt.y);return Math.sqrt(er*ir)*je/25e-6},ve=Oe=>{const mt=Ee,et=ge;return{aabb:o.cE(this,M,0,0,0,Oe,et,mt,this.projection),zoom:0,x:0,y:0,minZ:et,maxZ:mt,wrap:Oe,fullyVisible:!1}},Ie=[];let $e=[];const Fe=c,at=n.reparseOverscaled?m:c,Qe=(oe-this._centerAltitude)*ee,pt=Oe=>{if(!this._elevation||!Oe.tileID||!S)return;const mt=this._elevation.getMinMaxForTile(Oe.tileID),et=Oe.aabb;mt?(et.min[2]=mt.min,et.max[2]=mt.max,et.center[2]=(et.min[2]+et.max[2])/2):(Oe.shouldSplit=Ye(Oe),Oe.shouldSplit||(et.min[2]=et.max[2]=et.center[2]=this._centerAltitude))},Ot=(Oe,mt)=>{if(.707*mt<Oe)return 1;const et=mt/Oe;return et/(1.4144271570014144+(Math.pow(1.1,et-1.4144271570014144+1)-1)/(1.1-1)-1)},Ye=Oe=>{if(Oe.zoom<de)return!0;if(Oe.zoom===Fe)return!1;if(Oe.shouldSplit!=null)return Oe.shouldSplit;const mt=Oe.aabb.distanceX(ie),et=Oe.aabb.distanceY(ie);let Et=Qe,$t=1;if(B){Et=Oe.aabb.distanceZ(ie);const ir=Math.pow(2,Oe.zoom),kr=o.a_((Oe.y+1)/ir),xn=o.a_(Oe.y/ir),Mn=Math.min(Math.max(j,kr),xn),fi=o.d0(Mn)/o.d0(j);if($t=Mn===j?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,fi/this._mercatorScaleRatio),this.zoom<=o.cZ&&Oe.zoom===Fe-1&&fi>=.9)return!0}else if(w&&(Et=Oe.aabb.distanceZ(ie)*ee),this.projection.isReprojectedInTileSpace&&m<=5){const ir=Math.pow(2,Oe.zoom),kr=Se(new o.ae((Oe.x+.5)/ir,(Oe.y+.5)/ir));$t=kr>.85?1:kr}if(!S&&!B){const ir=Math.sqrt(mt*mt+et*et+Et*Et);let kr=(1<<Fe-Oe.zoom)*me*$t;return kr*=Ot(Math.max(Et,Qe),ir),ir<kr}let lr=Number.MAX_VALUE,Mt=0;const zt=Oe.aabb.getCorners(),ur=[];for(const ir of zt){o.av(ur,ir,ie),B||(w?ur[2]*=ee:ur[2]=Qe);const kr=o.bI(ur,this._camera.forward());kr<lr&&(lr=kr,Mt=Math.abs(ur[2]))}let nr=(1<<Fe-Oe.zoom)*me*$t;if(nr*=Ot(Math.max(Mt,Qe),lr),lr<nr)return!0;const er=Oe.aabb.closestPoint(D);return er[0]===D[0]&&er[1]===D[1]};if(this.renderWorldCopies)for(let Oe=1;Oe<=3;Oe++)Ie.push(ve(-Oe)),Ie.push(ve(Oe));for(Ie.push(ve(0));Ie.length>0;){const Oe=Ie.pop(),mt=Oe.x,et=Oe.y;let Et=Oe.fullyVisible;const $t=()=>this.projection.name==="globe"&&(Oe.y===0||Oe.y===(1<<Oe.zoom)-1);if(!Et){let lr=ce?Oe.aabb.intersects(G):Oe.aabb.intersectsFlat(G);if(lr===0&&$t()){const Mt=new o.cC(Oe.zoom,mt,et);lr=o.cD(this,M,Mt,!0).intersects(G)}if(lr===0)continue;Et=lr===2}if(Oe.zoom!==Fe&&Ye(Oe))for(let lr=0;lr<4;lr++){const Mt=(mt<<1)+lr%2,zt=(et<<1)+(lr>>1),ur={aabb:S?Oe.aabb.quadrant(lr):o.cE(this,M,Oe.zoom+1,Mt,zt,Oe.wrap,Oe.minZ,Oe.maxZ,this.projection),zoom:Oe.zoom+1,x:Mt,y:zt,wrap:Oe.wrap,fullyVisible:Et,tileID:void 0,shouldSplit:void 0,minZ:Oe.minZ,maxZ:Oe.maxZ};w&&!B&&(ur.tileID=new o.aP(Oe.zoom+1===Fe?at:Oe.zoom+1,Oe.wrap,Oe.zoom+1,Mt,zt),pt(ur)),Ie.push(ur)}else{const lr=Oe.zoom===Fe?at:Oe.zoom;if(n.minzoom&&n.minzoom>lr)continue;let Mt=0;if(!Et){let er=ce?Oe.aabb.intersectsPrecise(G):Oe.aabb.intersectsPreciseFlat(G);if(er===0&&$t()){const ir=new o.cC(Oe.zoom,mt,et);er=o.cD(this,M,ir,!0).intersectsPrecise(G)}if(er===0)continue;if(n.calculateQuadrantVisibility)if(G.containsPoint(Oe.aabb.center))Mt=15;else for(let ir=0;ir<4;ir++)Oe.aabb.quadrant(ir).intersects(G)!==0&&(Mt|=1<<ir)}const zt=D[0]-(.5+mt+(Oe.wrap<<Oe.zoom))*(1<<c-Oe.zoom),ur=D[1]-.5-et,nr=Oe.tileID?Oe.tileID:new o.aP(lr,Oe.wrap,Oe.zoom,mt,et);n.calculateQuadrantVisibility&&(nr.visibleQuadrants=Mt),$e.push({tileID:nr,distanceSq:zt*zt+ur*ur})}}if(this.fogCullDistSq){const Oe=this.fogCullDistSq,mt=this.horizonLineFromTop();$e=$e.filter(et=>{const Et=[0,0,0,1],$t=[o.al,o.al,0,1],lr=this.calculateFogTileMatrix(et.tileID.toUnwrapped());o.aC(Et,Et,lr),o.aC($t,$t,lr);const Mt=o.cF([],Et,$t),zt=o.cG([],Et,$t),ur=o.c_(Mt,zt);if(ur===0)return!0;let nr=!1;const er=this._elevation;if(er&&ur>Oe&&mt!==0){const ir=this.calculateProjMatrix(et.tileID.toUnwrapped());let kr;n.isTerrainDEM||(kr=er.getMinMaxForTile(et.tileID)),kr||(kr={min:ge,max:Ee});const xn=o.cH(this.rotation),Mn=[xn[0]*o.al,xn[1]*o.al,kr.max];o.af(Mn,Mn,ir),nr=(1-Mn[1])*this.height*.5<mt}return ur<Oe||nr})}return $e.sort((Oe,mt)=>Oe.distanceSq-mt.distanceSq).map(Oe=>Oe.tileID)}resize(n,c){this.width=n,this.height=c,this.pixelsToGLUnits=[2/n,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log2(n)}project(n){const c=o.aA(n.lat,-o.cI,o.cI),m=this.projection.project(n.lng,c);return new o.P(m.x*this.worldSize,m.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,c){let m,v;const w=this.centerPoint;if(this.projection.name==="globe"){const C=this.worldSize;m=(c.x-w.x)/C,v=(c.y-w.y)/C}else{const C=this.pointCoordinate(c),j=this.pointCoordinate(w);m=C.x-j.x,v=C.y-j.y}const S=this.locationCoordinate(n);this.setLocation(new o.ae(S.x-m,S.y-v))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n,c){return this.projection.locationPoint(this,n,c)}locationPoint3D(n,c){return this.projection.locationPoint(this,n,c,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n,c){return this.coordinateLocation(this.pointCoordinate3D(n,c))}locationCoordinate(n,c){const m=c?o.ce(c,n.lat):void 0,v=this.projection.project(n.lng,n.lat);return new o.ae(v.x,v.y,m)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,c){const m=c??this._centerAltitude,v=[n.x,n.y,0,1],w=[n.x,n.y,1,1];o.aC(v,v,this.pixelMatrixInverse),o.aC(w,w,this.pixelMatrixInverse);const S=w[3];o.cJ(v,v,1/v[3]),o.cJ(w,w,1/S);const C=v[2],j=w[2];return{p0:v,p1:w,t:C===j?0:(m-C)/(j-C)}}screenPointToMercatorRay(n){const c=[n.x,n.y,0,1],m=[n.x,n.y,1,1];return o.aC(c,c,this.pixelMatrixInverse),o.aC(m,m,this.pixelMatrixInverse),o.cJ(c,c,1/c[3]),o.cJ(m,m,1/m[3]),c[2]=o.ce(c[2],this._center.lat)*this.worldSize,m[2]=o.ce(m[2],this._center.lat)*this.worldSize,o.cJ(c,c,1/this.worldSize),o.cJ(m,m,1/this.worldSize),new o.ax([c[0],c[1],c[2]],o.aw([],o.av([],m,c)))}rayIntersectionCoordinate(n){const{p0:c,p1:m,t:v}=n,w=o.ce(c[2],this._center.lat),S=o.ce(m[2],this._center.lat);return new o.ae(o.ak(c[0],m[0],v)/this.worldSize,o.ak(c[1],m[1],v)/this.worldSize,o.ak(w,S,v))}pointCoordinate(n,c=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,c)}pointCoordinate3D(n,c){if(!this.elevation)return this.pointCoordinate(n,c);let m=this.projection.pointCoordinate3D(this,n.x,n.y);if(m)return new o.ae(m[0],m[1],m[2]);let v=0,w=this.horizonLineFromTop();if(n.y>w)return this.pointCoordinate(n,c);const S=.02*w,C=n.clone();for(let j=0;j<10&&w-v>S;j++){C.y=o.ak(v,w,.66);const M=this.projection.pointCoordinate3D(this,C.x,C.y);M?(w=C.y,m=M):v=C.y}return m?new o.ae(m[0],m[1],m[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=o.cK)return!this.isPointAboveHorizon(n);const c=this.pointCoordinate(n);return c.y>=0&&c.y<=1}_coordinatePoint(n,c){const m=c&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,v=[n.x*this.worldSize,n.y*this.worldSize,m+n.toAltitude(),1];return o.aC(v,v,this.pixelMatrix),v[3]>0?new o.P(v[0]/v[3],v[1]/v[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:c}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,w=this.pointLocation3D(new o.P(c,n)),S=this.pointLocation3D(new o.P(v,n)),C=this.pointLocation3D(new o.P(v,m)),j=this.pointLocation3D(new o.P(c,m));let M=Math.min(w.lng,S.lng,C.lng,j.lng),D=Math.max(w.lng,S.lng,C.lng,j.lng),B=Math.min(w.lat,S.lat,C.lat,j.lat),O=Math.max(w.lat,S.lat,C.lat,j.lat);const G=Math.pow(2,-this.zoom)/16*270,X=this.projection.name==="globe"?1:4,ee=(oe,ie,ce,me,de)=>{const Ee=(oe+ce)/2,ge=(ie+me)/2,je=new o.P(Ee,ge),{lng:Se,lat:ve}=this.pointLocation3D(je),Ie=Math.max(0,M-Se,B-ve,Se-D,ve-O);M=Math.min(M,Se),D=Math.max(D,Se),B=Math.min(B,ve),O=Math.max(O,ve),(de<X||Ie>G)&&(ee(oe,ie,Ee,ge,de+1),ee(Ee,ge,ce,me,de+1))};if(ee(c,n,v,n,1),ee(v,n,v,m,1),ee(v,m,c,m,1),ee(c,m,c,n,1),this.projection.name==="globe"){const[oe,ie]=o.cL(this);oe?(O=90,D=180,M=-180):ie&&(B=-90,D=180,M=-180)}return new o.aI(new o.aS(M,B),new o.aS(D,O))}_getBoundsRectangular(n,c){const{top:m,left:v}=this._edgeInsets,w=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,C=new o.P(v,m),j=new o.P(S,m),M=new o.P(S,w),D=new o.P(v,w);let B=this.pointCoordinate(C,n),O=this.pointCoordinate(j,n);const G=this.pointCoordinate(M,c),X=this.pointCoordinate(D,c),ee=(oe,ie)=>(ie.y-oe.y)/(ie.x-oe.x);return B.y>1&&O.y>=0?B=new o.ae((1-X.y)/ee(X,B)+X.x,1):B.y<0&&O.y<=1&&(B=new o.ae(-X.y/ee(X,B)+X.x,0)),O.y>1&&B.y>=0?O=new o.ae((1-G.y)/ee(G,O)+G.x,1):O.y<0&&B.y<=1&&(O=new o.ae(-G.y/ee(G,O)+G.x,0)),new o.aI().extend(this.coordinateLocation(B)).extend(this.coordinateLocation(O)).extend(this.coordinateLocation(X)).extend(this.coordinateLocation(G))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=n.visibleDemTiles.reduce((m,v)=>{if(v.dem){const w=v.dem.tree;m.min=Math.min(m.min,w.minimums[0]),m.max=Math.max(m.max,w.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*n.exaggeration(),c.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,m=this.height/2-c*(1-this._horizonShift);return n?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-o.cI,this.maxLat=o.cI,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.aF(this.minLng)*this.tileSize,this.worldMaxX=o.aF(this.maxLng)*this.tileSize,this.worldMinY=o.aJ(this.maxLat)*this.tileSize,this.worldMaxY=o.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,c){return this.projection.createTileMatrix(this,c,n)}calculateDistanceTileData(n){const c=n.key,m=this._distanceTileDataCache;if(m[c])return m[c];const v=n.canonical,w=1/this.height,S=this.cameraWorldSize,C=S/this.zoomScale(v.z),j=(v.x+Math.pow(2,v.z)*n.wrap)*C,M=v.y*C,D=this.point;D.x*=S/this.worldSize,D.y*=S/this.worldSize;const B=this.angle,O=Math.sin(-B),G=-Math.cos(-B);return m[c]={bearing:[O,G],center:[(D.x-j)*w,(D.y-M)*w],scale:C/o.al*w},m[c]}calculateFogTileMatrix(n){const c=n.key,m=this._fogTileMatrixCache;if(m[c])return m[c];const v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return o.aB(v,this.worldToFogMatrix,v),m[c]=new Float32Array(v),m[c]}calculateProjMatrix(n,c=!1,m=!1){const v=n.key;let w;if(w=m?this._expandedProjMatrixCache:c?this._alignedProjMatrixCache:this._projMatrixCache,w[v])return w[v];const S=this.calculatePosMatrix(n,this.worldSize);let C;return C=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:m?this.expandedFarZProjMatrix:c?this.alignedProjMatrix:this.projMatrix,o.aB(S,C,S),w[v]=new Float32Array(S),w[v]}calculatePixelsToTileUnitsMatrix(n){const c=n.tileID.key,m=this._pixelsToTileUnitsCache;if(m[c])return m[c];const v=o.cM(n,this);return m[c]=v,m[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,c=o.bp([],[n,n,n]);return o.aB(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const c=o.ce(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(c),v=this._camera.forward(),w=o.ce(1,this._center.lat);m[2]/=w,v[2]/=w,o.aw(v,v);const S=n.raycast(m,v,n.exaggeration());if(S){const C=o.bG([],m,v,S),j=new o.ae(C[0],C[1],o.ce(C[2],o.a_(C[1]))),M=(j.z+o.ag([j.x-m[0],j.y-m[1],j.z-m[2]*w]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(M),this._centerAltitude=j.toAltitude(),this._center=this.coordinateLocation(j),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const c=this._elevation,m=o.ce(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(m),w=c.getAtPointOrZero(new o.ae(...v)),S=this.pixelsPerMeter/this.worldSize*w,C=this._minimumHeightOverTerrain(),j=v[2]-S;if(j<=C)if(j<0||n){const M=this.locationCoordinate(this._center,this._centerAltitude),D=[v[0],v[1],M.z-v[2]],B=o.ag(D);D[2]-=(C-j)/this._pixelsPerMercatorPixel;const O=o.ag(D);if(O===0)return;o.c4(D,D,B/O*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],M.z*this._pixelsPerMercatorPixel-D[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const O=this.center;return O.lat=o.aA(O.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(O.lng=o.aA(O.lng,this.minLng,this.maxLng)),this.center=O,void(this._constraining=!1)}const c=this._unmodified,{x:m,y:v}=this.point;let w=0,S=m,C=v;const j=this.width/2,M=this.height/2,D=this.worldMinY*this.scale,B=this.worldMaxY*this.scale;if(v-M<D&&(C=D+M),v+M>B&&(C=B-M),B-D<this.height&&(w=Math.max(w,this.height/(B-D)),C=(B+D)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const O=this.worldMinX*this.scale,G=this.worldMaxX*this.scale,X=this.worldSize/2-(O+G)/2;S=(m+X+this.worldSize)%this.worldSize-X,S-j<O&&(S=O+j),S+j>G&&(S=G-j),G-O<this.width&&(w=Math.max(w,this.width/(G-O)),S=(G+O)/2)}S===m&&C===v||this._allowWorldUnderZoom||(this.center=this.unproject(new o.P(S,C))),w&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(w)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,c=this.projection.name==="globe",m=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.ce(1,this.center.lat)/o.ce(1,o.d1));const v=o.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w=this.projection.zAxisUnit==="meters"?m:1,S=this._camera.getWorldToCamera(this.worldSize,w);let C;const j=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(j[8]=2*-n.x/this.width,j[9]=2*n.y/this.height,this.isOrthographic){let ve=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ie=ve*this.aspect,$e=-Ie,Fe=-ve;Ie-=n.x,$e-=n.x,ve+=n.y,Fe+=n.y,C=this._camera.getCameraToClipOrthographic($e,Ie,Fe,ve,this._nearZ,this._farZ),((at,Qe,pt,Ot)=>{for(let Ye=0;Ye<16;Ye++)at[Ye]=o.ak(Qe[Ye],pt[Ye],Ot)})(C,C,j,o.c$(this.pitch>=hd?1:this.pitch/hd))}else C=j;const M=o.cO([],j,S);let D=o.cO([],C,S);if(this.projection.isReprojectedInTileSpace){const ve=this.locationCoordinate(this.center),Ie=o.bz([]);o.bq(Ie,Ie,[ve.x*this.worldSize,ve.y*this.worldSize,0]),o.aB(Ie,Ie,o.cP(this)),o.bq(Ie,Ie,[-ve.x*this.worldSize,-ve.y*this.worldSize,0]),o.aB(D,D,Ie),o.aB(M,M,Ie),this.inverseAdjustmentMatrix=o.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.cR([],D,[this.worldSize,this.worldSize,this.worldSize/w,1]),this.projMatrix=D,this.invProjMatrix=o.bk(new Float64Array(16),this.projMatrix),c){const ve=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ve[8]=2*-n.x/this.width,ve[9]=2*n.y/this.height,this.expandedFarZProjMatrix=o.cO([],ve,S)}else this.expandedFarZProjMatrix=this.projMatrix;const B=o.bk([],C);this.frustumCorners=o.cS.fromInvProjectionMatrix(B,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!c);const O=new Float32Array(16);o.bz(O),o.cR(O,O,[1,-1,1]),o.cT(O,O,this._pitch),o.bA(O,O,this.angle);const G=o.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.by(G);const X=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;G[8]=2*-n.x/this.width,G[9]=2*(n.y+X)/this.height,this.skyboxMatrix=o.aB(O,G,O);const ee=this.point,oe=ee.x,ie=ee.y,ce=this.width%2/2,me=this.height%2/2,de=Math.cos(this.angle),Ee=Math.sin(this.angle),ge=oe-Math.round(oe)+de*ce+Ee*me,je=ie-Math.round(ie)+de*me+Ee*ce,Se=new Float64Array(D);if(o.bq(Se,Se,[ge>.5?ge-1:ge,je>.5?je-1:je,0]),this.alignedProjMatrix=Se,D=o.bB(),o.cR(D,D,[this.width/2,-this.height/2,1]),o.bq(D,D,[1,-1,0]),this.labelPlaneMatrix=D,D=o.bB(),o.cR(D,D,[1,-1,1]),o.bq(D,D,[-1,-1,0]),o.cR(D,D,[2/this.width,2/this.height,1]),this.glCoordMatrix=D,this.pixelMatrix=o.aB(new Float64Array(16),this.labelPlaneMatrix,M),this._calcFogMatrices(),this._distanceTileDataCache={},D=o.bk(new Float64Array(16),this.pixelMatrix),!D)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=D,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.cU(this);const ve=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.af(ve,ve,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=D;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,m=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,w=[n,n,c];o.c4(w,w,v),o.c4(m,m,-1),o.cV(m,m,w);const S=o.bB();o.bq(S,S,m),o.cR(S,S,w),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,c,v)}_computeCameraPosition(n){const c=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),v=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-n/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-m[0]*w,v.y/this.worldSize-m[1]*w,n/this.worldSize*this._centerAltitude-m[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=this._camera.position[2],v=n[2];let w=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(w=Math.min((c-m)/v,1)),this._camera.position=o.bG([],this._camera.position,n,w),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,c=this._camera.forward(),{pitch:m,bearing:v}=this._camera.getPitchBearing(),w=o.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.an(this._maxPitch)),C=Math.max((n[2]-w)/Math.cos(m),S),j=this._zoomFromMercatorZ(C);o.bG(n,n,c,C),this._pitch=o.aA(m,o.an(this.minPitch),o.an(this.maxPitch)),this.angle=o.bS(v,-Math.PI,Math.PI),this._setZoom(o.aA(j,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.ae(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,n)*this.tileSize))}zoomFromMercatorZAdjusted(n){let c=0,m=o.cK,v=0,w=1/0;for(;m-c>1e-6&&m>c;){const S=c+.5*(m-c),C=this.tileSize*Math.pow(2,S),j=this.getCameraToCenterDistance(this.projection,S,C),M=this.scaleZoom(j/(Math.max(0,n)*this.tileSize)),D=Math.abs(S-M);D<w&&(w=D,v=S),S<M?c=S:m=S}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,c){const m=Math.min(n.x,c.x),v=Math.max(n.x,c.x),w=Math.min(n.y,c.y),S=Math.max(n.y,c.y);if(w<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const C=[new o.P(m,w),new o.P(v,S),new o.P(m,S),new o.P(v,w)],j=this.renderWorldCopies?-3:0,M=this.renderWorldCopies?4:1;for(const D of C){const B=this.pointRayIntersection(D);if(B.t<0)return!0;const O=this.rayIntersectionCoordinate(B);if(O.x<j||O.y<0||O.x>M||O.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(n,c){const m=o.ag(o.av([],this._camera.position,n)),v=this._zoomFromMercatorZ(m)+c;return m-this._mercatorZfromZoom(v)}getCameraPoint(){if(this.projection.name==="globe"){const n=function([c,m,v],w){const S=[c,m,v,1];o.aC(S,S,w);const C=S[3]=Math.max(S[3],1e-6);return S[0]/=C,S[1]/=C,S[2]/=C,S}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,n))}}getCameraToCenterDistance(n,c=this.zoom,m=this.worldSize){const v=o.cN(n,c,this.width,this.height,1024),w=n.pixelSpaceConversion(this.center.lat,m,v);let S=.5/Math.tan(.5*this._fov)*this.height*w;return this.isOrthographic&&(S=o.ak(1,S,o.c$(this.pitch>=hd?1:this.pitch/hd))),S}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.aB(n,n,this.globeMatrix),n}getFrustum(n){return o.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,this.projection.zAxisUnit==="meters")}}const Mc=(p,n)=>{if(n>0&&p.terrain&&o.w("Cutoff is currently disabled on terrain"),n<=0||p.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const c=p.transform,m=Math.max(Math.abs(c._zoom-(p.minCutoffZoom-1)),1),v=c.isLODDisabled(!1)?o.ah(60,45,c.pitch):o.ah(30,15,c.pitch),w=c._farZ-c._nearZ,S=n*c.height,C=((1-(j=v))*c.cameraToCenterDistance+j*(c._farZ+S))*m;var j;return{shouldRenderCutoff:v<1,uniformValues:{u_cutoff_params:[c._nearZ,c._farZ,(C-c._nearZ)/w,(C-S-c._nearZ)/w]}}},mo={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class $2{constructor(n,c){this.aabb=n,this.lastCascade=c}}class q2{add(n,c){const m=this.receivers[n.key];m!==void 0?(m.aabb.min[0]=Math.min(m.aabb.min[0],c.min[0]),m.aabb.min[1]=Math.min(m.aabb.min[1],c.min[1]),m.aabb.min[2]=Math.min(m.aabb.min[2],c.min[2]),m.aabb.max[0]=Math.max(m.aabb.max[0],c.max[0]),m.aabb.max[1]=Math.max(m.aabb.max[1],c.max[1]),m.aabb.max[2]=Math.max(m.aabb.max[2],c.max[2])):this.receivers[n.key]=new $2(c,null)}clear(){this.receivers={}}get(n){return this.receivers[n.key]}computeRequiredCascades(n,c,m){const v=o.d8.fromPoints(n.points);let w=0;for(const S in this.receivers){const C=this.receivers[S];if(!C||!v.intersectsAabb(C.aabb))continue;C.aabb.min=v.closestPoint(C.aabb.min),C.aabb.max=v.closestPoint(C.aabb.max);const j=C.aabb.getCorners();for(let M=0;M<m.length;M++){let D=!0;for(const B of j){const O=[B[0]*c,B[1]*c,B[2]];if(o.af(O,O,m[M].matrix),O[0]<-1||O[0]>1||O[1]<-1||O[1]>1){D=!1;break}}if(C.lastCascade=M,w=Math.max(w,M),D)break}}return w+1}}class wp{constructor(n){this.painter=n,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new q2,this._depthMode=new hr(n.context.gl.LEQUAL,hr.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,n.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),n.tp.registerParameter(mo,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),n.tp.registerParameter(mo,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),n.tp.registerParameter(mo,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),n.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const n of this._cascades)n.texture.destroy(),n.framebuffer.destroy();this._cascades=[]}updateShadowParameters(n,c){const m=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!c||!c.properties)return;const v=c.properties.get("shadow-intensity");if(!c.shadowsEnabled()||v<=0||(this._shadowLayerCount=m.style.order.reduce((X,ee)=>{const oe=m.style._mergedLayers[ee];return X+(oe.hasShadowPass()&&!oe.isHidden(n.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const w=m.context,S=mo.shadowMapResolution,C=mo.shadowMapResolution;if(this._cascades.length===0||mo.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let X=0;X<mo.cascadeCount;++X){const ee=m._shadowMapDebug,oe=w.gl,ie=w.createFramebuffer(S,C,ee,"texture"),ce=new o.T(w,{width:S,height:C,data:null},oe.DEPTH_COMPONENT16);if(ie.depthAttachment.set(ce.texture),ee){const me=new o.T(w,{width:S,height:C,data:null},oe.RGBA8);ie.colorAttachment.set(me.texture)}this._cascades.push({framebuffer:ie,texture:ce,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.cA,scale:0})}}this.shadowDirection=Kb(c);let j=0;if(n.elevation){const X=n.elevation,ee=[1e4,-1e4];X.visibleDemTiles.filter(oe=>oe.dem).forEach(oe=>{const ie=oe.dem.tree;ee[0]=Math.min(ee[0],ie.minimums[0]),ee[1]=Math.max(ee[1],ie.maximums[0])}),ee[0]!==1e4&&(j=(ee[1]-ee[0])*X.exaggeration())}const M=1.5*n.cameraToCenterDistance,D=3*M,B=new Float64Array(16);for(let X=0;X<this._cascades.length;++X){const ee=this._cascades[X];let oe=n.height/50,ie=1;mo.cascadeCount===1?ie=D:X===0?ie=M:(oe=M,ie=D);const[ce,me]=Yb(n,this.shadowDirection,oe,ie,mo.shadowMapResolution,j);ee.scale=n.scale,ee.matrix=ce,ee.boundingSphereRadius=me,o.bk(B,ee.matrix),ee.frustum=o.cA.fromInvProjectionMatrix(B,1,0,!0),ee.far=ie}const O=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[O].far,this._cascades[O].far],this._uniformValues.u_shadow_intensity=v,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/mo.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=mo.shadowMapResolution,this._uniformValues.u_shadowmap_0=po.ShadowMap0,this._uniformValues.u_shadowmap_1=po.ShadowMap0+1,this._groundShadowTiles=m.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const G=m.transform.elevation;for(const X of this._groundShadowTiles){let ee={min:0,max:0};if(G){const oe=G.getMinMaxForTile(X);oe&&(ee=oe)}this.addShadowReceiver(X.toUnwrapped(),ee.min,ee.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(n){this._enabled=n}drawShadowPass(n,c){if(!this.enabled)return;const m=this.painter,v=m.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(m.transform.getFrustum(0),m.transform.worldSize,this._cascades),v.viewport.set([0,0,mo.shadowMapResolution,mo.shadowMapResolution]);for(let w=0;w<this._numCascadesToRender;++w){m.currentShadowCascade=w,v.bindFramebuffer.set(this._cascades[w].framebuffer.framebuffer),v.clear({color:o.ao.white,depth:1});for(const S of n.order){const C=n._mergedLayers[S];if(!C.hasShadowPass()||C.isHidden(m.transform.zoom))continue;const j=n.getLayerSourceCache(C),M=j?c[j.id]:void 0;(C.type==="model"||M&&M.length)&&m.renderLayer(m,j,C,M)}}m.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const n=this.painter,c=n.style,m=n.context,v=m.gl,w=c.directionalLight,S=c.ambientLight;if(!w||!S)return;const C=[],j=Mc(n,n.longestCutoffRange);j.shouldRenderCutoff&&C.push("RENDER_CUTOFF"),C.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&C.push("NORMAL_OFFSET");const M=al(c,w,S),D=new hr(v.LEQUAL,hr.ReadOnly,n.depthRangeFor3D),B=new Kr({func:v.EQUAL,mask:255},0,255,v.KEEP,v.KEEP,v.KEEP);for(const O of this._groundShadowTiles){const G=O.toUnwrapped(),X=n.isTileAffectedByFog(O),ee=n.getOrCreateProgram("groundShadow",{defines:C,overrideFog:X});this.setupShadows(G,ee),n.uploadCommonUniforms(m,ee,G,null,j);const oe={u_matrix:n.transform.calculateProjMatrix(G),u_ground_shadow_factor:M};ee.draw(n,v.TRIANGLES,D,B,un.multiply,qr.disabled,oe,"ground_shadow",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments,null,n.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?un.unblended:un.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(n){const c=this.painter.transform,m=c.calculatePosMatrix(n,c.worldSize);return o.aB(m,this._cascades[this.painter.currentShadowCascade].matrix,m),Float32Array.from(m)}calculateShadowPassMatrixFromMatrix(n){const c=o.by(n);return o.aB(c,this._cascades[this.painter.currentShadowCascade].matrix,n),c}setupShadows(n,c,m){if(!this.enabled)return;const v=this.painter.transform,w=this.painter.context,S=w.gl,C=this._uniformValues,j=new Float64Array(16),M=v.calculatePosMatrix(n,v.worldSize);for(let D=0;D<this._cascades.length;D++)o.aB(j,this._cascades[D].matrix,M),C[D===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(j),w.activeTexture.set(S.TEXTURE0+po.ShadowMap0+D),this._cascades[D].texture.bindExtraParam(S.LINEAR,S.LINEAR,S.CLAMP_TO_EDGE,S.CLAMP_TO_EDGE,S.GREATER);if(this.useNormalOffset=!!m,this.useNormalOffset){const D=o.d6(n.canonical),B=2/v.tileSize*o.al/mo.shadowMapResolution,O=B*this._cascades[0].boundingSphereRadius,G=B*this._cascades[this._cascades.length-1].boundingSphereRadius,X=(m==="vector-tile"?1:3)*function(ee,oe,ie,ce,me){const de=o.aA((ee-22)/-22,0,1);return .125*(1-de)+4*de}(v.zoom);C.u_shadow_normal_offset=[D,O*X,G*X],C.u_shadow_bias=[1e-4,.0012,.012]}else C.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(w,C)}setupShadowsFromMatrix(n,c,m=!1){if(!this.enabled)return;const v=this.painter.context,w=v.gl,S=this._uniformValues,C=new Float64Array(16);for(let j=0;j<mo.cascadeCount;j++)o.aB(C,this._cascades[j].matrix,n),S[j===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),v.activeTexture.set(w.TEXTURE0+po.ShadowMap0+j),this._cascades[j].texture.bindExtraParam(w.LINEAR,w.LINEAR,w.CLAMP_TO_EDGE,w.CLAMP_TO_EDGE,w.GREATER);if(this.useNormalOffset=m,m){const j=mo.normalOffset;S.u_shadow_normal_offset=[1,j,j],S.u_shadow_bias=[6e-5,.0012,.012]}else S.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(v,S)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(n,c,m,v){if(v[2]>=0)return{};const w=function(j,M,D){const B=D/(1<<j.canonical.z);return new o.d8([j.canonical.x*B+j.wrap*D,j.canonical.y*B+j.wrap*D,0],[(j.canonical.x+1)*B+j.wrap*D,(j.canonical.y+1)*B+j.wrap*D,M])}(n,c,m).getCorners(),S=c/-v[2];v[0]<0?(o.d7(w[0],w[0],[v[0]*S,0,0]),o.d7(w[3],w[3],[v[0]*S,0,0])):v[0]>0&&(o.d7(w[1],w[1],[v[0]*S,0,0]),o.d7(w[2],w[2],[v[0]*S,0,0])),v[1]<0?(o.d7(w[0],w[0],[0,v[1]*S,0]),o.d7(w[1],w[1],[0,v[1]*S,0])):v[1]>0&&(o.d7(w[2],w[2],[0,v[1]*S,0]),o.d7(w[3],w[3],[0,v[1]*S,0]));const C={};return C.vertices=w,C.planes=[xu(w[1],w[0],w[4]),xu(w[2],w[1],w[5]),xu(w[3],w[2],w[6]),xu(w[0],w[3],w[7])],C}addShadowReceiver(n,c,m){this._receivers.add(n,o.d8.fromTileIdAndHeight(n,c,m))}getMaxCascadeForTile(n){const c=this._receivers.get(n);return c&&c.lastCascade?c.lastCascade:0}}function xu(p,n,c){const m=o.av([],c,n),v=o.av([],p,n),w=o.bH([],m,v),S=o.ag(w);return S===0?[0,0,1,0]:(o.c4(w,w,1/S),[w[0],w[1],w[2],-o.bI(w,n)])}function Kb(p){const n=p.properties.get("direction"),c=o.d3(n.x,n.y,n.z);c[2]=o.aA(c[2],0,75);const m=o.d5([c[0],c[1],c[2]]);return o.d4(m.x,m.y,m.z)}function al(p,n,c){const m=n.properties.get("color-use-theme")==="none",v=n.properties.get("color"),w=n.properties.get("intensity"),S=n.properties.get("direction"),C=[S.x,S.y,S.z],j=c.properties.get("color-use-theme")==="none",M=c.properties.get("color"),D=c.properties.get("intensity"),B=Math.max(o.bI([0,0,1],C),0),O=[0,0,0];o.c4(O,M.toPremultipliedRenderColor(j?null:p.getLut(n.scope)).toArray01Linear().slice(0,3),D);const G=[0,0,0];return o.c4(G,v.toPremultipliedRenderColor(m?null:p.getLut(c.scope)).toArray01Linear().slice(0,3),B*w),o.da([O[0]>0?O[0]/(O[0]+G[0]):0,O[1]>0?O[1]/(O[1]+G[1]):0,O[2]>0?O[2]/(O[2]+G[2]):0])}function Yb(p,n,c,m,v,w){const S=p.zoom,C=p.scale,j=p.worldSize,M=1/j,D=p.aspect,B=Math.sqrt(1+D*D)*Math.tan(.5*p.fovX),O=B*B,G=m-c,X=m+c;let ee,oe;O>G/X?(ee=m,oe=m*B):(ee=.5*X*(1+O),oe=.5*Math.sqrt(G*G+2*(m*m+c*c)*O+X*X*O*O));const ie=p.projection.pixelsPerMeter(p.center.lat,j),ce=p._camera.getCameraToWorldMercator(),me=[0,0,-ee*M];o.af(me,me,ce);let de=oe*M;const Ee=p._edgeInsets;if(!(Ee.left===0&&Ee.top===0&&Ee.right===0&&Ee.bottom===0||Ee.left===Ee.right&&Ee.top===Ee.bottom)){const Et=p._camera.getWorldToCamera(p.worldSize,p.projection.zAxisUnit==="meters"?ie:1),$t=p._camera.getCameraToClipPerspective(p._fov,p.width/p.height,c,m);$t[8]=2*-p.centerOffset.x/p.width,$t[9]=2*p.centerOffset.y/p.height;const lr=new Float64Array(16);o.cO(lr,$t,Et);const Mt=new Float64Array(16);o.bk(Mt,lr);const zt=o.cA.fromInvProjectionMatrix(Mt,j,S,!0);for(const ur of zt.points){const nr=((ge=ur)[0]/=C,ge[1]/=C,ge[2]=o.ce(ge[2],p._center.lat),ge);de=Math.max(de,o.c5(o.d9([],me,nr)))}}var ge;de*=v/(v-1);const je=Math.acos(n[2]),Se=Math.atan2(-n[0],-n[1]),ve=new tg;ve.position=me,ve.setPitchBearing(je,Se);const Ie=ve.getWorldToCamera(j,ie),$e=de*j,Fe=Math.min(p._mercatorZfromZoom(17)*j*-2,-2*$e),at=ve.getCameraToClipOrthographic(-$e,$e,-$e,$e,Fe,($e+w*ie)/n[2]),Qe=new Float64Array(16);o.aB(Qe,at,Ie);const pt=o.d4(Math.floor(1e6*me[0])/1e6*j,Math.floor(1e6*me[1])/1e6*j,0),Ot=.5*v,Ye=[0,0,0];o.af(Ye,pt,Qe),o.c4(Ye,Ye,Ot);const Oe=[Math.floor(Ye[0]),Math.floor(Ye[1]),Math.floor(Ye[2])],mt=[0,0,0];o.av(mt,Ye,Oe),o.c4(mt,mt,-1/Ot);const et=new Float64Array(16);return o.bz(et),o.bq(et,et,mt),o.aB(Qe,et,Qe),[Qe,$e]}class rg extends o.E{constructor(n){super(),this.requestManager=n,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(n,c){return o.db(this.requestManager.transformRequest(c,o.R.Model).url).then(m=>{if(!m)return;const v=o.dc(m),w=new o.dd(n,c,void 0,void 0,v);return w.computeBoundsAndApplyParent(),w}).catch(m=>{if(m&&m.status===404)return null;this.fire(new o.y(new Error(`Could not load model ${n} from ${c}: ${m.message}`)))})}load(n,c,m={forceReload:!1}){this.models[c]||(this.models[c]={});const v=Object.keys(n),w=[],S=[];for(const C of v){const j=n[C];this.hasURLBeenRequested(j)&&!m.forceReload||(this.modelByURL[j]={modelId:C,scope:c},w.push(this.loadModel(C,j)),S.push(C)),this.models[c][C]||(this.models[c][C]={model:null,numReferences:1})}this.numModelsLoading[c]=(this.numModelsLoading[c]||0)+S.length,Promise.allSettled(w).then(C=>{for(let j=0;j<C.length;j++){const{status:M}=C[j];if(M==="rejected")continue;const{value:D}=C[j];this.models[c][S[j]]||(this.models[c][S[j]]={model:null,numReferences:1}),this.models[c][S[j]].model=D}this.numModelsLoading[c]-=S.length,this.fire(new o.z("data",{dataType:"style"}))}).catch(C=>{this.fire(new o.y(new Error(`Could not load models: ${C.message}`)))})}isLoaded(){for(const n in this.numModelsLoading)if(this.numModelsLoading[n]>0)return!1;return!0}hasModel(n,c,m={exactIdMatch:!1}){return!!(m.exactIdMatch?this.getModel(n,c):this.getModelByURL(this.modelUris[c][n]))}getModel(n,c){return this.models[c]||(this.models[c]={}),this.models[c][n]?this.models[c][n].model:void 0}getModelByURL(n){if(!n)return null;const c=this.modelByURL[n];return c?this.models[c.scope][c.modelId].model:null}hasModelBeenAdded(n,c){return this.models[c]&&this.models[c][n]!==void 0}getModelURIs(n){return this.modelUris[n]||{}}addModel(n,c,m){this.models[m]||(this.models[m]={}),this.modelUris[m]||(this.modelUris[m]={});const v=this.requestManager.normalizeModelURL(c);if((this.hasModel(n,m,{exactIdMatch:!0})||this.hasModelBeenAdded(n,m))&&this.modelUris[m][n]===v)this.models[m][n].numReferences++;else if(this.hasURLBeenRequested(v)){const{scope:w,modelId:S}=this.modelByURL[v];this.models[w][S].numReferences++}else this.modelUris[m][n]=v,this.load({[n]:this.modelUris[m][n]},m)}addModelURLs(n,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const m=this.modelUris[c];for(const v in n)m[v]=this.requestManager.normalizeModelURL(n[v])}reloadModels(n){this.load(this.modelUris[n],n,{forceReload:!0})}addModelsFromBucket(n,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const m={};for(const v of n)this.hasModel(v,c,{exactIdMatch:!0})||this.hasURLBeenRequested(v)?this.models[c][v].numReferences++:this.modelUris[c][v]&&!this.hasURLBeenRequested(v)?m[v]=this.modelUris[c][v]:!this.hasURLBeenRequested(v)&&o.de(v,!1)&&(this.modelUris[c][v]=this.requestManager.normalizeModelURL(v),m[v]=this.modelUris[c][v]);this.load(m,c)}hasURLBeenRequested(n){return this.modelByURL[n]!==void 0}removeModel(n,c,m=!1,v=!1){if(this.models[c]&&this.models[c][n]&&(this.models[c][n].numReferences--,this.models[c][n].numReferences===0||v)){const w=this.modelUris[c][n];m||delete this.modelUris[c][n],delete this.modelByURL[w];const S=this.models[c][n].model;if(!S)return;delete this.models[c][n],S.destroy()}}destroy(){for(const n of Object.keys(this.models))for(const c of Object.keys(this.models[n])){const m=this.models[n][c].model;delete this.models[n][c],m&&m.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(n){return this.models[n]||(this.models[n]={}),Object.keys(this.models[n])}upload(n,c){this.models[c]||(this.models[c]={});for(const m in this.models[c])this.models[c][m].model&&this.models[c][m].model.upload(n.context)}}const Sp=o.a6.colorTheme,bu=new o.a9({data:new o.aa(Sp.data)});function G2(p){if(!p.metadata||!p.metadata.content_area)return;const n=o.o.devicePixelRatio,{left:c,top:m,width:v,height:w}=p.metadata.content_area,S=c*n,C=m*n;return[S,C,S+v*n,C+w*n]}function Jb(p){if(p)return p.map(([n,c])=>[n*o.o.devicePixelRatio,c*o.o.devicePixelRatio])}class H2{constructor(n,c,m){this.id=n,this.scope=c,this.sourceCache=m,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(n){this.missingRequests.has(n.name)||this.pendingRequests.has(n.name)||this.pendingRequests.add(n.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const n=new Map;if(!this.sourceCache.loaded())return n;const c=this.sourceCache.getVisibleCoordinates();if(c.length===0)return n;const m=this.sourceCache.getSource();if(!(m instanceof Js))return n;const v=c.map(S=>this.sourceCache.getTile(S)),w=m.getImages(v,Array.from(this.pendingRequests));for(const[S,C]of w)n.set(o.I.from({name:S,iconsetId:this.id}),C),this.pendingRequests.delete(S);for(const S of this.pendingRequests)this.missingRequests.add(S);return this.pendingRequests.clear(),n}}const wu=(p,n)=>re(p,n&&n.filter(c=>c.identifier!=="source.canvas")),W2=o.aH(Jn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),hv=o.aH(Jn,["setCenter","setZoom","setBearing","setPitch"]),ng=new Set(["background","sky","slot","custom"]),fv={version:8,layers:[],sources:{}},pv={duration:300,delay:0};class ll extends o.E{constructor(n,c={}){super(),this.map=n,this.scope=c.scope||"",this.globalId=null,this.fragments=[],this.importDepth=c.importDepth||0,this.importsCache=c.importsCache||new Map,this.resolvedImports=c.resolvedImports||new Set,this.transition=Object.assign({},pv),this._buildingIndex=new nv(this),this.crossTileSymbolIndex=new Rc,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=c.styleChanges||new Ii,this.dispatcher=c.dispatcher?c.dispatcher:new o.D(o.dg(),this),c.imageManager?this.imageManager=c.imageManager:(this.imageManager=new As(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=c.glyphManager?c.glyphManager:new o.dh(n._requestManager,c.localFontFamily?o.di.all:c.localIdeographFontFamily?o.di.ideographs:o.di.none,c.localFontFamily||c.localIdeographFontFamily),c.modelManager?this.modelManager=c.modelManager:(this.modelManager=new rg(n._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=c.configOptions?c.configOptions:new Map,this._configDependentLayers=c.configDependentLayers?c.configDependentLayers:new Set,this._indoorDependentLayers=c.indoorDependentLayers?c.indoorDependentLayers:new Set,this._config=c.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:c.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=c.initialConfig,this.dispatcher.broadcast("setReferrer",o.dj());const m=this;this._rtlTextPluginCallback=ll.registerForPluginStateChange(v=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(w,S)=>{if(o.dk(w),S&&S.every(C=>C))for(const C in m._sourceCaches){const j=m._sourceCaches[C],M=j.getSource().type;M!=="vector"&&M!=="geojson"||j.reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;const w=this.getOwnSource(v.sourceId);if(w&&w.vectorLayerIds)for(const S in this._layers){const C=this._layers[S];C.source===w.id&&this._validateLayer(C)}})}load(n){return n?(typeof n=="string"?this.loadURL(n):this.loadJSON(n),this):this}_getGlobalId(n){if(!n)return null;if(typeof n=="string"){if(o.h(n))return n;const c=o.dl(n);if(!c.startsWith("http"))try{return new URL(c,location.href).toString()}catch{return c}return c}return`json://${o.dm(JSON.stringify(n))}`}_diffStyle(n,c,m){this.globalId=this._getGlobalId(n);const v=(w,S)=>{try{S(null,this.setState(w,m))}catch(C){S(C,!1)}};if(typeof n=="string"){const w=this.map._requestManager.normalizeStyleURL(n),S=this.map._requestManager.transformRequest(w,o.R.Style);o.m(S,(C,j)=>{C?this.fire(new o.y(C)):j&&v(j,c)})}else typeof n=="object"&&v(n,c)}loadURL(n,c={}){this.fire(new o.z("dataloading",{dataType:"style"}));const m=typeof c.validate=="boolean"?c.validate:!o.h(n);this.globalId=this._getGlobalId(n),n=this.map._requestManager.normalizeStyleURL(n,c.accessToken),this.resolvedImports.add(n);const v=this.importsCache.get(n);if(v)return this._load(v,m);const w=this.map._requestManager.transformRequest(n,o.R.Style);this._request=o.m(w,(S,C)=>{if(this._request=null,S)this.fire(new o.y(S));else if(C)return this.importsCache.set(n,C),this._load(C,m)})}loadJSON(n,c={}){this.fire(new o.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(n),this._request=o.o.frame(()=>{this._request=null,this._load(n,c.validate!==!1)})}loadEmpty(){this.fire(new o.z("dataloading",{dataType:"style"})),this._load(fv,!1)}_loadImports(n,c,m){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const v=[];for(const w of n){const S=this._createFragmentStyle(w),C=new Promise(D=>{S.once("style.import.load",D),S.once("error",D)}).then(()=>this.mergeAll());if(v.push(C),this.resolvedImports.has(w.url)){S.loadEmpty();continue}const j=w.data||this.importsCache.get(w.url);j?(S.loadJSON(j,{validate:c}),this._isInternalStyle(j)&&(S.globalId=null)):w.url?S.loadURL(w.url,{validate:c}):S.loadEmpty();const M={style:S,id:w.id,config:w.config};if(m){const D=this.fragments.findIndex(({id:B})=>B===m);this.fragments=this.fragments.slice(0,D).concat(M).concat(this.fragments.slice(D))}else this.fragments.push(M)}return Promise.allSettled(v)}getImportGlobalIds(n=this,c=new Set){for(const m of n.fragments)m.style.globalId&&c.add(m.style.globalId),this.getImportGlobalIds(m.style,c);return[...c.values()]}_createFragmentStyle(n){const c=this.scope?o.B(n.id,this.scope):n.id;let m;const v=this._initialConfig&&this._initialConfig[c];(n.config||v)&&(m=Object.assign({},n.config,v));const w=new ll(this.map,{scope:c,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:m,configOptions:this.options,colorThemeOverride:n["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return w.setEventedParent(this.map,{style:w}),w}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(n){return this.isRootStyle()&&(n.fragment||!!n.schema&&n.fragment!==!1)}_load(n,c){if(this._isInternalStyle(n)){const w=Object.assign({},fv,{imports:[{id:"basemap",data:n,url:""}]},n.center?{center:n.center}:{},n.bearing?{bearing:n.bearing}:{},n.pitch?{pitch:n.pitch}:{},n.zoom?{zoom:n.zoom}:{},n.light?{light:n.light}:{});return this._importedAsBasemap=!0,void this._load(w,c)}if(this.updateConfig(this._config,n.schema),c&&wu(this,ra(n)))return;this._loaded=!0,this.stylesheet=o.dn(n);const m=()=>{for(const j in n.sources)this.addSource(j,n.sources[j],{validate:!1,isInitialLoad:!0});if(n.iconsets)for(const j in n.iconsets)this.addIconset(j,n.iconsets[j]);n.sprite?this._loadIconset(n.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&n.glyphs&&this.glyphManager.setURL(n.glyphs);const w=ih(this.stylesheet.layers);if(this._order=w.map(j=>j.id),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const j=this.stylesheet.lights[0];this.light=new Re(j.properties,j.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Re(this.stylesheet.light)),this._layers={};for(const j of w){const M=o.dt(j,this.scope,this._styleColorTheme.lut,this.options);M.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(M.fqid),M.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(M.fqid),this._hasAppearances=this._hasAppearances||M.getAppearances().length!==0,M.setEventedParent(this,{layer:{id:M.id}}),this._layers[M.id]=M;const D=this.getOwnLayerSourceCache(M),B=!!this.directionalLight&&this.directionalLight.shadowsEnabled();D&&M.canCastShadows()&&B&&(D.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const S=this.stylesheet.terrain;S&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(S,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.z("data",{dataType:"style"}));const C=this.isRootStyle();n.imports?this._loadImports(n.imports,c).then(()=>{this._reloadImports(),this.fire(new o.z(C?"style.load":"style.import.load"))}).catch(j=>{this.fire(new o.y(new Error("Failed to load imports",j))),this.fire(new o.z(C?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new o.z(C?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const v=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(v){const w=this._evaluateColorThemeData(v);this._loadColorTheme(w).then(()=>{m()}).catch(S=>{o.w(`Couldn't load color theme from the stylesheet: ${S}`),m()})}else this._styleColorTheme.lut=null,m()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances}mergeAll(){let n,c,m,v,w,S,C,j,M,D;const B={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(O=>{if(O.stylesheet){if(O.light!=null&&(n=O.light),O.stylesheet.lights)for(const G of O.stylesheet.lights)G.type==="ambient"&&O.ambientLight!=null&&(c=O.ambientLight),G.type==="directional"&&O.directionalLight!=null&&(m=O.directionalLight);v=this._prioritizeTerrain(v,O.terrain,O.stylesheet.terrain),O.stylesheet.fog&&O.fog!=null&&(w=O.fog),O.stylesheet.snow&&O.snow!=null&&(S=O.snow),O.stylesheet.rain&&O.rain!=null&&(C=O.rain),O.stylesheet.camera!=null&&(D=O.stylesheet.camera),O.stylesheet.projection!=null&&(j=O.stylesheet.projection),O.stylesheet.transition!=null&&(M=O.stylesheet.transition),B[O.scope]=O._styleColorTheme}}),this.light=n,this.ambientLight=c,this.directionalLight=m,this.fog=w,this.snow=S,this.rain=C,this._styleColorThemeForScope=B,v===null?delete this.terrain:this.terrain=v,this.camera=D||{"camera-projection":"perspective"},this.projection=j||{name:"mercator"},this.transition=Object.assign({},pv,M),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(n){const c=m=>{for(const v of m.fragments)c(v.style);n(m)};c(this)}_prioritizeTerrain(n,c,m){const v=n&&n.drapeRenderMode===0;return m===null?c&&c.drapeRenderMode===0?c:v?n:null:c!=null&&(!n||v||c&&c.drapeRenderMode===1)?c:n}mergeTerrain(){let n;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(c=>{n=this._prioritizeTerrain(n,c.terrain,c.stylesheet.terrain)}),n===null?delete this.terrain:this.terrain=n}mergeProjection(){let n;this.forEachFragmentStyle(c=>{c.stylesheet.projection!=null&&(n=c.stylesheet.projection)}),this.projection=n||{name:"mercator"}}mergeSources(){const n={},c={},m={};this.forEachFragmentStyle(v=>{for(const w in v._sourceCaches){const S=o.B(w,v.scope);n[S]=v._sourceCaches[w]}for(const w in v._otherSourceCaches){const S=o.B(w,v.scope);c[S]=v._otherSourceCaches[w]}for(const w in v._symbolSourceCaches){const S=o.B(w,v.scope);m[S]=v._symbolSourceCaches[w]}}),this._mergedSourceCaches=n,this._mergedOtherSourceCaches=c,this._mergedSymbolSourceCaches=m}mergeIndoor(){this.forEachFragmentStyle(n=>{if(n.stylesheet&&n.stylesheet.indoor)for(const c of Object.values(n.stylesheet.indoor)){const m=c,v=o.B(m.sourceId,n.scope);this._mergedIndoor[v]=new Set(m.sourceLayers||[])}})}mergeLayers(){const n={},c=[],m={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(S=>{for(const C of S._order){const j=S._layers[C];if(j.type==="slot"){const M=o.dp(C);if(n[M])continue;n[M]=[]}j.slot&&n[j.slot]?n[j.slot].push(j):c.push(j)}}),this._mergedOrder=[];let v=-1;const w=(S=[])=>{for(const C of S)if(C.type==="slot"){const j=o.dp(C.id);n[j]&&w(n[j]),this._mergedSlots.push(j)}else{const j=o.B(C.id,C.scope);this._mergedOrder.push(j),m[j]=C,C.is3D(!!this.terrain)&&(this._has3DLayers=!0,v=this._mergedOrder.length-1),C.type==="circle"&&(this._hasCircleLayers=!0),C.type==="symbol"&&(this._hasSymbolLayers=!0),C.type==="clip"&&(this._clipLayerPresent=!0)}};if(w(c),this._has3DLayers){const S={};for(let C=0;C<this._mergedOrder.length;++C){const j=this._mergedOrder[C];S[j]=C===v?1:C<v?m[j].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((C,j)=>S[C]-S[j])}this._mergedLayers=m,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(n){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,n),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(n){return n.data?function(c,m,v,w){const S=Object.assign({},m);for(const j of Object.keys(Sp))S[j]===void 0&&(S[j]=Sp[j].default);const C=new o.a8(bu,c,new Map(v));return C.setTransitionOrValue(S,v),C.untransitioned().possiblyEvaluate(new o.ac(0,{worldview:void 0}))}(this.scope,n,this.options).get("data"):null}_loadColorTheme(n){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const c=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((m,v)=>{const w="data:image/png;base64,";if(!n||n.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void m();let S=n;S.startsWith(w)||(S=w+S);const C=o.I.from("mapbox-reserved-lut"),j=new Image;j.src=S,j.onerror=()=>{this._styleColorTheme.lutLoading=!1,v(new Error("Failed to load image data"))},j.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==c)return void m();this._styleColorTheme.lutLoading=!1;const{width:M,height:D,data:B}=o.o.getImageData(j);if(D>32)return void v(new Error("The height of the image must be less than or equal to 32 pixels."));if(M!==D*D)return void v(new Error("The width of the image must be equal to the height squared."));this.getImage(C)&&this.removeImage(C),this.addImage(C,{data:new o.q({width:M,height:D},B),pixelRatio:1,sdf:!1,usvg:!1,version:0});const O=this.imageManager.getImage(C,this.scope);O?(this._styleColorTheme.lut={image:O.data,data:n},m()):v(new Error("Missing LUT image."))}})}getLut(n){const c=this._styleColorThemeForScope[n];return c?c.lut:null}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(n){this._spriteRequest=function(c,m,v){let w,S,C;const j=o.o.devicePixelRatio>1?"@2x":"";let M=o.m(m.transformRequest(m.normalizeSpriteURL(c,j,".json"),o.R.SpriteJSON),(O,G)=>{M=null,C||(C=O,w=G,B())}),D=o.n(m.transformRequest(m.normalizeSpriteURL(c,j,".png"),o.R.SpriteImage),(O,G)=>{D=null,C||(C=O,S=G,B())});function B(){if(C)v(C);else if(w&&S){const O=o.o.getImageData(S),G={};for(const X in w){const{width:ee,height:oe,x:ie,y:ce,sdf:me,pixelRatio:de,stretchX:Ee,stretchY:ge,content:je}=w[X],Se=new o.q({width:ee,height:oe});o.q.copy(O,Se,{x:ie,y:ce},{x:0,y:0},{width:ee,height:oe},null),G[X]={data:Se,pixelRatio:de!==void 0?de:1,sdf:me!==void 0&&me,stretchX:Ee,stretchY:ge,content:je,usvg:!1,version:0}}v(null,G)}}return{cancel(){M&&(M.cancel(),M=null),D&&(D.cancel(),D=null)}}}(n,this.map._requestManager,(c,m)=>{if(this._spriteRequest=null,c)this.fire(new o.y(c));else if(m){const v=new Map;for(const w in m)v.set(o.I.from(w),m[w]);this.addImages(v)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.z("data",{dataType:"style"}))})}addIconset(n,c){if(c.type==="sprite")return void this._loadSprite(c.url);const m=this.getOwnSourceCache(c.source);if(!m)return void this.fire(new o.y(new Error(`Source "${c.source}" as specified by iconset "${n}" does not exist and cannot be used as an iconset source`)));const v=m.getSource();if(v.type!=="raster-array")return void this.fire(new o.y(new Error(`Source "${c.source}" as specified by iconset "${n}" is not a "raster-array" source and cannot be used as an iconset source`)));v.partial=!1;const w=new H2(n,this.scope,m);this.imageManager.addImageProvider(w,this.scope)}removeIconset(n){this.imageManager.removeImageProvider(n,this.scope)}_loadIconset(n){if(!o.h(n)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(n);const c=this.map._spriteFormat==="auto";var m,v;this._spriteRequest=(v=(w,S)=>{if(this._spriteRequest=null,w)c?this._loadSprite(n):this.fire(new o.y(w));else if(S){const C=new Map;for(const j in S)C.set(o.I.from(j),S[j]);this.addImages(C)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.z("data",{dataType:"style"}))},o.bt((m=this.map._requestManager).transformRequest(m.normalizeIconsetURL(n),o.R.Iconset),(w,S)=>{if(w)return void v(w);const C={},j=o.df(new o.bs(S));for(const M of j.icons){const D={version:1,pixelRatio:o.o.devicePixelRatio,content:G2(M),stretchX:M.metadata?Jb(M.metadata.stretch_x_areas):void 0,stretchY:M.metadata?Jb(M.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:M};C[M.name]=D}v(null,C)}))}_validateLayer(n){const c=this.getOwnSource(n.source);if(!c)return;const m=n.sourceLayer;m&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(m)===-1)&&this.fire(new o.y(new Error(`Source layer "${m}" does not exist on source "${c.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:n}of this.fragments)if(!n.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((n,c)=>{const m=this.fragments[c];return m&&m.style&&(n.data=m.style.serialize()),n})}_serializeSources(){const n={};for(const c in this._sourceCaches){const m=this._sourceCaches[c].getSource();n[m.id]||(n[m.id]=m.serialize())}return n}_serializeLayers(n){const c=[];for(const m of n){const v=this._layers[m];v&&v.type!=="custom"&&c.push(v.serialize())}return c}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(n){return n?this.order:this._mergedOrder}isLayerDraped(n){return!!this.terrain&&n.isDraped(this.getLayerSourceCache(n))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(n){const c=this.getOwnLayer(n);if(c)return c;this.fire(new o.y(new Error(`The layer '${n}' does not exist in the map's style.`)))}_checkSource(n){const c=this.getOwnSource(n);if(c)return c;this.fire(new o.y(new Error(`The source '${n}' does not exist in the map's style.`)))}precompilePrograms(n,c){const m=this.map.painter;if(m)for(let v=n.minzoom||0;v<(n.maxzoom||25.5);v++){const w=n.getProgramIds();if(w)for(const S of w){const C=n.getDefaultProgramParams(S,c.zoom,this._styleColorTheme.lut);C&&(m.style=this,this.fog&&(m._fogVisible=!0,C.overrideFog=!0,m.getOrCreateProgram(S,C)),m._fogVisible=!1,C.overrideFog=!1,m.getOrCreateProgram(S,C),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(C.overrideRtt=!0,m.getOrCreateProgram(S,C)))}}}update(n){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n);const c=this.calculateLightsBrightness();n.brightness=c||0,c!==this._brightness&&(this._brightness=c,this.dispatcher.broadcast("setBrightness",c)),n.worldview!==this._worldview&&(this._worldview=n.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const m=this._changes.isDirty();let v=!1;if(this._changes.isDirty()){const C=this._changes.getLayerUpdatesByScope();for(const j in C){const{updatedIds:M,removedIds:D}=C[j];(M||D)&&(this._updateWorkerLayers(j,M,D),v=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(n),this.light&&this.light.updateTransitions(n),this.ambientLight&&this.ambientLight.updateTransitions(n),this.directionalLight&&this.directionalLight.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this.snow&&this.snow.updateTransitions(n),this.rain&&this.rain.updateTransitions(n),this._changes.reset()}const w={};for(const C in this._mergedSourceCaches){const j=this._mergedSourceCaches[C];w[C]=j.used,j.used=!1,j.tileCoverLift=0}for(const C of this._mergedOrder){const j=this._mergedLayers[C];if(j.recalculate(n,this._availableImages),!j.isHidden(n.zoom)){const M=this.getLayerSourceCache(j);M&&(M.used=!0,M.tileCoverLift=Math.max(M.tileCoverLift,j.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(j,n)}):this.precompilePrograms(j,n))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&v&&this.mergeLayers();const S=this.imageManager.getPendingImageProviders();for(const C of S)C.sourceCache.used=!0;for(const C in w){const j=this._mergedSourceCaches[C];w[C]!==j.used&&j.getSource().fire(new o.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:j.getSource().id}))}this.light&&this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.snow&&this.snow.recalculate(n),this.rain&&this.rain.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),m&&this.fire(new o.z("data",{dataType:"style"}))}updateImageProviders(){const n=this.imageManager.getPendingImageProviders();for(const c of n){const m=c.resolvePendingRequests(),v=this.getFragmentStyle(c.scope);v&&v.addImages(m)}}_updateTilesForChangedImages(){const n={};for(const c in this._mergedSourceCaches){const m=this._mergedSourceCaches[c].getSource().scope;n[m]=n[m]||this._changes.getUpdatedImages(m),n[m].length!==0&&this._mergedSourceCaches[c].reloadTilesForDependencies(["icons","patterns"],n[m])}for(const c in n)this._changes.resetUpdatedImages(c)}_updateWorkerLayers(n,c,m){const v=this.getFragmentStyle(n);v&&this.dispatcher.broadcast("updateLayers",{layers:c?v._serializeLayers(c):[],scope:n,removedIds:m||[],options:v.options})}setState(n,c){if(this._checkLoaded(),wu(this,ra(n)))return!1;(n=o.dn(n)).layers=ih(n.layers);const m=function(S,C){if(!S)return[{command:Jn.setStyle,args:[C]}];let j=[];try{if(!o.bx(S.version,C.version))return[{command:Jn.setStyle,args:[C]}];if(o.bx(S.center,C.center)||j.push({command:Jn.setCenter,args:[C.center]}),o.bx(S.zoom,C.zoom)||j.push({command:Jn.setZoom,args:[C.zoom]}),o.bx(S.bearing,C.bearing)||j.push({command:Jn.setBearing,args:[C.bearing]}),o.bx(S.pitch,C.pitch)||j.push({command:Jn.setPitch,args:[C.pitch]}),o.bx(S.sprite,C.sprite)||j.push({command:Jn.setSprite,args:[C.sprite]}),o.bx(S.glyphs,C.glyphs)||j.push({command:Jn.setGlyphs,args:[C.glyphs]}),o.bx(S.imports,C.imports)||function(G=[],X=[],ee){X=X||[];const oe=(G=G||[]).map(up),ie=X.map(up),ce=G.reduce(dp,{}),me=X.reduce(dp,{}),de=oe.slice();let Ee,ge,je,Se;for(Ee=0,ge=0;Ee<oe.length;Ee++)je=oe[Ee],me.hasOwnProperty(je)?ge++:(ee.push({command:Jn.removeImport,args:[je]}),de.splice(de.indexOf(je,ge),1));for(Ee=0,ge=0;Ee<ie.length;Ee++)je=ie[ie.length-1-Ee],de[de.length-1-Ee]!==je&&(ce.hasOwnProperty(je)?(ee.push({command:Jn.removeImport,args:[je]}),de.splice(de.lastIndexOf(je,de.length-ge),1)):ge++,Se=de[de.length-Ee],ee.push({command:Jn.addImport,args:[me[je],Se]}),de.splice(de.length-Ee,0,je));for(const ve of X){const Ie=ce[ve.id];Ie&&(delete Ie.data,o.bx(Ie,ve)||ee.push({command:Jn.updateImport,args:[ve.id,ve]}))}}(S.imports,C.imports,j),o.bx(S.transition,C.transition)||j.push({command:Jn.setTransition,args:[C.transition]}),o.bx(S.light,C.light)||j.push({command:Jn.setLight,args:[C.light]}),o.bx(S.fog,C.fog)||j.push({command:Jn.setFog,args:[C.fog]}),o.bx(S.snow,C.snow)||j.push({command:Jn.setSnow,args:[C.snow]}),o.bx(S.rain,C.rain)||j.push({command:Jn.setRain,args:[C.rain]}),o.bx(S.projection,C.projection)||j.push({command:Jn.setProjection,args:[C.projection]}),o.bx(S.lights,C.lights)||j.push({command:Jn.setLights,args:[C.lights]}),o.bx(S.camera,C.camera)||j.push({command:Jn.setCamera,args:[C.camera]}),o.bx(S.iconsets,C.iconsets)||function(G,X,ee){let oe;for(oe in X=X||{},G=G||{})G.hasOwnProperty(oe)&&(X.hasOwnProperty(oe)||ee.push({command:Jn.removeIconset,args:[oe]}));for(oe in X){if(!X.hasOwnProperty(oe))continue;const ie=X[oe];G.hasOwnProperty(oe)?o.bx(G[oe],ie)||(ee.push({command:Jn.removeIconset,args:[oe]}),ee.push({command:Jn.addIconset,args:[oe,ie]})):ee.push({command:Jn.addIconset,args:[oe,ie]})}}(S.iconsets,C.iconsets,j),!o.bx(S["color-theme"],C["color-theme"]))return[{command:Jn.setStyle,args:[C]}];const M={},D=[];(function(G,X,ee,oe){let ie;for(ie in X=X||{},G=G||{})G.hasOwnProperty(ie)&&(X.hasOwnProperty(ie)||ap(ie,ee,oe));for(ie in X){if(!X.hasOwnProperty(ie))continue;const ce=X[ie];G.hasOwnProperty(ie)?o.bx(G[ie],ce)||(G[ie].type==="geojson"&&ce.type==="geojson"&&sv(G,X,ie)?ee.push({command:Jn.setGeoJSONSourceData,args:[ie,ce.data]}):lp(ie,X,ee,oe)):iv(ie,X,ee)}})(S.sources,C.sources,D,M);const B=[];S.layers&&S.layers.forEach(G=>{G.source&&M[G.source]?j.push({command:Jn.removeLayer,args:[G.id]}):B.push(G)});let O=S.terrain;O&&M[O.source]&&(j.push({command:Jn.setTerrain,args:[void 0]}),O=void 0),j=j.concat(D),o.bx(O,C.terrain)||j.push({command:Jn.setTerrain,args:[C.terrain]}),function(G,X,ee){X=X||[];const oe=(G=G||[]).map(up),ie=X.map(up),ce=G.reduce(dp,{}),me=X.reduce(dp,{}),de=oe.slice(),Ee=Object.create(null);let ge,je,Se,ve,Ie,$e,Fe;for(ge=0,je=0;ge<oe.length;ge++)Se=oe[ge],me.hasOwnProperty(Se)?je++:(ee.push({command:Jn.removeLayer,args:[Se]}),de.splice(de.indexOf(Se,je),1));for(ge=0,je=0;ge<ie.length;ge++)Se=ie[ie.length-1-ge],de[de.length-1-ge]!==Se&&(ce.hasOwnProperty(Se)?(ee.push({command:Jn.removeLayer,args:[Se]}),de.splice(de.lastIndexOf(Se,de.length-je),1)):je++,$e=de[de.length-ge],ee.push({command:Jn.addLayer,args:[me[Se],$e]}),de.splice(de.length-ge,0,Se),Ee[Se]=!0);for(ge=0;ge<ie.length;ge++)if(Se=ie[ge],ve=ce[Se],Ie=me[Se],!Ee[Se]&&!o.bx(ve,Ie))if(o.bx(ve.source,Ie.source)&&o.bx(ve["source-layer"],Ie["source-layer"])&&o.bx(ve.type,Ie.type)){for(Fe in cp(ve.layout,Ie.layout,ee,Se,null,Jn.setLayoutProperty),cp(ve.paint,Ie.paint,ee,Se,null,Jn.setPaintProperty),o.bx(ve.slot,Ie.slot)||ee.push({command:Jn.setSlot,args:[Se,Ie.slot]}),o.bx(ve.filter,Ie.filter)||ee.push({command:Jn.setFilter,args:[Se,Ie.filter]}),o.bx(ve.minzoom,Ie.minzoom)&&o.bx(ve.maxzoom,Ie.maxzoom)||ee.push({command:Jn.setLayerZoomRange,args:[Se,Ie.minzoom,Ie.maxzoom]}),ve)ve.hasOwnProperty(Fe)&&Fe!=="layout"&&Fe!=="paint"&&Fe!=="filter"&&Fe!=="metadata"&&Fe!=="minzoom"&&Fe!=="maxzoom"&&Fe!=="slot"&&(Fe.indexOf("paint.")===0?cp(ve[Fe],Ie[Fe],ee,Se,Fe.slice(6),Jn.setPaintProperty):o.bx(ve[Fe],Ie[Fe])||ee.push({command:Jn.setLayerProperty,args:[Se,Fe,Ie[Fe]]}));for(Fe in Ie)Ie.hasOwnProperty(Fe)&&!ve.hasOwnProperty(Fe)&&Fe!=="layout"&&Fe!=="paint"&&Fe!=="filter"&&Fe!=="metadata"&&Fe!=="minzoom"&&Fe!=="maxzoom"&&Fe!=="slot"&&(Fe.indexOf("paint.")===0?cp(ve[Fe],Ie[Fe],ee,Se,Fe.slice(6),Jn.setPaintProperty):o.bx(ve[Fe],Ie[Fe])||ee.push({command:Jn.setLayerProperty,args:[Se,Fe,Ie[Fe]]}))}else ee.push({command:Jn.removeLayer,args:[Se]}),$e=de[de.lastIndexOf(Se)+1],ee.push({command:Jn.addLayer,args:[Ie,$e]})}(B,C.layers,j)}catch(M){console.warn("Unable to compute style diff:",M),j=[{command:Jn.setStyle,args:[C]}]}return j}(this.serialize(),n).filter(S=>!(S.command in hv));if(m.length===0)return!1;const v=m.filter(S=>!(S.command in W2));if(v.length>0)throw new Error(`Unimplemented: ${v.map(S=>S.command).join(", ")}.`);const w=[];return m.forEach(S=>{w.push(this[S.command](...S.args))}),c&&Promise.all(w).then(c).catch(c),this.stylesheet=n,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(n){if(n.size===0)return this;for(const[c,m]of n.entries()){if(this.getImage(c))return this.fire(new o.y(new Error(`An image with the name "${c.name}" already exists.`)));this.imageManager.addImage(c,this.scope,m),this._changes.updateImage(c,this.scope)}return this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this}addImage(n,c){return this.getImage(n)?this.fire(new o.y(new Error(`An image with the name "${n.name}" already exists.`))):(this.imageManager.addImage(n,this.scope,c),this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this)}updateImage(n,c,m=!1){this.imageManager.updateImage(n,this.scope,c),m&&(this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})))}getImage(n){return this.imageManager.getImage(n,this.scope)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n,this.scope),this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this):this.fire(new o.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(n){return this.modelManager.addModelURLs(n,this.scope),this._updateWorkerModels(),this.fire(new o.z("data",{dataType:"style"})),this}addModel(n,c,m={}){return this._checkLoaded(),this._validate(rp,`models.${n}`,c,null,m)||(this.modelManager.addModel(n,c,this.scope),this.fire(new o.z("data",{dataType:"style"}))),this}hasModel(n){return this.modelManager.hasModel(n,this.scope)}removeModel(n){return this.hasModel(n)?(this.modelManager.removeModel(n,this.scope,!1,!0),this.fire(new o.z("data",{dataType:"style"})),this):this.fire(new o.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(n,c,m={}){if(this._checkLoaded(),this.getOwnSource(n)!==void 0)throw new Error(`There is already a source with ID "${n}".`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(Yn,`sources.${n}`,c,null,m))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const v=Xo(n,c,this.dispatcher,this);v.scope=this.scope,v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(v.id),source:v.serialize(),sourceId:v.id}));const w=S=>{const C=(S?"symbol:":"other:")+v.id,j=o.B(C,this.scope),M=this._sourceCaches[C]=new il(j,v,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[v.id]=M,M.onAdd(this.map)};w(!1),c.type!=="vector"&&c.type!=="geojson"||w(!0),v.onAdd&&v.onAdd(this.map),m.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(n){this._checkLoaded();const c=this.getOwnSource(n);if(!c)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===n)return this.fire(new o.y(new Error(`Source "${n}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===n)return this.fire(new o.y(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const v=Object.entries(this.stylesheet.iconsets).find(([w,S])=>S.type==="source"&&S.source===n);if(v)return this.fire(new o.y(new Error(`Source "${n}" cannot be removed while iconset "${v[0]}" is using it.`)))}const m=this.getOwnSourceCaches(n);for(const v of m){const w=o.dp(v.id);delete this._sourceCaches[w],this._changes.discardSourceCacheUpdate(v.id),v.fire(new o.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles()}return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],this.mergeSources(),c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(n,c){this._checkLoaded(),this.getOwnSource(n).setData(c),this._changes.setDirty()}getOwnSource(n){const c=this.getOwnSourceCache(n);return c&&c.getSource()}getOwnSources(){const n=[];for(const c in this._otherSourceCaches){const m=this.getOwnSourceCache(c);m&&n.push(m.getSource())}return n}areTilesLoaded(){const n=this._mergedSourceCaches;for(const c in n){const m=n[c]._tiles;for(const v in m){const w=m[v];if(w.state!=="loaded"&&w.state!=="errored")return!1}}return!0}setLights(n){if(this._checkLoaded(),!n)return delete this.ambientLight,void delete this.directionalLight;const c=this._getTransitionParameters();for(const w of n){if(this._validate(ps,"lights",w))return;switch(w.type){case"ambient":if(this.ambientLight){const S=this.ambientLight;S.set(w),S.updateTransitions(c)}else this.ambientLight=new us(w,hi||(hi=new o.a9({color:new o.aa(o.a6.properties_light_ambient.color),"color-use-theme":new o.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.aa(o.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const S=this.directionalLight;S.set(w),S.updateTransitions(c)}else this.directionalLight=new us(w,ns||(ns=new o.a9({direction:new o.ap(o.a6.properties_light_directional.direction),color:new o.aa(o.a6.properties_light_directional.color),"color-use-theme":new o.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.aa(o.a6.properties_light_directional.intensity),"cast-shadows":new o.aa(o.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new o.aa(o.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new o.aa(o.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const m=Object.assign(c,{worldview:this.map.getWorldview()}),v=new o.ac(this.z||0,m);this.ambientLight&&this.ambientLight.recalculate(v),this.directionalLight&&this.directionalLight.recalculate(v),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const n=this.directionalLight,c=this.ambientLight;if(!n||!c)return;const m=O=>.2126*(O[0]<=.03928?O[0]/12.92:Math.pow((O[0]+.055)/1.055,2.4))+.7152*(O[1]<=.03928?O[1]/12.92:Math.pow((O[1]+.055)/1.055,2.4))+.0722*(O[2]<=.03928?O[2]/12.92:Math.pow((O[2]+.055)/1.055,2.4)),v=n.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),w=n.properties.get("intensity"),S=n.properties.get("direction"),C=1-o.d3(S.x,S.y,S.z)[2]/90,j=m(v)*w*C,M=c.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),D=c.properties.get("intensity"),B=m(M)*D;return Number(((j+B)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const n=[];return this.directionalLight&&n.push(this.directionalLight.get()),this.ambientLight&&n.push(this.ambientLight.get()),n}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(n){if(n==null||n===""&&this.isRootStyle())return this;if(o.dq(n)){const c=o.dr(n),m=this.fragments.find(({id:w})=>w===c);if(!m)return;const v=o.dp(n);return m.style.getFragmentStyle(v)}{const c=this.fragments.find(({id:m})=>m===n);return c?c.style:void 0}}setFeaturesetSelectors(n){if(!n)return;const c={},m=(v,w="")=>`${v}::${w}`;this._featuresetSelectors={};for(const v in n){const w=this._featuresetSelectors[v]=[];for(const S of n[v].selectors){if(S.featureNamespace){const j=this.getOwnLayer(S.layer);if(!j){o.w(`Layer is undefined for selector: ${S.layer}`);continue}const M=m(j.source,j.sourceLayer);if(M in c&&c[M]!==S.featureNamespace){o.w(`"featureNamespace ${S.featureNamespace} of featureset ${v}'s selector is not associated to the same source, skip this selector`);continue}c[M]=S.featureNamespace}let C;if(S.properties)for(const j in S.properties){const M=o.U(S.properties[j]);M.result==="success"&&(C=C||{},C[j]=M.value)}w.push({layerId:S.layer,namespace:S.featureNamespace,properties:C,uniqueFeatureID:S._uniqueFeatureID})}}}getFeaturesetDescriptors(n){const c=this.getFragmentStyle(n);if(!c||!c.stylesheet.featuresets)return[];const m=[];for(const v in c.stylesheet.featuresets)m.push({featuresetId:v,importId:c.scope?c.scope:void 0});return m}getFeaturesetLayers(n,c){const m=this.getFragmentStyle(c),v=m.stylesheet.featuresets;if(!v||!v[n])return this.fire(new o.y(new Error(`The featureset '${n}' does not exist in the map's style and cannot be queried.`))),[];const w=[];for(const S of v[n].selectors){const C=m.getOwnLayer(S.layer);C&&w.push(C)}return w}getConfigProperty(n,c){const m=this.getFragmentStyle(n);if(!m)return null;const v=o.B(c,m.scope),w=m.options.get(v),S=w?w.value||w.default:null;return S?S.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(n,c){const m=o.B(n,c);return this._mergedIndoor[m]}setIndoorData(n,c){this.map.indoor.setIndoorData(c)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(n,c,m){const v=this.getFragmentStyle(n);if(!v)return;const w=v.stylesheet.schema;if(!w||!w[c])return;const S=o.U(m);if(S.result!=="success")return void wu(this,S.value);const C=S.value.expression,j=o.B(c,v.scope),M=v.options.get(j);if(!M)return;let D;const{minValue:B,maxValue:O,stepValue:G,type:X,values:ee}=w[c],oe=o.U(w[c].default);oe.result==="success"&&(D=oe.value.expression),D?(this.options.set(j,Object.assign({},M,{value:C,default:D,minValue:B,maxValue:O,stepValue:G,type:X,values:ee})),this.updateConfigDependencies(c)):this.fire(new o.y(new Error(`No schema defined for the config option "${c}" in the "${n}" fragment.`)))}getConfig(n){const c=this.getFragmentStyle(n);if(!c)return null;const m=c.stylesheet.schema;if(!m)return null;const v={};for(const w in m){const S=o.B(w,c.scope),C=c.options.get(S),j=C?C.value||C.default:null;v[w]=j?j.serialize():null}return v}setConfig(n,c){const m=this.getFragmentStyle(n);m&&(m.updateConfig(c,m.stylesheet.schema),this.updateConfigDependencies())}getSchema(n){const c=this.getFragmentStyle(n);return c?c.stylesheet.schema:null}setSchema(n,c){const m=this.getFragmentStyle(n);m&&(m.stylesheet.schema=c,m.updateConfig(m._config,c),this.updateConfigDependencies())}updateConfig(n,c){if(this._config=n,n||c)if(c)for(const m in c){let v,w;const S=o.U(c[m].default);if(S.result==="success"&&(v=S.value.expression),n&&n[m]!==void 0){const O=o.U(n[m]);O.result==="success"&&(w=O.value.expression)}const{minValue:C,maxValue:j,stepValue:M,type:D,values:B}=c[m];if(v){const O=o.B(m,this.scope);this.options.set(O,{default:v,value:w,minValue:C,maxValue:j,stepValue:M,type:D,values:B})}else this.fire(new o.y(new Error(`No schema defined for config option "${m}".`)))}else this.fire(new o.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(n,c=()=>!0){for(const m of n){const v=this.getLayer(m);v&&c(v)&&(v.possiblyEvaluateVisibility(),this._updateLayer(v),this._changes.setDirty())}}updateConfigDependencies(n){this._updateLayers(this._configDependentLayers,c=>!n||c.expressionDependencies.configDependencies.has(n)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(c=>{const m=c._styleColorTheme.colorThemeOverride?c._styleColorTheme.colorThemeOverride:c._styleColorTheme.colorTheme;if(m){const v=c._evaluateColorThemeData(m);(!c._styleColorTheme.lut&&v!==""||c._styleColorTheme.lut&&v!==c._styleColorTheme.lut.data)&&c.setColorTheme(m)}}),this._changes.setDirty()}addLayer(n,c,m={}){this._checkLoaded();const v=n.id;if(this._layers[v])return void this.fire(new o.y(new Error(`Layer with id "${v}" already exists on this map`)));let w;if(n.type==="custom"){if(wu(this,o.ds(n)))return;w=o.dt(n,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof n.source=="object"&&(this.addSource(v,n.source),n=o.dn(n),n=Object.assign(n,{source:v})),this._validate(Fo,`layers.${v}`,n,{arrayIndex:-1},m))return;w=o.dt(n,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(w),w.setEventedParent(this,{layer:{id:v}})}const S=o.B(w.source,w.scope);w.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(S),w.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(S);let C=this._order.length;if(c){const B=this._order.indexOf(c);if(B===-1)return void this.fire(new o.y(new Error(`Layer with id "${c}" does not exist on this map.`)));w.slot===this._layers[c].slot?C=B:o.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(C,0,v),this._layerOrderChanged=!0,this._layers[v]=w;const j=this.getOwnLayerSourceCache(w),M=!!this.directionalLight&&this.directionalLight.shadowsEnabled();j&&w.canCastShadows()&&M&&(j.castsShadows=!0);const D=this._changes.getRemovedLayer(w);if(D&&w.source&&j&&w.type!=="custom"){this._changes.discardLayerRemoval(w);const B=o.B(w.source,w.scope);D.type!==w.type?this._changes.updateSourceCache(B,"clear"):(this._changes.updateSourceCache(B,"reload"),j.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),w.scope=this.scope,this.mergeLayers()}moveLayer(n,c){this._checkLoaded();const m=this._checkLayer(n);if(!m||n===c)return;const v=this._order.indexOf(n);this._order.splice(v,1);let w=this._order.length;if(c){const S=this._order.indexOf(c);if(S===-1)return void this.fire(new o.y(new Error(`Layer with id "${c}" does not exist on this map.`)));m.slot===this._layers[c].slot?w=S:o.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,n),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(n){this._checkLoaded();const c=this._checkLayer(n);if(!c)return;c.setEventedParent(null);const m=this._order.indexOf(n);this._order.splice(m,1),delete this._layers[n],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(c.fqid),this._indoorDependentLayers.delete(c.fqid),this._changes.removeLayer(c);const v=this.getOwnLayerSourceCache(c);if(v&&v.castsShadows){let w=!1;for(const S in this._layers)if(this._layers[S].source===c.source&&this._layers[S].canCastShadows()){w=!0;break}v.castsShadows=w}c.onRemove&&c.onRemove(this.map),this.mergeLayers()}getOwnLayer(n){return this._layers[n]}hasLayer(n){return n in this._mergedLayers}hasLayerType(n){for(const c in this._layers)if(this._layers[c].type===n)return!0;return!1}setLayerZoomRange(n,c,m){this._checkLoaded();const v=this._checkLayer(n);v&&(v.minzoom===c&&v.maxzoom===m||(c!=null&&(v.minzoom=c),m!=null&&(v.maxzoom=m),this._updateLayer(v)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(n,c){this._checkLoaded();const m=this._checkLayer(n);m&&m.slot!==c&&(m.slot=c,this._updateLayer(m))}setFilter(n,c,m={}){this._checkLoaded();const v=this._checkLayer(n);if(v&&!o.bx(v.filter,c))return c==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(gn,`layers.${v.id}.filter`,c,{layerType:v.type},m)||(v.filter=o.dn(c),this._updateLayer(v)))}getFilter(n){const c=this._checkLayer(n);if(c)return o.dn(c.filter)}setLayoutProperty(n,c,m,v={}){this._checkLoaded();const w=this._checkLayer(n);if(w&&!o.bx(w.getLayoutProperty(c),m)){if(m!=null&&(!v||v.validate!==!1)&&wu(w,ev.call(ra,{key:`layers.${n}.layout.${c}`,layerType:w.type,objectKey:c,value:m,styleSpec:o.a6,style:{glyphs:!0,sprite:!0}})))return;w.setLayoutProperty(c,m),w.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid),w.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(w.fqid),this._updateLayer(w)}}setLayerProperty(n,c,m,v={}){this._checkLoaded();const w=this._checkLayer(n);w&&(c==="appearances"?(w.setAppearances(m),this._changes.setDirty()):w.isPaintProperty(c)?this.setPaintProperty(n,c,m,v):this.setLayoutProperty(n,c,m,v))}getLayoutProperty(n,c){const m=this._checkLayer(n);if(m)return m.getLayoutProperty(c)}setPaintProperty(n,c,m,v={}){this._checkLoaded();const w=this._checkLayer(n);if(!w||o.bx(w.getPaintProperty(c),m)||m!=null&&(!v||v.validate!==!1)&&wu(w,Bo.call(ra,{key:`layers.${n}.paint.${c}`,layerType:w.type,objectKey:c,value:m,styleSpec:o.a6})))return;const S=w.setPaintProperty(c,m);w.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid),w.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(w.fqid),S&&this._updateLayer(w),this._changes.updatePaintProperties(w)}getPaintProperty(n,c){const m=this._checkLayer(n);if(m)return m.getPaintProperty(c)}setFeatureState(n,c){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:j,importId:M}=n.target,D=this.getFragmentStyle(M),B=D.getFeaturesetLayers(j);for(const{source:O,sourceLayer:G}of B)D.setFeatureState({id:n.id,source:O,sourceLayer:G},c)}else if("layerId"in n.target){const{layerId:j}=n.target,M=this.getLayer(j);this.setFeatureState({id:n.id,source:M.source,sourceLayer:M.sourceLayer},c)}return}const m=n.source,v=n.sourceLayer,w=this._checkSource(m);if(!w)return;const S=w.type;if(S==="geojson"&&v)return void this.fire(new o.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(S==="vector"&&!v)return void this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new o.y(new Error("The feature id parameter must be provided.")));const C=this.getOwnSourceCaches(m);for(const j of C)j.setFeatureState(v,n.id,c)}removeFeatureState(n,c){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:j,importId:M}=n.target,D=this.getFragmentStyle(M),B=D.getFeaturesetLayers(j);for(const{source:O,sourceLayer:G}of B)D.removeFeatureState({id:n.id,source:O,sourceLayer:G},c)}else if("layerId"in n.target){const{layerId:j}=n.target,M=this.getLayer(j);this.removeFeatureState({id:n.id,source:M.source,sourceLayer:M.sourceLayer},c)}return}const m=n.source,v=this._checkSource(m);if(!v)return;const w=v.type,S=w==="vector"?n.sourceLayer:void 0;if(w==="vector"&&!S)return void this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new o.y(new Error("A feature id is required to remove its specific state property.")));const C=this.getOwnSourceCaches(m);for(const j of C)j.removeFeatureState(S,n.id,c)}getFeatureState(n){if(this._checkLoaded(),"target"in n){let w;if("featuresetId"in n.target){const{featuresetId:S,importId:C}=n.target,j=this.getFragmentStyle(C),M=j.getFeaturesetLayers(S);for(const{source:D,sourceLayer:B}of M){const O=j.getFeatureState({id:n.id,source:D,sourceLayer:B});if(O&&!w)w=O;else if(!o.bx(w,O))return void this.fire(new o.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in n.target){const{layerId:S}=n.target,C=this.getLayer(S);w=this.getFeatureState({id:n.id,source:C.source,sourceLayer:C.sourceLayer})}return w}const c=n.source,m=n.sourceLayer,v=this._checkSource(c);if(v){if(v.type!=="vector"||m)return n.id===void 0&&this.fire(new o.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(c)[0].getFeatureState(m,n.id);this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(n){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,n),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const n=this.getTerrain(),c=n&&this.terrain&&this.terrain.scope===this.scope?n:this.stylesheet.terrain;return o.du({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:c,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},m=>m!==void 0)}_updateFilteredLayers(n){for(const c of Object.values(this._mergedLayers))n(c)&&this._updateLayer(c)}_updateLayer(n){this._changes.updateLayer(n);const c=this.getLayerSourceCache(n),m=o.B(n.source,n.scope),v=this._changes.getUpdatedSourceCaches();n.source&&!v[m]&&c&&c.getSource().type!=="raster"&&(this._changes.updateSourceCache(m,"reload"),c.pause()),n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const c=C=>this._mergedLayers[C].is3D(!!this.terrain),m=this.order,v={},w=[];for(let C=m.length-1;C>=0;C--){const j=m[C];if(c(j)){v[j]=C;for(const M of n){const D=M[j];if(D)for(const B of D)w.push(B)}}}w.sort((C,j)=>j.intersectionZ-C.intersectionZ);const S=[];for(let C=m.length-1;C>=0;C--){const j=m[C];if(c(j))for(let M=w.length-1;M>=0;M--){const D=w[M].feature;if(D.layer&&v[D.layer.id]<C)break;S.push(D),w.pop()}else for(const M of n){const D=M[j];if(D)for(const B of D)S.push(B.feature)}}return S}queryRasterValue(n,c,m){const v=this.getOwnSource(n);return v?v.type!=="raster-array"?(this.fire(new o.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):v.queryRasterArrayValue(c,m):(this.fire(new o.y(new Error(`Source with id "${n}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(n,c,m){let v;c&&!Array.isArray(c)&&c.filter&&(this._validate(gn,"queryRenderedFeatures.filter",c.filter,null,c),v=o.b5(c.filter));const w={},S=D=>{if(ng.has(D.type))return;const B=this.getOwnLayerSourceCache(D),O=w[B.id]=w[B.id]||{sourceCache:B,layers:{},has3DLayers:!1};D.is3D(!!this.terrain)&&(O.has3DLayers=!0),O.layers[D.fqid]=O.layers[D.fqid]||{styleLayer:D,targets:[]},O.layers[D.fqid].targets.push({filter:v})};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new o.y(new Error("parameters.layers must be an Array."))),[];for(const D of c.layers){const B=this._layers[D];if(!B)return this.fire(new o.y(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];S(B)}}else for(const D in this._layers)S(this._layers[D]);const C=this._queryRenderedFeatures(n,w,m),j=this._flattenAndSortRenderedFeatures(C),M=[];for(const D of j)o.dv(D.layer.id)===this.scope&&M.push(D);return M}queryRenderedFeatureset(n,c,m){let v;c&&!Array.isArray(c)&&c.filter&&(this._validate(gn,"queryRenderedFeatures.filter",c.filter,null,c),v=o.b5(c.filter));const w="mock",S=[];if(c&&c.target)S.push(Object.assign({},c,{targetId:w,filter:v}));else{const D=this.getFeaturesetDescriptors();for(const B of D)S.push({targetId:w,filter:v,target:B});for(const{style:B}of this.fragments){const O=B.getFeaturesetDescriptors();for(const G of O)S.push({targetId:w,filter:v,target:G})}}const C=this.queryRenderedTargets(n,S,m),j=[],M=new Set;for(const D of C)for(const B of D.variants[w])fa(B,D,M)||j.push(new o.dw(D,B));return j}queryRenderedTargets(n,c,m){const v={},w=(C,j,M,D)=>{const B=v[j.id]=v[j.id]||{sourceCache:j,layers:{},has3DLayers:!1};if(B.layers[C.fqid]=B.layers[C.fqid]||{styleLayer:C,targets:[]},C.is3D(!!this.terrain)&&(B.has3DLayers=!0),!D)return M.uniqueFeatureID=!1,void B.layers[C.fqid].targets.push(M);B.layers[C.fqid].targets.push(Object.assign({},M,{namespace:D.namespace,properties:D.properties,uniqueFeatureID:D.uniqueFeatureID}))};for(const C of c)if("featuresetId"in C.target){const{featuresetId:j,importId:M}=C.target,D=this.getFragmentStyle(M);if(!D||!D._featuresetSelectors)continue;const B=D._featuresetSelectors[j];if(!B){this.fire(new o.y(new Error(`The featureset '${j}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const O of B){const G=D.getOwnLayer(O.layerId);G&&!ng.has(G.type)&&w(G,D.getOwnLayerSourceCache(G),C,O)}}else if("layerId"in C.target){const{layerId:j}=C.target,M=this.getLayer(j);if(!M||ng.has(M.type))continue;w(M,this.getLayerSourceCache(M),C)}const S=this._queryRenderedFeatures(n,v,m);return this._flattenAndSortRenderedFeatures(S)}_queryRenderedFeatures(n,c,m){const v=[],w=!!this.map._showQueryGeometry,S=ci.createFromScreenPoints(n,m);for(const C in c){const j=pa(S,c[C],this._availableImages,m,w);Object.keys(j).length&&v.push(j)}if(this.placement)for(const C in c){if(!c[C].sourceCache._onlySymbols)continue;const j=Wm(S.screenGeometry,c[C],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(j).length&&v.push(j)}return v}querySourceFeatures(n,c){const m=c&&c.filter;m&&this._validate(gn,"querySourceFeatures.filter",m,null,c);let v=[];const w=this.getOwnSourceCaches(n);for(const S of w)v=v.concat(np(S,c));return v}addSourceType(n,c,m){return ll.getSourceType(n)?m(new Error(`A source type called "${n}" already exists.`)):(ll.setSourceType(n,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:c.workerSourceURL},m):m(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(n,c,m={}){this._checkLoaded();const v=this.light.getLight();let w=!1;for(const C in n)if(!o.bx(n[C],v[C])){w=!0;break}if(!w)return;const S=this._getTransitionParameters();this.light.setLight(n,c,m),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(n,c=1){if(this._checkLoaded(),!n)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),c===0&&delete this.terrain,n===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let m=n;const v=n.source==null;if(c===1){if(this.disableElevatedTerrain)return;if(typeof m.source=="object"){const C="terrain-dem-src";this.addSource(C,m.source),m=o.dn(m),m=Object.assign(m,{source:C})}const w=Object.assign({},m),S={};if(this.terrain&&v){w.source=this.terrain.get().source;const C=this.terrain?this.getFragmentStyle(this.terrain.scope):null;C&&(S.style=C.serialize())}if(this._validate(Ao,"terrain",w,S))return}if(!this.terrain||this.terrain.scope!==this.scope&&!v||this.terrain&&c!==this.terrain.drapeRenderMode){if(!m)return;this._createTerrain(m,c),this.fire(new o.z("data",{dataType:"style"}))}else{const w=this.terrain,S=w.get();for(const C of Object.keys(o.a6.terrain))!m.hasOwnProperty(C)&&o.a6.terrain[C].default&&(m[C]=o.a6.terrain[C].default);for(const C in n)if(!o.bx(n[C],S[C])){w.set(n,this.options),this.stylesheet.terrain=n;const j=this._getTransitionParameters({duration:0});w.updateTransitions(j),this.fire(new o.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const c=this.fog=new Cr(n,this.map.transform,this.scope,this.options);this.stylesheet.fog=c.get();const m=this._getTransitionParameters({duration:0});c.updateTransitions(m)}_createSnow(n){const c=this.snow=new ks(n,this.map.transform,this.scope,this.options);this.stylesheet.snow=c.get();const m=this._getTransitionParameters({duration:0});c.updateTransitions(m)}_createRain(n){const c=this.rain=new ms(n,this.map.transform,this.scope,this.options);this.stylesheet.rain=c.get();const m=this._getTransitionParameters({duration:0});c.updateTransitions(m)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog;if(!o.bx(c.get(),n)){c.set(n,this.options),this.stylesheet.fog=c.get();const m=this._getTransitionParameters({duration:0});c.updateTransitions(m)}}else this._createFog(n);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(n){if(this._checkLoaded(),!n)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const c=this.snow;if(!o.bx(c.get(),n)){c.set(n,this.options),this.stylesheet.snow=c.get();const m=this._getTransitionParameters({duration:0});c.updateTransitions(m)}}else this._createSnow(n);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(n){if(this._checkLoaded(),!n)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const c=this.rain;if(!o.bx(c.get(),n)){c.set(n,this.options),this.stylesheet.rain=c.get();const m=this._getTransitionParameters({duration:0});c.updateTransitions(m)}}else this._createRain(n);this._markersNeedUpdate=!0}_reloadColorTheme(){const n=()=>{for(const v in this._layers)this._layers[v].lut=this._styleColorTheme.lut;for(const v in this._sourceCaches)this._sourceCaches[v].clearTiles()},c=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!c)return this._styleColorTheme.lut=null,void n();const m=this._evaluateColorThemeData(c);this._loadColorTheme(m).then(()=>{this.fire(new o.z("colorthemeset")),n()}).catch(v=>{o.w(`Couldn't set color theme: ${v}`)})}setColorTheme(n){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&o.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=n,this._reloadColorTheme()}setImportColorTheme(n,c){const m=this.getFragmentStyle(n);m&&(m._styleColorTheme.colorThemeOverride=c,m._reloadColorTheme())}_getTransitionParameters(n){return{now:o.o.now(),transition:Object.assign(this.transition,n)}}updateDrapeFirstLayers(){if(!this.terrain)return;const n=[],c=[];for(const m of this._mergedOrder)this.isLayerDraped(this._mergedLayers[m])?n.push(m):c.push(m);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...c)}_createTerrain(n,c){const m=this.terrain=new Ve(n,c,this.scope,this.options,this.map.getWorldview());c===1&&(this.stylesheet.terrain=n),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const v=this._getTransitionParameters({duration:0});m.updateTransitions(v)}_force3DLayerUpdate(){for(const n in this._layers){const c=this._layers[n];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const c=this._layers[n];c.type==="symbol"&&this._updateLayer(c)}}_validate(n,c,m,v,w={}){if(w&&w.validate===!1)return!1;const S=Object.assign({},this.serialize());return wu(this,n.call(ra,Object.assign({key:c,style:S,value:m,styleSpec:o.a6},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.dx.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._mergedLayers)this._mergedLayers[n].setEventedParent(null);for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles(),this._mergedSourceCaches[n].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(n){const c=this.getSourceCaches(n);for(const m of c)m.clearTiles()}clearSources(){for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles()}clearLayers(){for(const n in this._mergedLayers){const c=this._mergedLayers[n];c._clear&&c._clear()}}reloadSource(n){const c=this.getSourceCaches(n);for(const m of c)m.resume(),m.reload()}reloadSources(){for(const n of this.getSources())n.reload&&n.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(n=>{n.modelManager.reloadModels(n.scope)})}updateSources(n){let c;this.directionalLight&&(c=Kb(this.directionalLight));const m=new Set;for(const v in this._mergedLayers){const w=this._mergedLayers[v];w.hasElevation()&&!m.has(w.source)&&m.add(w.source)}for(const v in this._mergedSourceCaches){const w=this._mergedSourceCaches[v],S=m.has(w._source.id);w.update(n,void 0,void 0,c,S)}}_generateCollisionBoxes(){for(const n in this._sourceCaches){const c=this._sourceCaches[n];c.resume(),c.reload()}}_updatePlacement(n,c,m,v,w,S,C=!1){let j=!1,M=!1;const D={},B={};for(const O of this._mergedOrder){const G=this._mergedLayers[O];if(G.type!=="symbol")continue;const X=o.B(G.source,G.scope);let ee=D[X];if(!ee){const ie=this.getLayerSourceCache(G);if(!ie)continue;const ce=ie.getRenderableIds(!0).map(me=>ie.getTileByID(me));B[X]=ce.slice(),ee=D[X]=ce.sort((me,de)=>de.tileID.overscaledZ-me.tileID.overscaledZ||(me.tileID.isLessThan(de.tileID)?-1:1))}const oe=this.crossTileSymbolIndex.addLayer(G,ee,c.center.lng,c.projection);j=j||oe}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),C=C||this._layerOrderChanged||v===0,this._layerOrderChanged&&this.fire(new o.z("neworder")),(C||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.o.now(),c.zoom))&&(this.pauseablePlacement=new ia(c,this._mergedOrder,C,m,v,w,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,D,B,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.o.now()),M=!0),j&&this.pauseablePlacement.placement.setStale()),M||j){this._buildingIndex.onNewFrame(c.zoom);for(let O=0;O<this._mergedOrder.length;O++){const G=this._mergedLayers[this._mergedOrder[O]];if(G.type!=="symbol")continue;const X=this.isLayerClipped(G);this.placement.updateLayerOpacities(G,D[o.B(G.source,G.scope)],O,X?S:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.o.now())}}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}addImport(n,c){this._checkLoaded();const m=this.stylesheet.imports=this.stylesheet.imports||[];if(m.findIndex(({id:w})=>w===n.id)!==-1)return void this.fire(new o.y(new Error(`Import with id '${n.id}' already exists in the map's style.`)));if(!c)return m.push(n),this._loadImports([n],!0);const v=m.findIndex(({id:w})=>w===c);return v===-1&&this.fire(new o.y(new Error(`Import with id "${c}" does not exist on this map.`))),this.stylesheet.imports=m.slice(0,v).concat(n).concat(m.slice(v)),this._loadImports([n],!0,c)}updateImport(n,c){this._checkLoaded();const m=this.stylesheet.imports||[],v=this.getImportIndex(n);return v===-1?this:typeof c=="string"?(this.setImportUrl(n,c),this):(c.url&&c.url!==m[v].url&&this.setImportUrl(n,c.url),o.bx(c.config,m[v].config)||this.setImportConfig(n,c.config,c.data.schema),o.bx(c.data,m[v].data)||this.setImportData(n,c.data),this)}moveImport(n,c){this._checkLoaded();let m=this.stylesheet.imports||[];const v=this.getImportIndex(n);if(v===-1)return this;const w=this.getImportIndex(c);if(w===-1)return this;const S=m[v],C=this.fragments[v];return m=m.filter(({id:j})=>j!==n),this.fragments=this.fragments.filter(({id:j})=>j!==n),this.stylesheet.imports=m.slice(0,w).concat(S).concat(m.slice(w)),this.fragments=this.fragments.slice(0,w).concat(C).concat(this.fragments.slice(w)),this.mergeLayers(),this}setImportUrl(n,c){this._checkLoaded();const m=this.stylesheet.imports||[],v=this.getImportIndex(n);if(v===-1)return this;m[v].url=c;const w=this.fragments[v];return w.style=this._createFragmentStyle(m[v]),w.style.on("style.import.load",()=>this.mergeAll()),w.style.loadURL(c),this}setImportData(n,c){this._checkLoaded();const m=this.getImportIndex(n),v=this.stylesheet.imports||[];return m===-1?this:c?(this.fragments[m].style.setState(c),this._reloadImports(),this):(delete v[m].data,this.setImportUrl(n,v[m].url))}setImportConfig(n,c,m){this._checkLoaded();const v=this.getImportIndex(n),w=this.stylesheet.imports||[];if(v===-1)return this;c?w[v].config=c:delete w[v].config;const S=this.fragments[v];m&&S.style.stylesheet&&(S.style.stylesheet.schema=m);const C=S.style.stylesheet&&S.style.stylesheet.schema;return S.config=c,S.style.updateConfig(c,C),this.updateConfigDependencies(),this}removeImport(n){this._checkLoaded();const c=this.stylesheet.imports||[],m=this.getImportIndex(n);m!==-1&&(c.splice(m,1),this.fragments[m].style._remove(),this.fragments.splice(m,1),this._reloadImports())}getImportIndex(n){const c=(this.stylesheet.imports||[]).findIndex(m=>m.id===n);return c===-1&&this.fire(new o.y(new Error(`Import '${n}' does not exist in the map's style and cannot be updated.`))),c}getLayer(n){return this._mergedLayers[n]}getSources(){const n=[];for(const c in this._mergedOtherSourceCaches){const m=this._mergedOtherSourceCaches[c];m&&n.push(m.getSource())}return n}getSource(n,c){const m=this.getSourceCache(n,c);return m&&m.getSource()}getLayerSource(n){const c=this.getLayerSourceCache(n);return c&&c.getSource()}getSourceCache(n,c){const m=o.B(n,c);return this._mergedOtherSourceCaches[m]}getLayerSourceCache(n){const c=o.B(n.source,n.scope);return n.type==="symbol"?this._mergedSymbolSourceCaches[c]:this._mergedOtherSourceCaches[c]}getSourceCaches(n){if(n==null)return Object.values(this._mergedSourceCaches);const c=[];return this._mergedOtherSourceCaches[n]&&c.push(this._mergedOtherSourceCaches[n]),this._mergedSymbolSourceCaches[n]&&c.push(this._mergedSymbolSourceCaches[n]),c}updateSourceCaches(){const n=this._changes.getUpdatedSourceCaches();for(const c in n){const m=n[c];m==="reload"?this.reloadSource(c):m==="clear"&&this.clearSource(c)}}updateLayers(n){const c=this._changes.getUpdatedPaintProperties();for(const m of c){const v=this.getLayer(m);v&&v.updateTransitions(n)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(n){this.stylesheet.glyphs=n,this.glyphManager.setURL(n)}getImages(n,c,m){this.imageManager.getImages(c.images,c.scope,m),this._updateTilesForChangedImages();const v=S=>{if(S){const C=c.images.map(j=>o.I.toString(j));S.setDependencies(c.tileID.key,c.type,C)}},w=o.B(c.source,c.scope);v(this._mergedOtherSourceCaches[w]),v(this._mergedSymbolSourceCaches[w]),c.images.some(S=>S.iconsetId)&&this.fire(new o.z("data",{dataType:"style"}))}rasterizeImages(n,c,m){this.imageManager.rasterizeImages(c,m)}getGlyphs(n,c,m){this.glyphManager.getGlyphs(c.stacks,m)}getResource(n,c,m){return o.dy(c,m)}getOwnSourceCache(n){return this._otherSourceCaches[n]}getOwnLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}getOwnSourceCaches(n){const c=[];return this._otherSourceCaches[n]&&c.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&c.push(this._symbolSourceCaches[n]),c}_isSourceCacheLoaded(n){const c=this.getOwnSourceCaches(n);return c.length===0?(this.fire(new o.y(new Error(`There is no source with ID '${n}'`))),!1):c.every(m=>m.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(n,c){if(!this._clipLayerPresent&&n.type!=="fill-extrusion"&&n.type!=="building")return!1;const m=n.type==="fill-extrusion"&&(n.sourceLayer==="building"||n.sourceLayer==="procedural_buildings"),v=n.type==="building";if(n.is3D(!!this.terrain)){if(m||v||c&&c.type==="batched-model"||n.type==="model")return!0}else if(n.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(n=>{n.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ll.getSourceType=function(p){return nl[p]},ll.setSourceType=function(p,n){nl[p]=n},ll.registerForPluginStateChange=o.dz;class fd extends o.E{constructor(n){super(),this._style=n,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},o.aX(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(n){n===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=n,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(n){this._activeFloorsVisible=n,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(n){for(const[c,m]of Object.entries(n.buildings))if(this._buildings[c])for(const v of m.floorIds)this._buildings[c].floors[v]||(this._buildings[c].floors[v]=m.floors[v]);else this._buildings[c]=m;for(const c of n.activeFloors)this._activeFloors.add(c);this._updateIndoorSelector()}getIndoorTileOptions(n,c){const m=this._style.getIndoorSourceLayers(n,c);return m&&this._indoorState?{sourceLayers:m,indoorState:this._indoorState}:null}_updateUI(n,c,m){const v=function(w,S,C,j){let M=null,D=Number.MAX_SAFE_INTEGER;if(j<16)return null;for(const[B,O]of Object.entries(w)){const G=O.center;if(G){const X=S.distanceTo(o.aS.convert(G));X<D&&C.contains(G)&&(D=X,M=B)}}return M}(this._buildings,c,m,n);v!==this._closestBuildingId&&(this._closestBuildingId=v,this._updateIndoorSelector())}_updateIndoorSelector(){const n=this._buildings,c=this._closestBuildingId,m=c&&n?n[c]:void 0;if(!m)return void this.fire(new o.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let v=null;for(const S of m.floorIds)if(this._activeFloors&&this._activeFloors.has(S)){v=S;break}const w=Array.from(m.floorIds).map(S=>({id:S,name:m.floors[S].name,zIndex:m.floors[S].zIndex})).sort((S,C)=>C.zIndex-S.zIndex);this.fire(new o.z("selector-update",{selectedFloorId:v,activeFloorsVisible:this._activeFloorsVisible,floors:w}))}_updateActiveFloors(){const n=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:n,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var Tp=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,mv=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,gv=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,dh="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",hh=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,_v=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,ig=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Pa=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,sg=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Vt=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,yv=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const fh=[];cl(Tp,fh),cl(gv,fh),cl(mv,fh);const ph={"_prelude_fog.vertex.glsl":_v,"_prelude_terrain.vertex.glsl":hh,"_prelude_shadow.vertex.glsl":Vt,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":ig,"_prelude_shadow.fragment.glsl":yv,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Pa,"_prelude_raster_particle.glsl":sg},Ep={};En("",hh),En(ig,_v),En(yv,Vt),En(Pa,""),En(sg,"");const Cp=En(mv,gv),ic=Tp;var og={background:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:En(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:En(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:En("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:En(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:En(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:En("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:En("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:En("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:En(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:En(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:En(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:En(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:En(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:En(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:En("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:En("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:En(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:En(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:En("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:En(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,dh),skyboxGradient:En(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,dh),skyboxCapture:En(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:En(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:En(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:En(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:En(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:En("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:En("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:En("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:En("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function cl(p,n){const c=p.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let m of c)if(m=m.trim(),m[0]==="#"&&m.includes("if")&&!m.includes("endif")){m=m.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const v=m.split(" ");for(const w of v)n.includes(w)||n.push(w)}}function En(p,n){const c=/#include\s+"([^"]+)"/g,m=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,v={},w=[],S=[];if(p=p.replace(c,(j,M)=>(S.push(M),"")),(n=n.replace(c,(j,M)=>(w.push(M),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let C=[...fh];cl(p,C),cl(n,C);for(const j of[...w,...S])ph[j]||console.error(`Undefined include: ${j}`),Ep[j]||(Ep[j]=[],cl(ph[j],Ep[j])),C=[...C,...Ep[j]];return{fragmentSource:p=p.replace(m,(j,M,D,B,O)=>(v[O]=!0,M==="define"?`
#ifndef HAS_UNIFORM_u_${O}
in ${D} ${B} ${O};
#else
uniform ${D} ${B} u_${O};
#endif
`:M==="initialize"?`
#ifdef HAS_UNIFORM_u_${O}
    ${D} ${B} ${O} = u_${O};
#endif
`:M==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    in ${D} ${B} ${O};
#endif
`:M==="initialize-attribute"?"":void 0)),vertexSource:n=n.replace(m,(j,M,D,B,O)=>{const G=`MATERIAL_ATTRIBUTE_OFFSET_${O}`,X=B==="float"?"vec2":B,ee=`GET_ATTRIBUTE_${X}(a_${O}, materialInfo, ${G})`,oe=O.match(/color/)?"color":X;return M==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${O}
in ${D} ${B} a_${O};
#endif
`:v[O]?M==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
    #if !defined(${G})
        in ${D} ${X} a_${O};
    #endif
out ${D} ${B} ${O};
#else
uniform ${D} ${B} u_${O};
#endif
`:M==="initialize"?oe==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = a_${O};
#else
    ${D} ${B} ${O} = u_${O};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${O}) 
    #ifdef ${G}
        ${O} = unpack_mix_${oe}(${ee}, u_${O}_t);
    #else
        ${O} = unpack_mix_${oe}(a_${O}, u_${O}_t);
    #endif
#else
    ${D} ${B} ${O} = u_${O};
#endif
`:M==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    in ${D} ${B} a_${O};
    out ${D} ${B} ${O};
#endif
`:M==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    ${O} = a_${O};
#endif
`:void 0:M==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
    #if !defined(${G})
        in ${D} ${X} a_${O};
    #endif  
#else
uniform ${D} ${B} u_${O};
#endif
`:M==="define-instanced"?oe==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${O}0;
in vec4 a_${O}1;
in vec4 a_${O}2;
in vec4 a_${O}3;
#else
uniform ${D} ${B} u_${O};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${D} ${X} a_${O};
#else
uniform ${D} ${B} u_${O};
#endif
`:M==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    ${D} ${B} ${O} = a_${O};
#endif
`:oe==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    #ifdef ${G}
        ${D} ${B} ${O} = ${ee};
    #else
        ${D} ${B} ${O} = a_${O};
    #endif
#else
    ${D} ${B} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    #ifdef ${G}
        ${D} ${B} ${O} = unpack_mix_${oe}(${ee}, u_${O}_t);
    #else
        ${D} ${B} ${O} = unpack_mix_${oe}(a_${O}, u_${O}_t);
    #endif
#else
    ${D} ${B} ${O} = u_${O};
#endif
`}),usedDefines:C,vertexIncludes:w,fragmentIncludes:S}}class mh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,c,m,v,w,S,C,j){this.context=n;let M=this.boundPaintVertexBuffers.length!==v.length;for(let B=0;!M&&B<v.length;B++)this.boundPaintVertexBuffers[B]!==v[B]&&(M=!0);let D=this.boundDynamicVertexBuffers.length!==C.length;for(let B=0;!D&&B<C.length;B++)this.boundDynamicVertexBuffers[B]!==C[B]&&(D=!0);if(!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==m||M||D||this.boundIndexBuffer!==w||this.boundVertexOffset!==S)this.freshBind(c,m,v,w,S,C,j);else{n.bindVertexArrayOES.set(this.vao);for(const B of C)B&&(B.bind(),j&&B.instanceCount&&B.setVertexAttribDivisor(n.gl,c,j));w&&w.dynamicDraw&&w.bind()}}freshBind(n,c,m,v,w,S,C){const j=this.context,M=j.gl;this.vao&&this.destroy(),this.vao=j.gl.createVertexArray(),j.bindVertexArrayOES.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=v,this.boundVertexOffset=w,this.boundDynamicVertexBuffers=S,c.enableAttributes(M,n),c.bind(),c.setVertexAttribPointers(M,n,w);for(const D of m)D.enableAttributes(M,n),D.bind(),D.setVertexAttribPointers(M,n,w);for(const D of S)D&&(D.enableAttributes(M,n),D.bind(),D.setVertexAttribPointers(M,n,w),C&&D.instanceCount&&D.setVertexAttribDivisor(M,n,C));v&&v.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Z2(p,n){const c=Math.pow(2,n.canonical.z),m=n.canonical.y;return[new o.ae(0,m/c).toLngLat().lat,new o.ae(0,(m+1)/c).toLngLat().lat]}function X2(p,n,c,m,v,w,S){const C=p.context,j=C.gl,M=c.hillshadeFBO;if(!M)return;p.prepareDrawTile();const D=p.isTileAffectedByFog(n),B=p.getOrCreateProgram("hillshade",{overrideFog:D});C.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,M.colorAttachment.get());const O=((oe,ie,ce,me)=>{const de=ce.paint.get("hillshade-shadow-color"),Ee=ce.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",ge=ce.paint.get("hillshade-highlight-color"),je=ce.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Se=ce.paint.get("hillshade-accent-color"),ve=ce.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ie=ce.paint.get("hillshade-emissive-strength");let $e=o.an(ce.paint.get("hillshade-illumination-direction"));if(ce.paint.get("hillshade-illumination-anchor")==="viewport")$e-=oe.transform.angle;else if(oe.style&&oe.style.enable3dLights()&&oe.style.directionalLight){const at=oe.style.directionalLight.properties.get("direction"),Qe=o.d3(at.x,at.y,at.z);$e=o.an(Qe[1])}const Fe=!oe.options.moving;return{u_matrix:me||oe.transform.calculateProjMatrix(ie.tileID.toUnwrapped(),Fe),u_image:0,u_latrange:Z2(0,ie.tileID),u_light:[ce.paint.get("hillshade-exaggeration"),$e],u_shadow:de.toPremultipliedRenderColor(Ee?null:ce.lut),u_highlight:ge.toPremultipliedRenderColor(je?null:ce.lut),u_emissive_strength:Ie,u_accent:Se.toPremultipliedRenderColor(ve?null:ce.lut)}})(p,c,m,p.terrain?n.projMatrix:null);p.uploadCommonUniforms(C,B,n.toUnwrapped());const{tileBoundsBuffer:G,tileBoundsIndexBuffer:X,tileBoundsSegments:ee}=p.getTileBoundsBuffers(c);B.draw(p,j.TRIANGLES,v,w,S,qr.disabled,O,m.id,G,X,ee)}function ag(p,n,c){if(!n.needsDEMTextureUpload)return;const m=p.context,v=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||p.getTileTexture(c.stride);const w=c.getPixels();n.demTexture?n.demTexture.update(w,{premultiply:!1}):n.demTexture=new o.T(m,w,v.R32F,{premultiply:!1}),n.needsDEMTextureUpload=!1}function K2(p,n,c){const m=p.context,v=m.gl;if(!n.dem)return;const w=n.dem;if(m.activeTexture.set(v.TEXTURE1),ag(p,n,w),!n.demTexture)return;n.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE);const S=w.dim;m.activeTexture.set(v.TEXTURE0);let C=n.hillshadeFBO;if(!C){const O=new o.T(m,{width:S,height:S,data:null},v.RGBA8);O.bind(v.LINEAR,v.CLAMP_TO_EDGE),C=n.hillshadeFBO=m.createFramebuffer(S,S,!0,"renderbuffer"),C.colorAttachment.set(O.texture)}m.bindFramebuffer.set(C.framebuffer),m.viewport.set([0,0,S,S]);const{tileBoundsBuffer:j,tileBoundsIndexBuffer:M,tileBoundsSegments:D}=p.getMercatorTileBoundsBuffers(),B=[];p.linearFloatFilteringSupported()&&B.push("TERRAIN_DEM_FLOAT_FORMAT"),p.getOrCreateProgram("hillshadePrepare",{defines:B}).draw(p,v.TRIANGLES,hr.disabled,Kr.disabled,un.unblended,qr.disabled,((O,G)=>{const X=G.stride,ee=o.bB();return o.cd(ee,0,o.al,-o.al,0,0,1),o.bq(ee,ee,[0,-o.al,0]),{u_matrix:ee,u_image:1,u_dimension:[X,X],u_zoom:O.overscaledZ}})(n.tileID,w),c.id,j,M,D),n.needsHillshadePrepare=!1}class Wi{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Qb extends Wi{getDefault(){return o.ao.transparent.toNonPremultipliedRenderColor(null)}set(n){const c=this.current;(n.r!==c.r||n.g!==c.g||n.b!==c.b||n.a!==c.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class vv extends Wi{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class Y2 extends Wi{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class J2 extends Wi{getDefault(){return[!0,!0,!0,!0]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||n[3]!==c[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Q2 extends Wi{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class eE extends Wi{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class ew extends Wi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const c=this.current;(n.func!==c.func||n.ref!==c.ref||n.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class tE extends Wi{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class lg extends Wi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=n,this.dirty=!1}}class rE extends Wi{getDefault(){return[0,1]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class tw extends Wi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=n,this.dirty=!1}}class xv extends Wi{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class cg extends Wi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.BLEND):c.disable(c.BLEND),this.current=n,this.dirty=!1}}class bv extends Wi{getDefault(){const n=this.gl;return[n.ONE,n.ZERO,n.ONE,n.ZERO]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||n[3]!==c[3]||this.dirty)&&(this.gl.blendFuncSeparate(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class pd extends Wi{getDefault(){return o.ao.transparent.toNonPremultipliedRenderColor(null)}set(n){const c=this.current;(n.r!==c.r||n.g!==c.g||n.b!==c.b||n.a!==c.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class gh extends Wi{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(n,n),this.current=n,this.dirty=!1)}}class Ap extends Wi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=n,this.dirty=!1}}class _h extends Wi{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class rw extends Wi{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let wv=class extends Wi{getDefault(){return null}set(p){(p!==this.current||this.dirty)&&(this.gl.useProgram(p),this.current=p,this.dirty=!1)}};class nw extends Wi{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class yh extends Wi{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||n[3]!==c[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class ug extends Wi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class dg extends Wi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Sv extends Wi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class hg extends Wi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class jp extends Wi{getDefault(){return null}set(n){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class iw extends Wi{getDefault(){return null}set(n){this.gl&&(n!==this.current||this.dirty)&&(this.gl.bindVertexArray(n),this.current=n,this.dirty=!1)}}class sw extends Wi{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class ow extends Wi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class vh extends Wi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class fg extends Wi{constructor(n,c){super(n),this.context=n,this.parent=c}getDefault(){return null}}class nE extends fg{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class aw extends fg{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class iE extends fg{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachment(),c.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Tv extends aw{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Ev=(p,n,c)=>({u_matrix:p,u_image0:0,u_skirt_height:n,u_ground_shadow_factor:c}),pg=(p,n,c,m,v,w,S,C,j,M,D,B,O,G,X,ee)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:c,u_zoom_transition:v,u_merc_center:w,u_image0:0,u_frustum_tl:S,u_frustum_tr:C,u_frustum_br:j,u_frustum_bl:M,u_globe_pos:D,u_globe_radius:B,u_viewport:O,u_grid_matrix:ee?Float32Array.from(ee):new Float32Array(9),u_skirt_height:G,u_far_z_cutoff:X});function mg(p,n){return p!=null&&n!=null&&!(!p.hasData()||!n.hasData())&&p.demTexture!=null&&n.demTexture!=null&&p.tileID.key!==n.tileID.key}const md=new class{constructor(){this.operations={}}newMorphing(p,n,c,m,v){if(p in this.operations){const w=this.operations[p];w.to.tileID.key!==c.tileID.key&&(w.queued=c)}else this.operations[p]={startTime:m,phase:0,duration:v,from:n,to:c,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const n=this.operations[p];return{from:n.from,to:n.to,phase:n.phase}}update(p){for(const n in this.operations){const c=this.operations[n];for(c.phase=(p-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,p)){delete this.operations[n];break}}}_nextOp(p,n){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=n,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},Cv={0:null,1:"TERRAIN_VERTEX_MORPHING"};function lw(p,n,c){if(n===0)return 0;const m=n<1&&c===514?.25/n:1;return 6*Math.pow(1.5,22-p)*Math.max(n,1)*m}function Ip(p,n){const c=1<<p.z;return!n&&(p.x===0||p.x===c-1)||p.y===0||p.y===c-1}const gd=p=>({u_matrix:p});function gg(p,n,c,m,v){if(v>0){const w=o.o.now(),S=(w-p.timeAdded)/v,C=n?(w-n.timeAdded)/v:-1,j=c.getSource(),M=m.coveringZoomLevel({tileSize:j.tileSize,roundZoom:j.roundZoom}),D=!n||Math.abs(n.tileID.overscaledZ-M)>Math.abs(p.tileID.overscaledZ-M),B=D&&p.refreshedUponExpiration?1:o.aA(D?S:1-C,0,1);return n?{opacity:1,mix:1-B,isFading:S<1}:{opacity:B,mix:0,isFading:S<1}}return{opacity:1,mix:0,isFading:!1}}class Ra extends il{constructor(n){const c=Xo("mock-dem",{type:"raster-dem",maxzoom:n.transform.maxZoom},n.style.dispatcher,n.style);super("mock-dem",c,!1),c.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,c){n.state="loaded",c(null)}}class Av extends il{constructor(n){const c=Xo("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},n.style.dispatcher,n.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,c,m){if(n.freezeTileCoverage)return;this.transform=n;const v=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((w,S)=>{if(w[S.key]="",!this._tiles[S.key]){const C=new tc(S,this._source.tileSize*S.overscaleFactor(),n.tileZoom,void 0,void 0,this._source.worldview);C.state="loaded",this._tiles[S.key]=C}return w},{});for(const w in this._tiles)w in v||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(n){const c=this.proxyCachedFBO[n];if(c!==void 0){const m=Object.values(c);this.renderCachePool.push(...m),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class kp extends o.aP{constructor(n,c,m){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=c,this.projMatrix=m}}class Pp extends o.bU{constructor(n,c){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},n.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,v,w]=function(j){const M=new o.bc,D=new o.b0,B=131;M.reserve(17161),D.reserve(33800);const O=o.al/128,G=o.al+O/2,X=G+O;for(let oe=-O;oe<X;oe+=O)for(let ie=-O;ie<X;ie+=O){const ce=ie<0||ie>G||oe<0||oe>G?24575:0,me=o.aA(Math.round(ie),0,o.al),de=o.aA(Math.round(oe),0,o.al);M.emplaceBack(me+ce,de)}const ee=(oe,ie)=>{const ce=ie*B+oe;D.emplaceBack(ce+1,ce,ce+B),D.emplaceBack(ce+B,ce+B+1,ce+1)};for(let oe=1;oe<129;oe++)for(let ie=1;ie<129;ie++)ee(ie,oe);return[0,129].forEach(oe=>{for(let ie=0;ie<130;ie++)ee(ie,oe),ee(oe,ie)}),[M,D,32768]}(),S=n.context;this.gridBuffer=S.createVertexBuffer(m,o.be.members),this.gridIndexBuffer=S.createIndexBuffer(v),this.gridSegments=o.bf.simpleSegment(0,0,m.length,v.length),this.gridNoSkirtSegments=o.bf.simpleSegment(0,0,m.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Av(c.map),this.orthoMatrix=o.bB(),o.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.al,0,o.al,0,1);const C=S.gl;this._overlapStencilMode=new Kr({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ra(c.map),this._pendingGroundEffectLayers=[]}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),this._style=n,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,c,m){if(n&&n.terrain){this._style!==n&&(this.style=n,this._evaluationZoom=void 0);const v=n.terrain.properties,w=n.terrain.drapeRenderMode===0,S=n.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.o.now();const C=n.terrain&&n.terrain.scope,j=v.get("source"),M=w?this._mockSourceCache:n.getSourceCache(j,C);if(!M)return void o.w(`Couldn't find terrain source "${j}".`);if(this.sourceCache=M,this._attenuationRange=n.terrain.getAttenuationRange(),this._exaggeration=S?this.calculateExaggeration(c):v.get("exaggeration"),!c.projection.requiresDraping&&S&&this._exaggeration===0)return void this._disable();this.enabled=!0;const D=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const B=this.getScaledDemTileSize();this.sourceCache.update(c,B,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,D(),this._initializing=!0),D(),c.updateElevation(!0,m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0,this._previousZoom=c.zoom}else this._disable()}calculateExaggeration(n){if(this._attenuationRange&&n.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(n.zoom);const c=this._previousCameraAltitude,m=n.getFreeCameraOptions().position.z/n.pixelsPerMeter*n.worldSize;this._previousCameraAltitude=m;const v=c!=null?m-c:Number.MAX_VALUE;if(Math.abs(v)<2)return this._exaggeration;const w=n.zoom,S=this._style.terrain;if(!this._previousUpdateTimestamp)return S.getExaggeration(w);let C=w-this._previousZoom;const j=this._previousUpdateTimestamp;let M=w;this._evaluationZoom!=null&&(M=this._evaluationZoom,Math.abs(w-M)>.5&&(C=.5*(w-M+C)),C*v<0&&(M+=C)),this._evaluationZoom=M;const D=S.getExaggeration(M),B=D===S.getExaggeration(Math.max(0,M-.1));if(B&&Math.abs(D-this._exaggeration)<.01)return D;let O=Math.min(.1,.00375*(this._updateTimestamp-j));return(B||D<.1||Math.abs(C)<1e-4)&&(O=Math.min(.2,4*O)),o.ak(this._exaggeration,D,O)}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(n){n.dataType==="source"&&n.coord?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._mergedSourceCaches)this._style._mergedSourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=m._centerAltitude===0&&this.getAtPointOrZero(o.ae.fromLngLat(m.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=c.getIds().map(j=>{const M=c.getTileByID(j).tileID;return M.projMatrix=m.calculateProjMatrix(M.toUnwrapped()),M});(function(j,M){const D=M.transform.pointCoordinate(M.transform.getCameraPoint()),B=new o.P(D.x,D.y);j.sort((O,G)=>{if(G.overscaledZ-O.overscaledZ)return G.overscaledZ-O.overscaledZ;const X=new o.P(O.canonical.x+(1<<O.canonical.z)*O.wrap,O.canonical.y),ee=new o.P(G.canonical.x+(1<<G.canonical.z)*G.wrap,G.canonical.y),oe=B.mult(1<<O.canonical.z);return oe.x-=.5,oe.y-=.5,oe.distSqr(X)-oe.distSqr(ee)})})(v,this.painter);const w=this.proxyToSource||{};this.proxyToSource={},v.forEach(j=>{this.proxyToSource[j.key]={}}),this.terrainTileForTile={};const S=this._style._mergedSourceCaches;for(const j in S){const M=S[j];if(!M.used||(M!==this.sourceCache&&this.resetTileLookupCache(M.id),this._setupProxiedCoordsForOrtho(M,n[j],w),M.usedForTerrain))continue;const D=n[j];M.getSource().reparseOverscaled&&this._assignTerrainTiles(D)}this.proxiedCoords[c.id]=v.map(j=>new kp(j,j.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1;const C={};this._visibleDemTiles=[];for(const j of this.proxyCoords){const M=this.terrainTileForTile[j.key];if(!M)continue;const D=M.tileID.key;D in C||(this._visibleDemTiles.push(M),C[D]=D)}}_assignTerrainTiles(n){this._initializing||n.forEach(c=>{if(this.terrainTileForTile[c.key])return;const m=this._findTileCoveringTileID(c,this.sourceCache);m&&(this.terrainTileForTile[c.key]=m)})}_prepareDEMTextures(){const n=this.painter.context,c=n.gl;for(const m in this.terrainTileForTile){const v=this.terrainTileForTile[m],w=v.dem;!w||v.demTexture&&!v.needsDEMTextureUpload||(n.activeTexture.set(c.TEXTURE1),ag(this.painter,v,w))}}_prepareDemTileUniforms(n,c,m,v){if(!c||c.demTexture==null)return!1;const w=n.tileID.canonical,S=Math.pow(2,c.tileID.canonical.z-w.z),C=v||"";return m[`u_dem_tl${C}`]=[w.x*S%1,w.y*S%1],m[`u_dem_scale${C}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let n=0;const c=this._visibleDemTiles.reduce((m,v)=>{if(!v.dem)return m;const w=v.dem.tree.minimums[0];return w>0&&n++,m+w},0);return n?c/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,c=n.gl;n.activeTexture.set(c.TEXTURE2);const m=this._getLoadedAreaMinimum(),v=new o.dK({width:1,height:1},new Float32Array([m]));this._emptyDEMTextureDirty=!1;let w=this._emptyDEMTexture;return w?w.update(v,{premultiply:!1}):w=this._emptyDEMTexture=new o.T(n,v,c.R32F,{premultiply:!1}),w}setupElevationDraw(n,c,m){const v=this.painter.context,w=v.gl,S={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};S.u_exaggeration=this.exaggeration();let C=null,j=null,M=1;if(m&&m.morphing&&this._useVertexMorphing){const G=m.morphing.srcDemTile,X=m.morphing.dstDemTile;M=m.morphing.phase,G&&X&&(this._prepareDemTileUniforms(n,G,S,"_prev")&&(j=G),this._prepareDemTileUniforms(n,X,S)&&(C=X))}const D=G=>G&&G.demTexture&&this.painter.linearFloatFilteringSupported()?w.LINEAR:w.NEAREST;let B=null;var O;if(this.enabled?j&&C?(B=C.demTexture,v.activeTexture.set(w.TEXTURE4),j.demTexture.bind(D(j),w.CLAMP_TO_EDGE),S.u_dem_lerp=M):(C=this.terrainTileForTile[n.tileID.key],B=this._prepareDemTileUniforms(n,C,S)?C.demTexture:this.emptyDEMTexture):B=this.emptyDEMTexture,v.activeTexture.set(w.TEXTURE2),B&&(S.u_dem_size=(O=B).size[0]===1?1:O.size[0]-2,B.bind(D(C),w.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(m&&m.useDepthForOcclusion,c,S),m&&m.useMeterToDem&&C){const G=(1<<C.tileID.canonical.z)*o.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=G}if(m&&m.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),c.setTerrainUniformValues(v,S),this.painter.transform.projection.name==="globe"){const G=this.globeUniformValues(this.painter.transform,n.tileID.canonical,m&&m.useDenormalizedUpVectorScale);c.setGlobeUniformValues(v,G)}}globeUniformValues(n,c,m){const v=n.projection;return{u_tile_tl_up:v.upVector(c,0,0),u_tile_tr_up:v.upVector(c,o.al,0),u_tile_br_up:v.upVector(c,o.al,o.al),u_tile_bl_up:v.upVector(c,0,o.al),u_tile_up_scale:m?o.dL(1):v.upVectorScale(c,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const c=this.painter,m=this.painter.context;n.length!==0&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,w,S,C,j){if(v.transform.projection.name==="globe")(function(M,D,B,O,G){const X=M.context,ee=X.gl;let oe,ie;const ce=M.transform,me=o.dD(M,X,ce),de=(at,Qe)=>{if(ie===Qe)return;const pt=[Cv[Qe],"PROJECTION_GLOBE_VIEW"];me&&pt.push("CUSTOM_ANTIALIASING");const Ot=M.isTileAffectedByFog(at);oe=M.getOrCreateProgram("globeRaster",{defines:pt,overrideFog:Ot}),ie=Qe},Ee=M.colorModeForRenderPass(),ge=new hr(ee.LEQUAL,hr.ReadWrite,M.depthRangeFor3D);md.update(G);const je=o.dE(ce),Se=[o.aF(ce.center.lng),o.aJ(ce.center.lat)],ve=M.globeSharedBuffers,Ie=[ce.width*o.o.devicePixelRatio,ce.height*o.o.devicePixelRatio],$e=Float32Array.from(ce.globeMatrix),Fe={useDenormalizedUpVectorScale:!0};{const at=M.transform,Qe=lw(at.zoom,D.exaggeration(),D.sourceCache._source.tileSize);ie=-1;const pt=ee.TRIANGLES;for(const Ot of O){const Ye=B.getTile(Ot),Oe=Kr.disabled,mt=D.prevTerrainTileForTile[Ot.key],et=D.terrainTileForTile[Ot.key];mg(mt,et)&&md.newMorphing(Ot.key,mt,et,G,250),X.activeTexture.set(ee.TEXTURE0),Ye.texture&&Ye.texture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE);const Et=md.getMorphValuesForProxy(Ot.key),$t=Et?1:0;Et&&Object.assign(Fe,{morphing:{srcDemTile:Et.from,dstDemTile:Et.to,phase:o.dC(Et.phase)}});const lr=o.dF(Ot.canonical),Mt=o.dG(lr.getCenter().lat),zt=o.dH(Ot.canonical,lr,Mt,at.worldSize/at._pixelsPerMercatorPixel),ur=o.bj(o.dI(Ot.canonical)),nr=pg(at.expandedFarZProjMatrix,$e,je,ur,o.aj(at.zoom),Se,at.frustumCorners.TL,at.frustumCorners.TR,at.frustumCorners.BR,at.frustumCorners.BL,at.globeCenterInViewSpace,at.globeRadius,Ie,Qe,at._farZ,zt);if(de(Ot,$t),oe&&(D.setupElevationDraw(Ye,oe,Fe),M.uploadCommonUniforms(X,oe,Ot.toUnwrapped()),ve)){const[er,ir,kr]=ve.getGridBuffers(Mt,Qe!==0);oe.draw(M,pt,ge,Oe,Ee,qr.backCCW,nr,"globe_raster",er,ir,kr)}}}if(ve&&(M.renderDefaultNorthPole||M.renderDefaultSouthPole)){const at=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];me&&at.push("CUSTOM_ANTIALIASING"),oe=M.getOrCreateProgram("globeRaster",{defines:at});for(const Qe of O){const{x:pt,y:Ot,z:Ye}=Qe.canonical,Oe=Ot===0,mt=Ot===(1<<Ye)-1,[et,Et,$t,lr]=ve.getPoleBuffers(Ye,!1);if(lr&&(Oe||mt)){const Mt=B.getTile(Qe);X.activeTexture.set(ee.TEXTURE0),Mt.texture&&Mt.texture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE);let zt=o.dJ(Ye,pt,ce);const ur=o.bj(o.dI(Qe.canonical)),nr=(er,ir)=>er.draw(M,ee.TRIANGLES,ge,Kr.disabled,Ee,qr.disabled,pg(ce.expandedFarZProjMatrix,zt,zt,ur,0,Se,ce.frustumCorners.TL,ce.frustumCorners.TR,ce.frustumCorners.BR,ce.frustumCorners.BL,ce.globeCenterInViewSpace,ce.globeRadius,Ie,0,ce._farZ),"globe_pole_raster",ir,$t,lr);D.setupElevationDraw(Mt,oe,Fe),M.uploadCommonUniforms(X,oe,Qe.toUnwrapped()),Oe&&M.renderDefaultNorthPole&&nr(oe,et),mt&&M.renderDefaultSouthPole&&(zt=o.cR(o.bB(),zt,[1,-1,1]),nr(oe,Et))}}}})(v,w,S,C,j);else{const M=v.context,D=M.gl;let B,O;const G=v.shadowRenderer,X=Mc(v,v.longestCutoffRange),ee=Ee=>{if(O===Ee)return;const ge=[];ge.push(Cv[Ee]),X.shouldRenderCutoff&&ge.push("RENDER_CUTOFF"),G&&(ge.push("RENDER_SHADOWS","DEPTH_TEXTURE"),G.useNormalOffset&&ge.push("NORMAL_OFFSET")),B=v.getOrCreateProgram("terrainRaster",{defines:ge}),O=Ee},oe=v.colorModeForRenderPass(),ie=new hr(D.LEQUAL,hr.ReadWrite,v.depthRangeFor3D);md.update(j);const ce=v.transform,me=lw(ce.zoom,w.exaggeration(),w.sourceCache._source.tileSize);let de=[0,0,0];if(G){const Ee=v.style.directionalLight,ge=v.style.ambientLight;Ee&&ge&&(de=al(v.style,Ee,ge))}{O=-1;const Ee=D.TRIANGLES,[ge,je]=[w.gridIndexBuffer,w.gridSegments];for(const Se of C){const ve=S.getTile(Se),Ie=Kr.disabled,$e=w.prevTerrainTileForTile[Se.key],Fe=w.terrainTileForTile[Se.key];mg($e,Fe)&&md.newMorphing(Se.key,$e,Fe,j,250),M.activeTexture.set(D.TEXTURE0),ve.texture&&ve.texture.bind(D.LINEAR,D.CLAMP_TO_EDGE);const at=md.getMorphValuesForProxy(Se.key),Qe=at?1:0;let pt;at&&(pt={morphing:{srcDemTile:at.from,dstDemTile:at.to,phase:o.dC(at.phase)}});const Ot=Ev(Se.projMatrix,Ip(Se.canonical,ce.renderWorldCopies)?me/10:me,de);if(ee(Qe),!B)continue;w.setupElevationDraw(ve,B,pt);const Ye=Se.toUnwrapped();G&&G.setupShadows(Ye,B),v.uploadCommonUniforms(M,B,Ye,null,X),B.draw(v,Ee,ie,Ie,oe,qr.backCCW,Ot,"terrain_raster",w.gridBuffer,ge,je)}}}}(c,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const c=this.painter,m=this.painter.context,v=this.proxySourceCache,w=this.proxiedCoords[v.id],S=this._drapedRenderBatches.shift(),C=c.style.order,j=[];let M=0;for(const D of w){const B=v.getTileByID(D.proxyTileKey),O=v.proxyCachedFBO[D.key]?v.proxyCachedFBO[D.key][n]:void 0,G=O!==void 0?v.renderCache[O]:this.pool[M++],X=O!==void 0;if(B.texture=G.tex,X&&!G.dirty){j.push(B.tileID);continue}let ee;m.bindFramebuffer.set(G.fb.framebuffer),this.renderedToTile=!1,G.dirty&&(m.clear({color:o.ao.transparent,stencil:0}),G.dirty=!1);for(let oe=S.start;oe<=S.end;++oe){const ie=c.style._mergedLayers[C[oe]];if(ie.isHidden(c.transform.zoom))continue;const ce=c.style.getLayerSourceCache(ie),me=ce?this.proxyToSource[D.key][ce.id]:[D];if(!me)continue;const de=me;m.viewport.set([0,0,G.fb.width,G.fb.height]),ee!==(ce?ce.id:null)&&(this._setupStencil(G,me,ie,ce),ee=ce?ce.id:null),c.renderLayer(c,ce,ie,de)}if(this._drapedRenderBatches.length===0)for(const oe of this._pendingGroundEffectLayers){const ie=c.style._mergedLayers[C[oe]];if(ie.isHidden(c.transform.zoom))continue;const ce=c.style.getLayerSourceCache(ie),me=ce?this.proxyToSource[D.key][ce.id]:[D];if(!me)continue;const de=me;m.viewport.set([0,0,G.fb.width,G.fb.height]),ee!==(ce?ce.id:null)&&(this._setupStencil(G,me,ie,ce),ee=ce?ce.id:null),c.renderLayer(c,ce,ie,de)}this.renderedToTile?(G.dirty=!0,j.push(B.tileID)):X||--M,M===5&&(M=0,this.renderToBackBuffer(j))}return this.renderToBackBuffer(j),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),S.end+1}postRender(){}isLayerOrderingCorrect(n){const c=n.order.length;let m=-1,v=c;for(let w=0;w<c;++w)this._style.isLayerDraped(n._mergedLayers[n.order[w]])?m=Math.max(m,w):v=Math.min(v,w);return v>m}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{n=Math.min(n,c.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,c,m){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(w=>w.dem).map(w=>{const S=w.tileID,C=1<<S.overscaledZ,{x:j,y:M}=S.canonical,D=j/C,B=(j+1)/C,O=M/C,G=(M+1)/C;return{minx:D,miny:O,maxx:B,maxy:G,t:w.dem.tree.raycastRoot(D,O,B,G,n,c,m),tile:w}});v.sort((w,S)=>(w.t!==null?w.t:Number.MAX_VALUE)-(S.t!==null?S.t:Number.MAX_VALUE));for(const w of v){if(w.t==null)return null;const S=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,n,c,m);if(S!=null)return S}return null}_createFBO(){const n=this.painter.context,c=n.gl,m=this.drapeBufferSize;n.activeTexture.set(c.TEXTURE0);const v=new o.T(n,{width:m[0],height:m[1],data:null},c.RGBA8);v.bind(c.LINEAR,c.CLAMP_TO_EDGE);const w=n.createFramebuffer(m[0],m[1],!0,null);return w.colorAttachment.set(v.texture),w.depthAttachment=new Tv(n,w.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:w,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const c=this._style._mergedLayers[n],m=c.isHidden(this.painter.transform.zoom);return c.type==="hillshade"||c.type==="custom"?!m&&c.shouldRedrape():!m&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(const m of this._style.getSources())if(m instanceof Vo){n=!0;break}if(!n)return;const c={};for(let m=0;m<this._style.order.length;++m){const v=this._style._mergedLayers[this._style.order[m]],w=this._style.getLayerSourceCache(v);if(w&&!c[w.id]&&!v.isHidden(this.painter.transform.zoom)&&v.type==="line"&&v.widthExpression()instanceof o.ad){c[w.id]=!0;for(const S of this.proxyCoords){const C=this.proxyToSource[S.key][w.id];if(C)for(const j of C)this._clearRenderCacheForTile(w.id,j)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const m in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[m]._source instanceof rl){n=!0;break}if(!n)return;const c={};for(let m=0;m<this._style.order.length;++m){const v=this._style._mergedLayers[this._style.order[m]],w=this._style.getLayerSourceCache(v);if(!w||c[w.id]||v.isHidden(this.painter.transform.zoom)||v.type!=="raster")continue;const S=v.paint.get("raster-fade-duration");for(const C of this.proxyCoords){const j=this.proxyToSource[C.key][w.id];if(j)for(const M of j){const D=gg(w.getTile(M),w.findLoadedParent(M,0),w,this.painter.transform,S);(D.opacity!==1||D.mix!==0)&&this._clearRenderCacheForTile(w.id,M)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const n=this._style.order,c=n.length;if(c===0)return;const m=[];this._pendingGroundEffectLayers=[];let v,w=0,S=this._style._mergedLayers[n[w]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++w<c;)S=this._style._mergedLayers[n[w]];for(;w<c;++w){const C=this._style._mergedLayers[n[w]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?v===void 0&&(v=w):(C.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(w),v!==void 0&&(m.push({start:v,end:w-1}),v=void 0)))}if(v!==void 0&&m.push({start:v,end:w-1}),m.length!==0){const C=m[m.length-1];this._pendingGroundEffectLayers.every(j=>j>C.end)||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=m}_setupRenderCache(n){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const S=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let C=0;C<S.length;++C){const j=Object.values(S[C]);c.renderCachePool.push(...j)}}return}this._clearRasterLayersFromRenderCache();const m=this.proxyCoords,v=this._tilesDirty;for(let S=m.length-1;S>=0;S--){const C=m[S];if(c.getTileByID(C.key),c.proxyCachedFBO[C.key]!==void 0){const j=n[C.key],M=this.proxyToSource[C.key];let D=0;for(const B in M){const O=M[B],G=j[B];if(!G||G.length!==O.length||O.some((X,ee)=>X!==G[ee]||v[B]&&v[B].hasOwnProperty(X.key))){D=-1;break}++D}for(const B in c.proxyCachedFBO[C.key])c.renderCache[c.proxyCachedFBO[C.key][B]].dirty=D<0||D!==Object.values(j).length}}const w=[...this._drapedRenderBatches];w.sort((S,C)=>C.end-C.start-(S.end-S.start));for(const S of w)for(const C of m){if(c.proxyCachedFBO[C.key])continue;let j=c.renderCachePool.pop();j===void 0&&c.renderCache.length<50&&(j=c.renderCache.length,c.renderCache.push(this._createFBO())),j!==void 0&&(c.proxyCachedFBO[C.key]={},c.proxyCachedFBO[C.key][S.start]=j,c.renderCache[j].dirty=!0)}this._tilesDirty={}}_setupStencil(n,c,m,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,S=w.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let C;if(m.isTileClipped())C=c.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):Kr.disabled}_renderTileClippingMasks(n,c){const m=this.painter,v=this.painter.context,w=v.gl;m._tileClippingMaskIDs={},v.setColorMode(un.disabled),v.setDepthMode(hr.disabled);const S=m.getOrCreateProgram("clippingMask");for(const C of n){const j=m._tileClippingMaskIDs[C.key]=--c;S.draw(m,w.TRIANGLES,hr.disabled,new Kr({func:w.ALWAYS,mask:0},j,255,w.KEEP,w.KEEP,w.REPLACE),un.disabled,qr.disabled,gd(C.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(n){const c=this.painter.transform;if(n.x<0||n.x>c.width||n.y<0||n.y>c.height)return null;const m=[n.x,n.y,1,1];o.aC(m,m,c.pixelMatrixInverse),o.cJ(m,m,1/m[3]),m[0]/=c.worldSize,m[1]/=c.worldSize;const v=c._camera.position,w=o.ce(1,c.center.lat),S=[v[0],v[1],v[2]/w,0],C=o.d9([],m.slice(0,3),S);o.aw(C,C);const j=this.raycast(S,C,this._exaggeration);return j!==null&&j?(o.bG(S,S,C,j),S[3]=S[2],S[2]*=w,S):null}_setupProxiedCoordsForOrtho(n,c,m){if(n.getSource()instanceof o.aT)return this._setupProxiedCoordsForImageSource(n,c,m);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const v=this.proxiedCoords[n.id]=[],w=this.proxyCoords;for(let j=0;j<w.length;j++){const M=w[j],D=this._findTileCoveringTileID(M,n);if(D){const B=this._createProxiedId(M,D,m[M.key]&&m[M.key][n.id]);v.push(B),this.proxyToSource[M.key][n.id]=[B]}}let S=!1;const C=new Set;for(let j=0;j<c.length;j++){const M=n.getTile(c[j]);if(!M||!M.hasData())continue;const D=this._findTileCoveringTileID(M.tileID,this.proxySourceCache);if(D&&D.tileID.canonical.z!==M.tileID.canonical.z){const B=this.proxyToSource[D.tileID.key][n.id],O=this._createProxiedId(D.tileID,M,m[D.tileID.key]&&m[D.tileID.key][n.id]);B?B.splice(B.length-1,0,O):this.proxyToSource[D.tileID.key][n.id]=[O];const G=this.proxyToSource[D.tileID.key][n.id];C.has(G)||C.add(G),v.push(O),S=!0}}if(this._sourceTilesOverlap[n.id]=S,S&&this._debugParams.sortTilesHiZFirst)for(const j of C)j.sort((M,D)=>D.overscaledZ-M.overscaledZ)}_setupProxiedCoordsForImageSource(n,c,m){if(!n.getSource().loaded())return;const v=this.proxiedCoords[n.id]=[],w=this.proxyCoords,S=n.getSource(),C=S.tileID;if(!C)return;const j=new o.P(C.x,C.y)._div(1<<C.z),M=S.coordinates.map(o.ae.fromLngLat).reduce((B,O)=>(B.min.x=Math.min(B.min.x,O.x-j.x),B.min.y=Math.min(B.min.y,O.y-j.y),B.max.x=Math.max(B.max.x,O.x-j.x),B.max.y=Math.max(B.max.y,O.y-j.y),B),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),D=(B,O)=>{const G=B.wrap+B.canonical.x/(1<<B.canonical.z),X=B.canonical.y/(1<<B.canonical.z),ee=o.al/(1<<B.canonical.z),oe=O.wrap+O.canonical.x/(1<<O.canonical.z),ie=O.canonical.y/(1<<O.canonical.z);return G+ee<oe+M.min.x||G>oe+M.max.x||X+ee<ie+M.min.y||X>ie+M.max.y};for(let B=0;B<w.length;B++){const O=w[B];for(let G=0;G<c.length;G++){const X=n.getTile(c[G]);if(!X||!X.hasData()||D(O,X.tileID))continue;const ee=this._createProxiedId(O,X,m[O.key]&&m[O.key][n.id]),oe=this.proxyToSource[O.key][n.id];oe?oe.push(ee):this.proxyToSource[O.key][n.id]=[ee],v.push(ee)}}}_createProxiedId(n,c,m){let v=this.orthoMatrix;if(m){const w=m.find(S=>S.key===c.tileID.key);if(w)return w}if(c.tileID.key!==n.key){const w=n.canonical.z-c.tileID.canonical.z;let S,C,j;v=o.bB();const M=c.tileID.wrap-n.wrap<<n.overscaledZ;w>0?(S=o.al>>w,C=S*((c.tileID.canonical.x<<w)-n.canonical.x+M),j=S*((c.tileID.canonical.y<<w)-n.canonical.y)):(S=o.al<<-w,C=o.al*(c.tileID.canonical.x-(n.canonical.x+M<<-w)),j=o.al*(c.tileID.canonical.y-(n.canonical.y<<-w))),o.cd(v,0,S,0,S,0,1),o.bq(v,v,[C,j,0])}return new kp(c.tileID,n.key,v)}_findTileCoveringTileID(n,c){let m=c.getTile(n);if(m&&m.hasData())return m;const v=this._findCoveringTileCache[c.id],w=v[n.key];if(m=w?c.getTileByID(w):null,m&&m.hasData()||w===null)return m;let S=m?m.tileID:n,C=S.overscaledZ;const j=c.getSource().minzoom,M=[];if(!w){const B=c.getSource().maxzoom;if(n.canonical.z>=B){const O=n.canonical.z-B;c.getSource().reparseOverscaled?(C=Math.max(n.canonical.z+2,c.transform.tileZoom),S=new o.aP(C,n.wrap,B,n.canonical.x>>O,n.canonical.y>>O)):O!==0&&(C=B,S=new o.aP(C,n.wrap,B,n.canonical.x>>O,n.canonical.y>>O))}S.key!==n.key&&(M.push(S.key),m=c.getTile(S))}const D=B=>{M.forEach(O=>{v[O]=B}),M.length=0};for(C-=1;C>=j&&(!m||!m.hasData());C--){m&&D(m.tileID.key);const B=S.calculateScaledKey(C);if(m=c.getTileByID(B),m&&m.hasData())break;const O=v[B];if(O===null)break;O===void 0?M.push(B):m=c.getTileByID(O)}return D(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,c){let m=this._tilesDirty[n];m||(m=this._tilesDirty[n]={}),m[c.key]=!0}}function jv(p,n,c){const m=function(C,j,M){const D=o.bI(j,C),B=o.bI(M,[.2126,.7152,.0722]),O=(X,ee,oe)=>(1-oe)*X+oe*ee,G=O(1-.3*Math.min(B,1),1,Math.min(D+1,1));return O(.92,1,Math.asin(o.aA(j[2],-1,1))/Math.PI+.5)*G}(p,[0,0,1],n),v=[0,0,0];o.c4(v,c.slice(0,3),m);const w=[0,0,0];o.c4(w,n.slice(0,3),p[2]);const S=[0,0,0];return o.d7(S,v,w),o.da(S)}const Iv=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],kv=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Rp{static cacheKey(n,c,m,v){let w=`${c}${v?v.cacheKey:""}`;for(const S of m)n.usedDefines.includes(S)&&(w+=`/${S}`);return w}constructor(n,c,m,v,w,S){const C=n.gl;this.program=C.createProgram(),this.configuration=v,this.name=c,this.fixedDefines=[...S];let j=v?v.defines():[];j=j.concat(S.map(X=>`#define ${X}`));const M=`#version 300 es
`;let D=M+j.concat("precision mediump float;",ic,Cp.fragmentSource).join(`
`);for(const X of m.fragmentIncludes)D+=`
${ph[X]}`;D+=`
${m.fragmentSource}`;let B=M+j.concat("precision highp float;",ic,Cp.vertexSource).join(`
`);for(const X of m.vertexIncludes)B+=`
${ph[X]}`;this.forceManualRenderingForInstanceIDShaders=n.forceManualRenderingForInstanceIDShaders&&m.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(B+=`
uniform int u_instanceID;
`),B+=`
${m.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(B=B.replaceAll("gl_InstanceID","u_instanceID"));const O=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(O,D),C.compileShader(O),C.attachShader(this.program,O);const G=C.createShader(C.VERTEX_SHADER);C.isContextLost()?this.failedToCreate=!0:(C.shaderSource(G,B),C.compileShader(G),C.attachShader(this.program,G),this.attributes={},C.linkProgram(this.program),C.deleteShader(G),C.deleteShader(O),this.fixedUniforms=w(n),this.binderUniforms=v?v.getUniforms(n):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(X=>({u_instanceID:new o.cg(X)}))(n)),(S.includes("TERRAIN")||c.indexOf("symbol")!==-1||c.indexOf("circle")!==-1)&&(this.terrainUniforms=(X=>({u_dem:new o.cg(X),u_dem_prev:new o.cg(X),u_dem_tl:new o.cj(X),u_dem_scale:new o.ci(X),u_dem_tl_prev:new o.cj(X),u_dem_scale_prev:new o.ci(X),u_dem_size:new o.ci(X),u_dem_lerp:new o.ci(X),u_exaggeration:new o.ci(X),u_depth:new o.cg(X),u_depth_size_inv:new o.cj(X),u_depth_range_unpack:new o.cj(X),u_occluder_half_size:new o.ci(X),u_occlusion_depth_offset:new o.ci(X),u_meter_to_dem:new o.ci(X),u_label_plane_matrix_inv:new o.ck(X)}))(n)),S.includes("GLOBE")&&(this.globeUniforms=(X=>({u_tile_tl_up:new o.ch(X),u_tile_tr_up:new o.ch(X),u_tile_br_up:new o.ch(X),u_tile_bl_up:new o.ch(X),u_tile_up_scale:new o.ci(X)}))(n)),S.includes("FOG")&&(this.fogUniforms=(X=>({u_fog_matrix:new o.ck(X),u_fog_range:new o.cj(X),u_fog_color:new o.d2(X),u_fog_horizon_blend:new o.ci(X),u_fog_vertical_limit:new o.cj(X),u_fog_temporal_offset:new o.ci(X),u_frustum_tl:new o.ch(X),u_frustum_tr:new o.ch(X),u_frustum_br:new o.ch(X),u_frustum_bl:new o.ch(X),u_globe_pos:new o.ch(X),u_globe_radius:new o.ci(X),u_globe_transition:new o.ci(X),u_is_globe:new o.cg(X),u_viewport:new o.cj(X)}))(n)),S.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(X=>({u_cutoff_params:new o.d2(X)}))(n)),S.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(X=>({u_lighting_ambient_color:new o.ch(X),u_lighting_directional_dir:new o.ch(X),u_lighting_directional_color:new o.ch(X),u_ground_radiance:new o.ch(X)}))(n)),S.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(X=>({u_light_matrix_0:new o.ck(X),u_light_matrix_1:new o.ck(X),u_fade_range:new o.cj(X),u_shadow_normal_offset:new o.ch(X),u_shadow_intensity:new o.ci(X),u_shadow_texel_size:new o.ci(X),u_shadow_map_resolution:new o.ci(X),u_shadow_direction:new o.ch(X),u_shadow_bias:new o.ch(X),u_shadowmap_0:new o.cg(X),u_shadowmap_1:new o.cg(X)}))(n)))}getAttributeLocation(n,c){let m=this.attributes[c];return m===void 0&&(m=this.attributes[c]=n.getAttribLocation(this.program,c)),m}setTerrainUniformValues(n,c){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const v in c)m[v]&&m[v].set(this.program,v,c[v])}}setGlobeUniformValues(n,c){if(!this.globeUniforms)return;const m=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const v in c)m[v]&&m[v].set(this.program,v,c[v])}}setFogUniformValues(n,c){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const v in c)m[v].set(this.program,v,c[v])}}setCutoffUniformValues(n,c){if(!this.cutoffUniforms)return;const m=this.cutoffUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const v in c)m[v].set(this.program,v,c[v])}}setLightsUniformValues(n,c){if(!this.lightsUniforms)return;const m=this.lightsUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const v in c)m[v].set(this.program,v,c[v])}}setShadowUniformValues(n,c){if(this.failedToCreate||!this.shadowUniforms)return;const m=this.shadowUniforms;n.program.set(this.program);for(const v in c)m[v].set(this.program,v,c[v])}_drawDebugWireframe(n,c,m,v,w,S,C,j,M,D){const B=n.options.wireframe;if(B.terrain===!1&&B.layers2D===!1&&B.layers3D===!1)return;const O=n.context;if(!(!(!B.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!B.layers2D||n._terrain&&n._terrain.renderingToTexture||!Iv.includes(this.name))||!(!B.layers3D||!kv.includes(this.name))))return;const G=O.gl,X=n.wireframeDebugCache.getLinesFromTrianglesBuffer(n.frameCounter,w,O);if(!X)return;const ee=[...this.fixedDefines];ee.push("DEBUG_WIREFRAME");const oe=n.getOrCreateProgram(this.name,{config:this.configuration,defines:ee});O.program.set(oe.program);const ie=(de,Ee,ge)=>{if(Ee[de]&&ge[de])for(const je in Ee[de])ge[de][je]&&ge[de][je].set(ge.program,je,Ee[de][je].current)};M&&M.setUniforms(oe.program,O,oe.binderUniforms,C,{zoom:j}),ie("fixedUniforms",this,oe),ie("terrainUniforms",this,oe),ie("globeUniforms",this,oe),ie("fogUniforms",this,oe),ie("lightsUniforms",this,oe),ie("shadowUniforms",this,oe),X.bind(),O.setColorMode(new un([G.ONE,G.ONE_MINUS_SRC_ALPHA,G.ZERO,G.ONE],o.ao.transparent,[!0,!0,!0,!1])),O.setDepthMode(new hr(c.func===G.LESS?G.LEQUAL:c.func,hr.ReadOnly,c.range)),O.setStencilMode(Kr.disabled);const ce=3*S.primitiveLength*2,me=3*S.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const de=D||1;for(let Ee=0;Ee<de;++Ee)oe.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ee),G.drawElements(G.LINES,ce,G.UNSIGNED_SHORT,me)}else D&&D>1?G.drawElementsInstanced(G.LINES,ce,G.UNSIGNED_SHORT,me,D):G.drawElements(G.LINES,ce,G.UNSIGNED_SHORT,me);w.bind(),O.program.set(this.program),O.setDepthMode(c),O.setStencilMode(m),O.setColorMode(v)}checkUniforms(n,c,m){if(this.fixedDefines.includes(c)){for(const v of Object.keys(m))if(!m[v].initialized)throw new Error(`Program '${this.name}', from draw '${n}': uniform ${v} not set but required by ${c} being defined`)}}draw(n,c,m,v,w,S,C,j,M,D,B,O,G,X,ee,oe){const ie=n.context,ce=ie.gl;if(this.failedToCreate)return;ie.program.set(this.program),ie.setDepthMode(m),ie.setStencilMode(v),ie.setColorMode(w),ie.setCullFace(S);for(const Ee of Object.keys(this.fixedUniforms))this.fixedUniforms[Ee].set(this.program,Ee,C[Ee]);X&&X.setUniforms(this.program,ie,this.binderUniforms,O,{zoom:G});const me={[ce.POINTS]:1,[ce.LINES]:2,[ce.TRIANGLES]:3,[ce.LINE_STRIP]:1}[c];this.checkUniforms(j,"RENDER_SHADOWS",this.shadowUniforms);const de=oe&&oe>0?1:void 0;for(const Ee of B.get()){const ge=Ee.vaos||(Ee.vaos={});if((ge[j]||(ge[j]=new mh)).bind(ie,this,M,X?X.getPaintVertexBuffers():[],D,Ee.vertexOffset,ee||[],de),this.forceManualRenderingForInstanceIDShaders){const je=oe||1;for(let Se=0;Se<je;++Se)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Se),D?ce.drawElements(c,Ee.primitiveLength*me,ce.UNSIGNED_SHORT,Ee.primitiveOffset*me*2):ce.drawArrays(c,Ee.vertexOffset,Ee.vertexLength)}else oe&&oe>1?ce.drawElementsInstanced(c,Ee.primitiveLength*me,ce.UNSIGNED_SHORT,Ee.primitiveOffset*me*2,oe):D?ce.drawElements(c,Ee.primitiveLength*me,ce.UNSIGNED_SHORT,Ee.primitiveOffset*me*2):ce.drawArrays(c,Ee.vertexOffset,Ee.vertexLength);c===ce.TRIANGLES&&D&&this._drawDebugWireframe(n,m,v,w,D,Ee,O,G,X,oe)}}}function _g(p,n,c=0){const m=Math.pow(2,n.tileID.overscaledZ),v=n.tileSize*Math.pow(2,p.transform.tileZoom)/m,w=v*(n.tileID.canonical.x+n.tileID.wrap*m),S=v*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.ay(n,1,p.transform.tileZoom),u_pixel_coord_upper:[w>>16,S>>16],u_pixel_coord_lower:[65535&w,65535&S],u_pattern_transition:c}}const xh={terrain:0,flat:1},yg=o.bB(),vg=(p,n,c,m,v,w,S,C,j,M,D,B,O,G,X,ee,oe,ie)=>{const ce=n.style.light,me=ce.properties.get("position"),de=[me.x,me.y,me.z],Ee=o.dN();ce.properties.get("anchor")==="viewport"&&(o.dO(Ee,-n.transform.angle),o.dP(de,de,Ee));const ge=ce.properties.get("color").toPremultipliedRenderColor(null),je=n.transform,Se={u_matrix:p,u_lightpos:de,u_lightintensity:ce.properties.get("intensity"),u_lightcolor:[ge.r,ge.g,ge.b],u_vertical_gradient:+c,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:yg,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:xh[M],u_base_type:xh[D],u_ao:v,u_edge_radius:w,u_width_scale:S,u_flood_light_color:X,u_vertical_scale:ee,u_flood_light_intensity:oe,u_ground_shadow_factor:ie};return je.projection.name==="globe"&&(Se.u_tile_id=[C.canonical.x,C.canonical.y,1<<C.canonical.z],Se.u_zoom_transition=B,Se.u_inv_rot_matrix=G,Se.u_merc_center=O,Se.u_up_dir=je.projection.upVector(new o.cC(0,0,0),O[0]*o.al,O[1]*o.al),Se.u_height_lift=j),Se},cw=(p,n,c,m,v,w)=>({u_matrix:p,u_edge_radius:n,u_width_scale:c,u_vertical_scale:m,u_height_type:xh[v],u_base_type:xh[w]}),uw=(p,n,c,m,v,w,S,C,j,M,D,B,O,G,X,ee,oe,ie)=>{const ce=vg(p,n,c,m,v,w,S,C,M,D,B,O,G,X,ee,oe,1,[0,0,0]),me={u_height_factor:-Math.pow(2,C.overscaledZ)/j.tileSize/8};return Object.assign(ce,_g(n,j,ie),me)},bh=(p,n,c,m,v,w,S,C,j,M,D)=>({u_matrix:n,u_opacity:c,u_ao_pass:m?1:0,u_meter_to_tile:v,u_ao:w,u_flood_light_intensity:S,u_flood_light_color:C,u_attenuation:j,u_edge_radius:M,u_fb:0,u_fb_size:D,u_dynamic_offset:1}),dw=(p,n,c)=>({u_matrix:p,u_emissive_strength:n,u_ground_shadow_factor:c}),hw=(p,n,c,m,v,w=0)=>Object.assign(dw(p,n,v),_g(c,m,w)),sE=(p,n,c,m)=>({u_matrix:p,u_world:c,u_emissive_strength:n,u_ground_shadow_factor:m}),oE=(p,n,c,m,v,w,S=0)=>Object.assign(hw(p,n,c,m,w,S),{u_world:v}),aE=(p,n)=>({u_matrix:p,u_ground_shadow_factor:n}),xg=(p,n,c,m,v)=>({u_matrix:p,u_camera_pos:[n[0],n[1],n[2]],u_depth_bias:c,u_height_scale:m,u_reset_depth:v}),Pv=(p,n,c,m,v,w,S,C,j)=>({u_matrix:p,u_normal_matrix:n,u_opacity:c,u_faux_facade_ao_intensity:m,u_camera_pos:v,u_tile_to_meter:w,u_facade_emissive_chance:S,u_flood_light_color:C,u_flood_light_intensity:j}),Rv=p=>({u_matrix:p}),fw=p=>({u_matrix:p}),wh=(p,n,c,m,v,w,S,C)=>{const j=o.al/w.tileSize;return{u_matrix:p,u_inv_rot_matrix:n,u_camera_to_center_distance:c.getCameraToCenterDistance(C),u_extrude_scale:[c.pixelsToGLUnits[0]/j,c.pixelsToGLUnits[1]/j],u_zoom_transition:m,u_tile_id:S,u_merc_center:v}},Mv=(p,n,c=1)=>({u_matrix:p,u_color:n,u_overlay:0,u_overlay_scale:c}),pw=o.bB(),mw=(p,n,c,m,v,w,S)=>{const C=p.transform,j=C.projection.name==="globe",M=j?o.dQ(C.zoom,n.canonical)*C._pixelsPerMercatorPixel:o.ay(c,1,w),D={u_matrix:n.projMatrix,u_extrude_scale:M,u_intensity:S,u_inv_rot_matrix:pw,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(j){D.u_inv_rot_matrix=m,D.u_merc_center=v,D.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],D.u_zoom_transition=o.aj(C.zoom);const B=v[0]*o.al,O=v[1]*o.al;D.u_up_dir=C.projection.upVector(new o.cC(0,0,0),B,O)}return D};function bg(p,[n,c,m,v],[w,S]){if(w===S)return[0,0,0,0];const C=255*(p-1)/(p*(S-w));return[n*C,c*C,m*C,v*C]}function Nc(p,n,[c,m]){return c===m?0:.5/p+(n-c)*(p-1)/(p*(m-c))}const Mp=(p,n,c,m,v,w,S,C,j,M,D,B,O,G,X,ee,oe,ie,ce,me,de)=>({u_matrix:p,u_normalize_matrix:n,u_globe_matrix:c,u_merc_matrix:m,u_grid_matrix:v,u_tl_parent:w,u_scale_parent:M,u_fade_t:D.mix,u_opacity:D.opacity*B.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:B.paint.get("raster-brightness-min"),u_brightness_high:B.paint.get("raster-brightness-max"),u_saturation_factor:o.dS(B.paint.get("raster-saturation")),u_contrast_factor:o.dR(B.paint.get("raster-contrast")),u_spin_weights:wg(B.paint.get("raster-hue-rotate")),u_perspective_transform:O,u_raster_elevation:G,u_zoom_transition:S,u_merc_center:C,u_cutoff_params:j,u_colorization_mix:bg(o.dT,ee,ie),u_colorization_offset:Nc(o.dT,oe,ie),u_color_ramp:X,u_texture_offset:[me/(ce+2*me),ce/(ce+2*me)],u_texture_res:[ce+2*me,ce+2*me],u_emissive_strength:de});function wg(p){p*=Math.PI/180;const n=Math.sin(p),c=Math.cos(p);return[(2*c+1)/3,(-Math.sqrt(3)*n-c+1)/3,(Math.sqrt(3)*n-c+1)/3]}const _d=.05,Su=(p,n,c,m,v,w,S,C,j,M,D,B)=>({u_matrix:p,u_normalize_matrix:n,u_globe_matrix:c,u_merc_matrix:m,u_grid_matrix:v,u_tl_parent:w,u_scale_parent:M,u_fade_t:D.mix,u_opacity:D.opacity,u_image0:0,u_image1:1,u_raster_elevation:B,u_zoom_transition:S,u_merc_center:C,u_cutoff_params:j}),Nv=(p,n,c,m,v,w,S,C,j,M)=>({u_particle_texture:p,u_particle_texture_side_len:n,u_tile_offset:c,u_velocity:m,u_color_ramp:w,u_velocity_res:v,u_max_speed:S,u_uv_offset:C,u_data_scale:[255*j[0],255*j[1]],u_data_offset:M,u_particle_pos_scale:1.1,u_particle_pos_offset:[_d,_d]}),Sg=(p,n,c,m,v,w,S,C,j,M)=>({u_particle_texture:p,u_particle_texture_side_len:n,u_velocity:c,u_velocity_res:m,u_max_speed:v,u_speed_factor:w,u_reset_rate:S,u_rand_seed:Math.random(),u_uv_offset:C,u_data_scale:[255*j[0],255*j[1]],u_data_offset:M,u_particle_pos_scale:1.1,u_particle_pos_offset:[_d,_d]}),Dv=o.bB(),Ov=(p,n,c,m,v,w,S,C,j,M,D,B,O,G,X,ee,oe,ie,ce,me,de,Ee,ge,je)=>{const Se=v.transform,ve={u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:Se.getCameraToCenterDistance(ce),u_rotate_symbol:+c,u_aspect_ratio:Se.width/Se.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:S,u_coord_matrix:C,u_is_text:+M,u_elevation_from_sea:j?1:0,u_pitch_with_map:+m,u_texsize:D,u_texsize_icon:B,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Dv,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Dv,u_up_vector:[0,-1,0],u_color_adj_mat:Ee,u_icon_transition:ge||0,u_gamma_scale:m?v.transform.getCameraToCenterDistance(ce)*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:o.o.devicePixelRatio,u_is_halo:1,u_scale_factor:je||1,u_ground_shadow_factor:me,u_inv_matrix:o.bk(o.bB(),S),u_normal_scale:de,u_lutTexture:po.LUT};return ce.name==="globe"&&(ve.u_tile_id=[G.canonical.x,G.canonical.y,1<<G.canonical.z],ve.u_zoom_transition=X,ve.u_inv_rot_matrix=oe,ve.u_merc_center=ee,ve.u_camera_forward=Se._camera.forward(),ve.u_ecef_origin=o.dU(Se.globeMatrix,G.toUnwrapped()),ve.u_tile_matrix=Float32Array.from(Se.globeMatrix),ve.u_up_vector=ie),ve},Tg=(p,n,c,m)=>({u_matrix:p,u_emissive_strength:n,u_opacity:c,u_color:m}),Eg=(p,n,c,m,v,w,S,C,j)=>Object.assign(function(M,D,B,O,G,X){const{width:ee,height:oe}=O.imageManager.getPixelSize(D),ie=Math.pow(2,X.tileID.overscaledZ),ce=X.tileSize*Math.pow(2,O.transform.tileZoom)/ie,me=ce*(X.tileID.canonical.x+X.tileID.wrap*ie),de=ce*X.tileID.canonical.y;return{u_image:0,u_pattern_tl:B.tl,u_pattern_br:B.br,u_texsize:[ee,oe],u_pattern_size:B.displaySize,u_pattern_units_to_pixels:G?[O.transform.width,-1*O.transform.height]:[1/o.ay(X,1,O.transform.tileZoom),1/o.ay(X,1,O.transform.tileZoom)],u_pixel_coord_upper:[me>>16,de>>16],u_pixel_coord_lower:[65535&me,65535&de]}}(0,w,S,m,C,j),{u_matrix:p,u_emissive_strength:n,u_opacity:c}),Lv=new Float32Array(o.bz([])),Cg=(p,n,c,m,v,w,S,C,j,M,D,B,O,G=[0,0,0],X,ee,oe)=>{const ie=v.style.light,ce=ie.properties.get("position"),me=[-ce.x,-ce.y,ce.z],de=o.dN();ie.properties.get("anchor")==="viewport"&&(o.dO(de,-v.transform.angle),o.dP(me,me,de));const Ee=D.alphaMode==="MASK",ge=ie.properties.get("color").toNonPremultipliedRenderColor(null),je=O.paint.get("model-ambient-occlusion-intensity"),Se=O.paint.get("model-color").constantOr(o.ao.white).toNonPremultipliedRenderColor(null);return Se.a=O.paint.get("model-color-mix-intensity").constantOr(0),oe&&(Se.r=oe[0],Se.g=oe[1],Se.b=oe[2],Se.a=oe[3]),ee&&(Se.r=ee.color.r,Se.g=ee.color.g,Se.b=ee.color.b,Se.a=ee.colorMix,B=ee.emissionStrength,w=ee.opacity),{u_matrix:p,u_lighting_matrix:n,u_normal_matrix:c,u_node_matrix:m||Lv,u_lightpos:me,u_lightintensity:ie.properties.get("intensity"),u_lightcolor:[ge.r,ge.g,ge.b],u_camera_pos:G,u_opacity:w,u_baseTextureIsAlpha:0,u_alphaMask:+Ee,u_alphaCutoff:D.alphaCutoff,u_baseColorFactor:S.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:C.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:j,u_roughnessFactor:M,u_baseColorTexture:po.BaseColor,u_metallicRoughnessTexture:po.MetallicRoughness,u_normalTexture:po.Normal,u_occlusionTexture:po.Occlusion,u_emissionTexture:po.Emission,u_lutTexture:po.LUT,u_color_mix:Se.toArray01(),u_aoIntensity:je,u_emissive_strength:B,u_occlusionTextureTransform:X||[0,0,0,0]}},Sh=(p,n=Lv,c=Lv)=>({u_matrix:p,u_instance:n,u_node_matrix:c}),lE={fillExtrusion:p=>({u_matrix:new o.ck(p),u_lightpos:new o.ch(p),u_lightintensity:new o.ci(p),u_lightcolor:new o.ch(p),u_vertical_gradient:new o.ci(p),u_opacity:new o.ci(p),u_edge_radius:new o.ci(p),u_width_scale:new o.ci(p),u_ao:new o.cj(p),u_height_type:new o.cg(p),u_base_type:new o.cg(p),u_tile_id:new o.ch(p),u_zoom_transition:new o.ci(p),u_inv_rot_matrix:new o.ck(p),u_merc_center:new o.cj(p),u_up_dir:new o.ch(p),u_height_lift:new o.ci(p),u_flood_light_color:new o.ch(p),u_vertical_scale:new o.ci(p),u_flood_light_intensity:new o.ci(p),u_ground_shadow_factor:new o.ch(p)}),fillExtrusionDepth:p=>({u_matrix:new o.ck(p),u_edge_radius:new o.ci(p),u_width_scale:new o.ci(p),u_vertical_scale:new o.ci(p),u_height_type:new o.cg(p),u_base_type:new o.cg(p)}),fillExtrusionPattern:p=>({u_matrix:new o.ck(p),u_lightpos:new o.ch(p),u_lightintensity:new o.ci(p),u_lightcolor:new o.ch(p),u_vertical_gradient:new o.ci(p),u_height_factor:new o.ci(p),u_edge_radius:new o.ci(p),u_width_scale:new o.ci(p),u_ao:new o.cj(p),u_height_type:new o.cg(p),u_base_type:new o.cg(p),u_tile_id:new o.ch(p),u_zoom_transition:new o.ci(p),u_inv_rot_matrix:new o.ck(p),u_merc_center:new o.cj(p),u_up_dir:new o.ch(p),u_height_lift:new o.ci(p),u_image:new o.cg(p),u_texsize:new o.cj(p),u_pixel_coord_upper:new o.cj(p),u_pixel_coord_lower:new o.cj(p),u_tile_units_to_pixels:new o.ci(p),u_opacity:new o.ci(p),u_pattern_transition:new o.ci(p)}),fillExtrusionGroundEffect:p=>({u_matrix:new o.ck(p),u_opacity:new o.ci(p),u_ao_pass:new o.ci(p),u_meter_to_tile:new o.ci(p),u_ao:new o.cj(p),u_flood_light_intensity:new o.ci(p),u_flood_light_color:new o.ch(p),u_attenuation:new o.ci(p),u_edge_radius:new o.ci(p),u_fb:new o.cg(p),u_fb_size:new o.ci(p),u_dynamic_offset:new o.ci(p)}),fill:p=>({u_matrix:new o.ck(p),u_emissive_strength:new o.ci(p),u_ground_shadow_factor:new o.ch(p)}),fillPattern:p=>({u_matrix:new o.ck(p),u_emissive_strength:new o.ci(p),u_image:new o.cg(p),u_texsize:new o.cj(p),u_pixel_coord_upper:new o.cj(p),u_pixel_coord_lower:new o.cj(p),u_tile_units_to_pixels:new o.ci(p),u_ground_shadow_factor:new o.ch(p),u_pattern_transition:new o.ci(p)}),fillOutline:p=>({u_matrix:new o.ck(p),u_emissive_strength:new o.ci(p),u_world:new o.cj(p),u_ground_shadow_factor:new o.ch(p)}),fillOutlinePattern:p=>({u_matrix:new o.ck(p),u_emissive_strength:new o.ci(p),u_world:new o.cj(p),u_image:new o.cg(p),u_texsize:new o.cj(p),u_pixel_coord_upper:new o.cj(p),u_pixel_coord_lower:new o.cj(p),u_tile_units_to_pixels:new o.ci(p),u_ground_shadow_factor:new o.ch(p),u_pattern_transition:new o.ci(p)}),building:p=>({u_matrix:new o.ck(p),u_normal_matrix:new o.ck(p),u_opacity:new o.ci(p),u_faux_facade_ao_intensity:new o.ci(p),u_camera_pos:new o.ch(p),u_tile_to_meter:new o.ci(p),u_facade_emissive_chance:new o.ci(p),u_flood_light_color:new o.ch(p),u_flood_light_intensity:new o.ci(p)}),buildingBloom:p=>({u_matrix:new o.ck(p)}),buildingDepth:p=>({u_matrix:new o.ck(p)}),elevatedStructuresDepth:p=>({u_matrix:new o.ck(p),u_depth_bias:new o.ci(p)}),elevatedStructures:p=>({u_matrix:new o.ck(p),u_ground_shadow_factor:new o.ch(p)}),elevatedStructuresDepthReconstruct:p=>({u_matrix:new o.ck(p),u_camera_pos:new o.ch(p),u_depth_bias:new o.ci(p),u_height_scale:new o.ci(p),u_reset_depth:new o.ci(p)}),circle:o.dX,collisionBox:p=>({u_matrix:new o.ck(p),u_inv_rot_matrix:new o.ck(p),u_camera_to_center_distance:new o.ci(p),u_extrude_scale:new o.cj(p),u_zoom_transition:new o.ci(p),u_merc_center:new o.cj(p),u_tile_id:new o.ch(p)}),collisionCircle:p=>({u_matrix:new o.ck(p),u_inv_matrix:new o.ck(p),u_camera_to_center_distance:new o.ci(p),u_viewport_size:new o.cj(p)}),debug:p=>({u_color:new o.dA(p),u_matrix:new o.ck(p),u_overlay:new o.cg(p),u_overlay_scale:new o.ci(p)}),clippingMask:p=>({u_matrix:new o.ck(p)}),heatmap:p=>({u_extrude_scale:new o.ci(p),u_intensity:new o.ci(p),u_matrix:new o.ck(p),u_inv_rot_matrix:new o.ck(p),u_merc_center:new o.cj(p),u_tile_id:new o.ch(p),u_zoom_transition:new o.ci(p),u_up_dir:new o.ch(p)}),heatmapTexture:p=>({u_image:new o.cg(p),u_color_ramp:new o.cg(p),u_opacity:new o.ci(p)}),hillshade:p=>({u_matrix:new o.ck(p),u_image:new o.cg(p),u_latrange:new o.cj(p),u_light:new o.cj(p),u_shadow:new o.dA(p),u_highlight:new o.dA(p),u_emissive_strength:new o.ci(p),u_accent:new o.dA(p)}),hillshadePrepare:p=>({u_matrix:new o.ck(p),u_image:new o.cg(p),u_dimension:new o.cj(p),u_zoom:new o.ci(p)}),line:o.dW,linePattern:o.dV,raster:p=>({u_matrix:new o.ck(p),u_normalize_matrix:new o.ck(p),u_globe_matrix:new o.ck(p),u_merc_matrix:new o.ck(p),u_grid_matrix:new o.dB(p),u_tl_parent:new o.cj(p),u_scale_parent:new o.ci(p),u_fade_t:new o.ci(p),u_opacity:new o.ci(p),u_image0:new o.cg(p),u_image1:new o.cg(p),u_brightness_low:new o.ci(p),u_brightness_high:new o.ci(p),u_saturation_factor:new o.ci(p),u_contrast_factor:new o.ci(p),u_spin_weights:new o.ch(p),u_perspective_transform:new o.cj(p),u_raster_elevation:new o.ci(p),u_zoom_transition:new o.ci(p),u_merc_center:new o.cj(p),u_cutoff_params:new o.d2(p),u_colorization_mix:new o.d2(p),u_colorization_offset:new o.ci(p),u_color_ramp:new o.cg(p),u_texture_offset:new o.cj(p),u_texture_res:new o.cj(p),u_emissive_strength:new o.ci(p)}),rasterParticle:p=>({u_matrix:new o.ck(p),u_normalize_matrix:new o.ck(p),u_globe_matrix:new o.ck(p),u_merc_matrix:new o.ck(p),u_grid_matrix:new o.dB(p),u_tl_parent:new o.cj(p),u_scale_parent:new o.ci(p),u_fade_t:new o.ci(p),u_opacity:new o.ci(p),u_image0:new o.cg(p),u_image1:new o.cg(p),u_raster_elevation:new o.ci(p),u_zoom_transition:new o.ci(p),u_merc_center:new o.cj(p),u_cutoff_params:new o.d2(p)}),rasterParticleTexture:p=>({u_texture:new o.cg(p),u_opacity:new o.ci(p)}),rasterParticleDraw:p=>({u_particle_texture:new o.cg(p),u_particle_texture_side_len:new o.ci(p),u_tile_offset:new o.cj(p),u_velocity:new o.cg(p),u_color_ramp:new o.cg(p),u_velocity_res:new o.cj(p),u_max_speed:new o.ci(p),u_uv_offset:new o.cj(p),u_data_scale:new o.cj(p),u_data_offset:new o.ci(p),u_particle_pos_scale:new o.ci(p),u_particle_pos_offset:new o.cj(p)}),rasterParticleUpdate:p=>({u_particle_texture:new o.cg(p),u_particle_texture_side_len:new o.ci(p),u_velocity:new o.cg(p),u_velocity_res:new o.cj(p),u_max_speed:new o.ci(p),u_speed_factor:new o.ci(p),u_reset_rate:new o.ci(p),u_rand_seed:new o.ci(p),u_uv_offset:new o.cj(p),u_data_scale:new o.cj(p),u_data_offset:new o.ci(p),u_particle_pos_scale:new o.ci(p),u_particle_pos_offset:new o.cj(p)}),symbol:p=>({u_is_size_zoom_constant:new o.cg(p),u_is_size_feature_constant:new o.cg(p),u_size_t:new o.ci(p),u_size:new o.ci(p),u_camera_to_center_distance:new o.ci(p),u_rotate_symbol:new o.cg(p),u_aspect_ratio:new o.ci(p),u_fade_change:new o.ci(p),u_matrix:new o.ck(p),u_label_plane_matrix:new o.ck(p),u_coord_matrix:new o.ck(p),u_is_text:new o.cg(p),u_elevation_from_sea:new o.cg(p),u_pitch_with_map:new o.cg(p),u_texsize:new o.cj(p),u_texsize_icon:new o.cj(p),u_texture:new o.cg(p),u_texture_icon:new o.cg(p),u_gamma_scale:new o.ci(p),u_device_pixel_ratio:new o.ci(p),u_tile_id:new o.ch(p),u_zoom_transition:new o.ci(p),u_inv_rot_matrix:new o.ck(p),u_merc_center:new o.cj(p),u_camera_forward:new o.ch(p),u_tile_matrix:new o.ck(p),u_up_vector:new o.ch(p),u_ecef_origin:new o.ch(p),u_is_halo:new o.cg(p),u_icon_transition:new o.ci(p),u_color_adj_mat:new o.ck(p),u_scale_factor:new o.ci(p),u_ground_shadow_factor:new o.ch(p),u_inv_matrix:new o.ck(p),u_normal_scale:new o.ci(p),u_lutTexture:new o.cg(p)}),background:p=>({u_matrix:new o.ck(p),u_emissive_strength:new o.ci(p),u_opacity:new o.ci(p),u_color:new o.dA(p)}),backgroundPattern:p=>({u_matrix:new o.ck(p),u_emissive_strength:new o.ci(p),u_opacity:new o.ci(p),u_image:new o.cg(p),u_pattern_tl:new o.cj(p),u_pattern_br:new o.cj(p),u_texsize:new o.cj(p),u_pattern_size:new o.cj(p),u_pixel_coord_upper:new o.cj(p),u_pixel_coord_lower:new o.cj(p),u_pattern_units_to_pixels:new o.cj(p)}),terrainRaster:p=>({u_matrix:new o.ck(p),u_image0:new o.cg(p),u_skirt_height:new o.ci(p),u_ground_shadow_factor:new o.ch(p)}),skybox:p=>({u_matrix:new o.ck(p),u_sun_direction:new o.ch(p),u_cubemap:new o.cg(p),u_opacity:new o.ci(p),u_temporal_offset:new o.ci(p)}),skyboxGradient:p=>({u_matrix:new o.ck(p),u_color_ramp:new o.cg(p),u_center_direction:new o.ch(p),u_radius:new o.ci(p),u_opacity:new o.ci(p),u_temporal_offset:new o.ci(p)}),skyboxCapture:p=>({u_matrix_3f:new o.dB(p),u_sun_direction:new o.ch(p),u_sun_intensity:new o.ci(p),u_color_tint_r:new o.d2(p),u_color_tint_m:new o.d2(p),u_luminance:new o.ci(p)}),globeRaster:p=>({u_proj_matrix:new o.ck(p),u_globe_matrix:new o.ck(p),u_normalize_matrix:new o.ck(p),u_merc_matrix:new o.ck(p),u_zoom_transition:new o.ci(p),u_merc_center:new o.cj(p),u_image0:new o.cg(p),u_grid_matrix:new o.dB(p),u_skirt_height:new o.ci(p),u_far_z_cutoff:new o.ci(p),u_frustum_tl:new o.ch(p),u_frustum_tr:new o.ch(p),u_frustum_br:new o.ch(p),u_frustum_bl:new o.ch(p),u_globe_pos:new o.ch(p),u_globe_radius:new o.ci(p),u_viewport:new o.cj(p)}),globeAtmosphere:p=>({u_frustum_tl:new o.ch(p),u_frustum_tr:new o.ch(p),u_frustum_br:new o.ch(p),u_frustum_bl:new o.ch(p),u_horizon:new o.ci(p),u_transition:new o.ci(p),u_fadeout_range:new o.ci(p),u_atmosphere_fog_color:new o.d2(p),u_high_color:new o.d2(p),u_space_color:new o.d2(p),u_temporal_offset:new o.ci(p),u_horizon_angle:new o.ci(p)}),model:p=>({u_matrix:new o.ck(p),u_lighting_matrix:new o.ck(p),u_normal_matrix:new o.ck(p),u_node_matrix:new o.ck(p),u_lightpos:new o.ch(p),u_lightintensity:new o.ci(p),u_lightcolor:new o.ch(p),u_camera_pos:new o.ch(p),u_opacity:new o.ci(p),u_baseColorFactor:new o.d2(p),u_emissiveFactor:new o.d2(p),u_metallicFactor:new o.ci(p),u_roughnessFactor:new o.ci(p),u_baseTextureIsAlpha:new o.cg(p),u_alphaMask:new o.cg(p),u_alphaCutoff:new o.ci(p),u_baseColorTexture:new o.cg(p),u_metallicRoughnessTexture:new o.cg(p),u_normalTexture:new o.cg(p),u_occlusionTexture:new o.cg(p),u_emissionTexture:new o.cg(p),u_lutTexture:new o.cg(p),u_color_mix:new o.d2(p),u_aoIntensity:new o.ci(p),u_emissive_strength:new o.ci(p),u_occlusionTextureTransform:new o.d2(p)}),modelDepth:p=>({u_matrix:new o.ck(p),u_instance:new o.ck(p),u_node_matrix:new o.ck(p)}),groundShadow:p=>({u_matrix:new o.ck(p),u_ground_shadow_factor:new o.ch(p)}),stars:p=>({u_matrix:new o.ck(p),u_up:new o.ch(p),u_right:new o.ch(p),u_intensity_multiplier:new o.ci(p)}),snowParticle:p=>({u_modelview:new o.ck(p),u_projection:new o.ck(p),u_time:new o.ci(p),u_cam_pos:new o.ch(p),u_velocityConeAperture:new o.ci(p),u_velocity:new o.ci(p),u_horizontalOscillationRadius:new o.ci(p),u_horizontalOscillationRate:new o.ci(p),u_boxSize:new o.ci(p),u_billboardSize:new o.ci(p),u_simpleShapeParameters:new o.cj(p),u_screenSize:new o.cj(p),u_thinningCenterPos:new o.cj(p),u_thinningShape:new o.ch(p),u_thinningAffectedRatio:new o.ci(p),u_thinningParticleOffset:new o.ci(p),u_particleColor:new o.d2(p),u_direction:new o.ch(p)}),rainParticle:p=>({u_modelview:new o.ck(p),u_projection:new o.ck(p),u_time:new o.ci(p),u_cam_pos:new o.ch(p),u_texScreen:new o.cg(p),u_velocityConeAperture:new o.ci(p),u_velocity:new o.ci(p),u_boxSize:new o.ci(p),u_rainDropletSize:new o.cj(p),u_distortionStrength:new o.ci(p),u_rainDirection:new o.ch(p),u_color:new o.d2(p),u_screenSize:new o.cj(p),u_thinningCenterPos:new o.cj(p),u_thinningShape:new o.ch(p),u_thinningAffectedRatio:new o.ci(p),u_thinningParticleOffset:new o.ci(p),u_shapeDirectionalPower:new o.ci(p),u_shapeNormalPower:new o.ci(p),u_mode:new o.ci(p)}),vignette:p=>({u_vignetteShape:new o.ch(p),u_vignetteColor:new o.d2(p)}),occlusion:p=>({u_matrix:new o.ck(p),u_anchorPos:new o.ch(p),u_screenSizePx:new o.cj(p),u_occluderSizePx:new o.cj(p),u_color:new o.d2(p)})};class Tu{constructor(n,c,m,v){this.id=Tu.uniqueIdxCounter,Tu.uniqueIdxCounter++,this.context=n;const w=n.gl;this.buffer=w.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||v||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=Tu.uniqueIdxCounter,Tu.uniqueIdxCounter++;const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Tu.uniqueIdxCounter=0;const gw={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class cE{constructor(n,c,m,v,w,S){this.length=c.length,this.attributes=m,this.itemSize=c.bytesPerElement,this.dynamicDraw=v,this.instanceCount=S,this.context=n;const C=n.gl;this.buffer=C.createBuffer(),n.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||w||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,c){for(let m=0;m<this.attributes.length;m++){const v=c.getAttributeLocation(n,this.attributes[m].name);v!==-1&&n.enableVertexAttribArray(v)}}setVertexAttribPointers(n,c,m){for(let v=0;v<this.attributes.length;v++){const w=this.attributes[v],S=c.getAttributeLocation(n,w.name);S!==-1&&n.vertexAttribPointer(S,w.components,n[gw[w.type]],!1,this.itemSize,w.offset+this.itemSize*(m||0))}}setVertexAttribDivisor(n,c,m){for(let v=0;v<this.attributes.length;v++){const w=c.getAttributeLocation(n,this.attributes[v].name);w!==-1&&this.instanceCount&&this.instanceCount>0&&n.vertexAttribDivisor(w,m)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ag{constructor(n,c,m,v,w){this.context=n,this.width=c,this.height=m;const S=this.framebuffer=n.gl.createFramebuffer();v&&(this.colorAttachment=new nE(n,S)),w&&(this.depthAttachmentType=w,this.depthAttachment=w==="renderbuffer"?new aw(n,S):new iE(n,S))}destroy(){const n=this.context.gl;if(this.colorAttachment){const c=this.colorAttachment.get();c&&n.deleteTexture(c)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const c=this.depthAttachment.get();c&&n.deleteRenderbuffer(c)}else{const c=this.depthAttachment.get();c&&n.deleteTexture(c)}n.deleteFramebuffer(this.framebuffer)}}class jg{constructor(n,c){this.gl=n,this.clearColor=new Qb(this),this.clearDepth=new vv(this),this.clearStencil=new Y2(this),this.colorMask=new J2(this),this.depthMask=new Q2(this),this.stencilMask=new eE(this),this.stencilFunc=new ew(this),this.stencilOp=new tE(this),this.stencilTest=new lg(this),this.depthRange=new rE(this),this.depthTest=new tw(this),this.depthFunc=new xv(this),this.blend=new cg(this),this.blendFunc=new bv(this),this.blendColor=new pd(this),this.blendEquation=new gh(this),this.cullFace=new Ap(this),this.cullFaceSide=new _h(this),this.frontFace=new rw(this),this.program=new wv(this),this.activeTexture=new nw(this),this.viewport=new yh(this),this.bindFramebuffer=new ug(this),this.bindRenderbuffer=new dg(this),this.bindTexture=new Sv(this),this.bindVertexBuffer=new hg(this),this.bindElementBuffer=new jp(this),this.bindVertexArrayOES=new iw(this),this.pixelStoreUnpack=new sw(this),this.pixelStoreUnpackPremultiplyAlpha=new ow(this),this.pixelStoreUnpackFlipY=new vh(this),this.options=c?Object.assign({},c):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=c&&!!c.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=n.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),this.maxPointSize=n.getParameter(n.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,c,m){return new Tu(this,n,c,m)}createVertexBuffer(n,c,m,v,w){return new cE(this,n,c,m,v,w)}createRenderbuffer(n,c,m){const v=this.gl,w=v.createRenderbuffer();return this.bindRenderbuffer.set(w),v.renderbufferStorage(v.RENDERBUFFER,n,c,m),this.bindRenderbuffer.set(null),w}createFramebuffer(n,c,m,v){return new Ag(this,n,c,m,v)}clear({color:n,depth:c,stencil:m,colorMask:v}){const w=this.gl;let S=0;n&&(S|=w.COLOR_BUFFER_BIT,this.clearColor.set(n.toNonPremultipliedRenderColor(null)),this.colorMask.set(v||[!0,!0,!0,!0])),c!==void 0&&(S|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),m!==void 0&&(S|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),w.clear(S)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){o.bx(n.blendFunction,un.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor),n.blendEquation?this.blendEquation.set(n.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(n.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let sc;function Np(p,n,c,m,v,w,S){const C=p.context,j=C.gl,M=p.transform,D=[o.aF(M.center.lng),o.aJ(M.center.lat)],B=c.layout.get("symbol-placement"),O=c.layout.get("text-variable-anchor"),G=c.layout.get("icon-rotation-alignment")==="map",X=c.layout.get("text-rotation-alignment")==="map",ee=B!=="point",oe=[];let ie=0,ce=0;for(let ve=0;ve<m.length;ve++){const Ie=m[ve],$e=n.getTile(Ie),Fe=$e.getBucket(c);if(!Fe)continue;const at=Fe.getProjection().createInversionMatrix(M,Ie.canonical),Qe=[],pt=Hb(Ie,Fe,M),Ot=!S&&G&&ee,Ye=S&&X&&ee,Oe=O&&Fe.hasTextData(),mt=Fe.hasIconTextFit()&&Oe&&Fe.hasIconData(),et=Ot||Ye||S&&Oe||mt,Et=Fe.projection.name==="globe",$t=Et?o.aj(M.zoom):0;Et&&(Qe.push("PROJECTION_GLOBE_VIEW"),et&&Qe.push("PROJECTED_POS_ON_VIEWPORT"));const lr=p.getOrCreateProgram("collisionBox",{defines:Qe});let Mt=pt;v[0]===0&&v[1]===0||(Mt=p.translatePosMatrix(pt,$e,v,w));const zt=S?Fe.textCollisionBox:Fe.iconCollisionBox,ur=Fe.collisionCircleArray;if(ur.length>0){const er=o.bB(),ir=Mt;o.cO(er,Fe.placementInvProjMatrix,M.glCoordMatrix),o.cO(er,er,Fe.placementViewportMatrix),oe.push({circleArray:ur,circleOffset:ce,transform:ir,invTransform:er,projection:Fe.getProjection()}),ie+=ur.length/4,ce=ie}if(!zt)continue;p.terrain&&p.terrain.setupElevationDraw($e,lr);const nr=Et?[Ie.canonical.x,Ie.canonical.y,1<<Ie.canonical.z]:[0,0,0];lr.draw(p,j.LINES,hr.disabled,Kr.disabled,p.colorModeForRenderPass(),qr.disabled,wh(Mt,at,M,$t,D,$e,nr,Fe.getProjection()),c.id,zt.layoutVertexBuffer,zt.indexBuffer,zt.segments,null,M.zoom,null,[zt.collisionVertexBuffer,zt.collisionVertexBufferExt])}if(!S||!oe.length)return;const me=p.getOrCreateProgram("collisionCircle"),de=new o.dY;de.resize(4*ie),de._trim();let Ee=0;for(const ve of oe)for(let Ie=0;Ie<ve.circleArray.length/4;Ie++){const $e=4*Ie,Fe=ve.circleArray[$e+0],at=ve.circleArray[$e+1],Qe=ve.circleArray[$e+2],pt=ve.circleArray[$e+3];de.emplace(Ee++,Fe,at,Qe,pt,0),de.emplace(Ee++,Fe,at,Qe,pt,1),de.emplace(Ee++,Fe,at,Qe,pt,2),de.emplace(Ee++,Fe,at,Qe,pt,3)}(!sc||sc.length<2*ie)&&(sc=function(ve){const Ie=2*ve,$e=new o.b0;$e.resize(Ie),$e._trim();for(let Fe=0;Fe<Ie;Fe++){const at=6*Fe;$e.uint16[at+0]=4*Fe+0,$e.uint16[at+1]=4*Fe+1,$e.uint16[at+2]=4*Fe+2,$e.uint16[at+3]=4*Fe+2,$e.uint16[at+4]=4*Fe+3,$e.uint16[at+5]=4*Fe+0}return $e}(ie));const ge=C.createIndexBuffer(sc,!0),je=C.createVertexBuffer(de,o.dZ.members,!0);for(const ve of oe){const Ie={u_matrix:ve.transform,u_inv_matrix:ve.invTransform,u_camera_to_center_distance:(Se=M).getCameraToCenterDistance(ve.projection),u_viewport_size:[Se.width,Se.height]};me.draw(p,j.TRIANGLES,hr.disabled,Kr.disabled,p.colorModeForRenderPass(),qr.disabled,Ie,c.id,je,ge,o.bf.simpleSegment(0,2*ve.circleOffset,ve.circleArray.length,ve.circleArray.length/2),null,M.zoom)}var Se;je.destroy(),ge.destroy()}const Eu=o.bB();function zv(p){const n=p._camera.getWorldToCamera(p.worldSize,1),c=o.aB([],n,p.globeMatrix);o.bk(c,c);const m=[0,0,0],v=[0,1,0,0];return o.aC(v,v,c),m[0]=v[0],m[1]=v[1],m[2]=v[2],o.aw(m,m),m}function Ig({width:p,height:n,anchor:c,textOffset:m,textScale:v},w){const{horizontalAlign:S,verticalAlign:C}=o.c0(c),j=-(S-.5)*p,M=-(C-.5)*n,D=o.c1(c,m);return new o.P((j/v+D[0])*w,(M/v+D[1])*w)}function kg(p,n,c,m,v,w,S,C,j,M){const D=p.text.placedSymbolArray,B=p.text.dynamicLayoutVertexArray,O=p.icon.dynamicLayoutVertexArray,G={},X=p.getProjection(),ee=Km(S,X,v),oe=v.elevation,ie=X.upVectorScale(S.canonical,v.center.lat,v.worldSize).metersToTile;B.clear();for(let ce=0;ce<D.length;ce++){const me=D.get(ce),{tileAnchorX:de,tileAnchorY:Ee,numGlyphs:ge}=me,je=me.hidden||!me.crossTileID||p.allowVerticalPlacement&&!me.placedOrientation?null:m[me.crossTileID];if(je){let Se=0,ve=0,Ie=0;const $e=p.elevationType==="road";if(oe||$e){const et=$e?p.getElevationFeatureForText(ce):null,Et=o.bU.getAtTileOffset(S,new o.P(de,Ee),oe,et),[$t,lr,Mt]=X.upVector(S.canonical,de,Ee);Se=Et*$t*ie,ve=Et*lr*ie,Ie=Et*Mt*ie}let[Fe,at,Qe,pt]=Gs(me.projectedAnchorX+Se,me.projectedAnchorY+ve,me.projectedAnchorZ+Ie,c?ee:w);const Ot=ov(v.getCameraToCenterDistance(X),pt);let Ye=o.bL(p.textSizeData,j,me)*Ot/o.bX;c&&(Ye*=p.tilePixelRatio/C);const Oe=Ig(je,Ye);c?({x:Fe,y:at,z:Qe}=X.projectTilePoint(de+Oe.x,Ee+Oe.y,S.canonical),[Fe,at,Qe]=Gs(Fe+Se,at+ve,Qe+Ie,w)):(n&&Oe._rotate(-v.angle),Fe+=Oe.x,at+=Oe.y,Qe=0);const mt=p.allowVerticalPlacement&&me.placedOrientation===o.bK.vertical?Math.PI/2:0;for(let et=0;et<ge;et++)o.bN(B,Fe,at,Qe,mt);M&&me.associatedIconIndex>=0&&(G[me.associatedIconIndex]={x:Fe,y:at,z:Qe,angle:mt})}else kc(ge,B)}if(M){O.clear();const ce=p.icon.placedSymbolArray;for(let me=0;me<ce.length;me++){const de=ce.get(me),{numGlyphs:Ee}=de,ge=G[me];if(de.hidden||!ge)kc(Ee,O);else{const{x:je,y:Se,z:ve,angle:Ie}=ge;for(let $e=0;$e<Ee;$e++)o.bN(O,je,Se,ve,Ie)}}p.icon.dynamicLayoutVertexBuffer.updateData(O)}p.text.dynamicLayoutVertexBuffer.updateData(B)}function Dp(p,n,c,m,v,w,S={}){const C=c.paint.get("icon-translate"),j=c.paint.get("text-translate"),M=c.paint.get("icon-translate-anchor"),D=c.paint.get("text-translate-anchor"),B=c.layout.get("icon-rotation-alignment"),O=c.layout.get("text-rotation-alignment"),G=c.layout.get("icon-pitch-alignment"),X=c.layout.get("text-pitch-alignment"),ee=c.layout.get("icon-keep-upright"),oe=c.layout.get("text-keep-upright"),ie=c.paint.get("icon-color-saturation"),ce=c.paint.get("icon-color-contrast"),me=c.paint.get("icon-color-brightness-min"),de=c.paint.get("icon-color-brightness-max"),Ee=c.layout.get("symbol-elevation-reference")==="sea",ge=c.layout.get("icon-image-use-theme")==="none",je=p.context,Se=je.gl,ve=p.transform,Ie=B==="map",$e=O==="map",Fe=G==="map",at=X==="map",Qe=c.layout.get("symbol-sort-key").constantOr(1)!==void 0;let pt=!1;const Ot=p.depthModeForSublayer(0,hr.ReadOnly),Ye=new hr(p.context.gl.LEQUAL,hr.ReadOnly,p.depthRangeFor3D),Oe=[o.aF(ve.center.lng),o.aJ(ve.center.lat)],mt=c.layout.get("text-variable-anchor"),et=ve.projection.name==="globe",Et=[],$t=[0,-1,0];for(const lr of m){const Mt=n.getTile(lr),zt=Mt.getBucket(c);if(!zt||zt.projection.name==="mercator"&&et||zt.fullyClipped)continue;const ur=zt.projection.name==="globe",nr=ur?o.aj(ve.zoom):0,er=Km(lr,zt.getProjection(),ve),ir=ve.calculatePixelsToTileUnitsMatrix(Mt),kr=mt&&zt.hasTextData(),xn=zt.hasIconTextFit()&&kr&&zt.hasIconData(),Mn=zt.getProjection().createInversionMatrix(ve,lr.canonical),fi=(1<<Mt.tileID.canonical.z)*o.al/p.transform.worldSize,Gr=ti=>{let Zr=[0,0,0];if(ti){const Ln=p.style.directionalLight,Gi=p.style.ambientLight;Ln&&Gi&&(Zr=al(p.style,Ln,Gi))}return Zr},Pn=ti=>{ve.depthOcclusionForSymbolsAndCircles&&(c.hasOcclusionOpacityProperties||p.terrain)&&(ti.push("DEPTH_D24"),ti.push("DEPTH_OCCLUSION"))},on=ti=>{c.lut&&!ge&&(c.lut.texture||(c.lut.texture=new o.d_(p.context,c.lut.image,[c.lut.image.height,c.lut.image.height,c.lut.image.height],je.gl.RGBA8)),je.activeTexture.set(je.gl.TEXTURE0+po.LUT),c.lut.texture&&c.lut.texture.bind(je.gl.LINEAR,je.gl.CLAMP_TO_EDGE),ti.push("APPLY_LUT_ON_GPU"))},ai=()=>{const ti=Ie&&c.layout.get("symbol-placement")!=="point",Zr=[];Pn(Zr),on(Zr);const Ln=ti||xn,Gi=zt.elevationType==="road",ds=p.shadowRenderer,Xi=Gi&&Fe&&!!ds&&ds.enabled,ss=Gr(Xi),aa=Gi&&Fe&&!p.terrain?Ye:Ot,Jo=c.paint.get("icon-image-cross-fade");p.terrainRenderModeElevated()&&Fe&&Zr.push("PITCH_WITH_MAP_TERRAIN"),ur&&(Zr.push("PROJECTION_GLOBE_VIEW"),Ln&&Zr.push("PROJECTED_POS_ON_VIEWPORT")),Jo>0&&zt.hasAnySecondaryIcon&&Zr.push("ICON_TRANSITION"),!zt.icon.zOffsetVertexBuffer||Gi&&p.terrain||Zr.push("Z_OFFSET"),ie===0&&ce===0&&me===0&&de===1||Zr.push("COLOR_ADJUSTMENT"),zt.sdfIcons&&Zr.push("RENDER_SDF"),Xi&&Zr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Gi&&Fe&&!p.terrain&&zt.icon.orientationVertexBuffer&&Zr.push("ELEVATED_ROADS");const wo=zt.icon.programConfigurations.get(c.id),ko=p.getOrCreateProgram("symbol",{config:wo,defines:Zr}),Da=Mt.imageAtlasTexture?Mt.imageAtlasTexture.size:[0,0],So=zt.iconSizeData,Oa=o.bJ(So,ve.zoom),fl=Fe||!ve.isOrthographic,no=sh(er,Mt.tileID.canonical,Fe,Ie,ve,zt.getProjection(),ir),es=Ic(er,Mt.tileID.canonical,Fe,Ie,ve,zt.getProjection(),ir),hs=p.translatePosMatrix(es,Mt,C,M,!0),wi=p.translatePosMatrix(er,Mt,C,M),_s=Ln?Eu:no,io=Ie&&!Fe&&!ti;let ts=$t;!et&&!ve.mercatorFromTransition||Ie||(ts=zv(ve));const La=ur?ts:$t,zh=c.getColorAdjustmentMatrix(ie,ce,me,de),Bc=Ov(So.kind,Oa,io,Fe,p,wi,_s,hs,Ee,!1,Da,[0,0],0,lr,nr,Oe,Mn,La,zt.getProjection(),ss,fi,zh,Jo,null),Fh=Mt.imageAtlasTexture?Mt.imageAtlasTexture:null,Bh=c.layout.get("icon-size").constantOr(0)!==1||zt.iconsNeedLinear,za=zt.sdfIcons||p.options.rotating||p.options.zooming||Bh||fl?Se.LINEAR:Se.NEAREST,ac=zt.sdfIcons&&c.paint.get("icon-halo-width").constantOr(1)!==0,eo=p.terrain&&Fe&&ti?o.bk(o.bB(),no):Eu;if(ti&&zt.icon){const Fa=o.bU.getAtTileOffsetFunc(lr,ve.center.lat,ve.worldSize,zt.getProjection()),Td=pp(er,Mt.tileID.canonical,Fe,Ie,ve,zt.getProjection(),ir),Bw=c.layout.get("icon-size-scale-range"),Yg=o.aA(p.scaleFactor,Bw[0],Bw[1]);lv(zt,er,p,!1,Td,es,Fe,ee,Fa,lr,Yg)}return{program:ko,buffers:zt.icon,uniformValues:Bc,atlasTexture:Fh,atlasTextureIcon:null,atlasInterpolation:za,atlasInterpolationIcon:null,isSDF:zt.sdfIcons,hasHalo:ac,depthMode:aa,tile:Mt,renderWithShadows:Xi,labelPlaneMatrixInv:eo}},Nn=()=>{const ti=$e&&c.layout.get("symbol-placement")!=="point",Zr=[],Ln=ti||mt||xn,Gi=zt.elevationType==="road",ds=p.shadowRenderer,Xi=Gi&&at&&!!ds&&ds.enabled,ss=Gr(Xi),aa=Gi&&at&&!p.terrain?Ye:Ot;p.terrainRenderModeElevated()&&at&&Zr.push("PITCH_WITH_MAP_TERRAIN"),ur&&(Zr.push("PROJECTION_GLOBE_VIEW"),Ln&&Zr.push("PROJECTED_POS_ON_VIEWPORT")),!zt.text.zOffsetVertexBuffer||Gi&&p.terrain||Zr.push("Z_OFFSET"),zt.iconsInText&&Zr.push("RENDER_TEXT_AND_SYMBOL"),Zr.push("RENDER_SDF"),Xi&&Zr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Gi&&at&&!p.terrain&&zt.text.orientationVertexBuffer&&Zr.push("ELEVATED_ROADS"),Pn(Zr);const Jo=zt.text.programConfigurations.get(c.id),wo=p.getOrCreateProgram("symbol",{config:Jo,defines:Zr});let ko,Da=[0,0],So=null;const Oa=zt.textSizeData;zt.iconsInText&&(Da=Mt.imageAtlasTexture?Mt.imageAtlasTexture.size:[0,0],So=Mt.imageAtlasTexture?Mt.imageAtlasTexture:null,ko=at||!ve.isOrthographic||p.options.rotating||p.options.zooming||Oa.kind==="composite"||Oa.kind==="camera"?Se.LINEAR:Se.NEAREST);const fl=Mt.glyphAtlasTexture?Mt.glyphAtlasTexture.size:[0,0],no=c.layout.get("text-size-scale-range"),es=o.aA(p.scaleFactor,no[0],no[1]),hs=o.bJ(Oa,ve.zoom,es),wi=sh(er,Mt.tileID.canonical,at,$e,ve,zt.getProjection(),ir),_s=Ic(er,Mt.tileID.canonical,at,$e,ve,zt.getProjection(),ir),io=p.translatePosMatrix(_s,Mt,j,D,!0),ts=p.translatePosMatrix(er,Mt,j,D),La=Ln?Eu:wi,zh=$e&&!at&&!ti;let Bc=$t;!et&&!ve.mercatorFromTransition||$e||(Bc=zv(ve));const Fh=Ov(Oa.kind,hs,zh,at,p,ts,La,io,Ee,!0,fl,Da,0,lr,nr,Oe,Mn,ur?Bc:$t,zt.getProjection(),ss,fi,null,null,es),Bh=Mt.glyphAtlasTexture?Mt.glyphAtlasTexture:null,za=Se.LINEAR,ac=c.paint.get("text-halo-width").constantOr(1)!==0,eo=p.terrain&&at&&ti?o.bk(o.bB(),wi):Eu;if(ti&&zt.text){const Fa=o.bU.getAtTileOffsetFunc(lr,ve.center.lat,ve.worldSize,zt.getProjection()),Td=pp(er,Mt.tileID.canonical,at,$e,ve,zt.getProjection(),ir);lv(zt,er,p,!0,Td,_s,at,oe,Fa,lr,es)}return{program:wo,buffers:zt.text,uniformValues:Fh,atlasTexture:Bh,atlasTextureIcon:So,atlasInterpolation:za,atlasInterpolationIcon:ko,isSDF:!0,hasHalo:ac,depthMode:aa,tile:Mt,renderWithShadows:Xi,labelPlaneMatrixInv:eo}},Si=zt.icon.segments.get().length,$n=zt.text.segments.get().length,an=Si&&!S.onlyText?ai():null,Qn=$n&&!S.onlyIcons?Nn():null,dn=c.paint.get("icon-opacity").constantOr(1),ki=c.paint.get("text-opacity").constantOr(1);if(Qe&&zt.canOverlap){pt=!0;const ti=dn&&!S.onlyText?zt.icon.segments.get():[],Zr=ki&&!S.onlyIcons?zt.text.segments.get():[];for(const Ln of ti)Et.push({segments:new o.bf([Ln]),sortKey:Ln.sortKey,state:an});for(const Ln of Zr)Et.push({segments:new o.bf([Ln]),sortKey:Ln.sortKey,state:Qn})}else S.onlyText||Et.push({segments:dn?zt.icon.segments:new o.bf([]),sortKey:0,state:an}),S.onlyIcons||Et.push({segments:ki?zt.text.segments:new o.bf([]),sortKey:0,state:Qn})}pt&&Et.sort((lr,Mt)=>lr.sortKey-Mt.sortKey);for(const lr of Et){const Mt=lr.state;if(Mt)if(p.terrain?p.terrain.setupElevationDraw(Mt.tile,Mt.program,{useDepthForOcclusion:ve.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Mt.labelPlaneMatrixInv}):p.setupDepthForOcclusion(ve.depthOcclusionForSymbolsAndCircles,Mt.program),je.activeTexture.set(Se.TEXTURE0),Mt.atlasTexture&&Mt.atlasTexture.bind(Mt.atlasInterpolation,Se.CLAMP_TO_EDGE,!0),Mt.atlasTextureIcon&&(je.activeTexture.set(Se.TEXTURE1),Mt.atlasTextureIcon&&Mt.atlasTextureIcon.bind(Mt.atlasInterpolationIcon,Se.CLAMP_TO_EDGE,!0)),Mt.renderWithShadows&&p.shadowRenderer.setupShadows(Mt.tile.tileID.toUnwrapped(),Mt.program,"vector-tile"),p.uploadCommonLightUniforms(p.context,Mt.program),Mt.hasHalo){const zt=Mt.uniformValues;zt.u_is_halo=1,Pg(Mt.buffers,lr.segments,c,p,Mt.program,Mt.depthMode,v,w,zt,2),zt.u_is_halo=0}else{if(Mt.isSDF){const zt=Mt.uniformValues;Mt.hasHalo&&(zt.u_is_halo=1,Pg(Mt.buffers,lr.segments,c,p,Mt.program,Mt.depthMode,v,w,zt,1)),zt.u_is_halo=0}Pg(Mt.buffers,lr.segments,c,p,Mt.program,Mt.depthMode,v,w,Mt.uniformValues,1)}}}function Pg(p,n,c,m,v,w,S,C,j,M){const D=[p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.iconTransitioningVertexBuffer,p.globeExtVertexBuffer,p.zOffsetVertexBuffer,p.orientationVertexBuffer];v.draw(m,m.context.gl.TRIANGLES,w,S,C,qr.disabled,j,c.id,p.layoutVertexBuffer,p.indexBuffer,n,c.paint,m.transform.zoom,p.programConfigurations.get(c.id),D,M)}function _w(p,n){const c=1<<p.canonical.z,m=(n.x*c-p.canonical.x-p.wrap*c)*o.al,v=(n.y*c-p.canonical.y)*o.al,w=o.e7(n.z,n.y);return o.d4(m,v,w)}function yd(p,n,c,m,v){if(!c.layout||c.layout.get("fill-elevation-reference")==="none"||c.paint.get("fill-opacity").constantOr(1)===0)return;const w=p.context.gl,S=new hr(p.context.gl.LEQUAL,hr.ReadWrite,p.depthRangeFor3D),C=new hr(p.context.gl.GREATER,hr.ReadWrite,p.depthRangeFor3D),j=function(G){let X=.01;return G.isOrthographic&&(X=o.ak(1e-4,X,o.c$(G.pitch>=hd?1:G.pitch/hd))),2*X}(p.transform),M=p.transform.getFreeCameraOptions().position,D="elevatedStructuresDepthReconstruct",B=p.getOrCreateProgram(D,{defines:["DEPTH_RECONSTRUCTION"]}),O=p.getOrCreateProgram(D);for(const G of m){const X=n.getTile(G),ee=X.getBucket(c);if(!ee)continue;const oe=ee.elevatedStructures;if(!oe)continue;const ie=ee.elevationBufferData.heightRange,ce=_w(G.toUnwrapped(),M),me=p.translatePosMatrix(G.projMatrix,X,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));let de,Ee,ge,je;if(v==="initialize"){if(!ie||ie.min>=1||oe.depthSegments.segments[0].primitiveLength===0)continue;de=xg(me,ce,j,1,0),Ee=S,ge=oe.depthSegments,je=B}else if(v==="reset"){if(!ie||ie.min>=0||oe.maskSegments.segments[0].primitiveLength===0)continue;de=xg(me,ce,0,0,1),Ee=C,ge=oe.maskSegments,je=B}else if(v==="geometry"){if(oe.depthSegments.segments[0].primitiveLength===0)continue;de=xg(me,ce,j,1,0),Ee=S,ge=oe.depthSegments,je=O}je.draw(p,w.TRIANGLES,Ee,Kr.disabled,un.disabled,qr.disabled,de,c.id,oe.vertexBuffer,oe.indexBuffer,ge,c.paint,p.transform.zoom)}}function Th(p,n,c){const{painter:m,sourceCache:v,layer:w,coords:S,colorMode:C,elevationType:j,terrainEnabled:M,pass:D}=p,B=m.context.gl,O=w.paint.get("fill-pattern"),G=w.paint.get("fill-pattern-cross-fade"),X=O.constantOr(null);let ee=j;j!=="road"||n&&!M||(ee="none");const oe=ee==="road",ie=p.painter.shadowRenderer,ce=oe&&!!ie&&ie.enabled,me=new hr(m.context.gl.LEQUAL,hr.ReadOnly,m.depthRangeFor3D);let de=[0,0,0];if(ce){const je=m.style.directionalLight,Se=m.style.ambientLight;je&&Se&&(de=al(m.style,je,Se))}const Ee=O&&O.constantOr(1),ge=(je,Se)=>{let ve,Ie,$e,Fe,at;Se?(ve=Ee&&!w.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",$e=B.LINES):(ve=Ee?"fillPattern":"fill",$e=B.TRIANGLES);for(const Qe of S){const pt=v.getTile(Qe);if(Ee&&!pt.patternsLoaded())continue;const Ot=pt.getBucket(w);if(!Ot)continue;const Ye=n?Ot.elevationBufferData:Ot.bufferData;if(Ye.isEmpty())continue;m.prepareDrawTile();const Oe=Ye.programConfigurations.get(w.id),mt=m.isTileAffectedByFog(Qe),et=[],Et=[];oe&&(et.push("ELEVATED_ROADS"),Et.push(Ye.elevatedLayoutVertexBuffer)),ce&&et.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ee&&(m.context.activeTexture.set(B.TEXTURE0),pt.imageAtlasTexture&&pt.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Oe.updatePaintBuffers());let $t=!1;if(X&&pt.imageAtlas){const nr=pt.imageAtlas,er=o.e2.from(X),ir=er.getPrimary().scaleSelf(o.o.devicePixelRatio).toString(),kr=er.getSecondary(),xn=nr.patternPositions.get(ir),Mn=kr?nr.patternPositions.get(kr.scaleSelf(o.o.devicePixelRatio).toString()):null;$t=!!xn&&!!Mn,xn&&Oe.setConstantPatternPositions(xn,Mn)}G>0&&($t||Oe.getPatternTransitionVertexBuffer("fill-pattern"))&&et.push("FILL_PATTERN_TRANSITION");const lr=m.getOrCreateProgram(ve,{config:Oe,overrideFog:mt,defines:et}),Mt=m.translatePosMatrix(Qe.projMatrix,pt,w.paint.get("fill-translate"),w.paint.get("fill-translate-anchor"));ce&&ie.setupShadows(pt.tileID.toUnwrapped(),lr,"vector-tile");const zt=w.paint.get("fill-emissive-strength");if(Se){Fe=Ye.lineIndexBuffer,at=Ye.lineSegments;const nr=m.terrain&&m.terrain.renderingToTexture?m.terrain.drapeBufferSize:[B.drawingBufferWidth,B.drawingBufferHeight];Ie=ve==="fillOutlinePattern"&&Ee?oE(Mt,zt,m,pt,nr,de,G):sE(Mt,zt,nr,de)}else Fe=Ye.indexBuffer,at=Ye.triangleSegments,Ie=Ee?hw(Mt,zt,m,pt,de,G):dw(Mt,zt,de);m.uploadCommonUniforms(m.context,lr,Qe.toUnwrapped());let ur=je;(j==="road"&&!M||j==="offset")&&(ur=me),lr.draw(m,$e,ur,c||m.stencilModeForClipping(Qe),C,qr.disabled,Ie,w.id,Ye.layoutVertexBuffer,Fe,at,w.paint,m.transform.zoom,Oe,Et)}};m.renderPass===D&&ge(m.depthModeForSublayer(1,m.renderPass==="opaque"?hr.ReadWrite:hr.ReadOnly),!1),ee==="none"&&m.renderPass==="translucent"&&w.paint.get("fill-antialias")&&ge(m.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,hr.ReadOnly),!0)}function or(p,n,c,m,v,w,S,C){c.resetLayerRenderingStats(p);const j=p.context,M=j.gl,D=p.transform,B=c.paint.get("fill-extrusion-pattern"),O=c.paint.get("fill-extrusion-pattern-cross-fade"),G=B.constantOr(null),X=B.constantOr(1),ee=c.paint.get("fill-extrusion-opacity"),oe=p.style.enable3dLights(),ie=c.paint.get(oe&&!X?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ce=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),ie],me=c.layout.get("fill-extrusion-edge-radius"),de=me>0&&!c.paint.get("fill-extrusion-rounded-roof"),Ee=de?0:me,ge=D.projection.name==="globe"?o.ea():0,je=D.projection.name==="globe",Se=je?o.aj(D.zoom):0,ve=[o.aF(D.center.lng),o.aJ(D.center.lat)],Ie=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",$e=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Ie?null:c.lut).toArray01().slice(0,3),Fe=c.paint.get("fill-extrusion-flood-light-intensity"),at=c.paint.get("fill-extrusion-vertical-scale"),Qe=c.paint.get("fill-extrusion-line-width").constantOr(1)!==0,pt=c.paint.get("fill-extrusion-height-alignment"),Ot=c.paint.get("fill-extrusion-base-alignment"),Ye=Mc(p,c.paint.get("fill-extrusion-cutoff-fade-range")),Oe=[];let mt;je&&Oe.push("PROJECTION_GLOBE_VIEW"),ce[0]>0&&Oe.push("FAUX_AO"),de&&Oe.push("ZERO_ROOF_RADIUS"),C&&Oe.push("HAS_CENTROID"),Fe>0&&Oe.push("FLOOD_LIGHT"),Ye.shouldRenderCutoff&&Oe.push("RENDER_CUTOFF"),Qe&&Oe.push("RENDER_WALL_MODE");const et=p.renderPass==="shadow",Et=p.shadowRenderer,$t=et&&!!Et,lr=et?qr.disabled:qr.backCCW;p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!0);let Mt=[0,0,0];if(Et){const nr=p.style.directionalLight,er=p.style.ambientLight;nr&&er&&(Mt=al(p.style,nr,er)),et||(Oe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Et.useNormalOffset&&Oe.push("NORMAL_OFFSET")),mt=Oe.concat(["SHADOWS_SINGLE_CASCADE"])}const zt=$t?"fillExtrusionDepth":X?"fillExtrusionPattern":"fillExtrusion",ur=c.getLayerRenderingStats();for(const nr of m){const er=n.getTile(nr),ir=er.getBucket(c);if(!ir||ir.projection.name!==D.projection.name)continue;let kr=!1;Et&&(kr=Et.getMaxCascadeForTile(nr.toUnwrapped())===0);const xn=p.isTileAffectedByFog(nr),Mn=ir.programConfigurations.get(c.id);let fi=!1;if(G&&er.imageAtlas){const $n=er.imageAtlas,an=o.e2.from(G),Qn=an.getPrimary().scaleSelf(o.o.devicePixelRatio).toString(),dn=an.getSecondary(),ki=$n.patternPositions.get(Qn),ti=dn?$n.patternPositions.get(dn.scaleSelf(o.o.devicePixelRatio).toString()):null;fi=!!ki&&!!ti,ki&&Mn.setConstantPatternPositions(ki,ti)}O>0&&(fi||Mn.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Oe.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Gr=p.getOrCreateProgram(zt,{config:Mn,defines:kr?mt:Oe,overrideFog:xn});if(p.terrain&&p.terrain.setupElevationDraw(er,Gr,{useMeterToDem:!0}),!ir.centroidVertexBuffer){const $n=Gr.getAttributeLocation(M,"a_centroid_pos");$n!==-1&&M.vertexAttrib2f($n,0,0)}!et&&Et&&Et.setupShadows(er.tileID.toUnwrapped(),Gr,"vector-tile"),X&&(p.context.activeTexture.set(M.TEXTURE0),er.imageAtlasTexture&&er.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),Mn.updatePaintBuffers());const Pn=c.paint.get("fill-extrusion-vertical-gradient"),on=1/ir.tileToMeter;let ai;if(et&&Et){if(yw(er.tileID,ir.maxHeight,p))continue;const $n=Et.calculateShadowPassMatrixFromTile(er.tileID.toUnwrapped());ai=cw($n,Ee,on,at,pt,Ot)}else{const $n=p.translatePosMatrix(nr.expandedProjMatrix,er,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),an=D.projection.createInversionMatrix(D,nr.canonical);ai=X?uw($n,p,Pn,ee,ce,Ee,on,nr,er,ge,pt,Ot,Se,ve,an,$e,at,O):vg($n,p,Pn,ee,ce,Ee,on,nr,ge,pt,Ot,Se,ve,an,$e,at,Fe,Mt)}p.uploadCommonUniforms(j,Gr,nr.toUnwrapped(),null,Ye);let Nn=ir.segments;if(D.projection.name==="mercator"&&!et&&(Nn=ir.getVisibleSegments(er.tileID,p.terrain,p.transform.getFrustum(0)),!Nn.get().length))continue;if(ur)if(et)for(const $n of Nn.get())ur.numRenderedVerticesInShadowPass+=$n.primitiveLength;else for(const $n of Nn.get())ur.numRenderedVerticesInTransparentPass+=$n.primitiveLength;const Si=[];(p.terrain||C)&&Si.push(ir.centroidVertexBuffer),je&&Si.push(ir.layoutVertexExtBuffer),Qe&&Si.push(ir.wallVertexBuffer),Gr.draw(p,j.gl.TRIANGLES,v,w,S,lr,ai,c.id,ir.layoutVertexBuffer,ir.indexBuffer,Nn,c.paint,p.transform.zoom,Mn,Si)}p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!1)}class Fv{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Dc(p,n,c,m,v,w,S,C,j,M,D,B,O,G,X,ee,oe,ie,ce,me){const de=n.context,Ee=de.gl,ge=n.transform,je=n.transform.zoom,Se=[],ve=p.translate,Ie=p.translateAnchor,$e=p.edgeRadius,Fe=Mc(n,p.cutoffFadeRange);D==="clear"?(Se.push("CLEAR_SUBPASS"),me&&(Se.push("CLEAR_FROM_TEXTURE"),de.activeTexture.set(Ee.TEXTURE0),me.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE))):D==="sdf"&&Se.push("SDF_SUBPASS"),ie&&Se.push("HAS_CENTROID"),Fe.shouldRenderCutoff&&Se.push("RENDER_CUTOFF");const at=(Qe,pt,Ot,Ye,Oe)=>{let mt=Se;pt.groundRadiusBuffer!=null&&(mt=Se.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const et=pt.programConfigurations.get(m.id),Et=n.isTileAffectedByFog(Qe),$t=n.getOrCreateProgram("fillExtrusionGroundEffect",{config:et,defines:mt,overrideFog:Et}),lr=bh(n,Ye,B,M,Oe,[O,G*Oe],X,ee,oe,je>=17?0:$e*Oe,me?me.size[0]:0),Mt=[];ie&&Mt.push(pt.hiddenByLandmarkVertexBuffer),pt.groundRadiusBuffer!=null&&Mt.push(pt.groundRadiusBuffer),n.uploadCommonUniforms(de,$t,Qe.toUnwrapped(),null,Fe),$t.draw(n,de.gl.TRIANGLES,w,S,C,j,lr,m.id,pt.vertexBuffer,pt.indexBuffer,Ot,m.paint,je,et,Mt)};for(const Qe of v){const pt=c.getTile(Qe),Ot=pt.getBucket(m);if(!Ot||Ot.projection.name!==ge.projection.name||!Ot.groundEffect||Ot.groundEffect&&!Ot.groundEffect.hasData())continue;const Ye=Ot.groundEffect,Oe=1/Ot.tileToMeter;{const mt=n.translatePosMatrix(Qe.projMatrix,pt,ve,Ie),et=Ye.getDefaultSegment();at(Qe,Ye,et,mt,Oe)}if(ce)for(let mt=0;mt<4;mt++){const et=o.e8[mt](Qe),Et=c.getTile(et);if(!Et)continue;const $t=Et.getBucket(m);if(!$t||$t.projection.name!==ge.projection.name||!$t.groundEffect||$t.groundEffect&&!$t.groundEffect.hasData())continue;const lr=$t.groundEffect;let Mt,zt;mt===0?(Mt=[-o.al,0,0],zt=1):mt===1?(Mt=[o.al,0,0],zt=0):mt===2?(Mt=[0,-o.al,0],zt=3):(Mt=[0,o.al,0],zt=2);const ur=lr.regionSegments[zt];if(!ur)continue;const nr=new Float32Array(16);o.bq(nr,Qe.projMatrix,Mt),at(Qe,lr,ur,n.translatePosMatrix(nr,pt,ve,Ie),Oe)}}}function Cu(p,n,c,m,v,w,S){m.centroidVertexArray.length===0&&m.createCentroidsBuffer();const C=w?w.findDEMTileFor(c):null;if(!(C&&C.dem||S))return;w&&C&&C.dem&&m.selfDEMTileTimestamp!==C.dem._timestamp&&(m.borderDoneWithNeighborZ=[-1,-1,-1,-1],m.selfDEMTileTimestamp=C.dem._timestamp);const j=ie=>new o.P(Math.ceil((ie+o.ec)*o.ed),0),M=ie=>{const ce=n.getSource().minzoom,me=Ee=>{const ge=n.getTileByID(Ee);if(ge&&ge.hasData())return ge.getBucket(v)},de=[0,-1,1];for(const Ee of de){if(ie.overscaledZ+Ee<ce)continue;const ge=me(ie.calculateScaledKey(ie.overscaledZ+Ee));if(ge)return ge}},D=[0,0,0],B=(ie,ce)=>(D[0]=Math.min(ie.min.y,ce.min.y),D[1]=Math.max(ie.max.y,ce.max.y),D[2]=o.al-ce.min.x>ie.max.x?ce.min.x-o.al:ie.max.x,D),O=(ie,ce)=>(D[0]=Math.min(ie.min.x,ce.min.x),D[1]=Math.max(ie.max.x,ce.max.x),D[2]=o.al-ce.min.y>ie.max.y?ce.min.y-o.al:ie.max.y,D),G=[(ie,ce)=>B(ie,ce),(ie,ce)=>B(ce,ie),(ie,ce)=>O(ie,ce),(ie,ce)=>O(ce,ie)],X=(ie,ce,me,de,Ee,ge,je)=>{if(!w)return 0;const Se=[[ge?me:ie,ge?ie:me,0],[ge?me:ce,ge?ce:me,0]],ve=je<0?o.al+je:je,Ie=[ge?ve:(ie+ce)/2,ge?(ie+ce)/2:ve,0];return me===0&&je<0||me!==0&&je>0?w.getForTilePoints(Ee,[Ie],!0,de):Se.push(Ie),w.getForTilePoints(c,Se,!0,C),Math.max(Se[0][2],Se[1][2],Ie[2])/w.exaggeration()};for(let ie=0;ie<4;ie++){const ce=m.borderFeatureIndices[ie];if(ce.length===0)continue;const me=o.e8[ie](c),de=M(me);if(!(de&&de instanceof o.e9))continue;const Ee=w?w.findDEMTileFor(me):null;if(!(Ee&&Ee.dem||S)||(w&&Ee&&Ee.dem&&m.borderDEMTileTimestamp[ie]!==Ee.dem._timestamp&&(m.borderDoneWithNeighborZ[ie]=-1,m.borderDEMTileTimestamp[ie]=Ee.dem._timestamp),m.borderDoneWithNeighborZ[ie]===de.canonical.z))continue;de.centroidVertexArray.length===0&&de.createCentroidsBuffer();const ge=(ie<2?1:5)-ie,je=de.borderDoneWithNeighborZ[ge]!==m.canonical.z,Se=de.borderFeatureIndices[ge];let ve=0;if(m.canonical.z!==de.canonical.z){for(const Ie of ce)m.showCentroid(m.featuresOnBorder[Ie]);if(je)for(const Ie of Se)de.showCentroid(de.featuresOnBorder[Ie]);m.borderDoneWithNeighborZ[ie]=de.canonical.z,de.borderDoneWithNeighborZ[ge]=m.canonical.z}for(const Ie of ce){const $e=m.featuresOnBorder[Ie],Fe=m.centroidData[$e.centroidDataIndex],at=$e.borders[ie];let Qe;for(;ve<Se.length;){Qe=de.featuresOnBorder[Se[ve]];const pt=Qe.borders[ge];if(pt[1]>at[0]+3||pt[0]>at[0]-3)break;de.showCentroid(Qe),ve++}if(Qe&&ve<Se.length){const pt=ve;let Ot=0;for(;!(Qe.borders[ge][0]>at[1]-3)&&(Ot++,++ve!==Se.length);)Qe=de.featuresOnBorder[Se[ve]];Qe=de.featuresOnBorder[Se[pt]];let Ye=!1;if(Ot>=1){const et=Qe.borders[ge];Math.abs(at[0]-et[0])<3&&Math.abs(at[1]-et[1])<3&&(Ot=1,Ye=!0,ve=pt+1)}else if(Ot===0){m.showCentroid($e);continue}const Oe=de.centroidData[Qe.centroidDataIndex];S&&Ye&&(((ee=Fe).flags|(oe=Oe).flags)&o.eb?(ee.flags|=o.eb,oe.flags|=o.eb):(ee.flags&=~o.eb,oe.flags&=~o.eb));const mt=$e.intersectsCount()>1||Qe.intersectsCount()>1;if(Ot>1)ve=pt,Fe.centroidXY=Oe.centroidXY=new o.P(0,0);else if(Ee&&Ee.dem&&!mt){const et=G[ie](Fe,Oe),Et=ie%2?o.al-1:0,$t=X(et[0],Math.min(o.al-1,et[1]),Et,Ee,me,ie<2,et[2]);Fe.centroidXY=Oe.centroidXY=j($t)}else mt?Fe.centroidXY=Oe.centroidXY=new o.P(0,0):(Fe.centroidXY=m.encodeBorderCentroid($e),Oe.centroidXY=de.encodeBorderCentroid(Qe));m.writeCentroidToBuffer(Fe),de.writeCentroidToBuffer(Oe)}else m.showCentroid($e)}m.borderDoneWithNeighborZ[ie]=de.canonical.z,de.borderDoneWithNeighborZ[ge]=m.canonical.z}var ee,oe;(m.needsCentroidUpdate||!m.centroidVertexBuffer&&m.centroidVertexArray.length!==0)&&m.uploadCentroid(p)}const Au=[1,0,0],Ir=[0,1,0],Bv=[0,0,1];function yw(p,n,c){const m=c.transform,v=c.shadowRenderer;if(!v)return!0;const w=p.toUnwrapped(),S=m.tileSize*v._cascades[c.currentShadowCascade].scale;let C=n;if(m.elevation){const ee=m.elevation.getMinMaxForTile(p);ee&&(C+=ee.max)}const j=[...v.shadowDirection];j[2]=-j[2];const M=v.computeSimplifiedTileShadowVolume(w,C,S,j);if(!M)return!1;const D=[Au,Ir,Bv,j,[j[0],0,j[2]],[0,j[1],j[2]]],B=m.projection.name==="globe",O=m.scaleZoom(S),G=o.cA.fromInvProjectionMatrix(m.invProjMatrix,m.worldSize,O,!B),X=v.getCurrentCascadeFrustum();return G.intersectsPrecise(M.vertices,M.planes,D)===0||X.intersectsPrecise(M.vertices,M.planes,D)===0}function Rg(p){const{painter:n,source:c,layer:m,coords:v}=p;let w=p.defines;const S=n.context,C=n.renderPass==="shadow",j=n.renderPass==="light-beam",M=n.shadowRenderer,D=o.ee(n.transform.center.lat,n.transform.zoom),B=Mc(n,m.paint.get("building-cutoff-fade-range"));B.shouldRenderCutoff&&(w=w.concat("RENDER_CUTOFF")),p.floodLightIntensity>0&&(w=w.concat("FLOOD_LIGHT"));for(const O of v){const G=c.getTile(O),X=G.getBucket(m);if(!X)continue;M&&M.getMaxCascadeForTile(O.toUnwrapped())===0&&(w=w.concat("SHADOWS_SINGLE_CASCADE"));const ee=X.programConfigurations.get(m.id);let oe,ie,ce,me=n.translatePosMatrix(O.expandedProjMatrix,G,[0,0],"map");if(me=o.cR(o.bB(),me,[1,1,p.verticalScale]),C&&M){if(yw(G.tileID,X.maxHeight*D,n))continue;let Ee=M.calculateShadowPassMatrixFromTile(G.tileID.toUnwrapped());Ee=o.cR(o.bB(),Ee,[1,1,p.verticalScale]),ce=fw(Ee),oe=ie=n.getOrCreateProgram("buildingDepth",{config:ee,defines:w,overrideFog:!1})}else if(j)oe=ie=n.getOrCreateProgram("buildingBloom",{config:ee,defines:w,overrideFog:!1}),ce=Rv(me);else{const Ee=n.transform.calculatePosMatrix(O.toUnwrapped(),n.transform.worldSize);o.cR(Ee,Ee,[1,1,p.verticalScale]);const ge=o.bB();o.cR(ge,Ee,[1,-1,1/D]),o.bk(ge,ge),o.ef(ge,ge);const je=n.transform.getFreeCameraOptions().position,Se=1<<O.canonical.z;if(ce=Pv(me,ge,p.opacity,p.facadeAOIntensity,[((je.x-O.wrap)*Se-O.canonical.x)*o.al,(je.y*Se-O.canonical.y)*o.al,je.z*Se*o.al],X.tileToMeter,p.facadeEmissiveChance,p.floodLightColor,p.floodLightIntensity),ie=n.getOrCreateProgram("building",{config:ee,defines:w,overrideFog:!1}),p.depthOnly===!0)oe=ie;else{const ve=w.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);oe=n.getOrCreateProgram("building",{config:ee,defines:ve,overrideFog:!1})}M&&(M.setupShadowsFromMatrix(Ee,ie,!0),oe!==ie&&M.setupShadowsFromMatrix(Ee,oe,!0))}const de=(Ee,ge)=>{if(j){const je=Ee.entranceBloom;ge.draw(n,S.gl.TRIANGLES,p.depthMode,Kr.disabled,p.blendMode,qr.disabled,ce,m.id,je.layoutVertexBuffer,je.indexBuffer,je.segmentsBucket,m.paint,n.transform.zoom,ee,[je.layoutAttenuationBuffer,je.layoutColorBuffer])}else{const je=Ee.segmentsBucket;let Se=[Ee.layoutNormalBuffer,Ee.layoutCentroidBuffer,Ee.layoutColorBuffer,Ee.layoutFloodLightDataBuffer];Ee.layoutFacadePaintBuffer&&(Se=Se.concat([Ee.layoutFacadeDataBuffer,Ee.layoutFacadeVerticalRangeBuffer,Ee.layoutFacadePaintBuffer])),ge.draw(n,S.gl.TRIANGLES,p.depthMode,Kr.disabled,p.blendMode,C?qr.disabled:qr.backCW,ce,m.id,Ee.layoutVertexBuffer,Ee.indexBuffer,je,m.paint,n.transform.zoom,ee,Se)}};n.uploadCommonUniforms(S,ie,O.toUnwrapped(),null,B),X.buildingWithoutFacade&&de(X.buildingWithoutFacade,ie),X.buildingWithFacade&&(oe!==ie&&n.uploadCommonUniforms(S,oe,O.toUnwrapped(),null,B),de(X.buildingWithFacade,oe))}}function Mg(p,n,c,m,v,w,S,C,j,M,D,B,O){const G=p.context.gl,X=p.depthModeForSublayer(1,hr.ReadOnly,G.LEQUAL,!0),ee=.1*(1-(oe=D))+3*oe;var oe;const ie=p._showOverdrawInspector,ce=B,me=new Fv;ie||Dc(me,p,n,c,m,X,new Kr({func:G.ALWAYS,mask:255},255,255,G.KEEP,G.KEEP,G.REPLACE),new un([G.ONE,G.ONE,G.ONE,G.ONE],o.ao.transparent,[!1,!1,!1,!0],G.MIN),qr.disabled,v,"sdf",w,S,C,j,M,ee,ce,!1);{const de=ie?Kr.disabled:new Kr({func:G.EQUAL,mask:255},255,255,G.KEEP,G.DECR,G.DECR),Ee=ie?p.colorModeForRenderPass():new un([G.ONE_MINUS_DST_ALPHA,G.DST_ALPHA,G.ONE,G.ONE],o.ao.transparent,[!0,!0,!0,!0]);Dc(me,p,n,c,m,X,de,Ee,qr.disabled,v,"color",w,S,C,j,M,ee,ce,!1)}}function Vv(p){return[p[0]*o.eg,p[1]*o.eg,p[2]*o.eg,0]}function Uv(p,n,c,m,v,w,S,C,j){const M=m.getSource(),D=c.globeSharedBuffers;if(!D)return;let B,O,G;if(n&&(B=m.getTile(n)),M instanceof o.aT?(O=M.texture,G=o.dJ(0,0,c.transform)):B&&n&&(O=B.texture,G=o.dJ(n.canonical.z,n.canonical.x,c.transform)),!O||!G)return;p||(G=o.cR(o.bB(),G,[1,-1,1]));const X=c.context,ee=X.gl,oe=v.paint.get("raster-resampling")==="nearest"?ee.NEAREST:ee.LINEAR,ie=c.colorModeForDrapableLayerRenderPass(w),ce=S.defines;ce.push("GLOBE_POLES");const me=new hr(ee.LEQUAL,hr.ReadWrite,c.depthRangeFor3D),de=Float32Array.from(c.transform.expandedFarZProjMatrix),Ee=Float32Array.from(o.bj(o.dI(new o.cC(0,0,0))));c.terrain&&c.terrain.prepareDrawTile(),X.activeTexture.set(ee.TEXTURE0),O.bind(oe,ee.CLAMP_TO_EDGE),X.activeTexture.set(ee.TEXTURE1),O.bind(oe,ee.CLAMP_TO_EDGE),"useMipmap"in O&&X.extTextureFilterAnisotropic&&c.transform.pitch>20&&ee.texParameterf(ee.TEXTURE_2D,X.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,X.extTextureFilterAnisotropicMax);const[ge,je,Se,ve]=n?D.getPoleBuffers(n.canonical.z,!1):D.getPoleBuffers(0,!0),Ie=v.paint.get("raster-elevation");let $e;p?($e=ge,c.renderDefaultNorthPole=Ie!==0):($e=je,c.renderDefaultSouthPole=Ie!==0);const Fe=Vv(S.mix),at=((pt,Ot,Ye,Oe,mt,et,Et,$t,lr,Mt,zt,ur,nr)=>Mp(pt,Ot,Ye,new Float32Array(16),new Float32Array(9),[0,0],Oe,[0,0],[0,0,0,0],1,{opacity:1,mix:0},et,[0,0],$t,2,Mt,zt,ur,1,0,nr))(de,Ee,G,o.aj(c.transform.zoom),0,v,0,Ie,0,Fe,S.offset,S.range,w),Qe=c.getOrCreateProgram("raster",{defines:ce});c.uploadCommonUniforms(X,Qe,null),Qe.draw(c,ee.TRIANGLES,me,j,ie,C,at,v.id,$e,Se,ve)}function vw(p){const n=p._nearZ,c=p.projection.farthestPixelDistance(p),m=c-n,v=.2*p.height,w=n+v;return[n,c,(w-v-n)/m,(w-n)/m]}function uE(p,n,c,m){if(p)return n instanceof Js&&p instanceof vu?n.getTextureDescriptor(p,c,!0):{texture:p.texture,mix:Vv(m.mix),offset:m.offset,buffer:0,tileSize:1}}var dE=o.eh([{name:"a_index",type:"Int16",components:1}]);class ga{constructor(n,c,m,v){const w={width:m[0],height:m[1],data:null},S=n.gl;this.targetColorTexture=new o.T(n,w,S.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new o.T(n,w,S.RGBA8,{useMipmap:!1}),this.context=n,this.updateParticleTexture(c,v),this.lastInvalidatedAt=0}updateParticleTexture(n,c){if(this.particleTextureDimension===c.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const m=this.context.gl,v=c.width*c.height;this.particleTexture0=new o.T(this.context,c,m.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new o.T(this.context,c,m.RGBA8,{premultiply:!1,useMipmap:!1});const w=new o.ei;w.reserve(v);for(let S=0;S<v;S++)w.emplaceBack(S);this.particleIndexBuffer=this.context.createVertexBuffer(w,dE.members,!0),this.particleSegment=o.bf.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=c.width}update(n){return!(this.lastInvalidatedAt<n&&(this.lastInvalidatedAt=o.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function $v(p,n,c){if(!p)return null;const m=n.getTextureDescriptor(p,c,!0);if(!m)return null;let{texture:v,mix:w,offset:S,tileSize:C,buffer:j,format:M}=m;if(!v||!M)return null;let D=!1;return M==="uint32"&&(D=!0,w[3]=0,w=bg(o.ej,w,[0,c.paint.get("raster-particle-max-speed")]),S=Nc(o.ej,S,[0,c.paint.get("raster-particle-max-speed")])),{texture:v,textureOffset:[j/(C+2*j),C/(C+2*j)],tileSize:C,scalarData:D,scale:w,offset:S,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[M]]}}function Yo(p){const n=p._nearZ,c=p.projection.farthestPixelDistance(p),m=c-n,v=.2*p.height,w=n+v;return[n,c,(w-v-n)/m,(w-n)/m]}const ju=new o.ao(1,0,0,1),xw=new o.ao(0,1,0,1),qv=new o.ao(0,0,1,1),Gv=new o.ao(1,0,1,1),Hv=new o.ao(0,1,1,1);function Wv(p,n,c,m,v,w){for(let S=0;S<c.length;S++)if(v){const M=new o.ao(m.r*.8,m.g*.8,m.b*.8,1);_a(p,n,c[S],m,-1,-1,w),_a(p,n,c[S],m,-1,1,w),_a(p,n,c[S],m,1,1,w),_a(p,n,c[S],m,1,-1,w),_a(p,n,c[S],M,0,0,w)}else _a(p,n,c[S],m,0,0,w)}function _a(p,n,c,m,v,w,S){const C=p.context,j=p.transform,M=C.gl,D=j.projection.name==="globe",B=D?["PROJECTION_GLOBE_VIEW"]:[];let O=o.by(c.projMatrix);if(D&&o.aj(j.zoom)>0){const Fe=o.bi(c.canonical,j),at=o.ek(Fe);O=o.aB(new Float32Array(16),j.globeMatrix,at),o.aB(O,j.projMatrix,O)}const G=o.bB();G[12]+=2*v/(o.o.devicePixelRatio*j.width),G[13]+=2*w/(o.o.devicePixelRatio*j.height),o.aB(O,G,O);const X=p.getOrCreateProgram("debug",{defines:B}),ee=n.getTileByID(c.key);p.terrain&&p.terrain.setupElevationDraw(ee,X);const oe=hr.disabled,ie=Kr.disabled,ce=p.colorModeForRenderPass(),me="$debug";C.activeTexture.set(M.TEXTURE0),p.emptyTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),D?ee._makeGlobeTileDebugBuffers(p.context,j):ee._makeDebugTileBoundsBuffers(p.context,j.projection);const de=ee._tileDebugBuffer||p.debugBuffer,Ee=ee._tileDebugIndexBuffer||p.debugIndexBuffer,ge=ee._tileDebugSegments||p.debugSegments;if(X.draw(p,M.LINE_STRIP,oe,ie,ce,qr.disabled,Mv(O,m.toPremultipliedRenderColor(null)),me,de,Ee,ge,null,null,null,[ee._globeTileDebugBorderBuffer]),S){const Fe=ee.latestRawTileData,at=Math.floor((Fe&&Fe.byteLength||0)/1024);let Qe=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Qe+=` => ${c.overscaledZ}`),Qe+=` ${ee.state}`,Qe+=` ${at}kb`,function(pt,Ot){pt.initDebugOverlayCanvas();const Ye=pt.debugOverlayCanvas,Oe=pt.context.gl,mt=pt.debugOverlayCanvas.getContext("2d");mt.clearRect(0,0,Ye.width,Ye.height),mt.shadowColor="white",mt.shadowBlur=2,mt.lineWidth=1.5,mt.strokeStyle="white",mt.textBaseline="top",mt.font="bold 36px Open Sans, sans-serif",mt.fillText(Ot,5,5),mt.strokeText(Ot,5,5),pt.debugOverlayTexture.update(Ye),pt.debugOverlayTexture.bind(Oe.LINEAR,Oe.CLAMP_TO_EDGE)}(p,Qe)}const je=n.getTile(c).tileSize,Se=512/Math.min(je,512)*(c.overscaledZ/j.zoom)*.5,ve=ee._tileDebugTextBuffer||p.debugBuffer,Ie=ee._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,$e=ee._tileDebugTextSegments||p.debugSegments;X.draw(p,M.TRIANGLES,oe,ie,un.alphaBlended,qr.disabled,Mv(O,o.ao.transparent.toPremultipliedRenderColor(null),Se),me,ve,Ie,$e,null,null,null,[ee._globeTileDebugTextBuffer])}function Ai(p,n,c,m){Eh(p,0,n+c/2,p.transform.width,c,m)}function Op(p,n,c,m){Eh(p,n-c/2,0,c,p.transform.height,m)}function Eh(p,n,c,m,v,w){const S=p.context,C=S.gl;C.enable(C.SCISSOR_TEST),C.scissor(n*o.o.devicePixelRatio,c*o.o.devicePixelRatio,m*o.o.devicePixelRatio,v*o.o.devicePixelRatio),S.clear({color:w}),C.disable(C.SCISSOR_TEST)}const bw=o.eh([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ww}=bw;function Oc(p,n,c,m){p.emplaceBack(n,c,m)}class Zv{constructor(n){this.vertexArray=new o.el,this.indices=new o.b0,Oc(this.vertexArray,-1,-1,1),Oc(this.vertexArray,1,-1,1),Oc(this.vertexArray,-1,1,1),Oc(this.vertexArray,1,1,1),Oc(this.vertexArray,-1,-1,-1),Oc(this.vertexArray,1,-1,-1),Oc(this.vertexArray,-1,1,-1),Oc(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,ww),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=o.bf.simpleSegment(0,0,36,12)}}function ul(p,n,c,m,v,w){const S=p.context.gl,C=n.paint.get("sky-atmosphere-color"),j=n.paint.get("sky-atmosphere-halo-color"),M=n.paint.get("sky-atmosphere-sun-intensity"),D=((B,O,G,X,ee)=>({u_matrix_3f:B,u_sun_direction:O,u_sun_intensity:G,u_color_tint_r:[X.r,X.g,X.b,X.a],u_color_tint_m:[ee.r,ee.g,ee.b,ee.a],u_luminance:5e-5}))(o.en(o.dN(),m),v,M,C.toPremultipliedRenderColor(null),j.toPremultipliedRenderColor(null));S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+w,n.skyboxTexture,0),c.draw(p,S.TRIANGLES,hr.disabled,Kr.disabled,un.unblended,qr.frontCW,D,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const vd=o.eh([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Rt{constructor(n){const c=new o.eo;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const m=new o.b0;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(c,vd.members),this.indexBuffer=n.createIndexBuffer(m),this.segments=o.bf.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Qt=o.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Ch{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class is{constructor(n){this.colorModeAlphaBlendedWriteRGB=new un([1,gs,1,gs],o.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new un([1,0,1,0],o.ao.transparent,[!1,!1,!1,!0]),this.params=new Ch,this.updateNeeded=!0,n.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),n.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(n){const c=n.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Rt(c);const m=this.params.sizeRange,v=this.params.intensityRange,w=function(D){const B=o.eq(30),O=[];for(let G=0;G<D;++G){const X=2*Math.PI*B(),ee=Math.acos(1-2*B())-.5*Math.PI;O.push(o.d4(Math.cos(ee)*Math.cos(X),Math.cos(ee)*Math.sin(X),Math.sin(ee)))}return O}(this.params.starsCount),S=o.eq(300),C=new o.ep,j=new o.b0;let M=0;for(let D=0;D<w.length;++D){const B=o.c4([],w[D],200),O=Math.max(0,1+.01*m*(1*S()-.5)),G=Math.max(0,1+.01*v*(1*S()-.5));C.emplaceBack(B[0],B[1],B[2],-1,-1,O,G),C.emplaceBack(B[0],B[1],B[2],1,-1,O,G),C.emplaceBack(B[0],B[1],B[2],1,1,O,G),C.emplaceBack(B[0],B[1],B[2],-1,1,O,G),j.emplaceBack(M+0,M+1,M+2),j.emplaceBack(M+0,M+2,M+3),M+=4}this.starsVx=c.createVertexBuffer(C,Qt.members),this.starsIdx=c.createIndexBuffer(j),this.starsSegments=o.bf.simpleSegment(0,0,C.length,j.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(n,c){const m=n.context,v=m.gl,w=n.transform,S=new hr(v.LEQUAL,hr.ReadOnly,[0,1]),C=o.aj(w.zoom),j=n.style.getLut(c.scope),M=c.properties.get("color-use-theme")==="none",D=c.properties.get("color").toNonPremultipliedRenderColor(M?null:j),B=c.properties.get("high-color-use-theme")==="none",O=c.properties.get("high-color").toNonPremultipliedRenderColor(B?null:j),G=c.properties.get("space-color-use-theme")==="none",X=c.properties.get("space-color").toNonPremultipliedRenderColor(G?null:j),ee=5e-4,oe=o.er(c.properties.get("horizon-blend"),0,1,ee,.25),ie=o.dD(n,m,w)&&oe===ee?w.worldSize/(2*Math.PI*1.025)-1:w.globeRadius,ce=n.frameCounter/1e3%1,me=o.ag(w.globeCenterInViewSpace),de=Math.sqrt(Math.pow(me,2)-Math.pow(ie,2)),Ee=Math.acos(de/me),ge=je=>{const Se=w.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];je&&Se.push("ALPHA_PASS");const ve=n.getOrCreateProgram("globeAtmosphere",{defines:Se}),Ie=((Fe,at,Qe,pt,Ot,Ye,Oe,mt,et,Et,$t,lr)=>({u_frustum_tl:Fe,u_frustum_tr:at,u_frustum_br:Qe,u_frustum_bl:pt,u_horizon:Ot,u_transition:Ye,u_fadeout_range:Oe,u_atmosphere_fog_color:mt.toArray01(),u_high_color:et.toArray01(),u_space_color:Et.toArray01(),u_temporal_offset:$t,u_horizon_angle:lr}))(w.frustumCorners.TL,w.frustumCorners.TR,w.frustumCorners.BR,w.frustumCorners.BL,w.frustumCorners.horizon,C,oe,D,O,X,ce,Ee);n.uploadCommonUniforms(m,ve);const $e=this.atmosphereBuffer;$e&&ve.draw(n,v.TRIANGLES,S,Kr.disabled,je?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,qr.backCW,Ie,je?"atmosphere_glow_alpha":"atmosphere_glow",$e.vertexBuffer,$e.indexBuffer,$e.segments)};ge(!1),ge(!0)}drawStars(n,c){const m=o.aA(c.properties.get("star-intensity"),0,1);if(m===0)return;const v=n.context,w=v.gl,S=n.transform,C=n.getOrCreateProgram("stars"),j=o.c6([]);o.c8(j,j,-S._pitch),o.c7(j,j,-S.angle),o.c8(j,j,o.an(S._center.lat)),o.es(j,j,-o.an(S._center.lng));const M=o.cb(new Float32Array(16),j),D=o.aB([],S.starsProjMatrix,M),B=o.en([],M),O=o.et([],B),G=[0,1,0];o.dP(G,G,O),o.c4(G,G,this.params.sizeMultiplier);const X=[1,0,0];o.dP(X,X,O),o.c4(X,X,this.params.sizeMultiplier);const ee=(oe=G,ie=X,ce=m,{u_matrix:Float32Array.from(D),u_up:oe,u_right:ie,u_intensity_multiplier:ce});var oe,ie,ce;n.uploadCommonUniforms(v,C),this.starsVx&&this.starsIdx&&C.draw(n,w.TRIANGLES,hr.disabled,Kr.disabled,this.colorModeAlphaBlendedWriteRGB,qr.disabled,ee,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class He{constructor(){this.visibleTiles=[]}updateBorders(n,c){const m=[],v=[],w=n._getRenderableCoordinates(!1,!0);for(const j of w){const M=n.getTile(j);if(!M.hasData())continue;const D=M.getBucket(c);D&&(D.isEmpty()||(m.push(j.key),v.push({bucket:D,tileID:j.canonical})))}let S=m.length!==this.visibleTiles.length;if(!S){m.sort();for(let j=0;j<m.length;j++)if(m[j]!==this.visibleTiles[j]){S=!0;break}}if(!S)return;const C=new Set;this.visibleTiles=m,v.sort((j,M)=>j.tileID.z-M.tileID.z||j.tileID.x-M.tileID.x||j.tileID.y-M.tileID.y);for(const j of v){const M=new Array,D=new Array,B=j.bucket;for(const O of B.featuresOnBorder)C.has(O.featureId)?D.push(O.footprintIndex):(C.add(O.featureId),M.push(O.footprintIndex));B.updateFootprintHiddenFlags(M,o.eu,!1),B.updateFootprintHiddenFlags(D,o.eu,!0)}}}function Xv(p,n){const c=[...p],m=n.cameraWorldSizeForFog/n.worldSize,v=o.bz([]);return o.cR(v,v,[m,m,1]),o.aB(c,v,c),o.aB(c,n.worldToFogMatrix,c),c}function Ah(p,n,c,m,v){const w=c.material,S=m.context,{baseColorTexture:C,metallicRoughnessTexture:j}=w.pbrMetallicRoughness,{normalTexture:M,occlusionTexture:D,emissionTexture:B}=w;function O(X,ee,oe){if(X&&(p.push(ee),S.activeTexture.set(S.gl.TEXTURE0+oe),X.gfxTexture)){const{minFilter:ie,magFilter:ce,wrapS:me,wrapT:de}=X.sampler;X.gfxTexture.bindExtraParam(ie,ce,me,de)}}O(C,"HAS_TEXTURE_u_baseColorTexture",po.BaseColor),O(j,"HAS_TEXTURE_u_metallicRoughnessTexture",po.MetallicRoughness),O(M,"HAS_TEXTURE_u_normalTexture",po.Normal),O(D,"HAS_TEXTURE_u_occlusionTexture",po.Occlusion),O(B,"HAS_TEXTURE_u_emissionTexture",po.Emission),v&&(v.texture||(v.texture=new o.d_(m.context,v.image,[v.image.height,v.image.height,v.image.height],S.gl.RGBA8)),S.activeTexture.set(S.gl.TEXTURE0+po.LUT),v.texture&&v.texture.bind(S.gl.LINEAR,S.gl.CLAMP_TO_EDGE),p.push("APPLY_LUT_ON_GPU")),c.texcoordBuffer&&(p.push("HAS_ATTRIBUTE_a_uv_2f"),n.push(c.texcoordBuffer)),c.colorBuffer&&(p.push(c.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),n.push(c.colorBuffer)),c.normalBuffer&&(p.push("HAS_ATTRIBUTE_a_normal_3f"),n.push(c.normalBuffer)),c.pbrBuffer&&(p.push("HAS_ATTRIBUTE_a_pbr"),p.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),n.push(c.pbrBuffer)),w.alphaMode!=="OPAQUE"&&w.alphaMode!=="MASK"||p.push("UNPREMULT_TEXTURE_IN_SHADER"),w.defined||p.push("DIFFUSE_SHADED");const G=m.shadowRenderer;G&&(p.push("RENDER_SHADOWS","DEPTH_TEXTURE"),G.useNormalOffset&&p.push("NORMAL_OFFSET"))}function jh(p,n,c,m,v,w){const S=c.paint.get("model-opacity").constantOr(1),C=n.context,j=new hr(n.context.gl.LEQUAL,p.isLightMesh?hr.ReadOnly:hr.ReadWrite,n.depthRangeFor3D),M=n.transform,D=p.mesh,B=D.material,O=B.pbrMetallicRoughness,G=n.style.fog;let X;X=n.transform.projection.zAxisUnit==="pixels"?[...p.nodeModelMatrix]:o.aB([],m.zScaleMatrix,p.nodeModelMatrix),o.aB(X,m.negCameraPosMatrix,X);const ee=o.bk([],X);o.ef(ee,ee);const oe=c.paint.get("model-color-use-theme").constantOr("default")==="none",ie=c.paint.get("model-emissive-strength").constantOr(0),ce=Cg(new Float32Array(p.worldViewProjection),new Float32Array(X),new Float32Array(ee),null,n,S,O.baseColorFactor,B.emissiveFactor,O.metallicFactor,O.roughnessFactor,B,ie,c,void 0,void 0,p.materialOverride,p.modelColor),me={defines:[]},de=[],Ee=n.shadowRenderer;Ee&&(Ee.useNormalOffset=!1),Ah(me.defines,de,D,n,oe?null:c.lut);let ge=null;if(G){const ve=Xv(p.nodeModelMatrix,n.transform);if(ge=new Float32Array(ve),M.projection.name!=="globe"){const Ie=D.aabb.min,$e=D.aabb.max,[Fe,at]=G.getOpacityForBounds(ve,Ie[0],Ie[1],$e[0],$e[1]);me.overrideFog=Fe>=tt||at>=tt}}const je=Mc(n,c.paint.get("model-cutoff-fade-range"));je.shouldRenderCutoff&&me.defines.push("RENDER_CUTOFF");const Se=n.getOrCreateProgram("model",me);n.uploadCommonUniforms(C,Se,null,ge,je),n.renderPass!=="shadow"&&Ee&&Ee.setupShadowsFromMatrix(p.nodeModelMatrix,Se),Se.draw(n,C.gl.TRIANGLES,j,v,w,D.material.doubleSided?qr.disabled:qr.backCCW,ce,c.id,D.vertexBuffer,D.indexBuffer,D.segments,c.paint,n.transform.zoom,void 0,de)}function Ng(p,n,c){return p.type==="vector"?n.scope:c?"basemap":""}function Dg(p,n,c,m,v,w,S,C,j){const M=p.transform,D=!!n.isGeometryBloom&&n.isGeometryBloom;if(D&&p.renderPass==="shadow")return;const B=M.projection.name==="globe"?o.eC(c,M):[...c];o.aB(B,B,n.globalMatrix);const O=o.aB([],m,B);if(n.meshes)for(const G of n.meshes){const X=C.get(G.material.name);if(X&&X.opacity<=0)continue;if(G.material.alphaMode!=="BLEND"){S.push({mesh:G,depth:0,modelIndex:v,worldViewProjection:O,nodeModelMatrix:B,isLightMesh:D,materialOverride:X,modelColor:j});continue}const ee=o.af([],G.centroid,O);!M.isOrthographic&&ee[2]<=0||w.push({mesh:G,depth:ee[2],modelIndex:v,worldViewProjection:O,nodeModelMatrix:B,isLightMesh:D,materialOverride:X,modelColor:j})}if(n.children)for(const G of n.children)Dg(p,G,c,m,v,w,S,C,j)}function Ih(p,n,c,m){const v=c.shadowRenderer;if(!v)return;const w=v.getShadowPassDepthMode(),S=v.getShadowPassColorMode(),C=v.calculateShadowPassMatrixFromMatrix(n),j=Sh(C);c.getOrCreateProgram("modelDepth",{defines:c._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(c,c.context.gl.TRIANGLES,w,Kr.disabled,S,qr.disabled,j,m.id,p.vertexBuffer,p.indexBuffer,p.segments,m.paint,c.transform.zoom,void 0,void 0)}function kh(p,n,c,m,v,w){for(const S of v){const C=Object.assign({},m);C.part=S;const j={type:"Unknown",id:n,properties:C},M={orientation:p.paint.get("model-rotation").evaluate(j,c)};w.set(S,M)}}function hE(p,n,c,m,v,w){for(const S of v){const C=Object.assign({},m);C.part=S;const j={type:"Unknown",id:n,properties:C},M={color:p.paint.get("model-color").evaluate(j,c),colorMix:p.paint.get("model-color-mix-intensity").evaluate(j,c),opacity:p.paint.get("model-opacity").evaluate(j,c),emissionStrength:p.paint.get("model-emissive-strength").evaluate(j,c)};w.set(S,M)}}function Sw(p,n,c,m,v,w){if(c===1)for(const C of v)jh(C,p,n,w[C.modelIndex],Kr.disabled,p.colorModeForRenderPass());else{for(const C of v)jh(C,p,n,w[C.modelIndex],Kr.disabled,un.disabled);for(const C of v)jh(C,p,n,w[C.modelIndex],p.stencilModeFor3D(),p.colorModeForRenderPass());p.resetStencilClippingMasks()}const S=un.additive;for(const C of m)jh(C,p,n,w[C.modelIndex],Kr.disabled,C.isLightMesh?S:p.colorModeForRenderPass())}function Tw(p,n,c){const m=n.updateZoomBasedPaintProperties(),v=function(w,S,C){let j,M,D,B=w.terrain?w.terrain.exaggeration():0;if(w.terrain&&B>0){const O=w.terrain,G=O.findDEMTileFor(C);G&&G.dem?j=o.eE.create(O,C,G):B=0}if(B===0&&(S.terrainElevationMin=0,S.terrainElevationMax=0),B===S.validForExaggeration&&(B===0||j&&j._demTile&&j._demTile.tileID===S.validForDEMTile.id&&j._dem._timestamp===S.validForDEMTile.timestamp))return!1;for(const O in S.instancesPerModel){const G=S.instancesPerModel[O];for(let X=0;X<G.instancedDataArray.length;++X){const ee=(j?B*j.getElevationAt(0|G.instancedDataArray.float32[16*X],0|G.instancedDataArray.float32[16*X+1],!0,!0):0)+G.instancesEvaluatedElevation[X];G.instancedDataArray.float32[16*X+6]=ee,M=M?Math.min(S.terrainElevationMin,ee):ee,D=D?Math.max(S.terrainElevationMax,ee):ee}}return S.terrainElevationMin=M||0,S.terrainElevationMax=D||0,S.validForExaggeration=B,S.validForDEMTile=j&&j._demTile?{id:j._demTile.tileID,timestamp:j._dem._timestamp}:{id:void 0,timestamp:0},!0}(p,n,c);(m||v)&&(n.uploaded=!1,n.upload(p.context))}const Ma={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.d8([0,0,0],[o.al,o.al,0])};function Kv(p,n){const c=1<<p.canonical.z,m=n.getFreeCameraOptions().position,v=n.elevation,w=p.canonical.x/c,S=(p.canonical.x+1)/c,C=p.canonical.y/c,j=(p.canonical.y+1)/c;let M=n._centerAltitude;if(v){const G=v.getMinMaxForTile(p);G&&G.max>M&&(M=G.max)}const D=o.aA(m.x,w,S)-m.x,B=o.aA(m.y,C,j)-m.y,O=o.ce(M,n.center.lat)-m.z;return n._zoomFromMercatorZ(Math.sqrt(D*D+B*B+O*O))}function Yv(p,n,c,m,v,w,S){const C=p.context,j=p.renderPass==="shadow",M=p.shadowRenderer,D=j&&M?M.getShadowPassDepthMode():new hr(C.gl.LEQUAL,hr.ReadWrite,p.depthRangeFor3D),B=p.isTileAffectedByFog(w),O=p.transform.projection.name==="globe";if(c.meshes)for(const G of c.meshes){const X=O?[]:["MODEL_POSITION_ON_GPU"],ee=[];let oe,ie,ce;const me=!O&&m.instancedDataArray.length>20;me&&X.push("INSTANCED_ARRAYS");const de=Mc(p,n.paint.get("model-cutoff-fade-range"));if(de.shouldRenderCutoff&&X.push("RENDER_CUTOFF"),j&&M)oe=p.getOrCreateProgram("modelDepth",{defines:X}),ie=Sh(S.shadowTileMatrix,S.shadowTileMatrix,Float32Array.from(c.globalMatrix)),ce=M.getShadowPassColorMode();else{Ah(X,ee,G,p,n.paint.get("model-color-use-theme").constantOr("default")==="none"?null:n.lut),oe=p.getOrCreateProgram("model",{defines:X,overrideFog:B});const ge=G.material,je=ge.pbrMetallicRoughness,Se=n.paint.get("model-opacity").constantOr(1),ve=n.paint.get("model-emissive-strength").constantOr(0);ie=Cg(w.expandedProjMatrix,Float32Array.from(c.globalMatrix),new Float32Array(16),null,p,Se,je.baseColorFactor,ge.emissiveFactor,je.metallicFactor,je.roughnessFactor,ge,ve,n,v),M&&(S.shadowUniformsInitialized?oe.setShadowUniformValues(C,M.getShadowUniformValues()):(M.setupShadows(w.toUnwrapped(),oe,"model-tile"),S.shadowUniformsInitialized=!0)),ce=de.shouldRenderCutoff||Se<1||ge.alphaMode!=="OPAQUE"?un.alphaBlended:un.unblended}p.uploadCommonUniforms(C,oe,w.toUnwrapped(),null,de);const Ee=G.material.doubleSided?qr.disabled:qr.backCCW;if(me)ee.push(m.instancedDataBuffer),oe.draw(p,C.gl.TRIANGLES,D,Kr.disabled,ce,Ee,ie,n.id,G.vertexBuffer,G.indexBuffer,G.segments,n.paint,p.transform.zoom,void 0,ee,m.instancedDataArray.length);else{const ge=j?"u_instance":"u_normal_matrix";for(let je=0;je<m.instancedDataArray.length;++je)ie[ge]=new Float32Array(m.instancedDataArray.arrayBuffer,64*je,16),oe.draw(p,C.gl.TRIANGLES,D,Kr.disabled,ce,Ee,ie,n.id,G.vertexBuffer,G.indexBuffer,G.segments,n.paint,p.transform.zoom,void 0,ee)}}if(c.children)for(const G of c.children)Yv(p,n,G,m,v,w,S)}const Ew=[1,-1,1];function Og(p,n,c,m){if(!c.modelManager)return!0;const v=c.modelManager;if(!c.shadowRenderer)return!0;const w=c.shadowRenderer,S=n.aabb;let C=!0,j=p.maxHeight;if(j===0){let D=0;for(const B in p.instancesPerModel){const O=v.getModel(B,m);O?D=Math.max(D,Math.max(Math.max(O.aabb.max[0],O.aabb.max[1]),O.aabb.max[2])):C=!1}j=p.maxScale*D*1.41+p.maxVerticalOffset,C&&(p.maxHeight=j)}S.max[2]=j,S.min[2]+=p.terrainElevationMin,S.max[2]+=p.terrainElevationMax,o.af(S.min,S.min,n.tileMatrix),o.af(S.max,S.max,n.tileMatrix);const M=S.intersects(w.getCurrentCascadeFrustum());return c.currentShadowCascade===0&&(p.isInsideFirstShadowMapFrustum=M===2),M===0}function Lp(p,n){const c=p.uniformValues.u_cutoff_params[0],m=p.uniformValues.u_cutoff_params[1],v=p.uniformValues.u_cutoff_params[2],w=p.uniformValues.u_cutoff_params[3];return m===c||w===v?1:o.aA(((n-c)/(m-c)-v)/(w-v),0,1)}function xd(p,n,c,m){if(n.pitch<20)return 1;const v=n.getWorldToCameraMatrix();o.aB(v,v,p);const w=o.bT(c.min[0],c.min[1],c.min[2],1);let S=o.aC(o.eF(),w,v),C=S,j=S;w[1]=c.max[1],S=o.aC(o.eF(),w,v),C=S[1]<C[1]?S:C,j=S[1]>j[1]?S:j,w[0]=c.max[0],S=o.aC(o.eF(),w,v),C=S[1]<C[1]?S:C,j=S[1]>j[1]?S:j,w[1]=c.min[1],S=o.aC(o.eF(),w,v),C=S[1]<C[1]?S:C,j=S[1]>j[1]?S:j;const M=o.aA(m[0],0,1),D=100*n.pixelsPerMeter*o.aA(m[1],0,1),B=o.aA(m[2],0,1),O=o.eG(o.eF(),C,j,M),G=Math.tan(.5*n.fovX),X=-O[2]*G;if(D===0)return O[1]<-Math.abs(X)?B:1;const ee=(-Math.abs(X)-O[1])/D,oe=(ce,me,de)=>(1-de)*ce+de*me,ie=o.aA(oe(1,B,ee),B,1);return oe(1,ie,o.aA((n.pitch-20)/20,0,1))}class Cw{}class Aw{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(n,c,m){{const B=this._storage.get(c.id);if(B)return B.lastUsedFrameIdx=n,B.buf}const v=m.gl,w=v.getBufferParameter(v.ELEMENT_ARRAY_BUFFER,v.BUFFER_SIZE),S=new ArrayBuffer(w),C=new Int16Array(S);v.getBufferSubData(v.ELEMENT_ARRAY_BUFFER,0,new Int16Array(S));const j=new o.eI;for(let B=0;B<w/2;B+=3){const O=C[B],G=C[B+1],X=C[B+2];j.emplaceBack(O,G),j.emplaceBack(G,X),j.emplaceBack(X,O)}const M=m.bindVertexArrayOES.current,D=new Cw;return D.buf=new Tu(m,j),D.lastUsedFrameIdx=n,this._storage.set(c.id,D),m.bindVertexArrayOES.set(M),D.buf}update(n){for(const[c,m]of this._storage)n-m.lastUsedFrameIdx>30&&(m.buf.destroy(),this._storage.delete(c))}destroy(){for(const[n,c]of this._storage)c.buf.destroy(),this._storage.delete(n)}}class fE{constructor(n){this.occluderSize=30,this.depthOffset=-1e-4,n.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),n.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const jw=o.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class pE{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class $o{constructor(n,c){this.revealStart=11,this.revealRange=2,n.registerParameter(this,[...c,"Reveal"],"revealStart",{min:0,max:17,step:.05}),n.registerParameter(this,[...c,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const mE=o.eh([{type:"Float32",name:"a_pos_2f",components:2}]);class zp{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(n,c){const m=n.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const S=new o.eJ,C=new o.b0;S.emplaceBack(-1,-1),S.emplaceBack(1,-1),S.emplaceBack(1,1),S.emplaceBack(-1,1),C.emplaceBack(0,1,2),C.emplaceBack(0,2,3),this.vignetteVx=n.context.createVertexBuffer(S,mE.members),this.vignetteIdx=n.context.createIndexBuffer(C)}const v=o.bf.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){n.uploadCommonUniforms(n.context,m);const S={u_vignetteShape:(w={vignetteShape:[c.start,c.range,Math.pow(10,c.fadePower)],vignetteColor:[c.color.r,c.color.g,c.color.b,c.color.a*c.strength]}).vignetteShape,u_vignetteColor:w.vignetteColor};m.draw(n,n.context.gl.TRIANGLES,hr.disabled,Kr.disabled,un.alphaBlended,qr.disabled,S,"vignette",this.vignetteVx,this.vignetteIdx,v)}var w}}class Oi{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(n,c){const m=n.getFreeCameraOptions().position,v=m.toAltitude(),w=m.toLngLat(),S=o.an(w.lng),C=o.an(w.lat),j=n.pixelsPerMeter/c,M=S*o.eL,D=o.eL*Math.log(Math.tan(Math.PI/4+C/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const B=-this._offsetYPrev+D,O=-this._elevationPrev+v;this._accumulatedOffsetX+=(-this._offsetXPrev+M)*j,this._accumulatedOffsetY+=B*j,this._accumulatedElevation+=O*j,this._offsetXPrev=M,this._offsetYPrev=D,this._elevationPrev=v}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function vn(p,n){return[-(p[0]-Math.floor(p[0]/n)*n),-(p[1]-Math.floor(p[1]/n)*n),-(p[2]-Math.floor(p[2]/n)*n)]}function Jv(p){const n=o.eq(1323123451230),c=[];for(let m=0;m<p;++m){const v=2*n()-1,w=2*n()-1,S=2*n()-1;c.push(o.d4(v,w,S))}return c}function sa(p,n,c,m,v){const w=o.aA((v-c)/(m-c),0,1);return(1-w)*p+w*n}class bd{constructor(n){this._movement=new Oi,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new zp,this._ppmScaleFactor=n}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(n,c){const m=n.transform;this._movement.update(m,this._ppmScaleFactor);const v=m.starsProjMatrix,w=o.c6([]);o.c8(w,w,o.an(90)-m._pitch),o.c7(w,w,-m.angle);const S=o.cb(new Float32Array(16),w),C=o.eK(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),j=o.ef([],C),M=o.aB([],j,S),D=Date.now()/1e3;return this._accumulatedTimeFromStart+=(D-this._prevTime)*c,this._prevTime=D,{projectionMatrix:v,modelviewMatrix:M}}}class Ph extends bd{constructor(n){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new $o(n.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(n){const c=n.context;if(!this.particlesVx){const m=Jv(this.particlesCount),v=new o.eM,w=new o.b0;let S=0;const C=o.eq(1323123451230);for(let j=0;j<m.length;++j){const M=m[j],D=[2*C()-1,C(),C(),C()];v.emplaceBack(M[0],M[1],M[2],-1,-1,...D),v.emplaceBack(M[0],M[1],M[2],1,-1,...D),v.emplaceBack(M[0],M[1],M[2],1,1,...D),v.emplaceBack(M[0],M[1],M[2],-1,1,...D),w.emplaceBack(S+0,S+1,S+2),w.emplaceBack(S+0,S+2,S+3),S+=4}this.particlesVx=c.createVertexBuffer(v,jw.members),this.particlesIdx=c.createIndexBuffer(w)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.rain)return;const c=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},m=n.transform.zoom;if(c.revealStart>m)return;const v=sa(0,1,c.revealStart,c.revealStart+c.revealRange,m);if(!this.particlesVx||!this.particlesIdx)return;const w=structuredClone(this._params);let S=[-w.direction.x,w.direction.y,-100];o.aw(S,S);const C=structuredClone(this._vignetteParams);C.strength*=v,w.overrideStyleParameters||(w.intensity=n.style.rain.state.density,w.timeFactor=n.style.rain.state.intensity,w.color=structuredClone(n.style.rain.state.color),S=structuredClone(n.style.rain.state.direction),w.screenThinning.intensity=n.style.rain.state.centerThinning,w.dropletSizeX=n.style.rain.state.dropletSize[0],w.dropletSizeYScale=n.style.rain.state.dropletSize[1]/n.style.rain.state.dropletSize[0],w.distortionStrength=100*n.style.rain.state.distortionStrength,C.strength=1,C.color=structuredClone(n.style.rain.state.vignetteColor));const j=this.updateOnRender(n,w.timeFactor),M=n.context,D=M.gl,B=n.transform;this.screenTexture&&this.screenTexture.size[0]===n.width&&this.screenTexture.size[1]===n.height||(this.screenTexture=new o.T(M,{width:n.width,height:n.height,data:null},D.RGBA8)),w.distortionStrength>0&&(M.activeTexture.set(D.TEXTURE0),this.screenTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),D.copyTexSubImage2D(D.TEXTURE_2D,0,0,0,0,0,n.width,n.height));const O=n.getOrCreateProgram("rainParticle");n.uploadCommonUniforms(M,O),M.activeTexture.set(D.TEXTURE0),this.screenTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE);const G=[w.color.r,w.color.g,w.color.b,w.color.a],X=(ee,oe)=>{const ie=vn(this._movement.getPosition(),ee),ce=w.dropletSizeX,me=w.dropletSizeX*w.dropletSizeYScale,de=n.width/2,Ee=n.height/2,ge=sa(0,w.screenThinning.start,0,1,w.screenThinning.intensity),je=sa(.001,w.screenThinning.range,0,1,w.screenThinning.intensity),Se=sa(0,w.screenThinning.particleOffset,0,1,w.screenThinning.intensity),ve=(Ie={modelview:j.modelviewMatrix,projection:j.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ie,velocityConeAperture:w.velocityConeAperture,velocity:w.velocity,boxSize:ee,rainDropletSize:[ce,me],distortionStrength:w.distortionStrength,rainDirection:S,color:G,screenSize:[B.width,B.height],thinningCenterPos:[de,Ee],thinningShape:[ge,je,Math.pow(10,w.screenThinning.fadePower)],thinningAffectedRatio:w.screenThinning.affectedRatio,thinningParticleOffset:Se,shapeDirectionalPower:w.shapeDirPower,shapeNormalPower:w.shapeNormalPower,mode:oe?0:1},{u_modelview:Float32Array.from(Ie.modelview),u_projection:Float32Array.from(Ie.projection),u_time:Ie.time,u_cam_pos:Ie.camPos,u_texScreen:0,u_velocityConeAperture:Ie.velocityConeAperture,u_velocity:Ie.velocity,u_boxSize:Ie.boxSize,u_rainDropletSize:Ie.rainDropletSize,u_distortionStrength:Ie.distortionStrength,u_rainDirection:Ie.rainDirection,u_color:Ie.color,u_screenSize:Ie.screenSize,u_thinningCenterPos:Ie.thinningCenterPos,u_thinningShape:Ie.thinningShape,u_thinningAffectedRatio:Ie.thinningAffectedRatio,u_thinningParticleOffset:Ie.thinningParticleOffset,u_shapeDirectionalPower:Ie.shapeDirectionalPower,u_shapeNormalPower:Ie.shapeNormalPower,u_mode:Ie.mode});var Ie;const $e=Math.round(w.intensity*this.particlesCount),Fe=o.bf.simpleSegment(0,0,4*$e,2*$e);O.draw(n,D.TRIANGLES,hr.disabled,Kr.disabled,un.alphaBlended,qr.disabled,ve,"rain_particles",this.particlesVx,this.particlesIdx,Fe)};w.distortionStrength>0&&X(w.boxSize,!0),X(w.boxSize,!1),this._vignette.draw(n,C)}}const Lc=o.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Qv extends bd{constructor(n){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new $o(n.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(n){const c=n.context;if(!this.particlesVx){const m=Jv(this.particlesCount),v=new o.eN,w=new o.b0;let S=0;const C=o.eq(1323123451230);for(let j=0;j<m.length;++j){const M=m[j],D=C(),B=C(),O=C(),G=[j/m.length,D,B,O],X=[C(),C()];v.emplaceBack(M[0],M[1],M[2],-1,-1,...G,...X),v.emplaceBack(M[0],M[1],M[2],1,-1,...G,...X),v.emplaceBack(M[0],M[1],M[2],1,1,...G,...X),v.emplaceBack(M[0],M[1],M[2],-1,1,...G,...X),w.emplaceBack(S+0,S+1,S+2),w.emplaceBack(S+0,S+2,S+3),S+=4}this.particlesVx=c.createVertexBuffer(v,Lc.members),this.particlesIdx=c.createIndexBuffer(w)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.snow)return;const c=structuredClone(this._params);let m=[-c.direction.x,c.direction.y,-100];o.aw(m,m);const v=structuredClone(this._vignetteParams),w=c.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},S=n.transform.zoom;if(w.revealStart>S)return;const C=sa(0,1,w.revealStart,w.revealStart+w.revealRange,S);v.strength*=C,c.overrideStyleParameters||(c.intensity=n.style.snow.state.density,c.timeFactor=n.style.snow.state.intensity,c.color=structuredClone(n.style.snow.state.color),m=structuredClone(n.style.snow.state.direction),c.screenThinning.intensity=n.style.snow.state.centerThinning,c.billboardSize=2.79*n.style.snow.state.flakeSize,v.strength=1,v.color=structuredClone(n.style.snow.state.vignetteColor));const j=this.updateOnRender(n,c.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const M=n.context,D=M.gl,B=n.transform,O=n.getOrCreateProgram("snowParticle");n.uploadCommonUniforms(M,O),((G,X,ee)=>{const oe=vn(this._movement.getPosition(),G),ie=B.width/2,ce=B.height/2,me=sa(0,ee.screenThinning.start,0,1,ee.screenThinning.intensity),de=sa(.001,ee.screenThinning.range,0,1,ee.screenThinning.intensity),Ee=sa(0,ee.screenThinning.particleOffset,0,1,ee.screenThinning.intensity),ge=(je={modelview:j.modelviewMatrix,projection:j.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:oe,velocityConeAperture:ee.velocityConeAperture,velocity:ee.velocity,horizontalOscillationRadius:ee.horizontalOscillationRadius,horizontalOscillationRate:ee.horizontalOscillationRate,boxSize:G,billboardSize:1*ee.billboardSize,simpleShapeParameters:[ee.shapeFadeStart,ee.shapeFadePower],screenSize:[B.width,B.height],thinningCenterPos:[ie,ce],thinningShape:[me,de,Math.pow(10,ee.screenThinning.fadePower)],thinningAffectedRatio:ee.screenThinning.affectedRatio,thinningParticleOffset:Ee,color:[ee.color.r,ee.color.g,ee.color.b,ee.color.a],direction:m},{u_modelview:Float32Array.from(je.modelview),u_projection:Float32Array.from(je.projection),u_time:je.time,u_cam_pos:je.camPos,u_velocityConeAperture:je.velocityConeAperture,u_velocity:je.velocity,u_horizontalOscillationRadius:je.horizontalOscillationRadius,u_horizontalOscillationRate:je.horizontalOscillationRate,u_boxSize:je.boxSize,u_billboardSize:je.billboardSize,u_simpleShapeParameters:je.simpleShapeParameters,u_screenSize:je.screenSize,u_thinningCenterPos:je.thinningCenterPos,u_thinningShape:je.thinningShape,u_thinningAffectedRatio:je.thinningAffectedRatio,u_thinningParticleOffset:je.thinningParticleOffset,u_particleColor:je.color,u_direction:je.direction});var je;const Se=Math.round(ee.intensity*this.particlesCount),ve=o.bf.simpleSegment(0,0,4*Se,2*Se);this.particlesVx&&this.particlesIdx&&O.draw(n,D.TRIANGLES,hr.disabled,Kr.disabled,un.alphaBlended,qr.disabled,ge,"snow_particles",this.particlesVx,this.particlesIdx,ve)})(c.boxSize,0,c),this._vignette.draw(n,v)}}const ex={symbol:function(p,n,c,m,v){if(p.renderPass!=="translucent")return;const w=Kr.disabled,S=p.colorModeForRenderPass(),C=c.layout.get("text-variable-anchor"),j=c.layout.get("text-size-scale-range"),M=o.aA(p.scaleFactor,j[0],j[1]);C&&function(O,G,X,ee,oe,ie,ce,me){const de=G.transform,Ee=oe==="map",ge=ie==="map";for(const je of O){const Se=ee.getTile(je),ve=Se.getBucket(X);if(!ve||!ve.text||!ve.text.segments.get().length)continue;const Ie=o.bJ(ve.textSizeData,de.zoom,me),$e=Km(je,ve.getProjection(),de),Fe=de.calculatePixelsToTileUnitsMatrix(Se),at=sh($e,Se.tileID.canonical,ge,Ee,de,ve.getProjection(),Fe),Qe=ve.hasIconTextFit()&&ve.hasIconData();Ie&&kg(ve,Ee,ge,ce,de,at,je,Math.pow(2,de.zoom-Se.tileID.overscaledZ),Ie,Qe)}}(m,p,c,n,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),v,M);const D=c.paint.get("icon-opacity").constantOr(1)!==0,B=c.paint.get("text-opacity").constantOr(1)!==0;c.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(D||B)?Dp(p,n,c,m,w,S):(D&&Dp(p,n,c,m,w,S,{onlyIcons:!0}),B&&Dp(p,n,c,m,w,S,{onlyText:!0})),n.map.showCollisionBoxes&&(Np(p,n,c,m,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Np(p,n,c,m,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(p,n,c,m){if(p.renderPass!=="translucent")return;const v=c.paint.get("circle-opacity"),w=c.paint.get("circle-stroke-width"),S=c.paint.get("circle-stroke-opacity"),C=c.layout.get("circle-sort-key").constantOr(1)!==void 0,j=c.paint.get("circle-emissive-strength");if(v.constantOr(1)===0&&(w.constantOr(1)===0||S.constantOr(1)===0))return;const M=p.context,D=M.gl,B=p.transform,O=!(!p.terrain||!p.terrain.enabled),G=c.layout.get("circle-elevation-reference"),X=p.depthModeForSublayer(0,hr.ReadOnly),ee=new hr(p.context.gl.LEQUAL,hr.ReadOnly,p.depthRangeFor3D),oe=G==="none"||O?X:ee,ie=Kr.disabled,ce=p.colorModeForDrapableLayerRenderPass(j),me=B.projection.name==="globe",de=[o.aF(B.center.lng),o.aJ(B.center.lat)],Ee=[];for(let je=0;je<m.length;je++){const Se=m[je],ve=n.getTile(Se),Ie=ve.getBucket(c);if(!Ie||Ie.projection.name!==B.projection.name)continue;const $e=Ie.programConfigurations.get(c.id),Fe=Ie.layoutVertexBuffer,at=Ie.globeExtVertexBuffer,Qe=Ie.indexBuffer,pt=o.d$(c),Ot=[at],Ye=p.isTileAffectedByFog(Se);me&&pt.push("PROJECTION_GLOBE_VIEW"),pt.push("DEPTH_D24"),p.terrain&&B.depthOcclusionForSymbolsAndCircles&&pt.push("DEPTH_OCCLUSION"),Ie.hasElevation&&!p.terrain&&(pt.push("ELEVATED_ROADS"),Ot.push(Ie.elevatedLayoutVertexBuffer));const Oe=p.getOrCreateProgram("circle",{config:$e,defines:pt,overrideFog:Ye}),mt=B.projection.createInversionMatrix(B,Se.canonical),et={programConfiguration:$e,program:Oe,layoutVertexBuffer:Fe,dynamicBuffers:Ot,indexBuffer:Qe,uniformValues:o.e0(p,Se,ve,mt,de,c),tile:ve};if(C){const Et=Ie.segments.get();for(const $t of Et)Ee.push({segments:new o.bf([$t]),sortKey:$t.sortKey,state:et})}else Ee.push({segments:Ie.segments,sortKey:0,state:et})}C&&Ee.sort((je,Se)=>je.sortKey-Se.sortKey);const ge={useDepthForOcclusion:B.depthOcclusionForSymbolsAndCircles};for(const je of Ee){const{programConfiguration:Se,program:ve,layoutVertexBuffer:Ie,dynamicBuffers:$e,indexBuffer:Fe,uniformValues:at,tile:Qe}=je.state,pt=je.segments;p.terrain&&p.terrain.setupElevationDraw(Qe,ve,ge),p.uploadCommonUniforms(M,ve,Qe.tileID.toUnwrapped()),ve.draw(p,D.TRIANGLES,oe,ie,ce,qr.disabled,at,c.id,Ie,Fe,pt,c.paint,B.zoom,Se,$e)}},heatmap:function(p,n,c,m){if(c.paint.get("heatmap-opacity")!==0)if(p.renderPass==="offscreen"){const v=p.context,w=v.gl,S=Kr.disabled,C=new un([w.ONE,w.ONE,w.ONE,w.ONE],o.ao.transparent,[!0,!0,!0,!0]);(function(G,X,ee,oe){const ie=G.gl,ce=X.width*oe,me=X.height*oe;G.activeTexture.set(ie.TEXTURE1),G.viewport.set([0,0,ce,me]);let de=ee.heatmapFbo;if(!de||de&&(de.width!==ce||de.height!==me)){de&&de.destroy();const Ee=ie.createTexture();ie.bindTexture(ie.TEXTURE_2D,Ee),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_S,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_T,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_MIN_FILTER,ie.LINEAR),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_MAG_FILTER,ie.LINEAR),de=ee.heatmapFbo=G.createFramebuffer(ce,me,!0,null),function(ge,je,Se,ve,Ie,$e){const Fe=ge.gl;Fe.texImage2D(Fe.TEXTURE_2D,0,ge.extRenderToTextureHalfFloat?Fe.RGBA16F:Fe.RGBA,Ie,$e,0,Fe.RGBA,ge.extRenderToTextureHalfFloat?Fe.HALF_FLOAT:Fe.UNSIGNED_BYTE,null),ve.colorAttachment.set(Se)}(G,0,Ee,de,ce,me)}else ie.bindTexture(ie.TEXTURE_2D,de.colorAttachment.get()),G.bindFramebuffer.set(de.framebuffer)})(v,p,c,p.transform.projection.name==="globe"?.5:.25),v.clear({color:o.ao.transparent});const j=p.transform,M=j.projection.name==="globe",D=M?["PROJECTION_GLOBE_VIEW"]:[],B=M?qr.frontCCW:qr.disabled,O=[o.aF(j.center.lng),o.aJ(j.center.lat)];for(let G=0;G<m.length;G++){const X=m[G];if(n.hasRenderableParent(X))continue;const ee=n.getTile(X),oe=ee.getBucket(c);if(!oe||oe.projection.name!==j.projection.name)continue;const ie=p.isTileAffectedByFog(X),ce=oe.programConfigurations.get(c.id),me=p.getOrCreateProgram("heatmap",{config:ce,defines:D,overrideFog:ie}),{zoom:de}=p.transform;p.terrain&&p.terrain.setupElevationDraw(ee,me),p.uploadCommonUniforms(v,me,X.toUnwrapped());const Ee=j.projection.createInversionMatrix(j,X.canonical);me.draw(p,w.TRIANGLES,hr.disabled,S,C,B,mw(p,X,ee,Ee,O,de,c.paint.get("heatmap-intensity")),c.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,c.paint,p.transform.zoom,ce,M?[oe.globeExtVertexBuffer]:null)}v.viewport.set([0,0,p.width,p.height])}else p.renderPass==="translucent"&&(p.context.setColorMode(p.colorModeForRenderPass()),function(v,w){const S=v.context,C=S.gl,j=w.heatmapFbo;if(!j)return;S.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,j.colorAttachment.get()),S.activeTexture.set(C.TEXTURE1);let M=w.colorRampTexture;M||(M=w.colorRampTexture=new o.T(S,w.colorRamp,C.RGBA8)),M.bind(C.LINEAR,C.CLAMP_TO_EDGE),v.getOrCreateProgram("heatmapTexture").draw(v,C.TRIANGLES,hr.disabled,Kr.disabled,v.colorModeForRenderPass(),qr.disabled,((D,B,O,G)=>({u_image:0,u_color_ramp:1,u_opacity:B.paint.get("heatmap-opacity")}))(0,w),w.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,w.paint,v.transform.zoom)}(p,c))},line:function(p,n,c,m){if(p.renderPass!=="translucent")return;const v=c.paint.get("line-opacity"),w=c.paint.get("line-width");if(v.constantOr(1)===0||w.constantOr(1)===0)return;const S=c.paint.get("line-emissive-strength"),C=c.paint.get("line-occlusion-opacity"),j=c.layout.get("line-elevation-reference"),M=c.layout.get("line-width-unit")==="meters",D=j==="sea",B=!(!p.terrain||!p.terrain.enabled),O=p.context,G=O.gl;if(c.hasElevatedBuckets&&p.transform.projection.name==="globe")return;const X=c.layout.get("line-cross-slope"),ee=X!==void 0,oe=X<1,ie=p.colorModeForDrapableLayerRenderPass(S),ce=p.terrain&&p.terrain.renderingToTexture,me=ce?1:o.o.devicePixelRatio,de=c.paint.get("line-dasharray"),Ee=de.constantOr(1),ge=c.layout.get("line-cap"),je=de.constantOr(null),Se=ge.constantOr(null),ve=c.paint.get("line-pattern"),Ie=ve.constantOr(1),$e=c.paint.get("line-pattern-cross-fade"),Fe=ve.constantOr(null),at=c.paint.get("line-opacity").constantOr(1);let Qe=!Ie&&at!==1||p.depthOcclusion&&C>0&&C<1;const pt=c.paint.get("line-gradient"),Ot=Ie?"linePattern":"line",Ye=o.e1(c);let Oe;if(ce&&p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(Qe=!1),C!==0&&p.depthOcclusion){const $t=c.paint._values["line-opacity"];$t&&$t.value&&$t.value.kind==="constant"?Oe=$t.value:o.w(`Occlusion opacity for layer ${c.id} is supported only when line-opacity isn't data-driven.`)}w.value.kind!=="constant"&&w.value.isLineProgressConstant===!1&&Ye.push("VARIABLE_LINE_WIDTH");const mt=($t,lr,Mt,zt,ur,nr)=>{for(const er of $t){const ir=n.getTile(er);if(Ie&&!ir.patternsLoaded())continue;const kr=ir.getBucket(c);if(!kr||kr.elevationType!=="none"&&!ur||kr.elevationType==="none"&&ur)continue;p.prepareDrawTile();const xn=[...lr],Mn=p.shadowRenderer,fi=kr.elevationType==="road"&&!!Mn&&Mn.enabled;let Gr=[0,0,0];if(fi){const Zr=p.style.directionalLight,Ln=p.style.ambientLight;Zr&&Ln&&(Gr=al(p.style,Zr,Ln)),xn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Pn=kr.programConfigurations.get(c.id);let on=!1;if(Fe&&ir.imageAtlas){const Zr=o.e2.from(Fe),Ln=Zr.getPrimary().scaleSelf(me).toString(),Gi=ir.imageAtlas.patternPositions.get(Ln),ds=Zr.getSecondary(),Xi=ds?ir.imageAtlas.patternPositions.get(ds.scaleSelf(me).toString()):null;on=!!Gi&&!!Xi,Gi&&Pn.setConstantPatternPositions(Gi,Xi)}$e>0&&(on||Pn.getPatternTransitionVertexBuffer("line-pattern"))&&xn.push("LINE_PATTERN_TRANSITION");const ai=p.isTileAffectedByFog(er),Nn=p.getOrCreateProgram(Ot,{config:Pn,defines:xn,overrideFog:ai});if(!Ie&&je&&Se&&ir.lineAtlas){const Zr=ir.lineAtlas.getDash(je,Se);Zr&&Pn.setConstantPatternPositions(Zr)}fi&&Mn.setupShadows(ir.tileID.toUnwrapped(),Nn,"vector-tile");let[Si,$n]=c.paint.get("line-trim-offset");(Se==="round"||Se==="square")&&Si!==$n&&(Si===0&&(Si-=1),$n===1&&($n+=1));const an=ce?er.projMatrix:null,Qn=M?1/kr.tileToMeter/o.ay(ir,1,p.transform.zoom):1,dn=M?1/kr.tileToMeter/o.ay(ir,1,Math.floor(p.transform.zoom)):1,ki=Ie?o.e3(p,ir,c,an,me,Qn,dn,[Si,$n],Gr,$e):o.e4(p,ir,c,an,kr.lineClipsArray.length,me,Qn,dn,[Si,$n],Gr);if(pt){const Zr=kr.gradients[c.id];let Ln=Zr.texture;if(c.gradientVersion!==Zr.version){let Gi=256;if(c.stepInterpolant){const ds=n.getSource().maxzoom,Xi=er.canonical.z===ds?Math.ceil(1<<p.transform.maxZoom-er.canonical.z):1;Gi=o.aA(o.e5(kr.maxLineLength/o.al*1024*Xi),256,O.maxTextureSize)}Zr.gradient=o.e6({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:Gi,image:Zr.gradient||void 0,clips:kr.lineClipsArray}),Zr.texture?Zr.texture.update(Zr.gradient):Zr.texture=new o.T(O,Zr.gradient,G.RGBA8),Zr.version=c.gradientVersion,Ln=Zr.texture}O.activeTexture.set(G.TEXTURE1),Ln.bind(c.stepInterpolant?G.NEAREST:G.LINEAR,G.CLAMP_TO_EDGE)}Ee&&(O.activeTexture.set(G.TEXTURE0),ir.lineAtlasTexture&&ir.lineAtlasTexture.bind(G.LINEAR,G.REPEAT),Pn.updatePaintBuffers()),Ie&&(O.activeTexture.set(G.TEXTURE0),ir.imageAtlasTexture&&ir.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),Pn.updatePaintBuffers()),ur&&!D&&p.terrain.setupElevationDraw(ir,Nn),p.uploadCommonUniforms(O,Nn,er.toUnwrapped());const ti=Zr=>{Oe!=null&&(Oe.value=at*C),Nn.draw(p,G.TRIANGLES,Mt,Zr,ie,qr.disabled,ki,c.id,kr.layoutVertexBuffer,kr.indexBuffer,kr.segments,c.paint,p.transform.zoom,Pn,[kr.layoutVertexBuffer2,kr.patternVertexBuffer,kr.zOffsetVertexBuffer]),Oe!=null&&(Oe.value=at)};if(Qe&&!ur){const Zr=p.stencilModeForClipping(er).ref;Zr===0&&ce&&O.clear({stencil:0});const Ln={func:G.EQUAL,mask:255};ki.u_alpha_discard_threshold=.8,ti(new Kr(Ln,Zr,255,G.KEEP,G.KEEP,G.INVERT)),ki.u_alpha_discard_threshold=0,ti(new Kr(Ln,Zr,255,G.KEEP,G.KEEP,G.KEEP))}else ki.u_alpha_discard_threshold=Qe&&ur&&nr?.8:0,ti(ur?zt:p.stencilModeForClipping(er))}};let et=p.depthModeForSublayer(0,hr.ReadOnly);const Et=new hr(p.depthOcclusion?G.GREATER:G.LEQUAL,hr.ReadOnly,p.depthRangeFor3D);if(c.hasNonElevatedBuckets){const $t=!ce&&p.terrain;C!==0&&$t?o.w(`Occlusion opacity for layer ${c.id} is supported on terrain only if the layer has line-z-offset enabled.`):$t?o.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${c.id}.`):mt(m,Ye,et,Kr.disabled,!1,!0)}if(c.hasElevatedBuckets){j==="hd-road-markup"?B||(et=Et,Ye.push("ELEVATED_ROADS")):(Ye.push("ELEVATED"),et=Et,ee&&Ye.push(oe?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),D&&Ye.push("ELEVATION_REFERENCE_SEA"));const $t=Qe?p.stencilModeFor3D():Kr.disabled;p.forceTerrainMode=!0,mt(m,Ye,et,$t,!0,!0),Qe&&mt(m,Ye,et,$t,!0,!1),p.forceTerrainMode=!1}Qe&&(p.resetStencilClippingMasks(),ce&&O.clear({stencil:0})),C===0||p.depthOcclusion||ce||p.layersWithOcclusionOpacity.push(p.currentLayer)},fill:function(p,n,c,m){const v=c.paint.get("fill-color"),w=c.paint.get("fill-opacity");if(w.constantOr(1)===0)return;const S=c.paint.get("fill-emissive-strength"),C=p.colorModeForDrapableLayerRenderPass(S),j=c.paint.get("fill-pattern"),M=p.opaquePassEnabledForLayer()&&!j.constantOr(1)&&v.constantOr(o.ao.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";let D="none";c.layout.get("fill-elevation-reference")!=="none"?D="road":c.paint.get("fill-z-offset").constantOr(1)!==0&&(D="offset");const B=!(!p.terrain||!p.terrain.enabled),O={painter:p,sourceCache:n,layer:c,coords:m,colorMode:C,elevationType:D,terrainEnabled:B,pass:M};if(p.renderPass!=="shadow")if(D!=="offset"){if(Th(O,!1),D==="road"){const G=!B&&p.renderPass==="translucent";G&&yd(p,n,c,m,"geometry"),Th(O,!0,Kr.disabled),G&&function(X){const{painter:ee,sourceCache:oe,layer:ie,coords:ce,colorMode:me}=X,de=ee.context.gl,Ee=X.painter.shadowRenderer,ge=!!Ee&&Ee.enabled,je=new hr(ee.context.gl.LEQUAL,hr.ReadOnly,ee.depthRangeFor3D);let Se=[0,0,0];if(ge){const Ie=ee.style.directionalLight,$e=ee.style.ambientLight;Ie&&$e&&(Se=al(ee.style,Ie,$e))}const ve=Ie=>{for(const $e of ce){const Fe=oe.getTile($e),at=Fe.getBucket(ie);if(!at)continue;const Qe=at.elevatedStructures;if(!Qe)continue;let pt,Ot;if(Ie?(pt=Qe.renderableBridgeSegments,Ot=Qe.bridgeProgramConfigurations.get(ie.id)):(pt=Qe.renderableTunnelSegments,Ot=Qe.tunnelProgramConfigurations.get(ie.id)),!pt||pt.segments[0].primitiveLength===0)continue;Ot.updatePaintBuffers(),ee.prepareDrawTile();const Ye=ee.isTileAffectedByFog($e),Oe=[];ge&&Oe.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const mt=ee.getOrCreateProgram("elevatedStructures",{config:Ot,overrideFog:Ye,defines:Oe}),et=ee.translatePosMatrix($e.projMatrix,Fe,ie.paint.get("fill-translate"),ie.paint.get("fill-translate-anchor"));ge&&Ee.setupShadows(Fe.tileID.toUnwrapped(),mt,"vector-tile");const Et=aE(et,Se);ee.uploadCommonUniforms(ee.context,mt,$e.toUnwrapped()),mt.draw(ee,de.TRIANGLES,je,Kr.disabled,me,qr.backCCW,Et,ie.id,Qe.vertexBuffer,Qe.indexBuffer,pt,ie.paint,ee.transform.zoom,Ot,[Qe.vertexBufferNormal])}};ve(!0),ve(!1)}(O)}}else Th(O,!1,p.stencilModeFor3D());else p.shadowRenderer&&D==="road"&&!B&&function(G){const{painter:X,sourceCache:ee,layer:oe,coords:ie}=G,ce=X.context.gl,me=G.painter.shadowRenderer;for(const de of ie){const Ee=ee.getTile(de),ge=Ee.getBucket(oe);if(!ge)continue;const je=ge.elevatedStructures;if(!je||!je.shadowCasterSegments||je.shadowCasterSegments.segments[0].primitiveLength===0)continue;X.prepareDrawTile();const Se=ge.bufferData.programConfigurations.get(oe.id),ve=X.isTileAffectedByFog(de),Ie=X.getOrCreateProgram("elevatedStructuresDepth",{config:Se,overrideFog:ve}),$e=me.calculateShadowPassMatrixFromTile(Ee.tileID.toUnwrapped());X.uploadCommonUniforms(X.context,Ie,de.toUnwrapped());const Fe={u_matrix:$e,u_depth_bias:0};Ie.draw(X,ce.TRIANGLES,me.getShadowPassDepthMode(),Kr.disabled,me.getShadowPassColorMode(),qr.disabled,Fe,oe.id,je.vertexBuffer,je.indexBuffer,je.shadowCasterSegments,oe.paint,X.transform.zoom,Se)}}(O)},"fill-extrusion":function(p,n,c,m){const v=c.paint.get("fill-extrusion-opacity"),w=p.context,S=w.gl,C=p.terrain,j=C&&C.renderingToTexture;if(v===0)return;const M=p.conflationActive&&p.style.isLayerClipped(c,n.getSource()),D=p.style.order.indexOf(c.fqid);if(M&&function(B,O,G,X,ee){for(const oe of X){const ie=O.getTile(oe).getBucket(G);ie&&(ie.updateReplacement(oe,B.replacementSource,ee),ie.uploadCentroid(B.context))}}(p,n,c,m,D),C||M)for(const B of m){const O=n.getTile(B).getBucket(c);O&&Cu(p.context,n,B,O,c,C,M)}if(p.renderPass==="shadow"&&p.shadowRenderer){const B=p.shadowRenderer;if(C&&v<.65&&c._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.ad)return;const O=B.getShadowPassDepthMode(),G=B.getShadowPassColorMode();or(p,n,c,m,O,Kr.disabled,G,M)}else if(p.renderPass==="translucent"){const B=!c.paint.get("fill-extrusion-pattern").constantOr(1),O=c.paint.get("fill-extrusion-color").constantOr(o.ao.white);if(!j&&O.a!==0){const G=new hr(p.context.gl.LEQUAL,hr.ReadWrite,p.depthRangeFor3D);v===1&&B?or(p,n,c,m,G,Kr.disabled,un.unblended,M):(or(p,n,c,m,G,Kr.disabled,un.disabled,M),or(p,n,c,m,G,p.stencilModeFor3D(),p.colorModeForRenderPass(),M),p.resetStencilClippingMasks())}if(p.style.enable3dLights()&&B&&(!C&&p.transform.projection.name!=="globe"||j)){const G=c.paint.get("fill-extrusion-opacity"),X=c.paint.get("fill-extrusion-ambient-occlusion-intensity"),ee=c.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),oe=c.paint.get("fill-extrusion-flood-light-intensity"),ie=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ce=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(ie?null:c.lut).toArray01().slice(0,3),me=X>0&&ee>0,de=oe>0,Ee=(Se,ve,Ie)=>(1-Ie)*Se+Ie*ve,ge=new Fv;ge.translate=c.paint.get("fill-extrusion-translate"),ge.translateAnchor=c.paint.get("fill-extrusion-translate-anchor"),ge.edgeRadius=c.layout.get("fill-extrusion-edge-radius"),ge.cutoffFadeRange=c.paint.get("fill-extrusion-cutoff-fade-range");const je=Se=>{const ve=p.depthModeForSublayer(1,hr.ReadOnly,S.LEQUAL,!0),Ie=c.paint.get(Se?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),$e=Ee(.1,3,Ie),Fe=p._showOverdrawInspector;if(!Fe){const at=new Kr({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),Qe=new un([S.ONE,S.ONE,S.ONE,S.ONE],o.ao.transparent,[!1,!1,!1,!0],S.MIN);Dc(ge,p,n,c,m,ve,at,Qe,qr.disabled,Se,"sdf",G,X,ee,oe,ce,$e,M,!1)}{const at=Fe?Kr.disabled:new Kr({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),Qe=Fe?p.colorModeForRenderPass():new un([S.ONE_MINUS_DST_ALPHA,S.DST_ALPHA,S.ONE,S.ONE],o.ao.transparent,[!0,!0,!0,!0]);Dc(ge,p,n,c,m,ve,at,Qe,qr.disabled,Se,"color",G,X,ee,oe,ce,$e,M,!1)}};if(j){const Se=(ve,Ie,$e)=>{const Fe=p.depthModeForSublayer(1,hr.ReadOnly,S.LEQUAL,!1),at=c.paint.get(ve?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Qe=Ee(.1,3,at);{const pt=new un([S.ONE,S.ONE,S.ONE,S.ONE],o.ao.transparent,[!1,!1,!1,!0]);Dc(ge,p,n,c,m,Fe,Kr.disabled,pt,qr.disabled,ve,"clear",G,X,ee,oe,ce,Qe,M,Ie)}{const pt=new Kr({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),Ot=new un([S.ONE,S.ONE,S.ONE,S.ONE],o.ao.transparent,[!1,!1,!1,!0],S.MIN);Dc(ge,p,n,c,m,Fe,pt,Ot,qr.disabled,ve,"sdf",G,X,ee,oe,ce,Qe,M,Ie)}{const pt=ve?S.ZERO:S.ONE_MINUS_DST_ALPHA,Ot=new Kr({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),Ye=new un([pt,S.DST_ALPHA,S.ONE_MINUS_DST_ALPHA,S.ZERO],o.ao.transparent,[!0,!0,!0,!0]);Dc(ge,p,n,c,m,Fe,Ot,Ye,qr.disabled,ve,"color",G,X,ee,oe,ce,Qe,M,Ie)}{const pt=new un([S.ONE,S.ONE,S.ONE,ve?S.ZERO:S.ONE],o.ao.transparent,[!1,!1,!1,!0],ve?S.FUNC_ADD:S.MAX);Dc(ge,p,n,c,m,Fe,Kr.disabled,pt,qr.disabled,ve,"clear",G,X,ee,oe,ce,Qe,M,Ie,$e)}};if(me||de){let ve;if(p.prepareDrawTile(),C){const Ie=C.drapeBufferSize[0],$e=C.drapeBufferSize[1];ve=C.framebufferCopyTexture,ve&&(!ve||ve.size[0]===Ie&&ve.size[1]===$e)||(ve&&ve.destroy(),ve=C.framebufferCopyTexture=new o.T(w,new o.q({width:Ie,height:$e}),S.RGBA8)),ve.bind(S.LINEAR,S.CLAMP_TO_EDGE),S.copyTexSubImage2D(S.TEXTURE_2D,0,0,0,0,0,Ie,$e)}me&&Se(!0,!1,ve),de&&Se(!1,!0,ve)}}else me&&je(!0),de&&je(!1),(me||de)&&p.resetStencilClippingMasks()}}},building:function(p,n,c,m){p.currentLayer<p.firstLightBeamLayer&&(p.firstLightBeamLayer=p.currentLayer);const v=c.paint.get("building-ambient-occlusion-ground-intensity"),w=c.paint.get("building-ambient-occlusion-ground-radius"),S=c.paint.get("building-ambient-occlusion-ground-attenuation"),C=c.paint.get("building-opacity");if(C<=0)return;let j=v>0&&w>0,M=!0;const D=c.paint.get("building-vertical-scale");if(D<=0)return;(!p.shadowRenderer||D<1)&&(M=!1);const B=p.conflationActive&&p.style.isLayerClipped(c,n.getSource()),O=p.style.order.indexOf(c.fqid);if(function(G,X,ee,oe,ie,ce){for(const me of ce){const de=X.getTile(me).getBucket(ee);de&&(ie&&de.updateReplacement(me,G.replacementSource,oe),de.uploadUpdatedIndexBuffer(G.context))}}(p,n,c,O,B,m),function(G,X,ee,oe){for(const ie of oe){const ce=X.getTile(ie).getBucket(ee);ce&&ce.needsEvaluation()&&ce.uploadUpdatedColorBuffer(G.context)}}(p,n,c,m),c.resetLayerRenderingStats(p),p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!0),p.renderPass==="shadow"&&p.shadowRenderer){const G=p.shadowRenderer,X=[],ee=G.getShadowPassDepthMode();Rg({painter:p,source:n,layer:c,coords:m,defines:X,blendMode:G.getShadowPassColorMode(),depthMode:ee,opacity:C,verticalScale:D,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(p.renderPass==="translucent"){let G=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];M&&(G=G.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),p.shadowRenderer&&p.shadowRenderer.useNormalOffset&&(G=G.concat("NORMAL_OFFSET"));const X=c.paint.get("building-facade-emissive-chance"),ee=c.paint.get("building-ambient-occlusion-intensity"),oe=c.paint.get("building-flood-light-intensity"),ie=c.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",ce=c.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(ie?null:c.lut).toArray01().slice(0,3),me=c.paint.get("building-flood-light-ground-attenuation"),de=oe>0,Ee=new hr(p.context.gl.LEQUAL,hr.ReadWrite,p.depthRangeFor3D);C<1&&Rg({painter:p,source:n,layer:c,coords:m,defines:G,blendMode:un.disabled,depthMode:Ee,opacity:C,verticalScale:D,facadeEmissiveChance:X,facadeAOIntensity:ee,floodLightIntensity:oe,floodLightColor:ce,depthOnly:!0});const ge=p.colorModeForRenderPass();Rg({painter:p,source:n,layer:c,coords:m,defines:G,blendMode:ge,depthMode:Ee,opacity:C,verticalScale:D,facadeEmissiveChance:X,facadeAOIntensity:ee,floodLightIntensity:oe,floodLightColor:ce}),j&&Mg(p,n,c,m,!0,C,v,w,oe,ce,S,B),de&&Mg(p,n,c,m,!1,C,v,w,oe,ce,me,B)}else if(p.renderPass==="light-beam"){const G=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],X=new hr(p.context.gl.LEQUAL,hr.ReadOnly,p.depthRangeFor3D);Rg({painter:p,source:n,layer:c,coords:m,defines:G,blendMode:un.alphaBlended,depthMode:X,opacity:C,verticalScale:D,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!1),p.resetStencilClippingMasks()},hillshade:function(p,n,c,m){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent"||p.style.disableElevatedTerrain)return;const v=p.context,w=p.terrain&&p.terrain.renderingToTexture,[S,C]=p.renderPass!=="translucent"||w?[{},m]:p.stencilConfigForOverlap(m);for(const j of C){const M=n.getTile(j);if(M.needsHillshadePrepare&&p.renderPass==="offscreen")K2(p,M,c);else if(p.renderPass==="translucent"){const D=p.depthModeForSublayer(0,hr.ReadOnly),B=c.paint.get("hillshade-emissive-strength"),O=p.colorModeForDrapableLayerRenderPass(B),G=w&&p.terrain?p.terrain.stencilModeForRTTOverlap(j):S[j.overscaledZ];X2(p,j,M,c,D,G,O)}}v.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,n,c,m,v,w){if(p.renderPass!=="translucent"||c.paint.get("raster-opacity")===0)return;const S=p.transform.projection.name==="globe",C=c.paint.get("raster-elevation")!==0,j=C&&S;if(p.renderElevatedRasterBackface&&!j)return;const M=p.context,D=M.gl,B=n.getSource(),O=function(ge,je,Se,ve){const Ie=je.paint.get("raster-color"),$e=ge.type==="raster-array",Fe=[],at=je.paint.get("raster-resampling"),Qe=je.paint.get("raster-color-mix");let pt=je.paint.get("raster-color-range");const Ot=[Qe[0],Qe[1],Qe[2],0],Ye=Qe[3];let Oe=at==="nearest"?ve.NEAREST:ve.LINEAR;if($e&&(Fe.push("RASTER_ARRAY"),Ie||Fe.push("RASTER_COLOR"),at==="linear"&&Fe.push("RASTER_ARRAY_LINEAR"),Oe=ve.NEAREST,!pt&&ge.rasterLayers)){const mt=ge.rasterLayers.find(({id:et})=>et===je.sourceLayer);mt&&mt.fields&&mt.fields.range&&(pt=mt.fields.range)}if(pt=pt||[0,1],Ie){Fe.push("RASTER_COLOR"),Se.activeTexture.set(ve.TEXTURE2),je.updateColorRamp(pt);let mt=je.colorRampTexture;mt||(mt=je.colorRampTexture=new o.T(Se,je.colorRamp,ve.RGBA8)),mt.bind(ve.LINEAR,ve.CLAMP_TO_EDGE)}return{mix:Ot,range:pt,offset:Ye,defines:Fe,resampling:Oe}}(B,c,M,D);if(B instanceof o.aT&&!m.length&&!S)return;const G=c.paint.get("raster-emissive-strength"),X=p.colorModeForDrapableLayerRenderPass(G),ee=p.terrain&&p.terrain.renderingToTexture,oe=!p.options.moving,ie=c.paint.get("raster-resampling")==="nearest"?D.NEAREST:D.LINEAR;if(B instanceof o.aT&&!m.length&&(B.onNorthPole||B.onSouthPole)){const ge=C?p.stencilModeFor3D():Kr.disabled;return void Uv(!!B.onNorthPole,null,p,n,c,G,O,qr.disabled,ge)}if(!m.length)return;const[ce,me]=B instanceof o.aT||ee?[{},m]:p.stencilConfigForOverlap(m),de=me[me.length-1].overscaledZ;j&&O.defines.push("PROJECTION_GLOBE_VIEW"),C&&O.defines.push("RENDER_CUTOFF");const Ee=(ge,je,Se)=>{for(const ve of ge){const Ie=ve.toUnwrapped(),$e=n.getTile(ve);if(ee&&(!$e||!$e.hasData()))continue;M.activeTexture.set(D.TEXTURE0);const Fe=uE($e,B,c,O);if(!Fe||!Fe.texture)continue;const{texture:at,mix:Qe,offset:pt,tileSize:Ot,buffer:Ye}=Fe;let Oe,mt;ee?(Oe=hr.disabled,mt=ve.projMatrix):C?(Oe=new hr(D.LEQUAL,hr.ReadWrite,p.depthRangeFor3D),mt=S?Float32Array.from(p.transform.expandedFarZProjMatrix):p.transform.calculateProjMatrix(Ie,oe)):(Oe=p.depthModeForSublayer(ve.overscaledZ-de,c.paint.get("raster-opacity")===1?hr.ReadWrite:hr.ReadOnly,D.LESS),mt=p.transform.calculateProjMatrix(Ie,oe));const et=p.terrain&&ee?p.terrain.stencilModeForRTTOverlap(ve):ce[ve.overscaledZ],Et=w?0:c.paint.get("raster-fade-duration");$e.registerFadeDuration(Et);const $t=n.findLoadedParent(ve,0),lr=gg($e,$t,n,p.transform,Et);let Mt,zt;!lr.isFading&&$e.refreshedUponExpiration&&($e.refreshedUponExpiration=!1),p.terrain&&p.terrain.prepareDrawTile(),M.activeTexture.set(D.TEXTURE0),at.bind(ie,D.CLAMP_TO_EDGE),M.activeTexture.set(D.TEXTURE1),$t?($t.texture&&$t.texture.bind(ie,D.CLAMP_TO_EDGE),Mt=Math.pow(2,$t.tileID.overscaledZ-$e.tileID.overscaledZ),zt=[$e.tileID.canonical.x*Mt%1,$e.tileID.canonical.y*Mt%1]):at.bind(ie,D.CLAMP_TO_EDGE),"useMipmap"in at&&M.extTextureFilterAnisotropic&&p.transform.pitch>20&&D.texParameterf(D.TEXTURE_2D,M.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,M.extTextureFilterAnisotropicMax);const ur=p.transform;let nr;const er=C?vw(ur):[0,0,0,0];let ir,kr,xn,Mn,fi,Gr=0;if(j&&B instanceof o.aT&&B.coordinates.length>3)ir=Float32Array.from(o.bj(o.dI(new o.cC(0,0,0)))),kr=Float32Array.from(ur.globeMatrix),xn=Float32Array.from(o.dE(ur)),Mn=[o.aF(ur.center.lng),o.aJ(ur.center.lat)],nr=B.elevatedGlobePerspectiveTransform,fi=B.elevatedGlobeGridMatrix||new Float32Array(9);else if(j){const Nn=o.dF(ve.canonical);Gr=o.dG(Nn.getCenter().lat),ir=Float32Array.from(o.bj(o.dI(ve.canonical))),kr=Float32Array.from(ur.globeMatrix),xn=Float32Array.from(o.dE(ur)),Mn=[o.aF(ur.center.lng),o.aJ(ur.center.lat)],nr=[0,0],fi=Float32Array.from(o.dH(ve.canonical,Nn,Gr,ur.worldSize/ur._pixelsPerMercatorPixel))}else nr=B instanceof o.aT?B.perspectiveTransform:[0,0],ir=new Float32Array(16),kr=new Float32Array(9),xn=new Float32Array(16),Mn=[0,0],fi=new Float32Array(9);const Pn=Mp(mt,ir,kr,xn,fi,zt||[0,0],o.aj(p.transform.zoom),Mn,er,Mt||1,lr,c,nr,C?c.paint.get("raster-elevation"):0,2,Qe,pt,O.range,Ot,Ye,G),on=p.isTileAffectedByFog(ve),ai=p.getOrCreateProgram("raster",{defines:O.defines,overrideFog:on});if(p.uploadCommonUniforms(M,ai,Ie),B instanceof o.aT){const Nn=B.elevatedGlobeVertexBuffer,Si=B.elevatedGlobeIndexBuffer;if(ee||!S)B.boundsBuffer&&B.boundsSegments&&ai.draw(p,D.TRIANGLES,Oe,Kr.disabled,X,qr.disabled,Pn,c.id,B.boundsBuffer,p.quadTriangleIndexBuffer,B.boundsSegments);else if(Nn&&Si){const $n=ur.zoom<=o.cZ?B.elevatedGlobeSegments:B.getSegmentsForLongitude(ur.center.lng);$n&&ai.draw(p,D.TRIANGLES,Oe,Kr.disabled,X,je,Pn,c.id,Nn,Si,$n)}}else if(j){Oe=new hr(D.LEQUAL,hr.ReadOnly,p.depthRangeFor3D);const Nn=p.globeSharedBuffers;if(Nn){const[Si,$n,an]=Nn.getGridBuffers(Gr,!1);ai.draw(p,D.TRIANGLES,Oe,Se||et,p.colorModeForRenderPass(),je,Pn,c.id,Si,$n,an)}}else{const{tileBoundsBuffer:Nn,tileBoundsIndexBuffer:Si,tileBoundsSegments:$n}=p.getTileBoundsBuffers($e);ai.draw(p,D.TRIANGLES,Oe,et,X,qr.disabled,Pn,c.id,Nn,Si,$n)}}if(!(B instanceof o.aT)&&j)for(const ve of ge){const Ie=ve.canonical.y===(1<<ve.canonical.z)-1;ve.canonical.y===0&&Uv(!0,ve,p,n,c,G,O,je,Se||Kr.disabled),Ie&&Uv(!1,ve,p,n,c,G,O,je===qr.frontCW?qr.backCW:qr.frontCW,Se||Kr.disabled)}};j?Ee(me,p.renderElevatedRasterBackface?qr.backCW:qr.frontCW,p.stencilModeFor3D()):Ee(me,qr.disabled,void 0),p.resetStencilClippingMasks()},"raster-particle":function(p,n,c,m,v,w){p.renderPass==="offscreen"&&function(S,C,j,M){if(!M.length)return;const D=S.context,B=D.gl,O=C.getSource();if(!(O instanceof Js))return;const G=Math.ceil(Math.sqrt(j.paint.get("raster-particle-count")));let X=j.particlePositionRGBAImage;if(!X||X.width!==G){const me=function(de){const Ee=de*de,ge=new Uint8Array(4*Ee),je=function(ve){return ve|=0,ve=Math.imul(2747636419^ve,2654435769),ve=Math.imul(ve^ve>>>16,2654435769),((ve=Math.imul(ve^ve>>>16,2654435769))>>>0)/4294967296},Se=1/1.1;for(let ve=0;ve<Ee;ve++){const Ie=Se*(je(2*ve+0)+_d),$e=Se*(je(2*ve+1)+_d),Fe=255*Ie%1,at=255*$e%1,Qe=Fe,pt=$e-at/255,Ot=at;ge[4*ve+0]=255*(Ie-Fe/255),ge[4*ve+1]=255*Qe,ge[4*ve+2]=255*pt,ge[4*ve+3]=255*Ot}return ge}(G);X=j.particlePositionRGBAImage=new o.q({width:G,height:G},me)}let ee=j.particleFramebuffer;ee?ee.width!==G&&(ee.destroy(),ee=j.particleFramebuffer=D.createFramebuffer(G,G,!0,null)):ee=j.particleFramebuffer=D.createFramebuffer(G,G,!0,null);const oe=[];for(const me of M){const de=C.getTile(me);if(!(de instanceof vu))continue;const Ee=$v(de,O,j);if(!Ee)continue;const ge=[de.tileSize,de.tileSize];let je=j.tileFramebuffer;je||(je=j.tileFramebuffer=D.createFramebuffer(ge[0],ge[1],!0,null));let Se=de.rasterParticleState;Se||(Se=de.rasterParticleState=new ga(D,me,ge,X));const ve=Se.update(j.lastInvalidatedAt);Se.particleTextureDimension!==G&&Se.updateParticleTexture(me,X);const Ie=Se.targetColorTexture;Se.targetColorTexture=Se.backgroundColorTexture,Se.backgroundColorTexture=Ie;const $e=Se.particleTexture0;Se.particleTexture0=Se.particleTexture1,Se.particleTexture1=$e,oe.push([me,Ee,Se,ve])}if(oe.length===0)return;const ie=o.o.now(),ce=j.previousDrawTimestamp?.001*(ie-j.previousDrawTimestamp):.0167;if(j.previousDrawTimestamp=ie,j.hasColorMap()){D.activeTexture.set(B.TEXTURE0+2);let me=j.colorRampTexture;me||(me=j.colorRampTexture=new o.T(D,j.colorRamp,B.RGBA8)),me.bind(B.LINEAR,B.CLAMP_TO_EDGE)}D.bindFramebuffer.set(j.tileFramebuffer.framebuffer),function(me,de,Ee){const ge=me.context,je=ge.gl,Se=de.tileFramebuffer;ge.activeTexture.set(je.TEXTURE0);const ve={u_texture:0,u_opacity:1.05*($e=de.paint.get("raster-particle-fade-opacity-factor"))/($e+.05)},Ie=me.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var $e;for(const Fe of Ee){const[,,at,Qe]=Fe;Se.colorAttachment.set(at.targetColorTexture.texture),ge.viewport.set([0,0,Se.width,Se.height]),ge.clear({color:o.ao.transparent}),Qe&&(at.backgroundColorTexture.bind(je.NEAREST,je.CLAMP_TO_EDGE),Ie.draw(me,je.TRIANGLES,hr.disabled,Kr.disabled,un.alphaBlended,qr.disabled,ve,de.id,me.viewportBuffer,me.quadTriangleIndexBuffer,me.viewportSegments))}}(S,j,oe),function(me,de,Ee,ge){const je=me.context,Se=je.gl,ve=Ee.tileFramebuffer,Ie=me.transform.projection.name==="globe",$e=Ee.paint.get("raster-particle-max-speed");for(const Fe of ge){const[at,Qe,pt]=Fe;je.activeTexture.set(Se.TEXTURE0+0),Qe.texture.bind(Se.LINEAR,Se.CLAMP_TO_EDGE),ve.colorAttachment.set(pt.targetColorTexture.texture);const Ot=me.getOrCreateProgram("rasterParticleDraw",{defines:Qe.defines,overrideFog:!1});je.activeTexture.set(Se.TEXTURE0+1);const Ye=Qe.scalarData?[]:[0,1,2,3].map(et=>o.e8[et](at));Ye.push(at);const Oe=at.canonical.x,mt=at.canonical.y;for(const et of Ye){const Et=de.getTile(Ie?et.wrapped():et);if(!Et)continue;const $t=Et.rasterParticleState;if(!$t)continue;const lr=et.canonical.x+(1<<et.canonical.z)*(et.wrap-at.wrap),Mt=et.canonical.y;$t.particleTexture0.bind(Se.NEAREST,Se.CLAMP_TO_EDGE);const zt=Nv(1,$t.particleTexture0.size[0],[lr-Oe,Mt-mt],0,Qe.texture.size,2,$e,Qe.textureOffset,Qe.scale,Qe.offset);Ot.draw(me,Se.POINTS,hr.disabled,Kr.disabled,un.alphaBlended,qr.disabled,zt,Ee.id,$t.particleIndexBuffer,void 0,$t.particleSegment)}}}(S,C,j,oe),D.bindFramebuffer.set(j.particleFramebuffer.framebuffer),function(me,de,Ee,ge){const je=me.context,Se=je.gl,ve=de.paint.get("raster-particle-max-speed"),Ie=ge*de.paint.get("raster-particle-speed-factor")*.15,$e=function(at){return Math.pow(at,6)}(.01+1*de.paint.get("raster-particle-reset-rate-factor")),Fe=de.particleFramebuffer;je.viewport.set([0,0,Fe.width,Fe.height]);for(const at of Ee){const[,Qe,pt]=at;je.activeTexture.set(Se.TEXTURE0+0),Qe.texture.bind(Se.LINEAR,Se.CLAMP_TO_EDGE),je.activeTexture.set(Se.TEXTURE0+1);const Ot=pt.particleTexture0;Ot.bind(Se.NEAREST,Se.CLAMP_TO_EDGE);const Ye=Sg(1,Ot.size[0],0,Qe.texture.size,ve,Ie,$e,Qe.textureOffset,Qe.scale,Qe.offset);Fe.colorAttachment.set(pt.particleTexture1.texture),je.clear({color:o.ao.transparent}),me.getOrCreateProgram("rasterParticleUpdate",{defines:Qe.defines}).draw(me,Se.TRIANGLES,hr.disabled,Kr.disabled,un.unblended,qr.disabled,Ye,de.id,me.viewportBuffer,me.quadTriangleIndexBuffer,me.viewportSegments)}}(S,j,oe,ce)}(p,n,c,m),p.renderPass==="translucent"&&(function(S,C,j,M,D){const B=S.context,O=B.gl,G=C.getSource().tileSize,X=5*(1-o.ah(o.cK,o.cK+1,S.transform.zoom))*G+j.paint.get("raster-particle-elevation"),ee=!S.options.moving,oe=S.transform.projection.name==="globe";if(!M.length)return;const[ie,ce]=S.stencilConfigForOverlap(M),me=[];oe&&me.push("PROJECTION_GLOBE_VIEW");const de=S.stencilModeFor3D();for(const Ee of ce){const ge=Ee.toUnwrapped(),je=C.getTile(Ee);if(!je.rasterParticleState)continue;const Se=je.rasterParticleState,ve=100;je.registerFadeDuration(ve);const Ie=C.findLoadedParent(Ee,0),$e=gg(je,Ie,C,S.transform,ve);let Fe,at;S.terrain&&S.terrain.prepareDrawTile(),B.activeTexture.set(O.TEXTURE0),Se.targetColorTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),B.activeTexture.set(O.TEXTURE1),Ie&&Ie.rasterParticleState?(Ie.rasterParticleState.targetColorTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),Fe=Math.pow(2,Ie.tileID.overscaledZ-je.tileID.overscaledZ),at=[je.tileID.canonical.x*Fe%1,je.tileID.canonical.y*Fe%1]):Se.targetColorTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE);const Qe=oe?Float32Array.from(S.transform.expandedFarZProjMatrix):S.transform.calculateProjMatrix(ge,ee),pt=S.transform,Ot=Yo(pt),Ye=o.dF(Ee.canonical),Oe=o.dG(Ye.getCenter().lat);let mt,et,Et,$t,lr;oe?(mt=Float32Array.from(o.bj(o.dI(Ee.canonical))),et=Float32Array.from(pt.globeMatrix),Et=Float32Array.from(o.dE(pt)),$t=[o.aF(pt.center.lng),o.aJ(pt.center.lat)],lr=Float32Array.from(o.dH(Ee.canonical,Ye,Oe,pt.worldSize/pt._pixelsPerMercatorPixel))):(mt=new Float32Array(16),et=new Float32Array(9),Et=new Float32Array(16),$t=[0,0],lr=new Float32Array(9));const Mt=Su(Qe,mt,et,Et,lr,at||[0,0],o.aj(S.transform.zoom),$t,Ot,Fe||1,$e,X),zt=S.isTileAffectedByFog(Ee),ur=S.getOrCreateProgram("rasterParticle",{defines:me,overrideFog:zt});if(S.uploadCommonUniforms(B,ur,ge),oe){const nr=new hr(O.LEQUAL,hr.ReadOnly,S.depthRangeFor3D),er=0,ir=S.globeSharedBuffers;if(ir){const[kr,xn,Mn]=ir.getGridBuffers(Oe,er!==0);ur.draw(S,O.TRIANGLES,nr,de,un.alphaBlended,S.renderElevatedRasterBackface?qr.frontCCW:qr.backCCW,Mt,j.id,kr,xn,Mn)}}else{const nr=S.depthModeForSublayer(0,hr.ReadOnly),er=ie[Ee.overscaledZ],{tileBoundsBuffer:ir,tileBoundsIndexBuffer:kr,tileBoundsSegments:xn}=S.getTileBoundsBuffers(je);ur.draw(S,O.TRIANGLES,nr,er,un.alphaBlended,qr.disabled,Mt,j.id,ir,kr,xn)}}S.resetStencilClippingMasks()}(p,n,c,m),p.style.map.triggerRepaint())},background:function(p,n,c,m){const v=c.paint.get("background-color"),w=c.paint.get("background-color-use-theme").constantOr("default")==="none",S=c.paint.get("background-opacity"),C=c.paint.get("background-emissive-strength"),j=c.paint.get("background-pitch-alignment")==="viewport";if(S===0)return;const M=p.context,D=M.gl,B=p.transform,O=B.tileSize,G=c.paint.get("background-pattern");let X;if(G!==void 0&&(G===null||(X=p.imageManager.getPattern(o.I.from(G.toString()),c.scope,p.style.getLut(c.scope)),!X)))return;const ee=!G&&v.a===1&&S===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==ee)return;const oe=Kr.disabled,ie=p.depthModeForSublayer(0,ee==="opaque"?hr.ReadWrite:hr.ReadOnly),ce=p.colorModeForDrapableLayerRenderPass(C),me=G?"backgroundPattern":"background";let de,Ee=m;if(Ee||(de=p.getBackgroundTiles(),Ee=Object.values(de).map(ge=>ge.tileID)),G&&(M.activeTexture.set(D.TEXTURE0),p.imageManager.bind(p.context,c.scope)),j){const ge=p.getOrCreateProgram(me,{overrideFog:!1,overrideRtt:!0}),je=new Float32Array(o.bz([])),Se=new o.aP(0,0,0,0,0),ve=G?Eg(je,C,S,p,0,c.scope,X,j,{tileID:Se,tileSize:O}):Tg(je,C,S,v.toPremultipliedRenderColor(w?null:c.lut));ge.draw(p,D.TRIANGLES,ie,oe,ce,qr.disabled,ve,c.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments)}else for(const ge of Ee){const je=p.isTileAffectedByFog(ge),Se=p.getOrCreateProgram(me,{overrideFog:je}),ve=ge.toUnwrapped(),Ie=m?ge.projMatrix:p.transform.calculateProjMatrix(ve);p.prepareDrawTile();const $e=n?n.getTile(ge):de?de[ge.key]:new tc(ge,O,B.zoom,p),Fe=G?Eg(Ie,C,S,p,0,c.scope,X,j,{tileID:ge,tileSize:O}):Tg(Ie,C,S,v.toPremultipliedRenderColor(w?null:c.lut));p.uploadCommonUniforms(M,Se,ve);const{tileBoundsBuffer:at,tileBoundsIndexBuffer:Qe,tileBoundsSegments:pt}=p.getTileBoundsBuffers($e);Se.draw(p,D.TRIANGLES,ie,oe,ce,qr.disabled,Fe,c.id,at,Qe,pt)}},sky:function(p,n,c){const m=p._atmosphere?o.aj(p.transform.zoom):1,v=c.paint.get("sky-opacity")*m;if(v===0)return;const w=p.context,S=c.paint.get("sky-type"),C=new hr(w.gl.LEQUAL,hr.ReadOnly,[0,1]),j=p.frameCounter/1e3%1;S==="atmosphere"?p.renderPass==="offscreen"?c.needsSkyboxCapture(p)&&(function(M,D,B,O){const G=M.context,X=G.gl;let ee=D.skyboxFbo;if(!ee){ee=D.skyboxFbo=G.createFramebuffer(32,32,!0,null),D.skyboxGeometry=new Zv(G),D.skyboxTexture=G.gl.createTexture(),X.bindTexture(X.TEXTURE_CUBE_MAP,D.skyboxTexture),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_MAG_FILTER,X.LINEAR);for(let me=0;me<6;++me)X.texImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+me,0,X.RGBA,32,32,0,X.RGBA,X.UNSIGNED_BYTE,null)}G.bindFramebuffer.set(ee.framebuffer),G.viewport.set([0,0,32,32]);const oe=D.getCenter(M,!0),ie=M.getOrCreateProgram("skyboxCapture"),ce=new Float64Array(16);o.bz(ce),o.em(ce,ce,.5*-Math.PI),ul(M,D,ie,ce,oe,0),o.bz(ce),o.em(ce,ce,.5*Math.PI),ul(M,D,ie,ce,oe,1),o.bz(ce),o.cT(ce,ce,.5*-Math.PI),ul(M,D,ie,ce,oe,2),o.bz(ce),o.cT(ce,ce,.5*Math.PI),ul(M,D,ie,ce,oe,3),o.bz(ce),ul(M,D,ie,ce,oe,4),o.bz(ce),o.em(ce,ce,Math.PI),ul(M,D,ie,ce,oe,5),G.viewport.set([0,0,M.width,M.height])}(p,c),c.markSkyboxValid(p)):p.renderPass==="sky"&&function(M,D,B,O,G){const X=M.context,ee=X.gl,oe=M.transform,ie=M.getOrCreateProgram("skybox");X.activeTexture.set(ee.TEXTURE0),ee.bindTexture(ee.TEXTURE_CUBE_MAP,D.skyboxTexture);const ce=((me,de,Ee,ge,je)=>({u_matrix:me,u_sun_direction:de,u_cubemap:0,u_opacity:ge,u_temporal_offset:je}))(oe.skyboxMatrix,D.getCenter(M,!1),0,O,G);M.uploadCommonUniforms(X,ie),ie.draw(M,ee.TRIANGLES,B,Kr.disabled,M.colorModeForRenderPass(),qr.backCW,ce,"skybox",D.skyboxGeometry.vertexBuffer,D.skyboxGeometry.indexBuffer,D.skyboxGeometry.segment)}(p,c,C,v,j):S==="gradient"&&p.renderPass==="sky"&&function(M,D,B,O,G){const X=M.context,ee=X.gl,oe=M.transform,ie=M.getOrCreateProgram("skyboxGradient");D.skyboxGeometry||(D.skyboxGeometry=new Zv(X)),X.activeTexture.set(ee.TEXTURE0);let ce=D.colorRampTexture;ce||(ce=D.colorRampTexture=new o.T(X,D.colorRamp,ee.RGBA8)),ce.bind(ee.LINEAR,ee.CLAMP_TO_EDGE);const me=((de,Ee,ge,je,Se)=>({u_matrix:de,u_color_ramp:0,u_center_direction:Ee,u_radius:o.an(ge),u_opacity:je,u_temporal_offset:Se}))(oe.skyboxMatrix,D.getCenter(M,!1),D.paint.get("sky-gradient-radius"),O,G);M.uploadCommonUniforms(X,ie),ie.draw(M,ee.TRIANGLES,B,Kr.disabled,M.colorModeForRenderPass(),qr.backCW,me,"skyboxGradient",D.skyboxGeometry.vertexBuffer,D.skyboxGeometry.indexBuffer,D.skyboxGeometry.segment)}(p,c,C,v,j)},custom:function(p,n,c,m){const v=p.context,w=c.implementation;if(!p.transform.projection.unsupportedLayers||!p.transform.projection.unsupportedLayers.includes("custom")||p.terrain&&(p.terrain.renderingToTexture||p.renderPass==="offscreen")&&c.isDraped(n)){if(p.renderPass==="offscreen"){const S=w.prerender;if(S){if(p.setCustomLayerDefaults(),v.setColorMode(p.colorModeForRenderPass()),p.transform.projection.name==="globe"){const C=p.transform.pointMerc;S.call(w,v.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),o.aj(p.transform.zoom),[C.x,C.y],p.transform.pixelsPerMeterRatio)}else S.call(w,v.gl,p.transform.customLayerMatrix());v.setDirty(),p.setBaseState()}}else if(p.renderPass==="translucent"){if(p.terrain&&p.terrain.renderingToTexture){const C=w.renderToTile;if(C){const j=m[0].canonical,M={x:j.x+m[0].wrap*(w.wrapTileId?0:1<<j.z),y:j.y,z:j.z};v.setDepthMode(hr.disabled),v.setStencilMode(Kr.disabled),v.setColorMode(p.colorModeForRenderPass()),p.setCustomLayerDefaults(),C.call(w,v.gl,M),v.setDirty(),p.setBaseState()}return}p.setCustomLayerDefaults(),v.setColorMode(p.colorModeForRenderPass()),v.setStencilMode(Kr.disabled);const S=w.renderingMode==="3d"?new hr(p.context.gl.LEQUAL,hr.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,hr.ReadOnly);if(v.setDepthMode(S),p.transform.projection.name==="globe"){const C=p.transform.pointMerc;w.render(v.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),o.aj(p.transform.zoom),[C.x,C.y],p.transform.pixelsPerMeterRatio)}else w.render(v.gl,p.transform.customLayerMatrix());v.setDirty(),p.setBaseState(),v.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(p,n,c,m){if(p.renderPass==="opaque")return;const v=c.paint.get("model-opacity").constantOr(1),w=c.paint.get("model-elevation-reference"),S=w==="ground",C=w==="ground";if(v===0)return;const j=c.paint.get("model-cast-shadows");if(p.renderPass==="shadow"&&(!j||p.terrain&&v<.65&&c._transitionablePaint._values["model-opacity"].value.expression instanceof o.ad))return;const M=p.shadowRenderer,D=c.paint.get("model-receive-shadows");M&&(M.useNormalOffset=!0,D||(M.enabled=!1));const B=()=>{M&&(M.useNormalOffset=!0,D||(M.enabled=!0))},O=n.getSource();if(p.renderPass==="light-beam"&&O.type!=="batched-model")return;if(O.type==="vector"||O.type==="geojson")return function(de,Ee,ge,je,Se){const ve=de.transform,Ie=ve.projection.name==="globe",$e=ve.getFreeCameraOptions().position;if(!de.modelManager)return;const Fe=de.modelManager;ge.modelManager=Fe;const at=de.shadowRenderer;if(!ge._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Qe=ge._unevaluatedLayout._values["model-id"],pt=Object.assign({},ge.layout.get("model-id").parameters),Ot=de.style.order.indexOf(ge.fqid);for(const Ye of je){const Oe=Ee.getTile(Ye).getBucket(ge);if(!Oe||Oe.projection.name!==ve.projection.name)continue;const mt=Oe.getModelUris();if(mt&&!Oe.modelsRequested&&(Fe.addModelsFromBucket(mt,Se),Oe.modelsRequested=!0),Ie)pt.zoom=Ye.overscaledZ;else{const nr=Kv(Ye,ve);pt.zoom=nr}const et=Qe.possiblyEvaluate(pt);if(Tw(de,Oe,Ye),Ma.shadowUniformsInitialized=!1,Ma.useSingleShadowCascade=!!at&&at.getMaxCascadeForTile(Ye.toUnwrapped())===0,de.renderPass==="shadow"&&at){if(de.currentShadowCascade===1&&Oe.isInsideFirstShadowMapFrustum)continue;const nr=ve.calculatePosMatrix(Ye.toUnwrapped(),ve.worldSize);if(Ma.tileMatrix.set(nr),Ma.shadowTileMatrix=Float32Array.from(at.calculateShadowPassMatrixFromMatrix(nr)),Ma.aabb.min=[0,0,0],Ma.aabb.max[0]=Ma.aabb.max[1]=o.al,Ma.aabb.max[2]=0,Og(Oe,Ma,de,ge.scope))continue}const Et=1<<Ye.canonical.z,$t=[(($e.x-Ye.wrap)*Et-Ye.canonical.x)*o.al,($e.y*Et-Ye.canonical.y)*o.al,$e.z*Et*o.al];de.conflationActive&&Object.keys(Oe.instancesPerModel).length>0&&de.style.isLayerClipped(ge,Ee.getSource())&&Oe.updateReplacement(Ye,de.replacementSource,Ot,Se)&&(Oe.uploaded=!1,Oe.upload(de.context));let lr=0;const Mt=new Array,zt=new Array,ur=new Array;for(let nr in Oe.instancesPerModel){const er=Oe.instancesPerModel[nr];er.features.length>0&&!Ie&&(nr=et.evaluate(er.features[0].feature,{}));const ir=Fe.getModel(nr,Se);if(ir||Fe.hasURLBeenRequested(nr)||Oe.modelUris.includes(nr)||(Oe.modelUris.push(nr),Oe.modelsRequested=!1),ir&&ir.uploaded)if(Ie){const kr=o.c4([],[$e.x,$e.y,$e.z],de.transform.worldSize);o.ev(kr,kr);for(let xn=0;xn<er.instancedDataArray.length;++xn){const Mn=[0,0,0],fi=[1,1,1],Gr=o.ew(),Pn=er.tileCoordinatesForInstance(xn),on=er.transformForInstance(xn);o.ex(fi,on),o.ey(Gr,on),o.ez(Mn,Gr);const ai=er.translationForInstance(xn),Nn=new o.aS(0,0);o.eA(Oe.canonical,Nn,Pn.x,Pn.y);const Si=o.bB();o.eB(Si,ir,de.transform,Nn,Mn,fi,ai,!0,!1,!1);const $n=er.colorForInstance(xn),an=o.bz([]),Qn=o.ee(Nn.lat,de.transform.zoom),dn=o.bp([],[1,1,1/Qn]);o.bq(an,an,kr),ur.push({zScaleMatrix:dn,negCameraPosMatrix:an});for(const ki of ir.nodes)Dg(de,ki,Si,de.transform.expandedFarZProjMatrix,lr,Mt,zt,ir.materialOverrides,$n);++lr}}else for(const kr of ir.nodes)Yv(de,ge,kr,er,$t,Ye,Ma)}if(Ie)if(de.renderPass==="shadow"){for(const nr of zt)Ih(nr.mesh,nr.nodeModelMatrix,de,ge);for(const nr of Mt)Ih(nr.mesh,nr.nodeModelMatrix,de,ge)}else Sw(de,ge,1,Mt,zt,ur)}}(p,n,c,m,Ng(O,c,p.style._importedAsBasemap)),void B();if(!O.loaded())return;if(O.type==="batched-model")return function(de,Ee,ge,je){ge.resetLayerRenderingStats(de);const Se=de.context,ve=de.transform,Ie=de.style.fog,$e=de.shadowRenderer;if(ve.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${ve.projection.name} projection is not yet implemented`);const Fe=de.transform.getFreeCameraOptions().position,at=o.c4([],[Fe.x,Fe.y,Fe.z],de.transform.worldSize),Qe=o.ev([],at),pt=o.bz([]),Ot=o.ee(ve.center.lat,ve.zoom),Ye=o.bp([],[1,1,1/Ot]);o.bq(pt,pt,Qe);const Oe=ge.paint.get("model-opacity").constantOr(1),mt=new hr(Se.gl.LEQUAL,hr.ReadWrite,de.depthRangeFor3D),et=new hr(Se.gl.LEQUAL,hr.ReadOnly,de.depthRangeFor3D),Et=new o.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),$t=de.renderPass==="shadow",lr=$t&&$e?$e.getCurrentCascadeFrustum():ve.getFrustum(ve.scaleZoom(ve.worldSize)),Mt=ge.paint.get("model-front-cutoff"),zt=Mt[2]<1,ur=Mc(de,ge.paint.get("model-cutoff-fade-range")),nr=ge.getLayerRenderingStats();(function(er,ir,kr,xn){const Mn=er.terrain?er.terrain.exaggeration():0,fi=er.transform.zoom;for(const Gr of xn){const Pn=ir.getTile(Gr).getBucket(kr);Pn&&(Pn.setFilter(kr.filter),er.conflationActive&&Pn.updateReplacement(Gr,er.replacementSource),Pn.evaluateTransform(er,kr),er.terrain&&Mn>0&&Pn.elevationUpdate(er.terrain,Mn,Gr,kr.source),Pn.needsReEvaluation(er,fi,kr)&&Pn.evaluate(kr))}})(de,Ee,ge,je),function(){let er,ir,kr;zt?(er=je.length-1,ir=-1,kr=-1):(er=0,ir=je.length,kr=1);const xn=new Float64Array(16),Mn=o.cz(),fi=new o.P(0,0);for(let Gr=er;Gr!==ir;Gr+=kr){const Pn=je[Gr],on=Ee.getTile(Pn).getBucket(ge);if(!on||!on.uploaded)continue;let ai=!1;$e&&(ai=$e.getMaxCascadeForTile(Pn.toUnwrapped())===0);const Nn=ve.calculatePosMatrix(Pn.toUnwrapped(),ve.worldSize),Si=on.modelTraits;!$t&&zt&&(o.bk(xn,Nn),o.af(Mn,at,xn),fi.x=Mn[0],fi.y=Mn[1]);const $n=[];on.setFilter(ge.filter);for(const an of on.getNodesInfo()){if(an.hiddenByReplacement||!an.node.meshes)continue;const Qn=an.node;let dn=0;de.terrain&&Qn.elevation&&(dn=Qn.elevation*de.terrain.exaggeration());const ki=(()=>{const ko=an.aabb;return Et.min=[...ko.min],Et.max=[...ko.max],Et.min[2]+=dn,Et.max[2]+=dn,o.af(Et.min,Et.min,Nn),o.af(Et.max,Et.max,Nn),Et})(),ti=an.evaluatedScale;if(ti[0]<=1&&ti[1]<=1&&ti[2]<=1&&ki.intersects(lr)===0)continue;if(!$t&&zt){const ko=.16666666666666666;an.cameraCollisionOpacity=at[0]>ki.min[0]&&at[0]<ki.max[0]&&at[1]>ki.min[1]&&at[1]<ki.max[1]&&at[2]*Ot<ki.max[2]&&Qn.footprint&&o.b$(fi,Qn.footprint)?Math.max(an.cameraCollisionOpacity-ko,0):Math.min(1,an.cameraCollisionOpacity+ko)}const Zr=[...Nn],Ln=1/o.d6(Pn.canonical),Gi=Qn.anchor?Qn.anchor[0]:0,ds=Qn.anchor?Qn.anchor[1]:0;o.bq(Zr,Zr,[Gi*(ti[0]-1)+an.evaluatedTranslation[0]*Ln,ds*(ti[1]-1)+an.evaluatedTranslation[1]*Ln,dn+an.evaluatedTranslation[2]]),o.cp(ti,o.eD)||o.cR(Zr,Zr,ti);const Xi=o.aB([],Zr,Qn.globalMatrix),ss=o.aB([],ve.expandedFarZProjMatrix,Xi),aa=o.aB([],ve.expandedFarZProjMatrix,Zr),Jo=o.aC([],[Gi,ds,dn,1],ss)[2];Qn.hidden=!1;let wo=Oe;$t||(zt&&(wo*=an.cameraCollisionOpacity,wo*=xd(Zr,ve,an.aabb,Mt)),wo*=Lp(ur,Jo)),wo!==0?$n.push({nodeInfo:an,depth:Jo,opacity:wo,wvpForNode:ss,wvpForTile:aa,nodeModelMatrix:Xi,tileModelMatrix:Zr}):Qn.hidden=!0}$t||$n.sort((an,Qn)=>!zt||an.opacity===1&&Qn.opacity===1?an.depth<Qn.depth?-1:1:an.opacity===1?-1:Qn.opacity===1?1:an.depth>Qn.depth?-1:1);for(const an of $n){const Qn=an.nodeInfo,dn=Qn.node;let ki=o.aB([],Ye,an.tileModelMatrix);o.aB(ki,pt,ki);const ti=o.bk([],ki);o.ef(ti,ti),o.cR(ti,ti,Ew),ki=o.aB(ki,ki,dn.globalMatrix);const Zr=de.renderPass==="light-beam",Ln=ge.paint.get("model-color-use-theme").constantOr("default")==="none",Gi=Si&o.eH.HasMapboxMeshFeatures,ds=Gi?0:Qn.evaluatedRMEA[0][2];for(let Xi=0;Xi<dn.meshes.length;++Xi){const ss=dn.meshes[Xi],aa=Xi===dn.lightMeshIndex;let Jo=an.wvpForNode;if(aa){if(!Zr&&!de.terrain&&de.shadowRenderer){de.currentLayer<de.firstLightBeamLayer&&(de.firstLightBeamLayer=de.currentLayer);continue}Jo=an.wvpForTile}else if(Zr)continue;const wo={defines:[]},ko=[];if(!$t&&$e&&($e.useNormalOffset=!!ss.normalBuffer),Ah(wo.defines,ko,ss,de,Ln?null:ge.lut),Gi||wo.defines.push("DIFFUSE_SHADED"),ai&&wo.defines.push("SHADOWS_SINGLE_CASCADE"),nr&&($t?nr.numRenderedVerticesInShadowPass+=ss.vertexArray.length:nr.numRenderedVerticesInTransparentPass+=ss.vertexArray.length),$t){Ih(ss,an.nodeModelMatrix,de,ge);continue}let Da=null;if(Ie){const hs=Xv(an.nodeModelMatrix,de.transform);if(Da=new Float32Array(hs),ve.projection.name!=="globe"){const wi=ss.aabb.min,_s=ss.aabb.max,[io,ts]=Ie.getOpacityForBounds(hs,wi[0],wi[1],_s[0],_s[1]);wo.overrideFog=io>=tt||ts>=tt}}const So=ss.material;let Oa;So.occlusionTexture&&So.occlusionTexture.offsetScale&&(Oa=So.occlusionTexture.offsetScale,wo.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const fl=de.getOrCreateProgram("model",wo);!$t&&$e&&$e.setupShadowsFromMatrix(an.tileModelMatrix,fl,$e.useNormalOffset),de.uploadCommonUniforms(Se,fl,null,Da);const no=So.pbrMetallicRoughness;no.metallicFactor=.9,no.roughnessFactor=.5;const es=Cg(new Float32Array(Jo),new Float32Array(ki),new Float32Array(ti),new Float32Array(dn.globalMatrix),de,an.opacity,no.baseColorFactor,So.emissiveFactor,no.metallicFactor,no.roughnessFactor,So,ds,ge,[0,0,0],Oa);!aa&&(Qn.hasTranslucentParts||an.opacity<1)&&fl.draw(de,Se.gl.TRIANGLES,mt,Kr.disabled,un.disabled,qr.backCCW,es,ge.id,ss.vertexBuffer,ss.indexBuffer,ss.segments,ge.paint,de.transform.zoom,void 0,ko),fl.draw(de,Se.gl.TRIANGLES,aa?et:mt,Kr.disabled,aa||an.opacity<1||Qn.hasTranslucentParts?un.alphaBlended:un.unblended,qr.backCCW,es,ge.id,ss.vertexBuffer,ss.indexBuffer,ss.segments,ge.paint,de.transform.zoom,void 0,ko)}}}}()}(p,n,c,m),void B();if(O.type!=="model")return;const G=O.getModels(),X=[],ee=p.transform.getFreeCameraOptions().position,oe=o.c4([],[ee.x,ee.y,ee.z],p.transform.worldSize);o.ev(oe,oe);const ie=[],ce=[];let me=0;for(const de of G){const Ee=n.getFeatureState("",de.id),ge={type:"Unknown",id:de.id,properties:de.featureProperties},je=c.paint.get("model-rotation").evaluate(ge,Ee),Se=c.paint.get("model-scale").evaluate(ge,Ee),ve=c.paint.get("model-translation").evaluate(ge,Ee);kh(c,de.id,Ee,de.featureProperties,de.nodeOverrideNames,de.nodeOverrides),hE(c,de.id,Ee,de.featureProperties,de.materialOverrideNames,de.materialOverrides),de.nodeOverrides.size>0&&de.computeBoundsAndApplyParent(),de.computeModelMatrix(p,je,Se,ve,C,S,!1);const Ie=o.bz([]),$e=o.ee(de.position.lat,p.transform.zoom),Fe=o.bp([],[1,1,1/$e]);o.bq(Ie,Ie,oe),X.push({zScaleMatrix:Fe,negCameraPosMatrix:Ie});for(const at of de.nodes)Dg(p,at,de.matrix,p.transform.expandedFarZProjMatrix,me,ie,ce,de.materialOverrides);me++}if(ie.sort((de,Ee)=>Ee.depth-de.depth),p.renderPass!=="shadow")Sw(p,c,v,ie,ce,X),B();else{for(const de of ce)Ih(de.mesh,de.nodeModelMatrix,p,c);for(const de of ie)Ih(de.mesh,de.nodeModelMatrix,p,c);B()}}},Lg={line:function(p,n,c){if(p.hasElevatedBuckets=!1,p.hasNonElevatedBuckets=!1,p._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||p._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(n){const m=n.getVisibleCoordinates();for(const v of m){const w=n.getTile(v).getBucket(p);if(w&&(w.elevationType!=="none"?p.hasElevatedBuckets=!0:p.hasNonElevatedBuckets=!0,p.hasElevatedBuckets&&p.hasNonElevatedBuckets))break}}}else p.hasNonElevatedBuckets=!0},model:function(p,n,c){const m=n.getSource();if(!m.loaded())return;if(m.type==="vector"||m.type==="geojson"){const w=Ng(m,p,c.style._importedAsBasemap);return void(c.modelManager&&c.modelManager.upload(c,w))}if(m.type==="batched-model"||m.type!=="model")return;const v=m.getModels();for(const w of v)w.upload(c.context)},raster:function(p,n,c){const m=n.getSource();if(!(m instanceof Js&&m.loaded()))return;const v=p.sourceLayer||m.rasterLayerIds&&m.rasterLayerIds[0];if(!v)return;const w=p.paint.get("raster-array-band")||m.getInitialBand(v);if(w==null)return;const S=n.getIds().map(C=>n.getTileByID(C));for(const C of S)C.updateNeeded(p.id,w)&&m.prepareTile(C,v,p.id,w)},"raster-particle":function(p,n,c){const m=n.getSource();if(!(m instanceof Js&&m.loaded()))return;const v=p.sourceLayer||m.rasterLayerIds&&m.rasterLayerIds[0];if(!v)return;const w=p.paint.get("raster-particle-array-band")||m.getInitialBand(v);if(w==null)return;const S=n.getIds().map(C=>n.getTileByID(C));for(const C of S)C.updateNeeded(p.id,w)&&m.prepareTile(C,v,p.id,w)}},zg={fill:yd},Na={fill:function(p,n,c,m){if(!c.layout||c.layout.get("fill-elevation-reference")==="none"||c.paint.get("fill-opacity").constantOr(1)===0)return;const v=p.context.gl,w=new hr(v.LEQUAL,hr.ReadOnly,p.depthRangeFor3D),S=new Kr({func:v.ALWAYS,mask:255},255,255,v.KEEP,v.KEEP,v.REPLACE),C=p.transform.getFreeCameraOptions().position,j=p.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const M of m){const D=n.getTile(M),B=D.getBucket(c);if(!B)continue;const O=B.elevatedStructures;if(!O||O.depthSegments.segments[0].primitiveLength===0)continue;const G=_w(M.toUnwrapped(),C),X=p.translatePosMatrix(M.projMatrix,D,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor")),ee=xg(X,G,0,1,0);j.draw(p,v.TRIANGLES,w,S,un.disabled,qr.disabled,ee,c.id,O.vertexBuffer,O.indexBuffer,O.depthSegments,c.paint,p.transform.zoom)}}};class Iu{constructor(n,c,m,v,w,S){this.context=new jg(n,c),this.transform=m,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=w,this._timeStamp=o.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const C=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const M of C)this._debugParams.enabledLayers[M]=!0;w.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),w.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),w.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),w.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),w.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),w.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const M of C)w.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],M);this.occlusionParams=new fE(w),this.setup(),this.numSublayers=il.maxUnderzooming+il.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.eO,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new wp(this),this._wireframeDebugCache=new Aw,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const j=new o.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new o.T(this.context,j,n.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=v,this.worldview=S}updateTerrain(n,c){const m=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Pp(this,n));const v=this._terrain;this.transform.elevation=m?v:null,v.update(n,this.transform,c),this.transform.elevation&&!v.enabled&&(this.transform.elevation=null)}_updateFog(n){const c=n.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,v]=c.getFovAdjustedRange(this.transform._fov);if(m>v)return void(this.transform.fogCullDistSq=null);const w=m+.78*(v-m);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(n){n&&!this._terrain&&(this._terrain=new Pp(this,this.style)),this._forceTerrainMode=n}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(n,c){if(this.width=n*o.o.devicePixelRatio,this.height=c*o.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._mergedLayers[m].resize()}setup(){const n=this.context,c=new o.bc;c.emplaceBack(0,0),c.emplaceBack(o.al,0),c.emplaceBack(0,o.al),c.emplaceBack(o.al,o.al),this.tileExtentBuffer=n.createVertexBuffer(c,o.be.members),this.tileExtentSegments=o.bf.simpleSegment(0,0,4,2);const m=new o.bc;m.emplaceBack(0,0),m.emplaceBack(o.al,0),m.emplaceBack(0,o.al),m.emplaceBack(o.al,o.al),this.debugBuffer=n.createVertexBuffer(m,o.be.members),this.debugSegments=o.bf.simpleSegment(0,0,4,5);const v=new o.bc;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(v,o.be.members),this.viewportSegments=o.bf.simpleSegment(0,0,4,2);const w=new o.a$;w.emplaceBack(0,0,0,0),w.emplaceBack(o.al,0,o.al,0),w.emplaceBack(0,o.al,0,o.al),w.emplaceBack(o.al,o.al,o.al,o.al),this.mercatorBoundsBuffer=n.createVertexBuffer(w,o.bh.members),this.mercatorBoundsSegments=o.bf.simpleSegment(0,0,4,2);const S=new o.b0;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(S);const C=new o.bd;for(const M of[0,1,3,2,0])C.emplaceBack(M);this.debugIndexBuffer=n.createIndexBuffer(C),this.emptyTexture=new o.T(n,new o.q({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA8),this.identityMat=o.bB();const j=this.context.gl;this.stencilClearMode=new Kr({func:j.ALWAYS,mask:0},0,255,j.ZERO,j.ZERO,j.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,n.TRIANGLES,hr.disabled,this.stencilClearMode,un.disabled,qr.disabled,gd(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,c,m){if(!c||this.currentStencilSource===c.id||!n.isTileClipped()||!m||m.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(const j of m)if(this._tileClippingMaskIDs[j.key]===void 0){C=!0;break}if(!C)return}this.currentStencilSource=c.id;const v=this.context,w=v.gl;this.nextStencilID+m.length>256&&this.clearStencil(),v.setColorMode(un.disabled),v.setDepthMode(hr.disabled);const S=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of m){const j=c.getTile(C),M=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:D,tileBoundsIndexBuffer:B,tileBoundsSegments:O}=this.getTileBoundsBuffers(j);S.draw(this,w.TRIANGLES,hr.disabled,new Kr({func:w.ALWAYS,mask:0},M,255,w.KEEP,w.KEEP,w.REPLACE),un.disabled,qr.disabled,gd(C.projMatrix),"$clipping",D,B,O)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,c=this.context.gl;return new Kr({func:c.NOTEQUAL,mask:255},n,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const c=this.context.gl;return new Kr({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(n){const c=this.context.gl,m=n.sort((S,C)=>C.overscaledZ-S.overscaledZ),v=m[m.length-1].overscaledZ,w=m[0].overscaledZ-v+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const S={};for(let C=0;C<w;C++)S[C+v]=new Kr({func:c.GEQUAL,mask:255},C+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=w,[S,m]}return[{[v]:Kr.disabled},m]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new un([n.CONSTANT_COLOR,n.ONE,n.CONSTANT_COLOR,n.ONE],new o.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?un.unblended:un.alphaBlended}colorModeForDrapableLayerRenderPass(n){const c=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new un([c.ONE,c.ONE_MINUS_SRC_ALPHA,c.CONSTANT_ALPHA,c.ONE_MINUS_SRC_ALPHA],new o.ao(0,0,0,n===void 0?0:n),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(n,c,m,v=!1){if(this.depthOcclusion)return new hr(this.context.gl.GREATER,hr.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!v)return hr.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new hr(m||this.context.gl.LEQUAL,c,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const n=this.context.gl,c=Math.ceil(this.width),m=Math.ceil(this.height),v=this.context.bindFramebuffer.get(),w=n.getParameter(n.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===c&&this.depthFBO.height===m||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),c!==0&&m!==0&&(this.depthFBO=new Ag(this.context,c,m,!1,"texture"),this.depthTexture=new o.T(this.context,{width:c,height:m,data:null},n.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(v),n.bindTexture(n.TEXTURE_2D,w),this.depthFBO&&(n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),n.blitFramebuffer(0,0,c,m,0,0,c,m,n.DEPTH_BUFFER_BIT,n.NEAREST),n.bindFramebuffer(n.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((n,c)=>n+c/this._fpsHistory.length,0))}render(n,c){const m=o.o.now();this._dt=m-this._timeStamp,this._timeStamp=m,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=n.map.repaint,this.style=n,this.options=c;const v=this.style._mergedLayers,w=!(!this.terrain||!this.terrain.enabled),S=()=>this.style._getOrder(w).filter(Ye=>{const Oe=v[Ye];return!(Oe.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Oe.type]});let C=S(),j=!1,M=!1,D=null;for(const Ye of C){const Oe=v[Ye];Oe.type==="circle"?j=!0:Oe.type==="building"?D=Oe:Oe.type==="symbol"&&(Oe.hasOcclusionOpacityProperties?M=!0:j=!0)}let B=C.map(Ye=>v[Ye]);const O=this.style._mergedSourceCaches;this.imageManager=n.imageManager,this.modelManager=n.modelManager,this.symbolFadeChange=n.placement.symbolFadeChange(o.o.now()),this.imageManager.beginFrame();let G=0,X=!1;for(const Ye in O){const Oe=O[Ye];Oe.used&&(Oe.prepare(this.context),Oe.getSource().usedInConflation&&++G)}let ee=!1;for(const Ye of B)Ye.isHidden(this.transform.zoom)||(Ye.type==="clip"&&(ee=!0),this.prepareLayer(Ye));const oe={},ie={},ce={},me={},de={};for(const Ye in O){const Oe=O[Ye];oe[Ye]=Oe.getVisibleCoordinates(),ie[Ye]=oe[Ye].slice().reverse(),ce[Ye]=Oe.getVisibleCoordinates(!0).reverse(),me[Ye]=Oe.getShadowCasterCoordinates(),de[Ye]=Oe.sortCoordinatesByDistance(oe[Ye])}const Ee=Ye=>{const Oe=this.style.getLayerSourceCache(Ye);return Oe&&Oe.used?Oe.getSource():null};if(G||ee||this._clippingActiveLastFrame){const Ye=[],Oe=[];let mt=0;for(const et of B)this.isSourceForClippingOrConflation(et,Ee(et))&&(Ye.push(et),Oe.push(mt)),mt++;if(Ye&&(ee||Ye.length>1)||this._clippingActiveLastFrame){ee=!1;const et=[];for(let Et=0;Et<Ye.length;Et++){const $t=Ye[Et],lr=Oe[Et],Mt=this.style.getLayerSourceCache($t);if(!Mt||!Mt.used||!Mt.getSource().usedInConflation&&$t.type!=="clip"&&$t.type!=="building")continue;let zt=o.eP,ur=o.bZ.None;const nr=[];let er=!0;if($t.type==="building")zt=o.eR;else if($t.type==="clip"){zt=lr;for(const ir of $t.layout.get("clip-layer-types"))ur|=ir==="model"?o.bZ.Model:ir==="symbol"?o.bZ.Symbol:o.bZ.FillExtrusion;for(const ir of $t.layout.get("clip-layer-scope"))nr.push(ir);$t.isHidden(this.transform.zoom)?er=!1:ee=!0}er&&et.push({layer:$t.fqid,cache:Mt,order:zt,clipMask:ur,clipScope:nr})}this.replacementSource.setSources(et),X=!0}}this._clippingActiveLastFrame=ee,X||this.replacementSource.clear(),this.conflationActive=X,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Ye=0;Ye<B.length;Ye++){const Oe=B[Ye],mt=Oe.cutoffRange();if(this.longestCutoffRange=Math.max(mt,this.longestCutoffRange),mt>0){const et=Ee(Oe);et&&(this.minCutoffZoom=Math.max(et.minzoom,this.minCutoffZoom)),Oe.minzoom&&(this.minCutoffZoom=Math.max(Oe.minzoom,this.minCutoffZoom))}Oe.is3D(w)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Ye),this._lastOcclusionLayer=Ye)}const ge=this.style&&this.style.fog;ge?(this._fogVisible=ge.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=ge.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ce),this.opaquePassCutoff=0,C=S(),B=C.map(Ye=>v[Ye]));const je=this._shadowRenderer;if(je){je.updateShadowParameters(this.transform,this.style.directionalLight);for(const Ye in O)for(const Oe of oe[Ye]){let mt={min:0,max:0};this.terrain&&(mt=this.terrain.getMinMaxForTile(Oe)||mt),je.addShadowReceiver(Oe.toUnwrapped(),mt.min,mt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.eQ(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new is(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Se=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),ve=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Se&&!this._snow&&(this._snow=new Qv(this)),!Se&&this._snow&&(this._snow.destroy(),delete this._snow),ve&&!this._rain&&(this._rain=new Ph(this)),!ve&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),D){this.buildingTileBorderManager||(this.buildingTileBorderManager=new He);const Ye=this.style.getLayerSourceCache(D);this.buildingTileBorderManager.updateBorders(Ye,D)}if(!hn.has(this.context.gl))return;this.renderPass="offscreen";for(const Ye of B){const Oe=n.getLayerSourceCache(Ye);if(!Ye.hasOffscreenPass()||Ye.isHidden(this.transform.zoom))continue;const mt=Oe?ie[Oe.id]:void 0;(Ye.type==="custom"||Ye.type==="raster"||Ye.type==="raster-particle"||Ye.isSky()||mt&&mt.length)&&this.renderLayer(this,Oe,Ye,mt)}this.depthRangeFor3D=[0,1-(B.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,me)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ie=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),$e=(()=>{if(c.showOverdrawInspector)return o.ao.black;const Ye=this.style.fog;if(Ye&&this.transform.projection.supportsFog){const Oe=this.style.getLut(Ye.scope);if(!Ie){const mt=Ye.properties.get("color-use-theme")==="none",et=Ye.properties.get("color").toNonPremultipliedRenderColor(mt?null:Oe).toArray01();return new o.ao(...et)}if(Ie){const mt=Ye.properties.get("space-color-use-theme")==="none",et=Ye.properties.get("space-color").toNonPremultipliedRenderColor(mt?null:Oe).toArray01();return new o.ao(...et)}}return o.ao.transparent})();if(this.context.clear({color:$e,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ie&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=C.length-1;this.currentLayer>=0;this.currentLayer--){const Ye=B[this.currentLayer],Oe=n.getLayerSourceCache(Ye);if(Ye.isSky())continue;const mt=Oe?(Ye.is3D(w)?de:ie)[Oe.id]:void 0;this._renderTileClippingMasks(Ye,Oe,mt),this.renderLayer(this,Oe,Ye,mt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ie&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<C.length;this.currentLayer++){const Ye=B[this.currentLayer],Oe=n.getLayerSourceCache(Ye);Ye.isSky()&&this.renderLayer(this,Oe,Ye,Oe?ie[Oe.id]:void 0)}function Fe(Ye,Oe){let mt;return Oe&&(mt=(Ye.type==="symbol"?ce:Ye.is3D(w)?de:ie)[Oe.id]),mt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<C.length;){const Ye=B[this.currentLayer];if(Ye.type==="raster"||Ye.type==="raster-particle"){const Oe=n.getLayerSourceCache(Ye);this.renderLayer(this,Oe,Ye,Fe(Ye,Oe))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let at=0;je&&(at=je.getShadowCastingLayerCount());let Qe=!1,pt=-1;for(let Ye=0;Ye<C.length;++Ye){const Oe=B[Ye];Oe.isHidden(this.transform.zoom)||Oe.is3D(w)&&(pt=Ye)}M&&pt===-1&&(j=!0);let Ot=!1;for(;this.currentLayer<C.length;){const Ye=B[this.currentLayer],Oe=n.getLayerSourceCache(Ye);if(Ye.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Ye)){if(Ye.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Ot&&Ye.is3D(w)&&!w){const mt=this.currentLayer,et=Et=>{for(this.currentLayer=0;this.currentLayer<B.length;this.currentLayer++){const $t=B[this.currentLayer];if(zg[$t.type]){const lr=this.style.getLayerSourceCache($t);zg[$t.type](this,lr,$t,Fe($t,lr),Et)}}};et("initialize"),et("reset"),this.currentLayer=mt,Ot=!0}if(j&&!Qe&&this.terrain&&!this.transform.isOrthographic&&(Qe=!0,this.blitDepth()),M&&pt!==-1&&this.currentLayer===pt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Ye,Oe,Oe?oe[Oe.id]:void 0),this.renderLayer(this,Oe,Ye,Fe(Ye,Oe)),!this.terrain&&je&&at>0&&Ye.hasShadowPass()&&--at==0){{this.clearStencil(),this.resetStencilClippingMasks();const mt=this.currentLayer;for(this.currentLayer=0;this.currentLayer<B.length;this.currentLayer++){const et=B[this.currentLayer];if(Na[et.type]){const Et=this.style.getLayerSourceCache(et);Na[et.type](this,Et,et,Fe(et,Et))}}this.currentLayer=mt}if(je.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const mt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=mt;this.currentLayer++){const et=B[this.currentLayer];if(!et.hasLightBeamPass())continue;const Et=n.getLayerSourceCache(et);this.renderLayer(this,Et,et,Et?ie[Et.id]:void 0)}this.currentLayer=mt,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const mt=this.currentLayer;this.depthOcclusion=!0;for(const et of this.layersWithOcclusionOpacity){this.currentLayer=et;const Et=B[this.currentLayer],$t=n.getLayerSourceCache(Et),lr=$t?ie[$t.id]:void 0;this.terrain||this._renderTileClippingMasks(Et,$t,$t?oe[$t.id]:void 0),this.renderLayer(this,$t,Et,lr)}this.depthOcclusion=!1,this.currentLayer=mt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Ye=null;B.forEach(Oe=>{const mt=n.getLayerSourceCache(Oe);mt&&!Oe.isHidden(this.transform.zoom)&&mt.getVisibleCoordinates().length&&(!Ye||Ye.getSource().maxzoom<mt.getSource().maxzoom)&&(Ye=mt)}),Ye&&this.options.showTileBoundaries&&Wv(this,Ye,Ye.getVisibleCoordinates(),o.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Wv(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Ye){const Oe=Ye.transform.padding;Ai(Ye,Ye.transform.height-(Oe.top||0),3,ju),Ai(Ye,Oe.bottom||0,3,xw),Op(Ye,Oe.left||0,3,qv),Op(Ye,Ye.transform.width-(Oe.right||0),3,Gv);const mt=Ye.transform.centerPoint;(function(et,Et,$t,lr){Eh(et,Et-1,$t-10,2,20,lr),Eh(et,Et-10,$t-1,20,2,lr)})(Ye,mt.x,Ye.transform.height-mt.y,Hv)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),X||(this.conflationActive=!1)}prepareLayer(n){this.gpuTimingStart(n);const{unsupportedLayers:c}=this.transform.projection,m=!c||!c.includes(n.type);if(Lg[n.type]&&(m||this.terrain&&n.type==="custom")){const v=this.style.getLayerSourceCache(n);Lg[n.type](n,v,this)}this.gpuTimingEnd()}renderLayer(n,c,m,v){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="sky"||m.type==="custom"||m.type==="model"||m.type==="raster"||m.type==="raster-particle"||v&&v.length)&&(this.id=m.id,this.gpuTimingStart(m),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(m.type)&&(!n.terrain||m.type!=="custom")||m.type==="clip"||ex[m.type](n,c,m,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery,m=this.context.gl;let v=this.gpuTimers[n.id];v||(v=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:m.createQuery()}),v.calls++,m.beginQuery(c.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,c=this.context.gl,m=c.createQuery();this.deferredRenderGpuTimeQueries.push(m),c.beginQuery(n.TIME_ELAPSED_EXT,m)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const c={};for(const m in n){const v=n[m],w=this.context.extTimerQuery,S=w.getQueryParameter(v.query,this.context.gl.QUERY_RESULT)/1e6;w.deleteQueryEXT(v.query),c[m]=S}return c}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.gl;let m=0;for(const v of n)m+=c.getQueryParameter(v,c.QUERY_RESULT)/1e6,c.deleteQuery(v);return m}translatePosMatrix(n,c,m,v,w){if(!m[0]&&!m[1])return n;const S=w?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(S){const M=Math.sin(S),D=Math.cos(S);m=[m[0]*D-m[1]*M,m[0]*M+m[1]*D]}const C=[w?m[0]:o.ay(c,m[0],this.transform.zoom),w?m[1]:o.ay(c,m[1],this.transform.zoom),0],j=new Float32Array(16);return o.bq(j,n,C),j}saveTileTexture(n){if(n.context!==this.context)return;const c=n.size[0],m=this._tileTextures[c];m?m.push(n):this._tileTextures[c]=[n]}getTileTexture(n){const c=this._tileTextures[n];return c&&c.length>0?c.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(n,c,m){const v=m===void 0?this.terrain&&this.terrain.renderingToTexture:m,w=[];return this.style&&this.style.enable3dLights()&&(n==="globeRaster"||n==="terrainRaster"?(w.push("LIGHTING_3D_MODE"),w.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):v||w.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||w.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(w.push("TERRAIN"),this.linearFloatFilteringSupported()&&w.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&w.push("GLOBE"),!this._fogVisible||v||c!==void 0&&!c||w.push("FOG","FOG_DITHERING"),v&&w.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&w.push("OVERDRAW_INSPECTOR"),w}getOrCreateProgram(n,c){this.cache=this.cache||{};const m=c&&c.defines||[],v=c&&c.config,w=this.currentGlobalDefines(n,c&&c.overrideFog,c&&c.overrideRtt).concat(m),S=Rp.cacheKey(og[n],n,w,v);return this.cache[S]||(this.cache[S]=new Rp(this.context,n,og[n],v,lE[n],w)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(n,c){if(this.style.enable3dLights()){const m=this.style.directionalLight,v=this.style.ambientLight;if(m&&v){const w=((S,C,j)=>{const M=S.properties.get("direction"),D=S.properties.get("color-use-theme")==="none",B=S.properties.get("color").toNonPremultipliedRenderColor(D?null:j.getLut(S.scope)).toArray01(),O=S.properties.get("intensity"),G=C.properties.get("color-use-theme")==="none",X=C.properties.get("color").toNonPremultipliedRenderColor(G?null:j.getLut(C.scope)).toArray01(),ee=C.properties.get("intensity"),oe=[M.x,M.y,M.z],ie=o.dM(X,ee),ce=o.dM(B,O);return{u_lighting_ambient_color:ie,u_lighting_directional_dir:oe,u_lighting_directional_color:ce,u_ground_radiance:jv(oe,ce,ie)}})(m,v,this.style);c.setLightsUniformValues(n,w)}}}uploadCommonUniforms(n,c,m,v,w){if(this.uploadCommonLightUniforms(n,c),this.terrain&&this.terrain.renderingToTexture)return;const S=this.style.fog;if(S){const C=S.getOpacity(this.transform.pitch),j=((M,D,B,O,G,X,ee,oe,ie,ce,me,de)=>{const Ee=M.transform,ge=D.properties.get("color-use-theme")==="none",je=D.properties.get("color").toNonPremultipliedRenderColor(ge?null:M.style.getLut(D.scope)).toArray01();je[3]=O;const Se=M.frameCounter/1e3%1,[ve,Ie]=D.properties.get("vertical-range");return{u_fog_matrix:B?Ee.calculateFogTileMatrix(B):de||M.identityMat,u_fog_range:D.getFovAdjustedRange(Ee._fov),u_fog_color:je,u_fog_horizon_blend:D.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ve,Ie),Ie],u_fog_temporal_offset:Se,u_frustum_tl:G,u_frustum_tr:X,u_frustum_br:ee,u_frustum_bl:oe,u_globe_pos:ie,u_globe_radius:ce,u_viewport:me,u_globe_transition:o.aj(Ee.zoom),u_is_globe:+(Ee.projection.name==="globe")}})(this,S,m,C,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.o.devicePixelRatio,this.transform.height*o.o.devicePixelRatio],v);c.setFogUniformValues(n,j)}w&&c.setCutoffUniformValues(n,w.uniformValues)}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,c=n.createTexture();return n.bindTexture(n.TEXTURE_2D,c),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,c=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const v of m)c[v.key]=n[v.key]||new tc(v,512,this.transform.tileZoom,this,void 0,this.worldview);return c}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(n,c){return!(!n.is3D(!(!this.terrain||!this.terrain.enabled))||n.type!=="clip"&&n.type!=="building"&&(n.minzoom&&n.minzoom>this.transform.zoom||(this.style._clipLayerPresent||n.sourceLayer!=="building"&&n.sourceLayer!=="procedural_buildings")&&(!c||c.type!=="batched-model")))}isTileAffectedByFog(n){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let c=this._cachedTileFogOpacities[n.key];return c||(this._cachedTileFogOpacities[n.key]=c=this.style.fog.getOpacityForTile(n)),c[0]>=tt||c[1]>=tt}setupDepthForOcclusion(n,c,m){const v=this.context,w=v.gl,S=!!m;var C;m||(m={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),v.activeTexture.set(w.TEXTURE3),n&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),m.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],m.u_depth_range_unpack=[2/((C=this.depthRangeFor3D)[1]-C[0]),-1-2*C[0]/(C[1]-C[0])],m.u_occluder_half_size=.5*this.occlusionParams.occluderSize,m.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),v.activeTexture.set(w.TEXTURE0),S||c.setTerrainUniformValues(v,m)}}function wd(p,n){let c=!1,m=null;const v=()=>{m=null,c&&(p(),m=setTimeout(v,n),c=!1)};return()=>(c=!0,m||v(),m)}class Fg{constructor(n){this._hashName=n&&encodeURIComponent(n),o.aX(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=wd(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const c=Bg(n);if(this._hashName){const m=this._hashName;let v=!1;const w=location.hash.slice(1).split("&").map(S=>{const C=S.split("=")[0];return C===m?(v=!0,`${C}=${c}`):S}).filter(S=>S);return v||w.push(`${m}=${c}`),`#${w.join("&")}`}return`#${c}`}_getCurrentHash(){const n=location.hash.replace("#","");if(this._hashName){let c;return n.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(c=m)}),(c&&c[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(m=>isNaN(Number(m)))){const m=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(c[3]||0):n.getBearing();return n.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:m,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Bg(p,n){const c=p.getCenter(),m=Math.round(100*p.getZoom())/100,v=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,v),S=Math.round(c.lng*w)/w,C=Math.round(c.lat*w)/w,j=p.getBearing(),M=p.getPitch();let D=n?`/${S}/${C}/${m}`:`${m}/${C}/${S}`;return(j||M)&&(D+="/"+Math.round(10*j)/10),M&&(D+=`/${Math.round(M)}`),D}const Rh={linearity:.3,easing:o.eS(0,0,.3,1)},ku=Object.assign({deceleration:2500,maxSpeed:1400},Rh),tx=Object.assign({deceleration:20,maxSpeed:1400},Rh),dl=Object.assign({deceleration:1e3,maxSpeed:360},Rh),rx=Object.assign({deceleration:1e3,maxSpeed:90},Rh);class Vg{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.o.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,c=o.o.now();for(;n.length>0&&c-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const c={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)c.zoom+=w.zoomDelta||0,c.bearing+=w.bearingDelta||0,c.pitch+=w.pitchDelta||0,w.panDelta&&c.pan._add(w.panDelta),w.around&&(c.around=w.around),w.pinchAround&&(c.pinchAround=w.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(c.pan.mag()){const w=Nh(c.pan.mag(),m,Object.assign({},ku,n||{}));v.offset=c.pan.mult(w.amount/c.pan.mag()),v.center=this._map.transform.center,Mh(v,w)}if(c.zoom){const w=Nh(c.zoom,m,tx);v.zoom=this._map.transform.zoom+w.amount,Mh(v,w)}if(c.bearing){const w=Nh(c.bearing,m,dl);v.bearing=this._map.transform.bearing+o.aA(w.amount,-179,179),Mh(v,w)}if(c.pitch){const w=Nh(c.pitch,m,rx);v.pitch=this._map.transform.pitch+w.amount,Mh(v,w)}if(v.zoom||v.bearing){const w=c.pinchAround===void 0?c.around:c.pinchAround;v.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function Mh(p,n){(!p.duration||p.duration<n.duration)&&(p.duration=n.duration,p.easing=n.easing)}function Nh(p,n,c){const{maxSpeed:m,linearity:v,deceleration:w}=c,S=o.aA(p*v/(n/1e3),-m,m),C=Math.abs(S)/(w*v);return{easing:c.easing,duration:1e3*C,amount:S*(C/2)}}class Ui extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,m,v={}){const w=Ze(c.getCanvasContainer(),m),S=c.unproject(w);super(n,Object.assign({point:w,lngLat:S,originalEvent:m},v)),this._defaultPrevented=!1,this.target=c}}class Dh extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,m){const v=n==="touchend"?m.changedTouches:m.touches,w=Xe(c.getCanvasContainer(),v),S=w.map(j=>c.unproject(j)),C=w.reduce((j,M,D,B)=>j.add(M.div(B.length)),new o.P(0,0));super(n,{points:w,point:C,lngLats:S,lngLat:c.unproject(C),originalEvent:m}),this._defaultPrevented=!1}}class nx extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c){super("wheel",{originalEvent:c}),this._defaultPrevented=!1}}class ix{constructor(n,c){this._map=n,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new nx(this._map,n))}mousedown(n,c){return this._mousedownPos=c,this._firePreventable(new Ui(n.type,this._map,n))}mouseup(n){this._map.fire(new Ui(n.type,this._map,n))}preclick(n){const c=new MouseEvent("preclick",n);this._map.fire(new Ui(c.type,this._map,c))}click(n,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(n),this._map.fire(new Ui(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new Ui(n.type,this._map,n))}mouseover(n){this._map.fire(new Ui(n.type,this._map,n))}mouseout(n){this._map.fire(new Ui(n.type,this._map,n))}touchstart(n){return this._firePreventable(new Dh(n.type,this._map,n))}touchmove(n){this._map.fire(new Dh(n.type,this._map,n))}touchend(n){this._map.fire(new Dh(n.type,this._map,n))}touchcancel(n){this._map.fire(new Dh(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Sd{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new Ui(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ui("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new Ui(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class sx{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,c){this.isEnabled()&&n.shiftKey&&n.button===0&&(ne(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(n,c){if(!this._active)return;const m=c,v=this._startPos,w=this._lastPos;if(!v||!w||w.equals(m)||!this._box&&m.dist(v)<this._clickTolerance)return;this._lastPos=m,this._box||(this._box=q("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const S=Math.min(v.x,m.x),C=Math.max(v.x,m.x),j=Math.min(v.y,m.y),M=Math.max(v.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${S}px,${j}px)`,this._box.style.width=C-S+"px",this._box.style.height=M-j+"px")})}mouseupWindow(n,c){if(!this._active)return;const m=this._startPos,v=c;if(m&&n.button===0){if(this.reset(),Ae(),m.x!==v.x||m.y!==v.y)return this._map.fire(new o.z("boxzoomend",{originalEvent:n})),{cameraAnimation:w=>w.fitScreenCoordinates(m,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),le(),delete this._startPos,delete this._lastPos}_fireEvent(n,c){return this._map.fire(new o.z(n,{originalEvent:c}))}}function Fp(p,n){const c={};for(let m=0;m<p.length;m++)c[p[m].identifier]=n[m];return c}class ox{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,c,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),m.length===this.numTouches&&(this.centroid=function(v){const w=new o.P(0,0);for(const S of v)w._add(S);return w.div(v.length)}(c),this.touches=Fp(m,c)))}touchmove(n,c,m){if(this.aborted||!this.centroid)return;const v=Fp(m,c);for(const w in this.touches){const S=v[w];(!S||S.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(n,c,m){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Pu{constructor(n){this.singleTap=new ox(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,c,m){this.singleTap.touchstart(n,c,m)}touchmove(n,c,m){this.singleTap.touchmove(n,c,m)}touchend(n,c,m){const v=this.singleTap.touchend(n,c,m);if(v){const w=n.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(v)<30;if(w&&S||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class ax{constructor(){this._zoomIn=new Pu({numTouches:1,numTaps:2}),this._zoomOut=new Pu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,c,m){this._zoomIn.touchstart(n,c,m),this._zoomOut.touchstart(n,c,m)}touchmove(n,c,m){this._zoomIn.touchmove(n,c,m),this._zoomOut.touchmove(n,c,m)}touchend(n,c,m){const v=this._zoomIn.touchend(n,c,m),w=this._zoomOut.touchend(n,c,m);return v?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(v)},{originalEvent:n})}):w?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(w)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ug={0:1,2:2},$g={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Oh{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,c){return!1}_move(n,c){return{}}mousedown(n,c){if(this._lastPoint)return;const m=Je(n);this._correctButton(n,m)&&(this._lastPoint=c,this._eventButton=m)}mousemoveWindow(n,c){const m=this._lastPoint;if(m){if(n.preventDefault(),this._eventButton!=null&&function(v,w){const S=Ug[w];return v.buttons===void 0||(v.buttons&S)!==S}(n,this._eventButton))this.reset();else if(this._moved||!(c.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(m,c)}}mouseupWindow(n){this._lastPoint&&Je(n)===this._eventButton&&(this._moved&&Ae(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class lx extends Oh{mousedown(n,c){super.mousedown(n,c),this._lastPoint&&(this._active=!0)}_correctButton(n,c){return c===0&&!n.ctrlKey}_move(n,c){return{around:c,panDelta:c.sub(n)}}}class qg extends Oh{constructor(n){super(n),this._pitchRotateKey=n.pitchRotateKey?$g[n.pitchRotateKey]:void 0}_correctButton(n,c){return this._pitchRotateKey?c===0&&n[this._pitchRotateKey]:c===0&&n.ctrlKey||c===2}_move(n,c){const m=.8*(c.x-n.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(n){this._pitchRotateKey||n.preventDefault()}}class cx extends Oh{constructor(n){super(n),this._pitchRotateKey=n.pitchRotateKey?$g[n.pitchRotateKey]:void 0}_correctButton(n,c){return this._pitchRotateKey?c===0&&n[this._pitchRotateKey]:c===0&&n.ctrlKey||c===2}_move(n,c){const m=-.5*(c.y-n.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(n){this._pitchRotateKey||n.preventDefault()}}class Iw{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),o.aX(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(n,c,m){return this._calculateTransform(n,c,m)}touchmove(n,c,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(m.length===1&&!o.eT())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,c,m)}}touchend(n,c,m){this._calculateTransform(n,c,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,c,m){m.length>0&&(this._active=!0);const v=Fp(m,c),w=new o.P(0,0),S=new o.P(0,0);let C=0;for(const M in v){const D=v[M],B=this._touches[M];B&&(w._add(D),S._add(D.sub(B)),C++,v[M]=D)}if(this._touches=v,C<this._minTouches||!S.mag())return;const j=S.div(C);return this._sum._add(j),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(C),panDelta:j}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=q("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Gg{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,c,m){return{}}touchstart(n,c,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([c[0],c[1]]))}touchmove(n,c,m){const v=this._firstTwoTouches;if(!v)return;n.preventDefault();const[w,S]=v,C=Bp(m,c,w),j=Bp(m,c,S);if(!C||!j)return;const M=this._aroundCenter?null:C.add(j).div(2);return this._move([C,j],M,n)}touchend(n,c,m){if(!this._firstTwoTouches)return;const[v,w]=this._firstTwoTouches,S=Bp(m,c,v),C=Bp(m,c,w);S&&C||(this._active&&Ae(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Bp(p,n,c){for(let m=0;m<p.length;m++)if(p[m].identifier===c)return n[m]}function ux(p,n){return Math.log2(p/n)}class kw extends Gg{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,c){const m=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(ux(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ux(this._distance,m),pinchAround:c}}}function dx(p,n){return 180*p.angleWith(n)/Math.PI}class Pw extends Gg{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,c){const m=this._vector;if(this._vector=n[0].sub(n[1]),m&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:dx(this._vector,m),pinchAround:c}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const c=25/(Math.PI*this._minDiameter)*360,m=this._startVector;if(!m)return!1;const v=dx(n,m);return Math.abs(v)<c}}function Hg(p){return Math.abs(p.y)>Math.abs(p.x)}class Rw extends Gg{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,Hg(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,c,m){const v=this._lastPoints;if(!v)return;const w=n[0].sub(v[0]),S=n[1].sub(v[1]);return this._map._cooperativeGestures&&!o.eT()&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(w,S,m.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(w.y+S.y)/2*-.5})}gestureBeginsVertically(n,c,m){if(this._valid!==void 0)return this._valid;const v=n.mag()>=2,w=c.mag()>=2;if(!v&&!w)return;if(!v||!w)return this._firstMove==null&&(this._firstMove=m),m-this._firstMove<100&&void 0;const S=n.y>0==c.y>0;return Hg(n)&&Hg(c)&&S}}const Mw={panStep:100,bearingStep:15,pitchStep:10};class Nw{constructor(){const n=Mw;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let c=0,m=0,v=0,w=0,S=0;switch(n.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:n.shiftKey?m=-1:(n.preventDefault(),w=-1);break;case 39:n.shiftKey?m=1:(n.preventDefault(),w=1);break;case 38:n.shiftKey?v=1:(n.preventDefault(),S=-1);break;case 40:n.shiftKey?v=-1:(n.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(m=0,v=0),{cameraAnimation:C=>{const j=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:Dw,zoom:c?Math.round(j)+c*(n.shiftKey?2:1):j,bearing:C.getBearing()+m*this._bearingStep,pitch:C.getPitch()+v*this._pitchStep,offset:[-w*this._panStep,-S*this._panStep],center:C.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Dw(p){return p*(2-p)}const Ow=4.000244140625,gE=1/450;class _E{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._handler=c,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=gE,o.aX(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||o.eT()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const m=o.o.now(),v=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,c!==0&&c%Ow==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=c,this._timeout=window.setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(v*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),n.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=n,this._delta-=c,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=Ze(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>Ow?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&D!==0&&(D=1/D);const B=c(),O=Math.pow(2,B),G=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):O;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(G*D))),this._type==="wheel"&&(this._startZoom=B,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const m=typeof this._targetZoom=="number"?this._targetZoom:c(),v=this._startZoom,w=this._easing;let S,C=!1;if(this._type==="wheel"&&v&&w){const M=Math.min((o.o.now()-this._lastWheelEventTime)/200,1),D=w(M);S=o.ak(v,m,D),M<1?this._frameId||(this._frameId=!0):C=!0}else S=m,C=!0;this._active=!0,C&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let j=S-c();return j*this._lastDelta<0&&(j=0),{noInertia:!0,needsRenderFrame:!C,zoomDelta:j,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let c=o.eU;if(this._prevEase){const m=this._prevEase,v=(o.o.now()-m.start)/m.duration,w=m.easing(v+.01)-m.easing(v),S=.27/Math.sqrt(w*w+1e-4)*.01,C=Math.sqrt(.0729-S*S);c=o.eS(S,C,.25,1)}return this._prevEase={start:o.o.now(),duration:n,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=q("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Zi{constructor(n,c){this._clickZoom=n,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Lw{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,c){return n.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(n.shiftKey?-1:1),around:m.unproject(c)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yE{constructor(){this._tap=new Pu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,c,m){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=c[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(n,c,m))}touchmove(n,c,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const v=c[0],w=v.y-this._swipePoint.y;return this._swipePoint=v,n.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(n,c,m)}touchend(n,c,m){this._tapTime?this._swipePoint&&m.length===0&&this.reset():this._tap.touchend(n,c,m)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vE{constructor(n,c,m){this._el=n,this._mousePan=c,this._touchPan=m}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class xE{constructor(n,c,m){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=c,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Vp{constructor(n,c,m,v){this._el=n,this._touchZoom=c,this._touchRotate=m,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Up=p=>p.zoom||p.drag||p.pitch||p.rotate;class hx extends o.z{}class Wg{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,c){const m=o.av([],c,n);this.radius=o.ag(m[2]<0?o.eW([],m,this.constants):[m[0],m[1],0])}projectRay(n){o.eW(n,n,this.constants),o.aw(n,n),o.eX(n,n,this.constants);const c=o.c4([],n,this.radius);if(c[2]>0){const m=o.c4([],[0,0,1],o.bI(c,[0,0,1])),v=o.c4([],o.aw([],[c[0],c[1],0]),this.radius),w=o.d7([],c,o.c4([],o.av([],o.d7([],v,m),c),2));c[0]=w[0],c[1]=w[1]}return c}}function hl(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class Zg{constructor(n,c){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Vg(n),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Wg,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),o.aX(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(const[v,w,S]of this._listeners){const C=v===document?this.handleWindowEvent:this.handleEvent;v.addEventListener(w,C,S)}}destroy(){for(const[n,c,m]of this._listeners){const v=n===document?this.handleWindowEvent:this.handleEvent;n.removeEventListener(c,v,m)}}_addDefaultHandlers(n){const c=this._map,m=c.getCanvasContainer();this._add("mapEvent",new ix(c,n));const v=c.boxZoom=new sx(c,n);this._add("boxZoom",v);const w=new ax,S=new Lw;c.doubleClickZoom=new Zi(S,w),this._add("tapZoom",w),this._add("clickZoom",S);const C=new yE;this._add("tapDragZoom",C);const j=c.touchPitch=new Rw(c);this._add("touchPitch",j);const M=new qg(n),D=new cx(n);c.dragRotate=new xE(n,M,D),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",D,["mouseRotate"]);const B=new lx(n),O=new Iw(c,n);c.dragPan=new vE(m,B,O),this._add("mousePan",B),this._add("touchPan",O,["touchZoom","touchRotate"]);const G=new Pw,X=new kw;c.touchZoomRotate=new Vp(m,X,G,C),this._add("touchRotate",G,["touchPan","touchZoom"]),this._add("touchZoom",X,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Sd(c));const ee=c.scrollZoom=new _E(c,this);this._add("scrollZoom",ee,["mousePan"]);const oe=c.keyboard=new Nw;this._add("keyboard",oe);for(const ie of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[ie]&&c[ie].enable(n[ie])}_add(n,c,m){this._handlers.push({handlerName:n,handler:c,allowed:m}),this._handlersById[n]=c}stop(n){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Up(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,c,m){for(const v in n)if(v!==m&&(!c||c.indexOf(v)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const c=[];for(const m of n)this._el.contains(m.target)&&c.push(m);return c}handleEvent(n,c){this._updatingCamera=!0;const m=n.type==="renderFrame",v=m?void 0:n,w={needsRenderFrame:!1},S={},C={},j=n.touches?this._getMapTouches(n.touches):void 0,M=j?Xe(this._el,j):m?void 0:Ze(this._el,n);for(const{handlerName:O,handler:G,allowed:X}of this._handlers){if(!G.isEnabled())continue;let ee;this._blockedByActive(C,X,O)?G.reset():G[c||n.type]&&(ee=G[c||n.type](n,M,j),this.mergeHandlerResult(w,S,ee,O,v),ee&&ee.needsRenderFrame&&this._triggerRenderFrame()),(ee||G.isActive())&&(C[O]=G)}const D={};for(const O in this._previousActiveHandlers)C[O]||(D[O]=v);this._previousActiveHandlers=C,(Object.keys(D).length||hl(w))&&(this._changes.push([w,S,D]),this._triggerRenderFrame()),(Object.keys(C).length||hl(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=w;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))}mergeHandlerResult(n,c,m,v,w){if(!m)return;Object.assign(n,m);const S={handlerName:v,originalEvent:m.originalEvent||w};m.zoomDelta!==void 0&&(c.zoom=S),m.panDelta!==void 0&&(c.drag=S),m.pitchDelta!==void 0&&(c.pitch=S),m.bearingDelta!==void 0&&(c.rotate=S)}_applyChanges(){const n={},c={},m={};for(const[v,w,S]of this._changes)v.panDelta&&(n.panDelta=(n.panDelta||new o.P(0,0))._add(v.panDelta)),v.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(n.around=v.around),v.aroundCoord!==void 0&&(n.aroundCoord=v.aroundCoord),v.pinchAround!==void 0&&(n.pinchAround=v.pinchAround),v.noInertia&&(n.noInertia=v.noInertia),Object.assign(c,w),Object.assign(m,S);this._updateMapTransform(n,c,m),this._changes=[]}_updateMapTransform(n,c,m){const v=this._map,w=v.transform,S=ce=>[ce.x,ce.y,ce.z];if((ce=>{const me=this._eventsInProgress.drag;return me&&!this._handlersById[me.handlerName].isActive()})()&&!hl(n)){const ce=w.zoom;w.cameraElevationReference="sea",this._originalZoom!=null&&w._orthographicProjectionAtLowPitch&&w.projection.name!=="globe"&&w.pitch===0?(w.cameraElevationReference="ground",w.zoom=this._originalZoom):(w.recenterOnTerrain(),w.cameraElevationReference="ground"),ce!==w.zoom&&this._map._update(!0)}if(w._isCameraConstrained&&v._stop(!0),!hl(n))return void this._fireEvents(c,m,!0);let{panDelta:C,zoomDelta:j,bearingDelta:M,pitchDelta:D,around:B,aroundCoord:O,pinchAround:G}=n;w._isCameraConstrained&&(j>0&&(j=0),w._isCameraConstrained=!1),G!==void 0&&(B=G),(j||(ce=>c[ce]&&!this._eventsInProgress[ce])("drag"))&&B&&(this._dragOrigin=S(w.pointCoordinate3D(B)),this._originalZoom=w.zoom,this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",v._stop(!0),B=B||v.transform.centerPoint,M&&(w.bearing+=M),D&&(w.pitch+=D),w._updateCameraState();const X=[0,0,0];if(C)if(w.projection.name==="mercator"){const ce=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(B).dir),me=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(B.sub(C)).dir);X[0]=me[0]-ce[0],X[1]=me[1]-ce[1]}else{const ce=w.pointCoordinate(B);if(w.projection.name==="globe"){C=C.rotate(-w.angle);const me=w._pixelsPerMercatorPixel/w.worldSize;X[0]=-C.x*o.eV(o.a_(ce.y))*me,X[1]=-C.y*o.eV(w.center.lat)*me}else{const me=w.pointCoordinate(B.sub(C));ce&&me&&(X[0]=me.x-ce.x,X[1]=me.y-ce.y)}}const ee=w.zoom,oe=[0,0,0];if(j){const ce=S(O||w.pointCoordinate3D(B)),me={dir:o.aw([],o.av([],ce,w._camera.position))};if(me.dir[2]<0){const de=w.zoomDeltaToMovement(ce,j);o.c4(oe,me.dir,de)}}const ie=o.d7(X,X,oe);w._translateCameraConstrained(ie),j&&Math.abs(w.zoom-ee)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(c,m,!0)}_fireEvents(n,c,m){const v=Up(this._eventsInProgress),w=Up(n),S={};for(const D in n){const{originalEvent:B}=n[D];this._eventsInProgress[D]||(S[`${D}start`]=B),this._eventsInProgress[D]=n[D]}!v&&w&&this._fireEvent("movestart",w.originalEvent);for(const D in S)this._fireEvent(D,S[D]);w&&this._fireEvent("move",w.originalEvent);for(const D in n){const{originalEvent:B}=n[D];this._fireEvent(D,B)}const C={};let j;for(const D in this._eventsInProgress){const{handlerName:B,originalEvent:O}=this._eventsInProgress[D];this._handlersById[B].isActive()||(delete this._eventsInProgress[D],j=c[B]||O,C[`${D}end`]=j)}for(const D in C)this._fireEvent(D,C[D]);const M=Up(this._eventsInProgress);if(m&&(v||w)&&!M){this._updatingCamera=!0;const D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=O=>O!==0&&-this._bearingSnap<O&&O<this._bearingSnap;D?(B(D.bearing||this._map.getBearing())&&(D.bearing=0),this._map.easeTo(D,{originalEvent:j})):(this._map.fire(new o.z("moveend",{originalEvent:j})),B(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,c){this._map.fire(new o.z(n,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new hx("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Ss="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class oc extends o.E{constructor(n,c){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=c.respectPrefersReducedMotion!==!1,o.aX(["_renderFrameCallback"],this)}getCenter(){return new o.aS(this.transform.center.lng,this.transform.center.lat)}setCenter(n,c){return this.jumpTo({center:n},c)}panBy(n,c,m){return n=o.P.convert(n).mult(-1),this.panTo(this.transform.center,Object.assign({offset:n},c),m)}panTo(n,c,m){return this.easeTo(Object.assign({center:n},c),m)}getZoom(){return this.transform.zoom}setZoom(n,c){return this.jumpTo({zoom:n},c),this}zoomTo(n,c,m){return this.easeTo(Object.assign({zoom:n},c),m)}zoomIn(n,c){return this.zoomTo(this.getZoom()+1,n,c),this}zoomOut(n,c){return this.zoomTo(this.getZoom()-1,n,c),this}getBearing(){return this.transform.bearing}setBearing(n,c){return this.jumpTo({bearing:n},c),this}getPadding(){return this.transform.padding}setPadding(n,c){return this.jumpTo({padding:n},c),this}rotateTo(n,c,m){return this.easeTo(Object.assign({bearing:n},c),m)}resetNorth(n,c){return this.rotateTo(0,Object.assign({duration:1e3},n),c),this}resetNorthPitch(n,c){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},n),c),this}snapToNorth(n,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,c):this}getPitch(){return this.transform.pitch}setPitch(n,c){return this.jumpTo({pitch:n},c),this}cameraForBounds(n,c){n=o.aI.convert(n);const m=c&&c.bearing||0,v=c&&c.pitch||0,w=n.getNorthWest(),S=n.getSouthEast();return this._cameraForBounds(this.transform,w,S,m,v,c)}_extendPadding(n){const c={top:0,right:0,bottom:0,left:0};return n==null?Object.assign({},c,this.transform.padding):typeof n=="number"?{top:n,bottom:n,right:n,left:n}:Object.assign({},c,n)}_extendCameraOptions(n){return(n=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=this._extendPadding(n.padding),n}_minimumAABBFrustumDistance(n,c){const m=c.max[0]-c.min[0],v=c.max[1]-c.min[1];return m/v>n.aspect?m/(2*Math.tan(.5*n.fovX)*n.aspect):v/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,c,m,v,w,S){const C=n.clone(),j=this._extendCameraOptions(S);C.bearing=v,C.pitch=w;const M=o.aS.convert(c),D=o.aS.convert(m),B=.5*(M.lat+D.lat),O=.5*(M.lng+D.lng),G=o.eY(B,O),X=o.aw([],G),ee=o.aw([],o.bH([],X,[0,1,0])),oe=o.bH([],ee,X),ie=[ee[0],ee[1],ee[2],0,oe[0],oe[1],oe[2],0,X[0],X[1],X[2],0,0,0,0,1],ce=[G,o.eY(M.lat,M.lng),o.eY(D.lat,M.lng),o.eY(D.lat,D.lng),o.eY(M.lat,D.lng),o.eY(B,M.lng),o.eY(B,D.lng),o.eY(M.lat,O),o.eY(D.lat,O)];let me=o.d8.fromPoints(ce.map(et=>[o.bI(ee,et),o.bI(oe,et),o.bI(X,et)]));const de=o.af([],me.center,ie);o.eZ(de)===0&&o.e_(de,0,0,1),o.aw(de,de),o.c4(de,de,o.aD),C.center=o.e$(de);const Ee=C.getWorldToCameraMatrix(),ge=o.bk(new Float64Array(16),Ee);me=o.d8.applyTransform(me,o.aB([],Ee,ie));const je=this._extendAABB(me,C,j,v);if(!je)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");me=je,o.af(de,de,Ee);const Se=.5*(me.max[2]-me.min[2]),ve=this._minimumAABBFrustumDistance(C,me),Ie=o.c4([],[0,0,1],Se),$e=o.d7(Ie,de,Ie),Fe=ve+(C.pitch===0?0:o.bF(de,$e)),at=C.globeCenterInViewSpace,Qe=o.av([],de,[at[0],at[1],at[2]]);o.aw(Qe,Qe),o.c4(Qe,Qe,Fe);const pt=o.d7([],de,Qe);o.af(pt,pt,ge);const Ot=o.eL/o.aD,Ye=o.ag(pt),Oe=o.ce(Math.max(Ye*Ot-o.eL,Number.EPSILON),0),mt=Math.min(C.zoomFromMercatorZAdjusted(Oe),j.maxZoom);return mt>.5*(o.cZ+o.cK)?(C.setProjection({name:"mercator"}),C.zoom=mt,this._cameraForBounds(C,c,m,v,w,S)):{center:C.center,zoom:mt,bearing:v,pitch:w}}_extendAABB(n,c,m,v){const w=.5*((m.padding.left||0)+(m.padding.right||0)),S=.5*((m.padding.top||0)+(m.padding.bottom||0)),C=S,j=w,M=w,D=S,B=c.width-(j+M),O=c.height-(C+D),G=o.av([],n.max,n.min),X=Math.min(B/G[0],O/G[1]),ee=Math.min(c.scaleZoom(c.scale*X),m.maxZoom);if(isNaN(ee))return null;const oe=c.scale/c.zoomScale(ee),ie=new o.d8([n.min[0]-j*oe,n.min[1]-D*oe,n.min[2]],[n.max[0]+M*oe,n.max[1]+C*oe,n.max[2]]),ce=(typeof m.offset.x=="number"&&typeof m.offset.y=="number"?new o.P(m.offset.x,m.offset.y):o.P.convert(m.offset)).rotate(-o.an(v));return ie.center[0]-=ce.x*oe,ie.center[1]+=ce.y*oe,ie}queryTerrainElevation(n,c){const m=this.transform.elevation;return m?(c=Object.assign({},{exaggerated:!0},c),m.getAtPoint(o.ae.fromLngLat(n),null,c.exaggerated)):null}_cameraForBounds(n,c,m,v,w,S){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,c,m,v,w,S);const C=n.clone(),j=this._extendCameraOptions(S);C.bearing=v,C.pitch=w;const M=o.aS.convert(c),D=o.aS.convert(m),B=new o.aS(M.lng,D.lat),O=new o.aS(D.lng,M.lat),G=C.project(M),X=C.project(D),ee=this.queryTerrainElevation(M),oe=this.queryTerrainElevation(D),ie=this.queryTerrainElevation(B),ce=this.queryTerrainElevation(O),me=[[G.x,G.y,Math.min(ee||0,oe||0,ie||0,ce||0)],[X.x,X.y,Math.max(ee||0,oe||0,ie||0,ce||0)]];let de=o.d8.fromPoints(me);const Ee=C.getWorldToCameraMatrix(),ge=o.bk(new Float64Array(16),Ee);de=o.d8.applyTransform(de,Ee);const je=this._extendAABB(de,C,j,v);if(!je)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");de=je;const Se=.5*o.av([],de.max,de.min)[2],ve=this._minimumAABBFrustumDistance(C,de),Ie=[0,0,1,0];o.aC(Ie,Ie,Ee),o.f0(Ie,Ie);const $e=o.c4([],Ie,ve+Se),Fe=o.d7([],de.center,$e);o.af(de.center,de.center,ge),o.af(Fe,Fe,ge);const at=C.unproject(new o.P(de.center[0],de.center[1])),Qe=o.f1(C.projection,at),pt=Math.pow(2,Qe),Ot=Math.min(C._zoomFromMercatorZ(Fe[2]*C.pixelsPerMeter*pt/C.worldSize),j.maxZoom);return C.mercatorFromTransition&&Ot<.5*(o.cZ+o.cK)?(C.setProjection({name:"globe"}),C.zoom=Ot,this._cameraForBounds(C,c,m,v,w,S)):{center:at,zoom:Ot,bearing:v,pitch:w}}fitBounds(n,c,m){const v=this.cameraForBounds(n,c);return this._fitInternal(v,c,m)}fitScreenCoordinates(n,c,m,v,w){const S=o.P.convert(n),C=o.P.convert(c),j=new o.P(Math.min(S.x,C.x),Math.min(S.y,C.y)),M=new o.P(Math.max(S.x,C.x),Math.max(S.y,C.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(S,C))return this;const D=this.transform.pointLocation3D(j),B=this.transform.pointLocation3D(M),O=this.transform.pointLocation3D(new o.P(j.x,M.y)),G=this.transform.pointLocation3D(new o.P(M.x,j.y)),X=[Math.min(D.lng,B.lng,O.lng,G.lng),Math.min(D.lat,B.lat,O.lat,G.lat)],ee=[Math.max(D.lng,B.lng,O.lng,G.lng),Math.max(D.lat,B.lat,O.lat,G.lat)],oe=v&&v.pitch?v.pitch:this.getPitch(),ie=this._cameraForBounds(this.transform,X,ee,m,oe,v);return this._fitInternal(ie,v,w)}_fitInternal(n,c,m){return n?(c=Object.assign(n,c)).linear?this.easeTo(c,m):this.flyTo(c,m):this}jumpTo(n,c){this.stop();const m=n.preloadOnly?this.transform.clone():this.transform;let v=!1,w=!1,S=!1;"zoom"in n&&m.zoom!==+n.zoom&&(v=!0,m.zoom=+n.zoom),n.center!==void 0&&(m.center=o.aS.convert(n.center)),"bearing"in n&&m.bearing!==+n.bearing&&(w=!0,m.bearing=+n.bearing),"pitch"in n&&m.pitch!==+n.pitch&&(S=!0,m.pitch=+n.pitch);const C=typeof n.padding=="number"?this._extendPadding(n.padding):n.padding;if(n.padding!=null&&!m.isPaddingEqual(C))if(n.retainPadding===!1){const j=m.clone();j.padding=C,m.setLocationAtPoint(m.center,j.centerPoint)}else m.padding=C;return n.preloadOnly?(this._preloadTiles(m),this):(this.fire(new o.z("movestart",c)).fire(new o.z("move",c)),v&&this.fire(new o.z("zoomstart",c)).fire(new o.z("zoom",c)).fire(new o.z("zoomend",c)),w&&this.fire(new o.z("rotatestart",c)).fire(new o.z("rotate",c)).fire(new o.z("rotateend",c)),S&&this.fire(new o.z("pitchstart",c)).fire(new o.z("pitch",c)).fire(new o.z("pitchend",c)),this.fire(new o.z("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(Ss),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,c){const m=this.transform;if(!m.projection.supportsFreeCamera)return o.w(Ss),this;this.stop();const v=m.zoom,w=m.pitch,S=m.bearing;m.setFreeCameraOptions(n);const C=v!==m.zoom,j=w!==m.pitch,M=S!==m.bearing;return this.fire(new o.z("movestart",c)).fire(new o.z("move",c)),C&&this.fire(new o.z("zoomstart",c)).fire(new o.z("zoom",c)).fire(new o.z("zoomend",c)),M&&this.fire(new o.z("rotatestart",c)).fire(new o.z("rotate",c)).fire(new o.z("rotateend",c)),j&&this.fire(new o.z("pitchstart",c)).fire(new o.z("pitch",c)).fire(new o.z("pitchend",c)),this.fire(new o.z("moveend",c)),this}easeTo(n,c){this._stop(!1,n.easeId),((n=Object.assign({offset:[0,0],duration:500,easing:o.eU},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);const m=this.transform,v=this.getZoom(),w=this.getBearing(),S=this.getPitch(),C=this.getPadding(),j="zoom"in n?+n.zoom:v,M="bearing"in n?this._normalizeBearing(n.bearing,w):w,D="pitch"in n?+n.pitch:S,B=this._extendPadding(n.padding),O=o.P.convert(n.offset);let G,X,ee;if(m.projection.name==="globe"){const Ie=o.ae.fromLngLat(m.center),$e=O.rotate(-m.angle);Ie.x+=$e.x/m.worldSize,Ie.y+=$e.y/m.worldSize;const Fe=Ie.toLngLat(),at=o.aS.convert(n.center||Fe);this._normalizeCenter(at),G=m.centerPoint.add($e),X=new o.P(Ie.x,Ie.y).mult(m.worldSize),ee=new o.P(o.aF(at.lng),o.aJ(at.lat)).mult(m.worldSize).sub(X)}else{G=m.centerPoint.add(O);const Ie=m.pointLocation(G),$e=o.aS.convert(n.center||Ie);this._normalizeCenter($e),X=m.project(Ie),ee=m.project($e).sub(X)}const oe=m.zoomScale(j-v);let ie,ce;n.around&&(ie=o.aS.convert(n.around),ce=m.locationPoint(ie));const me=this._zooming||j!==v,de=this._rotating||w!==M,Ee=this._pitching||D!==S,ge=!m.isPaddingEqual(B),je=n.retainPadding===!1?m.clone():m,Se=Ie=>$e=>{if(me&&(Ie.zoom=o.ak(v,j,$e)),de&&(Ie.bearing=o.ak(w,M,$e)),Ee&&(Ie.pitch=o.ak(S,D,$e)),ge&&(je.interpolatePadding(C,B,$e),G=je.centerPoint.add(O)),ie)Ie.setLocationAtPoint(ie,ce);else{const Fe=Ie.zoomScale(Ie.zoom-v),at=j>v?Math.min(2,oe):Math.max(.5,oe),Qe=Math.pow(at,1-$e),pt=Ie.unproject(X.add(ee.mult($e*Qe)).mult(Fe));Ie.setLocationAtPoint(Ie.renderWorldCopies?pt.wrap():pt,G)}return n.preloadOnly||this._fireMoveEvents(c),Ie};if(n.preloadOnly){const Ie=this._emulate(Se,n.duration,m);return this._preloadTiles(Ie),this}const ve={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=me,this._rotating=de,this._pitching=Ee,this._padding=ge,this._easeId=n.easeId,this._prepareEase(c,n.noMoveStart,ve),this._ease(Se(m),Ie=>{m.cameraElevationReference==="sea"&&m.recenterOnTerrain(),this._afterEase(c,Ie)},n),this}_prepareEase(n,c,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),c||m.moving||this.fire(new o.z("movestart",n)),this._zooming&&!m.zooming&&this.fire(new o.z("zoomstart",n)),this._rotating&&!m.rotating&&this.fire(new o.z("rotatestart",n)),this._pitching&&!m.pitching&&this.fire(new o.z("pitchstart",n))}_fireMoveEvents(n){this.fire(new o.z("move",n)),this._zooming&&this.fire(new o.z("zoom",n)),this._rotating&&this.fire(new o.z("rotate",n)),this._pitching&&this.fire(new o.z("pitch",n))}_afterEase(n,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const m=this._zooming,v=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new o.z("zoomend",n)),v&&this.fire(new o.z("rotateend",n)),w&&this.fire(new o.z("pitchend",n)),this.fire(new o.z("moveend",n))}flyTo(n,c){if(this._prefersReducedMotion(n)){const et=o.aH(n,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(et,c)}this.stop(),n=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:o.eU},n);const m=this.transform,v=this.getZoom(),w=this.getBearing(),S=this.getPitch(),C=this.getPadding(),j="zoom"in n?o.aA(+n.zoom,m.minZoom,m.maxZoom):v,M="bearing"in n?this._normalizeBearing(n.bearing,w):w,D="pitch"in n?+n.pitch:S,B=this._extendPadding(n.padding),O=m.zoomScale(j-v),G=o.P.convert(n.offset);let X=m.centerPoint.add(G);const ee=m.pointLocation(X),oe=o.aS.convert(n.center||ee);this._normalizeCenter(oe);const ie=m.project(ee),ce=m.project(oe).sub(ie);let me=n.curve;const de=Math.max(m.width,m.height),Ee=de/O,ge=ce.mag();if("minZoom"in n){const et=o.aA(Math.min(n.minZoom,v,j),m.minZoom,m.maxZoom),Et=de/m.zoomScale(et-v);me=Math.sqrt(Et/ge*2)}const je=me*me;function Se(et){const Et=(Ee*Ee-de*de+(et?-1:1)*je*je*ge*ge)/(2*(et?Ee:de)*je*ge);return Math.log(Math.sqrt(Et*Et+1)-Et)}function ve(et){return(Math.exp(et)-Math.exp(-et))/2}function Ie(et){return(Math.exp(et)+Math.exp(-et))/2}const $e=Se(0);let Fe=function(et){return Ie($e)/Ie($e+me*et)},at=function(et){return de*((Ie($e)*(ve(Et=$e+me*et)/Ie(Et))-ve($e))/je)/ge;var Et},Qe=(Se(1)-$e)/me;if(Math.abs(ge)<1e-6||!isFinite(Qe)){if(Math.abs(de-Ee)<1e-6)return this.easeTo(n,c);const et=Ee<de?-1:1;Qe=Math.abs(Math.log(Ee/de))/me,at=function(){return 0},Fe=function(Et){return Math.exp(et*me*Et)}}n.duration="duration"in n?+n.duration:1e3*Qe/("screenSpeed"in n?+n.screenSpeed/me:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const pt=w!==M,Ot=D!==S,Ye=!m.isPaddingEqual(B),Oe=n.retainPadding===!1?m.clone():m,mt=et=>Et=>{const $t=Et*Qe,lr=1/Fe($t);et.zoom=Et===1?j:v+et.scaleZoom(lr),pt&&(et.bearing=o.ak(w,M,Et)),Ot&&(et.pitch=o.ak(S,D,Et)),Ye&&(Oe.interpolatePadding(C,B,Et),X=Oe.centerPoint.add(G));const Mt=Et===1?oe:et.unproject(ie.add(ce.mult(at($t))).mult(lr));return et.setLocationAtPoint(et.renderWorldCopies?Mt.wrap():Mt,X),et._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(c),et};if(n.preloadOnly){const et=this._emulate(mt,n.duration,m);return this._preloadTiles(et),this}return this._zooming=!0,this._rotating=pt,this._pitching=Ot,this._padding=Ye,this._prepareEase(c,!1),this._ease(mt(m),()=>this._afterEase(c),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(n){}_cancelRenderFrame(n){}_stop(n,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,c)}if(!n){const m=this.handlers;m&&m.stop(!1)}return this}_ease(n,c,m){m.animate===!1||m.duration===0?(n(1),c()):(this._easeStart=o.o.now(),this._easeOptions=m,this._onEaseFrame=n,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((o.o.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,c){n=o.bS(n,-180,180);const m=Math.abs(n-c);return Math.abs(n-360-c)<m&&(n-=360),Math.abs(n+360-c)<m&&(n+=360),n}_normalizeCenter(n){const c=this.transform;if(c.maxBounds||c.projection.name!=="globe"&&!c.renderWorldCopies)return;const m=n.lng-c.center.lng;n.lng+=m>180?-360:m<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&o.o.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,c,m){const v=Math.ceil(15*c/1e3),w=[],S=n(m.clone());for(let C=0;C<=v;C++){const j=S(C/v);w.push(j.clone())}return w}_preloadTiles(n,c){}}class Lh{constructor(n={}){this.options=n,o.aX(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const c=this.options&&this.options.compact,m=n._getUIString("AttributionControl.ToggleAttribution");this._map=n,this._container=q("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=q("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",m);const v=q("span","mapboxgl-ctrl-icon",this._compactButton);return v.setAttribute("aria-hidden","true"),v.setAttribute("title",m),this._innerContainer=q("div","mapboxgl-ctrl-attrib-inner",this._container),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.e.ACCESS_TOKEN}];if(n){const m=c.reduce((v,w,S)=>(w.value&&(v+=`${w.key}=${w.value}${S<c.length-1?"&":""}`),v),"?");n.href=`${o.e.FEEDBACK_URL}/${m}#${Bg(this._map,!0)}`,n.rel="noopener nofollow"}}_updateData(n){!n||(n.dataType!=="source"||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility")&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const c=this._map.style._mergedSourceCaches;for(const v in c){const w=c[v];if(w.used){const S=w.getSource();S.attribution&&n.indexOf(S.attribution)<0&&n.push(S.attribution)}}n.sort((v,w)=>v.length-w.length),n=n.filter((v,w)=>{for(let S=w+1;S<n.length;S++)if(n[S].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const m=n.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,n.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class $p{constructor(){o.aX(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=q("div","mapboxgl-ctrl");const c=q("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const c in n){const m=n[c].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const c=n[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class fx{constructor(){o.aX(["_onIndoorUpdate"],this)}onAdd(n){return this._map=n,this._container=q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",c=>this._onIndoorUpdate(c)),this._container}_createButton(n,c){const m=q("button",n,this._container);return m.type="button",m.addEventListener("click",c),m}_createSeparator(){return q("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(n,c){this._map&&(n.setAttribute("aria-label",c),n.textContent=c)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(n){if(!n||!n.floors)return this._model=n,void(this._container.style.display="none");const c=this._model;this._model=n,this._container.style.display="inline-block",this._container.style.borderRadius="8px",c&&Array.from(this._container.children).forEach(m=>m.remove()),n.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(n.floors,n.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const n=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const c=this._map;this._model&&c&&c._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});q("span","mapboxgl-ctrl-icon",n).setAttribute("aria-hidden","true"),n.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&n.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(n),this._createSeparator()}_updateBuildingsButtonState(){const n=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");n&&this._model&&(this._model.activeFloorsVisible?n.classList.remove("mapboxgl-ctrl-level-button-selected"):n.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(n,c){for(let m=0;m<n.length;m++){const v=n[m],w=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(v.id)});this._setButtonTitle(w,v.zIndex.toString()),this._model&&v.id===this._model.selectedFloorId&&c&&w.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(w),m<n.length-1&&this._createSeparator()}}}class zw{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const c=++this._id;return this._queue.push({callback:n,id:c,cancelled:!1}),c}remove(n){const c=this._currentlyRunning,m=c?this._queue.concat(c):this._queue;for(const v of m)if(v.id===n)return void(v.cancelled=!0)}run(n=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const m of c)if(!m.cancelled&&(m.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class qp{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const c=o.dC((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,c,m){this._start=this.getValue(c),this._end=n,this._startTime=c,this._endTime=c+m}}const bE={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Fw extends o.z{constructor(n,c,m,v){const{point:w,lngLat:S,originalEvent:C,target:j}=n;super(n.type,{point:w,lngLat:S,originalEvent:C,target:j}),this.preventDefault=()=>{n.preventDefault()},this.id=c,this.interaction=m,this.feature=v}}class px{constructor(n){this.map=n,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(n,c){if(this.typeById.has(n))throw new Error(`Interaction id "${n}" already exists.`);const m=c.filter;let v=c.type;m&&this.filters.set(n,o.b5(m)),v==="mouseover"&&(v="mouseenter"),v==="mouseout"&&(v="mouseleave");const w=this.interactionsByType.get(v)||new Map;v==="mouseenter"||v==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(n,c)):w.size===0&&this.map.on(v,this.handleType),w.size===0&&this.interactionsByType.set(v,w),w.set(n,c),this.typeById.set(n,v)}get(n){const c=this.typeById.get(n);if(!c)return;const m=this.interactionsByType.get(c);return m?m.get(n):void 0}remove(n){const c=this.typeById.get(n);if(!c)return;this.typeById.delete(n),this.filters.delete(n);const m=this.interactionsByType.get(c);m&&(m.delete(n),c==="mouseenter"||c==="mouseleave"?(this.delegatedInteractions.delete(n),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):m.size===0&&this.map.off(c,this.handleType))}queryTargets(n,c){const m=[];for(const[v,w]of c)w.target&&m.push({targetId:v,target:w.target,filter:this.filters.get(v)});return this.map.style.queryRenderedTargets(n,m,this.map.transform)}handleMove(n){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const c=this.queryTargets(n.point,Array.from(this.delegatedInteractions).reverse());c.length&&(n.type="mouseenter",this.handleType(n,c));const m=new Map;for(const[v,{feature:w}]of this.prevHoveredFeatures)this.hoveredFeatures.has(v)||m.set(w.id,w);m.size&&(n.type="mouseleave",this.handleType(n,Array.from(m.values())))}handleOut(n){const c=Array.from(this.hoveredFeatures.values()).map(({feature:m})=>m);c.length&&(n.type="mouseleave",this.handleType(n,c)),this.hoveredFeatures.clear()}handleType(n,c){const m=n.type==="mouseenter";if(m&&!this.interactionsByType.has(n.type))return void o.w("mouseenter interaction required for mouseleave to work.");const v=Array.from(this.interactionsByType.get(n.type)).reverse(),w=!!c;c=c||this.queryTargets(n.point,v);let S=!1;const C=new Set;for(const j of c){for(const[M,D]of v){if(!D.target)continue;const B=j.variants?j.variants[M]:null;if(B){for(const O of B){if(fa(O,j,C,M))continue;const G=new o.dw(j,O),X=kl(O,j,M);w&&G.id!==void 0&&(G.state=this.map.getFeatureState(G));const ee=m?this.prevHoveredFeatures.get(X):null,oe=new Fw(n,M,D,G),ie=ee?ee.stop:D.handler(oe);if(m&&this.hoveredFeatures.set(X,{feature:j,stop:ie}),ie!==!1){S=!0;break}}if(S)break}}if(S)break}if(!S)for(const[j,M]of v){const{handler:D,target:B}=M;if(!B&&D(new Fw(n,j,M,null))!==!1)break}}}function mx(p,n){if(Array.isArray(p)&&Array.isArray(n)){const c=new Set(p),m=new Set(n);return c.size===m.size&&p.every(v=>m.has(v))}return o.bx(p,n)}const Xg={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Kg={showCompass:!0,showZoom:!0,visualizePitch:!1};class Gp{constructor(n,c,m=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new qg({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,m&&(this.mousePitch=new cx({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),o.aX(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(n,c){this.mouseRotate.mousedown(n,c),this.mousePitch&&this.mousePitch.mousedown(n,c),ne()}move(n,c){const m=this.map,v=this.mouseRotate.mousemoveWindow(n,c),w=v&&v.bearingDelta;if(w&&m.setBearing(m.getBearing()+w),this.mousePitch){const S=this.mousePitch.mousemoveWindow(n,c),C=S&&S.pitchDelta;C&&m.setPitch(m.getPitch()+C)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){le(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(Object.assign({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),Ze(this.element,n)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,Ze(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Xe(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=Xe(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function zc(p,n,c){if(p=new o.aS(p.lng,p.lat),n){const m=new o.aS(p.lng-360,p.lat),v=new o.aS(p.lng+360,p.lat),w=360*Math.ceil(Math.abs(p.lng-c.center.lng)/360),S=c.locationPoint3D(p).distSqr(n),C=n.x<0||n.y<0||n.x>c.width||n.y>c.height;c.locationPoint3D(m).distSqr(n)<S&&(C||Math.abs(m.lng-c.center.lng)<w)?p=m:c.locationPoint3D(v).distSqr(n)<S&&(C||Math.abs(v.lng-c.center.lng)<w)&&(p=v)}for(;Math.abs(p.lng-c.center.lng)>180;){const m=c.locationPoint3D(p);if(m.x>=0&&m.y>=0&&m.x<=c.width&&m.y<=c.height)break;p.lng>c.center.lng?p.lng-=360:p.lng+=360}return p}const Rl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Io={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Fc extends o.E{constructor(n,c){super(),(n instanceof HTMLElement||c)&&(n=Object.assign({element:n},c)),o.aX(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:m="center",color:v="#3FB1CE",scale:w=1,draggable:S=!1,clickTolerance:C=0,rotation:j=Io.rotation,rotationAlignment:M=Io.rotationAlignment,pitchAlignment:D=Io.pitchAlignment,occludedOpacity:B=Io.occludedOpacity,altitude:O=Io.altitude}=n||{};this._anchor=m,this._color=v,this._scale=w,this._draggable=S,this._clickTolerance=C,this._rotation=j,this._rotationAlignment=M,this._pitchAlignment=D,this._occludedOpacity=B,this._altitude=O,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),n&&n.element?(this._element=n.element,this._offset=o.P.convert(n&&n.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=o.P.convert(n&&n.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",ee=>{ee.preventDefault()}),this._element.addEventListener("mousedown",ee=>{ee.preventDefault()});const G=this._element.classList;for(const ee in Rl)G.remove(`mapboxgl-marker-anchor-${ee}`);G.add(`mapboxgl-marker-anchor-${this._anchor}`);const X=n&&n.className?n.className.trim().split(/\s+/):[];G.add(...X),this._popup=null}_createDefaultMarker(){const n=q("div"),c=Z("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},n);if(this._altitude===0){const m=Z("radialGradient",{id:"shadowGradient"},Z("defs",{},c));Z("stop",{offset:"10%","stop-opacity":.4},m),Z("stop",{offset:"100%","stop-opacity":.05},m),Z("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},c)}return Z("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},c),Z("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},c),Z("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},c),n}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=o.aS.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(n){return n===this._altitude||(this._defaultMarker&&(this._altitude===0&&n!==0||this._altitude!==0&&n===0)&&(this._element=this._createDefaultMarker()),this._altitude=n||Io.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const v=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,n._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const c=n.code,m=n.charCode||n.keyCode;c!=="Space"&&c!=="Enter"&&m!==32&&m!==13||this.togglePopup()}_onMapClick(n){const c=n.originalEvent.target,m=this._element;this._popup&&(c===m||m.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,c=this._pos;if(!n||!c)return!1;const m=n.unproject(c,this._altitude),v=n.getFreeCameraOptions();if(!v.position)return!1;const w=v.position.toLngLat();return w.distanceTo(m)<.9*w.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const c=this._pos;if(!c||c.x<0||c.x>n.transform.width||c.y<0||c.y>n.transform.height)return void this._clearFadeTimer();const m=n.unproject(c,this._altitude);let v;n._showingGlobe()&&o.f4(n.transform,this._lngLat)?v=0:(v=1-n._queryFogOpacity(m),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${Rl[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){const n=this._pos,c=this._map,m=this.getPitchAlignment();if(!c||!n||m!=="map")return"";if(!c._showingGlobe()){const j=c.getPitch();return j?`rotateX(${j}deg)`:""}const v=o.cW(o.f5(c.transform,this._lngLat)),w=n.sub(o.f6(c.transform)),S=Math.abs(w.x)+Math.abs(w.y);if(S===0)return"";const C=v/S;return`rotateX(${-w.y*C}deg) rotateY(${w.x*C}deg)`}_calculateZTransform(){const n=this._pos,c=this._map;if(!c||!n)return"";let m=0;const v=this.getRotationAlignment();if(v==="map")if(c._showingGlobe()){const w=c.project(new o.aS(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),S=c.project(new o.aS(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(w);m=o.cW(Math.atan2(S.y,S.x))-90}else m=-c.getBearing();else if(v==="horizon"){const w=o.ah(4,6,c.getZoom()),S=o.f6(c.transform);S.y+=w*c.transform.height;const C=n.sub(S),j=o.cW(Math.atan2(C.y,C.x));m=(j>90?j-270:j+90)*(1-w)}return m+=this._rotation,m?`rotateZ(${m}deg)`:""}_update(n){cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=zc(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat,this._altitude),n===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=o.P.convert(n),this._update(),this}addClassName(n){return this._element.classList.add(n),this}removeClassName(n){return this._element.classList.remove(n),this}toggleClassName(n){return this._element.classList.toggle(n)}_onMove(n){const c=this._map;if(!c)return;const m=this._pointerdownPos,v=this._positionDelta;if(m&&v){if(!this._isDragging){const w=this._clickTolerance||c._clickTolerance;if(n.point.dist(m)<w)return;this._isDragging=!0}this._pos=n.point.sub(v),this._lngLat=c.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.z("dragstart"))),this.fire(new o.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.z("dragend")),this._state="inactive"}_addDragHandler(n){const c=this._map,m=this._pos;c&&m&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(m),this._pointerdownPos=n.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const c=this._map;return c&&(n?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||Io.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||Io.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||Io.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||Io.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Ml={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},wE={maxWidth:100,unit:"metric"},SE={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},TE={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},EE=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function gx(p=new o.P(0,0),n="bottom"){if(typeof p=="number"){const c=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(n){case"top":return new o.P(0,p);case"top-left":return new o.P(c,c);case"top-right":return new o.P(-c,c);case"bottom":return new o.P(0,-p);case"bottom-left":return new o.P(c,-c);case"bottom-right":return new o.P(-c,-c);case"left":return new o.P(p,0);case"right":return new o.P(-p,0)}return new o.P(0,0)}return p instanceof o.P||Array.isArray(p)?o.P.convert(p):o.P.convert(p[n]||[0,0])}return{version:A,supported:Y.supported,setRTLTextPlugin:o.fa,getRTLTextPluginStatus:o.f9,Map:class extends oc{constructor(p){N.mark(I.create);const n=p;if((p=Object.assign({},Xg,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&o.f2(window)&&(p.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new uh(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies,null,null),p),this._repaint=!!p.repaint,this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._collectResourceTiming=p.collectResourceTiming,this._language=this._parseLanguage(p.language),this._worldview=p.worldview,this._renderTaskQueue=new zw,this._domRenderTaskQueue=new zw,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.b1(),this._locale=Object.assign({},bE,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._performanceMetricsCollection=p.performanceMetricsCollection,this._tessellationStep=p.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=p.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new qp(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=p.scaleFactor,this._requestManager=new dt(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,this._contextCreateOptions=p.contextCreateOptions?Object.assign({},p.contextCreateOptions):{},typeof p.container=="string"){const c=document.getElementById(p.container);if(!c)throw new Error(`Container '${p.container.toString()}' not found.`);this._container=c}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),this._spriteFormat=p.spriteFormat,o.aX(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new pE),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Zg(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,(p.style||!p.testMode)&&this.setStyle(p.style||o.e.DEFAULT_STYLE,{config:p.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),p.hash&&(this._hash=new Fg(typeof p.hash=="string"&&p.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){n.center==null&&n.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch});const c=p.bounds;c&&(this.resize(),this.fitBounds(c,Object.assign({},p.fitBoundsOptions,{duration:0})))}this.resize(),p.attributionControl&&this.addControl(new Lh({customAttribution:p.customAttribution})),this._logoControl=new $p,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()}),this.on("data",c=>{this._update(c.dataType==="style"),this.fire(new o.z(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new o.z(`${c.dataType}dataloading`,c))}),this._interactions=new px(this)}_getMapId(){return this._mapId}addControl(p,n){if(n===void 0&&(n=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new o.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=p.onAdd(this);this._controls.push(p);const m=this._controlPositions[n];return n.indexOf("bottom")!==-1?m.insertBefore(c,m.firstChild):m.appendChild(c),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new o.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(p);return n>-1&&this._controls.splice(n,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new o.z("movestart",p)).fire(new o.z("move",p)),this.fire(new o.z("resize",p)),n&&this.fire(new o.z("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(o.aI.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new o.z("zoomstart")).fire(new o.z("zoom")).fire(new o.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new o.z("zoomstart")).fire(new o.z("zoom")).fire(new o.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new o.z("pitchstart")).fire(new o.z("pitch")).fire(new o.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new o.z("pitchstart")).fire(new o.z("pitch")).fire(new o.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(p){return this._scaleFactor=p,this.painter.scaleFactor=p,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(n=>n.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(p){return p==="auto"?navigator.language:Array.isArray(p)?p.length===0?void 0:p.map(n=>n==="auto"?navigator.language:n):p}setLanguage(p){const n=this._parseLanguage(p);if(!this.style||n===this._language)return this;this._language=n,this.style.reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){return this.style&&p!==this._worldview?(this._worldview=p,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(p){return this._lazyInitEmptyStyle(),p?typeof p=="string"&&(p={name:p}):p=null,this._useExplicitProjection=!!p,this._prioritizeAndUpdateProjection(p,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const p=this.transform,n=p.projection.name;let c;n==="globe"&&p.zoom>=o.cK?(p.setMercatorFromTransition(),c=!0):n==="mercator"&&p.zoom<o.cK&&(p.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(p,n){return this._updateProjection(p||n||{name:"mercator"})}_updateProjection(p){let n;const c=this.transform.mercatorFromTransition;n=p.name==="globe"&&this.transform.zoom>=o.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(p),this.style.applyProjectionUpdate();const m=this.transform.getProjection().name==="mercator"&&c!==this.transform.mercatorFromTransition;return(n||m)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(p,n){return this.transform.locationPoint3D(o.aS.convert(p),n)}unproject(p,n){return this.transform.pointLocation3D(o.P.convert(p),n)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(p,n,c){const m=v=>{let w=[];if(Array.isArray(n)){const S=n.filter(C=>this.getLayer(C));w=S.length?this.queryRenderedFeatures(v,{layers:S}):[]}else w=this.queryRenderedFeatures(v,{target:n});return w};if(p==="mouseenter"||p==="mouseover"){let v=!1;return{listener:c,targets:n,delegates:{mousemove:S=>{const C=m(S.point);C.length?v||(v=!0,c.call(this,new Ui(p,this,S.originalEvent,{features:C}))):v=!1},mouseout:()=>{v=!1}}}}if(p==="mouseleave"||p==="mouseout"){let v=!1;return{listener:c,targets:n,delegates:{mousemove:C=>{m(C.point).length?v=!0:v&&(v=!1,c.call(this,new Ui(p,this,C.originalEvent)))},mouseout:C=>{v&&(v=!1,c.call(this,new Ui(p,this,C.originalEvent)))}}}}{const v=w=>{const S=m(w.point);S.length&&(w.features=S,c.call(this,w),delete w.features)};return{listener:c,targets:n,delegates:{[p]:v}}}}on(p,n,c){if(typeof n=="function"||c===void 0)return super.on(p,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const m=this._createDelegatedListener(p,n,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(m);for(const v in m.delegates)this.on(v,m.delegates[v]);return this}once(p,n,c){if(typeof n=="function"||c===void 0)return super.once(p,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const m=this._createDelegatedListener(p,n,c);for(const v in m.delegates)this.once(v,m.delegates[v]);return this}off(p,n,c){if(typeof n=="function"||c===void 0)return super.off(p,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const m=this._delegatedListeners?this._delegatedListeners[p]:void 0;return m&&(v=>{for(let w=0;w<v.length;w++){const S=v[w];if(S.listener===c&&mx(S.targets,n)){for(const C in S.delegates)this.off(C,S.delegates[C]);return v.splice(w,1),this}}})(m),this}queryRenderedFeatures(p,n){if(!this.style)return[];if(p===void 0||p instanceof o.P||Array.isArray(p)||n!==void 0||(n=p,p=void 0),p=p||[[0,0],[this.transform.width,this.transform.height]],!n){const w=this.style.queryRenderedFeatures(p,void 0,this.transform),S=this.style.queryRenderedFeatureset(p,void 0,this.transform);return w.concat(S)}let c=!0;if(n.target&&(c=this._isTargetValid(n.target),c&&!n.layers))return this.style.queryRenderedFeatureset(p,n,this.transform);let m=!0;if(n.layers&&Array.isArray(n.layers)){for(const w of n.layers)if(!this._isValidId(w)){m=!1;break}if(m&&!n.target)return this.style.queryRenderedFeatures(p,n,this.transform)}let v=[];return m&&(v=v.concat(this.style.queryRenderedFeatures(p,n,this.transform))),c&&(v=v.concat(this.style.queryRenderedFeatureset(p,n,this.transform))),v}querySourceFeatures(p,n){return!p||typeof p=="string"&&!this._isValidId(p)?[]:this.style.querySourceFeatures(p,n)}queryRasterValue(p,n,c){return this._isValidId(p)?this.style.queryRasterValue(p,n,c):Promise.resolve(null)}isPointOnSurface(p){const{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&o.w(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(p))}addInteraction(p,n){return this._interactions.add(p,n),this}removeInteraction(p){return this._interactions.remove(p),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(p){return this._cooperativeGestures=p,this}setStyle(p,n){return n=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n),this.style&&p&&n.diff!==!1&&n.localFontFamily===this._localFontFamily&&n.localIdeographFontFamily===this._localIdeographFontFamily&&!n.config?(this.style._diffStyle(p,(c,m)=>{if(c){const v=typeof c=="string"?c:c instanceof Error?c.message:c.error;o.w(`Unable to perform style diff: ${v}. Rebuilding the style from scratch.`),this._updateStyle(p,n)}else m&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(p,n))}_getUIString(p){const n=this._locale[p];if(n==null)throw new Error(`Missing UI string '${p}'`);return n}_updateStyle(p,n){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p){const c=Object.assign({},n);n&&n.config&&(c.initialConfig=n.config,delete c.config),this.style=new ll(this,c).load(p),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ll(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(p){return p==null?(this.fire(new o.y(new Error("IDs can't be empty."))),!1):!o.dq(p)||(this.fire(new o.y(new Error(`IDs can't contain special symbols: "${p}".`))),!1)}_isTargetValid(p){return"featuresetId"in p?this._isValidId("importId"in p?p.importId:p.featuresetId):"layerId"in p&&this._isValidId(p.layerId)}_areTargetsValid(p){if(Array.isArray(p)){for(const n of p)if(!this._isValidId(n))return!1;return!0}return this._isTargetValid(p)}addSource(p,n){return this._isValidId(p)?(this._lazyInitEmptyStyle(),this.style.addSource(p,n),this._update(!0)):this}isSourceLoaded(p){return!!this._isValidId(p)&&!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(p,n,c){this._lazyInitEmptyStyle(),this.style.addSourceType(p,n,c)}removeSource(p){return this._isValidId(p)?(this.style.removeSource(p),this._updateTerrain(),this._update(!0)):this}getSource(p){return this._isValidId(p)?this.style.getOwnSource(p):null}addImage(p,n,{pixelRatio:c=1,sdf:m=!1,stretchX:v,stretchY:w,content:S}={}){this._lazyInitEmptyStyle();const C=o.I.from(p);if(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap){const{width:j,height:M,data:D}=o.o.getImageData(n);this.style.addImage(C,{data:new o.q({width:j,height:M},D),pixelRatio:c,stretchX:v,stretchY:w,content:S,sdf:m,version:0,usvg:!1})}else if(n.width===void 0||n.height===void 0)this.fire(new o.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:j,height:M}=n,D=n;this.style.addImage(C,{data:new o.q({width:j,height:M},new Uint8Array(D.data)),pixelRatio:c,stretchX:v,stretchY:w,content:S,sdf:m,usvg:!1,version:0,userImage:D}),D.onAdd&&D.onAdd(this,p)}}updateImage(p,n){this._lazyInitEmptyStyle();const c=o.I.from(p),m=this.style.getImage(c);if(!m)return void this.fire(new o.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap?o.o.getImageData(n):n,{width:w,height:S,data:C}=v;if(w===void 0||S===void 0)return void this.fire(new o.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(w!==(m.usvg?m.icon.usvg_tree.width:m.data.width)||S!==(m.usvg?m.icon.usvg_tree.height:m.data.height))return void this.fire(new o.y(new Error(`The width and height of the updated image (${w}, ${S})
                must be that same as the previous version of the image
                (${m.data.width}, ${m.data.height})`)));const j=!(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap);let M=!1;m.usvg?(m.data=new o.q({width:w,height:S},new Uint8Array(C)),m.usvg=!1,m.icon=void 0,M=!0):m.data.replace(C,j),this.style.updateImage(c,m,M)}hasImage(p){return p?!!this.style&&!!this.style.getImage(o.I.from(p)):(this.fire(new o.y(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(o.I.from(p))}loadImage(p,n){o.n(this._requestManager.transformRequest(p,o.R.Image),(c,m)=>{n(c,m instanceof HTMLImageElement?o.o.getImageData(m):m)})}listImages(){return this.style.listImages().map(p=>p.name)}addModel(p,n){this._lazyInitEmptyStyle(),this.style.addModel(p,n)}hasModel(p){return p?this.style.hasModel(p):(this.fire(new o.y(new Error("Missing required model id"))),!1)}removeModel(p){this.style.removeModel(p)}listModels(){return this.style.listModels()}addLayer(p,n){return this._isValidId(p.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(p,n),this._update(!0)):this}getSlot(p){const n=this.getLayer(p);return n&&n.slot||null}setSlot(p,n){return this.style.setSlot(p,n),this.style.mergeLayers(),this._update(!0)}addImport(p,n){return this.style.addImport(p,n).catch(c=>this.fire(new o.y(new Error("Failed to add import",c)))),this}updateImport(p,n){return typeof n!="string"&&n.id!==p?(this.removeImport(p),this.addImport(n)):(this.style.updateImport(p,n),this._update(!0))}removeImport(p){return this.style.removeImport(p),this}moveImport(p,n){return this.style.moveImport(p,n),this._update(!0)}moveLayer(p,n){return this._isValidId(p)?(this.style.moveLayer(p,n),this._update(!0)):this}removeLayer(p){return this._isValidId(p)?(this.style.removeLayer(p),this._update(!0)):this}getLayer(p){if(!this._isValidId(p))return null;const n=this.style.getOwnLayer(p);return n?n.type==="custom"?n.implementation:n.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(p,n,c){return this._isValidId(p)?(this.style.setLayerZoomRange(p,n,c),this._update(!0)):this}setFilter(p,n,c={}){return this._isValidId(p)?(this.style.setFilter(p,n,c),this._update(!0)):this}getFilter(p){return this._isValidId(p)?this.style.getFilter(p):null}setPaintProperty(p,n,c,m={}){return this._isValidId(p)?(this.style.setPaintProperty(p,n,c,m),this._update(!0)):this}getPaintProperty(p,n){return this._isValidId(p)?this.style.getPaintProperty(p,n):null}setLayoutProperty(p,n,c,m={}){return this._isValidId(p)?(this.style.setLayoutProperty(p,n,c,m),this._update(!0)):this}getLayoutProperty(p,n){return this._isValidId(p)?this.style.getLayoutProperty(p,n):null}setLayerProperty(p,n,c,m={}){return this._isValidId(p)?(this.style.setLayerProperty(p,n,c,m),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(p){return this.style.setGlyphsUrl(p),this._update(!0)}getSchema(p){return this.style.getSchema(p)}setSchema(p,n){return this.style.setSchema(p,n),this._update(!0)}getConfig(p){return this.style.getConfig(p)}setConfig(p,n){return this.style.setConfig(p,n),this._update(!0)}getConfigProperty(p,n){return this.style.getConfigProperty(p,n)}setConfigProperty(p,n,c){return this.style.setConfigProperty(p,n,c),this._update(!0)}getFeaturesetDescriptors(p){return this.style.getFeaturesetDescriptors(p)}setLights(p){if(this._lazyInitEmptyStyle(),p&&p.length===1&&p[0].type==="flat"){const n=p[0];n.properties?this.style.setFlatLight(n.properties,n.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(p),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const p=this.style.getLights()||[];return p.length===0&&p.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),p}setLight(p,n={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:p}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(p){return this._lazyInitEmptyStyle(),this.style.setSnow(p),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(p){return this._lazyInitEmptyStyle(),this.style.setRain(p),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(p){return this._lazyInitEmptyStyle(),this.style.setColorTheme(p),this._update(!0)}setImportColorTheme(p,n){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(p,n),this._update(!0)}setCamera(p){return this.style.setCamera(p),this._triggerCameraUpdate(p)}_triggerCameraUpdate(p){return this._update(this.transform.setOrthographicProjectionAtLowPitch(p["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.aS.convert(p),this.transform):0}setFeatureState(p,n){return p.source&&!this._isValidId(p.source)?this:(this.style.setFeatureState(p,n),this._update())}removeFeatureState(p,n){return p.source&&!this._isValidId(p.source)?this:(this.style.removeFeatureState(p,n),this._update())}getFeatureState(p){return p.source&&!this._isValidId(p.source)?null:this.style.getFeatureState(p)}_selectIndoorFloor(p){this.indoor.selectFloor(p)}_setIndoorActiveFloorsVisibility(p){this.indoor.setActiveFloorsVisibility(p)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new fx),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let c,m,v,w=this._container;for(;w&&(!m||!v);){const S=window.getComputedStyle(w).transform;S&&S!=="none"&&(c=S.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(m=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(v=c[3])),w=w.parentElement}this._containerWidth=m?Math.abs(p/m):p,this._containerHeight=v?Math.abs(n/v):n}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new fd(this.style),this.on("load",()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}),this.on("idle",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})}))}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=q("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=q("div","mapboxgl-canvas-container",p);this._canvas=q("canvas","mapboxgl-canvas",n),this._interactive&&(n.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=q("div","mapboxgl-control-container",p),m=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(v=>{m[v]=q("div",`mapboxgl-ctrl-${v}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,n){const c=o.o.devicePixelRatio||1;this._canvas.width=c*Math.ceil(p),this._canvas.height=c*Math.ceil(n),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${n}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const n=this._markers.indexOf(p);n!==-1&&this._markers.splice(n,1)}_addPopup(p){this._popups.push(p)}_removePopup(p){const n=this._popups.indexOf(p);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const p=Object.assign({},Y.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",p);n?(Ji(n,!0),this.painter=new Iu(n,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",c=>{c.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.k.testSupport(n)):this.fire(new o.y(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.z("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new o.z("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let n;this.fire(new o.z("renderstart")),++this._frameId;const c=this.painter.context.extTimerQuery,m=o.o.now(),v=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=v.createQuery(),v.beginQuery(c.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjectionTransition();const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const M=this.transform.zoom,D=this.transform.pitch,B=o.o.now(),O=new o.ac(M,{now:B,fadeDuration:w,pitch:D,transition:this.style.transition,worldview:this._worldview});this.style.update(O)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(m),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(m);const C=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),C&&(this._placementDirty=C.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,N.mark(I.load),this.fire(new o.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const M=o.o.now()-m;v.endQuery(c.TIME_ELAPSED_EXT),setTimeout(()=>{const D=v.getQueryParameter(n,v.QUERY_RESULT)/1e6;v.deleteQuery(n),this.fire(new o.z("gpu-timing-frame",{cpuTime:M,gpuTime:D}))},50)}if(this.listens("gpu-timing-layer")){const M=this.painter.collectGpuTimers();setTimeout(()=>{const D=this.painter.queryGpuTimers(M);this.fire(new o.z("gpu-timing-layer",{layerTimes:D}))},50)}if(this.listens("gpu-timing-deferred-render")){const M=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const D=this.painter.queryGpuTimeDeferredRender(M);this.fire(new o.z("gpu-timing-deferred-render",{gpuTime:D}))},50)}const j=this._sourcesDirty||this._styleDirty||this._placementDirty||S;if(j||this._repaint)this.triggerRepaint();else{const M=this.idle();if(M&&(S=this._updateAverageElevation(m,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),M&&(this.fire(new o.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const D=this._calculateSpeedIndex();this.fire(new o.z("speedindexcompleted",{speedIndex:D})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||j||(this._fullyLoaded=!0,N.mark(I.fullLoad),this._performanceMetricsCollection&&zr(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(p){for(const n of this._markers)p&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!p||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(p,n=!1){const c=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);const m=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(m||(n||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const v=this.transform.averageElevation;let w=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=p;const S=Math.abs(v-w);if(S>1){if(this._isInitialLoad||m)return this._averageElevation.jumpTo(w),c(w);this._averageElevation.easeTo(w,p,300)}else if(S>1e-4)return this._averageElevation.jumpTo(w),c(w)}return!!this._averageElevation.isEasing(p)&&c(this._averageElevation.getValue(p))}_authenticate(){jn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===Be||p.status===401)){const n=this.painter.context.gl;Ji(n,!1),this._logoControl instanceof $p&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),vt(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Ft(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&vr(this._requestManager._customAccessToken)}_updateTerrain(){const p=this._isDragging();this.painter.updateTerrain(this.style,p)}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const c=this.painter.context.gl,m=c.createFramebuffer();function v(w){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,w,0);const S=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,S),S}return c.bindFramebuffer(c.FRAMEBUFFER,m),this._canvasPixelComparison(v(p),n.canvasCopies.map(v),n.timeStamps)}_canvasPixelComparison(p,n,c){let m=c[1]-c[0];const v=p.length/4;for(let w=0;w<n.length;w++){const S=n[w];let C=0;for(let j=0;j<S.length;j+=4)S[j]===p[j]&&S[j+1]===p[j+1]&&S[j+2]===p[j+2]&&S[j+3]===p[j+3]&&(C+=1);m+=(c[w+2]-c[w+1])*(1-C/v)}return m}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),hn.delete(this.painter.context.gl),Hr.remove(),Le.remove(),this._removed=!0,this.fire(new o.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=o.o.frame(n=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(n)}))}_preloadTiles(p){const n=this.style?this.style.getSourceCaches():[];return o.bv(n,(c,m)=>c._preloadTiles(p,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(p){this._showParseStatus!==p&&(this._showParseStatus=p,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(p){this._showLayers2DWireframe!==p&&(this._showLayers2DWireframe=p,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(p){this._showLayers3DWireframe!==p&&(this._showLayers3DWireframe=p,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,this._tp.refreshUI(),p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(p){this._showTileAABBs!==p&&(this._showTileAABBs=p,this._tp.refreshUI(),p&&this._update())}_setCacheLimits(p,n){o.f3(p,n)}get version(){return A}},NavigationControl:class{constructor(p={}){this.options=Object.assign({},Kg,p),this._container=q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(o.aX(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),q("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),q("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.aX(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:n}):c.resetNorth({},{originalEvent:n}))}),this._compassIcon=q("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map;if(!p)return;const n=p.getZoom(),c=n===p.getMaxZoom(),m=n===p.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const p=this._map;if(!p)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Gp(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){const p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,n){const c=q("button",p,this._container);return c.type="button",c.addEventListener("click",n),c}_setButtonTitle(p,n){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${n}`);p.setAttribute("aria-label",c),p.firstElementChild&&p.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends o.E{constructor(p={}){super();const n=navigator.geolocation;this.options=Object.assign({geolocation:n},Ml,p),o.aX(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=wd(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){const n=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,p(c)};this._supportsGeolocation!==void 0?p(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(c=>n(c.state!=="denied")).catch(()=>n()):n()}_isOutOfMapMaxBounds(p){const n=this._map.getMaxBounds(),c=p.coords;return!!n&&(c.longitude<n.getWest()||c.longitude>n.getEast()||c.latitude<n.getSouth()||c.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new o.z("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.z("geolocate",Object.assign({coords:p.coords,timestamp:p.timestamp},p.toJSON?{toJSON:p.toJSON.bind(p)}:{}))),this._finish()}}_updateCamera(p){const n=new o.aS(p.coords.longitude,p.coords.latitude),c=p.coords.accuracy,m=this._map.getBearing(),v=Object.assign({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(c),v,{geolocateSource:!0})}_updateMarker(p){if(p){const n=new o.aS(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map.transform,n=o.ce(1,p._center.lat)*p.worldSize,c=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.z("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=q("button","mapboxgl-ctrl-geolocate",this._container),q("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",p===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=q("div","mapboxgl-user-location"),this._dotElement.appendChild(q("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(q("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Fc({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=q("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Fc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.z("trackuserlocationend")))})}}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:p.absolute===!0&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&p()}).catch(console.error):p()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Lh,ScaleControl:class{constructor(p={}){this.options=Object.assign({},wE,p),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),o.aX(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const p=this.options.maxWidth||100,n=this._map,c=n._containerHeight/2,m=n._containerWidth/2-p/2,v=n.unproject([m,c]),w=n.unproject([m+p,c]),S=v.distanceTo(w);if(this.options.unit==="imperial"){const C=3.2808*S;C>5280?this._setScale(p,C/5280,"mile"):this._setScale(p,C,"foot")}else this.options.unit==="nautical"?this._setScale(p,S/1852,"nautical-mile"):S>=1e3?this._setScale(p,S/1e3,"kilometer"):this._setScale(p,S,"meter")}_setScale(p,n,c){this._map._requestDomTask(()=>{const m=function(w){const S=Math.pow(10,`${Math.floor(w)}`.length-1);let C=w/S;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(j){const M=Math.pow(10,Math.ceil(-Math.log(j)/Math.LN10));return Math.round(j*M)/M}(C),S*C}(n),v=m/n;this._container.innerHTML=this._isNumberFormatSupported&&c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(m):`${m}&nbsp;${SE[c]}`,this._container.style.width=p*v+"px"})}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=q("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p={}){this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:o.w("Full screen control 'container' must be a DOM element.")),o.aX(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=q("button","mapboxgl-ctrl-fullscreen",this._controlContainer);q("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:fx,Popup:class extends o.E{constructor(p){super(),this.options=Object.assign(Object.create(TE),p),this._altitude=this.options.altitude,o.aX(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),p._addPopup(this),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new o.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),p._canvasContainer&&p._canvasContainer.classList.remove("mapboxgl-track-pointer"),p._removePopup(this),this._map=void 0),this.fire(new o.z("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=o.aS.convert(p),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(p){return this._altitude=p,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const n=document.createDocumentFragment(),c=document.createElement("body");let m;for(c.innerHTML=p;m=c.firstChild,m;)n.appendChild(m);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=q("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(p),this.options.closeButton){const c=this._closeButton=q("button","mapboxgl-popup-close-button",n);c.type="button",c.setAttribute("aria-label","Close popup"),c.innerHTML='<span aria-hidden="true">&#215;</span>',c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let n;return this._classList.delete(p)?n=!1:(this._classList.add(p),n=!0),this._updateClassList(),n}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const n=this._map,c=this._container,m=this._pos;if(!n||!c||!m)return"bottom";const v=c.offsetWidth,w=c.offsetHeight,S=m.x<v/2,C=m.x>n.transform.width-v/2;if(m.y+p<w)return S?"top-left":C?"top-right":"top";if(m.y>n.transform.height-w){if(S)return"bottom-left";if(C)return"bottom-right"}return S?"left":C?"right":"bottom"}_updateClassList(){const p=this._container;if(!p)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),p.className=n.join(" ")}_update(p){const n=this._map,c=this._content;if(!n||!this._lngLat&&!this._trackPointer||!c)return;let m=this._container;if(m||(m=this._container=q("div","mapboxgl-popup",n.getContainer()),this._tip=q("div","mapboxgl-popup-tip",m),m.appendChild(c)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=zc(this._lngLat,this._pos,n.transform)),!this._trackPointer||p){const v=this._pos=this._trackPointer&&p instanceof o.P?p:n.project(this._lngLat,this._altitude),w=gx(this.options.offset),S=this._anchor=this._getAnchor(w.y),C=gx(this.options.offset,S),j=v.add(C).round();n._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${Rl[S]} translate(${j.x}px,${j.y}px)`)})}if(!this._marker&&n._showingGlobe()){const v=o.f4(n.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(EE);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:Fc,Style:ll,LngLat:o.aS,LngLatBounds:o.aI,Point:o.P,MercatorCoordinate:o.ae,FreeCameraOptions:nc,Evented:o.E,config:o.e,prewarm:o.f8,clearPrewarmedResources:o.f7,get accessToken(){return o.e.ACCESS_TOKEN},set accessToken(p){o.e.ACCESS_TOKEN=p},get baseApiUrl(){return o.e.API_URL},set baseApiUrl(p){o.e.API_URL=p},get workerCount(){return o.fh.workerCount},set workerCount(p){o.fh.workerCount=p},get maxParallelImageRequests(){return o.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){o.e.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){o.fg(p)},get workerUrl(){return o.ff.workerUrl},set workerUrl(p){o.ff.workerUrl=p},get workerClass(){return o.ff.workerClass},set workerClass(p){o.ff.workerClass=p},get workerParams(){return o.ff.workerParams},set workerParams(p){o.ff.workerParams=p},get dracoUrl(){return o.fe()},set dracoUrl(p){o.fd(p)},get meshoptUrl(){return o.fc()},set meshoptUrl(p){o.fb(p)},setNow:o.o.setNow,restoreNow:o.o.restoreNow}});var x=f;return x})})(i6);var Sie=i6.exports;const $u=rk(Sie);function Tie(){const e=_u(),t=F.useRef(null),i=F.useRef(null),[l,f]=F.useState([]),[_,x]=F.useState([]),[o,A]=F.useState([]),[I,N]=F.useState(!0),[U,$]=F.useState(null);F.useState("all"),F.useState("all"),F.useState("all"),F.useState("all");const[V,Y]=F.useState({sla_dia:0,incidentes_critico:0,incidentes_alto:0,incidentes_medio:0,chamados_urgente:0,chamados_alto:0,chamados_medio:0,postos_cobertos:0,postos_total:0,variacao_presenca:0,preventivas_prazo:0,nps_7d:0,nps_30d:0,inspecoes_total:0});F.useEffect(()=>{q()},[]),F.useEffect(()=>{l.length>0&&Ze()},[l]);const q=async()=>{try{const{data:{user:Te}}=await Ge.auth.getUser();if(!Te){e("/auth");return}const{data:xe}=await Ge.from("user_roles").select("role").eq("user_id",Te.id).single();$((xe==null?void 0:xe.role)||null),await Promise.all([Z(xe==null?void 0:xe.role),le(xe==null?void 0:xe.role),Ae(),pe()])}catch(Te){console.error("Error:",Te),Yt.error("Erro ao carregar dados")}finally{N(!1)}},Z=async Te=>{try{let xe=Ge.from("unidades").select(`
          id,
          nome,
          codigo,
          latitude,
          longitude,
          cidade,
          uf,
          contrato_id,
          contratos (
            nome,
            sla_alvo_pct,
            cliente_id,
            clientes (
              razao_social
            )
          )
        `).eq("status","ativo").not("latitude","is",null).not("longitude","is",null);const{data:Be,error:dt}=await xe;if(dt)throw dt;const qt=await Promise.all((Be||[]).map(async Ke=>{var Le,vt,Wt,Ft;const[st,Ne,De,Tt]=await Promise.all([H(Ke.id),K(Ke.id),ne(Ke.id),Q(Ke.id)]),Pt=Tt.cobertos,fe=Tt.total>0?Math.round(Pt/Tt.total*100):0;return{id:Ke.id,nome:Ke.nome,codigo:Ke.codigo,latitude:Number(Ke.latitude),longitude:Number(Ke.longitude),cidade:Ke.cidade||"",uf:Ke.uf||"",contrato:{nome:((Le=Ke.contratos)==null?void 0:Le.nome)||"Sem contrato",cliente:{razao_social:((Wt=(vt=Ke.contratos)==null?void 0:vt.clientes)==null?void 0:Wt.razao_social)||"Sem cliente"}},sla_atual:st,chamados_abertos:Ne,nps_atual:De,postos_vagos:Tt.vagos,total_postos:Tt.total,postos_preenchidos:Pt,porcentagem_ocupacao:fe,meta_sla:((Ft=Ke.contratos)==null?void 0:Ft.sla_alvo_pct)||null}}));f(qt)}catch(xe){console.error("Error loading unidades:",xe),Yt.error("Erro ao carregar unidades")}},Q=async Te=>{try{const{data:xe,error:Be}=await Ge.from("postos_servico").select("id, status").eq("unidade_id",Te);if(Be)throw Be;if(!xe||xe.length===0)return{total:0,vagos:0,cobertos:0};const dt=xe.length,qt=xe.filter(st=>st.status==="ocupado").length,Ke=dt-qt;return{total:dt,vagos:Ke,cobertos:qt}}catch(xe){return console.error("Error getting postos info:",xe),{total:0,vagos:0,cobertos:0}}},H=async Te=>{const{data:xe}=await Ge.from("ordens_servico").select("status").eq("unidade_id",Te);if(!xe||xe.length===0)return 100;const Be=xe.filter(dt=>dt.status==="concluida").length;return Math.round(Be/xe.length*100)},K=async Te=>{const{count:xe}=await Ge.from("chamados").select("*",{count:"exact",head:!0}).eq("unidade_id",Te).in("status",["aberto","em_andamento"]);return xe||0},ne=async Te=>{const{data:xe}=await Ge.from("chamados").select("avaliacao").eq("unidade_id",Te).not("avaliacao","is",null).gte("created_at",new Date(Date.now()-6048e5).toISOString());if(!xe||xe.length===0)return 0;const Be=xe.filter(qt=>qt.avaliacao>=9).length,dt=xe.filter(qt=>qt.avaliacao<=6).length;return Math.round((Be-dt)/xe.length*100)},le=async Te=>{try{const{data:xe}=await Ge.from("ordens_servico").select("status").gte("data_abertura",new Date().toISOString().split("T")[0]),Be=xe&&xe.length>0?Math.round(xe.filter(Ft=>Ft.status==="concluida").length/xe.length*100):100,{data:dt}=await Ge.from("incidentes").select("severidade").in("status",["aberto","em_investigacao"]),{data:qt}=await Ge.from("chamados").select("prioridade").in("status",["aberto","em_andamento"]),{data:Ke}=await Ge.from("postos_servico").select("status"),st=(Ke==null?void 0:Ke.length)||0,Ne=(Ke==null?void 0:Ke.filter(Ft=>Ft.status==="ocupado").length)||0,{data:De}=await Ge.from("ordens_servico").select("data_prevista, data_conclusao").eq("tipo","preventiva").eq("status","concluida").gte("created_at",new Date(Date.now()-30*24*60*60*1e3).toISOString()),Tt=De?De.filter(Ft=>Ft.data_conclusao&&Ft.data_prevista&&new Date(Ft.data_conclusao)<=new Date(Ft.data_prevista)).length:0,Pt=De&&De.length>0?Math.round(Tt/De.length*100):100,{data:fe}=await Ge.from("chamados").select("avaliacao").not("avaliacao","is",null).gte("created_at",new Date(Date.now()-7*24*60*60*1e3).toISOString()),{data:Le}=await Ge.from("chamados").select("avaliacao").not("avaliacao","is",null).gte("created_at",new Date(Date.now()-30*24*60*60*1e3).toISOString()),{count:vt}=await Ge.from("inspecoes").select("*",{count:"exact",head:!0}),Wt=Ft=>{if(!Ft||Ft.length===0)return 0;const Ut=Ft.filter(xr=>xr.avaliacao>=9).length,vr=Ft.filter(xr=>xr.avaliacao<=6).length;return Math.round((Ut-vr)/Ft.length*100)};Y({sla_dia:Be,incidentes_critico:(dt==null?void 0:dt.filter(Ft=>Ft.severidade==="critica").length)||0,incidentes_alto:(dt==null?void 0:dt.filter(Ft=>Ft.severidade==="alta").length)||0,incidentes_medio:(dt==null?void 0:dt.filter(Ft=>Ft.severidade==="media").length)||0,chamados_urgente:(qt==null?void 0:qt.filter(Ft=>Ft.prioridade==="urgente").length)||0,chamados_alto:(qt==null?void 0:qt.filter(Ft=>Ft.prioridade==="alta").length)||0,chamados_medio:(qt==null?void 0:qt.filter(Ft=>Ft.prioridade==="media").length)||0,postos_cobertos:Ne,postos_total:st,variacao_presenca:95,preventivas_prazo:Pt,nps_7d:Wt(fe||[]),nps_30d:Wt(Le||[]),inspecoes_total:vt||0})}catch(xe){console.error("Error loading stats:",xe)}},pe=async()=>{try{const{data:Te,error:xe}=await Ge.from("execucao_checklist").select(`
          id,
          checklist_id,
          data_prevista,
          status,
          finalizado_em,
          checklist:checklist ( nome ),
          supervisor:profiles ( full_name )
        `).order("data_prevista",{ascending:!1}).limit(5);if(xe)throw xe;const Be=(Te==null?void 0:Te.filter(dt=>dt.status!=="concluido"&&dt.status!=="cancelado"))||[];A(Be)}catch(Te){console.error("Error loading checklist executions:",Te)}},Ae=async()=>{try{const{data:Te,error:xe}=await Ge.from("chamados").select(`
          id,
          numero,
          titulo,
          prioridade,
          status,
          data_abertura,
          unidade:unidades(nome)
        `).neq("status","concluido").order("data_abertura",{ascending:!1});if(xe)throw xe;x(Te||[])}catch(Te){console.error("Error loading chamados feed:",Te)}},Ze=async()=>{if(!(!t.current||i.current))try{const{data:Te,error:xe}=await Ge.functions.invoke("get-mapbox-token");if(xe||!(Te!=null&&Te.token)){Yt.error("Erro ao carregar token do Mapbox");return}$u.accessToken=Te.token,i.current=new $u.Map({container:t.current,style:"mapbox://styles/mapbox/light-v11",center:[-47.9292,-15.7801],zoom:4}),i.current.addControl(new $u.NavigationControl,"top-right"),l.forEach(Be=>{if(!i.current)return;const dt=document.createElement("div");dt.className="marker",dt.style.backgroundColor=Xe(Be.porcentagem_ocupacao),dt.style.width="24px",dt.style.height="24px",dt.style.borderRadius="50%",dt.style.border="3px solid white",dt.style.cursor="pointer",dt.style.boxShadow="0 2px 4px rgba(0,0,0,0.3)";const qt=new $u.Marker(dt).setLngLat([Be.longitude,Be.latitude]).addTo(i.current),Ke=new $u.Popup({offset:25}).setHTML(`<div style="padding: 12px; min-width: 200px;">
            <h3 style="font-weight: bold; margin-bottom: 8px; font-size: 14px;">${Be.nome}</h3>
            <p style="font-size: 12px; color: #666; margin-bottom: 8px;">${Be.cidade}/${Be.uf}</p>
            <div style="border-top: 1px solid #e5e7eb; padding-top: 8px;">
              <p style="font-size: 12px; margin-bottom: 4px;">Meta de SLA: <strong>${Be.meta_sla??"N/A"}${Be.meta_sla?"%":""}</strong></p>
              <p style="font-size: 12px; margin-bottom: 4px;">Postos Preenchidos: <strong>${Be.postos_preenchidos}/${Be.total_postos}</strong></p>
              <p style="font-size: 12px;">Taxa de Ocupao: <strong style="color: ${Be.porcentagem_ocupacao>=90?"#22c55e":Be.porcentagem_ocupacao>=70?"#eab308":"#ef4444"};">${Be.porcentagem_ocupacao}%</strong></p>
            </div>
          </div>`);qt.setPopup(Ke)})}catch(Te){console.error("Error initializing map:",Te),Yt.error("Erro ao inicializar mapa")}},Xe=Te=>Te>=100?"#22c55e":Te>=70?"#eab308":"#ef4444",Je=Te=>Te==="concluido"?"default":Te==="atrasado"?"destructive":Te==="cancelado"?"outline":"secondary";return I?d.jsx(bo,{children:d.jsx("div",{className:"flex items-center justify-center h-screen",children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),d.jsx("p",{className:"text-muted-foreground",children:"Carregando dashboard..."})]})})}):d.jsx(bo,{children:d.jsxs("div",{className:"min-h-screen bg-background p-6 space-y-6",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-3xl font-bold",children:"Dashboard 24/7 Resumo Executivo"}),d.jsx("p",{className:"text-muted-foreground",children:"Monitoramento em tempo real"})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(Al,{className:"h-4 w-4 text-muted-foreground"}),d.jsx("span",{className:"text-sm text-muted-foreground",children:new Date().toLocaleDateString("pt-BR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[d.jsxs(Sr,{children:[d.jsx(wn,{children:d.jsxs(An,{className:"flex items-center gap-2",children:[d.jsx(Cm,{className:"h-5 w-5 text-destructive"}),"Incidentes por Severidade (Disponvel em breve!)"]})}),d.jsxs(tn,{className:"space-y-2",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-sm",children:"Crtico"}),d.jsx(Gn,{variant:"destructive",children:V.incidentes_critico})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-sm",children:"Alto"}),d.jsx(Gn,{variant:"destructive",children:V.incidentes_alto})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-sm",children:"Mdio"}),d.jsx(Gn,{variant:"secondary",children:V.incidentes_medio})]})]})]}),d.jsxs(Sr,{children:[d.jsx(wn,{children:d.jsxs(An,{className:"flex items-center gap-2",children:[d.jsx(ib,{className:"h-5 w-5 text-primary"}),"Chamados por Prioridade"]})}),d.jsxs(tn,{className:"space-y-2",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-sm",children:"Urgente"}),d.jsx(Gn,{variant:"destructive",children:V.chamados_urgente})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-sm",children:"Alta"}),d.jsx(Gn,{variant:"destructive",children:V.chamados_alto})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-sm",children:"Mdia"}),d.jsx(Gn,{variant:"secondary",children:V.chamados_medio})]})]})]})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[d.jsxs(Sr,{className:"h-[500px]",children:[d.jsxs(wn,{children:[d.jsx(An,{children:"Chamados em aberto"}),d.jsx(fs,{children:"Chamados ainda no concludos"})]}),d.jsxs(tn,{className:"h-[calc(100%-100px)] overflow-y-auto space-y-3",children:[_.length===0&&d.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum chamado pendente no momento."}),_.map(Te=>{var xe;return d.jsxs("div",{className:"p-3 rounded-lg border bg-background space-y-2",children:[d.jsxs("div",{className:"flex items-start justify-between gap-2",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-semibold",children:Te.titulo||`Chamado ${Te.numero??"-"}`}),d.jsx("p",{className:"text-xs text-muted-foreground",children:(xe=Te.unidade)!=null&&xe.nome?`Unidade: ${Te.unidade.nome}`:"Unidade no informada"})]}),d.jsx(Gn,{variant:"outline",className:"capitalize",children:Te.status})]}),d.jsxs("div",{className:"flex flex-wrap gap-2 text-xs text-muted-foreground",children:[d.jsxs("span",{children:["Prioridade: ",Te.prioridade||"-"]}),d.jsxs("span",{children:["Aberto em:"," ",Te.data_abertura?new Date(Te.data_abertura).toLocaleString("pt-BR"):"-"]})]}),d.jsx("div",{className:"flex justify-end",children:d.jsx(Bt,{size:"sm",variant:"outline",onClick:()=>e("/chamados"),children:"Ver detalhes"})})]},Te.id)})]})]}),d.jsxs(Sr,{className:"h-[500px]",children:[d.jsxs(wn,{children:[d.jsx(An,{children:"Execuo de Checklists"}),d.jsx(fs,{children:"Acompanhamento das execues registradas"})]}),d.jsxs(tn,{className:"h-[calc(100%-100px)] overflow-y-auto space-y-3",children:[o.length===0&&d.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhuma execuo de checklist cadastrada at o momento."}),o.map(Te=>{var xe,Be;return d.jsxs("div",{className:"p-3 rounded-lg border bg-background space-y-2",children:[d.jsxs("div",{className:"flex items-start justify-between gap-2",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-semibold",children:((xe=Te.checklist)==null?void 0:xe.nome)||`Checklist ${Te.checklist_id??"-"}`}),d.jsx("p",{className:"text-xs text-muted-foreground",children:(Be=Te.supervisor)!=null&&Be.full_name?`Supervisor: ${Te.supervisor.full_name}`:"Supervisor nao informado"})]}),d.jsx(Gn,{variant:Je(Te.status),className:"capitalize",children:Te.status})]}),d.jsxs("div",{className:"flex flex-wrap gap-2 text-xs text-muted-foreground",children:[d.jsxs("span",{children:["Previsto:"," ",Te.data_prevista?new Date(Te.data_prevista).toLocaleDateString("pt-BR"):"-"]}),d.jsxs("span",{children:["Finalizado:"," ",Te.finalizado_em?new Date(Te.finalizado_em).toLocaleString("pt-BR"):"-"]})]}),d.jsx("div",{className:"flex justify-end",children:d.jsx(Bt,{size:"sm",variant:"outline",onClick:()=>e("/checklist-execucoes"),children:"Ver detalhes"})})]},Te.id)})]}),d.jsx("div",{className:"px-6 pb-6",children:d.jsx(Bt,{className:"w-full",variant:"outline",onClick:()=>e("/checklist-execucoes"),children:"Gerenciar execues"})})]})]})]})})}function iF(e,[t,i]){return Math.min(i,Math.max(t,e))}var Eie=F.createContext(void 0);function VP(e){const t=F.useContext(Eie);return e||t||"ltr"}function o6(e){const t=F.useRef({value:e,previous:e});return F.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var Cie=[" ","Enter","ArrowUp","ArrowDown"],Aie=[" ","Enter"],Bm="Select",[I2,k2,jie]=Jk(Bm),[Yy,Cde]=rd(Bm,[jie,_2]),P2=_2(),[Iie,ep]=Yy(Bm),[kie,Pie]=Yy(Bm),a6=e=>{const{__scopeSelect:t,children:i,open:l,defaultOpen:f,onOpenChange:_,value:x,defaultValue:o,onValueChange:A,dir:I,name:N,autoComplete:U,disabled:$,required:V,form:Y}=e,q=P2(t),[Z,Q]=F.useState(null),[H,K]=F.useState(null),[ne,le]=F.useState(!1),pe=VP(I),[Ae,Ze]=Of({prop:l,defaultProp:f??!1,onChange:_,caller:Bm}),[Xe,Je]=Of({prop:x,defaultProp:o,onChange:A,caller:Bm}),Te=F.useRef(null),xe=Z?Y||!!Z.closest("form"):!0,[Be,dt]=F.useState(new Set),qt=Array.from(Be).map(Ke=>Ke.props.value).join(";");return d.jsx(T5,{...q,children:d.jsxs(Iie,{required:V,scope:t,trigger:Z,onTriggerChange:Q,valueNode:H,onValueNodeChange:K,valueNodeHasChildren:ne,onValueNodeHasChildrenChange:le,contentId:Wd(),value:Xe,onValueChange:Je,open:Ae,onOpenChange:Ze,dir:pe,triggerPointerDownPosRef:Te,disabled:$,children:[d.jsx(I2.Provider,{scope:t,children:d.jsx(kie,{scope:e.__scopeSelect,onNativeOptionAdd:F.useCallback(Ke=>{dt(st=>new Set(st).add(Ke))},[]),onNativeOptionRemove:F.useCallback(Ke=>{dt(st=>{const Ne=new Set(st);return Ne.delete(Ke),Ne})},[]),children:i})}),xe?d.jsxs(P6,{"aria-hidden":!0,required:V,tabIndex:-1,name:N,autoComplete:U,value:Xe,onChange:Ke=>Je(Ke.target.value),disabled:$,form:Y,children:[Xe===void 0?d.jsx("option",{value:""}):null,Array.from(Be)]},qt):null]})})};a6.displayName=Bm;var l6="SelectTrigger",c6=F.forwardRef((e,t)=>{const{__scopeSelect:i,disabled:l=!1,...f}=e,_=P2(i),x=ep(l6,i),o=x.disabled||l,A=bs(t,x.onTriggerChange),I=k2(i),N=F.useRef("touch"),[U,$,V]=M6(q=>{const Z=I().filter(K=>!K.disabled),Q=Z.find(K=>K.value===x.value),H=N6(Z,q,Q);H!==void 0&&x.onValueChange(H.value)}),Y=q=>{o||(x.onOpenChange(!0),V()),q&&(x.triggerPointerDownPosRef.current={x:Math.round(q.pageX),y:Math.round(q.pageY)})};return d.jsx(E5,{asChild:!0,..._,children:d.jsx(xi.button,{type:"button",role:"combobox","aria-controls":x.contentId,"aria-expanded":x.open,"aria-required":x.required,"aria-autocomplete":"none",dir:x.dir,"data-state":x.open?"open":"closed",disabled:o,"data-disabled":o?"":void 0,"data-placeholder":R6(x.value)?"":void 0,...f,ref:A,onClick:Vn(f.onClick,q=>{q.currentTarget.focus(),N.current!=="mouse"&&Y(q)}),onPointerDown:Vn(f.onPointerDown,q=>{N.current=q.pointerType;const Z=q.target;Z.hasPointerCapture(q.pointerId)&&Z.releasePointerCapture(q.pointerId),q.button===0&&q.ctrlKey===!1&&q.pointerType==="mouse"&&(Y(q),q.preventDefault())}),onKeyDown:Vn(f.onKeyDown,q=>{const Z=U.current!=="";!(q.ctrlKey||q.altKey||q.metaKey)&&q.key.length===1&&$(q.key),!(Z&&q.key===" ")&&Cie.includes(q.key)&&(Y(),q.preventDefault())})})})});c6.displayName=l6;var u6="SelectValue",d6=F.forwardRef((e,t)=>{const{__scopeSelect:i,className:l,style:f,children:_,placeholder:x="",...o}=e,A=ep(u6,i),{onValueNodeHasChildrenChange:I}=A,N=_!==void 0,U=bs(t,A.onValueNodeChange);return ha(()=>{I(N)},[I,N]),d.jsx(xi.span,{...o,ref:U,style:{pointerEvents:"none"},children:R6(A.value)?d.jsx(d.Fragment,{children:x}):_})});d6.displayName=u6;var Rie="SelectIcon",h6=F.forwardRef((e,t)=>{const{__scopeSelect:i,children:l,...f}=e;return d.jsx(xi.span,{"aria-hidden":!0,...f,ref:t,children:l||""})});h6.displayName=Rie;var Mie="SelectPortal",f6=e=>d.jsx(l2,{asChild:!0,...e});f6.displayName=Mie;var Vm="SelectContent",p6=F.forwardRef((e,t)=>{const i=ep(Vm,e.__scopeSelect),[l,f]=F.useState();if(ha(()=>{f(new DocumentFragment)},[]),!i.open){const _=l;return _?Gm.createPortal(d.jsx(m6,{scope:e.__scopeSelect,children:d.jsx(I2.Slot,{scope:e.__scopeSelect,children:d.jsx("div",{children:e.children})})}),_):null}return d.jsx(g6,{...e,ref:t})});p6.displayName=Vm;var Kc=10,[m6,tp]=Yy(Vm),Nie="SelectContentImpl",Die=Ey("SelectContent.RemoveScroll"),g6=F.forwardRef((e,t)=>{const{__scopeSelect:i,position:l="item-aligned",onCloseAutoFocus:f,onEscapeKeyDown:_,onPointerDownOutside:x,side:o,sideOffset:A,align:I,alignOffset:N,arrowPadding:U,collisionBoundary:$,collisionPadding:V,sticky:Y,hideWhenDetached:q,avoidCollisions:Z,...Q}=e,H=ep(Vm,i),[K,ne]=F.useState(null),[le,pe]=F.useState(null),Ae=bs(t,Ut=>ne(Ut)),[Ze,Xe]=F.useState(null),[Je,Te]=F.useState(null),xe=k2(i),[Be,dt]=F.useState(!1),qt=F.useRef(!1);F.useEffect(()=>{if(K)return TU(K)},[K]),gU();const Ke=F.useCallback(Ut=>{const[vr,...xr]=xe().map(jn=>jn.ref.current),[zr]=xr.slice(-1),Hr=document.activeElement;for(const jn of Ut)if(jn===Hr||(jn==null||jn.scrollIntoView({block:"nearest"}),jn===vr&&le&&(le.scrollTop=0),jn===zr&&le&&(le.scrollTop=le.scrollHeight),jn==null||jn.focus(),document.activeElement!==Hr))return},[xe,le]),st=F.useCallback(()=>Ke([Ze,K]),[Ke,Ze,K]);F.useEffect(()=>{Be&&st()},[Be,st]);const{onOpenChange:Ne,triggerPointerDownPosRef:De}=H;F.useEffect(()=>{if(K){let Ut={x:0,y:0};const vr=zr=>{var Hr,jn;Ut={x:Math.abs(Math.round(zr.pageX)-(((Hr=De.current)==null?void 0:Hr.x)??0)),y:Math.abs(Math.round(zr.pageY)-(((jn=De.current)==null?void 0:jn.y)??0))}},xr=zr=>{Ut.x<=10&&Ut.y<=10?zr.preventDefault():K.contains(zr.target)||Ne(!1),document.removeEventListener("pointermove",vr),De.current=null};return De.current!==null&&(document.addEventListener("pointermove",vr),document.addEventListener("pointerup",xr,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",vr),document.removeEventListener("pointerup",xr,{capture:!0})}}},[K,Ne,De]),F.useEffect(()=>{const Ut=()=>Ne(!1);return window.addEventListener("blur",Ut),window.addEventListener("resize",Ut),()=>{window.removeEventListener("blur",Ut),window.removeEventListener("resize",Ut)}},[Ne]);const[Tt,Pt]=M6(Ut=>{const vr=xe().filter(Hr=>!Hr.disabled),xr=vr.find(Hr=>Hr.ref.current===document.activeElement),zr=N6(vr,Ut,xr);zr&&setTimeout(()=>zr.ref.current.focus())}),fe=F.useCallback((Ut,vr,xr)=>{const zr=!qt.current&&!xr;(H.value!==void 0&&H.value===vr||zr)&&(Xe(Ut),zr&&(qt.current=!0))},[H.value]),Le=F.useCallback(()=>K==null?void 0:K.focus(),[K]),vt=F.useCallback((Ut,vr,xr)=>{const zr=!qt.current&&!xr;(H.value!==void 0&&H.value===vr||zr)&&Te(Ut)},[H.value]),Wt=l==="popper"?GI:_6,Ft=Wt===GI?{side:o,sideOffset:A,align:I,alignOffset:N,arrowPadding:U,collisionBoundary:$,collisionPadding:V,sticky:Y,hideWhenDetached:q,avoidCollisions:Z}:{};return d.jsx(m6,{scope:i,content:K,viewport:le,onViewportChange:pe,itemRefCallback:fe,selectedItem:Ze,onItemLeave:Le,itemTextRefCallback:vt,focusSelectedItem:st,selectedItemText:Je,position:l,isPositioned:Be,searchRef:Tt,children:d.jsx(DP,{as:Die,allowPinchZoom:!0,children:d.jsx(NP,{asChild:!0,trapped:H.open,onMountAutoFocus:Ut=>{Ut.preventDefault()},onUnmountAutoFocus:Vn(f,Ut=>{var vr;(vr=H.trigger)==null||vr.focus({preventScroll:!0}),Ut.preventDefault()}),children:d.jsx(Ab,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:_,onPointerDownOutside:x,onFocusOutside:Ut=>Ut.preventDefault(),onDismiss:()=>H.onOpenChange(!1),children:d.jsx(Wt,{role:"listbox",id:H.contentId,"data-state":H.open?"open":"closed",dir:H.dir,onContextMenu:Ut=>Ut.preventDefault(),...Q,...Ft,onPlaced:()=>dt(!0),ref:Ae,style:{display:"flex",flexDirection:"column",outline:"none",...Q.style},onKeyDown:Vn(Q.onKeyDown,Ut=>{const vr=Ut.ctrlKey||Ut.altKey||Ut.metaKey;if(Ut.key==="Tab"&&Ut.preventDefault(),!vr&&Ut.key.length===1&&Pt(Ut.key),["ArrowUp","ArrowDown","Home","End"].includes(Ut.key)){let zr=xe().filter(Hr=>!Hr.disabled).map(Hr=>Hr.ref.current);if(["ArrowUp","End"].includes(Ut.key)&&(zr=zr.slice().reverse()),["ArrowUp","ArrowDown"].includes(Ut.key)){const Hr=Ut.target,jn=zr.indexOf(Hr);zr=zr.slice(jn+1)}setTimeout(()=>Ke(zr)),Ut.preventDefault()}})})})})})})});g6.displayName=Nie;var Oie="SelectItemAlignedPosition",_6=F.forwardRef((e,t)=>{const{__scopeSelect:i,onPlaced:l,...f}=e,_=ep(Vm,i),x=tp(Vm,i),[o,A]=F.useState(null),[I,N]=F.useState(null),U=bs(t,Ae=>N(Ae)),$=k2(i),V=F.useRef(!1),Y=F.useRef(!0),{viewport:q,selectedItem:Z,selectedItemText:Q,focusSelectedItem:H}=x,K=F.useCallback(()=>{if(_.trigger&&_.valueNode&&o&&I&&q&&Z&&Q){const Ae=_.trigger.getBoundingClientRect(),Ze=I.getBoundingClientRect(),Xe=_.valueNode.getBoundingClientRect(),Je=Q.getBoundingClientRect();if(_.dir!=="rtl"){const Hr=Je.left-Ze.left,jn=Xe.left-Hr,hn=Ae.left-jn,Ji=Ae.width+hn,Ii=Math.max(Ji,Ze.width),Vi=window.innerWidth-Kc,As=iF(jn,[Kc,Math.max(Kc,Vi-Ii)]);o.style.minWidth=Ji+"px",o.style.left=As+"px"}else{const Hr=Ze.right-Je.right,jn=window.innerWidth-Xe.right-Hr,hn=window.innerWidth-Ae.right-jn,Ji=Ae.width+hn,Ii=Math.max(Ji,Ze.width),Vi=window.innerWidth-Kc,As=iF(jn,[Kc,Math.max(Kc,Vi-Ii)]);o.style.minWidth=Ji+"px",o.style.right=As+"px"}const Te=$(),xe=window.innerHeight-Kc*2,Be=q.scrollHeight,dt=window.getComputedStyle(I),qt=parseInt(dt.borderTopWidth,10),Ke=parseInt(dt.paddingTop,10),st=parseInt(dt.borderBottomWidth,10),Ne=parseInt(dt.paddingBottom,10),De=qt+Ke+Be+Ne+st,Tt=Math.min(Z.offsetHeight*5,De),Pt=window.getComputedStyle(q),fe=parseInt(Pt.paddingTop,10),Le=parseInt(Pt.paddingBottom,10),vt=Ae.top+Ae.height/2-Kc,Wt=xe-vt,Ft=Z.offsetHeight/2,Ut=Z.offsetTop+Ft,vr=qt+Ke+Ut,xr=De-vr;if(vr<=vt){const Hr=Te.length>0&&Z===Te[Te.length-1].ref.current;o.style.bottom="0px";const jn=I.clientHeight-q.offsetTop-q.offsetHeight,hn=Math.max(Wt,Ft+(Hr?Le:0)+jn+st),Ji=vr+hn;o.style.height=Ji+"px"}else{const Hr=Te.length>0&&Z===Te[0].ref.current;o.style.top="0px";const hn=Math.max(vt,qt+q.offsetTop+(Hr?fe:0)+Ft)+xr;o.style.height=hn+"px",q.scrollTop=vr-vt+q.offsetTop}o.style.margin=`${Kc}px 0`,o.style.minHeight=Tt+"px",o.style.maxHeight=xe+"px",l==null||l(),requestAnimationFrame(()=>V.current=!0)}},[$,_.trigger,_.valueNode,o,I,q,Z,Q,_.dir,l]);ha(()=>K(),[K]);const[ne,le]=F.useState();ha(()=>{I&&le(window.getComputedStyle(I).zIndex)},[I]);const pe=F.useCallback(Ae=>{Ae&&Y.current===!0&&(K(),H==null||H(),Y.current=!1)},[K,H]);return d.jsx(zie,{scope:i,contentWrapper:o,shouldExpandOnScrollRef:V,onScrollButtonChange:pe,children:d.jsx("div",{ref:A,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:ne},children:d.jsx(xi.div,{...f,ref:U,style:{boxSizing:"border-box",maxHeight:"100%",...f.style}})})})});_6.displayName=Oie;var Lie="SelectPopperPosition",GI=F.forwardRef((e,t)=>{const{__scopeSelect:i,align:l="start",collisionPadding:f=Kc,..._}=e,x=P2(i);return d.jsx(C5,{...x,..._,ref:t,align:l,collisionPadding:f,style:{boxSizing:"border-box",..._.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});GI.displayName=Lie;var[zie,UP]=Yy(Vm,{}),HI="SelectViewport",y6=F.forwardRef((e,t)=>{const{__scopeSelect:i,nonce:l,...f}=e,_=tp(HI,i),x=UP(HI,i),o=bs(t,_.onViewportChange),A=F.useRef(0);return d.jsxs(d.Fragment,{children:[d.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:l}),d.jsx(I2.Slot,{scope:i,children:d.jsx(xi.div,{"data-radix-select-viewport":"",role:"presentation",...f,ref:o,style:{position:"relative",flex:1,overflow:"hidden auto",...f.style},onScroll:Vn(f.onScroll,I=>{const N=I.currentTarget,{contentWrapper:U,shouldExpandOnScrollRef:$}=x;if($!=null&&$.current&&U){const V=Math.abs(A.current-N.scrollTop);if(V>0){const Y=window.innerHeight-Kc*2,q=parseFloat(U.style.minHeight),Z=parseFloat(U.style.height),Q=Math.max(q,Z);if(Q<Y){const H=Q+V,K=Math.min(Y,H),ne=H-K;U.style.height=K+"px",U.style.bottom==="0px"&&(N.scrollTop=ne>0?ne:0,U.style.justifyContent="flex-end")}}}A.current=N.scrollTop})})})]})});y6.displayName=HI;var v6="SelectGroup",[Fie,Bie]=Yy(v6),Vie=F.forwardRef((e,t)=>{const{__scopeSelect:i,...l}=e,f=Wd();return d.jsx(Fie,{scope:i,id:f,children:d.jsx(xi.div,{role:"group","aria-labelledby":f,...l,ref:t})})});Vie.displayName=v6;var x6="SelectLabel",b6=F.forwardRef((e,t)=>{const{__scopeSelect:i,...l}=e,f=Bie(x6,i);return d.jsx(xi.div,{id:f.id,...l,ref:t})});b6.displayName=x6;var zT="SelectItem",[Uie,w6]=Yy(zT),S6=F.forwardRef((e,t)=>{const{__scopeSelect:i,value:l,disabled:f=!1,textValue:_,...x}=e,o=ep(zT,i),A=tp(zT,i),I=o.value===l,[N,U]=F.useState(_??""),[$,V]=F.useState(!1),Y=bs(t,H=>{var K;return(K=A.itemRefCallback)==null?void 0:K.call(A,H,l,f)}),q=Wd(),Z=F.useRef("touch"),Q=()=>{f||(o.onValueChange(l),o.onOpenChange(!1))};if(l==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return d.jsx(Uie,{scope:i,value:l,disabled:f,textId:q,isSelected:I,onItemTextChange:F.useCallback(H=>{U(K=>K||((H==null?void 0:H.textContent)??"").trim())},[]),children:d.jsx(I2.ItemSlot,{scope:i,value:l,disabled:f,textValue:N,children:d.jsx(xi.div,{role:"option","aria-labelledby":q,"data-highlighted":$?"":void 0,"aria-selected":I&&$,"data-state":I?"checked":"unchecked","aria-disabled":f||void 0,"data-disabled":f?"":void 0,tabIndex:f?void 0:-1,...x,ref:Y,onFocus:Vn(x.onFocus,()=>V(!0)),onBlur:Vn(x.onBlur,()=>V(!1)),onClick:Vn(x.onClick,()=>{Z.current!=="mouse"&&Q()}),onPointerUp:Vn(x.onPointerUp,()=>{Z.current==="mouse"&&Q()}),onPointerDown:Vn(x.onPointerDown,H=>{Z.current=H.pointerType}),onPointerMove:Vn(x.onPointerMove,H=>{var K;Z.current=H.pointerType,f?(K=A.onItemLeave)==null||K.call(A):Z.current==="mouse"&&H.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Vn(x.onPointerLeave,H=>{var K;H.currentTarget===document.activeElement&&((K=A.onItemLeave)==null||K.call(A))}),onKeyDown:Vn(x.onKeyDown,H=>{var ne;((ne=A.searchRef)==null?void 0:ne.current)!==""&&H.key===" "||(Aie.includes(H.key)&&Q(),H.key===" "&&H.preventDefault())})})})})});S6.displayName=zT;var S0="SelectItemText",T6=F.forwardRef((e,t)=>{const{__scopeSelect:i,className:l,style:f,..._}=e,x=ep(S0,i),o=tp(S0,i),A=w6(S0,i),I=Pie(S0,i),[N,U]=F.useState(null),$=bs(t,Q=>U(Q),A.onItemTextChange,Q=>{var H;return(H=o.itemTextRefCallback)==null?void 0:H.call(o,Q,A.value,A.disabled)}),V=N==null?void 0:N.textContent,Y=F.useMemo(()=>d.jsx("option",{value:A.value,disabled:A.disabled,children:V},A.value),[A.disabled,A.value,V]),{onNativeOptionAdd:q,onNativeOptionRemove:Z}=I;return ha(()=>(q(Y),()=>Z(Y)),[q,Z,Y]),d.jsxs(d.Fragment,{children:[d.jsx(xi.span,{id:A.textId,..._,ref:$}),A.isSelected&&x.valueNode&&!x.valueNodeHasChildren?Gm.createPortal(_.children,x.valueNode):null]})});T6.displayName=S0;var E6="SelectItemIndicator",C6=F.forwardRef((e,t)=>{const{__scopeSelect:i,...l}=e;return w6(E6,i).isSelected?d.jsx(xi.span,{"aria-hidden":!0,...l,ref:t}):null});C6.displayName=E6;var WI="SelectScrollUpButton",A6=F.forwardRef((e,t)=>{const i=tp(WI,e.__scopeSelect),l=UP(WI,e.__scopeSelect),[f,_]=F.useState(!1),x=bs(t,l.onScrollButtonChange);return ha(()=>{if(i.viewport&&i.isPositioned){let o=function(){const I=A.scrollTop>0;_(I)};const A=i.viewport;return o(),A.addEventListener("scroll",o),()=>A.removeEventListener("scroll",o)}},[i.viewport,i.isPositioned]),f?d.jsx(I6,{...e,ref:x,onAutoScroll:()=>{const{viewport:o,selectedItem:A}=i;o&&A&&(o.scrollTop=o.scrollTop-A.offsetHeight)}}):null});A6.displayName=WI;var ZI="SelectScrollDownButton",j6=F.forwardRef((e,t)=>{const i=tp(ZI,e.__scopeSelect),l=UP(ZI,e.__scopeSelect),[f,_]=F.useState(!1),x=bs(t,l.onScrollButtonChange);return ha(()=>{if(i.viewport&&i.isPositioned){let o=function(){const I=A.scrollHeight-A.clientHeight,N=Math.ceil(A.scrollTop)<I;_(N)};const A=i.viewport;return o(),A.addEventListener("scroll",o),()=>A.removeEventListener("scroll",o)}},[i.viewport,i.isPositioned]),f?d.jsx(I6,{...e,ref:x,onAutoScroll:()=>{const{viewport:o,selectedItem:A}=i;o&&A&&(o.scrollTop=o.scrollTop+A.offsetHeight)}}):null});j6.displayName=ZI;var I6=F.forwardRef((e,t)=>{const{__scopeSelect:i,onAutoScroll:l,...f}=e,_=tp("SelectScrollButton",i),x=F.useRef(null),o=k2(i),A=F.useCallback(()=>{x.current!==null&&(window.clearInterval(x.current),x.current=null)},[]);return F.useEffect(()=>()=>A(),[A]),ha(()=>{var N;const I=o().find(U=>U.ref.current===document.activeElement);(N=I==null?void 0:I.ref.current)==null||N.scrollIntoView({block:"nearest"})},[o]),d.jsx(xi.div,{"aria-hidden":!0,...f,ref:t,style:{flexShrink:0,...f.style},onPointerDown:Vn(f.onPointerDown,()=>{x.current===null&&(x.current=window.setInterval(l,50))}),onPointerMove:Vn(f.onPointerMove,()=>{var I;(I=_.onItemLeave)==null||I.call(_),x.current===null&&(x.current=window.setInterval(l,50))}),onPointerLeave:Vn(f.onPointerLeave,()=>{A()})})}),$ie="SelectSeparator",k6=F.forwardRef((e,t)=>{const{__scopeSelect:i,...l}=e;return d.jsx(xi.div,{"aria-hidden":!0,...l,ref:t})});k6.displayName=$ie;var XI="SelectArrow",qie=F.forwardRef((e,t)=>{const{__scopeSelect:i,...l}=e,f=P2(i),_=ep(XI,i),x=tp(XI,i);return _.open&&x.position==="popper"?d.jsx(A5,{...f,...l,ref:t}):null});qie.displayName=XI;var Gie="SelectBubbleInput",P6=F.forwardRef(({__scopeSelect:e,value:t,...i},l)=>{const f=F.useRef(null),_=bs(l,f),x=o6(t);return F.useEffect(()=>{const o=f.current;if(!o)return;const A=window.HTMLSelectElement.prototype,N=Object.getOwnPropertyDescriptor(A,"value").set;if(x!==t&&N){const U=new Event("change",{bubbles:!0});N.call(o,t),o.dispatchEvent(U)}},[x,t]),d.jsx(xi.select,{...i,style:{...m4,...i.style},ref:_,defaultValue:t})});P6.displayName=Gie;function R6(e){return e===""||e===void 0}function M6(e){const t=vc(e),i=F.useRef(""),l=F.useRef(0),f=F.useCallback(x=>{const o=i.current+x;t(o),function A(I){i.current=I,window.clearTimeout(l.current),I!==""&&(l.current=window.setTimeout(()=>A(""),1e3))}(o)},[t]),_=F.useCallback(()=>{i.current="",window.clearTimeout(l.current)},[]);return F.useEffect(()=>()=>window.clearTimeout(l.current),[]),[i,f,_]}function N6(e,t,i){const f=t.length>1&&Array.from(t).every(I=>I===t[0])?t[0]:t,_=i?e.indexOf(i):-1;let x=Hie(e,Math.max(_,0));f.length===1&&(x=x.filter(I=>I!==i));const A=x.find(I=>I.textValue.toLowerCase().startsWith(f.toLowerCase()));return A!==i?A:void 0}function Hie(e,t){return e.map((i,l)=>e[(t+l)%e.length])}var Wie=a6,D6=c6,Zie=d6,Xie=h6,Kie=f6,O6=p6,Yie=y6,L6=b6,z6=S6,Jie=T6,Qie=C6,F6=A6,B6=j6,V6=k6;const Vr=Wie,Ur=Zie,Or=F.forwardRef(({className:e,children:t,...i},l)=>d.jsxs(D6,{ref:l,className:wr("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...i,children:[t,d.jsx(Xie,{asChild:!0,children:d.jsx(F4,{className:"h-4 w-4 opacity-50"})})]}));Or.displayName=D6.displayName;const U6=F.forwardRef(({className:e,...t},i)=>d.jsx(F6,{ref:i,className:wr("flex cursor-default items-center justify-center py-1",e),...t,children:d.jsx(NZ,{className:"h-4 w-4"})}));U6.displayName=F6.displayName;const $6=F.forwardRef(({className:e,...t},i)=>d.jsx(B6,{ref:i,className:wr("flex cursor-default items-center justify-center py-1",e),...t,children:d.jsx(F4,{className:"h-4 w-4"})}));$6.displayName=B6.displayName;const Lr=F.forwardRef(({className:e,children:t,position:i="popper",...l},f)=>d.jsx(Kie,{children:d.jsxs(O6,{ref:f,className:wr("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",i==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:i,...l,children:[d.jsx(U6,{}),d.jsx(Yie,{className:wr("p-1",i==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),d.jsx($6,{})]})}));Lr.displayName=O6.displayName;const ese=F.forwardRef(({className:e,...t},i)=>d.jsx(L6,{ref:i,className:wr("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t}));ese.displayName=L6.displayName;const bt=F.forwardRef(({className:e,children:t,...i},l)=>d.jsxs(z6,{ref:l,className:wr("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),...i,children:[d.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:d.jsx(Qie,{children:d.jsx(z4,{className:"h-4 w-4"})})}),d.jsx(Jie,{children:t})]}));bt.displayName=z6.displayName;const tse=F.forwardRef(({className:e,...t},i)=>d.jsx(V6,{ref:i,className:wr("-mx-1 my-1 h-px bg-muted",e),...t}));tse.displayName=V6.displayName;const rse=()=>{const[e,t]=F.useState([]),[i,l]=F.useState([]),[f,_]=F.useState(""),[x,o]=F.useState(!0),[A,I]=F.useState(!1),N=_u(),{toast:U}=Hf();F.useEffect(()=>{$()},[]),F.useEffect(()=>{Y()},[f,e]);const $=async()=>{try{const{data:{user:H}}=await Ge.auth.getUser();if(!H){N("/auth");return}const{data:K}=await Ge.from("user_roles").select("role").eq("user_id",H.id).single();if((K==null?void 0:K.role)!=="admin"){U({title:"Acesso negado",description:"Apenas administradores podem acessar esta pgina.",variant:"destructive"}),N("/dashboard");return}I(!0),await V()}catch(H){console.error("Error:",H)}finally{o(!1)}},V=async()=>{try{const{data:H,error:K}=await Ge.from("profiles").select(`
          id,
          email,
          full_name,
          phone,
          user_roles (role)
        `);if(K)throw K;const ne=(H==null?void 0:H.map(le=>{var pe,Ae;return{id:le.id,email:le.email,full_name:le.full_name,phone:le.phone,role:((Ae=(pe=le.user_roles)==null?void 0:pe[0])==null?void 0:Ae.role)||"tecnico"}}))||[];t(ne),l(ne)}catch(H){U({title:"Erro ao carregar usurios",description:H.message,variant:"destructive"})}},Y=()=>{if(!f.trim()){l(e);return}const H=f.toLowerCase(),K=e.filter(ne=>{var le,pe;return((le=ne.email)==null?void 0:le.toLowerCase().includes(H))||((pe=ne.full_name)==null?void 0:pe.toLowerCase().includes(H))});l(K)},q=async(H,K)=>{try{const{error:ne}=await Ge.from("user_roles").update({role:K}).eq("user_id",H);if(ne)throw ne;U({title:"Perfil atualizado",description:"O perfil do usurio foi alterado com sucesso."}),await V()}catch(ne){U({title:"Erro ao atualizar perfil",description:ne.message,variant:"destructive"})}},Z={admin:"Administrador",gestor_operacoes:"Gestor de Operaes",supervisor:"Supervisor",analista_centro_controle:"Analista Centro Controle",tecnico:"Tcnico",cliente_view:"Cliente (Visualizao)"},Q=H=>({admin:"bg-red-500",gestor_operacoes:"bg-purple-500",supervisor:"bg-blue-500",analista_centro_controle:"bg-cyan-500",tecnico:"bg-green-500",cliente_view:"bg-gray-500"})[H]||"bg-gray-500";return x?d.jsx("div",{className:"min-h-screen flex items-center justify-center",children:d.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):A?d.jsx(bo,{children:d.jsxs("div",{className:"min-h-screen bg-background",children:[d.jsx("header",{className:"border-b bg-card shadow-sm",children:d.jsx("div",{className:"container mx-auto px-4 py-4",children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"p-2 bg-gradient-to-br from-primary to-accent rounded-lg",children:d.jsx(Lf,{className:"h-6 w-6 text-primary-foreground"})}),d.jsxs("div",{children:[d.jsx("h1",{className:"text-xl font-bold",children:"Facilities Center"}),d.jsx("p",{className:"text-sm text-muted-foreground",children:"Gesto de Usurios"})]})]})})}),d.jsxs("main",{className:"container mx-auto px-4 py-8",children:[d.jsxs("div",{className:"mb-6",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[d.jsx(nP,{className:"h-6 w-6 text-primary"}),d.jsx("h2",{className:"text-2xl font-bold",children:"Gesto de Perfis de Usurios"})]}),d.jsx("p",{className:"text-muted-foreground mb-6",children:"Gerencie os perfis de acesso de todos os usurios do sistema"}),d.jsxs("div",{className:"relative max-w-md",children:[d.jsx(ou,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),d.jsx(gr,{placeholder:"Buscar por nome ou email...",value:f,onChange:H=>_(H.target.value),className:"pl-10"})]})]}),d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map(H=>d.jsxs(Sr,{className:"hover:shadow-md transition-shadow",children:[d.jsx(wn,{children:d.jsx("div",{className:"flex items-start justify-between",children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:d.jsx(QZ,{className:"h-5 w-5 text-primary"})}),d.jsxs("div",{children:[d.jsx(An,{className:"text-base",children:H.full_name||"Sem nome"}),d.jsx(fs,{className:"text-xs",children:H.email})]})]})})}),d.jsx(tn,{children:d.jsxs("div",{className:"space-y-3",children:[H.phone&&d.jsxs("p",{className:"text-sm text-muted-foreground",children:["Tel: ",H.phone]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:"text-sm font-medium",children:"Perfil de Acesso"}),d.jsxs(Vr,{value:H.role,onValueChange:K=>q(H.id,K),children:[d.jsx(Or,{children:d.jsx(Ur,{})}),d.jsx(Lr,{children:Object.entries(Z).map(([K,ne])=>d.jsx(bt,{value:K,children:d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("div",{className:`w-2 h-2 rounded-full ${Q(K)}`}),ne]})},K))})]})]}),d.jsx(Gn,{className:`${Q(H.role)} text-white`,children:Z[H.role]})]})})]},H.id))}),i.length===0&&d.jsx(Sr,{className:"mt-8",children:d.jsx(tn,{className:"py-12 text-center",children:d.jsx("p",{className:"text-muted-foreground",children:"Nenhum usurio encontrado com os filtros aplicados."})})})]})]})}):null},nse=Rb({password:ca().min(6,{message:"Senha deve ter no mnimo 6 caracteres"}).max(72,{message:"Senha deve ter no mximo 72 caracteres"}),confirmPassword:ca()}).refine(e=>e.password===e.confirmPassword,{message:"As senhas no coincidem",path:["confirmPassword"]}),ise=()=>{const[e,t]=F.useState(""),[i,l]=F.useState(""),[f,_]=F.useState(!1),[x,o]=F.useState(!1),A=_u(),{toast:I}=Hf();F.useEffect(()=>{Ge.auth.getSession().then(({data:{session:U}})=>{U?o(!0):(I({title:"Sesso invlida",description:"O link de redefinio expirou ou  invlido.",variant:"destructive"}),A("/auth"))})},[A,I]);const N=async U=>{U.preventDefault(),_(!0);try{const $=nse.parse({password:e,confirmPassword:i}),{error:V}=await Ge.auth.updateUser({password:$.password});if(V)throw V;I({title:"Senha redefinida!",description:"Sua senha foi alterada com sucesso. Faa login com a nova senha."}),await Ge.auth.signOut(),A("/auth")}catch($){$ instanceof xc?I({title:"Erro de validao",description:$.errors[0].message,variant:"destructive"}):I({title:"Erro",description:$.message||"No foi possvel redefinir a senha",variant:"destructive"})}finally{_(!1)}};return x?d.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-primary/5 via-background to-accent/5 p-4",children:d.jsxs(Sr,{className:"w-full max-w-md shadow-lg",children:[d.jsxs(wn,{className:"space-y-3 text-center",children:[d.jsx("div",{className:"flex justify-center mb-2",children:d.jsx("div",{className:"p-3 bg-gradient-to-br from-destructive to-destructive/80 rounded-xl",children:d.jsx(UZ,{className:"h-8 w-8 text-destructive-foreground"})})}),d.jsx(An,{className:"text-2xl font-bold",children:"Nova Senha"}),d.jsx(fs,{children:"Crie uma nova senha segura para sua conta"})]}),d.jsxs(tn,{children:[d.jsxs("form",{onSubmit:N,className:"space-y-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"password",children:"Nova Senha"}),d.jsx(gr,{id:"password",type:"password",placeholder:"",value:e,onChange:U=>t(U.target.value),required:!0,disabled:f,minLength:6,maxLength:72}),d.jsx("p",{className:"text-xs text-muted-foreground",children:"Mnimo de 6 caracteres"})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"confirmPassword",children:"Confirmar Nova Senha"}),d.jsx(gr,{id:"confirmPassword",type:"password",placeholder:"",value:i,onChange:U=>l(U.target.value),required:!0,disabled:f,minLength:6,maxLength:72})]}),d.jsx(Bt,{type:"submit",className:"w-full",disabled:f,children:f?d.jsxs(d.Fragment,{children:[d.jsx(nd,{className:"mr-2 h-4 w-4 animate-spin"}),"Redefinindo..."]}):"Redefinir Senha"})]}),d.jsx("div",{className:"mt-6 text-center",children:d.jsx("button",{type:"button",onClick:()=>A("/auth"),className:"text-sm text-muted-foreground hover:text-primary",disabled:f,children:"Voltar para login"})})]})]})}):null},Jl=F.forwardRef(({className:e,...t},i)=>d.jsx("div",{className:"relative w-full overflow-auto",children:d.jsx("table",{ref:i,className:wr("w-full caption-bottom text-sm",e),...t})}));Jl.displayName="Table";const Ql=F.forwardRef(({className:e,...t},i)=>d.jsx("thead",{ref:i,className:wr("[&_tr]:border-b",e),...t}));Ql.displayName="TableHeader";const ec=F.forwardRef(({className:e,...t},i)=>d.jsx("tbody",{ref:i,className:wr("[&_tr:last-child]:border-0",e),...t}));ec.displayName="TableBody";const sse=F.forwardRef(({className:e,...t},i)=>d.jsx("tfoot",{ref:i,className:wr("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t}));sse.displayName="TableFooter";const Yi=F.forwardRef(({className:e,...t},i)=>d.jsx("tr",{ref:i,className:wr("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",e),...t}));Yi.displayName="TableRow";const Yr=F.forwardRef(({className:e,...t},i)=>d.jsx("th",{ref:i,className:wr("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));Yr.displayName="TableHead";const Pr=F.forwardRef(({className:e,...t},i)=>d.jsx("td",{ref:i,className:wr("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));Pr.displayName="TableCell";const ose=F.forwardRef(({className:e,...t},i)=>d.jsx("caption",{ref:i,className:wr("mt-4 text-sm text-muted-foreground",e),...t}));ose.displayName="TableCaption";var zb=e=>e.type==="checkbox",pm=e=>e instanceof Date,Xa=e=>e==null;const q6=e=>typeof e=="object";var Co=e=>!Xa(e)&&!Array.isArray(e)&&q6(e)&&!pm(e),G6=e=>Co(e)&&e.target?zb(e.target)?e.target.checked:e.target.value:e,ase=e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e,H6=(e,t)=>e.has(ase(t)),lse=e=>{const t=e.constructor&&e.constructor.prototype;return Co(t)&&t.hasOwnProperty("isPrototypeOf")},$P=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Go(e){let t;const i=Array.isArray(e),l=typeof FileList<"u"?e instanceof FileList:!1;if(e instanceof Date)t=new Date(e);else if(!($P&&(e instanceof Blob||l))&&(i||Co(e)))if(t=i?[]:{},!i&&!lse(e))t=e;else for(const f in e)e.hasOwnProperty(f)&&(t[f]=Go(e[f]));else return e;return t}var R2=e=>/^\w*$/.test(e),To=e=>e===void 0,qP=e=>Array.isArray(e)?e.filter(Boolean):[],GP=e=>qP(e.replace(/["|']|\]/g,"").split(/\.|\[/)),en=(e,t,i)=>{if(!t||!Co(e))return i;const l=(R2(t)?[t]:GP(t)).reduce((f,_)=>Xa(f)?f:f[_],e);return To(l)||l===e?To(e[t])?i:e[t]:l},Fl=e=>typeof e=="boolean",Ts=(e,t,i)=>{let l=-1;const f=R2(t)?[t]:GP(t),_=f.length,x=_-1;for(;++l<_;){const o=f[l];let A=i;if(l!==x){const I=e[o];A=Co(I)||Array.isArray(I)?I:isNaN(+f[l+1])?{}:[]}if(o==="__proto__"||o==="constructor"||o==="prototype")return;e[o]=A,e=e[o]}};const FT={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},iu={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},kd={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},HP=ar.createContext(null);HP.displayName="HookFormContext";const M2=()=>ar.useContext(HP),cse=e=>{const{children:t,...i}=e;return ar.createElement(HP.Provider,{value:i},t)};var W6=(e,t,i,l=!0)=>{const f={defaultValues:t._defaultValues};for(const _ in e)Object.defineProperty(f,_,{get:()=>{const x=_;return t._proxyFormState[x]!==iu.all&&(t._proxyFormState[x]=!l||iu.all),i&&(i[x]=!0),e[x]}});return f};const WP=typeof window<"u"?ar.useLayoutEffect:ar.useEffect;function use(e){const t=M2(),{control:i=t.control,disabled:l,name:f,exact:_}=e||{},[x,o]=ar.useState(i._formState),A=ar.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1});return WP(()=>i._subscribe({name:f,formState:A.current,exact:_,callback:I=>{!l&&o({...i._formState,...I})}}),[f,l,_]),ar.useEffect(()=>{A.current.isValid&&i._setValid(!0)},[i]),ar.useMemo(()=>W6(x,i,A.current,!1),[x,i])}var Wu=e=>typeof e=="string",Z6=(e,t,i,l,f)=>Wu(e)?(l&&t.watch.add(e),en(i,e,f)):Array.isArray(e)?e.map(_=>(l&&t.watch.add(_),en(i,_))):(l&&(t.watchAll=!0),i),KI=e=>Xa(e)||!q6(e);function zd(e,t,i=new WeakSet){if(KI(e)||KI(t))return e===t;if(pm(e)&&pm(t))return e.getTime()===t.getTime();const l=Object.keys(e),f=Object.keys(t);if(l.length!==f.length)return!1;if(i.has(e)||i.has(t))return!0;i.add(e),i.add(t);for(const _ of l){const x=e[_];if(!f.includes(_))return!1;if(_!=="ref"){const o=t[_];if(pm(x)&&pm(o)||Co(x)&&Co(o)||Array.isArray(x)&&Array.isArray(o)?!zd(x,o,i):x!==o)return!1}}return!0}function dse(e){const t=M2(),{control:i=t.control,name:l,defaultValue:f,disabled:_,exact:x,compute:o}=e||{},A=ar.useRef(f),I=ar.useRef(o),N=ar.useRef(void 0);I.current=o;const U=ar.useMemo(()=>i._getWatch(l,A.current),[i,l]),[$,V]=ar.useState(I.current?I.current(U):U);return WP(()=>i._subscribe({name:l,formState:{values:!0},exact:x,callback:Y=>{if(!_){const q=Z6(l,i._names,Y.values||i._formValues,!1,A.current);if(I.current){const Z=I.current(q);zd(Z,N.current)||(V(Z),N.current=Z)}else V(q)}}}),[i,_,l,x]),ar.useEffect(()=>i._removeUnmounted()),$}function hse(e){const t=M2(),{name:i,disabled:l,control:f=t.control,shouldUnregister:_,defaultValue:x}=e,o=H6(f._names.array,i),A=ar.useMemo(()=>en(f._formValues,i,en(f._defaultValues,i,x)),[f,i,x]),I=dse({control:f,name:i,defaultValue:A,exact:!0}),N=use({control:f,name:i,exact:!0}),U=ar.useRef(e),$=ar.useRef(f.register(i,{...e.rules,value:I,...Fl(e.disabled)?{disabled:e.disabled}:{}}));U.current=e;const V=ar.useMemo(()=>Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!en(N.errors,i)},isDirty:{enumerable:!0,get:()=>!!en(N.dirtyFields,i)},isTouched:{enumerable:!0,get:()=>!!en(N.touchedFields,i)},isValidating:{enumerable:!0,get:()=>!!en(N.validatingFields,i)},error:{enumerable:!0,get:()=>en(N.errors,i)}}),[N,i]),Y=ar.useCallback(H=>$.current.onChange({target:{value:G6(H),name:i},type:FT.CHANGE}),[i]),q=ar.useCallback(()=>$.current.onBlur({target:{value:en(f._formValues,i),name:i},type:FT.BLUR}),[i,f._formValues]),Z=ar.useCallback(H=>{const K=en(f._fields,i);K&&H&&(K._f.ref={focus:()=>H.focus&&H.focus(),select:()=>H.select&&H.select(),setCustomValidity:ne=>H.setCustomValidity(ne),reportValidity:()=>H.reportValidity()})},[f._fields,i]),Q=ar.useMemo(()=>({name:i,value:I,...Fl(l)||N.disabled?{disabled:N.disabled||l}:{},onChange:Y,onBlur:q,ref:Z}),[i,l,N.disabled,Y,q,Z,I]);return ar.useEffect(()=>{const H=f._options.shouldUnregister||_;f.register(i,{...U.current.rules,...Fl(U.current.disabled)?{disabled:U.current.disabled}:{}});const K=(ne,le)=>{const pe=en(f._fields,ne);pe&&pe._f&&(pe._f.mount=le)};if(K(i,!0),H){const ne=Go(en(f._options.defaultValues,i));Ts(f._defaultValues,i,ne),To(en(f._formValues,i))&&Ts(f._formValues,i,ne)}return!o&&f.register(i),()=>{(o?H&&!f._state.action:H)?f.unregister(i):K(i,!1)}},[i,f,o,_]),ar.useEffect(()=>{f._setDisabledField({disabled:l,name:i})},[l,i,f]),ar.useMemo(()=>({field:Q,formState:N,fieldState:V}),[Q,N,V])}const fse=e=>e.render(hse(e));var X6=(e,t,i,l,f)=>t?{...i[e],types:{...i[e]&&i[e].types?i[e].types:{},[l]:f||!0}}:{},z0=e=>Array.isArray(e)?e:[e],sF=()=>{let e=[];return{get observers(){return e},next:f=>{for(const _ of e)_.next&&_.next(f)},subscribe:f=>(e.push(f),{unsubscribe:()=>{e=e.filter(_=>_!==f)}}),unsubscribe:()=>{e=[]}}},vl=e=>Co(e)&&!Object.keys(e).length,ZP=e=>e.type==="file",su=e=>typeof e=="function",BT=e=>{if(!$P)return!1;const t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},K6=e=>e.type==="select-multiple",XP=e=>e.type==="radio",pse=e=>XP(e)||zb(e),$A=e=>BT(e)&&e.isConnected;function mse(e,t){const i=t.slice(0,-1).length;let l=0;for(;l<i;)e=To(e)?l++:e[t[l++]];return e}function gse(e){for(const t in e)if(e.hasOwnProperty(t)&&!To(e[t]))return!1;return!0}function No(e,t){const i=Array.isArray(t)?t:R2(t)?[t]:GP(t),l=i.length===1?e:mse(e,i),f=i.length-1,_=i[f];return l&&delete l[_],f!==0&&(Co(l)&&vl(l)||Array.isArray(l)&&gse(l))&&No(e,i.slice(0,-1)),e}var Y6=e=>{for(const t in e)if(su(e[t]))return!0;return!1};function VT(e,t={}){const i=Array.isArray(e);if(Co(e)||i)for(const l in e)Array.isArray(e[l])||Co(e[l])&&!Y6(e[l])?(t[l]=Array.isArray(e[l])?[]:{},VT(e[l],t[l])):Xa(e[l])||(t[l]=!0);return t}function J6(e,t,i){const l=Array.isArray(e);if(Co(e)||l)for(const f in e)Array.isArray(e[f])||Co(e[f])&&!Y6(e[f])?To(t)||KI(i[f])?i[f]=Array.isArray(e[f])?VT(e[f],[]):{...VT(e[f])}:J6(e[f],Xa(t)?{}:t[f],i[f]):i[f]=!zd(e[f],t[f]);return i}var f0=(e,t)=>J6(e,t,VT(t));const oF={value:!1,isValid:!1},aF={value:!0,isValid:!0};var Q6=e=>{if(Array.isArray(e)){if(e.length>1){const t=e.filter(i=>i&&i.checked&&!i.disabled).map(i=>i.value);return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!To(e[0].attributes.value)?To(e[0].value)||e[0].value===""?aF:{value:e[0].value,isValid:!0}:aF:oF}return oF},e$=(e,{valueAsNumber:t,valueAsDate:i,setValueAs:l})=>To(e)?e:t?e===""?NaN:e&&+e:i&&Wu(e)?new Date(e):l?l(e):e;const lF={isValid:!1,value:null};var t$=e=>Array.isArray(e)?e.reduce((t,i)=>i&&i.checked&&!i.disabled?{isValid:!0,value:i.value}:t,lF):lF;function cF(e){const t=e.ref;return ZP(t)?t.files:XP(t)?t$(e.refs).value:K6(t)?[...t.selectedOptions].map(({value:i})=>i):zb(t)?Q6(e.refs).value:e$(To(t.value)?e.ref.value:t.value,e)}var _se=(e,t,i,l)=>{const f={};for(const _ of e){const x=en(t,_);x&&Ts(f,_,x._f)}return{criteriaMode:i,names:[...e],fields:f,shouldUseNativeValidation:l}},UT=e=>e instanceof RegExp,p0=e=>To(e)?e:UT(e)?e.source:Co(e)?UT(e.value)?e.value.source:e.value:e,uF=e=>({isOnSubmit:!e||e===iu.onSubmit,isOnBlur:e===iu.onBlur,isOnChange:e===iu.onChange,isOnAll:e===iu.all,isOnTouch:e===iu.onTouched});const dF="AsyncFunction";var yse=e=>!!e&&!!e.validate&&!!(su(e.validate)&&e.validate.constructor.name===dF||Co(e.validate)&&Object.values(e.validate).find(t=>t.constructor.name===dF)),vse=e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate),hF=(e,t,i)=>!i&&(t.watchAll||t.watch.has(e)||[...t.watch].some(l=>e.startsWith(l)&&/^\.\w+/.test(e.slice(l.length))));const F0=(e,t,i,l)=>{for(const f of i||Object.keys(e)){const _=en(e,f);if(_){const{_f:x,...o}=_;if(x){if(x.refs&&x.refs[0]&&t(x.refs[0],f)&&!l)return!0;if(x.ref&&t(x.ref,x.name)&&!l)return!0;if(F0(o,t))break}else if(Co(o)&&F0(o,t))break}}};function fF(e,t,i){const l=en(e,i);if(l||R2(i))return{error:l,name:i};const f=i.split(".");for(;f.length;){const _=f.join("."),x=en(t,_),o=en(e,_);if(x&&!Array.isArray(x)&&i!==_)return{name:i};if(o&&o.type)return{name:_,error:o};if(o&&o.root&&o.root.type)return{name:`${_}.root`,error:o.root};f.pop()}return{name:i}}var xse=(e,t,i,l)=>{i(e);const{name:f,..._}=e;return vl(_)||Object.keys(_).length>=Object.keys(t).length||Object.keys(_).find(x=>t[x]===(!l||iu.all))},bse=(e,t,i)=>!e||!t||e===t||z0(e).some(l=>l&&(i?l===t:l.startsWith(t)||t.startsWith(l))),wse=(e,t,i,l,f)=>f.isOnAll?!1:!i&&f.isOnTouch?!(t||e):(i?l.isOnBlur:f.isOnBlur)?!e:(i?l.isOnChange:f.isOnChange)?e:!0,Sse=(e,t)=>!qP(en(e,t)).length&&No(e,t),Tse=(e,t,i)=>{const l=z0(en(e,i));return Ts(l,"root",t[i]),Ts(e,i,l),e},qS=e=>Wu(e);function pF(e,t,i="validate"){if(qS(e)||Array.isArray(e)&&e.every(qS)||Fl(e)&&!e)return{type:i,message:qS(e)?e:"",ref:t}}var I_=e=>Co(e)&&!UT(e)?e:{value:e,message:""},mF=async(e,t,i,l,f,_)=>{const{ref:x,refs:o,required:A,maxLength:I,minLength:N,min:U,max:$,pattern:V,validate:Y,name:q,valueAsNumber:Z,mount:Q}=e._f,H=en(i,q);if(!Q||t.has(q))return{};const K=o?o[0]:x,ne=xe=>{f&&K.reportValidity&&(K.setCustomValidity(Fl(xe)?"":xe||""),K.reportValidity())},le={},pe=XP(x),Ae=zb(x),Ze=pe||Ae,Xe=(Z||ZP(x))&&To(x.value)&&To(H)||BT(x)&&x.value===""||H===""||Array.isArray(H)&&!H.length,Je=X6.bind(null,q,l,le),Te=(xe,Be,dt,qt=kd.maxLength,Ke=kd.minLength)=>{const st=xe?Be:dt;le[q]={type:xe?qt:Ke,message:st,ref:x,...Je(xe?qt:Ke,st)}};if(_?!Array.isArray(H)||!H.length:A&&(!Ze&&(Xe||Xa(H))||Fl(H)&&!H||Ae&&!Q6(o).isValid||pe&&!t$(o).isValid)){const{value:xe,message:Be}=qS(A)?{value:!!A,message:A}:I_(A);if(xe&&(le[q]={type:kd.required,message:Be,ref:K,...Je(kd.required,Be)},!l))return ne(Be),le}if(!Xe&&(!Xa(U)||!Xa($))){let xe,Be;const dt=I_($),qt=I_(U);if(!Xa(H)&&!isNaN(H)){const Ke=x.valueAsNumber||H&&+H;Xa(dt.value)||(xe=Ke>dt.value),Xa(qt.value)||(Be=Ke<qt.value)}else{const Ke=x.valueAsDate||new Date(H),st=Tt=>new Date(new Date().toDateString()+" "+Tt),Ne=x.type=="time",De=x.type=="week";Wu(dt.value)&&H&&(xe=Ne?st(H)>st(dt.value):De?H>dt.value:Ke>new Date(dt.value)),Wu(qt.value)&&H&&(Be=Ne?st(H)<st(qt.value):De?H<qt.value:Ke<new Date(qt.value))}if((xe||Be)&&(Te(!!xe,dt.message,qt.message,kd.max,kd.min),!l))return ne(le[q].message),le}if((I||N)&&!Xe&&(Wu(H)||_&&Array.isArray(H))){const xe=I_(I),Be=I_(N),dt=!Xa(xe.value)&&H.length>+xe.value,qt=!Xa(Be.value)&&H.length<+Be.value;if((dt||qt)&&(Te(dt,xe.message,Be.message),!l))return ne(le[q].message),le}if(V&&!Xe&&Wu(H)){const{value:xe,message:Be}=I_(V);if(UT(xe)&&!H.match(xe)&&(le[q]={type:kd.pattern,message:Be,ref:x,...Je(kd.pattern,Be)},!l))return ne(Be),le}if(Y){if(su(Y)){const xe=await Y(H,i),Be=pF(xe,K);if(Be&&(le[q]={...Be,...Je(kd.validate,Be.message)},!l))return ne(Be.message),le}else if(Co(Y)){let xe={};for(const Be in Y){if(!vl(xe)&&!l)break;const dt=pF(await Y[Be](H,i),K,Be);dt&&(xe={...dt,...Je(Be,dt.message)},ne(dt.message),l&&(le[q]=xe))}if(!vl(xe)&&(le[q]={ref:K,...xe},!l))return le}}return ne(!0),le};const Ese={mode:iu.onSubmit,reValidateMode:iu.onChange,shouldFocusError:!0};function Cse(e={}){let t={...Ese,...e},i={submitCount:0,isDirty:!1,isReady:!1,isLoading:su(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},l={},f=Co(t.defaultValues)||Co(t.values)?Go(t.defaultValues||t.values)||{}:{},_=t.shouldUnregister?{}:Go(f),x={action:!1,mount:!1,watch:!1},o={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},A,I=0;const N={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let U={...N};const $={array:sF(),state:sF()},V=t.criteriaMode===iu.all,Y=nt=>Ct=>{clearTimeout(I),I=setTimeout(nt,Ct)},q=async nt=>{if(!t.disabled&&(N.isValid||U.isValid||nt)){const Ct=t.resolver?vl((await Ae()).errors):await Xe(l,!0);Ct!==i.isValid&&$.state.next({isValid:Ct})}},Z=(nt,Ct)=>{!t.disabled&&(N.isValidating||N.validatingFields||U.isValidating||U.validatingFields)&&((nt||Array.from(o.mount)).forEach(Kt=>{Kt&&(Ct?Ts(i.validatingFields,Kt,Ct):No(i.validatingFields,Kt))}),$.state.next({validatingFields:i.validatingFields,isValidating:!vl(i.validatingFields)}))},Q=(nt,Ct=[],Kt,jr,yr=!0,br=!0)=>{if(jr&&Kt&&!t.disabled){if(x.action=!0,br&&Array.isArray(en(l,nt))){const Fr=Kt(en(l,nt),jr.argA,jr.argB);yr&&Ts(l,nt,Fr)}if(br&&Array.isArray(en(i.errors,nt))){const Fr=Kt(en(i.errors,nt),jr.argA,jr.argB);yr&&Ts(i.errors,nt,Fr),Sse(i.errors,nt)}if((N.touchedFields||U.touchedFields)&&br&&Array.isArray(en(i.touchedFields,nt))){const Fr=Kt(en(i.touchedFields,nt),jr.argA,jr.argB);yr&&Ts(i.touchedFields,nt,Fr)}(N.dirtyFields||U.dirtyFields)&&(i.dirtyFields=f0(f,_)),$.state.next({name:nt,isDirty:Te(nt,Ct),dirtyFields:i.dirtyFields,errors:i.errors,isValid:i.isValid})}else Ts(_,nt,Ct)},H=(nt,Ct)=>{Ts(i.errors,nt,Ct),$.state.next({errors:i.errors})},K=nt=>{i.errors=nt,$.state.next({errors:i.errors,isValid:!1})},ne=(nt,Ct,Kt,jr)=>{const yr=en(l,nt);if(yr){const br=en(_,nt,To(Kt)?en(f,nt):Kt);To(br)||jr&&jr.defaultChecked||Ct?Ts(_,nt,Ct?br:cF(yr._f)):dt(nt,br),x.mount&&q()}},le=(nt,Ct,Kt,jr,yr)=>{let br=!1,Fr=!1;const On={name:nt};if(!t.disabled){if(!Kt||jr){(N.isDirty||U.isDirty)&&(Fr=i.isDirty,i.isDirty=On.isDirty=Te(),br=Fr!==On.isDirty);const pi=zd(en(f,nt),Ct);Fr=!!en(i.dirtyFields,nt),pi?No(i.dirtyFields,nt):Ts(i.dirtyFields,nt,!0),On.dirtyFields=i.dirtyFields,br=br||(N.dirtyFields||U.dirtyFields)&&Fr!==!pi}if(Kt){const pi=en(i.touchedFields,nt);pi||(Ts(i.touchedFields,nt,Kt),On.touchedFields=i.touchedFields,br=br||(N.touchedFields||U.touchedFields)&&pi!==Kt)}br&&yr&&$.state.next(On)}return br?On:{}},pe=(nt,Ct,Kt,jr)=>{const yr=en(i.errors,nt),br=(N.isValid||U.isValid)&&Fl(Ct)&&i.isValid!==Ct;if(t.delayError&&Kt?(A=Y(()=>H(nt,Kt)),A(t.delayError)):(clearTimeout(I),A=null,Kt?Ts(i.errors,nt,Kt):No(i.errors,nt)),(Kt?!zd(yr,Kt):yr)||!vl(jr)||br){const Fr={...jr,...br&&Fl(Ct)?{isValid:Ct}:{},errors:i.errors,name:nt};i={...i,...Fr},$.state.next(Fr)}},Ae=async nt=>{Z(nt,!0);const Ct=await t.resolver(_,t.context,_se(nt||o.mount,l,t.criteriaMode,t.shouldUseNativeValidation));return Z(nt),Ct},Ze=async nt=>{const{errors:Ct}=await Ae(nt);if(nt)for(const Kt of nt){const jr=en(Ct,Kt);jr?Ts(i.errors,Kt,jr):No(i.errors,Kt)}else i.errors=Ct;return Ct},Xe=async(nt,Ct,Kt={valid:!0})=>{for(const jr in nt){const yr=nt[jr];if(yr){const{_f:br,...Fr}=yr;if(br){const On=o.array.has(br.name),pi=yr._f&&yse(yr._f);pi&&N.validatingFields&&Z([jr],!0);const Ri=await mF(yr,o.disabled,_,V,t.shouldUseNativeValidation&&!Ct,On);if(pi&&N.validatingFields&&Z([jr]),Ri[br.name]&&(Kt.valid=!1,Ct))break;!Ct&&(en(Ri,br.name)?On?Tse(i.errors,Ri,br.name):Ts(i.errors,br.name,Ri[br.name]):No(i.errors,br.name))}!vl(Fr)&&await Xe(Fr,Ct,Kt)}}return Kt.valid},Je=()=>{for(const nt of o.unMount){const Ct=en(l,nt);Ct&&(Ct._f.refs?Ct._f.refs.every(Kt=>!$A(Kt)):!$A(Ct._f.ref))&&Ut(nt)}o.unMount=new Set},Te=(nt,Ct)=>!t.disabled&&(nt&&Ct&&Ts(_,nt,Ct),!zd(Tt(),f)),xe=(nt,Ct,Kt)=>Z6(nt,o,{...x.mount?_:To(Ct)?f:Wu(nt)?{[nt]:Ct}:Ct},Kt,Ct),Be=nt=>qP(en(x.mount?_:f,nt,t.shouldUnregister?en(f,nt,[]):[])),dt=(nt,Ct,Kt={})=>{const jr=en(l,nt);let yr=Ct;if(jr){const br=jr._f;br&&(!br.disabled&&Ts(_,nt,e$(Ct,br)),yr=BT(br.ref)&&Xa(Ct)?"":Ct,K6(br.ref)?[...br.ref.options].forEach(Fr=>Fr.selected=yr.includes(Fr.value)):br.refs?zb(br.ref)?br.refs.forEach(Fr=>{(!Fr.defaultChecked||!Fr.disabled)&&(Array.isArray(yr)?Fr.checked=!!yr.find(On=>On===Fr.value):Fr.checked=yr===Fr.value||!!yr)}):br.refs.forEach(Fr=>Fr.checked=Fr.value===yr):ZP(br.ref)?br.ref.value="":(br.ref.value=yr,br.ref.type||$.state.next({name:nt,values:Go(_)})))}(Kt.shouldDirty||Kt.shouldTouch)&&le(nt,yr,Kt.shouldTouch,Kt.shouldDirty,!0),Kt.shouldValidate&&De(nt)},qt=(nt,Ct,Kt)=>{for(const jr in Ct){if(!Ct.hasOwnProperty(jr))return;const yr=Ct[jr],br=nt+"."+jr,Fr=en(l,br);(o.array.has(nt)||Co(yr)||Fr&&!Fr._f)&&!pm(yr)?qt(br,yr,Kt):dt(br,yr,Kt)}},Ke=(nt,Ct,Kt={})=>{const jr=en(l,nt),yr=o.array.has(nt),br=Go(Ct);Ts(_,nt,br),yr?($.array.next({name:nt,values:Go(_)}),(N.isDirty||N.dirtyFields||U.isDirty||U.dirtyFields)&&Kt.shouldDirty&&$.state.next({name:nt,dirtyFields:f0(f,_),isDirty:Te(nt,br)})):jr&&!jr._f&&!Xa(br)?qt(nt,br,Kt):dt(nt,br,Kt),hF(nt,o)&&$.state.next({...i,name:nt}),$.state.next({name:x.mount?nt:void 0,values:Go(_)})},st=async nt=>{x.mount=!0;const Ct=nt.target;let Kt=Ct.name,jr=!0;const yr=en(l,Kt),br=pi=>{jr=Number.isNaN(pi)||pm(pi)&&isNaN(pi.getTime())||zd(pi,en(_,Kt,pi))},Fr=uF(t.mode),On=uF(t.reValidateMode);if(yr){let pi,Ri;const $s=Ct.type?cF(yr._f):G6(nt),ws=nt.type===FT.BLUR||nt.type===FT.FOCUS_OUT,Lo=!vse(yr._f)&&!t.resolver&&!en(i.errors,Kt)&&!yr._f.deps||wse(ws,en(i.touchedFields,Kt),i.isSubmitted,On,Fr),ho=hF(Kt,o,ws);Ts(_,Kt,$s),ws?(yr._f.onBlur&&yr._f.onBlur(nt),A&&A(0)):yr._f.onChange&&yr._f.onChange(nt);const rr=le(Kt,$s,ws),yt=!vl(rr)||ho;if(!ws&&$.state.next({name:Kt,type:nt.type,values:Go(_)}),Lo)return(N.isValid||U.isValid)&&(t.mode==="onBlur"?ws&&q():ws||q()),yt&&$.state.next({name:Kt,...ho?{}:rr});if(!ws&&ho&&$.state.next({...i}),t.resolver){const{errors:Ar}=await Ae([Kt]);if(br($s),jr){const Qr=fF(i.errors,l,Kt),Cn=fF(Ar,l,Qr.name||Kt);pi=Cn.error,Kt=Cn.name,Ri=vl(Ar)}}else Z([Kt],!0),pi=(await mF(yr,o.disabled,_,V,t.shouldUseNativeValidation))[Kt],Z([Kt]),br($s),jr&&(pi?Ri=!1:(N.isValid||U.isValid)&&(Ri=await Xe(l,!0)));jr&&(yr._f.deps&&De(yr._f.deps),pe(Kt,Ri,pi,rr))}},Ne=(nt,Ct)=>{if(en(i.errors,Ct)&&nt.focus)return nt.focus(),1},De=async(nt,Ct={})=>{let Kt,jr;const yr=z0(nt);if(t.resolver){const br=await Ze(To(nt)?nt:yr);Kt=vl(br),jr=nt?!yr.some(Fr=>en(br,Fr)):Kt}else nt?(jr=(await Promise.all(yr.map(async br=>{const Fr=en(l,br);return await Xe(Fr&&Fr._f?{[br]:Fr}:Fr)}))).every(Boolean),!(!jr&&!i.isValid)&&q()):jr=Kt=await Xe(l);return $.state.next({...!Wu(nt)||(N.isValid||U.isValid)&&Kt!==i.isValid?{}:{name:nt},...t.resolver||!nt?{isValid:Kt}:{},errors:i.errors}),Ct.shouldFocus&&!jr&&F0(l,Ne,nt?yr:o.mount),jr},Tt=nt=>{const Ct={...x.mount?_:f};return To(nt)?Ct:Wu(nt)?en(Ct,nt):nt.map(Kt=>en(Ct,Kt))},Pt=(nt,Ct)=>({invalid:!!en((Ct||i).errors,nt),isDirty:!!en((Ct||i).dirtyFields,nt),error:en((Ct||i).errors,nt),isValidating:!!en(i.validatingFields,nt),isTouched:!!en((Ct||i).touchedFields,nt)}),fe=nt=>{nt&&z0(nt).forEach(Ct=>No(i.errors,Ct)),$.state.next({errors:nt?i.errors:{}})},Le=(nt,Ct,Kt)=>{const jr=(en(l,nt,{_f:{}})._f||{}).ref,yr=en(i.errors,nt)||{},{ref:br,message:Fr,type:On,...pi}=yr;Ts(i.errors,nt,{...pi,...Ct,ref:jr}),$.state.next({name:nt,errors:i.errors,isValid:!1}),Kt&&Kt.shouldFocus&&jr&&jr.focus&&jr.focus()},vt=(nt,Ct)=>su(nt)?$.state.subscribe({next:Kt=>"values"in Kt&&nt(xe(void 0,Ct),Kt)}):xe(nt,Ct,!0),Wt=nt=>$.state.subscribe({next:Ct=>{bse(nt.name,Ct.name,nt.exact)&&xse(Ct,nt.formState||N,As,nt.reRenderRoot)&&nt.callback({values:{..._},...i,...Ct,defaultValues:f})}}).unsubscribe,Ft=nt=>(x.mount=!0,U={...U,...nt.formState},Wt({...nt,formState:U})),Ut=(nt,Ct={})=>{for(const Kt of nt?z0(nt):o.mount)o.mount.delete(Kt),o.array.delete(Kt),Ct.keepValue||(No(l,Kt),No(_,Kt)),!Ct.keepError&&No(i.errors,Kt),!Ct.keepDirty&&No(i.dirtyFields,Kt),!Ct.keepTouched&&No(i.touchedFields,Kt),!Ct.keepIsValidating&&No(i.validatingFields,Kt),!t.shouldUnregister&&!Ct.keepDefaultValue&&No(f,Kt);$.state.next({values:Go(_)}),$.state.next({...i,...Ct.keepDirty?{isDirty:Te()}:{}}),!Ct.keepIsValid&&q()},vr=({disabled:nt,name:Ct})=>{(Fl(nt)&&x.mount||nt||o.disabled.has(Ct))&&(nt?o.disabled.add(Ct):o.disabled.delete(Ct))},xr=(nt,Ct={})=>{let Kt=en(l,nt);const jr=Fl(Ct.disabled)||Fl(t.disabled);return Ts(l,nt,{...Kt||{},_f:{...Kt&&Kt._f?Kt._f:{ref:{name:nt}},name:nt,mount:!0,...Ct}}),o.mount.add(nt),Kt?vr({disabled:Fl(Ct.disabled)?Ct.disabled:t.disabled,name:nt}):ne(nt,!0,Ct.value),{...jr?{disabled:Ct.disabled||t.disabled}:{},...t.progressive?{required:!!Ct.required,min:p0(Ct.min),max:p0(Ct.max),minLength:p0(Ct.minLength),maxLength:p0(Ct.maxLength),pattern:p0(Ct.pattern)}:{},name:nt,onChange:st,onBlur:st,ref:yr=>{if(yr){xr(nt,Ct),Kt=en(l,nt);const br=To(yr.value)&&yr.querySelectorAll&&yr.querySelectorAll("input,select,textarea")[0]||yr,Fr=pse(br),On=Kt._f.refs||[];if(Fr?On.find(pi=>pi===br):br===Kt._f.ref)return;Ts(l,nt,{_f:{...Kt._f,...Fr?{refs:[...On.filter($A),br,...Array.isArray(en(f,nt))?[{}]:[]],ref:{type:br.type,name:nt}}:{ref:br}}}),ne(nt,!1,void 0,br)}else Kt=en(l,nt,{}),Kt._f&&(Kt._f.mount=!1),(t.shouldUnregister||Ct.shouldUnregister)&&!(H6(o.array,nt)&&x.action)&&o.unMount.add(nt)}}},zr=()=>t.shouldFocusError&&F0(l,Ne,o.mount),Hr=nt=>{Fl(nt)&&($.state.next({disabled:nt}),F0(l,(Ct,Kt)=>{const jr=en(l,Kt);jr&&(Ct.disabled=jr._f.disabled||nt,Array.isArray(jr._f.refs)&&jr._f.refs.forEach(yr=>{yr.disabled=jr._f.disabled||nt}))},0,!1))},jn=(nt,Ct)=>async Kt=>{let jr;Kt&&(Kt.preventDefault&&Kt.preventDefault(),Kt.persist&&Kt.persist());let yr=Go(_);if($.state.next({isSubmitting:!0}),t.resolver){const{errors:br,values:Fr}=await Ae();i.errors=br,yr=Go(Fr)}else await Xe(l);if(o.disabled.size)for(const br of o.disabled)No(yr,br);if(No(i.errors,"root"),vl(i.errors)){$.state.next({errors:{}});try{await nt(yr,Kt)}catch(br){jr=br}}else Ct&&await Ct({...i.errors},Kt),zr(),setTimeout(zr);if($.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:vl(i.errors)&&!jr,submitCount:i.submitCount+1,errors:i.errors}),jr)throw jr},hn=(nt,Ct={})=>{en(l,nt)&&(To(Ct.defaultValue)?Ke(nt,Go(en(f,nt))):(Ke(nt,Ct.defaultValue),Ts(f,nt,Go(Ct.defaultValue))),Ct.keepTouched||No(i.touchedFields,nt),Ct.keepDirty||(No(i.dirtyFields,nt),i.isDirty=Ct.defaultValue?Te(nt,Go(en(f,nt))):Te()),Ct.keepError||(No(i.errors,nt),N.isValid&&q()),$.state.next({...i}))},Ji=(nt,Ct={})=>{const Kt=nt?Go(nt):f,jr=Go(Kt),yr=vl(nt),br=yr?f:jr;if(Ct.keepDefaultValues||(f=Kt),!Ct.keepValues){if(Ct.keepDirtyValues){const Fr=new Set([...o.mount,...Object.keys(f0(f,_))]);for(const On of Array.from(Fr))en(i.dirtyFields,On)?Ts(br,On,en(_,On)):Ke(On,en(br,On))}else{if($P&&To(nt))for(const Fr of o.mount){const On=en(l,Fr);if(On&&On._f){const pi=Array.isArray(On._f.refs)?On._f.refs[0]:On._f.ref;if(BT(pi)){const Ri=pi.closest("form");if(Ri){Ri.reset();break}}}}if(Ct.keepFieldsRef)for(const Fr of o.mount)Ke(Fr,en(br,Fr));else l={}}_=t.shouldUnregister?Ct.keepDefaultValues?Go(f):{}:Go(br),$.array.next({values:{...br}}),$.state.next({values:{...br}})}o={mount:Ct.keepDirtyValues?o.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},x.mount=!N.isValid||!!Ct.keepIsValid||!!Ct.keepDirtyValues,x.watch=!!t.shouldUnregister,$.state.next({submitCount:Ct.keepSubmitCount?i.submitCount:0,isDirty:yr?!1:Ct.keepDirty?i.isDirty:!!(Ct.keepDefaultValues&&!zd(nt,f)),isSubmitted:Ct.keepIsSubmitted?i.isSubmitted:!1,dirtyFields:yr?{}:Ct.keepDirtyValues?Ct.keepDefaultValues&&_?f0(f,_):i.dirtyFields:Ct.keepDefaultValues&&nt?f0(f,nt):Ct.keepDirty?i.dirtyFields:{},touchedFields:Ct.keepTouched?i.touchedFields:{},errors:Ct.keepErrors?i.errors:{},isSubmitSuccessful:Ct.keepIsSubmitSuccessful?i.isSubmitSuccessful:!1,isSubmitting:!1})},Ii=(nt,Ct)=>Ji(su(nt)?nt(_):nt,Ct),Vi=(nt,Ct={})=>{const Kt=en(l,nt),jr=Kt&&Kt._f;if(jr){const yr=jr.refs?jr.refs[0]:jr.ref;yr.focus&&(yr.focus(),Ct.shouldSelect&&su(yr.select)&&yr.select())}},As=nt=>{i={...i,...nt}},Is={control:{register:xr,unregister:Ut,getFieldState:Pt,handleSubmit:jn,setError:Le,_subscribe:Wt,_runSchema:Ae,_focusError:zr,_getWatch:xe,_getDirty:Te,_setValid:q,_setFieldArray:Q,_setDisabledField:vr,_setErrors:K,_getFieldArray:Be,_reset:Ji,_resetDefaultValues:()=>su(t.defaultValues)&&t.defaultValues().then(nt=>{Ii(nt,t.resetOptions),$.state.next({isLoading:!1})}),_removeUnmounted:Je,_disableForm:Hr,_subjects:$,_proxyFormState:N,get _fields(){return l},get _formValues(){return _},get _state(){return x},set _state(nt){x=nt},get _defaultValues(){return f},get _names(){return o},set _names(nt){o=nt},get _formState(){return i},get _options(){return t},set _options(nt){t={...t,...nt}}},subscribe:Ft,trigger:De,register:xr,handleSubmit:jn,watch:vt,setValue:Ke,getValues:Tt,reset:Ii,resetField:hn,clearErrors:fe,unregister:Ut,setError:Le,setFocus:Vi,getFieldState:Pt};return{...Is,formControl:Is}}function KP(e={}){const t=ar.useRef(void 0),i=ar.useRef(void 0),[l,f]=ar.useState({isDirty:!1,isValidating:!1,isLoading:su(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,isReady:!1,defaultValues:su(e.defaultValues)?void 0:e.defaultValues});if(!t.current)if(e.formControl)t.current={...e.formControl,formState:l},e.defaultValues&&!su(e.defaultValues)&&e.formControl.reset(e.defaultValues,e.resetOptions);else{const{formControl:x,...o}=Cse(e);t.current={...o,formState:l}}const _=t.current.control;return _._options=e,WP(()=>{const x=_._subscribe({formState:_._proxyFormState,callback:()=>f({..._._formState}),reRenderRoot:!0});return f(o=>({...o,isReady:!0})),_._formState.isReady=!0,x},[_]),ar.useEffect(()=>_._disableForm(e.disabled),[_,e.disabled]),ar.useEffect(()=>{e.mode&&(_._options.mode=e.mode),e.reValidateMode&&(_._options.reValidateMode=e.reValidateMode)},[_,e.mode,e.reValidateMode]),ar.useEffect(()=>{e.errors&&(_._setErrors(e.errors),_._focusError())},[_,e.errors]),ar.useEffect(()=>{e.shouldUnregister&&_._subjects.state.next({values:_._getWatch()})},[_,e.shouldUnregister]),ar.useEffect(()=>{if(_._proxyFormState.isDirty){const x=_._getDirty();x!==l.isDirty&&_._subjects.state.next({isDirty:x})}},[_,l.isDirty]),ar.useEffect(()=>{e.values&&!zd(e.values,i.current)?(_._reset(e.values,{keepFieldsRef:!0,..._._options.resetOptions}),i.current=e.values,f(x=>({...x}))):_._resetDefaultValues()},[_,e.values]),ar.useEffect(()=>{_._state.mount||(_._setValid(),_._state.mount=!0),_._state.watch&&(_._state.watch=!1,_._subjects.state.next({..._._formState})),_._removeUnmounted()}),t.current.formState=W6(l,_),t.current}const gF=(e,t,i)=>{if(e&&"reportValidity"in e){const l=en(i,t);e.setCustomValidity(l&&l.message||""),e.reportValidity()}},r$=(e,t)=>{for(const i in t.fields){const l=t.fields[i];l&&l.ref&&"reportValidity"in l.ref?gF(l.ref,i,e):l.refs&&l.refs.forEach(f=>gF(f,i,e))}},Ase=(e,t)=>{t.shouldUseNativeValidation&&r$(e,t);const i={};for(const l in e){const f=en(t.fields,l),_=Object.assign(e[l]||{},{ref:f&&f.ref});if(jse(t.names||Object.keys(e),l)){const x=Object.assign({},en(i,l));Ts(x,"root",_),Ts(i,l,x)}else Ts(i,l,_)}return i},jse=(e,t)=>e.some(i=>i.startsWith(t+"."));var Ise=function(e,t){for(var i={};e.length;){var l=e[0],f=l.code,_=l.message,x=l.path.join(".");if(!i[x])if("unionErrors"in l){var o=l.unionErrors[0].errors[0];i[x]={message:o.message,type:o.code}}else i[x]={message:_,type:f};if("unionErrors"in l&&l.unionErrors.forEach(function(N){return N.errors.forEach(function(U){return e.push(U)})}),t){var A=i[x].types,I=A&&A[l.code];i[x]=X6(x,t,i,f,I?[].concat(I,l.message):l.message)}e.shift()}return i},kse=function(e,t,i){return i===void 0&&(i={}),function(l,f,_){try{return Promise.resolve(function(x,o){try{var A=Promise.resolve(e[i.mode==="sync"?"parse":"parseAsync"](l,t)).then(function(I){return _.shouldUseNativeValidation&&r$({},_),{errors:{},values:i.raw?l:I}})}catch(I){return o(I)}return A&&A.then?A.then(void 0,o):A}(0,function(x){if(function(o){return Array.isArray(o==null?void 0:o.errors)}(x))return{values:{},errors:Ase(Ise(x.errors,!_.shouldUseNativeValidation&&_.criteriaMode==="all"),_)};throw x}))}catch(x){return Promise.reject(x)}}};const Pse=cse,n$=F.createContext({}),cc=({...e})=>d.jsx(n$.Provider,{value:{name:e.name},children:d.jsx(fse,{...e})}),N2=()=>{const e=F.useContext(n$),t=F.useContext(i$),{getFieldState:i,formState:l}=M2(),f=i(e.name,l);if(!e)throw new Error("useFormField should be used within <FormField>");const{id:_}=t;return{id:_,name:e.name,formItemId:`${_}-form-item`,formDescriptionId:`${_}-form-item-description`,formMessageId:`${_}-form-item-message`,...f}},i$=F.createContext({}),pl=F.forwardRef(({className:e,...t},i)=>{const l=F.useId();return d.jsx(i$.Provider,{value:{id:l},children:d.jsx("div",{ref:i,className:wr("space-y-2",e),...t})})});pl.displayName="FormItem";const ml=F.forwardRef(({className:e,...t},i)=>{const{error:l,formItemId:f}=N2();return d.jsx(Gt,{ref:i,className:wr(l&&"text-destructive",e),htmlFor:f,...t})});ml.displayName="FormLabel";const gl=F.forwardRef(({...e},t)=>{const{error:i,formItemId:l,formDescriptionId:f,formMessageId:_}=N2();return d.jsx(Hm,{ref:t,id:l,"aria-describedby":i?`${f} ${_}`:`${f}`,"aria-invalid":!!i,...e})});gl.displayName="FormControl";const Rse=F.forwardRef(({className:e,...t},i)=>{const{formDescriptionId:l}=N2();return d.jsx("p",{ref:i,id:l,className:wr("text-sm text-muted-foreground",e),...t})});Rse.displayName="FormDescription";const Ll=F.forwardRef(({className:e,children:t,...i},l)=>{const{error:f,formMessageId:_}=N2(),x=f?String(f==null?void 0:f.message):t;return x?d.jsx("p",{ref:l,id:_,className:wr("text-sm font-medium text-destructive",e),...i,children:x}):null});Ll.displayName="FormMessage";const hu=F.forwardRef(({className:e,...t},i)=>d.jsx("textarea",{className:wr("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:i,...t}));hu.displayName="Textarea";const Mse=Rb({titulo:ca().min(3,"Ttulo deve ter no mnimo 3 caracteres"),descricao:ca().optional(),tipo:ca().min(1,"Tipo  obrigatrio"),categoria:mS(["manutencao","rh","suprimentos","atendimento"]),subcategoria:ca().optional(),prioridade:mS(["baixa","media","alta","critica"]),status:mS(["aberto","em_andamento","pendente","concluido"]),unidade_id:ca().uuid("Unidade  obrigatria"),posto_servico_id:ca().uuid().optional(),contrato_id:ca().uuid().optional(),solicitante_id:ca().uuid().optional(),sla_horas:kre.number().min(1).default(24),canal:mS(["app","webhook","qr"]).default("app")}),_F=[".pdf",".doc",".docx",".xls",".xlsx",".jpg",".jpeg",".png"],Nse=e=>{if(!e)return"";const t=e.replace(/_/g," ");return t.charAt(0).toUpperCase()+t.slice(1)},Dse={manutencao:["Equipamento","Veculo","Infraestrutura"],rh:["Benefcios","Movimentao","Dvidas"],suprimentos:["Material","Uniforme","EPI"],atendimento:["Limpeza","Organizao","Predial","Outros"]};function Ose({open:e,onOpenChange:t,chamado:i,onSuccess:l}){const{toast:f}=Hf(),_=Xf(),[x,o]=F.useState(!1),[A,I]=F.useState(null),[N,U]=F.useState(null),[$,V]=F.useState([]),[Y,q]=F.useState(null),Z=(i==null?void 0:i.id)??null,Q=KP({resolver:kse(Mse),defaultValues:{titulo:"",descricao:"",tipo:"",categoria:"atendimento",subcategoria:"",prioridade:"media",status:"aberto",sla_horas:24,canal:"app"}}),H=Q.watch("contrato_id"),K=F.useRef(null);F.useEffect(()=>{if(K.current===null){K.current=H??null;return}K.current!==H&&(Q.setValue("unidade_id",""),Q.setValue("posto_servico_id",""),K.current=H??null)},[H,Q]);const ne=Q.watch("unidade_id"),le=Q.watch("posto_servico_id");F.useEffect(()=>{(async()=>{const{data:{user:Le}}=await Ge.auth.getUser();if(Le){I(Le.id);const{data:vt}=await Ge.from("user_roles").select("role").eq("user_id",Le.id).single();vt&&U(vt.role)}})()},[]);const{data:pe}=Ks({queryKey:["unidades",H],queryFn:async()=>{let fe=Ge.from("unidades").select("id, nome, codigo").eq("status","ativo").order("nome");H&&(fe=fe.eq("contrato_id",H));const{data:Le,error:vt}=await fe;if(vt)throw vt;return Le}}),{data:Ae}=Ks({queryKey:["contratos"],queryFn:async()=>{const{data:fe,error:Le}=await Ge.from("contratos").select("id, nome, codigo").eq("status","ativo").order("nome");if(Le)throw Le;return fe}}),{data:Ze,isLoading:Xe,refetch:Je}=Ks({queryKey:["chamado-anexos",Z],enabled:!!Z&&e,initialData:i==null?void 0:i.anexos,queryFn:async()=>{if(!Z)return[];const{data:fe,error:Le}=await Ge.from("chamados_anexos").select(`
          *,
          usuario:profiles(full_name)
        `).eq("chamado_id",Z).order("created_at",{ascending:!1});if(Le)throw Le;return fe||[]}}),{data:Te}=Ks({queryKey:["postos",ne],queryFn:async()=>{if(!ne)return[];const{data:fe,error:Le}=await Ge.from("postos_servico").select("id, nome, codigo, status").eq("unidade_id",ne).neq("status","inativo").order("nome");if(Le)throw Le;return fe},enabled:!!ne}),{data:xe}=Ks({queryKey:["colaboradores",le],queryFn:async()=>{let fe=Ge.from("colaboradores").select("id, nome_completo, cpf").eq("status_colaborador","ativo").order("nome_completo");le&&(fe=fe.eq("posto_servico_id",le));const{data:Le,error:vt}=await fe;if(vt)throw vt;return Le}}),Be=F.useRef(null);F.useEffect(()=>{if(Be.current===null){Be.current=le??null;return}Be.current!==le&&(Q.setValue("solicitante_id",""),Be.current=le??null)},[le,Q]);const dt=Ze??(i==null?void 0:i.anexos)??[],qt=(fe,Le)=>{if(!fe||fe.length===0){Le==null||Le();return}const vt=Array.from(fe),Wt=[],Ft=[];vt.forEach(Ut=>{var xr;const vr=`.${((xr=Ut.name.split(".").pop())==null?void 0:xr.toLowerCase())||""}`;_F.includes(vr)?Wt.push(Ut):Ft.push(Ut.name)}),Ft.length>0&&f({title:"Formato no suportado",description:`Os arquivos (${Ft.join(", ")}) no so permitidos. Use PDF, DOCX, XLS ou imagens.`,variant:"destructive"}),V(Ut=>[...Ut,...Wt]),Le==null||Le()},Ke=async fe=>{try{const{data:Le,error:vt}=await Ge.storage.from("chamados-anexos").download(fe.caminho_storage);if(vt||!Le)throw vt;const Wt=URL.createObjectURL(Le),Ft=document.createElement("a");Ft.href=Wt,Ft.download=fe.nome_arquivo,document.body.appendChild(Ft),Ft.click(),Ft.remove(),URL.revokeObjectURL(Wt)}catch(Le){console.error("Erro ao baixar anexo:",Le),f({title:"Erro ao baixar anexo",description:"No foi possvel baixar o arquivo. Tente novamente.",variant:"destructive"})}},st=async fe=>{if(Z)try{q(fe.id);const{error:Le}=await Ge.storage.from("chamados-anexos").remove([fe.caminho_storage]);if(Le)throw Le;const{error:vt}=await Ge.from("chamados_anexos").delete().eq("id",fe.id);if(vt)throw vt;[["chamado-anexos",Z],["chamado-anexos-detalhes",Z]].forEach(Ft=>{_.setQueryData(Ft,Ut=>(Ut||[]).filter(vr=>vr.id!==fe.id))}),f({title:"Anexo removido com sucesso"}),await Je()}catch(Le){console.error("Erro ao remover anexo:",Le),f({title:"Erro ao remover anexo",description:(Le==null?void 0:Le.message)??"Tente novamente.",variant:"destructive"})}finally{q(null)}},Ne=fe=>{V(Le=>Le.filter((vt,Wt)=>Wt!==fe))},De=Q.watch("categoria");F.useEffect(()=>{i&&Q.reset({titulo:i.titulo||"",descricao:i.descricao||"",tipo:i.tipo||"",categoria:i.categoria||"atendimento",subcategoria:i.subcategoria||"",prioridade:i.prioridade||"media",status:i.status||"aberto",unidade_id:i.unidade_id||"",posto_servico_id:i.posto_servico_id||"",contrato_id:i.contrato_id||"",solicitante_id:i.solicitante_id||"",sla_horas:i.sla_horas||24,canal:i.canal||"app"})},[i,Q]);const Tt=async fe=>{var Le;o(!0);try{const vt={titulo:fe.titulo,descricao:fe.descricao||null,tipo:fe.tipo,categoria:fe.categoria,subcategoria:fe.subcategoria||null,prioridade:fe.prioridade,status:fe.status,unidade_id:fe.unidade_id,posto_servico_id:fe.posto_servico_id||null,contrato_id:fe.contrato_id||null,sla_horas:fe.sla_horas,canal:fe.canal,numero:(i==null?void 0:i.numero)||`CH-${Date.now()}`};let Wt=i==null?void 0:i.id;if(i){const{error:Ft}=await Ge.from("chamados").update(vt).eq("id",i.id);if(Ft)throw Ft;f({title:"Chamado atualizado com sucesso!"})}else{const{data:Ft,error:Ut}=await Ge.from("chamados").insert([vt]).select().single();if(Ut)throw Ut;Wt=Ft.id,f({title:"Chamado criado com sucesso!"})}if($.length>0&&Wt){const{data:{user:Ft},error:Ut}=await Ge.auth.getUser();if(Ut||!Ft)throw new Error("No foi possvel identificar o usurio para salvar os anexos.");for(const vr of $){const xr=`.${((Le=vr.name.split(".").pop())==null?void 0:Le.toLowerCase())||""}`;if(!_F.includes(xr)){f({title:"Formato no permitido",description:`O arquivo ${vr.name} no est em um formato suportado.`,variant:"destructive"});continue}const zr=vr.name.toLowerCase().replace(/[^\w.-]/g,"_"),Hr=`${Wt}/${Date.now()}-${zr}`,{error:jn}=await Ge.storage.from("chamados-anexos").upload(Hr,vr,{cacheControl:"3600",upsert:!1});if(jn){console.error("Erro ao fazer upload:",jn),f({title:"Erro ao enviar anexo",description:`No foi possvel enviar o arquivo ${vr.name}.`,variant:"destructive"});continue}const{error:hn}=await Ge.from("chamados_anexos").insert({chamado_id:Wt,usuario_id:Ft.id,nome_arquivo:vr.name,caminho_storage:Hr,tipo_arquivo:vr.type,tamanho_bytes:vr.size});hn&&(console.error("Erro ao registrar anexo:",hn),f({title:"Erro ao registrar anexo",description:`O arquivo ${vr.name} foi enviado, mas no foi registrado no banco.`,variant:"destructive"}))}}l(),Q.reset(),V([])}catch(vt){console.error(vt),f({title:"Erro ao salvar chamado",description:vt.message??"Ocorreu um erro inesperado.",variant:"destructive"})}finally{o(!1)}},Pt=N==="admin";return d.jsx(Vs,{open:e,onOpenChange:t,children:d.jsxs(Ms,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[d.jsxs(Ns,{children:[d.jsx(Ds,{children:i?"Editar Chamado":"Novo Chamado"}),d.jsx(Qa,{children:i?"Atualize dados, anexos e informaes operacionais deste chamado.":"Preencha os campos para registrar um novo chamado."})]}),d.jsx(Pse,{...Q,children:d.jsxs("form",{onSubmit:Q.handleSubmit(Tt),className:"space-y-4",children:[d.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[d.jsx(cc,{control:Q.control,name:"titulo",render:({field:fe})=>d.jsxs(pl,{className:"md:col-span-2",children:[d.jsx(ml,{children:"Ttulo *"}),d.jsx(gl,{children:d.jsx(gr,{...fe,placeholder:"Digite o ttulo do chamado"})}),d.jsx(Ll,{})]})}),d.jsx(cc,{control:Q.control,name:"tipo",render:({field:fe})=>d.jsxs(pl,{children:[d.jsx(ml,{children:"Tipo *"}),d.jsx(gl,{children:d.jsx(gr,{...fe,placeholder:"Ex: Corretiva, Preventiva"})}),d.jsx(Ll,{})]})}),d.jsx(cc,{control:Q.control,name:"categoria",render:({field:fe})=>d.jsxs(pl,{children:[d.jsx(ml,{children:"Categoria *"}),d.jsxs(Vr,{onValueChange:fe.onChange,value:fe.value,children:[d.jsx(gl,{children:d.jsx(Or,{children:d.jsx(Ur,{})})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"manutencao",children:"Manuteno"}),d.jsx(bt,{value:"rh",children:"RH"}),d.jsx(bt,{value:"suprimentos",children:"Suprimentos"}),d.jsx(bt,{value:"atendimento",children:"Atendimento"})]})]}),d.jsx(Ll,{})]})}),d.jsx(cc,{control:Q.control,name:"subcategoria",render:({field:fe})=>{var Le;return d.jsxs(pl,{children:[d.jsx(ml,{children:"Subcategoria"}),d.jsxs(Vr,{onValueChange:fe.onChange,value:fe.value,children:[d.jsx(gl,{children:d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Selecione..."})})}),d.jsx(Lr,{children:(Le=Dse[De])==null?void 0:Le.map(vt=>d.jsx(bt,{value:vt.toLowerCase(),children:vt},vt))})]}),d.jsx(Ll,{})]})}}),d.jsx(cc,{control:Q.control,name:"prioridade",render:({field:fe})=>d.jsxs(pl,{children:[d.jsx(ml,{children:"Prioridade *"}),d.jsxs(Vr,{onValueChange:fe.onChange,value:fe.value,children:[d.jsx(gl,{children:d.jsx(Or,{children:d.jsx(Ur,{})})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"baixa",children:"Baixa"}),d.jsx(bt,{value:"media",children:"Mdia"}),d.jsx(bt,{value:"alta",children:"Alta"}),d.jsx(bt,{value:"critica",children:"Crtica"})]})]}),d.jsx(Ll,{})]})}),d.jsx(cc,{control:Q.control,name:"status",render:({field:fe})=>d.jsxs(pl,{children:[d.jsx(ml,{children:"Status *"}),d.jsxs(Vr,{onValueChange:fe.onChange,value:fe.value,children:[d.jsx(gl,{children:d.jsx(Or,{children:d.jsx(Ur,{})})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"aberto",children:"Aberto"}),d.jsx(bt,{value:"em_andamento",children:"Em Andamento"}),d.jsx(bt,{value:"pendente",children:"Pendente"}),d.jsx(bt,{value:"concluido",children:"Concludo"})]})]}),d.jsx(Ll,{})]})}),d.jsx(cc,{control:Q.control,name:"sla_horas",render:({field:fe})=>d.jsxs(pl,{children:[d.jsx(ml,{children:"SLA (horas) *"}),d.jsx(gl,{children:d.jsx(gr,{type:"number",...fe,min:1})}),d.jsx(Ll,{})]})}),d.jsx(cc,{control:Q.control,name:"contrato_id",render:({field:fe})=>d.jsxs(pl,{children:[d.jsx(ml,{children:"Contrato"}),d.jsxs(Vr,{onValueChange:fe.onChange,value:fe.value,children:[d.jsx(gl,{children:d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Selecione o contrato"})})}),d.jsx(Lr,{children:Ae==null?void 0:Ae.map(Le=>d.jsxs(bt,{value:Le.id,children:[Le.codigo," - ",Le.nome]},Le.id))})]}),d.jsx(Ll,{})]})}),d.jsx(cc,{control:Q.control,name:"unidade_id",render:({field:fe})=>d.jsxs(pl,{children:[d.jsx(ml,{children:"Unidade *"}),d.jsxs(Vr,{onValueChange:fe.onChange,value:fe.value,children:[d.jsx(gl,{children:d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Selecione a unidade"})})}),d.jsx(Lr,{children:pe==null?void 0:pe.map(Le=>d.jsxs(bt,{value:Le.id,children:[Le.codigo," - ",Le.nome]},Le.id))})]}),d.jsx(Ll,{})]})}),d.jsx(cc,{control:Q.control,name:"posto_servico_id",render:({field:fe})=>d.jsxs(pl,{children:[d.jsx(ml,{children:"Posto de Servio"}),d.jsxs(Vr,{onValueChange:fe.onChange,value:fe.value,disabled:!ne,children:[d.jsx(gl,{children:d.jsx(Or,{children:d.jsx(Ur,{placeholder:ne?"Selecione o posto":"Selecione a unidade primeiro"})})}),d.jsx(Lr,{children:Te==null?void 0:Te.map(Le=>{const vt=Nse(Le.status);return d.jsxs(bt,{value:Le.id,children:[Le.codigo," - ",Le.nome,vt?` (${vt})`:""]},Le.id)})})]}),d.jsx(Ll,{})]})}),Pt&&d.jsx(cc,{control:Q.control,name:"solicitante_id",render:({field:fe})=>d.jsxs(pl,{children:[d.jsx(ml,{children:"Solicitante"}),d.jsxs(Vr,{onValueChange:fe.onChange,value:fe.value,children:[d.jsx(gl,{children:d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Selecione o solicitante"})})}),d.jsx(Lr,{children:xe==null?void 0:xe.map(Le=>d.jsx(bt,{value:Le.id,children:Le.nome_completo},Le.id))})]}),d.jsx(Ll,{})]})}),d.jsx(cc,{control:Q.control,name:"descricao",render:({field:fe})=>d.jsxs(pl,{className:"md:col-span-2",children:[d.jsx(ml,{children:"Descrio"}),d.jsx(gl,{children:d.jsx(hu,{...fe,placeholder:"Descreva os detalhes do chamado",rows:4})}),d.jsx(Ll,{})]})}),d.jsxs(pl,{className:"md:col-span-2",children:[d.jsx(ml,{children:"Anexos"}),d.jsx(gl,{children:d.jsx(gr,{type:"file",multiple:!0,accept:".doc,.docx,.pdf,.xls,.xlsx,.jpg,.jpeg,.png,image/*,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onChange:fe=>qt(fe.target.files,()=>{fe.target.value=""})})}),$.length>0&&d.jsx("div",{className:"mt-2 space-y-2",children:$.map((fe,Le)=>d.jsxs("div",{className:"flex items-center justify-between rounded-md border px-3 py-2 text-sm",children:[d.jsxs("div",{className:"min-w-0",children:[d.jsx("p",{className:"truncate font-medium",children:fe.name}),d.jsxs("p",{className:"text-xs text-muted-foreground",children:[(fe.size/1024).toFixed(1)," KB"]})]}),d.jsx(Bt,{type:"button",variant:"ghost",size:"sm",onClick:()=>Ne(Le),children:"Remover"})]},fe.name+Le))})]}),i&&d.jsxs("div",{className:"md:col-span-2 space-y-2",children:[d.jsxs("p",{className:"text-sm font-medium flex items-center gap-2",children:[d.jsx(rP,{className:"h-4 w-4"}),"Anexos atuais"]}),Xe?d.jsx("p",{className:"text-sm text-muted-foreground",children:"Carregando anexos..."}):dt.length>0?d.jsx("div",{className:"space-y-2",children:dt.map(fe=>{var Le;return d.jsxs("div",{className:"flex items-center justify-between gap-2 rounded-md border px-3 py-2 text-sm",children:[d.jsxs("div",{className:"min-w-0",children:[d.jsx("p",{className:"truncate font-medium",children:fe.nome_arquivo}),d.jsxs("p",{className:"text-xs text-muted-foreground",children:[fe.created_at?new Date(fe.created_at).toLocaleString("pt-BR"):"Sem data",(Le=fe.usuario)!=null&&Le.full_name?`  ${fe.usuario.full_name}`:""]})]}),d.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[d.jsx(Bt,{type:"button",variant:"ghost",size:"sm",onClick:()=>Ke(fe),children:"Baixar"}),d.jsx(Bt,{type:"button",variant:"ghost",size:"sm",className:"text-destructive",disabled:Y===fe.id,onClick:()=>st(fe),children:Y===fe.id?"Removendo...":"Remover"})]})]},fe.id)})}):d.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum anexo cadastrado para este chamado."})]})]}),d.jsxs("div",{className:"flex justify-end gap-2",children:[d.jsx(Bt,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Cancelar"}),d.jsxs(Bt,{type:"submit",disabled:x,children:[x&&d.jsx(nd,{className:"mr-2 h-4 w-4 animate-spin"}),i?"Atualizar":"Criar"," Chamado"]})]})]})})]})})}function Pi(e){const t=Object.prototype.toString.call(e);return e instanceof Date||typeof e=="object"&&t==="[object Date]"?new e.constructor(+e):typeof e=="number"||t==="[object Number]"||typeof e=="string"||t==="[object String]"?new Date(e):new Date(NaN)}function Zl(e,t){return e instanceof Date?new e.constructor(t):new Date(t)}function Ka(e,t){const i=Pi(e);return isNaN(t)?Zl(e,NaN):(t&&i.setDate(i.getDate()+t),i)}function Xl(e,t){const i=Pi(e);if(isNaN(t))return Zl(e,NaN);if(!t)return i;const l=i.getDate(),f=Zl(e,i.getTime());f.setMonth(i.getMonth()+t+1,0);const _=f.getDate();return l>=_?f:(i.setFullYear(f.getFullYear(),f.getMonth(),l),i)}const YP=6048e5,Lse=864e5,s$=6e4,o$=36e5;let zse={};function Fb(){return zse}function fu(e,t){var o,A,I,N;const i=Fb(),l=(t==null?void 0:t.weekStartsOn)??((A=(o=t==null?void 0:t.locale)==null?void 0:o.options)==null?void 0:A.weekStartsOn)??i.weekStartsOn??((N=(I=i.locale)==null?void 0:I.options)==null?void 0:N.weekStartsOn)??0,f=Pi(e),_=f.getDay(),x=(_<l?7:0)+_-l;return f.setDate(f.getDate()-x),f.setHours(0,0,0,0),f}function Um(e){return fu(e,{weekStartsOn:1})}function a$(e){const t=Pi(e),i=t.getFullYear(),l=Zl(e,0);l.setFullYear(i+1,0,4),l.setHours(0,0,0,0);const f=Um(l),_=Zl(e,0);_.setFullYear(i,0,4),_.setHours(0,0,0,0);const x=Um(_);return t.getTime()>=f.getTime()?i+1:t.getTime()>=x.getTime()?i:i-1}function Dy(e){const t=Pi(e);return t.setHours(0,0,0,0),t}function $T(e){const t=Pi(e),i=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return i.setUTCFullYear(t.getFullYear()),+e-+i}function Zu(e,t){const i=Dy(e),l=Dy(t),f=+i-$T(i),_=+l-$T(l);return Math.round((f-_)/Lse)}function Fse(e){const t=a$(e),i=Zl(e,0);return i.setFullYear(t,0,4),i.setHours(0,0,0,0),Um(i)}function YI(e,t){const i=t*7;return Ka(e,i)}function Bse(e,t){return Xl(e,t*12)}function Vse(e){let t;return e.forEach(function(i){const l=Pi(i);(t===void 0||t<l||isNaN(Number(l)))&&(t=l)}),t||new Date(NaN)}function Use(e){let t;return e.forEach(i=>{const l=Pi(i);(!t||t>l||isNaN(+l))&&(t=l)}),t||new Date(NaN)}function Sl(e,t){const i=Dy(e),l=Dy(t);return+i==+l}function JP(e){return e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}function $se(e){if(!JP(e)&&typeof e!="number")return!1;const t=Pi(e);return!isNaN(Number(t))}function _b(e,t){const i=Pi(e),l=Pi(t),f=i.getFullYear()-l.getFullYear(),_=i.getMonth()-l.getMonth();return f*12+_}function qse(e,t,i){const l=fu(e,i),f=fu(t,i),_=+l-$T(l),x=+f-$T(f);return Math.round((_-x)/YP)}function Oy(e){const t=Pi(e),i=t.getMonth();return t.setFullYear(t.getFullYear(),i+1,0),t.setHours(23,59,59,999),t}function Gse(e,t){const i=Pi(e.start),l=Pi(e.end);let f=+i>+l;const _=f?+i:+l,x=f?l:i;x.setHours(0,0,0,0);let o=1;const A=[];for(;+x<=_;)A.push(Pi(x)),x.setDate(x.getDate()+o),x.setHours(0,0,0,0);return f?A.reverse():A}function Ca(e){const t=Pi(e);return t.setDate(1),t.setHours(0,0,0,0),t}function l$(e){const t=Pi(e),i=Zl(e,0);return i.setFullYear(t.getFullYear(),0,1),i.setHours(0,0,0,0),i}function D2(e,t){var o,A,I,N;const i=Fb(),l=(t==null?void 0:t.weekStartsOn)??((A=(o=t==null?void 0:t.locale)==null?void 0:o.options)==null?void 0:A.weekStartsOn)??i.weekStartsOn??((N=(I=i.locale)==null?void 0:I.options)==null?void 0:N.weekStartsOn)??0,f=Pi(e),_=f.getDay(),x=(_<l?-7:0)+6-(_-l);return f.setDate(f.getDate()+x),f.setHours(23,59,59,999),f}function c$(e){return D2(e,{weekStartsOn:1})}const Hse={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Wse=(e,t,i)=>{let l;const f=Hse[e];return typeof f=="string"?l=f:t===1?l=f.one:l=f.other.replace("{{count}}",t.toString()),i!=null&&i.addSuffix?i.comparison&&i.comparison>0?"in "+l:l+" ago":l};function iy(e){return(t={})=>{const i=t.width?String(t.width):e.defaultWidth;return e.formats[i]||e.formats[e.defaultWidth]}}const Zse={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Xse={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Kse={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Yse={date:iy({formats:Zse,defaultWidth:"full"}),time:iy({formats:Xse,defaultWidth:"full"}),dateTime:iy({formats:Kse,defaultWidth:"full"})},Jse={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Qse=(e,t,i,l)=>Jse[e];function qu(e){return(t,i)=>{const l=i!=null&&i.context?String(i.context):"standalone";let f;if(l==="formatting"&&e.formattingValues){const x=e.defaultFormattingWidth||e.defaultWidth,o=i!=null&&i.width?String(i.width):x;f=e.formattingValues[o]||e.formattingValues[x]}else{const x=e.defaultWidth,o=i!=null&&i.width?String(i.width):e.defaultWidth;f=e.values[o]||e.values[x]}const _=e.argumentCallback?e.argumentCallback(t):t;return f[_]}}const eoe={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},toe={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},roe={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},noe={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},ioe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},soe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},ooe=(e,t)=>{const i=Number(e),l=i%100;if(l>20||l<10)switch(l%10){case 1:return i+"st";case 2:return i+"nd";case 3:return i+"rd"}return i+"th"},aoe={ordinalNumber:ooe,era:qu({values:eoe,defaultWidth:"wide"}),quarter:qu({values:toe,defaultWidth:"wide",argumentCallback:e=>e-1}),month:qu({values:roe,defaultWidth:"wide"}),day:qu({values:noe,defaultWidth:"wide"}),dayPeriod:qu({values:ioe,defaultWidth:"wide",formattingValues:soe,defaultFormattingWidth:"wide"})};function Gu(e){return(t,i={})=>{const l=i.width,f=l&&e.matchPatterns[l]||e.matchPatterns[e.defaultMatchWidth],_=t.match(f);if(!_)return null;const x=_[0],o=l&&e.parsePatterns[l]||e.parsePatterns[e.defaultParseWidth],A=Array.isArray(o)?coe(o,U=>U.test(x)):loe(o,U=>U.test(x));let I;I=e.valueCallback?e.valueCallback(A):A,I=i.valueCallback?i.valueCallback(I):I;const N=t.slice(x.length);return{value:I,rest:N}}}function loe(e,t){for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&t(e[i]))return i}function coe(e,t){for(let i=0;i<e.length;i++)if(t(e[i]))return i}function u$(e){return(t,i={})=>{const l=t.match(e.matchPattern);if(!l)return null;const f=l[0],_=t.match(e.parsePattern);if(!_)return null;let x=e.valueCallback?e.valueCallback(_[0]):_[0];x=i.valueCallback?i.valueCallback(x):x;const o=t.slice(f.length);return{value:x,rest:o}}}const uoe=/^(\d+)(th|st|nd|rd)?/i,doe=/\d+/i,hoe={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},foe={any:[/^b/i,/^(a|c)/i]},poe={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},moe={any:[/1/i,/2/i,/3/i,/4/i]},goe={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},_oe={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},yoe={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},voe={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},xoe={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},boe={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},woe={ordinalNumber:u$({matchPattern:uoe,parsePattern:doe,valueCallback:e=>parseInt(e,10)}),era:Gu({matchPatterns:hoe,defaultMatchWidth:"wide",parsePatterns:foe,defaultParseWidth:"any"}),quarter:Gu({matchPatterns:poe,defaultMatchWidth:"wide",parsePatterns:moe,defaultParseWidth:"any",valueCallback:e=>e+1}),month:Gu({matchPatterns:goe,defaultMatchWidth:"wide",parsePatterns:_oe,defaultParseWidth:"any"}),day:Gu({matchPatterns:yoe,defaultMatchWidth:"wide",parsePatterns:voe,defaultParseWidth:"any"}),dayPeriod:Gu({matchPatterns:xoe,defaultMatchWidth:"any",parsePatterns:boe,defaultParseWidth:"any"})},d$={code:"en-US",formatDistance:Wse,formatLong:Yse,formatRelative:Qse,localize:aoe,match:woe,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Soe(e){const t=Pi(e);return Zu(t,l$(t))+1}function h$(e){const t=Pi(e),i=+Um(t)-+Fse(t);return Math.round(i/YP)+1}function f$(e,t){var N,U,$,V;const i=Pi(e),l=i.getFullYear(),f=Fb(),_=(t==null?void 0:t.firstWeekContainsDate)??((U=(N=t==null?void 0:t.locale)==null?void 0:N.options)==null?void 0:U.firstWeekContainsDate)??f.firstWeekContainsDate??((V=($=f.locale)==null?void 0:$.options)==null?void 0:V.firstWeekContainsDate)??1,x=Zl(e,0);x.setFullYear(l+1,0,_),x.setHours(0,0,0,0);const o=fu(x,t),A=Zl(e,0);A.setFullYear(l,0,_),A.setHours(0,0,0,0);const I=fu(A,t);return i.getTime()>=o.getTime()?l+1:i.getTime()>=I.getTime()?l:l-1}function Toe(e,t){var o,A,I,N;const i=Fb(),l=(t==null?void 0:t.firstWeekContainsDate)??((A=(o=t==null?void 0:t.locale)==null?void 0:o.options)==null?void 0:A.firstWeekContainsDate)??i.firstWeekContainsDate??((N=(I=i.locale)==null?void 0:I.options)==null?void 0:N.firstWeekContainsDate)??1,f=f$(e,t),_=Zl(e,0);return _.setFullYear(f,0,l),_.setHours(0,0,0,0),fu(_,t)}function p$(e,t){const i=Pi(e),l=+fu(i,t)-+Toe(i,t);return Math.round(l/YP)+1}function Es(e,t){const i=e<0?"-":"",l=Math.abs(e).toString().padStart(t,"0");return i+l}const Qh={y(e,t){const i=e.getFullYear(),l=i>0?i:1-i;return Es(t==="yy"?l%100:l,t.length)},M(e,t){const i=e.getMonth();return t==="M"?String(i+1):Es(i+1,2)},d(e,t){return Es(e.getDate(),t.length)},a(e,t){const i=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return i.toUpperCase();case"aaa":return i;case"aaaaa":return i[0];case"aaaa":default:return i==="am"?"a.m.":"p.m."}},h(e,t){return Es(e.getHours()%12||12,t.length)},H(e,t){return Es(e.getHours(),t.length)},m(e,t){return Es(e.getMinutes(),t.length)},s(e,t){return Es(e.getSeconds(),t.length)},S(e,t){const i=t.length,l=e.getMilliseconds(),f=Math.trunc(l*Math.pow(10,i-3));return Es(f,t.length)}},k_={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},yF={G:function(e,t,i){const l=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return i.era(l,{width:"abbreviated"});case"GGGGG":return i.era(l,{width:"narrow"});case"GGGG":default:return i.era(l,{width:"wide"})}},y:function(e,t,i){if(t==="yo"){const l=e.getFullYear(),f=l>0?l:1-l;return i.ordinalNumber(f,{unit:"year"})}return Qh.y(e,t)},Y:function(e,t,i,l){const f=f$(e,l),_=f>0?f:1-f;if(t==="YY"){const x=_%100;return Es(x,2)}return t==="Yo"?i.ordinalNumber(_,{unit:"year"}):Es(_,t.length)},R:function(e,t){const i=a$(e);return Es(i,t.length)},u:function(e,t){const i=e.getFullYear();return Es(i,t.length)},Q:function(e,t,i){const l=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(l);case"QQ":return Es(l,2);case"Qo":return i.ordinalNumber(l,{unit:"quarter"});case"QQQ":return i.quarter(l,{width:"abbreviated",context:"formatting"});case"QQQQQ":return i.quarter(l,{width:"narrow",context:"formatting"});case"QQQQ":default:return i.quarter(l,{width:"wide",context:"formatting"})}},q:function(e,t,i){const l=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(l);case"qq":return Es(l,2);case"qo":return i.ordinalNumber(l,{unit:"quarter"});case"qqq":return i.quarter(l,{width:"abbreviated",context:"standalone"});case"qqqqq":return i.quarter(l,{width:"narrow",context:"standalone"});case"qqqq":default:return i.quarter(l,{width:"wide",context:"standalone"})}},M:function(e,t,i){const l=e.getMonth();switch(t){case"M":case"MM":return Qh.M(e,t);case"Mo":return i.ordinalNumber(l+1,{unit:"month"});case"MMM":return i.month(l,{width:"abbreviated",context:"formatting"});case"MMMMM":return i.month(l,{width:"narrow",context:"formatting"});case"MMMM":default:return i.month(l,{width:"wide",context:"formatting"})}},L:function(e,t,i){const l=e.getMonth();switch(t){case"L":return String(l+1);case"LL":return Es(l+1,2);case"Lo":return i.ordinalNumber(l+1,{unit:"month"});case"LLL":return i.month(l,{width:"abbreviated",context:"standalone"});case"LLLLL":return i.month(l,{width:"narrow",context:"standalone"});case"LLLL":default:return i.month(l,{width:"wide",context:"standalone"})}},w:function(e,t,i,l){const f=p$(e,l);return t==="wo"?i.ordinalNumber(f,{unit:"week"}):Es(f,t.length)},I:function(e,t,i){const l=h$(e);return t==="Io"?i.ordinalNumber(l,{unit:"week"}):Es(l,t.length)},d:function(e,t,i){return t==="do"?i.ordinalNumber(e.getDate(),{unit:"date"}):Qh.d(e,t)},D:function(e,t,i){const l=Soe(e);return t==="Do"?i.ordinalNumber(l,{unit:"dayOfYear"}):Es(l,t.length)},E:function(e,t,i){const l=e.getDay();switch(t){case"E":case"EE":case"EEE":return i.day(l,{width:"abbreviated",context:"formatting"});case"EEEEE":return i.day(l,{width:"narrow",context:"formatting"});case"EEEEEE":return i.day(l,{width:"short",context:"formatting"});case"EEEE":default:return i.day(l,{width:"wide",context:"formatting"})}},e:function(e,t,i,l){const f=e.getDay(),_=(f-l.weekStartsOn+8)%7||7;switch(t){case"e":return String(_);case"ee":return Es(_,2);case"eo":return i.ordinalNumber(_,{unit:"day"});case"eee":return i.day(f,{width:"abbreviated",context:"formatting"});case"eeeee":return i.day(f,{width:"narrow",context:"formatting"});case"eeeeee":return i.day(f,{width:"short",context:"formatting"});case"eeee":default:return i.day(f,{width:"wide",context:"formatting"})}},c:function(e,t,i,l){const f=e.getDay(),_=(f-l.weekStartsOn+8)%7||7;switch(t){case"c":return String(_);case"cc":return Es(_,t.length);case"co":return i.ordinalNumber(_,{unit:"day"});case"ccc":return i.day(f,{width:"abbreviated",context:"standalone"});case"ccccc":return i.day(f,{width:"narrow",context:"standalone"});case"cccccc":return i.day(f,{width:"short",context:"standalone"});case"cccc":default:return i.day(f,{width:"wide",context:"standalone"})}},i:function(e,t,i){const l=e.getDay(),f=l===0?7:l;switch(t){case"i":return String(f);case"ii":return Es(f,t.length);case"io":return i.ordinalNumber(f,{unit:"day"});case"iii":return i.day(l,{width:"abbreviated",context:"formatting"});case"iiiii":return i.day(l,{width:"narrow",context:"formatting"});case"iiiiii":return i.day(l,{width:"short",context:"formatting"});case"iiii":default:return i.day(l,{width:"wide",context:"formatting"})}},a:function(e,t,i){const f=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return i.dayPeriod(f,{width:"abbreviated",context:"formatting"});case"aaa":return i.dayPeriod(f,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return i.dayPeriod(f,{width:"narrow",context:"formatting"});case"aaaa":default:return i.dayPeriod(f,{width:"wide",context:"formatting"})}},b:function(e,t,i){const l=e.getHours();let f;switch(l===12?f=k_.noon:l===0?f=k_.midnight:f=l/12>=1?"pm":"am",t){case"b":case"bb":return i.dayPeriod(f,{width:"abbreviated",context:"formatting"});case"bbb":return i.dayPeriod(f,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return i.dayPeriod(f,{width:"narrow",context:"formatting"});case"bbbb":default:return i.dayPeriod(f,{width:"wide",context:"formatting"})}},B:function(e,t,i){const l=e.getHours();let f;switch(l>=17?f=k_.evening:l>=12?f=k_.afternoon:l>=4?f=k_.morning:f=k_.night,t){case"B":case"BB":case"BBB":return i.dayPeriod(f,{width:"abbreviated",context:"formatting"});case"BBBBB":return i.dayPeriod(f,{width:"narrow",context:"formatting"});case"BBBB":default:return i.dayPeriod(f,{width:"wide",context:"formatting"})}},h:function(e,t,i){if(t==="ho"){let l=e.getHours()%12;return l===0&&(l=12),i.ordinalNumber(l,{unit:"hour"})}return Qh.h(e,t)},H:function(e,t,i){return t==="Ho"?i.ordinalNumber(e.getHours(),{unit:"hour"}):Qh.H(e,t)},K:function(e,t,i){const l=e.getHours()%12;return t==="Ko"?i.ordinalNumber(l,{unit:"hour"}):Es(l,t.length)},k:function(e,t,i){let l=e.getHours();return l===0&&(l=24),t==="ko"?i.ordinalNumber(l,{unit:"hour"}):Es(l,t.length)},m:function(e,t,i){return t==="mo"?i.ordinalNumber(e.getMinutes(),{unit:"minute"}):Qh.m(e,t)},s:function(e,t,i){return t==="so"?i.ordinalNumber(e.getSeconds(),{unit:"second"}):Qh.s(e,t)},S:function(e,t){return Qh.S(e,t)},X:function(e,t,i){const l=e.getTimezoneOffset();if(l===0)return"Z";switch(t){case"X":return xF(l);case"XXXX":case"XX":return am(l);case"XXXXX":case"XXX":default:return am(l,":")}},x:function(e,t,i){const l=e.getTimezoneOffset();switch(t){case"x":return xF(l);case"xxxx":case"xx":return am(l);case"xxxxx":case"xxx":default:return am(l,":")}},O:function(e,t,i){const l=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+vF(l,":");case"OOOO":default:return"GMT"+am(l,":")}},z:function(e,t,i){const l=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+vF(l,":");case"zzzz":default:return"GMT"+am(l,":")}},t:function(e,t,i){const l=Math.trunc(e.getTime()/1e3);return Es(l,t.length)},T:function(e,t,i){const l=e.getTime();return Es(l,t.length)}};function vF(e,t=""){const i=e>0?"-":"+",l=Math.abs(e),f=Math.trunc(l/60),_=l%60;return _===0?i+String(f):i+String(f)+t+Es(_,2)}function xF(e,t){return e%60===0?(e>0?"-":"+")+Es(Math.abs(e)/60,2):am(e,t)}function am(e,t=""){const i=e>0?"-":"+",l=Math.abs(e),f=Es(Math.trunc(l/60),2),_=Es(l%60,2);return i+f+t+_}const bF=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},m$=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},Eoe=(e,t)=>{const i=e.match(/(P+)(p+)?/)||[],l=i[1],f=i[2];if(!f)return bF(e,t);let _;switch(l){case"P":_=t.dateTime({width:"short"});break;case"PP":_=t.dateTime({width:"medium"});break;case"PPP":_=t.dateTime({width:"long"});break;case"PPPP":default:_=t.dateTime({width:"full"});break}return _.replace("{{date}}",bF(l,t)).replace("{{time}}",m$(f,t))},Coe={p:m$,P:Eoe},Aoe=/^D+$/,joe=/^Y+$/,Ioe=["D","DD","YY","YYYY"];function koe(e){return Aoe.test(e)}function Poe(e){return joe.test(e)}function Roe(e,t,i){const l=Moe(e,t,i);if(console.warn(l),Ioe.includes(e))throw new RangeError(l)}function Moe(e,t,i){const l=e[0]==="Y"?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${t}\`) for formatting ${l} to the input \`${i}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const Noe=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Doe=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Ooe=/^'([^]*?)'?$/,Loe=/''/g,zoe=/[a-zA-Z]/;function Kn(e,t,i){var N,U,$,V,Y,q,Z,Q;const l=Fb(),f=(i==null?void 0:i.locale)??l.locale??d$,_=(i==null?void 0:i.firstWeekContainsDate)??((U=(N=i==null?void 0:i.locale)==null?void 0:N.options)==null?void 0:U.firstWeekContainsDate)??l.firstWeekContainsDate??((V=($=l.locale)==null?void 0:$.options)==null?void 0:V.firstWeekContainsDate)??1,x=(i==null?void 0:i.weekStartsOn)??((q=(Y=i==null?void 0:i.locale)==null?void 0:Y.options)==null?void 0:q.weekStartsOn)??l.weekStartsOn??((Q=(Z=l.locale)==null?void 0:Z.options)==null?void 0:Q.weekStartsOn)??0,o=Pi(e);if(!$se(o))throw new RangeError("Invalid time value");let A=t.match(Doe).map(H=>{const K=H[0];if(K==="p"||K==="P"){const ne=Coe[K];return ne(H,f.formatLong)}return H}).join("").match(Noe).map(H=>{if(H==="''")return{isToken:!1,value:"'"};const K=H[0];if(K==="'")return{isToken:!1,value:Foe(H)};if(yF[K])return{isToken:!0,value:H};if(K.match(zoe))throw new RangeError("Format string contains an unescaped latin alphabet character `"+K+"`");return{isToken:!1,value:H}});f.localize.preprocessor&&(A=f.localize.preprocessor(o,A));const I={firstWeekContainsDate:_,weekStartsOn:x,locale:f};return A.map(H=>{if(!H.isToken)return H.value;const K=H.value;(!(i!=null&&i.useAdditionalWeekYearTokens)&&Poe(K)||!(i!=null&&i.useAdditionalDayOfYearTokens)&&koe(K))&&Roe(K,t,String(e));const ne=yF[K[0]];return ne(o,K,f.localize,I)}).join("")}function Foe(e){const t=e.match(Ooe);return t?t[1].replace(Loe,"'"):e}function Boe(e){const t=Pi(e),i=t.getFullYear(),l=t.getMonth(),f=Zl(e,0);return f.setFullYear(i,l+1,0),f.setHours(0,0,0,0),f.getDate()}function Voe(e){return Math.trunc(+Pi(e)/1e3)}function Uoe(e){const t=Pi(e),i=t.getMonth();return t.setFullYear(t.getFullYear(),i+1,0),t.setHours(0,0,0,0),t}function $oe(e,t){return qse(Uoe(e),Ca(e),t)+1}function JI(e,t){const i=Pi(e),l=Pi(t);return i.getTime()>l.getTime()}function g$(e,t){const i=Pi(e),l=Pi(t);return+i<+l}function O2(e,t){const i=Pi(e),l=Pi(t);return i.getFullYear()===l.getFullYear()&&i.getMonth()===l.getMonth()}function qoe(e,t){const i=Pi(e),l=Pi(t);return i.getFullYear()===l.getFullYear()}function wF(e,t){const i=+Pi(e),[l,f]=[+Pi(t.start),+Pi(t.end)].sort((_,x)=>_-x);return i>=l&&i<=f}function qA(e,t){return Ka(e,-t)}function W_(e,t){const l=Zoe(e);let f;if(l.date){const A=Xoe(l.date,2);f=Koe(A.restDateString,A.year)}if(!f||isNaN(f.getTime()))return new Date(NaN);const _=f.getTime();let x=0,o;if(l.time&&(x=Yoe(l.time),isNaN(x)))return new Date(NaN);if(l.timezone){if(o=Joe(l.timezone),isNaN(o))return new Date(NaN)}else{const A=new Date(_+x),I=new Date(0);return I.setFullYear(A.getUTCFullYear(),A.getUTCMonth(),A.getUTCDate()),I.setHours(A.getUTCHours(),A.getUTCMinutes(),A.getUTCSeconds(),A.getUTCMilliseconds()),I}return new Date(_+x+o)}const xS={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Goe=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Hoe=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Woe=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Zoe(e){const t={},i=e.split(xS.dateTimeDelimiter);let l;if(i.length>2)return t;if(/:/.test(i[0])?l=i[0]:(t.date=i[0],l=i[1],xS.timeZoneDelimiter.test(t.date)&&(t.date=e.split(xS.timeZoneDelimiter)[0],l=e.substr(t.date.length,e.length))),l){const f=xS.timezone.exec(l);f?(t.time=l.replace(f[1],""),t.timezone=f[1]):t.time=l}return t}function Xoe(e,t){const i=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),l=e.match(i);if(!l)return{year:NaN,restDateString:""};const f=l[1]?parseInt(l[1]):null,_=l[2]?parseInt(l[2]):null;return{year:_===null?f:_*100,restDateString:e.slice((l[1]||l[2]).length)}}function Koe(e,t){if(t===null)return new Date(NaN);const i=e.match(Goe);if(!i)return new Date(NaN);const l=!!i[4],f=m0(i[1]),_=m0(i[2])-1,x=m0(i[3]),o=m0(i[4]),A=m0(i[5])-1;if(l)return nae(t,o,A)?Qoe(t,o,A):new Date(NaN);{const I=new Date(0);return!tae(t,_,x)||!rae(t,f)?new Date(NaN):(I.setUTCFullYear(t,_,Math.max(f,x)),I)}}function m0(e){return e?parseInt(e):1}function Yoe(e){const t=e.match(Hoe);if(!t)return NaN;const i=GA(t[1]),l=GA(t[2]),f=GA(t[3]);return iae(i,l,f)?i*o$+l*s$+f*1e3:NaN}function GA(e){return e&&parseFloat(e.replace(",","."))||0}function Joe(e){if(e==="Z")return 0;const t=e.match(Woe);if(!t)return 0;const i=t[1]==="+"?-1:1,l=parseInt(t[2]),f=t[3]&&parseInt(t[3])||0;return sae(l,f)?i*(l*o$+f*s$):NaN}function Qoe(e,t,i){const l=new Date(0);l.setUTCFullYear(e,0,4);const f=l.getUTCDay()||7,_=(t-1)*7+i+1-f;return l.setUTCDate(l.getUTCDate()+_),l}const eae=[31,null,31,30,31,30,31,31,30,31,30,31];function _$(e){return e%400===0||e%4===0&&e%100!==0}function tae(e,t,i){return t>=0&&t<=11&&i>=1&&i<=(eae[t]||(_$(e)?29:28))}function rae(e,t){return t>=1&&t<=(_$(e)?366:365)}function nae(e,t,i){return t>=1&&t<=53&&i>=0&&i<=6}function iae(e,t,i){return e===24?t===0&&i===0:i>=0&&i<60&&t>=0&&t<60&&e>=0&&e<25}function sae(e,t){return t>=0&&t<=59}function HA(e,t){const i=Pi(e),l=i.getFullYear(),f=i.getDate(),_=Zl(e,0);_.setFullYear(l,t,15),_.setHours(0,0,0,0);const x=Boe(_);return i.setMonth(t,Math.min(f,x)),i}function SF(e,t){const i=Pi(e);return isNaN(+i)?Zl(e,NaN):(i.setFullYear(t),i)}const oae={lessThanXSeconds:{one:"menos de um segundo",other:"menos de {{count}} segundos"},xSeconds:{one:"1 segundo",other:"{{count}} segundos"},halfAMinute:"meio minuto",lessThanXMinutes:{one:"menos de um minuto",other:"menos de {{count}} minutos"},xMinutes:{one:"1 minuto",other:"{{count}} minutos"},aboutXHours:{one:"cerca de 1 hora",other:"cerca de {{count}} horas"},xHours:{one:"1 hora",other:"{{count}} horas"},xDays:{one:"1 dia",other:"{{count}} dias"},aboutXWeeks:{one:"cerca de 1 semana",other:"cerca de {{count}} semanas"},xWeeks:{one:"1 semana",other:"{{count}} semanas"},aboutXMonths:{one:"cerca de 1 ms",other:"cerca de {{count}} meses"},xMonths:{one:"1 ms",other:"{{count}} meses"},aboutXYears:{one:"cerca de 1 ano",other:"cerca de {{count}} anos"},xYears:{one:"1 ano",other:"{{count}} anos"},overXYears:{one:"mais de 1 ano",other:"mais de {{count}} anos"},almostXYears:{one:"quase 1 ano",other:"quase {{count}} anos"}},aae=(e,t,i)=>{let l;const f=oae[e];return typeof f=="string"?l=f:t===1?l=f.one:l=f.other.replace("{{count}}",String(t)),i!=null&&i.addSuffix?i.comparison&&i.comparison>0?"em "+l:"h "+l:l},lae={full:"EEEE, d 'de' MMMM 'de' y",long:"d 'de' MMMM 'de' y",medium:"d MMM y",short:"dd/MM/yyyy"},cae={full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},uae={full:"{{date}} 's' {{time}}",long:"{{date}} 's' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},dae={date:iy({formats:lae,defaultWidth:"full"}),time:iy({formats:cae,defaultWidth:"full"}),dateTime:iy({formats:uae,defaultWidth:"full"})},hae={lastWeek:e=>{const t=e.getDay();return"'"+(t===0||t===6?"ltimo":"ltima")+"' eeee 's' p"},yesterday:"'ontem s' p",today:"'hoje s' p",tomorrow:"'amanh s' p",nextWeek:"eeee 's' p",other:"P"},fae=(e,t,i,l)=>{const f=hae[e];return typeof f=="function"?f(t):f},pae={narrow:["AC","DC"],abbreviated:["AC","DC"],wide:["antes de cristo","depois de cristo"]},mae={narrow:["1","2","3","4"],abbreviated:["T1","T2","T3","T4"],wide:["1 trimestre","2 trimestre","3 trimestre","4 trimestre"]},gae={narrow:["j","f","m","a","m","j","j","a","s","o","n","d"],abbreviated:["jan","fev","mar","abr","mai","jun","jul","ago","set","out","nov","dez"],wide:["janeiro","fevereiro","maro","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"]},_ae={narrow:["D","S","T","Q","Q","S","S"],short:["dom","seg","ter","qua","qui","sex","sab"],abbreviated:["domingo","segunda","tera","quarta","quinta","sexta","sbado"],wide:["domingo","segunda-feira","tera-feira","quarta-feira","quinta-feira","sexta-feira","sbado"]},yae={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"manh",afternoon:"tarde",evening:"tarde",night:"noite"},abbreviated:{am:"AM",pm:"PM",midnight:"meia-noite",noon:"meio-dia",morning:"manh",afternoon:"tarde",evening:"tarde",night:"noite"},wide:{am:"a.m.",pm:"p.m.",midnight:"meia-noite",noon:"meio-dia",morning:"manh",afternoon:"tarde",evening:"tarde",night:"noite"}},vae={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"da manh",afternoon:"da tarde",evening:"da tarde",night:"da noite"},abbreviated:{am:"AM",pm:"PM",midnight:"meia-noite",noon:"meio-dia",morning:"da manh",afternoon:"da tarde",evening:"da tarde",night:"da noite"},wide:{am:"a.m.",pm:"p.m.",midnight:"meia-noite",noon:"meio-dia",morning:"da manh",afternoon:"da tarde",evening:"da tarde",night:"da noite"}},xae=(e,t)=>{const i=Number(e);return(t==null?void 0:t.unit)==="week"?i+"":i+""},bae={ordinalNumber:xae,era:qu({values:pae,defaultWidth:"wide"}),quarter:qu({values:mae,defaultWidth:"wide",argumentCallback:e=>e-1}),month:qu({values:gae,defaultWidth:"wide"}),day:qu({values:_ae,defaultWidth:"wide"}),dayPeriod:qu({values:yae,defaultWidth:"wide",formattingValues:vae,defaultFormattingWidth:"wide"})},wae=/^(\d+)[o]?/i,Sae=/\d+/i,Tae={narrow:/^(ac|dc|a|d)/i,abbreviated:/^(a\.?\s?c\.?|d\.?\s?c\.?)/i,wide:/^(antes de cristo|depois de cristo)/i},Eae={any:[/^ac/i,/^dc/i],wide:[/^antes de cristo/i,/^depois de cristo/i]},Cae={narrow:/^[1234]/i,abbreviated:/^T[1234]/i,wide:/^[1234]()? trimestre/i},Aae={any:[/1/i,/2/i,/3/i,/4/i]},jae={narrow:/^[jfmajsond]/i,abbreviated:/^(jan|fev|mar|abr|mai|jun|jul|ago|set|out|nov|dez)/i,wide:/^(janeiro|fevereiro|maro|abril|maio|junho|julho|agosto|setembro|outubro|novembro|dezembro)/i},Iae={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^fev/i,/^mar/i,/^abr/i,/^mai/i,/^jun/i,/^jul/i,/^ago/i,/^set/i,/^out/i,/^nov/i,/^dez/i]},kae={narrow:/^(dom|[23456]?|s[a]b)/i,short:/^(dom|[23456]?|s[a]b)/i,abbreviated:/^(dom|seg|ter|qua|qui|sex|s[a]b)/i,wide:/^(domingo|(segunda|ter[c]a|quarta|quinta|sexta)([- ]feira)?|s[a]bado)/i},Pae={short:[/^d/i,/^2/i,/^3/i,/^4/i,/^5/i,/^6/i,/^s[a]/i],narrow:[/^d/i,/^2/i,/^3/i,/^4/i,/^5/i,/^6/i,/^s[a]/i],any:[/^d/i,/^seg/i,/^t/i,/^qua/i,/^qui/i,/^sex/i,/^s[a]b/i]},Rae={narrow:/^(a|p|mn|md|(da) (manh|tarde|noite))/i,any:/^([ap]\.?\s?m\.?|meia[-\s]noite|meio[-\s]dia|(da) (manh|tarde|noite))/i},Mae={any:{am:/^a/i,pm:/^p/i,midnight:/^mn|^meia[-\s]noite/i,noon:/^md|^meio[-\s]dia/i,morning:/manh/i,afternoon:/tarde/i,evening:/tarde/i,night:/noite/i}},Nae={ordinalNumber:u$({matchPattern:wae,parsePattern:Sae,valueCallback:e=>parseInt(e,10)}),era:Gu({matchPatterns:Tae,defaultMatchWidth:"wide",parsePatterns:Eae,defaultParseWidth:"any"}),quarter:Gu({matchPatterns:Cae,defaultMatchWidth:"wide",parsePatterns:Aae,defaultParseWidth:"any",valueCallback:e=>e+1}),month:Gu({matchPatterns:jae,defaultMatchWidth:"wide",parsePatterns:Iae,defaultParseWidth:"any"}),day:Gu({matchPatterns:kae,defaultMatchWidth:"wide",parsePatterns:Pae,defaultParseWidth:"any"}),dayPeriod:Gu({matchPatterns:Rae,defaultMatchWidth:"any",parsePatterns:Mae,defaultParseWidth:"any"})},js={code:"pt-BR",formatDistance:aae,formatLong:dae,formatRelative:fae,localize:bae,match:Nae,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Dae({chamado:e,open:t,onOpenChange:i,onEdit:l,onDelete:f}){var Ze;const{toast:_}=Hf(),x=Xf(),[o,A]=F.useState(""),[I,N]=F.useState(e.avaliacao||null),[U,$]=F.useState(null);F.useEffect(()=>{(async()=>{const{data:{user:Je}}=await Ge.auth.getUser();Je&&$(Je.id)})()},[]);const{data:V,isLoading:Y}=Ks({queryKey:["chamado-anexos-detalhes",e.id],enabled:t&&!!e.id,queryFn:async()=>{const{data:Xe,error:Je}=await Ge.from("chamados_anexos").select("*").eq("chamado_id",e.id).order("created_at",{ascending:!1});if(Je)throw Je;return Xe||[]}}),q=async Xe=>{var Je;try{const{data:Te,error:xe}=await Ge.storage.from("chamados-anexos").download(Xe.caminho_storage);if(xe||!Te)throw xe||new Error("Nenhum dado retornado do Storage");const Be=Te,dt=URL.createObjectURL(Be);if((Je=Xe.tipo_arquivo)!=null&&Je.startsWith("image/")||Xe.tipo_arquivo==="application/pdf")window.open(dt,"_blank"),setTimeout(()=>URL.revokeObjectURL(dt),6e4);else{const qt=document.createElement("a");qt.href=dt,qt.download=Xe.nome_arquivo,document.body.appendChild(qt),qt.click(),qt.remove(),URL.revokeObjectURL(dt)}}catch(Te){console.error("Erro ao abrir/baixar anexo:",Te),_({title:"Erro ao abrir anexo",description:"No foi possvel abrir o arquivo. Tente novamente.",variant:"destructive"})}},{data:Z,isLoading:Q}=Ks({queryKey:["chamados_comentarios",e.id],enabled:t&&!!e.id,queryFn:async()=>{const{data:Xe,error:Je}=await Ge.from("chamados_comentarios").select(`
          *,
          usuario:profiles(full_name)
        `).eq("chamado_id",e.id).order("created_at",{ascending:!0});if(Je)throw Je;return Xe}}),H=sS({mutationFn:async Xe=>{const{data:{user:Je}}=await Ge.auth.getUser();if(!Je)throw new Error("Usurio no autenticado");const{data:Te,error:xe}=await Ge.from("chamados_comentarios").insert([{chamado_id:e.id,usuario_id:Je.id,comentario:Xe}]).select(`
        *,
        usuario:profiles(full_name)
      `).single();if(xe)throw xe;return Te},onSuccess:Xe=>{x.setQueryData(["chamados_comentarios",e.id],Je=>[...Je||[],Xe]),A(""),_({title:"Comentrio adicionado com sucesso!"})},onError:Xe=>{_({title:"Erro ao adicionar comentrio",description:Xe.message,variant:"destructive"})}}),K=sS({mutationFn:async Xe=>{const{error:Je}=await Ge.from("chamados").update({avaliacao:Xe}).eq("id",e.id);if(Je)throw Je},onSuccess:()=>{_({title:"Avaliao registrada com sucesso!"})},onError:Xe=>{_({title:"Erro ao avaliar chamado",description:Xe.message,variant:"destructive"})}}),ne=sS({mutationFn:async()=>{if(!U)throw new Error("Usurio no autenticado");const{error:Xe}=await Ge.from("chamados").update({atribuido_para_id:U}).eq("id",e.id);if(Xe)throw Xe},onSuccess:()=>{x.invalidateQueries({queryKey:["chamados"]}),_({title:"Voc foi atribudo ao chamado com sucesso!"}),i(!1)},onError:Xe=>{_({title:"Erro ao atribuir chamado",description:Xe.message,variant:"destructive"})}}),le=sS({mutationFn:async()=>{const{error:Xe}=await Ge.from("chamados").update({status:"concluido",data_conclusao:new Date().toISOString()}).eq("id",e.id);if(Xe)throw Xe},onSuccess:()=>{x.invalidateQueries({queryKey:["chamados"]}),_({title:"Chamado concludo com sucesso!"}),i(!1)},onError:Xe=>{_({title:"Erro ao concluir chamado",description:Xe.message,variant:"destructive"})}}),pe=()=>{o.trim()&&H.mutate(o)},Ae=Xe=>{N(Xe),K.mutate(Xe)};return d.jsx(Vs,{open:t,onOpenChange:i,children:d.jsxs(Ms,{className:"max-w-4xl w-[95vw] max-h-[90vh] overflow-y-auto",children:[d.jsxs(Ns,{children:[d.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[d.jsxs(Ds,{className:"flex flex-col gap-1 sm:flex-row sm:items-center sm:gap-2",children:[d.jsx("span",{children:e.numero}),d.jsx(Gn,{children:(Ze=e.status)==null?void 0:Ze.replace("_"," ")})]}),d.jsxs("div",{className:"flex flex-wrap gap-2",children:[!e.atribuido_para_id&&U&&d.jsxs(Bt,{variant:"default",size:"sm",onClick:()=>ne.mutate(),disabled:ne.isPending,children:[d.jsx(f2,{className:"mr-2 h-4 w-4"}),"Atribuir para mim"]}),e.comentario_avaliacao&&d.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Comentrio: ",e.comentario_avaliacao]}),e.atribuido_para_id===U&&e.status!=="concluido"&&d.jsx(Bt,{variant:"default",size:"sm",onClick:()=>{confirm("Tem certeza que deseja concluir este chamado?")&&le.mutate()},disabled:le.isPending,children:"Concluir"}),d.jsx(Bt,{variant:"outline",size:"sm",onClick:()=>{l({...e,anexos:V??[]}),i(!1)},children:"Editar"}),d.jsx(Bt,{variant:"destructive",size:"sm",onClick:()=>{confirm("Tem certeza que deseja excluir este chamado?")&&(f(e.id),i(!1))},children:"Excluir"})]})]}),d.jsx(Qa,{children:"Consulte dados completos, anexos e comentrios antes de atualizar o chamado."})]}),d.jsx(Am,{}),d.jsxs(Sr,{className:"p-4",children:[d.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2",children:[d.jsx(rP,{className:"h-5 w-5"}),"Anexos"]}),Y?d.jsx(LT,{className:"h-16 w-full"}):V&&V.length>0?d.jsx("div",{className:"space-y-2",children:V.map(Xe=>d.jsxs("button",{type:"button",onClick:()=>q(Xe),className:"w-full flex items-center justify-between rounded-md border px-3 py-2 text-sm hover:bg-accent transition-colors",children:[d.jsxs("div",{className:"min-w-0 text-left",children:[d.jsx("p",{className:"truncate font-medium",children:Xe.nome_arquivo}),d.jsx("p",{className:"text-xs text-muted-foreground",children:Xe.created_at?Kn(new Date(Xe.created_at),"dd/MM/yyyy HH:mm",{locale:js}):"Sem data"})]}),d.jsx("span",{className:"text-xs text-primary underline",children:"Abrir / Baixar"})]},Xe.id))}):d.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum anexo cadastrado para este chamado."})]}),d.jsx(Am,{}),d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("h2",{className:"text-2xl font-bold mb-2",children:e.titulo}),e.descricao&&d.jsx("p",{className:"text-muted-foreground",children:e.descricao})]}),d.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[d.jsxs(Sr,{className:"p-4 space-y-2",children:[d.jsx("h3",{className:"font-semibold",children:"Informaes"}),d.jsxs("div",{className:"text-sm space-y-1",children:[d.jsxs("div",{children:[d.jsx("span",{className:"font-medium",children:"Tipo:"})," ",e.tipo]}),e.categoria&&d.jsxs("div",{children:[d.jsx("span",{className:"font-medium",children:"Categoria:"})," ",e.categoria]}),e.subcategoria&&d.jsxs("div",{children:[d.jsx("span",{className:"font-medium",children:"Subcategoria:"})," ",e.subcategoria]}),d.jsxs("div",{children:[d.jsx("span",{className:"font-medium",children:"Prioridade:"})," ",e.prioridade]}),d.jsxs("div",{children:[d.jsx("span",{className:"font-medium",children:"Canal:"})," ",e.canal]}),e.sla_horas&&d.jsxs("div",{children:[d.jsx("span",{className:"font-medium",children:"SLA:"})," ",e.sla_horas," horas"]}),typeof e.avaliacao=="number"&&d.jsxs("div",{children:[d.jsx("span",{className:"font-medium",children:"Nota NPS:"})," ",e.avaliacao,"/5"]}),e.comentario_avaliacao&&d.jsxs("div",{children:[d.jsx("span",{className:"font-medium",children:"Comentrio NPS:"})," ",e.comentario_avaliacao]})]})]}),d.jsxs(Sr,{className:"p-4 space-y-2",children:[d.jsx("h3",{className:"font-semibold",children:"Localizao"}),d.jsxs("div",{className:"text-sm space-y-1",children:[e.contrato&&d.jsxs("div",{children:[d.jsx("span",{className:"font-medium",children:"Contrato:"})," ",e.contrato.nome]}),e.unidade&&d.jsxs("div",{children:[d.jsx("span",{className:"font-medium",children:"Unidade:"})," ",e.unidade.nome]}),e.posto_servico&&d.jsxs("div",{children:[d.jsx("span",{className:"font-medium",children:"Posto:"})," ",e.posto_servico.nome]})]})]}),d.jsxs(Sr,{className:"p-4 space-y-2",children:[d.jsx("h3",{className:"font-semibold",children:"Pessoas"}),d.jsxs("div",{className:"text-sm space-y-1",children:[e.solicitante&&d.jsxs("div",{children:[d.jsx("span",{className:"font-medium",children:"Solicitante:"})," ",e.solicitante.nome_completo]}),e.atribuido&&d.jsxs("div",{children:[d.jsx("span",{className:"font-medium",children:"Atribudo:"})," ",e.atribuido.nome_completo]}),e.responsavel&&d.jsxs("div",{children:[d.jsx("span",{className:"font-medium",children:"Responsvel:"})," ",e.responsavel.full_name||e.responsavel.nome_completo]})]})]}),d.jsxs(Sr,{className:"p-4 space-y-2",children:[d.jsx("h3",{className:"font-semibold",children:"Datas"}),d.jsxs("div",{className:"text-sm space-y-1",children:[d.jsxs("div",{children:[d.jsx("span",{className:"font-medium",children:"Abertura:"})," ",Kn(new Date(e.data_abertura),"dd/MM/yyyy HH:mm",{locale:js})]}),e.data_conclusao&&d.jsxs("div",{children:[d.jsx("span",{className:"font-medium",children:"Concluso:"})," ",Kn(new Date(e.data_conclusao),"dd/MM/yyyy HH:mm",{locale:js})]})]})]})]}),e.status==="concluido"&&d.jsxs(Sr,{className:"p-4",children:[d.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2",children:[d.jsx(KZ,{className:"h-5 w-5"}),"Avaliacao do Chamado"]}),d.jsx("div",{className:"flex flex-wrap gap-2",children:[1,2,3,4,5].map(Xe=>d.jsx(Bt,{variant:I===Xe?"default":"outline",size:"sm",onClick:()=>Ae(Xe),children:Xe},Xe))}),I&&d.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Avaliao: ",I,"/5"]}),e.comentario_avaliacao&&d.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Comentrio: ",e.comentario_avaliacao]})]}),d.jsx(Am,{}),d.jsxs("div",{children:[d.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2",children:[d.jsx(ib,{className:"h-5 w-5"}),"Comentrios (",(Z==null?void 0:Z.length)||0,")"]}),d.jsx("div",{className:"space-y-3 mb-4",children:Q?d.jsx(LT,{className:"h-20 w-full"}):Z&&Z.length>0?Z.map(Xe=>{var Je;return d.jsx(Sr,{className:"p-3",children:d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsx(U4,{className:"h-8 w-8 text-muted-foreground"}),d.jsxs("div",{className:"flex-1",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[d.jsx("span",{className:"text-sm font-medium",children:((Je=Xe.usuario)==null?void 0:Je.full_name)||"Usurio"}),d.jsx("span",{className:"text-xs text-muted-foreground",children:Kn(new Date(Xe.created_at),"dd/MM/yyyy HH:mm",{locale:js})})]}),d.jsx("p",{className:"text-sm",children:Xe.comentario})]})]})},Xe.id)}):d.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum comentrio ainda"})}),d.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-start",children:[d.jsx(hu,{className:"w-full",placeholder:"Adicione um comentrio...",value:o,onChange:Xe=>A(Xe.target.value),rows:2}),d.jsx(Bt,{onClick:pe,disabled:!o.trim()||H.isPending,children:d.jsx(eI,{className:"h-4 w-4"})})]})]})]})]})})}function Oae(){const[e,t]=F.useState(""),[i,l]=F.useState("todos"),[f,_]=F.useState("todos"),[x,o]=F.useState("todos"),[A,I]=F.useState("todos"),[N,U]=F.useState(()=>Kn(new Date,"yyyy-MM")),[$,V]=F.useState(!1),[Y,q]=F.useState(null),[Z,Q]=F.useState(null),[H,K]=F.useState(null);F.useEffect(()=>{(async()=>{const{data:{user:st}}=await Ge.auth.getUser();st&&K(st.id)})()},[]);const{data:ne,isLoading:le,refetch:pe}=Ks({queryKey:["chamados",i,f,x,A,H],queryFn:async()=>{let Ke=Ge.from("chamados").select(`
          *,
          unidade:unidades(nome, codigo),
          responsavel:profiles(full_name)
        `).order("data_abertura",{ascending:!1});i!=="todos"&&(Ke=Ke.eq("status",i)),f!=="todos"&&(Ke=Ke.eq("categoria",f)),x!=="todos"&&(Ke=Ke.eq("prioridade",x)),A==="meus"&&H&&(Ke=Ke.eq("atribuido_para_id",H));const{data:st,error:Ne}=await Ke;if(Ne)throw Ne;return st}}),Ae=ne==null?void 0:ne.filter(Ke=>{var st,Ne,De;return((st=Ke.titulo)==null?void 0:st.toLowerCase().includes(e.toLowerCase()))||((Ne=Ke.numero)==null?void 0:Ne.toLowerCase().includes(e.toLowerCase()))||((De=Ke.descricao)==null?void 0:De.toLowerCase().includes(e.toLowerCase()))}),Ze={total:(ne==null?void 0:ne.length)||0,abertos:(ne==null?void 0:ne.filter(Ke=>Ke.status==="aberto").length)||0,em_andamento:(ne==null?void 0:ne.filter(Ke=>Ke.status==="em_andamento").length)||0,concluidos:(ne==null?void 0:ne.filter(Ke=>Ke.status==="concluido").length)||0},Xe=Array.from(new Set((ne||[]).flatMap(Ke=>[Ke.data_abertura,Ke.data_conclusao].filter(Boolean)).map(Ke=>Kn(new Date(Ke),"yyyy-MM")))).sort((Ke,st)=>Ke>st?-1:1),Je=(ne==null?void 0:ne.filter(Ke=>Ke.data_abertura&&Kn(new Date(Ke.data_abertura),"yyyy-MM")===N).length)||0,Te=(ne==null?void 0:ne.filter(Ke=>Ke.status==="concluido"&&Ke.data_conclusao&&Kn(new Date(Ke.data_conclusao),"yyyy-MM")===N).length)||0,xe=Ke=>{q(Ke),V(!0)},Be=async Ke=>{const{error:st}=await Ge.from("chamados").delete().eq("id",Ke);st||pe()},dt=Ke=>({aberto:"bg-yellow-500/10 text-yellow-600 border-yellow-500/20",em_andamento:"bg-blue-500/10 text-blue-600 border-blue-500/20",pendente:"bg-orange-500/10 text-orange-600 border-orange-500/20",concluido:"bg-green-500/10 text-green-600 border-green-500/20"})[Ke]||"",qt=Ke=>({baixa:"bg-gray-500/10 text-gray-600 border-gray-500/20",media:"bg-blue-500/10 text-blue-600 border-blue-500/20",alta:"bg-orange-500/10 text-orange-600 border-orange-500/20",critica:"bg-red-500/10 text-red-600 border-red-500/20"})[Ke]||"";return d.jsx(bo,{children:d.jsxs("div",{className:"space-y-6 p-4 md:p-6",children:[d.jsxs("div",{className:"flex flex-col gap-3 rounded-lg border bg-card p-4 md:flex-row md:items-center md:justify-between",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-3xl font-bold",children:"Chamados"}),d.jsx("p",{className:"text-muted-foreground",children:"Gesto completa de chamados e solicitaes"})]}),d.jsxs(Bt,{className:"w-full md:w-auto",onClick:()=>{q(null),V(!0)},children:[d.jsx(Ea,{className:"mr-2 h-4 w-4"}),"Novo Chamado"]})]}),d.jsxs("div",{className:"grid gap-4 rounded-lg border bg-card p-4 sm:grid-cols-2",children:[d.jsxs(Sr,{className:"p-4 text-center space-y-1",children:[d.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Abertos"}),d.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:Ze.abertos})]}),d.jsxs(Sr,{className:"p-4 text-center space-y-1",children:[d.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Em Andamento"}),d.jsx("div",{className:"text-2xl font-bold text-blue-600",children:Ze.em_andamento})]})]}),d.jsxs("div",{className:"rounded-lg border bg-card p-4 space-y-4",children:[d.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[d.jsx("h2",{className:"text-lg font-semibold",children:"Indicadores por ms"}),d.jsxs(Vr,{value:N,onValueChange:U,children:[d.jsx(Or,{className:"w-full sm:w-[200px]",children:d.jsx(Ur,{placeholder:"Selecione o ms"})}),d.jsxs(Lr,{children:[Xe.length===0&&d.jsx(bt,{value:N,children:Kn(new Date,"MMMM/yyyy",{locale:js})}),Xe.map(Ke=>d.jsx(bt,{value:Ke,children:Kn(new Date(Ke+"-01"),"MMMM/yyyy",{locale:js})},Ke))]})]})]}),d.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[d.jsxs(Sr,{className:"p-4 text-center space-y-1",children:[d.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Total do ms"}),d.jsx("div",{className:"text-2xl font-bold",children:Je})]}),d.jsxs(Sr,{className:"p-4 text-center space-y-1",children:[d.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Concludos no ms"}),d.jsx("div",{className:"text-2xl font-bold text-green-600",children:Te})]})]})]}),d.jsxs("div",{className:"rounded-lg border bg-card p-4 space-y-3",children:[d.jsxs("div",{className:"relative",children:[d.jsx(ou,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),d.jsx(gr,{placeholder:"Buscar por ttulo, nmero ou descrio...",value:e,onChange:Ke=>t(Ke.target.value),className:"pl-9"})]}),d.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-4",children:[d.jsxs(Vr,{value:i,onValueChange:l,children:[d.jsx(Or,{className:"w-full",children:d.jsx(Ur,{placeholder:"Status"})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"todos",children:"Todos Status"}),d.jsx(bt,{value:"aberto",children:"Aberto"}),d.jsx(bt,{value:"em_andamento",children:"Em Andamento"}),d.jsx(bt,{value:"pendente",children:"Pendente"}),d.jsx(bt,{value:"concluido",children:"Concludo"})]})]}),d.jsxs(Vr,{value:f,onValueChange:_,children:[d.jsx(Or,{className:"w-full",children:d.jsx(Ur,{placeholder:"Categoria"})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"todos",children:"Todas Categorias"}),d.jsx(bt,{value:"manutencao",children:"Manuteno"}),d.jsx(bt,{value:"rh",children:"RH"}),d.jsx(bt,{value:"suprimentos",children:"Suprimentos"}),d.jsx(bt,{value:"atendimento",children:"Atendimento"})]})]}),d.jsxs(Vr,{value:x,onValueChange:o,children:[d.jsx(Or,{className:"w-full",children:d.jsx(Ur,{placeholder:"Prioridade"})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"todos",children:"Todas Prioridades"}),d.jsx(bt,{value:"baixa",children:"Baixa"}),d.jsx(bt,{value:"media",children:"Mdia"}),d.jsx(bt,{value:"alta",children:"Alta"}),d.jsx(bt,{value:"critica",children:"Crtica"})]})]}),d.jsxs(Vr,{value:A,onValueChange:I,children:[d.jsx(Or,{className:"w-full",children:d.jsx(Ur,{placeholder:"Atribuio"})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"todos",children:"Todos"}),d.jsx(bt,{value:"meus",children:"Meus Chamados"})]})]})]})]}),d.jsx("div",{className:"rounded-md border p-4 overflow-x-auto",children:d.jsxs(Jl,{children:[d.jsx(Ql,{children:d.jsxs(Yi,{children:[d.jsx(Yr,{className:"hidden sm:table-cell",children:"Nmero"}),d.jsx(Yr,{children:"Ttulo"}),d.jsx(Yr,{className:"hidden sm:table-cell",children:"Unidade"}),d.jsx(Yr,{children:"Status"}),d.jsx(Yr,{children:"Prioridade"}),d.jsx(Yr,{className:"hidden sm:table-cell",children:"Data Abertura"}),d.jsx(Yr,{className:"hidden sm:table-cell text-right",children:"Aes"})]})}),d.jsx(ec,{children:Ae==null?void 0:Ae.map(Ke=>{var st,Ne;return d.jsxs(Yi,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>Q(Ke),children:[d.jsx(Pr,{className:"hidden font-mono text-sm sm:table-cell",children:Ke.numero}),d.jsx(Pr,{className:"font-medium",children:Ke.titulo}),d.jsx(Pr,{className:"hidden sm:table-cell",children:((st=Ke.unidade)==null?void 0:st.nome)||"-"}),d.jsx(Pr,{children:d.jsx(Gn,{variant:"outline",className:dt(Ke.status),children:(Ne=Ke.status)==null?void 0:Ne.replace("_"," ")})}),d.jsx(Pr,{children:d.jsx(Gn,{variant:"outline",className:qt(Ke.prioridade),children:Ke.prioridade})}),d.jsx(Pr,{className:"hidden sm:table-cell",children:Kn(new Date(Ke.data_abertura),"dd/MM/yyyy HH:mm",{locale:js})}),d.jsx(Pr,{className:"hidden sm:table-cell text-right",children:d.jsx(Bt,{variant:"ghost",size:"icon",onClick:De=>{De.stopPropagation(),Q(Ke)},children:d.jsx(h2,{className:"h-4 w-4"})})})]},Ke.id)})})]})}),$&&d.jsx(Ose,{open:$,onOpenChange:Ke=>{V(Ke),Ke||q(null)},chamado:Y,onSuccess:()=>{V(!1),q(null),pe()}}),Z&&d.jsx(Dae,{chamado:Z,open:!!Z,onOpenChange:Ke=>!Ke&&Q(null),onEdit:xe,onDelete:Be})]})})}var WA="rovingFocusGroup.onEntryFocus",Lae={bubbles:!1,cancelable:!0},Bb="RovingFocusGroup",[QI,y$,zae]=Jk(Bb),[Fae,v$]=rd(Bb,[zae]),[Bae,Vae]=Fae(Bb),x$=F.forwardRef((e,t)=>d.jsx(QI.Provider,{scope:e.__scopeRovingFocusGroup,children:d.jsx(QI.Slot,{scope:e.__scopeRovingFocusGroup,children:d.jsx(Uae,{...e,ref:t})})}));x$.displayName=Bb;var Uae=F.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:i,orientation:l,loop:f=!1,dir:_,currentTabStopId:x,defaultCurrentTabStopId:o,onCurrentTabStopIdChange:A,onEntryFocus:I,preventScrollOnEntryFocus:N=!1,...U}=e,$=F.useRef(null),V=bs(t,$),Y=VP(_),[q,Z]=Of({prop:x,defaultProp:o??null,onChange:A,caller:Bb}),[Q,H]=F.useState(!1),K=vc(I),ne=y$(i),le=F.useRef(!1),[pe,Ae]=F.useState(0);return F.useEffect(()=>{const Ze=$.current;if(Ze)return Ze.addEventListener(WA,K),()=>Ze.removeEventListener(WA,K)},[K]),d.jsx(Bae,{scope:i,orientation:l,dir:Y,loop:f,currentTabStopId:q,onItemFocus:F.useCallback(Ze=>Z(Ze),[Z]),onItemShiftTab:F.useCallback(()=>H(!0),[]),onFocusableItemAdd:F.useCallback(()=>Ae(Ze=>Ze+1),[]),onFocusableItemRemove:F.useCallback(()=>Ae(Ze=>Ze-1),[]),children:d.jsx(xi.div,{tabIndex:Q||pe===0?-1:0,"data-orientation":l,...U,ref:V,style:{outline:"none",...e.style},onMouseDown:Vn(e.onMouseDown,()=>{le.current=!0}),onFocus:Vn(e.onFocus,Ze=>{const Xe=!le.current;if(Ze.target===Ze.currentTarget&&Xe&&!Q){const Je=new CustomEvent(WA,Lae);if(Ze.currentTarget.dispatchEvent(Je),!Je.defaultPrevented){const Te=ne().filter(Ke=>Ke.focusable),xe=Te.find(Ke=>Ke.active),Be=Te.find(Ke=>Ke.id===q),qt=[xe,Be,...Te].filter(Boolean).map(Ke=>Ke.ref.current);S$(qt,N)}}le.current=!1}),onBlur:Vn(e.onBlur,()=>H(!1))})})}),b$="RovingFocusGroupItem",w$=F.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:i,focusable:l=!0,active:f=!1,tabStopId:_,children:x,...o}=e,A=Wd(),I=_||A,N=Vae(b$,i),U=N.currentTabStopId===I,$=y$(i),{onFocusableItemAdd:V,onFocusableItemRemove:Y,currentTabStopId:q}=N;return F.useEffect(()=>{if(l)return V(),()=>Y()},[l,V,Y]),d.jsx(QI.ItemSlot,{scope:i,id:I,focusable:l,active:f,children:d.jsx(xi.span,{tabIndex:U?0:-1,"data-orientation":N.orientation,...o,ref:t,onMouseDown:Vn(e.onMouseDown,Z=>{l?N.onItemFocus(I):Z.preventDefault()}),onFocus:Vn(e.onFocus,()=>N.onItemFocus(I)),onKeyDown:Vn(e.onKeyDown,Z=>{if(Z.key==="Tab"&&Z.shiftKey){N.onItemShiftTab();return}if(Z.target!==Z.currentTarget)return;const Q=Gae(Z,N.orientation,N.dir);if(Q!==void 0){if(Z.metaKey||Z.ctrlKey||Z.altKey||Z.shiftKey)return;Z.preventDefault();let K=$().filter(ne=>ne.focusable).map(ne=>ne.ref.current);if(Q==="last")K.reverse();else if(Q==="prev"||Q==="next"){Q==="prev"&&K.reverse();const ne=K.indexOf(Z.currentTarget);K=N.loop?Hae(K,ne+1):K.slice(ne+1)}setTimeout(()=>S$(K))}}),children:typeof x=="function"?x({isCurrentTabStop:U,hasTabStop:q!=null}):x})})});w$.displayName=b$;var $ae={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function qae(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function Gae(e,t,i){const l=qae(e.key,i);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(l))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(l)))return $ae[l]}function S$(e,t=!1){const i=document.activeElement;for(const l of e)if(l===i||(l.focus({preventScroll:t}),document.activeElement!==i))return}function Hae(e,t){return e.map((i,l)=>e[(t+l)%e.length])}var Wae=x$,Zae=w$,L2="Tabs",[Xae,Ade]=rd(L2,[v$]),T$=v$(),[Kae,QP]=Xae(L2),E$=F.forwardRef((e,t)=>{const{__scopeTabs:i,value:l,onValueChange:f,defaultValue:_,orientation:x="horizontal",dir:o,activationMode:A="automatic",...I}=e,N=VP(o),[U,$]=Of({prop:l,onChange:f,defaultProp:_??"",caller:L2});return d.jsx(Kae,{scope:i,baseId:Wd(),value:U,onValueChange:$,orientation:x,dir:N,activationMode:A,children:d.jsx(xi.div,{dir:N,"data-orientation":x,...I,ref:t})})});E$.displayName=L2;var C$="TabsList",A$=F.forwardRef((e,t)=>{const{__scopeTabs:i,loop:l=!0,...f}=e,_=QP(C$,i),x=T$(i);return d.jsx(Wae,{asChild:!0,...x,orientation:_.orientation,dir:_.dir,loop:l,children:d.jsx(xi.div,{role:"tablist","aria-orientation":_.orientation,...f,ref:t})})});A$.displayName=C$;var j$="TabsTrigger",I$=F.forwardRef((e,t)=>{const{__scopeTabs:i,value:l,disabled:f=!1,..._}=e,x=QP(j$,i),o=T$(i),A=R$(x.baseId,l),I=M$(x.baseId,l),N=l===x.value;return d.jsx(Zae,{asChild:!0,...o,focusable:!f,active:N,children:d.jsx(xi.button,{type:"button",role:"tab","aria-selected":N,"aria-controls":I,"data-state":N?"active":"inactive","data-disabled":f?"":void 0,disabled:f,id:A,..._,ref:t,onMouseDown:Vn(e.onMouseDown,U=>{!f&&U.button===0&&U.ctrlKey===!1?x.onValueChange(l):U.preventDefault()}),onKeyDown:Vn(e.onKeyDown,U=>{[" ","Enter"].includes(U.key)&&x.onValueChange(l)}),onFocus:Vn(e.onFocus,()=>{const U=x.activationMode!=="manual";!N&&!f&&U&&x.onValueChange(l)})})})});I$.displayName=j$;var k$="TabsContent",P$=F.forwardRef((e,t)=>{const{__scopeTabs:i,value:l,forceMount:f,children:_,...x}=e,o=QP(k$,i),A=R$(o.baseId,l),I=M$(o.baseId,l),N=l===o.value,U=F.useRef(N);return F.useEffect(()=>{const $=requestAnimationFrame(()=>U.current=!1);return()=>cancelAnimationFrame($)},[]),d.jsx(Wf,{present:f||N,children:({present:$})=>d.jsx(xi.div,{"data-state":N?"active":"inactive","data-orientation":o.orientation,role:"tabpanel","aria-labelledby":A,hidden:!$,id:I,tabIndex:0,...x,ref:t,style:{...e.style,animationDuration:U.current?"0s":void 0},children:$&&_})})});P$.displayName=k$;function R$(e,t){return`${e}-trigger-${t}`}function M$(e,t){return`${e}-content-${t}`}var Yae=E$,N$=A$,D$=I$,O$=P$;const eR=Yae,z2=F.forwardRef(({className:e,...t},i)=>d.jsx(N$,{ref:i,className:wr("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));z2.displayName=N$.displayName;const $d=F.forwardRef(({className:e,...t},i)=>d.jsx(D$,{ref:i,className:wr("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",e),...t}));$d.displayName=D$.displayName;const qd=F.forwardRef(({className:e,...t},i)=>d.jsx(O$,{ref:i,className:wr("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));qd.displayName=O$.displayName;const Jae=({clienteId:e,onClose:t,onSuccess:i})=>{const[l,f]=F.useState(!1),_={razao_social:"",cnpj:"",contato_nome:"",contato_email:"",contato_telefone:"",status:"ativo"},[x,o]=F.useState(_);F.useEffect(()=>{if(!e){o(_);return}(async()=>{f(!0);const{data:N,error:U}=await Ge.from("clientes").select("razao_social, cnpj, contato_nome, contato_email, contato_telefone, status").eq("id",e).single();U?In({title:"Erro",description:"No foi possvel carregar os dados do cliente",variant:"destructive"}):N&&o({razao_social:N.razao_social??"",cnpj:N.cnpj??"",contato_nome:N.contato_nome??"",contato_email:N.contato_email??"",contato_telefone:N.contato_telefone??"",status:N.status??"ativo"}),f(!1)})()},[e]);const A=async I=>{I.preventDefault(),f(!0);try{if(e){const{error:N}=await Ge.from("clientes").update(x).eq("id",e);if(N)throw N;In({title:"Cliente atualizado",description:"Cliente atualizado com sucesso"})}else{const{error:N}=await Ge.from("clientes").insert([x]);if(N)throw N;In({title:"Cliente criado",description:"Cliente criado com sucesso"})}i()}catch(N){In({title:"Erro",description:N.message,variant:"destructive"})}finally{f(!1)}};return d.jsx(Vs,{open:!0,onOpenChange:t,children:d.jsxs(Ms,{className:"max-w-2xl w-full",children:[d.jsxs(Ns,{children:[d.jsx(Ds,{children:e?"Editar Cliente":"Novo Cliente"}),d.jsx(Qa,{children:"Preencha os dados do cliente"})]}),d.jsxs("form",{onSubmit:A,className:"space-y-4",children:[d.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"razao_social",children:"Razao Social *"}),d.jsx(gr,{id:"razao_social",value:x.razao_social,onChange:I=>o({...x,razao_social:I.target.value}),required:!0})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"cnpj",children:"CNPJ *"}),d.jsx(gr,{id:"cnpj",value:x.cnpj,onChange:I=>o({...x,cnpj:I.target.value}),placeholder:"00.000.000/0000-00",required:!0})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"contato_nome",children:"Nome do Contato"}),d.jsx(gr,{id:"contato_nome",value:x.contato_nome,onChange:I=>o({...x,contato_nome:I.target.value})})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"contato_email",children:"Email do Contato"}),d.jsx(gr,{id:"contato_email",type:"email",value:x.contato_email,onChange:I=>o({...x,contato_email:I.target.value})})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"contato_telefone",children:"Telefone do Contato"}),d.jsx(gr,{id:"contato_telefone",value:x.contato_telefone,onChange:I=>o({...x,contato_telefone:I.target.value}),placeholder:"(00) 00000-0000"})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"status",children:"Status"}),d.jsxs(Vr,{value:x.status,onValueChange:I=>o({...x,status:I}),children:[d.jsx(Or,{children:d.jsx(Ur,{})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"ativo",children:"Ativo"}),d.jsx(bt,{value:"inativo",children:"Inativo"})]})]})]})]}),d.jsxs("div",{className:"flex justify-end gap-2",children:[d.jsx(Bt,{type:"button",variant:"outline",onClick:t,children:"Cancelar"}),d.jsxs(Bt,{type:"submit",disabled:l,children:[l&&d.jsx(nd,{className:"mr-2 h-4 w-4 animate-spin"}),e?"Atualizar":"Criar"]})]})]})]})})},Qae=({contratoId:e,clienteId:t,onClose:i,onSuccess:l})=>{const[f,_]=F.useState(!1),[x,o]=F.useState([]),A={cliente_id:t||"",nome:"",codigo:"",data_inicio:"",data_fim:"",sla_alvo_pct:"95",nps_meta:"",status:"ativo"},[I,N]=F.useState(A);F.useEffect(()=>{U()},[]),F.useEffect(()=>{if(!e){N(Y=>({...A,cliente_id:t||""}));return}(async()=>{var Z,Q;_(!0);const{data:Y,error:q}=await Ge.from("contratos").select("cliente_id, nome, codigo, data_inicio, data_fim, sla_alvo_pct, nps_meta, status").eq("id",e).single();q?In({title:"Erro",description:"No foi possvel carregar os dados do contrato",variant:"destructive"}):Y&&N({cliente_id:Y.cliente_id??"",nome:Y.nome??"",codigo:Y.codigo??"",data_inicio:Y.data_inicio??"",data_fim:Y.data_fim??"",sla_alvo_pct:((Z=Y.sla_alvo_pct)==null?void 0:Z.toString())??"95",nps_meta:((Q=Y.nps_meta)==null?void 0:Q.toString())??"",status:Y.status??"ativo"}),_(!1)})()},[e,t]);const U=async()=>{const{data:V}=await Ge.from("clientes").select("id, razao_social").eq("status","ativo").order("razao_social");o(V||[])},$=async V=>{V.preventDefault(),_(!0);try{const Y={...I,sla_alvo_pct:parseFloat(I.sla_alvo_pct),nps_meta:I.nps_meta?parseFloat(I.nps_meta):null,data_fim:I.data_fim||null};if(e){const{error:q}=await Ge.from("contratos").update(Y).eq("id",e);if(q)throw q;In({title:"Contrato atualizado",description:"Contrato atualizado com sucesso"})}else{const{error:q}=await Ge.from("contratos").insert([Y]);if(q)throw q;In({title:"Contrato criado",description:"Contrato criado com sucesso"})}l()}catch(Y){In({title:"Erro",description:Y.message,variant:"destructive"})}finally{_(!1)}};return d.jsx(Vs,{open:!0,onOpenChange:i,children:d.jsxs(Ms,{className:"max-w-2xl w-full",children:[d.jsxs(Ns,{children:[d.jsx(Ds,{children:e?"Editar Contrato":"Novo Contrato"}),d.jsx(Qa,{children:"Preencha os dados do contrato"})]}),d.jsxs("form",{onSubmit:$,className:"space-y-4",children:[d.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[d.jsxs("div",{className:"space-y-2 sm:col-span-2",children:[d.jsx(Gt,{htmlFor:"cliente_id",children:"Cliente *"}),d.jsxs(Vr,{value:I.cliente_id,onValueChange:V=>N({...I,cliente_id:V}),disabled:!!t,children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Selecione um cliente"})}),d.jsx(Lr,{children:x.map(V=>d.jsx(bt,{value:V.id,children:V.razao_social},V.id))})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"nome",children:"Nome do Contrato *"}),d.jsx(gr,{id:"nome",value:I.nome,onChange:V=>N({...I,nome:V.target.value}),required:!0})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"codigo",children:"Cdigo *"}),d.jsx(gr,{id:"codigo",value:I.codigo,onChange:V=>N({...I,codigo:V.target.value}),required:!0})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"data_inicio",children:"Data Incio *"}),d.jsx(gr,{id:"data_inicio",type:"date",value:I.data_inicio,onChange:V=>N({...I,data_inicio:V.target.value}),required:!0})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"data_fim",children:"Data Fim"}),d.jsx(gr,{id:"data_fim",type:"date",value:I.data_fim,onChange:V=>N({...I,data_fim:V.target.value})})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"sla_alvo_pct",children:"SLA Alvo (%)"}),d.jsx(gr,{id:"sla_alvo_pct",type:"number",step:"0.01",value:I.sla_alvo_pct,onChange:V=>N({...I,sla_alvo_pct:V.target.value})})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"nps_meta",children:"NPS Meta"}),d.jsx(gr,{id:"nps_meta",type:"number",step:"0.01",value:I.nps_meta,onChange:V=>N({...I,nps_meta:V.target.value})})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"status",children:"Status"}),d.jsxs(Vr,{value:I.status,onValueChange:V=>N({...I,status:V}),children:[d.jsx(Or,{children:d.jsx(Ur,{})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"ativo",children:"Ativo"}),d.jsx(bt,{value:"inativo",children:"Inativo"}),d.jsx(bt,{value:"suspenso",children:"Suspenso"})]})]})]})]}),d.jsxs("div",{className:"flex justify-end gap-2",children:[d.jsx(Bt,{type:"button",variant:"outline",onClick:i,children:"Cancelar"}),d.jsxs(Bt,{type:"submit",disabled:f,children:[f&&d.jsx(nd,{className:"mr-2 h-4 w-4 animate-spin"}),e?"Atualizar":"Criar"]})]})]})]})})},ele=({unidadeId:e,contratoId:t,onClose:i,onSuccess:l})=>{const[f,_]=F.useState(!1),[x,o]=F.useState([]),[A,I]=F.useState({contrato_id:t||"",nome:"",codigo:"",endereco:"",cidade:"",uf:"",cep:"",latitude:"",longitude:"",status:"ativo"});F.useEffect(()=>{N(),e&&U()},[e]);const N=async()=>{const{data:V}=await Ge.from("contratos").select("id, nome").eq("status","ativo").order("nome");o(V||[])},U=async()=>{if(!e)return;const{data:V,error:Y}=await Ge.from("unidades").select("*").eq("id",e).single();if(Y){In({title:"Erro ao carregar unidade",description:Y.message,variant:"destructive"});return}V&&I({contrato_id:V.contrato_id||"",nome:V.nome,codigo:V.codigo,endereco:V.endereco||"",cidade:V.cidade||"",uf:V.uf||"",cep:V.cep||"",latitude:V.latitude?String(V.latitude):"",longitude:V.longitude?String(V.longitude):"",status:V.status||"ativo"})},$=async V=>{V.preventDefault(),_(!0);try{const Y={...A,latitude:A.latitude?parseFloat(A.latitude):null,longitude:A.longitude?parseFloat(A.longitude):null};if(e){const{error:q}=await Ge.from("unidades").update(Y).eq("id",e);if(q)throw q;In({title:"Unidade atualizada",description:"Unidade atualizada com sucesso"})}else{const{error:q}=await Ge.from("unidades").insert([Y]);if(q)throw q;In({title:"Unidade criada",description:"Unidade criada com sucesso"})}l()}catch(Y){In({title:"Erro",description:Y.message,variant:"destructive"})}finally{_(!1)}};return d.jsx(Vs,{open:!0,onOpenChange:i,children:d.jsxs(Ms,{className:"max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[d.jsxs(Ns,{children:[d.jsx(Ds,{children:e?"Editar Unidade":"Nova Unidade"}),d.jsx(Qa,{children:"Preencha os dados da unidade"})]}),d.jsxs("form",{onSubmit:$,className:"space-y-4",children:[d.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[d.jsxs("div",{className:"space-y-2 sm:col-span-2",children:[d.jsx(Gt,{htmlFor:"contrato_id",children:"Contrato *"}),d.jsxs(Vr,{value:A.contrato_id,onValueChange:V=>I({...A,contrato_id:V}),disabled:!!t,children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Selecione um contrato"})}),d.jsx(Lr,{children:x.map(V=>d.jsx(bt,{value:V.id,children:V.nome},V.id))})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"nome",children:"Nome *"}),d.jsx(gr,{id:"nome",value:A.nome,onChange:V=>I({...A,nome:V.target.value}),required:!0})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"codigo",children:"Cdigo *"}),d.jsx(gr,{id:"codigo",value:A.codigo,onChange:V=>I({...A,codigo:V.target.value}),required:!0})]}),d.jsxs("div",{className:"space-y-2 sm:col-span-2",children:[d.jsx(Gt,{htmlFor:"endereco",children:"Endereo"}),d.jsx(gr,{id:"endereco",value:A.endereco,onChange:V=>I({...A,endereco:V.target.value})})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"cidade",children:"Cidade"}),d.jsx(gr,{id:"cidade",value:A.cidade,onChange:V=>I({...A,cidade:V.target.value})})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"uf",children:"UF"}),d.jsx(gr,{id:"uf",value:A.uf,onChange:V=>I({...A,uf:V.target.value.toUpperCase()}),maxLength:2,placeholder:"SP"})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"cep",children:"CEP"}),d.jsx(gr,{id:"cep",value:A.cep,onChange:V=>I({...A,cep:V.target.value}),placeholder:"00000-000"})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"latitude",children:"Latitude"}),d.jsx(gr,{id:"latitude",type:"number",step:"any",value:A.latitude,onChange:V=>I({...A,latitude:V.target.value}),placeholder:"-15.7801"})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"longitude",children:"Longitude"}),d.jsx(gr,{id:"longitude",type:"number",step:"any",value:A.longitude,onChange:V=>I({...A,longitude:V.target.value}),placeholder:"-47.9292"})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"status",children:"Status"}),d.jsxs(Vr,{value:A.status,onValueChange:V=>I({...A,status:V}),children:[d.jsx(Or,{children:d.jsx(Ur,{})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"ativo",children:"Ativo"}),d.jsx(bt,{value:"inativo",children:"Inativo"})]})]})]})]}),d.jsxs("div",{className:"flex justify-end gap-2",children:[d.jsx(Bt,{type:"button",variant:"outline",onClick:i,children:"Cancelar"}),d.jsxs(Bt,{type:"submit",disabled:f,children:[f&&d.jsx(nd,{className:"mr-2 h-4 w-4 animate-spin"}),e?"Atualizar":"Criar"]})]})]})]})})};var F2="Checkbox",[tle,jde]=rd(F2),[rle,tR]=tle(F2);function nle(e){const{__scopeCheckbox:t,checked:i,children:l,defaultChecked:f,disabled:_,form:x,name:o,onCheckedChange:A,required:I,value:N="on",internal_do_not_use_render:U}=e,[$,V]=Of({prop:i,defaultProp:f??!1,onChange:A,caller:F2}),[Y,q]=F.useState(null),[Z,Q]=F.useState(null),H=F.useRef(!1),K=Y?!!x||!!Y.closest("form"):!0,ne={checked:$,disabled:_,setChecked:V,control:Y,setControl:q,name:o,form:x,value:N,hasConsumerStoppedPropagationRef:H,required:I,defaultChecked:Mf(f)?!1:f,isFormControl:K,bubbleInput:Z,setBubbleInput:Q};return d.jsx(rle,{scope:t,...ne,children:ile(U)?U(ne):l})}var L$="CheckboxTrigger",z$=F.forwardRef(({__scopeCheckbox:e,onKeyDown:t,onClick:i,...l},f)=>{const{control:_,value:x,disabled:o,checked:A,required:I,setControl:N,setChecked:U,hasConsumerStoppedPropagationRef:$,isFormControl:V,bubbleInput:Y}=tR(L$,e),q=bs(f,N),Z=F.useRef(A);return F.useEffect(()=>{const Q=_==null?void 0:_.form;if(Q){const H=()=>U(Z.current);return Q.addEventListener("reset",H),()=>Q.removeEventListener("reset",H)}},[_,U]),d.jsx(xi.button,{type:"button",role:"checkbox","aria-checked":Mf(A)?"mixed":A,"aria-required":I,"data-state":$$(A),"data-disabled":o?"":void 0,disabled:o,value:x,...l,ref:q,onKeyDown:Vn(t,Q=>{Q.key==="Enter"&&Q.preventDefault()}),onClick:Vn(i,Q=>{U(H=>Mf(H)?!0:!H),Y&&V&&($.current=Q.isPropagationStopped(),$.current||Q.stopPropagation())})})});z$.displayName=L$;var rR=F.forwardRef((e,t)=>{const{__scopeCheckbox:i,name:l,checked:f,defaultChecked:_,required:x,disabled:o,value:A,onCheckedChange:I,form:N,...U}=e;return d.jsx(nle,{__scopeCheckbox:i,checked:f,defaultChecked:_,disabled:o,required:x,onCheckedChange:I,name:l,form:N,value:A,internal_do_not_use_render:({isFormControl:$})=>d.jsxs(d.Fragment,{children:[d.jsx(z$,{...U,ref:t,__scopeCheckbox:i}),$&&d.jsx(U$,{__scopeCheckbox:i})]})})});rR.displayName=F2;var F$="CheckboxIndicator",B$=F.forwardRef((e,t)=>{const{__scopeCheckbox:i,forceMount:l,...f}=e,_=tR(F$,i);return d.jsx(Wf,{present:l||Mf(_.checked)||_.checked===!0,children:d.jsx(xi.span,{"data-state":$$(_.checked),"data-disabled":_.disabled?"":void 0,...f,ref:t,style:{pointerEvents:"none",...e.style}})})});B$.displayName=F$;var V$="CheckboxBubbleInput",U$=F.forwardRef(({__scopeCheckbox:e,...t},i)=>{const{control:l,hasConsumerStoppedPropagationRef:f,checked:_,defaultChecked:x,required:o,disabled:A,name:I,value:N,form:U,bubbleInput:$,setBubbleInput:V}=tR(V$,e),Y=bs(i,V),q=o6(_),Z=p5(l);F.useEffect(()=>{const H=$;if(!H)return;const K=window.HTMLInputElement.prototype,le=Object.getOwnPropertyDescriptor(K,"checked").set,pe=!f.current;if(q!==_&&le){const Ae=new Event("click",{bubbles:pe});H.indeterminate=Mf(_),le.call(H,Mf(_)?!1:_),H.dispatchEvent(Ae)}},[$,q,_,f]);const Q=F.useRef(Mf(_)?!1:_);return d.jsx(xi.input,{type:"checkbox","aria-hidden":!0,defaultChecked:x??Q.current,required:o,disabled:A,name:I,value:N,form:U,...t,tabIndex:-1,ref:Y,style:{...t.style,...Z,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});U$.displayName=V$;function ile(e){return typeof e=="function"}function Mf(e){return e==="indeterminate"}function $$(e){return Mf(e)?"indeterminate":e?"checked":"unchecked"}const q$=F.forwardRef(({className:e,...t},i)=>d.jsx(rR,{ref:i,className:wr("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...t,children:d.jsx(B$,{className:wr("flex items-center justify-center text-current"),children:d.jsx(z4,{className:"h-4 w-4"})})}));q$.displayName=rR.displayName;const sle=[{value:0,label:"Domingo"},{value:1,label:"Segunda-feira"},{value:2,label:"Tera-feira"},{value:3,label:"Quarta-feira"},{value:4,label:"Quinta-feira"},{value:5,label:"Sexta-feira"},{value:6,label:"Sbado"}],qT=[{value:"vago",label:"Vago"},{value:"ocupado",label:"Ocupado"},{value:"vago_temporariamente",label:"Vago temporariamente"},{value:"ocupado_temporariamente",label:"Ocupado temporariamente"},{value:"presenca_confirmada",label:"Presenca confirmada"},{value:"inativo",label:"Inativo (encerrado)"}],ZA=new Set(["5x2","6x1"]),ole=e=>{var t;return((t=qT.find(i=>i.value===e))==null?void 0:t.value)??qT[0].value},ale=({postoId:e,unidadeId:t,onClose:i,onSuccess:l})=>{const[f,_]=F.useState(!1),[x,o]=F.useState([]),A={unidade_id:t||"",nome:"",codigo:"",funcao:"",escala:"",dias_semana:[],jornada:"",horario_inicio:"",horario_fim:"",intervalo_refeicao:"",status:qT[0].value,observacoes:"",beneficios:[],primeiro_dia_atividade:"",ultimo_dia_atividade:""},[I,N]=F.useState(A);F.useEffect(()=>{U()},[]),F.useEffect(()=>{N(Y=>!ZA.has(Y.escala)&&Y.dias_semana.length>0?{...Y,dias_semana:[]}:Y)},[I.escala]),F.useEffect(()=>{if(!e){N({...A,unidade_id:t||""});return}(async()=>{var Q,H;_(!0);const{data:q,error:Z}=await Ge.from("postos_servico").select("unidade_id, nome, codigo, funcao, escala, dias_semana, jornada, horario_inicio, horario_fim, intervalo_refeicao, status, observacoes, beneficios, primeiro_dia_atividade, ultimo_dia_atividade").eq("id",e).single();Z?In({title:"Erro",description:"No foi possvel carregar os dados do posto",variant:"destructive"}):q&&N({unidade_id:q.unidade_id??"",nome:q.nome??"",codigo:q.codigo??"",funcao:q.funcao??"",escala:q.escala??"",dias_semana:Array.isArray(q.dias_semana)?q.dias_semana.map(K=>Number(K)):[],jornada:((Q=q.jornada)==null?void 0:Q.toString())??"",horario_inicio:q.horario_inicio??"",horario_fim:q.horario_fim??"",intervalo_refeicao:((H=q.intervalo_refeicao)==null?void 0:H.toString())??"",status:ole(q.status),observacoes:q.observacoes??"",beneficios:Array.isArray(q.beneficios)?q.beneficios.filter(K=>typeof K=="string"):[],primeiro_dia_atividade:q.primeiro_dia_atividade??"",ultimo_dia_atividade:q.ultimo_dia_atividade??""}),_(!1)})()},[e,t]);const U=async()=>{const{data:Y}=await Ge.from("unidades").select("id, nome").eq("status","ativo").order("nome");o(Y||[])},$=async Y=>{Y.preventDefault(),_(!0);try{const{unidade_id:q,nome:Z,codigo:Q,funcao:H,escala:K,dias_semana:ne,jornada:le,horario_inicio:pe,horario_fim:Ae,intervalo_refeicao:Ze,status:Xe,observacoes:Je,beneficios:Te,primeiro_dia_atividade:xe,ultimo_dia_atividade:Be}=I;if(ZA.has(K)&&ne.length===0){In({title:"Dias obrigatorios",description:"Selecione ao menos um dia da semana para as escalas 5x2 ou 6x1.",variant:"destructive"}),_(!1);return}const dt=Te.map(Ke=>Ke.trim()).filter(Ke=>Ke.length>0),qt={unidade_id:q,nome:Z,codigo:Q,funcao:H,escala:K,dias_semana:ne.length?ne:null,jornada:le?parseInt(le):null,horario_inicio:pe,horario_fim:Ae,intervalo_refeicao:Ze?parseInt(Ze):null,status:Xe,observacoes:Je||null,beneficios:dt.length?dt:null,primeiro_dia_atividade:xe||null,ultimo_dia_atividade:Be||null};if(e){const{error:Ke}=await Ge.from("postos_servico").update(qt).eq("id",e);if(Ke)throw Ke;In({title:"Posto atualizado",description:"Posto atualizado com sucesso"})}else{const{error:Ke}=await Ge.from("postos_servico").insert([qt]);if(Ke)throw Ke;In({title:"Posto criado",description:"Posto criado com sucesso"})}l()}catch(q){const Z=typeof(q==null?void 0:q.message)=="string"?q.message:"No foi possvel salvar o posto. Tente novamente.",Q=Z.includes("ON CONFLICT DO UPDATE not supported")?"O posto foi salvo, mas houve uma tentativa duplicada de sincronizar dias vagos. Recarregue a pgina ou tente novamente.":Z;In({title:"Erro",description:Q,variant:"destructive"})}finally{_(!1)}},V=ZA.has(I.escala);return d.jsx(Vs,{open:!0,onOpenChange:i,children:d.jsxs(Ms,{className:"max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[d.jsxs(Ns,{children:[d.jsx(Ds,{children:e?"Editar Posto":"Novo Posto"}),d.jsx(Qa,{children:"Preencha os dados do posto de servio"})]}),d.jsxs("form",{onSubmit:$,className:"space-y-4",children:[d.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[d.jsxs("div",{className:"space-y-2 sm:col-span-2",children:[d.jsx(Gt,{htmlFor:"unidade_id",children:"Unidade *"}),d.jsxs(Vr,{value:I.unidade_id,onValueChange:Y=>N({...I,unidade_id:Y}),disabled:!!t,children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Selecione"})}),d.jsx(Lr,{children:x.map(Y=>d.jsx(bt,{value:Y.id,children:Y.nome},Y.id))})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"nome",children:"Nome *"}),d.jsx(gr,{id:"nome",value:I.nome,onChange:Y=>N({...I,nome:Y.target.value}),required:!0})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"codigo",children:"Cdigo *"}),d.jsx(gr,{id:"codigo",value:I.codigo,onChange:Y=>N({...I,codigo:Y.target.value}),required:!0})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"funcao",children:"Funo"}),d.jsx(gr,{id:"funcao",value:I.funcao,onChange:Y=>N({...I,funcao:Y.target.value})})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"escala",children:"Escala"}),d.jsxs(Vr,{value:I.escala,onValueChange:Y=>N({...I,escala:Y}),children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Selecione a escala"})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"5x1",children:"5x1"}),d.jsx(bt,{value:"5x2",children:"5x2"}),d.jsx(bt,{value:"4x2",children:"4x2"}),d.jsx(bt,{value:"6x1",children:"6x1"}),d.jsx(bt,{value:"12x36",children:"12x36"}),d.jsx(bt,{value:"18x36",children:"18x36"}),d.jsx(bt,{value:"24x48",children:"24x48"})]})]})]}),V&&d.jsxs("div",{className:"space-y-2 sm:col-span-2",children:[d.jsx(Gt,{children:"Dias da semana"}),d.jsx("p",{className:"text-xs text-muted-foreground",children:"Para as escalas 5x2 ou 6x1, selecione pelo menos um dia."}),d.jsx("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-3",children:sle.map(Y=>d.jsxs("label",{className:"flex items-center space-x-2 rounded-md border border-border p-2 text-sm font-medium",children:[d.jsx(q$,{checked:I.dias_semana.includes(Y.value),onCheckedChange:q=>{V&&N(Z=>{const Q=q===!0,H=Z.dias_semana.filter(ne=>ne!==Y.value),K=Q?[...H,Y.value]:H;return{...Z,dias_semana:K}})}}),d.jsx("span",{children:Y.label})]},Y.value))})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"jornada",children:"Jornada (horas)"}),d.jsx(gr,{id:"jornada",type:"number",min:"0",value:I.jornada,onChange:Y=>N({...I,jornada:Y.target.value}),placeholder:"Ex: 44"})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"horario_inicio",children:"Horrio Incio"}),d.jsx(gr,{id:"horario_inicio",type:"time",value:I.horario_inicio,onChange:Y=>N({...I,horario_inicio:Y.target.value})})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"horario_fim",children:"Horrio Fim"}),d.jsx(gr,{id:"horario_fim",type:"time",value:I.horario_fim,onChange:Y=>N({...I,horario_fim:Y.target.value})})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"intervalo_refeicao",children:"Intervalo Refeio (min)"}),d.jsx(gr,{id:"intervalo_refeicao",type:"number",value:I.intervalo_refeicao,onChange:Y=>N({...I,intervalo_refeicao:Y.target.value}),placeholder:"60"})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"primeiro_dia_atividade",children:"Primeiro dia de atividade"}),d.jsx(gr,{id:"primeiro_dia_atividade",type:"date",value:I.primeiro_dia_atividade,onChange:Y=>N({...I,primeiro_dia_atividade:Y.target.value})})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"ultimo_dia_atividade",children:"ltimo dia de atividade"}),d.jsx(gr,{id:"ultimo_dia_atividade",type:"date",value:I.ultimo_dia_atividade,onChange:Y=>N({...I,ultimo_dia_atividade:Y.target.value})}),d.jsx("p",{className:"text-xs text-muted-foreground",children:"Ao definir essa data, o posto ser encerrado automaticamente e deixar de gerar escala aps o dia informado. Os dias futuros e a alocao corrente sero limpos pelo sistema."})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"status",children:"Status"}),d.jsx("p",{className:"text-xs text-muted-foreground",children:"Valores alinhados ao novo ENUM: vago, ocupado, vago temporariamente, ocupado temporariamente, presena confirmada ou inativo (encerrado)."}),d.jsxs(Vr,{value:I.status,onValueChange:Y=>N({...I,status:Y}),children:[d.jsx(Or,{children:d.jsx(Ur,{})}),d.jsx(Lr,{children:qT.map(Y=>d.jsx(bt,{value:Y.value,children:Y.label},Y.value))})]})]}),d.jsxs("div",{className:"space-y-2 sm:col-span-2",children:[d.jsx(Gt,{htmlFor:"observacoes",children:"Observaes"}),d.jsx(hu,{id:"observacoes",value:I.observacoes,onChange:Y=>N({...I,observacoes:Y.target.value}),rows:3})]}),d.jsxs("div",{className:"space-y-2 sm:col-span-2",children:[d.jsx(Gt,{htmlFor:"beneficios",children:"Beneficios"}),d.jsxs("div",{className:"space-y-2",children:[I.beneficios.map((Y,q)=>d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(gr,{value:Y,onChange:Z=>N(Q=>{const H=[...Q.beneficios];return H[q]=Z.target.value,{...Q,beneficios:H}}),placeholder:"Descreva o beneficio"}),d.jsx(Bt,{type:"button",variant:"outline",onClick:()=>N(Z=>{const Q=Z.beneficios.filter((H,K)=>K!==q);return{...Z,beneficios:Q}}),children:"Remover"})]},q)),d.jsx(Bt,{type:"button",variant:"secondary",onClick:()=>N(Y=>({...Y,beneficios:[...Y.beneficios,""]})),children:"Adicionar beneficio"})]})]})]}),d.jsxs("div",{className:"flex justify-end gap-2",children:[d.jsx(Bt,{type:"button",variant:"outline",onClick:i,children:"Cancelar"}),d.jsxs(Bt,{type:"submit",disabled:f,children:[f&&d.jsx(nd,{className:"mr-2 h-4 w-4 animate-spin"}),e?"Atualizar":"Criar"]})]})]})]})})};var G$="AlertDialog",[lle,Ide]=rd(G$,[CU]),nh=CU(),H$=e=>{const{__scopeAlertDialog:t,...i}=e,l=nh(t);return d.jsx(FP,{...l,...i,modal:!0})};H$.displayName=G$;var cle="AlertDialogTrigger",W$=F.forwardRef((e,t)=>{const{__scopeAlertDialog:i,...l}=e,f=nh(i);return d.jsx(UU,{...f,...l,ref:t})});W$.displayName=cle;var ule="AlertDialogPortal",Z$=e=>{const{__scopeAlertDialog:t,...i}=e,l=nh(t);return d.jsx(BP,{...l,...i})};Z$.displayName=ule;var dle="AlertDialogOverlay",X$=F.forwardRef((e,t)=>{const{__scopeAlertDialog:i,...l}=e,f=nh(i);return d.jsx(Mb,{...f,...l,ref:t})});X$.displayName=dle;var sy="AlertDialogContent",[hle,fle]=lle(sy),ple=u4("AlertDialogContent"),K$=F.forwardRef((e,t)=>{const{__scopeAlertDialog:i,children:l,...f}=e,_=nh(i),x=F.useRef(null),o=bs(t,x),A=F.useRef(null);return d.jsx(Mne,{contentName:sy,titleName:Y$,docsSlug:"alert-dialog",children:d.jsx(hle,{scope:i,cancelRef:A,children:d.jsxs(Nb,{role:"alertdialog",..._,...f,ref:o,onOpenAutoFocus:Vn(f.onOpenAutoFocus,I=>{var N;I.preventDefault(),(N=A.current)==null||N.focus({preventScroll:!0})}),onPointerDownOutside:I=>I.preventDefault(),onInteractOutside:I=>I.preventDefault(),children:[d.jsx(ple,{children:l}),d.jsx(gle,{contentRef:x})]})})})});K$.displayName=sy;var Y$="AlertDialogTitle",J$=F.forwardRef((e,t)=>{const{__scopeAlertDialog:i,...l}=e,f=nh(i);return d.jsx(Db,{...f,...l,ref:t})});J$.displayName=Y$;var Q$="AlertDialogDescription",e8=F.forwardRef((e,t)=>{const{__scopeAlertDialog:i,...l}=e,f=nh(i);return d.jsx(Ob,{...f,...l,ref:t})});e8.displayName=Q$;var mle="AlertDialogAction",t8=F.forwardRef((e,t)=>{const{__scopeAlertDialog:i,...l}=e,f=nh(i);return d.jsx(j2,{...f,...l,ref:t})});t8.displayName=mle;var r8="AlertDialogCancel",n8=F.forwardRef((e,t)=>{const{__scopeAlertDialog:i,...l}=e,{cancelRef:f}=fle(r8,i),_=nh(i),x=bs(t,f);return d.jsx(j2,{..._,...l,ref:x})});n8.displayName=r8;var gle=({contentRef:e})=>{const t=`\`${sy}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${sy}\` by passing a \`${Q$}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${sy}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return F.useEffect(()=>{var l;document.getElementById((l=e.current)==null?void 0:l.getAttribute("aria-describedby"))||console.warn(t)},[t,e]),null},_le=H$,yle=W$,vle=Z$,i8=X$,s8=K$,o8=t8,a8=n8,l8=J$,c8=e8;const pu=_le,Vb=yle,xle=vle,u8=F.forwardRef(({className:e,...t},i)=>d.jsx(i8,{className:wr("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:i}));u8.displayName=i8.displayName;const bc=F.forwardRef(({className:e,...t},i)=>d.jsxs(xle,{children:[d.jsx(u8,{}),d.jsx(s8,{ref:i,className:wr("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t})]}));bc.displayName=s8.displayName;const wc=({className:e,...t})=>d.jsx("div",{className:wr("flex flex-col space-y-2 text-center sm:text-left",e),...t});wc.displayName="AlertDialogHeader";const Sc=({className:e,...t})=>d.jsx("div",{className:wr("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});Sc.displayName="AlertDialogFooter";const Tc=F.forwardRef(({className:e,...t},i)=>d.jsx(l8,{ref:i,className:wr("text-lg font-semibold",e),...t}));Tc.displayName=l8.displayName;const Ec=F.forwardRef(({className:e,...t},i)=>d.jsx(c8,{ref:i,className:wr("text-sm text-muted-foreground",e),...t}));Ec.displayName=c8.displayName;const Cc=F.forwardRef(({className:e,...t},i)=>d.jsx(o8,{ref:i,className:wr(mb(),e),...t}));Cc.displayName=o8.displayName;const td=F.forwardRef(({className:e,...t},i)=>d.jsx(a8,{ref:i,className:wr(mb({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));td.displayName=a8.displayName;const ble=({cliente:e,onSelect:t,onEdit:i,onDelete:l})=>{const f=async()=>{try{const{data:_}=await Ge.from("contratos").select("id").eq("cliente_id",e.id).limit(1);if(_&&_.length>0){In({title:"No  possvel excluir",description:"Este cliente possui contratos relacionados. Exclua os contratos primeiro.",variant:"destructive"});return}const{error:x}=await Ge.from("clientes").delete().eq("id",e.id);if(x)throw x;In({title:"Cliente excludo",description:"Cliente excludo com sucesso"}),l()}catch(_){In({title:"Erro",description:_.message,variant:"destructive"})}};return d.jsxs(Sr,{className:"hover:shadow-lg transition-shadow cursor-pointer",children:[d.jsx(wn,{onClick:t,children:d.jsxs("div",{className:"flex items-start justify-between",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:d.jsx(Lf,{className:"h-4 w-4 text-primary"})}),d.jsxs("div",{children:[d.jsx(An,{className:"text-base",children:e.razao_social}),d.jsx("p",{className:"text-sm text-muted-foreground",children:e.cnpj})]})]}),d.jsx(Gn,{variant:e.status==="ativo"?"default":"secondary",children:e.status})]})}),d.jsxs(tn,{children:[d.jsxs("div",{className:"space-y-2",children:[e.contato_nome&&d.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[d.jsx(sb,{className:"h-4 w-4 text-muted-foreground"}),d.jsx("span",{children:e.contato_nome})]}),e.contato_email&&d.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[d.jsx(qZ,{className:"h-4 w-4 text-muted-foreground"}),d.jsx("span",{className:"truncate",children:e.contato_email})]}),e.contato_telefone&&d.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[d.jsx(ZZ,{className:"h-4 w-4 text-muted-foreground"}),d.jsx("span",{children:e.contato_telefone})]})]}),d.jsxs("div",{className:"flex gap-2 mt-4",children:[d.jsxs(Bt,{variant:"outline",size:"sm",className:"flex-1",onClick:i,children:[d.jsx(gu,{className:"h-3 w-3 mr-1"}),"Editar"]}),d.jsxs(pu,{children:[d.jsx(Vb,{asChild:!0,children:d.jsx(Bt,{variant:"outline",size:"sm",onClick:_=>_.stopPropagation(),children:d.jsx(jl,{className:"h-3 w-3"})})}),d.jsxs(bc,{children:[d.jsxs(wc,{children:[d.jsx(Tc,{children:"Confirmar excluso"}),d.jsx(Ec,{children:"Tem certeza que deseja excluir este cliente? Esta ao no pode ser desfeita."})]}),d.jsxs(Sc,{children:[d.jsx(td,{children:"Cancelar"}),d.jsx(Cc,{onClick:f,children:"Excluir"})]})]})]})]})]})]})},wle=({contrato:e,cliente:t,onSelect:i,onEdit:l,onDelete:f})=>{const _=async()=>{try{const{data:x}=await Ge.from("chamados").select("id").eq("contrato_id",e.id).limit(1),{data:o}=await Ge.from("unidades").select("id").eq("contrato_id",e.id).limit(1);if(x&&x.length>0){In({title:"No  possvel excluir",description:"Este contrato possui chamados relacionados. Exclua os chamados primeiro.",variant:"destructive"});return}if(o&&o.length>0){In({title:"No  possvel excluir",description:"Este contrato possui unidades relacionadas. Exclua as unidades primeiro.",variant:"destructive"});return}const{error:A}=await Ge.from("contratos").delete().eq("id",e.id);if(A)throw A;In({title:"Contrato excludo",description:"Contrato excludo com sucesso"}),f()}catch(x){In({title:"Erro",description:x.message,variant:"destructive"})}};return d.jsxs(Sr,{className:"hover:shadow-lg transition-shadow cursor-pointer",children:[d.jsx(wn,{onClick:i,children:d.jsxs("div",{className:"flex items-start justify-between",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:d.jsx(Zf,{className:"h-4 w-4 text-primary"})}),d.jsxs("div",{children:[d.jsx(An,{className:"text-base",children:e.nome}),d.jsx("p",{className:"text-sm text-muted-foreground",children:e.codigo})]})]}),d.jsx(Gn,{variant:e.status==="ativo"?"default":"secondary",children:e.status})]})}),d.jsxs(tn,{children:[d.jsxs("div",{className:"space-y-2",children:[t&&d.jsxs("p",{className:"text-sm text-muted-foreground",children:["Cliente: ",t.razao_social]}),d.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[d.jsx(Al,{className:"h-4 w-4 text-muted-foreground"}),d.jsxs("span",{children:[Kn(new Date(e.data_inicio),"dd/MM/yyyy"),e.data_fim&&` - ${Kn(new Date(e.data_fim),"dd/MM/yyyy")}`]})]}),d.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[d.jsx(iP,{className:"h-4 w-4 text-muted-foreground"}),d.jsxs("span",{children:["SLA: ",e.sla_alvo_pct,"%"]}),e.nps_meta&&d.jsxs("span",{children:[" NPS: ",e.nps_meta]})]})]}),d.jsxs("div",{className:"flex gap-2 mt-4",children:[d.jsxs(Bt,{variant:"outline",size:"sm",className:"flex-1",onClick:l,children:[d.jsx(gu,{className:"h-3 w-3 mr-1"}),"Editar"]}),d.jsxs(pu,{children:[d.jsx(Vb,{asChild:!0,children:d.jsx(Bt,{variant:"outline",size:"sm",onClick:x=>x.stopPropagation(),children:d.jsx(jl,{className:"h-3 w-3"})})}),d.jsxs(bc,{children:[d.jsxs(wc,{children:[d.jsx(Tc,{children:"Confirmar excluso"}),d.jsx(Ec,{children:"Tem certeza que deseja excluir este contrato? Esta ao no pode ser desfeita."})]}),d.jsxs(Sc,{children:[d.jsx(td,{children:"Cancelar"}),d.jsx(Cc,{onClick:_,children:"Excluir"})]})]})]})]})]})]})},Sle=({unidade:e,contrato:t,onSelect:i,onEdit:l,onDelete:f})=>{const _=async()=>{try{const{data:x}=await Ge.from("postos_servico").select("id").eq("unidade_id",e.id).limit(1),{data:o}=await Ge.from("colaboradores").select("id").eq("unidade_id",e.id).limit(1),{data:A}=await Ge.from("chamados").select("id").eq("unidade_id",e.id).limit(1),{data:I}=await Ge.from("ordens_servico").select("id").eq("unidade_id",e.id).limit(1);if(x&&x.length>0){In({title:"No  possvel excluir",description:"Esta unidade possui postos de servio relacionados. Exclua os postos primeiro.",variant:"destructive"});return}if(o&&o.length>0){In({title:"No  possvel excluir",description:"Esta unidade possui colaboradores relacionados. Remova a vinculao dos colaboradores primeiro.",variant:"destructive"});return}if(A&&A.length>0){In({title:"No  possvel excluir",description:"Esta unidade possui chamados relacionados. Exclua os chamados primeiro.",variant:"destructive"});return}if(I&&I.length>0){In({title:"No  possvel excluir",description:"Esta unidade possui ordens de servio relacionadas. Exclua as ordens primeiro.",variant:"destructive"});return}const{error:N}=await Ge.from("unidades").delete().eq("id",e.id);if(N)throw N;In({title:"Unidade excluda",description:"Unidade excluda com sucesso"}),f()}catch(x){In({title:"Erro",description:x.message,variant:"destructive"})}};return d.jsxs(Sr,{className:"hover:shadow-lg transition-shadow cursor-pointer",children:[d.jsx(wn,{onClick:i,children:d.jsxs("div",{className:"flex items-start justify-between",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:d.jsx(zf,{className:"h-4 w-4 text-primary"})}),d.jsxs("div",{children:[d.jsx(An,{className:"text-base",children:e.nome}),d.jsx("p",{className:"text-sm text-muted-foreground",children:e.codigo})]})]}),d.jsx(Gn,{variant:e.status==="ativo"?"default":"secondary",children:e.status})]})}),d.jsxs(tn,{children:[d.jsxs("div",{className:"space-y-2",children:[t&&d.jsxs("p",{className:"text-sm text-muted-foreground",children:["Contrato: ",t.nome]}),e.endereco&&d.jsx("p",{className:"text-sm",children:e.endereco}),(e.cidade||e.uf)&&d.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.cidade,e.cidade&&e.uf?"/":"",e.uf]})]}),d.jsxs("div",{className:"flex gap-2 mt-4",children:[d.jsxs(Bt,{variant:"outline",size:"sm",className:"flex-1",onClick:l,children:[d.jsx(gu,{className:"h-3 w-3 mr-1"}),"Editar"]}),d.jsxs(pu,{children:[d.jsx(Vb,{asChild:!0,children:d.jsx(Bt,{variant:"outline",size:"sm",onClick:x=>x.stopPropagation(),children:d.jsx(jl,{className:"h-3 w-3"})})}),d.jsxs(bc,{children:[d.jsxs(wc,{children:[d.jsx(Tc,{children:"Confirmar excluso"}),d.jsx(Ec,{children:"Tem certeza que deseja excluir esta unidade? Esta ao no pode ser desfeita."})]}),d.jsxs(Sc,{children:[d.jsx(td,{children:"Cancelar"}),d.jsx(Cc,{onClick:_,children:"Excluir"})]})]})]})]})]})]})};var si=function(){return si=Object.assign||function(t){for(var i,l=1,f=arguments.length;l<f;l++){i=arguments[l];for(var _ in i)Object.prototype.hasOwnProperty.call(i,_)&&(t[_]=i[_])}return t},si.apply(this,arguments)};function Tle(e,t){var i={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&t.indexOf(l)<0&&(i[l]=e[l]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,l=Object.getOwnPropertySymbols(e);f<l.length;f++)t.indexOf(l[f])<0&&Object.prototype.propertyIsEnumerable.call(e,l[f])&&(i[l[f]]=e[l[f]]);return i}function d8(e,t,i){for(var l=0,f=t.length,_;l<f;l++)(_||!(l in t))&&(_||(_=Array.prototype.slice.call(t,0,l)),_[l]=t[l]);return e.concat(_||Array.prototype.slice.call(t))}function Ub(e){return e.mode==="multiple"}function $b(e){return e.mode==="range"}function B2(e){return e.mode==="single"}var Ele={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};function Cle(e,t){return Kn(e,"LLLL y",t)}function Ale(e,t){return Kn(e,"d",t)}function jle(e,t){return Kn(e,"LLLL",t)}function Ile(e){return"".concat(e)}function kle(e,t){return Kn(e,"cccccc",t)}function Ple(e,t){return Kn(e,"yyyy",t)}var Rle=Object.freeze({__proto__:null,formatCaption:Cle,formatDay:Ale,formatMonthCaption:jle,formatWeekNumber:Ile,formatWeekdayName:kle,formatYearCaption:Ple}),Mle=function(e,t,i){return Kn(e,"do MMMM (EEEE)",i)},Nle=function(){return"Month: "},Dle=function(){return"Go to next month"},Ole=function(){return"Go to previous month"},Lle=function(e,t){return Kn(e,"cccc",t)},zle=function(e){return"Week n. ".concat(e)},Fle=function(){return"Year: "},Ble=Object.freeze({__proto__:null,labelDay:Mle,labelMonthDropdown:Nle,labelNext:Dle,labelPrevious:Ole,labelWeekNumber:zle,labelWeekday:Lle,labelYearDropdown:Fle});function Vle(){var e="buttons",t=Ele,i=d$,l={},f={},_=1,x={},o=new Date;return{captionLayout:e,classNames:t,formatters:Rle,labels:Ble,locale:i,modifiersClassNames:l,modifiers:f,numberOfMonths:_,styles:x,today:o,mode:"default"}}function Ule(e){var t=e.fromYear,i=e.toYear,l=e.fromMonth,f=e.toMonth,_=e.fromDate,x=e.toDate;return l?_=Ca(l):t&&(_=new Date(t,0,1)),f?x=Oy(f):i&&(x=new Date(i,11,31)),{fromDate:_?Dy(_):void 0,toDate:x?Dy(x):void 0}}var h8=F.createContext(void 0);function $le(e){var t,i=e.initialProps,l=Vle(),f=Ule(i),_=f.fromDate,x=f.toDate,o=(t=i.captionLayout)!==null&&t!==void 0?t:l.captionLayout;o!=="buttons"&&(!_||!x)&&(o="buttons");var A;(B2(i)||Ub(i)||$b(i))&&(A=i.onSelect);var I=si(si(si({},l),i),{captionLayout:o,classNames:si(si({},l.classNames),i.classNames),components:si({},i.components),formatters:si(si({},l.formatters),i.formatters),fromDate:_,labels:si(si({},l.labels),i.labels),mode:i.mode||l.mode,modifiers:si(si({},l.modifiers),i.modifiers),modifiersClassNames:si(si({},l.modifiersClassNames),i.modifiersClassNames),onSelect:A,styles:si(si({},l.styles),i.styles),toDate:x});return d.jsx(h8.Provider,{value:I,children:e.children})}function Us(){var e=F.useContext(h8);if(!e)throw new Error("useDayPicker must be used within a DayPickerProvider.");return e}function f8(e){var t=Us(),i=t.locale,l=t.classNames,f=t.styles,_=t.formatters.formatCaption;return d.jsx("div",{className:l.caption_label,style:f.caption_label,"aria-live":"polite",role:"presentation",id:e.id,children:_(e.displayMonth,{locale:i})})}function qle(e){return d.jsx("svg",si({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},e,{children:d.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function p8(e){var t,i,l=e.onChange,f=e.value,_=e.children,x=e.caption,o=e.className,A=e.style,I=Us(),N=(i=(t=I.components)===null||t===void 0?void 0:t.IconDropdown)!==null&&i!==void 0?i:qle;return d.jsxs("div",{className:o,style:A,children:[d.jsx("span",{className:I.classNames.vhidden,children:e["aria-label"]}),d.jsx("select",{name:e.name,"aria-label":e["aria-label"],className:I.classNames.dropdown,style:I.styles.dropdown,value:f,onChange:l,children:_}),d.jsxs("div",{className:I.classNames.caption_label,style:I.styles.caption_label,"aria-hidden":"true",children:[x,d.jsx(N,{className:I.classNames.dropdown_icon,style:I.styles.dropdown_icon})]})]})}function Gle(e){var t,i=Us(),l=i.fromDate,f=i.toDate,_=i.styles,x=i.locale,o=i.formatters.formatMonthCaption,A=i.classNames,I=i.components,N=i.labels.labelMonthDropdown;if(!l)return d.jsx(d.Fragment,{});if(!f)return d.jsx(d.Fragment,{});var U=[];if(qoe(l,f))for(var $=Ca(l),V=l.getMonth();V<=f.getMonth();V++)U.push(HA($,V));else for(var $=Ca(new Date),V=0;V<=11;V++)U.push(HA($,V));var Y=function(Z){var Q=Number(Z.target.value),H=HA(Ca(e.displayMonth),Q);e.onChange(H)},q=(t=I==null?void 0:I.Dropdown)!==null&&t!==void 0?t:p8;return d.jsx(q,{name:"months","aria-label":N(),className:A.dropdown_month,style:_.dropdown_month,onChange:Y,value:e.displayMonth.getMonth(),caption:o(e.displayMonth,{locale:x}),children:U.map(function(Z){return d.jsx("option",{value:Z.getMonth(),children:o(Z,{locale:x})},Z.getMonth())})})}function Hle(e){var t,i=e.displayMonth,l=Us(),f=l.fromDate,_=l.toDate,x=l.locale,o=l.styles,A=l.classNames,I=l.components,N=l.formatters.formatYearCaption,U=l.labels.labelYearDropdown,$=[];if(!f)return d.jsx(d.Fragment,{});if(!_)return d.jsx(d.Fragment,{});for(var V=f.getFullYear(),Y=_.getFullYear(),q=V;q<=Y;q++)$.push(SF(l$(new Date),q));var Z=function(H){var K=SF(Ca(i),Number(H.target.value));e.onChange(K)},Q=(t=I==null?void 0:I.Dropdown)!==null&&t!==void 0?t:p8;return d.jsx(Q,{name:"years","aria-label":U(),className:A.dropdown_year,style:o.dropdown_year,onChange:Z,value:i.getFullYear(),caption:N(i,{locale:x}),children:$.map(function(H){return d.jsx("option",{value:H.getFullYear(),children:N(H,{locale:x})},H.getFullYear())})})}function Wle(e,t){var i=F.useState(e),l=i[0],f=i[1],_=t===void 0?l:t;return[_,f]}function Zle(e){var t=e.month,i=e.defaultMonth,l=e.today,f=t||i||l||new Date,_=e.toDate,x=e.fromDate,o=e.numberOfMonths,A=o===void 0?1:o;if(_&&_b(_,f)<0){var I=-1*(A-1);f=Xl(_,I)}return x&&_b(f,x)<0&&(f=x),Ca(f)}function Xle(){var e=Us(),t=Zle(e),i=Wle(t,e.month),l=i[0],f=i[1],_=function(x){var o;if(!e.disableNavigation){var A=Ca(x);f(A),(o=e.onMonthChange)===null||o===void 0||o.call(e,A)}};return[l,_]}function Kle(e,t){for(var i=t.reverseMonths,l=t.numberOfMonths,f=Ca(e),_=Ca(Xl(f,l)),x=_b(_,f),o=[],A=0;A<x;A++){var I=Xl(f,A);o.push(I)}return i&&(o=o.reverse()),o}function Yle(e,t){if(!t.disableNavigation){var i=t.toDate,l=t.pagedNavigation,f=t.numberOfMonths,_=f===void 0?1:f,x=l?_:1,o=Ca(e);if(!i)return Xl(o,x);var A=_b(i,e);if(!(A<_))return Xl(o,x)}}function Jle(e,t){if(!t.disableNavigation){var i=t.fromDate,l=t.pagedNavigation,f=t.numberOfMonths,_=f===void 0?1:f,x=l?_:1,o=Ca(e);if(!i)return Xl(o,-x);var A=_b(o,i);if(!(A<=0))return Xl(o,-x)}}var m8=F.createContext(void 0);function Qle(e){var t=Us(),i=Xle(),l=i[0],f=i[1],_=Kle(l,t),x=Yle(l,t),o=Jle(l,t),A=function(U){return _.some(function($){return O2(U,$)})},I=function(U,$){A(U)||($&&g$(U,$)?f(Xl(U,1+t.numberOfMonths*-1)):f(U))},N={currentMonth:l,displayMonths:_,goToMonth:f,goToDate:I,previousMonth:o,nextMonth:x,isDateDisplayed:A};return d.jsx(m8.Provider,{value:N,children:e.children})}function qb(){var e=F.useContext(m8);if(!e)throw new Error("useNavigation must be used within a NavigationProvider");return e}function TF(e){var t,i=Us(),l=i.classNames,f=i.styles,_=i.components,x=qb().goToMonth,o=function(N){x(Xl(N,e.displayIndex?-e.displayIndex:0))},A=(t=_==null?void 0:_.CaptionLabel)!==null&&t!==void 0?t:f8,I=d.jsx(A,{id:e.id,displayMonth:e.displayMonth});return d.jsxs("div",{className:l.caption_dropdowns,style:f.caption_dropdowns,children:[d.jsx("div",{className:l.vhidden,children:I}),d.jsx(Gle,{onChange:o,displayMonth:e.displayMonth}),d.jsx(Hle,{onChange:o,displayMonth:e.displayMonth})]})}function ece(e){return d.jsx("svg",si({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:d.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function tce(e){return d.jsx("svg",si({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:d.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var GT=F.forwardRef(function(e,t){var i=Us(),l=i.classNames,f=i.styles,_=[l.button_reset,l.button];e.className&&_.push(e.className);var x=_.join(" "),o=si(si({},f.button_reset),f.button);return e.style&&Object.assign(o,e.style),d.jsx("button",si({},e,{ref:t,type:"button",className:x,style:o}))});function rce(e){var t,i,l=Us(),f=l.dir,_=l.locale,x=l.classNames,o=l.styles,A=l.labels,I=A.labelPrevious,N=A.labelNext,U=l.components;if(!e.nextMonth&&!e.previousMonth)return d.jsx(d.Fragment,{});var $=I(e.previousMonth,{locale:_}),V=[x.nav_button,x.nav_button_previous].join(" "),Y=N(e.nextMonth,{locale:_}),q=[x.nav_button,x.nav_button_next].join(" "),Z=(t=U==null?void 0:U.IconRight)!==null&&t!==void 0?t:tce,Q=(i=U==null?void 0:U.IconLeft)!==null&&i!==void 0?i:ece;return d.jsxs("div",{className:x.nav,style:o.nav,children:[!e.hidePrevious&&d.jsx(GT,{name:"previous-month","aria-label":$,className:V,style:o.nav_button_previous,disabled:!e.previousMonth,onClick:e.onPreviousClick,children:f==="rtl"?d.jsx(Z,{className:x.nav_icon,style:o.nav_icon}):d.jsx(Q,{className:x.nav_icon,style:o.nav_icon})}),!e.hideNext&&d.jsx(GT,{name:"next-month","aria-label":Y,className:q,style:o.nav_button_next,disabled:!e.nextMonth,onClick:e.onNextClick,children:f==="rtl"?d.jsx(Q,{className:x.nav_icon,style:o.nav_icon}):d.jsx(Z,{className:x.nav_icon,style:o.nav_icon})})]})}function EF(e){var t=Us().numberOfMonths,i=qb(),l=i.previousMonth,f=i.nextMonth,_=i.goToMonth,x=i.displayMonths,o=x.findIndex(function(Y){return O2(e.displayMonth,Y)}),A=o===0,I=o===x.length-1,N=t>1&&(A||!I),U=t>1&&(I||!A),$=function(){l&&_(l)},V=function(){f&&_(f)};return d.jsx(rce,{displayMonth:e.displayMonth,hideNext:N,hidePrevious:U,nextMonth:f,previousMonth:l,onPreviousClick:$,onNextClick:V})}function nce(e){var t,i=Us(),l=i.classNames,f=i.disableNavigation,_=i.styles,x=i.captionLayout,o=i.components,A=(t=o==null?void 0:o.CaptionLabel)!==null&&t!==void 0?t:f8,I;return f?I=d.jsx(A,{id:e.id,displayMonth:e.displayMonth}):x==="dropdown"?I=d.jsx(TF,{displayMonth:e.displayMonth,id:e.id}):x==="dropdown-buttons"?I=d.jsxs(d.Fragment,{children:[d.jsx(TF,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id}),d.jsx(EF,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id})]}):I=d.jsxs(d.Fragment,{children:[d.jsx(A,{id:e.id,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),d.jsx(EF,{displayMonth:e.displayMonth,id:e.id})]}),d.jsx("div",{className:l.caption,style:_.caption,children:I})}function ice(e){var t=Us(),i=t.footer,l=t.styles,f=t.classNames.tfoot;return i?d.jsx("tfoot",{className:f,style:l.tfoot,children:d.jsx("tr",{children:d.jsx("td",{colSpan:8,children:i})})}):d.jsx(d.Fragment,{})}function sce(e,t,i){for(var l=i?Um(new Date):fu(new Date,{locale:e,weekStartsOn:t}),f=[],_=0;_<7;_++){var x=Ka(l,_);f.push(x)}return f}function oce(){var e=Us(),t=e.classNames,i=e.styles,l=e.showWeekNumber,f=e.locale,_=e.weekStartsOn,x=e.ISOWeek,o=e.formatters.formatWeekdayName,A=e.labels.labelWeekday,I=sce(f,_,x);return d.jsxs("tr",{style:i.head_row,className:t.head_row,children:[l&&d.jsx("td",{style:i.head_cell,className:t.head_cell}),I.map(function(N,U){return d.jsx("th",{scope:"col",className:t.head_cell,style:i.head_cell,"aria-label":A(N,{locale:f}),children:o(N,{locale:f})},U)})]})}function ace(){var e,t=Us(),i=t.classNames,l=t.styles,f=t.components,_=(e=f==null?void 0:f.HeadRow)!==null&&e!==void 0?e:oce;return d.jsx("thead",{style:l.head,className:i.head,children:d.jsx(_,{})})}function lce(e){var t=Us(),i=t.locale,l=t.formatters.formatDay;return d.jsx(d.Fragment,{children:l(e.date,{locale:i})})}var nR=F.createContext(void 0);function cce(e){if(!Ub(e.initialProps)){var t={selected:void 0,modifiers:{disabled:[]}};return d.jsx(nR.Provider,{value:t,children:e.children})}return d.jsx(uce,{initialProps:e.initialProps,children:e.children})}function uce(e){var t=e.initialProps,i=e.children,l=t.selected,f=t.min,_=t.max,x=function(I,N,U){var $,V;($=t.onDayClick)===null||$===void 0||$.call(t,I,N,U);var Y=!!(N.selected&&f&&(l==null?void 0:l.length)===f);if(!Y){var q=!!(!N.selected&&_&&(l==null?void 0:l.length)===_);if(!q){var Z=l?d8([],l):[];if(N.selected){var Q=Z.findIndex(function(H){return Sl(I,H)});Z.splice(Q,1)}else Z.push(I);(V=t.onSelect)===null||V===void 0||V.call(t,Z,I,N,U)}}},o={disabled:[]};l&&o.disabled.push(function(I){var N=_&&l.length>_-1,U=l.some(function($){return Sl($,I)});return!!(N&&!U)});var A={selected:l,onDayClick:x,modifiers:o};return d.jsx(nR.Provider,{value:A,children:i})}function iR(){var e=F.useContext(nR);if(!e)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return e}function dce(e,t){var i=t||{},l=i.from,f=i.to;return l&&f?Sl(f,e)&&Sl(l,e)?void 0:Sl(f,e)?{from:f,to:void 0}:Sl(l,e)?void 0:JI(l,e)?{from:e,to:f}:{from:l,to:e}:f?JI(e,f)?{from:f,to:e}:{from:e,to:f}:l?g$(e,l)?{from:e,to:l}:{from:l,to:e}:{from:e,to:void 0}}var sR=F.createContext(void 0);function hce(e){if(!$b(e.initialProps)){var t={selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}};return d.jsx(sR.Provider,{value:t,children:e.children})}return d.jsx(fce,{initialProps:e.initialProps,children:e.children})}function fce(e){var t=e.initialProps,i=e.children,l=t.selected,f=l||{},_=f.from,x=f.to,o=t.min,A=t.max,I=function(V,Y,q){var Z,Q;(Z=t.onDayClick)===null||Z===void 0||Z.call(t,V,Y,q);var H=dce(V,l);(Q=t.onSelect)===null||Q===void 0||Q.call(t,H,V,Y,q)},N={range_start:[],range_end:[],range_middle:[],disabled:[]};if(_?(N.range_start=[_],x?(N.range_end=[x],Sl(_,x)||(N.range_middle=[{after:_,before:x}])):N.range_end=[_]):x&&(N.range_start=[x],N.range_end=[x]),o&&(_&&!x&&N.disabled.push({after:qA(_,o-1),before:Ka(_,o-1)}),_&&x&&N.disabled.push({after:_,before:Ka(_,o-1)}),!_&&x&&N.disabled.push({after:qA(x,o-1),before:Ka(x,o-1)})),A){if(_&&!x&&(N.disabled.push({before:Ka(_,-A+1)}),N.disabled.push({after:Ka(_,A-1)})),_&&x){var U=Zu(x,_)+1,$=A-U;N.disabled.push({before:qA(_,$)}),N.disabled.push({after:Ka(x,$)})}!_&&x&&(N.disabled.push({before:Ka(x,-A+1)}),N.disabled.push({after:Ka(x,A-1)}))}return d.jsx(sR.Provider,{value:{selected:l,onDayClick:I,modifiers:N},children:i})}function oR(){var e=F.useContext(sR);if(!e)throw new Error("useSelectRange must be used within a SelectRangeProvider");return e}function GS(e){return Array.isArray(e)?d8([],e):e!==void 0?[e]:[]}function pce(e){var t={};return Object.entries(e).forEach(function(i){var l=i[0],f=i[1];t[l]=GS(f)}),t}var mu;(function(e){e.Outside="outside",e.Disabled="disabled",e.Selected="selected",e.Hidden="hidden",e.Today="today",e.RangeStart="range_start",e.RangeEnd="range_end",e.RangeMiddle="range_middle"})(mu||(mu={}));var mce=mu.Selected,Pd=mu.Disabled,gce=mu.Hidden,_ce=mu.Today,XA=mu.RangeEnd,KA=mu.RangeMiddle,YA=mu.RangeStart,yce=mu.Outside;function vce(e,t,i){var l,f=(l={},l[mce]=GS(e.selected),l[Pd]=GS(e.disabled),l[gce]=GS(e.hidden),l[_ce]=[e.today],l[XA]=[],l[KA]=[],l[YA]=[],l[yce]=[],l);return e.fromDate&&f[Pd].push({before:e.fromDate}),e.toDate&&f[Pd].push({after:e.toDate}),Ub(e)?f[Pd]=f[Pd].concat(t.modifiers[Pd]):$b(e)&&(f[Pd]=f[Pd].concat(i.modifiers[Pd]),f[YA]=i.modifiers[YA],f[KA]=i.modifiers[KA],f[XA]=i.modifiers[XA]),f}var g8=F.createContext(void 0);function xce(e){var t=Us(),i=iR(),l=oR(),f=vce(t,i,l),_=pce(t.modifiers),x=si(si({},f),_);return d.jsx(g8.Provider,{value:x,children:e.children})}function _8(){var e=F.useContext(g8);if(!e)throw new Error("useModifiers must be used within a ModifiersProvider");return e}function bce(e){return!!(e&&typeof e=="object"&&"before"in e&&"after"in e)}function wce(e){return!!(e&&typeof e=="object"&&"from"in e)}function Sce(e){return!!(e&&typeof e=="object"&&"after"in e)}function Tce(e){return!!(e&&typeof e=="object"&&"before"in e)}function Ece(e){return!!(e&&typeof e=="object"&&"dayOfWeek"in e)}function Cce(e,t){var i,l=t.from,f=t.to;if(l&&f){var _=Zu(f,l)<0;_&&(i=[f,l],l=i[0],f=i[1]);var x=Zu(e,l)>=0&&Zu(f,e)>=0;return x}return f?Sl(f,e):l?Sl(l,e):!1}function Ace(e){return JP(e)}function jce(e){return Array.isArray(e)&&e.every(JP)}function Ice(e,t){return t.some(function(i){if(typeof i=="boolean")return i;if(Ace(i))return Sl(e,i);if(jce(i))return i.includes(e);if(wce(i))return Cce(e,i);if(Ece(i))return i.dayOfWeek.includes(e.getDay());if(bce(i)){var l=Zu(i.before,e),f=Zu(i.after,e),_=l>0,x=f<0,o=JI(i.before,i.after);return o?x&&_:_||x}return Sce(i)?Zu(e,i.after)>0:Tce(i)?Zu(i.before,e)>0:typeof i=="function"?i(e):!1})}function aR(e,t,i){var l=Object.keys(t).reduce(function(_,x){var o=t[x];return Ice(e,o)&&_.push(x),_},[]),f={};return l.forEach(function(_){return f[_]=!0}),i&&!O2(e,i)&&(f.outside=!0),f}function kce(e,t){for(var i=Ca(e[0]),l=Oy(e[e.length-1]),f,_,x=i;x<=l;){var o=aR(x,t),A=!o.disabled&&!o.hidden;if(!A){x=Ka(x,1);continue}if(o.selected)return x;o.today&&!_&&(_=x),f||(f=x),x=Ka(x,1)}return _||f}var Pce=365;function y8(e,t){var i=t.moveBy,l=t.direction,f=t.context,_=t.modifiers,x=t.retry,o=x===void 0?{count:0,lastFocused:e}:x,A=f.weekStartsOn,I=f.fromDate,N=f.toDate,U=f.locale,$={day:Ka,week:YI,month:Xl,year:Bse,startOfWeek:function(Z){return f.ISOWeek?Um(Z):fu(Z,{locale:U,weekStartsOn:A})},endOfWeek:function(Z){return f.ISOWeek?c$(Z):D2(Z,{locale:U,weekStartsOn:A})}},V=$[i](e,l==="after"?1:-1);l==="before"&&I?V=Vse([I,V]):l==="after"&&N&&(V=Use([N,V]));var Y=!0;if(_){var q=aR(V,_);Y=!q.disabled&&!q.hidden}return Y?V:o.count>Pce?o.lastFocused:y8(V,{moveBy:i,direction:l,context:f,modifiers:_,retry:si(si({},o),{count:o.count+1})})}var v8=F.createContext(void 0);function Rce(e){var t=qb(),i=_8(),l=F.useState(),f=l[0],_=l[1],x=F.useState(),o=x[0],A=x[1],I=kce(t.displayMonths,i),N=f??(o&&t.isDateDisplayed(o))?o:I,U=function(){A(f),_(void 0)},$=function(Z){_(Z)},V=Us(),Y=function(Z,Q){if(f){var H=y8(f,{moveBy:Z,direction:Q,context:V,modifiers:i});Sl(f,H)||(t.goToDate(H,f),$(H))}},q={focusedDay:f,focusTarget:N,blur:U,focus:$,focusDayAfter:function(){return Y("day","after")},focusDayBefore:function(){return Y("day","before")},focusWeekAfter:function(){return Y("week","after")},focusWeekBefore:function(){return Y("week","before")},focusMonthBefore:function(){return Y("month","before")},focusMonthAfter:function(){return Y("month","after")},focusYearBefore:function(){return Y("year","before")},focusYearAfter:function(){return Y("year","after")},focusStartOfWeek:function(){return Y("startOfWeek","before")},focusEndOfWeek:function(){return Y("endOfWeek","after")}};return d.jsx(v8.Provider,{value:q,children:e.children})}function lR(){var e=F.useContext(v8);if(!e)throw new Error("useFocusContext must be used within a FocusProvider");return e}function Mce(e,t){var i=_8(),l=aR(e,i,t);return l}var cR=F.createContext(void 0);function Nce(e){if(!B2(e.initialProps)){var t={selected:void 0};return d.jsx(cR.Provider,{value:t,children:e.children})}return d.jsx(Dce,{initialProps:e.initialProps,children:e.children})}function Dce(e){var t=e.initialProps,i=e.children,l=function(_,x,o){var A,I,N;if((A=t.onDayClick)===null||A===void 0||A.call(t,_,x,o),x.selected&&!t.required){(I=t.onSelect)===null||I===void 0||I.call(t,void 0,_,x,o);return}(N=t.onSelect)===null||N===void 0||N.call(t,_,_,x,o)},f={selected:t.selected,onDayClick:l};return d.jsx(cR.Provider,{value:f,children:i})}function x8(){var e=F.useContext(cR);if(!e)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return e}function Oce(e,t){var i=Us(),l=x8(),f=iR(),_=oR(),x=lR(),o=x.focusDayAfter,A=x.focusDayBefore,I=x.focusWeekAfter,N=x.focusWeekBefore,U=x.blur,$=x.focus,V=x.focusMonthBefore,Y=x.focusMonthAfter,q=x.focusYearBefore,Z=x.focusYearAfter,Q=x.focusStartOfWeek,H=x.focusEndOfWeek,K=function(st){var Ne,De,Tt,Pt;B2(i)?(Ne=l.onDayClick)===null||Ne===void 0||Ne.call(l,e,t,st):Ub(i)?(De=f.onDayClick)===null||De===void 0||De.call(f,e,t,st):$b(i)?(Tt=_.onDayClick)===null||Tt===void 0||Tt.call(_,e,t,st):(Pt=i.onDayClick)===null||Pt===void 0||Pt.call(i,e,t,st)},ne=function(st){var Ne;$(e),(Ne=i.onDayFocus)===null||Ne===void 0||Ne.call(i,e,t,st)},le=function(st){var Ne;U(),(Ne=i.onDayBlur)===null||Ne===void 0||Ne.call(i,e,t,st)},pe=function(st){var Ne;(Ne=i.onDayMouseEnter)===null||Ne===void 0||Ne.call(i,e,t,st)},Ae=function(st){var Ne;(Ne=i.onDayMouseLeave)===null||Ne===void 0||Ne.call(i,e,t,st)},Ze=function(st){var Ne;(Ne=i.onDayPointerEnter)===null||Ne===void 0||Ne.call(i,e,t,st)},Xe=function(st){var Ne;(Ne=i.onDayPointerLeave)===null||Ne===void 0||Ne.call(i,e,t,st)},Je=function(st){var Ne;(Ne=i.onDayTouchCancel)===null||Ne===void 0||Ne.call(i,e,t,st)},Te=function(st){var Ne;(Ne=i.onDayTouchEnd)===null||Ne===void 0||Ne.call(i,e,t,st)},xe=function(st){var Ne;(Ne=i.onDayTouchMove)===null||Ne===void 0||Ne.call(i,e,t,st)},Be=function(st){var Ne;(Ne=i.onDayTouchStart)===null||Ne===void 0||Ne.call(i,e,t,st)},dt=function(st){var Ne;(Ne=i.onDayKeyUp)===null||Ne===void 0||Ne.call(i,e,t,st)},qt=function(st){var Ne;switch(st.key){case"ArrowLeft":st.preventDefault(),st.stopPropagation(),i.dir==="rtl"?o():A();break;case"ArrowRight":st.preventDefault(),st.stopPropagation(),i.dir==="rtl"?A():o();break;case"ArrowDown":st.preventDefault(),st.stopPropagation(),I();break;case"ArrowUp":st.preventDefault(),st.stopPropagation(),N();break;case"PageUp":st.preventDefault(),st.stopPropagation(),st.shiftKey?q():V();break;case"PageDown":st.preventDefault(),st.stopPropagation(),st.shiftKey?Z():Y();break;case"Home":st.preventDefault(),st.stopPropagation(),Q();break;case"End":st.preventDefault(),st.stopPropagation(),H();break}(Ne=i.onDayKeyDown)===null||Ne===void 0||Ne.call(i,e,t,st)},Ke={onClick:K,onFocus:ne,onBlur:le,onKeyDown:qt,onKeyUp:dt,onMouseEnter:pe,onMouseLeave:Ae,onPointerEnter:Ze,onPointerLeave:Xe,onTouchCancel:Je,onTouchEnd:Te,onTouchMove:xe,onTouchStart:Be};return Ke}function Lce(){var e=Us(),t=x8(),i=iR(),l=oR(),f=B2(e)?t.selected:Ub(e)?i.selected:$b(e)?l.selected:void 0;return f}function zce(e){return Object.values(mu).includes(e)}function Fce(e,t){var i=[e.classNames.day];return Object.keys(t).forEach(function(l){var f=e.modifiersClassNames[l];if(f)i.push(f);else if(zce(l)){var _=e.classNames["day_".concat(l)];_&&i.push(_)}}),i}function Bce(e,t){var i=si({},e.styles.day);return Object.keys(t).forEach(function(l){var f;i=si(si({},i),(f=e.modifiersStyles)===null||f===void 0?void 0:f[l])}),i}function Vce(e,t,i){var l,f,_,x=Us(),o=lR(),A=Mce(e,t),I=Oce(e,A),N=Lce(),U=!!(x.onDayClick||x.mode!=="default");F.useEffect(function(){var pe;A.outside||o.focusedDay&&U&&Sl(o.focusedDay,e)&&((pe=i.current)===null||pe===void 0||pe.focus())},[o.focusedDay,e,i,U,A.outside]);var $=Fce(x,A).join(" "),V=Bce(x,A),Y=!!(A.outside&&!x.showOutsideDays||A.hidden),q=(_=(f=x.components)===null||f===void 0?void 0:f.DayContent)!==null&&_!==void 0?_:lce,Z=d.jsx(q,{date:e,displayMonth:t,activeModifiers:A}),Q={style:V,className:$,children:Z,role:"gridcell"},H=o.focusTarget&&Sl(o.focusTarget,e)&&!A.outside,K=o.focusedDay&&Sl(o.focusedDay,e),ne=si(si(si({},Q),(l={disabled:A.disabled,role:"gridcell"},l["aria-selected"]=A.selected,l.tabIndex=K||H?0:-1,l)),I),le={isButton:U,isHidden:Y,activeModifiers:A,selectedDays:N,buttonProps:ne,divProps:Q};return le}function Uce(e){var t=F.useRef(null),i=Vce(e.date,e.displayMonth,t);return i.isHidden?d.jsx("div",{role:"gridcell"}):i.isButton?d.jsx(GT,si({name:"day",ref:t},i.buttonProps)):d.jsx("div",si({},i.divProps))}function $ce(e){var t=e.number,i=e.dates,l=Us(),f=l.onWeekNumberClick,_=l.styles,x=l.classNames,o=l.locale,A=l.labels.labelWeekNumber,I=l.formatters.formatWeekNumber,N=I(Number(t),{locale:o});if(!f)return d.jsx("span",{className:x.weeknumber,style:_.weeknumber,children:N});var U=A(Number(t),{locale:o}),$=function(V){f(t,i,V)};return d.jsx(GT,{name:"week-number","aria-label":U,className:x.weeknumber,style:_.weeknumber,onClick:$,children:N})}function qce(e){var t,i,l=Us(),f=l.styles,_=l.classNames,x=l.showWeekNumber,o=l.components,A=(t=o==null?void 0:o.Day)!==null&&t!==void 0?t:Uce,I=(i=o==null?void 0:o.WeekNumber)!==null&&i!==void 0?i:$ce,N;return x&&(N=d.jsx("td",{className:_.cell,style:f.cell,children:d.jsx(I,{number:e.weekNumber,dates:e.dates})})),d.jsxs("tr",{className:_.row,style:f.row,children:[N,e.dates.map(function(U){return d.jsx("td",{className:_.cell,style:f.cell,role:"presentation",children:d.jsx(A,{displayMonth:e.displayMonth,date:U})},Voe(U))})]})}function CF(e,t,i){for(var l=i!=null&&i.ISOWeek?c$(t):D2(t,i),f=i!=null&&i.ISOWeek?Um(e):fu(e,i),_=Zu(l,f),x=[],o=0;o<=_;o++)x.push(Ka(f,o));var A=x.reduce(function(I,N){var U=i!=null&&i.ISOWeek?h$(N):p$(N,i),$=I.find(function(V){return V.weekNumber===U});return $?($.dates.push(N),I):(I.push({weekNumber:U,dates:[N]}),I)},[]);return A}function Gce(e,t){var i=CF(Ca(e),Oy(e),t);if(t!=null&&t.useFixedWeeks){var l=$oe(e,t);if(l<6){var f=i[i.length-1],_=f.dates[f.dates.length-1],x=YI(_,6-l),o=CF(YI(_,1),x,t);i.push.apply(i,o)}}return i}function Hce(e){var t,i,l,f=Us(),_=f.locale,x=f.classNames,o=f.styles,A=f.hideHead,I=f.fixedWeeks,N=f.components,U=f.weekStartsOn,$=f.firstWeekContainsDate,V=f.ISOWeek,Y=Gce(e.displayMonth,{useFixedWeeks:!!I,ISOWeek:V,locale:_,weekStartsOn:U,firstWeekContainsDate:$}),q=(t=N==null?void 0:N.Head)!==null&&t!==void 0?t:ace,Z=(i=N==null?void 0:N.Row)!==null&&i!==void 0?i:qce,Q=(l=N==null?void 0:N.Footer)!==null&&l!==void 0?l:ice;return d.jsxs("table",{id:e.id,className:x.table,style:o.table,role:"grid","aria-labelledby":e["aria-labelledby"],children:[!A&&d.jsx(q,{}),d.jsx("tbody",{className:x.tbody,style:o.tbody,children:Y.map(function(H){return d.jsx(Z,{displayMonth:e.displayMonth,dates:H.dates,weekNumber:H.weekNumber},H.weekNumber)})}),d.jsx(Q,{displayMonth:e.displayMonth})]})}function Wce(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var Zce=Wce()?F.useLayoutEffect:F.useEffect,JA=!1,Xce=0;function AF(){return"react-day-picker-".concat(++Xce)}function Kce(e){var t,i=e??(JA?AF():null),l=F.useState(i),f=l[0],_=l[1];return Zce(function(){f===null&&_(AF())},[]),F.useEffect(function(){JA===!1&&(JA=!0)},[]),(t=e??f)!==null&&t!==void 0?t:void 0}function Yce(e){var t,i,l=Us(),f=l.dir,_=l.classNames,x=l.styles,o=l.components,A=qb().displayMonths,I=Kce(l.id?"".concat(l.id,"-").concat(e.displayIndex):void 0),N=l.id?"".concat(l.id,"-grid-").concat(e.displayIndex):void 0,U=[_.month],$=x.month,V=e.displayIndex===0,Y=e.displayIndex===A.length-1,q=!V&&!Y;f==="rtl"&&(t=[V,Y],Y=t[0],V=t[1]),V&&(U.push(_.caption_start),$=si(si({},$),x.caption_start)),Y&&(U.push(_.caption_end),$=si(si({},$),x.caption_end)),q&&(U.push(_.caption_between),$=si(si({},$),x.caption_between));var Z=(i=o==null?void 0:o.Caption)!==null&&i!==void 0?i:nce;return d.jsxs("div",{className:U.join(" "),style:$,children:[d.jsx(Z,{id:I,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),d.jsx(Hce,{id:N,"aria-labelledby":I,displayMonth:e.displayMonth})]},e.displayIndex)}function Jce(e){var t=Us(),i=t.classNames,l=t.styles;return d.jsx("div",{className:i.months,style:l.months,children:e.children})}function Qce(e){var t,i,l=e.initialProps,f=Us(),_=lR(),x=qb(),o=F.useState(!1),A=o[0],I=o[1];F.useEffect(function(){f.initialFocus&&_.focusTarget&&(A||(_.focus(_.focusTarget),I(!0)))},[f.initialFocus,A,_.focus,_.focusTarget,_]);var N=[f.classNames.root,f.className];f.numberOfMonths>1&&N.push(f.classNames.multiple_months),f.showWeekNumber&&N.push(f.classNames.with_weeknumber);var U=si(si({},f.styles.root),f.style),$=Object.keys(l).filter(function(Y){return Y.startsWith("data-")}).reduce(function(Y,q){var Z;return si(si({},Y),(Z={},Z[q]=l[q],Z))},{}),V=(i=(t=l.components)===null||t===void 0?void 0:t.Months)!==null&&i!==void 0?i:Jce;return d.jsx("div",si({className:N.join(" "),style:U,dir:f.dir,id:f.id,nonce:l.nonce,title:l.title,lang:l.lang},$,{children:d.jsx(V,{children:x.displayMonths.map(function(Y,q){return d.jsx(Yce,{displayIndex:q,displayMonth:Y},q)})})}))}function eue(e){var t=e.children,i=Tle(e,["children"]);return d.jsx($le,{initialProps:i,children:d.jsx(Qle,{children:d.jsx(Nce,{initialProps:i,children:d.jsx(cce,{initialProps:i,children:d.jsx(hce,{initialProps:i,children:d.jsx(xce,{children:d.jsx(Rce,{children:t})})})})})})})}function tue(e){return d.jsx(eue,si({},e,{children:d.jsx(Qce,{initialProps:e})}))}function uR({className:e,classNames:t,showOutsideDays:i=!0,...l}){return d.jsx(tue,{showOutsideDays:i,className:wr("p-3",e),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:wr(mb({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:wr(mb({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:({...f})=>d.jsx(B4,{className:"h-4 w-4"}),IconRight:({...f})=>d.jsx(V4,{className:"h-4 w-4"})},...l})}uR.displayName="Calendar";const nm=e=>Kn(e,"yyyy-MM-dd"),T0=e=>new Date(`${e}T00:00:00`),jF=e=>Kn(T0(e),"dd/MM/yyyy"),rue=["falta justificada","falta injustificada","afastamento INSS","frias","suspenso","Posto vago"],nue=e=>{switch(e==null?void 0:e.replace(/_/g," ").trim().toLowerCase()){case"falta justificada":return"falta justificada";case"falta injustificada":return"falta injustificada";case"afastamento inss":return"afastamento INSS";case"f?rias":case"ferias":return"f?rias";case"suspens?o":case"suspensao":return"suspens?o";case"posto vago":return"Posto vago";default:return e==null?void 0:e.replace(/_/g," ").trim()}},iue="00000000-0000-0000-0000-000000000000",sue={vago:"Vago",ocupado:"Ocupado",vago_temporariamente:"Vago temporariamente",ocupado_temporariamente:"Ocupado temporariamente",presenca_confirmada:"Presenca confirmada",ocupacao_agendada:"Ocupa??o agendada",inativo:"Inativo"},oue=e=>{switch(e){case"ocupado":case"presenca_confirmada":return"default";case"ocupacao_agendada":case"ocupado_temporariamente":return"secondary";case"vago":return"destructive";case"inativo":return"outline";default:return"outline"}},aue=e=>{switch(e){case"ocupado":case"presenca_confirmada":return d.jsx(f2,{className:"h-4 w-4"});case"ocupacao_agendada":return d.jsx(Al,{className:"h-4 w-4"});case"vago":case"vago_temporariamente":return d.jsx(tI,{className:"h-4 w-4"});case"inativo":return d.jsx(tI,{className:"h-4 w-4"});default:return d.jsx(Hd,{className:"h-4 w-4"})}},lue=({posto:e,unidade:t,onEdit:i,onDelete:l})=>{const[f,_]=F.useState([]),[x,o]=F.useState(e.status??"vago"),[A,I]=F.useState(e.ultimo_dia_atividade??null),[N,U]=F.useState(),[$,V]=F.useState(!1),[Y,q]=F.useState([]),[Z,Q]=F.useState([]),[H,K]=F.useState([]),[ne,le]=F.useState([]),[pe,Ae]=F.useState(!1),[Ze,Xe]=F.useState(null),[Je,Te]=F.useState("");F.useEffect(()=>{o(e.status??"vago"),I(e.ultimo_dia_atividade??null)},[e.status,e.ultimo_dia_atividade]);const xe=F.useCallback(async()=>{const Pt=new Date,fe=new Date(Pt.getFullYear(),Pt.getMonth(),1),Le=new Date(Pt.getFullYear(),Pt.getMonth()+1,0),{data:vt,error:Wt}=await Ge.from("dias_trabalho").select("data, status").eq("posto_servico_id",e.id).in("status",["vago","presenca_confirmada","ocupacao_agendada"]).gte("data",nm(fe)).lte("data",nm(Le));if(!Wt&&vt){const Ft=vt.filter(vr=>vr.status==="presenca_confirmada").map(vr=>T0(vr.data)),Ut=vt.filter(vr=>vr.status==="ocupacao_agendada").map(vr=>T0(vr.data));Q(Ft),le(Ut)}else Q([]),le([])},[e.id]),Be=F.useCallback(async()=>{const Pt=new Date,fe=new Date(Pt.getFullYear(),Pt.getMonth(),1),Le=new Date(Pt.getFullYear(),Pt.getMonth()+1,0),{data:vt,error:Wt}=await Ge.from("posto_dias_vagos").select("data").eq("posto_servico_id",e.id).gte("data",nm(fe)).lte("data",nm(Le));if(!Wt&&vt){const Ft=vt.map(Ut=>T0(Ut.data));K(Ft)}else K([])},[e.id]),dt=F.useCallback(async()=>{const Pt=new Date,fe=Pt.getMonth()+1,Le=Pt.getFullYear(),{data:vt,error:Wt}=await Ge.from("posto_jornadas").select("dias_trabalho").eq("posto_servico_id",e.id).eq("mes",fe).eq("ano",Le).maybeSingle();if(!Wt&&vt){const Ft=vt.dias_trabalho.map(Ut=>new Date(Ut+"T00:00:00"));q(Ft)}},[e.id]),qt=F.useCallback(async()=>{const{data:Pt,error:fe}=await Ge.from("colaboradores").select("id, nome_completo, status_colaborador").eq("posto_servico_id",e.id).eq("status_colaborador","ativo");!fe&&Pt&&_(Pt)},[e.id]);F.useEffect(()=>{qt(),dt(),xe(),Be();const Pt=Ge.channel(`posto-${e.id}-updates`).on("postgres_changes",{event:"*",schema:"public",table:"colaboradores",filter:`posto_servico_id=eq.${e.id}`},()=>{qt()}).on("postgres_changes",{event:"*",schema:"public",table:"dias_trabalho",filter:`posto_servico_id=eq.${e.id}`},()=>{xe(),Be()}).on("postgres_changes",{event:"*",schema:"public",table:"posto_dias_vagos",filter:`posto_servico_id=eq.${e.id}`},()=>{Be()}).on("postgres_changes",{event:"*",schema:"public",table:"postos_servico",filter:`id=eq.${e.id}`},fe=>{const Le=fe.new;Le!=null&&Le.status&&o(Le.status),Le&&"ultimo_dia_atividade"in Le&&I(Le.ultimo_dia_atividade??null)}).subscribe();return()=>{Ge.removeChannel(Pt)}},[e.id,qt,xe,Be,dt]);const Ke=async()=>{try{const{data:Pt}=await Ge.from("colaboradores").select("id").eq("posto_servico_id",e.id).limit(1),{data:fe}=await Ge.from("chamados").select("id").eq("posto_servico_id",e.id).limit(1);if(Pt&&Pt.length>0){In({title:"No  possvel excluir",description:"Este posto possui colaboradores relacionados. Remova a vinculao dos colaboradores primeiro.",variant:"destructive"});return}if(fe&&fe.length>0){In({title:"No  possvel excluir",description:"Este posto possui chamados relacionados. Exclua os chamados primeiro.",variant:"destructive"});return}const{error:Le}=await Ge.from("postos_servico").delete().eq("id",e.id);if(Le)throw Le;In({title:"Posto excludo",description:"Posto de servio excludo com sucesso"}),l()}catch(Pt){In({title:"Erro",description:Pt.message,variant:"destructive"})}},st=async()=>{try{const Pt=new Date,fe=new Date(Pt.getFullYear(),Pt.getMonth(),1),Le=new Date(Pt.getFullYear(),Pt.getMonth()+1,0),vt=A?T0(A):null;if(vt&&vt<fe){In({title:"Posto encerrado",description:`O ultimo dia de atividade foi ${jF(A)}. Nao ha jornadas disponiveis para o periodo atual.`,variant:"destructive"});return}const Wt=vt&&vt<Le?vt:Le,Ft=fe.toISOString().split("T")[0],Ut=Wt.toISOString().split("T")[0],{data:vr,error:xr}=await Ge.from("dias_trabalho").select("data").eq("posto_servico_id",e.id).gte("data",Ft).lte("data",Ut).order("data");if(xr)throw xr;let zr=(vr==null?void 0:vr.map(Vi=>new Date(Vi.data+"T00:00:00")))||[],Hr=(vr==null?void 0:vr.map(Vi=>Vi.data))||[];if(!zr.length){if(!e.escala){In({title:"Escala nao configurada",description:"Defina a escala do posto para gerar a jornada.",variant:"destructive"});return}const Vi=e.primeiro_dia_atividade||Ft,{data:As,error:bi}=await Ge.rpc("calcular_dias_escala",{p_escala:e.escala,p_data_inicio:Ft,p_data_fim:Ut,p_dias_semana:e.dias_semana??null,p_primeiro_dia_atividade:Vi});if(bi)throw bi;if(zr=(As||[]).map(Is=>new Date(Is.data_trabalho+"T00:00:00")),Hr=zr.map(Is=>nm(Is)),!zr.length){In({title:"Sem dias programados",description:"Nenhum dia de trabalho foi retornado pela funcao calcular_dias_escala.",variant:"destructive"});return}}if(!zr.length){In({title:"Sem dias programados",description:"Nenhum dia de trabalho esta disponivel dentro do periodo permitido.",variant:"destructive"});return}const{data:{user:jn}}=await Ge.auth.getUser();if(!jn)throw new Error("Usuario nao autenticado");const hn=Pt.getMonth()+1,Ji=Pt.getFullYear(),{error:Ii}=await Ge.from("posto_jornadas").upsert({posto_servico_id:e.id,mes:hn,ano:Ji,dias_trabalho:Hr,created_by:jn.id},{onConflict:"posto_servico_id,mes,ano"});if(Ii)throw Ii;q(zr),In({title:"Jornada confirmada",description:`Jornada confirmada para ${zr.length} dias do mes corrente`})}catch(Pt){In({title:"Erro ao salvar jornada",description:Pt.message,variant:"destructive"})}},Ne=Pt=>{Pt&&(Xe(Pt),Ae(!0))},De=async()=>{if(Ze)try{const Pt=nm(Ze),{error:fe}=await Ge.from("dias_trabalho").update({status:"presenca_confirmada",motivo_vago:null}).eq("posto_servico_id",e.id).eq("data",Pt);if(fe)throw fe;const{error:Le}=await Ge.from("posto_dias_vagos").delete().eq("posto_servico_id",e.id).eq("data",Pt);if(Le)throw Le;K(vt=>vt.filter(Wt=>Wt.getTime()!==Ze.getTime())),Z.some(vt=>vt.getTime()===Ze.getTime())||Q(vt=>[...vt,Ze]),Ae(!1),In({title:"Presena confirmada",description:`Presena confirmada para ${Ze.toLocaleDateString("pt-BR")}`})}catch(Pt){In({title:"Erro ao confirmar presena",description:Pt.message,variant:"destructive"})}},Tt=async()=>{if(!Ze||!Je){In({title:"Motivo obrigat?rio",description:"Selecione um motivo para marcar o posto como vago",variant:"destructive"});return}try{const Pt=nm(Ze),fe=nue(Je),{error:Le}=await Ge.from("dias_trabalho").update({status:"vago",motivo_vago:fe}).eq("posto_servico_id",e.id).eq("data",Pt);if(Le)throw Le;const{data:{user:vt}}=await Ge.auth.getUser(),{error:Wt}=await Ge.from("posto_dias_vagos").upsert({posto_servico_id:e.id,colaborador_id:null,data:Pt,motivo:fe,created_by:(vt==null?void 0:vt.id)??iue});if(Wt)throw Wt;Q(Ft=>Ft.filter(Ut=>Ut.getTime()!==Ze.getTime())),await Be(),await xe(),await xe(),await Be(),Ae(!1),Te(""),In({title:"Posto vago",description:`Posto marcado como vago para ${Ze.toLocaleDateString("pt-BR")}`,variant:"destructive"})}catch(Pt){In({title:"Erro ao marcar dia vago",description:Pt.message,variant:"destructive"})}};return d.jsxs(Sr,{className:"hover:shadow-lg transition-shadow",children:[d.jsx(wn,{children:d.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:d.jsx(AL,{className:"h-4 w-4 text-primary"})}),d.jsxs("div",{children:[d.jsx(An,{className:"text-base",children:e.nome}),d.jsx("p",{className:"text-sm text-muted-foreground",children:e.codigo})]})]}),d.jsxs("div",{className:"flex flex-wrap gap-2 items-center sm:justify-end",children:[d.jsxs(Vs,{open:$,onOpenChange:V,children:[d.jsx($U,{asChild:!0,children:d.jsx(Bt,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:d.jsx(Al,{className:"h-4 w-4"})})}),d.jsxs(Ms,{className:"sm:max-w-md",children:[d.jsx(Ns,{children:d.jsxs(Ds,{children:["Calendrio - ",e.nome]})}),d.jsxs("div",{className:"space-y-4",children:[d.jsx("div",{className:"flex justify-center",children:d.jsx(uR,{mode:"single",selected:N,onSelect:Ne,className:"rounded-md border pointer-events-auto",modifiers:{confirmado:Y,presenca:Z,vago:H,agendado:ne},modifiersStyles:{confirmado:{backgroundColor:"hsl(var(--primary) / 0.2)",color:"hsl(var(--foreground))"},presenca:{backgroundColor:"hsl(142 76% 36%)",color:"white",fontWeight:"bold"},vago:{backgroundColor:"hsl(0 84% 60%)",color:"white",fontWeight:"bold"},agendado:{backgroundColor:"hsl(31 97% 45%)",color:"white",fontWeight:"bold"}}})}),e.escala&&d.jsx("div",{className:"space-y-2",children:d.jsxs("div",{className:"flex justify-center gap-2",children:[d.jsx(Bt,{onClick:st,className:"w-full",disabled:Y.length>0,children:Y.length>0?"Jornada Confirmada":"Confirmar Jornada"}),Y.length>0&&d.jsx(Bt,{onClick:async()=>{try{const Pt=new Date,{error:fe}=await Ge.from("posto_jornadas").delete().eq("posto_servico_id",e.id).eq("mes",Pt.getMonth()+1).eq("ano",Pt.getFullYear());if(fe)throw fe;q([]),In({title:"Jornada limpa",description:"Jornada removida com sucesso"})}catch(Pt){In({title:"Erro ao limpar jornada",description:Pt.message,variant:"destructive"})}},variant:"outline",children:"Limpar"})]})})]})]})]}),d.jsxs(Gn,{variant:oue(x),className:"flex items-center gap-1",children:[aue(x),sue[x]??x]})]})]})}),d.jsxs(tn,{children:[d.jsxs("div",{className:"space-y-2",children:[t&&d.jsxs("p",{className:"text-sm text-muted-foreground",children:["Unidade: ",t.nome]}),d.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[d.jsx(Hd,{className:"h-4 w-4 text-muted-foreground"}),d.jsx("span",{children:e.funcao})]}),e.escala&&d.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[d.jsx(AL,{className:"h-4 w-4"}),d.jsxs("span",{children:["Escala: ",e.escala]})]}),A&&d.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[d.jsx(Al,{className:"h-4 w-4"}),d.jsxs("span",{children:["ltimo dia previsto: ",jF(A)]})]}),d.jsxs("div",{className:"flex items-center justify-between text-sm pt-2 border-t",children:[d.jsx("span",{className:"text-muted-foreground",children:"Colaboradores lotados:"}),d.jsxs("span",{className:"font-semibold",children:[f.length,"/1"]})]}),e.horario_inicio&&e.horario_fim&&d.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[d.jsx(Vy,{className:"h-4 w-4"}),d.jsxs("span",{children:[e.horario_inicio," - ",e.horario_fim]})]})]}),d.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mt-4",children:[d.jsxs(Bt,{variant:"outline",size:"sm",className:"flex-1",onClick:i,children:[d.jsx(gu,{className:"h-3 w-3 mr-1"}),"Editar"]}),d.jsxs(pu,{children:[d.jsx(Vb,{asChild:!0,children:d.jsx(Bt,{variant:"outline",size:"sm",className:"sm:w-auto",children:d.jsx(jl,{className:"h-3 w-3"})})}),d.jsxs(bc,{children:[d.jsxs(wc,{children:[d.jsx(Tc,{children:"Confirmar excluso"}),d.jsx(Ec,{children:"Tem certeza que deseja excluir este posto? Esta ao no pode ser desfeita."})]}),d.jsxs(Sc,{children:[d.jsx(td,{children:"Cancelar"}),d.jsx(Cc,{onClick:Ke,children:"Excluir"})]})]})]})]})]}),d.jsx(Vs,{open:pe,onOpenChange:Ae,children:d.jsxs(Ms,{className:"sm:max-w-md",children:[d.jsx(Ns,{children:d.jsx(Ds,{children:Ze&&`Marcar dia ${Ze.toLocaleDateString("pt-BR")}`})}),Ze&&ne.some(Pt=>Pt.getTime()===Ze.getTime())&&d.jsx("p",{className:"text-sm text-muted-foreground",children:"Este dia possui uma ocupao agendada para um colaborador."}),d.jsxs("div",{className:"flex flex-col gap-4",children:[d.jsxs(Bt,{onClick:De,className:"w-full bg-green-600 hover:bg-green-700",children:[d.jsx(f2,{className:"h-4 w-4 mr-2"}),"Confirmar Presena"]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"motivo",children:"Motivo da Ausncia"}),d.jsxs(Vr,{value:Je,onValueChange:Te,children:[d.jsx(Or,{id:"motivo",children:d.jsx(Ur,{placeholder:"Selecione o motivo"})}),d.jsx(Lr,{children:rue.map(Pt=>d.jsx(bt,{value:Pt,children:Pt},Pt))})]})]}),d.jsxs(Bt,{onClick:Tt,variant:"destructive",className:"w-full",disabled:!Je,children:[d.jsx(tI,{className:"h-4 w-4 mr-2"}),"Posto Vago"]})]})]})})]})},ek=e=>1,cue=()=>{var ws,Lo,ho;const e=_u(),[t,i]=F.useState(!0),[l,f]=F.useState(""),[_,x]=F.useState("clientes"),[o,A]=F.useState("all"),[I,N]=F.useState("all"),[U,$]=F.useState({}),[V,Y]=F.useState(0),[q,Z]=F.useState(0),[Q,H]=F.useState(0),[K,ne]=F.useState(0),[le,pe]=F.useState(0),[Ae,Ze]=F.useState([]),[Xe,Je]=F.useState([]),[Te,xe]=F.useState([]),[Be,dt]=F.useState([]),[qt,Ke]=F.useState(!1),[st,Ne]=F.useState(!1),[De,Tt]=F.useState(!1),[Pt,fe]=F.useState(!1),[Le,vt]=F.useState(void 0),[Wt,Ft]=F.useState(void 0),[Ut,vr]=F.useState(void 0),[xr,zr]=F.useState(void 0),[Hr,jn]=F.useState(null),[hn,Ji]=F.useState(null),[Ii,Vi]=F.useState(null);F.useEffect(()=>{As(),bi()},[]);const As=async()=>{const{data:{user:rr}}=await Ge.auth.getUser();rr||e("/auth")},bi=async()=>{i(!0);try{await Promise.all([Is(),nt(),Ct(),Kt(),jr(),yr(),br(),Fr()])}catch(rr){console.error("Erro ao carregar dados:",rr),In({title:"Erro",description:"Erro ao carregar dados",variant:"destructive"})}finally{i(!1)}},Is=async()=>{const{data:rr,error:yt}=await Ge.from("clientes").select("*").order("razao_social");if(yt)throw yt;Ze(rr||[])},nt=async()=>{const{data:rr,error:yt}=await Ge.from("contratos").select("*").order("nome");if(yt)throw yt;Je(rr||[])},Ct=async()=>{const{data:rr,error:yt}=await Ge.from("unidades").select("*").order("nome");if(yt)throw yt;xe(rr||[])},Kt=async()=>{const{data:rr,error:yt}=await Ge.from("postos_servico").select("*").order("nome");if(yt)throw yt;if(dt(rr||[]),rr){const Ar=rr.map(Cn=>Cn.id),{data:Qr}=await Ge.from("colaboradores").select("posto_servico_id").in("posto_servico_id",Ar);if(Qr){const Cn={};Qr.forEach(Mi=>{Mi.posto_servico_id&&(Cn[Mi.posto_servico_id]=(Cn[Mi.posto_servico_id]||0)+1)}),$(Cn)}}},jr=async()=>{const{count:rr,error:yt}=await Ge.from("ordens_servico").select("id",{count:"exact",head:!0}).eq("status","aberta");if(yt)throw yt;Y(rr||0)},yr=async()=>{const{data:rr,error:yt}=await Ge.from("chamados").select("sla_horas, avaliacao").eq("status","concluido").not("avaliacao","is",null);if(yt)throw yt;if(rr&&rr.length>0){const Ar=rr.map(Cn=>Cn.sla_horas).filter(Cn=>typeof Cn=="number"),Qr=rr.map(Cn=>Cn.avaliacao).filter(Cn=>typeof Cn=="number");if(Ar.length>0){const Cn=Ar.reduce((Mi,li)=>Mi+li,0);Z(Math.round(Cn/Ar.length*100)/100)}if(Qr.length>0){const Cn=Qr.reduce((Mi,li)=>Mi+li,0);H(Math.round(Cn/Qr.length*10)/10)}}else Z(0),H(0)},br=async()=>{const{count:rr,error:yt}=await Ge.from("checklist").select("id",{count:"exact",head:!0});if(yt)throw yt;ne(rr||0)},Fr=async()=>{const{count:rr,error:yt}=await Ge.from("inspecoes").select("id",{count:"exact",head:!0});if(yt)throw yt;pe(rr||0)},On=Ae.filter(rr=>rr.razao_social.toLowerCase().includes(l.toLowerCase())||rr.cnpj.includes(l)),pi=Hr?Xe.filter(rr=>rr.cliente_id===Hr):Xe.filter(rr=>rr.nome.toLowerCase().includes(l.toLowerCase())||rr.codigo.toLowerCase().includes(l.toLowerCase())),Ri=hn?Te.filter(rr=>rr.contrato_id===hn):Te.filter(rr=>rr.nome.toLowerCase().includes(l.toLowerCase())||rr.codigo.toLowerCase().includes(l.toLowerCase())),$s=Ii?Be.filter(rr=>{const yt=rr.unidade_id===Ii,Ar=rr.nome.toLowerCase().includes(l.toLowerCase())||rr.codigo.toLowerCase().includes(l.toLowerCase());if(I==="all")return yt&&Ar;const Qr=U[rr.id]||0,Cn=ek(),Mi=Qr>=Cn;return yt&&Ar&&(I==="ocupado"?Mi:!Mi)}):Be.filter(rr=>{const yt=rr.nome.toLowerCase().includes(l.toLowerCase())||rr.codigo.toLowerCase().includes(l.toLowerCase()),Ar=o==="all"||rr.unidade_id===o;if(I==="all")return yt&&Ar;const Qr=U[rr.id]||0,Cn=ek(),Mi=Qr>=Cn;return yt&&Ar&&(I==="ocupado"?Mi:!Mi)});return t?d.jsx("div",{className:"min-h-screen flex items-center justify-center",children:d.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):d.jsx(bo,{children:d.jsxs("div",{className:"min-h-screen bg-background",children:[d.jsx("header",{className:"border-b bg-card shadow-sm",children:d.jsx("div",{className:"container mx-auto px-4 py-4",children:d.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-start",children:[d.jsx("div",{className:"p-2 bg-gradient-to-br from-primary to-accent rounded-lg",children:d.jsx(Lf,{className:"h-6 w-6 text-primary-foreground"})}),d.jsxs("div",{children:[d.jsx("h1",{className:"text-xl font-bold",children:"Gesto de Contratos"}),d.jsx("p",{className:"text-sm text-muted-foreground",children:"Hierarquia: Cliente  Contrato  Unidade  Posto"})]})]})})}),d.jsxs("main",{className:"container mx-auto px-4 py-8",children:[d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-8",children:[d.jsx(Sr,{children:d.jsxs(wn,{className:"pb-3 text-center flex flex-col items-center gap-2",children:[d.jsx(Hd,{className:"h-5 w-5 text-primary"}),d.jsx(An,{className:"text-sm font-medium text-muted-foreground",children:"Total Clientes"}),d.jsx("p",{className:"text-2xl font-bold",children:Ae.length})]})}),d.jsx(Sr,{children:d.jsxs(wn,{className:"pb-3 text-center flex flex-col items-center gap-2",children:[d.jsx(q4,{className:"h-5 w-5 text-emerald-600"}),d.jsx(An,{className:"text-sm font-medium text-muted-foreground",children:"Checklists Ativos"}),d.jsx("p",{className:"text-2xl font-bold text-emerald-600",children:K})]})}),d.jsx(Sr,{children:d.jsxs(wn,{className:"pb-3 text-center flex flex-col items-center gap-2",children:[d.jsx(PZ,{className:"h-5 w-5 text-indigo-600"}),d.jsx(An,{className:"text-sm font-medium text-muted-foreground",children:"Inspees Registradas"}),d.jsx("p",{className:"text-2xl font-bold text-indigo-600",children:le})]})}),d.jsx(Sr,{children:d.jsxs(wn,{className:"pb-3 text-center flex flex-col items-center gap-2",children:[d.jsx(iP,{className:"h-5 w-5 text-blue-600"}),d.jsx(An,{className:"text-sm font-medium text-muted-foreground",children:"Chamados: NPS Mdio Geral"}),d.jsx("p",{className:"text-2xl font-bold text-blue-600",children:Q>0?Q.toFixed(1):"0"})]})}),d.jsx(Sr,{children:d.jsxs(wn,{className:"pb-3 text-center flex flex-col items-center gap-2",children:[d.jsx(Zf,{className:"h-5 w-5 text-orange-600"}),d.jsx(An,{className:"text-sm font-medium text-muted-foreground",children:"OS Abertas"}),d.jsx("p",{className:"text-2xl font-bold text-orange-600",children:V})]})})]}),(Hr||hn||Ii)&&d.jsxs("div",{className:"mb-4 flex items-center gap-2 text-sm",children:[d.jsx(Bt,{variant:"link",size:"sm",onClick:()=>{jn(null),Ji(null),Vi(null),x("clientes")},children:"Clientes"}),Hr&&d.jsxs(d.Fragment,{children:[d.jsx("span",{children:"/"}),d.jsx(Bt,{variant:"link",size:"sm",onClick:()=>{Ji(null),Vi(null),x("contratos")},children:(ws=Ae.find(rr=>rr.id===Hr))==null?void 0:ws.razao_social})]}),hn&&d.jsxs(d.Fragment,{children:[d.jsx("span",{children:"/"}),d.jsx(Bt,{variant:"link",size:"sm",onClick:()=>{Vi(null),x("unidades")},children:(Lo=Xe.find(rr=>rr.id===hn))==null?void 0:Lo.nome})]}),Ii&&d.jsxs(d.Fragment,{children:[d.jsx("span",{children:"/"}),d.jsx("span",{className:"text-muted-foreground",children:(ho=Te.find(rr=>rr.id===Ii))==null?void 0:ho.nome})]})]}),d.jsxs(eR,{value:_,onValueChange:x,children:[d.jsxs(z2,{className:"grid w-full grid-cols-4",children:[d.jsx($d,{value:"clientes",children:"Clientes"}),d.jsx($d,{value:"contratos",children:"Contratos"}),d.jsx($d,{value:"unidades",children:"Unidades"}),d.jsx($d,{value:"postos",children:"Postos"})]}),d.jsxs(qd,{value:"clientes",className:"space-y-4",children:[d.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[d.jsxs("div",{className:"relative flex-1 w-full md:max-w-sm",children:[d.jsx(ou,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),d.jsx(gr,{placeholder:"Buscar cliente...",value:l,onChange:rr=>f(rr.target.value),className:"pl-10"})]}),d.jsxs(Bt,{className:"w-full md:w-auto",onClick:()=>Ke(!0),children:[d.jsx(Ea,{className:"h-4 w-4 mr-2"}),"Novo Cliente"]})]}),qt&&d.jsx(Jae,{clienteId:Le,onClose:()=>{Ke(!1),vt(void 0)},onSuccess:()=>{Is(),Ke(!1),vt(void 0)}}),d.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4",children:On.map(rr=>d.jsx(ble,{cliente:rr,onSelect:()=>{jn(rr.id),x("contratos")},onEdit:()=>{vt(rr.id),Ke(!0)},onDelete:()=>Is()},rr.id))}),On.length===0&&d.jsx(Sr,{children:d.jsxs(tn,{className:"flex flex-col items-center justify-center py-12",children:[d.jsx(H_,{className:"h-12 w-12 text-muted-foreground mb-4"}),d.jsx("p",{className:"text-muted-foreground",children:"Nenhum cliente encontrado"})]})})]}),d.jsxs(qd,{value:"contratos",className:"space-y-4",children:[d.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[d.jsxs("div",{className:"relative flex-1 w-full md:max-w-sm",children:[d.jsx(ou,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),d.jsx(gr,{placeholder:"Buscar contrato...",value:l,onChange:rr=>f(rr.target.value),className:"pl-10"})]}),d.jsxs(Bt,{className:"w-full md:w-auto",onClick:()=>Ne(!0),children:[d.jsx(Ea,{className:"h-4 w-4 mr-2"}),"Novo Contrato"]})]}),st&&d.jsx(Qae,{contratoId:Wt,clienteId:Hr||void 0,onClose:()=>{Ne(!1),Ft(void 0)},onSuccess:()=>{nt(),Ne(!1),Ft(void 0)}}),d.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4",children:pi.map(rr=>d.jsx(wle,{contrato:rr,cliente:Ae.find(yt=>yt.id===rr.cliente_id),onSelect:()=>{Ji(rr.id),x("unidades")},onEdit:()=>{Ft(rr.id),Ne(!0)},onDelete:()=>nt()},rr.id))}),pi.length===0&&d.jsx(Sr,{children:d.jsxs(tn,{className:"flex flex-col items-center justify-center py-12",children:[d.jsx(H_,{className:"h-12 w-12 text-muted-foreground mb-4"}),d.jsx("p",{className:"text-muted-foreground",children:"Nenhum contrato encontrado"})]})})]}),d.jsxs(qd,{value:"unidades",className:"space-y-4",children:[d.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[d.jsxs("div",{className:"relative flex-1 w-full md:max-w-sm",children:[d.jsx(ou,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),d.jsx(gr,{placeholder:"Buscar unidade...",value:l,onChange:rr=>f(rr.target.value),className:"pl-10"})]}),d.jsxs(Bt,{className:"w-full md:w-auto",onClick:()=>Tt(!0),children:[d.jsx(Ea,{className:"h-4 w-4 mr-2"}),"Nova Unidade"]})]}),De&&d.jsx(ele,{unidadeId:Ut,contratoId:hn||void 0,onClose:()=>{Tt(!1),vr(void 0)},onSuccess:()=>{Ct(),Tt(!1),vr(void 0)}}),d.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4",children:Ri.map(rr=>d.jsx(Sle,{unidade:rr,contrato:Xe.find(yt=>yt.id===rr.contrato_id),onSelect:()=>{Vi(rr.id),x("postos")},onEdit:()=>{vr(rr.id),Tt(!0)},onDelete:()=>Ct()},rr.id))}),Ri.length===0&&d.jsx(Sr,{children:d.jsxs(tn,{className:"flex flex-col items-center justify-center py-12",children:[d.jsx(H_,{className:"h-12 w-12 text-muted-foreground mb-4"}),d.jsx("p",{className:"text-muted-foreground",children:"Nenhuma unidade encontrada"})]})})]}),d.jsxs(qd,{value:"postos",className:"space-y-4",children:[d.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between",children:[d.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center lg:gap-2 flex-1",children:[d.jsxs("div",{className:"relative flex-1 w-full lg:max-w-sm",children:[d.jsx(ou,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),d.jsx(gr,{placeholder:"Buscar posto...",value:l,onChange:rr=>f(rr.target.value),className:"pl-10"})]}),!Ii&&d.jsxs(Vr,{value:o,onValueChange:A,children:[d.jsx(Or,{className:"w-full lg:w-[250px]",children:d.jsx(Ur,{placeholder:"Filtrar por unidade"})}),d.jsxs(Lr,{className:"bg-popover z-50",children:[d.jsx(bt,{value:"all",children:"Todas as unidades"}),Te.map(rr=>d.jsx(bt,{value:rr.id,children:rr.nome},rr.id))]})]}),d.jsxs(Vr,{value:I,onValueChange:N,children:[d.jsx(Or,{className:"w-full lg:w-[200px]",children:d.jsx(Ur,{placeholder:"Filtrar por ocupao"})}),d.jsxs(Lr,{className:"bg-popover z-50",children:[d.jsx(bt,{value:"all",children:"Todos os postos"}),d.jsx(bt,{value:"ocupado",children:"Ocupados"}),d.jsx(bt,{value:"vago",children:"Vagos"})]})]})]}),d.jsxs(Bt,{className:"w-full lg:w-auto",onClick:()=>fe(!0),children:[d.jsx(Ea,{className:"h-4 w-4 mr-2"}),"Novo Posto"]})]}),Pt&&d.jsx(ale,{postoId:xr,unidadeId:Ii||void 0,onClose:()=>{fe(!1),zr(void 0)},onSuccess:()=>{Kt(),fe(!1),zr(void 0)}}),d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:$s.map(rr=>d.jsx(lue,{posto:rr,unidade:Te.find(yt=>yt.id===rr.unidade_id),onEdit:()=>{zr(rr.id),fe(!0)},onDelete:()=>Kt()},rr.id))}),$s.length===0&&d.jsx(Sr,{children:d.jsxs(tn,{className:"flex flex-col items-center justify-center py-12",children:[d.jsx(H_,{className:"h-12 w-12 text-muted-foreground mb-4"}),d.jsx("p",{className:"text-muted-foreground",children:"Nenhum posto encontrado"})]})})]})]})]})]})})},dR=async({postoId:e,colaboradorId:t,data:i,usuarioId:l=null})=>{const{error:f}=await Ge.rpc("agendar_ocupacao_posto",{p_posto_servico_id:e,p_colaborador_id:t,p_data:i,p_usuario_id:l});if(f)throw f},uue=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:2}),bS=e=>{const[t,i,l]=e.split("-").map(Number);return new Date(t,(i||1)-1,l||1)};function due({open:e,onClose:t}){const i=Xf(),[l,f]=F.useState(!0),[_,x]=F.useState([]),[o,A]=F.useState([]),[I,N]=F.useState([]),[U,$]=F.useState([]),[V,Y]=F.useState("all"),[q,Z]=F.useState(void 0),[Q,H]=F.useState("all"),[K,ne]=F.useState([]),[le,pe]=F.useState({}),[Ae,Ze]=F.useState(null);F.useEffect(()=>{e&&Xe()},[e]);const Xe=async()=>{f(!0);try{await Promise.all([Te(),xe(),Je(),Be(),dt()])}catch(De){In({title:"Erro ao carregar dados",description:De.message,variant:"destructive"})}finally{f(!1)}},Je=async()=>{const{data:De,error:Tt}=await Ge.from("postos_servico").select("id, nome, codigo").in("status",["vago","vago_temporariamente"]).order("nome");if(Tt)throw Tt;ne(De||[])},Te=async()=>{var fe,Le,vt;const{data:De,error:Tt}=await Ge.from("postos_servico").select(`
        id,
        nome,
        codigo,
        funcao,
        escala,
        unidades (
          nome,
          codigo,
          contratos (
            nome,
            codigo
          )
        )
      `).in("status",["vago","vago_temporariamente"]);if(Tt)throw Tt;const Pt=[];for(const Wt of De||[]){const{data:Ft}=await Ge.from("colaboradores").select("id").eq("posto_servico_id",Wt.id).eq("status_colaborador","ativo"),Ut=(Ft==null?void 0:Ft.length)||0,vr=ek();Ut<vr&&Pt.push({id:Wt.id,nome:Wt.nome,codigo:Wt.codigo,funcao:Wt.funcao,efetivo_planejado:vr,efetivo_atual:Ut,unidade:{nome:((fe=Wt.unidades)==null?void 0:fe.nome)||"Sem unidade",codigo:((Le=Wt.unidades)==null?void 0:Le.codigo)||"",contrato:(vt=Wt.unidades)!=null&&vt.contratos?{nome:Wt.unidades.contratos.nome,codigo:Wt.unidades.contratos.codigo}:null}})}x(Pt)},xe=async()=>{const{data:De,error:Tt}=await Ge.from("posto_dias_vagos").select(`
        id,
        data,
        motivo,
        posto_servico_id,
        postos_servico (
          id,
          nome,
          codigo,
          unidades (
            nome,
            contratos (
              nome,
              codigo
            )
          )
        ),
        colaboradores (
          nome_completo,
          cargo
        ),
        diarias:diarias_posto_dia_vago_id_fkey (
          id,
          status,
          valor,
          diaristas (
            id,
            nome_completo,
            telefone
          )
        )
      `).gte("data",new Date().toISOString().split("T")[0]).order("data");if(Tt)throw Tt;const Pt=(De||[]).map(fe=>{var Le,vt,Wt,Ft,Ut,vr,xr,zr;return{id:fe.id,data:fe.data,motivo:fe.motivo,postoId:fe.posto_servico_id,posto:{id:(Le=fe.postos_servico)==null?void 0:Le.id,nome:((vt=fe.postos_servico)==null?void 0:vt.nome)||"Desconhecido",codigo:((Wt=fe.postos_servico)==null?void 0:Wt.codigo)||"",unidade:{nome:((Ut=(Ft=fe.postos_servico)==null?void 0:Ft.unidades)==null?void 0:Ut.nome)||"Sem unidade",contrato:(xr=(vr=fe.postos_servico)==null?void 0:vr.unidades)!=null&&xr.contratos?{nome:fe.postos_servico.unidades.contratos.nome,codigo:fe.postos_servico.unidades.contratos.codigo}:null}},colaborador:fe.colaboradores?{nome_completo:fe.colaboradores.nome_completo,cargo:fe.colaboradores.cargo||"Sem cargo"}:null,diarias:((zr=fe.diarias)==null?void 0:zr.map(Hr=>({id:Hr.id,status:Hr.status,valor:Hr.valor||0,diarista:Hr.diaristas?{id:Hr.diaristas.id,nome_completo:Hr.diaristas.nome_completo,telefone:Hr.diaristas.telefone}:void 0})))||[]}});A(Pt)},Be=async()=>{const{data:De,error:Tt}=await Ge.from("colaboradores").select("id, nome_completo, cargo").is("posto_servico_id",null).eq("status_colaborador","ativo").order("nome_completo");if(Tt)throw Tt;const Pt=(De||[]).map(fe=>({id:fe.id,nome_completo:fe.nome_completo,cargo:fe.cargo||"Sem cargo",funcao:fe.cargo||"Sem funo"}));N(Pt)},dt=async()=>{const{data:De,error:Tt}=await Ge.from("diaristas").select("id, nome_completo, telefone, cidade").eq("status","ativo").order("nome_completo");if(Tt)throw Tt;$(De||[])},qt=async De=>{const Tt=le[De.id];if(!Tt){In({title:"Selecione o colaborador",description:"Escolha um colaborador reserva para realizar a cobertura.",variant:"destructive"});return}Ze(De.id);try{const{data:{user:Pt}}=await Ge.auth.getUser();if(!Pt)throw new Error("Usurio no autenticado");await dR({postoId:De.postoId,colaboradorId:Tt,data:De.data,usuarioId:Pt.id}),In({title:"Ocupao agendada",description:`Colaborador alocado para ${Kn(bS(De.data),"dd/MM/yyyy",{locale:js})}.`}),pe(fe=>({...fe,[De.id]:""})),await Promise.all([xe(),Te(),Be()]),await i.invalidateQueries({queryKey:["colaboradores"]})}catch(Pt){In({title:"Erro ao agendar ocupao",description:Pt.message||"No foi possvel alocar o colaborador para o dia escolhido.",variant:"destructive"})}finally{Ze(null)}},Ke=_.filter(De=>!(V!=="all"&&De.id!==V)),st=o.filter(De=>{if(V!=="all"){const Tt=K.find(Pt=>Pt.id===V);if(Tt&&De.posto.codigo!==Tt.codigo)return!1}if(q){const Tt=bS(De.data);if(Tt.getDate()!==q.getDate()||Tt.getMonth()!==q.getMonth()||Tt.getFullYear()!==q.getFullYear())return!1}return!(Q!=="all"&&De.data!==Q)}),Ne=Array.from(new Set(o.map(De=>De.data))).sort();return d.jsx(Vs,{open:e,onOpenChange:t,children:d.jsxs(Ms,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[d.jsxs(Ns,{children:[d.jsxs(Ds,{className:"text-2xl flex items-center gap-2",children:[d.jsx(H_,{className:"h-6 w-6 text-orange-500"}),"Gesto de Cobertura"]}),d.jsx(Qa,{children:"Monitore postos vagos e dias com ausncias programadas"})]}),d.jsxs("div",{className:"space-y-6",children:[d.jsxs(Sr,{children:[d.jsx(wn,{children:d.jsx(An,{className:"text-lg",children:"Filtros"})}),d.jsxs(tn,{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Posto"}),d.jsxs(Vr,{value:V,onValueChange:Y,children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Todos os postos"})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"all",children:"Todos os postos"}),K.map(De=>d.jsxs(bt,{value:De.id,children:[De.codigo," - ",De.nome]},De.id))]})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Data"}),d.jsx(uR,{mode:"single",selected:q,onSelect:Z,className:"border rounded-md",locale:js})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Filtrar por dia especfico"}),d.jsxs(Vr,{value:Q,onValueChange:H,children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Todos os dias"})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"all",children:"Todos os dias"}),Ne.map(De=>d.jsx(bt,{value:De,children:Kn(bS(De),"dd/MM/yyyy",{locale:js})},De))]})]})]})]})]}),d.jsxs(Sr,{children:[d.jsxs(wn,{children:[d.jsxs(An,{className:"flex items-center gap-2",children:[d.jsx(Hd,{className:"h-5 w-5 text-red-500"}),"Postos Vagos (",Ke.length,")"]}),d.jsx(fs,{children:"Postos com vagas no preenchidas"})]}),d.jsx(tn,{children:l?d.jsx("p",{className:"text-sm text-muted-foreground",children:"Carregando..."}):Ke.length===0?d.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum posto vago encontrado"}):d.jsxs("div",{className:"space-y-3",children:[Ke.map(De=>d.jsx(Sr,{className:"border-red-200",children:d.jsx(tn,{className:"p-4",children:d.jsx("div",{className:"flex items-start justify-between",children:d.jsxs("div",{className:"flex-1",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[d.jsx("h4",{className:"font-semibold",children:De.nome}),d.jsx(Gn,{variant:"outline",children:De.codigo})]}),d.jsxs("div",{className:"space-y-1 mb-2",children:[De.unidade.contrato&&d.jsxs("p",{className:"text-sm text-muted-foreground",children:[d.jsx("span",{className:"font-medium",children:"Contrato:"})," ",De.unidade.contrato.codigo," - ",De.unidade.contrato.nome]}),d.jsxs("p",{className:"text-sm text-muted-foreground",children:[d.jsx("span",{className:"font-medium",children:"Unidade:"})," ",De.unidade.nome,"  ",De.funcao]})]}),d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsxs("div",{className:"text-sm",children:[d.jsx("span",{className:"text-muted-foreground",children:"Efetivo atual: "}),d.jsx("span",{className:"font-medium text-red-500",children:De.efetivo_atual})]}),d.jsxs("div",{className:"text-sm",children:[d.jsx("span",{className:"text-muted-foreground",children:"Efetivo necessrio: "}),d.jsx("span",{className:"font-medium",children:De.efetivo_planejado})]}),d.jsxs(Gn,{variant:"destructive",children:["Faltam ",De.efetivo_planejado-De.efetivo_atual," colaboradores"]})]})]})})})},De.id)),I.length>0&&d.jsxs("div",{className:"mt-6 pt-6 border-t",children:[d.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[d.jsx(Hd,{className:"h-5 w-5 text-green-500"}),"Reservas Tcnicas Disponveis (",I.length,")"]}),d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:I.map(De=>d.jsx(Sr,{className:"border-green-200",children:d.jsx(tn,{className:"p-3",children:d.jsxs("div",{children:[d.jsx("h4",{className:"font-semibold text-sm mb-1",children:De.nome_completo}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(Gn,{variant:"secondary",className:"text-xs",children:De.cargo}),d.jsx(Gn,{variant:"outline",className:"text-xs bg-green-50",children:"Disponvel"})]})]})})},De.id))})]})]})})]}),d.jsxs(Sr,{children:[d.jsxs(wn,{children:[d.jsxs(An,{className:"flex items-center gap-2",children:[d.jsx(RZ,{className:"h-5 w-5 text-orange-500"}),"Dias Vagos (",st.length,")"]}),d.jsx(fs,{children:"Dias com ausncias programadas de colaboradores"})]}),d.jsx(tn,{children:l?d.jsx("p",{className:"text-sm text-muted-foreground",children:"Carregando..."}):st.length===0?d.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum dia vago encontrado"}):d.jsxs("div",{className:"space-y-3",children:[st.map(De=>d.jsx(Sr,{className:"border-orange-200",children:d.jsx(tn,{className:"p-4",children:d.jsx("div",{className:"flex items-start justify-between",children:d.jsxs("div",{className:"flex-1",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[d.jsx("h4",{className:"font-semibold",children:Kn(bS(De.data),"dd 'de' MMMM 'de' yyyy",{locale:js})}),d.jsx(Gn,{variant:"outline",children:De.posto.codigo})]}),d.jsxs("div",{className:"space-y-1 mb-2",children:[De.posto.unidade.contrato&&d.jsxs("p",{className:"text-sm text-muted-foreground",children:[d.jsx("span",{className:"font-medium",children:"Contrato:"})," ",De.posto.unidade.contrato.codigo," - ",De.posto.unidade.contrato.nome]}),d.jsxs("p",{className:"text-sm text-muted-foreground",children:[d.jsx("span",{className:"font-medium",children:"Unidade:"})," ",De.posto.unidade.nome,"  ",De.posto.nome]})]}),De.colaborador?d.jsxs("div",{className:"space-y-1",children:[d.jsxs("div",{className:"text-sm",children:[d.jsx("span",{className:"text-muted-foreground",children:"Colaborador: "}),d.jsx("span",{className:"font-medium",children:De.colaborador.nome_completo})]}),d.jsxs("div",{className:"text-sm",children:[d.jsx("span",{className:"text-muted-foreground",children:"Cargo: "}),d.jsx("span",{className:"font-medium",children:De.colaborador.cargo})]})]}):d.jsx("p",{className:"text-sm text-muted-foreground italic",children:"Sem colaborador atribudo"}),De.motivo&&d.jsxs("div",{className:"mt-2 text-sm",children:[d.jsx("span",{className:"text-muted-foreground",children:"Motivo: "}),d.jsx(Gn,{variant:"secondary",children:De.motivo==="falta_justificada"?"Falta Justificada":De.motivo==="falta_injustificada"?"Falta Injustificada":De.motivo==="pedido"?"Pedido":De.motivo==="afastamento_inss"?"Afastamento INSS":De.motivo==="folga"?"Folga":De.motivo==="ferias"?"Frias":De.motivo==="suspensao"?"Suspenso":De.motivo})]}),d.jsx("div",{className:"mt-3",children:De.diarias.length>0?d.jsxs("div",{className:"space-y-2",children:[d.jsxs("p",{className:"text-sm font-medium",children:["Diarias cadastradas (",De.diarias.length,")"]}),d.jsx("div",{className:"space-y-2",children:De.diarias.map(Tt=>d.jsxs("div",{className:"rounded-md border px-3 py-2 text-sm",children:[d.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[d.jsx(Gn,{variant:"outline",children:Tt.status}),d.jsx("span",{className:"font-semibold",children:uue.format(Number(Tt.valor)||0)})]}),Tt.diarista&&d.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Diarista: ",Tt.diarista.nome_completo,Tt.diarista.telefone?d.jsxs("span",{children:[" - ",Tt.diarista.telefone]}):null]})]},Tt.id))})]}):d.jsx("p",{className:"text-xs text-muted-foreground",children:"Nenhuma diaria cadastrada para este dia"})}),d.jsxs("div",{className:"mt-4 space-y-2",children:[d.jsx("p",{className:"text-sm font-medium",children:"Agendar ocupao"}),I.length===0?d.jsx("p",{className:"text-xs text-muted-foreground",children:"No h colaboradores em reserva tcnica disponveis."}):d.jsxs(d.Fragment,{children:[d.jsxs(Vr,{value:le[De.id]||"",onValueChange:Tt=>pe(Pt=>({...Pt,[De.id]:Tt})),children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Selecione o colaborador"})}),d.jsx(Lr,{className:"max-h-64",children:I.map(Tt=>d.jsxs(bt,{value:Tt.id,children:[Tt.nome_completo,"  ",Tt.cargo]},Tt.id))})]}),d.jsx(Bt,{className:"w-full",onClick:()=>qt(De),disabled:!le[De.id]||Ae===De.id,children:Ae===De.id?"Agendando...":"Agendar ocupao"})]})]})]})})})},De.id)),U.length>0&&d.jsxs("div",{className:"mt-6 pt-6 border-t",children:[d.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[d.jsx(Hd,{className:"h-5 w-5 text-blue-500"}),"Diaristas Disponveis (",U.length,")"]}),d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:U.map(De=>d.jsx(Sr,{className:"border-blue-200",children:d.jsx(tn,{className:"p-3",children:d.jsxs("div",{children:[d.jsx("h4",{className:"font-semibold text-sm mb-2",children:De.nome_completo}),d.jsxs("div",{className:"space-y-1",children:[d.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[d.jsx("span",{className:"text-muted-foreground",children:"Telefone:"}),d.jsx("span",{className:"font-medium",children:De.telefone})]}),d.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[d.jsx("span",{className:"text-muted-foreground",children:"Cidade:"}),d.jsx("span",{className:"font-medium",children:De.cidade||"No informada"})]})]}),d.jsx(Gn,{variant:"outline",className:"text-xs bg-blue-50 mt-2",children:"Diarista"})]})})},De.id))})]})]})})]})]})]})})}const hue=()=>{_u();const e=F.useRef(null),t=F.useRef(null),[i,l]=F.useState([]),[f,_]=F.useState(null),[x,o]=F.useState(!0),[A,I]=F.useState(""),[N,U]=F.useState(!1);F.useEffect(()=>{V(),$();const pe=Ge.channel("incidentes-changes").on("postgres_changes",{event:"*",schema:"public",table:"incidentes"},()=>{V()}).subscribe(),Ae=Ge.channel("chamados-changes").on("postgres_changes",{event:"*",schema:"public",table:"chamados"},()=>{V()}).subscribe(),Ze=Ge.channel("colaboradores-changes").on("postgres_changes",{event:"*",schema:"public",table:"colaboradores"},()=>{V()}).subscribe(),Xe=Ge.channel("postos-servico-changes").on("postgres_changes",{event:"*",schema:"public",table:"postos_servico"},()=>{V()}).subscribe();return()=>{Ge.removeChannel(pe),Ge.removeChannel(Ae),Ge.removeChannel(Ze),Ge.removeChannel(Xe)}},[]);const $=async()=>{try{const{data:pe,error:Ae}=await Ge.functions.invoke("get-mapbox-token");if(Ae)throw Ae;pe!=null&&pe.token?I(pe.token):In({title:"Token do Mapbox no configurado",description:"Configure o token MAPBOX_PUBLIC_TOKEN nos secrets do projeto",variant:"destructive"})}catch(pe){console.error("Erro ao buscar token do Mapbox:",pe),In({title:"Erro ao carregar token do Mapbox",description:"Usando formulrio manual",variant:"destructive"})}};F.useEffect(()=>{A&&i.length>0&&e.current&&!t.current&&Q()});const V=async()=>{try{const{data:pe,error:Ae}=await Ge.from("unidades").select(`
          id,
          nome,
          codigo,
          latitude,
          longitude,
          cidade,
          uf,
          status,
          contrato_id,
          contratos (
            nome,
            sla_alvo_pct
          )
        `).eq("status","ativo").not("latitude","is",null).not("longitude","is",null);if(Ae)throw Ae;const Ze=await Promise.all((pe||[]).map(async Xe=>{var xe,Be;const Je=await q(Xe.id),Te=await Y(Xe.id);return{id:Xe.id,nome:Xe.nome,codigo:Xe.codigo,latitude:Number(Xe.latitude),longitude:Number(Xe.longitude),cidade:Xe.cidade||"",uf:Xe.uf||"",contrato:{nome:((xe=Xe.contratos)==null?void 0:xe.nome)||"Sem contrato",sla_alvo_pct:Number(((Be=Xe.contratos)==null?void 0:Be.sla_alvo_pct)||95)},sla_atual:Je,postos_total:Te.total,postos_preenchidos:Te.preenchidos,postos_vagos:Te.vagos,porcentagem_preenchimento:Te.porcentagem}}));l(Ze)}catch(pe){In({title:"Erro ao carregar unidades",description:pe.message,variant:"destructive"})}finally{o(!1)}},Y=async pe=>{const{data:Ae}=await Ge.from("postos_servico").select("id, status").eq("unidade_id",pe).in("status",["vago","ocupado"]);if(!Ae)return{total:0,preenchidos:0,porcentagem:0};const Ze=Ae.length,Xe=Ae.filter(xe=>xe.status==="ocupado").length,Je=Ae.filter(xe=>xe.status==="vago").length,Te=Ze>0?Math.round(Xe/Ze*100):0;return{total:Ze,preenchidos:Xe,vagos:Je,porcentagem:Te}},q=async pe=>{const{data:Ae}=await Ge.from("ordens_servico").select("status").eq("unidade_id",pe);if(!Ae||Ae.length===0)return 100;const Ze=Ae.filter(Xe=>Xe.status==="concluida").length;return Math.round(Ze/Ae.length*100)},Z=pe=>pe===100?"#22c55e":pe>=70?"#eab308":"#ef4444",Q=()=>{e.current&&($u.accessToken=A,t.current=new $u.Map({container:e.current,style:"mapbox://styles/mapbox/light-v11",center:[-47.9292,-15.7801],zoom:4}),t.current.addControl(new $u.NavigationControl,"top-right"),i.forEach(pe=>{if(!t.current)return;const Ae=document.createElement("div");Ae.className="marker",Ae.style.backgroundColor=Z(pe.porcentagem_preenchimento),Ae.style.width="24px",Ae.style.height="24px",Ae.style.borderRadius="50%",Ae.style.border="3px solid white",Ae.style.cursor="pointer",Ae.style.boxShadow="0 2px 4px rgba(0,0,0,0.3)";const Ze=new $u.Marker(Ae).setLngLat([pe.longitude,pe.latitude]).addTo(t.current);Ae.addEventListener("click",()=>{_(pe)});const Xe=new $u.Popup({offset:25}).setHTML(`<div style="padding: 12px; min-width: 200px;">
          <h3 style="font-weight: bold; margin-bottom: 8px; font-size: 14px;">${pe.nome}</h3>
          <p style="font-size: 12px; color: #666; margin-bottom: 8px;">${pe.cidade}/${pe.uf}</p>
          <div style="border-top: 1px solid #e5e7eb; padding-top: 8px;">
            <p style="font-size: 12px; margin-bottom: 4px;">Meta de SLA: <strong>${pe.contrato.sla_alvo_pct}%</strong></p>
            <p style="font-size: 12px; margin-bottom: 4px;">Postos Preenchidos: <strong>${pe.postos_preenchidos}/${pe.postos_total}</strong></p>
            <p style="font-size: 12px;">Taxa de Ocupao: <strong style="color: ${pe.porcentagem_preenchimento>=90?"#22c55e":pe.porcentagem_preenchimento>=70?"#eab308":"#ef4444"};">${pe.porcentagem_preenchimento}%</strong></p>
          </div>
        </div>`);Ze.setPopup(Xe)}))},H=pe=>{pe.preventDefault();const Ze=new FormData(pe.currentTarget).get("token");Ze&&(I(Ze),In({title:"Token configurado",description:"Carregando mapa..."}))},K={total:i.length,slaVerde:i.filter(pe=>pe.sla_atual>=100).length,slaAmarelo:i.filter(pe=>pe.sla_atual>=90&&pe.sla_atual<100).length,slaVermelho:i.filter(pe=>pe.sla_atual<90).length},ne=i.reduce((pe,Ae)=>{const Ze=`${Ae.cidade}/${Ae.uf}`;return pe[Ze]||(pe[Ze]={cidade:Ae.cidade,uf:Ae.uf,postos_total:0,postos_preenchidos:0,postos_vagos:0,unidades_count:0}),pe[Ze].postos_total+=Ae.postos_total,pe[Ze].postos_preenchidos+=Ae.postos_preenchidos,pe[Ze].postos_vagos+=Ae.postos_vagos,pe[Ze].unidades_count+=1,pe},{}),le=Object.entries(ne).map(([pe,Ae])=>({cidadeUf:pe,...Ae,porcentagem_ocupacao:Ae.postos_total>0?Math.round(Ae.postos_preenchidos/Ae.postos_total*100):0})).sort((pe,Ae)=>Ae.porcentagem_ocupacao-pe.porcentagem_ocupacao);return x?d.jsx("div",{className:"flex items-center justify-center h-screen",children:d.jsxs("div",{className:"text-center",children:[d.jsx(LS,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),d.jsx("p",{className:"text-muted-foreground",children:"Carregando dados..."})]})}):A?d.jsxs(bo,{children:[d.jsxs("div",{className:"h-screen flex flex-col",children:[d.jsx("div",{className:"border-b bg-background p-4",children:d.jsxs("div",{className:"container mx-auto",children:[d.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-3xl font-bold",children:"Mesa de Operaes 24/7"}),d.jsx("p",{className:"text-muted-foreground",children:"Monitoramento em tempo real de todas as unidades"})]}),d.jsxs(Bt,{onClick:()=>U(!0),variant:"default",className:"gap-2",children:[d.jsx(d2,{className:"h-4 w-4"}),"Gesto de Cobertura"]})]}),d.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[d.jsx(Sr,{children:d.jsx(tn,{className:"p-4",children:d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(zf,{className:"h-4 w-4 text-primary"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-2xl font-bold",children:K.total}),d.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Unidades"})]})]})})}),d.jsx(Sr,{className:"border-green-500/50",children:d.jsx(tn,{className:"p-4",children:d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(iP,{className:"h-4 w-4 text-green-500"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-2xl font-bold text-green-500",children:K.slaVerde}),d.jsx("p",{className:"text-xs text-muted-foreground",children:"SLA 100%"})]})]})})}),d.jsx(Sr,{className:"border-yellow-500/50",children:d.jsx(tn,{className:"p-4",children:d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(LS,{className:"h-4 w-4 text-yellow-500"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-2xl font-bold text-yellow-500",children:K.slaAmarelo}),d.jsx("p",{className:"text-xs text-muted-foreground",children:"SLA 90-99%"})]})]})})}),d.jsx(Sr,{className:"border-red-500/50",children:d.jsx(tn,{className:"p-4",children:d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(H_,{className:"h-4 w-4 text-red-500"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-2xl font-bold text-red-500",children:K.slaVermelho}),d.jsx("p",{className:"text-xs text-muted-foreground",children:"SLA <90%"})]})]})})})]}),le.length>0&&d.jsxs("div",{className:"mt-4",children:[d.jsx("h3",{className:"text-sm font-semibold mb-3 text-muted-foreground uppercase",children:"Ocupao por Regio"}),d.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-3",children:le.map(pe=>d.jsx(Sr,{className:`transition-all hover:shadow-md ${pe.porcentagem_ocupacao===100?"border-green-500/50":pe.porcentagem_ocupacao>=70?"border-yellow-500/50":"border-red-500/50"}`,children:d.jsx(tn,{className:"p-4",children:d.jsxs("div",{className:"space-y-2",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(zf,{className:"h-3 w-3 text-muted-foreground"}),d.jsx("p",{className:"text-sm font-semibold truncate",children:pe.cidade})]}),d.jsxs("div",{children:[d.jsxs("p",{className:`text-2xl font-bold ${pe.porcentagem_ocupacao===100?"text-green-500":pe.porcentagem_ocupacao>=70?"text-yellow-500":"text-red-500"}`,children:[pe.porcentagem_ocupacao,"%"]}),d.jsxs("p",{className:"text-xs text-muted-foreground",children:[pe.postos_preenchidos,"/",pe.postos_total," ","postos"]}),d.jsxs("p",{className:"text-xs text-muted-foreground",children:["Vagos: ",pe.postos_vagos]})]}),d.jsxs(Gn,{variant:"outline",className:"text-xs",children:[pe.unidades_count," ",pe.unidades_count===1?"unidade":"unidades"]})]})})},pe.cidadeUf))})]})]})}),d.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[d.jsx("div",{className:"flex-[3] relative",children:d.jsx("div",{ref:e,className:"absolute inset-0"})}),f&&d.jsxs("div",{className:"w-80 border-l bg-background p-6 overflow-y-auto",children:[d.jsxs("div",{className:"flex items-start justify-between mb-4",children:[d.jsxs("div",{children:[d.jsx("h2",{className:"text-xl font-bold",children:f.nome}),d.jsx("p",{className:"text-sm text-muted-foreground",children:f.codigo})]}),d.jsx(Bt,{variant:"ghost",size:"sm",onClick:()=>_(null),children:""})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium mb-1",children:"Localizao"}),d.jsxs("p",{className:"text-sm text-muted-foreground",children:[f.cidade,"/",f.uf]})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium mb-1",children:"Contrato"}),d.jsx("p",{className:"text-sm text-muted-foreground",children:f.contrato.nome})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium mb-1",children:"Meta de SLA"}),d.jsxs("p",{className:"text-sm text-muted-foreground",children:[f.contrato.sla_alvo_pct,"%"]})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium mb-2",children:"Postos de Servio"}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("div",{className:"flex justify-between text-sm",children:[d.jsx("span",{className:"text-muted-foreground",children:"Preenchidos"}),d.jsxs("span",{className:"font-medium",children:[f.postos_preenchidos,"/",f.postos_total]})]}),d.jsxs("div",{className:"flex justify-between text-sm",children:[d.jsx("span",{className:"text-muted-foreground",children:"Vagos"}),d.jsx("span",{className:"font-medium",children:f.postos_vagos})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("div",{className:"flex-1 bg-secondary rounded-full h-2",children:d.jsx("div",{className:"h-2 rounded-full transition-all",style:{width:`${f.porcentagem_preenchimento}%`,backgroundColor:f.porcentagem_preenchimento>=90?"#22c55e":f.porcentagem_preenchimento>=70?"#eab308":"#ef4444"}})}),d.jsxs(Gn,{variant:f.porcentagem_preenchimento>=90?"default":f.porcentagem_preenchimento>=70?"secondary":"destructive",children:[f.porcentagem_preenchimento,"%"]})]})]})]})]})]})]})]}),d.jsx(due,{open:N,onClose:()=>U(!1)})]}):d.jsx(bo,{children:d.jsx("div",{className:"container mx-auto p-6",children:d.jsxs(Sr,{className:"max-w-md mx-auto mt-20",children:[d.jsx(wn,{children:d.jsx(An,{children:"Carregando Mapa"})}),d.jsxs(tn,{children:[d.jsxs("div",{className:"text-center py-8",children:[d.jsx(LS,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),d.jsx("p",{className:"text-sm text-muted-foreground",children:"Carregando token do Mapbox..."})]}),d.jsxs("div",{className:"mt-6 border-t pt-6",children:[d.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Ou insira manualmente seu token pblico do Mapbox:"}),d.jsxs("form",{onSubmit:H,className:"space-y-4",children:[d.jsx("input",{name:"token",type:"text",placeholder:"pk.eyJ1...",className:"w-full px-3 py-2 border rounded-md"}),d.jsx(Bt,{type:"submit",className:"w-full",children:"Usar Token Manual"})]})]})]})]})})})};function fue({os:e,open:t,onClose:i,onSuccess:l}){const[f,_]=F.useState(!1),[x,o]=F.useState({numero:"",titulo:"",descricao:"",tipo:"corretiva",prioridade:"media",status:"aberta",unidade_id:"",ativo_id:"",data_prevista:"",observacoes:""}),A=F.useRef(null),{data:I}=Ks({queryKey:["unidades"],queryFn:async()=>{const{data:V,error:Y}=await Ge.from("unidades").select("id, nome").eq("status","ativo").order("nome");if(Y)throw Y;return V}}),{data:N}=Ks({queryKey:["ativos",x.unidade_id],queryFn:async()=>{let V=Ge.from("ativos").select("id, tag_patrimonio, categoria, modelo, unidade_id").eq("status","operacional").order("tag_patrimonio");x.unidade_id&&(V=V.eq("unidade_id",x.unidade_id));const{data:Y,error:q}=await V;if(q)throw q;return Y}});F.useEffect(()=>{e?o({numero:e.numero||"",titulo:e.titulo||"",descricao:e.descricao||"",tipo:e.tipo||"corretiva",prioridade:e.prioridade||"media",status:e.status||"aberta",unidade_id:e.unidade_id||"",ativo_id:e.ativo_id||"",data_prevista:e.data_prevista||"",observacoes:e.observacoes||""}):U()},[e]),F.useEffect(()=>{if(A.current===null){A.current=x.unidade_id||null;return}A.current!==x.unidade_id&&(o(V=>({...V,ativo_id:""})),A.current=x.unidade_id||null)},[x.unidade_id]);const U=async()=>{const{data:V}=await Ge.from("ordens_servico").select("numero").order("created_at",{ascending:!1}).limit(1);let Y="OS-0001";if(V&&V.length>0){const q=parseInt(V[0].numero.split("-")[1]);Y=`OS-${String(q+1).padStart(4,"0")}`}o(q=>({...q,numero:Y}))},$=async V=>{V.preventDefault(),_(!0);try{const{data:{user:Y}}=await Ge.auth.getUser();if(!Y)throw new Error("Usuario nao autenticado");const q={...x,solicitante_id:(e==null?void 0:e.solicitante_id)||Y.id,data_prevista:x.data_prevista||null,ativo_id:x.ativo_id||null};if(e){const{error:Z}=await Ge.from("ordens_servico").update(q).eq("id",e.id);if(Z)throw Z;Yt.success("OS atualizada com sucesso")}else{const{error:Z}=await Ge.from("ordens_servico").insert(q);if(Z)throw Z;Yt.success("OS criada com sucesso")}l()}catch(Y){Yt.error("Erro ao salvar OS: "+Y.message)}finally{_(!1)}};return d.jsx(Vs,{open:t,onOpenChange:i,children:d.jsxs(Ms,{className:"max-w-3xl w-[95vw]",children:[d.jsx(Ns,{children:d.jsx(Ds,{children:e?"Editar Ordem de Servico":"Nova Ordem de Servico"})}),d.jsxs("form",{onSubmit:$,className:"flex flex-col gap-4",children:[d.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"numero",children:"Numero *"}),d.jsx(gr,{id:"numero",value:x.numero,onChange:V=>o({...x,numero:V.target.value}),required:!0,disabled:!0})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"tipo",children:"Tipo *"}),d.jsxs(Vr,{value:x.tipo,onValueChange:V=>o({...x,tipo:V}),children:[d.jsx(Or,{children:d.jsx(Ur,{})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"preventiva",children:"Preventiva"}),d.jsx(bt,{value:"corretiva",children:"Corretiva"}),d.jsx(bt,{value:"emergencial",children:"Emergencial"}),d.jsx(bt,{value:"melhoria",children:"Melhoria"})]})]})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"titulo",children:"Titulo *"}),d.jsx(gr,{id:"titulo",value:x.titulo,onChange:V=>o({...x,titulo:V.target.value}),required:!0})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"descricao",children:"Descricao"}),d.jsx(hu,{id:"descricao",value:x.descricao,onChange:V=>o({...x,descricao:V.target.value}),rows:3})]}),d.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"prioridade",children:"Prioridade *"}),d.jsxs(Vr,{value:x.prioridade,onValueChange:V=>o({...x,prioridade:V}),children:[d.jsx(Or,{children:d.jsx(Ur,{})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"baixa",children:"Baixa"}),d.jsx(bt,{value:"media",children:"Media"}),d.jsx(bt,{value:"alta",children:"Alta"}),d.jsx(bt,{value:"urgente",children:"Urgente"})]})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"status",children:"Status *"}),d.jsxs(Vr,{value:x.status,onValueChange:V=>o({...x,status:V}),children:[d.jsx(Or,{children:d.jsx(Ur,{})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"aberta",children:"Aberta"}),d.jsx(bt,{value:"em_andamento",children:"Em Andamento"}),d.jsx(bt,{value:"concluida",children:"Concluida"}),d.jsx(bt,{value:"cancelada",children:"Cancelada"})]})]})]})]}),d.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"unidade_id",children:"Unidade"}),d.jsxs(Vr,{value:x.unidade_id,onValueChange:V=>o({...x,unidade_id:V}),children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Selecione..."})}),d.jsx(Lr,{children:I==null?void 0:I.map(V=>d.jsx(bt,{value:V.id,children:V.nome},V.id))})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"ativo_id",children:"Ativo"}),d.jsxs(Vr,{value:x.ativo_id,onValueChange:V=>o({...x,ativo_id:V}),children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Selecione..."})}),d.jsx(Lr,{children:N==null?void 0:N.map(V=>d.jsxs(bt,{value:V.id,children:[V.tag_patrimonio," - ",V.categoria," ",V.modelo]},V.id))})]})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"data_prevista",children:"Data Prevista"}),d.jsx(gr,{id:"data_prevista",type:"date",value:x.data_prevista,onChange:V=>o({...x,data_prevista:V.target.value})})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"observacoes",children:"Observacoes"}),d.jsx(hu,{id:"observacoes",value:x.observacoes,onChange:V=>o({...x,observacoes:V.target.value}),rows:3})]}),d.jsxs("div",{className:"flex justify-end gap-2",children:[d.jsx(Bt,{type:"button",variant:"outline",onClick:i,children:"Cancelar"}),d.jsx(Bt,{type:"submit",disabled:f,children:f?"Salvando...":e?"Atualizar":"Criar"})]})]})]})})}function pue({osId:e}){const[t,i]=F.useState(!1),[l,f]=F.useState(null),[_,x]=F.useState(null),[o,A]=F.useState(""),I=F.useRef(null),{data:N,refetch:U}=Ks({queryKey:["os-anexos",e],queryFn:async()=>{const{data:K,error:ne}=await Ge.from("os_anexos").select("*").eq("os_id",e).order("created_at",{ascending:!1});if(ne)throw ne;return await Promise.all((K||[]).map(async pe=>{const{data:Ae}=await Ge.from("profiles").select("full_name").eq("id",pe.uploaded_by).single();return{...pe,uploader:Ae}}))}}),$=async K=>{var le;const ne=(le=K.target.files)==null?void 0:le[0];if(ne){i(!0);try{const{data:{user:pe}}=await Ge.auth.getUser();if(!pe)throw new Error("Usurio no autenticado");const Ae=ne.name.split(".").pop(),Ze=`${e}/${Date.now()}.${Ae}`,{error:Xe}=await Ge.storage.from("os-anexos").upload(Ze,ne);if(Xe)throw Xe;const{error:Je}=await Ge.from("os_anexos").insert({os_id:e,nome_arquivo:ne.name,caminho_storage:Ze,tamanho_bytes:ne.size,tipo_arquivo:ne.type,uploaded_by:pe.id});if(Je)throw Je;Yt.success("Arquivo enviado com sucesso"),U()}catch(pe){Yt.error("Erro ao enviar arquivo: "+pe.message)}finally{i(!1),I.current&&(I.current.value="")}}},V=async K=>{const{data:ne,error:le}=await Ge.storage.from("os-anexos").createSignedUrl(K,60);if(le||!(ne!=null&&ne.signedUrl))throw le||new Error("No foi possvel gerar o link");return ne.signedUrl},Y=async K=>{try{const ne=await V(K.caminho_storage),le=document.createElement("a");le.href=ne,le.download=K.nome_arquivo,le.target="_blank",document.body.appendChild(le),le.click(),document.body.removeChild(le),Yt.success("Download iniciado.")}catch(ne){Yt.error("Erro ao baixar arquivo: "+ne.message)}},q=async K=>{try{const ne=await V(K.caminho_storage);x(ne),A(K.nome_arquivo)}catch(ne){Yt.error("Erro ao visualizar arquivo: "+ne.message)}},Z=async()=>{if(l)try{const K=N==null?void 0:N.find(pe=>pe.id===l);if(!K)return;const{error:ne}=await Ge.storage.from("os-anexos").remove([K.caminho_storage]);if(ne)throw ne;const{error:le}=await Ge.from("os_anexos").delete().eq("id",l);if(le)throw le;Yt.success("Arquivo excludo com sucesso"),U()}catch(K){Yt.error("Erro ao excluir arquivo: "+K.message)}finally{f(null)}},Q=K=>K.startsWith("image/")?d.jsx(zZ,{className:"h-5 w-5"}):K.includes("pdf")?d.jsx(Zf,{className:"h-5 w-5"}):d.jsx(OZ,{className:"h-5 w-5"}),H=K=>K<1024?K+" B":K<1024*1024?(K/1024).toFixed(1)+" KB":(K/(1024*1024)).toFixed(1)+" MB";return d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{children:[d.jsx("input",{ref:I,type:"file",onChange:$,className:"hidden"}),d.jsxs(Bt,{onClick:()=>{var K;return(K=I.current)==null?void 0:K.click()},disabled:t,children:[d.jsx(JZ,{className:"mr-2 h-4 w-4"}),t?"Enviando...":"Adicionar Anexo"]})]}),N&&N.length>0?d.jsx("div",{className:"space-y-2",children:N.map(K=>{var ne;return d.jsx(Sr,{children:d.jsx(tn,{className:"p-4",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[Q(K.tipo_arquivo||""),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsx("p",{className:"font-medium truncate",children:K.nome_arquivo}),d.jsxs("p",{className:"text-sm text-muted-foreground",children:[H(K.tamanho_bytes||0),"  ",(ne=K.uploader)==null?void 0:ne.full_name," "," ",new Date(K.created_at).toLocaleDateString("pt-BR")]})]})]}),d.jsxs("div",{className:"flex gap-1",children:[d.jsx(Bt,{variant:"ghost",size:"icon",onClick:()=>Y(K),children:d.jsx(DZ,{className:"h-4 w-4"})}),d.jsx(Bt,{variant:"ghost",size:"icon",onClick:()=>q(K),children:d.jsx(h2,{className:"h-4 w-4"})}),d.jsx(Bt,{variant:"ghost",size:"icon",onClick:()=>f(K.id),children:d.jsx(jl,{className:"h-4 w-4 text-destructive"})})]})]})})},K.id)})}):d.jsx(Sr,{children:d.jsx(tn,{className:"py-8 text-center text-muted-foreground",children:"Nenhum anexo adicionado"})}),d.jsx(pu,{open:!!l,onOpenChange:()=>f(null),children:d.jsxs(bc,{children:[d.jsxs(wc,{children:[d.jsx(Tc,{children:"Confirmar excluso"}),d.jsx(Ec,{children:"Tem certeza que deseja excluir este arquivo? Esta ao no pode ser desfeita."})]}),d.jsxs(Sc,{children:[d.jsx(td,{children:"Cancelar"}),d.jsx(Cc,{onClick:Z,className:"bg-destructive text-destructive-foreground",children:"Excluir"})]})]})}),_&&d.jsx(pu,{open:!0,onOpenChange:()=>{x(null),A("")},children:d.jsxs(bc,{className:"max-w-3xl",children:[d.jsxs(wc,{children:[d.jsx(Tc,{children:o}),d.jsx(Ec,{children:"Visualizao do anexo. Para salvar, utilize o boto de download."})]}),d.jsx("div",{className:"max-h-[70vh] overflow-auto border rounded-md p-4 bg-muted",children:o.toLowerCase().match(/\.(png|jpg|jpeg|gif|webp)$/)?d.jsx("img",{src:_,alt:o,className:"max-w-full h-auto mx-auto"}):d.jsx("iframe",{src:_,className:"w-full h-[60vh]",title:"Preview"})}),d.jsx(Sc,{children:d.jsx(Cc,{onClick:()=>{_&&URL.revokeObjectURL(_),x(null),A("")},children:"Fechar"})})]})})]})}function mue({osId:e}){const{data:t,isLoading:i}=Ks({queryKey:["os-historico",e],queryFn:async()=>{const{data:x,error:o}=await Ge.from("os_historico").select("*").eq("os_id",e).order("created_at",{ascending:!1});if(o)throw o;return await Promise.all((x||[]).map(async I=>{const{data:N}=await Ge.from("profiles").select("full_name").eq("id",I.usuario_id).single();return{...I,usuario:N}}))}}),l=x=>new Date(x).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),f=x=>{switch(x){case"criacao":return"Criao";case"atualizacao":return"Atualizao";case"exclusao":return"Excluso";default:return x}},_=x=>{switch(x){case"status":return"Status";case"responsavel_id":return"Responsvel";case"prioridade":return"Prioridade";case"tipo":return"Tipo";default:return x}};return i?d.jsx(Sr,{children:d.jsx(tn,{className:"py-8 text-center text-muted-foreground",children:"Carregando histrico..."})}):!t||t.length===0?d.jsx(Sr,{children:d.jsx(tn,{className:"py-8 text-center text-muted-foreground",children:"Nenhuma alterao registrada"})}):d.jsx("div",{className:"space-y-4",children:t.map((x,o)=>{var A;return d.jsx(Sr,{children:d.jsx(tn,{className:"p-4",children:d.jsx("div",{className:"flex items-start gap-3",children:d.jsxs("div",{className:"flex-1 space-y-2",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(Gn,{variant:"outline",children:f(x.acao)}),x.campo_alterado&&d.jsx("span",{className:"text-sm text-muted-foreground",children:_(x.campo_alterado)})]}),x.campo_alterado&&d.jsxs("div",{className:"text-sm space-y-1",children:[x.valor_anterior&&d.jsxs("div",{children:[d.jsx("span",{className:"text-muted-foreground",children:"De: "}),d.jsx("span",{className:"line-through",children:x.valor_anterior})]}),x.valor_novo&&d.jsxs("div",{children:[d.jsx("span",{className:"text-muted-foreground",children:"Para: "}),d.jsx("span",{className:"font-medium",children:x.valor_novo})]})]}),x.observacao&&d.jsx("p",{className:"text-sm text-muted-foreground",children:x.observacao}),d.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground pt-2",children:[d.jsxs("div",{className:"flex items-center gap-1",children:[d.jsx(sb,{className:"h-3 w-3"}),d.jsx("span",{children:((A=x.usuario)==null?void 0:A.full_name)||"Sistema"})]}),d.jsxs("div",{className:"flex items-center gap-1",children:[d.jsx(Vy,{className:"h-3 w-3"}),d.jsx("span",{children:l(x.created_at)})]})]})]})})})},x.id)})})}function gue({os:e,open:t,onClose:i}){var _,x,o;const l=A=>new Date(A).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"}),f=A=>new Date(A).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return d.jsx(Vs,{open:t,onOpenChange:i,children:d.jsxs(Ms,{className:"max-w-4xl w-[95vw] max-h-[90vh] overflow-y-auto",children:[d.jsx(Ns,{children:d.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between",children:[d.jsxs(Ds,{children:["Ordem de Servio ",e.numero]}),d.jsxs("div",{className:"flex flex-wrap gap-2",children:[d.jsx(Gn,{children:e.tipo}),d.jsx(Gn,{children:e.prioridade}),d.jsx(Gn,{children:e.status.replace("_"," ")})]})]})}),d.jsxs(eR,{defaultValue:"detalhes",className:"w-full",children:[d.jsxs(z2,{className:"grid w-full grid-cols-1 sm:grid-cols-3",children:[d.jsxs($d,{value:"detalhes",children:[d.jsx(Zf,{className:"h-4 w-4 mr-2"}),"Detalhes"]}),d.jsxs($d,{value:"anexos",children:[d.jsx(rP,{className:"h-4 w-4 mr-2"}),"Anexos"]}),d.jsxs($d,{value:"historico",children:[d.jsx(G4,{className:"h-4 w-4 mr-2"}),"Histrico"]})]}),d.jsx(qd,{value:"detalhes",className:"space-y-4",children:d.jsxs(Sr,{children:[d.jsx(wn,{children:d.jsx(An,{className:"text-lg",children:"Informaes Gerais"})}),d.jsxs(tn,{className:"space-y-4",children:[d.jsxs("div",{children:[d.jsx("h4",{className:"font-semibold mb-1",children:e.titulo}),e.descricao&&d.jsx("p",{className:"text-sm text-muted-foreground",children:e.descricao})]}),d.jsx(Am,{}),d.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[((_=e.unidade)==null?void 0:_.nome)&&d.jsxs("div",{className:"flex items-start gap-2",children:[d.jsx(zf,{className:"h-4 w-4 text-muted-foreground mt-1"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium",children:"Unidade"}),d.jsx("p",{className:"text-sm text-muted-foreground",children:e.unidade.nome})]})]}),((x=e.responsavel)==null?void 0:x.full_name)&&d.jsxs("div",{className:"flex items-start gap-2",children:[d.jsx(sb,{className:"h-4 w-4 text-muted-foreground mt-1"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium",children:"Responsvel"}),d.jsx("p",{className:"text-sm text-muted-foreground",children:e.responsavel.full_name})]})]}),((o=e.solicitante)==null?void 0:o.full_name)&&d.jsxs("div",{className:"flex items-start gap-2",children:[d.jsx(sb,{className:"h-4 w-4 text-muted-foreground mt-1"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium",children:"Solicitante"}),d.jsx("p",{className:"text-sm text-muted-foreground",children:e.solicitante.full_name})]})]}),e.data_abertura&&d.jsxs("div",{className:"flex items-start gap-2",children:[d.jsx(Vy,{className:"h-4 w-4 text-muted-foreground mt-1"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium",children:"Data de Abertura"}),d.jsx("p",{className:"text-sm text-muted-foreground",children:f(e.data_abertura)})]})]}),e.data_prevista&&d.jsxs("div",{className:"flex items-start gap-2",children:[d.jsx(Al,{className:"h-4 w-4 text-muted-foreground mt-1"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium",children:"Data Prevista"}),d.jsx("p",{className:"text-sm text-muted-foreground",children:l(e.data_prevista)})]})]}),e.data_conclusao&&d.jsxs("div",{className:"flex items-start gap-2",children:[d.jsx(Al,{className:"h-4 w-4 text-muted-foreground mt-1"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium",children:"Data de Concluso"}),d.jsx("p",{className:"text-sm text-muted-foreground",children:f(e.data_conclusao)})]})]})]}),e.observacoes&&d.jsxs(d.Fragment,{children:[d.jsx(Am,{}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium mb-1",children:"Observaes"}),d.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:e.observacoes})]})]})]})]})}),d.jsx(qd,{value:"anexos",children:d.jsx(pue,{osId:e.id})}),d.jsx(qd,{value:"historico",children:d.jsx(mue,{osId:e.id})})]})]})})}function _ue({os:e,onEdit:t,onDelete:i,onConcluir:l,onAtribuir:f}){var q,Z;const[_,x]=F.useState(!1),[o,A]=F.useState(!1),[I,N]=F.useState(!1),U=Q=>{switch(Q){case"aberta":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-100";case"em_andamento":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100";case"concluida":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100";case"cancelada":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-100";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-100"}},$=Q=>{switch(Q){case"baixa":return"bg-gray-100 text-gray-800";case"media":return"bg-blue-100 text-blue-800";case"alta":return"bg-orange-100 text-orange-800";case"urgente":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},V=Q=>{switch(Q){case"preventiva":return"bg-green-100 text-green-800";case"corretiva":return"bg-yellow-100 text-yellow-800";case"emergencial":return"bg-red-100 text-red-800";case"melhoria":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},Y=Q=>new Date(Q).toLocaleDateString("pt-BR");return d.jsxs(d.Fragment,{children:[d.jsxs(Sr,{className:"hover:shadow-md transition-shadow",children:[d.jsx(wn,{className:"pb-3",children:d.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between",children:[d.jsxs("div",{className:"space-y-1 flex-1",children:[d.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[d.jsx("span",{className:"font-mono text-sm text-muted-foreground hidden sm:inline",children:e.numero}),d.jsx(Gn,{className:V(e.tipo),children:e.tipo}),d.jsx(Gn,{className:$(e.prioridade),children:e.prioridade}),d.jsx(Gn,{className:U(e.status),children:e.status.replace("_"," ")})]}),d.jsx("h3",{className:"text-lg font-semibold",children:e.titulo})]}),d.jsxs("div",{className:"flex flex-wrap gap-1",children:[d.jsx(Bt,{variant:"ghost",size:"icon",onClick:()=>x(!0),children:d.jsx(h2,{className:"h-4 w-4"})}),e.status!=="concluida"&&d.jsxs(d.Fragment,{children:[d.jsx(Bt,{variant:"ghost",size:"icon",onClick:()=>{window.confirm("Se atribuir como tecnico?")&&f(e.id)},className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:d.jsx(eX,{className:"h-4 w-4"})}),d.jsx(Bt,{variant:"ghost",size:"icon",onClick:()=>N(!0),className:"text-green-600 hover:text-green-700 hover:bg-green-50",children:d.jsx(Ib,{className:"h-4 w-4"})}),d.jsx(Bt,{variant:"ghost",size:"icon",onClick:()=>t(e),children:d.jsx(WZ,{className:"h-4 w-4"})})]}),d.jsx(Bt,{variant:"ghost",size:"icon",onClick:()=>A(!0),children:d.jsx(jl,{className:"h-4 w-4 text-destructive"})})]})]})}),d.jsx(tn,{children:d.jsxs("div",{className:"hidden sm:block",children:[e.descricao&&d.jsx("p",{className:"text-sm text-muted-foreground mb-3 line-clamp-2",children:e.descricao}),d.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[((q=e.unidade)==null?void 0:q.nome)&&d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(zf,{className:"h-4 w-4 text-muted-foreground"}),d.jsx("span",{className:"truncate",children:e.unidade.nome})]}),((Z=e.responsavel)==null?void 0:Z.full_name)&&d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(sb,{className:"h-4 w-4 text-muted-foreground"}),d.jsx("span",{className:"truncate",children:e.responsavel.full_name})]}),e.data_abertura&&d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(Vy,{className:"h-4 w-4 text-muted-foreground"}),d.jsx("span",{children:Y(e.data_abertura)})]}),e.data_prevista&&d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(Al,{className:"h-4 w-4 text-muted-foreground"}),d.jsx("span",{children:Y(e.data_prevista)})]})]})]})})]}),_&&d.jsx(gue,{os:e,open:_,onClose:()=>x(!1)}),d.jsx(pu,{open:o,onOpenChange:A,children:d.jsxs(bc,{children:[d.jsxs(wc,{children:[d.jsx(Tc,{children:"Confirmar exclusao"}),d.jsxs(Ec,{children:["Tem certeza que deseja excluir a OS ",e.numero,"? Esta acao nao pode ser desfeita."]})]}),d.jsxs(Sc,{children:[d.jsx(td,{children:"Cancelar"}),d.jsx(Cc,{onClick:()=>i(e.id),className:"bg-destructive text-destructive-foreground",children:"Excluir"})]})]})}),d.jsx(pu,{open:I,onOpenChange:N,children:d.jsxs(bc,{children:[d.jsxs(wc,{children:[d.jsx(Tc,{children:"Concluir Ordem de Servico"}),d.jsxs(Ec,{children:["Tem certeza que deseja concluir a OS ",e.numero,"? Esta acao marcara a ordem como concluida."]})]}),d.jsxs(Sc,{children:[d.jsx(td,{children:"Cancelar"}),d.jsx(Cc,{onClick:()=>l(e.id),className:"bg-green-600 hover:bg-green-700",children:"Concluir"})]})]})})]})}function yue(){const[e,t]=F.useState(""),[i,l]=F.useState("ativas"),[f,_]=F.useState("all"),[x,o]=F.useState("all"),[A,I]=F.useState(!1),[N,U]=F.useState(null),{data:$,isLoading:V,refetch:Y}=Ks({queryKey:["ordens-servico",i,f,x],queryFn:async()=>{let le=Ge.from("ordens_servico").select(`
          *,
          unidade:unidades(nome),
          solicitante:profiles!ordens_servico_solicitante_id_fkey(full_name),
          responsavel:profiles!ordens_servico_responsavel_id_fkey(full_name)
        `).order("created_at",{ascending:!1});i==="ativas"?le=le.neq("status","concluida"):i!=="all"&&(le=le.eq("status",i)),f!=="all"&&(le=le.eq("prioridade",f)),x!=="all"&&(le=le.eq("tipo",x));const{data:pe,error:Ae}=await le;if(Ae)throw Ae;return pe}}),q=$==null?void 0:$.filter(le=>{var pe;return le.numero.toLowerCase().includes(e.toLowerCase())||le.titulo.toLowerCase().includes(e.toLowerCase())||((pe=le.descricao)==null?void 0:pe.toLowerCase().includes(e.toLowerCase()))}),Z={total:($==null?void 0:$.length)||0,abertas:($==null?void 0:$.filter(le=>le.status==="aberta").length)||0,emAndamento:($==null?void 0:$.filter(le=>le.status==="em_andamento").length)||0,concluidas:($==null?void 0:$.filter(le=>le.status==="concluida").length)||0},Q=le=>{U(le),I(!0)},H=async le=>{try{const{error:pe}=await Ge.from("ordens_servico").delete().eq("id",le);if(pe)throw pe;Yt.success("OS excluida com sucesso"),Y()}catch(pe){Yt.error("Erro ao excluir OS: "+pe.message)}},K=async le=>{try{const{error:pe}=await Ge.from("ordens_servico").update({status:"concluida",data_conclusao:new Date().toISOString()}).eq("id",le);if(pe)throw pe;Yt.success("OS concluida com sucesso"),Y()}catch(pe){Yt.error("Erro ao concluir OS: "+pe.message)}},ne=async le=>{try{const{data:{user:pe}}=await Ge.auth.getUser();if(!pe)throw new Error("Usuario nao autenticado");const{error:Ae}=await Ge.from("ordens_servico").update({responsavel_id:pe.id}).eq("id",le);if(Ae)throw Ae;Yt.success("Atribuido como responsavel da OS"),Y()}catch(pe){Yt.error("Erro ao atribuir responsavel: "+pe.message)}};return d.jsx(bo,{children:d.jsx("div",{className:"min-h-screen bg-background p-8",children:d.jsxs("div",{className:"flex flex-col gap-6",children:[d.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-2xl font-bold",children:"Ordens de Servico"}),d.jsx("p",{className:"text-muted-foreground",children:"Gerencie as ordens de servico em aberto e concluidas."})]}),d.jsxs(Bt,{onClick:()=>I(!0),className:"self-start md:self-auto",children:[d.jsx(Ea,{className:"mr-2 h-4 w-4"}),"Nova OS"]})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[d.jsxs(Sr,{children:[d.jsxs(wn,{className:"pb-2",children:[d.jsx(fs,{children:"Total"}),d.jsx(An,{className:"text-3xl",children:Z.total})]}),d.jsx(tn,{children:d.jsx(Gn,{variant:"secondary",children:"Todas"})})]}),d.jsxs(Sr,{children:[d.jsxs(wn,{className:"pb-2",children:[d.jsx(fs,{children:"Abertas"}),d.jsx(An,{className:"text-3xl text-yellow-600",children:Z.abertas})]}),d.jsx(tn,{children:d.jsx($4,{className:"h-4 w-4 text-yellow-600"})})]}),d.jsxs(Sr,{children:[d.jsxs(wn,{className:"pb-2",children:[d.jsx(fs,{children:"Em Andamento"}),d.jsx(An,{className:"text-3xl text-blue-600",children:Z.emAndamento})]}),d.jsx(tn,{children:d.jsx(d2,{className:"h-4 w-4 text-blue-600"})})]}),d.jsxs(Sr,{children:[d.jsxs(wn,{className:"pb-2",children:[d.jsx(fs,{children:"Concluidas"}),d.jsx(An,{className:"text-3xl text-green-600",children:Z.concluidas})]}),d.jsx(tn,{children:d.jsx(Ib,{className:"h-4 w-4 text-green-600"})})]})]}),d.jsx(Sr,{children:d.jsx(tn,{className:"pt-6",children:d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[d.jsxs("div",{className:"relative",children:[d.jsx(ou,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),d.jsx(gr,{placeholder:"Buscar por numero, titulo...",value:e,onChange:le=>t(le.target.value),className:"pl-9"})]}),d.jsxs(Vr,{value:i,onValueChange:l,children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Status"})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"ativas",children:"Ativas (Abertas e Em Andamento)"}),d.jsx(bt,{value:"all",children:"Todos os Status"}),d.jsx(bt,{value:"aberta",children:"Aberta"}),d.jsx(bt,{value:"em_andamento",children:"Em Andamento"}),d.jsx(bt,{value:"concluida",children:"Concluida"}),d.jsx(bt,{value:"cancelada",children:"Cancelada"})]})]}),d.jsxs(Vr,{value:f,onValueChange:_,children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Prioridade"})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"all",children:"Todas as Prioridades"}),d.jsx(bt,{value:"baixa",children:"Baixa"}),d.jsx(bt,{value:"media",children:"Media"}),d.jsx(bt,{value:"alta",children:"Alta"}),d.jsx(bt,{value:"urgente",children:"Urgente"})]})]}),d.jsxs(Vr,{value:x,onValueChange:o,children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Tipo"})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"all",children:"Todos os Tipos"}),d.jsx(bt,{value:"preventiva",children:"Preventiva"}),d.jsx(bt,{value:"corretiva",children:"Corretiva"}),d.jsx(bt,{value:"emergencial",children:"Emergencial"}),d.jsx(bt,{value:"melhoria",children:"Melhoria"})]})]})]})})}),d.jsxs(eR,{defaultValue:"lista",className:"w-full",children:[d.jsx(z2,{children:d.jsx($d,{value:"lista",children:"Lista"})}),d.jsx(qd,{value:"lista",className:"space-y-4 pt-4",children:V?d.jsx("div",{className:"text-center py-12",children:d.jsx("p",{className:"text-muted-foreground",children:"Carregando ordens de servico..."})}):q&&q.length>0?d.jsx("div",{className:"grid gap-4",children:q.map(le=>d.jsx(_ue,{os:le,onEdit:Q,onDelete:H,onConcluir:K,onAtribuir:ne},le.id))}):d.jsx(Sr,{children:d.jsxs(tn,{className:"py-12 text-center",children:[d.jsx(Zf,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),d.jsx("p",{className:"text-muted-foreground",children:"Nenhuma ordem de servico encontrada"}),d.jsxs(Bt,{onClick:()=>I(!0),className:"mt-4",children:[d.jsx(Ea,{className:"mr-2 h-4 w-4"}),"Criar primeira OS"]})]})})})]}),A&&d.jsx(fue,{os:N,open:A,onClose:()=>{I(!1),U(null)},onSuccess:()=>{I(!1),U(null),Y()}})]})})})}function vue({colaborador:e,open:t,onClose:i,onSuccess:l}){const[f,_]=F.useState(!1),[x,o]=F.useState({nome_completo:"",cpf:"",telefone:"",email:"",data_admissao:"",data_desligamento:"",cargo:"",status_colaborador:"ativo",observacoes:""});F.useEffect(()=>{e&&o({nome_completo:e.nome_completo||"",cpf:e.cpf||"",telefone:e.telefone||"",email:e.email||"",data_admissao:e.data_admissao||"",data_desligamento:e.data_desligamento||"",cargo:e.cargo||"",status_colaborador:e.status_colaborador||"ativo",observacoes:e.observacoes||""})},[e]);const A=async I=>{I.preventDefault(),_(!0);try{const N={...x,cargo:x.cargo||null,data_desligamento:x.status_colaborador==="inativo"&&x.data_desligamento||null};if(e){const{error:U}=await Ge.from("colaboradores").update(N).eq("id",e.id);if(U)throw U;Yt.success("Colaborador atualizado com sucesso")}else{const{error:U}=await Ge.from("colaboradores").insert(N);if(U)throw U;Yt.success("Colaborador cadastrado com sucesso")}l()}catch(N){Yt.error("Erro ao salvar colaborador: "+N.message)}finally{_(!1)}};return d.jsx(Vs,{open:t,onOpenChange:i,children:d.jsxs(Ms,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[d.jsx(Ns,{children:d.jsx(Ds,{children:e?"Editar Colaborador":"Novo Colaborador"})}),d.jsxs("form",{onSubmit:A,className:"space-y-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"nome_completo",children:"Nome Completo *"}),d.jsx(gr,{id:"nome_completo",value:x.nome_completo,onChange:I=>o({...x,nome_completo:I.target.value}),required:!0})]}),d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"cpf",children:"CPF *"}),d.jsx(gr,{id:"cpf",value:x.cpf,onChange:I=>o({...x,cpf:I.target.value}),placeholder:"000.000.000-00",required:!0})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"telefone",children:"Telefone"}),d.jsx(gr,{id:"telefone",value:x.telefone,onChange:I=>o({...x,telefone:I.target.value}),placeholder:"(00) 00000-0000"})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"email",children:"Email"}),d.jsx(gr,{id:"email",type:"email",value:x.email,onChange:I=>o({...x,email:I.target.value})})]}),d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"data_admissao",children:"Data de Admisso"}),d.jsx(gr,{id:"data_admissao",type:"date",value:x.data_admissao,onChange:I=>o({...x,data_admissao:I.target.value})})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"status_colaborador",children:"Status *"}),d.jsxs(Vr,{value:x.status_colaborador,onValueChange:I=>o({...x,status_colaborador:I}),children:[d.jsx(Or,{children:d.jsx(Ur,{})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"ativo",children:"Ativo"}),d.jsx(bt,{value:"inativo",children:"Inativo"})]})]})]})]}),x.status_colaborador==="inativo"&&d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"data_desligamento",children:"Data de Desligamento"}),d.jsx(gr,{id:"data_desligamento",type:"date",value:x.data_desligamento,onChange:I=>o({...x,data_desligamento:I.target.value})})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"cargo",children:"Cargo"}),d.jsx(gr,{id:"cargo",value:x.cargo,onChange:I=>o({...x,cargo:I.target.value}),placeholder:"Ex: Vigilante, Supervisor, etc."})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"observacoes",children:"Observaes"}),d.jsx(hu,{id:"observacoes",value:x.observacoes,onChange:I=>o({...x,observacoes:I.target.value}),rows:3})]}),d.jsxs("div",{className:"flex justify-end gap-2",children:[d.jsx(Bt,{type:"button",variant:"outline",onClick:i,children:"Cancelar"}),d.jsx(Bt,{type:"submit",disabled:f,children:f?"Salvando...":e?"Atualizar":"Cadastrar"})]})]})]})})}function xue({open:e,onClose:t,missingEntities:i}){return d.jsx(pu,{open:e,onOpenChange:t,children:d.jsxs(bc,{children:[d.jsxs(wc,{children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(Cm,{className:"h-5 w-5 text-destructive"}),d.jsx(Tc,{children:"Requisitos No Atendidos"})]}),d.jsxs(Ec,{className:"space-y-3",children:[d.jsx("p",{children:"Para cadastrar um colaborador,  necessrio ter pelo menos uma instncia cadastrada de cada uma das seguintes entidades:"}),d.jsxs("div",{className:"bg-muted p-3 rounded-md",children:[d.jsx("p",{className:"font-medium mb-2",children:"Entidades faltantes:"}),d.jsx("ul",{className:"list-disc list-inside space-y-1",children:i.map(l=>d.jsx("li",{className:"text-sm",children:l},l))})]}),d.jsx("p",{className:"text-sm",children:"Por favor, cadastre as entidades necessrias antes de adicionar colaboradores."})]})]}),d.jsx(Sc,{children:d.jsx(Cc,{onClick:t,children:"Entendi"})})]})})}function bue({colaborador:e,open:t,onClose:i,onSuccess:l}){const[f,_]=F.useState(!1),[x,o]=F.useState((e==null?void 0:e.escala_id)||""),{data:A,isLoading:I}=Ks({queryKey:["escalas"],queryFn:async()=>{const{data:U,error:$}=await Ge.from("escalas").select("id, nome, tipo, descricao").order("nome");if($)throw $;return U}}),N=async U=>{if(U.preventDefault(),!x){Yt.error("Selecione uma escala");return}_(!0);try{const{error:$}=await Ge.from("colaboradores").update({escala_id:x}).eq("id",e.id);if($)throw $;Yt.success("Escala atribuda com sucesso"),l()}catch($){Yt.error("Erro ao atribuir escala: "+$.message)}finally{_(!1)}};return d.jsx(Vs,{open:t,onOpenChange:i,children:d.jsxs(Ms,{className:"max-w-md",children:[d.jsxs(Ns,{children:[d.jsxs(Ds,{className:"flex items-center gap-2",children:[d.jsx(Al,{className:"h-5 w-5"}),"Atribuir Escala"]}),d.jsxs(Qa,{children:["Atribuir escala ao colaborador ",d.jsx("strong",{children:e==null?void 0:e.nome_completo})]})]}),I?d.jsx("div",{className:"text-center py-8",children:d.jsx("p",{className:"text-muted-foreground",children:"Carregando escalas..."})}):!A||A.length===0?d.jsxs("div",{className:"text-center py-8 space-y-4",children:[d.jsx("p",{className:"text-muted-foreground",children:"Nenhuma escala cadastrada. Crie uma escala primeiro no mdulo de Escalas."}),d.jsx(Bt,{variant:"outline",onClick:i,children:"Fechar"})]}):d.jsxs("form",{onSubmit:N,className:"space-y-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"escala",children:"Escala *"}),d.jsxs(Vr,{value:x,onValueChange:o,children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Selecione uma escala..."})}),d.jsx(Lr,{children:A.map(U=>d.jsxs(bt,{value:U.id,children:[U.nome," - ",U.tipo,U.descricao&&` (${U.descricao})`]},U.id))})]})]}),d.jsxs("div",{className:"flex justify-end gap-2",children:[d.jsx(Bt,{type:"button",variant:"outline",onClick:i,children:"Cancelar"}),d.jsx(Bt,{type:"submit",disabled:f,children:f?"Atribuindo...":"Atribuir Escala"})]})]})]})})}const wue=e=>{try{return new Date(`${e}T00:00:00`).toLocaleDateString("pt-BR")}catch{return e}};function Sue({colaborador:e,open:t,onClose:i,onSuccess:l}){const[f,_]=F.useState(!1),[x,o]=F.useState((e==null?void 0:e.unidade_id)||""),[A,I]=F.useState((e==null?void 0:e.posto_servico_id)||""),{data:N,isLoading:U}=Ks({queryKey:["unidades-ativas"],queryFn:async()=>{const{data:Y,error:q}=await Ge.from("unidades").select("id, nome, codigo").eq("status","ativo").order("nome");if(q)throw q;return Y}}),{data:$}=Ks({queryKey:["postos-unidade",x],queryFn:async()=>{if(!x)return[];const{data:Y,error:q}=await Ge.from("postos_servico").select("id, nome, codigo, status, ultimo_dia_atividade").eq("unidade_id",x).order("nome");if(q)throw q;return Y},enabled:!!x}),V=async Y=>{if(Y.preventDefault(),!x){Yt.error("Selecione uma unidade");return}_(!0);try{if((e==null?void 0:e.posto_servico_id)&&e.posto_servico_id!==A){const{error:Q}=await Ge.from("colaboradores").update({posto_servico_id:null}).eq("id",e.id);if(Q)throw Q}const{error:Z}=await Ge.from("colaboradores").update({unidade_id:x,posto_servico_id:A||null}).eq("id",e.id);if(Z)throw Z;Yt.success("Unidade atribuida com sucesso"),l(),i()}catch(q){const Z=typeof(q==null?void 0:q.message)=="string"?q.message:"Erro ao atribuir unidade. Tente novamente.",Q=Z.includes('status" is of type status_posto')||Z.includes("status_posto")?"Erro ao atribuir unidade: o status do posto deve usar valores do enum (vago, ocupado, vago_temporariamente, ocupado_temporariamente, presenca_confirmada ou inativo).":Z;Yt.error(Q)}finally{_(!1)}};return d.jsx(Vs,{open:t,onOpenChange:i,children:d.jsxs(Ms,{children:[d.jsx(Ns,{children:d.jsxs(Ds,{children:["Atribuir Unidade - ",e==null?void 0:e.nome_completo]})}),d.jsxs("form",{onSubmit:V,className:"space-y-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"unidade",children:"Unidade *"}),U?d.jsx("p",{className:"text-sm text-muted-foreground",children:"Carregando unidades..."}):!N||N.length===0?d.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhuma unidade ativa encontrada. Cadastre unidades primeiro."}):d.jsxs(Vr,{value:x,onValueChange:Y=>{o(Y),I("")},children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Selecione uma unidade..."})}),d.jsx(Lr,{children:N.map(Y=>d.jsxs(bt,{value:Y.id,children:[Y.codigo," - ",Y.nome]},Y.id))})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"posto",children:"Posto de Servio (Opcional)"}),d.jsxs(Vr,{value:A,onValueChange:I,disabled:!x,children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:x?"Selecione um posto...":"Selecione uma unidade primeiro..."})}),d.jsx(Lr,{children:$==null?void 0:$.map(Y=>{const q=Y.status?`(${Y.status.replaceAll("_"," ")})`:"",Z=Y.status==="inativo",Q=Y.ultimo_dia_atividade?wue(Y.ultimo_dia_atividade):null,H=Q?Z?`Encerrado em ${Q}`:`Ultimo dia planejado: ${Q}`:null;return d.jsxs(bt,{value:Y.id,disabled:Z,className:"flex flex-col",children:[d.jsxs("span",{children:[Y.codigo," - ",Y.nome," ",q]}),H&&d.jsxs("span",{className:"text-xs text-muted-foreground",children:[H,Z?"  selecione outro posto":""]})]},Y.id)})})]})]}),d.jsxs("div",{className:"flex justify-end gap-2",children:[d.jsx(Bt,{type:"button",variant:"outline",onClick:i,children:"Cancelar"}),d.jsx(Bt,{type:"submit",disabled:f||!x,children:f?"Atribuindo...":"Atribuir"})]})]})]})})}function Tue({colaborador:e,open:t,onClose:i}){var H;const[l,f]=F.useState(new Date),[_,x]=F.useState([]),[o,A]=F.useState(!1),[I,N]=F.useState(null);F.useEffect(()=>{t&&(f(new Date),N(null))},[t,e==null?void 0:e.id]),F.useEffect(()=>{if(!t||!(e!=null&&e.id))return;(async()=>{try{A(!0);const ne=Ca(l),le=Oy(l),{data:pe,error:Ae}=await Ge.from("presencas").select("*").eq("colaborador_id",e.id).gte("data",Kn(ne,"yyyy-MM-dd")).lte("data",Kn(le,"yyyy-MM-dd")).order("data",{ascending:!0});if(Ae)throw Ae;x(pe||[])}catch(ne){console.error("Erro ao carregar presenas:",ne)}finally{A(!1)}})()},[t,e==null?void 0:e.id,l]);const U=F.useMemo(()=>{const K=Ca(l),ne=Oy(l),le=fu(K,{weekStartsOn:0}),pe=D2(ne,{weekStartsOn:0});return Gse({start:le,end:pe})},[l]),$=F.useMemo(()=>{const K=new Map;return _.forEach(ne=>{K.set(ne.data,ne)}),K},[_]),V=["Dom","Seg","Ter","Qua","Qui","Sex","Sb"],Y=(K,ne)=>{if(!K)return wr("border border-dashed bg-muted/30",ne?"text-muted-foreground":"text-muted-foreground/50 opacity-60");const le=ne?"":"opacity-60";return wr(K==="presente"?"border border-emerald-200 bg-emerald-50 text-emerald-700":K==="falta"||K==="falta_justificada"?"border border-red-200 bg-red-50 text-red-700":K==="folga"?"border border-slate-200 bg-slate-50 text-slate-700":K==="ferias"?"border border-amber-200 bg-amber-50 text-amber-700":K==="atestado"?"border border-sky-200 bg-sky-50 text-sky-700":"border bg-muted/40 text-muted-foreground",le)},q=(K,ne)=>{ne&&(ne.tipo==="falta"||ne.tipo==="falta_justificada")&&N({date:Kn(new Date(K),"dd 'de' MMMM",{locale:js}),tipo:ne.tipo,observacao:ne.observacao})},Z=()=>{f(K=>Xl(K,-1)),N(null)},Q=()=>{f(K=>Xl(K,1)),N(null)};return d.jsx(Vs,{open:t,onOpenChange:i,children:d.jsxs(Ms,{className:"max-w-3xl",children:[d.jsxs(Ns,{children:[d.jsx(Ds,{children:"Calendrio de Presenas"}),d.jsx("p",{className:"text-sm text-muted-foreground",children:e==null?void 0:e.nome_completo})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx(Bt,{variant:"ghost",size:"icon",onClick:Z,disabled:o,children:d.jsx(B4,{className:"h-4 w-4"})}),d.jsx("div",{className:"text-lg font-semibold",children:Kn(l,"MMMM 'de' yyyy",{locale:js})}),d.jsx(Bt,{variant:"ghost",size:"icon",onClick:Q,disabled:o,children:d.jsx(V4,{className:"h-4 w-4"})})]}),o?d.jsx("div",{className:"flex items-center justify-center py-16",children:d.jsx(nd,{className:"h-6 w-6 animate-spin text-primary"})}):d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"grid grid-cols-7 gap-2 text-center text-xs font-medium text-muted-foreground",children:V.map(K=>d.jsx("div",{children:K},K))}),d.jsx("div",{className:"grid grid-cols-7 gap-2",children:U.map(K=>{const ne=Kn(K,"yyyy-MM-dd"),le=$.get(ne),pe=le&&(le.tipo==="falta"||le.tipo==="falta_justificada"),Ae=O2(K,l);return d.jsxs("button",{type:"button",onClick:()=>q(ne,le),className:wr("flex min-h-[68px] flex-col items-center justify-center rounded-md border p-2 text-xs transition-colors",Y(le==null?void 0:le.tipo,Ae),pe?"cursor-pointer hover:border-red-400":"cursor-default"),children:[d.jsx("span",{className:"text-sm font-semibold",children:K.getDate()}),le?d.jsx("span",{className:"mt-1 text-[11px] capitalize",children:le.tipo.replace("_"," ")}):d.jsx("span",{className:"mt-1 text-[11px] text-muted-foreground/70",children:"--"})]},ne)})})]}),d.jsxs("div",{className:"flex flex-wrap gap-4 text-xs text-muted-foreground",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"h-3 w-3 rounded bg-emerald-200"})," Presente"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"h-3 w-3 rounded bg-red-200"})," Falta / Falta justificada"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"h-3 w-3 rounded bg-amber-200"})," Frias"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"h-3 w-3 rounded bg-slate-200"})," Folga"]})]}),I&&d.jsxs("div",{className:"rounded-md border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:[d.jsxs("div",{className:"font-semibold",children:[I.tipo==="falta_justificada"?"Falta justificada":"Falta"," em"," ",I.date]}),d.jsx("p",{className:"mt-1 text-red-600",children:(H=I.observacao)!=null&&H.trim()?I.observacao:"Motivo no informado"})]})]})]})})}const Eue=[{value:"presente",label:"Presente"},{value:"falta",label:"Falta"},{value:"falta_justificada",label:"Falta Justificada"},{value:"ferias",label:"Frias"},{value:"atestado",label:"Atestado"},{value:"folga",label:"Folga"}];function Cue({colaborador:e,open:t,onClose:i,onSuccess:l}){const[f,_]=F.useState(!1),[x,o]=F.useState({data:new Date().toISOString().split("T")[0],tipo:"presente",horario_entrada:"",horario_saida:"",observacao:""});F.useEffect(()=>{t&&o({data:new Date().toISOString().split("T")[0],tipo:"presente",horario_entrada:"",horario_saida:"",observacao:""})},[t,e==null?void 0:e.id]);const A=async N=>{var U;if(N.preventDefault(),!!e){_(!0);try{const{data:{user:$}}=await Ge.auth.getUser();if(!$)throw new Error("Usurio no autenticado");const V={colaborador_id:e.id,data:x.data,tipo:x.tipo,horario_entrada:x.horario_entrada?new Date(`${x.data}T${x.horario_entrada}`).toISOString():null,horario_saida:x.horario_saida?new Date(`${x.data}T${x.horario_saida}`).toISOString():null,observacao:x.observacao||null,registrado_por:$.id},{error:Y}=await Ge.from("presencas").insert(V);if(Y)throw Y;Yt.success("Presena registrada com sucesso"),l(),i()}catch($){(U=$==null?void 0:$.message)!=null&&U.includes("duplicate key")?Yt.error("J existe um registro de presena para este colaborador nesta data."):Yt.error(($==null?void 0:$.message)||"Erro ao registrar presena.")}finally{_(!1)}}},I=(N,U)=>{o($=>({...$,[N]:U}))};return d.jsx(Vs,{open:t,onOpenChange:i,children:d.jsxs(Ms,{className:"max-w-md",children:[d.jsxs(Ns,{children:[d.jsx(Ds,{children:"Registrar Presena"}),d.jsx("p",{className:"text-sm text-muted-foreground",children:e==null?void 0:e.nome_completo})]}),d.jsxs("form",{onSubmit:A,className:"space-y-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"data",children:"Data *"}),d.jsx(gr,{id:"data",type:"date",value:x.data,onChange:N=>I("data",N.target.value),required:!0})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"tipo",children:"Tipo *"}),d.jsxs(Vr,{value:x.tipo,onValueChange:N=>I("tipo",N),children:[d.jsx(Or,{id:"tipo",children:d.jsx(Ur,{})}),d.jsx(Lr,{children:Eue.map(N=>d.jsx(bt,{value:N.value,children:N.label},N.value))})]})]}),x.tipo==="presente"&&d.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"horario_entrada",children:"Horrio Entrada"}),d.jsx(gr,{id:"horario_entrada",type:"time",value:x.horario_entrada,onChange:N=>I("horario_entrada",N.target.value)})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"horario_saida",children:"Horrio Sada"}),d.jsx(gr,{id:"horario_saida",type:"time",value:x.horario_saida,onChange:N=>I("horario_saida",N.target.value)})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"observacao",children:"Observao"}),d.jsx(hu,{id:"observacao",value:x.observacao,onChange:N=>I("observacao",N.target.value),rows:3,placeholder:"Informaes adicionais..."})]}),d.jsxs("div",{className:"flex justify-end gap-2",children:[d.jsx(Bt,{type:"button",variant:"outline",onClick:i,children:"Cancelar"}),d.jsx(Bt,{type:"submit",disabled:f,children:f?"Registrando...":"Registrar"})]})]})]})})}const b8={vago:"Vago",ocupado:"Ocupado",vago_temporariamente:"Vago temporariamente",ocupado_temporariamente:"Ocupado temporariamente",presenca_confirmada:"Presenca confirmada",ocupacao_agendada:"Ocupacao agendada",inativo:"Inativo"},Aue={vago:"secondary",ocupado:"default",vago_temporariamente:"outline",ocupado_temporariamente:"outline",presenca_confirmada:"default",ocupacao_agendada:"outline",inativo:"outline"},QA={ativo:"Ativo",inativo:"Inativo"},jue={ativo:"default",inativo:"secondary"},IF=e=>new Date(`${e}T00:00:00`),Iue=["falta justificada","falta injustificada","afastamento INSS","frias","suspenso","Posto vago"],kue=e=>{switch(e==null?void 0:e.replace(/_/g," ").trim().toLowerCase()){case"falta justificada":return"falta justificada";case"falta injustificada":return"falta injustificada";case"afastamento inss":return"afastamento INSS";case"f?rias":case"ferias":return"f?rias";case"suspens?o":case"suspensao":return"suspens?o";case"posto vago":return"Posto vago";default:return e==null?void 0:e.replace(/_/g," ").trim()}},Pue=e=>e?e==="ativo"?"Ocupado":b8[e]||e:"Sem status",Rue=e=>e?e==="ativo"?"default":Aue[e]||"outline":"outline";function Mue(){var Kt,jr,yr,br,Fr,On,pi,Ri,$s,ws,Lo,ho,rr;const e=Xf(),[t,i]=F.useState(""),[l,f]=F.useState("all"),[_,x]=F.useState("all"),[o,A]=F.useState("all"),[I,N]=F.useState("all"),[U,$]=F.useState(!1),[V,Y]=F.useState(null),[q,Z]=F.useState(!1),[Q,H]=F.useState([]),[K,ne]=F.useState(null),[le,pe]=F.useState(null),[Ae,Ze]=F.useState(null),[Xe,Je]=F.useState(null),[Te,xe]=F.useState(null),[Be,dt]=F.useState(null),[qt,Ke]=F.useState({}),[st,Ne]=F.useState(null),[De,Tt]=F.useState({data:"",postoDestino:""}),[Pt,fe]=F.useState(!1),[Le,vt]=F.useState([]),{data:Wt,refetch:Ft}=Ks({queryKey:["colaboradores",l,I,_,o],queryFn:async()=>{let yt=Ge.from("colaboradores").select(`

          *,

          unidade:unidades(id, nome, contratos(id, nome, codigo)),

          escala:escalas(nome, tipo),

          posto:postos_servico(

            id,

            nome,

            codigo,

            status,
            ultimo_dia_atividade,

            unidade:unidades(id, nome, contratos(id, nome, codigo))

          )

        `).order("nome_completo");l!=="all"&&(yt=yt.eq("status_colaborador",l)),I!=="all"&&(yt=yt.eq("unidade_id",I)),_==="alocado"?yt=yt.not("posto_servico_id","is",null):_==="nao_alocado"&&(yt=yt.is("posto_servico_id",null)),o!=="all"&&(yt=yt.eq("cargo",o));const{data:Ar,error:Qr}=await yt;if(Qr)throw Qr;return Ar}}),{data:Ut}=Ks({queryKey:["unidades"],queryFn:async()=>{const{data:yt,error:Ar}=await Ge.from("unidades").select("id, nome").eq("status","ativo").order("nome");if(Ar)throw Ar;return yt}}),{data:vr=[]}=Ks({queryKey:["postos-disponiveis-agendamento"],queryFn:async()=>{const{data:yt,error:Ar}=await Ge.from("postos_servico").select("id, nome, codigo, status").eq("status","vago").order("nome");if(Ar)throw Ar;return yt}});F.useEffect(()=>{const yt=async Ar=>{try{const Qr=Kn(new Date,"yyyy-MM-dd"),{data:Cn,error:Mi}=await Ge.from("dias_trabalho").select("data").eq("posto_servico_id",Ar).is("colaborador_id",null).gte("data",Qr).order("data");if(Mi)throw Mi;const li=(Cn==null?void 0:Cn.map(Os=>Os.data))??[];vt(li),Tt(Os=>({...Os,data:li[0]??""}))}catch(Qr){Yt.error(Qr.message||"Erro ao carregar dias disponveis para o posto."),vt([]),Tt(Cn=>({...Cn,data:""}))}};(st==null?void 0:st.tipo)==="vincular"&&De.postoDestino?yt(De.postoDestino):(st==null?void 0:st.tipo)==="vincular"&&(vt([]),Tt(Ar=>({...Ar,data:""})))},[st==null?void 0:st.tipo,De.postoDestino]);const xr=Wt==null?void 0:Wt.filter(yt=>{var Ar,Qr;return yt.nome_completo.toLowerCase().includes(t.toLowerCase())||((Ar=yt.cpf)==null?void 0:Ar.includes(t))||((Qr=yt.email)==null?void 0:Qr.toLowerCase().includes(t.toLowerCase()))}),zr=Array.from(new Set(["ativo","inativo"].concat((Wt??[]).map(yt=>yt.status_colaborador).filter(yt=>!!yt)))),Hr=Array.from(new Set((Wt??[]).map(yt=>yt.cargo).filter(yt=>!!yt))),jn=(xr==null?void 0:xr.length)??0,hn=yt=>{window.confirm(`Deseja editar o colaborador ${yt.nome_completo}?`)&&(Y(yt),$(!0))},Ji=async yt=>{if(window.confirm("Tem certeza que deseja excluir este colaborador?"))try{const{error:Ar}=await Ge.from("colaboradores").delete().eq("id",yt);if(Ar)throw Ar;Yt.success("Colaborador excludo com sucesso"),Ft()}catch(Ar){Yt.error(Ar.message||"Erro ao excluir colaborador")}},Ii=async yt=>{if(window.confirm("Deseja realmente desvincular o colaborador do posto atual?"))try{const{error:Ar}=await Ge.from("colaboradores").update({posto_servico_id:null}).eq("id",yt.id);if(Ar)throw Ar;Yt.success("Posto de servio desvinculado com sucesso"),Ft()}catch(Ar){Yt.error(Ar.message||"Erro ao desvincular posto de servio")}},Vi=()=>{if(!window.confirm("Deseja cadastrar um novo colaborador?"))return;const yt=[];if((!Ut||Ut.length===0)&&yt.push("Unidades"),yt.length>0){H(yt),Z(!0);return}$(!0)},As=async yt=>{if(!yt.posto_servico_id){Yt.error("Colaborador nao esta vinculado a um posto no momento.");return}try{const{data:Ar,error:Qr}=await Ge.from("dias_trabalho").select("id, data, status, motivo_vago").eq("posto_servico_id",yt.posto_servico_id).order("data");if(Qr)throw Qr;xe({colaborador:yt,postoId:yt.posto_servico_id,dias:Ar||[]})}catch(Ar){Yt.error(Ar.message||"Erro ao carregar escala do colaborador")}},bi=async yt=>{try{const{error:Ar}=await Ge.rpc("confirmar_presenca",{p_dia_trabalho_id:yt,p_novo_status:"presenca_confirmada"});if(Ar)throw Ar;xe(Qr=>Qr&&{...Qr,dias:Qr.dias.map(Cn=>Cn.id===yt?{...Cn,status:"presenca_confirmada"}:Cn)}),Yt.success("Presena confirmada com sucesso.")}catch(Ar){Yt.error(Ar.message||"Erro ao confirmar presena.")}},Is=(yt,Ar)=>{Ne({tipo:yt,colaborador:Ar}),Tt({data:"",postoDestino:""}),vt([])},nt=async yt=>{if(yt.preventDefault(),!!st){if(!De.data){Yt.error("Selecione uma data para o agendamento.");return}if(st.tipo==="vincular"&&!De.postoDestino){Yt.error("Selecione o posto de destino para a vinculao.");return}if(st.tipo==="vincular"&&(!De.data||!Le.includes(De.data))){Yt.error("Selecione uma data disponvel para o posto escolhido.");return}fe(!0);try{const{data:{user:Ar}}=await Ge.auth.getUser();if(!Ar)throw new Error("Usurio no autenticado");const Qr={colaborador_id:st.colaborador.id,status:"agendado",created_by:Ar.id,posto_servico_id_origem:st.colaborador.posto_servico_id};st.tipo==="desvincular"?Qr.data_desvinculacao=De.data:(Qr.data_vinculacao=De.data,Qr.posto_servico_id_destino=De.postoDestino,await dR({postoId:De.postoDestino,colaboradorId:st.colaborador.id,data:De.data,usuarioId:Ar.id}));const{error:Cn}=await Ge.from("colaborador_movimentacoes_posto").insert([Qr]);if(Cn)throw Cn;await Promise.all([Ft(),e.invalidateQueries({queryKey:["colaboradores"]}),e.invalidateQueries({queryKey:["postos-disponiveis-agendamento"]})]),Yt.success(st.tipo==="desvincular"?"Desvinculao agendada com sucesso.":"Vinculao agendada com sucesso."),Ne(null),Tt({data:"",postoDestino:""})}catch(Ar){Yt.error(Ar.message||"Erro ao agendar movimentao.")}finally{fe(!1)}}},Ct=async yt=>{if(!(Te!=null&&Te.postoId)){Yt.error("Nao foi possivel identificar o posto para atualizar o dia.");return}const Ar=qt[yt];if(!Ar){Yt.error("Selecione um motivo para marcar o dia como vago.");return}try{const{error:Qr}=await Ge.from("dias_trabalho").update({status:"vago",motivo_vago:kue(Ar)}).eq("posto_servico_id",Te.postoId).eq("data",yt);if(Qr)throw Qr;xe(Cn=>Cn&&{...Cn,dias:Cn.dias.map(Mi=>Mi.data===yt?{...Mi,status:"vago",motivo_vago:Ar}:Mi)}),Yt.success("Dia marcado como vago.")}catch(Qr){Yt.error(Qr.message||"Erro ao marcar dia vago.")}};return d.jsx(bo,{children:d.jsxs("div",{className:"space-y-6 p-4 md:p-6",children:[d.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-3xl font-bold",children:"Colaboradores"}),d.jsx("p",{className:"text-sm text-muted-foreground",children:"Gerencie cadastros, alocacoes e presencas dos colaboradores."})]}),d.jsxs(Bt,{onClick:Vi,className:"w-full md:w-auto",children:[d.jsx(Ea,{className:"mr-2 h-4 w-4"}),"Novo colaborador"]})]}),d.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[d.jsxs("div",{className:"space-y-2 md:col-span-2",children:[d.jsx(Gt,{htmlFor:"search-colaboradores",children:"Buscar"}),d.jsxs("div",{className:"relative",children:[d.jsx(ou,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),d.jsx(gr,{id:"search-colaboradores",placeholder:"Nome, CPF ou email",value:t,onChange:yt=>i(yt.target.value),className:"pl-9"})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Status"}),d.jsxs(Vr,{value:l,onValueChange:f,children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Todos"})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"all",children:"Todos"}),zr.map(yt=>d.jsx(bt,{value:yt,children:QA[yt]||yt},yt))]})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Alocao"}),d.jsxs(Vr,{value:_,onValueChange:x,children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Todos"})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"all",children:"Todos"}),d.jsx(bt,{value:"alocado",children:"Alocados"}),d.jsx(bt,{value:"nao_alocado",children:"No alocados"})]})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Cargo"}),d.jsxs(Vr,{value:o,onValueChange:A,children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Todos"})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"all",children:"Todos"}),Hr.map(yt=>d.jsx(bt,{value:yt,children:yt},yt))]})]})]}),d.jsxs("div",{className:"space-y-2 lg:col-span-2",children:[d.jsx(Gt,{children:"Unidade"}),d.jsxs(Vr,{value:I,onValueChange:N,children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Todas"})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"all",children:"Todas"}),Ut==null?void 0:Ut.map(yt=>d.jsx(bt,{value:yt.id,children:yt.nome},yt.id))]})]})]})]}),d.jsxs("div",{className:"rounded-md border bg-card",children:[d.jsx("div",{className:"flex flex-wrap items-center justify-between gap-3 border-b p-4",children:d.jsxs("div",{children:[d.jsxs("p",{className:"text-sm font-semibold",children:[jn," ",jn===1?"colaborador":"colaboradores"]}),d.jsx("p",{className:"text-xs text-muted-foreground",children:xr&&jn!==(Wt==null?void 0:Wt.length)?"Exibindo resultados com filtros aplicados":"Exibindo todos os colaboradores disponveis"})]})}),d.jsxs(Jl,{children:[d.jsx(Ql,{children:d.jsxs(Yi,{children:[d.jsx(Yr,{children:"Colaborador"}),d.jsx(Yr,{children:"Posto"}),d.jsx(Yr,{className:"w-[360px]",children:"Aes"})]})}),d.jsx(ec,{children:xr!=null&&xr.length?xr.map(yt=>{var Ar;return d.jsxs(Yi,{className:"cursor-pointer",role:"button",tabIndex:0,onClick:()=>dt(yt),onKeyDown:Qr=>{(Qr.key==="Enter"||Qr.key===" ")&&(Qr.preventDefault(),dt(yt))},children:[d.jsx(Pr,{className:"align-top",children:d.jsxs("div",{className:"space-y-2 rounded-md border border-transparent p-2 transition group-hover:border-muted",children:[d.jsx("p",{className:"font-semibold leading-tight",children:yt.nome_completo}),yt.status_colaborador&&d.jsx(Gn,{variant:jue[yt.status_colaborador]||"outline",className:"capitalize",children:QA[yt.status_colaborador]||yt.status_colaborador})]})}),d.jsx(Pr,{className:"align-top",children:yt.posto?d.jsxs("div",{className:"space-y-1 text-sm",children:[d.jsx("p",{className:"font-medium",children:yt.posto.codigo?`${yt.posto.codigo} - ${yt.posto.nome}`:yt.posto.nome}),((Ar=yt.posto.unidade)==null?void 0:Ar.nome)&&d.jsxs("p",{className:"text-xs text-muted-foreground",children:["Unidade: ",yt.posto.unidade.nome]}),yt.posto.ultimo_dia_atividade&&d.jsxs("p",{className:"text-xs text-muted-foreground",children:["ltimo dia: ",Kn(IF(yt.posto.ultimo_dia_atividade),"dd/MM/yyyy",{locale:js})]})]}):d.jsx("p",{className:"text-sm text-muted-foreground",children:"Sem posto associado"})}),d.jsx(Pr,{className:"align-top",children:d.jsxs("div",{className:"flex flex-wrap gap-1",children:[d.jsxs(Bt,{variant:"ghost",size:"icon",onClick:Qr=>{Qr.stopPropagation(),dt(yt)},title:"Ver detalhes",children:[d.jsx(FZ,{className:"h-4 w-4"}),d.jsx("span",{className:"sr-only",children:"Ver detalhes"})]}),!yt.posto_servico_id&&d.jsxs(Bt,{variant:"ghost",size:"icon",onClick:Qr=>{Qr.stopPropagation(),pe(yt)},title:"Atribuir unidade",children:[d.jsx(zf,{className:"h-4 w-4"}),d.jsx("span",{className:"sr-only",children:"Atribuir unidade"})]}),!yt.posto_servico_id&&d.jsxs(Bt,{variant:"ghost",size:"icon",onClick:Qr=>{Qr.stopPropagation(),Is("vincular",yt)},title:"Agendar ocupao",children:[d.jsx(MZ,{className:"h-4 w-4"}),d.jsx("span",{className:"sr-only",children:"Agendar ocupao"})]}),yt.posto_servico_id&&d.jsxs(Bt,{variant:"ghost",size:"icon",onClick:Qr=>{Qr.stopPropagation(),Ii(yt)},title:"Desvincular do posto",children:[d.jsx(YZ,{className:"h-4 w-4"}),d.jsx("span",{className:"sr-only",children:"Desvincular do posto"})]}),d.jsxs(Bt,{variant:"ghost",size:"icon",onClick:Qr=>{Qr.stopPropagation(),As(yt)},disabled:!yt.posto_servico_id,title:"Visualizar escala prevista",children:[d.jsx(Al,{className:"h-4 w-4"}),d.jsx("span",{className:"sr-only",children:"Visualizar escala prevista"})]}),d.jsxs(Bt,{variant:"ghost",size:"icon",onClick:Qr=>{Qr.stopPropagation(),Ze(yt)},title:"Histrico de presena",children:[d.jsx(G4,{className:"h-4 w-4"}),d.jsx("span",{className:"sr-only",children:"Histrico de presena"})]}),d.jsxs(Bt,{variant:"ghost",size:"icon",onClick:Qr=>{Qr.stopPropagation(),hn(yt)},title:"Editar colaborador",children:[d.jsx(gu,{className:"h-4 w-4"}),d.jsx("span",{className:"sr-only",children:"Editar colaborador"})]}),d.jsxs(pu,{children:[d.jsx(Vb,{asChild:!0,children:d.jsxs(Bt,{variant:"ghost",size:"icon",title:"Excluir colaborador",onClick:Qr=>Qr.stopPropagation(),children:[d.jsx(jl,{className:"h-4 w-4 text-destructive"}),d.jsx("span",{className:"sr-only",children:"Excluir colaborador"})]})}),d.jsxs(bc,{children:[d.jsxs(wc,{children:[d.jsx(Tc,{children:"Confirmar excluso"}),d.jsx(Ec,{children:"Tem certeza que deseja excluir este colaborador?"})]}),d.jsxs(Sc,{children:[d.jsx(td,{children:"Cancelar"}),d.jsx(Cc,{onClick:()=>Ji(yt.id),children:"Excluir"})]})]})]})]})})]},yt.id)}):d.jsx(Yi,{children:d.jsx(Pr,{colSpan:5,className:"py-10 text-center text-sm text-muted-foreground",children:"Nenhum colaborador encontrado com os filtros selecionados."})})})]})]}),U&&d.jsx(vue,{open:U,onClose:()=>{$(!1),Y(null)},colaborador:V,onSuccess:()=>{$(!1),Y(null),Ft()}}),q&&d.jsx(xue,{open:q,onClose:()=>Z(!1),missingEntities:Q}),K&&d.jsx(bue,{open:!!K,onClose:()=>ne(null),colaborador:K,onSuccess:Ft}),le&&d.jsx(Sue,{open:!!le,onClose:()=>pe(null),colaborador:le,onSuccess:Ft}),Ae&&d.jsx(Tue,{open:!!Ae,onClose:()=>Ze(null),colaborador:Ae}),Xe&&d.jsx(Cue,{open:!!Xe,colaborador:Xe,onClose:()=>Je(null),onSuccess:Ft}),st&&d.jsx(Vs,{open:!!st,onOpenChange:yt=>{yt||Ne(null)},children:d.jsxs(Ms,{children:[d.jsxs(Ns,{children:[d.jsx(Ds,{children:st.tipo==="desvincular"?"Agendar desvinculao":"Agendar vinculao"}),d.jsx(Qa,{children:st.colaborador.nome_completo})]}),d.jsxs("form",{className:"space-y-4",onSubmit:nt,children:[st.tipo==="vincular"?d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Posto de destino"}),d.jsxs(Vr,{value:De.postoDestino,onValueChange:yt=>Tt(Ar=>({...Ar,postoDestino:yt,data:""})),children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Selecione o posto"})}),d.jsx(Lr,{className:"max-h-72 overflow-y-auto",children:vr.length===0?d.jsx(bt,{value:"none",disabled:!0,children:"Nenhum posto vago disponvel"}):vr.map(yt=>d.jsx(bt,{value:yt.id,children:yt.codigo?`${yt.codigo} - ${yt.nome}`:yt.nome},yt.id))})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Data disponvel"}),d.jsxs(Vr,{value:De.data,onValueChange:yt=>Tt(Ar=>({...Ar,data:yt})),disabled:Le.length===0,children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:Le.length===0?"Selecione um posto para listar as datas":"Selecione a data"})}),d.jsx(Lr,{className:"max-h-72 overflow-y-auto",children:Le.map(yt=>d.jsx(bt,{value:yt,children:Kn(new Date(`${yt}T00:00:00`),"dd/MM/yyyy",{locale:js})},yt))})]}),De.postoDestino&&Le.length===0&&d.jsx("p",{className:"text-xs text-muted-foreground",children:"Nenhuma data disponvel para o posto selecionado."})]})]}):d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Data"}),d.jsx(gr,{type:"date",value:De.data,min:new Date().toISOString().split("T")[0],onChange:yt=>Tt(Ar=>({...Ar,data:yt.target.value})),required:!0})]}),d.jsxs("div",{className:"flex justify-end gap-2",children:[d.jsx(Bt,{type:"button",variant:"outline",onClick:()=>Ne(null),children:"Cancelar"}),d.jsx(Bt,{type:"submit",disabled:Pt||(st==null?void 0:st.tipo)==="vincular"&&!De.data,children:Pt?"Salvando...":"Confirmar agendamento"})]})]})]})}),d.jsx(Vs,{open:!!Te,onOpenChange:yt=>{yt||xe(null)},children:d.jsxs(Ms,{children:[d.jsxs(Ns,{children:[d.jsxs(Ds,{children:["Escala prevista - ",(Kt=Te==null?void 0:Te.colaborador)==null?void 0:Kt.nome_completo]}),d.jsx(Qa,{children:"Dias cadastrados na tabela de dias de trabalho para este colaborador."})]}),Te?Te.dias.length>0?d.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:Te.dias.map(yt=>d.jsxs("div",{className:"flex items-center justify-between rounded-md border px-3 py-2 text-sm",children:[d.jsx("span",{children:Kn(IF(yt.data),"dd/MM/yyyy",{locale:js})}),d.jsxs("div",{className:"flex flex-col items-end gap-2",children:[yt.status&&d.jsx(Gn,{variant:Rue(yt.status),className:"capitalize",children:Pue(yt.status)}),yt.motivo_vago&&d.jsxs("span",{className:"text-xs text-muted-foreground",children:["Motivo: ",yt.motivo_vago]}),d.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[d.jsxs(Vr,{value:qt[yt.data]||"",onValueChange:Ar=>Ke(Qr=>({...Qr,[yt.data]:Ar})),children:[d.jsx(Or,{className:"w-[160px]",children:d.jsx(Ur,{placeholder:"Motivo"})}),d.jsx(Lr,{children:Iue.map(Ar=>d.jsx(bt,{value:Ar,children:Ar},Ar))})]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx(Bt,{size:"sm",variant:"outline",onClick:()=>Ct(yt.data),children:"Marcar vago"}),yt.status!=="presenca_confirmada"&&d.jsx(Bt,{size:"sm",onClick:()=>bi(yt.id),children:"Confirmar presena"})]})]})]})]},yt.id||`${Te.colaborador.id}-${yt.data}`))}):d.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum dia de trabalho encontrado para este colaborador."}):null]})}),d.jsx(Vs,{open:!!Be,onOpenChange:yt=>{yt||dt(null)},children:d.jsxs(Ms,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[d.jsxs(Ns,{children:[d.jsx(Ds,{children:(Be==null?void 0:Be.nome_completo)||"Colaborador"}),d.jsx(Qa,{children:"Informaes completas do colaborador"})]}),Be&&d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-xs text-muted-foreground",children:"Email"}),d.jsx("p",{className:"font-medium",children:Be.email||"-"})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-xs text-muted-foreground",children:"Telefone"}),d.jsx("p",{className:"font-medium",children:Be.telefone||"-"})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-xs text-muted-foreground",children:"Status"}),d.jsx("p",{className:"font-medium",children:QA[Be.status_colaborador||""]||Be.status_colaborador||"-"})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-xs text-muted-foreground",children:"Cargo"}),d.jsx("p",{className:"font-medium",children:Be.cargo||"-"})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-xs text-muted-foreground",children:"Tipo / Escala"}),d.jsx("p",{className:"font-medium",children:(jr=Be.escala)!=null&&jr.tipo?Be.escala.tipo:"efetivo"})]})]}),d.jsxs("div",{className:"rounded-md border p-4 space-y-2",children:[d.jsx("p",{className:"font-semibold",children:"Alocao"}),Be.posto_servico_id?d.jsxs("div",{className:"space-y-1 text-sm",children:[d.jsxs("p",{children:[d.jsx("span",{className:"font-medium",children:"Posto: "}),(yr=Be.posto)!=null&&yr.codigo?`${Be.posto.codigo} - ${Be.posto.nome}`:((br=Be.posto)==null?void 0:br.nome)||"-"]}),d.jsxs("p",{children:[d.jsx("span",{className:"font-medium",children:"Status do Posto: "}),b8[((Fr=Be.posto)==null?void 0:Fr.status)||"vago"]||"vago"]}),d.jsxs("p",{children:[d.jsx("span",{className:"font-medium",children:"Unidade: "}),((pi=(On=Be.posto)==null?void 0:On.unidade)==null?void 0:pi.nome)||((Ri=Be.unidade)==null?void 0:Ri.nome)||"-"]}),d.jsxs("p",{children:[d.jsx("span",{className:"font-medium",children:"Contrato: "}),((Lo=(ws=($s=Be.posto)==null?void 0:$s.unidade)==null?void 0:ws.contratos)==null?void 0:Lo.nome)||((rr=(ho=Be.unidade)==null?void 0:ho.contratos)==null?void 0:rr.nome)||"-"]})]}):d.jsx("p",{className:"text-sm text-muted-foreground",children:"No alocado a um posto de servio."})]})]})]})})]})})}function Nue({escala:e,open:t,onClose:i,onSuccess:l}){const[f,_]=F.useState(!1),[x,o]=F.useState({nome:"",tipo:"fixa",descricao:"",dias_trabalhados:"",dias_folga:""});F.useEffect(()=>{var I,N;e&&o({nome:e.nome||"",tipo:e.tipo||"fixa",descricao:e.descricao||"",dias_trabalhados:((I=e.dias_trabalhados)==null?void 0:I.toString())||"",dias_folga:((N=e.dias_folga)==null?void 0:N.toString())||""})},[e]);const A=async I=>{I.preventDefault(),_(!0);try{const N={nome:x.nome,tipo:x.tipo,descricao:x.descricao||null,dias_trabalhados:x.dias_trabalhados?parseInt(x.dias_trabalhados):null,dias_folga:x.dias_folga?parseInt(x.dias_folga):null};if(e){const{error:U}=await Ge.from("escalas").update(N).eq("id",e.id);if(U)throw U;Yt.success("Escala atualizada com sucesso")}else{const{error:U}=await Ge.from("escalas").insert(N);if(U)throw U;Yt.success("Escala cadastrada com sucesso")}l()}catch(N){Yt.error("Erro ao salvar escala: "+N.message)}finally{_(!1)}};return d.jsx(Vs,{open:t,onOpenChange:i,children:d.jsxs(Ms,{className:"max-w-md",children:[d.jsx(Ns,{children:d.jsx(Ds,{children:e?"Editar Escala Modelo":"Nova Escala Modelo"})}),d.jsxs("form",{onSubmit:A,className:"space-y-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"nome",children:"Nome *"}),d.jsx(gr,{id:"nome",value:x.nome,onChange:I=>o({...x,nome:I.target.value}),placeholder:"Ex: 12x36, 5x2",required:!0})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"tipo",children:"Tipo *"}),d.jsxs(Vr,{value:x.tipo,onValueChange:I=>o({...x,tipo:I}),children:[d.jsx(Or,{children:d.jsx(Ur,{})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"fixa",children:"Fixa"}),d.jsx(bt,{value:"alternada",children:"Alternada"}),d.jsx(bt,{value:"flexivel",children:"Flexvel"}),d.jsx(bt,{value:"plantao",children:"Planto"})]})]})]}),d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"dias_trabalhados",children:"Dias Trabalhados"}),d.jsx(gr,{id:"dias_trabalhados",type:"number",min:"1",value:x.dias_trabalhados,onChange:I=>o({...x,dias_trabalhados:I.target.value}),placeholder:"Ex: 12"})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"dias_folga",children:"Dias de Folga"}),d.jsx(gr,{id:"dias_folga",type:"number",min:"1",value:x.dias_folga,onChange:I=>o({...x,dias_folga:I.target.value}),placeholder:"Ex: 36"})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"descricao",children:"Descrio"}),d.jsx(hu,{id:"descricao",value:x.descricao,onChange:I=>o({...x,descricao:I.target.value}),rows:3,placeholder:"Descreva os detalhes da escala..."})]}),d.jsxs("div",{className:"flex justify-end gap-2",children:[d.jsx(Bt,{type:"button",variant:"outline",onClick:i,children:"Cancelar"}),d.jsx(Bt,{type:"submit",disabled:f,children:f?"Salvando...":e?"Atualizar":"Cadastrar"})]})]})]})})}function Due(){const[e,t]=F.useState(!1),[i,l]=F.useState(null),{data:f,isLoading:_,refetch:x}=Ks({queryKey:["escalas-detalhes"],queryFn:async()=>{const{data:I,error:N}=await Ge.from("postos_servico").select(`
          id,
          nome,
          codigo,
          escala,
          turno,
          jornada,
          horario_inicio,
          horario_fim,
          de,
          ate,
          dias_semana,
          unidade:unidades(nome, codigo)
        `).eq("status","ativo").order("escala");if(N)throw N;const U=new Map;return I==null||I.forEach($=>{if($.escala){U.has($.escala)||U.set($.escala,{escala:$.escala,turno:$.turno,jornada:$.jornada,horario_inicio:$.horario_inicio,horario_fim:$.horario_fim,dias_semana:$.dias_semana,postos:[]});const V=U.get($.escala);!V.turno&&$.turno&&(V.turno=$.turno),V.jornada==null&&$.jornada!=null&&(V.jornada=$.jornada),!V.horario_inicio&&$.horario_inicio&&(V.horario_inicio=$.horario_inicio),!V.horario_fim&&$.horario_fim&&(V.horario_fim=$.horario_fim),V.postos.push({id:$.id,nome:$.nome,codigo:$.codigo,unidade:$.unidade})}}),Array.from(U.values())}}),{data:o}=Ks({queryKey:["escalas-modelo"],queryFn:async()=>{const{data:I,error:N}=await Ge.from("escalas").select("*").order("nome");if(N)throw N;return I}}),A=async I=>{try{const{error:N}=await Ge.from("escalas").delete().eq("id",I);if(N)throw N;Yt.success("Escala excluda com sucesso"),x()}catch(N){Yt.error("Erro ao excluir escala: "+N.message)}};return d.jsxs(bo,{children:[d.jsx("div",{className:"min-h-screen bg-background p-8",children:d.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-4xl font-bold text-foreground",children:"Escalas"}),d.jsx("p",{className:"text-muted-foreground mt-2",children:"Gesto de escalas e turnos de trabalho"})]}),d.jsxs(Bt,{onClick:()=>{l(null),t(!0)},children:[d.jsx(Ea,{className:"mr-2 h-4 w-4"}),"Nova Escala Modelo"]})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsx("h2",{className:"text-2xl font-semibold",children:"Escalas em Uso"}),_?d.jsx("div",{className:"text-center py-12",children:d.jsx("p",{className:"text-muted-foreground",children:"Carregando escalas..."})}):f&&f.length>0?d.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:f.map((I,N)=>{const U=!!I.turno&&(I.escala||"").toLowerCase()!=="12x36";return d.jsxs(Sr,{children:[d.jsx(wn,{children:d.jsxs("div",{className:"flex items-start justify-between",children:[d.jsxs("div",{children:[d.jsxs(An,{className:"flex items-center gap-2",children:[d.jsx(Al,{className:"h-5 w-5"}),I.escala]}),d.jsxs(fs,{className:"mt-2",children:[I.postos.length," posto(s) de servio"]})]}),U&&d.jsx(Gn,{variant:"outline",children:I.turno})]})}),d.jsxs(tn,{className:"space-y-4",children:[I.horario_inicio&&I.horario_fim&&d.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[d.jsx(Vy,{className:"h-4 w-4 text-muted-foreground"}),d.jsxs("span",{children:[I.horario_inicio.slice(0,5)," s ",I.horario_fim.slice(0,5)]})]}),U&&d.jsxs("div",{className:"text-sm",children:[d.jsx("span",{className:"font-medium",children:"Turno:"})," ",I.turno]}),typeof I.jornada=="number"&&d.jsxs("div",{className:"text-sm",children:[d.jsx("span",{className:"font-medium",children:"Jornada:"})," ",I.jornada,"h"]}),I.dias_semana&&I.dias_semana.length>0&&d.jsxs("div",{className:"text-sm",children:[d.jsx("span",{className:"font-medium",children:"Dias:"})," ",I.dias_semana.join(", ")]}),d.jsxs("div",{className:"pt-3 border-t",children:[d.jsx("p",{className:"text-sm font-medium mb-2",children:"Postos de Servio:"}),d.jsx("div",{className:"space-y-2",children:I.postos.map($=>d.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[d.jsx(zf,{className:"h-3 w-3 text-muted-foreground"}),d.jsxs("span",{children:[$.codigo," - ",$.nome,$.unidade&&d.jsxs("span",{className:"text-muted-foreground ml-1",children:["(",$.unidade.nome,")"]})]})]},$.id))})]})]})]},N)})}):d.jsx(Sr,{children:d.jsxs(tn,{className:"py-12 text-center",children:[d.jsx(Al,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),d.jsx("p",{className:"text-muted-foreground",children:"Nenhuma escala em uso. Crie postos de servio com escalas definidas."})]})})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsx("h2",{className:"text-2xl font-semibold",children:"Escalas Modelo"}),o&&o.length>0?d.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:o.map(I=>{const N=!!I.turno&&(I.tipo||"").toLowerCase()!=="12x36";return d.jsxs(Sr,{children:[d.jsx(wn,{children:d.jsxs("div",{className:"flex items-start justify-between",children:[d.jsxs("div",{children:[d.jsx(An,{children:I.nome}),I.descricao&&d.jsx(fs,{className:"mt-2",children:I.descricao})]}),d.jsx(Gn,{variant:"outline",children:I.tipo})]})}),d.jsxs(tn,{className:"space-y-2",children:[I.dias_trabalhados&&I.dias_folga&&d.jsxs("div",{className:"text-sm",children:[d.jsx("span",{className:"font-medium",children:"Regime:"})," ",I.dias_trabalhados,"x",I.dias_folga]}),N&&d.jsxs("div",{className:"text-sm",children:[d.jsx("span",{className:"font-medium",children:"Turno:"})," ",I.turno]}),typeof I.jornada=="number"&&d.jsxs("div",{className:"text-sm",children:[d.jsx("span",{className:"font-medium",children:"Jornada:"})," ",I.jornada,"h"]}),I.horario_inicio&&I.horario_fim&&d.jsxs("div",{className:"text-sm",children:[d.jsx("span",{className:"font-medium",children:"Horrio:"})," ",I.horario_inicio.slice(0,5)," s ",I.horario_fim.slice(0,5)]}),d.jsxs("div",{className:"flex gap-2 pt-3",children:[d.jsx(Bt,{variant:"outline",size:"sm",onClick:()=>{l(I),t(!0)},children:"Editar"}),d.jsx(Bt,{variant:"outline",size:"sm",onClick:()=>A(I.id),children:"Excluir"})]})]})]},I.id)})}):d.jsx(Sr,{children:d.jsxs(tn,{className:"py-12 text-center",children:[d.jsx(Al,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),d.jsx("p",{className:"text-muted-foreground",children:"Nenhuma escala modelo cadastrada"}),d.jsxs(Bt,{onClick:()=>t(!0),className:"mt-4",children:[d.jsx(Ea,{className:"mr-2 h-4 w-4"}),"Criar primeira escala modelo"]})]})})]})]})}),e&&d.jsx(Nue,{escala:i,open:e,onClose:()=>{t(!1),l(null)},onSuccess:()=>{t(!1),l(null),x()}})]})}function Oue({open:e,onOpenChange:t,ativo:i,onSuccess:l}){var q;const[f,_]=F.useState(!1),[x,o]=F.useState([]),{register:A,handleSubmit:I,setValue:N,watch:U,reset:$}=KP({defaultValues:{unidade_id:(i==null?void 0:i.unidade_id)||"",categoria:(i==null?void 0:i.categoria)||"",tag_patrimonio:(i==null?void 0:i.tag_patrimonio)||"",fabricante:(i==null?void 0:i.fabricante)||"",modelo:(i==null?void 0:i.modelo)||"",numero_serie:(i==null?void 0:i.numero_serie)||"",status:(i==null?void 0:i.status)||"operacional",critico:(i==null?void 0:i.critico)||!1,data_instalacao:(i==null?void 0:i.data_instalacao)||"",frequencia_preventiva_dias:(i==null?void 0:i.frequencia_preventiva_dias)||90}});F.useEffect(()=>{V()},[]),F.useEffect(()=>{i&&$({unidade_id:i.unidade_id||"",categoria:i.categoria||"",tag_patrimonio:i.tag_patrimonio||"",fabricante:i.fabricante||"",modelo:i.modelo||"",numero_serie:i.numero_serie||"",status:i.status||"operacional",critico:i.critico||!1,data_instalacao:i.data_instalacao||"",frequencia_preventiva_dias:i.frequencia_preventiva_dias||90})},[i,$]);const V=async()=>{const{data:Z}=await Ge.from("unidades").select("*").order("nome");o(Z||[])},Y=async Z=>{_(!0);try{const Q={...Z,critico:Z.critico==="true"||Z.critico===!0};if(i){const{error:H}=await Ge.from("ativos").update(Q).eq("id",i.id);if(H)throw H;Yt.success("Ativo atualizado com sucesso!")}else{const{error:H}=await Ge.from("ativos").insert([Q]);if(H)throw H;Yt.success("Ativo cadastrado com sucesso!")}l(),t(!1),$()}catch(Q){Yt.error(Q.message)}finally{_(!1)}};return d.jsx(Vs,{open:e,onOpenChange:t,children:d.jsxs(Ms,{className:"max-w-2xl max-h-[90vh] overflow-y-auto w-full",children:[d.jsx(Ns,{children:d.jsx(Ds,{children:i?"Editar Ativo":"Cadastrar Novo Ativo"})}),d.jsxs("form",{onSubmit:I(Y),className:"space-y-4",children:[d.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"unidade_id",children:"Unidade *"}),d.jsxs(Vr,{value:U("unidade_id"),onValueChange:Z=>N("unidade_id",Z),children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Selecione"})}),d.jsx(Lr,{children:x.map(Z=>d.jsx(bt,{value:Z.id,children:Z.nome},Z.id))})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"categoria",children:"Categoria *"}),d.jsx(gr,{...A("categoria",{required:!0})})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"tag_patrimonio",children:"Tag Patrimnio *"}),d.jsx(gr,{...A("tag_patrimonio",{required:!0})})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"fabricante",children:"Fabricante"}),d.jsx(gr,{...A("fabricante")})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"modelo",children:"Modelo"}),d.jsx(gr,{...A("modelo")})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"numero_serie",children:"Nmero de Srie"}),d.jsx(gr,{...A("numero_serie")})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"status",children:"Status *"}),d.jsxs(Vr,{value:U("status"),onValueChange:Z=>N("status",Z),children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Operacional"})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"operacional",children:"Operacional"}),d.jsx(bt,{value:"manutencao",children:"Manuteno"}),d.jsx(bt,{value:"inativo",children:"Inativo"}),d.jsx(bt,{value:"descartado",children:"Descartado"})]})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"critico",children:"Crtico *"}),d.jsxs(Vr,{value:(q=U("critico"))==null?void 0:q.toString(),onValueChange:Z=>N("critico",Z==="true"),children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"No"})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"false",children:"No"}),d.jsx(bt,{value:"true",children:"Sim"})]})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"data_instalacao",children:"Data Instalao"}),d.jsx(gr,{type:"date",...A("data_instalacao")})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"frequencia_preventiva_dias",children:"Frequncia Preventiva (dias)"}),d.jsx(gr,{type:"number",...A("frequencia_preventiva_dias")})]})]}),d.jsxs("div",{className:"flex justify-end gap-2",children:[d.jsx(Bt,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Cancelar"}),d.jsx(Bt,{type:"submit",disabled:f,children:f?"Salvando...":"Cadastrar"})]})]})]})})}function Lue(){var st;const[e,t]=F.useState([]),[i,l]=F.useState([]),[f,_]=F.useState(""),[x,o]=F.useState("all"),[A,I]=F.useState("all"),[N,U]=F.useState("all"),[$,V]=F.useState("all"),[Y,q]=F.useState("all"),[Z,Q]=F.useState(!1),[H,K]=F.useState(null),[ne,le]=F.useState(null),[pe,Ae]=F.useState({});F.useEffect(()=>{Ze()},[]),F.useEffect(()=>{const Ne=e.filter(De=>{var Ft,Ut,vr,xr,zr;const Tt=((Ft=De.tag_patrimonio)==null?void 0:Ft.toLowerCase().includes(f.toLowerCase()))||((Ut=De.categoria)==null?void 0:Ut.toLowerCase().includes(f.toLowerCase()))||((vr=De.fabricante)==null?void 0:vr.toLowerCase().includes(f.toLowerCase()))||((xr=De.modelo)==null?void 0:xr.toLowerCase().includes(f.toLowerCase())),Pt=x==="all"||De.categoria===x,fe=A==="all"||De.fabricante===A,Le=N==="all"||((zr=De.unidades)==null?void 0:zr.id)===N,vt=$==="all"||De.status===$,Wt=Y==="all"||(Y==="critico"?!!De.critico:!De.critico);return Tt&&Pt&&fe&&Le&&vt&&Wt});l(Ne)},[f,e,x,A,N,$,Y]);const Ze=async()=>{const{data:Ne,error:De}=await Ge.from("ativos").select("*, unidades(id, nome)").order("created_at",{ascending:!1});if(De){Yt.error("Erro ao carregar ativos");return}t(Ne||[]),Xe(Ne||[])},Xe=Ne=>{const De=Ne.length,Tt=Ne.reduce((Le,vt)=>{const Wt=vt.categoria||"Sem categoria";return Le[Wt]=(Le[Wt]||0)+1,Le},{}),Pt=Ne.filter(Le=>Le.status==="operacional").length,fe=Ne.filter(Le=>Le.critico).length;Ae({totalAtivos:De,categorias:Tt,operacionais:Pt,criticos:fe})},Je=async Ne=>{if(!confirm("Tem certeza que deseja deletar este ativo?"))return;const{error:De}=await Ge.from("ativos").delete().eq("id",Ne);if(De){Yt.error("Erro ao deletar ativo");return}Yt.success("Ativo deletado com sucesso!"),Ze()},Te=Ne=>{le(Ne),Q(!0)},xe=()=>{le(null),Q(!0)},Be=Array.from(new Set(e.map(Ne=>Ne.categoria).filter(Boolean))),dt=Array.from(new Set(e.map(Ne=>Ne.fabricante).filter(Boolean))),qt=Array.from(new Set(e.map(Ne=>Ne.unidades?{id:Ne.unidades.id,nome:Ne.unidades.nome}:null).filter(Boolean).map(Ne=>JSON.stringify(Ne)))).map(Ne=>JSON.parse(Ne)),Ke=Array.from(new Set(e.map(Ne=>Ne.status).filter(Boolean)));return d.jsxs(bo,{children:[d.jsxs("div",{className:"p-6 space-y-6",children:[d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("h1",{className:"text-3xl font-bold",children:"Gesto de Ativos"}),d.jsxs(Bt,{onClick:xe,children:[d.jsx(Ea,{className:"h-4 w-4 mr-2"}),"Novo Ativo"]})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[d.jsxs(Sr,{children:[d.jsxs(wn,{className:"flex flex-col items-center justify-center space-y-1 pb-2 text-center",children:[d.jsx(An,{className:"text-sm font-medium",children:"Total de Ativos"}),d.jsx(Vd,{className:"h-4 w-4 text-muted-foreground"})]}),d.jsx(tn,{className:"text-center",children:d.jsx("div",{className:"text-2xl font-bold",children:pe.totalAtivos||0})})]}),d.jsxs(Sr,{children:[d.jsxs(wn,{className:"flex flex-col items-center justify-center space-y-1 pb-2 text-center",children:[d.jsx(An,{className:"text-sm font-medium",children:"Operacionais"}),d.jsx(Vd,{className:"h-4 w-4 text-muted-foreground"})]}),d.jsx(tn,{className:"text-center",children:d.jsx("div",{className:"text-2xl font-bold",children:pe.operacionais||0})})]}),d.jsxs(Sr,{children:[d.jsxs(wn,{className:"flex flex-col items-center justify-center space-y-1 pb-2 text-center",children:[d.jsx(An,{className:"text-sm font-medium",children:"Crticos"}),d.jsx(Vd,{className:"h-4 w-4 text-muted-foreground"})]}),d.jsx(tn,{className:"text-center",children:d.jsx("div",{className:"text-2xl font-bold",children:pe.criticos||0})})]})]}),d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:Object.entries(pe.categorias||{}).map(([Ne,De])=>d.jsxs(Sr,{children:[d.jsxs(wn,{className:"flex flex-col items-center justify-center space-y-1 pb-2 text-center",children:[d.jsx(An,{className:"text-sm font-medium capitalize",children:Ne}),d.jsx(Vd,{className:"h-4 w-4 text-muted-foreground"})]}),d.jsx(tn,{className:"text-center",children:d.jsx("div",{className:"text-2xl font-bold",children:De})})]},Ne))}),d.jsxs(Sr,{children:[d.jsx(wn,{children:d.jsxs("div",{className:"flex flex-col gap-3",children:[d.jsxs("div",{className:"relative w-full",children:[d.jsx(ou,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),d.jsx(gr,{placeholder:"Buscar por tag, categoria, fabricante ou modelo...",value:f,onChange:Ne=>_(Ne.target.value),className:"pl-8"})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-2 md:gap-3 w-full",children:[d.jsxs(Vr,{value:x,onValueChange:o,children:[d.jsx(Or,{className:"w-full",children:d.jsx(Ur,{placeholder:"Categoria"})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"all",children:"Todas categorias"}),Be.map(Ne=>d.jsx(bt,{value:Ne,children:Ne},Ne))]})]}),d.jsxs(Vr,{value:A,onValueChange:I,children:[d.jsx(Or,{className:"w-full",children:d.jsx(Ur,{placeholder:"Fabricante"})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"all",children:"Todos fabricantes"}),dt.map(Ne=>d.jsx(bt,{value:Ne,children:Ne},Ne))]})]}),d.jsxs(Vr,{value:N,onValueChange:U,children:[d.jsx(Or,{className:"w-full",children:d.jsx(Ur,{placeholder:"Unidade"})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"all",children:"Todas unidades"}),qt.map(Ne=>d.jsx(bt,{value:Ne.id,children:Ne.nome},Ne.id))]})]}),d.jsxs(Vr,{value:$,onValueChange:V,children:[d.jsx(Or,{className:"w-full",children:d.jsx(Ur,{placeholder:"Status"})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"all",children:"Todos status"}),Ke.map(Ne=>d.jsx(bt,{value:Ne,children:Ne},Ne))]})]}),d.jsxs(Vr,{value:Y,onValueChange:q,children:[d.jsx(Or,{className:"w-full",children:d.jsx(Ur,{placeholder:"Crtico"})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"all",children:"Todos"}),d.jsx(bt,{value:"critico",children:"Crtico"}),d.jsx(bt,{value:"nao_critico",children:"No crtico"})]})]})]})]})}),d.jsx(tn,{className:"overflow-x-auto sm:overflow-x-visible",children:d.jsxs(Jl,{children:[d.jsx(Ql,{children:d.jsxs(Yi,{children:[d.jsx(Yr,{children:"Tag Patrimnio"}),d.jsx(Yr,{className:"hidden sm:table-cell",children:"Categoria"}),d.jsx(Yr,{className:"hidden sm:table-cell",children:"Fabricante"}),d.jsx(Yr,{className:"hidden sm:table-cell",children:"Modelo"}),d.jsx(Yr,{className:"hidden sm:table-cell",children:"Unidade"}),d.jsx(Yr,{children:"Status"}),d.jsx(Yr,{children:"Crtico"}),d.jsx(Yr,{className:"hidden sm:table-cell",children:"Aes"})]})}),d.jsx(ec,{children:i.map(Ne=>{var De;return d.jsxs(Yi,{className:"cursor-pointer",onClick:()=>K(Ne),children:[d.jsx(Pr,{className:"font-medium",children:Ne.tag_patrimonio}),d.jsx(Pr,{className:"hidden sm:table-cell",children:Ne.categoria}),d.jsx(Pr,{className:"hidden sm:table-cell",children:Ne.fabricante}),d.jsx(Pr,{className:"hidden sm:table-cell",children:Ne.modelo}),d.jsx(Pr,{className:"hidden sm:table-cell",children:((De=Ne.unidades)==null?void 0:De.nome)||"-"}),d.jsx(Pr,{children:d.jsx(Gn,{variant:Ne.status==="operacional"?"default":Ne.status==="manutencao"?"secondary":"outline",children:Ne.status})}),d.jsx(Pr,{children:Ne.critico?d.jsx(Gn,{variant:"destructive",children:"Sim"}):d.jsx(Gn,{variant:"outline",children:"No"})}),d.jsx(Pr,{className:"hidden sm:table-cell",children:d.jsxs("div",{className:"flex gap-2",children:[d.jsx(Bt,{variant:"ghost",size:"icon",onClick:Tt=>{Tt.stopPropagation(),Te(Ne)},children:d.jsx(gu,{className:"h-4 w-4"})}),d.jsx(Bt,{variant:"ghost",size:"icon",onClick:Tt=>{Tt.stopPropagation(),Je(Ne.id)},children:d.jsx(jl,{className:"h-4 w-4"})})]})})]},Ne.id)})})]})})]})]}),d.jsx(Oue,{open:Z,onOpenChange:Q,ativo:ne,onSuccess:Ze}),d.jsx(Vs,{open:!!H,onOpenChange:Ne=>{Ne||K(null)},children:d.jsxs(Ms,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[d.jsxs(Ns,{className:"space-y-1",children:[d.jsx(Ds,{children:(H==null?void 0:H.tag_patrimonio)||"Ativo"}),d.jsx(Qa,{children:"Detalhes completos do ativo"})]}),H&&d.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[d.jsxs("div",{className:"flex flex-col gap-1",children:[d.jsx("span",{className:"text-xs text-muted-foreground",children:"Categoria"}),d.jsx("span",{className:"font-medium",children:H.categoria||"-"})]}),d.jsxs("div",{className:"flex flex-col gap-1",children:[d.jsx("span",{className:"text-xs text-muted-foreground",children:"Fabricante"}),d.jsx("span",{className:"font-medium",children:H.fabricante||"-"})]}),d.jsxs("div",{className:"flex flex-col gap-1",children:[d.jsx("span",{className:"text-xs text-muted-foreground",children:"Modelo"}),d.jsx("span",{className:"font-medium",children:H.modelo||"-"})]}),d.jsxs("div",{className:"flex flex-col gap-1",children:[d.jsx("span",{className:"text-xs text-muted-foreground",children:"Unidade"}),d.jsx("span",{className:"font-medium",children:((st=H.unidades)==null?void 0:st.nome)||"-"})]}),d.jsxs("div",{className:"flex flex-col gap-1",children:[d.jsx("span",{className:"text-xs text-muted-foreground",children:"Status"}),d.jsx("span",{className:"font-medium",children:H.status})]}),d.jsxs("div",{className:"flex flex-col gap-1",children:[d.jsx("span",{className:"text-xs text-muted-foreground",children:"Crtico"}),d.jsx("span",{className:"font-medium",children:H.critico?"Sim":"No"})]}),d.jsxs("div",{className:"flex gap-2 pt-2 sm:col-span-2",children:[d.jsx(Bt,{variant:"outline",onClick:()=>{le(H),Q(!0),K(null)},children:"Editar"}),d.jsx(Bt,{variant:"destructive",onClick:()=>{Je(H.id),K(null)},children:"Excluir"})]})]})]})})]})}function zue({open:e,onOpenChange:t,item:i,onSuccess:l}){const[f,_]=F.useState(!1),[x,o]=F.useState([]),{register:A,handleSubmit:I,setValue:N,watch:U,reset:$}=KP({defaultValues:{unidade_id:(i==null?void 0:i.unidade_id)||"",nome:(i==null?void 0:i.nome)||"",sku:(i==null?void 0:i.sku)||"",descricao:(i==null?void 0:i.descricao)||"",unidade_medida:(i==null?void 0:i.unidade_medida)||"",quantidade_minima:(i==null?void 0:i.quantidade_minima)||0,quantidade_atual:(i==null?void 0:i.quantidade_atual)||0}});F.useEffect(()=>{V()},[]),F.useEffect(()=>{$(i?{unidade_id:i.unidade_id||"",nome:i.nome||"",sku:i.sku||"",descricao:i.descricao||"",unidade_medida:i.unidade_medida||"",quantidade_minima:i.quantidade_minima||0,quantidade_atual:i.quantidade_atual||0}:{unidade_id:"",nome:"",sku:"",descricao:"",unidade_medida:"",quantidade_minima:0,quantidade_atual:0})},[i,$]);const V=async()=>{const{data:q,error:Z}=await Ge.from("unidades").select("id, nome").order("nome");if(Z){Yt.error("Erro ao carregar unidades");return}o(q||[])},Y=async q=>{_(!0);try{if(i){const{error:Z}=await Ge.from("itens_estoque").update(q).eq("id",i.id);if(Z)throw Z;Yt.success("Item atualizado com sucesso!")}else{const{error:Z}=await Ge.from("itens_estoque").insert([q]);if(Z)throw Z;Yt.success("Item cadastrado com sucesso!")}l(),t(!1),$()}catch(Z){Yt.error(Z.message)}finally{_(!1)}};return d.jsx(Vs,{open:e,onOpenChange:t,children:d.jsxs(Ms,{className:"max-w-xl max-h-[90vh] overflow-y-auto",children:[d.jsx(Ns,{children:d.jsx(Ds,{children:i?"Editar Item":"Cadastrar Novo Item"})}),d.jsxs("form",{onSubmit:I(Y),className:"space-y-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"unidade_id",children:"Unidade *"}),d.jsxs(Vr,{value:U("unidade_id"),onValueChange:q=>N("unidade_id",q),children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Selecione"})}),d.jsx(Lr,{children:x.map(q=>d.jsx(bt,{value:q.id,children:q.nome},q.id))})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"sku",children:"SKU *"}),d.jsx(gr,{...A("sku",{required:!0})})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"nome",children:"Nome *"}),d.jsx(gr,{...A("nome",{required:!0})})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"descricao",children:"Descrio *"}),d.jsx(gr,{...A("descricao",{required:!0})})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"unidade_medida",children:"Unidade de Medida *"}),d.jsx(gr,{placeholder:"Ex: UN, KG, L",...A("unidade_medida",{required:!0})})]}),d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"quantidade_minima",children:"Quantidade Mnima *"}),d.jsx(gr,{type:"number",...A("quantidade_minima",{required:!0,min:0})})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"quantidade_atual",children:"Quantidade Atual *"}),d.jsx(gr,{type:"number",...A("quantidade_atual",{required:!0,min:0})})]})]}),d.jsxs("div",{className:"flex justify-end gap-2",children:[d.jsx(Bt,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Cancelar"}),d.jsx(Bt,{type:"submit",disabled:f,children:f?"Salvando...":i?"Atualizar":"Cadastrar"})]})]})]})})}const Fue=()=>{const[e,t]=F.useState([]),[i,l]=F.useState(""),[f,_]=F.useState(!1),[x,o]=F.useState(null),[A,I]=F.useState({total:0,abaixoMinimo:0,quantidadeTotal:0});F.useEffect(()=>{N()},[]);const N=async()=>{const{data:H,error:K}=await Ge.from("itens_estoque").select("*, unidades(nome)").order("created_at",{ascending:!1});if(K){Yt.error("Erro ao carregar itens");return}t(H||[]),U(H||[])},U=H=>{const K=H.length,ne=H.filter(pe=>pe.quantidade_atual<pe.quantidade_minima).length,le=H.reduce((pe,Ae)=>pe+(Ae.quantidade_atual||0),0);I({total:K,abaixoMinimo:ne,quantidadeTotal:le})},$=F.useMemo(()=>{const H=i.toLowerCase();return e.filter(K=>{var ne,le,pe;return((ne=K.sku)==null?void 0:ne.toLowerCase().includes(H))||((le=K.nome)==null?void 0:le.toLowerCase().includes(H))||((pe=K.descricao)==null?void 0:pe.toLowerCase().includes(H))})},[e,i]),V=async H=>{if(!confirm("Tem certeza que deseja deletar este item?"))return;const{error:K}=await Ge.from("itens_estoque").delete().eq("id",H);if(K){Yt.error("Erro ao deletar item");return}Yt.success("Item deletado com sucesso!"),N()},Y=H=>{o(H),_(!0)},q=()=>{o(null),_(!0)},Z=H=>H.quantidade_atual<H.quantidade_minima,Q=H=>H.quantidade_atual<H.quantidade_minima?{borderClass:"border-red-500",textClass:"text-red-600",label:"Abaixo do mnimo",Icon:Cm}:H.quantidade_atual===H.quantidade_minima?{borderClass:"border-amber-400",textClass:"text-amber-500",label:"No limite",Icon:Cm}:{borderClass:"border-emerald-500",textClass:"text-emerald-600",label:"Estoque saudvel",Icon:Ib};return d.jsxs(bo,{children:[d.jsxs("div",{className:"p-6 space-y-6",children:[d.jsxs("div",{className:"flex items-center justify-between gap-4",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-3xl font-bold",children:"Estoque"}),d.jsx("p",{className:"text-muted-foreground",children:"Controle de materiais e insumos."})]}),d.jsxs(Bt,{onClick:q,children:[d.jsx(Ea,{className:"h-4 w-4 mr-2"}),"Novo Item"]})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[d.jsxs(Sr,{children:[d.jsxs(wn,{className:"flex items-center justify-between space-y-0 pb-2",children:[d.jsx(An,{className:"text-sm font-medium",children:"Total de itens"}),d.jsx(Vd,{className:"h-4 w-4 text-muted-foreground"})]}),d.jsx(tn,{className:"text-center",children:d.jsx("div",{className:"text-lg font-bold",children:A.total})})]}),d.jsxs(Sr,{children:[d.jsxs(wn,{className:"flex items-center justify-between space-y-0 pb-2",children:[d.jsx(An,{className:"text-sm font-medium",children:"Abaixo do mnimo"}),d.jsx(Cm,{className:"h-4 w-4 text-muted-foreground"})]}),d.jsx(tn,{className:"text-center",children:d.jsx("div",{className:"text-lg font-bold",children:A.abaixoMinimo})})]}),d.jsxs(Sr,{children:[d.jsxs(wn,{className:"flex items-center justify-between space-y-0 pb-2",children:[d.jsx(An,{className:"text-sm font-medium",children:"Quantidade total"}),d.jsx(Vd,{className:"h-4 w-4 text-muted-foreground"})]}),d.jsx(tn,{className:"text-center",children:d.jsx("div",{className:"text-lg font-bold",children:A.quantidadeTotal})})]})]}),d.jsxs(Sr,{children:[d.jsx(wn,{children:d.jsxs("div",{className:"relative flex-1",children:[d.jsx(ou,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),d.jsx(gr,{placeholder:"Buscar por SKU, nome ou descricao...",value:i,onChange:H=>l(H.target.value),className:"pl-9"})]})}),d.jsxs(tn,{children:[d.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[$.map(H=>{const K=Q(H);return d.jsx(Sr,{className:`border-2 ${K.borderClass} bg-transparent`,children:d.jsxs(tn,{className:"py-4 flex flex-col items-center text-center space-y-2",children:[d.jsx(K.Icon,{className:`h-6 w-6 ${K.textClass}`}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-semibold",children:H.nome}),d.jsx("p",{className:`text-xs ${K.textClass}`,children:K.label})]}),d.jsxs("div",{className:"text-lg font-bold",children:[H.quantidade_atual," ",d.jsxs("span",{className:"text-sm font-normal text-muted-foreground",children:["/ ",H.quantidade_minima]})]})]})},`indicator-${H.id}`)}),$.length===0&&d.jsx("div",{className:"col-span-full text-center text-sm text-muted-foreground",children:"Nenhum item para exibir nos indicadores."})]}),d.jsxs(Jl,{children:[d.jsx(Ql,{children:d.jsxs(Yi,{children:[d.jsx(Yr,{children:"SKU"}),d.jsx(Yr,{children:"Nome"}),d.jsx(Yr,{children:"Descricao"}),d.jsx(Yr,{children:"Unidade"}),d.jsx(Yr,{children:"Un. Medida"}),d.jsx(Yr,{children:"Qtd. Minima"}),d.jsx(Yr,{children:"Qtd. Atual"}),d.jsx(Yr,{children:"Status"}),d.jsx(Yr,{children:"Acoes"})]})}),d.jsxs(ec,{children:[$.map(H=>{var K;return d.jsxs(Yi,{children:[d.jsx(Pr,{className:"font-medium",children:H.sku}),d.jsx(Pr,{children:H.nome}),d.jsx(Pr,{children:H.descricao}),d.jsx(Pr,{children:((K=H.unidades)==null?void 0:K.nome)||"-"}),d.jsx(Pr,{children:H.unidade_medida}),d.jsx(Pr,{children:H.quantidade_minima}),d.jsx(Pr,{children:H.quantidade_atual}),d.jsx(Pr,{children:Z(H)?d.jsx(Gn,{variant:"destructive",children:"Abaixo do minimo"}):d.jsx(Gn,{children:"Normal"})}),d.jsx(Pr,{children:d.jsxs("div",{className:"flex gap-2",children:[d.jsx(Bt,{variant:"ghost",size:"icon",onClick:()=>Y(H),children:d.jsx(gu,{className:"h-4 w-4"})}),d.jsx(Bt,{variant:"ghost",size:"icon",onClick:()=>V(H.id),children:d.jsx(jl,{className:"h-4 w-4"})})]})})]},H.id)}),$.length===0&&d.jsx(Yi,{children:d.jsx(Pr,{colSpan:9,className:"text-center text-sm text-muted-foreground",children:"Nenhum item encontrado"})})]})]})]})]})]}),d.jsx(zue,{open:f,onOpenChange:_,item:x,onSuccess:N})]})},ej="diaristas-anexos";function Bue({open:e,onClose:t,onSuccess:i,diarista:l}){const[f,_]=F.useState(!1),[x,o]=F.useState({nome_completo:"",rg:"",cnh:"",endereco:"",cidade:"",telefone:"",email:"",possui_antecedente:!1,status:"ativo"}),[A,I]=F.useState([]),[N,U]=F.useState([]),[$,V]=F.useState(!1),Y=F.useCallback(async()=>{if(!(l!=null&&l.id)){I([]);return}V(!0);try{const{data:ne,error:le}=await Ge.from("diaristas_anexos").select("*").eq("diarista_id",l.id).order("created_at",{ascending:!1});if(le)throw le;I(ne||[])}catch(ne){Yt.error("Erro ao carregar anexos: "+ne.message)}finally{V(!1)}},[l==null?void 0:l.id]);F.useEffect(()=>{l?(o({nome_completo:l.nome_completo||"",rg:l.rg||"",cnh:l.cnh||"",endereco:l.endereco||"",cidade:l.cidade||"",telefone:l.telefone||"",email:l.email||"",possui_antecedente:l.possui_antecedente||!1,status:l.status||"ativo"}),Y()):(o({nome_completo:"",rg:"",cnh:"",endereco:"",cidade:"",telefone:"",email:"",possui_antecedente:!1,status:"ativo"}),I([])),U([])},[l,e,Y]);const q=ne=>{const le=ne.target.files;!le||le.length===0||(U(pe=>[...pe,...Array.from(le)]),ne.target.value="")},Z=ne=>{U(le=>le.filter((pe,Ae)=>Ae!==ne))},Q=async ne=>{V(!0);try{const{error:le}=await Ge.storage.from(ej).remove([ne.caminho_storage]);if(le)throw le;const{error:pe}=await Ge.from("diaristas_anexos").delete().eq("id",ne.id);if(pe)throw pe;Yt.success("Anexo removido"),Y()}catch(le){Yt.error("Erro ao remover anexo: "+le.message)}finally{V(!1)}},H=async ne=>{if(!N.length)return;const{data:le,error:pe}=await Ge.auth.getUser();if(pe||!le.user)throw new Error("Usurio no autenticado");for(const Ae of N){const Ze=`${ne}/${Date.now()}-${Ae.name}`,{error:Xe}=await Ge.storage.from(ej).upload(Ze,Ae,{upsert:!1});if(Xe)throw Xe;const{error:Je}=await Ge.from("diaristas_anexos").insert({diarista_id:ne,nome_arquivo:Ae.name,caminho_storage:Ze,tipo_arquivo:Ae.type||null,tamanho_bytes:Ae.size,uploaded_by:le.user.id});if(Je)throw await Ge.storage.from(ej).remove([Ze]),Je}U([]),await Y()},K=async ne=>{if(ne.preventDefault(),x.possui_antecedente){Yt.error("No  permitido cadastrar diaristas com antecedentes criminais");return}_(!0);try{let le=l==null?void 0:l.id;if(l){const{error:pe}=await Ge.from("diaristas").update(x).eq("id",l.id);if(pe)throw pe;Yt.success("Diarista atualizado com sucesso")}else{const{data:pe,error:Ae}=await Ge.from("diaristas").insert([x]).select().single();if(Ae)throw Ae;le=pe==null?void 0:pe.id,Yt.success("Diarista cadastrado com sucesso")}le&&await H(le),i()}catch(le){Yt.error("Erro ao salvar diarista: "+le.message)}finally{_(!1)}};return d.jsx(Vs,{open:e,onOpenChange:t,children:d.jsxs(Ms,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[d.jsx(Ns,{children:d.jsx(Ds,{children:l?"Editar Diarista":"Novo Diarista"})}),d.jsxs("form",{onSubmit:K,className:"space-y-4",children:[d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[d.jsxs("div",{className:"space-y-2 md:col-span-2",children:[d.jsx(Gt,{htmlFor:"nome_completo",children:"Nome Completo *"}),d.jsx(gr,{id:"nome_completo",value:x.nome_completo,onChange:ne=>o({...x,nome_completo:ne.target.value}),required:!0})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"rg",children:"RG *"}),d.jsx(gr,{id:"rg",value:x.rg,onChange:ne=>o({...x,rg:ne.target.value}),required:!0})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"cnh",children:"CNH *"}),d.jsx(gr,{id:"cnh",value:x.cnh,onChange:ne=>o({...x,cnh:ne.target.value}),required:!0})]}),d.jsxs("div",{className:"space-y-2 md:col-span-2",children:[d.jsx(Gt,{htmlFor:"endereco",children:"Endereo *"}),d.jsx(gr,{id:"endereco",value:x.endereco,onChange:ne=>o({...x,endereco:ne.target.value}),required:!0})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"cidade",children:"Cidade"}),d.jsx(gr,{id:"cidade",value:x.cidade,onChange:ne=>o({...x,cidade:ne.target.value})})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"telefone",children:"Telefone *"}),d.jsx(gr,{id:"telefone",type:"tel",value:x.telefone,onChange:ne=>o({...x,telefone:ne.target.value}),required:!0})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"email",children:"Email *"}),d.jsx(gr,{id:"email",type:"email",value:x.email,onChange:ne=>o({...x,email:ne.target.value}),required:!0})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"possui_antecedente",children:"Possui Antecedente Criminal? *"}),d.jsxs(Vr,{value:x.possui_antecedente?"true":"false",onValueChange:ne=>o({...x,possui_antecedente:ne==="true"}),children:[d.jsx(Or,{children:d.jsx(Ur,{})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"false",children:"No"}),d.jsx(bt,{value:"true",children:"Sim"})]})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{htmlFor:"status",children:"Status"}),d.jsxs(Vr,{value:x.status,onValueChange:ne=>o({...x,status:ne}),children:[d.jsx(Or,{children:d.jsx(Ur,{})}),d.jsxs(Lr,{children:[d.jsx(bt,{value:"ativo",children:"Ativo"}),d.jsx(bt,{value:"inativo",children:"Inativo"})]})]})]})]}),d.jsxs("div",{className:"space-y-3",children:[d.jsx(Gt,{children:"Documentos / anexos"}),d.jsx(gr,{type:"file",multiple:!0,onChange:q}),N.length>0&&d.jsxs("div",{className:"rounded-md border p-3 space-y-2 text-sm",children:[d.jsx("p",{className:"font-medium",children:"Anexos novos"}),N.map((ne,le)=>d.jsxs("div",{className:"flex items-center justify-between gap-2 text-xs",children:[d.jsx("span",{className:"truncate",children:ne.name}),d.jsx(Bt,{type:"button",variant:"ghost",size:"sm",className:"h-7 px-2",onClick:()=>Z(le),children:"Remover"})]},`${ne.name}-${le}`))]}),d.jsxs("div",{className:"rounded-md border p-3 space-y-2 text-sm",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("p",{className:"font-medium",children:"Anexos existentes"}),$&&d.jsx("span",{className:"text-xs text-muted-foreground",children:"Atualizando..."})]}),A.length===0?d.jsx("p",{className:"text-xs text-muted-foreground",children:"Nenhum anexo cadastrado."}):A.map(ne=>d.jsxs("div",{className:"flex items-center justify-between gap-2 text-xs",children:[d.jsx("span",{className:"truncate",children:ne.nome_arquivo}),d.jsx(Bt,{type:"button",variant:"ghost",size:"sm",className:"h-7 px-2",onClick:()=>Q(ne),children:"Excluir"})]},ne.id))]})]}),d.jsxs("div",{className:"flex justify-end gap-2",children:[d.jsx(Bt,{type:"button",variant:"outline",onClick:t,children:"Cancelar"}),d.jsx(Bt,{type:"submit",disabled:f,children:f?"Salvando...":l?"Atualizar":"Cadastrar"})]})]})]})})}const Vue="diaristas-anexos";function Uue(){const[e,t]=F.useState(""),[i,l]=F.useState(!1),[f,_]=F.useState(null),[x,o]=F.useState(null),[A,I]=F.useState(null),[N,U]=F.useState([]),[$,V]=F.useState(!1),Y=Xf(),{data:q,isLoading:Z}=Ks({queryKey:["diaristas"],queryFn:async()=>{const{data:le,error:pe}=await Ge.from("diaristas").select("*").order("nome_completo");if(pe)throw pe;return le||[]}}),Q=q==null?void 0:q.filter(le=>le.nome_completo.toLowerCase().includes(e.toLowerCase())||le.email.toLowerCase().includes(e.toLowerCase())||le.telefone.includes(e)),H=le=>{_(le),l(!0)},K=async le=>{try{const{error:pe}=await Ge.from("diaristas").delete().eq("id",le);if(pe)throw pe;Yt.success("Diarista excludo com sucesso"),Y.invalidateQueries({queryKey:["diaristas"]}),o(null)}catch(pe){Yt.error("Erro ao excluir diarista: "+pe.message)}},ne=async le=>{V(!0);try{const{data:pe,error:Ae}=await Ge.from("diaristas_anexos").select("*").eq("diarista_id",le).order("created_at",{ascending:!1});if(Ae)throw Ae;const Ze=await Promise.all((pe||[]).map(async Xe=>{const{data:Je}=await Ge.storage.from(Vue).createSignedUrl(Xe.caminho_storage,120);return{id:Xe.id,nome_arquivo:Xe.nome_arquivo,caminho_storage:Xe.caminho_storage,created_at:Xe.created_at,url:(Je==null?void 0:Je.signedUrl)||null}}));U(Ze)}catch(pe){Yt.error("Erro ao carregar anexos: "+pe.message),U([])}finally{V(!1)}};return F.useEffect(()=>{A!=null&&A.id?ne(A.id):U([])},[A==null?void 0:A.id]),d.jsxs(bo,{children:[d.jsxs("div",{className:"space-y-6 p-4 md:p-6",children:[d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("h1",{className:"text-3xl font-bold",children:"Diaristas"}),d.jsxs(Bt,{onClick:()=>{_(null),l(!0)},children:[d.jsx(Ea,{className:"mr-2 h-4 w-4"}),"Novo Diarista"]})]}),d.jsx("div",{className:"flex items-center gap-4",children:d.jsxs("div",{className:"relative flex-1",children:[d.jsx(ou,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),d.jsx(gr,{placeholder:"Buscar por nome, email ou telefone...",value:e,onChange:le=>t(le.target.value),className:"pl-10"})]})}),d.jsx("div",{className:"border rounded-lg overflow-x-auto",children:d.jsxs(Jl,{children:[d.jsx(Ql,{children:d.jsxs(Yi,{children:[d.jsx(Yr,{children:"Nome"}),d.jsx(Yr,{className:"hidden sm:table-cell",children:"RG"}),d.jsx(Yr,{className:"hidden sm:table-cell",children:"CNH"}),d.jsx(Yr,{children:"Cidade"}),d.jsx(Yr,{children:"Telefone"}),d.jsx(Yr,{className:"hidden sm:table-cell",children:"Email"}),d.jsx(Yr,{children:"Status"}),d.jsx(Yr,{className:"text-right",children:"Aes"})]})}),d.jsx(ec,{children:Z?d.jsx(Yi,{children:d.jsx(Pr,{colSpan:8,className:"text-center",children:"Carregando..."})}):(Q==null?void 0:Q.length)===0?d.jsx(Yi,{children:d.jsx(Pr,{colSpan:8,className:"text-center",children:"Nenhum diarista encontrado"})}):Q==null?void 0:Q.map(le=>d.jsxs(Yi,{className:"cursor-pointer",onClick:()=>I(le),children:[d.jsx(Pr,{className:"font-medium",children:le.nome_completo}),d.jsx(Pr,{className:"hidden sm:table-cell",children:le.rg}),d.jsx(Pr,{className:"hidden sm:table-cell",children:le.cnh}),d.jsx(Pr,{children:le.cidade||"-"}),d.jsx(Pr,{children:le.telefone}),d.jsx(Pr,{className:"hidden sm:table-cell",children:le.email}),d.jsx(Pr,{children:d.jsx(Gn,{variant:le.status==="ativo"?"default":"secondary",children:le.status})}),d.jsx(Pr,{className:"text-right",children:d.jsxs("div",{className:"flex justify-end gap-2",children:[d.jsx(Bt,{variant:"ghost",size:"icon",onClick:pe=>{pe.stopPropagation(),H(le)},children:d.jsx(gu,{className:"h-4 w-4"})}),d.jsx(Bt,{variant:"ghost",size:"icon",onClick:pe=>{pe.stopPropagation(),o(le.id)},children:d.jsx(jl,{className:"h-4 w-4"})})]})})]},le.id))})]})})]}),d.jsx(Bue,{open:i,onClose:()=>{l(!1),_(null)},onSuccess:()=>{Y.invalidateQueries({queryKey:["diaristas"]}),l(!1),_(null)},diarista:f}),d.jsx(pu,{open:!!x,onOpenChange:()=>o(null),children:d.jsxs(bc,{children:[d.jsxs(wc,{children:[d.jsx(Tc,{children:"Confirmar excluso"}),d.jsx(Ec,{children:"Tem certeza que deseja excluir este diarista? Esta ao no pode ser desfeita."})]}),d.jsxs(Sc,{children:[d.jsx(td,{children:"Cancelar"}),d.jsx(Cc,{onClick:()=>x&&K(x),children:"Excluir"})]})]})}),d.jsx(Vs,{open:!!A,onOpenChange:le=>{le||I(null)},children:d.jsxs(Ms,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[d.jsxs(Ns,{children:[d.jsx(Ds,{children:(A==null?void 0:A.nome_completo)||"Diarista"}),d.jsx(Qa,{children:"Dados completos do diarista"})]}),A&&d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-xs text-muted-foreground",children:"RG"}),d.jsx("p",{className:"font-medium break-words",children:A.rg||"-"})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-xs text-muted-foreground",children:"CNH"}),d.jsx("p",{className:"font-medium break-words",children:A.cnh||"-"})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-xs text-muted-foreground",children:"Email"}),d.jsx("p",{className:"font-medium break-words",children:A.email||"-"})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-xs text-muted-foreground",children:"Telefone"}),d.jsx("p",{className:"font-medium break-words",children:A.telefone||"-"})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-xs text-muted-foreground",children:"Cidade"}),d.jsx("p",{className:"font-medium break-words",children:A.cidade||"-"})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-xs text-muted-foreground",children:"Status"}),d.jsx("p",{className:"font-medium break-words",children:A.status})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("p",{className:"text-sm font-medium",children:"Anexos"}),$?d.jsx("p",{className:"text-xs text-muted-foreground",children:"Carregando anexos..."}):N.length===0?d.jsx("p",{className:"text-xs text-muted-foreground",children:"Nenhum anexo cadastrado."}):d.jsx("div",{className:"space-y-2",children:N.map(le=>d.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 rounded-md border px-3 py-2",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium break-all",children:le.nome_arquivo}),d.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(le.created_at).toLocaleString("pt-BR")})]}),le.url?d.jsx(Bt,{asChild:!0,size:"sm",variant:"outline",className:"mt-1",children:d.jsx("a",{href:le.url,target:"_blank",rel:"noreferrer",children:"Baixar"})}):d.jsx("span",{className:"text-xs text-muted-foreground",children:"Sem link"})]},le.id))})]})]})]})})]})}const Xu=e=>e?e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim():"",di={aguardando:"Aguardando confirmacao",confirmada:"Confirmada",aprovada:"Aprovada",lancada:"Lanada para pagamento",aprovadaPagamento:"Aprovada para pagamento",cancelada:"Cancelada"},B0={[di.aguardando]:"Aguardando confirmacao",[di.confirmada]:"Confirmada",[di.aprovada]:"Aprovada",[di.lancada]:"Lanada para pagamento",[di.aprovadaPagamento]:"Aprovada para pagamento",[di.cancelada]:"Cancelada"},$ue={[di.aguardando]:"secondary",[di.confirmada]:"default",[di.aprovada]:"default",[di.lancada]:"default",[di.aprovadaPagamento]:"default",[di.cancelada]:"destructive"},que={[Xu(di.aguardando)]:{label:"Confirmar diaria",nextStatus:di.confirmada,icon:"confirm"},[Xu(di.confirmada)]:{label:"Aprovar diaria",nextStatus:di.aprovada,icon:"advance"},[Xu(di.aprovada)]:{label:"Lanar para pagamento",nextStatus:di.lancada,icon:"advance"},[Xu(di.lancada)]:{label:"Aprovar para pagamento",nextStatus:di.aprovadaPagamento,icon:"advance"}},Gue=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}),tk=e=>{if(!e)return"-";try{return Kn(W_(e),"dd/MM/yyyy",{locale:js})}catch{return e}},Hue=e=>{if(!e)return"-";try{return Kn(new Date(e),"dd/MM/yyyy HH:mm",{locale:js})}catch{return e}},Wue=e=>{if(!e)return null;try{return Kn(W_(e),"yyyy-MM")}catch{return null}},w8=Kn(new Date,"yyyy-MM"),Zue=e=>{const[t,i]=e.split("-").map(Number),l=new Date(t,i-1,1);return{start:Kn(l,"yyyy-MM-dd"),end:Kn(Oy(l),"yyyy-MM-dd")}},Xue=()=>{const e=new Date().toLocaleString("en-US",{timeZone:"America/Sao_Paulo"}),t=new Date(e);return Kn(t,"yyyy-MM-dd")};function S8(e){const t=Xue(),i=F.useMemo(()=>Zue(e),[e]),{data:l=[],refetch:f}=Ks({queryKey:["posto-dias-vagos",i.start,i.end],queryFn:async()=>{const{data:q,error:Z}=await Ge.from("posto_dias_vagos").select(`
          id,
          data,
          motivo,
          posto_servico_id,
          posto:postos_servico (
            id,
            nome,
            codigo,
            unidade:unidades (
              id,
              nome,
              codigo
            )
          )
        `).gte("data",i.start).lte("data",i.end).order("data",{ascending:!0});if(Z)throw Z;return q}}),{data:_=[]}=Ks({queryKey:["diaristas-ativos"],queryFn:async()=>{const{data:q,error:Z}=await Ge.from("diaristas").select("*").order("nome_completo");if(Z)throw Z;return q?q.map(Q=>({id:Q.id,nome_completo:Q.nome_completo,cargo:Q.cargo??null,status:Q.status??null})):[]}}),{data:x=[],isLoading:o,refetch:A}=Ks({queryKey:["diarias"],queryFn:async()=>{const{data:q,error:Z}=await Ge.from("diarias").select("*").order("created_at",{ascending:!1});if(Z)throw Z;return q}}),I=F.useMemo(()=>{const q=new Map;return l.forEach(Z=>q.set(Z.id,Z)),q},[l]),N=F.useMemo(()=>{const q=new Map;return _.forEach(Z=>q.set(Z.id,Z)),q},[_]),U=F.useMemo(()=>new Set(x.map(q=>q.posto_dia_vago_id)),[x]),$=F.useMemo(()=>({start:W_(i.start),end:W_(i.end)}),[i]),V=F.useMemo(()=>x.filter(q=>{const Z=I.get(q.posto_dia_vago_id),Q=Z==null?void 0:Z.data;return Q?wF(W_(Q),$):!0}),[x,$,I]),Y=F.useMemo(()=>l.filter(q=>U.has(q.id)||q.data<t?!1:wF(W_(q.data),$)),[l,U,$,t]);return{postoDiasVagos:l,diaristas:_,diarias:x,filteredDiarias:V,postoDiaVagoMap:I,diaristaMap:N,availableDiasVagos:Y,usedDiaVagoIds:U,refetchDiarias:A,refetchDiasVagos:f,loadingDiarias:o}}const Jy=[{statusKey:di.aguardando,title:"Dirias aguardando confirmao",description:"Confirme as dirias recm cadastradas antes de liberar para aprovao.",emptyMessage:"Nenhuma diria aguardando confirmao."},{statusKey:di.confirmada,title:"Dirias confirmadas",description:"Dirias prontas para aprovao financeira."},{statusKey:di.aprovada,title:"Dirias aprovadas",description:"Avance as dirias aprovadas para lanamento."},{statusKey:di.lancada,title:"Dirias lanadas para pagamento",description:"Dirias lanadas aguardando aprovao de pagamento."},{statusKey:di.aprovadaPagamento,title:"Dirias aprovadas para pagamento",description:"Acompanhe as dirias aprovadas que esto em fase final de pagamento."},{statusKey:di.cancelada,title:"Dirias canceladas",description:"Histrico de dirias canceladas.",emptyMessage:"Nenhuma diria cancelada."}],Qy=({statusKey:e,title:t,description:i,emptyMessage:l})=>function(){const[_,x]=F.useState(w8),{filteredDiarias:o,postoDiaVagoMap:A,diaristaMap:I,loadingDiarias:N,refetchDiarias:U,diarias:$}=S8(_),[V,Y]=F.useState(null),[q,Z]=F.useState({}),Q=F.useMemo(()=>Object.values(di),[]),H=Xu(e),K=F.useMemo(()=>o.filter(Je=>Xu(Je.status)===H),[o,H]),ne=F.useMemo(()=>$.filter(Je=>Xu(Je.status)===H),[$,H]),le=F.useMemo(()=>{for(const Je of ne){const Te=A.get(Je.posto_dia_vago_id),xe=Wue(Te==null?void 0:Te.data);if(xe)return xe}return null},[ne,A]),pe=K.length===0&&ne.length>0&&!!le,Ae=async(Je,Te)=>{Y(Je);try{const{error:xe}=await Ge.from("diarias").update({status:Te}).eq("id",Je);if(xe)throw xe;Yt.success(`Status atualizado para ${B0[Te]}.`),await U()}catch(xe){Yt.error(xe.message||"Erro ao atualizar status da diria.")}finally{Y(null)}},Ze=(Je,Te)=>{const xe=que[Xu(Te)];return xe?d.jsx(Bt,{size:"sm",variant:"outline",disabled:V===Je,onClick:()=>Ae(Je,xe.nextStatus),children:xe.label}):null},Xe=async Je=>{const Te=q[Je];if(!Te){Yt.error("Selecione um status para atualizar.");return}await Ae(Je,Te),Z(xe=>({...xe,[Je]:""}))};return d.jsx(bo,{children:d.jsxs("div",{className:"space-y-6 p-4 md:p-6",children:[d.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-sm text-muted-foreground uppercase tracking-wide",children:"Di\\u00e1rias"}),d.jsx("h1",{className:"text-3xl font-bold",children:t}),d.jsx("p",{className:"text-sm text-muted-foreground",children:i})]}),d.jsx(gr,{type:"month",value:_,onChange:Je=>x(Je.target.value),className:"w-auto"})]}),pe&&le&&d.jsx(Sr,{children:d.jsxs(tn,{className:"flex items-center justify-between py-4",children:[d.jsx("p",{className:"text-sm text-muted-foreground",children:"Existem di\\u00e1rias neste status fora do m\\u00eas selecionado."}),d.jsx(Bt,{variant:"outline",size:"sm",onClick:()=>x(le),children:"Ver m\\u00eas com registros"})]})}),d.jsxs(Sr,{children:[d.jsxs(wn,{className:"flex flex-row items-center justify-between",children:[d.jsxs("div",{children:[d.jsx(An,{className:"text-lg",children:B0[e]}),d.jsxs(fs,{children:["Per\\u00edodo selecionado: ",_]})]}),d.jsxs(Gn,{variant:$ue[e]||"outline",children:[K.length," di\\u00e1ria(s)"]})]}),d.jsx(tn,{className:"overflow-x-auto",children:K.length===0?d.jsx("p",{className:"text-sm text-muted-foreground text-center py-6",children:l||"Nenhuma diria encontrada para este status no perodo selecionado."}):d.jsxs(Jl,{children:[d.jsx(Ql,{children:d.jsxs(Yi,{children:[d.jsx(Yr,{children:"Data"}),d.jsx(Yr,{children:"Posto"}),d.jsx(Yr,{children:"Unidade"}),d.jsx(Yr,{children:"Diarista"}),d.jsx(Yr,{children:"Valor"}),d.jsx(Yr,{children:"Atualizado em"}),d.jsx(Yr,{className:"text-right",children:"A\\u00e7\\u00f5es"})]})}),d.jsx(ec,{children:K.map(Je=>{var dt;const Te=A.get(Je.posto_dia_vago_id),xe=Te==null?void 0:Te.posto,Be=I.get(Je.diarista_id);return d.jsxs(Yi,{children:[d.jsx(Pr,{children:tk(Te==null?void 0:Te.data)}),d.jsx(Pr,{children:(xe==null?void 0:xe.nome)||"-"}),d.jsx(Pr,{children:((dt=xe==null?void 0:xe.unidade)==null?void 0:dt.nome)||"-"}),d.jsx(Pr,{children:(Be==null?void 0:Be.nome_completo)||"-"}),d.jsx(Pr,{children:Gue.format(Je.valor||0)}),d.jsx(Pr,{children:Hue(Je.updated_at)}),d.jsx(Pr,{children:d.jsxs("div",{className:"flex flex-col items-end gap-2",children:[Ze(Je.id,Je.status),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsxs(Vr,{value:q[Je.id]||"",onValueChange:qt=>Z(Ke=>({...Ke,[Je.id]:qt})),children:[d.jsx(Or,{className:"w-[220px]",children:d.jsx(Ur,{placeholder:"Alterar status"})}),d.jsx(Lr,{children:Q.map(qt=>d.jsx(bt,{value:qt,children:B0[qt]},qt))})]}),d.jsx(Bt,{size:"sm",variant:"secondary",disabled:V===Je.id||!q[Je.id]||q[Je.id]===Je.status,onClick:()=>Xe(Je.id),children:"Aplicar"})]})]})})]},Je.id)})})]})})]}),N&&d.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Atualizando informa\\u00e7\\u00f5es..."})]})})},Kue=Qy(Jy[0]),Yue=Qy(Jy[1]),Jue=Qy(Jy[2]),Que=Qy(Jy[3]),ede=Qy(Jy[4]),tde=Qy(Jy[5]),rde={[di.aguardando]:"/diarias/aguardando",[di.confirmada]:"/diarias/confirmadas",[di.aprovada]:"/diarias/aprovadas",[di.lancada]:"/diarias/lancadas",[di.aprovadaPagamento]:"/diarias/aprovadas-pagamento",[di.cancelada]:"/diarias/canceladas"},nde=[di.aguardando,di.confirmada,di.aprovada,di.lancada,di.aprovadaPagamento,di.cancelada];function ide(){const e=Xf(),[t,i]=F.useState(w8),[l,f]=F.useState({postoDiaVagoId:"",diaristaId:"",valor:""}),[_,x]=F.useState({diaVagoId:"",colaboradorId:""}),[o,A]=F.useState(!1),[I,N]=F.useState(!1),[U,$]=F.useState(!1),[V,Y]=F.useState([]),{availableDiasVagos:q,diaristas:Z,filteredDiarias:Q,refetchDiarias:H,refetchDiasVagos:K,loadingDiarias:ne}=S8(t),le=F.useMemo(()=>{const Te=Z.filter(xe=>xe.status?xe.status.toLowerCase()==="ativo":!0);return Te.length>0?Te:Z},[Z]),pe=F.useMemo(()=>Q.reduce((Te,xe)=>{const Be=Xu(xe.status);return Te[Be]=(Te[Be]||0)+1,Te},{}),[Q]),Ae=async()=>{if(!l.diaristaId)return!1;$(!0);try{const{count:Te,error:xe}=await Ge.from("diarias").select("id",{count:"exact",head:!0}).eq("diarista_id",l.diaristaId).eq("status",di.aguardando);if(xe)throw xe;return(Te||0)>0}finally{$(!1)}},Ze=async()=>{const{data:Te,error:xe}=await Ge.from("colaboradores").select("id, nome_completo, cargo").is("posto_servico_id",null).or("status_colaborador.eq.ativo,status.eq.ativo").order("nome_completo");if(xe){Yt.error("Erro ao carregar colaboradores de reserva.");return}Y(Te||[])};F.useEffect(()=>{Ze()},[]);const Xe=async Te=>{if(Te.preventDefault(),!l.postoDiaVagoId||!l.diaristaId||!l.valor){Yt.error("Selecione o dia vago, diarista e informe o valor.");return}A(!0);try{if(await Ae()){Yt.error("O diarista possui dirias aguardando confirmao. Confirme ou cancele antes de registrar uma nova."),A(!1);return}const Be=Number(l.valor);if(Number.isNaN(Be)||Be<=0){Yt.error("Valor da diria invlido."),A(!1);return}const{error:dt}=await Ge.from("diarias").insert({posto_dia_vago_id:l.postoDiaVagoId,diarista_id:l.diaristaId,valor:Be});if(dt)throw dt;Yt.success("Diria registrada com sucesso."),f({postoDiaVagoId:"",diaristaId:"",valor:""}),await Promise.all([H(),K()])}catch(xe){typeof(xe==null?void 0:xe.message)=="string"&&xe.message.includes('dirias com status "Aguardando confirmacao"')?Yt.error("O diarista possui dirias aguardando confirmao. Confirme ou cancele antes de registrar uma nova."):Yt.error(xe.message||"Erro ao registrar diria.")}finally{A(!1)}},Je=async Te=>{if(Te.preventDefault(),!_.diaVagoId||!_.colaboradorId){Yt.error("Selecione o dia vago e o colaborador.");return}const xe=q.find(Be=>Be.id===_.diaVagoId);if(!xe){Yt.error("Dia vago invlido ou indisponvel.");return}N(!0);try{const{data:{user:Be}}=await Ge.auth.getUser();if(!Be)throw new Error("Usurio no autenticado");await dR({postoId:xe.posto_servico_id,colaboradorId:_.colaboradorId,data:xe.data,usuarioId:Be.id}),Yt.success("Ocupao agendada com sucesso."),x({diaVagoId:"",colaboradorId:""}),await Promise.all([K(),H()]),await Ze(),await e.invalidateQueries({queryKey:["colaboradores"]})}catch(Be){Yt.error(Be.message||"Erro ao agendar ocupao.")}finally{N(!1)}};return d.jsx(bo,{children:d.jsxs("div",{className:"space-y-6 p-4 md:p-6",children:[d.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-sm text-muted-foreground uppercase tracking-wide",children:"Gest\\u00e3o de di\\u00e1rias"}),d.jsx("h1",{className:"text-3xl font-bold",children:"Di\\u00e1rias e pagamento"}),d.jsx("p",{className:"text-sm text-muted-foreground",children:"Cadastre novas di\\u00e1rias e acesse rapidamente cada etapa do fluxo pelo menu lateral."})]}),d.jsx(gr,{type:"month",value:t,onChange:Te=>i(Te.target.value),className:"w-auto"})]}),d.jsxs(Sr,{children:[d.jsxs(wn,{children:[d.jsx(An,{children:"Registrar di\\u00e1ria"}),d.jsx(fs,{children:'Selecione um dia vago, vincule um diarista e informe o valor. O status inicial ser\\u00e1 "Aguardando confirma\\u00e7\\u00e3o".'})]}),d.jsx(tn,{children:d.jsxs("form",{className:"grid gap-4 md:grid-cols-3",onSubmit:Xe,children:[d.jsxs("div",{className:"space-y-2 md:col-span-2",children:[d.jsx(Gt,{children:"Dia vago"}),d.jsxs(Vr,{value:l.postoDiaVagoId,onValueChange:Te=>f(xe=>({...xe,postoDiaVagoId:Te})),children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Selecione o dia vago"})}),d.jsx(Lr,{className:"max-h-72 overflow-y-auto",children:q.length===0?d.jsx(bt,{value:"none",disabled:!0,children:"Nenhum dia vago dispon\\u00edvel no per\\u00edodo"}):q.map(Te=>{var xe,Be;return d.jsxs(bt,{value:Te.id,children:[tk(Te.data)," - ",((xe=Te.posto)==null?void 0:xe.codigo)||"Sem cdigo"," ",(Be=Te.posto)==null?void 0:Be.nome,Te.motivo?`  Motivo: ${Te.motivo}`:""]},Te.id)})})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Diarista"}),d.jsxs(Vr,{value:l.diaristaId,onValueChange:Te=>f(xe=>({...xe,diaristaId:Te})),children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Selecione o diarista"})}),d.jsx(Lr,{className:"max-h-72 overflow-y-auto",children:le.length===0?d.jsx(bt,{value:"none",disabled:!0,children:"Nenhum diarista cadastrado"}):le.map(Te=>d.jsxs(bt,{value:Te.id,children:[Te.nome_completo,Te.status&&Te.status.toLowerCase()!=="ativo"?` (${Te.status})`:""]},Te.id))})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Valor"}),d.jsx(gr,{type:"number",min:"0",step:"0.01",placeholder:"0,00",value:l.valor,onChange:Te=>f(xe=>({...xe,valor:Te.target.value}))})]}),d.jsx("div",{className:"md:col-span-3 flex justify-end",children:d.jsx(Bt,{type:"submit",disabled:o||U||q.length===0,children:U?"Validando...":o?"Registrando...":"Cadastrar diria"})})]})})]}),d.jsxs(Sr,{children:[d.jsxs(wn,{children:[d.jsx(An,{children:"Agendar ocupao com colaborador interno"}),d.jsx(fs,{children:"Use um colaborador ativo e disponvel para cobrir um dia vago sem registrar uma diria."})]}),d.jsx(tn,{children:d.jsxs("form",{className:"grid gap-4 md:grid-cols-3",onSubmit:Je,children:[d.jsxs("div",{className:"space-y-2 md:col-span-2",children:[d.jsx(Gt,{children:"Dia vago"}),d.jsxs(Vr,{value:_.diaVagoId,onValueChange:Te=>x(xe=>({...xe,diaVagoId:Te})),children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Selecione o dia vago"})}),d.jsx(Lr,{className:"max-h-72 overflow-y-auto",children:q.length===0?d.jsx(bt,{value:"none",disabled:!0,children:"Nenhum dia vago disponvel no perodo"}):q.map(Te=>{var xe,Be;return d.jsxs(bt,{value:Te.id,children:[tk(Te.data)," - ",((xe=Te.posto)==null?void 0:xe.codigo)||""," ",(Be=Te.posto)==null?void 0:Be.nome]},Te.id)})})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Colaborador"}),d.jsxs(Vr,{value:_.colaboradorId,onValueChange:Te=>x(xe=>({...xe,colaboradorId:Te})),children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Selecione o colaborador"})}),d.jsx(Lr,{className:"max-h-72 overflow-y-auto",children:V.length===0?d.jsx(bt,{value:"none",disabled:!0,children:"Nenhum colaborador reserva disponvel"}):V.map(Te=>d.jsxs(bt,{value:Te.id,children:[Te.nome_completo,Te.cargo?`  ${Te.cargo}`:""]},Te.id))})]})]}),d.jsx("div",{className:"md:col-span-3 flex justify-end",children:d.jsx(Bt,{type:"submit",disabled:I||q.length===0||V.length===0,children:I?"Agendando...":"Agendar ocupao"})})]})})]}),d.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 xl:grid-cols-3",children:nde.map(Te=>{const xe=Xu(Te);return d.jsxs(Sr,{children:[d.jsxs(wn,{className:"pb-3",children:[d.jsxs(An,{className:"text-lg flex items-center justify-between",children:[d.jsx("span",{children:B0[Te]}),d.jsxs("span",{className:"text-sm font-normal text-muted-foreground",children:[pe[xe]||0," di\\u00e1ria(s)"]})]}),d.jsxs(fs,{children:["Acesse a lista completa de di\\u00e1rias ",B0[Te].toLowerCase()," em uma p\\u00e1gina dedicada."]})]}),d.jsxs(tn,{className:"flex justify-between items-end",children:[d.jsxs("div",{className:"text-sm text-muted-foreground",children:[Te===di.aguardando&&"Confirme as dirias registradas recentemente.",Te===di.confirmada&&"Avance as dirias confirmadas para aprovao.",Te===di.aprovada&&"Prepare as dirias aprovadas para lanamento.",Te===di.lancada&&"Gerencie as dirias lanadas para pagamento.",Te===di.aprovadaPagamento&&"Acompanhe as dirias aprovadas para pagamento.",Te===di.cancelada&&"Histrico de dirias canceladas."]}),d.jsx(Bt,{asChild:!0,variant:"outline",size:"sm",children:d.jsx(aV,{to:rde[Te],children:"Ver detalhes"})})]})]},Te)})}),ne&&d.jsx("p",{className:"text-center text-sm text-muted-foreground",children:"Carregando di\\u00e1rias cadastradas..."})]})})}const kF={unidade_id:"",posto_id:"",dia_inspecao:"",responsavel:"",checklistIds:[],checklistItemIds:[]},sde=["supervisor","gestor_operacoes","admin"],ode=()=>{const[e,t]=F.useState([]),[i,l]=F.useState([]),[f,_]=F.useState([]),[x,o]=F.useState([]),[A,I]=F.useState([]),[N,U]=F.useState([]),[$,V]=F.useState(kF),[Y,q]=F.useState(null),[Z,Q]=F.useState(!1),[H,K]=F.useState(!1),ne=F.useCallback((fe,Le)=>{const vt=new Set(N.filter(Wt=>Wt.checklist_id!==null&&fe.includes(Wt.checklist_id)).map(Wt=>Wt.id));return Le.filter(Wt=>vt.has(Wt))},[N]),le=F.useCallback(async()=>{const{data:fe,error:Le}=await Ge.from("inspecoes").select(`
        id,
        unidade_id,
        posto_id,
        responsavel,
        dia_inspecao,
        unidade:unidades ( nome ),
        posto:postos_servico ( nome ),
        responsavel_profile:profiles ( full_name ),
        rel_checklists:inspecoes_checklists (
          checklist_id,
          checklist:checklist (
            id,
            nome,
            periodicidade
          )
        ),
        rel_checklist_itens:inspecoes_checklist_itens (
          checklist_item_id,
          checklist_item:checklist_item (
            id,
            descricao,
            checklist_id
          )
        )
      `).order("dia_inspecao",{ascending:!1});if(Le){console.error(Le),Yt.error("Nao foi possivel carregar as inspecoes");return}t(fe??[])},[]),pe=F.useCallback(async()=>{const{data:fe,error:Le}=await Ge.from("unidades").select("id, nome").order("nome");if(Le){Yt.error("Nao foi possivel carregar as unidades");return}l(fe??[])},[]),Ae=F.useCallback(async()=>{const{data:fe,error:Le}=await Ge.from("postos_servico").select("id, nome, unidade_id").order("nome");if(Le){Yt.error("Nao foi possivel carregar os postos");return}_(fe??[])},[]),Ze=F.useCallback(async()=>{const{data:fe,error:Le}=await Ge.from("user_roles").select("user_id, role").in("role",sde);if(Le){Yt.error("Nao foi possivel carregar os responsaveis");return}const vt=(fe==null?void 0:fe.map(Ut=>Ut.user_id))??[];if(vt.length===0){o([]);return}const{data:Wt,error:Ft}=await Ge.from("profiles").select("id, full_name, email").in("id",vt);if(Ft){Yt.error("Nao foi possivel carregar os perfis");return}o((Wt??[]).map(Ut=>({id:Ut.id,nome:Ut.full_name||Ut.email||"Usuario sem nome"})))},[]),Xe=F.useCallback(async()=>{const{data:fe,error:Le}=await Ge.from("checklist").select("id, nome, periodicidade").order("nome");if(Le){Yt.error("Nao foi possivel carregar os checklists");return}I(fe??[])},[]),Je=F.useCallback(async()=>{const{data:fe,error:Le}=await Ge.from("checklist_item").select("id, descricao, checklist_id, ordem").order("ordem",{ascending:!0});if(Le){Yt.error("Nao foi possivel carregar os itens de checklist");return}U(fe??[])},[]),Te=F.useCallback(async()=>{Q(!0);try{await Promise.all([le(),pe(),Ae(),Ze(),Xe(),Je()])}finally{Q(!1)}},[le,pe,Ae,Ze,Xe,Je]);F.useEffect(()=>{Te()},[Te]);const xe=F.useMemo(()=>$.unidade_id?f.filter(fe=>fe.unidade_id===$.unidade_id):f,[f,$.unidade_id]),Be=F.useMemo(()=>$.checklistIds.length?N.filter(fe=>fe.checklist_id&&$.checklistIds.includes(fe.checklist_id)):[],[N,$.checklistIds]),dt=fe=>({diaria:"Diria",semanal:"Semanal",quinzenal:"Quinzenal",mensal:"Mensal",trimestral:"Trimestral",semestral:"Semestral",anual:"Anual"})[fe]??fe,qt=F.useCallback(async(fe,Le,vt)=>{if(await Ge.from("inspecoes_checklists").delete().eq("inspecao_id",fe),Le.length){const Wt=Le.map(Ut=>({inspecao_id:fe,checklist_id:Ut})),{error:Ft}=await Ge.from("inspecoes_checklists").insert(Wt);if(Ft)throw Ft}if(await Ge.from("inspecoes_checklist_itens").delete().eq("inspecao_id",fe),vt.length){const Wt=vt.map(Ut=>({inspecao_id:fe,checklist_item_id:Ut})),{error:Ft}=await Ge.from("inspecoes_checklist_itens").insert(Wt);if(Ft)throw Ft}},[]),Ke=async fe=>{if(fe.preventDefault(),!$.unidade_id||!$.posto_id||!$.dia_inspecao||!$.responsavel||$.checklistIds.length===0){Yt.warning("Preencha todos os campos obrigatorios e selecione ao menos um checklist");return}K(!0);const Le={unidade_id:$.unidade_id,posto_id:$.posto_id,responsavel:$.responsavel,dia_inspecao:new Date($.dia_inspecao).toISOString()},vt=ne($.checklistIds,$.checklistItemIds);try{let Wt=Y;if(Y){const{error:Ft}=await Ge.from("inspecoes").update(Le).eq("id",Y);if(Ft)throw Ft}else{const{data:Ft,error:Ut}=await Ge.from("inspecoes").insert(Le).select("id").single();if(Ut)throw Ut;Wt=(Ft==null?void 0:Ft.id)??null}if(!Wt)throw new Error("Nao foi possivel identificar a inspecao criada/atualizada.");await qt(Wt,$.checklistIds,vt),Yt.success("Inspecao salva com sucesso"),De(),le()}catch(Wt){console.error(Wt),Yt.error("Erro ao salvar inspecao")}finally{K(!1)}},st=fe=>{const Le=(fe.rel_checklists??[]).map(Wt=>Wt.checklist_id),vt=(fe.rel_checklist_itens??[]).map(Wt=>Wt.checklist_item_id);q(fe.id),V({unidade_id:fe.unidade_id,posto_id:fe.posto_id,responsavel:fe.responsavel,dia_inspecao:fe.dia_inspecao?new Date(fe.dia_inspecao).toISOString().slice(0,16):"",checklistIds:Le,checklistItemIds:ne(Le,vt)})},Ne=async fe=>{if(!confirm("Deseja realmente excluir esta inspecao?"))return;const{error:Le}=await Ge.from("inspecoes").delete().eq("id",fe);if(Le){Yt.error("Erro ao excluir inspecao");return}Yt.success("Inspecao excluida"),le()},De=()=>{V(kF),q(null)},Tt=(fe,Le)=>{V(vt=>{const Wt=Le?Array.from(new Set([...vt.checklistIds,fe])):vt.checklistIds.filter(Ut=>Ut!==fe),Ft=ne(Wt,vt.checklistItemIds);return{...vt,checklistIds:Wt,checklistItemIds:Ft}})},Pt=(fe,Le)=>{V(vt=>{const Wt=Le?Array.from(new Set([...vt.checklistItemIds,fe])):vt.checklistItemIds.filter(Ft=>Ft!==fe);return{...vt,checklistItemIds:Wt}})};return d.jsx(bo,{children:d.jsxs("div",{className:"p-6 space-y-6",children:[d.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-3xl font-bold",children:"Inspecoes"}),d.jsx("p",{className:"text-muted-foreground",children:"Cadastre e acompanhe inspecoes realizadas em campo."})]}),d.jsxs(Bt,{variant:"outline",onClick:Te,disabled:Z,children:[d.jsx(Uy,{className:`h-4 w-4 mr-2 ${Z?"animate-spin":""}`}),"Atualizar"]})]}),d.jsxs(Sr,{children:[d.jsx(wn,{children:d.jsx(An,{children:Y?"Editar inspecao":"Nova inspecao"})}),d.jsx(tn,{children:d.jsxs("form",{onSubmit:Ke,className:"space-y-4",children:[d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Unidade *"}),d.jsxs(Vr,{value:$.unidade_id,onValueChange:fe=>V(Le=>({...Le,unidade_id:fe,posto_id:""})),children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Selecione"})}),d.jsxs(Lr,{children:[i.map(fe=>d.jsx(bt,{value:fe.id,children:fe.nome},fe.id)),i.length===0&&d.jsx(bt,{value:"__placeholder",disabled:!0,children:"Nenhuma unidade cadastrada"})]})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Posto *"}),d.jsxs(Vr,{value:$.posto_id,onValueChange:fe=>V(Le=>({...Le,posto_id:fe})),disabled:!$.unidade_id,children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:$.unidade_id?"Selecione":"Escolha uma unidade primeiro"})}),d.jsxs(Lr,{children:[xe.map(fe=>d.jsx(bt,{value:fe.id,children:fe.nome},fe.id)),xe.length===0&&d.jsx(bt,{value:"__placeholder",disabled:!0,children:"Nenhum posto encontrado"})]})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Responsavel *"}),d.jsxs(Vr,{value:$.responsavel,onValueChange:fe=>V(Le=>({...Le,responsavel:fe})),children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Selecione"})}),d.jsxs(Lr,{children:[x.map(fe=>d.jsx(bt,{value:fe.id,children:fe.nome},fe.id)),x.length===0&&d.jsx(bt,{value:"__placeholder",disabled:!0,children:"Nenhum responsavel encontrado"})]})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Data da inspecao *"}),d.jsx(gr,{type:"datetime-local",value:$.dia_inspecao,onChange:fe=>V(Le=>({...Le,dia_inspecao:fe.target.value}))})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Checklists vinculados *"}),A.length>0?d.jsx("div",{className:"grid gap-2 md:grid-cols-2",children:A.map(fe=>{const Le=$.checklistIds.includes(fe.id);return d.jsxs("label",{className:`flex cursor-pointer items-center justify-between rounded-md border p-3 text-sm ${Le?"border-primary bg-primary/5":"border-muted"}`,children:[d.jsxs("span",{className:"flex flex-col",children:[d.jsx("span",{className:"font-medium",children:fe.nome}),d.jsx("span",{className:"text-xs text-muted-foreground",children:dt(fe.periodicidade)})]}),d.jsx("input",{type:"checkbox",className:"h-4 w-4",checked:Le,onChange:vt=>Tt(fe.id,vt.target.checked)})]},fe.id)})}):d.jsx("p",{className:"text-sm text-muted-foreground",children:"Cadastre um checklist antes de criar uma inspecao."})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Itens de checklist (opcional)"}),$.checklistIds.length===0?d.jsx("p",{className:"text-sm text-muted-foreground",children:"Selecione um checklist para visualizar os itens disponiveis."}):d.jsxs("div",{className:"max-h-48 space-y-1 overflow-y-auto rounded-md border p-3",children:[Be.map(fe=>{const Le=$.checklistItemIds.includes(fe.id);return d.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[d.jsx("input",{type:"checkbox",className:"h-4 w-4",checked:Le,onChange:vt=>Pt(fe.id,vt.target.checked)}),d.jsx("span",{children:fe.descricao})]},fe.id)}),Be.length===0&&d.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum item cadastrado para os checklists selecionados."})]})]}),d.jsxs("div",{className:"flex gap-2 flex-wrap",children:[d.jsx(Bt,{type:"submit",disabled:H||A.length===0,children:H?"Salvando...":Y?"Atualizar inspecao":"Cadastrar inspecao"}),Y&&d.jsx(Bt,{type:"button",variant:"secondary",onClick:De,children:"Cancelar"})]})]})})]}),d.jsxs(Sr,{children:[d.jsx(wn,{children:d.jsx(An,{children:"Historico de inspecoes"})}),d.jsx(tn,{children:d.jsxs(Jl,{children:[d.jsx(Ql,{children:d.jsxs(Yi,{children:[d.jsx(Yr,{children:"ID"}),d.jsx(Yr,{children:"Data"}),d.jsx(Yr,{children:"Unidade"}),d.jsx(Yr,{children:"Posto"}),d.jsx(Yr,{children:"Responsavel"}),d.jsx(Yr,{children:"Checklists"}),d.jsx(Yr,{children:"Itens selecionados"}),d.jsx(Yr,{children:"Acoes"})]})}),d.jsxs(ec,{children:[e.map(fe=>{var Le,vt,Wt,Ft,Ut;return d.jsxs(Yi,{children:[d.jsx(Pr,{children:fe.id}),d.jsx(Pr,{children:fe.dia_inspecao?Kn(new Date(fe.dia_inspecao),"dd/MM/yyyy HH:mm",{locale:js}):"-"}),d.jsx(Pr,{children:((Le=fe.unidade)==null?void 0:Le.nome)??"-"}),d.jsx(Pr,{children:((vt=fe.posto)==null?void 0:vt.nome)??"-"}),d.jsx(Pr,{children:((Wt=fe.responsavel_profile)==null?void 0:Wt.full_name)??"-"}),d.jsx(Pr,{className:"max-w-xs",children:(Ft=fe.rel_checklists)!=null&&Ft.length?fe.rel_checklists.map(vr=>{var xr;return(xr=vr.checklist)==null?void 0:xr.nome}).filter(Boolean).join(", "):"-"}),d.jsx(Pr,{children:(Ut=fe.rel_checklist_itens)!=null&&Ut.length?`${fe.rel_checklist_itens.length} item(ns)`:"-"}),d.jsx(Pr,{children:d.jsxs("div",{className:"flex gap-2",children:[d.jsx(Bt,{size:"icon",variant:"ghost",onClick:()=>st(fe),children:d.jsx(gu,{className:"h-4 w-4"})}),d.jsx(Bt,{size:"icon",variant:"ghost",onClick:()=>Ne(fe.id),children:d.jsx(jl,{className:"h-4 w-4"})})]})})]},fe.id)}),!Z&&e.length===0&&d.jsx(Yi,{children:d.jsx(Pr,{colSpan:8,className:"text-center text-sm text-muted-foreground",children:"Nenhuma inspecao cadastrada"})})]})]})})]})]})})},PF=[{value:"diaria",label:"Diaria"},{value:"semanal",label:"Semanal"},{value:"quinzenal",label:"Quinzenal"},{value:"mensal",label:"Mensal"},{value:"trimestral",label:"Trimestral"},{value:"semestral",label:"Semestral"},{value:"anual",label:"Anual"}],RF={nome:"",periodicidade:"mensal"},ade=()=>{const[e,t]=F.useState([]),[i,l]=F.useState(""),[f,_]=F.useState(!0),[x,o]=F.useState(!1),[A,I]=F.useState(null),[N,U]=F.useState(RF);F.useEffect(()=>{$()},[]);const $=async()=>{_(!0);try{await V()}catch(ne){console.error("Erro ao carregar dados do checklist:",ne),Yt.error("No foi possvel carregar os checklists.")}finally{_(!1)}},V=async()=>{const{data:ne,error:le}=await Ge.from("checklist").select(`
        id,
        nome,
        periodicidade,
        created_at,
        updated_at
      `).order("created_at",{ascending:!1});if(le)throw le;t(ne??[])},Y=F.useMemo(()=>{const ne=i.trim().toLowerCase();return e.filter(le=>!ne||le.nome.toLowerCase().includes(ne))},[e,i]),q=()=>{U(RF),I(null)},Z=async ne=>{if(ne.preventDefault(),!N.nome.trim()){Yt.error("Informe o nome do checklist.");return}const le={nome:N.nome.trim(),periodicidade:N.periodicidade},pe={...le,updated_at:new Date().toISOString()};try{if(o(!0),A){const{error:Ae}=await Ge.from("checklist").update(pe).eq("id",A);if(Ae)throw Ae;Yt.success("Checklist atualizado com sucesso.")}else{const{error:Ae}=await Ge.from("checklist").insert(le);if(Ae)throw Ae;Yt.success("Checklist criado com sucesso.")}await V(),q()}catch(Ae){console.error("Erro ao salvar checklist:",Ae),Yt.error("No foi possvel salvar o checklist.")}finally{o(!1)}},Q=ne=>{I(ne.id),U({nome:ne.nome,periodicidade:ne.periodicidade})},H=async ne=>{try{const{error:le}=await Ge.from("checklist").delete().eq("id",ne);if(le)throw le;Yt.success("Checklist removido com sucesso."),await V()}catch(le){console.error("Erro ao remover checklist:",le),Yt.error("No foi possvel remover o checklist.")}},K=ne=>{var le;return((le=PF.find(pe=>pe.value===ne))==null?void 0:le.label)??ne};return f?d.jsx("div",{className:"flex min-h-screen items-center justify-center",children:d.jsx("div",{className:"h-10 w-10 animate-spin rounded-full border-b-2 border-primary"})}):d.jsx(bo,{children:d.jsxs("div",{className:"space-y-6 p-4 md:p-6",children:[d.jsxs("div",{className:"flex flex-col gap-3 rounded-lg border bg-card p-4 md:flex-row md:items-center md:justify-between",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-3xl font-bold",children:"Checklists"}),d.jsx("p",{className:"text-muted-foreground",children:"Gerencie os checklists e suas periodicidades."})]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsxs(Bt,{variant:"outline",onClick:$,children:[d.jsx(Uy,{className:"mr-2 h-4 w-4"}),"Atualizar"]}),d.jsxs(Bt,{onClick:q,children:[d.jsx(Ea,{className:"mr-2 h-4 w-4"}),"Novo checklist"]})]})]}),d.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-3",children:[d.jsxs(Sr,{className:"lg:col-span-1",children:[d.jsxs(wn,{children:[d.jsx(An,{children:A?"Editar checklist":"Novo checklist"}),d.jsx(fs,{children:"Cadastre o checklist conforme o schema atualizado."})]}),d.jsx(tn,{children:d.jsxs("form",{className:"space-y-4",onSubmit:Z,children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Nome"}),d.jsx(gr,{required:!0,value:N.nome,onChange:ne=>U(le=>({...le,nome:ne.target.value})),placeholder:"Inspecao semanal, checklist de limpeza..."})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Periodicidade"}),d.jsxs(Vr,{value:N.periodicidade,onValueChange:ne=>U(le=>({...le,periodicidade:ne})),children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Selecione a periodicidade"})}),d.jsx(Lr,{className:"bg-popover",children:PF.map(ne=>d.jsx(bt,{value:ne.value,children:ne.label},ne.value))})]})]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx(Bt,{type:"submit",disabled:x,children:x?"Salvando...":A?"Atualizar":"Cadastrar"}),A&&d.jsx(Bt,{type:"button",variant:"secondary",onClick:q,children:"Cancelar"})]})]})})]}),d.jsxs(Sr,{className:"lg:col-span-2",children:[d.jsxs(wn,{children:[d.jsx(An,{children:"Checklists cadastrados"}),d.jsx(fs,{children:"Filtros rpidos por nome."})]}),d.jsxs(tn,{className:"space-y-4",children:[d.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[d.jsx(gr,{placeholder:"Buscar por nome",value:i,onChange:ne=>l(ne.target.value)}),d.jsxs("div",{className:"text-sm text-muted-foreground",children:[Y.length," checklist(s) listado(s)"]})]}),d.jsxs(Jl,{children:[d.jsx(Ql,{children:d.jsxs(Yi,{children:[d.jsx(Yr,{children:"Nome"}),d.jsx(Yr,{children:"Periodicidade"}),d.jsx(Yr,{children:"Criado em"}),d.jsx(Yr,{className:"text-right",children:"Aes"})]})}),d.jsxs(ec,{children:[Y.map(ne=>d.jsxs(Yi,{children:[d.jsx(Pr,{className:"font-medium",children:ne.nome}),d.jsx(Pr,{children:d.jsx(Gn,{variant:"secondary",className:"capitalize",children:K(ne.periodicidade)})}),d.jsx(Pr,{children:ne.created_at?Kn(new Date(ne.created_at),"dd/MM/yyyy",{locale:js}):"-"}),d.jsx(Pr,{className:"text-right",children:d.jsxs("div",{className:"flex justify-end gap-2",children:[d.jsx(Bt,{size:"icon",variant:"ghost",onClick:()=>Q(ne),children:d.jsx(gu,{className:"h-4 w-4"})}),d.jsx(Bt,{size:"icon",variant:"ghost",onClick:()=>H(ne.id),children:d.jsx(jl,{className:"h-4 w-4"})})]})})]},ne.id)),Y.length===0&&d.jsx(Yi,{children:d.jsx(Pr,{colSpan:4,className:"text-center text-muted-foreground",children:"Nenhum checklist cadastrado."})})]})]})]})]})]})]})})},MF=[{value:"diaria",label:"Diria"},{value:"semanal",label:"Semanal"},{value:"quinzenal",label:"Quinzenal"},{value:"mensal",label:"Mensal"},{value:"trimestral",label:"Trimestral"},{value:"semestral",label:"Semestral"},{value:"anual",label:"Anual"}],lde=()=>{const[e,t]=F.useState([]),[i,l]=F.useState([]),[f,_]=F.useState([]),[x,o]=F.useState(null),[A,I]=F.useState(!1),[N,U]=F.useState(!0),[$,V]=F.useState(""),[Y,q]=F.useState("all"),[Z,Q]=F.useState({checklist_id:"",descricao:"",periodicidade:"mensal",ordem:0,ativo_id:""});F.useEffect(()=>{H()},[]);const H=async()=>{try{await Promise.all([le(),K(),ne()])}catch(xe){console.error("Erro ao carregar itens de checklist:",xe),Yt.error("No foi possvel carregar os itens de checklist.")}finally{U(!1)}},K=async()=>{const{data:xe}=await Ge.from("checklist").select("id, nome, periodicidade");l(xe??[])},ne=async()=>{const{data:xe}=await Ge.from("ativos").select("id, tag_patrimonio, modelo");_(xe??[])},le=async()=>{const{data:xe,error:Be}=await Ge.from("checklist_item").select(`
        *,
        checklist:checklist ( id, nome, periodicidade ),
        ativo:ativos ( id, tag_patrimonio, modelo )
      `).order("checklist_id",{ascending:!0}).order("ordem",{ascending:!0});if(Be)throw Be;t(xe??[])},pe=()=>{Q({checklist_id:"",descricao:"",periodicidade:"mensal",ordem:0,ativo_id:""}),o(null)},Ae=async xe=>{if(xe.preventDefault(),!Z.checklist_id){Yt.error("Selecione um checklist.");return}const Be={checklist_id:Z.checklist_id,descricao:Z.descricao,periodicidade:Z.periodicidade,ordem:Z.ordem??0,ativo_id:Z.ativo_id||null};try{if(I(!0),x){const{error:dt}=await Ge.from("checklist_item").update(Be).eq("id",x);if(dt)throw dt;Yt.success("Item atualizado.")}else{const{error:dt}=await Ge.from("checklist_item").insert(Be);if(dt)throw dt;Yt.success("Item criado.")}await le(),pe()}catch(dt){console.error("Erro ao salvar item:",dt),Yt.error("No foi possvel salvar o item.")}finally{I(!1)}},Ze=xe=>{o(xe.id),Q({checklist_id:xe.checklist_id,descricao:xe.descricao,periodicidade:xe.periodicidade,ordem:xe.ordem??0,ativo_id:xe.ativo_id??""})},Xe=async xe=>{try{const{error:Be}=await Ge.from("checklist_item").delete().eq("id",xe);if(Be)throw Be;Yt.success("Item removido."),await le()}catch(Be){console.error("Erro ao remover item de checklist:",Be),Yt.error("No foi possvel remover o item.")}},Je=F.useMemo(()=>e.filter(xe=>{var qt,Ke;const Be=xe.descricao.toLowerCase().includes($.toLowerCase())||((Ke=(qt=xe.checklist)==null?void 0:qt.nome)==null?void 0:Ke.toLowerCase().includes($.toLowerCase())),dt=Y==="all"||xe.checklist_id===Y;return Be&&dt}),[e,$,Y]),Te=xe=>{var Be;return((Be=MF.find(dt=>dt.value===xe))==null?void 0:Be.label)??xe};return N?d.jsx("div",{className:"min-h-screen flex items-center justify-center",children:d.jsx("div",{className:"h-10 w-10 animate-spin rounded-full border-b-2 border-primary"})}):d.jsx(bo,{children:d.jsxs("div",{className:"space-y-6 p-4 md:p-6",children:[d.jsxs("div",{className:"flex flex-col gap-3 rounded-lg border bg-card p-4 md:flex-row md:items-center md:justify-between",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-3xl font-bold",children:"Itens de checklist"}),d.jsx("p",{className:"text-muted-foreground",children:"Cadastre e organize os itens executveis de cada checklist."})]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsxs(Bt,{variant:"outline",onClick:H,children:[d.jsx(Uy,{className:"h-4 w-4 mr-2"}),"Atualizar"]}),d.jsxs(Bt,{onClick:pe,children:[d.jsx(Ea,{className:"h-4 w-4 mr-2"}),"Novo item"]})]})]}),d.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-3",children:[d.jsxs(Sr,{className:"lg:col-span-1",children:[d.jsxs(wn,{children:[d.jsx(An,{children:x?"Editar item":"Novo item"}),d.jsx(fs,{children:"Descreva o item e vincule ao checklist correto."})]}),d.jsx(tn,{children:d.jsxs("form",{className:"space-y-4",onSubmit:Ae,children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Checklist"}),d.jsxs(Vr,{value:Z.checklist_id,onValueChange:xe=>Q(Be=>({...Be,checklist_id:xe})),children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Selecione o checklist"})}),d.jsx(Lr,{className:"bg-popover",children:i.map(xe=>d.jsx(bt,{value:xe.id,children:xe.nome},xe.id))})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Descrio"}),d.jsx(gr,{required:!0,value:Z.descricao,onChange:xe=>Q(Be=>({...Be,descricao:xe.target.value})),placeholder:"Ex.: Verificar iluminao, aferir temperatura..."})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Periodicidade especfica"}),d.jsxs(Vr,{value:Z.periodicidade,onValueChange:xe=>Q(Be=>({...Be,periodicidade:xe})),children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Periodicidade"})}),d.jsx(Lr,{className:"bg-popover",children:MF.map(xe=>d.jsx(bt,{value:xe.value,children:xe.label},xe.value))})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Ordem"}),d.jsx(gr,{type:"number",value:Z.ordem,onChange:xe=>Q(Be=>({...Be,ordem:Number(xe.target.value)}))})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Ativo relacionado (opcional)"}),d.jsxs(Vr,{value:Z.ativo_id,onValueChange:xe=>Q(Be=>({...Be,ativo_id:xe})),children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Selecione um ativo"})}),d.jsxs(Lr,{className:"bg-popover",children:[d.jsx(bt,{value:"",children:"Nenhum"}),f.map(xe=>d.jsxs(bt,{value:xe.id,children:[xe.tag_patrimonio," ",xe.modelo?`- ${xe.modelo}`:""]},xe.id))]})]})]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx(Bt,{type:"submit",disabled:A,children:A?"Salvando...":x?"Atualizar":"Cadastrar"}),x&&d.jsx(Bt,{type:"button",variant:"secondary",onClick:pe,children:"Cancelar"})]})]})})]}),d.jsxs(Sr,{className:"lg:col-span-2",children:[d.jsxs(wn,{children:[d.jsx(An,{children:"Itens cadastrados"}),d.jsx(fs,{children:"Visualize e filtre os itens por checklist."})]}),d.jsxs(tn,{className:"space-y-4",children:[d.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[d.jsx(gr,{placeholder:"Buscar por descrio ou checklist",value:$,onChange:xe=>V(xe.target.value),className:"md:w-1/2"}),d.jsxs(Vr,{value:Y,onValueChange:q,children:[d.jsx(Or,{className:"w-[240px]",children:d.jsx(Ur,{placeholder:"Filtrar checklist"})}),d.jsxs(Lr,{className:"bg-popover",children:[d.jsx(bt,{value:"all",children:"Todos"}),i.map(xe=>d.jsx(bt,{value:xe.id,children:xe.nome},xe.id))]})]})]}),d.jsxs(Jl,{children:[d.jsx(Ql,{children:d.jsxs(Yi,{children:[d.jsx(Yr,{children:"Ordem"}),d.jsx(Yr,{children:"Descrio"}),d.jsx(Yr,{children:"Checklist"}),d.jsx(Yr,{children:"Periodicidade"}),d.jsx(Yr,{children:"Ativo"}),d.jsx(Yr,{className:"text-right",children:"Aes"})]})}),d.jsxs(ec,{children:[Je.map(xe=>{var Be;return d.jsxs(Yi,{children:[d.jsx(Pr,{children:xe.ordem}),d.jsx(Pr,{className:"font-medium",children:xe.descricao}),d.jsx(Pr,{children:((Be=xe.checklist)==null?void 0:Be.nome)||"-"}),d.jsx(Pr,{children:d.jsx(Gn,{variant:"outline",className:"capitalize",children:Te(xe.periodicidade)})}),d.jsx(Pr,{children:xe.ativo?d.jsxs("div",{className:"flex flex-col",children:[d.jsx("span",{children:xe.ativo.tag_patrimonio}),d.jsx("span",{className:"text-xs text-muted-foreground",children:xe.ativo.modelo})]}):d.jsx("span",{className:"text-muted-foreground",children:"-"})}),d.jsx(Pr,{className:"text-right",children:d.jsxs("div",{className:"flex justify-end gap-2",children:[d.jsx(Bt,{size:"icon",variant:"ghost",onClick:()=>Ze(xe),children:d.jsx(gu,{className:"h-4 w-4"})}),d.jsx(Bt,{size:"icon",variant:"ghost",onClick:()=>Xe(xe.id),children:d.jsx(jl,{className:"h-4 w-4"})})]})})]},xe.id)}),Je.length===0&&d.jsx(Yi,{children:d.jsx(Pr,{colSpan:6,className:"text-center text-muted-foreground",children:"Nenhum item cadastrado."})})]})]})]})]})]})]})})},HS={ativo:"Ativo",concluido:"Concluido",atrasado:"Atrasado",cancelado:"Cancelado"},NF=Object.entries(HS).filter(([e])=>e!=="concluido"),DF={checklist_id:"none",data_prevista:"",supervisor_id:"none",status:"ativo",contrato_id:"none",unidade_id:"none"},cde=()=>{const[e,t]=F.useState([]),[i,l]=F.useState([]),[f,_]=F.useState([]),[x,o]=F.useState([]),[A,I]=F.useState([]),[N,U]=F.useState(null),[$,V]=F.useState(!1),[Y,q]=F.useState(null),[Z,Q]=F.useState(!0),[H,K]=F.useState("all"),[ne,le]=F.useState(DF);F.useEffect(()=>{pe()},[]);const pe=async()=>{try{await Promise.all([Ae(),Je(),Ze(),Xe(),Te()])}catch(fe){console.error("Erro ao carregar execucoes:",fe),Yt.error("No foi possvel carregar as execues de checklist.")}finally{Q(!1)}},Ae=async()=>{const{data:fe,error:Le}=await Ge.from("checklist").select("id, nome, periodicidade").order("nome");if(Le)throw Le;l(fe??[])},Ze=async()=>{const{data:fe,error:Le}=await Ge.from("contratos").select("id, nome, codigo").order("nome");if(Le)throw Le;o(fe??[])},Xe=async()=>{const{data:fe,error:Le}=await Ge.from("unidades").select("id, nome, codigo, contrato_id").order("nome");if(Le)throw Le;I(fe??[])},Je=async()=>{const{data:fe}=await Ge.from("user_roles").select("user_id").eq("role","supervisor");let Le=Ge.from("profiles").select("id, full_name");fe&&fe.length>0&&(Le=Le.in("id",fe.map(Ft=>Ft.user_id)));const{data:vt,error:Wt}=await Le;if(Wt)throw Wt;_(vt??[])},Te=async()=>{const{data:fe,error:Le}=await Ge.from("execucao_checklist").select(`
        id,
        checklist_id,
        data_prevista,
        supervisor_id,
        status,
        contrato_id,
        unidade_id,
        finalizado_em,
        created_at,
        updated_at,
        checklist:checklist ( id, nome, periodicidade ),
        supervisor:profiles ( id, full_name ),
        contrato:contratos ( id, nome, codigo ),
        unidade:unidades ( id, nome, codigo, contrato_id )
      `).order("data_prevista",{ascending:!1});if(Le)throw Le;t(fe??[])},xe=async fe=>{const{data:Le,error:vt}=await Ge.from("checklist_item").select("id, checklist_id").eq("checklist_id",fe);if(vt)throw vt;return Le??[]},Be=async(fe,Le,vt,Wt,Ft)=>{const Ut=await xe(Le);if(Ut.length===0)return;const vr=Ut.map(xr=>({execucao_checklist_id:fe,checklist_item_id:xr.id,data_prevista:vt,status:"ativo",contrato_id:Wt,unidade_id:Ft}));await Ge.from("execucao_checklist_item").insert(vr)},dt=()=>{le(DF),U(null)},qt=async fe=>{if(fe.preventDefault(),ne.checklist_id==="none"||!ne.data_prevista){Yt.error("Selecione um checklist e a data prevista.");return}const Le=ne.contrato_id==="none"?null:ne.contrato_id,vt=ne.unidade_id==="none"?null:ne.unidade_id,Wt={checklist_id:ne.checklist_id,data_prevista:ne.data_prevista,supervisor_id:ne.supervisor_id==="none"?null:ne.supervisor_id,status:ne.status,contrato_id:Le,unidade_id:vt};try{if(V(!0),N){const{error:Ft}=await Ge.from("execucao_checklist").update(Wt).eq("id",N);if(Ft)throw Ft;Yt.success("Execuo atualizada.")}else{const{data:Ft,error:Ut}=await Ge.from("execucao_checklist").insert(Wt).select("id, checklist_id, data_prevista, contrato_id, unidade_id").single();if(Ut)throw Ut;Ft&&await Be(Ft.id,Ft.checklist_id,Ft.data_prevista,Ft.contrato_id??null,Ft.unidade_id??null),Yt.success("Execuo criada.")}await Te(),dt()}catch(Ft){console.error("Erro ao salvar execuo:",Ft),Yt.error("No foi possvel salvar a execuo.")}finally{V(!1)}},Ke=fe=>{U(fe.id),le({checklist_id:fe.checklist_id,data_prevista:fe.data_prevista,supervisor_id:fe.supervisor_id??"none",status:fe.status,contrato_id:fe.contrato_id??"none",unidade_id:fe.unidade_id??"none"})},st=async(fe,Le)=>{try{const{error:vt}=await Ge.from("execucao_checklist").update({status:Le}).eq("id",fe);if(vt)throw vt;Yt.success("Status atualizado."),await Te()}catch(vt){console.error("Erro ao atualizar status:",vt),Yt.error("No foi possvel atualizar o status.")}},Ne=async fe=>{try{q(fe);const{data:Le}=await Ge.from("execucao_checklist_item").select("id").eq("execucao_checklist_id",fe),vt=(Le||[]).map(vr=>vr.id);if(vt.length>0){const{error:vr}=await Ge.from("resposta_execucao_checklist_item").delete().in("execucao_checklist_item_id",vt);if(vr)throw vr}const{error:Wt}=await Ge.from("resposta_execucao_checklist").delete().eq("execucao_checklist_id",fe);if(Wt)throw Wt;const{error:Ft}=await Ge.from("execucao_checklist_item").delete().eq("execucao_checklist_id",fe);if(Ft)throw Ft;const{error:Ut}=await Ge.from("execucao_checklist").delete().eq("id",fe);if(Ut)throw Ut;Yt.success("Execuo excluda."),await Te()}catch(Le){console.error("Erro ao excluir execuo:",Le),Yt.error("No foi possvel excluir a execuo.")}finally{q(null)}},De=F.useMemo(()=>e.filter(fe=>H==="all"||fe.status===H),[e,H]),Tt=fe=>{switch(fe){case"concluido":return"default";case"atrasado":return"destructive";case"cancelado":return"secondary";default:return"outline"}},Pt=F.useMemo(()=>ne.contrato_id==="none"?A:A.filter(fe=>fe.contrato_id===ne.contrato_id),[ne.contrato_id,A]);return Z?d.jsx("div",{className:"flex min-h-screen items-center justify-center",children:d.jsx("div",{className:"h-10 w-10 animate-spin rounded-full border-b-2 border-primary"})}):d.jsx(bo,{children:d.jsxs("div",{className:"space-y-6 p-4 md:p-6",children:[d.jsxs("div",{className:"flex flex-col gap-3 rounded-lg border bg-card p-4 md:flex-row md:items-center md:justify-between",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-3xl font-bold",children:"Execues de checklist"}),d.jsx("p",{className:"text-muted-foreground",children:"Agende e acompanhe execues vinculadas a contrato e unidade (schema atualizado)."})]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsxs(Bt,{variant:"outline",onClick:pe,children:[d.jsx(Uy,{className:"mr-2 h-4 w-4"}),"Atualizar"]}),d.jsxs(Bt,{onClick:dt,children:[d.jsx(Ea,{className:"h-4 w-4 mr-2"}),"Nova execuo"]})]})]}),d.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-3",children:[d.jsxs(Sr,{className:"lg:col-span-1",children:[d.jsxs(wn,{children:[d.jsx(An,{children:N?"Editar execuo":"Nova execuo"}),d.jsx(fs,{children:"Checklist, contrato/unidade, data e supervisor."})]}),d.jsx(tn,{children:d.jsxs("form",{className:"space-y-4",onSubmit:qt,children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Checklist"}),d.jsxs(Vr,{value:ne.checklist_id,onValueChange:fe=>le(Le=>({...Le,checklist_id:fe})),children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Selecione o checklist"})}),d.jsxs(Lr,{className:"bg-popover",children:[d.jsx(bt,{value:"none",children:"Selecione..."}),i.map(fe=>d.jsx(bt,{value:fe.id,children:fe.nome},fe.id))]})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Contrato"}),d.jsxs(Vr,{value:ne.contrato_id,onValueChange:fe=>le(Le=>({...Le,contrato_id:fe,unidade_id:fe==="none"?"none":Le.unidade_id})),children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Selecione o contrato"})}),d.jsxs(Lr,{className:"bg-popover",children:[d.jsx(bt,{value:"none",children:"Sem contrato"}),x.map(fe=>d.jsxs(bt,{value:fe.id,children:[fe.nome," (",fe.codigo,")"]},fe.id))]})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Unidade"}),d.jsxs(Vr,{value:ne.unidade_id,onValueChange:fe=>le(Le=>({...Le,unidade_id:fe})),children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Selecione a unidade"})}),d.jsxs(Lr,{className:"bg-popover",children:[d.jsx(bt,{value:"none",children:"Sem unidade"}),Pt.map(fe=>d.jsxs(bt,{value:fe.id,children:[fe.nome," (",fe.codigo,")"]},fe.id))]})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Data prevista"}),d.jsx(gr,{type:"date",value:ne.data_prevista,onChange:fe=>le(Le=>({...Le,data_prevista:fe.target.value}))})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Supervisor"}),d.jsxs(Vr,{value:ne.supervisor_id,onValueChange:fe=>le(Le=>({...Le,supervisor_id:fe})),children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Selecione o supervisor"})}),d.jsxs(Lr,{className:"bg-popover",children:[d.jsx(bt,{value:"none",children:"Sem supervisor"}),f.map(fe=>d.jsx(bt,{value:fe.id,children:fe.full_name||fe.id},fe.id))]})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Status"}),d.jsxs(Vr,{value:ne.status,onValueChange:fe=>{fe!=="concluido"&&le(Le=>({...Le,status:fe}))},disabled:ne.status==="concluido",children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Status"})}),d.jsx(Lr,{className:"bg-popover",children:(ne.status==="concluido"?[...NF,["concluido",HS.concluido]]:NF).map(([fe,Le])=>d.jsx(bt,{value:fe,disabled:fe==="concluido",children:Le},fe))})]})]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx(Bt,{type:"submit",disabled:$,children:$?"Salvando...":N?"Atualizar":"Agendar"}),N&&d.jsx(Bt,{type:"button",variant:"secondary",onClick:dt,children:"Cancelar"})]})]})})]}),d.jsxs(Sr,{className:"lg:col-span-2",children:[d.jsxs(wn,{children:[d.jsx(An,{children:"Execues cadastradas"}),d.jsx(fs,{children:"Visualize status e vnculos de contrato/unidade."})]}),d.jsxs(tn,{className:"space-y-4",children:[d.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[d.jsxs(Vr,{value:H,onValueChange:fe=>K(fe),children:[d.jsx(Or,{className:"w-[220px]",children:d.jsx(Ur,{placeholder:"Filtrar status"})}),d.jsxs(Lr,{className:"bg-popover",children:[d.jsx(bt,{value:"all",children:"Todos"}),Object.entries(HS).map(([fe,Le])=>d.jsx(bt,{value:fe,children:Le},fe))]})]}),d.jsxs("div",{className:"text-sm text-muted-foreground",children:[De.length," execuo(es) encontrada(s)"]})]}),d.jsxs(Jl,{children:[d.jsx(Ql,{children:d.jsxs(Yi,{children:[d.jsx(Yr,{children:"Checklist"}),d.jsx(Yr,{children:"Contrato"}),d.jsx(Yr,{children:"Unidade"}),d.jsx(Yr,{children:"Data prevista"}),d.jsx(Yr,{children:"Status"}),d.jsx(Yr,{children:"Finalizado em"}),d.jsx(Yr,{className:"text-right",children:"Aes"})]})}),d.jsxs(ec,{children:[De.map(fe=>{var Le,vt,Wt;return d.jsxs(Yi,{children:[d.jsx(Pr,{className:"font-medium",children:((Le=fe.checklist)==null?void 0:Le.nome)||"-"}),d.jsx(Pr,{children:(vt=fe.contrato)!=null&&vt.nome?d.jsxs("div",{className:"flex flex-col",children:[d.jsx("span",{children:fe.contrato.nome}),d.jsxs("span",{className:"text-xs text-muted-foreground",children:["Cod: ",fe.contrato.codigo]})]}):d.jsx("span",{className:"text-muted-foreground",children:"Sem contrato"})}),d.jsx(Pr,{children:(Wt=fe.unidade)!=null&&Wt.nome?d.jsxs("div",{className:"flex flex-col",children:[d.jsx("span",{children:fe.unidade.nome}),d.jsxs("span",{className:"text-xs text-muted-foreground",children:["Cod: ",fe.unidade.codigo]})]}):d.jsx("span",{className:"text-muted-foreground",children:"Sem unidade"})}),d.jsx(Pr,{children:fe.data_prevista?Kn(new Date(fe.data_prevista),"dd/MM/yyyy",{locale:js}):"-"}),d.jsx(Pr,{children:d.jsx(Gn,{variant:Tt(fe.status),className:"capitalize",children:HS[fe.status]})}),d.jsx(Pr,{children:fe.finalizado_em?Kn(new Date(fe.finalizado_em),"dd/MM/yyyy HH:mm",{locale:js}):"-"}),d.jsx(Pr,{className:"text-right",children:d.jsxs("div",{className:"flex justify-end gap-2",children:[d.jsx(Bt,{size:"icon",variant:"ghost",onClick:()=>Ke(fe),children:d.jsx(HZ,{className:"h-4 w-4"})}),d.jsx(Bt,{size:"icon",variant:"ghost",onClick:()=>{window.confirm("Deseja realmente marcar esta execuo como cancelada?")&&st(fe.id,"cancelado")},children:d.jsx($4,{className:"h-4 w-4"})}),d.jsx(Bt,{size:"icon",variant:"ghost",onClick:()=>{window.confirm("Deseja marcar esta execuo como atrasada?")&&st(fe.id,"atrasado")},children:d.jsx(Vy,{className:"h-4 w-4"})}),fe.status!=="concluido"&&d.jsx(Bt,{size:"icon",variant:"ghost",onClick:()=>Ne(fe.id),disabled:Y===fe.id,children:d.jsx(jl,{className:"h-4 w-4"})})]})})]},fe.id)}),De.length===0&&d.jsx(Yi,{children:d.jsx(Pr,{colSpan:7,className:"text-center text-muted-foreground",children:"Nenhuma execuo encontrada."})})]})]})]})]})]})]})})},tj={ativo:"Ativo",concluido:"Concludo",atrasado:"Atrasado",cancelado:"Cancelado"},OF=["ativo","atrasado"],ude=()=>{var Xe,Je;const[e,t]=F.useState([]),[i,l]=F.useState(""),[f,_]=F.useState(null),[x,o]=F.useState([]),[A,I]=F.useState({}),[N,U]=F.useState({resposta:"",conforme:!0,observacoes:"",foto:""}),[$,V]=F.useState(!0),[Y,q]=F.useState(!1),[Z,Q]=F.useState("all");F.useEffect(()=>{H()},[]),F.useEffect(()=>{i?K(i):(o([]),_(null))},[i]);const H=async()=>{try{const{data:Te,error:xe}=await Ge.from("execucao_checklist").select(`
          *,
          checklist:checklist ( id, nome ),
          supervisor:profiles ( id, full_name )
        `).order("data_prevista",{ascending:!1});if(xe)throw xe;t(Te??[])}catch(Te){console.error("Erro ao carregar execues:",Te),Yt.error("No foi possvel carregar as execues.")}finally{V(!1)}},K=async Te=>{try{q(!0);const{data:xe,error:Be}=await Ge.from("execucao_checklist_item").select(`
          *,
          checklist_item:checklist_item ( id, descricao, ordem )
        `).eq("execucao_checklist_id",Te).order("ordem",{foreignTable:"checklist_item",ascending:!0});if(Be)throw Be;const dt=(xe??[]).map(De=>De.id);let qt=[];if(dt.length>0){const{data:De,error:Tt}=await Ge.from("resposta_execucao_checklist_item").select("*").in("execucao_checklist_item_id",dt);if(Tt)throw Tt;qt=De}const Ke=new Map(qt.map(De=>[De.execucao_checklist_item_id,De]));o((xe==null?void 0:xe.map(De=>({...De,resposta:Ke.get(De.id)??null})))??[]),I(De=>{const Tt={...De};return(xe||[]).forEach(Pt=>{const fe=Ke.get(Pt.id);Tt[Pt.id]={resposta:(fe==null?void 0:fe.resposta)??"",conforme:(fe==null?void 0:fe.conforme)??!0,observacoes:(fe==null?void 0:fe.observacoes)??"",foto:(fe==null?void 0:fe.foto)??""}}),Tt});const{data:st,error:Ne}=await Ge.from("resposta_execucao_checklist").select("*").eq("execucao_checklist_id",Te).order("registrado_em",{ascending:!1}).limit(1);if(Ne)throw Ne;_((st==null?void 0:st[0])??null)}catch(xe){console.error("Erro ao carregar detalhes da execuo:",xe),Yt.error("No foi possvel carregar os detalhes da execuo selecionada.")}finally{q(!1)}},ne=async Te=>{if(Te.preventDefault(),!i){Yt.error("Selecione uma execuo.");return}if(!N.resposta){Yt.error("Descreva a resposta da execuo.");return}try{const{error:xe}=await Ge.from("resposta_execucao_checklist").insert({execucao_checklist_id:i,resposta:N.resposta,conforme:N.conforme,observacoes:N.observacoes||null,foto:N.foto||null});if(xe)throw xe;Yt.success("Resposta registrada."),await K(i)}catch(xe){console.error("Erro ao registrar resposta:",xe),Yt.error("No foi possvel registrar a resposta.")}},le=async Te=>{if(!i){Yt.error("Selecione uma execuo.");return}const xe=A[Te];if(!xe||!xe.resposta){Yt.error("Informe a resposta do item.");return}try{const{error:Be}=await Ge.from("resposta_execucao_checklist_item").insert({execucao_checklist_item_id:Te,resposta:xe.resposta,conforme:xe.conforme,observacoes:xe.observacoes||null,foto:xe.foto||null});if(Be)throw Be;Yt.success("Resposta do item registrada."),await K(i)}catch(Be){console.error("Erro ao responder item:",Be),Yt.error("No foi possvel registrar a resposta do item.")}},pe=F.useMemo(()=>e.filter(Te=>OF.includes(Te.status)).filter(Te=>Z==="all"?!0:Te.status===Z),[e,Z]);F.useEffect(()=>{i&&!pe.some(Te=>Te.id===i)&&l("")},[pe,i]);const Ae=pe.find(Te=>Te.id===i),Ze=Te=>Te==="concluido"?"default":Te==="cancelado"?"secondary":Te==="atrasado"?"destructive":"outline";return $?d.jsx("div",{className:"min-h-screen flex items-center justify-center",children:d.jsx("div",{className:"h-10 w-10 animate-spin rounded-full border-b-2 border-primary"})}):d.jsx(bo,{children:d.jsxs("div",{className:"space-y-6 p-4 md:p-6",children:[d.jsxs("div",{className:"flex flex-col gap-3 rounded-lg border bg-card p-4 md:flex-row md:items-center md:justify-between",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-3xl font-bold",children:"Respostas de checklist"}),d.jsx("p",{className:"text-muted-foreground",children:"Registre respostas das execues e acompanhe o progresso item a item."})]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsxs(Vr,{value:Z,onValueChange:Te=>Q(Te),children:[d.jsx(Or,{className:"w-[220px]",children:d.jsx(Ur,{placeholder:"Filtrar status"})}),d.jsxs(Lr,{className:"bg-popover",children:[d.jsx(bt,{value:"all",children:"Todas"}),OF.map(Te=>d.jsx(bt,{value:Te,children:tj[Te]},Te))]})]}),d.jsxs(Bt,{variant:"outline",onClick:H,children:[d.jsx(Uy,{className:"h-4 w-4 mr-2"}),"Atualizar"]})]})]}),d.jsxs(Sr,{children:[d.jsxs(wn,{children:[d.jsx(An,{children:"Selecione a execuo"}),d.jsx(fs,{children:"Escolha uma execuo para responder e ver o progresso."})]}),d.jsxs(tn,{className:"space-y-4",children:[d.jsxs(Vr,{value:i,onValueChange:Te=>l(Te),children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Selecione a execuo"})}),d.jsx(Lr,{className:"bg-popover",children:pe.map(Te=>{var xe;return d.jsxs(bt,{value:Te.id,children:[((xe=Te.checklist)==null?void 0:xe.nome)||Te.id," -"," ",Te.data_prevista?Kn(new Date(Te.data_prevista),"dd/MM/yyyy",{locale:js}):"Sem data"]},Te.id)})})]}),Ae&&d.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2",children:[d.jsxs(Sr,{children:[d.jsxs(wn,{className:"space-y-1",children:[d.jsxs(An,{className:"flex items-center gap-2",children:[d.jsx(d2,{className:"h-5 w-5"}),((Xe=Ae.checklist)==null?void 0:Xe.nome)||"Checklist"]}),d.jsx(fs,{children:"Dados bsicos da execuo"})]}),d.jsxs(tn,{className:"space-y-2",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"font-medium",children:"Status:"}),d.jsx(Gn,{variant:Ze(Ae.status),className:"capitalize",children:tj[Ae.status]})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"font-medium",children:"Data prevista:"}),d.jsx("span",{children:Ae.data_prevista?Kn(new Date(Ae.data_prevista),"dd/MM/yyyy",{locale:js}):"-"})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"font-medium",children:"Finalizado em:"}),d.jsx("span",{children:Ae.finalizado_em?Kn(new Date(Ae.finalizado_em),"dd/MM/yyyy HH:mm",{locale:js}):"-"})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"font-medium",children:"Supervisor:"}),d.jsx("span",{children:((Je=Ae.supervisor)==null?void 0:Je.full_name)||"-"})]}),f&&d.jsxs("div",{className:"rounded-md border bg-muted/30 p-3 space-y-1",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(Gn,{variant:f.conforme?"default":"destructive",children:f.conforme?"Conforme":"No conforme"}),d.jsx("span",{className:"text-xs text-muted-foreground",children:f.registrado_em?Kn(new Date(f.registrado_em),"dd/MM/yyyy HH:mm",{locale:js}):""})]}),d.jsx("p",{className:"text-sm",children:f.resposta}),f.observacoes&&d.jsx("p",{className:"text-xs text-muted-foreground",children:f.observacoes})]})]})]}),d.jsxs(Sr,{children:[d.jsxs(wn,{children:[d.jsx(An,{children:"Resposta da execuo"}),d.jsx(fs,{children:"Registro geral (opcional) da execuo."})]}),d.jsx(tn,{children:d.jsxs("form",{className:"space-y-3",onSubmit:ne,children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Resposta"}),d.jsx(hu,{value:N.resposta,onChange:Te=>U(xe=>({...xe,resposta:Te.target.value})),placeholder:"Resumo da execuo, observaes gerais..."})]}),d.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Conformidade"}),d.jsxs(Vr,{value:N.conforme?"true":"false",onValueChange:Te=>U(xe=>({...xe,conforme:Te==="true"})),children:[d.jsx(Or,{children:d.jsx(Ur,{})}),d.jsxs(Lr,{className:"bg-popover",children:[d.jsx(bt,{value:"true",children:"Conforme"}),d.jsx(bt,{value:"false",children:"No conforme"})]})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Foto (URL)"}),d.jsx(gr,{value:N.foto,onChange:Te=>U(xe=>({...xe,foto:Te.target.value}))})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Observaes"}),d.jsx(hu,{value:N.observacoes,onChange:Te=>U(xe=>({...xe,observacoes:Te.target.value}))})]}),d.jsxs(Bt,{type:"submit",disabled:Y,children:[d.jsx(eI,{className:"h-4 w-4 mr-2"}),"Registrar resposta"]})]})})]})]})]})]}),Ae&&d.jsxs(Sr,{children:[d.jsxs(wn,{children:[d.jsx(An,{children:"Itens da execuo"}),d.jsx(fs,{children:"Responda cada item e acompanhe o status individual."})]}),d.jsx(tn,{className:"space-y-4",children:d.jsxs(Jl,{children:[d.jsx(Ql,{children:d.jsxs(Yi,{children:[d.jsx(Yr,{children:"Ordem"}),d.jsx(Yr,{children:"Descrio"}),d.jsx(Yr,{children:"Status"}),d.jsx(Yr,{children:"Resposta"}),d.jsx(Yr,{className:"text-right",children:"Ao"})]})}),d.jsxs(ec,{children:[x.map(Te=>{var xe,Be,dt,qt,Ke,st;return d.jsxs(Yi,{children:[d.jsx(Pr,{children:((xe=Te.checklist_item)==null?void 0:xe.ordem)??"-"}),d.jsx(Pr,{className:"font-medium",children:((Be=Te.checklist_item)==null?void 0:Be.descricao)||"-"}),d.jsxs(Pr,{children:[d.jsx(Gn,{variant:Ze(Te.status),className:"capitalize",children:tj[Te.status]}),Te.resposta&&d.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:["Registrado em"," ",Te.resposta.registrado_em?Kn(new Date(Te.resposta.registrado_em),"dd/MM/yyyy HH:mm",{locale:js}):"-"]})]}),d.jsx(Pr,{children:d.jsxs("div",{className:"space-y-2",children:[d.jsx(gr,{placeholder:"Resposta",value:((dt=A[Te.id])==null?void 0:dt.resposta)||"",onChange:Ne=>I(De=>({...De,[Te.id]:{...De[Te.id]||wS,resposta:Ne.target.value}}))}),d.jsxs(Vr,{value:(qt=A[Te.id])!=null&&qt.conforme?"true":"false",onValueChange:Ne=>I(De=>({...De,[Te.id]:{...De[Te.id]||wS,conforme:Ne==="true"}})),children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Conformidade"})}),d.jsxs(Lr,{className:"bg-popover",children:[d.jsx(bt,{value:"true",children:"Conforme"}),d.jsx(bt,{value:"false",children:"No conforme"})]})]}),d.jsx(gr,{placeholder:"Observaes",value:((Ke=A[Te.id])==null?void 0:Ke.observacoes)||"",onChange:Ne=>I(De=>({...De,[Te.id]:{...De[Te.id]||wS,observacoes:Ne.target.value}}))}),d.jsx(gr,{placeholder:"Foto (URL)",value:((st=A[Te.id])==null?void 0:st.foto)||"",onChange:Ne=>I(De=>({...De,[Te.id]:{...De[Te.id]||wS,foto:Ne.target.value}}))})]})}),d.jsx(Pr,{className:"text-right",children:d.jsxs(Bt,{size:"sm",onClick:()=>le(Te.id),disabled:Y,children:[d.jsx(eI,{className:"h-4 w-4 mr-2"}),"Enviar"]})})]},Te.id)}),x.length===0&&d.jsx(Yi,{children:d.jsx(Pr,{colSpan:5,className:"text-center text-muted-foreground",children:"Nenhum item encontrado para esta execuo."})})]})]})})]})]})})},wS={resposta:"",conforme:!0,observacoes:"",foto:""},dde={ativo:"Ativo",concluido:"Concludo",atrasado:"Atrasado",cancelado:"Cancelado"},hde=()=>{const[e,t]=F.useState([]),[i,l]=F.useState([]),[f,_]=F.useState([]),[x,o]=F.useState("all"),[A,I]=F.useState("all"),[N,U]=F.useState(""),[$,V]=F.useState(""),[Y,q]=F.useState(!0);F.useEffect(()=>{Z()},[]);const Z=async()=>{q(!0);try{await Promise.all([Q(),H(),K()])}catch(le){console.error("Erro ao carregar respostas:",le),Yt.error("No foi possvel carregar as respostas das execues.")}finally{q(!1)}},Q=async()=>{const{data:le,error:pe}=await Ge.from("resposta_execucao_checklist").select(`
        id,
        resposta,
        conforme,
        observacoes,
        foto,
        registrado_em,
        execucao:execucao_checklist (
          id,
          checklist_id,
          supervisor_id,
          status,
          data_prevista,
          finalizado_em,
          checklist:checklist ( id, nome ),
          supervisor:profiles ( id, full_name )
        )
      `).order("registrado_em",{ascending:!1});if(pe)throw pe;t(le??[])},H=async()=>{const{data:le,error:pe}=await Ge.from("checklist").select("id, nome").order("nome");if(pe)throw pe;l(le??[])},K=async()=>{const{data:le,error:pe}=await Ge.from("profiles").select("id, full_name").order("full_name");if(pe)throw pe;_(le??[])},ne=F.useMemo(()=>{const le=N?new Date(N):null,pe=$?new Date($):null;return e.filter(Ae=>{var xe,Be;const Ze=x==="all"||((xe=Ae.execucao)==null?void 0:xe.supervisor_id)===x,Xe=A==="all"||((Be=Ae.execucao)==null?void 0:Be.checklist_id)===A,Je=Ae.registrado_em?new Date(Ae.registrado_em):null,Te=(!le||Je&&Je>=le)&&(!pe||Je&&Je<=pe);return Ze&&Xe&&Te})},[e,x,A,N,$]);return Y?d.jsx("div",{className:"flex min-h-screen items-center justify-center",children:d.jsx("div",{className:"h-10 w-10 animate-spin rounded-full border-b-2 border-primary"})}):d.jsx(bo,{children:d.jsxs("div",{className:"space-y-6 p-4 md:p-6",children:[d.jsxs("div",{className:"flex flex-col gap-3 rounded-lg border bg-card p-4 md:flex-row md:items-center md:justify-between",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-3xl font-bold",children:"Respostas das execues"}),d.jsx("p",{className:"text-muted-foreground",children:"Histrico de respostas de execues de checklist com filtros por supervisor, checklist e data."})]}),d.jsxs(Bt,{variant:"outline",onClick:Z,children:[d.jsx(Uy,{className:"mr-2 h-4 w-4"}),"Atualizar"]})]}),d.jsxs(Sr,{children:[d.jsxs(wn,{children:[d.jsx(An,{children:"Filtros"}),d.jsx(fs,{children:"Refine a listagem de respostas."})]}),d.jsxs(tn,{className:"grid grid-cols-1 gap-4 md:grid-cols-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Supervisor"}),d.jsxs(Vr,{value:x,onValueChange:o,children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Supervisor"})}),d.jsxs(Lr,{className:"bg-popover",children:[d.jsx(bt,{value:"all",children:"Todos"}),f.map(le=>d.jsx(bt,{value:le.id,children:le.full_name||le.id},le.id))]})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Checklist"}),d.jsxs(Vr,{value:A,onValueChange:I,children:[d.jsx(Or,{children:d.jsx(Ur,{placeholder:"Checklist"})}),d.jsxs(Lr,{className:"bg-popover",children:[d.jsx(bt,{value:"all",children:"Todos"}),i.map(le=>d.jsx(bt,{value:le.id,children:le.nome},le.id))]})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Data inicial"}),d.jsx(gr,{type:"date",value:N,onChange:le=>U(le.target.value)})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(Gt,{children:"Data final"}),d.jsx(gr,{type:"date",value:$,onChange:le=>V(le.target.value)})]})]})]}),d.jsxs(Sr,{children:[d.jsxs(wn,{children:[d.jsx(An,{children:"Respostas registradas"}),d.jsx(fs,{children:"Listagem com supervisor, checklist e data."})]}),d.jsxs(tn,{className:"space-y-4",children:[d.jsxs("div",{className:"text-sm text-muted-foreground",children:[ne.length," resposta(s) encontrada(s)"]}),d.jsxs(Jl,{children:[d.jsx(Ql,{children:d.jsxs(Yi,{children:[d.jsx(Yr,{children:"Checklist"}),d.jsx(Yr,{children:"Supervisor"}),d.jsx(Yr,{children:"Conformidade"}),d.jsx(Yr,{children:"Resposta"}),d.jsx(Yr,{children:"Registrado em"}),d.jsx(Yr,{children:"Observaes"})]})}),d.jsxs(ec,{children:[ne.map(le=>{var pe,Ae,Ze,Xe,Je;return d.jsxs(Yi,{children:[d.jsx(Pr,{className:"font-medium",children:((Ae=(pe=le.execucao)==null?void 0:pe.checklist)==null?void 0:Ae.nome)||"-"}),d.jsx(Pr,{children:((Xe=(Ze=le.execucao)==null?void 0:Ze.supervisor)==null?void 0:Xe.full_name)||"-"}),d.jsxs(Pr,{children:[d.jsx(Gn,{variant:le.conforme?"default":"destructive",children:le.conforme?"Conforme":"No conforme"}),d.jsx("div",{className:"text-xs text-muted-foreground",children:dde[(Je=le.execucao)==null?void 0:Je.status]||"-"})]}),d.jsx(Pr,{className:"max-w-xs whitespace-pre-wrap text-sm",children:le.resposta}),d.jsx(Pr,{children:le.registrado_em?Kn(new Date(le.registrado_em),"dd/MM/yyyy HH:mm",{locale:js}):"-"}),d.jsx(Pr,{className:"max-w-xs whitespace-pre-wrap text-sm",children:le.observacoes||"-"})]},le.id)}),ne.length===0&&d.jsx(Yi,{children:d.jsx(Pr,{colSpan:6,className:"text-center text-muted-foreground",children:"Nenhuma resposta encontrada."})})]})]})]})]})]})})},fde=()=>{const e=Yf();return F.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",e.pathname)},[e.pathname]),d.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-100",children:d.jsxs("div",{className:"text-center",children:[d.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),d.jsx("p",{className:"mb-4 text-xl text-gray-600",children:"Oops! Page not found"}),d.jsx("a",{href:"/",className:"text-blue-500 underline hover:text-blue-700",children:"Return to Home"})]})})},pde=new _J,mde=()=>d.jsx(wJ,{client:pde,children:d.jsxs(O5,{children:[d.jsx(OX,{}),d.jsx(pK,{}),d.jsx(kQ,{children:d.jsxs(wQ,{children:[d.jsx(vs,{path:"/",element:d.jsx(nre,{})}),d.jsx(vs,{path:"/auth",element:d.jsx(Une,{})}),d.jsx(vs,{path:"/reset-password",element:d.jsx(ise,{})}),d.jsx(vs,{path:"/dashboard",element:d.jsx(Zs,{children:d.jsx(bie,{})})}),d.jsx(vs,{path:"/dashboard-24h",element:d.jsx(Zs,{children:d.jsx(Tie,{})})}),d.jsx(vs,{path:"/users",element:d.jsx(Zs,{children:d.jsx(rse,{})})}),d.jsx(vs,{path:"/contratos",element:d.jsx(Zs,{children:d.jsx(cue,{})})}),d.jsx(vs,{path:"/mesa-operacoes",element:d.jsx(Zs,{children:d.jsx(hue,{})})}),d.jsx(vs,{path:"/chamados",element:d.jsx(Zs,{children:d.jsx(Oae,{})})}),d.jsx(vs,{path:"/ordens-servico",element:d.jsx(Zs,{children:d.jsx(yue,{})})}),d.jsx(vs,{path:"/colaboradores",element:d.jsx(Zs,{children:d.jsx(Mue,{})})}),d.jsx(vs,{path:"/escalas",element:d.jsx(Zs,{children:d.jsx(Due,{})})}),d.jsx(vs,{path:"/ativos",element:d.jsx(Zs,{children:d.jsx(Lue,{})})}),d.jsx(vs,{path:"/estoque",element:d.jsx(Zs,{children:d.jsx(Fue,{})})}),d.jsx(vs,{path:"/diaristas",element:d.jsx(Zs,{children:d.jsx(Uue,{})})}),d.jsx(vs,{path:"/diarias/aguardando",element:d.jsx(Zs,{children:d.jsx(Kue,{})})}),d.jsx(vs,{path:"/diarias/confirmadas",element:d.jsx(Zs,{children:d.jsx(Yue,{})})}),d.jsx(vs,{path:"/diarias/aprovadas",element:d.jsx(Zs,{children:d.jsx(Jue,{})})}),d.jsx(vs,{path:"/diarias/lancadas",element:d.jsx(Zs,{children:d.jsx(Que,{})})}),d.jsx(vs,{path:"/diarias/aprovadas-pagamento",element:d.jsx(Zs,{children:d.jsx(ede,{})})}),d.jsx(vs,{path:"/diarias/canceladas",element:d.jsx(Zs,{children:d.jsx(tde,{})})}),d.jsx(vs,{path:"/diarias",element:d.jsx(Zs,{children:d.jsx(ide,{})})}),d.jsx(vs,{path:"/inspecao",element:d.jsx(Zs,{children:d.jsx(ode,{})})}),d.jsx(vs,{path:"/checklists",element:d.jsx(Zs,{children:d.jsx(ade,{})})}),d.jsx(vs,{path:"/checklist-itens",element:d.jsx(Zs,{children:d.jsx(lde,{})})}),d.jsx(vs,{path:"/checklist-execucoes",element:d.jsx(Zs,{children:d.jsx(cde,{})})}),d.jsx(vs,{path:"/checklist-respostas",element:d.jsx(Zs,{children:d.jsx(ude,{})})}),d.jsx(vs,{path:"/checklist-respostas-lista",element:d.jsx(Zs,{children:d.jsx(hde,{})})}),d.jsx(vs,{path:"*",element:d.jsx(fde,{})})]})})]})});a4(document.getElementById("root")).render(d.jsx(mde,{}));
